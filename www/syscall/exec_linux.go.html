<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2092914">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2092969">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2093023">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2093074">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2093091">package</span>&nbsp;<span class="ident" id="2093099">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2093108">import</span>&nbsp;<span class="op" id="2093115">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2093118">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2093127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2093130">//&nbsp;SysProcIDMap&nbsp;holds&nbsp;Container&nbsp;ID&nbsp;to&nbsp;Host&nbsp;ID&nbsp;mappings&nbsp;used&nbsp;for&nbsp;User&nbsp;Namespaces&nbsp;in&nbsp;Linux.</span><br>
<span class="lineno"></span><span class="comment" id="2093220">//&nbsp;See&nbsp;user_namespaces(7).</span><br>
<span class="lineno">15</span><span class="keyword" id="2093247">type</span>&nbsp;<span class="ident" id="2093252">SysProcIDMap</span>&nbsp;<span class="keyword" id="2093265">struct</span>&nbsp;<span class="op" id="2093272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093275">ContainerID</span>&nbsp;<span class="builtintype" id="2093287">int</span>&nbsp;<span class="comment" id="2093291">//&nbsp;Container&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093309">HostID</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093321">int</span>&nbsp;<span class="comment" id="2093325">//&nbsp;Host&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093338">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093350">int</span>&nbsp;<span class="comment" id="2093354">//&nbsp;Size.</span><br>
<span class="lineno"></span><span class="op" id="2093363">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2093366">type</span>&nbsp;<span class="ident" id="2093371">SysProcAttr</span>&nbsp;<span class="keyword" id="2093383">struct</span>&nbsp;<span class="op" id="2093390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093393">Chroot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093405">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093420">//&nbsp;Chroot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093432">Credential</span>&nbsp;&nbsp;<span class="op" id="2093444">*</span><span class="ident" id="2093445"><a href="/syscall/exec_unix.go.html#2106415">Credential</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093459">//&nbsp;Credential.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093475">Ptrace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093487">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093502">//&nbsp;Enable&nbsp;tracing.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093522">Setsid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093534">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093549">//&nbsp;Create&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093569">Setpgid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093581">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093596">//&nbsp;Set&nbsp;process&nbsp;group&nbsp;ID&nbsp;to&nbsp;new&nbsp;pid&nbsp;(SYSV&nbsp;setpgrp)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093647">Setctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093659">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093674">//&nbsp;Set&nbsp;controlling&nbsp;terminal&nbsp;to&nbsp;fd&nbsp;Ctty&nbsp;(only&nbsp;meaningful&nbsp;if&nbsp;Setsid&nbsp;is&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093749">Noctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093761">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093776">//&nbsp;Detach&nbsp;fd&nbsp;0&nbsp;from&nbsp;controlling&nbsp;terminal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093818">Ctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2093830">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093845">//&nbsp;Controlling&nbsp;TTY&nbsp;fd&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093881">Pdeathsig</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2093893"><a href="/syscall/syscall_unix.go.html#2159613">Signal</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093908">//&nbsp;Signal&nbsp;that&nbsp;the&nbsp;process&nbsp;will&nbsp;get&nbsp;when&nbsp;its&nbsp;parent&nbsp;dies&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093979">Cloneflags</span>&nbsp;&nbsp;<span class="builtintype" id="2093991">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2094006">//&nbsp;Flags&nbsp;for&nbsp;clone&nbsp;calls&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094045">UidMappings</span>&nbsp;<span class="op" id="2094057">[</span><span class="op" id="2094058">]</span><span class="ident" id="2094059"><a href="/syscall/exec_linux.go.html#2093252">SysProcIDMap</a></span>&nbsp;<span class="comment" id="2094072">//&nbsp;User&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094114">GidMappings</span>&nbsp;<span class="op" id="2094126">[</span><span class="op" id="2094127">]</span><span class="ident" id="2094128"><a href="/syscall/exec_linux.go.html#2093252">SysProcIDMap</a></span>&nbsp;<span class="comment" id="2094141">//&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces.</span><br>
<span class="lineno"></span><span class="op" id="2094183">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2094186">//&nbsp;Implemented&nbsp;in&nbsp;runtime&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="2094221">func</span>&nbsp;<span class="ident" id="2094226">runtime_BeforeFork</span><span class="op" id="2094244">(</span><span class="op" id="2094245">)</span><br>
<span class="lineno"></span><span class="keyword" id="2094247">func</span>&nbsp;<span class="ident" id="2094252">runtime_AfterFork</span><span class="op" id="2094269">(</span><span class="op" id="2094270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2094273">//&nbsp;Fork,&nbsp;dup&nbsp;fd&nbsp;onto&nbsp;0..len(fd),&nbsp;and&nbsp;exec(argv0,&nbsp;argvv,&nbsp;envv)&nbsp;in&nbsp;child.</span><br>
<span class="lineno"></span><span class="comment" id="2094345">//&nbsp;If&nbsp;a&nbsp;dup&nbsp;or&nbsp;exec&nbsp;fails,&nbsp;write&nbsp;the&nbsp;errno&nbsp;error&nbsp;to&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="2094403">//&nbsp;(Pipe&nbsp;is&nbsp;close-on-exec&nbsp;so&nbsp;if&nbsp;exec&nbsp;succeeds,&nbsp;it&nbsp;will&nbsp;be&nbsp;closed.)</span><br>
<span class="lineno"></span><span class="comment" id="2094470">//&nbsp;In&nbsp;the&nbsp;child,&nbsp;this&nbsp;function&nbsp;must&nbsp;not&nbsp;acquire&nbsp;any&nbsp;locks,&nbsp;because</span><br>
<span class="lineno"></span><span class="comment" id="2094537">//&nbsp;they&nbsp;might&nbsp;have&nbsp;been&nbsp;locked&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;fork.&nbsp;&nbsp;This&nbsp;means</span><br>
<span class="lineno">45</span><span class="comment" id="2094605">//&nbsp;no&nbsp;rescheduling,&nbsp;no&nbsp;malloc&nbsp;calls,&nbsp;and&nbsp;no&nbsp;new&nbsp;stack&nbsp;segments.</span><br>
<span class="lineno"></span><span class="comment" id="2094669">//&nbsp;For&nbsp;the&nbsp;same&nbsp;reason&nbsp;compiler&nbsp;does&nbsp;not&nbsp;race&nbsp;instrument&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2094730">//&nbsp;The&nbsp;calls&nbsp;to&nbsp;RawSyscall&nbsp;are&nbsp;okay&nbsp;because&nbsp;they&nbsp;are&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="2094792">//&nbsp;functions&nbsp;that&nbsp;do&nbsp;not&nbsp;grow&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="2094833">func</span>&nbsp;<span class="ident" id="2094838">forkAndExecInChild</span><span class="op" id="2094856">(</span><span class="ident" id="2094857">argv0</span>&nbsp;<span class="op" id="2094863">*</span><span class="builtintype" id="2094864">byte</span><span class="op" id="2094868">,</span>&nbsp;<span class="ident" id="2094870">argv</span><span class="op" id="2094874">,</span>&nbsp;<span class="ident" id="2094876">envv</span>&nbsp;<span class="op" id="2094881">[</span><span class="op" id="2094882">]</span><span class="op" id="2094883">*</span><span class="builtintype" id="2094884">byte</span><span class="op" id="2094888">,</span>&nbsp;<span class="ident" id="2094890">chroot</span><span class="op" id="2094896">,</span>&nbsp;<span class="ident" id="2094898">dir</span>&nbsp;<span class="op" id="2094902">*</span><span class="builtintype" id="2094903">byte</span><span class="op" id="2094907">,</span>&nbsp;<span class="ident" id="2094909">attr</span>&nbsp;<span class="op" id="2094914">*</span><span class="ident" id="2094915"><a href="/syscall/exec_unix.go.html#2106642">ProcAttr</a></span><span class="op" id="2094923">,</span>&nbsp;<span class="ident" id="2094925">sys</span>&nbsp;<span class="op" id="2094929">*</span><span class="ident" id="2094930"><a href="/syscall/exec_linux.go.html#2093371">SysProcAttr</a></span><span class="op" id="2094941">,</span>&nbsp;<span class="ident" id="2094943">pipe</span>&nbsp;<span class="builtintype" id="2094948">int</span><span class="op" id="2094951">)</span>&nbsp;<span class="op" id="2094953">(</span><span class="ident" id="2094954">pid</span>&nbsp;<span class="builtintype" id="2094958">int</span><span class="op" id="2094961">,</span>&nbsp;<span class="ident" id="2094963">err</span>&nbsp;<span class="ident" id="2094967"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2094972">)</span>&nbsp;<span class="op" id="2094974">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2094977">//&nbsp;Declare&nbsp;all&nbsp;variables&nbsp;at&nbsp;top&nbsp;in&nbsp;case&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095022">//&nbsp;declarations&nbsp;require&nbsp;heap&nbsp;allocation&nbsp;(e.g.,&nbsp;err1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095077">var</span>&nbsp;<span class="op" id="2095081">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095085">r1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2095092">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095102">err1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2095109"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095117">err2</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2095124"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095132">nextfd</span>&nbsp;<span class="builtintype" id="2095139">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095145">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2095152">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095158">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2095165">[</span><span class="num" id="2095166">2</span><span class="op" id="2095167">]</span><span class="builtintype" id="2095168">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2095173">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095177">//&nbsp;Guard&nbsp;against&nbsp;side&nbsp;effects&nbsp;of&nbsp;shuffling&nbsp;fds&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095232">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;nextfd&nbsp;is&nbsp;beyond&nbsp;any&nbsp;currently&nbsp;open&nbsp;files&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095296">//&nbsp;that&nbsp;we&nbsp;can&#39;t&nbsp;run&nbsp;the&nbsp;risk&nbsp;of&nbsp;overwriting&nbsp;any&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095355">fd</span>&nbsp;<span class="op" id="2095358">:=</span>&nbsp;<span class="builtinfunc" id="2095361">make</span><span class="op" id="2095365">(</span><span class="op" id="2095366">[</span><span class="op" id="2095367">]</span><span class="builtintype" id="2095368">int</span><span class="op" id="2095371">,</span>&nbsp;<span class="builtinfunc" id="2095373">len</span><span class="op" id="2095376">(</span><span class="ident" id="2095377"><a href="/syscall/exec_linux.go.html#2094909">attr</a></span><span class="op" id="2095381">.</span><span class="ident" id="2095382">Files</span><span class="op" id="2095387">)</span><span class="op" id="2095388">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095391"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span>&nbsp;<span class="op" id="2095398">=</span>&nbsp;<span class="builtinfunc" id="2095400">len</span><span class="op" id="2095403">(</span><span class="ident" id="2095404"><a href="/syscall/exec_linux.go.html#2094909">attr</a></span><span class="op" id="2095408">.</span><span class="ident" id="2095409">Files</span><span class="op" id="2095414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095417">for</span>&nbsp;<span class="ident" id="2095421">i</span><span class="op" id="2095422">,</span>&nbsp;<span class="ident" id="2095424">ufd</span>&nbsp;<span class="op" id="2095428">:=</span>&nbsp;<span class="keyword" id="2095431">range</span>&nbsp;<span class="ident" id="2095437"><a href="/syscall/exec_linux.go.html#2094909">attr</a></span><span class="op" id="2095441">.</span><span class="ident" id="2095442">Files</span>&nbsp;<span class="op" id="2095448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095452">if</span>&nbsp;<span class="ident" id="2095455"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span>&nbsp;<span class="op" id="2095462">&lt;</span>&nbsp;<span class="builtintype" id="2095464">int</span><span class="op" id="2095467">(</span><span class="ident" id="2095468"><a href="/syscall/exec_linux.go.html#2095424">ufd</a></span><span class="op" id="2095471">)</span>&nbsp;<span class="op" id="2095473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095478"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span>&nbsp;<span class="op" id="2095485">=</span>&nbsp;<span class="builtintype" id="2095487">int</span><span class="op" id="2095490">(</span><span class="ident" id="2095491"><a href="/syscall/exec_linux.go.html#2095424">ufd</a></span><span class="op" id="2095494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2095498">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095502"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2095504">[</span><span class="ident" id="2095505"><a href="/syscall/exec_linux.go.html#2095421">i</a></span><span class="op" id="2095506">]</span>&nbsp;<span class="op" id="2095508">=</span>&nbsp;<span class="builtintype" id="2095510">int</span><span class="op" id="2095513">(</span><span class="ident" id="2095514"><a href="/syscall/exec_linux.go.html#2095424">ufd</a></span><span class="op" id="2095517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2095520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095523"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2095529">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095534">//&nbsp;Allocate&nbsp;another&nbsp;pipe&nbsp;for&nbsp;parent&nbsp;to&nbsp;child&nbsp;communication&nbsp;for</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095598">//&nbsp;synchronizing&nbsp;writing&nbsp;of&nbsp;User&nbsp;ID/Group&nbsp;ID&nbsp;mappings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095654">if</span>&nbsp;<span class="ident" id="2095657"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2095660">.</span><span class="ident" id="2095661">UidMappings</span>&nbsp;<span class="op" id="2095673">!=</span>&nbsp;<span class="ident" id="2095676">nil</span>&nbsp;<span class="op" id="2095680">||</span>&nbsp;<span class="ident" id="2095683"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2095686">.</span><span class="ident" id="2095687">GidMappings</span>&nbsp;<span class="op" id="2095699">!=</span>&nbsp;<span class="ident" id="2095702">nil</span>&nbsp;<span class="op" id="2095706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095710">if</span>&nbsp;<span class="ident" id="2095713">err</span>&nbsp;<span class="op" id="2095717">:=</span>&nbsp;<span class="ident" id="2095720"><a href="/syscall/exec_linux.go.html#2101018">forkExecPipe</a></span><span class="op" id="2095732">(</span><span class="ident" id="2095733"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2095734">[</span><span class="op" id="2095735">:</span><span class="op" id="2095736">]</span><span class="op" id="2095737">)</span><span class="op" id="2095738">;</span>&nbsp;<span class="ident" id="2095740"><a href="/syscall/exec_linux.go.html#2095713">err</a></span>&nbsp;<span class="op" id="2095744">!=</span>&nbsp;<span class="ident" id="2095747">nil</span>&nbsp;<span class="op" id="2095751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095756">return</span>&nbsp;<span class="num" id="2095763">0</span><span class="op" id="2095764">,</span>&nbsp;<span class="ident" id="2095766"><a href="/syscall/exec_linux.go.html#2095713">err</a></span><span class="op" id="2095769">.</span><span class="op" id="2095770">(</span><span class="ident" id="2095771"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2095776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2095780">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2095783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095787">//&nbsp;About&nbsp;to&nbsp;call&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2095811">//&nbsp;No&nbsp;more&nbsp;allocation&nbsp;or&nbsp;calls&nbsp;of&nbsp;non-assembly&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095870"><a href="/syscall/exec_linux.go.html#2094226">runtime_BeforeFork</a></span><span class="op" id="2095888">(</span><span class="op" id="2095889">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095892"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span><span class="op" id="2095894">,</span>&nbsp;<span class="ident" id="2095896">_</span><span class="op" id="2095897">,</span>&nbsp;<span class="ident" id="2095899"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2095904">=</span>&nbsp;<span class="ident" id="2095906"><a href="/syscall/syscall_unix.go.html#2157407">RawSyscall6</a></span><span class="op" id="2095917">(</span><span class="ident" id="2095918"><a href="/syscall/zsysnum_linux_amd64.go.html#2271150">SYS_CLONE</a></span><span class="op" id="2095927">,</span>&nbsp;<span class="builtintype" id="2095929">uintptr</span><span class="op" id="2095936">(</span><span class="ident" id="2095937"><a href="/syscall/zerrors_linux_amd64.go.html#2217661">SIGCHLD</a></span><span class="op" id="2095944">)</span><span class="op" id="2095945">|</span><span class="ident" id="2095946"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2095949">.</span><span class="ident" id="2095950">Cloneflags</span><span class="op" id="2095960">,</span>&nbsp;<span class="num" id="2095962">0</span><span class="op" id="2095963">,</span>&nbsp;<span class="num" id="2095965">0</span><span class="op" id="2095966">,</span>&nbsp;<span class="num" id="2095968">0</span><span class="op" id="2095969">,</span>&nbsp;<span class="num" id="2095971">0</span><span class="op" id="2095972">,</span>&nbsp;<span class="num" id="2095974">0</span><span class="op" id="2095975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2095978">if</span>&nbsp;<span class="ident" id="2095981"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2095986">!=</span>&nbsp;<span class="num" id="2095989">0</span>&nbsp;<span class="op" id="2095991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2095995"><a href="/syscall/exec_linux.go.html#2094252">runtime_AfterFork</a></span><span class="op" id="2096012">(</span><span class="op" id="2096013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096017">return</span>&nbsp;<span class="num" id="2096024">0</span><span class="op" id="2096025">,</span>&nbsp;<span class="ident" id="2096027"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096033">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096037">if</span>&nbsp;<span class="ident" id="2096040"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span>&nbsp;<span class="op" id="2096043">!=</span>&nbsp;<span class="num" id="2096046">0</span>&nbsp;<span class="op" id="2096048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2096052">//&nbsp;parent;&nbsp;return&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096076"><a href="/syscall/exec_linux.go.html#2094252">runtime_AfterFork</a></span><span class="op" id="2096093">(</span><span class="op" id="2096094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096098"><a href="/syscall/exec_linux.go.html#2094954">pid</a></span>&nbsp;<span class="op" id="2096102">=</span>&nbsp;<span class="builtintype" id="2096104">int</span><span class="op" id="2096107">(</span><span class="ident" id="2096108"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span><span class="op" id="2096110">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096115">if</span>&nbsp;<span class="ident" id="2096118"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096121">.</span><span class="ident" id="2096122">UidMappings</span>&nbsp;<span class="op" id="2096134">!=</span>&nbsp;<span class="ident" id="2096137">nil</span>&nbsp;<span class="op" id="2096141">||</span>&nbsp;<span class="ident" id="2096144"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096147">.</span><span class="ident" id="2096148">GidMappings</span>&nbsp;<span class="op" id="2096160">!=</span>&nbsp;<span class="ident" id="2096163">nil</span>&nbsp;<span class="op" id="2096167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096172"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2096177">(</span><span class="ident" id="2096178"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2096179">[</span><span class="num" id="2096180">0</span><span class="op" id="2096181">]</span><span class="op" id="2096182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096187">err</span>&nbsp;<span class="op" id="2096191">:=</span>&nbsp;<span class="ident" id="2096194"><a href="/syscall/exec_linux.go.html#2102121">writeUidGidMappings</a></span><span class="op" id="2096213">(</span><span class="ident" id="2096214"><a href="/syscall/exec_linux.go.html#2094954">pid</a></span><span class="op" id="2096217">,</span>&nbsp;<span class="ident" id="2096219"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096227">if</span>&nbsp;<span class="ident" id="2096230"><a href="/syscall/exec_linux.go.html#2096187">err</a></span>&nbsp;<span class="op" id="2096234">!=</span>&nbsp;<span class="ident" id="2096237">nil</span>&nbsp;<span class="op" id="2096241">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096247"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span>&nbsp;<span class="op" id="2096252">=</span>&nbsp;<span class="ident" id="2096254"><a href="/syscall/exec_linux.go.html#2096187">err</a></span><span class="op" id="2096257">.</span><span class="op" id="2096258">(</span><span class="ident" id="2096259"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2096264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096274"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2096284">(</span><span class="ident" id="2096285"><a href="/syscall/zsysnum_linux_amd64.go.html#2269344">SYS_WRITE</a></span><span class="op" id="2096294">,</span>&nbsp;<span class="builtintype" id="2096296">uintptr</span><span class="op" id="2096303">(</span><span class="ident" id="2096304"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2096305">[</span><span class="num" id="2096306">1</span><span class="op" id="2096307">]</span><span class="op" id="2096308">)</span><span class="op" id="2096309">,</span>&nbsp;<span class="builtintype" id="2096311">uintptr</span><span class="op" id="2096318">(</span><span class="ident" id="2096319"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2096325">.</span><span class="ident" id="2096326">Pointer</span><span class="op" id="2096333">(</span><span class="op" id="2096334">&amp;</span><span class="ident" id="2096335"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><span class="op" id="2096339">)</span><span class="op" id="2096340">)</span><span class="op" id="2096341">,</span>&nbsp;<span class="ident" id="2096343"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2096349">.</span><span class="ident" id="2096350">Sizeof</span><span class="op" id="2096356">(</span><span class="ident" id="2096357"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><span class="op" id="2096361">)</span><span class="op" id="2096362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096367"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2096372">(</span><span class="ident" id="2096373"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2096374">[</span><span class="num" id="2096375">1</span><span class="op" id="2096376">]</span><span class="op" id="2096377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096381">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096386">return</span>&nbsp;<span class="ident" id="2096393"><a href="/syscall/exec_linux.go.html#2094954">pid</a></span><span class="op" id="2096396">,</span>&nbsp;<span class="num" id="2096398">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2096405">//&nbsp;Fork&nbsp;succeeded,&nbsp;now&nbsp;in&nbsp;child.</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2096440">//&nbsp;Wait&nbsp;for&nbsp;User&nbsp;ID/Group&nbsp;ID&nbsp;mappings&nbsp;to&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096494">if</span>&nbsp;<span class="ident" id="2096497"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096500">.</span><span class="ident" id="2096501">UidMappings</span>&nbsp;<span class="op" id="2096513">!=</span>&nbsp;<span class="ident" id="2096516">nil</span>&nbsp;<span class="op" id="2096520">||</span>&nbsp;<span class="ident" id="2096523"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096526">.</span><span class="ident" id="2096527">GidMappings</span>&nbsp;<span class="op" id="2096539">!=</span>&nbsp;<span class="ident" id="2096542">nil</span>&nbsp;<span class="op" id="2096546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096550">if</span>&nbsp;<span class="ident" id="2096553">_</span><span class="op" id="2096554">,</span>&nbsp;<span class="ident" id="2096556">_</span><span class="op" id="2096557">,</span>&nbsp;<span class="ident" id="2096559"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096564">=</span>&nbsp;<span class="ident" id="2096566"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2096576">(</span><span class="ident" id="2096577"><a href="/syscall/zsysnum_linux_amd64.go.html#2269408">SYS_CLOSE</a></span><span class="op" id="2096586">,</span>&nbsp;<span class="builtintype" id="2096588">uintptr</span><span class="op" id="2096595">(</span><span class="ident" id="2096596"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2096597">[</span><span class="num" id="2096598">1</span><span class="op" id="2096599">]</span><span class="op" id="2096600">)</span><span class="op" id="2096601">,</span>&nbsp;<span class="num" id="2096603">0</span><span class="op" id="2096604">,</span>&nbsp;<span class="num" id="2096606">0</span><span class="op" id="2096607">)</span><span class="op" id="2096608">;</span>&nbsp;<span class="ident" id="2096610"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096615">!=</span>&nbsp;<span class="num" id="2096618">0</span>&nbsp;<span class="op" id="2096620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096625">goto</span>&nbsp;<span class="ident" id="2096630">childerror</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096647"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span><span class="op" id="2096649">,</span>&nbsp;<span class="ident" id="2096651">_</span><span class="op" id="2096652">,</span>&nbsp;<span class="ident" id="2096654"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096659">=</span>&nbsp;<span class="ident" id="2096661"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2096671">(</span><span class="ident" id="2096672"><a href="/syscall/zsysnum_linux_amd64.go.html#2269312">SYS_READ</a></span><span class="op" id="2096680">,</span>&nbsp;<span class="builtintype" id="2096682">uintptr</span><span class="op" id="2096689">(</span><span class="ident" id="2096690"><a href="/syscall/exec_linux.go.html#2095158">p</a></span><span class="op" id="2096691">[</span><span class="num" id="2096692">0</span><span class="op" id="2096693">]</span><span class="op" id="2096694">)</span><span class="op" id="2096695">,</span>&nbsp;<span class="builtintype" id="2096697">uintptr</span><span class="op" id="2096704">(</span><span class="ident" id="2096705"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2096711">.</span><span class="ident" id="2096712">Pointer</span><span class="op" id="2096719">(</span><span class="op" id="2096720">&amp;</span><span class="ident" id="2096721"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><span class="op" id="2096725">)</span><span class="op" id="2096726">)</span><span class="op" id="2096727">,</span>&nbsp;<span class="ident" id="2096729"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2096735">.</span><span class="ident" id="2096736">Sizeof</span><span class="op" id="2096742">(</span><span class="ident" id="2096743"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><span class="op" id="2096747">)</span><span class="op" id="2096748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096752">if</span>&nbsp;<span class="ident" id="2096755"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096760">!=</span>&nbsp;<span class="num" id="2096763">0</span>&nbsp;<span class="op" id="2096765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096770">goto</span>&nbsp;<span class="ident" id="2096775">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096788">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096792">if</span>&nbsp;<span class="ident" id="2096795"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span>&nbsp;<span class="op" id="2096798">!=</span>&nbsp;<span class="ident" id="2096801"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2096807">.</span><span class="ident" id="2096808">Sizeof</span><span class="op" id="2096814">(</span><span class="ident" id="2096815"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><span class="op" id="2096819">)</span>&nbsp;<span class="op" id="2096821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096826"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096831">=</span>&nbsp;<span class="ident" id="2096833"><a href="/syscall/zerrors_linux_amd64.go.html#2214659">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096843">goto</span>&nbsp;<span class="ident" id="2096848">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096865">if</span>&nbsp;<span class="ident" id="2096868"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span>&nbsp;<span class="op" id="2096873">!=</span>&nbsp;<span class="num" id="2096876">0</span>&nbsp;<span class="op" id="2096878">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096883"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096888">=</span>&nbsp;<span class="ident" id="2096890"><a href="/syscall/exec_linux.go.html#2095117">err2</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096898">goto</span>&nbsp;<span class="ident" id="2096903">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2096919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2096923">//&nbsp;Parent&nbsp;death&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2096947">if</span>&nbsp;<span class="ident" id="2096950"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2096953">.</span><span class="ident" id="2096954">Pdeathsig</span>&nbsp;<span class="op" id="2096964">!=</span>&nbsp;<span class="num" id="2096967">0</span>&nbsp;<span class="op" id="2096969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2096973">_</span><span class="op" id="2096974">,</span>&nbsp;<span class="ident" id="2096976">_</span><span class="op" id="2096977">,</span>&nbsp;<span class="ident" id="2096979"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2096984">=</span>&nbsp;<span class="ident" id="2096986"><a href="/syscall/syscall_unix.go.html#2157407">RawSyscall6</a></span><span class="op" id="2096997">(</span><span class="ident" id="2096998"><a href="/syscall/zsysnum_linux_amd64.go.html#2274540">SYS_PRCTL</a></span><span class="op" id="2097007">,</span>&nbsp;<span class="ident" id="2097009"><a href="/syscall/zerrors_linux_amd64.go.html#2193852">PR_SET_PDEATHSIG</a></span><span class="op" id="2097025">,</span>&nbsp;<span class="builtintype" id="2097027">uintptr</span><span class="op" id="2097034">(</span><span class="ident" id="2097035"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2097038">.</span><span class="ident" id="2097039">Pdeathsig</span><span class="op" id="2097048">)</span><span class="op" id="2097049">,</span>&nbsp;<span class="num" id="2097051">0</span><span class="op" id="2097052">,</span>&nbsp;<span class="num" id="2097054">0</span><span class="op" id="2097055">,</span>&nbsp;<span class="num" id="2097057">0</span><span class="op" id="2097058">,</span>&nbsp;<span class="num" id="2097060">0</span><span class="op" id="2097061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097065">if</span>&nbsp;<span class="ident" id="2097068"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097073">!=</span>&nbsp;<span class="num" id="2097076">0</span>&nbsp;<span class="op" id="2097078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097083">goto</span>&nbsp;<span class="ident" id="2097088">childerror</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097106">//&nbsp;Signal&nbsp;self&nbsp;if&nbsp;parent&nbsp;is&nbsp;already&nbsp;dead.&nbsp;This&nbsp;might&nbsp;cause&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097169">//&nbsp;duplicate&nbsp;signal&nbsp;in&nbsp;rare&nbsp;cases,&nbsp;but&nbsp;it&nbsp;won&#39;t&nbsp;matter&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097231">//&nbsp;using&nbsp;SIGKILL.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097251"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span><span class="op" id="2097253">,</span>&nbsp;<span class="ident" id="2097255">_</span><span class="op" id="2097256">,</span>&nbsp;<span class="ident" id="2097258">_</span>&nbsp;<span class="op" id="2097260">=</span>&nbsp;<span class="ident" id="2097262"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097272">(</span><span class="ident" id="2097273"><a href="/syscall/zsysnum_linux_amd64.go.html#2272942">SYS_GETPPID</a></span><span class="op" id="2097284">,</span>&nbsp;<span class="num" id="2097286">0</span><span class="op" id="2097287">,</span>&nbsp;<span class="num" id="2097289">0</span><span class="op" id="2097290">,</span>&nbsp;<span class="num" id="2097292">0</span><span class="op" id="2097293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097297">if</span>&nbsp;<span class="ident" id="2097300"><a href="/syscall/exec_linux.go.html#2095085">r1</a></span>&nbsp;<span class="op" id="2097303">==</span>&nbsp;<span class="num" id="2097306">1</span>&nbsp;<span class="op" id="2097308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097313">pid</span><span class="op" id="2097316">,</span>&nbsp;<span class="ident" id="2097318">_</span><span class="op" id="2097319">,</span>&nbsp;<span class="ident" id="2097321">_</span>&nbsp;<span class="op" id="2097323">:=</span>&nbsp;<span class="ident" id="2097326"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097336">(</span><span class="ident" id="2097337"><a href="/syscall/zsysnum_linux_amd64.go.html#2270589">SYS_GETPID</a></span><span class="op" id="2097347">,</span>&nbsp;<span class="num" id="2097349">0</span><span class="op" id="2097350">,</span>&nbsp;<span class="num" id="2097352">0</span><span class="op" id="2097353">,</span>&nbsp;<span class="num" id="2097355">0</span><span class="op" id="2097356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097361">_</span><span class="op" id="2097362">,</span>&nbsp;<span class="ident" id="2097364">_</span><span class="op" id="2097365">,</span>&nbsp;<span class="ident" id="2097367">err1</span>&nbsp;<span class="op" id="2097372">:=</span>&nbsp;<span class="ident" id="2097375"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097385">(</span><span class="ident" id="2097386"><a href="/syscall/zsysnum_linux_amd64.go.html#2271348">SYS_KILL</a></span><span class="op" id="2097394">,</span>&nbsp;<span class="ident" id="2097396"><a href="/syscall/exec_linux.go.html#2097313">pid</a></span><span class="op" id="2097399">,</span>&nbsp;<span class="builtintype" id="2097401">uintptr</span><span class="op" id="2097408">(</span><span class="ident" id="2097409"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2097412">.</span><span class="ident" id="2097413">Pdeathsig</span><span class="op" id="2097422">)</span><span class="op" id="2097423">,</span>&nbsp;<span class="num" id="2097425">0</span><span class="op" id="2097426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097431">if</span>&nbsp;<span class="ident" id="2097434"><a href="/syscall/exec_linux.go.html#2097367">err1</a></span>&nbsp;<span class="op" id="2097439">!=</span>&nbsp;<span class="num" id="2097442">0</span>&nbsp;<span class="op" id="2097444">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097450">goto</span>&nbsp;<span class="ident" id="2097455">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097480">//&nbsp;Enable&nbsp;tracing&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097513">if</span>&nbsp;<span class="ident" id="2097516"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2097519">.</span><span class="ident" id="2097520">Ptrace</span>&nbsp;<span class="op" id="2097527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097531">_</span><span class="op" id="2097532">,</span>&nbsp;<span class="ident" id="2097534">_</span><span class="op" id="2097535">,</span>&nbsp;<span class="ident" id="2097537"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097542">=</span>&nbsp;<span class="ident" id="2097544"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097554">(</span><span class="ident" id="2097555"><a href="/syscall/zsysnum_linux_amd64.go.html#2272636">SYS_PTRACE</a></span><span class="op" id="2097565">,</span>&nbsp;<span class="builtintype" id="2097567">uintptr</span><span class="op" id="2097574">(</span><span class="ident" id="2097575"><a href="/syscall/zerrors_linux_amd64.go.html#2196339">PTRACE_TRACEME</a></span><span class="op" id="2097589">)</span><span class="op" id="2097590">,</span>&nbsp;<span class="num" id="2097592">0</span><span class="op" id="2097593">,</span>&nbsp;<span class="num" id="2097595">0</span><span class="op" id="2097596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097600">if</span>&nbsp;<span class="ident" id="2097603"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097608">!=</span>&nbsp;<span class="num" id="2097611">0</span>&nbsp;<span class="op" id="2097613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097618">goto</span>&nbsp;<span class="ident" id="2097623">childerror</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097643">//&nbsp;Session&nbsp;ID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097658">if</span>&nbsp;<span class="ident" id="2097661"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2097664">.</span><span class="ident" id="2097665">Setsid</span>&nbsp;<span class="op" id="2097672">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097676">_</span><span class="op" id="2097677">,</span>&nbsp;<span class="ident" id="2097679">_</span><span class="op" id="2097680">,</span>&nbsp;<span class="ident" id="2097682"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097687">=</span>&nbsp;<span class="ident" id="2097689"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097699">(</span><span class="ident" id="2097700"><a href="/syscall/zsysnum_linux_amd64.go.html#2273010">SYS_SETSID</a></span><span class="op" id="2097710">,</span>&nbsp;<span class="num" id="2097712">0</span><span class="op" id="2097713">,</span>&nbsp;<span class="num" id="2097715">0</span><span class="op" id="2097716">,</span>&nbsp;<span class="num" id="2097718">0</span><span class="op" id="2097719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097723">if</span>&nbsp;<span class="ident" id="2097726"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097731">!=</span>&nbsp;<span class="num" id="2097734">0</span>&nbsp;<span class="op" id="2097736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097741">goto</span>&nbsp;<span class="ident" id="2097746">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097762">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097766">//&nbsp;Set&nbsp;process&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097788">if</span>&nbsp;<span class="ident" id="2097791"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2097794">.</span><span class="ident" id="2097795">Setpgid</span>&nbsp;<span class="op" id="2097803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097807">_</span><span class="op" id="2097808">,</span>&nbsp;<span class="ident" id="2097810">_</span><span class="op" id="2097811">,</span>&nbsp;<span class="ident" id="2097813"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097818">=</span>&nbsp;<span class="ident" id="2097820"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097830">(</span><span class="ident" id="2097831"><a href="/syscall/zsysnum_linux_amd64.go.html#2272908">SYS_SETPGID</a></span><span class="op" id="2097842">,</span>&nbsp;<span class="num" id="2097844">0</span><span class="op" id="2097845">,</span>&nbsp;<span class="num" id="2097847">0</span><span class="op" id="2097848">,</span>&nbsp;<span class="num" id="2097850">0</span><span class="op" id="2097851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097855">if</span>&nbsp;<span class="ident" id="2097858"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097863">!=</span>&nbsp;<span class="num" id="2097866">0</span>&nbsp;<span class="op" id="2097868">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097873">goto</span>&nbsp;<span class="ident" id="2097878">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2097894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2097898">//&nbsp;Chroot</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2097909">if</span>&nbsp;<span class="ident" id="2097912"><a href="/syscall/exec_linux.go.html#2094890">chroot</a></span>&nbsp;<span class="op" id="2097919">!=</span>&nbsp;<span class="ident" id="2097922">nil</span>&nbsp;<span class="op" id="2097926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2097930">_</span><span class="op" id="2097931">,</span>&nbsp;<span class="ident" id="2097933">_</span><span class="op" id="2097934">,</span>&nbsp;<span class="ident" id="2097936"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2097941">=</span>&nbsp;<span class="ident" id="2097943"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2097953">(</span><span class="ident" id="2097954"><a href="/syscall/zsysnum_linux_amd64.go.html#2274676">SYS_CHROOT</a></span><span class="op" id="2097964">,</span>&nbsp;<span class="builtintype" id="2097966">uintptr</span><span class="op" id="2097973">(</span><span class="ident" id="2097974"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2097980">.</span><span class="ident" id="2097981">Pointer</span><span class="op" id="2097988">(</span><span class="ident" id="2097989"><a href="/syscall/exec_linux.go.html#2094890">chroot</a></span><span class="op" id="2097995">)</span><span class="op" id="2097996">)</span><span class="op" id="2097997">,</span>&nbsp;<span class="num" id="2097999">0</span><span class="op" id="2098000">,</span>&nbsp;<span class="num" id="2098002">0</span><span class="op" id="2098003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098007">if</span>&nbsp;<span class="ident" id="2098010"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098015">!=</span>&nbsp;<span class="num" id="2098018">0</span>&nbsp;<span class="op" id="2098020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098025">goto</span>&nbsp;<span class="ident" id="2098030">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098043">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2098050">//&nbsp;User&nbsp;and&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098070">if</span>&nbsp;<span class="ident" id="2098073">cred</span>&nbsp;<span class="op" id="2098078">:=</span>&nbsp;<span class="ident" id="2098081"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2098084">.</span><span class="ident" id="2098085">Credential</span><span class="op" id="2098095">;</span>&nbsp;<span class="ident" id="2098097"><a href="/syscall/exec_linux.go.html#2098073">cred</a></span>&nbsp;<span class="op" id="2098102">!=</span>&nbsp;<span class="ident" id="2098105">nil</span>&nbsp;<span class="op" id="2098109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098113">ngroups</span>&nbsp;<span class="op" id="2098121">:=</span>&nbsp;<span class="builtintype" id="2098124">uintptr</span><span class="op" id="2098131">(</span><span class="builtinfunc" id="2098132">len</span><span class="op" id="2098135">(</span><span class="ident" id="2098136"><a href="/syscall/exec_linux.go.html#2098073">cred</a></span><span class="op" id="2098140">.</span><span class="ident" id="2098141">Groups</span><span class="op" id="2098147">)</span><span class="op" id="2098148">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098152">var</span>&nbsp;<span class="ident" id="2098156">groups</span>&nbsp;<span class="ident" id="2098163"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2098169">.</span><span class="ident" id="2098170">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098180">if</span>&nbsp;<span class="ident" id="2098183"><a href="/syscall/exec_linux.go.html#2098113">ngroups</a></span>&nbsp;<span class="op" id="2098191">&gt;</span>&nbsp;<span class="num" id="2098193">0</span>&nbsp;<span class="op" id="2098195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098200"><a href="/syscall/exec_linux.go.html#2098156">groups</a></span>&nbsp;<span class="op" id="2098207">=</span>&nbsp;<span class="ident" id="2098209"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2098215">.</span><span class="ident" id="2098216">Pointer</span><span class="op" id="2098223">(</span><span class="op" id="2098224">&amp;</span><span class="ident" id="2098225"><a href="/syscall/exec_linux.go.html#2098073">cred</a></span><span class="op" id="2098229">.</span><span class="ident" id="2098230">Groups</span><span class="op" id="2098236">[</span><span class="num" id="2098237">0</span><span class="op" id="2098238">]</span><span class="op" id="2098239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098247">_</span><span class="op" id="2098248">,</span>&nbsp;<span class="ident" id="2098250">_</span><span class="op" id="2098251">,</span>&nbsp;<span class="ident" id="2098253"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098258">=</span>&nbsp;<span class="ident" id="2098260"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098270">(</span><span class="ident" id="2098271"><a href="/syscall/zsysnum_linux_amd64.go.html#2273146">SYS_SETGROUPS</a></span><span class="op" id="2098284">,</span>&nbsp;<span class="ident" id="2098286"><a href="/syscall/exec_linux.go.html#2098113">ngroups</a></span><span class="op" id="2098293">,</span>&nbsp;<span class="builtintype" id="2098295">uintptr</span><span class="op" id="2098302">(</span><span class="ident" id="2098303"><a href="/syscall/exec_linux.go.html#2098156">groups</a></span><span class="op" id="2098309">)</span><span class="op" id="2098310">,</span>&nbsp;<span class="num" id="2098312">0</span><span class="op" id="2098313">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098317">if</span>&nbsp;<span class="ident" id="2098320"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098325">!=</span>&nbsp;<span class="num" id="2098328">0</span>&nbsp;<span class="op" id="2098330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098335">goto</span>&nbsp;<span class="ident" id="2098340">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098357">_</span><span class="op" id="2098358">,</span>&nbsp;<span class="ident" id="2098360">_</span><span class="op" id="2098361">,</span>&nbsp;<span class="ident" id="2098363"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098368">=</span>&nbsp;<span class="ident" id="2098370"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098380">(</span><span class="ident" id="2098381"><a href="/syscall/zsysnum_linux_amd64.go.html#2272806">SYS_SETGID</a></span><span class="op" id="2098391">,</span>&nbsp;<span class="builtintype" id="2098393">uintptr</span><span class="op" id="2098400">(</span><span class="ident" id="2098401"><a href="/syscall/exec_linux.go.html#2098073">cred</a></span><span class="op" id="2098405">.</span><span class="ident" id="2098406">Gid</span><span class="op" id="2098409">)</span><span class="op" id="2098410">,</span>&nbsp;<span class="num" id="2098412">0</span><span class="op" id="2098413">,</span>&nbsp;<span class="num" id="2098415">0</span><span class="op" id="2098416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098420">if</span>&nbsp;<span class="ident" id="2098423"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098428">!=</span>&nbsp;<span class="num" id="2098431">0</span>&nbsp;<span class="op" id="2098433">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098438">goto</span>&nbsp;<span class="ident" id="2098443">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098460">_</span><span class="op" id="2098461">,</span>&nbsp;<span class="ident" id="2098463">_</span><span class="op" id="2098464">,</span>&nbsp;<span class="ident" id="2098466"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098471">=</span>&nbsp;<span class="ident" id="2098473"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098483">(</span><span class="ident" id="2098484"><a href="/syscall/zsysnum_linux_amd64.go.html#2272772">SYS_SETUID</a></span><span class="op" id="2098494">,</span>&nbsp;<span class="builtintype" id="2098496">uintptr</span><span class="op" id="2098503">(</span><span class="ident" id="2098504"><a href="/syscall/exec_linux.go.html#2098073">cred</a></span><span class="op" id="2098508">.</span><span class="ident" id="2098509">Uid</span><span class="op" id="2098512">)</span><span class="op" id="2098513">,</span>&nbsp;<span class="num" id="2098515">0</span><span class="op" id="2098516">,</span>&nbsp;<span class="num" id="2098518">0</span><span class="op" id="2098519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098523">if</span>&nbsp;<span class="ident" id="2098526"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098531">!=</span>&nbsp;<span class="num" id="2098534">0</span>&nbsp;<span class="op" id="2098536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098541">goto</span>&nbsp;<span class="ident" id="2098546">childerror</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2098566">//&nbsp;Chdir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098576">if</span>&nbsp;<span class="ident" id="2098579"><a href="/syscall/exec_linux.go.html#2094898">dir</a></span>&nbsp;<span class="op" id="2098583">!=</span>&nbsp;<span class="ident" id="2098586">nil</span>&nbsp;<span class="op" id="2098590">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098594">_</span><span class="op" id="2098595">,</span>&nbsp;<span class="ident" id="2098597">_</span><span class="op" id="2098598">,</span>&nbsp;<span class="ident" id="2098600"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098605">=</span>&nbsp;<span class="ident" id="2098607"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098617">(</span><span class="ident" id="2098618"><a href="/syscall/zsysnum_linux_amd64.go.html#2271942">SYS_CHDIR</a></span><span class="op" id="2098627">,</span>&nbsp;<span class="builtintype" id="2098629">uintptr</span><span class="op" id="2098636">(</span><span class="ident" id="2098637"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2098643">.</span><span class="ident" id="2098644">Pointer</span><span class="op" id="2098651">(</span><span class="ident" id="2098652"><a href="/syscall/exec_linux.go.html#2094898">dir</a></span><span class="op" id="2098655">)</span><span class="op" id="2098656">)</span><span class="op" id="2098657">,</span>&nbsp;<span class="num" id="2098659">0</span><span class="op" id="2098660">,</span>&nbsp;<span class="num" id="2098662">0</span><span class="op" id="2098663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098667">if</span>&nbsp;<span class="ident" id="2098670"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098675">!=</span>&nbsp;<span class="num" id="2098678">0</span>&nbsp;<span class="op" id="2098680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098685">goto</span>&nbsp;<span class="ident" id="2098690">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098706">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2098710">//&nbsp;Pass&nbsp;1:&nbsp;look&nbsp;for&nbsp;fd[i]&nbsp;&lt;&nbsp;i&nbsp;and&nbsp;move&nbsp;those&nbsp;up&nbsp;above&nbsp;len(fd)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2098773">//&nbsp;so&nbsp;that&nbsp;pass&nbsp;2&nbsp;won&#39;t&nbsp;stomp&nbsp;on&nbsp;an&nbsp;fd&nbsp;it&nbsp;needs&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098829">if</span>&nbsp;<span class="ident" id="2098832"><a href="/syscall/exec_linux.go.html#2094943">pipe</a></span>&nbsp;<span class="op" id="2098837">&lt;</span>&nbsp;<span class="ident" id="2098839"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span>&nbsp;<span class="op" id="2098846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098850">_</span><span class="op" id="2098851">,</span>&nbsp;<span class="ident" id="2098853">_</span><span class="op" id="2098854">,</span>&nbsp;<span class="ident" id="2098856"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098861">=</span>&nbsp;<span class="ident" id="2098863"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098873">(</span><span class="ident" id="2098874"><a href="/syscall/zsysnum_linux_amd64.go.html#2270391">SYS_DUP2</a></span><span class="op" id="2098882">,</span>&nbsp;<span class="builtintype" id="2098884">uintptr</span><span class="op" id="2098891">(</span><span class="ident" id="2098892"><a href="/syscall/exec_linux.go.html#2094943">pipe</a></span><span class="op" id="2098896">)</span><span class="op" id="2098897">,</span>&nbsp;<span class="builtintype" id="2098899">uintptr</span><span class="op" id="2098906">(</span><span class="ident" id="2098907"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2098913">)</span><span class="op" id="2098914">,</span>&nbsp;<span class="num" id="2098916">0</span><span class="op" id="2098917">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098921">if</span>&nbsp;<span class="ident" id="2098924"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2098929">!=</span>&nbsp;<span class="num" id="2098932">0</span>&nbsp;<span class="op" id="2098934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2098939">goto</span>&nbsp;<span class="ident" id="2098944">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2098957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2098961"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2098971">(</span><span class="ident" id="2098972"><a href="/syscall/zsysnum_linux_amd64.go.html#2271678">SYS_FCNTL</a></span><span class="op" id="2098981">,</span>&nbsp;<span class="builtintype" id="2098983">uintptr</span><span class="op" id="2098990">(</span><span class="ident" id="2098991"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2098997">)</span><span class="op" id="2098998">,</span>&nbsp;<span class="ident" id="2099000"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2099007">,</span>&nbsp;<span class="ident" id="2099009"><a href="/syscall/zerrors_linux_amd64.go.html#2174482">FD_CLOEXEC</a></span><span class="op" id="2099019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099023"><a href="/syscall/exec_linux.go.html#2094943">pipe</a></span>&nbsp;<span class="op" id="2099028">=</span>&nbsp;<span class="ident" id="2099030"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099039"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2099045">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099052">for</span>&nbsp;<span class="ident" id="2099056"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2099058">=</span>&nbsp;<span class="num" id="2099060">0</span><span class="op" id="2099061">;</span>&nbsp;<span class="ident" id="2099063"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2099065">&lt;</span>&nbsp;<span class="builtinfunc" id="2099067">len</span><span class="op" id="2099070">(</span><span class="ident" id="2099071"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099073">)</span><span class="op" id="2099074">;</span>&nbsp;<span class="ident" id="2099076"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099077">++</span>&nbsp;<span class="op" id="2099080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099084">if</span>&nbsp;<span class="ident" id="2099087"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099089">[</span><span class="ident" id="2099090"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099091">]</span>&nbsp;<span class="op" id="2099093">&gt;=</span>&nbsp;<span class="num" id="2099096">0</span>&nbsp;<span class="op" id="2099098">&amp;&amp;</span>&nbsp;<span class="ident" id="2099101"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099103">[</span><span class="ident" id="2099104"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099105">]</span>&nbsp;<span class="op" id="2099107">&lt;</span>&nbsp;<span class="builtintype" id="2099109">int</span><span class="op" id="2099112">(</span><span class="ident" id="2099113"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099114">)</span>&nbsp;<span class="op" id="2099116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099121">_</span><span class="op" id="2099122">,</span>&nbsp;<span class="ident" id="2099124">_</span><span class="op" id="2099125">,</span>&nbsp;<span class="ident" id="2099127"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099132">=</span>&nbsp;<span class="ident" id="2099134"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2099144">(</span><span class="ident" id="2099145"><a href="/syscall/zsysnum_linux_amd64.go.html#2270391">SYS_DUP2</a></span><span class="op" id="2099153">,</span>&nbsp;<span class="builtintype" id="2099155">uintptr</span><span class="op" id="2099162">(</span><span class="ident" id="2099163"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099165">[</span><span class="ident" id="2099166"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099167">]</span><span class="op" id="2099168">)</span><span class="op" id="2099169">,</span>&nbsp;<span class="builtintype" id="2099171">uintptr</span><span class="op" id="2099178">(</span><span class="ident" id="2099179"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2099185">)</span><span class="op" id="2099186">,</span>&nbsp;<span class="num" id="2099188">0</span><span class="op" id="2099189">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099194">if</span>&nbsp;<span class="ident" id="2099197"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099202">!=</span>&nbsp;<span class="num" id="2099205">0</span>&nbsp;<span class="op" id="2099207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099213">goto</span>&nbsp;<span class="ident" id="2099218">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099237"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2099247">(</span><span class="ident" id="2099248"><a href="/syscall/zsysnum_linux_amd64.go.html#2271678">SYS_FCNTL</a></span><span class="op" id="2099257">,</span>&nbsp;<span class="builtintype" id="2099259">uintptr</span><span class="op" id="2099266">(</span><span class="ident" id="2099267"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2099273">)</span><span class="op" id="2099274">,</span>&nbsp;<span class="ident" id="2099276"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2099283">,</span>&nbsp;<span class="ident" id="2099285"><a href="/syscall/zerrors_linux_amd64.go.html#2174482">FD_CLOEXEC</a></span><span class="op" id="2099295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099300"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099302">[</span><span class="ident" id="2099303"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099304">]</span>&nbsp;<span class="op" id="2099306">=</span>&nbsp;<span class="ident" id="2099308"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099318"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2099324">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099330">if</span>&nbsp;<span class="ident" id="2099333"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span>&nbsp;<span class="op" id="2099340">==</span>&nbsp;<span class="ident" id="2099343"><a href="/syscall/exec_linux.go.html#2094943">pipe</a></span>&nbsp;<span class="op" id="2099348">{</span>&nbsp;<span class="comment" id="2099350">//&nbsp;don&#39;t&nbsp;stomp&nbsp;on&nbsp;pipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099377"><a href="/syscall/exec_linux.go.html#2095132">nextfd</a></span><span class="op" id="2099383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099393">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099400">//&nbsp;Pass&nbsp;2:&nbsp;dup&nbsp;fd[i]&nbsp;down&nbsp;onto&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099435">for</span>&nbsp;<span class="ident" id="2099439"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2099441">=</span>&nbsp;<span class="num" id="2099443">0</span><span class="op" id="2099444">;</span>&nbsp;<span class="ident" id="2099446"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2099448">&lt;</span>&nbsp;<span class="builtinfunc" id="2099450">len</span><span class="op" id="2099453">(</span><span class="ident" id="2099454"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099456">)</span><span class="op" id="2099457">;</span>&nbsp;<span class="ident" id="2099459"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099460">++</span>&nbsp;<span class="op" id="2099463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099467">if</span>&nbsp;<span class="ident" id="2099470"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099472">[</span><span class="ident" id="2099473"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099474">]</span>&nbsp;<span class="op" id="2099476">==</span>&nbsp;<span class="op" id="2099479">-</span><span class="num" id="2099480">1</span>&nbsp;<span class="op" id="2099482">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099487"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2099497">(</span><span class="ident" id="2099498"><a href="/syscall/zsysnum_linux_amd64.go.html#2269408">SYS_CLOSE</a></span><span class="op" id="2099507">,</span>&nbsp;<span class="builtintype" id="2099509">uintptr</span><span class="op" id="2099516">(</span><span class="ident" id="2099517"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099518">)</span><span class="op" id="2099519">,</span>&nbsp;<span class="num" id="2099521">0</span><span class="op" id="2099522">,</span>&nbsp;<span class="num" id="2099524">0</span><span class="op" id="2099525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099530">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099545">if</span>&nbsp;<span class="ident" id="2099548"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099550">[</span><span class="ident" id="2099551"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099552">]</span>&nbsp;<span class="op" id="2099554">==</span>&nbsp;<span class="builtintype" id="2099557">int</span><span class="op" id="2099560">(</span><span class="ident" id="2099561"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099562">)</span>&nbsp;<span class="op" id="2099564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099569">//&nbsp;dup2(i,&nbsp;i)&nbsp;won&#39;t&nbsp;clear&nbsp;close-on-exec&nbsp;flag&nbsp;on&nbsp;Linux,</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099627">//&nbsp;probably&nbsp;not&nbsp;elsewhere&nbsp;either.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099664">_</span><span class="op" id="2099665">,</span>&nbsp;<span class="ident" id="2099667">_</span><span class="op" id="2099668">,</span>&nbsp;<span class="ident" id="2099670"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099675">=</span>&nbsp;<span class="ident" id="2099677"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2099687">(</span><span class="ident" id="2099688"><a href="/syscall/zsysnum_linux_amd64.go.html#2271678">SYS_FCNTL</a></span><span class="op" id="2099697">,</span>&nbsp;<span class="builtintype" id="2099699">uintptr</span><span class="op" id="2099706">(</span><span class="ident" id="2099707"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099709">[</span><span class="ident" id="2099710"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099711">]</span><span class="op" id="2099712">)</span><span class="op" id="2099713">,</span>&nbsp;<span class="ident" id="2099715"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2099722">,</span>&nbsp;<span class="num" id="2099724">0</span><span class="op" id="2099725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099730">if</span>&nbsp;<span class="ident" id="2099733"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099738">!=</span>&nbsp;<span class="num" id="2099741">0</span>&nbsp;<span class="op" id="2099743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099749">goto</span>&nbsp;<span class="ident" id="2099754">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099768">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099788">//&nbsp;The&nbsp;new&nbsp;fd&nbsp;is&nbsp;created&nbsp;NOT&nbsp;close-on-exec,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099834">//&nbsp;which&nbsp;is&nbsp;exactly&nbsp;what&nbsp;we&nbsp;want.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2099870">_</span><span class="op" id="2099871">,</span>&nbsp;<span class="ident" id="2099873">_</span><span class="op" id="2099874">,</span>&nbsp;<span class="ident" id="2099876"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099881">=</span>&nbsp;<span class="ident" id="2099883"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2099893">(</span><span class="ident" id="2099894"><a href="/syscall/zsysnum_linux_amd64.go.html#2270391">SYS_DUP2</a></span><span class="op" id="2099902">,</span>&nbsp;<span class="builtintype" id="2099904">uintptr</span><span class="op" id="2099911">(</span><span class="ident" id="2099912"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2099914">[</span><span class="ident" id="2099915"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099916">]</span><span class="op" id="2099917">)</span><span class="op" id="2099918">,</span>&nbsp;<span class="builtintype" id="2099920">uintptr</span><span class="op" id="2099927">(</span><span class="ident" id="2099928"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2099929">)</span><span class="op" id="2099930">,</span>&nbsp;<span class="num" id="2099932">0</span><span class="op" id="2099933">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099937">if</span>&nbsp;<span class="ident" id="2099940"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2099945">!=</span>&nbsp;<span class="num" id="2099948">0</span>&nbsp;<span class="op" id="2099950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2099955">goto</span>&nbsp;<span class="ident" id="2099960">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2099976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2099980">//&nbsp;By&nbsp;convention,&nbsp;we&nbsp;don&#39;t&nbsp;close-on-exec&nbsp;the&nbsp;fds&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100037">//&nbsp;started&nbsp;with,&nbsp;so&nbsp;if&nbsp;len(fd)&nbsp;&lt;&nbsp;3,&nbsp;close&nbsp;0,&nbsp;1,&nbsp;2&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100099">//&nbsp;Programs&nbsp;that&nbsp;know&nbsp;they&nbsp;inherit&nbsp;fds&nbsp;&gt;=&nbsp;3&nbsp;will&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100154">//&nbsp;to&nbsp;set&nbsp;them&nbsp;close-on-exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100185">for</span>&nbsp;<span class="ident" id="2100189"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2100191">=</span>&nbsp;<span class="builtinfunc" id="2100193">len</span><span class="op" id="2100196">(</span><span class="ident" id="2100197"><a href="/syscall/exec_linux.go.html#2095355">fd</a></span><span class="op" id="2100199">)</span><span class="op" id="2100200">;</span>&nbsp;<span class="ident" id="2100202"><a href="/syscall/exec_linux.go.html#2095145">i</a></span>&nbsp;<span class="op" id="2100204">&lt;</span>&nbsp;<span class="num" id="2100206">3</span><span class="op" id="2100207">;</span>&nbsp;<span class="ident" id="2100209"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2100210">++</span>&nbsp;<span class="op" id="2100213">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100217"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100227">(</span><span class="ident" id="2100228"><a href="/syscall/zsysnum_linux_amd64.go.html#2269408">SYS_CLOSE</a></span><span class="op" id="2100237">,</span>&nbsp;<span class="builtintype" id="2100239">uintptr</span><span class="op" id="2100246">(</span><span class="ident" id="2100247"><a href="/syscall/exec_linux.go.html#2095145">i</a></span><span class="op" id="2100248">)</span><span class="op" id="2100249">,</span>&nbsp;<span class="num" id="2100251">0</span><span class="op" id="2100252">,</span>&nbsp;<span class="num" id="2100254">0</span><span class="op" id="2100255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100262">//&nbsp;Detach&nbsp;fd&nbsp;0&nbsp;from&nbsp;tty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100287">if</span>&nbsp;<span class="ident" id="2100290"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2100293">.</span><span class="ident" id="2100294">Noctty</span>&nbsp;<span class="op" id="2100301">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100305">_</span><span class="op" id="2100306">,</span>&nbsp;<span class="ident" id="2100308">_</span><span class="op" id="2100309">,</span>&nbsp;<span class="ident" id="2100311"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2100316">=</span>&nbsp;<span class="ident" id="2100318"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100328">(</span><span class="ident" id="2100329"><a href="/syscall/zsysnum_linux_amd64.go.html#2269830">SYS_IOCTL</a></span><span class="op" id="2100338">,</span>&nbsp;<span class="num" id="2100340">0</span><span class="op" id="2100341">,</span>&nbsp;<span class="builtintype" id="2100343">uintptr</span><span class="op" id="2100350">(</span><span class="ident" id="2100351"><a href="/syscall/zerrors_linux_amd64.go.html#2210849">TIOCNOTTY</a></span><span class="op" id="2100360">)</span><span class="op" id="2100361">,</span>&nbsp;<span class="num" id="2100363">0</span><span class="op" id="2100364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100368">if</span>&nbsp;<span class="ident" id="2100371"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2100376">!=</span>&nbsp;<span class="num" id="2100379">0</span>&nbsp;<span class="op" id="2100381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100386">goto</span>&nbsp;<span class="ident" id="2100391">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100407">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100411">//&nbsp;Set&nbsp;the&nbsp;controlling&nbsp;TTY&nbsp;to&nbsp;Ctty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100447">if</span>&nbsp;<span class="ident" id="2100450"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2100453">.</span><span class="ident" id="2100454">Setctty</span>&nbsp;<span class="op" id="2100462">&amp;&amp;</span>&nbsp;<span class="ident" id="2100465"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2100468">.</span><span class="ident" id="2100469">Ctty</span>&nbsp;<span class="op" id="2100474">&gt;=</span>&nbsp;<span class="num" id="2100477">0</span>&nbsp;<span class="op" id="2100479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100483">_</span><span class="op" id="2100484">,</span>&nbsp;<span class="ident" id="2100486">_</span><span class="op" id="2100487">,</span>&nbsp;<span class="ident" id="2100489"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2100494">=</span>&nbsp;<span class="ident" id="2100496"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100506">(</span><span class="ident" id="2100507"><a href="/syscall/zsysnum_linux_amd64.go.html#2269830">SYS_IOCTL</a></span><span class="op" id="2100516">,</span>&nbsp;<span class="builtintype" id="2100518">uintptr</span><span class="op" id="2100525">(</span><span class="ident" id="2100526"><a href="/syscall/exec_linux.go.html#2094925">sys</a></span><span class="op" id="2100529">.</span><span class="ident" id="2100530">Ctty</span><span class="op" id="2100534">)</span><span class="op" id="2100535">,</span>&nbsp;<span class="builtintype" id="2100537">uintptr</span><span class="op" id="2100544">(</span><span class="ident" id="2100545"><a href="/syscall/zerrors_linux_amd64.go.html#2211387">TIOCSCTTY</a></span><span class="op" id="2100554">)</span><span class="op" id="2100555">,</span>&nbsp;<span class="num" id="2100557">0</span><span class="op" id="2100558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100562">if</span>&nbsp;<span class="ident" id="2100565"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2100570">!=</span>&nbsp;<span class="num" id="2100573">0</span>&nbsp;<span class="op" id="2100575">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100580">goto</span>&nbsp;<span class="ident" id="2100585">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100605">//&nbsp;Time&nbsp;to&nbsp;exec.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100623">_</span><span class="op" id="2100624">,</span>&nbsp;<span class="ident" id="2100626">_</span><span class="op" id="2100627">,</span>&nbsp;<span class="ident" id="2100629"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span>&nbsp;<span class="op" id="2100634">=</span>&nbsp;<span class="ident" id="2100636"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100646">(</span><span class="ident" id="2100647"><a href="/syscall/zsysnum_linux_amd64.go.html#2271249">SYS_EXECVE</a></span><span class="op" id="2100657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2100661">uintptr</span><span class="op" id="2100668">(</span><span class="ident" id="2100669"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2100675">.</span><span class="ident" id="2100676">Pointer</span><span class="op" id="2100683">(</span><span class="ident" id="2100684"><a href="/syscall/exec_linux.go.html#2094857">argv0</a></span><span class="op" id="2100689">)</span><span class="op" id="2100690">)</span><span class="op" id="2100691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2100695">uintptr</span><span class="op" id="2100702">(</span><span class="ident" id="2100703"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2100709">.</span><span class="ident" id="2100710">Pointer</span><span class="op" id="2100717">(</span><span class="op" id="2100718">&amp;</span><span class="ident" id="2100719"><a href="/syscall/exec_linux.go.html#2094870">argv</a></span><span class="op" id="2100723">[</span><span class="num" id="2100724">0</span><span class="op" id="2100725">]</span><span class="op" id="2100726">)</span><span class="op" id="2100727">)</span><span class="op" id="2100728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2100732">uintptr</span><span class="op" id="2100739">(</span><span class="ident" id="2100740"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2100746">.</span><span class="ident" id="2100747">Pointer</span><span class="op" id="2100754">(</span><span class="op" id="2100755">&amp;</span><span class="ident" id="2100756"><a href="/syscall/exec_linux.go.html#2094876">envv</a></span><span class="op" id="2100760">[</span><span class="num" id="2100761">0</span><span class="op" id="2100762">]</span><span class="op" id="2100763">)</span><span class="op" id="2100764">)</span><span class="op" id="2100765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="ident" id="2100768">childerror</span><span class="op" id="2100778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2100781">//&nbsp;send&nbsp;error&nbsp;code&nbsp;on&nbsp;pipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100809"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100819">(</span><span class="ident" id="2100820"><a href="/syscall/zsysnum_linux_amd64.go.html#2269344">SYS_WRITE</a></span><span class="op" id="2100829">,</span>&nbsp;<span class="builtintype" id="2100831">uintptr</span><span class="op" id="2100838">(</span><span class="ident" id="2100839"><a href="/syscall/exec_linux.go.html#2094943">pipe</a></span><span class="op" id="2100843">)</span><span class="op" id="2100844">,</span>&nbsp;<span class="builtintype" id="2100846">uintptr</span><span class="op" id="2100853">(</span><span class="ident" id="2100854"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2100860">.</span><span class="ident" id="2100861">Pointer</span><span class="op" id="2100868">(</span><span class="op" id="2100869">&amp;</span><span class="ident" id="2100870"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span><span class="op" id="2100874">)</span><span class="op" id="2100875">)</span><span class="op" id="2100876">,</span>&nbsp;<span class="ident" id="2100878"><a href="/syscall/exec_linux.go.html#2093118">unsafe</a></span><span class="op" id="2100884">.</span><span class="ident" id="2100885">Sizeof</span><span class="op" id="2100891">(</span><span class="ident" id="2100892"><a href="/syscall/exec_linux.go.html#2095102">err1</a></span><span class="op" id="2100896">)</span><span class="op" id="2100897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2100900">for</span>&nbsp;<span class="op" id="2100904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2100908"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2100918">(</span><span class="ident" id="2100919"><a href="/syscall/zsysnum_linux_amd64.go.html#2271282">SYS_EXIT</a></span><span class="op" id="2100927">,</span>&nbsp;<span class="num" id="2100929">253</span><span class="op" id="2100932">,</span>&nbsp;<span class="num" id="2100934">0</span><span class="op" id="2100935">,</span>&nbsp;<span class="num" id="2100937">0</span><span class="op" id="2100938">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2100941">}</span><br>
<span class="lineno"></span><span class="op" id="2100943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2100946">//&nbsp;Try&nbsp;to&nbsp;open&nbsp;a&nbsp;pipe&nbsp;with&nbsp;O_CLOEXEC&nbsp;set&nbsp;on&nbsp;both&nbsp;file&nbsp;descriptors.</span><br>
<span class="lineno"></span><span class="keyword" id="2101013">func</span>&nbsp;<span class="ident" id="2101018">forkExecPipe</span><span class="op" id="2101030">(</span><span class="ident" id="2101031">p</span>&nbsp;<span class="op" id="2101033">[</span><span class="op" id="2101034">]</span><span class="builtintype" id="2101035">int</span><span class="op" id="2101038">)</span>&nbsp;<span class="op" id="2101040">(</span><span class="ident" id="2101041">err</span>&nbsp;<span class="builtintype" id="2101045">error</span><span class="op" id="2101050">)</span>&nbsp;<span class="op" id="2101052">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101055"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101059">=</span>&nbsp;<span class="ident" id="2101061"><a href="/syscall/syscall_linux.go.html#2126498">Pipe2</a></span><span class="op" id="2101066">(</span><span class="ident" id="2101067"><a href="/syscall/exec_linux.go.html#2101031">p</a></span><span class="op" id="2101068">,</span>&nbsp;<span class="ident" id="2101070"><a href="/syscall/zerrors_linux_amd64.go.html#2190320">O_CLOEXEC</a></span><span class="op" id="2101079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2101082">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2101157">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101187">if</span>&nbsp;<span class="ident" id="2101190"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101194">==</span>&nbsp;<span class="ident" id="2101197"><a href="/syscall/zerrors_linux_amd64.go.html#2216174">ENOSYS</a></span>&nbsp;<span class="op" id="2101204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101208">if</span>&nbsp;<span class="ident" id="2101211"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101215">=</span>&nbsp;<span class="ident" id="2101217"><a href="/syscall/syscall_linux.go.html#2126292">Pipe</a></span><span class="op" id="2101221">(</span><span class="ident" id="2101222"><a href="/syscall/exec_linux.go.html#2101031">p</a></span><span class="op" id="2101223">)</span><span class="op" id="2101224">;</span>&nbsp;<span class="ident" id="2101226"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101230">!=</span>&nbsp;<span class="ident" id="2101233">nil</span>&nbsp;<span class="op" id="2101237">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101242">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101255">if</span>&nbsp;<span class="ident" id="2101258">_</span><span class="op" id="2101259">,</span>&nbsp;<span class="ident" id="2101261"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101265">=</span>&nbsp;<span class="ident" id="2101267"><a href="/syscall/zsyscall_linux_amd64.go.html#2234545">fcntl</a></span><span class="op" id="2101272">(</span><span class="ident" id="2101273"><a href="/syscall/exec_linux.go.html#2101031">p</a></span><span class="op" id="2101274">[</span><span class="num" id="2101275">0</span><span class="op" id="2101276">]</span><span class="op" id="2101277">,</span>&nbsp;<span class="ident" id="2101279"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2101286">,</span>&nbsp;<span class="ident" id="2101288"><a href="/syscall/zerrors_linux_amd64.go.html#2174482">FD_CLOEXEC</a></span><span class="op" id="2101298">)</span><span class="op" id="2101299">;</span>&nbsp;<span class="ident" id="2101301"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101305">!=</span>&nbsp;<span class="ident" id="2101308">nil</span>&nbsp;<span class="op" id="2101312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101317">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101326">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101330">_</span><span class="op" id="2101331">,</span>&nbsp;<span class="ident" id="2101333"><a href="/syscall/exec_linux.go.html#2101041">err</a></span>&nbsp;<span class="op" id="2101337">=</span>&nbsp;<span class="ident" id="2101339"><a href="/syscall/zsyscall_linux_amd64.go.html#2234545">fcntl</a></span><span class="op" id="2101344">(</span><span class="ident" id="2101345"><a href="/syscall/exec_linux.go.html#2101031">p</a></span><span class="op" id="2101346">[</span><span class="num" id="2101347">1</span><span class="op" id="2101348">]</span><span class="op" id="2101349">,</span>&nbsp;<span class="ident" id="2101351"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2101358">,</span>&nbsp;<span class="ident" id="2101360"><a href="/syscall/zerrors_linux_amd64.go.html#2174482">FD_CLOEXEC</a></span><span class="op" id="2101370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101376">return</span><br>
<span class="lineno"></span><span class="op" id="2101383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="2101386">//&nbsp;writeIDMappings&nbsp;writes&nbsp;the&nbsp;user&nbsp;namespace&nbsp;User&nbsp;ID&nbsp;or&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;to&nbsp;the&nbsp;specified&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="2101483">func</span>&nbsp;<span class="ident" id="2101488">writeIDMappings</span><span class="op" id="2101503">(</span><span class="ident" id="2101504">path</span>&nbsp;<span class="builtintype" id="2101509">string</span><span class="op" id="2101515">,</span>&nbsp;<span class="ident" id="2101517">idMap</span>&nbsp;<span class="op" id="2101523">[</span><span class="op" id="2101524">]</span><span class="ident" id="2101525"><a href="/syscall/exec_linux.go.html#2093252">SysProcIDMap</a></span><span class="op" id="2101537">)</span>&nbsp;<span class="builtintype" id="2101539">error</span>&nbsp;<span class="op" id="2101545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101548">fd</span><span class="op" id="2101550">,</span>&nbsp;<span class="ident" id="2101552">err</span>&nbsp;<span class="op" id="2101556">:=</span>&nbsp;<span class="ident" id="2101559"><a href="/syscall/syscall_linux.go.html#2125918">Open</a></span><span class="op" id="2101563">(</span><span class="ident" id="2101564"><a href="/syscall/exec_linux.go.html#2101504">path</a></span><span class="op" id="2101568">,</span>&nbsp;<span class="ident" id="2101570"><a href="/syscall/zerrors_linux_amd64.go.html#2190915">O_RDWR</a></span><span class="op" id="2101576">,</span>&nbsp;<span class="num" id="2101578">0</span><span class="op" id="2101579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101582">if</span>&nbsp;<span class="ident" id="2101585"><a href="/syscall/exec_linux.go.html#2101552">err</a></span>&nbsp;<span class="op" id="2101589">!=</span>&nbsp;<span class="ident" id="2101592">nil</span>&nbsp;<span class="op" id="2101596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101600">return</span>&nbsp;<span class="ident" id="2101607"><a href="/syscall/exec_linux.go.html#2101552">err</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101616">data</span>&nbsp;<span class="op" id="2101621">:=</span>&nbsp;<span class="string" id="2101624">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101628">for</span>&nbsp;<span class="ident" id="2101632">_</span><span class="op" id="2101633">,</span>&nbsp;<span class="ident" id="2101635">im</span>&nbsp;<span class="op" id="2101638">:=</span>&nbsp;<span class="keyword" id="2101641">range</span>&nbsp;<span class="ident" id="2101647"><a href="/syscall/exec_linux.go.html#2101517">idMap</a></span>&nbsp;<span class="op" id="2101653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101657"><a href="/syscall/exec_linux.go.html#2101616">data</a></span>&nbsp;<span class="op" id="2101662">=</span>&nbsp;<span class="ident" id="2101664"><a href="/syscall/exec_linux.go.html#2101616">data</a></span>&nbsp;<span class="op" id="2101669">+</span>&nbsp;<span class="ident" id="2101671"><a href="/syscall/str.go.html#2121652">itoa</a></span><span class="op" id="2101675">(</span><span class="ident" id="2101676"><a href="/syscall/exec_linux.go.html#2101635">im</a></span><span class="op" id="2101678">.</span><span class="ident" id="2101679">ContainerID</span><span class="op" id="2101690">)</span>&nbsp;<span class="op" id="2101692">+</span>&nbsp;<span class="string" id="2101694">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="2101698">+</span>&nbsp;<span class="ident" id="2101700"><a href="/syscall/str.go.html#2121652">itoa</a></span><span class="op" id="2101704">(</span><span class="ident" id="2101705"><a href="/syscall/exec_linux.go.html#2101635">im</a></span><span class="op" id="2101707">.</span><span class="ident" id="2101708">HostID</span><span class="op" id="2101714">)</span>&nbsp;<span class="op" id="2101716">+</span>&nbsp;<span class="string" id="2101718">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="2101722">+</span>&nbsp;<span class="ident" id="2101724"><a href="/syscall/str.go.html#2121652">itoa</a></span><span class="op" id="2101728">(</span><span class="ident" id="2101729"><a href="/syscall/exec_linux.go.html#2101635">im</a></span><span class="op" id="2101731">.</span><span class="ident" id="2101732">Size</span><span class="op" id="2101736">)</span>&nbsp;<span class="op" id="2101738">+</span>&nbsp;<span class="string" id="2101740">&#34;\n&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101750">bytes</span><span class="op" id="2101755">,</span>&nbsp;<span class="ident" id="2101757"><a href="/syscall/exec_linux.go.html#2101552">err</a></span>&nbsp;<span class="op" id="2101761">:=</span>&nbsp;<span class="ident" id="2101764"><a href="/syscall/syscall.go.html#2124006">ByteSliceFromString</a></span><span class="op" id="2101783">(</span><span class="ident" id="2101784"><a href="/syscall/exec_linux.go.html#2101616">data</a></span><span class="op" id="2101788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101791">if</span>&nbsp;<span class="ident" id="2101794"><a href="/syscall/exec_linux.go.html#2101552">err</a></span>&nbsp;<span class="op" id="2101798">!=</span>&nbsp;<span class="ident" id="2101801">nil</span>&nbsp;<span class="op" id="2101805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101809"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2101814">(</span><span class="ident" id="2101815"><a href="/syscall/exec_linux.go.html#2101548">fd</a></span><span class="op" id="2101817">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101821">return</span>&nbsp;<span class="ident" id="2101828"><a href="/syscall/exec_linux.go.html#2101552">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101837">if</span>&nbsp;<span class="ident" id="2101840">_</span><span class="op" id="2101841">,</span>&nbsp;<span class="ident" id="2101843">err</span>&nbsp;<span class="op" id="2101847">:=</span>&nbsp;<span class="ident" id="2101850"><a href="/syscall/syscall_unix.go.html#2160051">Write</a></span><span class="op" id="2101855">(</span><span class="ident" id="2101856"><a href="/syscall/exec_linux.go.html#2101548">fd</a></span><span class="op" id="2101858">,</span>&nbsp;<span class="ident" id="2101860"><a href="/syscall/exec_linux.go.html#2101750">bytes</a></span><span class="op" id="2101865">)</span><span class="op" id="2101866">;</span>&nbsp;<span class="ident" id="2101868"><a href="/syscall/exec_linux.go.html#2101843">err</a></span>&nbsp;<span class="op" id="2101872">!=</span>&nbsp;<span class="ident" id="2101875">nil</span>&nbsp;<span class="op" id="2101879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2101883"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2101888">(</span><span class="ident" id="2101889"><a href="/syscall/exec_linux.go.html#2101548">fd</a></span><span class="op" id="2101891">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101895">return</span>&nbsp;<span class="ident" id="2101902"><a href="/syscall/exec_linux.go.html#2101843">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101911">if</span>&nbsp;<span class="ident" id="2101914">err</span>&nbsp;<span class="op" id="2101918">:=</span>&nbsp;<span class="ident" id="2101921"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2101926">(</span><span class="ident" id="2101927"><a href="/syscall/exec_linux.go.html#2101548">fd</a></span><span class="op" id="2101929">)</span><span class="op" id="2101930">;</span>&nbsp;<span class="ident" id="2101932"><a href="/syscall/exec_linux.go.html#2101914">err</a></span>&nbsp;<span class="op" id="2101936">!=</span>&nbsp;<span class="ident" id="2101939">nil</span>&nbsp;<span class="op" id="2101943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101947">return</span>&nbsp;<span class="ident" id="2101954"><a href="/syscall/exec_linux.go.html#2101914">err</a></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2101959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2101963">return</span>&nbsp;<span class="ident" id="2101970">nil</span><br>
<span class="lineno"></span><span class="op" id="2101974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="2101977">//&nbsp;writeUidGidMappings&nbsp;writes&nbsp;User&nbsp;ID&nbsp;and&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces</span><br>
<span class="lineno"></span><span class="comment" id="2102057">//&nbsp;for&nbsp;a&nbsp;process&nbsp;and&nbsp;it&nbsp;is&nbsp;called&nbsp;from&nbsp;the&nbsp;parent&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2102116">func</span>&nbsp;<span class="ident" id="2102121">writeUidGidMappings</span><span class="op" id="2102140">(</span><span class="ident" id="2102141">pid</span>&nbsp;<span class="builtintype" id="2102145">int</span><span class="op" id="2102148">,</span>&nbsp;<span class="ident" id="2102150">sys</span>&nbsp;<span class="op" id="2102154">*</span><span class="ident" id="2102155"><a href="/syscall/exec_linux.go.html#2093371">SysProcAttr</a></span><span class="op" id="2102166">)</span>&nbsp;<span class="builtintype" id="2102168">error</span>&nbsp;<span class="op" id="2102174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102177">if</span>&nbsp;<span class="ident" id="2102180"><a href="/syscall/exec_linux.go.html#2102150">sys</a></span><span class="op" id="2102183">.</span><span class="ident" id="2102184">UidMappings</span>&nbsp;<span class="op" id="2102196">!=</span>&nbsp;<span class="ident" id="2102199">nil</span>&nbsp;<span class="op" id="2102203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2102207">uidf</span>&nbsp;<span class="op" id="2102212">:=</span>&nbsp;<span class="string" id="2102215">&#34;/proc/&#34;</span>&nbsp;<span class="op" id="2102224">+</span>&nbsp;<span class="ident" id="2102226"><a href="/syscall/str.go.html#2121652">itoa</a></span><span class="op" id="2102230">(</span><span class="ident" id="2102231"><a href="/syscall/exec_linux.go.html#2102141">pid</a></span><span class="op" id="2102234">)</span>&nbsp;<span class="op" id="2102236">+</span>&nbsp;<span class="string" id="2102238">&#34;/uid_map&#34;</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102251">if</span>&nbsp;<span class="ident" id="2102254">err</span>&nbsp;<span class="op" id="2102258">:=</span>&nbsp;<span class="ident" id="2102261"><a href="/syscall/exec_linux.go.html#2101488">writeIDMappings</a></span><span class="op" id="2102276">(</span><span class="ident" id="2102277"><a href="/syscall/exec_linux.go.html#2102207">uidf</a></span><span class="op" id="2102281">,</span>&nbsp;<span class="ident" id="2102283"><a href="/syscall/exec_linux.go.html#2102150">sys</a></span><span class="op" id="2102286">.</span><span class="ident" id="2102287">UidMappings</span><span class="op" id="2102298">)</span><span class="op" id="2102299">;</span>&nbsp;<span class="ident" id="2102301"><a href="/syscall/exec_linux.go.html#2102254">err</a></span>&nbsp;<span class="op" id="2102305">!=</span>&nbsp;<span class="ident" id="2102308">nil</span>&nbsp;<span class="op" id="2102312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102317">return</span>&nbsp;<span class="ident" id="2102324"><a href="/syscall/exec_linux.go.html#2102254">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2102330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2102333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102337">if</span>&nbsp;<span class="ident" id="2102340"><a href="/syscall/exec_linux.go.html#2102150">sys</a></span><span class="op" id="2102343">.</span><span class="ident" id="2102344">GidMappings</span>&nbsp;<span class="op" id="2102356">!=</span>&nbsp;<span class="ident" id="2102359">nil</span>&nbsp;<span class="op" id="2102363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2102367">gidf</span>&nbsp;<span class="op" id="2102372">:=</span>&nbsp;<span class="string" id="2102375">&#34;/proc/&#34;</span>&nbsp;<span class="op" id="2102384">+</span>&nbsp;<span class="ident" id="2102386"><a href="/syscall/str.go.html#2121652">itoa</a></span><span class="op" id="2102390">(</span><span class="ident" id="2102391"><a href="/syscall/exec_linux.go.html#2102141">pid</a></span><span class="op" id="2102394">)</span>&nbsp;<span class="op" id="2102396">+</span>&nbsp;<span class="string" id="2102398">&#34;/gid_map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102411">if</span>&nbsp;<span class="ident" id="2102414">err</span>&nbsp;<span class="op" id="2102418">:=</span>&nbsp;<span class="ident" id="2102421"><a href="/syscall/exec_linux.go.html#2101488">writeIDMappings</a></span><span class="op" id="2102436">(</span><span class="ident" id="2102437"><a href="/syscall/exec_linux.go.html#2102367">gidf</a></span><span class="op" id="2102441">,</span>&nbsp;<span class="ident" id="2102443"><a href="/syscall/exec_linux.go.html#2102150">sys</a></span><span class="op" id="2102446">.</span><span class="ident" id="2102447">GidMappings</span><span class="op" id="2102458">)</span><span class="op" id="2102459">;</span>&nbsp;<span class="ident" id="2102461"><a href="/syscall/exec_linux.go.html#2102414">err</a></span>&nbsp;<span class="op" id="2102465">!=</span>&nbsp;<span class="ident" id="2102468">nil</span>&nbsp;<span class="op" id="2102472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102477">return</span>&nbsp;<span class="ident" id="2102484"><a href="/syscall/exec_linux.go.html#2102414">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2102490">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2102493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2102497">return</span>&nbsp;<span class="ident" id="2102504">nil</span><br>
<span class="lineno"></span><span class="op" id="2102508">}</span>
</div>
</body>
</html>
