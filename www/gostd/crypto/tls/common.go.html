<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3762860">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3762915">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3762969">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3763020">package</span>&nbsp;<span class="ident" id="3763028">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3763033">import</span>&nbsp;<span class="op" id="3763040">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763043">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763061">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763071">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763086">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763101">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763108">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763114">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763126">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763137">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763145">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3763152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3763155">const</span>&nbsp;<span class="op" id="3763161">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763164">VersionSSL30</span>&nbsp;<span class="op" id="3763177">=</span>&nbsp;<span class="num" id="3763179">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763187">VersionTLS10</span>&nbsp;<span class="op" id="3763200">=</span>&nbsp;<span class="num" id="3763202">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763210">VersionTLS11</span>&nbsp;<span class="op" id="3763223">=</span>&nbsp;<span class="num" id="3763225">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763233">VersionTLS12</span>&nbsp;<span class="op" id="3763246">=</span>&nbsp;<span class="num" id="3763248">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3763255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3763258">const</span>&nbsp;<span class="op" id="3763264">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763267">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3763283">=</span>&nbsp;<span class="num" id="3763285">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3763298">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763335">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3763351">=</span>&nbsp;<span class="num" id="3763353">16384</span>&nbsp;<span class="op" id="3763359">+</span>&nbsp;<span class="num" id="3763361">2048</span>&nbsp;<span class="comment" id="3763366">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763404">recordHeaderLen</span>&nbsp;<span class="op" id="3763420">=</span>&nbsp;<span class="num" id="3763422">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3763435">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763460">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3763476">=</span>&nbsp;<span class="num" id="3763478">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3763491">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763549">minVersion</span>&nbsp;<span class="op" id="3763560">=</span>&nbsp;<span class="ident" id="3763562">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763576">maxVersion</span>&nbsp;<span class="op" id="3763587">=</span>&nbsp;<span class="ident" id="3763589">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3763602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3763605">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3763626">type</span>&nbsp;<span class="ident" id="3763631">recordType</span>&nbsp;<span class="builtintype" id="3763642">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3763649">const</span>&nbsp;<span class="op" id="3763655">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763658">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3763685">recordType</span>&nbsp;<span class="op" id="3763696">=</span>&nbsp;<span class="num" id="3763698">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763702">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3763729">recordType</span>&nbsp;<span class="op" id="3763740">=</span>&nbsp;<span class="num" id="3763742">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763746">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3763773">recordType</span>&nbsp;<span class="op" id="3763784">=</span>&nbsp;<span class="num" id="3763786">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763790">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3763817">recordType</span>&nbsp;<span class="op" id="3763828">=</span>&nbsp;<span class="num" id="3763830">23</span><br>
<span class="lineno">45</span><span class="op" id="3763833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3763836">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3763868">const</span>&nbsp;<span class="op" id="3763874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763877">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3763900">uint8</span>&nbsp;<span class="op" id="3763906">=</span>&nbsp;<span class="num" id="3763908">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763911">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3763934">uint8</span>&nbsp;<span class="op" id="3763940">=</span>&nbsp;<span class="num" id="3763942">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763945">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3763968">uint8</span>&nbsp;<span class="op" id="3763974">=</span>&nbsp;<span class="num" id="3763976">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763979">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764002">uint8</span>&nbsp;<span class="op" id="3764008">=</span>&nbsp;<span class="num" id="3764010">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764014">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3764037">uint8</span>&nbsp;<span class="op" id="3764043">=</span>&nbsp;<span class="num" id="3764045">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764049">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3764072">uint8</span>&nbsp;<span class="op" id="3764078">=</span>&nbsp;<span class="num" id="3764080">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764084">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764107">uint8</span>&nbsp;<span class="op" id="3764113">=</span>&nbsp;<span class="num" id="3764115">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764119">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3764142">uint8</span>&nbsp;<span class="op" id="3764148">=</span>&nbsp;<span class="num" id="3764150">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764154">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3764177">uint8</span>&nbsp;<span class="op" id="3764183">=</span>&nbsp;<span class="num" id="3764185">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764189">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764212">uint8</span>&nbsp;<span class="op" id="3764218">=</span>&nbsp;<span class="num" id="3764220">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764224">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3764247">uint8</span>&nbsp;<span class="op" id="3764253">=</span>&nbsp;<span class="num" id="3764255">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764259">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764282">uint8</span>&nbsp;<span class="op" id="3764288">=</span>&nbsp;<span class="num" id="3764290">67</span>&nbsp;<span class="comment" id="3764293">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3764314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3764317">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3764343">const</span>&nbsp;<span class="op" id="3764349">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764352">compressionNone</span>&nbsp;<span class="builtintype" id="3764368">uint8</span>&nbsp;<span class="op" id="3764374">=</span>&nbsp;<span class="num" id="3764376">0</span><br>
<span class="lineno"></span><span class="op" id="3764378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3764381">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3764406">const</span>&nbsp;<span class="op" id="3764412">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764415">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764444">uint16</span>&nbsp;<span class="op" id="3764451">=</span>&nbsp;<span class="num" id="3764453">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764456">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764485">uint16</span>&nbsp;<span class="op" id="3764492">=</span>&nbsp;<span class="num" id="3764494">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764497">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764526">uint16</span>&nbsp;<span class="op" id="3764533">=</span>&nbsp;<span class="num" id="3764535">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764539">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764568">uint16</span>&nbsp;<span class="op" id="3764575">=</span>&nbsp;<span class="num" id="3764577">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764581">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3764610">uint16</span>&nbsp;<span class="op" id="3764617">=</span>&nbsp;<span class="num" id="3764619">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764623">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764652">uint16</span>&nbsp;<span class="op" id="3764659">=</span>&nbsp;<span class="num" id="3764661">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764665">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764694">uint16</span>&nbsp;<span class="op" id="3764701">=</span>&nbsp;<span class="num" id="3764703">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764707">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764736">uint16</span>&nbsp;<span class="op" id="3764743">=</span>&nbsp;<span class="num" id="3764745">13172</span>&nbsp;<span class="comment" id="3764751">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764773">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3764802">uint16</span>&nbsp;<span class="op" id="3764809">=</span>&nbsp;<span class="num" id="3764811">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3764818">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3764821">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3764858">const</span>&nbsp;<span class="op" id="3764864">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764867">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3764885">uint16</span>&nbsp;<span class="op" id="3764892">=</span>&nbsp;<span class="num" id="3764894">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3764901">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3764904">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3764974">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3765060">type</span>&nbsp;<span class="ident" id="3765065">CurveID</span>&nbsp;<span class="builtintype" id="3765073">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3765081">const</span>&nbsp;<span class="op" id="3765087">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765090">CurveP256</span>&nbsp;<span class="ident" id="3765100">CurveID</span>&nbsp;<span class="op" id="3765108">=</span>&nbsp;<span class="num" id="3765110">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765114">CurveP384</span>&nbsp;<span class="ident" id="3765124">CurveID</span>&nbsp;<span class="op" id="3765132">=</span>&nbsp;<span class="num" id="3765134">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765138">CurveP521</span>&nbsp;<span class="ident" id="3765148">CurveID</span>&nbsp;<span class="op" id="3765156">=</span>&nbsp;<span class="num" id="3765158">25</span><br>
<span class="lineno"></span><span class="op" id="3765161">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3765164">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3765200">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3765286">const</span>&nbsp;<span class="op" id="3765292">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765295">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3765319">uint8</span>&nbsp;<span class="op" id="3765325">=</span>&nbsp;<span class="num" id="3765327">0</span><br>
<span class="lineno">100</span><span class="op" id="3765329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3765332">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3765372">const</span>&nbsp;<span class="op" id="3765378">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765381">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3765396">uint8</span>&nbsp;<span class="op" id="3765402">=</span>&nbsp;<span class="num" id="3765404">1</span><br>
<span class="lineno">105</span><span class="op" id="3765406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3765409">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3765458">const</span>&nbsp;<span class="op" id="3765464">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765467">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3765486">=</span>&nbsp;<span class="num" id="3765488">1</span>&nbsp;<span class="comment" id="3765490">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765530">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3765549">=</span>&nbsp;<span class="num" id="3765551">2</span>&nbsp;<span class="comment" id="3765553">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765592">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3765611">=</span>&nbsp;<span class="num" id="3765613">3</span>&nbsp;<span class="comment" id="3765615">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765660">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3765679">=</span>&nbsp;<span class="num" id="3765681">4</span>&nbsp;<span class="comment" id="3765683">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765729">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765765">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3765788">=</span>&nbsp;<span class="num" id="3765790">64</span>&nbsp;<span class="comment" id="3765793">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765870">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3765893">=</span>&nbsp;<span class="num" id="3765895">65</span>&nbsp;<span class="comment" id="3765898">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765972">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3765995">=</span>&nbsp;<span class="num" id="3765997">66</span>&nbsp;<span class="comment" id="3766000">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766077">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3766123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766126">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3766186">const</span>&nbsp;<span class="op" id="3766192">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766195">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3766206">uint8</span>&nbsp;<span class="op" id="3766212">=</span>&nbsp;<span class="num" id="3766214">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766217">hashSHA256</span>&nbsp;<span class="builtintype" id="3766228">uint8</span>&nbsp;<span class="op" id="3766234">=</span>&nbsp;<span class="num" id="3766236">4</span><br>
<span class="lineno"></span><span class="op" id="3766238">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766241">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3766307">const</span>&nbsp;<span class="op" id="3766313">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766316">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3766331">uint8</span>&nbsp;<span class="op" id="3766337">=</span>&nbsp;<span class="num" id="3766339">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766342">signatureECDSA</span>&nbsp;<span class="builtintype" id="3766357">uint8</span>&nbsp;<span class="op" id="3766363">=</span>&nbsp;<span class="num" id="3766365">3</span><br>
<span class="lineno"></span><span class="op" id="3766367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766370">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3766449">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3766477">type</span>&nbsp;<span class="ident" id="3766482">signatureAndHash</span>&nbsp;<span class="keyword" id="3766499">struct</span>&nbsp;<span class="op" id="3766506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766509">hash</span><span class="op" id="3766513">,</span>&nbsp;<span class="ident" id="3766515">signature</span>&nbsp;<span class="builtintype" id="3766525">uint8</span><br>
<span class="lineno"></span><span class="op" id="3766531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3766534">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3766612">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3766679">var</span>&nbsp;<span class="ident" id="3766683">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3766715">=</span>&nbsp;<span class="op" id="3766717">[</span><span class="op" id="3766718">]</span><span class="ident" id="3766719">signatureAndHash</span><span class="op" id="3766735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766738">{</span><span class="ident" id="3766739">hashSHA256</span><span class="op" id="3766749">,</span>&nbsp;<span class="ident" id="3766751">signatureRSA</span><span class="op" id="3766763">}</span><span class="op" id="3766764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766767">{</span><span class="ident" id="3766768">hashSHA256</span><span class="op" id="3766778">,</span>&nbsp;<span class="ident" id="3766780">signatureECDSA</span><span class="op" id="3766794">}</span><span class="op" id="3766795">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766798">{</span><span class="ident" id="3766799">hashSHA1</span><span class="op" id="3766807">,</span>&nbsp;<span class="ident" id="3766809">signatureRSA</span><span class="op" id="3766821">}</span><span class="op" id="3766822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766825">{</span><span class="ident" id="3766826">hashSHA1</span><span class="op" id="3766834">,</span>&nbsp;<span class="ident" id="3766836">signatureECDSA</span><span class="op" id="3766850">}</span><span class="op" id="3766851">,</span><br>
<span class="lineno"></span><span class="op" id="3766853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766856">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3766930">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3766995">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3767018">var</span>&nbsp;<span class="ident" id="3767022">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3767061">=</span>&nbsp;<span class="op" id="3767063">[</span><span class="op" id="3767064">]</span><span class="ident" id="3767065">signatureAndHash</span><span class="op" id="3767081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767084">{</span><span class="ident" id="3767085">hashSHA256</span><span class="op" id="3767095">,</span>&nbsp;<span class="ident" id="3767097">signatureRSA</span><span class="op" id="3767109">}</span><span class="op" id="3767110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767113">{</span><span class="ident" id="3767114">hashSHA256</span><span class="op" id="3767124">,</span>&nbsp;<span class="ident" id="3767126">signatureECDSA</span><span class="op" id="3767140">}</span><span class="op" id="3767141">,</span><br>
<span class="lineno">155</span><span class="op" id="3767143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3767146">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3767213">type</span>&nbsp;<span class="ident" id="3767218">ConnectionState</span>&nbsp;<span class="keyword" id="3767234">struct</span>&nbsp;<span class="op" id="3767241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767244">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767271">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767293">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767352">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767379">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767401">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767431">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767458">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767480">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767529">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767556">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767578">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767634">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767661">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767683">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767737">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3767764">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767786">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767835">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3767862">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767884">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767947">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3767974">[</span><span class="op" id="3767975">]</span><span class="op" id="3767976">*</span><span class="ident" id="3767977">x509</span><span class="op" id="3767981">.</span><span class="ident" id="3767982">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3767996">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768043">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3768070">[</span><span class="op" id="3768071">]</span><span class="op" id="3768072">[</span><span class="op" id="3768073">]</span><span class="op" id="3768074">*</span><span class="ident" id="3768075">x509</span><span class="op" id="3768079">.</span><span class="ident" id="3768080">Certificate</span>&nbsp;<span class="comment" id="3768092">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768141">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768212">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768278">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768338">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768411">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768477">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768511">TLSUnique</span>&nbsp;<span class="op" id="3768521">[</span><span class="op" id="3768522">]</span><span class="builtintype" id="3768523">byte</span><br>
<span class="lineno"></span><span class="op" id="3768528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3768531">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3768596">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3768626">type</span>&nbsp;<span class="ident" id="3768631">ClientAuthType</span>&nbsp;<span class="builtintype" id="3768646">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3768651">const</span>&nbsp;<span class="op" id="3768657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768660">NoClientCert</span>&nbsp;<span class="ident" id="3768673">ClientAuthType</span>&nbsp;<span class="op" id="3768688">=</span>&nbsp;<span class="ident" id="3768690">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768696">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768715">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768737">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768762">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3768789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3768792">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3768865">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3768878">type</span>&nbsp;<span class="ident" id="3768883">ClientSessionState</span>&nbsp;<span class="keyword" id="3768902">struct</span>&nbsp;<span class="op" id="3768909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768912">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3768931">[</span><span class="op" id="3768932">]</span><span class="builtintype" id="3768933">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3768951">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769012">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3769031">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3769051">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769098">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3769117">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3769137">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769180">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3769199">[</span><span class="op" id="3769200">]</span><span class="builtintype" id="3769201">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3769219">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769276">serverCertificates</span>&nbsp;<span class="op" id="3769295">[</span><span class="op" id="3769296">]</span><span class="op" id="3769297">*</span><span class="ident" id="3769298">x509</span><span class="op" id="3769302">.</span><span class="ident" id="3769303">Certificate</span>&nbsp;<span class="comment" id="3769315">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3769360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3769363">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3769443">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3769522">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3769596">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3769611">type</span>&nbsp;<span class="ident" id="3769616">ClientSessionCache</span>&nbsp;<span class="keyword" id="3769635">interface</span>&nbsp;<span class="op" id="3769645">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769648">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769721">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769765">Get</span><span class="op" id="3769768">(</span><span class="ident" id="3769769">sessionKey</span>&nbsp;<span class="builtintype" id="3769780">string</span><span class="op" id="3769786">)</span>&nbsp;<span class="op" id="3769788">(</span><span class="ident" id="3769789">session</span>&nbsp;<span class="op" id="3769797">*</span><span class="ident" id="3769798">ClientSessionState</span><span class="op" id="3769816">,</span>&nbsp;<span class="ident" id="3769818">ok</span>&nbsp;<span class="builtintype" id="3769821">bool</span><span class="op" id="3769825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769829">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769898">Put</span><span class="op" id="3769901">(</span><span class="ident" id="3769902">sessionKey</span>&nbsp;<span class="builtintype" id="3769913">string</span><span class="op" id="3769919">,</span>&nbsp;<span class="ident" id="3769921">cs</span>&nbsp;<span class="op" id="3769924">*</span><span class="ident" id="3769925">ClientSessionState</span><span class="op" id="3769943">)</span><br>
<span class="lineno"></span><span class="op" id="3769945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769948">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3770027">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3770090">type</span>&nbsp;<span class="ident" id="3770095">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3770111">struct</span>&nbsp;<span class="op" id="3770118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770121">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770191">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770222">CipherSuites</span>&nbsp;<span class="op" id="3770235">[</span><span class="op" id="3770236">]</span><span class="builtintype" id="3770237">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770246">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770318">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770389">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770418">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770471">ServerName</span>&nbsp;<span class="builtintype" id="3770482">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770491">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770562">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770627">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770660">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770715">SupportedCurves</span>&nbsp;<span class="op" id="3770731">[</span><span class="op" id="3770732">]</span><span class="ident" id="3770733">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770743">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770812">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770885">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770908">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770963">SupportedPoints</span>&nbsp;<span class="op" id="3770979">[</span><span class="op" id="3770980">]</span><span class="builtintype" id="3770981">uint8</span><br>
<span class="lineno"></span><span class="op" id="3770987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3770990">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3771057">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3771119">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3771186">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3771200">type</span>&nbsp;<span class="ident" id="3771205">Config</span>&nbsp;<span class="keyword" id="3771212">struct</span>&nbsp;<span class="op" id="3771219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771222">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771291">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771363">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771380">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771440">Rand</span>&nbsp;<span class="ident" id="3771445">io</span><span class="op" id="3771447">.</span><span class="ident" id="3771448">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771457">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771533">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771572">Time</span>&nbsp;<span class="keyword" id="3771577">func</span><span class="op" id="3771581">(</span><span class="op" id="3771582">)</span>&nbsp;<span class="ident" id="3771584">time</span><span class="op" id="3771588">.</span><span class="ident" id="3771589">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771596">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771653">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771705">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771770">Certificates</span>&nbsp;<span class="op" id="3771783">[</span><span class="op" id="3771784">]</span><span class="ident" id="3771785">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771799">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771867">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771933">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772002">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772040">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772110">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772135">NameToCertificate</span>&nbsp;<span class="keyword" id="3772153">map</span><span class="op" id="3772156">[</span><span class="builtintype" id="3772157">string</span><span class="op" id="3772163">]</span><span class="op" id="3772164">*</span><span class="ident" id="3772165">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772179">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772239">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772310">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772366">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772438">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772448">GetCertificate</span>&nbsp;<span class="keyword" id="3772463">func</span><span class="op" id="3772467">(</span><span class="ident" id="3772468">clientHello</span>&nbsp;<span class="op" id="3772480">*</span><span class="ident" id="3772481">ClientHelloInfo</span><span class="op" id="3772496">)</span>&nbsp;<span class="op" id="3772498">(</span><span class="op" id="3772499">*</span><span class="ident" id="3772500">Certificate</span><span class="op" id="3772511">,</span>&nbsp;<span class="builtintype" id="3772513">error</span><span class="op" id="3772518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772522">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772582">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772639">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772695">RootCAs</span>&nbsp;<span class="op" id="3772703">*</span><span class="ident" id="3772704">x509</span><span class="op" id="3772708">.</span><span class="ident" id="3772709">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772720">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772788">NextProtos</span>&nbsp;<span class="op" id="3772799">[</span><span class="op" id="3772800">]</span><span class="builtintype" id="3772801">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772810">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772872">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772945">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773003">ServerName</span>&nbsp;<span class="builtintype" id="3773014">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773023">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773073">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773133">ClientAuth</span>&nbsp;<span class="ident" id="3773144">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773161">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773223">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773287">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773320">ClientCAs</span>&nbsp;<span class="op" id="3773330">*</span><span class="ident" id="3773331">x509</span><span class="op" id="3773335">.</span><span class="ident" id="3773336">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773347">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773409">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773455">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773518">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773585">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773652">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773694">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3773713">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773720">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773791">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773862">CipherSuites</span>&nbsp;<span class="op" id="3773875">[</span><span class="op" id="3773876">]</span><span class="builtintype" id="3773877">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773886">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773955">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774027">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774098">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774150">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3774175">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774182">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774254">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774280">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3774303">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774310">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774373">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774435">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774486">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774490">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774560">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774619">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774682">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774730">SessionTicketKey</span>&nbsp;<span class="op" id="3774747">[</span><span class="num" id="3774748">32</span><span class="op" id="3774750">]</span><span class="builtintype" id="3774751">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774758">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774832">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774848">ClientSessionCache</span>&nbsp;<span class="ident" id="3774867">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774888">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774960">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775009">MinVersion</span>&nbsp;<span class="builtintype" id="3775020">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775029">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775101">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775174">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775206">MaxVersion</span>&nbsp;<span class="builtintype" id="3775217">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775226">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775297">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775369">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775382">CurvePreferences</span>&nbsp;<span class="op" id="3775399">[</span><span class="op" id="3775400">]</span><span class="ident" id="3775401">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775411">serverInitOnce</span>&nbsp;<span class="ident" id="3775426">sync</span><span class="op" id="3775430">.</span><span class="ident" id="3775431">Once</span>&nbsp;<span class="comment" id="3775436">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3775475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3775478">func</span>&nbsp;<span class="op" id="3775483">(</span><span class="ident" id="3775484">c</span>&nbsp;<span class="op" id="3775486">*</span><span class="ident" id="3775487">Config</span><span class="op" id="3775493">)</span>&nbsp;<span class="ident" id="3775495">serverInit</span><span class="op" id="3775505">(</span><span class="op" id="3775506">)</span>&nbsp;<span class="op" id="3775508">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775511">if</span>&nbsp;<span class="ident" id="3775514">c</span><span class="op" id="3775515">.</span><span class="ident" id="3775516">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3775539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775555">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775619">for</span>&nbsp;<span class="ident" id="3775623">_</span><span class="op" id="3775624">,</span>&nbsp;<span class="ident" id="3775626">b</span>&nbsp;<span class="op" id="3775628">:=</span>&nbsp;<span class="keyword" id="3775631">range</span>&nbsp;<span class="ident" id="3775637">c</span><span class="op" id="3775638">.</span><span class="ident" id="3775639">SessionTicketKey</span>&nbsp;<span class="op" id="3775656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775660">if</span>&nbsp;<span class="ident" id="3775663">b</span>&nbsp;<span class="op" id="3775665">!=</span>&nbsp;<span class="num" id="3775668">0</span>&nbsp;<span class="op" id="3775670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775675">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775687">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775691">if</span>&nbsp;<span class="ident" id="3775694">_</span><span class="op" id="3775695">,</span>&nbsp;<span class="ident" id="3775697">err</span>&nbsp;<span class="op" id="3775701">:=</span>&nbsp;<span class="ident" id="3775704">io</span><span class="op" id="3775706">.</span><span class="ident" id="3775707">ReadFull</span><span class="op" id="3775715">(</span><span class="ident" id="3775716">c</span><span class="op" id="3775717">.</span><span class="ident" id="3775718">rand</span><span class="op" id="3775722">(</span><span class="op" id="3775723">)</span><span class="op" id="3775724">,</span>&nbsp;<span class="ident" id="3775726">c</span><span class="op" id="3775727">.</span><span class="ident" id="3775728">SessionTicketKey</span><span class="op" id="3775744">[</span><span class="op" id="3775745">:</span><span class="op" id="3775746">]</span><span class="op" id="3775747">)</span><span class="op" id="3775748">;</span>&nbsp;<span class="ident" id="3775750">err</span>&nbsp;<span class="op" id="3775754">!=</span>&nbsp;<span class="ident" id="3775757">nil</span>&nbsp;<span class="op" id="3775761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775765">c</span><span class="op" id="3775766">.</span><span class="ident" id="3775767">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3775790">=</span>&nbsp;<span class="builtintype" id="3775792">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775798">}</span><br>
<span class="lineno"></span><span class="op" id="3775800">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3775803">func</span>&nbsp;<span class="op" id="3775808">(</span><span class="ident" id="3775809">c</span>&nbsp;<span class="op" id="3775811">*</span><span class="ident" id="3775812">Config</span><span class="op" id="3775818">)</span>&nbsp;<span class="ident" id="3775820">rand</span><span class="op" id="3775824">(</span><span class="op" id="3775825">)</span>&nbsp;<span class="ident" id="3775827">io</span><span class="op" id="3775829">.</span><span class="ident" id="3775830">Reader</span>&nbsp;<span class="op" id="3775837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775840">r</span>&nbsp;<span class="op" id="3775842">:=</span>&nbsp;<span class="ident" id="3775845">c</span><span class="op" id="3775846">.</span><span class="ident" id="3775847">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775853">if</span>&nbsp;<span class="ident" id="3775856">r</span>&nbsp;<span class="op" id="3775858">==</span>&nbsp;<span class="ident" id="3775861">nil</span>&nbsp;<span class="op" id="3775865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775869">return</span>&nbsp;<span class="ident" id="3775876">rand</span><span class="op" id="3775880">.</span><span class="ident" id="3775881">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775892">return</span>&nbsp;<span class="ident" id="3775899">r</span><br>
<span class="lineno"></span><span class="op" id="3775901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3775904">func</span>&nbsp;<span class="op" id="3775909">(</span><span class="ident" id="3775910">c</span>&nbsp;<span class="op" id="3775912">*</span><span class="ident" id="3775913">Config</span><span class="op" id="3775919">)</span>&nbsp;<span class="ident" id="3775921">time</span><span class="op" id="3775925">(</span><span class="op" id="3775926">)</span>&nbsp;<span class="ident" id="3775928">time</span><span class="op" id="3775932">.</span><span class="ident" id="3775933">Time</span>&nbsp;<span class="op" id="3775938">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775941">t</span>&nbsp;<span class="op" id="3775943">:=</span>&nbsp;<span class="ident" id="3775946">c</span><span class="op" id="3775947">.</span><span class="ident" id="3775948">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775954">if</span>&nbsp;<span class="ident" id="3775957">t</span>&nbsp;<span class="op" id="3775959">==</span>&nbsp;<span class="ident" id="3775962">nil</span>&nbsp;<span class="op" id="3775966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775970">t</span>&nbsp;<span class="op" id="3775972">=</span>&nbsp;<span class="ident" id="3775974">time</span><span class="op" id="3775978">.</span><span class="ident" id="3775979">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775987">return</span>&nbsp;<span class="ident" id="3775994">t</span><span class="op" id="3775995">(</span><span class="op" id="3775996">)</span><br>
<span class="lineno">380</span><span class="op" id="3775998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3776001">func</span>&nbsp;<span class="op" id="3776006">(</span><span class="ident" id="3776007">c</span>&nbsp;<span class="op" id="3776009">*</span><span class="ident" id="3776010">Config</span><span class="op" id="3776016">)</span>&nbsp;<span class="ident" id="3776018">cipherSuites</span><span class="op" id="3776030">(</span><span class="op" id="3776031">)</span>&nbsp;<span class="op" id="3776033">[</span><span class="op" id="3776034">]</span><span class="builtintype" id="3776035">uint16</span>&nbsp;<span class="op" id="3776042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776045">s</span>&nbsp;<span class="op" id="3776047">:=</span>&nbsp;<span class="ident" id="3776050">c</span><span class="op" id="3776051">.</span><span class="ident" id="3776052">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776066">if</span>&nbsp;<span class="ident" id="3776069">s</span>&nbsp;<span class="op" id="3776071">==</span>&nbsp;<span class="ident" id="3776074">nil</span>&nbsp;<span class="op" id="3776078">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776082">s</span>&nbsp;<span class="op" id="3776084">=</span>&nbsp;<span class="ident" id="3776086">defaultCipherSuites</span><span class="op" id="3776105">(</span><span class="op" id="3776106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776112">return</span>&nbsp;<span class="ident" id="3776119">s</span><br>
<span class="lineno"></span><span class="op" id="3776121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3776124">func</span>&nbsp;<span class="op" id="3776129">(</span><span class="ident" id="3776130">c</span>&nbsp;<span class="op" id="3776132">*</span><span class="ident" id="3776133">Config</span><span class="op" id="3776139">)</span>&nbsp;<span class="ident" id="3776141">minVersion</span><span class="op" id="3776151">(</span><span class="op" id="3776152">)</span>&nbsp;<span class="builtintype" id="3776154">uint16</span>&nbsp;<span class="op" id="3776161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776164">if</span>&nbsp;<span class="ident" id="3776167">c</span>&nbsp;<span class="op" id="3776169">==</span>&nbsp;<span class="ident" id="3776172">nil</span>&nbsp;<span class="op" id="3776176">||</span>&nbsp;<span class="ident" id="3776179">c</span><span class="op" id="3776180">.</span><span class="ident" id="3776181">MinVersion</span>&nbsp;<span class="op" id="3776192">==</span>&nbsp;<span class="num" id="3776195">0</span>&nbsp;<span class="op" id="3776197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776201">return</span>&nbsp;<span class="ident" id="3776208">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776223">return</span>&nbsp;<span class="ident" id="3776230">c</span><span class="op" id="3776231">.</span><span class="ident" id="3776232">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3776243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3776246">func</span>&nbsp;<span class="op" id="3776251">(</span><span class="ident" id="3776252">c</span>&nbsp;<span class="op" id="3776254">*</span><span class="ident" id="3776255">Config</span><span class="op" id="3776261">)</span>&nbsp;<span class="ident" id="3776263">maxVersion</span><span class="op" id="3776273">(</span><span class="op" id="3776274">)</span>&nbsp;<span class="builtintype" id="3776276">uint16</span>&nbsp;<span class="op" id="3776283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776286">if</span>&nbsp;<span class="ident" id="3776289">c</span>&nbsp;<span class="op" id="3776291">==</span>&nbsp;<span class="ident" id="3776294">nil</span>&nbsp;<span class="op" id="3776298">||</span>&nbsp;<span class="ident" id="3776301">c</span><span class="op" id="3776302">.</span><span class="ident" id="3776303">MaxVersion</span>&nbsp;<span class="op" id="3776314">==</span>&nbsp;<span class="num" id="3776317">0</span>&nbsp;<span class="op" id="3776319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776323">return</span>&nbsp;<span class="ident" id="3776330">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776345">return</span>&nbsp;<span class="ident" id="3776352">c</span><span class="op" id="3776353">.</span><span class="ident" id="3776354">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3776365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3776368">var</span>&nbsp;<span class="ident" id="3776372">defaultCurvePreferences</span>&nbsp;<span class="op" id="3776396">=</span>&nbsp;<span class="op" id="3776398">[</span><span class="op" id="3776399">]</span><span class="ident" id="3776400">CurveID</span><span class="op" id="3776407">{</span><span class="ident" id="3776408">CurveP256</span><span class="op" id="3776417">,</span>&nbsp;<span class="ident" id="3776419">CurveP384</span><span class="op" id="3776428">,</span>&nbsp;<span class="ident" id="3776430">CurveP521</span><span class="op" id="3776439">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3776442">func</span>&nbsp;<span class="op" id="3776447">(</span><span class="ident" id="3776448">c</span>&nbsp;<span class="op" id="3776450">*</span><span class="ident" id="3776451">Config</span><span class="op" id="3776457">)</span>&nbsp;<span class="ident" id="3776459">curvePreferences</span><span class="op" id="3776475">(</span><span class="op" id="3776476">)</span>&nbsp;<span class="op" id="3776478">[</span><span class="op" id="3776479">]</span><span class="ident" id="3776480">CurveID</span>&nbsp;<span class="op" id="3776488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776491">if</span>&nbsp;<span class="ident" id="3776494">c</span>&nbsp;<span class="op" id="3776496">==</span>&nbsp;<span class="ident" id="3776499">nil</span>&nbsp;<span class="op" id="3776503">||</span>&nbsp;<span class="builtinfunc" id="3776506">len</span><span class="op" id="3776509">(</span><span class="ident" id="3776510">c</span><span class="op" id="3776511">.</span><span class="ident" id="3776512">CurvePreferences</span><span class="op" id="3776528">)</span>&nbsp;<span class="op" id="3776530">==</span>&nbsp;<span class="num" id="3776533">0</span>&nbsp;<span class="op" id="3776535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776539">return</span>&nbsp;<span class="ident" id="3776546">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776571">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776574">return</span>&nbsp;<span class="ident" id="3776581">c</span><span class="op" id="3776582">.</span><span class="ident" id="3776583">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3776600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776603">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3776677">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3776701">func</span>&nbsp;<span class="op" id="3776706">(</span><span class="ident" id="3776707">c</span>&nbsp;<span class="op" id="3776709">*</span><span class="ident" id="3776710">Config</span><span class="op" id="3776716">)</span>&nbsp;<span class="ident" id="3776718">mutualVersion</span><span class="op" id="3776731">(</span><span class="ident" id="3776732">vers</span>&nbsp;<span class="builtintype" id="3776737">uint16</span><span class="op" id="3776743">)</span>&nbsp;<span class="op" id="3776745">(</span><span class="builtintype" id="3776746">uint16</span><span class="op" id="3776752">,</span>&nbsp;<span class="builtintype" id="3776754">bool</span><span class="op" id="3776758">)</span>&nbsp;<span class="op" id="3776760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776763">minVersion</span>&nbsp;<span class="op" id="3776774">:=</span>&nbsp;<span class="ident" id="3776777">c</span><span class="op" id="3776778">.</span><span class="ident" id="3776779">minVersion</span><span class="op" id="3776789">(</span><span class="op" id="3776790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776793">maxVersion</span>&nbsp;<span class="op" id="3776804">:=</span>&nbsp;<span class="ident" id="3776807">c</span><span class="op" id="3776808">.</span><span class="ident" id="3776809">maxVersion</span><span class="op" id="3776819">(</span><span class="op" id="3776820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776824">if</span>&nbsp;<span class="ident" id="3776827">vers</span>&nbsp;<span class="op" id="3776832">&lt;</span>&nbsp;<span class="ident" id="3776834">minVersion</span>&nbsp;<span class="op" id="3776845">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776849">return</span>&nbsp;<span class="num" id="3776856">0</span><span class="op" id="3776857">,</span>&nbsp;<span class="builtintype" id="3776859">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776869">if</span>&nbsp;<span class="ident" id="3776872">vers</span>&nbsp;<span class="op" id="3776877">&gt;</span>&nbsp;<span class="ident" id="3776879">maxVersion</span>&nbsp;<span class="op" id="3776890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776894">vers</span>&nbsp;<span class="op" id="3776899">=</span>&nbsp;<span class="ident" id="3776901">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776913">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776916">return</span>&nbsp;<span class="ident" id="3776923">vers</span><span class="op" id="3776927">,</span>&nbsp;<span class="builtintype" id="3776929">true</span><br>
<span class="lineno"></span><span class="op" id="3776934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776937">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3777015">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3777069">func</span>&nbsp;<span class="op" id="3777074">(</span><span class="ident" id="3777075">c</span>&nbsp;<span class="op" id="3777077">*</span><span class="ident" id="3777078">Config</span><span class="op" id="3777084">)</span>&nbsp;<span class="ident" id="3777086">getCertificate</span><span class="op" id="3777100">(</span><span class="ident" id="3777101">clientHello</span>&nbsp;<span class="op" id="3777113">*</span><span class="ident" id="3777114">ClientHelloInfo</span><span class="op" id="3777129">)</span>&nbsp;<span class="op" id="3777131">(</span><span class="op" id="3777132">*</span><span class="ident" id="3777133">Certificate</span><span class="op" id="3777144">,</span>&nbsp;<span class="builtintype" id="3777146">error</span><span class="op" id="3777151">)</span>&nbsp;<span class="op" id="3777153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777156">if</span>&nbsp;<span class="ident" id="3777159">c</span><span class="op" id="3777160">.</span><span class="ident" id="3777161">GetCertificate</span>&nbsp;<span class="op" id="3777176">!=</span>&nbsp;<span class="ident" id="3777179">nil</span>&nbsp;<span class="op" id="3777183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777187">cert</span><span class="op" id="3777191">,</span>&nbsp;<span class="ident" id="3777193">err</span>&nbsp;<span class="op" id="3777197">:=</span>&nbsp;<span class="ident" id="3777200">c</span><span class="op" id="3777201">.</span><span class="ident" id="3777202">GetCertificate</span><span class="op" id="3777216">(</span><span class="ident" id="3777217">clientHello</span><span class="op" id="3777228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777232">if</span>&nbsp;<span class="ident" id="3777235">cert</span>&nbsp;<span class="op" id="3777240">!=</span>&nbsp;<span class="ident" id="3777243">nil</span>&nbsp;<span class="op" id="3777247">||</span>&nbsp;<span class="ident" id="3777250">err</span>&nbsp;<span class="op" id="3777254">!=</span>&nbsp;<span class="ident" id="3777257">nil</span>&nbsp;<span class="op" id="3777261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777266">return</span>&nbsp;<span class="ident" id="3777273">cert</span><span class="op" id="3777277">,</span>&nbsp;<span class="ident" id="3777279">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777292">if</span>&nbsp;<span class="builtinfunc" id="3777295">len</span><span class="op" id="3777298">(</span><span class="ident" id="3777299">c</span><span class="op" id="3777300">.</span><span class="ident" id="3777301">Certificates</span><span class="op" id="3777313">)</span>&nbsp;<span class="op" id="3777315">==</span>&nbsp;<span class="num" id="3777318">1</span>&nbsp;<span class="op" id="3777320">||</span>&nbsp;<span class="ident" id="3777323">c</span><span class="op" id="3777324">.</span><span class="ident" id="3777325">NameToCertificate</span>&nbsp;<span class="op" id="3777343">==</span>&nbsp;<span class="ident" id="3777346">nil</span>&nbsp;<span class="op" id="3777350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777354">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777412">return</span>&nbsp;<span class="op" id="3777419">&amp;</span><span class="ident" id="3777420">c</span><span class="op" id="3777421">.</span><span class="ident" id="3777422">Certificates</span><span class="op" id="3777434">[</span><span class="num" id="3777435">0</span><span class="op" id="3777436">]</span><span class="op" id="3777437">,</span>&nbsp;<span class="ident" id="3777439">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777448">name</span>&nbsp;<span class="op" id="3777453">:=</span>&nbsp;<span class="ident" id="3777456">strings</span><span class="op" id="3777463">.</span><span class="ident" id="3777464">ToLower</span><span class="op" id="3777471">(</span><span class="ident" id="3777472">clientHello</span><span class="op" id="3777483">.</span><span class="ident" id="3777484">ServerName</span><span class="op" id="3777494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777497">for</span>&nbsp;<span class="builtinfunc" id="3777501">len</span><span class="op" id="3777504">(</span><span class="ident" id="3777505">name</span><span class="op" id="3777509">)</span>&nbsp;<span class="op" id="3777511">&gt;</span>&nbsp;<span class="num" id="3777513">0</span>&nbsp;<span class="op" id="3777515">&amp;&amp;</span>&nbsp;<span class="ident" id="3777518">name</span><span class="op" id="3777522">[</span><span class="builtinfunc" id="3777523">len</span><span class="op" id="3777526">(</span><span class="ident" id="3777527">name</span><span class="op" id="3777531">)</span><span class="op" id="3777532">-</span><span class="num" id="3777533">1</span><span class="op" id="3777534">]</span>&nbsp;<span class="op" id="3777536">==</span>&nbsp;<span class="string" id="3777539">&#39;.&#39;</span>&nbsp;<span class="op" id="3777543">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777547">name</span>&nbsp;<span class="op" id="3777552">=</span>&nbsp;<span class="ident" id="3777554">name</span><span class="op" id="3777558">[</span><span class="op" id="3777559">:</span><span class="builtinfunc" id="3777560">len</span><span class="op" id="3777563">(</span><span class="ident" id="3777564">name</span><span class="op" id="3777568">)</span><span class="op" id="3777569">-</span><span class="num" id="3777570">1</span><span class="op" id="3777571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777578">if</span>&nbsp;<span class="ident" id="3777581">cert</span><span class="op" id="3777585">,</span>&nbsp;<span class="ident" id="3777587">ok</span>&nbsp;<span class="op" id="3777590">:=</span>&nbsp;<span class="ident" id="3777593">c</span><span class="op" id="3777594">.</span><span class="ident" id="3777595">NameToCertificate</span><span class="op" id="3777612">[</span><span class="ident" id="3777613">name</span><span class="op" id="3777617">]</span><span class="op" id="3777618">;</span>&nbsp;<span class="ident" id="3777620">ok</span>&nbsp;<span class="op" id="3777623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777627">return</span>&nbsp;<span class="ident" id="3777634">cert</span><span class="op" id="3777638">,</span>&nbsp;<span class="ident" id="3777640">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777649">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777716">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777727">labels</span>&nbsp;<span class="op" id="3777734">:=</span>&nbsp;<span class="ident" id="3777737">strings</span><span class="op" id="3777744">.</span><span class="ident" id="3777745">Split</span><span class="op" id="3777750">(</span><span class="ident" id="3777751">name</span><span class="op" id="3777755">,</span>&nbsp;<span class="string" id="3777757">&#34;.&#34;</span><span class="op" id="3777760">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777763">for</span>&nbsp;<span class="ident" id="3777767">i</span>&nbsp;<span class="op" id="3777769">:=</span>&nbsp;<span class="keyword" id="3777772">range</span>&nbsp;<span class="ident" id="3777778">labels</span>&nbsp;<span class="op" id="3777785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777789">labels</span><span class="op" id="3777795">[</span><span class="ident" id="3777796">i</span><span class="op" id="3777797">]</span>&nbsp;<span class="op" id="3777799">=</span>&nbsp;<span class="string" id="3777801">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777807">candidate</span>&nbsp;<span class="op" id="3777817">:=</span>&nbsp;<span class="ident" id="3777820">strings</span><span class="op" id="3777827">.</span><span class="ident" id="3777828">Join</span><span class="op" id="3777832">(</span><span class="ident" id="3777833">labels</span><span class="op" id="3777839">,</span>&nbsp;<span class="string" id="3777841">&#34;.&#34;</span><span class="op" id="3777844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777848">if</span>&nbsp;<span class="ident" id="3777851">cert</span><span class="op" id="3777855">,</span>&nbsp;<span class="ident" id="3777857">ok</span>&nbsp;<span class="op" id="3777860">:=</span>&nbsp;<span class="ident" id="3777863">c</span><span class="op" id="3777864">.</span><span class="ident" id="3777865">NameToCertificate</span><span class="op" id="3777882">[</span><span class="ident" id="3777883">candidate</span><span class="op" id="3777892">]</span><span class="op" id="3777893">;</span>&nbsp;<span class="ident" id="3777895">ok</span>&nbsp;<span class="op" id="3777898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777903">return</span>&nbsp;<span class="ident" id="3777910">cert</span><span class="op" id="3777914">,</span>&nbsp;<span class="ident" id="3777916">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777929">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777983">return</span>&nbsp;<span class="op" id="3777990">&amp;</span><span class="ident" id="3777991">c</span><span class="op" id="3777992">.</span><span class="ident" id="3777993">Certificates</span><span class="op" id="3778005">[</span><span class="num" id="3778006">0</span><span class="op" id="3778007">]</span><span class="op" id="3778008">,</span>&nbsp;<span class="ident" id="3778010">nil</span><br>
<span class="lineno">465</span><span class="op" id="3778014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3778017">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3778096">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3778171">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3778188">func</span>&nbsp;<span class="op" id="3778193">(</span><span class="ident" id="3778194">c</span>&nbsp;<span class="op" id="3778196">*</span><span class="ident" id="3778197">Config</span><span class="op" id="3778203">)</span>&nbsp;<span class="ident" id="3778205">BuildNameToCertificate</span><span class="op" id="3778227">(</span><span class="op" id="3778228">)</span>&nbsp;<span class="op" id="3778230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778233">c</span><span class="op" id="3778234">.</span><span class="ident" id="3778235">NameToCertificate</span>&nbsp;<span class="op" id="3778253">=</span>&nbsp;<span class="builtinfunc" id="3778255">make</span><span class="op" id="3778259">(</span><span class="keyword" id="3778260">map</span><span class="op" id="3778263">[</span><span class="builtintype" id="3778264">string</span><span class="op" id="3778270">]</span><span class="op" id="3778271">*</span><span class="ident" id="3778272">Certificate</span><span class="op" id="3778283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778286">for</span>&nbsp;<span class="ident" id="3778290">i</span>&nbsp;<span class="op" id="3778292">:=</span>&nbsp;<span class="keyword" id="3778295">range</span>&nbsp;<span class="ident" id="3778301">c</span><span class="op" id="3778302">.</span><span class="ident" id="3778303">Certificates</span>&nbsp;<span class="op" id="3778316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778320">cert</span>&nbsp;<span class="op" id="3778325">:=</span>&nbsp;<span class="op" id="3778328">&amp;</span><span class="ident" id="3778329">c</span><span class="op" id="3778330">.</span><span class="ident" id="3778331">Certificates</span><span class="op" id="3778343">[</span><span class="ident" id="3778344">i</span><span class="op" id="3778345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778349">x509Cert</span><span class="op" id="3778357">,</span>&nbsp;<span class="ident" id="3778359">err</span>&nbsp;<span class="op" id="3778363">:=</span>&nbsp;<span class="ident" id="3778366">x509</span><span class="op" id="3778370">.</span><span class="ident" id="3778371">ParseCertificate</span><span class="op" id="3778387">(</span><span class="ident" id="3778388">cert</span><span class="op" id="3778392">.</span><span class="ident" id="3778393">Certificate</span><span class="op" id="3778404">[</span><span class="num" id="3778405">0</span><span class="op" id="3778406">]</span><span class="op" id="3778407">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778411">if</span>&nbsp;<span class="ident" id="3778414">err</span>&nbsp;<span class="op" id="3778418">!=</span>&nbsp;<span class="ident" id="3778421">nil</span>&nbsp;<span class="op" id="3778425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778430">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778445">if</span>&nbsp;<span class="builtinfunc" id="3778448">len</span><span class="op" id="3778451">(</span><span class="ident" id="3778452">x509Cert</span><span class="op" id="3778460">.</span><span class="ident" id="3778461">Subject</span><span class="op" id="3778468">.</span><span class="ident" id="3778469">CommonName</span><span class="op" id="3778479">)</span>&nbsp;<span class="op" id="3778481">&gt;</span>&nbsp;<span class="num" id="3778483">0</span>&nbsp;<span class="op" id="3778485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778490">c</span><span class="op" id="3778491">.</span><span class="ident" id="3778492">NameToCertificate</span><span class="op" id="3778509">[</span><span class="ident" id="3778510">x509Cert</span><span class="op" id="3778518">.</span><span class="ident" id="3778519">Subject</span><span class="op" id="3778526">.</span><span class="ident" id="3778527">CommonName</span><span class="op" id="3778537">]</span>&nbsp;<span class="op" id="3778539">=</span>&nbsp;<span class="ident" id="3778541">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778552">for</span>&nbsp;<span class="ident" id="3778556">_</span><span class="op" id="3778557">,</span>&nbsp;<span class="ident" id="3778559">san</span>&nbsp;<span class="op" id="3778563">:=</span>&nbsp;<span class="keyword" id="3778566">range</span>&nbsp;<span class="ident" id="3778572">x509Cert</span><span class="op" id="3778580">.</span><span class="ident" id="3778581">DNSNames</span>&nbsp;<span class="op" id="3778590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778595">c</span><span class="op" id="3778596">.</span><span class="ident" id="3778597">NameToCertificate</span><span class="op" id="3778614">[</span><span class="ident" id="3778615">san</span><span class="op" id="3778618">]</span>&nbsp;<span class="op" id="3778620">=</span>&nbsp;<span class="ident" id="3778622">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778632">}</span><br>
<span class="lineno">485</span><span class="op" id="3778634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3778637">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3778706">type</span>&nbsp;<span class="ident" id="3778711">Certificate</span>&nbsp;<span class="keyword" id="3778723">struct</span>&nbsp;<span class="op" id="3778730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778733">Certificate</span>&nbsp;<span class="op" id="3778745">[</span><span class="op" id="3778746">]</span><span class="op" id="3778747">[</span><span class="op" id="3778748">]</span><span class="builtintype" id="3778749">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778755">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778827">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778888">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778958">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779028">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779057">PrivateKey</span>&nbsp;<span class="ident" id="3779068">crypto</span><span class="op" id="3779074">.</span><span class="ident" id="3779075">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779087">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779158">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779190">OCSPStaple</span>&nbsp;<span class="op" id="3779201">[</span><span class="op" id="3779202">]</span><span class="builtintype" id="3779203">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779209">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779275">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779343">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779415">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779462">Leaf</span>&nbsp;<span class="op" id="3779467">*</span><span class="ident" id="3779468">x509</span><span class="op" id="3779472">.</span><span class="ident" id="3779473">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3779485">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3779488">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3779505">type</span>&nbsp;<span class="ident" id="3779510">record</span>&nbsp;<span class="keyword" id="3779517">struct</span>&nbsp;<span class="op" id="3779524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779527">contentType</span>&nbsp;&nbsp;<span class="ident" id="3779540">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779552">major</span><span class="op" id="3779557">,</span>&nbsp;<span class="ident" id="3779559">minor</span>&nbsp;<span class="builtintype" id="3779565">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779572">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3779585">[</span><span class="op" id="3779586">]</span><span class="builtintype" id="3779587">byte</span><br>
<span class="lineno"></span><span class="op" id="3779592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3779595">type</span>&nbsp;<span class="ident" id="3779600">handshakeMessage</span>&nbsp;<span class="keyword" id="3779617">interface</span>&nbsp;<span class="op" id="3779627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779630">marshal</span><span class="op" id="3779637">(</span><span class="op" id="3779638">)</span>&nbsp;<span class="op" id="3779640">[</span><span class="op" id="3779641">]</span><span class="builtintype" id="3779642">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779648">unmarshal</span><span class="op" id="3779657">(</span><span class="op" id="3779658">[</span><span class="op" id="3779659">]</span><span class="builtintype" id="3779660">byte</span><span class="op" id="3779664">)</span>&nbsp;<span class="builtintype" id="3779666">bool</span><br>
<span class="lineno"></span><span class="op" id="3779671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3779674">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3779749">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3779770">type</span>&nbsp;<span class="ident" id="3779775">lruSessionCache</span>&nbsp;<span class="keyword" id="3779791">struct</span>&nbsp;<span class="op" id="3779798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779801">sync</span><span class="op" id="3779805">.</span><span class="ident" id="3779806">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779814">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3779823">map</span><span class="op" id="3779826">[</span><span class="builtintype" id="3779827">string</span><span class="op" id="3779833">]</span><span class="op" id="3779834">*</span><span class="ident" id="3779835">list</span><span class="op" id="3779839">.</span><span class="ident" id="3779840">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779849">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3779858">*</span><span class="ident" id="3779859">list</span><span class="op" id="3779863">.</span><span class="ident" id="3779864">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779870">capacity</span>&nbsp;<span class="builtintype" id="3779879">int</span><br>
<span class="lineno"></span><span class="op" id="3779883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3779886">type</span>&nbsp;<span class="ident" id="3779891">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3779912">struct</span>&nbsp;<span class="op" id="3779919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779922">sessionKey</span>&nbsp;<span class="builtintype" id="3779933">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779941">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3779952">*</span><span class="ident" id="3779953">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3779972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3779975">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3780047">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3780125">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3780145">func</span>&nbsp;<span class="ident" id="3780150">NewLRUClientSessionCache</span><span class="op" id="3780174">(</span><span class="ident" id="3780175">capacity</span>&nbsp;<span class="builtintype" id="3780184">int</span><span class="op" id="3780187">)</span>&nbsp;<span class="ident" id="3780189">ClientSessionCache</span>&nbsp;<span class="op" id="3780208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780211">const</span>&nbsp;<span class="ident" id="3780217">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3780245">=</span>&nbsp;<span class="num" id="3780247">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780252">if</span>&nbsp;<span class="ident" id="3780255">capacity</span>&nbsp;<span class="op" id="3780264">&lt;</span>&nbsp;<span class="num" id="3780266">1</span>&nbsp;<span class="op" id="3780268">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780272">capacity</span>&nbsp;<span class="op" id="3780281">=</span>&nbsp;<span class="ident" id="3780283">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780315">return</span>&nbsp;<span class="op" id="3780322">&amp;</span><span class="ident" id="3780323">lruSessionCache</span><span class="op" id="3780338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780342">m</span><span class="op" id="3780343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3780352">make</span><span class="op" id="3780356">(</span><span class="keyword" id="3780357">map</span><span class="op" id="3780360">[</span><span class="builtintype" id="3780361">string</span><span class="op" id="3780367">]</span><span class="op" id="3780368">*</span><span class="ident" id="3780369">list</span><span class="op" id="3780373">.</span><span class="ident" id="3780374">Element</span><span class="op" id="3780381">)</span><span class="op" id="3780382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780386">q</span><span class="op" id="3780387">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3780396">list</span><span class="op" id="3780400">.</span><span class="ident" id="3780401">New</span><span class="op" id="3780404">(</span><span class="op" id="3780405">)</span><span class="op" id="3780406">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780410">capacity</span><span class="op" id="3780418">:</span>&nbsp;<span class="ident" id="3780420">capacity</span><span class="op" id="3780428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780431">}</span><br>
<span class="lineno"></span><span class="op" id="3780433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780436">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3780497">func</span>&nbsp;<span class="op" id="3780502">(</span><span class="ident" id="3780503">c</span>&nbsp;<span class="op" id="3780505">*</span><span class="ident" id="3780506">lruSessionCache</span><span class="op" id="3780521">)</span>&nbsp;<span class="ident" id="3780523">Put</span><span class="op" id="3780526">(</span><span class="ident" id="3780527">sessionKey</span>&nbsp;<span class="builtintype" id="3780538">string</span><span class="op" id="3780544">,</span>&nbsp;<span class="ident" id="3780546">cs</span>&nbsp;<span class="op" id="3780549">*</span><span class="ident" id="3780550">ClientSessionState</span><span class="op" id="3780568">)</span>&nbsp;<span class="op" id="3780570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780573">c</span><span class="op" id="3780574">.</span><span class="ident" id="3780575">Lock</span><span class="op" id="3780579">(</span><span class="op" id="3780580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780583">defer</span>&nbsp;<span class="ident" id="3780589">c</span><span class="op" id="3780590">.</span><span class="ident" id="3780591">Unlock</span><span class="op" id="3780597">(</span><span class="op" id="3780598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780602">if</span>&nbsp;<span class="ident" id="3780605">elem</span><span class="op" id="3780609">,</span>&nbsp;<span class="ident" id="3780611">ok</span>&nbsp;<span class="op" id="3780614">:=</span>&nbsp;<span class="ident" id="3780617">c</span><span class="op" id="3780618">.</span><span class="ident" id="3780619">m</span><span class="op" id="3780620">[</span><span class="ident" id="3780621">sessionKey</span><span class="op" id="3780631">]</span><span class="op" id="3780632">;</span>&nbsp;<span class="ident" id="3780634">ok</span>&nbsp;<span class="op" id="3780637">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780641">entry</span>&nbsp;<span class="op" id="3780647">:=</span>&nbsp;<span class="ident" id="3780650">elem</span><span class="op" id="3780654">.</span><span class="ident" id="3780655">Value</span><span class="op" id="3780660">.</span><span class="op" id="3780661">(</span><span class="op" id="3780662">*</span><span class="ident" id="3780663">lruSessionCacheEntry</span><span class="op" id="3780683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780687">entry</span><span class="op" id="3780692">.</span><span class="ident" id="3780693">state</span>&nbsp;<span class="op" id="3780699">=</span>&nbsp;<span class="ident" id="3780701">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780706">c</span><span class="op" id="3780707">.</span><span class="ident" id="3780708">q</span><span class="op" id="3780709">.</span><span class="ident" id="3780710">MoveToFront</span><span class="op" id="3780721">(</span><span class="ident" id="3780722">elem</span><span class="op" id="3780726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780738">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780742">if</span>&nbsp;<span class="ident" id="3780745">c</span><span class="op" id="3780746">.</span><span class="ident" id="3780747">q</span><span class="op" id="3780748">.</span><span class="ident" id="3780749">Len</span><span class="op" id="3780752">(</span><span class="op" id="3780753">)</span>&nbsp;<span class="op" id="3780755">&lt;</span>&nbsp;<span class="ident" id="3780757">c</span><span class="op" id="3780758">.</span><span class="ident" id="3780759">capacity</span>&nbsp;<span class="op" id="3780768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780772">entry</span>&nbsp;<span class="op" id="3780778">:=</span>&nbsp;<span class="op" id="3780781">&amp;</span><span class="ident" id="3780782">lruSessionCacheEntry</span><span class="op" id="3780802">{</span><span class="ident" id="3780803">sessionKey</span><span class="op" id="3780813">,</span>&nbsp;<span class="ident" id="3780815">cs</span><span class="op" id="3780817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780821">c</span><span class="op" id="3780822">.</span><span class="ident" id="3780823">m</span><span class="op" id="3780824">[</span><span class="ident" id="3780825">sessionKey</span><span class="op" id="3780835">]</span>&nbsp;<span class="op" id="3780837">=</span>&nbsp;<span class="ident" id="3780839">c</span><span class="op" id="3780840">.</span><span class="ident" id="3780841">q</span><span class="op" id="3780842">.</span><span class="ident" id="3780843">PushFront</span><span class="op" id="3780852">(</span><span class="ident" id="3780853">entry</span><span class="op" id="3780858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780862">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780874">elem</span>&nbsp;<span class="op" id="3780879">:=</span>&nbsp;<span class="ident" id="3780882">c</span><span class="op" id="3780883">.</span><span class="ident" id="3780884">q</span><span class="op" id="3780885">.</span><span class="ident" id="3780886">Back</span><span class="op" id="3780890">(</span><span class="op" id="3780891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780894">entry</span>&nbsp;<span class="op" id="3780900">:=</span>&nbsp;<span class="ident" id="3780903">elem</span><span class="op" id="3780907">.</span><span class="ident" id="3780908">Value</span><span class="op" id="3780913">.</span><span class="op" id="3780914">(</span><span class="op" id="3780915">*</span><span class="ident" id="3780916">lruSessionCacheEntry</span><span class="op" id="3780936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3780939">delete</span><span class="op" id="3780945">(</span><span class="ident" id="3780946">c</span><span class="op" id="3780947">.</span><span class="ident" id="3780948">m</span><span class="op" id="3780949">,</span>&nbsp;<span class="ident" id="3780951">entry</span><span class="op" id="3780956">.</span><span class="ident" id="3780957">sessionKey</span><span class="op" id="3780967">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780970">entry</span><span class="op" id="3780975">.</span><span class="ident" id="3780976">sessionKey</span>&nbsp;<span class="op" id="3780987">=</span>&nbsp;<span class="ident" id="3780989">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781001">entry</span><span class="op" id="3781006">.</span><span class="ident" id="3781007">state</span>&nbsp;<span class="op" id="3781013">=</span>&nbsp;<span class="ident" id="3781015">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781019">c</span><span class="op" id="3781020">.</span><span class="ident" id="3781021">q</span><span class="op" id="3781022">.</span><span class="ident" id="3781023">MoveToFront</span><span class="op" id="3781034">(</span><span class="ident" id="3781035">elem</span><span class="op" id="3781039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781042">c</span><span class="op" id="3781043">.</span><span class="ident" id="3781044">m</span><span class="op" id="3781045">[</span><span class="ident" id="3781046">sessionKey</span><span class="op" id="3781056">]</span>&nbsp;<span class="op" id="3781058">=</span>&nbsp;<span class="ident" id="3781060">elem</span><br>
<span class="lineno"></span><span class="op" id="3781065">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3781068">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3781144">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3781190">func</span>&nbsp;<span class="op" id="3781195">(</span><span class="ident" id="3781196">c</span>&nbsp;<span class="op" id="3781198">*</span><span class="ident" id="3781199">lruSessionCache</span><span class="op" id="3781214">)</span>&nbsp;<span class="ident" id="3781216">Get</span><span class="op" id="3781219">(</span><span class="ident" id="3781220">sessionKey</span>&nbsp;<span class="builtintype" id="3781231">string</span><span class="op" id="3781237">)</span>&nbsp;<span class="op" id="3781239">(</span><span class="op" id="3781240">*</span><span class="ident" id="3781241">ClientSessionState</span><span class="op" id="3781259">,</span>&nbsp;<span class="builtintype" id="3781261">bool</span><span class="op" id="3781265">)</span>&nbsp;<span class="op" id="3781267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781270">c</span><span class="op" id="3781271">.</span><span class="ident" id="3781272">Lock</span><span class="op" id="3781276">(</span><span class="op" id="3781277">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781280">defer</span>&nbsp;<span class="ident" id="3781286">c</span><span class="op" id="3781287">.</span><span class="ident" id="3781288">Unlock</span><span class="op" id="3781294">(</span><span class="op" id="3781295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781299">if</span>&nbsp;<span class="ident" id="3781302">elem</span><span class="op" id="3781306">,</span>&nbsp;<span class="ident" id="3781308">ok</span>&nbsp;<span class="op" id="3781311">:=</span>&nbsp;<span class="ident" id="3781314">c</span><span class="op" id="3781315">.</span><span class="ident" id="3781316">m</span><span class="op" id="3781317">[</span><span class="ident" id="3781318">sessionKey</span><span class="op" id="3781328">]</span><span class="op" id="3781329">;</span>&nbsp;<span class="ident" id="3781331">ok</span>&nbsp;<span class="op" id="3781334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781338">c</span><span class="op" id="3781339">.</span><span class="ident" id="3781340">q</span><span class="op" id="3781341">.</span><span class="ident" id="3781342">MoveToFront</span><span class="op" id="3781353">(</span><span class="ident" id="3781354">elem</span><span class="op" id="3781358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781362">return</span>&nbsp;<span class="ident" id="3781369">elem</span><span class="op" id="3781373">.</span><span class="ident" id="3781374">Value</span><span class="op" id="3781379">.</span><span class="op" id="3781380">(</span><span class="op" id="3781381">*</span><span class="ident" id="3781382">lruSessionCacheEntry</span><span class="op" id="3781402">)</span><span class="op" id="3781403">.</span><span class="ident" id="3781404">state</span><span class="op" id="3781409">,</span>&nbsp;<span class="builtintype" id="3781411">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781420">return</span>&nbsp;<span class="ident" id="3781427">nil</span><span class="op" id="3781430">,</span>&nbsp;<span class="builtintype" id="3781432">false</span><br>
<span class="lineno"></span><span class="op" id="3781438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3781441">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3781514">type</span>&nbsp;<span class="ident" id="3781519">dsaSignature</span>&nbsp;<span class="keyword" id="3781532">struct</span>&nbsp;<span class="op" id="3781539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781542">R</span><span class="op" id="3781543">,</span>&nbsp;<span class="ident" id="3781545">S</span>&nbsp;<span class="op" id="3781547">*</span><span class="ident" id="3781548">big</span><span class="op" id="3781551">.</span><span class="ident" id="3781552">Int</span><br>
<span class="lineno"></span><span class="op" id="3781556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3781559">type</span>&nbsp;<span class="ident" id="3781564">ecdsaSignature</span>&nbsp;<span class="ident" id="3781579">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3781593">var</span>&nbsp;<span class="ident" id="3781597">emptyConfig</span>&nbsp;<span class="ident" id="3781609">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3781617">func</span>&nbsp;<span class="ident" id="3781622">defaultConfig</span><span class="op" id="3781635">(</span><span class="op" id="3781636">)</span>&nbsp;<span class="op" id="3781638">*</span><span class="ident" id="3781639">Config</span>&nbsp;<span class="op" id="3781646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781649">return</span>&nbsp;<span class="op" id="3781656">&amp;</span><span class="ident" id="3781657">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3781669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3781672">var</span>&nbsp;<span class="op" id="3781676">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781679">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3781702">sync</span><span class="op" id="3781706">.</span><span class="ident" id="3781707">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781713">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3781736">[</span><span class="op" id="3781737">]</span><span class="builtintype" id="3781738">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3781745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3781748">func</span>&nbsp;<span class="ident" id="3781753">defaultCipherSuites</span><span class="op" id="3781772">(</span><span class="op" id="3781773">)</span>&nbsp;<span class="op" id="3781775">[</span><span class="op" id="3781776">]</span><span class="builtintype" id="3781777">uint16</span>&nbsp;<span class="op" id="3781784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781787">once</span><span class="op" id="3781791">.</span><span class="ident" id="3781792">Do</span><span class="op" id="3781794">(</span><span class="ident" id="3781795">initDefaultCipherSuites</span><span class="op" id="3781818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781821">return</span>&nbsp;<span class="ident" id="3781828">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3781851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3781854">func</span>&nbsp;<span class="ident" id="3781859">initDefaultCipherSuites</span><span class="op" id="3781882">(</span><span class="op" id="3781883">)</span>&nbsp;<span class="op" id="3781885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781888">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3781911">=</span>&nbsp;<span class="builtinfunc" id="3781913">make</span><span class="op" id="3781917">(</span><span class="op" id="3781918">[</span><span class="op" id="3781919">]</span><span class="builtintype" id="3781920">uint16</span><span class="op" id="3781926">,</span>&nbsp;<span class="builtinfunc" id="3781928">len</span><span class="op" id="3781931">(</span><span class="ident" id="3781932">cipherSuites</span><span class="op" id="3781944">)</span><span class="op" id="3781945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781948">for</span>&nbsp;<span class="ident" id="3781952">i</span><span class="op" id="3781953">,</span>&nbsp;<span class="ident" id="3781955">suite</span>&nbsp;<span class="op" id="3781961">:=</span>&nbsp;<span class="keyword" id="3781964">range</span>&nbsp;<span class="ident" id="3781970">cipherSuites</span>&nbsp;<span class="op" id="3781983">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781987">varDefaultCipherSuites</span><span class="op" id="3782009">[</span><span class="ident" id="3782010">i</span><span class="op" id="3782011">]</span>&nbsp;<span class="op" id="3782013">=</span>&nbsp;<span class="ident" id="3782015">suite</span><span class="op" id="3782020">.</span><span class="ident" id="3782021">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782025">}</span><br>
<span class="lineno"></span><span class="op" id="3782027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3782030">func</span>&nbsp;<span class="ident" id="3782035">unexpectedMessageError</span><span class="op" id="3782057">(</span><span class="ident" id="3782058">wanted</span><span class="op" id="3782064">,</span>&nbsp;<span class="ident" id="3782066">got</span>&nbsp;<span class="keyword" id="3782070">interface</span><span class="op" id="3782079">{</span><span class="op" id="3782080">}</span><span class="op" id="3782081">)</span>&nbsp;<span class="builtintype" id="3782083">error</span>&nbsp;<span class="op" id="3782089">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782092">return</span>&nbsp;<span class="ident" id="3782099">fmt</span><span class="op" id="3782102">.</span><span class="ident" id="3782103">Errorf</span><span class="op" id="3782109">(</span><span class="string" id="3782110">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3782185">,</span>&nbsp;<span class="ident" id="3782187">got</span><span class="op" id="3782190">,</span>&nbsp;<span class="ident" id="3782192">wanted</span><span class="op" id="3782198">)</span><br>
<span class="lineno"></span><span class="op" id="3782200">}</span>
</div>
</body>
</html>
