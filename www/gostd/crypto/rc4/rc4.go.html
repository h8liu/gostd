<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4293929">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4293984">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4294038">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4294089">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4294162">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4294187">package</span>&nbsp;<span class="ident" id="4294195">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294200">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4294270">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294310">import</span>&nbsp;<span class="string" id="4294317">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294328">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4294386">type</span>&nbsp;<span class="ident" id="4294391">Cipher</span>&nbsp;<span class="keyword" id="4294398">struct</span>&nbsp;<span class="op" id="4294405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294408">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294413">[</span><span class="num" id="4294414">256</span><span class="op" id="4294417">]</span><span class="builtintype" id="4294418">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294426">i</span><span class="op" id="4294427">,</span>&nbsp;<span class="ident" id="4294429">j</span>&nbsp;<span class="builtintype" id="4294431">uint8</span><br>
<span class="lineno"></span><span class="op" id="4294437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4294440">type</span>&nbsp;<span class="ident" id="4294445">KeySizeError</span>&nbsp;<span class="builtintype" id="4294458">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294463">func</span>&nbsp;<span class="op" id="4294468">(</span><span class="ident" id="4294469">k</span>&nbsp;<span class="ident" id="4294471">KeySizeError</span><span class="op" id="4294483">)</span>&nbsp;<span class="ident" id="4294485">Error</span><span class="op" id="4294490">(</span><span class="op" id="4294491">)</span>&nbsp;<span class="builtintype" id="4294493">string</span>&nbsp;<span class="op" id="4294500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294503">return</span>&nbsp;<span class="string" id="4294510">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4294542">+</span>&nbsp;<span class="ident" id="4294544">strconv</span><span class="op" id="4294551">.</span><span class="ident" id="4294552">Itoa</span><span class="op" id="4294556">(</span><span class="builtintype" id="4294557">int</span><span class="op" id="4294560">(</span><span class="ident" id="4294561">k</span><span class="op" id="4294562">)</span><span class="op" id="4294563">)</span><br>
<span class="lineno"></span><span class="op" id="4294565">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4294568">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4294647">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4294698">func</span>&nbsp;<span class="ident" id="4294703">NewCipher</span><span class="op" id="4294712">(</span><span class="ident" id="4294713">key</span>&nbsp;<span class="op" id="4294717">[</span><span class="op" id="4294718">]</span><span class="builtintype" id="4294719">byte</span><span class="op" id="4294723">)</span>&nbsp;<span class="op" id="4294725">(</span><span class="op" id="4294726">*</span><span class="ident" id="4294727">Cipher</span><span class="op" id="4294733">,</span>&nbsp;<span class="builtintype" id="4294735">error</span><span class="op" id="4294740">)</span>&nbsp;<span class="op" id="4294742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294745">k</span>&nbsp;<span class="op" id="4294747">:=</span>&nbsp;<span class="builtinfunc" id="4294750">len</span><span class="op" id="4294753">(</span><span class="ident" id="4294754">key</span><span class="op" id="4294757">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294760">if</span>&nbsp;<span class="ident" id="4294763">k</span>&nbsp;<span class="op" id="4294765">&lt;</span>&nbsp;<span class="num" id="4294767">1</span>&nbsp;<span class="op" id="4294769">||</span>&nbsp;<span class="ident" id="4294772">k</span>&nbsp;<span class="op" id="4294774">&gt;</span>&nbsp;<span class="num" id="4294776">256</span>&nbsp;<span class="op" id="4294780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294784">return</span>&nbsp;<span class="ident" id="4294791">nil</span><span class="op" id="4294794">,</span>&nbsp;<span class="ident" id="4294796">KeySizeError</span><span class="op" id="4294808">(</span><span class="ident" id="4294809">k</span><span class="op" id="4294810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294816">var</span>&nbsp;<span class="ident" id="4294820">c</span>&nbsp;<span class="ident" id="4294822">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294830">for</span>&nbsp;<span class="ident" id="4294834">i</span>&nbsp;<span class="op" id="4294836">:=</span>&nbsp;<span class="num" id="4294839">0</span><span class="op" id="4294840">;</span>&nbsp;<span class="ident" id="4294842">i</span>&nbsp;<span class="op" id="4294844">&lt;</span>&nbsp;<span class="num" id="4294846">256</span><span class="op" id="4294849">;</span>&nbsp;<span class="ident" id="4294851">i</span><span class="op" id="4294852">++</span>&nbsp;<span class="op" id="4294855">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294859">c</span><span class="op" id="4294860">.</span><span class="ident" id="4294861">s</span><span class="op" id="4294862">[</span><span class="ident" id="4294863">i</span><span class="op" id="4294864">]</span>&nbsp;<span class="op" id="4294866">=</span>&nbsp;<span class="builtintype" id="4294868">uint32</span><span class="op" id="4294874">(</span><span class="ident" id="4294875">i</span><span class="op" id="4294876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294882">var</span>&nbsp;<span class="ident" id="4294886">j</span>&nbsp;<span class="builtintype" id="4294888">uint8</span>&nbsp;<span class="op" id="4294894">=</span>&nbsp;<span class="num" id="4294896">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294899">for</span>&nbsp;<span class="ident" id="4294903">i</span>&nbsp;<span class="op" id="4294905">:=</span>&nbsp;<span class="num" id="4294908">0</span><span class="op" id="4294909">;</span>&nbsp;<span class="ident" id="4294911">i</span>&nbsp;<span class="op" id="4294913">&lt;</span>&nbsp;<span class="num" id="4294915">256</span><span class="op" id="4294918">;</span>&nbsp;<span class="ident" id="4294920">i</span><span class="op" id="4294921">++</span>&nbsp;<span class="op" id="4294924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294928">j</span>&nbsp;<span class="op" id="4294930">+=</span>&nbsp;<span class="builtintype" id="4294933">uint8</span><span class="op" id="4294938">(</span><span class="ident" id="4294939">c</span><span class="op" id="4294940">.</span><span class="ident" id="4294941">s</span><span class="op" id="4294942">[</span><span class="ident" id="4294943">i</span><span class="op" id="4294944">]</span><span class="op" id="4294945">)</span>&nbsp;<span class="op" id="4294947">+</span>&nbsp;<span class="ident" id="4294949">key</span><span class="op" id="4294952">[</span><span class="ident" id="4294953">i</span><span class="op" id="4294954">%</span><span class="ident" id="4294955">k</span><span class="op" id="4294956">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294960">c</span><span class="op" id="4294961">.</span><span class="ident" id="4294962">s</span><span class="op" id="4294963">[</span><span class="ident" id="4294964">i</span><span class="op" id="4294965">]</span><span class="op" id="4294966">,</span>&nbsp;<span class="ident" id="4294968">c</span><span class="op" id="4294969">.</span><span class="ident" id="4294970">s</span><span class="op" id="4294971">[</span><span class="ident" id="4294972">j</span><span class="op" id="4294973">]</span>&nbsp;<span class="op" id="4294975">=</span>&nbsp;<span class="ident" id="4294977">c</span><span class="op" id="4294978">.</span><span class="ident" id="4294979">s</span><span class="op" id="4294980">[</span><span class="ident" id="4294981">j</span><span class="op" id="4294982">]</span><span class="op" id="4294983">,</span>&nbsp;<span class="ident" id="4294985">c</span><span class="op" id="4294986">.</span><span class="ident" id="4294987">s</span><span class="op" id="4294988">[</span><span class="ident" id="4294989">i</span><span class="op" id="4294990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294996">return</span>&nbsp;<span class="op" id="4295003">&amp;</span><span class="ident" id="4295004">c</span><span class="op" id="4295005">,</span>&nbsp;<span class="ident" id="4295007">nil</span><br>
<span class="lineno"></span><span class="op" id="4295011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4295014">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4295082">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4295103">func</span>&nbsp;<span class="op" id="4295108">(</span><span class="ident" id="4295109">c</span>&nbsp;<span class="op" id="4295111">*</span><span class="ident" id="4295112">Cipher</span><span class="op" id="4295118">)</span>&nbsp;<span class="ident" id="4295120">Reset</span><span class="op" id="4295125">(</span><span class="op" id="4295126">)</span>&nbsp;<span class="op" id="4295128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295131">for</span>&nbsp;<span class="ident" id="4295135">i</span>&nbsp;<span class="op" id="4295137">:=</span>&nbsp;<span class="keyword" id="4295140">range</span>&nbsp;<span class="ident" id="4295146">c</span><span class="op" id="4295147">.</span><span class="ident" id="4295148">s</span>&nbsp;<span class="op" id="4295150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295154">c</span><span class="op" id="4295155">.</span><span class="ident" id="4295156">s</span><span class="op" id="4295157">[</span><span class="ident" id="4295158">i</span><span class="op" id="4295159">]</span>&nbsp;<span class="op" id="4295161">=</span>&nbsp;<span class="num" id="4295163">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295169">c</span><span class="op" id="4295170">.</span><span class="ident" id="4295171">i</span><span class="op" id="4295172">,</span>&nbsp;<span class="ident" id="4295174">c</span><span class="op" id="4295175">.</span><span class="ident" id="4295176">j</span>&nbsp;<span class="op" id="4295178">=</span>&nbsp;<span class="num" id="4295180">0</span><span class="op" id="4295181">,</span>&nbsp;<span class="num" id="4295183">0</span><br>
<span class="lineno"></span><span class="op" id="4295185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295188">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4295257">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4295328">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4295344">//</span><br>
<span class="lineno"></span><span class="comment" id="4295347">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4295417">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4295483">func</span>&nbsp;<span class="op" id="4295488">(</span><span class="ident" id="4295489">c</span>&nbsp;<span class="op" id="4295491">*</span><span class="ident" id="4295492">Cipher</span><span class="op" id="4295498">)</span>&nbsp;<span class="ident" id="4295500">xorKeyStreamGeneric</span><span class="op" id="4295519">(</span><span class="ident" id="4295520">dst</span><span class="op" id="4295523">,</span>&nbsp;<span class="ident" id="4295525">src</span>&nbsp;<span class="op" id="4295529">[</span><span class="op" id="4295530">]</span><span class="builtintype" id="4295531">byte</span><span class="op" id="4295535">)</span>&nbsp;<span class="op" id="4295537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295540">i</span><span class="op" id="4295541">,</span>&nbsp;<span class="ident" id="4295543">j</span>&nbsp;<span class="op" id="4295545">:=</span>&nbsp;<span class="ident" id="4295548">c</span><span class="op" id="4295549">.</span><span class="ident" id="4295550">i</span><span class="op" id="4295551">,</span>&nbsp;<span class="ident" id="4295553">c</span><span class="op" id="4295554">.</span><span class="ident" id="4295555">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295558">for</span>&nbsp;<span class="ident" id="4295562">k</span><span class="op" id="4295563">,</span>&nbsp;<span class="ident" id="4295565">v</span>&nbsp;<span class="op" id="4295567">:=</span>&nbsp;<span class="keyword" id="4295570">range</span>&nbsp;<span class="ident" id="4295576">src</span>&nbsp;<span class="op" id="4295580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295584">i</span>&nbsp;<span class="op" id="4295586">+=</span>&nbsp;<span class="num" id="4295589">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295593">j</span>&nbsp;<span class="op" id="4295595">+=</span>&nbsp;<span class="builtintype" id="4295598">uint8</span><span class="op" id="4295603">(</span><span class="ident" id="4295604">c</span><span class="op" id="4295605">.</span><span class="ident" id="4295606">s</span><span class="op" id="4295607">[</span><span class="ident" id="4295608">i</span><span class="op" id="4295609">]</span><span class="op" id="4295610">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295614">c</span><span class="op" id="4295615">.</span><span class="ident" id="4295616">s</span><span class="op" id="4295617">[</span><span class="ident" id="4295618">i</span><span class="op" id="4295619">]</span><span class="op" id="4295620">,</span>&nbsp;<span class="ident" id="4295622">c</span><span class="op" id="4295623">.</span><span class="ident" id="4295624">s</span><span class="op" id="4295625">[</span><span class="ident" id="4295626">j</span><span class="op" id="4295627">]</span>&nbsp;<span class="op" id="4295629">=</span>&nbsp;<span class="ident" id="4295631">c</span><span class="op" id="4295632">.</span><span class="ident" id="4295633">s</span><span class="op" id="4295634">[</span><span class="ident" id="4295635">j</span><span class="op" id="4295636">]</span><span class="op" id="4295637">,</span>&nbsp;<span class="ident" id="4295639">c</span><span class="op" id="4295640">.</span><span class="ident" id="4295641">s</span><span class="op" id="4295642">[</span><span class="ident" id="4295643">i</span><span class="op" id="4295644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295648">dst</span><span class="op" id="4295651">[</span><span class="ident" id="4295652">k</span><span class="op" id="4295653">]</span>&nbsp;<span class="op" id="4295655">=</span>&nbsp;<span class="ident" id="4295657">v</span>&nbsp;<span class="op" id="4295659">^</span>&nbsp;<span class="builtintype" id="4295661">uint8</span><span class="op" id="4295666">(</span><span class="ident" id="4295667">c</span><span class="op" id="4295668">.</span><span class="ident" id="4295669">s</span><span class="op" id="4295670">[</span><span class="builtintype" id="4295671">uint8</span><span class="op" id="4295676">(</span><span class="ident" id="4295677">c</span><span class="op" id="4295678">.</span><span class="ident" id="4295679">s</span><span class="op" id="4295680">[</span><span class="ident" id="4295681">i</span><span class="op" id="4295682">]</span><span class="op" id="4295683">+</span><span class="ident" id="4295684">c</span><span class="op" id="4295685">.</span><span class="ident" id="4295686">s</span><span class="op" id="4295687">[</span><span class="ident" id="4295688">j</span><span class="op" id="4295689">]</span><span class="op" id="4295690">)</span><span class="op" id="4295691">]</span><span class="op" id="4295692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295698">c</span><span class="op" id="4295699">.</span><span class="ident" id="4295700">i</span><span class="op" id="4295701">,</span>&nbsp;<span class="ident" id="4295703">c</span><span class="op" id="4295704">.</span><span class="ident" id="4295705">j</span>&nbsp;<span class="op" id="4295707">=</span>&nbsp;<span class="ident" id="4295709">i</span><span class="op" id="4295710">,</span>&nbsp;<span class="ident" id="4295712">j</span><br>
<span class="lineno"></span><span class="op" id="4295714">}</span>
</div>
</body>
</html>
