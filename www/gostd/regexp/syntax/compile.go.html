<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5285572">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5285627">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5285681">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5285732">package</span>&nbsp;<span class="ident" id="5285740">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5285748">import</span>&nbsp;<span class="string" id="5285755">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5285766">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5285852">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5285931">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5286002">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5286068">//</span><br>
<span class="lineno"></span><span class="comment" id="5286071">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5286149">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5286210">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5286257">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5286327">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5286404">type</span>&nbsp;<span class="ident" id="5286409">patchList</span>&nbsp;<span class="builtintype" id="5286419">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5286427">func</span>&nbsp;<span class="op" id="5286432">(</span><span class="ident" id="5286433">l</span>&nbsp;<span class="ident" id="5286435">patchList</span><span class="op" id="5286444">)</span>&nbsp;<span class="ident" id="5286446">next</span><span class="op" id="5286450">(</span><span class="ident" id="5286451">p</span>&nbsp;<span class="op" id="5286453">*</span><span class="ident" id="5286454">Prog</span><span class="op" id="5286458">)</span>&nbsp;<span class="ident" id="5286460">patchList</span>&nbsp;<span class="op" id="5286470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286473">i</span>&nbsp;<span class="op" id="5286475">:=</span>&nbsp;<span class="op" id="5286478">&amp;</span><span class="ident" id="5286479">p</span><span class="op" id="5286480">.</span><span class="ident" id="5286481">Inst</span><span class="op" id="5286485">[</span><span class="ident" id="5286486">l</span><span class="op" id="5286487">&gt;&gt;</span><span class="num" id="5286489">1</span><span class="op" id="5286490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286493">if</span>&nbsp;<span class="ident" id="5286496">l</span><span class="op" id="5286497">&amp;</span><span class="num" id="5286498">1</span>&nbsp;<span class="op" id="5286500">==</span>&nbsp;<span class="num" id="5286503">0</span>&nbsp;<span class="op" id="5286505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286509">return</span>&nbsp;<span class="ident" id="5286516">patchList</span><span class="op" id="5286525">(</span><span class="ident" id="5286526">i</span><span class="op" id="5286527">.</span><span class="ident" id="5286528">Out</span><span class="op" id="5286531">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286537">return</span>&nbsp;<span class="ident" id="5286544">patchList</span><span class="op" id="5286553">(</span><span class="ident" id="5286554">i</span><span class="op" id="5286555">.</span><span class="ident" id="5286556">Arg</span><span class="op" id="5286559">)</span><br>
<span class="lineno"></span><span class="op" id="5286561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5286564">func</span>&nbsp;<span class="op" id="5286569">(</span><span class="ident" id="5286570">l</span>&nbsp;<span class="ident" id="5286572">patchList</span><span class="op" id="5286581">)</span>&nbsp;<span class="ident" id="5286583">patch</span><span class="op" id="5286588">(</span><span class="ident" id="5286589">p</span>&nbsp;<span class="op" id="5286591">*</span><span class="ident" id="5286592">Prog</span><span class="op" id="5286596">,</span>&nbsp;<span class="ident" id="5286598">val</span>&nbsp;<span class="builtintype" id="5286602">uint32</span><span class="op" id="5286608">)</span>&nbsp;<span class="op" id="5286610">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286613">for</span>&nbsp;<span class="ident" id="5286617">l</span>&nbsp;<span class="op" id="5286619">!=</span>&nbsp;<span class="num" id="5286622">0</span>&nbsp;<span class="op" id="5286624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286628">i</span>&nbsp;<span class="op" id="5286630">:=</span>&nbsp;<span class="op" id="5286633">&amp;</span><span class="ident" id="5286634">p</span><span class="op" id="5286635">.</span><span class="ident" id="5286636">Inst</span><span class="op" id="5286640">[</span><span class="ident" id="5286641">l</span><span class="op" id="5286642">&gt;&gt;</span><span class="num" id="5286644">1</span><span class="op" id="5286645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286649">if</span>&nbsp;<span class="ident" id="5286652">l</span><span class="op" id="5286653">&amp;</span><span class="num" id="5286654">1</span>&nbsp;<span class="op" id="5286656">==</span>&nbsp;<span class="num" id="5286659">0</span>&nbsp;<span class="op" id="5286661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286666">l</span>&nbsp;<span class="op" id="5286668">=</span>&nbsp;<span class="ident" id="5286670">patchList</span><span class="op" id="5286679">(</span><span class="ident" id="5286680">i</span><span class="op" id="5286681">.</span><span class="ident" id="5286682">Out</span><span class="op" id="5286685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286690">i</span><span class="op" id="5286691">.</span><span class="ident" id="5286692">Out</span>&nbsp;<span class="op" id="5286696">=</span>&nbsp;<span class="ident" id="5286698">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286704">}</span>&nbsp;<span class="keyword" id="5286706">else</span>&nbsp;<span class="op" id="5286711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286716">l</span>&nbsp;<span class="op" id="5286718">=</span>&nbsp;<span class="ident" id="5286720">patchList</span><span class="op" id="5286729">(</span><span class="ident" id="5286730">i</span><span class="op" id="5286731">.</span><span class="ident" id="5286732">Arg</span><span class="op" id="5286735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286740">i</span><span class="op" id="5286741">.</span><span class="ident" id="5286742">Arg</span>&nbsp;<span class="op" id="5286746">=</span>&nbsp;<span class="ident" id="5286748">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286757">}</span><br>
<span class="lineno">40</span><span class="op" id="5286759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5286762">func</span>&nbsp;<span class="op" id="5286767">(</span><span class="ident" id="5286768">l1</span>&nbsp;<span class="ident" id="5286771">patchList</span><span class="op" id="5286780">)</span>&nbsp;<span class="builtinfunc" id="5286782">append</span><span class="op" id="5286788">(</span><span class="ident" id="5286789">p</span>&nbsp;<span class="op" id="5286791">*</span><span class="ident" id="5286792">Prog</span><span class="op" id="5286796">,</span>&nbsp;<span class="ident" id="5286798">l2</span>&nbsp;<span class="ident" id="5286801">patchList</span><span class="op" id="5286810">)</span>&nbsp;<span class="ident" id="5286812">patchList</span>&nbsp;<span class="op" id="5286822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286825">if</span>&nbsp;<span class="ident" id="5286828">l1</span>&nbsp;<span class="op" id="5286831">==</span>&nbsp;<span class="num" id="5286834">0</span>&nbsp;<span class="op" id="5286836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286840">return</span>&nbsp;<span class="ident" id="5286847">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286854">if</span>&nbsp;<span class="ident" id="5286857">l2</span>&nbsp;<span class="op" id="5286860">==</span>&nbsp;<span class="num" id="5286863">0</span>&nbsp;<span class="op" id="5286865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286869">return</span>&nbsp;<span class="ident" id="5286876">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286884">last</span>&nbsp;<span class="op" id="5286889">:=</span>&nbsp;<span class="ident" id="5286892">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286896">for</span>&nbsp;<span class="op" id="5286900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286904">next</span>&nbsp;<span class="op" id="5286909">:=</span>&nbsp;<span class="ident" id="5286912">last</span><span class="op" id="5286916">.</span><span class="ident" id="5286917">next</span><span class="op" id="5286921">(</span><span class="ident" id="5286922">p</span><span class="op" id="5286923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286927">if</span>&nbsp;<span class="ident" id="5286930">next</span>&nbsp;<span class="op" id="5286935">==</span>&nbsp;<span class="num" id="5286938">0</span>&nbsp;<span class="op" id="5286940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286945">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286957">last</span>&nbsp;<span class="op" id="5286962">=</span>&nbsp;<span class="ident" id="5286964">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5286970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5286974">i</span>&nbsp;<span class="op" id="5286976">:=</span>&nbsp;<span class="op" id="5286979">&amp;</span><span class="ident" id="5286980">p</span><span class="op" id="5286981">.</span><span class="ident" id="5286982">Inst</span><span class="op" id="5286986">[</span><span class="ident" id="5286987">last</span><span class="op" id="5286991">&gt;&gt;</span><span class="num" id="5286993">1</span><span class="op" id="5286994">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5286997">if</span>&nbsp;<span class="ident" id="5287000">last</span><span class="op" id="5287004">&amp;</span><span class="num" id="5287005">1</span>&nbsp;<span class="op" id="5287007">==</span>&nbsp;<span class="num" id="5287010">0</span>&nbsp;<span class="op" id="5287012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287016">i</span><span class="op" id="5287017">.</span><span class="ident" id="5287018">Out</span>&nbsp;<span class="op" id="5287022">=</span>&nbsp;<span class="builtintype" id="5287024">uint32</span><span class="op" id="5287030">(</span><span class="ident" id="5287031">l2</span><span class="op" id="5287033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5287036">}</span>&nbsp;<span class="keyword" id="5287038">else</span>&nbsp;<span class="op" id="5287043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287047">i</span><span class="op" id="5287048">.</span><span class="ident" id="5287049">Arg</span>&nbsp;<span class="op" id="5287053">=</span>&nbsp;<span class="builtintype" id="5287055">uint32</span><span class="op" id="5287061">(</span><span class="ident" id="5287062">l2</span><span class="op" id="5287064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5287067">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287070">return</span>&nbsp;<span class="ident" id="5287077">l1</span><br>
<span class="lineno"></span><span class="op" id="5287080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5287083">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5287133">type</span>&nbsp;<span class="ident" id="5287138">frag</span>&nbsp;<span class="keyword" id="5287143">struct</span>&nbsp;<span class="op" id="5287150">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287153">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5287157">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5287167">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287198">out</span>&nbsp;<span class="ident" id="5287202">patchList</span>&nbsp;<span class="comment" id="5287212">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5287247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287250">type</span>&nbsp;<span class="ident" id="5287255">compiler</span>&nbsp;<span class="keyword" id="5287264">struct</span>&nbsp;<span class="op" id="5287271">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287274">p</span>&nbsp;<span class="op" id="5287276">*</span><span class="ident" id="5287277">Prog</span><br>
<span class="lineno"></span><span class="op" id="5287282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5287285">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5287347">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5287426">func</span>&nbsp;<span class="ident" id="5287431">Compile</span><span class="op" id="5287438">(</span><span class="ident" id="5287439">re</span>&nbsp;<span class="op" id="5287442">*</span><span class="ident" id="5287443">Regexp</span><span class="op" id="5287449">)</span>&nbsp;<span class="op" id="5287451">(</span><span class="op" id="5287452">*</span><span class="ident" id="5287453">Prog</span><span class="op" id="5287457">,</span>&nbsp;<span class="builtintype" id="5287459">error</span><span class="op" id="5287464">)</span>&nbsp;<span class="op" id="5287466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287469">var</span>&nbsp;<span class="ident" id="5287473">c</span>&nbsp;<span class="ident" id="5287475">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287485">c</span><span class="op" id="5287486">.</span><span class="ident" id="5287487">init</span><span class="op" id="5287491">(</span><span class="op" id="5287492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287495">f</span>&nbsp;<span class="op" id="5287497">:=</span>&nbsp;<span class="ident" id="5287500">c</span><span class="op" id="5287501">.</span><span class="ident" id="5287502">compile</span><span class="op" id="5287509">(</span><span class="ident" id="5287510">re</span><span class="op" id="5287512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287515">f</span><span class="op" id="5287516">.</span><span class="ident" id="5287517">out</span><span class="op" id="5287520">.</span><span class="ident" id="5287521">patch</span><span class="op" id="5287526">(</span><span class="ident" id="5287527">c</span><span class="op" id="5287528">.</span><span class="ident" id="5287529">p</span><span class="op" id="5287530">,</span>&nbsp;<span class="ident" id="5287532">c</span><span class="op" id="5287533">.</span><span class="ident" id="5287534">inst</span><span class="op" id="5287538">(</span><span class="ident" id="5287539">InstMatch</span><span class="op" id="5287548">)</span><span class="op" id="5287549">.</span><span class="ident" id="5287550">i</span><span class="op" id="5287551">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287554">c</span><span class="op" id="5287555">.</span><span class="ident" id="5287556">p</span><span class="op" id="5287557">.</span><span class="ident" id="5287558">Start</span>&nbsp;<span class="op" id="5287564">=</span>&nbsp;<span class="builtintype" id="5287566">int</span><span class="op" id="5287569">(</span><span class="ident" id="5287570">f</span><span class="op" id="5287571">.</span><span class="ident" id="5287572">i</span><span class="op" id="5287573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287576">return</span>&nbsp;<span class="ident" id="5287583">c</span><span class="op" id="5287584">.</span><span class="ident" id="5287585">p</span><span class="op" id="5287586">,</span>&nbsp;<span class="ident" id="5287588">nil</span><br>
<span class="lineno"></span><span class="op" id="5287592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287595">func</span>&nbsp;<span class="op" id="5287600">(</span><span class="ident" id="5287601">c</span>&nbsp;<span class="op" id="5287603">*</span><span class="ident" id="5287604">compiler</span><span class="op" id="5287612">)</span>&nbsp;<span class="ident" id="5287614">init</span><span class="op" id="5287618">(</span><span class="op" id="5287619">)</span>&nbsp;<span class="op" id="5287621">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287624">c</span><span class="op" id="5287625">.</span><span class="ident" id="5287626">p</span>&nbsp;<span class="op" id="5287628">=</span>&nbsp;<span class="builtinfunc" id="5287630">new</span><span class="op" id="5287633">(</span><span class="ident" id="5287634">Prog</span><span class="op" id="5287638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287641">c</span><span class="op" id="5287642">.</span><span class="ident" id="5287643">p</span><span class="op" id="5287644">.</span><span class="ident" id="5287645">NumCap</span>&nbsp;<span class="op" id="5287652">=</span>&nbsp;<span class="num" id="5287654">2</span>&nbsp;<span class="comment" id="5287656">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5287696">c</span><span class="op" id="5287697">.</span><span class="ident" id="5287698">inst</span><span class="op" id="5287702">(</span><span class="ident" id="5287703">InstFail</span><span class="op" id="5287711">)</span><br>
<span class="lineno"></span><span class="op" id="5287713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5287716">var</span>&nbsp;<span class="ident" id="5287720">anyRuneNotNL</span>&nbsp;<span class="op" id="5287733">=</span>&nbsp;<span class="op" id="5287735">[</span><span class="op" id="5287736">]</span><span class="builtintype" id="5287737">rune</span><span class="op" id="5287741">{</span><span class="num" id="5287742">0</span><span class="op" id="5287743">,</span>&nbsp;<span class="string" id="5287745">&#39;\n&#39;</span>&nbsp;<span class="op" id="5287750">-</span>&nbsp;<span class="num" id="5287752">1</span><span class="op" id="5287753">,</span>&nbsp;<span class="string" id="5287755">&#39;\n&#39;</span>&nbsp;<span class="op" id="5287760">+</span>&nbsp;<span class="num" id="5287762">1</span><span class="op" id="5287763">,</span>&nbsp;<span class="ident" id="5287765">unicode</span><span class="op" id="5287772">.</span><span class="ident" id="5287773">MaxRune</span><span class="op" id="5287780">}</span><br>
<span class="lineno"></span><span class="keyword" id="5287782">var</span>&nbsp;<span class="ident" id="5287786">anyRune</span>&nbsp;<span class="op" id="5287794">=</span>&nbsp;<span class="op" id="5287796">[</span><span class="op" id="5287797">]</span><span class="builtintype" id="5287798">rune</span><span class="op" id="5287802">{</span><span class="num" id="5287803">0</span><span class="op" id="5287804">,</span>&nbsp;<span class="ident" id="5287806">unicode</span><span class="op" id="5287813">.</span><span class="ident" id="5287814">MaxRune</span><span class="op" id="5287821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5287824">func</span>&nbsp;<span class="op" id="5287829">(</span><span class="ident" id="5287830">c</span>&nbsp;<span class="op" id="5287832">*</span><span class="ident" id="5287833">compiler</span><span class="op" id="5287841">)</span>&nbsp;<span class="ident" id="5287843">compile</span><span class="op" id="5287850">(</span><span class="ident" id="5287851">re</span>&nbsp;<span class="op" id="5287854">*</span><span class="ident" id="5287855">Regexp</span><span class="op" id="5287861">)</span>&nbsp;<span class="ident" id="5287863">frag</span>&nbsp;<span class="op" id="5287868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287871">switch</span>&nbsp;<span class="ident" id="5287878">re</span><span class="op" id="5287880">.</span><span class="ident" id="5287881">Op</span>&nbsp;<span class="op" id="5287884">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287887">case</span>&nbsp;<span class="ident" id="5287892">OpNoMatch</span><span class="op" id="5287901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287905">return</span>&nbsp;<span class="ident" id="5287912">c</span><span class="op" id="5287913">.</span><span class="ident" id="5287914">fail</span><span class="op" id="5287918">(</span><span class="op" id="5287919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287922">case</span>&nbsp;<span class="ident" id="5287927">OpEmptyMatch</span><span class="op" id="5287939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287943">return</span>&nbsp;<span class="ident" id="5287950">c</span><span class="op" id="5287951">.</span><span class="ident" id="5287952">nop</span><span class="op" id="5287955">(</span><span class="op" id="5287956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287959">case</span>&nbsp;<span class="ident" id="5287964">OpLiteral</span><span class="op" id="5287973">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5287977">if</span>&nbsp;<span class="builtinfunc" id="5287980">len</span><span class="op" id="5287983">(</span><span class="ident" id="5287984">re</span><span class="op" id="5287986">.</span><span class="ident" id="5287987">Rune</span><span class="op" id="5287991">)</span>&nbsp;<span class="op" id="5287993">==</span>&nbsp;<span class="num" id="5287996">0</span>&nbsp;<span class="op" id="5287998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288003">return</span>&nbsp;<span class="ident" id="5288010">c</span><span class="op" id="5288011">.</span><span class="ident" id="5288012">nop</span><span class="op" id="5288015">(</span><span class="op" id="5288016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288024">var</span>&nbsp;<span class="ident" id="5288028">f</span>&nbsp;<span class="ident" id="5288030">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288037">for</span>&nbsp;<span class="ident" id="5288041">j</span>&nbsp;<span class="op" id="5288043">:=</span>&nbsp;<span class="keyword" id="5288046">range</span>&nbsp;<span class="ident" id="5288052">re</span><span class="op" id="5288054">.</span><span class="ident" id="5288055">Rune</span>&nbsp;<span class="op" id="5288060">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288065">f1</span>&nbsp;<span class="op" id="5288068">:=</span>&nbsp;<span class="ident" id="5288071">c</span><span class="op" id="5288072">.</span><span class="builtintype" id="5288073">rune</span><span class="op" id="5288077">(</span><span class="ident" id="5288078">re</span><span class="op" id="5288080">.</span><span class="ident" id="5288081">Rune</span><span class="op" id="5288085">[</span><span class="ident" id="5288086">j</span><span class="op" id="5288087">:</span><span class="ident" id="5288088">j</span><span class="op" id="5288089">+</span><span class="num" id="5288090">1</span><span class="op" id="5288091">]</span><span class="op" id="5288092">,</span>&nbsp;<span class="ident" id="5288094">re</span><span class="op" id="5288096">.</span><span class="ident" id="5288097">Flags</span><span class="op" id="5288102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288107">if</span>&nbsp;<span class="ident" id="5288110">j</span>&nbsp;<span class="op" id="5288112">==</span>&nbsp;<span class="num" id="5288115">0</span>&nbsp;<span class="op" id="5288117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288123">f</span>&nbsp;<span class="op" id="5288125">=</span>&nbsp;<span class="ident" id="5288127">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288133">}</span>&nbsp;<span class="keyword" id="5288135">else</span>&nbsp;<span class="op" id="5288140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288146">f</span>&nbsp;<span class="op" id="5288148">=</span>&nbsp;<span class="ident" id="5288150">c</span><span class="op" id="5288151">.</span><span class="ident" id="5288152">cat</span><span class="op" id="5288155">(</span><span class="ident" id="5288156">f</span><span class="op" id="5288157">,</span>&nbsp;<span class="ident" id="5288159">f1</span><span class="op" id="5288161">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5288170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288174">return</span>&nbsp;<span class="ident" id="5288181">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288184">case</span>&nbsp;<span class="ident" id="5288189">OpCharClass</span><span class="op" id="5288200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288204">return</span>&nbsp;<span class="ident" id="5288211">c</span><span class="op" id="5288212">.</span><span class="builtintype" id="5288213">rune</span><span class="op" id="5288217">(</span><span class="ident" id="5288218">re</span><span class="op" id="5288220">.</span><span class="ident" id="5288221">Rune</span><span class="op" id="5288225">,</span>&nbsp;<span class="ident" id="5288227">re</span><span class="op" id="5288229">.</span><span class="ident" id="5288230">Flags</span><span class="op" id="5288235">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288238">case</span>&nbsp;<span class="ident" id="5288243">OpAnyCharNotNL</span><span class="op" id="5288257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288261">return</span>&nbsp;<span class="ident" id="5288268">c</span><span class="op" id="5288269">.</span><span class="builtintype" id="5288270">rune</span><span class="op" id="5288274">(</span><span class="ident" id="5288275">anyRuneNotNL</span><span class="op" id="5288287">,</span>&nbsp;<span class="num" id="5288289">0</span><span class="op" id="5288290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288293">case</span>&nbsp;<span class="ident" id="5288298">OpAnyChar</span><span class="op" id="5288307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288311">return</span>&nbsp;<span class="ident" id="5288318">c</span><span class="op" id="5288319">.</span><span class="builtintype" id="5288320">rune</span><span class="op" id="5288324">(</span><span class="ident" id="5288325">anyRune</span><span class="op" id="5288332">,</span>&nbsp;<span class="num" id="5288334">0</span><span class="op" id="5288335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288338">case</span>&nbsp;<span class="ident" id="5288343">OpBeginLine</span><span class="op" id="5288354">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288358">return</span>&nbsp;<span class="ident" id="5288365">c</span><span class="op" id="5288366">.</span><span class="ident" id="5288367">empty</span><span class="op" id="5288372">(</span><span class="ident" id="5288373">EmptyBeginLine</span><span class="op" id="5288387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288390">case</span>&nbsp;<span class="ident" id="5288395">OpEndLine</span><span class="op" id="5288404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288408">return</span>&nbsp;<span class="ident" id="5288415">c</span><span class="op" id="5288416">.</span><span class="ident" id="5288417">empty</span><span class="op" id="5288422">(</span><span class="ident" id="5288423">EmptyEndLine</span><span class="op" id="5288435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288438">case</span>&nbsp;<span class="ident" id="5288443">OpBeginText</span><span class="op" id="5288454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288458">return</span>&nbsp;<span class="ident" id="5288465">c</span><span class="op" id="5288466">.</span><span class="ident" id="5288467">empty</span><span class="op" id="5288472">(</span><span class="ident" id="5288473">EmptyBeginText</span><span class="op" id="5288487">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288490">case</span>&nbsp;<span class="ident" id="5288495">OpEndText</span><span class="op" id="5288504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288508">return</span>&nbsp;<span class="ident" id="5288515">c</span><span class="op" id="5288516">.</span><span class="ident" id="5288517">empty</span><span class="op" id="5288522">(</span><span class="ident" id="5288523">EmptyEndText</span><span class="op" id="5288535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288538">case</span>&nbsp;<span class="ident" id="5288543">OpWordBoundary</span><span class="op" id="5288557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288561">return</span>&nbsp;<span class="ident" id="5288568">c</span><span class="op" id="5288569">.</span><span class="ident" id="5288570">empty</span><span class="op" id="5288575">(</span><span class="ident" id="5288576">EmptyWordBoundary</span><span class="op" id="5288593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288596">case</span>&nbsp;<span class="ident" id="5288601">OpNoWordBoundary</span><span class="op" id="5288617">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288621">return</span>&nbsp;<span class="ident" id="5288628">c</span><span class="op" id="5288629">.</span><span class="ident" id="5288630">empty</span><span class="op" id="5288635">(</span><span class="ident" id="5288636">EmptyNoWordBoundary</span><span class="op" id="5288655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288658">case</span>&nbsp;<span class="ident" id="5288663">OpCapture</span><span class="op" id="5288672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288676">bra</span>&nbsp;<span class="op" id="5288680">:=</span>&nbsp;<span class="ident" id="5288683">c</span><span class="op" id="5288684">.</span><span class="builtinfunc" id="5288685">cap</span><span class="op" id="5288688">(</span><span class="builtintype" id="5288689">uint32</span><span class="op" id="5288695">(</span><span class="ident" id="5288696">re</span><span class="op" id="5288698">.</span><span class="ident" id="5288699">Cap</span>&nbsp;<span class="op" id="5288703">&lt;&lt;</span>&nbsp;<span class="num" id="5288706">1</span><span class="op" id="5288707">)</span><span class="op" id="5288708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288712">sub</span>&nbsp;<span class="op" id="5288716">:=</span>&nbsp;<span class="ident" id="5288719">c</span><span class="op" id="5288720">.</span><span class="ident" id="5288721">compile</span><span class="op" id="5288728">(</span><span class="ident" id="5288729">re</span><span class="op" id="5288731">.</span><span class="ident" id="5288732">Sub</span><span class="op" id="5288735">[</span><span class="num" id="5288736">0</span><span class="op" id="5288737">]</span><span class="op" id="5288738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5288742">ket</span>&nbsp;<span class="op" id="5288746">:=</span>&nbsp;<span class="ident" id="5288749">c</span><span class="op" id="5288750">.</span><span class="builtinfunc" id="5288751">cap</span><span class="op" id="5288754">(</span><span class="builtintype" id="5288755">uint32</span><span class="op" id="5288761">(</span><span class="ident" id="5288762">re</span><span class="op" id="5288764">.</span><span class="ident" id="5288765">Cap</span><span class="op" id="5288768">&lt;&lt;</span><span class="num" id="5288770">1</span>&nbsp;<span class="op" id="5288772">|</span>&nbsp;<span class="num" id="5288774">1</span><span class="op" id="5288775">)</span><span class="op" id="5288776">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288780">return</span>&nbsp;<span class="ident" id="5288787">c</span><span class="op" id="5288788">.</span><span class="ident" id="5288789">cat</span><span class="op" id="5288792">(</span><span class="ident" id="5288793">c</span><span class="op" id="5288794">.</span><span class="ident" id="5288795">cat</span><span class="op" id="5288798">(</span><span class="ident" id="5288799">bra</span><span class="op" id="5288802">,</span>&nbsp;<span class="ident" id="5288804">sub</span><span class="op" id="5288807">)</span><span class="op" id="5288808">,</span>&nbsp;<span class="ident" id="5288810">ket</span><span class="op" id="5288813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288816">case</span>&nbsp;<span class="ident" id="5288821">OpStar</span><span class="op" id="5288827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288831">return</span>&nbsp;<span class="ident" id="5288838">c</span><span class="op" id="5288839">.</span><span class="ident" id="5288840">star</span><span class="op" id="5288844">(</span><span class="ident" id="5288845">c</span><span class="op" id="5288846">.</span><span class="ident" id="5288847">compile</span><span class="op" id="5288854">(</span><span class="ident" id="5288855">re</span><span class="op" id="5288857">.</span><span class="ident" id="5288858">Sub</span><span class="op" id="5288861">[</span><span class="num" id="5288862">0</span><span class="op" id="5288863">]</span><span class="op" id="5288864">)</span><span class="op" id="5288865">,</span>&nbsp;<span class="ident" id="5288867">re</span><span class="op" id="5288869">.</span><span class="ident" id="5288870">Flags</span><span class="op" id="5288875">&amp;</span><span class="ident" id="5288876">NonGreedy</span>&nbsp;<span class="op" id="5288886">!=</span>&nbsp;<span class="num" id="5288889">0</span><span class="op" id="5288890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288893">case</span>&nbsp;<span class="ident" id="5288898">OpPlus</span><span class="op" id="5288904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288908">return</span>&nbsp;<span class="ident" id="5288915">c</span><span class="op" id="5288916">.</span><span class="ident" id="5288917">plus</span><span class="op" id="5288921">(</span><span class="ident" id="5288922">c</span><span class="op" id="5288923">.</span><span class="ident" id="5288924">compile</span><span class="op" id="5288931">(</span><span class="ident" id="5288932">re</span><span class="op" id="5288934">.</span><span class="ident" id="5288935">Sub</span><span class="op" id="5288938">[</span><span class="num" id="5288939">0</span><span class="op" id="5288940">]</span><span class="op" id="5288941">)</span><span class="op" id="5288942">,</span>&nbsp;<span class="ident" id="5288944">re</span><span class="op" id="5288946">.</span><span class="ident" id="5288947">Flags</span><span class="op" id="5288952">&amp;</span><span class="ident" id="5288953">NonGreedy</span>&nbsp;<span class="op" id="5288963">!=</span>&nbsp;<span class="num" id="5288966">0</span><span class="op" id="5288967">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288970">case</span>&nbsp;<span class="ident" id="5288975">OpQuest</span><span class="op" id="5288982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5288986">return</span>&nbsp;<span class="ident" id="5288993">c</span><span class="op" id="5288994">.</span><span class="ident" id="5288995">quest</span><span class="op" id="5289000">(</span><span class="ident" id="5289001">c</span><span class="op" id="5289002">.</span><span class="ident" id="5289003">compile</span><span class="op" id="5289010">(</span><span class="ident" id="5289011">re</span><span class="op" id="5289013">.</span><span class="ident" id="5289014">Sub</span><span class="op" id="5289017">[</span><span class="num" id="5289018">0</span><span class="op" id="5289019">]</span><span class="op" id="5289020">)</span><span class="op" id="5289021">,</span>&nbsp;<span class="ident" id="5289023">re</span><span class="op" id="5289025">.</span><span class="ident" id="5289026">Flags</span><span class="op" id="5289031">&amp;</span><span class="ident" id="5289032">NonGreedy</span>&nbsp;<span class="op" id="5289042">!=</span>&nbsp;<span class="num" id="5289045">0</span><span class="op" id="5289046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289049">case</span>&nbsp;<span class="ident" id="5289054">OpConcat</span><span class="op" id="5289062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289066">if</span>&nbsp;<span class="builtinfunc" id="5289069">len</span><span class="op" id="5289072">(</span><span class="ident" id="5289073">re</span><span class="op" id="5289075">.</span><span class="ident" id="5289076">Sub</span><span class="op" id="5289079">)</span>&nbsp;<span class="op" id="5289081">==</span>&nbsp;<span class="num" id="5289084">0</span>&nbsp;<span class="op" id="5289086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289091">return</span>&nbsp;<span class="ident" id="5289098">c</span><span class="op" id="5289099">.</span><span class="ident" id="5289100">nop</span><span class="op" id="5289103">(</span><span class="op" id="5289104">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289112">var</span>&nbsp;<span class="ident" id="5289116">f</span>&nbsp;<span class="ident" id="5289118">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289125">for</span>&nbsp;<span class="ident" id="5289129">i</span><span class="op" id="5289130">,</span>&nbsp;<span class="ident" id="5289132">sub</span>&nbsp;<span class="op" id="5289136">:=</span>&nbsp;<span class="keyword" id="5289139">range</span>&nbsp;<span class="ident" id="5289145">re</span><span class="op" id="5289147">.</span><span class="ident" id="5289148">Sub</span>&nbsp;<span class="op" id="5289152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289157">if</span>&nbsp;<span class="ident" id="5289160">i</span>&nbsp;<span class="op" id="5289162">==</span>&nbsp;<span class="num" id="5289165">0</span>&nbsp;<span class="op" id="5289167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289173">f</span>&nbsp;<span class="op" id="5289175">=</span>&nbsp;<span class="ident" id="5289177">c</span><span class="op" id="5289178">.</span><span class="ident" id="5289179">compile</span><span class="op" id="5289186">(</span><span class="ident" id="5289187">sub</span><span class="op" id="5289190">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289195">}</span>&nbsp;<span class="keyword" id="5289197">else</span>&nbsp;<span class="op" id="5289202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289208">f</span>&nbsp;<span class="op" id="5289210">=</span>&nbsp;<span class="ident" id="5289212">c</span><span class="op" id="5289213">.</span><span class="ident" id="5289214">cat</span><span class="op" id="5289217">(</span><span class="ident" id="5289218">f</span><span class="op" id="5289219">,</span>&nbsp;<span class="ident" id="5289221">c</span><span class="op" id="5289222">.</span><span class="ident" id="5289223">compile</span><span class="op" id="5289230">(</span><span class="ident" id="5289231">sub</span><span class="op" id="5289234">)</span><span class="op" id="5289235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289248">return</span>&nbsp;<span class="ident" id="5289255">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289258">case</span>&nbsp;<span class="ident" id="5289263">OpAlternate</span><span class="op" id="5289274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289278">var</span>&nbsp;<span class="ident" id="5289282">f</span>&nbsp;<span class="ident" id="5289284">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289291">for</span>&nbsp;<span class="ident" id="5289295">_</span><span class="op" id="5289296">,</span>&nbsp;<span class="ident" id="5289298">sub</span>&nbsp;<span class="op" id="5289302">:=</span>&nbsp;<span class="keyword" id="5289305">range</span>&nbsp;<span class="ident" id="5289311">re</span><span class="op" id="5289313">.</span><span class="ident" id="5289314">Sub</span>&nbsp;<span class="op" id="5289318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289323">f</span>&nbsp;<span class="op" id="5289325">=</span>&nbsp;<span class="ident" id="5289327">c</span><span class="op" id="5289328">.</span><span class="ident" id="5289329">alt</span><span class="op" id="5289332">(</span><span class="ident" id="5289333">f</span><span class="op" id="5289334">,</span>&nbsp;<span class="ident" id="5289336">c</span><span class="op" id="5289337">.</span><span class="ident" id="5289338">compile</span><span class="op" id="5289345">(</span><span class="ident" id="5289346">sub</span><span class="op" id="5289349">)</span><span class="op" id="5289350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289354">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289358">return</span>&nbsp;<span class="ident" id="5289365">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5289371">panic</span><span class="op" id="5289376">(</span><span class="string" id="5289377">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5289412">)</span><br>
<span class="lineno"></span><span class="op" id="5289414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5289417">func</span>&nbsp;<span class="op" id="5289422">(</span><span class="ident" id="5289423">c</span>&nbsp;<span class="op" id="5289425">*</span><span class="ident" id="5289426">compiler</span><span class="op" id="5289434">)</span>&nbsp;<span class="ident" id="5289436">inst</span><span class="op" id="5289440">(</span><span class="ident" id="5289441">op</span>&nbsp;<span class="ident" id="5289444">InstOp</span><span class="op" id="5289450">)</span>&nbsp;<span class="ident" id="5289452">frag</span>&nbsp;<span class="op" id="5289457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5289460">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289490">f</span>&nbsp;<span class="op" id="5289492">:=</span>&nbsp;<span class="ident" id="5289495">frag</span><span class="op" id="5289499">{</span><span class="ident" id="5289500">i</span><span class="op" id="5289501">:</span>&nbsp;<span class="builtintype" id="5289503">uint32</span><span class="op" id="5289509">(</span><span class="builtinfunc" id="5289510">len</span><span class="op" id="5289513">(</span><span class="ident" id="5289514">c</span><span class="op" id="5289515">.</span><span class="ident" id="5289516">p</span><span class="op" id="5289517">.</span><span class="ident" id="5289518">Inst</span><span class="op" id="5289522">)</span><span class="op" id="5289523">)</span><span class="op" id="5289524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289527">c</span><span class="op" id="5289528">.</span><span class="ident" id="5289529">p</span><span class="op" id="5289530">.</span><span class="ident" id="5289531">Inst</span>&nbsp;<span class="op" id="5289536">=</span>&nbsp;<span class="builtinfunc" id="5289538">append</span><span class="op" id="5289544">(</span><span class="ident" id="5289545">c</span><span class="op" id="5289546">.</span><span class="ident" id="5289547">p</span><span class="op" id="5289548">.</span><span class="ident" id="5289549">Inst</span><span class="op" id="5289553">,</span>&nbsp;<span class="ident" id="5289555">Inst</span><span class="op" id="5289559">{</span><span class="ident" id="5289560">Op</span><span class="op" id="5289562">:</span>&nbsp;<span class="ident" id="5289564">op</span><span class="op" id="5289566">}</span><span class="op" id="5289567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289570">return</span>&nbsp;<span class="ident" id="5289577">f</span><br>
<span class="lineno">175</span><span class="op" id="5289579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5289582">func</span>&nbsp;<span class="op" id="5289587">(</span><span class="ident" id="5289588">c</span>&nbsp;<span class="op" id="5289590">*</span><span class="ident" id="5289591">compiler</span><span class="op" id="5289599">)</span>&nbsp;<span class="ident" id="5289601">nop</span><span class="op" id="5289604">(</span><span class="op" id="5289605">)</span>&nbsp;<span class="ident" id="5289607">frag</span>&nbsp;<span class="op" id="5289612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289615">f</span>&nbsp;<span class="op" id="5289617">:=</span>&nbsp;<span class="ident" id="5289620">c</span><span class="op" id="5289621">.</span><span class="ident" id="5289622">inst</span><span class="op" id="5289626">(</span><span class="ident" id="5289627">InstNop</span><span class="op" id="5289634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289637">f</span><span class="op" id="5289638">.</span><span class="ident" id="5289639">out</span>&nbsp;<span class="op" id="5289643">=</span>&nbsp;<span class="ident" id="5289645">patchList</span><span class="op" id="5289654">(</span><span class="ident" id="5289655">f</span><span class="op" id="5289656">.</span><span class="ident" id="5289657">i</span>&nbsp;<span class="op" id="5289659">&lt;&lt;</span>&nbsp;<span class="num" id="5289662">1</span><span class="op" id="5289663">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289666">return</span>&nbsp;<span class="ident" id="5289673">f</span><br>
<span class="lineno"></span><span class="op" id="5289675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5289678">func</span>&nbsp;<span class="op" id="5289683">(</span><span class="ident" id="5289684">c</span>&nbsp;<span class="op" id="5289686">*</span><span class="ident" id="5289687">compiler</span><span class="op" id="5289695">)</span>&nbsp;<span class="ident" id="5289697">fail</span><span class="op" id="5289701">(</span><span class="op" id="5289702">)</span>&nbsp;<span class="ident" id="5289704">frag</span>&nbsp;<span class="op" id="5289709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289712">return</span>&nbsp;<span class="ident" id="5289719">frag</span><span class="op" id="5289723">{</span><span class="op" id="5289724">}</span><br>
<span class="lineno">185</span><span class="op" id="5289726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5289729">func</span>&nbsp;<span class="op" id="5289734">(</span><span class="ident" id="5289735">c</span>&nbsp;<span class="op" id="5289737">*</span><span class="ident" id="5289738">compiler</span><span class="op" id="5289746">)</span>&nbsp;<span class="builtinfunc" id="5289748">cap</span><span class="op" id="5289751">(</span><span class="ident" id="5289752">arg</span>&nbsp;<span class="builtintype" id="5289756">uint32</span><span class="op" id="5289762">)</span>&nbsp;<span class="ident" id="5289764">frag</span>&nbsp;<span class="op" id="5289769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289772">f</span>&nbsp;<span class="op" id="5289774">:=</span>&nbsp;<span class="ident" id="5289777">c</span><span class="op" id="5289778">.</span><span class="ident" id="5289779">inst</span><span class="op" id="5289783">(</span><span class="ident" id="5289784">InstCapture</span><span class="op" id="5289795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289798">f</span><span class="op" id="5289799">.</span><span class="ident" id="5289800">out</span>&nbsp;<span class="op" id="5289804">=</span>&nbsp;<span class="ident" id="5289806">patchList</span><span class="op" id="5289815">(</span><span class="ident" id="5289816">f</span><span class="op" id="5289817">.</span><span class="ident" id="5289818">i</span>&nbsp;<span class="op" id="5289820">&lt;&lt;</span>&nbsp;<span class="num" id="5289823">1</span><span class="op" id="5289824">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289827">c</span><span class="op" id="5289828">.</span><span class="ident" id="5289829">p</span><span class="op" id="5289830">.</span><span class="ident" id="5289831">Inst</span><span class="op" id="5289835">[</span><span class="ident" id="5289836">f</span><span class="op" id="5289837">.</span><span class="ident" id="5289838">i</span><span class="op" id="5289839">]</span><span class="op" id="5289840">.</span><span class="ident" id="5289841">Arg</span>&nbsp;<span class="op" id="5289845">=</span>&nbsp;<span class="ident" id="5289847">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289853">if</span>&nbsp;<span class="ident" id="5289856">c</span><span class="op" id="5289857">.</span><span class="ident" id="5289858">p</span><span class="op" id="5289859">.</span><span class="ident" id="5289860">NumCap</span>&nbsp;<span class="op" id="5289867">&lt;</span>&nbsp;<span class="builtintype" id="5289869">int</span><span class="op" id="5289872">(</span><span class="ident" id="5289873">arg</span><span class="op" id="5289876">)</span><span class="op" id="5289877">+</span><span class="num" id="5289878">1</span>&nbsp;<span class="op" id="5289880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5289884">c</span><span class="op" id="5289885">.</span><span class="ident" id="5289886">p</span><span class="op" id="5289887">.</span><span class="ident" id="5289888">NumCap</span>&nbsp;<span class="op" id="5289895">=</span>&nbsp;<span class="builtintype" id="5289897">int</span><span class="op" id="5289900">(</span><span class="ident" id="5289901">arg</span><span class="op" id="5289904">)</span>&nbsp;<span class="op" id="5289906">+</span>&nbsp;<span class="num" id="5289908">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5289911">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5289914">return</span>&nbsp;<span class="ident" id="5289921">f</span><br>
<span class="lineno"></span><span class="op" id="5289923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5289926">func</span>&nbsp;<span class="op" id="5289931">(</span><span class="ident" id="5289932">c</span>&nbsp;<span class="op" id="5289934">*</span><span class="ident" id="5289935">compiler</span><span class="op" id="5289943">)</span>&nbsp;<span class="ident" id="5289945">cat</span><span class="op" id="5289948">(</span><span class="ident" id="5289949">f1</span><span class="op" id="5289951">,</span>&nbsp;<span class="ident" id="5289953">f2</span>&nbsp;<span class="ident" id="5289956">frag</span><span class="op" id="5289960">)</span>&nbsp;<span class="ident" id="5289962">frag</span>&nbsp;<span class="op" id="5289967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5289970">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290003">if</span>&nbsp;<span class="ident" id="5290006">f1</span><span class="op" id="5290008">.</span><span class="ident" id="5290009">i</span>&nbsp;<span class="op" id="5290011">==</span>&nbsp;<span class="num" id="5290014">0</span>&nbsp;<span class="op" id="5290016">||</span>&nbsp;<span class="ident" id="5290019">f2</span><span class="op" id="5290021">.</span><span class="ident" id="5290022">i</span>&nbsp;<span class="op" id="5290024">==</span>&nbsp;<span class="num" id="5290027">0</span>&nbsp;<span class="op" id="5290029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290033">return</span>&nbsp;<span class="ident" id="5290040">frag</span><span class="op" id="5290044">{</span><span class="op" id="5290045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5290052">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290073">f1</span><span class="op" id="5290075">.</span><span class="ident" id="5290076">out</span><span class="op" id="5290079">.</span><span class="ident" id="5290080">patch</span><span class="op" id="5290085">(</span><span class="ident" id="5290086">c</span><span class="op" id="5290087">.</span><span class="ident" id="5290088">p</span><span class="op" id="5290089">,</span>&nbsp;<span class="ident" id="5290091">f2</span><span class="op" id="5290093">.</span><span class="ident" id="5290094">i</span><span class="op" id="5290095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290098">return</span>&nbsp;<span class="ident" id="5290105">frag</span><span class="op" id="5290109">{</span><span class="ident" id="5290110">f1</span><span class="op" id="5290112">.</span><span class="ident" id="5290113">i</span><span class="op" id="5290114">,</span>&nbsp;<span class="ident" id="5290116">f2</span><span class="op" id="5290118">.</span><span class="ident" id="5290119">out</span><span class="op" id="5290122">}</span><br>
<span class="lineno"></span><span class="op" id="5290124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5290127">func</span>&nbsp;<span class="op" id="5290132">(</span><span class="ident" id="5290133">c</span>&nbsp;<span class="op" id="5290135">*</span><span class="ident" id="5290136">compiler</span><span class="op" id="5290144">)</span>&nbsp;<span class="ident" id="5290146">alt</span><span class="op" id="5290149">(</span><span class="ident" id="5290150">f1</span><span class="op" id="5290152">,</span>&nbsp;<span class="ident" id="5290154">f2</span>&nbsp;<span class="ident" id="5290157">frag</span><span class="op" id="5290161">)</span>&nbsp;<span class="ident" id="5290163">frag</span>&nbsp;<span class="op" id="5290168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5290171">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290199">if</span>&nbsp;<span class="ident" id="5290202">f1</span><span class="op" id="5290204">.</span><span class="ident" id="5290205">i</span>&nbsp;<span class="op" id="5290207">==</span>&nbsp;<span class="num" id="5290210">0</span>&nbsp;<span class="op" id="5290212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290216">return</span>&nbsp;<span class="ident" id="5290223">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290227">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290230">if</span>&nbsp;<span class="ident" id="5290233">f2</span><span class="op" id="5290235">.</span><span class="ident" id="5290236">i</span>&nbsp;<span class="op" id="5290238">==</span>&nbsp;<span class="num" id="5290241">0</span>&nbsp;<span class="op" id="5290243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290247">return</span>&nbsp;<span class="ident" id="5290254">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290262">f</span>&nbsp;<span class="op" id="5290264">:=</span>&nbsp;<span class="ident" id="5290267">c</span><span class="op" id="5290268">.</span><span class="ident" id="5290269">inst</span><span class="op" id="5290273">(</span><span class="ident" id="5290274">InstAlt</span><span class="op" id="5290281">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290284">i</span>&nbsp;<span class="op" id="5290286">:=</span>&nbsp;<span class="op" id="5290289">&amp;</span><span class="ident" id="5290290">c</span><span class="op" id="5290291">.</span><span class="ident" id="5290292">p</span><span class="op" id="5290293">.</span><span class="ident" id="5290294">Inst</span><span class="op" id="5290298">[</span><span class="ident" id="5290299">f</span><span class="op" id="5290300">.</span><span class="ident" id="5290301">i</span><span class="op" id="5290302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290305">i</span><span class="op" id="5290306">.</span><span class="ident" id="5290307">Out</span>&nbsp;<span class="op" id="5290311">=</span>&nbsp;<span class="ident" id="5290313">f1</span><span class="op" id="5290315">.</span><span class="ident" id="5290316">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290319">i</span><span class="op" id="5290320">.</span><span class="ident" id="5290321">Arg</span>&nbsp;<span class="op" id="5290325">=</span>&nbsp;<span class="ident" id="5290327">f2</span><span class="op" id="5290329">.</span><span class="ident" id="5290330">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290333">f</span><span class="op" id="5290334">.</span><span class="ident" id="5290335">out</span>&nbsp;<span class="op" id="5290339">=</span>&nbsp;<span class="ident" id="5290341">f1</span><span class="op" id="5290343">.</span><span class="ident" id="5290344">out</span><span class="op" id="5290347">.</span><span class="builtinfunc" id="5290348">append</span><span class="op" id="5290354">(</span><span class="ident" id="5290355">c</span><span class="op" id="5290356">.</span><span class="ident" id="5290357">p</span><span class="op" id="5290358">,</span>&nbsp;<span class="ident" id="5290360">f2</span><span class="op" id="5290362">.</span><span class="ident" id="5290363">out</span><span class="op" id="5290366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290369">return</span>&nbsp;<span class="ident" id="5290376">f</span><br>
<span class="lineno">225</span><span class="op" id="5290378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5290381">func</span>&nbsp;<span class="op" id="5290386">(</span><span class="ident" id="5290387">c</span>&nbsp;<span class="op" id="5290389">*</span><span class="ident" id="5290390">compiler</span><span class="op" id="5290398">)</span>&nbsp;<span class="ident" id="5290400">quest</span><span class="op" id="5290405">(</span><span class="ident" id="5290406">f1</span>&nbsp;<span class="ident" id="5290409">frag</span><span class="op" id="5290413">,</span>&nbsp;<span class="ident" id="5290415">nongreedy</span>&nbsp;<span class="builtintype" id="5290425">bool</span><span class="op" id="5290429">)</span>&nbsp;<span class="ident" id="5290431">frag</span>&nbsp;<span class="op" id="5290436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290439">f</span>&nbsp;<span class="op" id="5290441">:=</span>&nbsp;<span class="ident" id="5290444">c</span><span class="op" id="5290445">.</span><span class="ident" id="5290446">inst</span><span class="op" id="5290450">(</span><span class="ident" id="5290451">InstAlt</span><span class="op" id="5290458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290461">i</span>&nbsp;<span class="op" id="5290463">:=</span>&nbsp;<span class="op" id="5290466">&amp;</span><span class="ident" id="5290467">c</span><span class="op" id="5290468">.</span><span class="ident" id="5290469">p</span><span class="op" id="5290470">.</span><span class="ident" id="5290471">Inst</span><span class="op" id="5290475">[</span><span class="ident" id="5290476">f</span><span class="op" id="5290477">.</span><span class="ident" id="5290478">i</span><span class="op" id="5290479">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290482">if</span>&nbsp;<span class="ident" id="5290485">nongreedy</span>&nbsp;<span class="op" id="5290495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290499">i</span><span class="op" id="5290500">.</span><span class="ident" id="5290501">Arg</span>&nbsp;<span class="op" id="5290505">=</span>&nbsp;<span class="ident" id="5290507">f1</span><span class="op" id="5290509">.</span><span class="ident" id="5290510">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290514">f</span><span class="op" id="5290515">.</span><span class="ident" id="5290516">out</span>&nbsp;<span class="op" id="5290520">=</span>&nbsp;<span class="ident" id="5290522">patchList</span><span class="op" id="5290531">(</span><span class="ident" id="5290532">f</span><span class="op" id="5290533">.</span><span class="ident" id="5290534">i</span>&nbsp;<span class="op" id="5290536">&lt;&lt;</span>&nbsp;<span class="num" id="5290539">1</span><span class="op" id="5290540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290543">}</span>&nbsp;<span class="keyword" id="5290545">else</span>&nbsp;<span class="op" id="5290550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290554">i</span><span class="op" id="5290555">.</span><span class="ident" id="5290556">Out</span>&nbsp;<span class="op" id="5290560">=</span>&nbsp;<span class="ident" id="5290562">f1</span><span class="op" id="5290564">.</span><span class="ident" id="5290565">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290569">f</span><span class="op" id="5290570">.</span><span class="ident" id="5290571">out</span>&nbsp;<span class="op" id="5290575">=</span>&nbsp;<span class="ident" id="5290577">patchList</span><span class="op" id="5290586">(</span><span class="ident" id="5290587">f</span><span class="op" id="5290588">.</span><span class="ident" id="5290589">i</span><span class="op" id="5290590">&lt;&lt;</span><span class="num" id="5290592">1</span>&nbsp;<span class="op" id="5290594">|</span>&nbsp;<span class="num" id="5290596">1</span><span class="op" id="5290597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290603">f</span><span class="op" id="5290604">.</span><span class="ident" id="5290605">out</span>&nbsp;<span class="op" id="5290609">=</span>&nbsp;<span class="ident" id="5290611">f</span><span class="op" id="5290612">.</span><span class="ident" id="5290613">out</span><span class="op" id="5290616">.</span><span class="builtinfunc" id="5290617">append</span><span class="op" id="5290623">(</span><span class="ident" id="5290624">c</span><span class="op" id="5290625">.</span><span class="ident" id="5290626">p</span><span class="op" id="5290627">,</span>&nbsp;<span class="ident" id="5290629">f1</span><span class="op" id="5290631">.</span><span class="ident" id="5290632">out</span><span class="op" id="5290635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290638">return</span>&nbsp;<span class="ident" id="5290645">f</span><br>
<span class="lineno"></span><span class="op" id="5290647">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5290650">func</span>&nbsp;<span class="op" id="5290655">(</span><span class="ident" id="5290656">c</span>&nbsp;<span class="op" id="5290658">*</span><span class="ident" id="5290659">compiler</span><span class="op" id="5290667">)</span>&nbsp;<span class="ident" id="5290669">star</span><span class="op" id="5290673">(</span><span class="ident" id="5290674">f1</span>&nbsp;<span class="ident" id="5290677">frag</span><span class="op" id="5290681">,</span>&nbsp;<span class="ident" id="5290683">nongreedy</span>&nbsp;<span class="builtintype" id="5290693">bool</span><span class="op" id="5290697">)</span>&nbsp;<span class="ident" id="5290699">frag</span>&nbsp;<span class="op" id="5290704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290707">f</span>&nbsp;<span class="op" id="5290709">:=</span>&nbsp;<span class="ident" id="5290712">c</span><span class="op" id="5290713">.</span><span class="ident" id="5290714">inst</span><span class="op" id="5290718">(</span><span class="ident" id="5290719">InstAlt</span><span class="op" id="5290726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290729">i</span>&nbsp;<span class="op" id="5290731">:=</span>&nbsp;<span class="op" id="5290734">&amp;</span><span class="ident" id="5290735">c</span><span class="op" id="5290736">.</span><span class="ident" id="5290737">p</span><span class="op" id="5290738">.</span><span class="ident" id="5290739">Inst</span><span class="op" id="5290743">[</span><span class="ident" id="5290744">f</span><span class="op" id="5290745">.</span><span class="ident" id="5290746">i</span><span class="op" id="5290747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290750">if</span>&nbsp;<span class="ident" id="5290753">nongreedy</span>&nbsp;<span class="op" id="5290763">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290767">i</span><span class="op" id="5290768">.</span><span class="ident" id="5290769">Arg</span>&nbsp;<span class="op" id="5290773">=</span>&nbsp;<span class="ident" id="5290775">f1</span><span class="op" id="5290777">.</span><span class="ident" id="5290778">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290782">f</span><span class="op" id="5290783">.</span><span class="ident" id="5290784">out</span>&nbsp;<span class="op" id="5290788">=</span>&nbsp;<span class="ident" id="5290790">patchList</span><span class="op" id="5290799">(</span><span class="ident" id="5290800">f</span><span class="op" id="5290801">.</span><span class="ident" id="5290802">i</span>&nbsp;<span class="op" id="5290804">&lt;&lt;</span>&nbsp;<span class="num" id="5290807">1</span><span class="op" id="5290808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290811">}</span>&nbsp;<span class="keyword" id="5290813">else</span>&nbsp;<span class="op" id="5290818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290822">i</span><span class="op" id="5290823">.</span><span class="ident" id="5290824">Out</span>&nbsp;<span class="op" id="5290828">=</span>&nbsp;<span class="ident" id="5290830">f1</span><span class="op" id="5290832">.</span><span class="ident" id="5290833">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290837">f</span><span class="op" id="5290838">.</span><span class="ident" id="5290839">out</span>&nbsp;<span class="op" id="5290843">=</span>&nbsp;<span class="ident" id="5290845">patchList</span><span class="op" id="5290854">(</span><span class="ident" id="5290855">f</span><span class="op" id="5290856">.</span><span class="ident" id="5290857">i</span><span class="op" id="5290858">&lt;&lt;</span><span class="num" id="5290860">1</span>&nbsp;<span class="op" id="5290862">|</span>&nbsp;<span class="num" id="5290864">1</span><span class="op" id="5290865">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5290868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5290871">f1</span><span class="op" id="5290873">.</span><span class="ident" id="5290874">out</span><span class="op" id="5290877">.</span><span class="ident" id="5290878">patch</span><span class="op" id="5290883">(</span><span class="ident" id="5290884">c</span><span class="op" id="5290885">.</span><span class="ident" id="5290886">p</span><span class="op" id="5290887">,</span>&nbsp;<span class="ident" id="5290889">f</span><span class="op" id="5290890">.</span><span class="ident" id="5290891">i</span><span class="op" id="5290892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290895">return</span>&nbsp;<span class="ident" id="5290902">f</span><br>
<span class="lineno"></span><span class="op" id="5290904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5290907">func</span>&nbsp;<span class="op" id="5290912">(</span><span class="ident" id="5290913">c</span>&nbsp;<span class="op" id="5290915">*</span><span class="ident" id="5290916">compiler</span><span class="op" id="5290924">)</span>&nbsp;<span class="ident" id="5290926">plus</span><span class="op" id="5290930">(</span><span class="ident" id="5290931">f1</span>&nbsp;<span class="ident" id="5290934">frag</span><span class="op" id="5290938">,</span>&nbsp;<span class="ident" id="5290940">nongreedy</span>&nbsp;<span class="builtintype" id="5290950">bool</span><span class="op" id="5290954">)</span>&nbsp;<span class="ident" id="5290956">frag</span>&nbsp;<span class="op" id="5290961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5290964">return</span>&nbsp;<span class="ident" id="5290971">frag</span><span class="op" id="5290975">{</span><span class="ident" id="5290976">f1</span><span class="op" id="5290978">.</span><span class="ident" id="5290979">i</span><span class="op" id="5290980">,</span>&nbsp;<span class="ident" id="5290982">c</span><span class="op" id="5290983">.</span><span class="ident" id="5290984">star</span><span class="op" id="5290988">(</span><span class="ident" id="5290989">f1</span><span class="op" id="5290991">,</span>&nbsp;<span class="ident" id="5290993">nongreedy</span><span class="op" id="5291002">)</span><span class="op" id="5291003">.</span><span class="ident" id="5291004">out</span><span class="op" id="5291007">}</span><br>
<span class="lineno"></span><span class="op" id="5291009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5291012">func</span>&nbsp;<span class="op" id="5291017">(</span><span class="ident" id="5291018">c</span>&nbsp;<span class="op" id="5291020">*</span><span class="ident" id="5291021">compiler</span><span class="op" id="5291029">)</span>&nbsp;<span class="ident" id="5291031">empty</span><span class="op" id="5291036">(</span><span class="ident" id="5291037">op</span>&nbsp;<span class="ident" id="5291040">EmptyOp</span><span class="op" id="5291047">)</span>&nbsp;<span class="ident" id="5291049">frag</span>&nbsp;<span class="op" id="5291054">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291057">f</span>&nbsp;<span class="op" id="5291059">:=</span>&nbsp;<span class="ident" id="5291062">c</span><span class="op" id="5291063">.</span><span class="ident" id="5291064">inst</span><span class="op" id="5291068">(</span><span class="ident" id="5291069">InstEmptyWidth</span><span class="op" id="5291083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291086">c</span><span class="op" id="5291087">.</span><span class="ident" id="5291088">p</span><span class="op" id="5291089">.</span><span class="ident" id="5291090">Inst</span><span class="op" id="5291094">[</span><span class="ident" id="5291095">f</span><span class="op" id="5291096">.</span><span class="ident" id="5291097">i</span><span class="op" id="5291098">]</span><span class="op" id="5291099">.</span><span class="ident" id="5291100">Arg</span>&nbsp;<span class="op" id="5291104">=</span>&nbsp;<span class="builtintype" id="5291106">uint32</span><span class="op" id="5291112">(</span><span class="ident" id="5291113">op</span><span class="op" id="5291115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291118">f</span><span class="op" id="5291119">.</span><span class="ident" id="5291120">out</span>&nbsp;<span class="op" id="5291124">=</span>&nbsp;<span class="ident" id="5291126">patchList</span><span class="op" id="5291135">(</span><span class="ident" id="5291136">f</span><span class="op" id="5291137">.</span><span class="ident" id="5291138">i</span>&nbsp;<span class="op" id="5291140">&lt;&lt;</span>&nbsp;<span class="num" id="5291143">1</span><span class="op" id="5291144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291147">return</span>&nbsp;<span class="ident" id="5291154">f</span><br>
<span class="lineno"></span><span class="op" id="5291156">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5291159">func</span>&nbsp;<span class="op" id="5291164">(</span><span class="ident" id="5291165">c</span>&nbsp;<span class="op" id="5291167">*</span><span class="ident" id="5291168">compiler</span><span class="op" id="5291176">)</span>&nbsp;<span class="builtintype" id="5291178">rune</span><span class="op" id="5291182">(</span><span class="ident" id="5291183">r</span>&nbsp;<span class="op" id="5291185">[</span><span class="op" id="5291186">]</span><span class="builtintype" id="5291187">rune</span><span class="op" id="5291191">,</span>&nbsp;<span class="ident" id="5291193">flags</span>&nbsp;<span class="ident" id="5291199">Flags</span><span class="op" id="5291204">)</span>&nbsp;<span class="ident" id="5291206">frag</span>&nbsp;<span class="op" id="5291211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291214">f</span>&nbsp;<span class="op" id="5291216">:=</span>&nbsp;<span class="ident" id="5291219">c</span><span class="op" id="5291220">.</span><span class="ident" id="5291221">inst</span><span class="op" id="5291225">(</span><span class="ident" id="5291226">InstRune</span><span class="op" id="5291234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291237">i</span>&nbsp;<span class="op" id="5291239">:=</span>&nbsp;<span class="op" id="5291242">&amp;</span><span class="ident" id="5291243">c</span><span class="op" id="5291244">.</span><span class="ident" id="5291245">p</span><span class="op" id="5291246">.</span><span class="ident" id="5291247">Inst</span><span class="op" id="5291251">[</span><span class="ident" id="5291252">f</span><span class="op" id="5291253">.</span><span class="ident" id="5291254">i</span><span class="op" id="5291255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291258">i</span><span class="op" id="5291259">.</span><span class="ident" id="5291260">Rune</span>&nbsp;<span class="op" id="5291265">=</span>&nbsp;<span class="ident" id="5291267">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291270">flags</span>&nbsp;<span class="op" id="5291276">&amp;=</span>&nbsp;<span class="ident" id="5291279">FoldCase</span>&nbsp;<span class="comment" id="5291288">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291323">if</span>&nbsp;<span class="builtinfunc" id="5291326">len</span><span class="op" id="5291329">(</span><span class="ident" id="5291330">r</span><span class="op" id="5291331">)</span>&nbsp;<span class="op" id="5291333">!=</span>&nbsp;<span class="num" id="5291336">1</span>&nbsp;<span class="op" id="5291338">||</span>&nbsp;<span class="ident" id="5291341">unicode</span><span class="op" id="5291348">.</span><span class="ident" id="5291349">SimpleFold</span><span class="op" id="5291359">(</span><span class="ident" id="5291360">r</span><span class="op" id="5291361">[</span><span class="num" id="5291362">0</span><span class="op" id="5291363">]</span><span class="op" id="5291364">)</span>&nbsp;<span class="op" id="5291366">==</span>&nbsp;<span class="ident" id="5291369">r</span><span class="op" id="5291370">[</span><span class="num" id="5291371">0</span><span class="op" id="5291372">]</span>&nbsp;<span class="op" id="5291374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5291378">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291411">flags</span>&nbsp;<span class="op" id="5291417">&amp;^=</span>&nbsp;<span class="ident" id="5291421">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5291431">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291434">i</span><span class="op" id="5291435">.</span><span class="ident" id="5291436">Arg</span>&nbsp;<span class="op" id="5291440">=</span>&nbsp;<span class="builtintype" id="5291442">uint32</span><span class="op" id="5291448">(</span><span class="ident" id="5291449">flags</span><span class="op" id="5291454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291457">f</span><span class="op" id="5291458">.</span><span class="ident" id="5291459">out</span>&nbsp;<span class="op" id="5291463">=</span>&nbsp;<span class="ident" id="5291465">patchList</span><span class="op" id="5291474">(</span><span class="ident" id="5291475">f</span><span class="op" id="5291476">.</span><span class="ident" id="5291477">i</span>&nbsp;<span class="op" id="5291479">&lt;&lt;</span>&nbsp;<span class="num" id="5291482">1</span><span class="op" id="5291483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5291487">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291523">switch</span>&nbsp;<span class="op" id="5291530">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291533">case</span>&nbsp;<span class="ident" id="5291538">flags</span><span class="op" id="5291543">&amp;</span><span class="ident" id="5291544">FoldCase</span>&nbsp;<span class="op" id="5291553">==</span>&nbsp;<span class="num" id="5291556">0</span>&nbsp;<span class="op" id="5291558">&amp;&amp;</span>&nbsp;<span class="op" id="5291561">(</span><span class="builtinfunc" id="5291562">len</span><span class="op" id="5291565">(</span><span class="ident" id="5291566">r</span><span class="op" id="5291567">)</span>&nbsp;<span class="op" id="5291569">==</span>&nbsp;<span class="num" id="5291572">1</span>&nbsp;<span class="op" id="5291574">||</span>&nbsp;<span class="builtinfunc" id="5291577">len</span><span class="op" id="5291580">(</span><span class="ident" id="5291581">r</span><span class="op" id="5291582">)</span>&nbsp;<span class="op" id="5291584">==</span>&nbsp;<span class="num" id="5291587">2</span>&nbsp;<span class="op" id="5291589">&amp;&amp;</span>&nbsp;<span class="ident" id="5291592">r</span><span class="op" id="5291593">[</span><span class="num" id="5291594">0</span><span class="op" id="5291595">]</span>&nbsp;<span class="op" id="5291597">==</span>&nbsp;<span class="ident" id="5291600">r</span><span class="op" id="5291601">[</span><span class="num" id="5291602">1</span><span class="op" id="5291603">]</span><span class="op" id="5291604">)</span><span class="op" id="5291605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291609">i</span><span class="op" id="5291610">.</span><span class="ident" id="5291611">Op</span>&nbsp;<span class="op" id="5291614">=</span>&nbsp;<span class="ident" id="5291616">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291627">case</span>&nbsp;<span class="builtinfunc" id="5291632">len</span><span class="op" id="5291635">(</span><span class="ident" id="5291636">r</span><span class="op" id="5291637">)</span>&nbsp;<span class="op" id="5291639">==</span>&nbsp;<span class="num" id="5291642">2</span>&nbsp;<span class="op" id="5291644">&amp;&amp;</span>&nbsp;<span class="ident" id="5291647">r</span><span class="op" id="5291648">[</span><span class="num" id="5291649">0</span><span class="op" id="5291650">]</span>&nbsp;<span class="op" id="5291652">==</span>&nbsp;<span class="num" id="5291655">0</span>&nbsp;<span class="op" id="5291657">&amp;&amp;</span>&nbsp;<span class="ident" id="5291660">r</span><span class="op" id="5291661">[</span><span class="num" id="5291662">1</span><span class="op" id="5291663">]</span>&nbsp;<span class="op" id="5291665">==</span>&nbsp;<span class="ident" id="5291668">unicode</span><span class="op" id="5291675">.</span><span class="ident" id="5291676">MaxRune</span><span class="op" id="5291683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291687">i</span><span class="op" id="5291688">.</span><span class="ident" id="5291689">Op</span>&nbsp;<span class="op" id="5291692">=</span>&nbsp;<span class="ident" id="5291694">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291707">case</span>&nbsp;<span class="builtinfunc" id="5291712">len</span><span class="op" id="5291715">(</span><span class="ident" id="5291716">r</span><span class="op" id="5291717">)</span>&nbsp;<span class="op" id="5291719">==</span>&nbsp;<span class="num" id="5291722">4</span>&nbsp;<span class="op" id="5291724">&amp;&amp;</span>&nbsp;<span class="ident" id="5291727">r</span><span class="op" id="5291728">[</span><span class="num" id="5291729">0</span><span class="op" id="5291730">]</span>&nbsp;<span class="op" id="5291732">==</span>&nbsp;<span class="num" id="5291735">0</span>&nbsp;<span class="op" id="5291737">&amp;&amp;</span>&nbsp;<span class="ident" id="5291740">r</span><span class="op" id="5291741">[</span><span class="num" id="5291742">1</span><span class="op" id="5291743">]</span>&nbsp;<span class="op" id="5291745">==</span>&nbsp;<span class="string" id="5291748">&#39;\n&#39;</span><span class="op" id="5291752">-</span><span class="num" id="5291753">1</span>&nbsp;<span class="op" id="5291755">&amp;&amp;</span>&nbsp;<span class="ident" id="5291758">r</span><span class="op" id="5291759">[</span><span class="num" id="5291760">2</span><span class="op" id="5291761">]</span>&nbsp;<span class="op" id="5291763">==</span>&nbsp;<span class="string" id="5291766">&#39;\n&#39;</span><span class="op" id="5291770">+</span><span class="num" id="5291771">1</span>&nbsp;<span class="op" id="5291773">&amp;&amp;</span>&nbsp;<span class="ident" id="5291776">r</span><span class="op" id="5291777">[</span><span class="num" id="5291778">3</span><span class="op" id="5291779">]</span>&nbsp;<span class="op" id="5291781">==</span>&nbsp;<span class="ident" id="5291784">unicode</span><span class="op" id="5291791">.</span><span class="ident" id="5291792">MaxRune</span><span class="op" id="5291799">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5291803">i</span><span class="op" id="5291804">.</span><span class="ident" id="5291805">Op</span>&nbsp;<span class="op" id="5291808">=</span>&nbsp;<span class="ident" id="5291810">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5291828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5291832">return</span>&nbsp;<span class="ident" id="5291839">f</span><br>
<span class="lineno"></span><span class="op" id="5291841">}</span>
</div>
</body>
</html>
