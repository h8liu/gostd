<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html" class="current">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6612907">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6612962">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6613016">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6613067">package</span>&nbsp;<span class="ident" id="6613075">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6613080">import</span>&nbsp;<span class="op" id="6613087">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6613090">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6613098">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6613105">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6613116">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6613123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6613126">var</span>&nbsp;<span class="ident" id="6613130">testDNSFlood</span>&nbsp;<span class="op" id="6613143">=</span>&nbsp;<span class="ident" id="6613145">flag</span><span class="op" id="6613149">.</span><span class="ident" id="6613150">Bool</span><span class="op" id="6613154">(</span><span class="string" id="6613155">&#34;dnsflood&#34;</span><span class="op" id="6613165">,</span>&nbsp;<span class="builtintype" id="6613167">false</span><span class="op" id="6613172">,</span>&nbsp;<span class="string" id="6613174">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="6613210">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6613213">func</span>&nbsp;<span class="ident" id="6613218">TestDNSThreadLimit</span><span class="op" id="6613236">(</span><span class="ident" id="6613237">t</span>&nbsp;<span class="op" id="6613239">*</span><span class="ident" id="6613240">testing</span><span class="op" id="6613247">.</span><span class="ident" id="6613248">T</span><span class="op" id="6613249">)</span>&nbsp;<span class="op" id="6613251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613254">if</span>&nbsp;<span class="op" id="6613257">!</span><span class="op" id="6613258">*</span><span class="ident" id="6613259">testDNSFlood</span>&nbsp;<span class="op" id="6613272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613276">t</span><span class="op" id="6613277">.</span><span class="ident" id="6613278">Skip</span><span class="op" id="6613282">(</span><span class="string" id="6613283">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6613323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613326">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613330">const</span>&nbsp;<span class="ident" id="6613336">N</span>&nbsp;<span class="op" id="6613338">=</span>&nbsp;<span class="num" id="6613340">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613347">c</span>&nbsp;<span class="op" id="6613349">:=</span>&nbsp;<span class="builtinfunc" id="6613352">make</span><span class="op" id="6613356">(</span><span class="keyword" id="6613357">chan</span>&nbsp;<span class="builtintype" id="6613362">int</span><span class="op" id="6613365">,</span>&nbsp;<span class="ident" id="6613367">N</span><span class="op" id="6613368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613371">for</span>&nbsp;<span class="ident" id="6613375">i</span>&nbsp;<span class="op" id="6613377">:=</span>&nbsp;<span class="num" id="6613380">0</span><span class="op" id="6613381">;</span>&nbsp;<span class="ident" id="6613383">i</span>&nbsp;<span class="op" id="6613385">&lt;</span>&nbsp;<span class="ident" id="6613387">N</span><span class="op" id="6613388">;</span>&nbsp;<span class="ident" id="6613390">i</span><span class="op" id="6613391">++</span>&nbsp;<span class="op" id="6613394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613398">go</span>&nbsp;<span class="keyword" id="6613401">func</span><span class="op" id="6613405">(</span><span class="ident" id="6613406">i</span>&nbsp;<span class="builtintype" id="6613408">int</span><span class="op" id="6613411">)</span>&nbsp;<span class="op" id="6613413">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613418">LookupIP</span><span class="op" id="6613426">(</span><span class="ident" id="6613427">fmt</span><span class="op" id="6613430">.</span><span class="ident" id="6613431">Sprintf</span><span class="op" id="6613438">(</span><span class="string" id="6613439">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6613463">,</span>&nbsp;<span class="ident" id="6613465">i</span><span class="op" id="6613466">)</span><span class="op" id="6613467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613472">c</span>&nbsp;<span class="op" id="6613474">&lt;-</span>&nbsp;<span class="num" id="6613477">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613481">}</span><span class="op" id="6613482">(</span><span class="ident" id="6613483">i</span><span class="op" id="6613484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6613490">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613550">for</span>&nbsp;<span class="ident" id="6613554">i</span>&nbsp;<span class="op" id="6613556">:=</span>&nbsp;<span class="num" id="6613559">0</span><span class="op" id="6613560">;</span>&nbsp;<span class="ident" id="6613562">i</span>&nbsp;<span class="op" id="6613564">&lt;</span>&nbsp;<span class="ident" id="6613566">N</span><span class="op" id="6613567">*</span><span class="num" id="6613568">9</span><span class="op" id="6613569">/</span><span class="num" id="6613570">10</span><span class="op" id="6613572">;</span>&nbsp;<span class="ident" id="6613574">i</span><span class="op" id="6613575">++</span>&nbsp;<span class="op" id="6613578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613582">if</span>&nbsp;<span class="ident" id="6613585">i</span><span class="op" id="6613586">%</span><span class="num" id="6613587">100</span>&nbsp;<span class="op" id="6613591">==</span>&nbsp;<span class="num" id="6613594">0</span>&nbsp;<span class="op" id="6613596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6613601">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613643">&lt;-</span><span class="ident" id="6613645">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6613652">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="6613687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6613690">func</span>&nbsp;<span class="ident" id="6613695">TestLookupIPDeadline</span><span class="op" id="6613715">(</span><span class="ident" id="6613716">t</span>&nbsp;<span class="op" id="6613718">*</span><span class="ident" id="6613719">testing</span><span class="op" id="6613726">.</span><span class="ident" id="6613727">T</span><span class="op" id="6613728">)</span>&nbsp;<span class="op" id="6613730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613733">if</span>&nbsp;<span class="op" id="6613736">!</span><span class="op" id="6613737">*</span><span class="ident" id="6613738">testDNSFlood</span>&nbsp;<span class="op" id="6613751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613755">t</span><span class="op" id="6613756">.</span><span class="ident" id="6613757">Skip</span><span class="op" id="6613761">(</span><span class="string" id="6613762">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="6613802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6613805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613809">const</span>&nbsp;<span class="ident" id="6613815">N</span>&nbsp;<span class="op" id="6613817">=</span>&nbsp;<span class="num" id="6613819">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613825">const</span>&nbsp;<span class="ident" id="6613831">timeout</span>&nbsp;<span class="op" id="6613839">=</span>&nbsp;<span class="num" id="6613841">3</span>&nbsp;<span class="op" id="6613843">*</span>&nbsp;<span class="ident" id="6613845">time</span><span class="op" id="6613849">.</span><span class="ident" id="6613850">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613858">c</span>&nbsp;<span class="op" id="6613860">:=</span>&nbsp;<span class="builtinfunc" id="6613863">make</span><span class="op" id="6613867">(</span><span class="keyword" id="6613868">chan</span>&nbsp;<span class="builtintype" id="6613873">error</span><span class="op" id="6613878">,</span>&nbsp;<span class="num" id="6613880">2</span><span class="op" id="6613881">*</span><span class="ident" id="6613882">N</span><span class="op" id="6613883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613886">for</span>&nbsp;<span class="ident" id="6613890">i</span>&nbsp;<span class="op" id="6613892">:=</span>&nbsp;<span class="num" id="6613895">0</span><span class="op" id="6613896">;</span>&nbsp;<span class="ident" id="6613898">i</span>&nbsp;<span class="op" id="6613900">&lt;</span>&nbsp;<span class="ident" id="6613902">N</span><span class="op" id="6613903">;</span>&nbsp;<span class="ident" id="6613905">i</span><span class="op" id="6613906">++</span>&nbsp;<span class="op" id="6613909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613913">name</span>&nbsp;<span class="op" id="6613918">:=</span>&nbsp;<span class="ident" id="6613921">fmt</span><span class="op" id="6613924">.</span><span class="ident" id="6613925">Sprintf</span><span class="op" id="6613932">(</span><span class="string" id="6613933">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="6613957">,</span>&nbsp;<span class="ident" id="6613959">i</span><span class="op" id="6613960">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6613964">go</span>&nbsp;<span class="keyword" id="6613967">func</span><span class="op" id="6613971">(</span><span class="op" id="6613972">)</span>&nbsp;<span class="op" id="6613974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6613979">_</span><span class="op" id="6613980">,</span>&nbsp;<span class="ident" id="6613982">err</span>&nbsp;<span class="op" id="6613986">:=</span>&nbsp;<span class="ident" id="6613989">lookupIPDeadline</span><span class="op" id="6614005">(</span><span class="ident" id="6614006">name</span><span class="op" id="6614010">,</span>&nbsp;<span class="ident" id="6614012">time</span><span class="op" id="6614016">.</span><span class="ident" id="6614017">Now</span><span class="op" id="6614020">(</span><span class="op" id="6614021">)</span><span class="op" id="6614022">.</span><span class="ident" id="6614023">Add</span><span class="op" id="6614026">(</span><span class="ident" id="6614027">timeout</span><span class="op" id="6614034">/</span><span class="num" id="6614035">2</span><span class="op" id="6614036">)</span><span class="op" id="6614037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614042">c</span>&nbsp;<span class="op" id="6614044">&lt;-</span>&nbsp;<span class="ident" id="6614047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614053">}</span><span class="op" id="6614054">(</span><span class="op" id="6614055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614059">go</span>&nbsp;<span class="keyword" id="6614062">func</span><span class="op" id="6614066">(</span><span class="op" id="6614067">)</span>&nbsp;<span class="op" id="6614069">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614074">_</span><span class="op" id="6614075">,</span>&nbsp;<span class="ident" id="6614077">err</span>&nbsp;<span class="op" id="6614081">:=</span>&nbsp;<span class="ident" id="6614084">lookupIPDeadline</span><span class="op" id="6614100">(</span><span class="ident" id="6614101">name</span><span class="op" id="6614105">,</span>&nbsp;<span class="ident" id="6614107">time</span><span class="op" id="6614111">.</span><span class="ident" id="6614112">Now</span><span class="op" id="6614115">(</span><span class="op" id="6614116">)</span><span class="op" id="6614117">.</span><span class="ident" id="6614118">Add</span><span class="op" id="6614121">(</span><span class="ident" id="6614122">timeout</span><span class="op" id="6614129">)</span><span class="op" id="6614130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614135">c</span>&nbsp;<span class="op" id="6614137">&lt;-</span>&nbsp;<span class="ident" id="6614140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614146">}</span><span class="op" id="6614147">(</span><span class="op" id="6614148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614154">qstats</span>&nbsp;<span class="op" id="6614161">:=</span>&nbsp;<span class="keyword" id="6614164">struct</span>&nbsp;<span class="op" id="6614171">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614175">succeeded</span><span class="op" id="6614184">,</span>&nbsp;<span class="ident" id="6614186">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6614201">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614207">timeout</span><span class="op" id="6614214">,</span>&nbsp;<span class="ident" id="6614216">temporary</span><span class="op" id="6614225">,</span>&nbsp;<span class="ident" id="6614227">other</span>&nbsp;<span class="builtintype" id="6614233">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614239">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6614265">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614270">}</span><span class="op" id="6614271">{</span><span class="op" id="6614272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614275">deadline</span>&nbsp;<span class="op" id="6614284">:=</span>&nbsp;<span class="ident" id="6614287">time</span><span class="op" id="6614291">.</span><span class="ident" id="6614292">After</span><span class="op" id="6614297">(</span><span class="ident" id="6614298">timeout</span>&nbsp;<span class="op" id="6614306">+</span>&nbsp;<span class="ident" id="6614308">time</span><span class="op" id="6614312">.</span><span class="ident" id="6614313">Second</span><span class="op" id="6614319">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614322">for</span>&nbsp;<span class="ident" id="6614326">i</span>&nbsp;<span class="op" id="6614328">:=</span>&nbsp;<span class="num" id="6614331">0</span><span class="op" id="6614332">;</span>&nbsp;<span class="ident" id="6614334">i</span>&nbsp;<span class="op" id="6614336">&lt;</span>&nbsp;<span class="num" id="6614338">2</span><span class="op" id="6614339">*</span><span class="ident" id="6614340">N</span><span class="op" id="6614341">;</span>&nbsp;<span class="ident" id="6614343">i</span><span class="op" id="6614344">++</span>&nbsp;<span class="op" id="6614347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614351">select</span>&nbsp;<span class="op" id="6614358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614362">case</span>&nbsp;<span class="op" id="6614367">&lt;-</span><span class="ident" id="6614369">deadline</span><span class="op" id="6614377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614382">t</span><span class="op" id="6614383">.</span><span class="ident" id="6614384">Fatal</span><span class="op" id="6614389">(</span><span class="string" id="6614390">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="6614409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614413">case</span>&nbsp;<span class="ident" id="6614418">err</span>&nbsp;<span class="op" id="6614422">:=</span>&nbsp;<span class="op" id="6614425">&lt;-</span><span class="ident" id="6614427">c</span><span class="op" id="6614428">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614433">switch</span>&nbsp;<span class="ident" id="6614440">err</span>&nbsp;<span class="op" id="6614444">:=</span>&nbsp;<span class="ident" id="6614447">err</span><span class="op" id="6614450">.</span><span class="op" id="6614451">(</span><span class="keyword" id="6614452">type</span><span class="op" id="6614456">)</span>&nbsp;<span class="op" id="6614458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614463">case</span>&nbsp;<span class="builtintype" id="6614468">nil</span><span class="op" id="6614471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614477">qstats</span><span class="op" id="6614483">.</span><span class="ident" id="6614484">succeeded</span><span class="op" id="6614493">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614499">case</span>&nbsp;<span class="ident" id="6614504">Error</span><span class="op" id="6614509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614515">qstats</span><span class="op" id="6614521">.</span><span class="ident" id="6614522">failed</span><span class="op" id="6614528">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614535">if</span>&nbsp;<span class="ident" id="6614538">err</span><span class="op" id="6614541">.</span><span class="ident" id="6614542">Timeout</span><span class="op" id="6614549">(</span><span class="op" id="6614550">)</span>&nbsp;<span class="op" id="6614552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614559">qstats</span><span class="op" id="6614565">.</span><span class="ident" id="6614566">timeout</span><span class="op" id="6614573">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614586">if</span>&nbsp;<span class="ident" id="6614589">err</span><span class="op" id="6614592">.</span><span class="ident" id="6614593">Temporary</span><span class="op" id="6614602">(</span><span class="op" id="6614603">)</span>&nbsp;<span class="op" id="6614605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614612">qstats</span><span class="op" id="6614618">.</span><span class="ident" id="6614619">temporary</span><span class="op" id="6614628">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614641">if</span>&nbsp;<span class="op" id="6614644">!</span><span class="ident" id="6614645">err</span><span class="op" id="6614648">.</span><span class="ident" id="6614649">Timeout</span><span class="op" id="6614656">(</span><span class="op" id="6614657">)</span>&nbsp;<span class="op" id="6614659">&amp;&amp;</span>&nbsp;<span class="op" id="6614662">!</span><span class="ident" id="6614663">err</span><span class="op" id="6614666">.</span><span class="ident" id="6614667">Temporary</span><span class="op" id="6614676">(</span><span class="op" id="6614677">)</span>&nbsp;<span class="op" id="6614679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614686">qstats</span><span class="op" id="6614692">.</span><span class="ident" id="6614693">other</span><span class="op" id="6614698">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6614710">default</span><span class="op" id="6614717">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614723">qstats</span><span class="op" id="6614729">.</span><span class="ident" id="6614730">failed</span><span class="op" id="6614736">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6614743">qstats</span><span class="op" id="6614749">.</span><span class="ident" id="6614750">unknown</span><span class="op" id="6614757">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6614770">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6614774">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6614836">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6614899">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6614957">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6615020">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6615078">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6615141">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6615179">t</span><span class="op" id="6615180">.</span><span class="ident" id="6615181">Logf</span><span class="op" id="6615185">(</span><span class="string" id="6615186">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="6615260">,</span>&nbsp;<span class="ident" id="6615262">qstats</span><span class="op" id="6615268">.</span><span class="ident" id="6615269">succeeded</span><span class="op" id="6615278">,</span>&nbsp;<span class="ident" id="6615280">qstats</span><span class="op" id="6615286">.</span><span class="ident" id="6615287">failed</span><span class="op" id="6615293">,</span>&nbsp;<span class="ident" id="6615295">qstats</span><span class="op" id="6615301">.</span><span class="ident" id="6615302">timeout</span><span class="op" id="6615309">,</span>&nbsp;<span class="ident" id="6615311">qstats</span><span class="op" id="6615317">.</span><span class="ident" id="6615318">temporary</span><span class="op" id="6615327">,</span>&nbsp;<span class="ident" id="6615329">qstats</span><span class="op" id="6615335">.</span><span class="ident" id="6615336">other</span><span class="op" id="6615341">,</span>&nbsp;<span class="ident" id="6615343">qstats</span><span class="op" id="6615349">.</span><span class="ident" id="6615350">unknown</span><span class="op" id="6615357">)</span><br>
<span class="lineno"></span><span class="op" id="6615359">}</span>
</div>
</body>
</html>
