<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6977584">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6977639">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6977693">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6977744">package</span>&nbsp;<span class="ident" id="6977752">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6977757">import</span>&nbsp;<span class="op" id="6977764">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977767">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977777">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977784">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977790">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977797">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977804">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977825">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977836">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977847">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977855">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977870">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6977881">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6977888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6977891">var</span>&nbsp;<span class="op" id="6977895">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6977898">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6977924">*</span><span class="ident" id="6977925">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6977933">serverAddr</span><span class="op" id="6977943">,</span>&nbsp;<span class="ident" id="6977945">newServerAddr</span>&nbsp;<span class="builtintype" id="6977959">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6977967">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6977993">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978001">once</span><span class="op" id="6978005">,</span>&nbsp;<span class="ident" id="6978007">newOnce</span><span class="op" id="6978014">,</span>&nbsp;<span class="ident" id="6978016">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6978027">sync</span><span class="op" id="6978031">.</span><span class="ident" id="6978032">Once</span><br>
<span class="lineno"></span><span class="op" id="6978037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978040">const</span>&nbsp;<span class="op" id="6978046">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978049">newHttpPath</span>&nbsp;<span class="op" id="6978061">=</span>&nbsp;<span class="string" id="6978063">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="6978070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978073">type</span>&nbsp;<span class="ident" id="6978078">Args</span>&nbsp;<span class="keyword" id="6978083">struct</span>&nbsp;<span class="op" id="6978090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978093">A</span><span class="op" id="6978094">,</span>&nbsp;<span class="ident" id="6978096">B</span>&nbsp;<span class="builtintype" id="6978098">int</span><br>
<span class="lineno">35</span><span class="op" id="6978102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978105">type</span>&nbsp;<span class="ident" id="6978110">Reply</span>&nbsp;<span class="keyword" id="6978116">struct</span>&nbsp;<span class="op" id="6978123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978126">C</span>&nbsp;<span class="builtintype" id="6978128">int</span><br>
<span class="lineno"></span><span class="op" id="6978132">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6978135">type</span>&nbsp;<span class="ident" id="6978140">Arith</span>&nbsp;<span class="builtintype" id="6978146">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6978151">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6978239">func</span>&nbsp;<span class="op" id="6978244">(</span><span class="ident" id="6978245">t</span>&nbsp;<span class="op" id="6978247">*</span><span class="ident" id="6978248">Arith</span><span class="op" id="6978253">)</span>&nbsp;<span class="ident" id="6978255">Add</span><span class="op" id="6978258">(</span><span class="ident" id="6978259">args</span>&nbsp;<span class="ident" id="6978264">Args</span><span class="op" id="6978268">,</span>&nbsp;<span class="ident" id="6978270">reply</span>&nbsp;<span class="op" id="6978276">*</span><span class="ident" id="6978277">Reply</span><span class="op" id="6978282">)</span>&nbsp;<span class="builtintype" id="6978284">error</span>&nbsp;<span class="op" id="6978290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978293">reply</span><span class="op" id="6978298">.</span><span class="ident" id="6978299">C</span>&nbsp;<span class="op" id="6978301">=</span>&nbsp;<span class="ident" id="6978303">args</span><span class="op" id="6978307">.</span><span class="ident" id="6978308">A</span>&nbsp;<span class="op" id="6978310">+</span>&nbsp;<span class="ident" id="6978312">args</span><span class="op" id="6978316">.</span><span class="ident" id="6978317">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978320">return</span>&nbsp;<span class="ident" id="6978327">nil</span><br>
<span class="lineno"></span><span class="op" id="6978331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6978334">func</span>&nbsp;<span class="op" id="6978339">(</span><span class="ident" id="6978340">t</span>&nbsp;<span class="op" id="6978342">*</span><span class="ident" id="6978343">Arith</span><span class="op" id="6978348">)</span>&nbsp;<span class="ident" id="6978350">Mul</span><span class="op" id="6978353">(</span><span class="ident" id="6978354">args</span>&nbsp;<span class="op" id="6978359">*</span><span class="ident" id="6978360">Args</span><span class="op" id="6978364">,</span>&nbsp;<span class="ident" id="6978366">reply</span>&nbsp;<span class="op" id="6978372">*</span><span class="ident" id="6978373">Reply</span><span class="op" id="6978378">)</span>&nbsp;<span class="builtintype" id="6978380">error</span>&nbsp;<span class="op" id="6978386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978389">reply</span><span class="op" id="6978394">.</span><span class="ident" id="6978395">C</span>&nbsp;<span class="op" id="6978397">=</span>&nbsp;<span class="ident" id="6978399">args</span><span class="op" id="6978403">.</span><span class="ident" id="6978404">A</span>&nbsp;<span class="op" id="6978406">*</span>&nbsp;<span class="ident" id="6978408">args</span><span class="op" id="6978412">.</span><span class="ident" id="6978413">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978416">return</span>&nbsp;<span class="ident" id="6978423">nil</span><br>
<span class="lineno"></span><span class="op" id="6978427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6978430">func</span>&nbsp;<span class="op" id="6978435">(</span><span class="ident" id="6978436">t</span>&nbsp;<span class="op" id="6978438">*</span><span class="ident" id="6978439">Arith</span><span class="op" id="6978444">)</span>&nbsp;<span class="ident" id="6978446">Div</span><span class="op" id="6978449">(</span><span class="ident" id="6978450">args</span>&nbsp;<span class="ident" id="6978455">Args</span><span class="op" id="6978459">,</span>&nbsp;<span class="ident" id="6978461">reply</span>&nbsp;<span class="op" id="6978467">*</span><span class="ident" id="6978468">Reply</span><span class="op" id="6978473">)</span>&nbsp;<span class="builtintype" id="6978475">error</span>&nbsp;<span class="op" id="6978481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978484">if</span>&nbsp;<span class="ident" id="6978487">args</span><span class="op" id="6978491">.</span><span class="ident" id="6978492">B</span>&nbsp;<span class="op" id="6978494">==</span>&nbsp;<span class="num" id="6978497">0</span>&nbsp;<span class="op" id="6978499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978503">return</span>&nbsp;<span class="ident" id="6978510">errors</span><span class="op" id="6978516">.</span><span class="ident" id="6978517">New</span><span class="op" id="6978520">(</span><span class="string" id="6978521">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6978537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6978540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978543">reply</span><span class="op" id="6978548">.</span><span class="ident" id="6978549">C</span>&nbsp;<span class="op" id="6978551">=</span>&nbsp;<span class="ident" id="6978553">args</span><span class="op" id="6978557">.</span><span class="ident" id="6978558">A</span>&nbsp;<span class="op" id="6978560">/</span>&nbsp;<span class="ident" id="6978562">args</span><span class="op" id="6978566">.</span><span class="ident" id="6978567">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978570">return</span>&nbsp;<span class="ident" id="6978577">nil</span><br>
<span class="lineno"></span><span class="op" id="6978581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978584">func</span>&nbsp;<span class="op" id="6978589">(</span><span class="ident" id="6978590">t</span>&nbsp;<span class="op" id="6978592">*</span><span class="ident" id="6978593">Arith</span><span class="op" id="6978598">)</span>&nbsp;<span class="ident" id="6978600">String</span><span class="op" id="6978606">(</span><span class="ident" id="6978607">args</span>&nbsp;<span class="op" id="6978612">*</span><span class="ident" id="6978613">Args</span><span class="op" id="6978617">,</span>&nbsp;<span class="ident" id="6978619">reply</span>&nbsp;<span class="op" id="6978625">*</span><span class="builtintype" id="6978626">string</span><span class="op" id="6978632">)</span>&nbsp;<span class="builtintype" id="6978634">error</span>&nbsp;<span class="op" id="6978640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6978643">*</span><span class="ident" id="6978644">reply</span>&nbsp;<span class="op" id="6978650">=</span>&nbsp;<span class="ident" id="6978652">fmt</span><span class="op" id="6978655">.</span><span class="ident" id="6978656">Sprintf</span><span class="op" id="6978663">(</span><span class="string" id="6978664">&#34;%d+%d=%d&#34;</span><span class="op" id="6978674">,</span>&nbsp;<span class="ident" id="6978676">args</span><span class="op" id="6978680">.</span><span class="ident" id="6978681">A</span><span class="op" id="6978682">,</span>&nbsp;<span class="ident" id="6978684">args</span><span class="op" id="6978688">.</span><span class="ident" id="6978689">B</span><span class="op" id="6978690">,</span>&nbsp;<span class="ident" id="6978692">args</span><span class="op" id="6978696">.</span><span class="ident" id="6978697">A</span><span class="op" id="6978698">+</span><span class="ident" id="6978699">args</span><span class="op" id="6978703">.</span><span class="ident" id="6978704">B</span><span class="op" id="6978705">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978708">return</span>&nbsp;<span class="ident" id="6978715">nil</span><br>
<span class="lineno"></span><span class="op" id="6978719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978722">func</span>&nbsp;<span class="op" id="6978727">(</span><span class="ident" id="6978728">t</span>&nbsp;<span class="op" id="6978730">*</span><span class="ident" id="6978731">Arith</span><span class="op" id="6978736">)</span>&nbsp;<span class="ident" id="6978738">Scan</span><span class="op" id="6978742">(</span><span class="ident" id="6978743">args</span>&nbsp;<span class="builtintype" id="6978748">string</span><span class="op" id="6978754">,</span>&nbsp;<span class="ident" id="6978756">reply</span>&nbsp;<span class="op" id="6978762">*</span><span class="ident" id="6978763">Reply</span><span class="op" id="6978768">)</span>&nbsp;<span class="op" id="6978770">(</span><span class="ident" id="6978771">err</span>&nbsp;<span class="builtintype" id="6978775">error</span><span class="op" id="6978780">)</span>&nbsp;<span class="op" id="6978782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978785">_</span><span class="op" id="6978786">,</span>&nbsp;<span class="ident" id="6978788">err</span>&nbsp;<span class="op" id="6978792">=</span>&nbsp;<span class="ident" id="6978794">fmt</span><span class="op" id="6978797">.</span><span class="ident" id="6978798">Sscan</span><span class="op" id="6978803">(</span><span class="ident" id="6978804">args</span><span class="op" id="6978808">,</span>&nbsp;<span class="op" id="6978810">&amp;</span><span class="ident" id="6978811">reply</span><span class="op" id="6978816">.</span><span class="ident" id="6978817">C</span><span class="op" id="6978818">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6978821">return</span><br>
<span class="lineno"></span><span class="op" id="6978828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978831">func</span>&nbsp;<span class="op" id="6978836">(</span><span class="ident" id="6978837">t</span>&nbsp;<span class="op" id="6978839">*</span><span class="ident" id="6978840">Arith</span><span class="op" id="6978845">)</span>&nbsp;<span class="ident" id="6978847">Error</span><span class="op" id="6978852">(</span><span class="ident" id="6978853">args</span>&nbsp;<span class="op" id="6978858">*</span><span class="ident" id="6978859">Args</span><span class="op" id="6978863">,</span>&nbsp;<span class="ident" id="6978865">reply</span>&nbsp;<span class="op" id="6978871">*</span><span class="ident" id="6978872">Reply</span><span class="op" id="6978877">)</span>&nbsp;<span class="builtintype" id="6978879">error</span>&nbsp;<span class="op" id="6978885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6978888">panic</span><span class="op" id="6978893">(</span><span class="string" id="6978894">&#34;ERROR&#34;</span><span class="op" id="6978901">)</span><br>
<span class="lineno">75</span><span class="op" id="6978903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6978906">func</span>&nbsp;<span class="ident" id="6978911">listenTCP</span><span class="op" id="6978920">(</span><span class="op" id="6978921">)</span>&nbsp;<span class="op" id="6978923">(</span><span class="ident" id="6978924">net</span><span class="op" id="6978927">.</span><span class="ident" id="6978928">Listener</span><span class="op" id="6978936">,</span>&nbsp;<span class="builtintype" id="6978938">string</span><span class="op" id="6978944">)</span>&nbsp;<span class="op" id="6978946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6978949">l</span><span class="op" id="6978950">,</span>&nbsp;<span class="ident" id="6978952">e</span>&nbsp;<span class="op" id="6978954">:=</span>&nbsp;<span class="ident" id="6978957">net</span><span class="op" id="6978960">.</span><span class="ident" id="6978961">Listen</span><span class="op" id="6978967">(</span><span class="string" id="6978968">&#34;tcp&#34;</span><span class="op" id="6978973">,</span>&nbsp;<span class="string" id="6978975">&#34;127.0.0.1:0&#34;</span><span class="op" id="6978988">)</span>&nbsp;<span class="comment" id="6978990">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979016">if</span>&nbsp;<span class="ident" id="6979019">e</span>&nbsp;<span class="op" id="6979021">!=</span>&nbsp;<span class="ident" id="6979024">nil</span>&nbsp;<span class="op" id="6979028">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979032">log</span><span class="op" id="6979035">.</span><span class="ident" id="6979036">Fatalf</span><span class="op" id="6979042">(</span><span class="string" id="6979043">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6979066">,</span>&nbsp;<span class="ident" id="6979068">e</span><span class="op" id="6979069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6979072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979075">return</span>&nbsp;<span class="ident" id="6979082">l</span><span class="op" id="6979083">,</span>&nbsp;<span class="ident" id="6979085">l</span><span class="op" id="6979086">.</span><span class="ident" id="6979087">Addr</span><span class="op" id="6979091">(</span><span class="op" id="6979092">)</span><span class="op" id="6979093">.</span><span class="ident" id="6979094">String</span><span class="op" id="6979100">(</span><span class="op" id="6979101">)</span><br>
<span class="lineno"></span><span class="op" id="6979103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="6979106">func</span>&nbsp;<span class="ident" id="6979111">startServer</span><span class="op" id="6979122">(</span><span class="op" id="6979123">)</span>&nbsp;<span class="op" id="6979125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979128">Register</span><span class="op" id="6979136">(</span><span class="builtinfunc" id="6979137">new</span><span class="op" id="6979140">(</span><span class="ident" id="6979141">Arith</span><span class="op" id="6979146">)</span><span class="op" id="6979147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979150">RegisterName</span><span class="op" id="6979162">(</span><span class="string" id="6979163">&#34;net.rpc.Arith&#34;</span><span class="op" id="6979178">,</span>&nbsp;<span class="builtinfunc" id="6979180">new</span><span class="op" id="6979183">(</span><span class="ident" id="6979184">Arith</span><span class="op" id="6979189">)</span><span class="op" id="6979190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979194">var</span>&nbsp;<span class="ident" id="6979198">l</span>&nbsp;<span class="ident" id="6979200">net</span><span class="op" id="6979203">.</span><span class="ident" id="6979204">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979214">l</span><span class="op" id="6979215">,</span>&nbsp;<span class="ident" id="6979217">serverAddr</span>&nbsp;<span class="op" id="6979228">=</span>&nbsp;<span class="ident" id="6979230">listenTCP</span><span class="op" id="6979239">(</span><span class="op" id="6979240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979243">log</span><span class="op" id="6979246">.</span><span class="ident" id="6979247">Println</span><span class="op" id="6979254">(</span><span class="string" id="6979255">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6979285">,</span>&nbsp;<span class="ident" id="6979287">serverAddr</span><span class="op" id="6979297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979300">go</span>&nbsp;<span class="ident" id="6979303">Accept</span><span class="op" id="6979309">(</span><span class="ident" id="6979310">l</span><span class="op" id="6979311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979315">HandleHTTP</span><span class="op" id="6979325">(</span><span class="op" id="6979326">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979329">httpOnce</span><span class="op" id="6979337">.</span><span class="ident" id="6979338">Do</span><span class="op" id="6979340">(</span><span class="ident" id="6979341">startHttpServer</span><span class="op" id="6979356">)</span><br>
<span class="lineno"></span><span class="op" id="6979358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6979361">func</span>&nbsp;<span class="ident" id="6979366">startNewServer</span><span class="op" id="6979380">(</span><span class="op" id="6979381">)</span>&nbsp;<span class="op" id="6979383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979386">newServer</span>&nbsp;<span class="op" id="6979396">=</span>&nbsp;<span class="ident" id="6979398">NewServer</span><span class="op" id="6979407">(</span><span class="op" id="6979408">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979411">newServer</span><span class="op" id="6979420">.</span><span class="ident" id="6979421">Register</span><span class="op" id="6979429">(</span><span class="builtinfunc" id="6979430">new</span><span class="op" id="6979433">(</span><span class="ident" id="6979434">Arith</span><span class="op" id="6979439">)</span><span class="op" id="6979440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979443">newServer</span><span class="op" id="6979452">.</span><span class="ident" id="6979453">RegisterName</span><span class="op" id="6979465">(</span><span class="string" id="6979466">&#34;net.rpc.Arith&#34;</span><span class="op" id="6979481">,</span>&nbsp;<span class="builtinfunc" id="6979483">new</span><span class="op" id="6979486">(</span><span class="ident" id="6979487">Arith</span><span class="op" id="6979492">)</span><span class="op" id="6979493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979496">newServer</span><span class="op" id="6979505">.</span><span class="ident" id="6979506">RegisterName</span><span class="op" id="6979518">(</span><span class="string" id="6979519">&#34;newServer.Arith&#34;</span><span class="op" id="6979536">,</span>&nbsp;<span class="builtinfunc" id="6979538">new</span><span class="op" id="6979541">(</span><span class="ident" id="6979542">Arith</span><span class="op" id="6979547">)</span><span class="op" id="6979548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979552">var</span>&nbsp;<span class="ident" id="6979556">l</span>&nbsp;<span class="ident" id="6979558">net</span><span class="op" id="6979561">.</span><span class="ident" id="6979562">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979572">l</span><span class="op" id="6979573">,</span>&nbsp;<span class="ident" id="6979575">newServerAddr</span>&nbsp;<span class="op" id="6979589">=</span>&nbsp;<span class="ident" id="6979591">listenTCP</span><span class="op" id="6979600">(</span><span class="op" id="6979601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979604">log</span><span class="op" id="6979607">.</span><span class="ident" id="6979608">Println</span><span class="op" id="6979615">(</span><span class="string" id="6979616">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6979656">,</span>&nbsp;<span class="ident" id="6979658">newServerAddr</span><span class="op" id="6979671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6979674">go</span>&nbsp;<span class="ident" id="6979677">newServer</span><span class="op" id="6979686">.</span><span class="ident" id="6979687">Accept</span><span class="op" id="6979693">(</span><span class="ident" id="6979694">l</span><span class="op" id="6979695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979699">newServer</span><span class="op" id="6979708">.</span><span class="ident" id="6979709">HandleHTTP</span><span class="op" id="6979719">(</span><span class="ident" id="6979720">newHttpPath</span><span class="op" id="6979731">,</span>&nbsp;<span class="string" id="6979733">&#34;/bar&#34;</span><span class="op" id="6979739">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979742">httpOnce</span><span class="op" id="6979750">.</span><span class="ident" id="6979751">Do</span><span class="op" id="6979753">(</span><span class="ident" id="6979754">startHttpServer</span><span class="op" id="6979769">)</span><br>
<span class="lineno"></span><span class="op" id="6979771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6979774">func</span>&nbsp;<span class="ident" id="6979779">startHttpServer</span><span class="op" id="6979794">(</span><span class="op" id="6979795">)</span>&nbsp;<span class="op" id="6979797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979800">server</span>&nbsp;<span class="op" id="6979807">:=</span>&nbsp;<span class="ident" id="6979810">httptest</span><span class="op" id="6979818">.</span><span class="ident" id="6979819">NewServer</span><span class="op" id="6979828">(</span><span class="ident" id="6979829">nil</span><span class="op" id="6979832">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979835">httpServerAddr</span>&nbsp;<span class="op" id="6979850">=</span>&nbsp;<span class="ident" id="6979852">server</span><span class="op" id="6979858">.</span><span class="ident" id="6979859">Listener</span><span class="op" id="6979867">.</span><span class="ident" id="6979868">Addr</span><span class="op" id="6979872">(</span><span class="op" id="6979873">)</span><span class="op" id="6979874">.</span><span class="ident" id="6979875">String</span><span class="op" id="6979881">(</span><span class="op" id="6979882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979885">log</span><span class="op" id="6979888">.</span><span class="ident" id="6979889">Println</span><span class="op" id="6979896">(</span><span class="string" id="6979897">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6979932">,</span>&nbsp;<span class="ident" id="6979934">httpServerAddr</span><span class="op" id="6979948">)</span><br>
<span class="lineno"></span><span class="op" id="6979950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6979953">func</span>&nbsp;<span class="ident" id="6979958">TestRPC</span><span class="op" id="6979965">(</span><span class="ident" id="6979966">t</span>&nbsp;<span class="op" id="6979968">*</span><span class="ident" id="6979969">testing</span><span class="op" id="6979976">.</span><span class="ident" id="6979977">T</span><span class="op" id="6979978">)</span>&nbsp;<span class="op" id="6979980">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6979983">once</span><span class="op" id="6979987">.</span><span class="ident" id="6979988">Do</span><span class="op" id="6979990">(</span><span class="ident" id="6979991">startServer</span><span class="op" id="6980002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980005">testRPC</span><span class="op" id="6980012">(</span><span class="ident" id="6980013">t</span><span class="op" id="6980014">,</span>&nbsp;<span class="ident" id="6980016">serverAddr</span><span class="op" id="6980026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980029">newOnce</span><span class="op" id="6980036">.</span><span class="ident" id="6980037">Do</span><span class="op" id="6980039">(</span><span class="ident" id="6980040">startNewServer</span><span class="op" id="6980054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980057">testRPC</span><span class="op" id="6980064">(</span><span class="ident" id="6980065">t</span><span class="op" id="6980066">,</span>&nbsp;<span class="ident" id="6980068">newServerAddr</span><span class="op" id="6980081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980084">testNewServerRPC</span><span class="op" id="6980100">(</span><span class="ident" id="6980101">t</span><span class="op" id="6980102">,</span>&nbsp;<span class="ident" id="6980104">newServerAddr</span><span class="op" id="6980117">)</span><br>
<span class="lineno">125</span><span class="op" id="6980119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6980122">func</span>&nbsp;<span class="ident" id="6980127">testRPC</span><span class="op" id="6980134">(</span><span class="ident" id="6980135">t</span>&nbsp;<span class="op" id="6980137">*</span><span class="ident" id="6980138">testing</span><span class="op" id="6980145">.</span><span class="ident" id="6980146">T</span><span class="op" id="6980147">,</span>&nbsp;<span class="ident" id="6980149">addr</span>&nbsp;<span class="builtintype" id="6980154">string</span><span class="op" id="6980160">)</span>&nbsp;<span class="op" id="6980162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980165">client</span><span class="op" id="6980171">,</span>&nbsp;<span class="ident" id="6980173">err</span>&nbsp;<span class="op" id="6980177">:=</span>&nbsp;<span class="ident" id="6980180">Dial</span><span class="op" id="6980184">(</span><span class="string" id="6980185">&#34;tcp&#34;</span><span class="op" id="6980190">,</span>&nbsp;<span class="ident" id="6980192">addr</span><span class="op" id="6980196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6980199">if</span>&nbsp;<span class="ident" id="6980202">err</span>&nbsp;<span class="op" id="6980206">!=</span>&nbsp;<span class="ident" id="6980209">nil</span>&nbsp;<span class="op" id="6980213">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980217">t</span><span class="op" id="6980218">.</span><span class="ident" id="6980219">Fatal</span><span class="op" id="6980224">(</span><span class="string" id="6980225">&#34;dialing&#34;</span><span class="op" id="6980234">,</span>&nbsp;<span class="ident" id="6980236">err</span><span class="op" id="6980239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6980242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6980245">defer</span>&nbsp;<span class="ident" id="6980251">client</span><span class="op" id="6980257">.</span><span class="ident" id="6980258">Close</span><span class="op" id="6980263">(</span><span class="op" id="6980264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6980268">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980290">args</span>&nbsp;<span class="op" id="6980295">:=</span>&nbsp;<span class="op" id="6980298">&amp;</span><span class="ident" id="6980299">Args</span><span class="op" id="6980303">{</span><span class="num" id="6980304">7</span><span class="op" id="6980305">,</span>&nbsp;<span class="num" id="6980307">8</span><span class="op" id="6980308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980311">reply</span>&nbsp;<span class="op" id="6980317">:=</span>&nbsp;<span class="builtinfunc" id="6980320">new</span><span class="op" id="6980323">(</span><span class="ident" id="6980324">Reply</span><span class="op" id="6980329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980332">err</span>&nbsp;<span class="op" id="6980336">=</span>&nbsp;<span class="ident" id="6980338">client</span><span class="op" id="6980344">.</span><span class="ident" id="6980345">Call</span><span class="op" id="6980349">(</span><span class="string" id="6980350">&#34;Arith.Add&#34;</span><span class="op" id="6980361">,</span>&nbsp;<span class="ident" id="6980363">args</span><span class="op" id="6980367">,</span>&nbsp;<span class="ident" id="6980369">reply</span><span class="op" id="6980374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6980377">if</span>&nbsp;<span class="ident" id="6980380">err</span>&nbsp;<span class="op" id="6980384">!=</span>&nbsp;<span class="ident" id="6980387">nil</span>&nbsp;<span class="op" id="6980391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980395">t</span><span class="op" id="6980396">.</span><span class="ident" id="6980397">Errorf</span><span class="op" id="6980403">(</span><span class="string" id="6980404">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6980446">,</span>&nbsp;<span class="ident" id="6980448">err</span><span class="op" id="6980451">.</span><span class="ident" id="6980452">Error</span><span class="op" id="6980457">(</span><span class="op" id="6980458">)</span><span class="op" id="6980459">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6980462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6980465">if</span>&nbsp;<span class="ident" id="6980468">reply</span><span class="op" id="6980473">.</span><span class="ident" id="6980474">C</span>&nbsp;<span class="op" id="6980476">!=</span>&nbsp;<span class="ident" id="6980479">args</span><span class="op" id="6980483">.</span><span class="ident" id="6980484">A</span><span class="op" id="6980485">+</span><span class="ident" id="6980486">args</span><span class="op" id="6980490">.</span><span class="ident" id="6980491">B</span>&nbsp;<span class="op" id="6980493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980497">t</span><span class="op" id="6980498">.</span><span class="ident" id="6980499">Errorf</span><span class="op" id="6980505">(</span><span class="string" id="6980506">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6980531">,</span>&nbsp;<span class="ident" id="6980533">reply</span><span class="op" id="6980538">.</span><span class="ident" id="6980539">C</span><span class="op" id="6980540">,</span>&nbsp;<span class="ident" id="6980542">args</span><span class="op" id="6980546">.</span><span class="ident" id="6980547">A</span><span class="op" id="6980548">+</span><span class="ident" id="6980549">args</span><span class="op" id="6980553">.</span><span class="ident" id="6980554">B</span><span class="op" id="6980555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6980558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6980562">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980585">args</span>&nbsp;<span class="op" id="6980590">=</span>&nbsp;<span class="op" id="6980592">&amp;</span><span class="ident" id="6980593">Args</span><span class="op" id="6980597">{</span><span class="num" id="6980598">7</span><span class="op" id="6980599">,</span>&nbsp;<span class="num" id="6980601">0</span><span class="op" id="6980602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980605">reply</span>&nbsp;<span class="op" id="6980611">=</span>&nbsp;<span class="builtinfunc" id="6980613">new</span><span class="op" id="6980616">(</span><span class="ident" id="6980617">Reply</span><span class="op" id="6980622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980625">err</span>&nbsp;<span class="op" id="6980629">=</span>&nbsp;<span class="ident" id="6980631">client</span><span class="op" id="6980637">.</span><span class="ident" id="6980638">Call</span><span class="op" id="6980642">(</span><span class="string" id="6980643">&#34;Arith.BadOperation&#34;</span><span class="op" id="6980663">,</span>&nbsp;<span class="ident" id="6980665">args</span><span class="op" id="6980669">,</span>&nbsp;<span class="ident" id="6980671">reply</span><span class="op" id="6980676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6980679">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6980699">if</span>&nbsp;<span class="ident" id="6980702">err</span>&nbsp;<span class="op" id="6980706">==</span>&nbsp;<span class="ident" id="6980709">nil</span>&nbsp;<span class="op" id="6980713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980717">t</span><span class="op" id="6980718">.</span><span class="ident" id="6980719">Error</span><span class="op" id="6980724">(</span><span class="string" id="6980725">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6980755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6980758">}</span>&nbsp;<span class="keyword" id="6980760">else</span>&nbsp;<span class="keyword" id="6980765">if</span>&nbsp;<span class="op" id="6980768">!</span><span class="ident" id="6980769">strings</span><span class="op" id="6980776">.</span><span class="ident" id="6980777">HasPrefix</span><span class="op" id="6980786">(</span><span class="ident" id="6980787">err</span><span class="op" id="6980790">.</span><span class="ident" id="6980791">Error</span><span class="op" id="6980796">(</span><span class="op" id="6980797">)</span><span class="op" id="6980798">,</span>&nbsp;<span class="string" id="6980800">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="6980825">)</span>&nbsp;<span class="op" id="6980827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980831">t</span><span class="op" id="6980832">.</span><span class="ident" id="6980833">Errorf</span><span class="op" id="6980839">(</span><span class="string" id="6980840">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6980896">,</span>&nbsp;<span class="ident" id="6980898">err</span><span class="op" id="6980901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6980904">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6980908">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980928">args</span>&nbsp;<span class="op" id="6980933">=</span>&nbsp;<span class="op" id="6980935">&amp;</span><span class="ident" id="6980936">Args</span><span class="op" id="6980940">{</span><span class="num" id="6980941">7</span><span class="op" id="6980942">,</span>&nbsp;<span class="num" id="6980944">8</span><span class="op" id="6980945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980948">reply</span>&nbsp;<span class="op" id="6980954">=</span>&nbsp;<span class="builtinfunc" id="6980956">new</span><span class="op" id="6980959">(</span><span class="ident" id="6980960">Reply</span><span class="op" id="6980965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6980968">err</span>&nbsp;<span class="op" id="6980972">=</span>&nbsp;<span class="ident" id="6980974">client</span><span class="op" id="6980980">.</span><span class="ident" id="6980981">Call</span><span class="op" id="6980985">(</span><span class="string" id="6980986">&#34;Arith.Unknown&#34;</span><span class="op" id="6981001">,</span>&nbsp;<span class="ident" id="6981003">args</span><span class="op" id="6981007">,</span>&nbsp;<span class="ident" id="6981009">reply</span><span class="op" id="6981014">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6981017">if</span>&nbsp;<span class="ident" id="6981020">err</span>&nbsp;<span class="op" id="6981024">==</span>&nbsp;<span class="ident" id="6981027">nil</span>&nbsp;<span class="op" id="6981031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981035">t</span><span class="op" id="6981036">.</span><span class="ident" id="6981037">Error</span><span class="op" id="6981042">(</span><span class="string" id="6981043">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="6981083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981086">}</span>&nbsp;<span class="keyword" id="6981088">else</span>&nbsp;<span class="keyword" id="6981093">if</span>&nbsp;<span class="ident" id="6981096">strings</span><span class="op" id="6981103">.</span><span class="ident" id="6981104">Index</span><span class="op" id="6981109">(</span><span class="ident" id="6981110">err</span><span class="op" id="6981113">.</span><span class="ident" id="6981114">Error</span><span class="op" id="6981119">(</span><span class="op" id="6981120">)</span><span class="op" id="6981121">,</span>&nbsp;<span class="string" id="6981123">&#34;method&#34;</span><span class="op" id="6981131">)</span>&nbsp;<span class="op" id="6981133">&lt;</span>&nbsp;<span class="num" id="6981135">0</span>&nbsp;<span class="op" id="6981137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981141">t</span><span class="op" id="6981142">.</span><span class="ident" id="6981143">Error</span><span class="op" id="6981148">(</span><span class="string" id="6981149">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="6981183">,</span>&nbsp;<span class="ident" id="6981185">err</span><span class="op" id="6981188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981191">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6981195">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981213">args</span>&nbsp;<span class="op" id="6981218">=</span>&nbsp;<span class="op" id="6981220">&amp;</span><span class="ident" id="6981221">Args</span><span class="op" id="6981225">{</span><span class="num" id="6981226">7</span><span class="op" id="6981227">,</span>&nbsp;<span class="num" id="6981229">8</span><span class="op" id="6981230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981233">mulReply</span>&nbsp;<span class="op" id="6981242">:=</span>&nbsp;<span class="builtinfunc" id="6981245">new</span><span class="op" id="6981248">(</span><span class="ident" id="6981249">Reply</span><span class="op" id="6981254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981257">mulCall</span>&nbsp;<span class="op" id="6981265">:=</span>&nbsp;<span class="ident" id="6981268">client</span><span class="op" id="6981274">.</span><span class="ident" id="6981275">Go</span><span class="op" id="6981277">(</span><span class="string" id="6981278">&#34;Arith.Mul&#34;</span><span class="op" id="6981289">,</span>&nbsp;<span class="ident" id="6981291">args</span><span class="op" id="6981295">,</span>&nbsp;<span class="ident" id="6981297">mulReply</span><span class="op" id="6981305">,</span>&nbsp;<span class="ident" id="6981307">nil</span><span class="op" id="6981310">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981313">addReply</span>&nbsp;<span class="op" id="6981322">:=</span>&nbsp;<span class="builtinfunc" id="6981325">new</span><span class="op" id="6981328">(</span><span class="ident" id="6981329">Reply</span><span class="op" id="6981334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981337">addCall</span>&nbsp;<span class="op" id="6981345">:=</span>&nbsp;<span class="ident" id="6981348">client</span><span class="op" id="6981354">.</span><span class="ident" id="6981355">Go</span><span class="op" id="6981357">(</span><span class="string" id="6981358">&#34;Arith.Add&#34;</span><span class="op" id="6981369">,</span>&nbsp;<span class="ident" id="6981371">args</span><span class="op" id="6981375">,</span>&nbsp;<span class="ident" id="6981377">addReply</span><span class="op" id="6981385">,</span>&nbsp;<span class="ident" id="6981387">nil</span><span class="op" id="6981390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981394">addCall</span>&nbsp;<span class="op" id="6981402">=</span>&nbsp;<span class="op" id="6981404">&lt;-</span><span class="ident" id="6981406">addCall</span><span class="op" id="6981413">.</span><span class="ident" id="6981414">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6981420">if</span>&nbsp;<span class="ident" id="6981423">addCall</span><span class="op" id="6981430">.</span><span class="ident" id="6981431">Error</span>&nbsp;<span class="op" id="6981437">!=</span>&nbsp;<span class="ident" id="6981440">nil</span>&nbsp;<span class="op" id="6981444">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981448">t</span><span class="op" id="6981449">.</span><span class="ident" id="6981450">Errorf</span><span class="op" id="6981456">(</span><span class="string" id="6981457">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6981499">,</span>&nbsp;<span class="ident" id="6981501">addCall</span><span class="op" id="6981508">.</span><span class="ident" id="6981509">Error</span><span class="op" id="6981514">.</span><span class="ident" id="6981515">Error</span><span class="op" id="6981520">(</span><span class="op" id="6981521">)</span><span class="op" id="6981522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6981528">if</span>&nbsp;<span class="ident" id="6981531">addReply</span><span class="op" id="6981539">.</span><span class="ident" id="6981540">C</span>&nbsp;<span class="op" id="6981542">!=</span>&nbsp;<span class="ident" id="6981545">args</span><span class="op" id="6981549">.</span><span class="ident" id="6981550">A</span><span class="op" id="6981551">+</span><span class="ident" id="6981552">args</span><span class="op" id="6981556">.</span><span class="ident" id="6981557">B</span>&nbsp;<span class="op" id="6981559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981563">t</span><span class="op" id="6981564">.</span><span class="ident" id="6981565">Errorf</span><span class="op" id="6981571">(</span><span class="string" id="6981572">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6981597">,</span>&nbsp;<span class="ident" id="6981599">addReply</span><span class="op" id="6981607">.</span><span class="ident" id="6981608">C</span><span class="op" id="6981609">,</span>&nbsp;<span class="ident" id="6981611">args</span><span class="op" id="6981615">.</span><span class="ident" id="6981616">A</span><span class="op" id="6981617">+</span><span class="ident" id="6981618">args</span><span class="op" id="6981622">.</span><span class="ident" id="6981623">B</span><span class="op" id="6981624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981627">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981631">mulCall</span>&nbsp;<span class="op" id="6981639">=</span>&nbsp;<span class="op" id="6981641">&lt;-</span><span class="ident" id="6981643">mulCall</span><span class="op" id="6981650">.</span><span class="ident" id="6981651">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6981657">if</span>&nbsp;<span class="ident" id="6981660">mulCall</span><span class="op" id="6981667">.</span><span class="ident" id="6981668">Error</span>&nbsp;<span class="op" id="6981674">!=</span>&nbsp;<span class="ident" id="6981677">nil</span>&nbsp;<span class="op" id="6981681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981685">t</span><span class="op" id="6981686">.</span><span class="ident" id="6981687">Errorf</span><span class="op" id="6981693">(</span><span class="string" id="6981694">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6981736">,</span>&nbsp;<span class="ident" id="6981738">mulCall</span><span class="op" id="6981745">.</span><span class="ident" id="6981746">Error</span><span class="op" id="6981751">.</span><span class="ident" id="6981752">Error</span><span class="op" id="6981757">(</span><span class="op" id="6981758">)</span><span class="op" id="6981759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981762">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6981765">if</span>&nbsp;<span class="ident" id="6981768">mulReply</span><span class="op" id="6981776">.</span><span class="ident" id="6981777">C</span>&nbsp;<span class="op" id="6981779">!=</span>&nbsp;<span class="ident" id="6981782">args</span><span class="op" id="6981786">.</span><span class="ident" id="6981787">A</span><span class="op" id="6981788">*</span><span class="ident" id="6981789">args</span><span class="op" id="6981793">.</span><span class="ident" id="6981794">B</span>&nbsp;<span class="op" id="6981796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981800">t</span><span class="op" id="6981801">.</span><span class="ident" id="6981802">Errorf</span><span class="op" id="6981808">(</span><span class="string" id="6981809">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6981834">,</span>&nbsp;<span class="ident" id="6981836">mulReply</span><span class="op" id="6981844">.</span><span class="ident" id="6981845">C</span><span class="op" id="6981846">,</span>&nbsp;<span class="ident" id="6981848">args</span><span class="op" id="6981852">.</span><span class="ident" id="6981853">A</span><span class="op" id="6981854">*</span><span class="ident" id="6981855">args</span><span class="op" id="6981859">.</span><span class="ident" id="6981860">B</span><span class="op" id="6981861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6981864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6981868">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981883">args</span>&nbsp;<span class="op" id="6981888">=</span>&nbsp;<span class="op" id="6981890">&amp;</span><span class="ident" id="6981891">Args</span><span class="op" id="6981895">{</span><span class="num" id="6981896">7</span><span class="op" id="6981897">,</span>&nbsp;<span class="num" id="6981899">0</span><span class="op" id="6981900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981903">reply</span>&nbsp;<span class="op" id="6981909">=</span>&nbsp;<span class="builtinfunc" id="6981911">new</span><span class="op" id="6981914">(</span><span class="ident" id="6981915">Reply</span><span class="op" id="6981920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6981923">err</span>&nbsp;<span class="op" id="6981927">=</span>&nbsp;<span class="ident" id="6981929">client</span><span class="op" id="6981935">.</span><span class="ident" id="6981936">Call</span><span class="op" id="6981940">(</span><span class="string" id="6981941">&#34;Arith.Div&#34;</span><span class="op" id="6981952">,</span>&nbsp;<span class="ident" id="6981954">args</span><span class="op" id="6981958">,</span>&nbsp;<span class="ident" id="6981960">reply</span><span class="op" id="6981965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6981968">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6982001">if</span>&nbsp;<span class="ident" id="6982004">err</span>&nbsp;<span class="op" id="6982008">==</span>&nbsp;<span class="ident" id="6982011">nil</span>&nbsp;<span class="op" id="6982015">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982019">t</span><span class="op" id="6982020">.</span><span class="ident" id="6982021">Error</span><span class="op" id="6982026">(</span><span class="string" id="6982027">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6982048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982051">}</span>&nbsp;<span class="keyword" id="6982053">else</span>&nbsp;<span class="keyword" id="6982058">if</span>&nbsp;<span class="ident" id="6982061">err</span><span class="op" id="6982064">.</span><span class="ident" id="6982065">Error</span><span class="op" id="6982070">(</span><span class="op" id="6982071">)</span>&nbsp;<span class="op" id="6982073">!=</span>&nbsp;<span class="string" id="6982076">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6982093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982097">t</span><span class="op" id="6982098">.</span><span class="ident" id="6982099">Error</span><span class="op" id="6982104">(</span><span class="string" id="6982105">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6982146">,</span>&nbsp;<span class="ident" id="6982148">err</span><span class="op" id="6982151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6982158">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982172">reply</span>&nbsp;<span class="op" id="6982178">=</span>&nbsp;<span class="builtinfunc" id="6982180">new</span><span class="op" id="6982183">(</span><span class="ident" id="6982184">Reply</span><span class="op" id="6982189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982192">err</span>&nbsp;<span class="op" id="6982196">=</span>&nbsp;<span class="ident" id="6982198">client</span><span class="op" id="6982204">.</span><span class="ident" id="6982205">Call</span><span class="op" id="6982209">(</span><span class="string" id="6982210">&#34;Arith.Add&#34;</span><span class="op" id="6982221">,</span>&nbsp;<span class="ident" id="6982223">reply</span><span class="op" id="6982228">,</span>&nbsp;<span class="ident" id="6982230">reply</span><span class="op" id="6982235">)</span>&nbsp;<span class="comment" id="6982237">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6982287">if</span>&nbsp;<span class="ident" id="6982290">err</span>&nbsp;<span class="op" id="6982294">==</span>&nbsp;<span class="ident" id="6982297">nil</span>&nbsp;<span class="op" id="6982301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982305">t</span><span class="op" id="6982306">.</span><span class="ident" id="6982307">Error</span><span class="op" id="6982312">(</span><span class="string" id="6982313">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="6982367">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982370">}</span>&nbsp;<span class="keyword" id="6982372">else</span>&nbsp;<span class="keyword" id="6982377">if</span>&nbsp;<span class="ident" id="6982380">strings</span><span class="op" id="6982387">.</span><span class="ident" id="6982388">Index</span><span class="op" id="6982393">(</span><span class="ident" id="6982394">err</span><span class="op" id="6982397">.</span><span class="ident" id="6982398">Error</span><span class="op" id="6982403">(</span><span class="op" id="6982404">)</span><span class="op" id="6982405">,</span>&nbsp;<span class="string" id="6982407">&#34;type&#34;</span><span class="op" id="6982413">)</span>&nbsp;<span class="op" id="6982415">&lt;</span>&nbsp;<span class="num" id="6982417">0</span>&nbsp;<span class="op" id="6982419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982423">t</span><span class="op" id="6982424">.</span><span class="ident" id="6982425">Error</span><span class="op" id="6982430">(</span><span class="string" id="6982431">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="6982463">,</span>&nbsp;<span class="ident" id="6982465">err</span><span class="op" id="6982468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6982475">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6982499">const</span>&nbsp;<span class="ident" id="6982505">Val</span>&nbsp;<span class="op" id="6982509">=</span>&nbsp;<span class="num" id="6982511">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982518">str</span>&nbsp;<span class="op" id="6982522">:=</span>&nbsp;<span class="ident" id="6982525">fmt</span><span class="op" id="6982528">.</span><span class="ident" id="6982529">Sprint</span><span class="op" id="6982535">(</span><span class="ident" id="6982536">Val</span><span class="op" id="6982539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982542">reply</span>&nbsp;<span class="op" id="6982548">=</span>&nbsp;<span class="builtinfunc" id="6982550">new</span><span class="op" id="6982553">(</span><span class="ident" id="6982554">Reply</span><span class="op" id="6982559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982562">err</span>&nbsp;<span class="op" id="6982566">=</span>&nbsp;<span class="ident" id="6982568">client</span><span class="op" id="6982574">.</span><span class="ident" id="6982575">Call</span><span class="op" id="6982579">(</span><span class="string" id="6982580">&#34;Arith.Scan&#34;</span><span class="op" id="6982592">,</span>&nbsp;<span class="op" id="6982594">&amp;</span><span class="ident" id="6982595">str</span><span class="op" id="6982598">,</span>&nbsp;<span class="ident" id="6982600">reply</span><span class="op" id="6982605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6982608">if</span>&nbsp;<span class="ident" id="6982611">err</span>&nbsp;<span class="op" id="6982615">!=</span>&nbsp;<span class="ident" id="6982618">nil</span>&nbsp;<span class="op" id="6982622">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982626">t</span><span class="op" id="6982627">.</span><span class="ident" id="6982628">Errorf</span><span class="op" id="6982634">(</span><span class="string" id="6982635">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6982678">,</span>&nbsp;<span class="ident" id="6982680">err</span><span class="op" id="6982683">.</span><span class="ident" id="6982684">Error</span><span class="op" id="6982689">(</span><span class="op" id="6982690">)</span><span class="op" id="6982691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982694">}</span>&nbsp;<span class="keyword" id="6982696">else</span>&nbsp;<span class="keyword" id="6982701">if</span>&nbsp;<span class="ident" id="6982704">reply</span><span class="op" id="6982709">.</span><span class="ident" id="6982710">C</span>&nbsp;<span class="op" id="6982712">!=</span>&nbsp;<span class="ident" id="6982715">Val</span>&nbsp;<span class="op" id="6982719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982723">t</span><span class="op" id="6982724">.</span><span class="ident" id="6982725">Errorf</span><span class="op" id="6982731">(</span><span class="string" id="6982732">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6982758">,</span>&nbsp;<span class="ident" id="6982760">Val</span><span class="op" id="6982763">,</span>&nbsp;<span class="ident" id="6982765">reply</span><span class="op" id="6982770">.</span><span class="ident" id="6982771">C</span><span class="op" id="6982772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6982779">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982800">args</span>&nbsp;<span class="op" id="6982805">=</span>&nbsp;<span class="op" id="6982807">&amp;</span><span class="ident" id="6982808">Args</span><span class="op" id="6982812">{</span><span class="num" id="6982813">27</span><span class="op" id="6982815">,</span>&nbsp;<span class="num" id="6982817">35</span><span class="op" id="6982819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982822">str</span>&nbsp;<span class="op" id="6982826">=</span>&nbsp;<span class="string" id="6982828">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982832">err</span>&nbsp;<span class="op" id="6982836">=</span>&nbsp;<span class="ident" id="6982838">client</span><span class="op" id="6982844">.</span><span class="ident" id="6982845">Call</span><span class="op" id="6982849">(</span><span class="string" id="6982850">&#34;Arith.String&#34;</span><span class="op" id="6982864">,</span>&nbsp;<span class="ident" id="6982866">args</span><span class="op" id="6982870">,</span>&nbsp;<span class="op" id="6982872">&amp;</span><span class="ident" id="6982873">str</span><span class="op" id="6982876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6982879">if</span>&nbsp;<span class="ident" id="6982882">err</span>&nbsp;<span class="op" id="6982886">!=</span>&nbsp;<span class="ident" id="6982889">nil</span>&nbsp;<span class="op" id="6982893">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982897">t</span><span class="op" id="6982898">.</span><span class="ident" id="6982899">Errorf</span><span class="op" id="6982905">(</span><span class="string" id="6982906">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6982951">,</span>&nbsp;<span class="ident" id="6982953">err</span><span class="op" id="6982956">.</span><span class="ident" id="6982957">Error</span><span class="op" id="6982962">(</span><span class="op" id="6982963">)</span><span class="op" id="6982964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6982967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6982970">expect</span>&nbsp;<span class="op" id="6982977">:=</span>&nbsp;<span class="ident" id="6982980">fmt</span><span class="op" id="6982983">.</span><span class="ident" id="6982984">Sprintf</span><span class="op" id="6982991">(</span><span class="string" id="6982992">&#34;%d+%d=%d&#34;</span><span class="op" id="6983002">,</span>&nbsp;<span class="ident" id="6983004">args</span><span class="op" id="6983008">.</span><span class="ident" id="6983009">A</span><span class="op" id="6983010">,</span>&nbsp;<span class="ident" id="6983012">args</span><span class="op" id="6983016">.</span><span class="ident" id="6983017">B</span><span class="op" id="6983018">,</span>&nbsp;<span class="ident" id="6983020">args</span><span class="op" id="6983024">.</span><span class="ident" id="6983025">A</span><span class="op" id="6983026">+</span><span class="ident" id="6983027">args</span><span class="op" id="6983031">.</span><span class="ident" id="6983032">B</span><span class="op" id="6983033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983036">if</span>&nbsp;<span class="ident" id="6983039">str</span>&nbsp;<span class="op" id="6983043">!=</span>&nbsp;<span class="ident" id="6983046">expect</span>&nbsp;<span class="op" id="6983053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983057">t</span><span class="op" id="6983058">.</span><span class="ident" id="6983059">Errorf</span><span class="op" id="6983065">(</span><span class="string" id="6983066">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6983094">,</span>&nbsp;<span class="ident" id="6983096">expect</span><span class="op" id="6983102">,</span>&nbsp;<span class="ident" id="6983104">str</span><span class="op" id="6983107">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983114">args</span>&nbsp;<span class="op" id="6983119">=</span>&nbsp;<span class="op" id="6983121">&amp;</span><span class="ident" id="6983122">Args</span><span class="op" id="6983126">{</span><span class="num" id="6983127">7</span><span class="op" id="6983128">,</span>&nbsp;<span class="num" id="6983130">8</span><span class="op" id="6983131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983134">reply</span>&nbsp;<span class="op" id="6983140">=</span>&nbsp;<span class="builtinfunc" id="6983142">new</span><span class="op" id="6983145">(</span><span class="ident" id="6983146">Reply</span><span class="op" id="6983151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983154">err</span>&nbsp;<span class="op" id="6983158">=</span>&nbsp;<span class="ident" id="6983160">client</span><span class="op" id="6983166">.</span><span class="ident" id="6983167">Call</span><span class="op" id="6983171">(</span><span class="string" id="6983172">&#34;Arith.Mul&#34;</span><span class="op" id="6983183">,</span>&nbsp;<span class="ident" id="6983185">args</span><span class="op" id="6983189">,</span>&nbsp;<span class="ident" id="6983191">reply</span><span class="op" id="6983196">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983199">if</span>&nbsp;<span class="ident" id="6983202">err</span>&nbsp;<span class="op" id="6983206">!=</span>&nbsp;<span class="ident" id="6983209">nil</span>&nbsp;<span class="op" id="6983213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983217">t</span><span class="op" id="6983218">.</span><span class="ident" id="6983219">Errorf</span><span class="op" id="6983225">(</span><span class="string" id="6983226">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6983268">,</span>&nbsp;<span class="ident" id="6983270">err</span><span class="op" id="6983273">.</span><span class="ident" id="6983274">Error</span><span class="op" id="6983279">(</span><span class="op" id="6983280">)</span><span class="op" id="6983281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983287">if</span>&nbsp;<span class="ident" id="6983290">reply</span><span class="op" id="6983295">.</span><span class="ident" id="6983296">C</span>&nbsp;<span class="op" id="6983298">!=</span>&nbsp;<span class="ident" id="6983301">args</span><span class="op" id="6983305">.</span><span class="ident" id="6983306">A</span><span class="op" id="6983307">*</span><span class="ident" id="6983308">args</span><span class="op" id="6983312">.</span><span class="ident" id="6983313">B</span>&nbsp;<span class="op" id="6983315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983319">t</span><span class="op" id="6983320">.</span><span class="ident" id="6983321">Errorf</span><span class="op" id="6983327">(</span><span class="string" id="6983328">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6983353">,</span>&nbsp;<span class="ident" id="6983355">reply</span><span class="op" id="6983360">.</span><span class="ident" id="6983361">C</span><span class="op" id="6983362">,</span>&nbsp;<span class="ident" id="6983364">args</span><span class="op" id="6983368">.</span><span class="ident" id="6983369">A</span><span class="op" id="6983370">*</span><span class="ident" id="6983371">args</span><span class="op" id="6983375">.</span><span class="ident" id="6983376">B</span><span class="op" id="6983377">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6983384">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983422">args</span>&nbsp;<span class="op" id="6983427">=</span>&nbsp;<span class="op" id="6983429">&amp;</span><span class="ident" id="6983430">Args</span><span class="op" id="6983434">{</span><span class="num" id="6983435">7</span><span class="op" id="6983436">,</span>&nbsp;<span class="num" id="6983438">8</span><span class="op" id="6983439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983442">reply</span>&nbsp;<span class="op" id="6983448">=</span>&nbsp;<span class="builtinfunc" id="6983450">new</span><span class="op" id="6983453">(</span><span class="ident" id="6983454">Reply</span><span class="op" id="6983459">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983462">err</span>&nbsp;<span class="op" id="6983466">=</span>&nbsp;<span class="ident" id="6983468">client</span><span class="op" id="6983474">.</span><span class="ident" id="6983475">Call</span><span class="op" id="6983479">(</span><span class="string" id="6983480">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="6983499">,</span>&nbsp;<span class="ident" id="6983501">args</span><span class="op" id="6983505">,</span>&nbsp;<span class="ident" id="6983507">reply</span><span class="op" id="6983512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983515">if</span>&nbsp;<span class="ident" id="6983518">err</span>&nbsp;<span class="op" id="6983522">!=</span>&nbsp;<span class="ident" id="6983525">nil</span>&nbsp;<span class="op" id="6983529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983533">t</span><span class="op" id="6983534">.</span><span class="ident" id="6983535">Errorf</span><span class="op" id="6983541">(</span><span class="string" id="6983542">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6983584">,</span>&nbsp;<span class="ident" id="6983586">err</span><span class="op" id="6983589">.</span><span class="ident" id="6983590">Error</span><span class="op" id="6983595">(</span><span class="op" id="6983596">)</span><span class="op" id="6983597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983603">if</span>&nbsp;<span class="ident" id="6983606">reply</span><span class="op" id="6983611">.</span><span class="ident" id="6983612">C</span>&nbsp;<span class="op" id="6983614">!=</span>&nbsp;<span class="ident" id="6983617">args</span><span class="op" id="6983621">.</span><span class="ident" id="6983622">A</span><span class="op" id="6983623">+</span><span class="ident" id="6983624">args</span><span class="op" id="6983628">.</span><span class="ident" id="6983629">B</span>&nbsp;<span class="op" id="6983631">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983635">t</span><span class="op" id="6983636">.</span><span class="ident" id="6983637">Errorf</span><span class="op" id="6983643">(</span><span class="string" id="6983644">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6983669">,</span>&nbsp;<span class="ident" id="6983671">reply</span><span class="op" id="6983676">.</span><span class="ident" id="6983677">C</span><span class="op" id="6983678">,</span>&nbsp;<span class="ident" id="6983680">args</span><span class="op" id="6983684">.</span><span class="ident" id="6983685">A</span><span class="op" id="6983686">+</span><span class="ident" id="6983687">args</span><span class="op" id="6983691">.</span><span class="ident" id="6983692">B</span><span class="op" id="6983693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983696">}</span><br>
<span class="lineno"></span><span class="op" id="6983698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6983701">func</span>&nbsp;<span class="ident" id="6983706">testNewServerRPC</span><span class="op" id="6983722">(</span><span class="ident" id="6983723">t</span>&nbsp;<span class="op" id="6983725">*</span><span class="ident" id="6983726">testing</span><span class="op" id="6983733">.</span><span class="ident" id="6983734">T</span><span class="op" id="6983735">,</span>&nbsp;<span class="ident" id="6983737">addr</span>&nbsp;<span class="builtintype" id="6983742">string</span><span class="op" id="6983748">)</span>&nbsp;<span class="op" id="6983750">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983753">client</span><span class="op" id="6983759">,</span>&nbsp;<span class="ident" id="6983761">err</span>&nbsp;<span class="op" id="6983765">:=</span>&nbsp;<span class="ident" id="6983768">Dial</span><span class="op" id="6983772">(</span><span class="string" id="6983773">&#34;tcp&#34;</span><span class="op" id="6983778">,</span>&nbsp;<span class="ident" id="6983780">addr</span><span class="op" id="6983784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983787">if</span>&nbsp;<span class="ident" id="6983790">err</span>&nbsp;<span class="op" id="6983794">!=</span>&nbsp;<span class="ident" id="6983797">nil</span>&nbsp;<span class="op" id="6983801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983805">t</span><span class="op" id="6983806">.</span><span class="ident" id="6983807">Fatal</span><span class="op" id="6983812">(</span><span class="string" id="6983813">&#34;dialing&#34;</span><span class="op" id="6983822">,</span>&nbsp;<span class="ident" id="6983824">err</span><span class="op" id="6983827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6983830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983833">defer</span>&nbsp;<span class="ident" id="6983839">client</span><span class="op" id="6983845">.</span><span class="ident" id="6983846">Close</span><span class="op" id="6983851">(</span><span class="op" id="6983852">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6983856">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983878">args</span>&nbsp;<span class="op" id="6983883">:=</span>&nbsp;<span class="op" id="6983886">&amp;</span><span class="ident" id="6983887">Args</span><span class="op" id="6983891">{</span><span class="num" id="6983892">7</span><span class="op" id="6983893">,</span>&nbsp;<span class="num" id="6983895">8</span><span class="op" id="6983896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983899">reply</span>&nbsp;<span class="op" id="6983905">:=</span>&nbsp;<span class="builtinfunc" id="6983908">new</span><span class="op" id="6983911">(</span><span class="ident" id="6983912">Reply</span><span class="op" id="6983917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983920">err</span>&nbsp;<span class="op" id="6983924">=</span>&nbsp;<span class="ident" id="6983926">client</span><span class="op" id="6983932">.</span><span class="ident" id="6983933">Call</span><span class="op" id="6983937">(</span><span class="string" id="6983938">&#34;newServer.Arith.Add&#34;</span><span class="op" id="6983959">,</span>&nbsp;<span class="ident" id="6983961">args</span><span class="op" id="6983965">,</span>&nbsp;<span class="ident" id="6983967">reply</span><span class="op" id="6983972">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6983975">if</span>&nbsp;<span class="ident" id="6983978">err</span>&nbsp;<span class="op" id="6983982">!=</span>&nbsp;<span class="ident" id="6983985">nil</span>&nbsp;<span class="op" id="6983989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6983993">t</span><span class="op" id="6983994">.</span><span class="ident" id="6983995">Errorf</span><span class="op" id="6984001">(</span><span class="string" id="6984002">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6984044">,</span>&nbsp;<span class="ident" id="6984046">err</span><span class="op" id="6984049">.</span><span class="ident" id="6984050">Error</span><span class="op" id="6984055">(</span><span class="op" id="6984056">)</span><span class="op" id="6984057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984063">if</span>&nbsp;<span class="ident" id="6984066">reply</span><span class="op" id="6984071">.</span><span class="ident" id="6984072">C</span>&nbsp;<span class="op" id="6984074">!=</span>&nbsp;<span class="ident" id="6984077">args</span><span class="op" id="6984081">.</span><span class="ident" id="6984082">A</span><span class="op" id="6984083">+</span><span class="ident" id="6984084">args</span><span class="op" id="6984088">.</span><span class="ident" id="6984089">B</span>&nbsp;<span class="op" id="6984091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984095">t</span><span class="op" id="6984096">.</span><span class="ident" id="6984097">Errorf</span><span class="op" id="6984103">(</span><span class="string" id="6984104">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6984129">,</span>&nbsp;<span class="ident" id="6984131">reply</span><span class="op" id="6984136">.</span><span class="ident" id="6984137">C</span><span class="op" id="6984138">,</span>&nbsp;<span class="ident" id="6984140">args</span><span class="op" id="6984144">.</span><span class="ident" id="6984145">A</span><span class="op" id="6984146">+</span><span class="ident" id="6984147">args</span><span class="op" id="6984151">.</span><span class="ident" id="6984152">B</span><span class="op" id="6984153">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984156">}</span><br>
<span class="lineno"></span><span class="op" id="6984158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6984161">func</span>&nbsp;<span class="ident" id="6984166">TestHTTP</span><span class="op" id="6984174">(</span><span class="ident" id="6984175">t</span>&nbsp;<span class="op" id="6984177">*</span><span class="ident" id="6984178">testing</span><span class="op" id="6984185">.</span><span class="ident" id="6984186">T</span><span class="op" id="6984187">)</span>&nbsp;<span class="op" id="6984189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984192">once</span><span class="op" id="6984196">.</span><span class="ident" id="6984197">Do</span><span class="op" id="6984199">(</span><span class="ident" id="6984200">startServer</span><span class="op" id="6984211">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984214">testHTTPRPC</span><span class="op" id="6984225">(</span><span class="ident" id="6984226">t</span><span class="op" id="6984227">,</span>&nbsp;<span class="string" id="6984229">&#34;&#34;</span><span class="op" id="6984231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984234">newOnce</span><span class="op" id="6984241">.</span><span class="ident" id="6984242">Do</span><span class="op" id="6984244">(</span><span class="ident" id="6984245">startNewServer</span><span class="op" id="6984259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984262">testHTTPRPC</span><span class="op" id="6984273">(</span><span class="ident" id="6984274">t</span><span class="op" id="6984275">,</span>&nbsp;<span class="ident" id="6984277">newHttpPath</span><span class="op" id="6984288">)</span><br>
<span class="lineno"></span><span class="op" id="6984290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6984293">func</span>&nbsp;<span class="ident" id="6984298">testHTTPRPC</span><span class="op" id="6984309">(</span><span class="ident" id="6984310">t</span>&nbsp;<span class="op" id="6984312">*</span><span class="ident" id="6984313">testing</span><span class="op" id="6984320">.</span><span class="ident" id="6984321">T</span><span class="op" id="6984322">,</span>&nbsp;<span class="ident" id="6984324">path</span>&nbsp;<span class="builtintype" id="6984329">string</span><span class="op" id="6984335">)</span>&nbsp;<span class="op" id="6984337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984340">var</span>&nbsp;<span class="ident" id="6984344">client</span>&nbsp;<span class="op" id="6984351">*</span><span class="ident" id="6984352">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984360">var</span>&nbsp;<span class="ident" id="6984364">err</span>&nbsp;<span class="builtintype" id="6984368">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984375">if</span>&nbsp;<span class="ident" id="6984378">path</span>&nbsp;<span class="op" id="6984383">==</span>&nbsp;<span class="string" id="6984386">&#34;&#34;</span>&nbsp;<span class="op" id="6984389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984393">client</span><span class="op" id="6984399">,</span>&nbsp;<span class="ident" id="6984401">err</span>&nbsp;<span class="op" id="6984405">=</span>&nbsp;<span class="ident" id="6984407">DialHTTP</span><span class="op" id="6984415">(</span><span class="string" id="6984416">&#34;tcp&#34;</span><span class="op" id="6984421">,</span>&nbsp;<span class="ident" id="6984423">httpServerAddr</span><span class="op" id="6984437">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984440">}</span>&nbsp;<span class="keyword" id="6984442">else</span>&nbsp;<span class="op" id="6984447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984451">client</span><span class="op" id="6984457">,</span>&nbsp;<span class="ident" id="6984459">err</span>&nbsp;<span class="op" id="6984463">=</span>&nbsp;<span class="ident" id="6984465">DialHTTPPath</span><span class="op" id="6984477">(</span><span class="string" id="6984478">&#34;tcp&#34;</span><span class="op" id="6984483">,</span>&nbsp;<span class="ident" id="6984485">httpServerAddr</span><span class="op" id="6984499">,</span>&nbsp;<span class="ident" id="6984501">path</span><span class="op" id="6984505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984511">if</span>&nbsp;<span class="ident" id="6984514">err</span>&nbsp;<span class="op" id="6984518">!=</span>&nbsp;<span class="ident" id="6984521">nil</span>&nbsp;<span class="op" id="6984525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984529">t</span><span class="op" id="6984530">.</span><span class="ident" id="6984531">Fatal</span><span class="op" id="6984536">(</span><span class="string" id="6984537">&#34;dialing&#34;</span><span class="op" id="6984546">,</span>&nbsp;<span class="ident" id="6984548">err</span><span class="op" id="6984551">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984557">defer</span>&nbsp;<span class="ident" id="6984563">client</span><span class="op" id="6984569">.</span><span class="ident" id="6984570">Close</span><span class="op" id="6984575">(</span><span class="op" id="6984576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6984580">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984602">args</span>&nbsp;<span class="op" id="6984607">:=</span>&nbsp;<span class="op" id="6984610">&amp;</span><span class="ident" id="6984611">Args</span><span class="op" id="6984615">{</span><span class="num" id="6984616">7</span><span class="op" id="6984617">,</span>&nbsp;<span class="num" id="6984619">8</span><span class="op" id="6984620">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984623">reply</span>&nbsp;<span class="op" id="6984629">:=</span>&nbsp;<span class="builtinfunc" id="6984632">new</span><span class="op" id="6984635">(</span><span class="ident" id="6984636">Reply</span><span class="op" id="6984641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984644">err</span>&nbsp;<span class="op" id="6984648">=</span>&nbsp;<span class="ident" id="6984650">client</span><span class="op" id="6984656">.</span><span class="ident" id="6984657">Call</span><span class="op" id="6984661">(</span><span class="string" id="6984662">&#34;Arith.Add&#34;</span><span class="op" id="6984673">,</span>&nbsp;<span class="ident" id="6984675">args</span><span class="op" id="6984679">,</span>&nbsp;<span class="ident" id="6984681">reply</span><span class="op" id="6984686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984689">if</span>&nbsp;<span class="ident" id="6984692">err</span>&nbsp;<span class="op" id="6984696">!=</span>&nbsp;<span class="ident" id="6984699">nil</span>&nbsp;<span class="op" id="6984703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984707">t</span><span class="op" id="6984708">.</span><span class="ident" id="6984709">Errorf</span><span class="op" id="6984715">(</span><span class="string" id="6984716">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6984758">,</span>&nbsp;<span class="ident" id="6984760">err</span><span class="op" id="6984763">.</span><span class="ident" id="6984764">Error</span><span class="op" id="6984769">(</span><span class="op" id="6984770">)</span><span class="op" id="6984771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984774">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6984777">if</span>&nbsp;<span class="ident" id="6984780">reply</span><span class="op" id="6984785">.</span><span class="ident" id="6984786">C</span>&nbsp;<span class="op" id="6984788">!=</span>&nbsp;<span class="ident" id="6984791">args</span><span class="op" id="6984795">.</span><span class="ident" id="6984796">A</span><span class="op" id="6984797">+</span><span class="ident" id="6984798">args</span><span class="op" id="6984802">.</span><span class="ident" id="6984803">B</span>&nbsp;<span class="op" id="6984805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6984809">t</span><span class="op" id="6984810">.</span><span class="ident" id="6984811">Errorf</span><span class="op" id="6984817">(</span><span class="string" id="6984818">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6984843">,</span>&nbsp;<span class="ident" id="6984845">reply</span><span class="op" id="6984850">.</span><span class="ident" id="6984851">C</span><span class="op" id="6984852">,</span>&nbsp;<span class="ident" id="6984854">args</span><span class="op" id="6984858">.</span><span class="ident" id="6984859">A</span><span class="op" id="6984860">+</span><span class="ident" id="6984861">args</span><span class="op" id="6984865">.</span><span class="ident" id="6984866">B</span><span class="op" id="6984867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6984870">}</span><br>
<span class="lineno"></span><span class="op" id="6984872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="6984875">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6984948">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="6984985">type</span>&nbsp;<span class="ident" id="6984990">CodecEmulator</span>&nbsp;<span class="keyword" id="6985004">struct</span>&nbsp;<span class="op" id="6985011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985014">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985028">*</span><span class="ident" id="6985029">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985037">serviceMethod</span>&nbsp;<span class="builtintype" id="6985051">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985059">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985073">*</span><span class="ident" id="6985074">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985080">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985094">*</span><span class="ident" id="6985095">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985102">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6985116">error</span><br>
<span class="lineno"></span><span class="op" id="6985122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6985125">func</span>&nbsp;<span class="op" id="6985130">(</span><span class="ident" id="6985131">codec</span>&nbsp;<span class="op" id="6985137">*</span><span class="ident" id="6985138">CodecEmulator</span><span class="op" id="6985151">)</span>&nbsp;<span class="ident" id="6985153">Call</span><span class="op" id="6985157">(</span><span class="ident" id="6985158">serviceMethod</span>&nbsp;<span class="builtintype" id="6985172">string</span><span class="op" id="6985178">,</span>&nbsp;<span class="ident" id="6985180">args</span>&nbsp;<span class="op" id="6985185">*</span><span class="ident" id="6985186">Args</span><span class="op" id="6985190">,</span>&nbsp;<span class="ident" id="6985192">reply</span>&nbsp;<span class="op" id="6985198">*</span><span class="ident" id="6985199">Reply</span><span class="op" id="6985204">)</span>&nbsp;<span class="builtintype" id="6985206">error</span>&nbsp;<span class="op" id="6985212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985215">codec</span><span class="op" id="6985220">.</span><span class="ident" id="6985221">serviceMethod</span>&nbsp;<span class="op" id="6985235">=</span>&nbsp;<span class="ident" id="6985237">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985252">codec</span><span class="op" id="6985257">.</span><span class="ident" id="6985258">args</span>&nbsp;<span class="op" id="6985263">=</span>&nbsp;<span class="ident" id="6985265">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985271">codec</span><span class="op" id="6985276">.</span><span class="ident" id="6985277">reply</span>&nbsp;<span class="op" id="6985283">=</span>&nbsp;<span class="ident" id="6985285">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985292">codec</span><span class="op" id="6985297">.</span><span class="ident" id="6985298">err</span>&nbsp;<span class="op" id="6985302">=</span>&nbsp;<span class="ident" id="6985304">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985309">var</span>&nbsp;<span class="ident" id="6985313">serverError</span>&nbsp;<span class="builtintype" id="6985325">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985332">if</span>&nbsp;<span class="ident" id="6985335">codec</span><span class="op" id="6985340">.</span><span class="ident" id="6985341">server</span>&nbsp;<span class="op" id="6985348">==</span>&nbsp;<span class="ident" id="6985351">nil</span>&nbsp;<span class="op" id="6985355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985359">serverError</span>&nbsp;<span class="op" id="6985371">=</span>&nbsp;<span class="ident" id="6985373">ServeRequest</span><span class="op" id="6985385">(</span><span class="ident" id="6985386">codec</span><span class="op" id="6985391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985394">}</span>&nbsp;<span class="keyword" id="6985396">else</span>&nbsp;<span class="op" id="6985401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985405">serverError</span>&nbsp;<span class="op" id="6985417">=</span>&nbsp;<span class="ident" id="6985419">codec</span><span class="op" id="6985424">.</span><span class="ident" id="6985425">server</span><span class="op" id="6985431">.</span><span class="ident" id="6985432">ServeRequest</span><span class="op" id="6985444">(</span><span class="ident" id="6985445">codec</span><span class="op" id="6985450">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985456">if</span>&nbsp;<span class="ident" id="6985459">codec</span><span class="op" id="6985464">.</span><span class="ident" id="6985465">err</span>&nbsp;<span class="op" id="6985469">==</span>&nbsp;<span class="ident" id="6985472">nil</span>&nbsp;<span class="op" id="6985476">&amp;&amp;</span>&nbsp;<span class="ident" id="6985479">serverError</span>&nbsp;<span class="op" id="6985491">!=</span>&nbsp;<span class="ident" id="6985494">nil</span>&nbsp;<span class="op" id="6985498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985502">codec</span><span class="op" id="6985507">.</span><span class="ident" id="6985508">err</span>&nbsp;<span class="op" id="6985512">=</span>&nbsp;<span class="ident" id="6985514">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985530">return</span>&nbsp;<span class="ident" id="6985537">codec</span><span class="op" id="6985542">.</span><span class="ident" id="6985543">err</span><br>
<span class="lineno">330</span><span class="op" id="6985547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985550">func</span>&nbsp;<span class="op" id="6985555">(</span><span class="ident" id="6985556">codec</span>&nbsp;<span class="op" id="6985562">*</span><span class="ident" id="6985563">CodecEmulator</span><span class="op" id="6985576">)</span>&nbsp;<span class="ident" id="6985578">ReadRequestHeader</span><span class="op" id="6985595">(</span><span class="ident" id="6985596">req</span>&nbsp;<span class="op" id="6985600">*</span><span class="ident" id="6985601">Request</span><span class="op" id="6985608">)</span>&nbsp;<span class="builtintype" id="6985610">error</span>&nbsp;<span class="op" id="6985616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985619">req</span><span class="op" id="6985622">.</span><span class="ident" id="6985623">ServiceMethod</span>&nbsp;<span class="op" id="6985637">=</span>&nbsp;<span class="ident" id="6985639">codec</span><span class="op" id="6985644">.</span><span class="ident" id="6985645">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985660">req</span><span class="op" id="6985663">.</span><span class="ident" id="6985664">Seq</span>&nbsp;<span class="op" id="6985668">=</span>&nbsp;<span class="num" id="6985670">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985673">return</span>&nbsp;<span class="ident" id="6985680">nil</span><br>
<span class="lineno"></span><span class="op" id="6985684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6985687">func</span>&nbsp;<span class="op" id="6985692">(</span><span class="ident" id="6985693">codec</span>&nbsp;<span class="op" id="6985699">*</span><span class="ident" id="6985700">CodecEmulator</span><span class="op" id="6985713">)</span>&nbsp;<span class="ident" id="6985715">ReadRequestBody</span><span class="op" id="6985730">(</span><span class="ident" id="6985731">argv</span>&nbsp;<span class="keyword" id="6985736">interface</span><span class="op" id="6985745">{</span><span class="op" id="6985746">}</span><span class="op" id="6985747">)</span>&nbsp;<span class="builtintype" id="6985749">error</span>&nbsp;<span class="op" id="6985755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985758">if</span>&nbsp;<span class="ident" id="6985761">codec</span><span class="op" id="6985766">.</span><span class="ident" id="6985767">args</span>&nbsp;<span class="op" id="6985772">==</span>&nbsp;<span class="ident" id="6985775">nil</span>&nbsp;<span class="op" id="6985779">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985783">return</span>&nbsp;<span class="ident" id="6985790">io</span><span class="op" id="6985792">.</span><span class="ident" id="6985793">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6985814">*</span><span class="op" id="6985815">(</span><span class="ident" id="6985816">argv</span><span class="op" id="6985820">.</span><span class="op" id="6985821">(</span><span class="op" id="6985822">*</span><span class="ident" id="6985823">Args</span><span class="op" id="6985827">)</span><span class="op" id="6985828">)</span>&nbsp;<span class="op" id="6985830">=</span>&nbsp;<span class="op" id="6985832">*</span><span class="ident" id="6985833">codec</span><span class="op" id="6985838">.</span><span class="ident" id="6985839">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985845">return</span>&nbsp;<span class="ident" id="6985852">nil</span><br>
<span class="lineno"></span><span class="op" id="6985856">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6985859">func</span>&nbsp;<span class="op" id="6985864">(</span><span class="ident" id="6985865">codec</span>&nbsp;<span class="op" id="6985871">*</span><span class="ident" id="6985872">CodecEmulator</span><span class="op" id="6985885">)</span>&nbsp;<span class="ident" id="6985887">WriteResponse</span><span class="op" id="6985900">(</span><span class="ident" id="6985901">resp</span>&nbsp;<span class="op" id="6985906">*</span><span class="ident" id="6985907">Response</span><span class="op" id="6985915">,</span>&nbsp;<span class="ident" id="6985917">reply</span>&nbsp;<span class="keyword" id="6985923">interface</span><span class="op" id="6985932">{</span><span class="op" id="6985933">}</span><span class="op" id="6985934">)</span>&nbsp;<span class="builtintype" id="6985936">error</span>&nbsp;<span class="op" id="6985942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6985945">if</span>&nbsp;<span class="ident" id="6985948">resp</span><span class="op" id="6985952">.</span><span class="ident" id="6985953">Error</span>&nbsp;<span class="op" id="6985959">!=</span>&nbsp;<span class="string" id="6985962">&#34;&#34;</span>&nbsp;<span class="op" id="6985965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6985969">codec</span><span class="op" id="6985974">.</span><span class="ident" id="6985975">err</span>&nbsp;<span class="op" id="6985979">=</span>&nbsp;<span class="ident" id="6985981">errors</span><span class="op" id="6985987">.</span><span class="ident" id="6985988">New</span><span class="op" id="6985991">(</span><span class="ident" id="6985992">resp</span><span class="op" id="6985996">.</span><span class="ident" id="6985997">Error</span><span class="op" id="6986002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986005">}</span>&nbsp;<span class="keyword" id="6986007">else</span>&nbsp;<span class="op" id="6986012">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986016">*</span><span class="ident" id="6986017">codec</span><span class="op" id="6986022">.</span><span class="ident" id="6986023">reply</span>&nbsp;<span class="op" id="6986029">=</span>&nbsp;<span class="op" id="6986031">*</span><span class="op" id="6986032">(</span><span class="ident" id="6986033">reply</span><span class="op" id="6986038">.</span><span class="op" id="6986039">(</span><span class="op" id="6986040">*</span><span class="ident" id="6986041">Reply</span><span class="op" id="6986046">)</span><span class="op" id="6986047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986053">return</span>&nbsp;<span class="ident" id="6986060">nil</span><br>
<span class="lineno"></span><span class="op" id="6986064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="6986067">func</span>&nbsp;<span class="op" id="6986072">(</span><span class="ident" id="6986073">codec</span>&nbsp;<span class="op" id="6986079">*</span><span class="ident" id="6986080">CodecEmulator</span><span class="op" id="6986093">)</span>&nbsp;<span class="ident" id="6986095">Close</span><span class="op" id="6986100">(</span><span class="op" id="6986101">)</span>&nbsp;<span class="builtintype" id="6986103">error</span>&nbsp;<span class="op" id="6986109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986112">return</span>&nbsp;<span class="ident" id="6986119">nil</span><br>
<span class="lineno"></span><span class="op" id="6986123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6986126">func</span>&nbsp;<span class="ident" id="6986131">TestServeRequest</span><span class="op" id="6986147">(</span><span class="ident" id="6986148">t</span>&nbsp;<span class="op" id="6986150">*</span><span class="ident" id="6986151">testing</span><span class="op" id="6986158">.</span><span class="ident" id="6986159">T</span><span class="op" id="6986160">)</span>&nbsp;<span class="op" id="6986162">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986165">once</span><span class="op" id="6986169">.</span><span class="ident" id="6986170">Do</span><span class="op" id="6986172">(</span><span class="ident" id="6986173">startServer</span><span class="op" id="6986184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986187">testServeRequest</span><span class="op" id="6986203">(</span><span class="ident" id="6986204">t</span><span class="op" id="6986205">,</span>&nbsp;<span class="ident" id="6986207">nil</span><span class="op" id="6986210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986213">newOnce</span><span class="op" id="6986220">.</span><span class="ident" id="6986221">Do</span><span class="op" id="6986223">(</span><span class="ident" id="6986224">startNewServer</span><span class="op" id="6986238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986241">testServeRequest</span><span class="op" id="6986257">(</span><span class="ident" id="6986258">t</span><span class="op" id="6986259">,</span>&nbsp;<span class="ident" id="6986261">newServer</span><span class="op" id="6986270">)</span><br>
<span class="lineno"></span><span class="op" id="6986272">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6986275">func</span>&nbsp;<span class="ident" id="6986280">testServeRequest</span><span class="op" id="6986296">(</span><span class="ident" id="6986297">t</span>&nbsp;<span class="op" id="6986299">*</span><span class="ident" id="6986300">testing</span><span class="op" id="6986307">.</span><span class="ident" id="6986308">T</span><span class="op" id="6986309">,</span>&nbsp;<span class="ident" id="6986311">server</span>&nbsp;<span class="op" id="6986318">*</span><span class="ident" id="6986319">Server</span><span class="op" id="6986325">)</span>&nbsp;<span class="op" id="6986327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986330">client</span>&nbsp;<span class="op" id="6986337">:=</span>&nbsp;<span class="ident" id="6986340">CodecEmulator</span><span class="op" id="6986353">{</span><span class="ident" id="6986354">server</span><span class="op" id="6986360">:</span>&nbsp;<span class="ident" id="6986362">server</span><span class="op" id="6986368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986371">defer</span>&nbsp;<span class="ident" id="6986377">client</span><span class="op" id="6986383">.</span><span class="ident" id="6986384">Close</span><span class="op" id="6986389">(</span><span class="op" id="6986390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986394">args</span>&nbsp;<span class="op" id="6986399">:=</span>&nbsp;<span class="op" id="6986402">&amp;</span><span class="ident" id="6986403">Args</span><span class="op" id="6986407">{</span><span class="num" id="6986408">7</span><span class="op" id="6986409">,</span>&nbsp;<span class="num" id="6986411">8</span><span class="op" id="6986412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986415">reply</span>&nbsp;<span class="op" id="6986421">:=</span>&nbsp;<span class="builtinfunc" id="6986424">new</span><span class="op" id="6986427">(</span><span class="ident" id="6986428">Reply</span><span class="op" id="6986433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986436">err</span>&nbsp;<span class="op" id="6986440">:=</span>&nbsp;<span class="ident" id="6986443">client</span><span class="op" id="6986449">.</span><span class="ident" id="6986450">Call</span><span class="op" id="6986454">(</span><span class="string" id="6986455">&#34;Arith.Add&#34;</span><span class="op" id="6986466">,</span>&nbsp;<span class="ident" id="6986468">args</span><span class="op" id="6986472">,</span>&nbsp;<span class="ident" id="6986474">reply</span><span class="op" id="6986479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986482">if</span>&nbsp;<span class="ident" id="6986485">err</span>&nbsp;<span class="op" id="6986489">!=</span>&nbsp;<span class="ident" id="6986492">nil</span>&nbsp;<span class="op" id="6986496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986500">t</span><span class="op" id="6986501">.</span><span class="ident" id="6986502">Errorf</span><span class="op" id="6986508">(</span><span class="string" id="6986509">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6986551">,</span>&nbsp;<span class="ident" id="6986553">err</span><span class="op" id="6986556">.</span><span class="ident" id="6986557">Error</span><span class="op" id="6986562">(</span><span class="op" id="6986563">)</span><span class="op" id="6986564">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986570">if</span>&nbsp;<span class="ident" id="6986573">reply</span><span class="op" id="6986578">.</span><span class="ident" id="6986579">C</span>&nbsp;<span class="op" id="6986581">!=</span>&nbsp;<span class="ident" id="6986584">args</span><span class="op" id="6986588">.</span><span class="ident" id="6986589">A</span><span class="op" id="6986590">+</span><span class="ident" id="6986591">args</span><span class="op" id="6986595">.</span><span class="ident" id="6986596">B</span>&nbsp;<span class="op" id="6986598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986602">t</span><span class="op" id="6986603">.</span><span class="ident" id="6986604">Errorf</span><span class="op" id="6986610">(</span><span class="string" id="6986611">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6986636">,</span>&nbsp;<span class="ident" id="6986638">reply</span><span class="op" id="6986643">.</span><span class="ident" id="6986644">C</span><span class="op" id="6986645">,</span>&nbsp;<span class="ident" id="6986647">args</span><span class="op" id="6986651">.</span><span class="ident" id="6986652">A</span><span class="op" id="6986653">+</span><span class="ident" id="6986654">args</span><span class="op" id="6986658">.</span><span class="ident" id="6986659">B</span><span class="op" id="6986660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986667">err</span>&nbsp;<span class="op" id="6986671">=</span>&nbsp;<span class="ident" id="6986673">client</span><span class="op" id="6986679">.</span><span class="ident" id="6986680">Call</span><span class="op" id="6986684">(</span><span class="string" id="6986685">&#34;Arith.Add&#34;</span><span class="op" id="6986696">,</span>&nbsp;<span class="ident" id="6986698">nil</span><span class="op" id="6986701">,</span>&nbsp;<span class="ident" id="6986703">reply</span><span class="op" id="6986708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986711">if</span>&nbsp;<span class="ident" id="6986714">err</span>&nbsp;<span class="op" id="6986718">==</span>&nbsp;<span class="ident" id="6986721">nil</span>&nbsp;<span class="op" id="6986725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6986729">t</span><span class="op" id="6986730">.</span><span class="ident" id="6986731">Errorf</span><span class="op" id="6986737">(</span><span class="string" id="6986738">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="6986785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6986788">}</span><br>
<span class="lineno"></span><span class="op" id="6986790">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="6986793">type</span>&nbsp;<span class="ident" id="6986798">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="6986814">int</span><br>
<span class="lineno"></span><span class="keyword" id="6986818">type</span>&nbsp;<span class="ident" id="6986823">ArgNotPublic</span>&nbsp;<span class="builtintype" id="6986836">int</span><br>
<span class="lineno"></span><span class="keyword" id="6986840">type</span>&nbsp;<span class="ident" id="6986845">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="6986860">int</span><br>
<span class="lineno"></span><span class="keyword" id="6986864">type</span>&nbsp;<span class="ident" id="6986869">NeedsPtrType</span>&nbsp;<span class="builtintype" id="6986882">int</span><br>
<span class="lineno">390</span><span class="keyword" id="6986886">type</span>&nbsp;<span class="ident" id="6986891">local</span>&nbsp;<span class="keyword" id="6986897">struct</span><span class="op" id="6986903">{</span><span class="op" id="6986904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6986907">func</span>&nbsp;<span class="op" id="6986912">(</span><span class="ident" id="6986913">t</span>&nbsp;<span class="op" id="6986915">*</span><span class="ident" id="6986916">ReplyNotPointer</span><span class="op" id="6986931">)</span>&nbsp;<span class="ident" id="6986933">ReplyNotPointer</span><span class="op" id="6986948">(</span><span class="ident" id="6986949">args</span>&nbsp;<span class="op" id="6986954">*</span><span class="ident" id="6986955">Args</span><span class="op" id="6986959">,</span>&nbsp;<span class="ident" id="6986961">reply</span>&nbsp;<span class="ident" id="6986967">Reply</span><span class="op" id="6986972">)</span>&nbsp;<span class="builtintype" id="6986974">error</span>&nbsp;<span class="op" id="6986980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6986983">return</span>&nbsp;<span class="ident" id="6986990">nil</span><br>
<span class="lineno"></span><span class="op" id="6986994">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6986997">func</span>&nbsp;<span class="op" id="6987002">(</span><span class="ident" id="6987003">t</span>&nbsp;<span class="op" id="6987005">*</span><span class="ident" id="6987006">ArgNotPublic</span><span class="op" id="6987018">)</span>&nbsp;<span class="ident" id="6987020">ArgNotPublic</span><span class="op" id="6987032">(</span><span class="ident" id="6987033">args</span>&nbsp;<span class="op" id="6987038">*</span><span class="ident" id="6987039">local</span><span class="op" id="6987044">,</span>&nbsp;<span class="ident" id="6987046">reply</span>&nbsp;<span class="op" id="6987052">*</span><span class="ident" id="6987053">Reply</span><span class="op" id="6987058">)</span>&nbsp;<span class="builtintype" id="6987060">error</span>&nbsp;<span class="op" id="6987066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987069">return</span>&nbsp;<span class="ident" id="6987076">nil</span><br>
<span class="lineno"></span><span class="op" id="6987080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="6987083">func</span>&nbsp;<span class="op" id="6987088">(</span><span class="ident" id="6987089">t</span>&nbsp;<span class="op" id="6987091">*</span><span class="ident" id="6987092">ReplyNotPublic</span><span class="op" id="6987106">)</span>&nbsp;<span class="ident" id="6987108">ReplyNotPublic</span><span class="op" id="6987122">(</span><span class="ident" id="6987123">args</span>&nbsp;<span class="op" id="6987128">*</span><span class="ident" id="6987129">Args</span><span class="op" id="6987133">,</span>&nbsp;<span class="ident" id="6987135">reply</span>&nbsp;<span class="op" id="6987141">*</span><span class="ident" id="6987142">local</span><span class="op" id="6987147">)</span>&nbsp;<span class="builtintype" id="6987149">error</span>&nbsp;<span class="op" id="6987155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987158">return</span>&nbsp;<span class="ident" id="6987165">nil</span><br>
<span class="lineno"></span><span class="op" id="6987169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987172">func</span>&nbsp;<span class="op" id="6987177">(</span><span class="ident" id="6987178">t</span>&nbsp;<span class="op" id="6987180">*</span><span class="ident" id="6987181">NeedsPtrType</span><span class="op" id="6987193">)</span>&nbsp;<span class="ident" id="6987195">NeedsPtrType</span><span class="op" id="6987207">(</span><span class="ident" id="6987208">args</span>&nbsp;<span class="op" id="6987213">*</span><span class="ident" id="6987214">Args</span><span class="op" id="6987218">,</span>&nbsp;<span class="ident" id="6987220">reply</span>&nbsp;<span class="op" id="6987226">*</span><span class="ident" id="6987227">Reply</span><span class="op" id="6987232">)</span>&nbsp;<span class="builtintype" id="6987234">error</span>&nbsp;<span class="op" id="6987240">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987243">return</span>&nbsp;<span class="ident" id="6987250">nil</span><br>
<span class="lineno"></span><span class="op" id="6987254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6987257">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6987349">func</span>&nbsp;<span class="ident" id="6987354">TestRegistrationError</span><span class="op" id="6987375">(</span><span class="ident" id="6987376">t</span>&nbsp;<span class="op" id="6987378">*</span><span class="ident" id="6987379">testing</span><span class="op" id="6987386">.</span><span class="ident" id="6987387">T</span><span class="op" id="6987388">)</span>&nbsp;<span class="op" id="6987390">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987393">err</span>&nbsp;<span class="op" id="6987397">:=</span>&nbsp;<span class="ident" id="6987400">Register</span><span class="op" id="6987408">(</span><span class="builtinfunc" id="6987409">new</span><span class="op" id="6987412">(</span><span class="ident" id="6987413">ReplyNotPointer</span><span class="op" id="6987428">)</span><span class="op" id="6987429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987432">if</span>&nbsp;<span class="ident" id="6987435">err</span>&nbsp;<span class="op" id="6987439">==</span>&nbsp;<span class="ident" id="6987442">nil</span>&nbsp;<span class="op" id="6987446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987450">t</span><span class="op" id="6987451">.</span><span class="ident" id="6987452">Error</span><span class="op" id="6987457">(</span><span class="string" id="6987458">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="6987502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6987505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987508">err</span>&nbsp;<span class="op" id="6987512">=</span>&nbsp;<span class="ident" id="6987514">Register</span><span class="op" id="6987522">(</span><span class="builtinfunc" id="6987523">new</span><span class="op" id="6987526">(</span><span class="ident" id="6987527">ArgNotPublic</span><span class="op" id="6987539">)</span><span class="op" id="6987540">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987543">if</span>&nbsp;<span class="ident" id="6987546">err</span>&nbsp;<span class="op" id="6987550">==</span>&nbsp;<span class="ident" id="6987553">nil</span>&nbsp;<span class="op" id="6987557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987561">t</span><span class="op" id="6987562">.</span><span class="ident" id="6987563">Error</span><span class="op" id="6987568">(</span><span class="string" id="6987569">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="6987610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6987613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987616">err</span>&nbsp;<span class="op" id="6987620">=</span>&nbsp;<span class="ident" id="6987622">Register</span><span class="op" id="6987630">(</span><span class="builtinfunc" id="6987631">new</span><span class="op" id="6987634">(</span><span class="ident" id="6987635">ReplyNotPublic</span><span class="op" id="6987649">)</span><span class="op" id="6987650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987653">if</span>&nbsp;<span class="ident" id="6987656">err</span>&nbsp;<span class="op" id="6987660">==</span>&nbsp;<span class="ident" id="6987663">nil</span>&nbsp;<span class="op" id="6987667">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987671">t</span><span class="op" id="6987672">.</span><span class="ident" id="6987673">Error</span><span class="op" id="6987678">(</span><span class="string" id="6987679">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="6987722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6987725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987728">err</span>&nbsp;<span class="op" id="6987732">=</span>&nbsp;<span class="ident" id="6987734">Register</span><span class="op" id="6987742">(</span><span class="ident" id="6987743">NeedsPtrType</span><span class="op" id="6987755">(</span><span class="num" id="6987756">0</span><span class="op" id="6987757">)</span><span class="op" id="6987758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6987761">if</span>&nbsp;<span class="ident" id="6987764">err</span>&nbsp;<span class="op" id="6987768">==</span>&nbsp;<span class="ident" id="6987771">nil</span>&nbsp;<span class="op" id="6987775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987779">t</span><span class="op" id="6987780">.</span><span class="ident" id="6987781">Error</span><span class="op" id="6987786">(</span><span class="string" id="6987787">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6987828">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6987831">}</span>&nbsp;<span class="keyword" id="6987833">else</span>&nbsp;<span class="keyword" id="6987838">if</span>&nbsp;<span class="op" id="6987841">!</span><span class="ident" id="6987842">strings</span><span class="op" id="6987849">.</span><span class="ident" id="6987850">Contains</span><span class="op" id="6987858">(</span><span class="ident" id="6987859">err</span><span class="op" id="6987862">.</span><span class="ident" id="6987863">Error</span><span class="op" id="6987868">(</span><span class="op" id="6987869">)</span><span class="op" id="6987870">,</span>&nbsp;<span class="string" id="6987872">&#34;pointer&#34;</span><span class="op" id="6987881">)</span>&nbsp;<span class="op" id="6987883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6987887">t</span><span class="op" id="6987888">.</span><span class="ident" id="6987889">Error</span><span class="op" id="6987894">(</span><span class="string" id="6987895">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6987940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6987943">}</span><br>
<span class="lineno"></span><span class="op" id="6987945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6987948">type</span>&nbsp;<span class="ident" id="6987953">WriteFailCodec</span>&nbsp;<span class="builtintype" id="6987968">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6987973">func</span>&nbsp;<span class="op" id="6987978">(</span><span class="ident" id="6987979">WriteFailCodec</span><span class="op" id="6987993">)</span>&nbsp;<span class="ident" id="6987995">WriteRequest</span><span class="op" id="6988007">(</span><span class="op" id="6988008">*</span><span class="ident" id="6988009">Request</span><span class="op" id="6988016">,</span>&nbsp;<span class="keyword" id="6988018">interface</span><span class="op" id="6988027">{</span><span class="op" id="6988028">}</span><span class="op" id="6988029">)</span>&nbsp;<span class="builtintype" id="6988031">error</span>&nbsp;<span class="op" id="6988037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6988040">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988102">return</span>&nbsp;<span class="ident" id="6988109">errors</span><span class="op" id="6988115">.</span><span class="ident" id="6988116">New</span><span class="op" id="6988119">(</span><span class="string" id="6988120">&#34;fail&#34;</span><span class="op" id="6988126">)</span><br>
<span class="lineno">435</span><span class="op" id="6988128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6988131">func</span>&nbsp;<span class="op" id="6988136">(</span><span class="ident" id="6988137">WriteFailCodec</span><span class="op" id="6988151">)</span>&nbsp;<span class="ident" id="6988153">ReadResponseHeader</span><span class="op" id="6988171">(</span><span class="op" id="6988172">*</span><span class="ident" id="6988173">Response</span><span class="op" id="6988181">)</span>&nbsp;<span class="builtintype" id="6988183">error</span>&nbsp;<span class="op" id="6988189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988192">select</span>&nbsp;<span class="op" id="6988199">{</span><span class="op" id="6988200">}</span><br>
<span class="lineno"></span><span class="op" id="6988202">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="6988205">func</span>&nbsp;<span class="op" id="6988210">(</span><span class="ident" id="6988211">WriteFailCodec</span><span class="op" id="6988225">)</span>&nbsp;<span class="ident" id="6988227">ReadResponseBody</span><span class="op" id="6988243">(</span><span class="keyword" id="6988244">interface</span><span class="op" id="6988253">{</span><span class="op" id="6988254">}</span><span class="op" id="6988255">)</span>&nbsp;<span class="builtintype" id="6988257">error</span>&nbsp;<span class="op" id="6988263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988266">select</span>&nbsp;<span class="op" id="6988273">{</span><span class="op" id="6988274">}</span><br>
<span class="lineno"></span><span class="op" id="6988276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="6988279">func</span>&nbsp;<span class="op" id="6988284">(</span><span class="ident" id="6988285">WriteFailCodec</span><span class="op" id="6988299">)</span>&nbsp;<span class="ident" id="6988301">Close</span><span class="op" id="6988306">(</span><span class="op" id="6988307">)</span>&nbsp;<span class="builtintype" id="6988309">error</span>&nbsp;<span class="op" id="6988315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988318">return</span>&nbsp;<span class="ident" id="6988325">nil</span><br>
<span class="lineno"></span><span class="op" id="6988329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6988332">func</span>&nbsp;<span class="ident" id="6988337">TestSendDeadlock</span><span class="op" id="6988353">(</span><span class="ident" id="6988354">t</span>&nbsp;<span class="op" id="6988356">*</span><span class="ident" id="6988357">testing</span><span class="op" id="6988364">.</span><span class="ident" id="6988365">T</span><span class="op" id="6988366">)</span>&nbsp;<span class="op" id="6988368">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988371">client</span>&nbsp;<span class="op" id="6988378">:=</span>&nbsp;<span class="ident" id="6988381">NewClientWithCodec</span><span class="op" id="6988399">(</span><span class="ident" id="6988400">WriteFailCodec</span><span class="op" id="6988414">(</span><span class="num" id="6988415">0</span><span class="op" id="6988416">)</span><span class="op" id="6988417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988420">defer</span>&nbsp;<span class="ident" id="6988426">client</span><span class="op" id="6988432">.</span><span class="ident" id="6988433">Close</span><span class="op" id="6988438">(</span><span class="op" id="6988439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988443">done</span>&nbsp;<span class="op" id="6988448">:=</span>&nbsp;<span class="builtinfunc" id="6988451">make</span><span class="op" id="6988455">(</span><span class="keyword" id="6988456">chan</span>&nbsp;<span class="builtintype" id="6988461">bool</span><span class="op" id="6988465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988468">go</span>&nbsp;<span class="keyword" id="6988471">func</span><span class="op" id="6988475">(</span><span class="op" id="6988476">)</span>&nbsp;<span class="op" id="6988478">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988482">testSendDeadlock</span><span class="op" id="6988498">(</span><span class="ident" id="6988499">client</span><span class="op" id="6988505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988509">testSendDeadlock</span><span class="op" id="6988525">(</span><span class="ident" id="6988526">client</span><span class="op" id="6988532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988536">done</span>&nbsp;<span class="op" id="6988541">&lt;-</span>&nbsp;<span class="builtintype" id="6988544">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6988550">}</span><span class="op" id="6988551">(</span><span class="op" id="6988552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988555">select</span>&nbsp;<span class="op" id="6988562">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988565">case</span>&nbsp;<span class="op" id="6988570">&lt;-</span><span class="ident" id="6988572">done</span><span class="op" id="6988576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988580">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988588">case</span>&nbsp;<span class="op" id="6988593">&lt;-</span><span class="ident" id="6988595">time</span><span class="op" id="6988599">.</span><span class="ident" id="6988600">After</span><span class="op" id="6988605">(</span><span class="num" id="6988606">5</span>&nbsp;<span class="op" id="6988608">*</span>&nbsp;<span class="ident" id="6988610">time</span><span class="op" id="6988614">.</span><span class="ident" id="6988615">Second</span><span class="op" id="6988621">)</span><span class="op" id="6988622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988626">t</span><span class="op" id="6988627">.</span><span class="ident" id="6988628">Fatal</span><span class="op" id="6988633">(</span><span class="string" id="6988634">&#34;deadlock&#34;</span><span class="op" id="6988644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6988647">}</span><br>
<span class="lineno">465</span><span class="op" id="6988649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6988652">func</span>&nbsp;<span class="ident" id="6988657">testSendDeadlock</span><span class="op" id="6988673">(</span><span class="ident" id="6988674">client</span>&nbsp;<span class="op" id="6988681">*</span><span class="ident" id="6988682">Client</span><span class="op" id="6988688">)</span>&nbsp;<span class="op" id="6988690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988693">defer</span>&nbsp;<span class="keyword" id="6988699">func</span><span class="op" id="6988703">(</span><span class="op" id="6988704">)</span>&nbsp;<span class="op" id="6988706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6988710">recover</span><span class="op" id="6988717">(</span><span class="op" id="6988718">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6988721">}</span><span class="op" id="6988722">(</span><span class="op" id="6988723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988726">args</span>&nbsp;<span class="op" id="6988731">:=</span>&nbsp;<span class="op" id="6988734">&amp;</span><span class="ident" id="6988735">Args</span><span class="op" id="6988739">{</span><span class="num" id="6988740">7</span><span class="op" id="6988741">,</span>&nbsp;<span class="num" id="6988743">8</span><span class="op" id="6988744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988747">reply</span>&nbsp;<span class="op" id="6988753">:=</span>&nbsp;<span class="builtinfunc" id="6988756">new</span><span class="op" id="6988759">(</span><span class="ident" id="6988760">Reply</span><span class="op" id="6988765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6988768">client</span><span class="op" id="6988774">.</span><span class="ident" id="6988775">Call</span><span class="op" id="6988779">(</span><span class="string" id="6988780">&#34;Arith.Add&#34;</span><span class="op" id="6988791">,</span>&nbsp;<span class="ident" id="6988793">args</span><span class="op" id="6988797">,</span>&nbsp;<span class="ident" id="6988799">reply</span><span class="op" id="6988804">)</span><br>
<span class="lineno"></span><span class="op" id="6988806">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6988809">func</span>&nbsp;<span class="ident" id="6988814">dialDirect</span><span class="op" id="6988824">(</span><span class="op" id="6988825">)</span>&nbsp;<span class="op" id="6988827">(</span><span class="op" id="6988828">*</span><span class="ident" id="6988829">Client</span><span class="op" id="6988835">,</span>&nbsp;<span class="builtintype" id="6988837">error</span><span class="op" id="6988842">)</span>&nbsp;<span class="op" id="6988844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988847">return</span>&nbsp;<span class="ident" id="6988854">Dial</span><span class="op" id="6988858">(</span><span class="string" id="6988859">&#34;tcp&#34;</span><span class="op" id="6988864">,</span>&nbsp;<span class="ident" id="6988866">serverAddr</span><span class="op" id="6988876">)</span><br>
<span class="lineno"></span><span class="op" id="6988878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6988881">func</span>&nbsp;<span class="ident" id="6988886">dialHTTP</span><span class="op" id="6988894">(</span><span class="op" id="6988895">)</span>&nbsp;<span class="op" id="6988897">(</span><span class="op" id="6988898">*</span><span class="ident" id="6988899">Client</span><span class="op" id="6988905">,</span>&nbsp;<span class="builtintype" id="6988907">error</span><span class="op" id="6988912">)</span>&nbsp;<span class="op" id="6988914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6988917">return</span>&nbsp;<span class="ident" id="6988924">DialHTTP</span><span class="op" id="6988932">(</span><span class="string" id="6988933">&#34;tcp&#34;</span><span class="op" id="6988938">,</span>&nbsp;<span class="ident" id="6988940">httpServerAddr</span><span class="op" id="6988954">)</span><br>
<span class="lineno"></span><span class="op" id="6988956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6988959">func</span>&nbsp;<span class="ident" id="6988964">countMallocs</span><span class="op" id="6988976">(</span><span class="ident" id="6988977">dial</span>&nbsp;<span class="keyword" id="6988982">func</span><span class="op" id="6988986">(</span><span class="op" id="6988987">)</span>&nbsp;<span class="op" id="6988989">(</span><span class="op" id="6988990">*</span><span class="ident" id="6988991">Client</span><span class="op" id="6988997">,</span>&nbsp;<span class="builtintype" id="6988999">error</span><span class="op" id="6989004">)</span><span class="op" id="6989005">,</span>&nbsp;<span class="ident" id="6989007">t</span>&nbsp;<span class="op" id="6989009">*</span><span class="ident" id="6989010">testing</span><span class="op" id="6989017">.</span><span class="ident" id="6989018">T</span><span class="op" id="6989019">)</span>&nbsp;<span class="builtintype" id="6989021">float64</span>&nbsp;<span class="op" id="6989029">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989032">once</span><span class="op" id="6989036">.</span><span class="ident" id="6989037">Do</span><span class="op" id="6989039">(</span><span class="ident" id="6989040">startServer</span><span class="op" id="6989051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989054">client</span><span class="op" id="6989060">,</span>&nbsp;<span class="ident" id="6989062">err</span>&nbsp;<span class="op" id="6989066">:=</span>&nbsp;<span class="ident" id="6989069">dial</span><span class="op" id="6989073">(</span><span class="op" id="6989074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989077">if</span>&nbsp;<span class="ident" id="6989080">err</span>&nbsp;<span class="op" id="6989084">!=</span>&nbsp;<span class="ident" id="6989087">nil</span>&nbsp;<span class="op" id="6989091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989095">t</span><span class="op" id="6989096">.</span><span class="ident" id="6989097">Fatal</span><span class="op" id="6989102">(</span><span class="string" id="6989103">&#34;error&nbsp;dialing&#34;</span><span class="op" id="6989118">,</span>&nbsp;<span class="ident" id="6989120">err</span><span class="op" id="6989123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989126">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989129">defer</span>&nbsp;<span class="ident" id="6989135">client</span><span class="op" id="6989141">.</span><span class="ident" id="6989142">Close</span><span class="op" id="6989147">(</span><span class="op" id="6989148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989152">args</span>&nbsp;<span class="op" id="6989157">:=</span>&nbsp;<span class="op" id="6989160">&amp;</span><span class="ident" id="6989161">Args</span><span class="op" id="6989165">{</span><span class="num" id="6989166">7</span><span class="op" id="6989167">,</span>&nbsp;<span class="num" id="6989169">8</span><span class="op" id="6989170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989173">reply</span>&nbsp;<span class="op" id="6989179">:=</span>&nbsp;<span class="builtinfunc" id="6989182">new</span><span class="op" id="6989185">(</span><span class="ident" id="6989186">Reply</span><span class="op" id="6989191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989194">return</span>&nbsp;<span class="ident" id="6989201">testing</span><span class="op" id="6989208">.</span><span class="ident" id="6989209">AllocsPerRun</span><span class="op" id="6989221">(</span><span class="num" id="6989222">100</span><span class="op" id="6989225">,</span>&nbsp;<span class="keyword" id="6989227">func</span><span class="op" id="6989231">(</span><span class="op" id="6989232">)</span>&nbsp;<span class="op" id="6989234">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989238">err</span>&nbsp;<span class="op" id="6989242">:=</span>&nbsp;<span class="ident" id="6989245">client</span><span class="op" id="6989251">.</span><span class="ident" id="6989252">Call</span><span class="op" id="6989256">(</span><span class="string" id="6989257">&#34;Arith.Add&#34;</span><span class="op" id="6989268">,</span>&nbsp;<span class="ident" id="6989270">args</span><span class="op" id="6989274">,</span>&nbsp;<span class="ident" id="6989276">reply</span><span class="op" id="6989281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989285">if</span>&nbsp;<span class="ident" id="6989288">err</span>&nbsp;<span class="op" id="6989292">!=</span>&nbsp;<span class="ident" id="6989295">nil</span>&nbsp;<span class="op" id="6989299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989304">t</span><span class="op" id="6989305">.</span><span class="ident" id="6989306">Errorf</span><span class="op" id="6989312">(</span><span class="string" id="6989313">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6989355">,</span>&nbsp;<span class="ident" id="6989357">err</span><span class="op" id="6989360">.</span><span class="ident" id="6989361">Error</span><span class="op" id="6989366">(</span><span class="op" id="6989367">)</span><span class="op" id="6989368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989376">if</span>&nbsp;<span class="ident" id="6989379">reply</span><span class="op" id="6989384">.</span><span class="ident" id="6989385">C</span>&nbsp;<span class="op" id="6989387">!=</span>&nbsp;<span class="ident" id="6989390">args</span><span class="op" id="6989394">.</span><span class="ident" id="6989395">A</span><span class="op" id="6989396">+</span><span class="ident" id="6989397">args</span><span class="op" id="6989401">.</span><span class="ident" id="6989402">B</span>&nbsp;<span class="op" id="6989404">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989409">t</span><span class="op" id="6989410">.</span><span class="ident" id="6989411">Errorf</span><span class="op" id="6989417">(</span><span class="string" id="6989418">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6989443">,</span>&nbsp;<span class="ident" id="6989445">reply</span><span class="op" id="6989450">.</span><span class="ident" id="6989451">C</span><span class="op" id="6989452">,</span>&nbsp;<span class="ident" id="6989454">args</span><span class="op" id="6989458">.</span><span class="ident" id="6989459">A</span><span class="op" id="6989460">+</span><span class="ident" id="6989461">args</span><span class="op" id="6989465">.</span><span class="ident" id="6989466">B</span><span class="op" id="6989467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989474">}</span><span class="op" id="6989475">)</span><br>
<span class="lineno"></span><span class="op" id="6989477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6989480">func</span>&nbsp;<span class="ident" id="6989485">TestCountMallocs</span><span class="op" id="6989501">(</span><span class="ident" id="6989502">t</span>&nbsp;<span class="op" id="6989504">*</span><span class="ident" id="6989505">testing</span><span class="op" id="6989512">.</span><span class="ident" id="6989513">T</span><span class="op" id="6989514">)</span>&nbsp;<span class="op" id="6989516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989519">if</span>&nbsp;<span class="ident" id="6989522">testing</span><span class="op" id="6989529">.</span><span class="ident" id="6989530">Short</span><span class="op" id="6989535">(</span><span class="op" id="6989536">)</span>&nbsp;<span class="op" id="6989538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989542">t</span><span class="op" id="6989543">.</span><span class="ident" id="6989544">Skip</span><span class="op" id="6989548">(</span><span class="string" id="6989549">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6989586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989592">if</span>&nbsp;<span class="ident" id="6989595">runtime</span><span class="op" id="6989602">.</span><span class="ident" id="6989603">GOMAXPROCS</span><span class="op" id="6989613">(</span><span class="num" id="6989614">0</span><span class="op" id="6989615">)</span>&nbsp;<span class="op" id="6989617">&gt;</span>&nbsp;<span class="num" id="6989619">1</span>&nbsp;<span class="op" id="6989621">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989625">t</span><span class="op" id="6989626">.</span><span class="ident" id="6989627">Skip</span><span class="op" id="6989631">(</span><span class="string" id="6989632">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6989656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989662">fmt</span><span class="op" id="6989665">.</span><span class="ident" id="6989666">Printf</span><span class="op" id="6989672">(</span><span class="string" id="6989673">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6989707">,</span>&nbsp;<span class="ident" id="6989709">countMallocs</span><span class="op" id="6989721">(</span><span class="ident" id="6989722">dialDirect</span><span class="op" id="6989732">,</span>&nbsp;<span class="ident" id="6989734">t</span><span class="op" id="6989735">)</span><span class="op" id="6989736">)</span><br>
<span class="lineno"></span><span class="op" id="6989738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6989741">func</span>&nbsp;<span class="ident" id="6989746">TestCountMallocsOverHTTP</span><span class="op" id="6989770">(</span><span class="ident" id="6989771">t</span>&nbsp;<span class="op" id="6989773">*</span><span class="ident" id="6989774">testing</span><span class="op" id="6989781">.</span><span class="ident" id="6989782">T</span><span class="op" id="6989783">)</span>&nbsp;<span class="op" id="6989785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989788">if</span>&nbsp;<span class="ident" id="6989791">testing</span><span class="op" id="6989798">.</span><span class="ident" id="6989799">Short</span><span class="op" id="6989804">(</span><span class="op" id="6989805">)</span>&nbsp;<span class="op" id="6989807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989811">t</span><span class="op" id="6989812">.</span><span class="ident" id="6989813">Skip</span><span class="op" id="6989817">(</span><span class="string" id="6989818">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6989855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6989861">if</span>&nbsp;<span class="ident" id="6989864">runtime</span><span class="op" id="6989871">.</span><span class="ident" id="6989872">GOMAXPROCS</span><span class="op" id="6989882">(</span><span class="num" id="6989883">0</span><span class="op" id="6989884">)</span>&nbsp;<span class="op" id="6989886">&gt;</span>&nbsp;<span class="num" id="6989888">1</span>&nbsp;<span class="op" id="6989890">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989894">t</span><span class="op" id="6989895">.</span><span class="ident" id="6989896">Skip</span><span class="op" id="6989900">(</span><span class="string" id="6989901">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6989925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6989928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6989931">fmt</span><span class="op" id="6989934">.</span><span class="ident" id="6989935">Printf</span><span class="op" id="6989941">(</span><span class="string" id="6989942">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6989981">,</span>&nbsp;<span class="ident" id="6989983">countMallocs</span><span class="op" id="6989995">(</span><span class="ident" id="6989996">dialHTTP</span><span class="op" id="6990004">,</span>&nbsp;<span class="ident" id="6990006">t</span><span class="op" id="6990007">)</span><span class="op" id="6990008">)</span><br>
<span class="lineno"></span><span class="op" id="6990010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6990013">type</span>&nbsp;<span class="ident" id="6990018">writeCrasher</span>&nbsp;<span class="keyword" id="6990031">struct</span>&nbsp;<span class="op" id="6990038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990041">done</span>&nbsp;<span class="keyword" id="6990046">chan</span>&nbsp;<span class="builtintype" id="6990051">bool</span><br>
<span class="lineno"></span><span class="op" id="6990056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990059">func</span>&nbsp;<span class="op" id="6990064">(</span><span class="ident" id="6990065">writeCrasher</span><span class="op" id="6990077">)</span>&nbsp;<span class="ident" id="6990079">Close</span><span class="op" id="6990084">(</span><span class="op" id="6990085">)</span>&nbsp;<span class="builtintype" id="6990087">error</span>&nbsp;<span class="op" id="6990093">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990096">return</span>&nbsp;<span class="ident" id="6990103">nil</span><br>
<span class="lineno"></span><span class="op" id="6990107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990110">func</span>&nbsp;<span class="op" id="6990115">(</span><span class="ident" id="6990116">w</span>&nbsp;<span class="op" id="6990118">*</span><span class="ident" id="6990119">writeCrasher</span><span class="op" id="6990131">)</span>&nbsp;<span class="ident" id="6990133">Read</span><span class="op" id="6990137">(</span><span class="ident" id="6990138">p</span>&nbsp;<span class="op" id="6990140">[</span><span class="op" id="6990141">]</span><span class="builtintype" id="6990142">byte</span><span class="op" id="6990146">)</span>&nbsp;<span class="op" id="6990148">(</span><span class="builtintype" id="6990149">int</span><span class="op" id="6990152">,</span>&nbsp;<span class="builtintype" id="6990154">error</span><span class="op" id="6990159">)</span>&nbsp;<span class="op" id="6990161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6990164">&lt;-</span><span class="ident" id="6990166">w</span><span class="op" id="6990167">.</span><span class="ident" id="6990168">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990174">return</span>&nbsp;<span class="num" id="6990181">0</span><span class="op" id="6990182">,</span>&nbsp;<span class="ident" id="6990184">io</span><span class="op" id="6990186">.</span><span class="ident" id="6990187">EOF</span><br>
<span class="lineno"></span><span class="op" id="6990191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990194">func</span>&nbsp;<span class="op" id="6990199">(</span><span class="ident" id="6990200">writeCrasher</span><span class="op" id="6990212">)</span>&nbsp;<span class="ident" id="6990214">Write</span><span class="op" id="6990219">(</span><span class="ident" id="6990220">p</span>&nbsp;<span class="op" id="6990222">[</span><span class="op" id="6990223">]</span><span class="builtintype" id="6990224">byte</span><span class="op" id="6990228">)</span>&nbsp;<span class="op" id="6990230">(</span><span class="builtintype" id="6990231">int</span><span class="op" id="6990234">,</span>&nbsp;<span class="builtintype" id="6990236">error</span><span class="op" id="6990241">)</span>&nbsp;<span class="op" id="6990243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990246">return</span>&nbsp;<span class="num" id="6990253">0</span><span class="op" id="6990254">,</span>&nbsp;<span class="ident" id="6990256">errors</span><span class="op" id="6990262">.</span><span class="ident" id="6990263">New</span><span class="op" id="6990266">(</span><span class="string" id="6990267">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="6990287">)</span><br>
<span class="lineno">540</span><span class="op" id="6990289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990292">func</span>&nbsp;<span class="ident" id="6990297">TestClientWriteError</span><span class="op" id="6990317">(</span><span class="ident" id="6990318">t</span>&nbsp;<span class="op" id="6990320">*</span><span class="ident" id="6990321">testing</span><span class="op" id="6990328">.</span><span class="ident" id="6990329">T</span><span class="op" id="6990330">)</span>&nbsp;<span class="op" id="6990332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990335">w</span>&nbsp;<span class="op" id="6990337">:=</span>&nbsp;<span class="op" id="6990340">&amp;</span><span class="ident" id="6990341">writeCrasher</span><span class="op" id="6990353">{</span><span class="ident" id="6990354">done</span><span class="op" id="6990358">:</span>&nbsp;<span class="builtinfunc" id="6990360">make</span><span class="op" id="6990364">(</span><span class="keyword" id="6990365">chan</span>&nbsp;<span class="builtintype" id="6990370">bool</span><span class="op" id="6990374">)</span><span class="op" id="6990375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990378">c</span>&nbsp;<span class="op" id="6990380">:=</span>&nbsp;<span class="ident" id="6990383">NewClient</span><span class="op" id="6990392">(</span><span class="ident" id="6990393">w</span><span class="op" id="6990394">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990397">defer</span>&nbsp;<span class="ident" id="6990403">c</span><span class="op" id="6990404">.</span><span class="ident" id="6990405">Close</span><span class="op" id="6990410">(</span><span class="op" id="6990411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990415">res</span>&nbsp;<span class="op" id="6990419">:=</span>&nbsp;<span class="builtintype" id="6990422">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990429">err</span>&nbsp;<span class="op" id="6990433">:=</span>&nbsp;<span class="ident" id="6990436">c</span><span class="op" id="6990437">.</span><span class="ident" id="6990438">Call</span><span class="op" id="6990442">(</span><span class="string" id="6990443">&#34;foo&#34;</span><span class="op" id="6990448">,</span>&nbsp;<span class="num" id="6990450">1</span><span class="op" id="6990451">,</span>&nbsp;<span class="op" id="6990453">&amp;</span><span class="ident" id="6990454">res</span><span class="op" id="6990457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990460">if</span>&nbsp;<span class="ident" id="6990463">err</span>&nbsp;<span class="op" id="6990467">==</span>&nbsp;<span class="ident" id="6990470">nil</span>&nbsp;<span class="op" id="6990474">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990478">t</span><span class="op" id="6990479">.</span><span class="ident" id="6990480">Fatal</span><span class="op" id="6990485">(</span><span class="string" id="6990486">&#34;expected&nbsp;error&#34;</span><span class="op" id="6990502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6990505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990508">if</span>&nbsp;<span class="ident" id="6990511">err</span><span class="op" id="6990514">.</span><span class="ident" id="6990515">Error</span><span class="op" id="6990520">(</span><span class="op" id="6990521">)</span>&nbsp;<span class="op" id="6990523">!=</span>&nbsp;<span class="string" id="6990526">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="6990547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990551">t</span><span class="op" id="6990552">.</span><span class="ident" id="6990553">Error</span><span class="op" id="6990558">(</span><span class="string" id="6990559">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="6990587">,</span>&nbsp;<span class="ident" id="6990589">err</span><span class="op" id="6990592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6990595">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990598">w</span><span class="op" id="6990599">.</span><span class="ident" id="6990600">done</span>&nbsp;<span class="op" id="6990605">&lt;-</span>&nbsp;<span class="builtintype" id="6990608">true</span><br>
<span class="lineno"></span><span class="op" id="6990613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990616">func</span>&nbsp;<span class="ident" id="6990621">TestTCPClose</span><span class="op" id="6990633">(</span><span class="ident" id="6990634">t</span>&nbsp;<span class="op" id="6990636">*</span><span class="ident" id="6990637">testing</span><span class="op" id="6990644">.</span><span class="ident" id="6990645">T</span><span class="op" id="6990646">)</span>&nbsp;<span class="op" id="6990648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990651">once</span><span class="op" id="6990655">.</span><span class="ident" id="6990656">Do</span><span class="op" id="6990658">(</span><span class="ident" id="6990659">startServer</span><span class="op" id="6990670">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990674">client</span><span class="op" id="6990680">,</span>&nbsp;<span class="ident" id="6990682">err</span>&nbsp;<span class="op" id="6990686">:=</span>&nbsp;<span class="ident" id="6990689">dialHTTP</span><span class="op" id="6990697">(</span><span class="op" id="6990698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990701">if</span>&nbsp;<span class="ident" id="6990704">err</span>&nbsp;<span class="op" id="6990708">!=</span>&nbsp;<span class="ident" id="6990711">nil</span>&nbsp;<span class="op" id="6990715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990719">t</span><span class="op" id="6990720">.</span><span class="ident" id="6990721">Fatalf</span><span class="op" id="6990727">(</span><span class="string" id="6990728">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6990741">,</span>&nbsp;<span class="ident" id="6990743">err</span><span class="op" id="6990746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6990749">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990752">defer</span>&nbsp;<span class="ident" id="6990758">client</span><span class="op" id="6990764">.</span><span class="ident" id="6990765">Close</span><span class="op" id="6990770">(</span><span class="op" id="6990771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990775">args</span>&nbsp;<span class="op" id="6990780">:=</span>&nbsp;<span class="ident" id="6990783">Args</span><span class="op" id="6990787">{</span><span class="num" id="6990788">17</span><span class="op" id="6990790">,</span>&nbsp;<span class="num" id="6990792">8</span><span class="op" id="6990793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990796">var</span>&nbsp;<span class="ident" id="6990800">reply</span>&nbsp;<span class="ident" id="6990806">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990813">err</span>&nbsp;<span class="op" id="6990817">=</span>&nbsp;<span class="ident" id="6990819">client</span><span class="op" id="6990825">.</span><span class="ident" id="6990826">Call</span><span class="op" id="6990830">(</span><span class="string" id="6990831">&#34;Arith.Mul&#34;</span><span class="op" id="6990842">,</span>&nbsp;<span class="ident" id="6990844">args</span><span class="op" id="6990848">,</span>&nbsp;<span class="op" id="6990850">&amp;</span><span class="ident" id="6990851">reply</span><span class="op" id="6990856">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990859">if</span>&nbsp;<span class="ident" id="6990862">err</span>&nbsp;<span class="op" id="6990866">!=</span>&nbsp;<span class="ident" id="6990869">nil</span>&nbsp;<span class="op" id="6990873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990877">t</span><span class="op" id="6990878">.</span><span class="ident" id="6990879">Fatal</span><span class="op" id="6990884">(</span><span class="string" id="6990885">&#34;arith&nbsp;error:&#34;</span><span class="op" id="6990899">,</span>&nbsp;<span class="ident" id="6990901">err</span><span class="op" id="6990904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6990907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990910">t</span><span class="op" id="6990911">.</span><span class="ident" id="6990912">Logf</span><span class="op" id="6990916">(</span><span class="string" id="6990917">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="6990936">,</span>&nbsp;<span class="ident" id="6990938">args</span><span class="op" id="6990942">.</span><span class="ident" id="6990943">A</span><span class="op" id="6990944">,</span>&nbsp;<span class="ident" id="6990946">args</span><span class="op" id="6990950">.</span><span class="ident" id="6990951">B</span><span class="op" id="6990952">,</span>&nbsp;<span class="ident" id="6990954">reply</span><span class="op" id="6990959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6990962">if</span>&nbsp;<span class="ident" id="6990965">reply</span><span class="op" id="6990970">.</span><span class="ident" id="6990971">C</span>&nbsp;<span class="op" id="6990973">!=</span>&nbsp;<span class="ident" id="6990976">args</span><span class="op" id="6990980">.</span><span class="ident" id="6990981">A</span><span class="op" id="6990982">*</span><span class="ident" id="6990983">args</span><span class="op" id="6990987">.</span><span class="ident" id="6990988">B</span>&nbsp;<span class="op" id="6990990">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990994">t</span><span class="op" id="6990995">.</span><span class="ident" id="6990996">Errorf</span><span class="op" id="6991002">(</span><span class="string" id="6991003">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6991028">,</span>&nbsp;<span class="ident" id="6991030">reply</span><span class="op" id="6991035">.</span><span class="ident" id="6991036">C</span><span class="op" id="6991037">,</span>&nbsp;<span class="ident" id="6991039">args</span><span class="op" id="6991043">.</span><span class="ident" id="6991044">A</span><span class="op" id="6991045">*</span><span class="ident" id="6991046">args</span><span class="op" id="6991050">.</span><span class="ident" id="6991051">B</span><span class="op" id="6991052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991055">}</span><br>
<span class="lineno"></span><span class="op" id="6991057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6991060">func</span>&nbsp;<span class="ident" id="6991065">TestErrorAfterClientClose</span><span class="op" id="6991090">(</span><span class="ident" id="6991091">t</span>&nbsp;<span class="op" id="6991093">*</span><span class="ident" id="6991094">testing</span><span class="op" id="6991101">.</span><span class="ident" id="6991102">T</span><span class="op" id="6991103">)</span>&nbsp;<span class="op" id="6991105">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991108">once</span><span class="op" id="6991112">.</span><span class="ident" id="6991113">Do</span><span class="op" id="6991115">(</span><span class="ident" id="6991116">startServer</span><span class="op" id="6991127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991131">client</span><span class="op" id="6991137">,</span>&nbsp;<span class="ident" id="6991139">err</span>&nbsp;<span class="op" id="6991143">:=</span>&nbsp;<span class="ident" id="6991146">dialHTTP</span><span class="op" id="6991154">(</span><span class="op" id="6991155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991158">if</span>&nbsp;<span class="ident" id="6991161">err</span>&nbsp;<span class="op" id="6991165">!=</span>&nbsp;<span class="ident" id="6991168">nil</span>&nbsp;<span class="op" id="6991172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991176">t</span><span class="op" id="6991177">.</span><span class="ident" id="6991178">Fatalf</span><span class="op" id="6991184">(</span><span class="string" id="6991185">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6991198">,</span>&nbsp;<span class="ident" id="6991200">err</span><span class="op" id="6991203">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991209">err</span>&nbsp;<span class="op" id="6991213">=</span>&nbsp;<span class="ident" id="6991215">client</span><span class="op" id="6991221">.</span><span class="ident" id="6991222">Close</span><span class="op" id="6991227">(</span><span class="op" id="6991228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991231">if</span>&nbsp;<span class="ident" id="6991234">err</span>&nbsp;<span class="op" id="6991238">!=</span>&nbsp;<span class="ident" id="6991241">nil</span>&nbsp;<span class="op" id="6991245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991249">t</span><span class="op" id="6991250">.</span><span class="ident" id="6991251">Fatal</span><span class="op" id="6991256">(</span><span class="string" id="6991257">&#34;close&nbsp;error:&#34;</span><span class="op" id="6991271">,</span>&nbsp;<span class="ident" id="6991273">err</span><span class="op" id="6991276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991279">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991282">err</span>&nbsp;<span class="op" id="6991286">=</span>&nbsp;<span class="ident" id="6991288">client</span><span class="op" id="6991294">.</span><span class="ident" id="6991295">Call</span><span class="op" id="6991299">(</span><span class="string" id="6991300">&#34;Arith.Add&#34;</span><span class="op" id="6991311">,</span>&nbsp;<span class="op" id="6991313">&amp;</span><span class="ident" id="6991314">Args</span><span class="op" id="6991318">{</span><span class="num" id="6991319">7</span><span class="op" id="6991320">,</span>&nbsp;<span class="num" id="6991322">9</span><span class="op" id="6991323">}</span><span class="op" id="6991324">,</span>&nbsp;<span class="builtinfunc" id="6991326">new</span><span class="op" id="6991329">(</span><span class="ident" id="6991330">Reply</span><span class="op" id="6991335">)</span><span class="op" id="6991336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991339">if</span>&nbsp;<span class="ident" id="6991342">err</span>&nbsp;<span class="op" id="6991346">!=</span>&nbsp;<span class="ident" id="6991349">ErrShutdown</span>&nbsp;<span class="op" id="6991361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991365">t</span><span class="op" id="6991366">.</span><span class="ident" id="6991367">Errorf</span><span class="op" id="6991373">(</span><span class="string" id="6991374">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6991412">,</span>&nbsp;<span class="ident" id="6991414">err</span><span class="op" id="6991417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991420">}</span><br>
<span class="lineno"></span><span class="op" id="6991422">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="6991425">func</span>&nbsp;<span class="ident" id="6991430">benchmarkEndToEnd</span><span class="op" id="6991447">(</span><span class="ident" id="6991448">dial</span>&nbsp;<span class="keyword" id="6991453">func</span><span class="op" id="6991457">(</span><span class="op" id="6991458">)</span>&nbsp;<span class="op" id="6991460">(</span><span class="op" id="6991461">*</span><span class="ident" id="6991462">Client</span><span class="op" id="6991468">,</span>&nbsp;<span class="builtintype" id="6991470">error</span><span class="op" id="6991475">)</span><span class="op" id="6991476">,</span>&nbsp;<span class="ident" id="6991478">b</span>&nbsp;<span class="op" id="6991480">*</span><span class="ident" id="6991481">testing</span><span class="op" id="6991488">.</span><span class="ident" id="6991489">B</span><span class="op" id="6991490">)</span>&nbsp;<span class="op" id="6991492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991495">once</span><span class="op" id="6991499">.</span><span class="ident" id="6991500">Do</span><span class="op" id="6991502">(</span><span class="ident" id="6991503">startServer</span><span class="op" id="6991514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991517">client</span><span class="op" id="6991523">,</span>&nbsp;<span class="ident" id="6991525">err</span>&nbsp;<span class="op" id="6991529">:=</span>&nbsp;<span class="ident" id="6991532">dial</span><span class="op" id="6991536">(</span><span class="op" id="6991537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991540">if</span>&nbsp;<span class="ident" id="6991543">err</span>&nbsp;<span class="op" id="6991547">!=</span>&nbsp;<span class="ident" id="6991550">nil</span>&nbsp;<span class="op" id="6991554">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991558">b</span><span class="op" id="6991559">.</span><span class="ident" id="6991560">Fatal</span><span class="op" id="6991565">(</span><span class="string" id="6991566">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6991582">,</span>&nbsp;<span class="ident" id="6991584">err</span><span class="op" id="6991587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991593">defer</span>&nbsp;<span class="ident" id="6991599">client</span><span class="op" id="6991605">.</span><span class="ident" id="6991606">Close</span><span class="op" id="6991611">(</span><span class="op" id="6991612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6991616">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991638">args</span>&nbsp;<span class="op" id="6991643">:=</span>&nbsp;<span class="op" id="6991646">&amp;</span><span class="ident" id="6991647">Args</span><span class="op" id="6991651">{</span><span class="num" id="6991652">7</span><span class="op" id="6991653">,</span>&nbsp;<span class="num" id="6991655">8</span><span class="op" id="6991656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991659">b</span><span class="op" id="6991660">.</span><span class="ident" id="6991661">ResetTimer</span><span class="op" id="6991671">(</span><span class="op" id="6991672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991676">b</span><span class="op" id="6991677">.</span><span class="ident" id="6991678">RunParallel</span><span class="op" id="6991689">(</span><span class="keyword" id="6991690">func</span><span class="op" id="6991694">(</span><span class="ident" id="6991695">pb</span>&nbsp;<span class="op" id="6991698">*</span><span class="ident" id="6991699">testing</span><span class="op" id="6991706">.</span><span class="ident" id="6991707">PB</span><span class="op" id="6991709">)</span>&nbsp;<span class="op" id="6991711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991715">reply</span>&nbsp;<span class="op" id="6991721">:=</span>&nbsp;<span class="builtinfunc" id="6991724">new</span><span class="op" id="6991727">(</span><span class="ident" id="6991728">Reply</span><span class="op" id="6991733">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991737">for</span>&nbsp;<span class="ident" id="6991741">pb</span><span class="op" id="6991743">.</span><span class="ident" id="6991744">Next</span><span class="op" id="6991748">(</span><span class="op" id="6991749">)</span>&nbsp;<span class="op" id="6991751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991756">err</span>&nbsp;<span class="op" id="6991760">:=</span>&nbsp;<span class="ident" id="6991763">client</span><span class="op" id="6991769">.</span><span class="ident" id="6991770">Call</span><span class="op" id="6991774">(</span><span class="string" id="6991775">&#34;Arith.Add&#34;</span><span class="op" id="6991786">,</span>&nbsp;<span class="ident" id="6991788">args</span><span class="op" id="6991792">,</span>&nbsp;<span class="ident" id="6991794">reply</span><span class="op" id="6991799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991804">if</span>&nbsp;<span class="ident" id="6991807">err</span>&nbsp;<span class="op" id="6991811">!=</span>&nbsp;<span class="ident" id="6991814">nil</span>&nbsp;<span class="op" id="6991818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991824">b</span><span class="op" id="6991825">.</span><span class="ident" id="6991826">Fatalf</span><span class="op" id="6991832">(</span><span class="string" id="6991833">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6991886">,</span>&nbsp;<span class="ident" id="6991888">err</span><span class="op" id="6991891">.</span><span class="ident" id="6991892">Error</span><span class="op" id="6991897">(</span><span class="op" id="6991898">)</span><span class="op" id="6991899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991904">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6991909">if</span>&nbsp;<span class="ident" id="6991912">reply</span><span class="op" id="6991917">.</span><span class="ident" id="6991918">C</span>&nbsp;<span class="op" id="6991920">!=</span>&nbsp;<span class="ident" id="6991923">args</span><span class="op" id="6991927">.</span><span class="ident" id="6991928">A</span><span class="op" id="6991929">+</span><span class="ident" id="6991930">args</span><span class="op" id="6991934">.</span><span class="ident" id="6991935">B</span>&nbsp;<span class="op" id="6991937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991943">b</span><span class="op" id="6991944">.</span><span class="ident" id="6991945">Fatalf</span><span class="op" id="6991951">(</span><span class="string" id="6991952">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6991988">,</span>&nbsp;<span class="ident" id="6991990">reply</span><span class="op" id="6991995">.</span><span class="ident" id="6991996">C</span><span class="op" id="6991997">,</span>&nbsp;<span class="ident" id="6991999">args</span><span class="op" id="6992003">.</span><span class="ident" id="6992004">A</span><span class="op" id="6992005">+</span><span class="ident" id="6992006">args</span><span class="op" id="6992010">.</span><span class="ident" id="6992011">B</span><span class="op" id="6992012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992024">}</span><span class="op" id="6992025">)</span><br>
<span class="lineno">620</span><span class="op" id="6992027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6992030">func</span>&nbsp;<span class="ident" id="6992035">benchmarkEndToEndAsync</span><span class="op" id="6992057">(</span><span class="ident" id="6992058">dial</span>&nbsp;<span class="keyword" id="6992063">func</span><span class="op" id="6992067">(</span><span class="op" id="6992068">)</span>&nbsp;<span class="op" id="6992070">(</span><span class="op" id="6992071">*</span><span class="ident" id="6992072">Client</span><span class="op" id="6992078">,</span>&nbsp;<span class="builtintype" id="6992080">error</span><span class="op" id="6992085">)</span><span class="op" id="6992086">,</span>&nbsp;<span class="ident" id="6992088">b</span>&nbsp;<span class="op" id="6992090">*</span><span class="ident" id="6992091">testing</span><span class="op" id="6992098">.</span><span class="ident" id="6992099">B</span><span class="op" id="6992100">)</span>&nbsp;<span class="op" id="6992102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992105">const</span>&nbsp;<span class="ident" id="6992111">MaxConcurrentCalls</span>&nbsp;<span class="op" id="6992130">=</span>&nbsp;<span class="num" id="6992132">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992137">once</span><span class="op" id="6992141">.</span><span class="ident" id="6992142">Do</span><span class="op" id="6992144">(</span><span class="ident" id="6992145">startServer</span><span class="op" id="6992156">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992159">client</span><span class="op" id="6992165">,</span>&nbsp;<span class="ident" id="6992167">err</span>&nbsp;<span class="op" id="6992171">:=</span>&nbsp;<span class="ident" id="6992174">dial</span><span class="op" id="6992178">(</span><span class="op" id="6992179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992182">if</span>&nbsp;<span class="ident" id="6992185">err</span>&nbsp;<span class="op" id="6992189">!=</span>&nbsp;<span class="ident" id="6992192">nil</span>&nbsp;<span class="op" id="6992196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992200">b</span><span class="op" id="6992201">.</span><span class="ident" id="6992202">Fatal</span><span class="op" id="6992207">(</span><span class="string" id="6992208">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6992224">,</span>&nbsp;<span class="ident" id="6992226">err</span><span class="op" id="6992229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992235">defer</span>&nbsp;<span class="ident" id="6992241">client</span><span class="op" id="6992247">.</span><span class="ident" id="6992248">Close</span><span class="op" id="6992253">(</span><span class="op" id="6992254">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992258">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992281">args</span>&nbsp;<span class="op" id="6992286">:=</span>&nbsp;<span class="op" id="6992289">&amp;</span><span class="ident" id="6992290">Args</span><span class="op" id="6992294">{</span><span class="num" id="6992295">7</span><span class="op" id="6992296">,</span>&nbsp;<span class="num" id="6992298">8</span><span class="op" id="6992299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992302">procs</span>&nbsp;<span class="op" id="6992308">:=</span>&nbsp;<span class="num" id="6992311">4</span>&nbsp;<span class="op" id="6992313">*</span>&nbsp;<span class="ident" id="6992315">runtime</span><span class="op" id="6992322">.</span><span class="ident" id="6992323">GOMAXPROCS</span><span class="op" id="6992333">(</span><span class="op" id="6992334">-</span><span class="num" id="6992335">1</span><span class="op" id="6992336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992339">send</span>&nbsp;<span class="op" id="6992344">:=</span>&nbsp;<span class="builtintype" id="6992347">int32</span><span class="op" id="6992352">(</span><span class="ident" id="6992353">b</span><span class="op" id="6992354">.</span><span class="ident" id="6992355">N</span><span class="op" id="6992356">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992359">recv</span>&nbsp;<span class="op" id="6992364">:=</span>&nbsp;<span class="builtintype" id="6992367">int32</span><span class="op" id="6992372">(</span><span class="ident" id="6992373">b</span><span class="op" id="6992374">.</span><span class="ident" id="6992375">N</span><span class="op" id="6992376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992379">var</span>&nbsp;<span class="ident" id="6992383">wg</span>&nbsp;<span class="ident" id="6992386">sync</span><span class="op" id="6992390">.</span><span class="ident" id="6992391">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992402">wg</span><span class="op" id="6992404">.</span><span class="ident" id="6992405">Add</span><span class="op" id="6992408">(</span><span class="ident" id="6992409">procs</span><span class="op" id="6992414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992417">gate</span>&nbsp;<span class="op" id="6992422">:=</span>&nbsp;<span class="builtinfunc" id="6992425">make</span><span class="op" id="6992429">(</span><span class="keyword" id="6992430">chan</span>&nbsp;<span class="builtintype" id="6992435">bool</span><span class="op" id="6992439">,</span>&nbsp;<span class="ident" id="6992441">MaxConcurrentCalls</span><span class="op" id="6992459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992462">res</span>&nbsp;<span class="op" id="6992466">:=</span>&nbsp;<span class="builtinfunc" id="6992469">make</span><span class="op" id="6992473">(</span><span class="keyword" id="6992474">chan</span>&nbsp;<span class="op" id="6992479">*</span><span class="ident" id="6992480">Call</span><span class="op" id="6992484">,</span>&nbsp;<span class="ident" id="6992486">MaxConcurrentCalls</span><span class="op" id="6992504">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992507">b</span><span class="op" id="6992508">.</span><span class="ident" id="6992509">ResetTimer</span><span class="op" id="6992519">(</span><span class="op" id="6992520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992524">for</span>&nbsp;<span class="ident" id="6992528">p</span>&nbsp;<span class="op" id="6992530">:=</span>&nbsp;<span class="num" id="6992533">0</span><span class="op" id="6992534">;</span>&nbsp;<span class="ident" id="6992536">p</span>&nbsp;<span class="op" id="6992538">&lt;</span>&nbsp;<span class="ident" id="6992540">procs</span><span class="op" id="6992545">;</span>&nbsp;<span class="ident" id="6992547">p</span><span class="op" id="6992548">++</span>&nbsp;<span class="op" id="6992551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992555">go</span>&nbsp;<span class="keyword" id="6992558">func</span><span class="op" id="6992562">(</span><span class="op" id="6992563">)</span>&nbsp;<span class="op" id="6992565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992570">for</span>&nbsp;<span class="ident" id="6992574">atomic</span><span class="op" id="6992580">.</span><span class="ident" id="6992581">AddInt32</span><span class="op" id="6992589">(</span><span class="op" id="6992590">&amp;</span><span class="ident" id="6992591">send</span><span class="op" id="6992595">,</span>&nbsp;<span class="op" id="6992597">-</span><span class="num" id="6992598">1</span><span class="op" id="6992599">)</span>&nbsp;<span class="op" id="6992601">&gt;=</span>&nbsp;<span class="num" id="6992604">0</span>&nbsp;<span class="op" id="6992606">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992612">gate</span>&nbsp;<span class="op" id="6992617">&lt;-</span>&nbsp;<span class="builtintype" id="6992620">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992629">reply</span>&nbsp;<span class="op" id="6992635">:=</span>&nbsp;<span class="builtinfunc" id="6992638">new</span><span class="op" id="6992641">(</span><span class="ident" id="6992642">Reply</span><span class="op" id="6992647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992653">client</span><span class="op" id="6992659">.</span><span class="ident" id="6992660">Go</span><span class="op" id="6992662">(</span><span class="string" id="6992663">&#34;Arith.Add&#34;</span><span class="op" id="6992674">,</span>&nbsp;<span class="ident" id="6992676">args</span><span class="op" id="6992680">,</span>&nbsp;<span class="ident" id="6992682">reply</span><span class="op" id="6992687">,</span>&nbsp;<span class="ident" id="6992689">res</span><span class="op" id="6992692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992701">}</span><span class="op" id="6992702">(</span><span class="op" id="6992703">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992707">go</span>&nbsp;<span class="keyword" id="6992710">func</span><span class="op" id="6992714">(</span><span class="op" id="6992715">)</span>&nbsp;<span class="op" id="6992717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992722">for</span>&nbsp;<span class="ident" id="6992726">call</span>&nbsp;<span class="op" id="6992731">:=</span>&nbsp;<span class="keyword" id="6992734">range</span>&nbsp;<span class="ident" id="6992740">res</span>&nbsp;<span class="op" id="6992744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992750">A</span>&nbsp;<span class="op" id="6992752">:=</span>&nbsp;<span class="ident" id="6992755">call</span><span class="op" id="6992759">.</span><span class="ident" id="6992760">Args</span><span class="op" id="6992764">.</span><span class="op" id="6992765">(</span><span class="op" id="6992766">*</span><span class="ident" id="6992767">Args</span><span class="op" id="6992771">)</span><span class="op" id="6992772">.</span><span class="ident" id="6992773">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992779">B</span>&nbsp;<span class="op" id="6992781">:=</span>&nbsp;<span class="ident" id="6992784">call</span><span class="op" id="6992788">.</span><span class="ident" id="6992789">Args</span><span class="op" id="6992793">.</span><span class="op" id="6992794">(</span><span class="op" id="6992795">*</span><span class="ident" id="6992796">Args</span><span class="op" id="6992800">)</span><span class="op" id="6992801">.</span><span class="ident" id="6992802">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992808">C</span>&nbsp;<span class="op" id="6992810">:=</span>&nbsp;<span class="ident" id="6992813">call</span><span class="op" id="6992817">.</span><span class="ident" id="6992818">Reply</span><span class="op" id="6992823">.</span><span class="op" id="6992824">(</span><span class="op" id="6992825">*</span><span class="ident" id="6992826">Reply</span><span class="op" id="6992831">)</span><span class="op" id="6992832">.</span><span class="ident" id="6992833">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992839">if</span>&nbsp;<span class="ident" id="6992842">A</span><span class="op" id="6992843">+</span><span class="ident" id="6992844">B</span>&nbsp;<span class="op" id="6992846">!=</span>&nbsp;<span class="ident" id="6992849">C</span>&nbsp;<span class="op" id="6992851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992858">b</span><span class="op" id="6992859">.</span><span class="ident" id="6992860">Fatalf</span><span class="op" id="6992866">(</span><span class="string" id="6992867">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6992909">,</span>&nbsp;<span class="ident" id="6992911">A</span><span class="op" id="6992912">+</span><span class="ident" id="6992913">B</span><span class="op" id="6992914">,</span>&nbsp;<span class="ident" id="6992916">C</span><span class="op" id="6992917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992929">&lt;-</span><span class="ident" id="6992931">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6992940">if</span>&nbsp;<span class="ident" id="6992943">atomic</span><span class="op" id="6992949">.</span><span class="ident" id="6992950">AddInt32</span><span class="op" id="6992958">(</span><span class="op" id="6992959">&amp;</span><span class="ident" id="6992960">recv</span><span class="op" id="6992964">,</span>&nbsp;<span class="op" id="6992966">-</span><span class="num" id="6992967">1</span><span class="op" id="6992968">)</span>&nbsp;<span class="op" id="6992970">==</span>&nbsp;<span class="num" id="6992973">0</span>&nbsp;<span class="op" id="6992975">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6992982">close</span><span class="op" id="6992987">(</span><span class="ident" id="6992988">res</span><span class="op" id="6992991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993007">wg</span><span class="op" id="6993009">.</span><span class="ident" id="6993010">Done</span><span class="op" id="6993014">(</span><span class="op" id="6993015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993019">}</span><span class="op" id="6993020">(</span><span class="op" id="6993021">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993027">wg</span><span class="op" id="6993029">.</span><span class="ident" id="6993030">Wait</span><span class="op" id="6993034">(</span><span class="op" id="6993035">)</span><br>
<span class="lineno"></span><span class="op" id="6993037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6993040">func</span>&nbsp;<span class="ident" id="6993045">BenchmarkEndToEnd</span><span class="op" id="6993062">(</span><span class="ident" id="6993063">b</span>&nbsp;<span class="op" id="6993065">*</span><span class="ident" id="6993066">testing</span><span class="op" id="6993073">.</span><span class="ident" id="6993074">B</span><span class="op" id="6993075">)</span>&nbsp;<span class="op" id="6993077">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993080">benchmarkEndToEnd</span><span class="op" id="6993097">(</span><span class="ident" id="6993098">dialDirect</span><span class="op" id="6993108">,</span>&nbsp;<span class="ident" id="6993110">b</span><span class="op" id="6993111">)</span><br>
<span class="lineno"></span><span class="op" id="6993113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6993116">func</span>&nbsp;<span class="ident" id="6993121">BenchmarkEndToEndHTTP</span><span class="op" id="6993142">(</span><span class="ident" id="6993143">b</span>&nbsp;<span class="op" id="6993145">*</span><span class="ident" id="6993146">testing</span><span class="op" id="6993153">.</span><span class="ident" id="6993154">B</span><span class="op" id="6993155">)</span>&nbsp;<span class="op" id="6993157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993160">benchmarkEndToEnd</span><span class="op" id="6993177">(</span><span class="ident" id="6993178">dialHTTP</span><span class="op" id="6993186">,</span>&nbsp;<span class="ident" id="6993188">b</span><span class="op" id="6993189">)</span><br>
<span class="lineno">675</span><span class="op" id="6993191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6993194">func</span>&nbsp;<span class="ident" id="6993199">BenchmarkEndToEndAsync</span><span class="op" id="6993221">(</span><span class="ident" id="6993222">b</span>&nbsp;<span class="op" id="6993224">*</span><span class="ident" id="6993225">testing</span><span class="op" id="6993232">.</span><span class="ident" id="6993233">B</span><span class="op" id="6993234">)</span>&nbsp;<span class="op" id="6993236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993239">benchmarkEndToEndAsync</span><span class="op" id="6993261">(</span><span class="ident" id="6993262">dialDirect</span><span class="op" id="6993272">,</span>&nbsp;<span class="ident" id="6993274">b</span><span class="op" id="6993275">)</span><br>
<span class="lineno"></span><span class="op" id="6993277">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="6993280">func</span>&nbsp;<span class="ident" id="6993285">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="6993311">(</span><span class="ident" id="6993312">b</span>&nbsp;<span class="op" id="6993314">*</span><span class="ident" id="6993315">testing</span><span class="op" id="6993322">.</span><span class="ident" id="6993323">B</span><span class="op" id="6993324">)</span>&nbsp;<span class="op" id="6993326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993329">benchmarkEndToEndAsync</span><span class="op" id="6993351">(</span><span class="ident" id="6993352">dialHTTP</span><span class="op" id="6993360">,</span>&nbsp;<span class="ident" id="6993362">b</span><span class="op" id="6993363">)</span><br>
<span class="lineno"></span><span class="op" id="6993365">}</span>
</div>
</body>
</html>
