<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html" class="current">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6447732">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6447787">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6447841">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6447892">package</span>&nbsp;<span class="ident" id="6447900">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6447905">import</span>&nbsp;<span class="op" id="6447912">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447915">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447921">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447932">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447943">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6447953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6447956">type</span>&nbsp;<span class="ident" id="6447961">listenerFile</span>&nbsp;<span class="keyword" id="6447974">interface</span>&nbsp;<span class="op" id="6447984">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6447987">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6447997">File</span><span class="op" id="6448001">(</span><span class="op" id="6448002">)</span>&nbsp;<span class="op" id="6448004">(</span><span class="ident" id="6448005">f</span>&nbsp;<span class="op" id="6448007">*</span><span class="ident" id="6448008">os</span><span class="op" id="6448010">.</span><span class="ident" id="6448011">File</span><span class="op" id="6448015">,</span>&nbsp;<span class="ident" id="6448017">err</span>&nbsp;<span class="builtintype" id="6448021">error</span><span class="op" id="6448026">)</span><br>
<span class="lineno"></span><span class="op" id="6448028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448031">type</span>&nbsp;<span class="ident" id="6448036">packetConnFile</span>&nbsp;<span class="keyword" id="6448051">interface</span>&nbsp;<span class="op" id="6448061">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448064">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448076">File</span><span class="op" id="6448080">(</span><span class="op" id="6448081">)</span>&nbsp;<span class="op" id="6448083">(</span><span class="ident" id="6448084">f</span>&nbsp;<span class="op" id="6448086">*</span><span class="ident" id="6448087">os</span><span class="op" id="6448089">.</span><span class="ident" id="6448090">File</span><span class="op" id="6448094">,</span>&nbsp;<span class="ident" id="6448096">err</span>&nbsp;<span class="builtintype" id="6448100">error</span><span class="op" id="6448105">)</span><br>
<span class="lineno"></span><span class="op" id="6448107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448110">type</span>&nbsp;<span class="ident" id="6448115">connFile</span>&nbsp;<span class="keyword" id="6448124">interface</span>&nbsp;<span class="op" id="6448134">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448137">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448143">File</span><span class="op" id="6448147">(</span><span class="op" id="6448148">)</span>&nbsp;<span class="op" id="6448150">(</span><span class="ident" id="6448151">f</span>&nbsp;<span class="op" id="6448153">*</span><span class="ident" id="6448154">os</span><span class="op" id="6448156">.</span><span class="ident" id="6448157">File</span><span class="op" id="6448161">,</span>&nbsp;<span class="ident" id="6448163">err</span>&nbsp;<span class="builtintype" id="6448167">error</span><span class="op" id="6448172">)</span><br>
<span class="lineno"></span><span class="op" id="6448174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448177">func</span>&nbsp;<span class="ident" id="6448182">testFileListener</span><span class="op" id="6448198">(</span><span class="ident" id="6448199">t</span>&nbsp;<span class="op" id="6448201">*</span><span class="ident" id="6448202">testing</span><span class="op" id="6448209">.</span><span class="ident" id="6448210">T</span><span class="op" id="6448211">,</span>&nbsp;<span class="ident" id="6448213">net</span><span class="op" id="6448216">,</span>&nbsp;<span class="ident" id="6448218">laddr</span>&nbsp;<span class="builtintype" id="6448224">string</span><span class="op" id="6448230">)</span>&nbsp;<span class="op" id="6448232">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448235">switch</span>&nbsp;<span class="ident" id="6448242">net</span>&nbsp;<span class="op" id="6448246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448249">case</span>&nbsp;<span class="string" id="6448254">&#34;tcp&#34;</span><span class="op" id="6448259">,</span>&nbsp;<span class="string" id="6448261">&#34;tcp4&#34;</span><span class="op" id="6448267">,</span>&nbsp;<span class="string" id="6448269">&#34;tcp6&#34;</span><span class="op" id="6448275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448279">laddr</span>&nbsp;<span class="op" id="6448285">+=</span>&nbsp;<span class="string" id="6448288">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6448293">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448319">l</span><span class="op" id="6448320">,</span>&nbsp;<span class="ident" id="6448322">err</span>&nbsp;<span class="op" id="6448326">:=</span>&nbsp;<span class="ident" id="6448329">Listen</span><span class="op" id="6448335">(</span><span class="ident" id="6448336">net</span><span class="op" id="6448339">,</span>&nbsp;<span class="ident" id="6448341">laddr</span><span class="op" id="6448346">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448349">if</span>&nbsp;<span class="ident" id="6448352">err</span>&nbsp;<span class="op" id="6448356">!=</span>&nbsp;<span class="builtintype" id="6448359">nil</span>&nbsp;<span class="op" id="6448363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448367">t</span><span class="op" id="6448368">.</span><span class="ident" id="6448369">Fatalf</span><span class="op" id="6448375">(</span><span class="string" id="6448376">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6448395">,</span>&nbsp;<span class="ident" id="6448397">err</span><span class="op" id="6448400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448406">defer</span>&nbsp;<span class="ident" id="6448412">l</span><span class="op" id="6448413">.</span><span class="ident" id="6448414">Close</span><span class="op" id="6448419">(</span><span class="op" id="6448420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448423">lf</span>&nbsp;<span class="op" id="6448426">:=</span>&nbsp;<span class="ident" id="6448429">l</span><span class="op" id="6448430">.</span><span class="op" id="6448431">(</span><span class="ident" id="6448432">listenerFile</span><span class="op" id="6448444">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448447">f</span><span class="op" id="6448448">,</span>&nbsp;<span class="ident" id="6448450">err</span>&nbsp;<span class="op" id="6448454">:=</span>&nbsp;<span class="ident" id="6448457">lf</span><span class="op" id="6448459">.</span><span class="ident" id="6448460">File</span><span class="op" id="6448464">(</span><span class="op" id="6448465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448468">if</span>&nbsp;<span class="ident" id="6448471">err</span>&nbsp;<span class="op" id="6448475">!=</span>&nbsp;<span class="builtintype" id="6448478">nil</span>&nbsp;<span class="op" id="6448482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448486">t</span><span class="op" id="6448487">.</span><span class="ident" id="6448488">Fatalf</span><span class="op" id="6448494">(</span><span class="string" id="6448495">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6448512">,</span>&nbsp;<span class="ident" id="6448514">err</span><span class="op" id="6448517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448523">c</span><span class="op" id="6448524">,</span>&nbsp;<span class="ident" id="6448526">err</span>&nbsp;<span class="op" id="6448530">:=</span>&nbsp;<span class="ident" id="6448533">FileListener</span><span class="op" id="6448545">(</span><span class="ident" id="6448546">f</span><span class="op" id="6448547">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448550">if</span>&nbsp;<span class="ident" id="6448553">err</span>&nbsp;<span class="op" id="6448557">!=</span>&nbsp;<span class="builtintype" id="6448560">nil</span>&nbsp;<span class="op" id="6448564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448568">t</span><span class="op" id="6448569">.</span><span class="ident" id="6448570">Fatalf</span><span class="op" id="6448576">(</span><span class="string" id="6448577">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6448602">,</span>&nbsp;<span class="ident" id="6448604">err</span><span class="op" id="6448607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448613">if</span>&nbsp;<span class="op" id="6448616">!</span><span class="ident" id="6448617">reflect</span><span class="op" id="6448624">.</span><span class="ident" id="6448625">DeepEqual</span><span class="op" id="6448634">(</span><span class="ident" id="6448635">l</span><span class="op" id="6448636">.</span><span class="ident" id="6448637">Addr</span><span class="op" id="6448641">(</span><span class="op" id="6448642">)</span><span class="op" id="6448643">,</span>&nbsp;<span class="ident" id="6448645">c</span><span class="op" id="6448646">.</span><span class="ident" id="6448647">Addr</span><span class="op" id="6448651">(</span><span class="op" id="6448652">)</span><span class="op" id="6448653">)</span>&nbsp;<span class="op" id="6448655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448659">t</span><span class="op" id="6448660">.</span><span class="ident" id="6448661">Fatalf</span><span class="op" id="6448667">(</span><span class="string" id="6448668">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6448697">,</span>&nbsp;<span class="ident" id="6448699">l</span><span class="op" id="6448700">.</span><span class="ident" id="6448701">Addr</span><span class="op" id="6448705">(</span><span class="op" id="6448706">)</span><span class="op" id="6448707">,</span>&nbsp;<span class="ident" id="6448709">c</span><span class="op" id="6448710">.</span><span class="ident" id="6448711">Addr</span><span class="op" id="6448715">(</span><span class="op" id="6448716">)</span><span class="op" id="6448717">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448723">if</span>&nbsp;<span class="ident" id="6448726">err</span>&nbsp;<span class="op" id="6448730">:=</span>&nbsp;<span class="ident" id="6448733">c</span><span class="op" id="6448734">.</span><span class="ident" id="6448735">Close</span><span class="op" id="6448740">(</span><span class="op" id="6448741">)</span><span class="op" id="6448742">;</span>&nbsp;<span class="ident" id="6448744">err</span>&nbsp;<span class="op" id="6448748">!=</span>&nbsp;<span class="builtintype" id="6448751">nil</span>&nbsp;<span class="op" id="6448755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448759">t</span><span class="op" id="6448760">.</span><span class="ident" id="6448761">Fatalf</span><span class="op" id="6448767">(</span><span class="string" id="6448768">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6448786">,</span>&nbsp;<span class="ident" id="6448788">err</span><span class="op" id="6448791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6448797">if</span>&nbsp;<span class="ident" id="6448800">err</span>&nbsp;<span class="op" id="6448804">:=</span>&nbsp;<span class="ident" id="6448807">f</span><span class="op" id="6448808">.</span><span class="ident" id="6448809">Close</span><span class="op" id="6448814">(</span><span class="op" id="6448815">)</span><span class="op" id="6448816">;</span>&nbsp;<span class="ident" id="6448818">err</span>&nbsp;<span class="op" id="6448822">!=</span>&nbsp;<span class="builtintype" id="6448825">nil</span>&nbsp;<span class="op" id="6448829">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448833">t</span><span class="op" id="6448834">.</span><span class="ident" id="6448835">Fatalf</span><span class="op" id="6448841">(</span><span class="string" id="6448842">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6448860">,</span>&nbsp;<span class="ident" id="6448862">err</span><span class="op" id="6448865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6448868">}</span><br>
<span class="lineno"></span><span class="op" id="6448870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448873">var</span>&nbsp;<span class="ident" id="6448877">fileListenerTests</span>&nbsp;<span class="op" id="6448895">=</span>&nbsp;<span class="op" id="6448897">[</span><span class="op" id="6448898">]</span><span class="keyword" id="6448899">struct</span>&nbsp;<span class="op" id="6448906">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448909">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6448915">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448923">laddr</span>&nbsp;<span class="builtintype" id="6448929">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448937">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6448943">bool</span>&nbsp;<span class="comment" id="6448948">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6448989">linux</span>&nbsp;<span class="builtintype" id="6448995">bool</span>&nbsp;<span class="comment" id="6449000">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6449054">}</span><span class="op" id="6449055">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449058">{</span><span class="ident" id="6449059">net</span><span class="op" id="6449062">:</span>&nbsp;<span class="string" id="6449064">&#34;tcp&#34;</span><span class="op" id="6449069">,</span>&nbsp;<span class="ident" id="6449071">laddr</span><span class="op" id="6449076">:</span>&nbsp;<span class="string" id="6449078">&#34;&#34;</span><span class="op" id="6449080">}</span><span class="op" id="6449081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449084">{</span><span class="ident" id="6449085">net</span><span class="op" id="6449088">:</span>&nbsp;<span class="string" id="6449090">&#34;tcp&#34;</span><span class="op" id="6449095">,</span>&nbsp;<span class="ident" id="6449097">laddr</span><span class="op" id="6449102">:</span>&nbsp;<span class="string" id="6449104">&#34;0.0.0.0&#34;</span><span class="op" id="6449113">}</span><span class="op" id="6449114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449117">{</span><span class="ident" id="6449118">net</span><span class="op" id="6449121">:</span>&nbsp;<span class="string" id="6449123">&#34;tcp&#34;</span><span class="op" id="6449128">,</span>&nbsp;<span class="ident" id="6449130">laddr</span><span class="op" id="6449135">:</span>&nbsp;<span class="string" id="6449137">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6449155">}</span><span class="op" id="6449156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449159">{</span><span class="ident" id="6449160">net</span><span class="op" id="6449163">:</span>&nbsp;<span class="string" id="6449165">&#34;tcp&#34;</span><span class="op" id="6449170">,</span>&nbsp;<span class="ident" id="6449172">laddr</span><span class="op" id="6449177">:</span>&nbsp;<span class="string" id="6449179">&#34;[::]&#34;</span><span class="op" id="6449185">,</span>&nbsp;<span class="ident" id="6449187">ipv6</span><span class="op" id="6449191">:</span>&nbsp;<span class="builtintype" id="6449193">true</span><span class="op" id="6449197">}</span><span class="op" id="6449198">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449202">{</span><span class="ident" id="6449203">net</span><span class="op" id="6449206">:</span>&nbsp;<span class="string" id="6449208">&#34;tcp&#34;</span><span class="op" id="6449213">,</span>&nbsp;<span class="ident" id="6449215">laddr</span><span class="op" id="6449220">:</span>&nbsp;<span class="string" id="6449222">&#34;127.0.0.1&#34;</span><span class="op" id="6449233">}</span><span class="op" id="6449234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449237">{</span><span class="ident" id="6449238">net</span><span class="op" id="6449241">:</span>&nbsp;<span class="string" id="6449243">&#34;tcp&#34;</span><span class="op" id="6449248">,</span>&nbsp;<span class="ident" id="6449250">laddr</span><span class="op" id="6449255">:</span>&nbsp;<span class="string" id="6449257">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6449277">}</span><span class="op" id="6449278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449281">{</span><span class="ident" id="6449282">net</span><span class="op" id="6449285">:</span>&nbsp;<span class="string" id="6449287">&#34;tcp&#34;</span><span class="op" id="6449292">,</span>&nbsp;<span class="ident" id="6449294">laddr</span><span class="op" id="6449299">:</span>&nbsp;<span class="string" id="6449301">&#34;[::1]&#34;</span><span class="op" id="6449308">,</span>&nbsp;<span class="ident" id="6449310">ipv6</span><span class="op" id="6449314">:</span>&nbsp;<span class="builtintype" id="6449316">true</span><span class="op" id="6449320">}</span><span class="op" id="6449321">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449325">{</span><span class="ident" id="6449326">net</span><span class="op" id="6449329">:</span>&nbsp;<span class="string" id="6449331">&#34;tcp4&#34;</span><span class="op" id="6449337">,</span>&nbsp;<span class="ident" id="6449339">laddr</span><span class="op" id="6449344">:</span>&nbsp;<span class="string" id="6449346">&#34;&#34;</span><span class="op" id="6449348">}</span><span class="op" id="6449349">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449352">{</span><span class="ident" id="6449353">net</span><span class="op" id="6449356">:</span>&nbsp;<span class="string" id="6449358">&#34;tcp4&#34;</span><span class="op" id="6449364">,</span>&nbsp;<span class="ident" id="6449366">laddr</span><span class="op" id="6449371">:</span>&nbsp;<span class="string" id="6449373">&#34;0.0.0.0&#34;</span><span class="op" id="6449382">}</span><span class="op" id="6449383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449386">{</span><span class="ident" id="6449387">net</span><span class="op" id="6449390">:</span>&nbsp;<span class="string" id="6449392">&#34;tcp4&#34;</span><span class="op" id="6449398">,</span>&nbsp;<span class="ident" id="6449400">laddr</span><span class="op" id="6449405">:</span>&nbsp;<span class="string" id="6449407">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6449425">}</span><span class="op" id="6449426">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449430">{</span><span class="ident" id="6449431">net</span><span class="op" id="6449434">:</span>&nbsp;<span class="string" id="6449436">&#34;tcp4&#34;</span><span class="op" id="6449442">,</span>&nbsp;<span class="ident" id="6449444">laddr</span><span class="op" id="6449449">:</span>&nbsp;<span class="string" id="6449451">&#34;127.0.0.1&#34;</span><span class="op" id="6449462">}</span><span class="op" id="6449463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449466">{</span><span class="ident" id="6449467">net</span><span class="op" id="6449470">:</span>&nbsp;<span class="string" id="6449472">&#34;tcp4&#34;</span><span class="op" id="6449478">,</span>&nbsp;<span class="ident" id="6449480">laddr</span><span class="op" id="6449485">:</span>&nbsp;<span class="string" id="6449487">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6449507">}</span><span class="op" id="6449508">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449512">{</span><span class="ident" id="6449513">net</span><span class="op" id="6449516">:</span>&nbsp;<span class="string" id="6449518">&#34;tcp6&#34;</span><span class="op" id="6449524">,</span>&nbsp;<span class="ident" id="6449526">laddr</span><span class="op" id="6449531">:</span>&nbsp;<span class="string" id="6449533">&#34;&#34;</span><span class="op" id="6449535">,</span>&nbsp;<span class="ident" id="6449537">ipv6</span><span class="op" id="6449541">:</span>&nbsp;<span class="builtintype" id="6449543">true</span><span class="op" id="6449547">}</span><span class="op" id="6449548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449551">{</span><span class="ident" id="6449552">net</span><span class="op" id="6449555">:</span>&nbsp;<span class="string" id="6449557">&#34;tcp6&#34;</span><span class="op" id="6449563">,</span>&nbsp;<span class="ident" id="6449565">laddr</span><span class="op" id="6449570">:</span>&nbsp;<span class="string" id="6449572">&#34;[::]&#34;</span><span class="op" id="6449578">,</span>&nbsp;<span class="ident" id="6449580">ipv6</span><span class="op" id="6449584">:</span>&nbsp;<span class="builtintype" id="6449586">true</span><span class="op" id="6449590">}</span><span class="op" id="6449591">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449595">{</span><span class="ident" id="6449596">net</span><span class="op" id="6449599">:</span>&nbsp;<span class="string" id="6449601">&#34;tcp6&#34;</span><span class="op" id="6449607">,</span>&nbsp;<span class="ident" id="6449609">laddr</span><span class="op" id="6449614">:</span>&nbsp;<span class="string" id="6449616">&#34;[::1]&#34;</span><span class="op" id="6449623">,</span>&nbsp;<span class="ident" id="6449625">ipv6</span><span class="op" id="6449629">:</span>&nbsp;<span class="builtintype" id="6449631">true</span><span class="op" id="6449635">}</span><span class="op" id="6449636">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449640">{</span><span class="ident" id="6449641">net</span><span class="op" id="6449644">:</span>&nbsp;<span class="string" id="6449646">&#34;unix&#34;</span><span class="op" id="6449652">,</span>&nbsp;<span class="ident" id="6449654">laddr</span><span class="op" id="6449659">:</span>&nbsp;<span class="string" id="6449661">&#34;@gotest/net&#34;</span><span class="op" id="6449674">,</span>&nbsp;<span class="ident" id="6449676">linux</span><span class="op" id="6449681">:</span>&nbsp;<span class="builtintype" id="6449683">true</span><span class="op" id="6449687">}</span><span class="op" id="6449688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449691">{</span><span class="ident" id="6449692">net</span><span class="op" id="6449695">:</span>&nbsp;<span class="string" id="6449697">&#34;unixpacket&#34;</span><span class="op" id="6449709">,</span>&nbsp;<span class="ident" id="6449711">laddr</span><span class="op" id="6449716">:</span>&nbsp;<span class="string" id="6449718">&#34;@gotest/net&#34;</span><span class="op" id="6449731">,</span>&nbsp;<span class="ident" id="6449733">linux</span><span class="op" id="6449738">:</span>&nbsp;<span class="builtintype" id="6449740">true</span><span class="op" id="6449744">}</span><span class="op" id="6449745">,</span><br>
<span class="lineno"></span><span class="op" id="6449747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6449750">func</span>&nbsp;<span class="ident" id="6449755">TestFileListener</span><span class="op" id="6449771">(</span><span class="ident" id="6449772">t</span>&nbsp;<span class="op" id="6449774">*</span><span class="ident" id="6449775">testing</span><span class="op" id="6449782">.</span><span class="ident" id="6449783">T</span><span class="op" id="6449784">)</span>&nbsp;<span class="op" id="6449786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6449789">switch</span>&nbsp;<span class="ident" id="6449796">runtime</span><span class="op" id="6449803">.</span><span class="ident" id="6449804">GOOS</span>&nbsp;<span class="op" id="6449809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6449812">case</span>&nbsp;<span class="string" id="6449817">&#34;nacl&#34;</span><span class="op" id="6449823">,</span>&nbsp;<span class="string" id="6449825">&#34;windows&#34;</span><span class="op" id="6449834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6449838">t</span><span class="op" id="6449839">.</span><span class="ident" id="6449840">Skipf</span><span class="op" id="6449845">(</span><span class="string" id="6449846">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6449867">,</span>&nbsp;<span class="ident" id="6449869">runtime</span><span class="op" id="6449876">.</span><span class="ident" id="6449877">GOOS</span><span class="op" id="6449881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449884">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6449888">for</span>&nbsp;<span class="ident" id="6449892">_</span><span class="op" id="6449893">,</span>&nbsp;<span class="ident" id="6449895">tt</span>&nbsp;<span class="op" id="6449898">:=</span>&nbsp;<span class="keyword" id="6449901">range</span>&nbsp;<span class="ident" id="6449907">fileListenerTests</span>&nbsp;<span class="op" id="6449925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6449929">if</span>&nbsp;<span class="ident" id="6449932">skipServerTest</span><span class="op" id="6449946">(</span><span class="ident" id="6449947">tt</span><span class="op" id="6449949">.</span><span class="ident" id="6449950">net</span><span class="op" id="6449953">,</span>&nbsp;<span class="string" id="6449955">&#34;unix&#34;</span><span class="op" id="6449961">,</span>&nbsp;<span class="ident" id="6449963">tt</span><span class="op" id="6449965">.</span><span class="ident" id="6449966">laddr</span><span class="op" id="6449971">,</span>&nbsp;<span class="ident" id="6449973">tt</span><span class="op" id="6449975">.</span><span class="ident" id="6449976">ipv6</span><span class="op" id="6449980">,</span>&nbsp;<span class="builtintype" id="6449982">false</span><span class="op" id="6449987">,</span>&nbsp;<span class="ident" id="6449989">tt</span><span class="op" id="6449991">.</span><span class="ident" id="6449992">linux</span><span class="op" id="6449997">)</span>&nbsp;<span class="op" id="6449999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450004">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450015">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450019">if</span>&nbsp;<span class="ident" id="6450022">skipServerTest</span><span class="op" id="6450036">(</span><span class="ident" id="6450037">tt</span><span class="op" id="6450039">.</span><span class="ident" id="6450040">net</span><span class="op" id="6450043">,</span>&nbsp;<span class="string" id="6450045">&#34;unixpacket&#34;</span><span class="op" id="6450057">,</span>&nbsp;<span class="ident" id="6450059">tt</span><span class="op" id="6450061">.</span><span class="ident" id="6450062">laddr</span><span class="op" id="6450067">,</span>&nbsp;<span class="ident" id="6450069">tt</span><span class="op" id="6450071">.</span><span class="ident" id="6450072">ipv6</span><span class="op" id="6450076">,</span>&nbsp;<span class="builtintype" id="6450078">false</span><span class="op" id="6450083">,</span>&nbsp;<span class="ident" id="6450085">tt</span><span class="op" id="6450087">.</span><span class="ident" id="6450088">linux</span><span class="op" id="6450093">)</span>&nbsp;<span class="op" id="6450095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450100">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450115">testFileListener</span><span class="op" id="6450131">(</span><span class="ident" id="6450132">t</span><span class="op" id="6450133">,</span>&nbsp;<span class="ident" id="6450135">tt</span><span class="op" id="6450137">.</span><span class="ident" id="6450138">net</span><span class="op" id="6450141">,</span>&nbsp;<span class="ident" id="6450143">tt</span><span class="op" id="6450145">.</span><span class="ident" id="6450146">laddr</span><span class="op" id="6450151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450154">}</span><br>
<span class="lineno">105</span><span class="op" id="6450156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6450159">func</span>&nbsp;<span class="ident" id="6450164">testFilePacketConn</span><span class="op" id="6450182">(</span><span class="ident" id="6450183">t</span>&nbsp;<span class="op" id="6450185">*</span><span class="ident" id="6450186">testing</span><span class="op" id="6450193">.</span><span class="ident" id="6450194">T</span><span class="op" id="6450195">,</span>&nbsp;<span class="ident" id="6450197">pcf</span>&nbsp;<span class="ident" id="6450201">packetConnFile</span><span class="op" id="6450215">,</span>&nbsp;<span class="ident" id="6450217">listen</span>&nbsp;<span class="builtintype" id="6450224">bool</span><span class="op" id="6450228">)</span>&nbsp;<span class="op" id="6450230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450233">f</span><span class="op" id="6450234">,</span>&nbsp;<span class="ident" id="6450236">err</span>&nbsp;<span class="op" id="6450240">:=</span>&nbsp;<span class="ident" id="6450243">pcf</span><span class="op" id="6450246">.</span><span class="ident" id="6450247">File</span><span class="op" id="6450251">(</span><span class="op" id="6450252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450255">if</span>&nbsp;<span class="ident" id="6450258">err</span>&nbsp;<span class="op" id="6450262">!=</span>&nbsp;<span class="builtintype" id="6450265">nil</span>&nbsp;<span class="op" id="6450269">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450273">t</span><span class="op" id="6450274">.</span><span class="ident" id="6450275">Fatalf</span><span class="op" id="6450281">(</span><span class="string" id="6450282">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6450299">,</span>&nbsp;<span class="ident" id="6450301">err</span><span class="op" id="6450304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450310">c</span><span class="op" id="6450311">,</span>&nbsp;<span class="ident" id="6450313">err</span>&nbsp;<span class="op" id="6450317">:=</span>&nbsp;<span class="ident" id="6450320">FilePacketConn</span><span class="op" id="6450334">(</span><span class="ident" id="6450335">f</span><span class="op" id="6450336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450339">if</span>&nbsp;<span class="ident" id="6450342">err</span>&nbsp;<span class="op" id="6450346">!=</span>&nbsp;<span class="builtintype" id="6450349">nil</span>&nbsp;<span class="op" id="6450353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450357">t</span><span class="op" id="6450358">.</span><span class="ident" id="6450359">Fatalf</span><span class="op" id="6450365">(</span><span class="string" id="6450366">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6450393">,</span>&nbsp;<span class="ident" id="6450395">err</span><span class="op" id="6450398">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450404">if</span>&nbsp;<span class="op" id="6450407">!</span><span class="ident" id="6450408">reflect</span><span class="op" id="6450415">.</span><span class="ident" id="6450416">DeepEqual</span><span class="op" id="6450425">(</span><span class="ident" id="6450426">pcf</span><span class="op" id="6450429">.</span><span class="ident" id="6450430">LocalAddr</span><span class="op" id="6450439">(</span><span class="op" id="6450440">)</span><span class="op" id="6450441">,</span>&nbsp;<span class="ident" id="6450443">c</span><span class="op" id="6450444">.</span><span class="ident" id="6450445">LocalAddr</span><span class="op" id="6450454">(</span><span class="op" id="6450455">)</span><span class="op" id="6450456">)</span>&nbsp;<span class="op" id="6450458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450462">t</span><span class="op" id="6450463">.</span><span class="ident" id="6450464">Fatalf</span><span class="op" id="6450470">(</span><span class="string" id="6450471">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6450505">,</span>&nbsp;<span class="ident" id="6450507">pcf</span><span class="op" id="6450510">.</span><span class="ident" id="6450511">LocalAddr</span><span class="op" id="6450520">(</span><span class="op" id="6450521">)</span><span class="op" id="6450522">,</span>&nbsp;<span class="ident" id="6450524">c</span><span class="op" id="6450525">.</span><span class="ident" id="6450526">LocalAddr</span><span class="op" id="6450535">(</span><span class="op" id="6450536">)</span><span class="op" id="6450537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450543">if</span>&nbsp;<span class="ident" id="6450546">listen</span>&nbsp;<span class="op" id="6450553">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450557">if</span>&nbsp;<span class="ident" id="6450560">_</span><span class="op" id="6450561">,</span>&nbsp;<span class="ident" id="6450563">err</span>&nbsp;<span class="op" id="6450567">:=</span>&nbsp;<span class="ident" id="6450570">c</span><span class="op" id="6450571">.</span><span class="ident" id="6450572">WriteTo</span><span class="op" id="6450579">(</span><span class="op" id="6450580">[</span><span class="op" id="6450581">]</span><span class="builtintype" id="6450582">byte</span><span class="op" id="6450586">{</span><span class="op" id="6450587">}</span><span class="op" id="6450588">,</span>&nbsp;<span class="ident" id="6450590">c</span><span class="op" id="6450591">.</span><span class="ident" id="6450592">LocalAddr</span><span class="op" id="6450601">(</span><span class="op" id="6450602">)</span><span class="op" id="6450603">)</span><span class="op" id="6450604">;</span>&nbsp;<span class="ident" id="6450606">err</span>&nbsp;<span class="op" id="6450610">!=</span>&nbsp;<span class="builtintype" id="6450613">nil</span>&nbsp;<span class="op" id="6450617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450622">t</span><span class="op" id="6450623">.</span><span class="ident" id="6450624">Fatalf</span><span class="op" id="6450630">(</span><span class="string" id="6450631">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6450651">,</span>&nbsp;<span class="ident" id="6450653">err</span><span class="op" id="6450656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450666">if</span>&nbsp;<span class="ident" id="6450669">err</span>&nbsp;<span class="op" id="6450673">:=</span>&nbsp;<span class="ident" id="6450676">c</span><span class="op" id="6450677">.</span><span class="ident" id="6450678">Close</span><span class="op" id="6450683">(</span><span class="op" id="6450684">)</span><span class="op" id="6450685">;</span>&nbsp;<span class="ident" id="6450687">err</span>&nbsp;<span class="op" id="6450691">!=</span>&nbsp;<span class="builtintype" id="6450694">nil</span>&nbsp;<span class="op" id="6450698">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450702">t</span><span class="op" id="6450703">.</span><span class="ident" id="6450704">Fatalf</span><span class="op" id="6450710">(</span><span class="string" id="6450711">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6450729">,</span>&nbsp;<span class="ident" id="6450731">err</span><span class="op" id="6450734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450740">if</span>&nbsp;<span class="ident" id="6450743">err</span>&nbsp;<span class="op" id="6450747">:=</span>&nbsp;<span class="ident" id="6450750">f</span><span class="op" id="6450751">.</span><span class="ident" id="6450752">Close</span><span class="op" id="6450757">(</span><span class="op" id="6450758">)</span><span class="op" id="6450759">;</span>&nbsp;<span class="ident" id="6450761">err</span>&nbsp;<span class="op" id="6450765">!=</span>&nbsp;<span class="builtintype" id="6450768">nil</span>&nbsp;<span class="op" id="6450772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450776">t</span><span class="op" id="6450777">.</span><span class="ident" id="6450778">Fatalf</span><span class="op" id="6450784">(</span><span class="string" id="6450785">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6450803">,</span>&nbsp;<span class="ident" id="6450805">err</span><span class="op" id="6450808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450811">}</span><br>
<span class="lineno">130</span><span class="op" id="6450813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6450816">func</span>&nbsp;<span class="ident" id="6450821">testFilePacketConnListen</span><span class="op" id="6450845">(</span><span class="ident" id="6450846">t</span>&nbsp;<span class="op" id="6450848">*</span><span class="ident" id="6450849">testing</span><span class="op" id="6450856">.</span><span class="ident" id="6450857">T</span><span class="op" id="6450858">,</span>&nbsp;<span class="ident" id="6450860">net</span><span class="op" id="6450863">,</span>&nbsp;<span class="ident" id="6450865">laddr</span>&nbsp;<span class="builtintype" id="6450871">string</span><span class="op" id="6450877">)</span>&nbsp;<span class="op" id="6450879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450882">switch</span>&nbsp;<span class="ident" id="6450889">net</span>&nbsp;<span class="op" id="6450893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6450896">case</span>&nbsp;<span class="string" id="6450901">&#34;udp&#34;</span><span class="op" id="6450906">,</span>&nbsp;<span class="string" id="6450908">&#34;udp4&#34;</span><span class="op" id="6450914">,</span>&nbsp;<span class="string" id="6450916">&#34;udp6&#34;</span><span class="op" id="6450922">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450926">laddr</span>&nbsp;<span class="op" id="6450932">+=</span>&nbsp;<span class="string" id="6450935">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6450940">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6450963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6450966">l</span><span class="op" id="6450967">,</span>&nbsp;<span class="ident" id="6450969">err</span>&nbsp;<span class="op" id="6450973">:=</span>&nbsp;<span class="ident" id="6450976">ListenPacket</span><span class="op" id="6450988">(</span><span class="ident" id="6450989">net</span><span class="op" id="6450992">,</span>&nbsp;<span class="ident" id="6450994">laddr</span><span class="op" id="6450999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451002">if</span>&nbsp;<span class="ident" id="6451005">err</span>&nbsp;<span class="op" id="6451009">!=</span>&nbsp;<span class="builtintype" id="6451012">nil</span>&nbsp;<span class="op" id="6451016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451020">t</span><span class="op" id="6451021">.</span><span class="ident" id="6451022">Fatalf</span><span class="op" id="6451028">(</span><span class="string" id="6451029">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6451054">,</span>&nbsp;<span class="ident" id="6451056">err</span><span class="op" id="6451059">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451065">testFilePacketConn</span><span class="op" id="6451083">(</span><span class="ident" id="6451084">t</span><span class="op" id="6451085">,</span>&nbsp;<span class="ident" id="6451087">l</span><span class="op" id="6451088">.</span><span class="op" id="6451089">(</span><span class="ident" id="6451090">packetConnFile</span><span class="op" id="6451104">)</span><span class="op" id="6451105">,</span>&nbsp;<span class="builtintype" id="6451107">true</span><span class="op" id="6451111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451114">if</span>&nbsp;<span class="ident" id="6451117">err</span>&nbsp;<span class="op" id="6451121">:=</span>&nbsp;<span class="ident" id="6451124">l</span><span class="op" id="6451125">.</span><span class="ident" id="6451126">Close</span><span class="op" id="6451131">(</span><span class="op" id="6451132">)</span><span class="op" id="6451133">;</span>&nbsp;<span class="ident" id="6451135">err</span>&nbsp;<span class="op" id="6451139">!=</span>&nbsp;<span class="builtintype" id="6451142">nil</span>&nbsp;<span class="op" id="6451146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451150">t</span><span class="op" id="6451151">.</span><span class="ident" id="6451152">Fatalf</span><span class="op" id="6451158">(</span><span class="string" id="6451159">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6451177">,</span>&nbsp;<span class="ident" id="6451179">err</span><span class="op" id="6451182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451185">}</span><br>
<span class="lineno">145</span><span class="op" id="6451187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6451190">func</span>&nbsp;<span class="ident" id="6451195">testFilePacketConnDial</span><span class="op" id="6451217">(</span><span class="ident" id="6451218">t</span>&nbsp;<span class="op" id="6451220">*</span><span class="ident" id="6451221">testing</span><span class="op" id="6451228">.</span><span class="ident" id="6451229">T</span><span class="op" id="6451230">,</span>&nbsp;<span class="ident" id="6451232">net</span><span class="op" id="6451235">,</span>&nbsp;<span class="ident" id="6451237">raddr</span>&nbsp;<span class="builtintype" id="6451243">string</span><span class="op" id="6451249">)</span>&nbsp;<span class="op" id="6451251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451254">switch</span>&nbsp;<span class="ident" id="6451261">net</span>&nbsp;<span class="op" id="6451265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451268">case</span>&nbsp;<span class="string" id="6451273">&#34;udp&#34;</span><span class="op" id="6451278">,</span>&nbsp;<span class="string" id="6451280">&#34;udp4&#34;</span><span class="op" id="6451286">,</span>&nbsp;<span class="string" id="6451288">&#34;udp6&#34;</span><span class="op" id="6451294">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451298">raddr</span>&nbsp;<span class="op" id="6451304">+=</span>&nbsp;<span class="string" id="6451307">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451320">c</span><span class="op" id="6451321">,</span>&nbsp;<span class="ident" id="6451323">err</span>&nbsp;<span class="op" id="6451327">:=</span>&nbsp;<span class="ident" id="6451330">Dial</span><span class="op" id="6451334">(</span><span class="ident" id="6451335">net</span><span class="op" id="6451338">,</span>&nbsp;<span class="ident" id="6451340">raddr</span><span class="op" id="6451345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451348">if</span>&nbsp;<span class="ident" id="6451351">err</span>&nbsp;<span class="op" id="6451355">!=</span>&nbsp;<span class="builtintype" id="6451358">nil</span>&nbsp;<span class="op" id="6451362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451366">t</span><span class="op" id="6451367">.</span><span class="ident" id="6451368">Fatalf</span><span class="op" id="6451374">(</span><span class="string" id="6451375">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6451392">,</span>&nbsp;<span class="ident" id="6451394">err</span><span class="op" id="6451397">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451403">testFilePacketConn</span><span class="op" id="6451421">(</span><span class="ident" id="6451422">t</span><span class="op" id="6451423">,</span>&nbsp;<span class="ident" id="6451425">c</span><span class="op" id="6451426">.</span><span class="op" id="6451427">(</span><span class="ident" id="6451428">packetConnFile</span><span class="op" id="6451442">)</span><span class="op" id="6451443">,</span>&nbsp;<span class="builtintype" id="6451445">false</span><span class="op" id="6451450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6451453">if</span>&nbsp;<span class="ident" id="6451456">err</span>&nbsp;<span class="op" id="6451460">:=</span>&nbsp;<span class="ident" id="6451463">c</span><span class="op" id="6451464">.</span><span class="ident" id="6451465">Close</span><span class="op" id="6451470">(</span><span class="op" id="6451471">)</span><span class="op" id="6451472">;</span>&nbsp;<span class="ident" id="6451474">err</span>&nbsp;<span class="op" id="6451478">!=</span>&nbsp;<span class="builtintype" id="6451481">nil</span>&nbsp;<span class="op" id="6451485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451489">t</span><span class="op" id="6451490">.</span><span class="ident" id="6451491">Fatalf</span><span class="op" id="6451497">(</span><span class="string" id="6451498">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6451516">,</span>&nbsp;<span class="ident" id="6451518">err</span><span class="op" id="6451521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451524">}</span><br>
<span class="lineno">160</span><span class="op" id="6451526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6451529">var</span>&nbsp;<span class="ident" id="6451533">filePacketConnTests</span>&nbsp;<span class="op" id="6451553">=</span>&nbsp;<span class="op" id="6451555">[</span><span class="op" id="6451556">]</span><span class="keyword" id="6451557">struct</span>&nbsp;<span class="op" id="6451564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451567">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6451573">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451581">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6451587">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451595">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6451601">bool</span>&nbsp;<span class="comment" id="6451606">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6451647">linux</span>&nbsp;<span class="builtintype" id="6451653">bool</span>&nbsp;<span class="comment" id="6451658">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6451712">}</span><span class="op" id="6451713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451716">{</span><span class="ident" id="6451717">net</span><span class="op" id="6451720">:</span>&nbsp;<span class="string" id="6451722">&#34;udp&#34;</span><span class="op" id="6451727">,</span>&nbsp;<span class="ident" id="6451729">addr</span><span class="op" id="6451733">:</span>&nbsp;<span class="string" id="6451735">&#34;127.0.0.1&#34;</span><span class="op" id="6451746">}</span><span class="op" id="6451747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451750">{</span><span class="ident" id="6451751">net</span><span class="op" id="6451754">:</span>&nbsp;<span class="string" id="6451756">&#34;udp&#34;</span><span class="op" id="6451761">,</span>&nbsp;<span class="ident" id="6451763">addr</span><span class="op" id="6451767">:</span>&nbsp;<span class="string" id="6451769">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6451789">}</span><span class="op" id="6451790">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451793">{</span><span class="ident" id="6451794">net</span><span class="op" id="6451797">:</span>&nbsp;<span class="string" id="6451799">&#34;udp&#34;</span><span class="op" id="6451804">,</span>&nbsp;<span class="ident" id="6451806">addr</span><span class="op" id="6451810">:</span>&nbsp;<span class="string" id="6451812">&#34;[::1]&#34;</span><span class="op" id="6451819">,</span>&nbsp;<span class="ident" id="6451821">ipv6</span><span class="op" id="6451825">:</span>&nbsp;<span class="builtintype" id="6451827">true</span><span class="op" id="6451831">}</span><span class="op" id="6451832">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451836">{</span><span class="ident" id="6451837">net</span><span class="op" id="6451840">:</span>&nbsp;<span class="string" id="6451842">&#34;udp4&#34;</span><span class="op" id="6451848">,</span>&nbsp;<span class="ident" id="6451850">addr</span><span class="op" id="6451854">:</span>&nbsp;<span class="string" id="6451856">&#34;127.0.0.1&#34;</span><span class="op" id="6451867">}</span><span class="op" id="6451868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451871">{</span><span class="ident" id="6451872">net</span><span class="op" id="6451875">:</span>&nbsp;<span class="string" id="6451877">&#34;udp4&#34;</span><span class="op" id="6451883">,</span>&nbsp;<span class="ident" id="6451885">addr</span><span class="op" id="6451889">:</span>&nbsp;<span class="string" id="6451891">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6451911">}</span><span class="op" id="6451912">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451916">{</span><span class="ident" id="6451917">net</span><span class="op" id="6451920">:</span>&nbsp;<span class="string" id="6451922">&#34;udp6&#34;</span><span class="op" id="6451928">,</span>&nbsp;<span class="ident" id="6451930">addr</span><span class="op" id="6451934">:</span>&nbsp;<span class="string" id="6451936">&#34;[::1]&#34;</span><span class="op" id="6451943">,</span>&nbsp;<span class="ident" id="6451945">ipv6</span><span class="op" id="6451949">:</span>&nbsp;<span class="builtintype" id="6451951">true</span><span class="op" id="6451955">}</span><span class="op" id="6451956">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6451960">{</span><span class="ident" id="6451961">net</span><span class="op" id="6451964">:</span>&nbsp;<span class="string" id="6451966">&#34;ip4:icmp&#34;</span><span class="op" id="6451976">,</span>&nbsp;<span class="ident" id="6451978">addr</span><span class="op" id="6451982">:</span>&nbsp;<span class="string" id="6451984">&#34;127.0.0.1&#34;</span><span class="op" id="6451995">}</span><span class="op" id="6451996">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452000">{</span><span class="ident" id="6452001">net</span><span class="op" id="6452004">:</span>&nbsp;<span class="string" id="6452006">&#34;unixgram&#34;</span><span class="op" id="6452016">,</span>&nbsp;<span class="ident" id="6452018">addr</span><span class="op" id="6452022">:</span>&nbsp;<span class="string" id="6452024">&#34;@gotest3/net&#34;</span><span class="op" id="6452038">,</span>&nbsp;<span class="ident" id="6452040">linux</span><span class="op" id="6452045">:</span>&nbsp;<span class="builtintype" id="6452047">true</span><span class="op" id="6452051">}</span><span class="op" id="6452052">,</span><br>
<span class="lineno">180</span><span class="op" id="6452054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6452057">func</span>&nbsp;<span class="ident" id="6452062">TestFilePacketConn</span><span class="op" id="6452080">(</span><span class="ident" id="6452081">t</span>&nbsp;<span class="op" id="6452083">*</span><span class="ident" id="6452084">testing</span><span class="op" id="6452091">.</span><span class="ident" id="6452092">T</span><span class="op" id="6452093">)</span>&nbsp;<span class="op" id="6452095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452098">switch</span>&nbsp;<span class="ident" id="6452105">runtime</span><span class="op" id="6452112">.</span><span class="ident" id="6452113">GOOS</span>&nbsp;<span class="op" id="6452118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452121">case</span>&nbsp;<span class="string" id="6452126">&#34;nacl&#34;</span><span class="op" id="6452132">,</span>&nbsp;<span class="string" id="6452134">&#34;plan9&#34;</span><span class="op" id="6452141">,</span>&nbsp;<span class="string" id="6452143">&#34;windows&#34;</span><span class="op" id="6452152">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6452156">t</span><span class="op" id="6452157">.</span><span class="ident" id="6452158">Skipf</span><span class="op" id="6452163">(</span><span class="string" id="6452164">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6452185">,</span>&nbsp;<span class="ident" id="6452187">runtime</span><span class="op" id="6452194">.</span><span class="ident" id="6452195">GOOS</span><span class="op" id="6452199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452206">for</span>&nbsp;<span class="ident" id="6452210">_</span><span class="op" id="6452211">,</span>&nbsp;<span class="ident" id="6452213">tt</span>&nbsp;<span class="op" id="6452216">:=</span>&nbsp;<span class="keyword" id="6452219">range</span>&nbsp;<span class="ident" id="6452225">filePacketConnTests</span>&nbsp;<span class="op" id="6452245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452249">if</span>&nbsp;<span class="ident" id="6452252">skipServerTest</span><span class="op" id="6452266">(</span><span class="ident" id="6452267">tt</span><span class="op" id="6452269">.</span><span class="ident" id="6452270">net</span><span class="op" id="6452273">,</span>&nbsp;<span class="string" id="6452275">&#34;unixgram&#34;</span><span class="op" id="6452285">,</span>&nbsp;<span class="ident" id="6452287">tt</span><span class="op" id="6452289">.</span><span class="ident" id="6452290">addr</span><span class="op" id="6452294">,</span>&nbsp;<span class="ident" id="6452296">tt</span><span class="op" id="6452298">.</span><span class="ident" id="6452299">ipv6</span><span class="op" id="6452303">,</span>&nbsp;<span class="builtintype" id="6452305">false</span><span class="op" id="6452310">,</span>&nbsp;<span class="ident" id="6452312">tt</span><span class="op" id="6452314">.</span><span class="ident" id="6452315">linux</span><span class="op" id="6452320">)</span>&nbsp;<span class="op" id="6452322">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452327">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452342">if</span>&nbsp;<span class="ident" id="6452345">os</span><span class="op" id="6452347">.</span><span class="ident" id="6452348">Getuid</span><span class="op" id="6452354">(</span><span class="op" id="6452355">)</span>&nbsp;<span class="op" id="6452357">!=</span>&nbsp;<span class="num" id="6452360">0</span>&nbsp;<span class="op" id="6452362">&amp;&amp;</span>&nbsp;<span class="ident" id="6452365">tt</span><span class="op" id="6452367">.</span><span class="ident" id="6452368">net</span>&nbsp;<span class="op" id="6452372">==</span>&nbsp;<span class="string" id="6452375">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="6452386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6452391">t</span><span class="op" id="6452392">.</span><span class="ident" id="6452393">Log</span><span class="op" id="6452396">(</span><span class="string" id="6452397">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6452426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452431">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6452446">testFilePacketConnListen</span><span class="op" id="6452470">(</span><span class="ident" id="6452471">t</span><span class="op" id="6452472">,</span>&nbsp;<span class="ident" id="6452474">tt</span><span class="op" id="6452476">.</span><span class="ident" id="6452477">net</span><span class="op" id="6452480">,</span>&nbsp;<span class="ident" id="6452482">tt</span><span class="op" id="6452484">.</span><span class="ident" id="6452485">addr</span><span class="op" id="6452489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452493">switch</span>&nbsp;<span class="ident" id="6452500">tt</span><span class="op" id="6452502">.</span><span class="ident" id="6452503">addr</span>&nbsp;<span class="op" id="6452508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452512">case</span>&nbsp;<span class="string" id="6452517">&#34;&#34;</span><span class="op" id="6452519">,</span>&nbsp;<span class="string" id="6452521">&#34;0.0.0.0&#34;</span><span class="op" id="6452530">,</span>&nbsp;<span class="string" id="6452532">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6452550">,</span>&nbsp;<span class="string" id="6452552">&#34;[::]&#34;</span><span class="op" id="6452558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452562">default</span><span class="op" id="6452569">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6452574">if</span>&nbsp;<span class="ident" id="6452577">tt</span><span class="op" id="6452579">.</span><span class="ident" id="6452580">net</span>&nbsp;<span class="op" id="6452584">!=</span>&nbsp;<span class="string" id="6452587">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="6452598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6452604">testFilePacketConnDial</span><span class="op" id="6452626">(</span><span class="ident" id="6452627">t</span><span class="op" id="6452628">,</span>&nbsp;<span class="ident" id="6452630">tt</span><span class="op" id="6452632">.</span><span class="ident" id="6452633">net</span><span class="op" id="6452636">,</span>&nbsp;<span class="ident" id="6452638">tt</span><span class="op" id="6452640">.</span><span class="ident" id="6452641">addr</span><span class="op" id="6452645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6452657">}</span><br>
<span class="lineno">205</span><span class="op" id="6452659">}</span>
</div>
</body>
</html>
