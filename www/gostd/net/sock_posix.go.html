<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html" class="current">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3348197">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3348253">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3348307">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3348358">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348436">package</span>&nbsp;<span class="ident" id="3348444">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348449">import</span>&nbsp;<span class="op" id="3348456">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3348459">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3348465">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3348476">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3348483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3348486">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3348551">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3348609">type</span>&nbsp;<span class="ident" id="3348614">sockaddr</span>&nbsp;<span class="keyword" id="3348623">interface</span>&nbsp;<span class="op" id="3348633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348636">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348643">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348653">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348710">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348726">family</span><span class="op" id="3348732">(</span><span class="op" id="3348733">)</span>&nbsp;<span class="builtintype" id="3348735">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348741">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348798">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348811">isWildcard</span><span class="op" id="3348821">(</span><span class="op" id="3348822">)</span>&nbsp;<span class="builtintype" id="3348824">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348831">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348889">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348940">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349002">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349011">sockaddr</span><span class="op" id="3349019">(</span><span class="ident" id="3349020">family</span>&nbsp;<span class="builtintype" id="3349027">int</span><span class="op" id="3349030">)</span>&nbsp;<span class="op" id="3349032">(</span><span class="ident" id="3349033">syscall</span><span class="op" id="3349040">.</span><span class="ident" id="3349041">Sockaddr</span><span class="op" id="3349049">,</span>&nbsp;<span class="builtintype" id="3349051">error</span><span class="op" id="3349056">)</span><br>
<span class="lineno">35</span><span class="op" id="3349058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349061">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3349123">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3349169">func</span>&nbsp;<span class="ident" id="3349174">socket</span><span class="op" id="3349180">(</span><span class="ident" id="3349181">net</span>&nbsp;<span class="builtintype" id="3349185">string</span><span class="op" id="3349191">,</span>&nbsp;<span class="ident" id="3349193">family</span><span class="op" id="3349199">,</span>&nbsp;<span class="ident" id="3349201">sotype</span><span class="op" id="3349207">,</span>&nbsp;<span class="ident" id="3349209">proto</span>&nbsp;<span class="builtintype" id="3349215">int</span><span class="op" id="3349218">,</span>&nbsp;<span class="ident" id="3349220">ipv6only</span>&nbsp;<span class="builtintype" id="3349229">bool</span><span class="op" id="3349233">,</span>&nbsp;<span class="ident" id="3349235">laddr</span><span class="op" id="3349240">,</span>&nbsp;<span class="ident" id="3349242">raddr</span>&nbsp;<span class="ident" id="3349248">sockaddr</span><span class="op" id="3349256">,</span>&nbsp;<span class="ident" id="3349258">deadline</span>&nbsp;<span class="ident" id="3349267">time</span><span class="op" id="3349271">.</span><span class="ident" id="3349272">Time</span><span class="op" id="3349276">)</span>&nbsp;<span class="op" id="3349278">(</span><span class="ident" id="3349279">fd</span>&nbsp;<span class="op" id="3349282">*</span><span class="ident" id="3349283">netFD</span><span class="op" id="3349288">,</span>&nbsp;<span class="ident" id="3349290">err</span>&nbsp;<span class="builtintype" id="3349294">error</span><span class="op" id="3349299">)</span>&nbsp;<span class="op" id="3349301">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349304">s</span><span class="op" id="3349305">,</span>&nbsp;<span class="ident" id="3349307">err</span>&nbsp;<span class="op" id="3349311">:=</span>&nbsp;<span class="ident" id="3349314">sysSocket</span><span class="op" id="3349323">(</span><span class="ident" id="3349324">family</span><span class="op" id="3349330">,</span>&nbsp;<span class="ident" id="3349332">sotype</span><span class="op" id="3349338">,</span>&nbsp;<span class="ident" id="3349340">proto</span><span class="op" id="3349345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349348">if</span>&nbsp;<span class="ident" id="3349351">err</span>&nbsp;<span class="op" id="3349355">!=</span>&nbsp;<span class="builtintype" id="3349358">nil</span>&nbsp;<span class="op" id="3349362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349366">return</span>&nbsp;<span class="builtintype" id="3349373">nil</span><span class="op" id="3349376">,</span>&nbsp;<span class="ident" id="3349378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349386">if</span>&nbsp;<span class="ident" id="3349389">err</span>&nbsp;<span class="op" id="3349393">=</span>&nbsp;<span class="ident" id="3349395">setDefaultSockopts</span><span class="op" id="3349413">(</span><span class="ident" id="3349414">s</span><span class="op" id="3349415">,</span>&nbsp;<span class="ident" id="3349417">family</span><span class="op" id="3349423">,</span>&nbsp;<span class="ident" id="3349425">sotype</span><span class="op" id="3349431">,</span>&nbsp;<span class="ident" id="3349433">ipv6only</span><span class="op" id="3349441">)</span><span class="op" id="3349442">;</span>&nbsp;<span class="ident" id="3349444">err</span>&nbsp;<span class="op" id="3349448">!=</span>&nbsp;<span class="builtintype" id="3349451">nil</span>&nbsp;<span class="op" id="3349455">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349459">closesocket</span><span class="op" id="3349470">(</span><span class="ident" id="3349471">s</span><span class="op" id="3349472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349476">return</span>&nbsp;<span class="builtintype" id="3349483">nil</span><span class="op" id="3349486">,</span>&nbsp;<span class="ident" id="3349488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349496">if</span>&nbsp;<span class="ident" id="3349499">fd</span><span class="op" id="3349501">,</span>&nbsp;<span class="ident" id="3349503">err</span>&nbsp;<span class="op" id="3349507">=</span>&nbsp;<span class="ident" id="3349509">newFD</span><span class="op" id="3349514">(</span><span class="ident" id="3349515">s</span><span class="op" id="3349516">,</span>&nbsp;<span class="ident" id="3349518">family</span><span class="op" id="3349524">,</span>&nbsp;<span class="ident" id="3349526">sotype</span><span class="op" id="3349532">,</span>&nbsp;<span class="ident" id="3349534">net</span><span class="op" id="3349537">)</span><span class="op" id="3349538">;</span>&nbsp;<span class="ident" id="3349540">err</span>&nbsp;<span class="op" id="3349544">!=</span>&nbsp;<span class="builtintype" id="3349547">nil</span>&nbsp;<span class="op" id="3349551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349555">closesocket</span><span class="op" id="3349566">(</span><span class="ident" id="3349567">s</span><span class="op" id="3349568">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349572">return</span>&nbsp;<span class="builtintype" id="3349579">nil</span><span class="op" id="3349582">,</span>&nbsp;<span class="ident" id="3349584">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349593">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349651">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349679">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349683">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349736">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349782">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349786">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349847">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349903">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349907">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349965">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350024">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350037">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350041">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350104">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350161">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350165">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350227">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350288">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350352">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350415">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350450">if</span>&nbsp;<span class="ident" id="3350453">laddr</span>&nbsp;<span class="op" id="3350459">!=</span>&nbsp;<span class="builtintype" id="3350462">nil</span>&nbsp;<span class="op" id="3350466">&amp;&amp;</span>&nbsp;<span class="ident" id="3350469">raddr</span>&nbsp;<span class="op" id="3350475">==</span>&nbsp;<span class="builtintype" id="3350478">nil</span>&nbsp;<span class="op" id="3350482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350486">switch</span>&nbsp;<span class="ident" id="3350493">sotype</span>&nbsp;<span class="op" id="3350500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350504">case</span>&nbsp;<span class="ident" id="3350509">syscall</span><span class="op" id="3350516">.</span><span class="ident" id="3350517">SOCK_STREAM</span><span class="op" id="3350528">,</span>&nbsp;<span class="ident" id="3350530">syscall</span><span class="op" id="3350537">.</span><span class="ident" id="3350538">SOCK_SEQPACKET</span><span class="op" id="3350552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350557">if</span>&nbsp;<span class="ident" id="3350560">err</span>&nbsp;<span class="op" id="3350564">:=</span>&nbsp;<span class="ident" id="3350567">fd</span><span class="op" id="3350569">.</span><span class="ident" id="3350570">listenStream</span><span class="op" id="3350582">(</span><span class="ident" id="3350583">laddr</span><span class="op" id="3350588">,</span>&nbsp;<span class="ident" id="3350590">listenerBacklog</span><span class="op" id="3350605">)</span><span class="op" id="3350606">;</span>&nbsp;<span class="ident" id="3350608">err</span>&nbsp;<span class="op" id="3350612">!=</span>&nbsp;<span class="builtintype" id="3350615">nil</span>&nbsp;<span class="op" id="3350619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350625">fd</span><span class="op" id="3350627">.</span><span class="ident" id="3350628">Close</span><span class="op" id="3350633">(</span><span class="op" id="3350634">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350640">return</span>&nbsp;<span class="builtintype" id="3350647">nil</span><span class="op" id="3350650">,</span>&nbsp;<span class="ident" id="3350652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350664">return</span>&nbsp;<span class="ident" id="3350671">fd</span><span class="op" id="3350673">,</span>&nbsp;<span class="builtintype" id="3350675">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350681">case</span>&nbsp;<span class="ident" id="3350686">syscall</span><span class="op" id="3350693">.</span><span class="ident" id="3350694">SOCK_DGRAM</span><span class="op" id="3350704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350709">if</span>&nbsp;<span class="ident" id="3350712">err</span>&nbsp;<span class="op" id="3350716">:=</span>&nbsp;<span class="ident" id="3350719">fd</span><span class="op" id="3350721">.</span><span class="ident" id="3350722">listenDatagram</span><span class="op" id="3350736">(</span><span class="ident" id="3350737">laddr</span><span class="op" id="3350742">)</span><span class="op" id="3350743">;</span>&nbsp;<span class="ident" id="3350745">err</span>&nbsp;<span class="op" id="3350749">!=</span>&nbsp;<span class="builtintype" id="3350752">nil</span>&nbsp;<span class="op" id="3350756">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350762">fd</span><span class="op" id="3350764">.</span><span class="ident" id="3350765">Close</span><span class="op" id="3350770">(</span><span class="op" id="3350771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350777">return</span>&nbsp;<span class="builtintype" id="3350784">nil</span><span class="op" id="3350787">,</span>&nbsp;<span class="ident" id="3350789">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350801">return</span>&nbsp;<span class="ident" id="3350808">fd</span><span class="op" id="3350810">,</span>&nbsp;<span class="builtintype" id="3350812">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350818">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350824">if</span>&nbsp;<span class="ident" id="3350827">err</span>&nbsp;<span class="op" id="3350831">:=</span>&nbsp;<span class="ident" id="3350834">fd</span><span class="op" id="3350836">.</span><span class="ident" id="3350837">dial</span><span class="op" id="3350841">(</span><span class="ident" id="3350842">laddr</span><span class="op" id="3350847">,</span>&nbsp;<span class="ident" id="3350849">raddr</span><span class="op" id="3350854">,</span>&nbsp;<span class="ident" id="3350856">deadline</span><span class="op" id="3350864">)</span><span class="op" id="3350865">;</span>&nbsp;<span class="ident" id="3350867">err</span>&nbsp;<span class="op" id="3350871">!=</span>&nbsp;<span class="builtintype" id="3350874">nil</span>&nbsp;<span class="op" id="3350878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350882">fd</span><span class="op" id="3350884">.</span><span class="ident" id="3350885">Close</span><span class="op" id="3350890">(</span><span class="op" id="3350891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350895">return</span>&nbsp;<span class="builtintype" id="3350902">nil</span><span class="op" id="3350905">,</span>&nbsp;<span class="ident" id="3350907">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350912">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350915">return</span>&nbsp;<span class="ident" id="3350922">fd</span><span class="op" id="3350924">,</span>&nbsp;<span class="builtintype" id="3350926">nil</span><br>
<span class="lineno"></span><span class="op" id="3350930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3350933">func</span>&nbsp;<span class="op" id="3350938">(</span><span class="ident" id="3350939">fd</span>&nbsp;<span class="op" id="3350942">*</span><span class="ident" id="3350943">netFD</span><span class="op" id="3350948">)</span>&nbsp;<span class="ident" id="3350950">addrFunc</span><span class="op" id="3350958">(</span><span class="op" id="3350959">)</span>&nbsp;<span class="keyword" id="3350961">func</span><span class="op" id="3350965">(</span><span class="ident" id="3350966">syscall</span><span class="op" id="3350973">.</span><span class="ident" id="3350974">Sockaddr</span><span class="op" id="3350982">)</span>&nbsp;<span class="ident" id="3350984">Addr</span>&nbsp;<span class="op" id="3350989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350992">switch</span>&nbsp;<span class="ident" id="3350999">fd</span><span class="op" id="3351001">.</span><span class="ident" id="3351002">family</span>&nbsp;<span class="op" id="3351009">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351012">case</span>&nbsp;<span class="ident" id="3351017">syscall</span><span class="op" id="3351024">.</span><span class="ident" id="3351025">AF_INET</span><span class="op" id="3351032">,</span>&nbsp;<span class="ident" id="3351034">syscall</span><span class="op" id="3351041">.</span><span class="ident" id="3351042">AF_INET6</span><span class="op" id="3351050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351054">switch</span>&nbsp;<span class="ident" id="3351061">fd</span><span class="op" id="3351063">.</span><span class="ident" id="3351064">sotype</span>&nbsp;<span class="op" id="3351071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351075">case</span>&nbsp;<span class="ident" id="3351080">syscall</span><span class="op" id="3351087">.</span><span class="ident" id="3351088">SOCK_STREAM</span><span class="op" id="3351099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351104">return</span>&nbsp;<span class="ident" id="3351111">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351127">case</span>&nbsp;<span class="ident" id="3351132">syscall</span><span class="op" id="3351139">.</span><span class="ident" id="3351140">SOCK_DGRAM</span><span class="op" id="3351150">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351155">return</span>&nbsp;<span class="ident" id="3351162">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351178">case</span>&nbsp;<span class="ident" id="3351183">syscall</span><span class="op" id="3351190">.</span><span class="ident" id="3351191">SOCK_RAW</span><span class="op" id="3351199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351204">return</span>&nbsp;<span class="ident" id="3351211">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351229">case</span>&nbsp;<span class="ident" id="3351234">syscall</span><span class="op" id="3351241">.</span><span class="ident" id="3351242">AF_UNIX</span><span class="op" id="3351249">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351253">switch</span>&nbsp;<span class="ident" id="3351260">fd</span><span class="op" id="3351262">.</span><span class="ident" id="3351263">sotype</span>&nbsp;<span class="op" id="3351270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351274">case</span>&nbsp;<span class="ident" id="3351279">syscall</span><span class="op" id="3351286">.</span><span class="ident" id="3351287">SOCK_STREAM</span><span class="op" id="3351298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351303">return</span>&nbsp;<span class="ident" id="3351310">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351327">case</span>&nbsp;<span class="ident" id="3351332">syscall</span><span class="op" id="3351339">.</span><span class="ident" id="3351340">SOCK_DGRAM</span><span class="op" id="3351350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351355">return</span>&nbsp;<span class="ident" id="3351362">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351383">case</span>&nbsp;<span class="ident" id="3351388">syscall</span><span class="op" id="3351395">.</span><span class="ident" id="3351396">SOCK_SEQPACKET</span><span class="op" id="3351410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351415">return</span>&nbsp;<span class="ident" id="3351422">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351451">return</span>&nbsp;<span class="keyword" id="3351458">func</span><span class="op" id="3351462">(</span><span class="ident" id="3351463">syscall</span><span class="op" id="3351470">.</span><span class="ident" id="3351471">Sockaddr</span><span class="op" id="3351479">)</span>&nbsp;<span class="ident" id="3351481">Addr</span>&nbsp;<span class="op" id="3351486">{</span>&nbsp;<span class="keyword" id="3351488">return</span>&nbsp;<span class="builtintype" id="3351495">nil</span>&nbsp;<span class="op" id="3351499">}</span><br>
<span class="lineno">120</span><span class="op" id="3351501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3351504">func</span>&nbsp;<span class="op" id="3351509">(</span><span class="ident" id="3351510">fd</span>&nbsp;<span class="op" id="3351513">*</span><span class="ident" id="3351514">netFD</span><span class="op" id="3351519">)</span>&nbsp;<span class="ident" id="3351521">dial</span><span class="op" id="3351525">(</span><span class="ident" id="3351526">laddr</span><span class="op" id="3351531">,</span>&nbsp;<span class="ident" id="3351533">raddr</span>&nbsp;<span class="ident" id="3351539">sockaddr</span><span class="op" id="3351547">,</span>&nbsp;<span class="ident" id="3351549">deadline</span>&nbsp;<span class="ident" id="3351558">time</span><span class="op" id="3351562">.</span><span class="ident" id="3351563">Time</span><span class="op" id="3351567">)</span>&nbsp;<span class="builtintype" id="3351569">error</span>&nbsp;<span class="op" id="3351575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351578">var</span>&nbsp;<span class="ident" id="3351582">err</span>&nbsp;<span class="builtintype" id="3351586">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351593">var</span>&nbsp;<span class="ident" id="3351597">lsa</span>&nbsp;<span class="ident" id="3351601">syscall</span><span class="op" id="3351608">.</span><span class="ident" id="3351609">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351619">if</span>&nbsp;<span class="ident" id="3351622">laddr</span>&nbsp;<span class="op" id="3351628">!=</span>&nbsp;<span class="builtintype" id="3351631">nil</span>&nbsp;<span class="op" id="3351635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351639">if</span>&nbsp;<span class="ident" id="3351642">lsa</span><span class="op" id="3351645">,</span>&nbsp;<span class="ident" id="3351647">err</span>&nbsp;<span class="op" id="3351651">=</span>&nbsp;<span class="ident" id="3351653">laddr</span><span class="op" id="3351658">.</span><span class="ident" id="3351659">sockaddr</span><span class="op" id="3351667">(</span><span class="ident" id="3351668">fd</span><span class="op" id="3351670">.</span><span class="ident" id="3351671">family</span><span class="op" id="3351677">)</span><span class="op" id="3351678">;</span>&nbsp;<span class="ident" id="3351680">err</span>&nbsp;<span class="op" id="3351684">!=</span>&nbsp;<span class="builtintype" id="3351687">nil</span>&nbsp;<span class="op" id="3351691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351696">return</span>&nbsp;<span class="ident" id="3351703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351709">}</span>&nbsp;<span class="keyword" id="3351711">else</span>&nbsp;<span class="keyword" id="3351716">if</span>&nbsp;<span class="ident" id="3351719">lsa</span>&nbsp;<span class="op" id="3351723">!=</span>&nbsp;<span class="builtintype" id="3351726">nil</span>&nbsp;<span class="op" id="3351730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351735">if</span>&nbsp;<span class="ident" id="3351738">err</span>&nbsp;<span class="op" id="3351742">:=</span>&nbsp;<span class="ident" id="3351745">syscall</span><span class="op" id="3351752">.</span><span class="ident" id="3351753">Bind</span><span class="op" id="3351757">(</span><span class="ident" id="3351758">fd</span><span class="op" id="3351760">.</span><span class="ident" id="3351761">sysfd</span><span class="op" id="3351766">,</span>&nbsp;<span class="ident" id="3351768">lsa</span><span class="op" id="3351771">)</span><span class="op" id="3351772">;</span>&nbsp;<span class="ident" id="3351774">err</span>&nbsp;<span class="op" id="3351778">!=</span>&nbsp;<span class="builtintype" id="3351781">nil</span>&nbsp;<span class="op" id="3351785">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351791">return</span>&nbsp;<span class="ident" id="3351798">os</span><span class="op" id="3351800">.</span><span class="ident" id="3351801">NewSyscallError</span><span class="op" id="3351816">(</span><span class="string" id="3351817">&#34;bind&#34;</span><span class="op" id="3351823">,</span>&nbsp;<span class="ident" id="3351825">err</span><span class="op" id="3351828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351843">var</span>&nbsp;<span class="ident" id="3351847">rsa</span>&nbsp;<span class="ident" id="3351851">syscall</span><span class="op" id="3351858">.</span><span class="ident" id="3351859">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351869">if</span>&nbsp;<span class="ident" id="3351872">raddr</span>&nbsp;<span class="op" id="3351878">!=</span>&nbsp;<span class="builtintype" id="3351881">nil</span>&nbsp;<span class="op" id="3351885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351889">if</span>&nbsp;<span class="ident" id="3351892">rsa</span><span class="op" id="3351895">,</span>&nbsp;<span class="ident" id="3351897">err</span>&nbsp;<span class="op" id="3351901">=</span>&nbsp;<span class="ident" id="3351903">raddr</span><span class="op" id="3351908">.</span><span class="ident" id="3351909">sockaddr</span><span class="op" id="3351917">(</span><span class="ident" id="3351918">fd</span><span class="op" id="3351920">.</span><span class="ident" id="3351921">family</span><span class="op" id="3351927">)</span><span class="op" id="3351928">;</span>&nbsp;<span class="ident" id="3351930">err</span>&nbsp;<span class="op" id="3351934">!=</span>&nbsp;<span class="builtintype" id="3351937">nil</span>&nbsp;<span class="op" id="3351941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351946">return</span>&nbsp;<span class="ident" id="3351953">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3351959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3351963">if</span>&nbsp;<span class="ident" id="3351966">err</span>&nbsp;<span class="op" id="3351970">:=</span>&nbsp;<span class="ident" id="3351973">fd</span><span class="op" id="3351975">.</span><span class="ident" id="3351976">connect</span><span class="op" id="3351983">(</span><span class="ident" id="3351984">lsa</span><span class="op" id="3351987">,</span>&nbsp;<span class="ident" id="3351989">rsa</span><span class="op" id="3351992">,</span>&nbsp;<span class="ident" id="3351994">deadline</span><span class="op" id="3352002">)</span><span class="op" id="3352003">;</span>&nbsp;<span class="ident" id="3352005">err</span>&nbsp;<span class="op" id="3352009">!=</span>&nbsp;<span class="builtintype" id="3352012">nil</span>&nbsp;<span class="op" id="3352016">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352021">return</span>&nbsp;<span class="ident" id="3352028">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352038">fd</span><span class="op" id="3352040">.</span><span class="ident" id="3352041">isConnected</span>&nbsp;<span class="op" id="3352053">=</span>&nbsp;<span class="builtintype" id="3352055">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352061">}</span>&nbsp;<span class="keyword" id="3352063">else</span>&nbsp;<span class="op" id="3352068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352072">if</span>&nbsp;<span class="ident" id="3352075">err</span>&nbsp;<span class="op" id="3352079">:=</span>&nbsp;<span class="ident" id="3352082">fd</span><span class="op" id="3352084">.</span><span class="ident" id="3352085">init</span><span class="op" id="3352089">(</span><span class="op" id="3352090">)</span><span class="op" id="3352091">;</span>&nbsp;<span class="ident" id="3352093">err</span>&nbsp;<span class="op" id="3352097">!=</span>&nbsp;<span class="builtintype" id="3352100">nil</span>&nbsp;<span class="op" id="3352104">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352109">return</span>&nbsp;<span class="ident" id="3352116">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352128">lsa</span><span class="op" id="3352131">,</span>&nbsp;<span class="ident" id="3352133">_</span>&nbsp;<span class="op" id="3352135">=</span>&nbsp;<span class="ident" id="3352137">syscall</span><span class="op" id="3352144">.</span><span class="ident" id="3352145">Getsockname</span><span class="op" id="3352156">(</span><span class="ident" id="3352157">fd</span><span class="op" id="3352159">.</span><span class="ident" id="3352160">sysfd</span><span class="op" id="3352165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352168">if</span>&nbsp;<span class="ident" id="3352171">rsa</span><span class="op" id="3352174">,</span>&nbsp;<span class="ident" id="3352176">_</span>&nbsp;<span class="op" id="3352178">=</span>&nbsp;<span class="ident" id="3352180">syscall</span><span class="op" id="3352187">.</span><span class="ident" id="3352188">Getpeername</span><span class="op" id="3352199">(</span><span class="ident" id="3352200">fd</span><span class="op" id="3352202">.</span><span class="ident" id="3352203">sysfd</span><span class="op" id="3352208">)</span><span class="op" id="3352209">;</span>&nbsp;<span class="ident" id="3352211">rsa</span>&nbsp;<span class="op" id="3352215">!=</span>&nbsp;<span class="builtintype" id="3352218">nil</span>&nbsp;<span class="op" id="3352222">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352226">fd</span><span class="op" id="3352228">.</span><span class="ident" id="3352229">setAddr</span><span class="op" id="3352236">(</span><span class="ident" id="3352237">fd</span><span class="op" id="3352239">.</span><span class="ident" id="3352240">addrFunc</span><span class="op" id="3352248">(</span><span class="op" id="3352249">)</span><span class="op" id="3352250">(</span><span class="ident" id="3352251">lsa</span><span class="op" id="3352254">)</span><span class="op" id="3352255">,</span>&nbsp;<span class="ident" id="3352257">fd</span><span class="op" id="3352259">.</span><span class="ident" id="3352260">addrFunc</span><span class="op" id="3352268">(</span><span class="op" id="3352269">)</span><span class="op" id="3352270">(</span><span class="ident" id="3352271">rsa</span><span class="op" id="3352274">)</span><span class="op" id="3352275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352278">}</span>&nbsp;<span class="keyword" id="3352280">else</span>&nbsp;<span class="op" id="3352285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352289">fd</span><span class="op" id="3352291">.</span><span class="ident" id="3352292">setAddr</span><span class="op" id="3352299">(</span><span class="ident" id="3352300">fd</span><span class="op" id="3352302">.</span><span class="ident" id="3352303">addrFunc</span><span class="op" id="3352311">(</span><span class="op" id="3352312">)</span><span class="op" id="3352313">(</span><span class="ident" id="3352314">lsa</span><span class="op" id="3352317">)</span><span class="op" id="3352318">,</span>&nbsp;<span class="ident" id="3352320">raddr</span><span class="op" id="3352325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352331">return</span>&nbsp;<span class="builtintype" id="3352338">nil</span><br>
<span class="lineno">155</span><span class="op" id="3352342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352345">func</span>&nbsp;<span class="op" id="3352350">(</span><span class="ident" id="3352351">fd</span>&nbsp;<span class="op" id="3352354">*</span><span class="ident" id="3352355">netFD</span><span class="op" id="3352360">)</span>&nbsp;<span class="ident" id="3352362">listenStream</span><span class="op" id="3352374">(</span><span class="ident" id="3352375">laddr</span>&nbsp;<span class="ident" id="3352381">sockaddr</span><span class="op" id="3352389">,</span>&nbsp;<span class="ident" id="3352391">backlog</span>&nbsp;<span class="builtintype" id="3352399">int</span><span class="op" id="3352402">)</span>&nbsp;<span class="builtintype" id="3352404">error</span>&nbsp;<span class="op" id="3352410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352413">if</span>&nbsp;<span class="ident" id="3352416">err</span>&nbsp;<span class="op" id="3352420">:=</span>&nbsp;<span class="ident" id="3352423">setDefaultListenerSockopts</span><span class="op" id="3352449">(</span><span class="ident" id="3352450">fd</span><span class="op" id="3352452">.</span><span class="ident" id="3352453">sysfd</span><span class="op" id="3352458">)</span><span class="op" id="3352459">;</span>&nbsp;<span class="ident" id="3352461">err</span>&nbsp;<span class="op" id="3352465">!=</span>&nbsp;<span class="builtintype" id="3352468">nil</span>&nbsp;<span class="op" id="3352472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352476">return</span>&nbsp;<span class="ident" id="3352483">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352491">if</span>&nbsp;<span class="ident" id="3352494">lsa</span><span class="op" id="3352497">,</span>&nbsp;<span class="ident" id="3352499">err</span>&nbsp;<span class="op" id="3352503">:=</span>&nbsp;<span class="ident" id="3352506">laddr</span><span class="op" id="3352511">.</span><span class="ident" id="3352512">sockaddr</span><span class="op" id="3352520">(</span><span class="ident" id="3352521">fd</span><span class="op" id="3352523">.</span><span class="ident" id="3352524">family</span><span class="op" id="3352530">)</span><span class="op" id="3352531">;</span>&nbsp;<span class="ident" id="3352533">err</span>&nbsp;<span class="op" id="3352537">!=</span>&nbsp;<span class="builtintype" id="3352540">nil</span>&nbsp;<span class="op" id="3352544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352548">return</span>&nbsp;<span class="ident" id="3352555">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352560">}</span>&nbsp;<span class="keyword" id="3352562">else</span>&nbsp;<span class="keyword" id="3352567">if</span>&nbsp;<span class="ident" id="3352570">lsa</span>&nbsp;<span class="op" id="3352574">!=</span>&nbsp;<span class="builtintype" id="3352577">nil</span>&nbsp;<span class="op" id="3352581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352585">if</span>&nbsp;<span class="ident" id="3352588">err</span>&nbsp;<span class="op" id="3352592">:=</span>&nbsp;<span class="ident" id="3352595">syscall</span><span class="op" id="3352602">.</span><span class="ident" id="3352603">Bind</span><span class="op" id="3352607">(</span><span class="ident" id="3352608">fd</span><span class="op" id="3352610">.</span><span class="ident" id="3352611">sysfd</span><span class="op" id="3352616">,</span>&nbsp;<span class="ident" id="3352618">lsa</span><span class="op" id="3352621">)</span><span class="op" id="3352622">;</span>&nbsp;<span class="ident" id="3352624">err</span>&nbsp;<span class="op" id="3352628">!=</span>&nbsp;<span class="builtintype" id="3352631">nil</span>&nbsp;<span class="op" id="3352635">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352640">return</span>&nbsp;<span class="ident" id="3352647">os</span><span class="op" id="3352649">.</span><span class="ident" id="3352650">NewSyscallError</span><span class="op" id="3352665">(</span><span class="string" id="3352666">&#34;bind&#34;</span><span class="op" id="3352672">,</span>&nbsp;<span class="ident" id="3352674">err</span><span class="op" id="3352677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352687">if</span>&nbsp;<span class="ident" id="3352690">err</span>&nbsp;<span class="op" id="3352694">:=</span>&nbsp;<span class="ident" id="3352697">syscall</span><span class="op" id="3352704">.</span><span class="ident" id="3352705">Listen</span><span class="op" id="3352711">(</span><span class="ident" id="3352712">fd</span><span class="op" id="3352714">.</span><span class="ident" id="3352715">sysfd</span><span class="op" id="3352720">,</span>&nbsp;<span class="ident" id="3352722">backlog</span><span class="op" id="3352729">)</span><span class="op" id="3352730">;</span>&nbsp;<span class="ident" id="3352732">err</span>&nbsp;<span class="op" id="3352736">!=</span>&nbsp;<span class="builtintype" id="3352739">nil</span>&nbsp;<span class="op" id="3352743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352747">return</span>&nbsp;<span class="ident" id="3352754">os</span><span class="op" id="3352756">.</span><span class="ident" id="3352757">NewSyscallError</span><span class="op" id="3352772">(</span><span class="string" id="3352773">&#34;listen&#34;</span><span class="op" id="3352781">,</span>&nbsp;<span class="ident" id="3352783">err</span><span class="op" id="3352786">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352792">if</span>&nbsp;<span class="ident" id="3352795">err</span>&nbsp;<span class="op" id="3352799">:=</span>&nbsp;<span class="ident" id="3352802">fd</span><span class="op" id="3352804">.</span><span class="ident" id="3352805">init</span><span class="op" id="3352809">(</span><span class="op" id="3352810">)</span><span class="op" id="3352811">;</span>&nbsp;<span class="ident" id="3352813">err</span>&nbsp;<span class="op" id="3352817">!=</span>&nbsp;<span class="builtintype" id="3352820">nil</span>&nbsp;<span class="op" id="3352824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352828">return</span>&nbsp;<span class="ident" id="3352835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3352840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352843">lsa</span><span class="op" id="3352846">,</span>&nbsp;<span class="ident" id="3352848">_</span>&nbsp;<span class="op" id="3352850">:=</span>&nbsp;<span class="ident" id="3352853">syscall</span><span class="op" id="3352860">.</span><span class="ident" id="3352861">Getsockname</span><span class="op" id="3352872">(</span><span class="ident" id="3352873">fd</span><span class="op" id="3352875">.</span><span class="ident" id="3352876">sysfd</span><span class="op" id="3352881">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3352884">fd</span><span class="op" id="3352886">.</span><span class="ident" id="3352887">setAddr</span><span class="op" id="3352894">(</span><span class="ident" id="3352895">fd</span><span class="op" id="3352897">.</span><span class="ident" id="3352898">addrFunc</span><span class="op" id="3352906">(</span><span class="op" id="3352907">)</span><span class="op" id="3352908">(</span><span class="ident" id="3352909">lsa</span><span class="op" id="3352912">)</span><span class="op" id="3352913">,</span>&nbsp;<span class="builtintype" id="3352915">nil</span><span class="op" id="3352918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352921">return</span>&nbsp;<span class="builtintype" id="3352928">nil</span><br>
<span class="lineno"></span><span class="op" id="3352932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3352935">func</span>&nbsp;<span class="op" id="3352940">(</span><span class="ident" id="3352941">fd</span>&nbsp;<span class="op" id="3352944">*</span><span class="ident" id="3352945">netFD</span><span class="op" id="3352950">)</span>&nbsp;<span class="ident" id="3352952">listenDatagram</span><span class="op" id="3352966">(</span><span class="ident" id="3352967">laddr</span>&nbsp;<span class="ident" id="3352973">sockaddr</span><span class="op" id="3352981">)</span>&nbsp;<span class="builtintype" id="3352983">error</span>&nbsp;<span class="op" id="3352989">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3352992">switch</span>&nbsp;<span class="ident" id="3352999">addr</span>&nbsp;<span class="op" id="3353004">:=</span>&nbsp;<span class="ident" id="3353007">laddr</span><span class="op" id="3353012">.</span><span class="op" id="3353013">(</span><span class="keyword" id="3353014">type</span><span class="op" id="3353018">)</span>&nbsp;<span class="op" id="3353020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353023">case</span>&nbsp;<span class="op" id="3353028">*</span><span class="ident" id="3353029">UDPAddr</span><span class="op" id="3353036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353040">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353092">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353149">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353202">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353259">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353309">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3353365">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353407">if</span>&nbsp;<span class="ident" id="3353410">addr</span><span class="op" id="3353414">.</span><span class="ident" id="3353415">IP</span>&nbsp;<span class="op" id="3353418">!=</span>&nbsp;<span class="builtintype" id="3353421">nil</span>&nbsp;<span class="op" id="3353425">&amp;&amp;</span>&nbsp;<span class="ident" id="3353428">addr</span><span class="op" id="3353432">.</span><span class="ident" id="3353433">IP</span><span class="op" id="3353435">.</span><span class="ident" id="3353436">IsMulticast</span><span class="op" id="3353447">(</span><span class="op" id="3353448">)</span>&nbsp;<span class="op" id="3353450">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353455">if</span>&nbsp;<span class="ident" id="3353458">err</span>&nbsp;<span class="op" id="3353462">:=</span>&nbsp;<span class="ident" id="3353465">setDefaultMulticastSockopts</span><span class="op" id="3353492">(</span><span class="ident" id="3353493">fd</span><span class="op" id="3353495">.</span><span class="ident" id="3353496">sysfd</span><span class="op" id="3353501">)</span><span class="op" id="3353502">;</span>&nbsp;<span class="ident" id="3353504">err</span>&nbsp;<span class="op" id="3353508">!=</span>&nbsp;<span class="builtintype" id="3353511">nil</span>&nbsp;<span class="op" id="3353515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353521">return</span>&nbsp;<span class="ident" id="3353528">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353540">addr</span>&nbsp;<span class="op" id="3353545">:=</span>&nbsp;<span class="op" id="3353548">*</span><span class="ident" id="3353549">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353557">switch</span>&nbsp;<span class="ident" id="3353564">fd</span><span class="op" id="3353566">.</span><span class="ident" id="3353567">family</span>&nbsp;<span class="op" id="3353574">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353579">case</span>&nbsp;<span class="ident" id="3353584">syscall</span><span class="op" id="3353591">.</span><span class="ident" id="3353592">AF_INET</span><span class="op" id="3353599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353605">addr</span><span class="op" id="3353609">.</span><span class="ident" id="3353610">IP</span>&nbsp;<span class="op" id="3353613">=</span>&nbsp;<span class="ident" id="3353615">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353627">case</span>&nbsp;<span class="ident" id="3353632">syscall</span><span class="op" id="3353639">.</span><span class="ident" id="3353640">AF_INET6</span><span class="op" id="3353648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353654">addr</span><span class="op" id="3353658">.</span><span class="ident" id="3353659">IP</span>&nbsp;<span class="op" id="3353662">=</span>&nbsp;<span class="ident" id="3353664">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353683">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353688">laddr</span>&nbsp;<span class="op" id="3353694">=</span>&nbsp;<span class="op" id="3353696">&amp;</span><span class="ident" id="3353697">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353710">if</span>&nbsp;<span class="ident" id="3353713">lsa</span><span class="op" id="3353716">,</span>&nbsp;<span class="ident" id="3353718">err</span>&nbsp;<span class="op" id="3353722">:=</span>&nbsp;<span class="ident" id="3353725">laddr</span><span class="op" id="3353730">.</span><span class="ident" id="3353731">sockaddr</span><span class="op" id="3353739">(</span><span class="ident" id="3353740">fd</span><span class="op" id="3353742">.</span><span class="ident" id="3353743">family</span><span class="op" id="3353749">)</span><span class="op" id="3353750">;</span>&nbsp;<span class="ident" id="3353752">err</span>&nbsp;<span class="op" id="3353756">!=</span>&nbsp;<span class="builtintype" id="3353759">nil</span>&nbsp;<span class="op" id="3353763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353767">return</span>&nbsp;<span class="ident" id="3353774">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353779">}</span>&nbsp;<span class="keyword" id="3353781">else</span>&nbsp;<span class="keyword" id="3353786">if</span>&nbsp;<span class="ident" id="3353789">lsa</span>&nbsp;<span class="op" id="3353793">!=</span>&nbsp;<span class="builtintype" id="3353796">nil</span>&nbsp;<span class="op" id="3353800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353804">if</span>&nbsp;<span class="ident" id="3353807">err</span>&nbsp;<span class="op" id="3353811">:=</span>&nbsp;<span class="ident" id="3353814">syscall</span><span class="op" id="3353821">.</span><span class="ident" id="3353822">Bind</span><span class="op" id="3353826">(</span><span class="ident" id="3353827">fd</span><span class="op" id="3353829">.</span><span class="ident" id="3353830">sysfd</span><span class="op" id="3353835">,</span>&nbsp;<span class="ident" id="3353837">lsa</span><span class="op" id="3353840">)</span><span class="op" id="3353841">;</span>&nbsp;<span class="ident" id="3353843">err</span>&nbsp;<span class="op" id="3353847">!=</span>&nbsp;<span class="builtintype" id="3353850">nil</span>&nbsp;<span class="op" id="3353854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353859">return</span>&nbsp;<span class="ident" id="3353866">os</span><span class="op" id="3353868">.</span><span class="ident" id="3353869">NewSyscallError</span><span class="op" id="3353884">(</span><span class="string" id="3353885">&#34;bind&#34;</span><span class="op" id="3353891">,</span>&nbsp;<span class="ident" id="3353893">err</span><span class="op" id="3353896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353903">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353906">if</span>&nbsp;<span class="ident" id="3353909">err</span>&nbsp;<span class="op" id="3353913">:=</span>&nbsp;<span class="ident" id="3353916">fd</span><span class="op" id="3353918">.</span><span class="ident" id="3353919">init</span><span class="op" id="3353923">(</span><span class="op" id="3353924">)</span><span class="op" id="3353925">;</span>&nbsp;<span class="ident" id="3353927">err</span>&nbsp;<span class="op" id="3353931">!=</span>&nbsp;<span class="builtintype" id="3353934">nil</span>&nbsp;<span class="op" id="3353938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353942">return</span>&nbsp;<span class="ident" id="3353949">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353957">lsa</span><span class="op" id="3353960">,</span>&nbsp;<span class="ident" id="3353962">_</span>&nbsp;<span class="op" id="3353964">:=</span>&nbsp;<span class="ident" id="3353967">syscall</span><span class="op" id="3353974">.</span><span class="ident" id="3353975">Getsockname</span><span class="op" id="3353986">(</span><span class="ident" id="3353987">fd</span><span class="op" id="3353989">.</span><span class="ident" id="3353990">sysfd</span><span class="op" id="3353995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353998">fd</span><span class="op" id="3354000">.</span><span class="ident" id="3354001">setAddr</span><span class="op" id="3354008">(</span><span class="ident" id="3354009">fd</span><span class="op" id="3354011">.</span><span class="ident" id="3354012">addrFunc</span><span class="op" id="3354020">(</span><span class="op" id="3354021">)</span><span class="op" id="3354022">(</span><span class="ident" id="3354023">lsa</span><span class="op" id="3354026">)</span><span class="op" id="3354027">,</span>&nbsp;<span class="builtintype" id="3354029">nil</span><span class="op" id="3354032">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354035">return</span>&nbsp;<span class="builtintype" id="3354042">nil</span><br>
<span class="lineno"></span><span class="op" id="3354046">}</span>
</div>
</body>
</html>
