<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1389373">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1389428">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1389482">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1389533">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;printing&nbsp;support&nbsp;for&nbsp;ASTs.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1389583">package</span>&nbsp;<span class="ident" id="1389591">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1389596">import</span>&nbsp;<span class="op" id="1389603">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1389606">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1389613">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1389625">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1389631">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1389637">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="1389647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1389650">//&nbsp;A&nbsp;FieldFilter&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Fprint&nbsp;to&nbsp;control&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="1389716">type</span>&nbsp;<span class="ident" id="1389721">FieldFilter</span>&nbsp;<span class="keyword" id="1389733">func</span><span class="op" id="1389737">(</span><span class="ident" id="1389738">name</span>&nbsp;<span class="builtintype" id="1389743">string</span><span class="op" id="1389749">,</span>&nbsp;<span class="ident" id="1389751">value</span>&nbsp;<span class="ident" id="1389757">reflect</span><span class="op" id="1389764">.</span><span class="ident" id="1389765">Value</span><span class="op" id="1389770">)</span>&nbsp;<span class="builtintype" id="1389772">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="1389778">//&nbsp;NotNilFilter&nbsp;returns&nbsp;true&nbsp;for&nbsp;field&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;nil;</span><br>
<span class="lineno"></span><span class="comment" id="1389842">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="1389873">func</span>&nbsp;<span class="ident" id="1389878">NotNilFilter</span><span class="op" id="1389890">(</span><span class="ident" id="1389891">_</span>&nbsp;<span class="builtintype" id="1389893">string</span><span class="op" id="1389899">,</span>&nbsp;<span class="ident" id="1389901">v</span>&nbsp;<span class="ident" id="1389903">reflect</span><span class="op" id="1389910">.</span><span class="ident" id="1389911">Value</span><span class="op" id="1389916">)</span>&nbsp;<span class="builtintype" id="1389918">bool</span>&nbsp;<span class="op" id="1389923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389926">switch</span>&nbsp;<span class="ident" id="1389933">v</span><span class="op" id="1389934">.</span><span class="ident" id="1389935">Kind</span><span class="op" id="1389939">(</span><span class="op" id="1389940">)</span>&nbsp;<span class="op" id="1389942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1389945">case</span>&nbsp;<span class="ident" id="1389950">reflect</span><span class="op" id="1389957">.</span><span class="ident" id="1389958">Chan</span><span class="op" id="1389962">,</span>&nbsp;<span class="ident" id="1389964">reflect</span><span class="op" id="1389971">.</span><span class="ident" id="1389972">Func</span><span class="op" id="1389976">,</span>&nbsp;<span class="ident" id="1389978">reflect</span><span class="op" id="1389985">.</span><span class="ident" id="1389986">Interface</span><span class="op" id="1389995">,</span>&nbsp;<span class="ident" id="1389997">reflect</span><span class="op" id="1390004">.</span><span class="ident" id="1390005">Map</span><span class="op" id="1390008">,</span>&nbsp;<span class="ident" id="1390010">reflect</span><span class="op" id="1390017">.</span><span class="ident" id="1390018">Ptr</span><span class="op" id="1390021">,</span>&nbsp;<span class="ident" id="1390023">reflect</span><span class="op" id="1390030">.</span><span class="ident" id="1390031">Slice</span><span class="op" id="1390036">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390040">return</span>&nbsp;<span class="op" id="1390047">!</span><span class="ident" id="1390048">v</span><span class="op" id="1390049">.</span><span class="ident" id="1390050">IsNil</span><span class="op" id="1390055">(</span><span class="op" id="1390056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390062">return</span>&nbsp;<span class="builtintype" id="1390069">true</span><br>
<span class="lineno"></span><span class="op" id="1390074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1390077">//&nbsp;Fprint&nbsp;prints&nbsp;the&nbsp;(sub-)tree&nbsp;starting&nbsp;at&nbsp;AST&nbsp;node&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="1390138">//&nbsp;If&nbsp;fset&nbsp;!=&nbsp;nil,&nbsp;position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative</span><br>
<span class="lineno"></span><span class="comment" id="1390202">//&nbsp;to&nbsp;that&nbsp;file&nbsp;set.&nbsp;Otherwise&nbsp;positions&nbsp;are&nbsp;printed&nbsp;as&nbsp;integer</span><br>
<span class="lineno"></span><span class="comment" id="1390266">//&nbsp;values&nbsp;(file&nbsp;set&nbsp;specific&nbsp;offsets).</span><br>
<span class="lineno"></span><span class="comment" id="1390305">//</span><br>
<span class="lineno">35</span><span class="comment" id="1390308">//&nbsp;A&nbsp;non-nil&nbsp;FieldFilter&nbsp;f&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;control&nbsp;the&nbsp;output:</span><br>
<span class="lineno"></span><span class="comment" id="1390374">//&nbsp;struct&nbsp;fields&nbsp;for&nbsp;which&nbsp;f(fieldname,&nbsp;fieldvalue)&nbsp;is&nbsp;true&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="1390438">//&nbsp;printed;&nbsp;all&nbsp;others&nbsp;are&nbsp;filtered&nbsp;from&nbsp;the&nbsp;output.&nbsp;Unexported</span><br>
<span class="lineno"></span><span class="comment" id="1390502">//&nbsp;struct&nbsp;fields&nbsp;are&nbsp;never&nbsp;printed.</span><br>
<span class="lineno"></span><span class="comment" id="1390538">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1390541">func</span>&nbsp;<span class="ident" id="1390546">Fprint</span><span class="op" id="1390552">(</span><span class="ident" id="1390553">w</span>&nbsp;<span class="ident" id="1390555">io</span><span class="op" id="1390557">.</span><span class="ident" id="1390558">Writer</span><span class="op" id="1390564">,</span>&nbsp;<span class="ident" id="1390566">fset</span>&nbsp;<span class="op" id="1390571">*</span><span class="ident" id="1390572">token</span><span class="op" id="1390577">.</span><span class="ident" id="1390578">FileSet</span><span class="op" id="1390585">,</span>&nbsp;<span class="ident" id="1390587">x</span>&nbsp;<span class="keyword" id="1390589">interface</span><span class="op" id="1390598">{</span><span class="op" id="1390599">}</span><span class="op" id="1390600">,</span>&nbsp;<span class="ident" id="1390602">f</span>&nbsp;<span class="ident" id="1390604">FieldFilter</span><span class="op" id="1390615">)</span>&nbsp;<span class="op" id="1390617">(</span><span class="ident" id="1390618">err</span>&nbsp;<span class="builtintype" id="1390622">error</span><span class="op" id="1390627">)</span>&nbsp;<span class="op" id="1390629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390632">//&nbsp;setup&nbsp;printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390650">p</span>&nbsp;<span class="op" id="1390652">:=</span>&nbsp;<span class="ident" id="1390655">printer</span><span class="op" id="1390662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390666">output</span><span class="op" id="1390672">:</span>&nbsp;<span class="ident" id="1390674">w</span><span class="op" id="1390675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390679">fset</span><span class="op" id="1390683">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1390687">fset</span><span class="op" id="1390691">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390695">filter</span><span class="op" id="1390701">:</span>&nbsp;<span class="ident" id="1390703">f</span><span class="op" id="1390704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390708">ptrmap</span><span class="op" id="1390714">:</span>&nbsp;<span class="builtinfunc" id="1390716">make</span><span class="op" id="1390720">(</span><span class="keyword" id="1390721">map</span><span class="op" id="1390724">[</span><span class="keyword" id="1390725">interface</span><span class="op" id="1390734">{</span><span class="op" id="1390735">}</span><span class="op" id="1390736">]</span><span class="builtintype" id="1390737">int</span><span class="op" id="1390740">)</span><span class="op" id="1390741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390745">last</span><span class="op" id="1390749">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1390753">&#39;\n&#39;</span><span class="op" id="1390757">,</span>&nbsp;<span class="comment" id="1390759">//&nbsp;force&nbsp;printing&nbsp;of&nbsp;line&nbsp;number&nbsp;on&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390811">//&nbsp;install&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390837">defer</span>&nbsp;<span class="keyword" id="1390843">func</span><span class="op" id="1390847">(</span><span class="op" id="1390848">)</span>&nbsp;<span class="op" id="1390850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390854">if</span>&nbsp;<span class="ident" id="1390857">e</span>&nbsp;<span class="op" id="1390859">:=</span>&nbsp;<span class="builtinfunc" id="1390862">recover</span><span class="op" id="1390869">(</span><span class="op" id="1390870">)</span><span class="op" id="1390871">;</span>&nbsp;<span class="ident" id="1390873">e</span>&nbsp;<span class="op" id="1390875">!=</span>&nbsp;<span class="ident" id="1390878">nil</span>&nbsp;<span class="op" id="1390882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390887">err</span>&nbsp;<span class="op" id="1390891">=</span>&nbsp;<span class="ident" id="1390893">e</span><span class="op" id="1390894">.</span><span class="op" id="1390895">(</span><span class="ident" id="1390896">localError</span><span class="op" id="1390906">)</span><span class="op" id="1390907">.</span><span class="ident" id="1390908">err</span>&nbsp;<span class="comment" id="1390912">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;localError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390952">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1390955">}</span><span class="op" id="1390956">(</span><span class="op" id="1390957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1390961">//&nbsp;print&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1390973">if</span>&nbsp;<span class="ident" id="1390976">x</span>&nbsp;<span class="op" id="1390978">==</span>&nbsp;<span class="ident" id="1390981">nil</span>&nbsp;<span class="op" id="1390985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1390989">p</span><span class="op" id="1390990">.</span><span class="ident" id="1390991">printf</span><span class="op" id="1390997">(</span><span class="string" id="1390998">&#34;nil\n&#34;</span><span class="op" id="1391005">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391009">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391020">p</span><span class="op" id="1391021">.</span><span class="builtinfunc" id="1391022">print</span><span class="op" id="1391027">(</span><span class="ident" id="1391028">reflect</span><span class="op" id="1391035">.</span><span class="ident" id="1391036">ValueOf</span><span class="op" id="1391043">(</span><span class="ident" id="1391044">x</span><span class="op" id="1391045">)</span><span class="op" id="1391046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391049">p</span><span class="op" id="1391050">.</span><span class="ident" id="1391051">printf</span><span class="op" id="1391057">(</span><span class="string" id="1391058">&#34;\n&#34;</span><span class="op" id="1391062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391066">return</span><br>
<span class="lineno"></span><span class="op" id="1391073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1391076">//&nbsp;Print&nbsp;prints&nbsp;x&nbsp;to&nbsp;standard&nbsp;output,&nbsp;skipping&nbsp;nil&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="1391135">//&nbsp;Print(fset,&nbsp;x)&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;Fprint(os.Stdout,&nbsp;fset,&nbsp;x,&nbsp;NotNilFilter).</span><br>
<span class="lineno">70</span><span class="keyword" id="1391210">func</span>&nbsp;<span class="ident" id="1391215">Print</span><span class="op" id="1391220">(</span><span class="ident" id="1391221">fset</span>&nbsp;<span class="op" id="1391226">*</span><span class="ident" id="1391227">token</span><span class="op" id="1391232">.</span><span class="ident" id="1391233">FileSet</span><span class="op" id="1391240">,</span>&nbsp;<span class="ident" id="1391242">x</span>&nbsp;<span class="keyword" id="1391244">interface</span><span class="op" id="1391253">{</span><span class="op" id="1391254">}</span><span class="op" id="1391255">)</span>&nbsp;<span class="builtintype" id="1391257">error</span>&nbsp;<span class="op" id="1391263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391266">return</span>&nbsp;<span class="ident" id="1391273">Fprint</span><span class="op" id="1391279">(</span><span class="ident" id="1391280">os</span><span class="op" id="1391282">.</span><span class="ident" id="1391283">Stdout</span><span class="op" id="1391289">,</span>&nbsp;<span class="ident" id="1391291">fset</span><span class="op" id="1391295">,</span>&nbsp;<span class="ident" id="1391297">x</span><span class="op" id="1391298">,</span>&nbsp;<span class="ident" id="1391300">NotNilFilter</span><span class="op" id="1391312">)</span><br>
<span class="lineno"></span><span class="op" id="1391314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1391317">type</span>&nbsp;<span class="ident" id="1391322">printer</span>&nbsp;<span class="keyword" id="1391330">struct</span>&nbsp;<span class="op" id="1391337">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391340">output</span>&nbsp;<span class="ident" id="1391347">io</span><span class="op" id="1391349">.</span><span class="ident" id="1391350">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391358">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1391365">*</span><span class="ident" id="1391366">token</span><span class="op" id="1391371">.</span><span class="ident" id="1391372">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391381">filter</span>&nbsp;<span class="ident" id="1391388">FieldFilter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391401">ptrmap</span>&nbsp;<span class="keyword" id="1391408">map</span><span class="op" id="1391411">[</span><span class="keyword" id="1391412">interface</span><span class="op" id="1391421">{</span><span class="op" id="1391422">}</span><span class="op" id="1391423">]</span><span class="builtintype" id="1391424">int</span>&nbsp;<span class="comment" id="1391428">//&nbsp;*T&nbsp;-&gt;&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391450">indent</span>&nbsp;<span class="builtintype" id="1391457">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1391477">//&nbsp;current&nbsp;indentation&nbsp;level</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391507">last</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1391514">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1391534">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;processed&nbsp;by&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391571">line</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1391578">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1391598">//&nbsp;current&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="op" id="1391621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1391624">var</span>&nbsp;<span class="ident" id="1391628">indent</span>&nbsp;<span class="op" id="1391635">=</span>&nbsp;<span class="op" id="1391637">[</span><span class="op" id="1391638">]</span><span class="builtintype" id="1391639">byte</span><span class="op" id="1391643">(</span><span class="string" id="1391644">&#34;.&nbsp;&nbsp;&#34;</span><span class="op" id="1391649">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="1391652">func</span>&nbsp;<span class="op" id="1391657">(</span><span class="ident" id="1391658">p</span>&nbsp;<span class="op" id="1391660">*</span><span class="ident" id="1391661">printer</span><span class="op" id="1391668">)</span>&nbsp;<span class="ident" id="1391670">Write</span><span class="op" id="1391675">(</span><span class="ident" id="1391676">data</span>&nbsp;<span class="op" id="1391681">[</span><span class="op" id="1391682">]</span><span class="builtintype" id="1391683">byte</span><span class="op" id="1391687">)</span>&nbsp;<span class="op" id="1391689">(</span><span class="ident" id="1391690">n</span>&nbsp;<span class="builtintype" id="1391692">int</span><span class="op" id="1391695">,</span>&nbsp;<span class="ident" id="1391697">err</span>&nbsp;<span class="builtintype" id="1391701">error</span><span class="op" id="1391706">)</span>&nbsp;<span class="op" id="1391708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391711">var</span>&nbsp;<span class="ident" id="1391715">m</span>&nbsp;<span class="builtintype" id="1391717">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391722">for</span>&nbsp;<span class="ident" id="1391726">i</span><span class="op" id="1391727">,</span>&nbsp;<span class="ident" id="1391729">b</span>&nbsp;<span class="op" id="1391731">:=</span>&nbsp;<span class="keyword" id="1391734">range</span>&nbsp;<span class="ident" id="1391740">data</span>&nbsp;<span class="op" id="1391745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391749">//&nbsp;invariant:&nbsp;data[0:n]&nbsp;has&nbsp;been&nbsp;written</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391792">if</span>&nbsp;<span class="ident" id="1391795">b</span>&nbsp;<span class="op" id="1391797">==</span>&nbsp;<span class="string" id="1391800">&#39;\n&#39;</span>&nbsp;<span class="op" id="1391805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391810">m</span><span class="op" id="1391811">,</span>&nbsp;<span class="ident" id="1391813">err</span>&nbsp;<span class="op" id="1391817">=</span>&nbsp;<span class="ident" id="1391819">p</span><span class="op" id="1391820">.</span><span class="ident" id="1391821">output</span><span class="op" id="1391827">.</span><span class="ident" id="1391828">Write</span><span class="op" id="1391833">(</span><span class="ident" id="1391834">data</span><span class="op" id="1391838">[</span><span class="ident" id="1391839">n</span>&nbsp;<span class="op" id="1391841">:</span>&nbsp;<span class="ident" id="1391843">i</span><span class="op" id="1391844">+</span><span class="num" id="1391845">1</span><span class="op" id="1391846">]</span><span class="op" id="1391847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391852">n</span>&nbsp;<span class="op" id="1391854">+=</span>&nbsp;<span class="ident" id="1391857">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391862">if</span>&nbsp;<span class="ident" id="1391865">err</span>&nbsp;<span class="op" id="1391869">!=</span>&nbsp;<span class="ident" id="1391872">nil</span>&nbsp;<span class="op" id="1391876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391882">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391897">p</span><span class="op" id="1391898">.</span><span class="ident" id="1391899">line</span><span class="op" id="1391903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391908">}</span>&nbsp;<span class="keyword" id="1391910">else</span>&nbsp;<span class="keyword" id="1391915">if</span>&nbsp;<span class="ident" id="1391918">p</span><span class="op" id="1391919">.</span><span class="ident" id="1391920">last</span>&nbsp;<span class="op" id="1391925">==</span>&nbsp;<span class="string" id="1391928">&#39;\n&#39;</span>&nbsp;<span class="op" id="1391933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391938">_</span><span class="op" id="1391939">,</span>&nbsp;<span class="ident" id="1391941">err</span>&nbsp;<span class="op" id="1391945">=</span>&nbsp;<span class="ident" id="1391947">fmt</span><span class="op" id="1391950">.</span><span class="ident" id="1391951">Fprintf</span><span class="op" id="1391958">(</span><span class="ident" id="1391959">p</span><span class="op" id="1391960">.</span><span class="ident" id="1391961">output</span><span class="op" id="1391967">,</span>&nbsp;<span class="string" id="1391969">&#34;%6d&nbsp;&nbsp;&#34;</span><span class="op" id="1391976">,</span>&nbsp;<span class="ident" id="1391978">p</span><span class="op" id="1391979">.</span><span class="ident" id="1391980">line</span><span class="op" id="1391984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391989">if</span>&nbsp;<span class="ident" id="1391992">err</span>&nbsp;<span class="op" id="1391996">!=</span>&nbsp;<span class="ident" id="1391999">nil</span>&nbsp;<span class="op" id="1392003">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392009">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392024">for</span>&nbsp;<span class="ident" id="1392028">j</span>&nbsp;<span class="op" id="1392030">:=</span>&nbsp;<span class="ident" id="1392033">p</span><span class="op" id="1392034">.</span><span class="ident" id="1392035">indent</span><span class="op" id="1392041">;</span>&nbsp;<span class="ident" id="1392043">j</span>&nbsp;<span class="op" id="1392045">&gt;</span>&nbsp;<span class="num" id="1392047">0</span><span class="op" id="1392048">;</span>&nbsp;<span class="ident" id="1392050">j</span><span class="op" id="1392051">--</span>&nbsp;<span class="op" id="1392054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392060">_</span><span class="op" id="1392061">,</span>&nbsp;<span class="ident" id="1392063">err</span>&nbsp;<span class="op" id="1392067">=</span>&nbsp;<span class="ident" id="1392069">p</span><span class="op" id="1392070">.</span><span class="ident" id="1392071">output</span><span class="op" id="1392077">.</span><span class="ident" id="1392078">Write</span><span class="op" id="1392083">(</span><span class="ident" id="1392084">indent</span><span class="op" id="1392090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392096">if</span>&nbsp;<span class="ident" id="1392099">err</span>&nbsp;<span class="op" id="1392103">!=</span>&nbsp;<span class="ident" id="1392106">nil</span>&nbsp;<span class="op" id="1392110">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392141">p</span><span class="op" id="1392142">.</span><span class="ident" id="1392143">last</span>&nbsp;<span class="op" id="1392148">=</span>&nbsp;<span class="ident" id="1392150">b</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392156">if</span>&nbsp;<span class="builtinfunc" id="1392159">len</span><span class="op" id="1392162">(</span><span class="ident" id="1392163">data</span><span class="op" id="1392167">)</span>&nbsp;<span class="op" id="1392169">&gt;</span>&nbsp;<span class="ident" id="1392171">n</span>&nbsp;<span class="op" id="1392173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392177">m</span><span class="op" id="1392178">,</span>&nbsp;<span class="ident" id="1392180">err</span>&nbsp;<span class="op" id="1392184">=</span>&nbsp;<span class="ident" id="1392186">p</span><span class="op" id="1392187">.</span><span class="ident" id="1392188">output</span><span class="op" id="1392194">.</span><span class="ident" id="1392195">Write</span><span class="op" id="1392200">(</span><span class="ident" id="1392201">data</span><span class="op" id="1392205">[</span><span class="ident" id="1392206">n</span><span class="op" id="1392207">:</span><span class="op" id="1392208">]</span><span class="op" id="1392209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392213">n</span>&nbsp;<span class="op" id="1392215">+=</span>&nbsp;<span class="ident" id="1392218">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392221">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392224">return</span><br>
<span class="lineno"></span><span class="op" id="1392231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392234">//&nbsp;localError&nbsp;wraps&nbsp;locally&nbsp;caught&nbsp;errors&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish</span><br>
<span class="lineno"></span><span class="comment" id="1392298">//&nbsp;them&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors.</span><br>
<span class="lineno">120</span><span class="keyword" id="1392367">type</span>&nbsp;<span class="ident" id="1392372">localError</span>&nbsp;<span class="keyword" id="1392383">struct</span>&nbsp;<span class="op" id="1392390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392393">err</span>&nbsp;<span class="builtintype" id="1392397">error</span><br>
<span class="lineno"></span><span class="op" id="1392403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392406">//&nbsp;printf&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;that&nbsp;takes&nbsp;care&nbsp;of&nbsp;print&nbsp;errors.</span><br>
<span class="lineno">125</span><span class="keyword" id="1392474">func</span>&nbsp;<span class="op" id="1392479">(</span><span class="ident" id="1392480">p</span>&nbsp;<span class="op" id="1392482">*</span><span class="ident" id="1392483">printer</span><span class="op" id="1392490">)</span>&nbsp;<span class="ident" id="1392492">printf</span><span class="op" id="1392498">(</span><span class="ident" id="1392499">format</span>&nbsp;<span class="builtintype" id="1392506">string</span><span class="op" id="1392512">,</span>&nbsp;<span class="ident" id="1392514">args</span>&nbsp;<span class="op" id="1392519">...</span><span class="keyword" id="1392522">interface</span><span class="op" id="1392531">{</span><span class="op" id="1392532">}</span><span class="op" id="1392533">)</span>&nbsp;<span class="op" id="1392535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392538">if</span>&nbsp;<span class="ident" id="1392541">_</span><span class="op" id="1392542">,</span>&nbsp;<span class="ident" id="1392544">err</span>&nbsp;<span class="op" id="1392548">:=</span>&nbsp;<span class="ident" id="1392551">fmt</span><span class="op" id="1392554">.</span><span class="ident" id="1392555">Fprintf</span><span class="op" id="1392562">(</span><span class="ident" id="1392563">p</span><span class="op" id="1392564">,</span>&nbsp;<span class="ident" id="1392566">format</span><span class="op" id="1392572">,</span>&nbsp;<span class="ident" id="1392574">args</span><span class="op" id="1392578">...</span><span class="op" id="1392581">)</span><span class="op" id="1392582">;</span>&nbsp;<span class="ident" id="1392584">err</span>&nbsp;<span class="op" id="1392588">!=</span>&nbsp;<span class="ident" id="1392591">nil</span>&nbsp;<span class="op" id="1392595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1392599">panic</span><span class="op" id="1392604">(</span><span class="ident" id="1392605">localError</span><span class="op" id="1392615">{</span><span class="ident" id="1392616">err</span><span class="op" id="1392619">}</span><span class="op" id="1392620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392623">}</span><br>
<span class="lineno"></span><span class="op" id="1392625">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1392628">//&nbsp;Implementation&nbsp;note:&nbsp;Print&nbsp;is&nbsp;written&nbsp;for&nbsp;AST&nbsp;nodes&nbsp;but&nbsp;could&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1392696">//&nbsp;used&nbsp;to&nbsp;print&nbsp;arbitrary&nbsp;data&nbsp;structures;&nbsp;such&nbsp;a&nbsp;version&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="1392762">//&nbsp;probably&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1392801">//</span><br>
<span class="lineno">135</span><span class="comment" id="1392804">//&nbsp;Note:&nbsp;This&nbsp;code&nbsp;detects&nbsp;(some)&nbsp;cycles&nbsp;created&nbsp;via&nbsp;pointers&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="1392870">//&nbsp;not&nbsp;cycles&nbsp;that&nbsp;are&nbsp;created&nbsp;via&nbsp;slices&nbsp;or&nbsp;maps&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1392935">//&nbsp;same&nbsp;slice&nbsp;or&nbsp;map.&nbsp;Code&nbsp;for&nbsp;general&nbsp;data&nbsp;structures&nbsp;probably</span><br>
<span class="lineno"></span><span class="comment" id="1392999">//&nbsp;should&nbsp;catch&nbsp;those&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="1393031">func</span>&nbsp;<span class="op" id="1393036">(</span><span class="ident" id="1393037">p</span>&nbsp;<span class="op" id="1393039">*</span><span class="ident" id="1393040">printer</span><span class="op" id="1393047">)</span>&nbsp;<span class="builtinfunc" id="1393049">print</span><span class="op" id="1393054">(</span><span class="ident" id="1393055">x</span>&nbsp;<span class="ident" id="1393057">reflect</span><span class="op" id="1393064">.</span><span class="ident" id="1393065">Value</span><span class="op" id="1393070">)</span>&nbsp;<span class="op" id="1393072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393075">if</span>&nbsp;<span class="op" id="1393078">!</span><span class="ident" id="1393079">NotNilFilter</span><span class="op" id="1393091">(</span><span class="string" id="1393092">&#34;&#34;</span><span class="op" id="1393094">,</span>&nbsp;<span class="ident" id="1393096">x</span><span class="op" id="1393097">)</span>&nbsp;<span class="op" id="1393099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393103">p</span><span class="op" id="1393104">.</span><span class="ident" id="1393105">printf</span><span class="op" id="1393111">(</span><span class="string" id="1393112">&#34;nil&#34;</span><span class="op" id="1393117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393121">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393129">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393133">switch</span>&nbsp;<span class="ident" id="1393140">x</span><span class="op" id="1393141">.</span><span class="ident" id="1393142">Kind</span><span class="op" id="1393146">(</span><span class="op" id="1393147">)</span>&nbsp;<span class="op" id="1393149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393152">case</span>&nbsp;<span class="ident" id="1393157">reflect</span><span class="op" id="1393164">.</span><span class="ident" id="1393165">Interface</span><span class="op" id="1393174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393178">p</span><span class="op" id="1393179">.</span><span class="builtinfunc" id="1393180">print</span><span class="op" id="1393185">(</span><span class="ident" id="1393186">x</span><span class="op" id="1393187">.</span><span class="ident" id="1393188">Elem</span><span class="op" id="1393192">(</span><span class="op" id="1393193">)</span><span class="op" id="1393194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393198">case</span>&nbsp;<span class="ident" id="1393203">reflect</span><span class="op" id="1393210">.</span><span class="ident" id="1393211">Map</span><span class="op" id="1393214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393218">p</span><span class="op" id="1393219">.</span><span class="ident" id="1393220">printf</span><span class="op" id="1393226">(</span><span class="string" id="1393227">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="1393244">,</span>&nbsp;<span class="ident" id="1393246">x</span><span class="op" id="1393247">.</span><span class="ident" id="1393248">Type</span><span class="op" id="1393252">(</span><span class="op" id="1393253">)</span><span class="op" id="1393254">,</span>&nbsp;<span class="ident" id="1393256">x</span><span class="op" id="1393257">.</span><span class="ident" id="1393258">Len</span><span class="op" id="1393261">(</span><span class="op" id="1393262">)</span><span class="op" id="1393263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393267">if</span>&nbsp;<span class="ident" id="1393270">x</span><span class="op" id="1393271">.</span><span class="ident" id="1393272">Len</span><span class="op" id="1393275">(</span><span class="op" id="1393276">)</span>&nbsp;<span class="op" id="1393278">&gt;</span>&nbsp;<span class="num" id="1393280">0</span>&nbsp;<span class="op" id="1393282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393287">p</span><span class="op" id="1393288">.</span><span class="ident" id="1393289">indent</span><span class="op" id="1393295">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393301">p</span><span class="op" id="1393302">.</span><span class="ident" id="1393303">printf</span><span class="op" id="1393309">(</span><span class="string" id="1393310">&#34;\n&#34;</span><span class="op" id="1393314">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393319">for</span>&nbsp;<span class="ident" id="1393323">_</span><span class="op" id="1393324">,</span>&nbsp;<span class="ident" id="1393326">key</span>&nbsp;<span class="op" id="1393330">:=</span>&nbsp;<span class="keyword" id="1393333">range</span>&nbsp;<span class="ident" id="1393339">x</span><span class="op" id="1393340">.</span><span class="ident" id="1393341">MapKeys</span><span class="op" id="1393348">(</span><span class="op" id="1393349">)</span>&nbsp;<span class="op" id="1393351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393357">p</span><span class="op" id="1393358">.</span><span class="builtinfunc" id="1393359">print</span><span class="op" id="1393364">(</span><span class="ident" id="1393365">key</span><span class="op" id="1393368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393374">p</span><span class="op" id="1393375">.</span><span class="ident" id="1393376">printf</span><span class="op" id="1393382">(</span><span class="string" id="1393383">&#34;:&nbsp;&#34;</span><span class="op" id="1393387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393393">p</span><span class="op" id="1393394">.</span><span class="builtinfunc" id="1393395">print</span><span class="op" id="1393400">(</span><span class="ident" id="1393401">x</span><span class="op" id="1393402">.</span><span class="ident" id="1393403">MapIndex</span><span class="op" id="1393411">(</span><span class="ident" id="1393412">key</span><span class="op" id="1393415">)</span><span class="op" id="1393416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393422">p</span><span class="op" id="1393423">.</span><span class="ident" id="1393424">printf</span><span class="op" id="1393430">(</span><span class="string" id="1393431">&#34;\n&#34;</span><span class="op" id="1393435">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393445">p</span><span class="op" id="1393446">.</span><span class="ident" id="1393447">indent</span><span class="op" id="1393453">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393462">p</span><span class="op" id="1393463">.</span><span class="ident" id="1393464">printf</span><span class="op" id="1393470">(</span><span class="string" id="1393471">&#34;}&#34;</span><span class="op" id="1393474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393478">case</span>&nbsp;<span class="ident" id="1393483">reflect</span><span class="op" id="1393490">.</span><span class="ident" id="1393491">Ptr</span><span class="op" id="1393494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393498">p</span><span class="op" id="1393499">.</span><span class="ident" id="1393500">printf</span><span class="op" id="1393506">(</span><span class="string" id="1393507">&#34;*&#34;</span><span class="op" id="1393510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1393514">//&nbsp;type-checked&nbsp;ASTs&nbsp;may&nbsp;contain&nbsp;cycles&nbsp;-&nbsp;use&nbsp;ptrmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1393569">//&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;objects&nbsp;that&nbsp;have&nbsp;been&nbsp;printed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1393622">//&nbsp;already&nbsp;and&nbsp;print&nbsp;the&nbsp;respective&nbsp;line&nbsp;number&nbsp;instead</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393680">ptr</span>&nbsp;<span class="op" id="1393684">:=</span>&nbsp;<span class="ident" id="1393687">x</span><span class="op" id="1393688">.</span><span class="ident" id="1393689">Interface</span><span class="op" id="1393698">(</span><span class="op" id="1393699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393703">if</span>&nbsp;<span class="ident" id="1393706">line</span><span class="op" id="1393710">,</span>&nbsp;<span class="ident" id="1393712">exists</span>&nbsp;<span class="op" id="1393719">:=</span>&nbsp;<span class="ident" id="1393722">p</span><span class="op" id="1393723">.</span><span class="ident" id="1393724">ptrmap</span><span class="op" id="1393730">[</span><span class="ident" id="1393731">ptr</span><span class="op" id="1393734">]</span><span class="op" id="1393735">;</span>&nbsp;<span class="ident" id="1393737">exists</span>&nbsp;<span class="op" id="1393744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393749">p</span><span class="op" id="1393750">.</span><span class="ident" id="1393751">printf</span><span class="op" id="1393757">(</span><span class="string" id="1393758">&#34;(obj&nbsp;@&nbsp;%d)&#34;</span><span class="op" id="1393770">,</span>&nbsp;<span class="ident" id="1393772">line</span><span class="op" id="1393776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393780">}</span>&nbsp;<span class="keyword" id="1393782">else</span>&nbsp;<span class="op" id="1393787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393792">p</span><span class="op" id="1393793">.</span><span class="ident" id="1393794">ptrmap</span><span class="op" id="1393800">[</span><span class="ident" id="1393801">ptr</span><span class="op" id="1393804">]</span>&nbsp;<span class="op" id="1393806">=</span>&nbsp;<span class="ident" id="1393808">p</span><span class="op" id="1393809">.</span><span class="ident" id="1393810">line</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393818">p</span><span class="op" id="1393819">.</span><span class="builtinfunc" id="1393820">print</span><span class="op" id="1393825">(</span><span class="ident" id="1393826">x</span><span class="op" id="1393827">.</span><span class="ident" id="1393828">Elem</span><span class="op" id="1393832">(</span><span class="op" id="1393833">)</span><span class="op" id="1393834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393842">case</span>&nbsp;<span class="ident" id="1393847">reflect</span><span class="op" id="1393854">.</span><span class="ident" id="1393855">Array</span><span class="op" id="1393860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393864">p</span><span class="op" id="1393865">.</span><span class="ident" id="1393866">printf</span><span class="op" id="1393872">(</span><span class="string" id="1393873">&#34;%s&nbsp;{&#34;</span><span class="op" id="1393879">,</span>&nbsp;<span class="ident" id="1393881">x</span><span class="op" id="1393882">.</span><span class="ident" id="1393883">Type</span><span class="op" id="1393887">(</span><span class="op" id="1393888">)</span><span class="op" id="1393889">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393893">if</span>&nbsp;<span class="ident" id="1393896">x</span><span class="op" id="1393897">.</span><span class="ident" id="1393898">Len</span><span class="op" id="1393901">(</span><span class="op" id="1393902">)</span>&nbsp;<span class="op" id="1393904">&gt;</span>&nbsp;<span class="num" id="1393906">0</span>&nbsp;<span class="op" id="1393908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393913">p</span><span class="op" id="1393914">.</span><span class="ident" id="1393915">indent</span><span class="op" id="1393921">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393927">p</span><span class="op" id="1393928">.</span><span class="ident" id="1393929">printf</span><span class="op" id="1393935">(</span><span class="string" id="1393936">&#34;\n&#34;</span><span class="op" id="1393940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393945">for</span>&nbsp;<span class="ident" id="1393949">i</span><span class="op" id="1393950">,</span>&nbsp;<span class="ident" id="1393952">n</span>&nbsp;<span class="op" id="1393954">:=</span>&nbsp;<span class="num" id="1393957">0</span><span class="op" id="1393958">,</span>&nbsp;<span class="ident" id="1393960">x</span><span class="op" id="1393961">.</span><span class="ident" id="1393962">Len</span><span class="op" id="1393965">(</span><span class="op" id="1393966">)</span><span class="op" id="1393967">;</span>&nbsp;<span class="ident" id="1393969">i</span>&nbsp;<span class="op" id="1393971">&lt;</span>&nbsp;<span class="ident" id="1393973">n</span><span class="op" id="1393974">;</span>&nbsp;<span class="ident" id="1393976">i</span><span class="op" id="1393977">++</span>&nbsp;<span class="op" id="1393980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393986">p</span><span class="op" id="1393987">.</span><span class="ident" id="1393988">printf</span><span class="op" id="1393994">(</span><span class="string" id="1393995">&#34;%d:&nbsp;&#34;</span><span class="op" id="1394001">,</span>&nbsp;<span class="ident" id="1394003">i</span><span class="op" id="1394004">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394010">p</span><span class="op" id="1394011">.</span><span class="builtinfunc" id="1394012">print</span><span class="op" id="1394017">(</span><span class="ident" id="1394018">x</span><span class="op" id="1394019">.</span><span class="ident" id="1394020">Index</span><span class="op" id="1394025">(</span><span class="ident" id="1394026">i</span><span class="op" id="1394027">)</span><span class="op" id="1394028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394034">p</span><span class="op" id="1394035">.</span><span class="ident" id="1394036">printf</span><span class="op" id="1394042">(</span><span class="string" id="1394043">&#34;\n&#34;</span><span class="op" id="1394047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394057">p</span><span class="op" id="1394058">.</span><span class="ident" id="1394059">indent</span><span class="op" id="1394065">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394070">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394074">p</span><span class="op" id="1394075">.</span><span class="ident" id="1394076">printf</span><span class="op" id="1394082">(</span><span class="string" id="1394083">&#34;}&#34;</span><span class="op" id="1394086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394090">case</span>&nbsp;<span class="ident" id="1394095">reflect</span><span class="op" id="1394102">.</span><span class="ident" id="1394103">Slice</span><span class="op" id="1394108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394112">if</span>&nbsp;<span class="ident" id="1394115">s</span><span class="op" id="1394116">,</span>&nbsp;<span class="ident" id="1394118">ok</span>&nbsp;<span class="op" id="1394121">:=</span>&nbsp;<span class="ident" id="1394124">x</span><span class="op" id="1394125">.</span><span class="ident" id="1394126">Interface</span><span class="op" id="1394135">(</span><span class="op" id="1394136">)</span><span class="op" id="1394137">.</span><span class="op" id="1394138">(</span><span class="op" id="1394139">[</span><span class="op" id="1394140">]</span><span class="builtintype" id="1394141">byte</span><span class="op" id="1394145">)</span><span class="op" id="1394146">;</span>&nbsp;<span class="ident" id="1394148">ok</span>&nbsp;<span class="op" id="1394151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394156">p</span><span class="op" id="1394157">.</span><span class="ident" id="1394158">printf</span><span class="op" id="1394164">(</span><span class="string" id="1394165">&#34;%#q&#34;</span><span class="op" id="1394170">,</span>&nbsp;<span class="ident" id="1394172">s</span><span class="op" id="1394173">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394178">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394191">p</span><span class="op" id="1394192">.</span><span class="ident" id="1394193">printf</span><span class="op" id="1394199">(</span><span class="string" id="1394200">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="1394217">,</span>&nbsp;<span class="ident" id="1394219">x</span><span class="op" id="1394220">.</span><span class="ident" id="1394221">Type</span><span class="op" id="1394225">(</span><span class="op" id="1394226">)</span><span class="op" id="1394227">,</span>&nbsp;<span class="ident" id="1394229">x</span><span class="op" id="1394230">.</span><span class="ident" id="1394231">Len</span><span class="op" id="1394234">(</span><span class="op" id="1394235">)</span><span class="op" id="1394236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394240">if</span>&nbsp;<span class="ident" id="1394243">x</span><span class="op" id="1394244">.</span><span class="ident" id="1394245">Len</span><span class="op" id="1394248">(</span><span class="op" id="1394249">)</span>&nbsp;<span class="op" id="1394251">&gt;</span>&nbsp;<span class="num" id="1394253">0</span>&nbsp;<span class="op" id="1394255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394260">p</span><span class="op" id="1394261">.</span><span class="ident" id="1394262">indent</span><span class="op" id="1394268">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394274">p</span><span class="op" id="1394275">.</span><span class="ident" id="1394276">printf</span><span class="op" id="1394282">(</span><span class="string" id="1394283">&#34;\n&#34;</span><span class="op" id="1394287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394292">for</span>&nbsp;<span class="ident" id="1394296">i</span><span class="op" id="1394297">,</span>&nbsp;<span class="ident" id="1394299">n</span>&nbsp;<span class="op" id="1394301">:=</span>&nbsp;<span class="num" id="1394304">0</span><span class="op" id="1394305">,</span>&nbsp;<span class="ident" id="1394307">x</span><span class="op" id="1394308">.</span><span class="ident" id="1394309">Len</span><span class="op" id="1394312">(</span><span class="op" id="1394313">)</span><span class="op" id="1394314">;</span>&nbsp;<span class="ident" id="1394316">i</span>&nbsp;<span class="op" id="1394318">&lt;</span>&nbsp;<span class="ident" id="1394320">n</span><span class="op" id="1394321">;</span>&nbsp;<span class="ident" id="1394323">i</span><span class="op" id="1394324">++</span>&nbsp;<span class="op" id="1394327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394333">p</span><span class="op" id="1394334">.</span><span class="ident" id="1394335">printf</span><span class="op" id="1394341">(</span><span class="string" id="1394342">&#34;%d:&nbsp;&#34;</span><span class="op" id="1394348">,</span>&nbsp;<span class="ident" id="1394350">i</span><span class="op" id="1394351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394357">p</span><span class="op" id="1394358">.</span><span class="builtinfunc" id="1394359">print</span><span class="op" id="1394364">(</span><span class="ident" id="1394365">x</span><span class="op" id="1394366">.</span><span class="ident" id="1394367">Index</span><span class="op" id="1394372">(</span><span class="ident" id="1394373">i</span><span class="op" id="1394374">)</span><span class="op" id="1394375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394381">p</span><span class="op" id="1394382">.</span><span class="ident" id="1394383">printf</span><span class="op" id="1394389">(</span><span class="string" id="1394390">&#34;\n&#34;</span><span class="op" id="1394394">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394404">p</span><span class="op" id="1394405">.</span><span class="ident" id="1394406">indent</span><span class="op" id="1394412">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394421">p</span><span class="op" id="1394422">.</span><span class="ident" id="1394423">printf</span><span class="op" id="1394429">(</span><span class="string" id="1394430">&#34;}&#34;</span><span class="op" id="1394433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394437">case</span>&nbsp;<span class="ident" id="1394442">reflect</span><span class="op" id="1394449">.</span><span class="ident" id="1394450">Struct</span><span class="op" id="1394456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394460">t</span>&nbsp;<span class="op" id="1394462">:=</span>&nbsp;<span class="ident" id="1394465">x</span><span class="op" id="1394466">.</span><span class="ident" id="1394467">Type</span><span class="op" id="1394471">(</span><span class="op" id="1394472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394476">p</span><span class="op" id="1394477">.</span><span class="ident" id="1394478">printf</span><span class="op" id="1394484">(</span><span class="string" id="1394485">&#34;%s&nbsp;{&#34;</span><span class="op" id="1394491">,</span>&nbsp;<span class="ident" id="1394493">t</span><span class="op" id="1394494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394498">p</span><span class="op" id="1394499">.</span><span class="ident" id="1394500">indent</span><span class="op" id="1394506">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394511">first</span>&nbsp;<span class="op" id="1394517">:=</span>&nbsp;<span class="builtintype" id="1394520">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394527">for</span>&nbsp;<span class="ident" id="1394531">i</span><span class="op" id="1394532">,</span>&nbsp;<span class="ident" id="1394534">n</span>&nbsp;<span class="op" id="1394536">:=</span>&nbsp;<span class="num" id="1394539">0</span><span class="op" id="1394540">,</span>&nbsp;<span class="ident" id="1394542">t</span><span class="op" id="1394543">.</span><span class="ident" id="1394544">NumField</span><span class="op" id="1394552">(</span><span class="op" id="1394553">)</span><span class="op" id="1394554">;</span>&nbsp;<span class="ident" id="1394556">i</span>&nbsp;<span class="op" id="1394558">&lt;</span>&nbsp;<span class="ident" id="1394560">n</span><span class="op" id="1394561">;</span>&nbsp;<span class="ident" id="1394563">i</span><span class="op" id="1394564">++</span>&nbsp;<span class="op" id="1394567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1394572">//&nbsp;exclude&nbsp;non-exported&nbsp;fields&nbsp;because&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1394620">//&nbsp;values&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;via&nbsp;reflection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394667">if</span>&nbsp;<span class="ident" id="1394670">name</span>&nbsp;<span class="op" id="1394675">:=</span>&nbsp;<span class="ident" id="1394678">t</span><span class="op" id="1394679">.</span><span class="ident" id="1394680">Field</span><span class="op" id="1394685">(</span><span class="ident" id="1394686">i</span><span class="op" id="1394687">)</span><span class="op" id="1394688">.</span><span class="ident" id="1394689">Name</span><span class="op" id="1394693">;</span>&nbsp;<span class="ident" id="1394695">IsExported</span><span class="op" id="1394705">(</span><span class="ident" id="1394706">name</span><span class="op" id="1394710">)</span>&nbsp;<span class="op" id="1394712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394718">value</span>&nbsp;<span class="op" id="1394724">:=</span>&nbsp;<span class="ident" id="1394727">x</span><span class="op" id="1394728">.</span><span class="ident" id="1394729">Field</span><span class="op" id="1394734">(</span><span class="ident" id="1394735">i</span><span class="op" id="1394736">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394742">if</span>&nbsp;<span class="ident" id="1394745">p</span><span class="op" id="1394746">.</span><span class="ident" id="1394747">filter</span>&nbsp;<span class="op" id="1394754">==</span>&nbsp;<span class="ident" id="1394757">nil</span>&nbsp;<span class="op" id="1394761">||</span>&nbsp;<span class="ident" id="1394764">p</span><span class="op" id="1394765">.</span><span class="ident" id="1394766">filter</span><span class="op" id="1394772">(</span><span class="ident" id="1394773">name</span><span class="op" id="1394777">,</span>&nbsp;<span class="ident" id="1394779">value</span><span class="op" id="1394784">)</span>&nbsp;<span class="op" id="1394786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394793">if</span>&nbsp;<span class="ident" id="1394796">first</span>&nbsp;<span class="op" id="1394802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394810">p</span><span class="op" id="1394811">.</span><span class="ident" id="1394812">printf</span><span class="op" id="1394818">(</span><span class="string" id="1394819">&#34;\n&#34;</span><span class="op" id="1394823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394831">first</span>&nbsp;<span class="op" id="1394837">=</span>&nbsp;<span class="builtintype" id="1394839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394850">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394857">p</span><span class="op" id="1394858">.</span><span class="ident" id="1394859">printf</span><span class="op" id="1394865">(</span><span class="string" id="1394866">&#34;%s:&nbsp;&#34;</span><span class="op" id="1394872">,</span>&nbsp;<span class="ident" id="1394874">name</span><span class="op" id="1394878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394885">p</span><span class="op" id="1394886">.</span><span class="builtinfunc" id="1394887">print</span><span class="op" id="1394892">(</span><span class="ident" id="1394893">value</span><span class="op" id="1394898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394905">p</span><span class="op" id="1394906">.</span><span class="ident" id="1394907">printf</span><span class="op" id="1394913">(</span><span class="string" id="1394914">&#34;\n&#34;</span><span class="op" id="1394918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394929">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394937">p</span><span class="op" id="1394938">.</span><span class="ident" id="1394939">indent</span><span class="op" id="1394945">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394950">p</span><span class="op" id="1394951">.</span><span class="ident" id="1394952">printf</span><span class="op" id="1394958">(</span><span class="string" id="1394959">&#34;}&#34;</span><span class="op" id="1394962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394966">default</span><span class="op" id="1394973">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394977">v</span>&nbsp;<span class="op" id="1394979">:=</span>&nbsp;<span class="ident" id="1394982">x</span><span class="op" id="1394983">.</span><span class="ident" id="1394984">Interface</span><span class="op" id="1394993">(</span><span class="op" id="1394994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394998">switch</span>&nbsp;<span class="ident" id="1395005">v</span>&nbsp;<span class="op" id="1395007">:=</span>&nbsp;<span class="ident" id="1395010">v</span><span class="op" id="1395011">.</span><span class="op" id="1395012">(</span><span class="keyword" id="1395013">type</span><span class="op" id="1395017">)</span>&nbsp;<span class="op" id="1395019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395023">case</span>&nbsp;<span class="builtintype" id="1395028">string</span><span class="op" id="1395034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1395039">//&nbsp;print&nbsp;strings&nbsp;in&nbsp;quotes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395069">p</span><span class="op" id="1395070">.</span><span class="ident" id="1395071">printf</span><span class="op" id="1395077">(</span><span class="string" id="1395078">&#34;%q&#34;</span><span class="op" id="1395082">,</span>&nbsp;<span class="ident" id="1395084">v</span><span class="op" id="1395085">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395090">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395099">case</span>&nbsp;<span class="ident" id="1395104">token</span><span class="op" id="1395109">.</span><span class="ident" id="1395110">Pos</span><span class="op" id="1395113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1395118">//&nbsp;position&nbsp;values&nbsp;can&nbsp;be&nbsp;printed&nbsp;nicely&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395184">if</span>&nbsp;<span class="ident" id="1395187">p</span><span class="op" id="1395188">.</span><span class="ident" id="1395189">fset</span>&nbsp;<span class="op" id="1395194">!=</span>&nbsp;<span class="ident" id="1395197">nil</span>&nbsp;<span class="op" id="1395201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395207">p</span><span class="op" id="1395208">.</span><span class="ident" id="1395209">printf</span><span class="op" id="1395215">(</span><span class="string" id="1395216">&#34;%s&#34;</span><span class="op" id="1395220">,</span>&nbsp;<span class="ident" id="1395222">p</span><span class="op" id="1395223">.</span><span class="ident" id="1395224">fset</span><span class="op" id="1395228">.</span><span class="ident" id="1395229">Position</span><span class="op" id="1395237">(</span><span class="ident" id="1395238">v</span><span class="op" id="1395239">)</span><span class="op" id="1395240">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395246">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1395264">//&nbsp;default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395277">p</span><span class="op" id="1395278">.</span><span class="ident" id="1395279">printf</span><span class="op" id="1395285">(</span><span class="string" id="1395286">&#34;%v&#34;</span><span class="op" id="1395290">,</span>&nbsp;<span class="ident" id="1395292">v</span><span class="op" id="1395293">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395296">}</span><br>
<span class="lineno"></span><span class="op" id="1395298">}</span>
</div>
</body>
</html>
