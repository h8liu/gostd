<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2220262">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2220318">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2220372">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2220423">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2220451">package</span>&nbsp;<span class="ident" id="2220459">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2220468">import</span>&nbsp;<span class="string" id="2220475">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2220485">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2220554">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2220610">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2220629">func</span>&nbsp;<span class="ident" id="2220634">UnixCredentials</span><span class="op" id="2220649">(</span><span class="ident" id="2220650">ucred</span>&nbsp;<span class="op" id="2220656">*</span><span class="ident" id="2220657">Ucred</span><span class="op" id="2220662">)</span>&nbsp;<span class="op" id="2220664">[</span><span class="op" id="2220665">]</span><span class="builtintype" id="2220666">byte</span>&nbsp;<span class="op" id="2220671">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220674">b</span>&nbsp;<span class="op" id="2220676">:=</span>&nbsp;<span class="builtinfunc" id="2220679">make</span><span class="op" id="2220683">(</span><span class="op" id="2220684">[</span><span class="op" id="2220685">]</span><span class="builtintype" id="2220686">byte</span><span class="op" id="2220690">,</span>&nbsp;<span class="ident" id="2220692">CmsgSpace</span><span class="op" id="2220701">(</span><span class="ident" id="2220702">SizeofUcred</span><span class="op" id="2220713">)</span><span class="op" id="2220714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220717">h</span>&nbsp;<span class="op" id="2220719">:=</span>&nbsp;<span class="op" id="2220722">(</span><span class="op" id="2220723">*</span><span class="ident" id="2220724">Cmsghdr</span><span class="op" id="2220731">)</span><span class="op" id="2220732">(</span><span class="ident" id="2220733">unsafe</span><span class="op" id="2220739">.</span><span class="ident" id="2220740">Pointer</span><span class="op" id="2220747">(</span><span class="op" id="2220748">&amp;</span><span class="ident" id="2220749">b</span><span class="op" id="2220750">[</span><span class="num" id="2220751">0</span><span class="op" id="2220752">]</span><span class="op" id="2220753">)</span><span class="op" id="2220754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220757">h</span><span class="op" id="2220758">.</span><span class="ident" id="2220759">Level</span>&nbsp;<span class="op" id="2220765">=</span>&nbsp;<span class="ident" id="2220767">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220779">h</span><span class="op" id="2220780">.</span><span class="ident" id="2220781">Type</span>&nbsp;<span class="op" id="2220786">=</span>&nbsp;<span class="ident" id="2220788">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2220805">h</span><span class="op" id="2220806">.</span><span class="ident" id="2220807">SetLen</span><span class="op" id="2220813">(</span><span class="ident" id="2220814">CmsgLen</span><span class="op" id="2220821">(</span><span class="ident" id="2220822">SizeofUcred</span><span class="op" id="2220833">)</span><span class="op" id="2220834">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2220837">*</span><span class="op" id="2220838">(</span><span class="op" id="2220839">(</span><span class="op" id="2220840">*</span><span class="ident" id="2220841">Ucred</span><span class="op" id="2220846">)</span><span class="op" id="2220847">(</span><span class="ident" id="2220848">cmsgData</span><span class="op" id="2220856">(</span><span class="ident" id="2220857">h</span><span class="op" id="2220858">)</span><span class="op" id="2220859">)</span><span class="op" id="2220860">)</span>&nbsp;<span class="op" id="2220862">=</span>&nbsp;<span class="op" id="2220864">*</span><span class="ident" id="2220865">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2220872">return</span>&nbsp;<span class="ident" id="2220879">b</span><br>
<span class="lineno"></span><span class="op" id="2220881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2220884">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2220955">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2221023">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2221076">func</span>&nbsp;<span class="ident" id="2221081">ParseUnixCredentials</span><span class="op" id="2221101">(</span><span class="ident" id="2221102">m</span>&nbsp;<span class="op" id="2221104">*</span><span class="ident" id="2221105">SocketControlMessage</span><span class="op" id="2221125">)</span>&nbsp;<span class="op" id="2221127">(</span><span class="op" id="2221128">*</span><span class="ident" id="2221129">Ucred</span><span class="op" id="2221134">,</span>&nbsp;<span class="builtintype" id="2221136">error</span><span class="op" id="2221141">)</span>&nbsp;<span class="op" id="2221143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221146">if</span>&nbsp;<span class="ident" id="2221149">m</span><span class="op" id="2221150">.</span><span class="ident" id="2221151">Header</span><span class="op" id="2221157">.</span><span class="ident" id="2221158">Level</span>&nbsp;<span class="op" id="2221164">!=</span>&nbsp;<span class="ident" id="2221167">SOL_SOCKET</span>&nbsp;<span class="op" id="2221178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221182">return</span>&nbsp;<span class="ident" id="2221189">nil</span><span class="op" id="2221192">,</span>&nbsp;<span class="ident" id="2221194">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221205">if</span>&nbsp;<span class="ident" id="2221208">m</span><span class="op" id="2221209">.</span><span class="ident" id="2221210">Header</span><span class="op" id="2221216">.</span><span class="ident" id="2221217">Type</span>&nbsp;<span class="op" id="2221222">!=</span>&nbsp;<span class="ident" id="2221225">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2221241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221245">return</span>&nbsp;<span class="ident" id="2221252">nil</span><span class="op" id="2221255">,</span>&nbsp;<span class="ident" id="2221257">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2221265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2221268">ucred</span>&nbsp;<span class="op" id="2221274">:=</span>&nbsp;<span class="op" id="2221277">*</span><span class="op" id="2221278">(</span><span class="op" id="2221279">*</span><span class="ident" id="2221280">Ucred</span><span class="op" id="2221285">)</span><span class="op" id="2221286">(</span><span class="ident" id="2221287">unsafe</span><span class="op" id="2221293">.</span><span class="ident" id="2221294">Pointer</span><span class="op" id="2221301">(</span><span class="op" id="2221302">&amp;</span><span class="ident" id="2221303">m</span><span class="op" id="2221304">.</span><span class="ident" id="2221305">Data</span><span class="op" id="2221309">[</span><span class="num" id="2221310">0</span><span class="op" id="2221311">]</span><span class="op" id="2221312">)</span><span class="op" id="2221313">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2221316">return</span>&nbsp;<span class="op" id="2221323">&amp;</span><span class="ident" id="2221324">ucred</span><span class="op" id="2221329">,</span>&nbsp;<span class="ident" id="2221331">nil</span><br>
<span class="lineno"></span><span class="op" id="2221335">}</span>
</div>
</body>
</html>
