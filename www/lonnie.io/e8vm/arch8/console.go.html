<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4856327">package</span>&nbsp;<span class="ident" id="4856335">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856342">import</span>&nbsp;<span class="op" id="4856349">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4856352">&#34;io&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4856358">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4856365">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="4856370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856373">//&nbsp;Console&nbsp;is&nbsp;a&nbsp;simple&nbsp;console&nbsp;that&nbsp;can&nbsp;output/input&nbsp;a&nbsp;single</span><br>
<span class="lineno">10</span><span class="comment" id="4856435">//&nbsp;byte&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span><span class="keyword" id="4856453">type</span>&nbsp;<span class="ident" id="4856458">console</span>&nbsp;<span class="keyword" id="4856466">struct</span>&nbsp;<span class="op" id="4856473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856476">intBus</span>&nbsp;<span class="ident" id="4856483">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856491">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4856498">*</span><span class="ident" id="4856499">page</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856506">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4856513">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856519">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="4856526">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856532">IntOut</span>&nbsp;<span class="builtintype" id="4856539">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856546">Output</span>&nbsp;<span class="ident" id="4856553">io</span><span class="op" id="4856555">.</span><span class="ident" id="4856556">Writer</span><br>
<span class="lineno">20</span><span class="op" id="4856563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856566">//&nbsp;NewConsole&nbsp;creates&nbsp;a&nbsp;new&nbsp;simple&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="4856610">func</span>&nbsp;<span class="ident" id="4856615">newConsole</span><span class="op" id="4856625">(</span><span class="ident" id="4856626">p</span>&nbsp;<span class="op" id="4856628">*</span><span class="ident" id="4856629">page</span><span class="op" id="4856633">,</span>&nbsp;<span class="ident" id="4856635">i</span>&nbsp;<span class="ident" id="4856637">intBus</span><span class="op" id="4856643">)</span>&nbsp;<span class="op" id="4856645">*</span><span class="ident" id="4856646">console</span>&nbsp;<span class="op" id="4856654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856657">ret</span>&nbsp;<span class="op" id="4856661">:=</span>&nbsp;<span class="builtinfunc" id="4856664">new</span><span class="op" id="4856667">(</span><span class="ident" id="4856668">console</span><span class="op" id="4856675">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856678">ret</span><span class="op" id="4856681">.</span><span class="ident" id="4856682">intBus</span>&nbsp;<span class="op" id="4856689">=</span>&nbsp;<span class="ident" id="4856691">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856694">ret</span><span class="op" id="4856697">.</span><span class="ident" id="4856698">p</span>&nbsp;<span class="op" id="4856700">=</span>&nbsp;<span class="ident" id="4856702">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856706">ret</span><span class="op" id="4856709">.</span><span class="ident" id="4856710">Core</span>&nbsp;<span class="op" id="4856715">=</span>&nbsp;<span class="num" id="4856717">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856720">ret</span><span class="op" id="4856723">.</span><span class="ident" id="4856724">IntIn</span>&nbsp;<span class="op" id="4856730">=</span>&nbsp;<span class="num" id="4856732">8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856735">ret</span><span class="op" id="4856738">.</span><span class="ident" id="4856739">IntOut</span>&nbsp;<span class="op" id="4856746">=</span>&nbsp;<span class="num" id="4856748">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856752">ret</span><span class="op" id="4856755">.</span><span class="ident" id="4856756">Output</span>&nbsp;<span class="op" id="4856763">=</span>&nbsp;<span class="ident" id="4856765">os</span><span class="op" id="4856767">.</span><span class="ident" id="4856768">Stdout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856776">return</span>&nbsp;<span class="ident" id="4856783">ret</span><br>
<span class="lineno"></span><span class="op" id="4856787">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="4856790">var</span>&nbsp;<span class="ident" id="4856794">_</span>&nbsp;<span class="ident" id="4856796">device</span>&nbsp;<span class="op" id="4856803">=</span>&nbsp;<span class="builtinfunc" id="4856805">new</span><span class="op" id="4856808">(</span><span class="ident" id="4856809">console</span><span class="op" id="4856816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856819">const</span>&nbsp;<span class="op" id="4856825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856828">consoleBase</span>&nbsp;<span class="op" id="4856840">=</span>&nbsp;<span class="num" id="4856842">0</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856846">consoleOut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4856862">=</span>&nbsp;<span class="ident" id="4856864">consoleBase</span>&nbsp;<span class="op" id="4856876">+</span>&nbsp;<span class="num" id="4856878">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856881">consoleOutValid</span>&nbsp;<span class="op" id="4856897">=</span>&nbsp;<span class="ident" id="4856899">consoleBase</span>&nbsp;<span class="op" id="4856911">+</span>&nbsp;<span class="num" id="4856913">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856916">consoleIn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4856932">=</span>&nbsp;<span class="ident" id="4856934">consoleBase</span>&nbsp;<span class="op" id="4856946">+</span>&nbsp;<span class="num" id="4856948">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856951">consoleInValid</span>&nbsp;&nbsp;<span class="op" id="4856967">=</span>&nbsp;<span class="ident" id="4856969">consoleBase</span>&nbsp;<span class="op" id="4856981">+</span>&nbsp;<span class="num" id="4856983">3</span><br>
<span class="lineno">45</span><span class="op" id="4856985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856988">func</span>&nbsp;<span class="op" id="4856993">(</span><span class="ident" id="4856994">c</span>&nbsp;<span class="op" id="4856996">*</span><span class="ident" id="4856997">console</span><span class="op" id="4857004">)</span>&nbsp;<span class="ident" id="4857006">interrupt</span><span class="op" id="4857015">(</span><span class="ident" id="4857016">code</span>&nbsp;<span class="builtintype" id="4857021">byte</span><span class="op" id="4857025">)</span>&nbsp;<span class="op" id="4857027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857030">c</span><span class="op" id="4857031">.</span><span class="ident" id="4857032">intBus</span><span class="op" id="4857038">.</span><span class="ident" id="4857039">Interrupt</span><span class="op" id="4857048">(</span><span class="ident" id="4857049">code</span><span class="op" id="4857053">,</span>&nbsp;<span class="ident" id="4857055">c</span><span class="op" id="4857056">.</span><span class="ident" id="4857057">Core</span><span class="op" id="4857061">)</span><br>
<span class="lineno"></span><span class="op" id="4857063">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4857066">//&nbsp;Tick&nbsp;flushes&nbsp;the&nbsp;buffered&nbsp;byte&nbsp;to&nbsp;the&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="4857116">func</span>&nbsp;<span class="op" id="4857121">(</span><span class="ident" id="4857122">c</span>&nbsp;<span class="op" id="4857124">*</span><span class="ident" id="4857125">console</span><span class="op" id="4857132">)</span>&nbsp;<span class="ident" id="4857134">Tick</span><span class="op" id="4857138">(</span><span class="op" id="4857139">)</span>&nbsp;<span class="op" id="4857141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857144">outValid</span>&nbsp;<span class="op" id="4857153">:=</span>&nbsp;<span class="ident" id="4857156">c</span><span class="op" id="4857157">.</span><span class="ident" id="4857158">p</span><span class="op" id="4857159">.</span><span class="ident" id="4857160">ReadByte</span><span class="op" id="4857168">(</span><span class="ident" id="4857169">consoleOutValid</span><span class="op" id="4857184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857187">if</span>&nbsp;<span class="ident" id="4857190">outValid</span>&nbsp;<span class="op" id="4857199">!=</span>&nbsp;<span class="num" id="4857202">0</span>&nbsp;<span class="op" id="4857204">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857208">out</span>&nbsp;<span class="op" id="4857212">:=</span>&nbsp;<span class="ident" id="4857215">c</span><span class="op" id="4857216">.</span><span class="ident" id="4857217">p</span><span class="op" id="4857218">.</span><span class="ident" id="4857219">ReadByte</span><span class="op" id="4857227">(</span><span class="ident" id="4857228">consoleOut</span><span class="op" id="4857238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857242">_</span><span class="op" id="4857243">,</span>&nbsp;<span class="ident" id="4857245">e</span>&nbsp;<span class="op" id="4857247">:=</span>&nbsp;<span class="ident" id="4857250">c</span><span class="op" id="4857251">.</span><span class="ident" id="4857252">Output</span><span class="op" id="4857258">.</span><span class="ident" id="4857259">Write</span><span class="op" id="4857264">(</span><span class="op" id="4857265">[</span><span class="op" id="4857266">]</span><span class="builtintype" id="4857267">byte</span><span class="op" id="4857271">{</span><span class="ident" id="4857272">out</span><span class="op" id="4857275">}</span><span class="op" id="4857276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857280">if</span>&nbsp;<span class="ident" id="4857283">e</span>&nbsp;<span class="op" id="4857285">!=</span>&nbsp;<span class="ident" id="4857288">nil</span>&nbsp;<span class="op" id="4857292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857297">log</span><span class="op" id="4857300">.</span><span class="ident" id="4857301">Print</span><span class="op" id="4857306">(</span><span class="ident" id="4857307">e</span><span class="op" id="4857308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857312">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857316">c</span><span class="op" id="4857317">.</span><span class="ident" id="4857318">p</span><span class="op" id="4857319">.</span><span class="ident" id="4857320">WriteByte</span><span class="op" id="4857329">(</span><span class="ident" id="4857330">consoleOutValid</span><span class="op" id="4857345">,</span>&nbsp;<span class="num" id="4857347">0</span><span class="op" id="4857348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857352">c</span><span class="op" id="4857353">.</span><span class="ident" id="4857354">interrupt</span><span class="op" id="4857363">(</span><span class="ident" id="4857364">c</span><span class="op" id="4857365">.</span><span class="ident" id="4857366">IntOut</span><span class="op" id="4857372">)</span>&nbsp;<span class="comment" id="4857374">//&nbsp;out&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857396">//&nbsp;TODO:&nbsp;input&nbsp;part</span><br>
<span class="lineno">65</span><span class="op" id="4857416">}</span>
</div>
</body>
</html>
