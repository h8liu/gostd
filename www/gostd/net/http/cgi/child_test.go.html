<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7638729">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7638784">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7638838">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7638889">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7638939">package</span>&nbsp;<span class="ident" id="7638947">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7638952">import</span>&nbsp;<span class="op" id="7638959">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638962">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7638972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7638975">func</span>&nbsp;<span class="ident" id="7638980">TestRequest</span><span class="op" id="7638991">(</span><span class="ident" id="7638992">t</span>&nbsp;<span class="op" id="7638994">*</span><span class="ident" id="7638995">testing</span><span class="op" id="7639002">.</span><span class="ident" id="7639003">T</span><span class="op" id="7639004">)</span>&nbsp;<span class="op" id="7639006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639009">env</span>&nbsp;<span class="op" id="7639013">:=</span>&nbsp;<span class="keyword" id="7639016">map</span><span class="op" id="7639019">[</span><span class="builtintype" id="7639020">string</span><span class="op" id="7639026">]</span><span class="builtintype" id="7639027">string</span><span class="op" id="7639033">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639037">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7639054">:</span>&nbsp;<span class="string" id="7639056">&#34;HTTP/1.1&#34;</span><span class="op" id="7639066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639070">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7639086">:</span>&nbsp;&nbsp;<span class="string" id="7639089">&#34;GET&#34;</span><span class="op" id="7639094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639098">&#34;HTTP_HOST&#34;</span><span class="op" id="7639109">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639117">&#34;example.com&#34;</span><span class="op" id="7639130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639134">&#34;HTTP_REFERER&#34;</span><span class="op" id="7639148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639153">&#34;elsewhere&#34;</span><span class="op" id="7639164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639168">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="7639185">:</span>&nbsp;<span class="string" id="7639187">&#34;goclient&#34;</span><span class="op" id="7639197">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639201">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="7639215">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639220">&#34;baz&#34;</span><span class="op" id="7639225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639229">&#34;REQUEST_URI&#34;</span><span class="op" id="7639242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639248">&#34;/path?a=b&#34;</span><span class="op" id="7639259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639263">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7639279">:</span>&nbsp;&nbsp;<span class="string" id="7639282">&#34;123&#34;</span><span class="op" id="7639287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639291">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7639305">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639310">&#34;text/xml&#34;</span><span class="op" id="7639320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7639324">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7639337">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7639343">&#34;5.6.7.8&#34;</span><span class="op" id="7639352">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639358">req</span><span class="op" id="7639361">,</span>&nbsp;<span class="ident" id="7639363">err</span>&nbsp;<span class="op" id="7639367">:=</span>&nbsp;<span class="ident" id="7639370">RequestFromMap</span><span class="op" id="7639384">(</span><span class="ident" id="7639385">env</span><span class="op" id="7639388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639391">if</span>&nbsp;<span class="ident" id="7639394">err</span>&nbsp;<span class="op" id="7639398">!=</span>&nbsp;<span class="ident" id="7639401">nil</span>&nbsp;<span class="op" id="7639405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639409">t</span><span class="op" id="7639410">.</span><span class="ident" id="7639411">Fatalf</span><span class="op" id="7639417">(</span><span class="string" id="7639418">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7639438">,</span>&nbsp;<span class="ident" id="7639440">err</span><span class="op" id="7639443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639446">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639449">if</span>&nbsp;<span class="ident" id="7639452">g</span><span class="op" id="7639453">,</span>&nbsp;<span class="ident" id="7639455">e</span>&nbsp;<span class="op" id="7639457">:=</span>&nbsp;<span class="ident" id="7639460">req</span><span class="op" id="7639463">.</span><span class="ident" id="7639464">UserAgent</span><span class="op" id="7639473">(</span><span class="op" id="7639474">)</span><span class="op" id="7639475">,</span>&nbsp;<span class="string" id="7639477">&#34;goclient&#34;</span><span class="op" id="7639487">;</span>&nbsp;<span class="ident" id="7639489">e</span>&nbsp;<span class="op" id="7639491">!=</span>&nbsp;<span class="ident" id="7639494">g</span>&nbsp;<span class="op" id="7639496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639500">t</span><span class="op" id="7639501">.</span><span class="ident" id="7639502">Errorf</span><span class="op" id="7639508">(</span><span class="string" id="7639509">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7639540">,</span>&nbsp;<span class="ident" id="7639542">e</span><span class="op" id="7639543">,</span>&nbsp;<span class="ident" id="7639545">g</span><span class="op" id="7639546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639552">if</span>&nbsp;<span class="ident" id="7639555">g</span><span class="op" id="7639556">,</span>&nbsp;<span class="ident" id="7639558">e</span>&nbsp;<span class="op" id="7639560">:=</span>&nbsp;<span class="ident" id="7639563">req</span><span class="op" id="7639566">.</span><span class="ident" id="7639567">Method</span><span class="op" id="7639573">,</span>&nbsp;<span class="string" id="7639575">&#34;GET&#34;</span><span class="op" id="7639580">;</span>&nbsp;<span class="ident" id="7639582">e</span>&nbsp;<span class="op" id="7639584">!=</span>&nbsp;<span class="ident" id="7639587">g</span>&nbsp;<span class="op" id="7639589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639593">t</span><span class="op" id="7639594">.</span><span class="ident" id="7639595">Errorf</span><span class="op" id="7639601">(</span><span class="string" id="7639602">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7639630">,</span>&nbsp;<span class="ident" id="7639632">e</span><span class="op" id="7639633">,</span>&nbsp;<span class="ident" id="7639635">g</span><span class="op" id="7639636">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639642">if</span>&nbsp;<span class="ident" id="7639645">g</span><span class="op" id="7639646">,</span>&nbsp;<span class="ident" id="7639648">e</span>&nbsp;<span class="op" id="7639650">:=</span>&nbsp;<span class="ident" id="7639653">req</span><span class="op" id="7639656">.</span><span class="ident" id="7639657">Header</span><span class="op" id="7639663">.</span><span class="ident" id="7639664">Get</span><span class="op" id="7639667">(</span><span class="string" id="7639668">&#34;Content-Type&#34;</span><span class="op" id="7639682">)</span><span class="op" id="7639683">,</span>&nbsp;<span class="string" id="7639685">&#34;text/xml&#34;</span><span class="op" id="7639695">;</span>&nbsp;<span class="ident" id="7639697">e</span>&nbsp;<span class="op" id="7639699">!=</span>&nbsp;<span class="ident" id="7639702">g</span>&nbsp;<span class="op" id="7639704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639708">t</span><span class="op" id="7639709">.</span><span class="ident" id="7639710">Errorf</span><span class="op" id="7639716">(</span><span class="string" id="7639717">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7639751">,</span>&nbsp;<span class="ident" id="7639753">e</span><span class="op" id="7639754">,</span>&nbsp;<span class="ident" id="7639756">g</span><span class="op" id="7639757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639763">if</span>&nbsp;<span class="ident" id="7639766">g</span><span class="op" id="7639767">,</span>&nbsp;<span class="ident" id="7639769">e</span>&nbsp;<span class="op" id="7639771">:=</span>&nbsp;<span class="ident" id="7639774">req</span><span class="op" id="7639777">.</span><span class="ident" id="7639778">ContentLength</span><span class="op" id="7639791">,</span>&nbsp;<span class="ident" id="7639793">int64</span><span class="op" id="7639798">(</span><span class="num" id="7639799">123</span><span class="op" id="7639802">)</span><span class="op" id="7639803">;</span>&nbsp;<span class="ident" id="7639805">e</span>&nbsp;<span class="op" id="7639807">!=</span>&nbsp;<span class="ident" id="7639810">g</span>&nbsp;<span class="op" id="7639812">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639816">t</span><span class="op" id="7639817">.</span><span class="ident" id="7639818">Errorf</span><span class="op" id="7639824">(</span><span class="string" id="7639825">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7639860">,</span>&nbsp;<span class="ident" id="7639862">e</span><span class="op" id="7639863">,</span>&nbsp;<span class="ident" id="7639865">g</span><span class="op" id="7639866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639872">if</span>&nbsp;<span class="ident" id="7639875">g</span><span class="op" id="7639876">,</span>&nbsp;<span class="ident" id="7639878">e</span>&nbsp;<span class="op" id="7639880">:=</span>&nbsp;<span class="ident" id="7639883">req</span><span class="op" id="7639886">.</span><span class="ident" id="7639887">Referer</span><span class="op" id="7639894">(</span><span class="op" id="7639895">)</span><span class="op" id="7639896">,</span>&nbsp;<span class="string" id="7639898">&#34;elsewhere&#34;</span><span class="op" id="7639909">;</span>&nbsp;<span class="ident" id="7639911">e</span>&nbsp;<span class="op" id="7639913">!=</span>&nbsp;<span class="ident" id="7639916">g</span>&nbsp;<span class="op" id="7639918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639922">t</span><span class="op" id="7639923">.</span><span class="ident" id="7639924">Errorf</span><span class="op" id="7639930">(</span><span class="string" id="7639931">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7639960">,</span>&nbsp;<span class="ident" id="7639962">e</span><span class="op" id="7639963">,</span>&nbsp;<span class="ident" id="7639965">g</span><span class="op" id="7639966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639969">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639972">if</span>&nbsp;<span class="ident" id="7639975">req</span><span class="op" id="7639978">.</span><span class="ident" id="7639979">Header</span>&nbsp;<span class="op" id="7639986">==</span>&nbsp;<span class="ident" id="7639989">nil</span>&nbsp;<span class="op" id="7639993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639997">t</span><span class="op" id="7639998">.</span><span class="ident" id="7639999">Fatalf</span><span class="op" id="7640005">(</span><span class="string" id="7640006">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="7640029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640035">if</span>&nbsp;<span class="ident" id="7640038">g</span><span class="op" id="7640039">,</span>&nbsp;<span class="ident" id="7640041">e</span>&nbsp;<span class="op" id="7640043">:=</span>&nbsp;<span class="ident" id="7640046">req</span><span class="op" id="7640049">.</span><span class="ident" id="7640050">Header</span><span class="op" id="7640056">.</span><span class="ident" id="7640057">Get</span><span class="op" id="7640060">(</span><span class="string" id="7640061">&#34;Foo-Bar&#34;</span><span class="op" id="7640070">)</span><span class="op" id="7640071">,</span>&nbsp;<span class="string" id="7640073">&#34;baz&#34;</span><span class="op" id="7640078">;</span>&nbsp;<span class="ident" id="7640080">e</span>&nbsp;<span class="op" id="7640082">!=</span>&nbsp;<span class="ident" id="7640085">g</span>&nbsp;<span class="op" id="7640087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640091">t</span><span class="op" id="7640092">.</span><span class="ident" id="7640093">Errorf</span><span class="op" id="7640099">(</span><span class="string" id="7640100">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7640129">,</span>&nbsp;<span class="ident" id="7640131">e</span><span class="op" id="7640132">,</span>&nbsp;<span class="ident" id="7640134">g</span><span class="op" id="7640135">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640141">if</span>&nbsp;<span class="ident" id="7640144">g</span><span class="op" id="7640145">,</span>&nbsp;<span class="ident" id="7640147">e</span>&nbsp;<span class="op" id="7640149">:=</span>&nbsp;<span class="ident" id="7640152">req</span><span class="op" id="7640155">.</span><span class="ident" id="7640156">URL</span><span class="op" id="7640159">.</span><span class="ident" id="7640160">String</span><span class="op" id="7640166">(</span><span class="op" id="7640167">)</span><span class="op" id="7640168">,</span>&nbsp;<span class="string" id="7640170">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="7640199">;</span>&nbsp;<span class="ident" id="7640201">e</span>&nbsp;<span class="op" id="7640203">!=</span>&nbsp;<span class="ident" id="7640206">g</span>&nbsp;<span class="op" id="7640208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640212">t</span><span class="op" id="7640213">.</span><span class="ident" id="7640214">Errorf</span><span class="op" id="7640220">(</span><span class="string" id="7640221">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7640246">,</span>&nbsp;<span class="ident" id="7640248">e</span><span class="op" id="7640249">,</span>&nbsp;<span class="ident" id="7640251">g</span><span class="op" id="7640252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640258">if</span>&nbsp;<span class="ident" id="7640261">g</span><span class="op" id="7640262">,</span>&nbsp;<span class="ident" id="7640264">e</span>&nbsp;<span class="op" id="7640266">:=</span>&nbsp;<span class="ident" id="7640269">req</span><span class="op" id="7640272">.</span><span class="ident" id="7640273">FormValue</span><span class="op" id="7640282">(</span><span class="string" id="7640283">&#34;a&#34;</span><span class="op" id="7640286">)</span><span class="op" id="7640287">,</span>&nbsp;<span class="string" id="7640289">&#34;b&#34;</span><span class="op" id="7640292">;</span>&nbsp;<span class="ident" id="7640294">e</span>&nbsp;<span class="op" id="7640296">!=</span>&nbsp;<span class="ident" id="7640299">g</span>&nbsp;<span class="op" id="7640301">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640305">t</span><span class="op" id="7640306">.</span><span class="ident" id="7640307">Errorf</span><span class="op" id="7640313">(</span><span class="string" id="7640314">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7640348">,</span>&nbsp;<span class="ident" id="7640350">e</span><span class="op" id="7640351">,</span>&nbsp;<span class="ident" id="7640353">g</span><span class="op" id="7640354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640360">if</span>&nbsp;<span class="ident" id="7640363">req</span><span class="op" id="7640366">.</span><span class="ident" id="7640367">Trailer</span>&nbsp;<span class="op" id="7640375">==</span>&nbsp;<span class="ident" id="7640378">nil</span>&nbsp;<span class="op" id="7640382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640386">t</span><span class="op" id="7640387">.</span><span class="ident" id="7640388">Errorf</span><span class="op" id="7640394">(</span><span class="string" id="7640395">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="7640419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640422">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640425">if</span>&nbsp;<span class="ident" id="7640428">req</span><span class="op" id="7640431">.</span><span class="ident" id="7640432">TLS</span>&nbsp;<span class="op" id="7640436">!=</span>&nbsp;<span class="ident" id="7640439">nil</span>&nbsp;<span class="op" id="7640443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640447">t</span><span class="op" id="7640448">.</span><span class="ident" id="7640449">Errorf</span><span class="op" id="7640455">(</span><span class="string" id="7640456">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="7640474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640480">if</span>&nbsp;<span class="ident" id="7640483">e</span><span class="op" id="7640484">,</span>&nbsp;<span class="ident" id="7640486">g</span>&nbsp;<span class="op" id="7640488">:=</span>&nbsp;<span class="string" id="7640491">&#34;5.6.7.8:0&#34;</span><span class="op" id="7640502">,</span>&nbsp;<span class="ident" id="7640504">req</span><span class="op" id="7640507">.</span><span class="ident" id="7640508">RemoteAddr</span><span class="op" id="7640518">;</span>&nbsp;<span class="ident" id="7640520">e</span>&nbsp;<span class="op" id="7640522">!=</span>&nbsp;<span class="ident" id="7640525">g</span>&nbsp;<span class="op" id="7640527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640531">t</span><span class="op" id="7640532">.</span><span class="ident" id="7640533">Errorf</span><span class="op" id="7640539">(</span><span class="string" id="7640540">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7640569">,</span>&nbsp;<span class="ident" id="7640571">g</span><span class="op" id="7640572">,</span>&nbsp;<span class="ident" id="7640574">e</span><span class="op" id="7640575">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640578">}</span><br>
<span class="lineno"></span><span class="op" id="7640580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7640583">func</span>&nbsp;<span class="ident" id="7640588">TestRequestWithTLS</span><span class="op" id="7640606">(</span><span class="ident" id="7640607">t</span>&nbsp;<span class="op" id="7640609">*</span><span class="ident" id="7640610">testing</span><span class="op" id="7640617">.</span><span class="ident" id="7640618">T</span><span class="op" id="7640619">)</span>&nbsp;<span class="op" id="7640621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640624">env</span>&nbsp;<span class="op" id="7640628">:=</span>&nbsp;<span class="keyword" id="7640631">map</span><span class="op" id="7640634">[</span><span class="builtintype" id="7640635">string</span><span class="op" id="7640641">]</span><span class="builtintype" id="7640642">string</span><span class="op" id="7640648">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640652">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7640669">:</span>&nbsp;<span class="string" id="7640671">&#34;HTTP/1.1&#34;</span><span class="op" id="7640681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640685">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7640701">:</span>&nbsp;&nbsp;<span class="string" id="7640704">&#34;GET&#34;</span><span class="op" id="7640709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640713">&#34;HTTP_HOST&#34;</span><span class="op" id="7640724">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640732">&#34;example.com&#34;</span><span class="op" id="7640745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640749">&#34;HTTP_REFERER&#34;</span><span class="op" id="7640763">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640768">&#34;elsewhere&#34;</span><span class="op" id="7640779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640783">&#34;REQUEST_URI&#34;</span><span class="op" id="7640796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640802">&#34;/path?a=b&#34;</span><span class="op" id="7640813">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640817">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7640831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640836">&#34;text/xml&#34;</span><span class="op" id="7640846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640850">&#34;HTTPS&#34;</span><span class="op" id="7640857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640869">&#34;1&#34;</span><span class="op" id="7640872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7640876">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7640889">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7640895">&#34;5.6.7.8&#34;</span><span class="op" id="7640904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640910">req</span><span class="op" id="7640913">,</span>&nbsp;<span class="ident" id="7640915">err</span>&nbsp;<span class="op" id="7640919">:=</span>&nbsp;<span class="ident" id="7640922">RequestFromMap</span><span class="op" id="7640936">(</span><span class="ident" id="7640937">env</span><span class="op" id="7640940">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640943">if</span>&nbsp;<span class="ident" id="7640946">err</span>&nbsp;<span class="op" id="7640950">!=</span>&nbsp;<span class="ident" id="7640953">nil</span>&nbsp;<span class="op" id="7640957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640961">t</span><span class="op" id="7640962">.</span><span class="ident" id="7640963">Fatalf</span><span class="op" id="7640969">(</span><span class="string" id="7640970">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7640990">,</span>&nbsp;<span class="ident" id="7640992">err</span><span class="op" id="7640995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641001">if</span>&nbsp;<span class="ident" id="7641004">g</span><span class="op" id="7641005">,</span>&nbsp;<span class="ident" id="7641007">e</span>&nbsp;<span class="op" id="7641009">:=</span>&nbsp;<span class="ident" id="7641012">req</span><span class="op" id="7641015">.</span><span class="ident" id="7641016">URL</span><span class="op" id="7641019">.</span><span class="ident" id="7641020">String</span><span class="op" id="7641026">(</span><span class="op" id="7641027">)</span><span class="op" id="7641028">,</span>&nbsp;<span class="string" id="7641030">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="7641060">;</span>&nbsp;<span class="ident" id="7641062">e</span>&nbsp;<span class="op" id="7641064">!=</span>&nbsp;<span class="ident" id="7641067">g</span>&nbsp;<span class="op" id="7641069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641073">t</span><span class="op" id="7641074">.</span><span class="ident" id="7641075">Errorf</span><span class="op" id="7641081">(</span><span class="string" id="7641082">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7641107">,</span>&nbsp;<span class="ident" id="7641109">e</span><span class="op" id="7641110">,</span>&nbsp;<span class="ident" id="7641112">g</span><span class="op" id="7641113">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641119">if</span>&nbsp;<span class="ident" id="7641122">req</span><span class="op" id="7641125">.</span><span class="ident" id="7641126">TLS</span>&nbsp;<span class="op" id="7641130">==</span>&nbsp;<span class="ident" id="7641133">nil</span>&nbsp;<span class="op" id="7641137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641141">t</span><span class="op" id="7641142">.</span><span class="ident" id="7641143">Errorf</span><span class="op" id="7641149">(</span><span class="string" id="7641150">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="7641172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641175">}</span><br>
<span class="lineno"></span><span class="op" id="7641177">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7641180">func</span>&nbsp;<span class="ident" id="7641185">TestRequestWithoutHost</span><span class="op" id="7641207">(</span><span class="ident" id="7641208">t</span>&nbsp;<span class="op" id="7641210">*</span><span class="ident" id="7641211">testing</span><span class="op" id="7641218">.</span><span class="ident" id="7641219">T</span><span class="op" id="7641220">)</span>&nbsp;<span class="op" id="7641222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641225">env</span>&nbsp;<span class="op" id="7641229">:=</span>&nbsp;<span class="keyword" id="7641232">map</span><span class="op" id="7641235">[</span><span class="builtintype" id="7641236">string</span><span class="op" id="7641242">]</span><span class="builtintype" id="7641243">string</span><span class="op" id="7641249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641253">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7641270">:</span>&nbsp;<span class="string" id="7641272">&#34;HTTP/1.1&#34;</span><span class="op" id="7641282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641286">&#34;HTTP_HOST&#34;</span><span class="op" id="7641297">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641305">&#34;&#34;</span><span class="op" id="7641307">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641311">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7641327">:</span>&nbsp;&nbsp;<span class="string" id="7641330">&#34;GET&#34;</span><span class="op" id="7641335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641339">&#34;REQUEST_URI&#34;</span><span class="op" id="7641352">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641358">&#34;/path?a=b&#34;</span><span class="op" id="7641369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641373">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7641389">:</span>&nbsp;&nbsp;<span class="string" id="7641392">&#34;123&#34;</span><span class="op" id="7641397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641403">req</span><span class="op" id="7641406">,</span>&nbsp;<span class="ident" id="7641408">err</span>&nbsp;<span class="op" id="7641412">:=</span>&nbsp;<span class="ident" id="7641415">RequestFromMap</span><span class="op" id="7641429">(</span><span class="ident" id="7641430">env</span><span class="op" id="7641433">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641436">if</span>&nbsp;<span class="ident" id="7641439">err</span>&nbsp;<span class="op" id="7641443">!=</span>&nbsp;<span class="ident" id="7641446">nil</span>&nbsp;<span class="op" id="7641450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641454">t</span><span class="op" id="7641455">.</span><span class="ident" id="7641456">Fatalf</span><span class="op" id="7641462">(</span><span class="string" id="7641463">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7641483">,</span>&nbsp;<span class="ident" id="7641485">err</span><span class="op" id="7641488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641494">if</span>&nbsp;<span class="ident" id="7641497">req</span><span class="op" id="7641500">.</span><span class="ident" id="7641501">URL</span>&nbsp;<span class="op" id="7641505">==</span>&nbsp;<span class="ident" id="7641508">nil</span>&nbsp;<span class="op" id="7641512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641516">t</span><span class="op" id="7641517">.</span><span class="ident" id="7641518">Fatalf</span><span class="op" id="7641524">(</span><span class="string" id="7641525">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7641545">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641551">if</span>&nbsp;<span class="ident" id="7641554">g</span><span class="op" id="7641555">,</span>&nbsp;<span class="ident" id="7641557">e</span>&nbsp;<span class="op" id="7641559">:=</span>&nbsp;<span class="ident" id="7641562">req</span><span class="op" id="7641565">.</span><span class="ident" id="7641566">URL</span><span class="op" id="7641569">.</span><span class="ident" id="7641570">String</span><span class="op" id="7641576">(</span><span class="op" id="7641577">)</span><span class="op" id="7641578">,</span>&nbsp;<span class="string" id="7641580">&#34;/path?a=b&#34;</span><span class="op" id="7641591">;</span>&nbsp;<span class="ident" id="7641593">e</span>&nbsp;<span class="op" id="7641595">!=</span>&nbsp;<span class="ident" id="7641598">g</span>&nbsp;<span class="op" id="7641600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641604">t</span><span class="op" id="7641605">.</span><span class="ident" id="7641606">Errorf</span><span class="op" id="7641612">(</span><span class="string" id="7641613">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7641632">,</span>&nbsp;<span class="ident" id="7641634">g</span><span class="op" id="7641635">,</span>&nbsp;<span class="ident" id="7641637">e</span><span class="op" id="7641638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641641">}</span><br>
<span class="lineno"></span><span class="op" id="7641643">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="7641646">func</span>&nbsp;<span class="ident" id="7641651">TestRequestWithoutRequestURI</span><span class="op" id="7641679">(</span><span class="ident" id="7641680">t</span>&nbsp;<span class="op" id="7641682">*</span><span class="ident" id="7641683">testing</span><span class="op" id="7641690">.</span><span class="ident" id="7641691">T</span><span class="op" id="7641692">)</span>&nbsp;<span class="op" id="7641694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641697">env</span>&nbsp;<span class="op" id="7641701">:=</span>&nbsp;<span class="keyword" id="7641704">map</span><span class="op" id="7641707">[</span><span class="builtintype" id="7641708">string</span><span class="op" id="7641714">]</span><span class="builtintype" id="7641715">string</span><span class="op" id="7641721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641725">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7641742">:</span>&nbsp;<span class="string" id="7641744">&#34;HTTP/1.1&#34;</span><span class="op" id="7641754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641758">&#34;HTTP_HOST&#34;</span><span class="op" id="7641769">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641777">&#34;example.com&#34;</span><span class="op" id="7641790">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641794">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7641810">:</span>&nbsp;&nbsp;<span class="string" id="7641813">&#34;GET&#34;</span><span class="op" id="7641818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641822">&#34;SCRIPT_NAME&#34;</span><span class="op" id="7641835">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641841">&#34;/dir/scriptname&#34;</span><span class="op" id="7641858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641862">&#34;PATH_INFO&#34;</span><span class="op" id="7641873">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641881">&#34;/p1/p2&#34;</span><span class="op" id="7641889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641893">&#34;QUERY_STRING&#34;</span><span class="op" id="7641907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7641912">&#34;a=1&amp;b=2&#34;</span><span class="op" id="7641921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7641925">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7641941">:</span>&nbsp;&nbsp;<span class="string" id="7641944">&#34;123&#34;</span><span class="op" id="7641949">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641955">req</span><span class="op" id="7641958">,</span>&nbsp;<span class="ident" id="7641960">err</span>&nbsp;<span class="op" id="7641964">:=</span>&nbsp;<span class="ident" id="7641967">RequestFromMap</span><span class="op" id="7641981">(</span><span class="ident" id="7641982">env</span><span class="op" id="7641985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641988">if</span>&nbsp;<span class="ident" id="7641991">err</span>&nbsp;<span class="op" id="7641995">!=</span>&nbsp;<span class="ident" id="7641998">nil</span>&nbsp;<span class="op" id="7642002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642006">t</span><span class="op" id="7642007">.</span><span class="ident" id="7642008">Fatalf</span><span class="op" id="7642014">(</span><span class="string" id="7642015">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7642035">,</span>&nbsp;<span class="ident" id="7642037">err</span><span class="op" id="7642040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642043">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642046">if</span>&nbsp;<span class="ident" id="7642049">req</span><span class="op" id="7642052">.</span><span class="ident" id="7642053">URL</span>&nbsp;<span class="op" id="7642057">==</span>&nbsp;<span class="ident" id="7642060">nil</span>&nbsp;<span class="op" id="7642064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642068">t</span><span class="op" id="7642069">.</span><span class="ident" id="7642070">Fatalf</span><span class="op" id="7642076">(</span><span class="string" id="7642077">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7642097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642103">if</span>&nbsp;<span class="ident" id="7642106">g</span><span class="op" id="7642107">,</span>&nbsp;<span class="ident" id="7642109">e</span>&nbsp;<span class="op" id="7642111">:=</span>&nbsp;<span class="ident" id="7642114">req</span><span class="op" id="7642117">.</span><span class="ident" id="7642118">URL</span><span class="op" id="7642121">.</span><span class="ident" id="7642122">String</span><span class="op" id="7642128">(</span><span class="op" id="7642129">)</span><span class="op" id="7642130">,</span>&nbsp;<span class="string" id="7642132">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="7642181">;</span>&nbsp;<span class="ident" id="7642183">e</span>&nbsp;<span class="op" id="7642185">!=</span>&nbsp;<span class="ident" id="7642188">g</span>&nbsp;<span class="op" id="7642190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642194">t</span><span class="op" id="7642195">.</span><span class="ident" id="7642196">Errorf</span><span class="op" id="7642202">(</span><span class="string" id="7642203">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7642222">,</span>&nbsp;<span class="ident" id="7642224">g</span><span class="op" id="7642225">,</span>&nbsp;<span class="ident" id="7642227">e</span><span class="op" id="7642228">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642231">}</span><br>
<span class="lineno"></span><span class="op" id="7642233">}</span>
</div>
</body>
</html>
