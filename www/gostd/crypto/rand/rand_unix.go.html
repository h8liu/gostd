<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html" class="current">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3683694">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3683750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3683804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3683855">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;plan9&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3683931">//&nbsp;Unix&nbsp;cryptographically&nbsp;secure&nbsp;pseudorandom&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3683984">//&nbsp;generator.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3683999">package</span>&nbsp;<span class="ident" id="3684007">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3684013">import</span>&nbsp;<span class="op" id="3684020">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684023">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684032">&#34;crypto/aes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684046">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684063">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684069">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684075">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684086">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3684094">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3684101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3684104">const</span>&nbsp;<span class="ident" id="3684110">urandomDevice</span>&nbsp;<span class="op" id="3684124">=</span>&nbsp;<span class="string" id="3684126">&#34;/dev/urandom&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3684142">//&nbsp;Easy&nbsp;implementation:&nbsp;read&nbsp;from&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span><span class="comment" id="3684190">//&nbsp;This&nbsp;is&nbsp;sufficient&nbsp;on&nbsp;Linux,&nbsp;OS&nbsp;X,&nbsp;and&nbsp;FreeBSD.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3684242">func</span>&nbsp;<span class="ident" id="3684247">init</span><span class="op" id="3684251">(</span><span class="op" id="3684252">)</span>&nbsp;<span class="op" id="3684254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684257">if</span>&nbsp;<span class="ident" id="3684260">runtime</span><span class="op" id="3684267">.</span><span class="ident" id="3684268">GOOS</span>&nbsp;<span class="op" id="3684273">==</span>&nbsp;<span class="string" id="3684276">&#34;plan9&#34;</span>&nbsp;<span class="op" id="3684284">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684288">Reader</span>&nbsp;<span class="op" id="3684295">=</span>&nbsp;<span class="ident" id="3684297">newReader</span><span class="op" id="3684306">(</span><span class="ident" id="3684307">nil</span><span class="op" id="3684310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684313">}</span>&nbsp;<span class="keyword" id="3684315">else</span>&nbsp;<span class="op" id="3684320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684324">Reader</span>&nbsp;<span class="op" id="3684331">=</span>&nbsp;<span class="op" id="3684333">&amp;</span><span class="ident" id="3684334">devReader</span><span class="op" id="3684343">{</span><span class="ident" id="3684344">name</span><span class="op" id="3684348">:</span>&nbsp;<span class="ident" id="3684350">urandomDevice</span><span class="op" id="3684363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684366">}</span><br>
<span class="lineno"></span><span class="op" id="3684368">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3684371">//&nbsp;A&nbsp;devReader&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;reading&nbsp;the&nbsp;file&nbsp;named&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3684434">type</span>&nbsp;<span class="ident" id="3684439">devReader</span>&nbsp;<span class="keyword" id="3684449">struct</span>&nbsp;<span class="op" id="3684456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684459">name</span>&nbsp;<span class="builtintype" id="3684464">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684472">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684477">io</span><span class="op" id="3684479">.</span><span class="ident" id="3684480">Reader</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684488">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3684493">sync</span><span class="op" id="3684497">.</span><span class="ident" id="3684498">Mutex</span><br>
<span class="lineno"></span><span class="op" id="3684504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3684507">//&nbsp;altGetRandom&nbsp;if&nbsp;non-nil&nbsp;specifies&nbsp;an&nbsp;OS-specific&nbsp;function&nbsp;to&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="3684575">//&nbsp;urandom-style&nbsp;randomness.</span><br>
<span class="lineno">45</span><span class="keyword" id="3684604">var</span>&nbsp;<span class="ident" id="3684608">altGetRandom</span>&nbsp;<span class="keyword" id="3684621">func</span><span class="op" id="3684625">(</span><span class="op" id="3684626">[</span><span class="op" id="3684627">]</span><span class="builtintype" id="3684628">byte</span><span class="op" id="3684632">)</span>&nbsp;<span class="op" id="3684634">(</span><span class="ident" id="3684635">ok</span>&nbsp;<span class="builtintype" id="3684638">bool</span><span class="op" id="3684642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3684645">func</span>&nbsp;<span class="op" id="3684650">(</span><span class="ident" id="3684651">r</span>&nbsp;<span class="op" id="3684653">*</span><span class="ident" id="3684654">devReader</span><span class="op" id="3684663">)</span>&nbsp;<span class="ident" id="3684665">Read</span><span class="op" id="3684669">(</span><span class="ident" id="3684670">b</span>&nbsp;<span class="op" id="3684672">[</span><span class="op" id="3684673">]</span><span class="builtintype" id="3684674">byte</span><span class="op" id="3684678">)</span>&nbsp;<span class="op" id="3684680">(</span><span class="ident" id="3684681">n</span>&nbsp;<span class="builtintype" id="3684683">int</span><span class="op" id="3684686">,</span>&nbsp;<span class="ident" id="3684688">err</span>&nbsp;<span class="builtintype" id="3684692">error</span><span class="op" id="3684697">)</span>&nbsp;<span class="op" id="3684699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684702">if</span>&nbsp;<span class="ident" id="3684705">altGetRandom</span>&nbsp;<span class="op" id="3684718">!=</span>&nbsp;<span class="ident" id="3684721">nil</span>&nbsp;<span class="op" id="3684725">&amp;&amp;</span>&nbsp;<span class="ident" id="3684728">r</span><span class="op" id="3684729">.</span><span class="ident" id="3684730">name</span>&nbsp;<span class="op" id="3684735">==</span>&nbsp;<span class="ident" id="3684738">urandomDevice</span>&nbsp;<span class="op" id="3684752">&amp;&amp;</span>&nbsp;<span class="ident" id="3684755">altGetRandom</span><span class="op" id="3684767">(</span><span class="ident" id="3684768">b</span><span class="op" id="3684769">)</span>&nbsp;<span class="op" id="3684771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684775">return</span>&nbsp;<span class="builtinfunc" id="3684782">len</span><span class="op" id="3684785">(</span><span class="ident" id="3684786">b</span><span class="op" id="3684787">)</span><span class="op" id="3684788">,</span>&nbsp;<span class="ident" id="3684790">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684798">r</span><span class="op" id="3684799">.</span><span class="ident" id="3684800">mu</span><span class="op" id="3684802">.</span><span class="ident" id="3684803">Lock</span><span class="op" id="3684807">(</span><span class="op" id="3684808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684811">defer</span>&nbsp;<span class="ident" id="3684817">r</span><span class="op" id="3684818">.</span><span class="ident" id="3684819">mu</span><span class="op" id="3684821">.</span><span class="ident" id="3684822">Unlock</span><span class="op" id="3684828">(</span><span class="op" id="3684829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684832">if</span>&nbsp;<span class="ident" id="3684835">r</span><span class="op" id="3684836">.</span><span class="ident" id="3684837">f</span>&nbsp;<span class="op" id="3684839">==</span>&nbsp;<span class="ident" id="3684842">nil</span>&nbsp;<span class="op" id="3684846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684850">f</span><span class="op" id="3684851">,</span>&nbsp;<span class="ident" id="3684853">err</span>&nbsp;<span class="op" id="3684857">:=</span>&nbsp;<span class="ident" id="3684860">os</span><span class="op" id="3684862">.</span><span class="ident" id="3684863">Open</span><span class="op" id="3684867">(</span><span class="ident" id="3684868">r</span><span class="op" id="3684869">.</span><span class="ident" id="3684870">name</span><span class="op" id="3684874">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684878">if</span>&nbsp;<span class="ident" id="3684881">f</span>&nbsp;<span class="op" id="3684883">==</span>&nbsp;<span class="ident" id="3684886">nil</span>&nbsp;<span class="op" id="3684890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684895">return</span>&nbsp;<span class="num" id="3684902">0</span><span class="op" id="3684903">,</span>&nbsp;<span class="ident" id="3684905">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3684915">if</span>&nbsp;<span class="ident" id="3684918">runtime</span><span class="op" id="3684925">.</span><span class="ident" id="3684926">GOOS</span>&nbsp;<span class="op" id="3684931">==</span>&nbsp;<span class="string" id="3684934">&#34;plan9&#34;</span>&nbsp;<span class="op" id="3684942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684947">r</span><span class="op" id="3684948">.</span><span class="ident" id="3684949">f</span>&nbsp;<span class="op" id="3684951">=</span>&nbsp;<span class="ident" id="3684953">f</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684957">}</span>&nbsp;<span class="keyword" id="3684959">else</span>&nbsp;<span class="op" id="3684964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3684969">r</span><span class="op" id="3684970">.</span><span class="ident" id="3684971">f</span>&nbsp;<span class="op" id="3684973">=</span>&nbsp;<span class="ident" id="3684975">bufio</span><span class="op" id="3684980">.</span><span class="ident" id="3684981">NewReader</span><span class="op" id="3684990">(</span><span class="ident" id="3684991">f</span><span class="op" id="3684992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3684999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3685002">return</span>&nbsp;<span class="ident" id="3685009">r</span><span class="op" id="3685010">.</span><span class="ident" id="3685011">f</span><span class="op" id="3685012">.</span><span class="ident" id="3685013">Read</span><span class="op" id="3685017">(</span><span class="ident" id="3685018">b</span><span class="op" id="3685019">)</span><br>
<span class="lineno">65</span><span class="op" id="3685021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3685024">//&nbsp;Alternate&nbsp;pseudo-random&nbsp;implementation&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3685077">//&nbsp;systems&nbsp;without&nbsp;a&nbsp;reliable&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="3685122">//&nbsp;newReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;pseudorandom&nbsp;generator&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3685177">//&nbsp;seeds&nbsp;itself&nbsp;by&nbsp;reading&nbsp;from&nbsp;entropy.&nbsp;&nbsp;If&nbsp;entropy&nbsp;==&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3685238">//&nbsp;the&nbsp;generator&nbsp;seeds&nbsp;itself&nbsp;by&nbsp;reading&nbsp;from&nbsp;the&nbsp;system&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3685297">//&nbsp;random&nbsp;number&nbsp;generator,&nbsp;typically&nbsp;/dev/random.</span><br>
<span class="lineno"></span><span class="comment" id="3685348">//&nbsp;The&nbsp;Read&nbsp;method&nbsp;on&nbsp;the&nbsp;returned&nbsp;reader&nbsp;always&nbsp;returns</span><br>
<span class="lineno">75</span><span class="comment" id="3685405">//&nbsp;the&nbsp;full&nbsp;amount&nbsp;asked&nbsp;for,&nbsp;or&nbsp;else&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3685464">//</span><br>
<span class="lineno"></span><span class="comment" id="3685467">//&nbsp;The&nbsp;generator&nbsp;uses&nbsp;the&nbsp;X9.31&nbsp;algorithm&nbsp;with&nbsp;AES-128,</span><br>
<span class="lineno"></span><span class="comment" id="3685523">//&nbsp;reseeding&nbsp;after&nbsp;every&nbsp;1&nbsp;MB&nbsp;of&nbsp;generated&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3685572">func</span>&nbsp;<span class="ident" id="3685577">newReader</span><span class="op" id="3685586">(</span><span class="ident" id="3685587">entropy</span>&nbsp;<span class="ident" id="3685595">io</span><span class="op" id="3685597">.</span><span class="ident" id="3685598">Reader</span><span class="op" id="3685604">)</span>&nbsp;<span class="ident" id="3685606">io</span><span class="op" id="3685608">.</span><span class="ident" id="3685609">Reader</span>&nbsp;<span class="op" id="3685616">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3685619">if</span>&nbsp;<span class="ident" id="3685622">entropy</span>&nbsp;<span class="op" id="3685630">==</span>&nbsp;<span class="ident" id="3685633">nil</span>&nbsp;<span class="op" id="3685637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685641">entropy</span>&nbsp;<span class="op" id="3685649">=</span>&nbsp;<span class="op" id="3685651">&amp;</span><span class="ident" id="3685652">devReader</span><span class="op" id="3685661">{</span><span class="ident" id="3685662">name</span><span class="op" id="3685666">:</span>&nbsp;<span class="string" id="3685668">&#34;/dev/random&#34;</span><span class="op" id="3685681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3685684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3685687">return</span>&nbsp;<span class="op" id="3685694">&amp;</span><span class="ident" id="3685695">reader</span><span class="op" id="3685701">{</span><span class="ident" id="3685702">entropy</span><span class="op" id="3685709">:</span>&nbsp;<span class="ident" id="3685711">entropy</span><span class="op" id="3685718">}</span><br>
<span class="lineno"></span><span class="op" id="3685720">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3685723">type</span>&nbsp;<span class="ident" id="3685728">reader</span>&nbsp;<span class="keyword" id="3685735">struct</span>&nbsp;<span class="op" id="3685742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685745">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685766">sync</span><span class="op" id="3685770">.</span><span class="ident" id="3685771">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685778">budget</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3685799">int</span>&nbsp;<span class="comment" id="3685803">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;generated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685845">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685866">cipher</span><span class="op" id="3685872">.</span><span class="ident" id="3685873">Block</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685880">entropy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685901">io</span><span class="op" id="3685903">.</span><span class="ident" id="3685904">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3685912">time</span><span class="op" id="3685916">,</span>&nbsp;<span class="ident" id="3685918">seed</span><span class="op" id="3685922">,</span>&nbsp;<span class="ident" id="3685924">dst</span><span class="op" id="3685927">,</span>&nbsp;<span class="ident" id="3685929">key</span>&nbsp;<span class="op" id="3685933">[</span><span class="ident" id="3685934">aes</span><span class="op" id="3685937">.</span><span class="ident" id="3685938">BlockSize</span><span class="op" id="3685947">]</span><span class="builtintype" id="3685948">byte</span><br>
<span class="lineno"></span><span class="op" id="3685953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3685956">func</span>&nbsp;<span class="op" id="3685961">(</span><span class="ident" id="3685962">r</span>&nbsp;<span class="op" id="3685964">*</span><span class="ident" id="3685965">reader</span><span class="op" id="3685971">)</span>&nbsp;<span class="ident" id="3685973">Read</span><span class="op" id="3685977">(</span><span class="ident" id="3685978">b</span>&nbsp;<span class="op" id="3685980">[</span><span class="op" id="3685981">]</span><span class="builtintype" id="3685982">byte</span><span class="op" id="3685986">)</span>&nbsp;<span class="op" id="3685988">(</span><span class="ident" id="3685989">n</span>&nbsp;<span class="builtintype" id="3685991">int</span><span class="op" id="3685994">,</span>&nbsp;<span class="ident" id="3685996">err</span>&nbsp;<span class="builtintype" id="3686000">error</span><span class="op" id="3686005">)</span>&nbsp;<span class="op" id="3686007">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686010">r</span><span class="op" id="3686011">.</span><span class="ident" id="3686012">mu</span><span class="op" id="3686014">.</span><span class="ident" id="3686015">Lock</span><span class="op" id="3686019">(</span><span class="op" id="3686020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686023">defer</span>&nbsp;<span class="ident" id="3686029">r</span><span class="op" id="3686030">.</span><span class="ident" id="3686031">mu</span><span class="op" id="3686033">.</span><span class="ident" id="3686034">Unlock</span><span class="op" id="3686040">(</span><span class="op" id="3686041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686044">n</span>&nbsp;<span class="op" id="3686046">=</span>&nbsp;<span class="builtinfunc" id="3686048">len</span><span class="op" id="3686051">(</span><span class="ident" id="3686052">b</span><span class="op" id="3686053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686057">for</span>&nbsp;<span class="builtinfunc" id="3686061">len</span><span class="op" id="3686064">(</span><span class="ident" id="3686065">b</span><span class="op" id="3686066">)</span>&nbsp;<span class="op" id="3686068">&gt;</span>&nbsp;<span class="num" id="3686070">0</span>&nbsp;<span class="op" id="3686072">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686076">if</span>&nbsp;<span class="ident" id="3686079">r</span><span class="op" id="3686080">.</span><span class="ident" id="3686081">budget</span>&nbsp;<span class="op" id="3686088">==</span>&nbsp;<span class="num" id="3686091">0</span>&nbsp;<span class="op" id="3686093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686098">_</span><span class="op" id="3686099">,</span>&nbsp;<span class="ident" id="3686101">err</span>&nbsp;<span class="op" id="3686105">:=</span>&nbsp;<span class="ident" id="3686108">io</span><span class="op" id="3686110">.</span><span class="ident" id="3686111">ReadFull</span><span class="op" id="3686119">(</span><span class="ident" id="3686120">r</span><span class="op" id="3686121">.</span><span class="ident" id="3686122">entropy</span><span class="op" id="3686129">,</span>&nbsp;<span class="ident" id="3686131">r</span><span class="op" id="3686132">.</span><span class="ident" id="3686133">seed</span><span class="op" id="3686137">[</span><span class="num" id="3686138">0</span><span class="op" id="3686139">:</span><span class="op" id="3686140">]</span><span class="op" id="3686141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686146">if</span>&nbsp;<span class="ident" id="3686149">err</span>&nbsp;<span class="op" id="3686153">!=</span>&nbsp;<span class="ident" id="3686156">nil</span>&nbsp;<span class="op" id="3686160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686166">return</span>&nbsp;<span class="ident" id="3686173">n</span>&nbsp;<span class="op" id="3686175">-</span>&nbsp;<span class="builtinfunc" id="3686177">len</span><span class="op" id="3686180">(</span><span class="ident" id="3686181">b</span><span class="op" id="3686182">)</span><span class="op" id="3686183">,</span>&nbsp;<span class="ident" id="3686185">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3686192">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686197">_</span><span class="op" id="3686198">,</span>&nbsp;<span class="ident" id="3686200">err</span>&nbsp;<span class="op" id="3686204">=</span>&nbsp;<span class="ident" id="3686206">io</span><span class="op" id="3686208">.</span><span class="ident" id="3686209">ReadFull</span><span class="op" id="3686217">(</span><span class="ident" id="3686218">r</span><span class="op" id="3686219">.</span><span class="ident" id="3686220">entropy</span><span class="op" id="3686227">,</span>&nbsp;<span class="ident" id="3686229">r</span><span class="op" id="3686230">.</span><span class="ident" id="3686231">key</span><span class="op" id="3686234">[</span><span class="num" id="3686235">0</span><span class="op" id="3686236">:</span><span class="op" id="3686237">]</span><span class="op" id="3686238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686243">if</span>&nbsp;<span class="ident" id="3686246">err</span>&nbsp;<span class="op" id="3686250">!=</span>&nbsp;<span class="ident" id="3686253">nil</span>&nbsp;<span class="op" id="3686257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686263">return</span>&nbsp;<span class="ident" id="3686270">n</span>&nbsp;<span class="op" id="3686272">-</span>&nbsp;<span class="builtinfunc" id="3686274">len</span><span class="op" id="3686277">(</span><span class="ident" id="3686278">b</span><span class="op" id="3686279">)</span><span class="op" id="3686280">,</span>&nbsp;<span class="ident" id="3686282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3686289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686294">r</span><span class="op" id="3686295">.</span><span class="ident" id="3686296">cipher</span><span class="op" id="3686302">,</span>&nbsp;<span class="ident" id="3686304">err</span>&nbsp;<span class="op" id="3686308">=</span>&nbsp;<span class="ident" id="3686310">aes</span><span class="op" id="3686313">.</span><span class="ident" id="3686314">NewCipher</span><span class="op" id="3686323">(</span><span class="ident" id="3686324">r</span><span class="op" id="3686325">.</span><span class="ident" id="3686326">key</span><span class="op" id="3686329">[</span><span class="num" id="3686330">0</span><span class="op" id="3686331">:</span><span class="op" id="3686332">]</span><span class="op" id="3686333">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686338">if</span>&nbsp;<span class="ident" id="3686341">err</span>&nbsp;<span class="op" id="3686345">!=</span>&nbsp;<span class="ident" id="3686348">nil</span>&nbsp;<span class="op" id="3686352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686358">return</span>&nbsp;<span class="ident" id="3686365">n</span>&nbsp;<span class="op" id="3686367">-</span>&nbsp;<span class="builtinfunc" id="3686369">len</span><span class="op" id="3686372">(</span><span class="ident" id="3686373">b</span><span class="op" id="3686374">)</span><span class="op" id="3686375">,</span>&nbsp;<span class="ident" id="3686377">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3686384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686389">r</span><span class="op" id="3686390">.</span><span class="ident" id="3686391">budget</span>&nbsp;<span class="op" id="3686398">=</span>&nbsp;<span class="num" id="3686400">1</span>&nbsp;<span class="op" id="3686402">&lt;&lt;</span>&nbsp;<span class="num" id="3686405">20</span>&nbsp;<span class="comment" id="3686408">//&nbsp;reseed&nbsp;after&nbsp;generating&nbsp;1MB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3686441">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686445">r</span><span class="op" id="3686446">.</span><span class="ident" id="3686447">budget</span>&nbsp;<span class="op" id="3686454">-=</span>&nbsp;<span class="ident" id="3686457">aes</span><span class="op" id="3686460">.</span><span class="ident" id="3686461">BlockSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686474">//&nbsp;ANSI&nbsp;X9.31&nbsp;(==&nbsp;X9.17)&nbsp;algorithm,&nbsp;but&nbsp;using&nbsp;AES&nbsp;in&nbsp;place&nbsp;of&nbsp;3DES.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686544">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686549">//&nbsp;single&nbsp;block:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686568">//&nbsp;t&nbsp;=&nbsp;encrypt(time)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686591">//&nbsp;dst&nbsp;=&nbsp;encrypt(t^seed)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686618">//&nbsp;seed&nbsp;=&nbsp;encrypt(t^dst)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686645">ns</span>&nbsp;<span class="op" id="3686648">:=</span>&nbsp;<span class="ident" id="3686651">time</span><span class="op" id="3686655">.</span><span class="ident" id="3686656">Now</span><span class="op" id="3686659">(</span><span class="op" id="3686660">)</span><span class="op" id="3686661">.</span><span class="ident" id="3686662">UnixNano</span><span class="op" id="3686670">(</span><span class="op" id="3686671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686675">r</span><span class="op" id="3686676">.</span><span class="ident" id="3686677">time</span><span class="op" id="3686681">[</span><span class="num" id="3686682">0</span><span class="op" id="3686683">]</span>&nbsp;<span class="op" id="3686685">=</span>&nbsp;<span class="builtintype" id="3686687">byte</span><span class="op" id="3686691">(</span><span class="ident" id="3686692">ns</span>&nbsp;<span class="op" id="3686695">&gt;&gt;</span>&nbsp;<span class="num" id="3686698">56</span><span class="op" id="3686700">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686704">r</span><span class="op" id="3686705">.</span><span class="ident" id="3686706">time</span><span class="op" id="3686710">[</span><span class="num" id="3686711">1</span><span class="op" id="3686712">]</span>&nbsp;<span class="op" id="3686714">=</span>&nbsp;<span class="builtintype" id="3686716">byte</span><span class="op" id="3686720">(</span><span class="ident" id="3686721">ns</span>&nbsp;<span class="op" id="3686724">&gt;&gt;</span>&nbsp;<span class="num" id="3686727">48</span><span class="op" id="3686729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686733">r</span><span class="op" id="3686734">.</span><span class="ident" id="3686735">time</span><span class="op" id="3686739">[</span><span class="num" id="3686740">2</span><span class="op" id="3686741">]</span>&nbsp;<span class="op" id="3686743">=</span>&nbsp;<span class="builtintype" id="3686745">byte</span><span class="op" id="3686749">(</span><span class="ident" id="3686750">ns</span>&nbsp;<span class="op" id="3686753">&gt;&gt;</span>&nbsp;<span class="num" id="3686756">40</span><span class="op" id="3686758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686762">r</span><span class="op" id="3686763">.</span><span class="ident" id="3686764">time</span><span class="op" id="3686768">[</span><span class="num" id="3686769">3</span><span class="op" id="3686770">]</span>&nbsp;<span class="op" id="3686772">=</span>&nbsp;<span class="builtintype" id="3686774">byte</span><span class="op" id="3686778">(</span><span class="ident" id="3686779">ns</span>&nbsp;<span class="op" id="3686782">&gt;&gt;</span>&nbsp;<span class="num" id="3686785">32</span><span class="op" id="3686787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686791">r</span><span class="op" id="3686792">.</span><span class="ident" id="3686793">time</span><span class="op" id="3686797">[</span><span class="num" id="3686798">4</span><span class="op" id="3686799">]</span>&nbsp;<span class="op" id="3686801">=</span>&nbsp;<span class="builtintype" id="3686803">byte</span><span class="op" id="3686807">(</span><span class="ident" id="3686808">ns</span>&nbsp;<span class="op" id="3686811">&gt;&gt;</span>&nbsp;<span class="num" id="3686814">24</span><span class="op" id="3686816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686820">r</span><span class="op" id="3686821">.</span><span class="ident" id="3686822">time</span><span class="op" id="3686826">[</span><span class="num" id="3686827">5</span><span class="op" id="3686828">]</span>&nbsp;<span class="op" id="3686830">=</span>&nbsp;<span class="builtintype" id="3686832">byte</span><span class="op" id="3686836">(</span><span class="ident" id="3686837">ns</span>&nbsp;<span class="op" id="3686840">&gt;&gt;</span>&nbsp;<span class="num" id="3686843">16</span><span class="op" id="3686845">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686849">r</span><span class="op" id="3686850">.</span><span class="ident" id="3686851">time</span><span class="op" id="3686855">[</span><span class="num" id="3686856">6</span><span class="op" id="3686857">]</span>&nbsp;<span class="op" id="3686859">=</span>&nbsp;<span class="builtintype" id="3686861">byte</span><span class="op" id="3686865">(</span><span class="ident" id="3686866">ns</span>&nbsp;<span class="op" id="3686869">&gt;&gt;</span>&nbsp;<span class="num" id="3686872">8</span><span class="op" id="3686873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686877">r</span><span class="op" id="3686878">.</span><span class="ident" id="3686879">time</span><span class="op" id="3686883">[</span><span class="num" id="3686884">7</span><span class="op" id="3686885">]</span>&nbsp;<span class="op" id="3686887">=</span>&nbsp;<span class="builtintype" id="3686889">byte</span><span class="op" id="3686893">(</span><span class="ident" id="3686894">ns</span><span class="op" id="3686896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686900">r</span><span class="op" id="3686901">.</span><span class="ident" id="3686902">cipher</span><span class="op" id="3686908">.</span><span class="ident" id="3686909">Encrypt</span><span class="op" id="3686916">(</span><span class="ident" id="3686917">r</span><span class="op" id="3686918">.</span><span class="ident" id="3686919">time</span><span class="op" id="3686923">[</span><span class="num" id="3686924">0</span><span class="op" id="3686925">:</span><span class="op" id="3686926">]</span><span class="op" id="3686927">,</span>&nbsp;<span class="ident" id="3686929">r</span><span class="op" id="3686930">.</span><span class="ident" id="3686931">time</span><span class="op" id="3686935">[</span><span class="num" id="3686936">0</span><span class="op" id="3686937">:</span><span class="op" id="3686938">]</span><span class="op" id="3686939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3686943">for</span>&nbsp;<span class="ident" id="3686947">i</span>&nbsp;<span class="op" id="3686949">:=</span>&nbsp;<span class="num" id="3686952">0</span><span class="op" id="3686953">;</span>&nbsp;<span class="ident" id="3686955">i</span>&nbsp;<span class="op" id="3686957">&lt;</span>&nbsp;<span class="ident" id="3686959">aes</span><span class="op" id="3686962">.</span><span class="ident" id="3686963">BlockSize</span><span class="op" id="3686972">;</span>&nbsp;<span class="ident" id="3686974">i</span><span class="op" id="3686975">++</span>&nbsp;<span class="op" id="3686978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3686983">r</span><span class="op" id="3686984">.</span><span class="ident" id="3686985">dst</span><span class="op" id="3686988">[</span><span class="ident" id="3686989">i</span><span class="op" id="3686990">]</span>&nbsp;<span class="op" id="3686992">=</span>&nbsp;<span class="ident" id="3686994">r</span><span class="op" id="3686995">.</span><span class="ident" id="3686996">time</span><span class="op" id="3687000">[</span><span class="ident" id="3687001">i</span><span class="op" id="3687002">]</span>&nbsp;<span class="op" id="3687004">^</span>&nbsp;<span class="ident" id="3687006">r</span><span class="op" id="3687007">.</span><span class="ident" id="3687008">seed</span><span class="op" id="3687012">[</span><span class="ident" id="3687013">i</span><span class="op" id="3687014">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3687018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3687022">r</span><span class="op" id="3687023">.</span><span class="ident" id="3687024">cipher</span><span class="op" id="3687030">.</span><span class="ident" id="3687031">Encrypt</span><span class="op" id="3687038">(</span><span class="ident" id="3687039">r</span><span class="op" id="3687040">.</span><span class="ident" id="3687041">dst</span><span class="op" id="3687044">[</span><span class="num" id="3687045">0</span><span class="op" id="3687046">:</span><span class="op" id="3687047">]</span><span class="op" id="3687048">,</span>&nbsp;<span class="ident" id="3687050">r</span><span class="op" id="3687051">.</span><span class="ident" id="3687052">dst</span><span class="op" id="3687055">[</span><span class="num" id="3687056">0</span><span class="op" id="3687057">:</span><span class="op" id="3687058">]</span><span class="op" id="3687059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3687063">for</span>&nbsp;<span class="ident" id="3687067">i</span>&nbsp;<span class="op" id="3687069">:=</span>&nbsp;<span class="num" id="3687072">0</span><span class="op" id="3687073">;</span>&nbsp;<span class="ident" id="3687075">i</span>&nbsp;<span class="op" id="3687077">&lt;</span>&nbsp;<span class="ident" id="3687079">aes</span><span class="op" id="3687082">.</span><span class="ident" id="3687083">BlockSize</span><span class="op" id="3687092">;</span>&nbsp;<span class="ident" id="3687094">i</span><span class="op" id="3687095">++</span>&nbsp;<span class="op" id="3687098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3687103">r</span><span class="op" id="3687104">.</span><span class="ident" id="3687105">seed</span><span class="op" id="3687109">[</span><span class="ident" id="3687110">i</span><span class="op" id="3687111">]</span>&nbsp;<span class="op" id="3687113">=</span>&nbsp;<span class="ident" id="3687115">r</span><span class="op" id="3687116">.</span><span class="ident" id="3687117">time</span><span class="op" id="3687121">[</span><span class="ident" id="3687122">i</span><span class="op" id="3687123">]</span>&nbsp;<span class="op" id="3687125">^</span>&nbsp;<span class="ident" id="3687127">r</span><span class="op" id="3687128">.</span><span class="ident" id="3687129">dst</span><span class="op" id="3687132">[</span><span class="ident" id="3687133">i</span><span class="op" id="3687134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3687138">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3687142">r</span><span class="op" id="3687143">.</span><span class="ident" id="3687144">cipher</span><span class="op" id="3687150">.</span><span class="ident" id="3687151">Encrypt</span><span class="op" id="3687158">(</span><span class="ident" id="3687159">r</span><span class="op" id="3687160">.</span><span class="ident" id="3687161">seed</span><span class="op" id="3687165">[</span><span class="num" id="3687166">0</span><span class="op" id="3687167">:</span><span class="op" id="3687168">]</span><span class="op" id="3687169">,</span>&nbsp;<span class="ident" id="3687171">r</span><span class="op" id="3687172">.</span><span class="ident" id="3687173">seed</span><span class="op" id="3687177">[</span><span class="num" id="3687178">0</span><span class="op" id="3687179">:</span><span class="op" id="3687180">]</span><span class="op" id="3687181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3687186">m</span>&nbsp;<span class="op" id="3687188">:=</span>&nbsp;<span class="builtinfunc" id="3687191">copy</span><span class="op" id="3687195">(</span><span class="ident" id="3687196">b</span><span class="op" id="3687197">,</span>&nbsp;<span class="ident" id="3687199">r</span><span class="op" id="3687200">.</span><span class="ident" id="3687201">dst</span><span class="op" id="3687204">[</span><span class="num" id="3687205">0</span><span class="op" id="3687206">:</span><span class="op" id="3687207">]</span><span class="op" id="3687208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3687212">b</span>&nbsp;<span class="op" id="3687214">=</span>&nbsp;<span class="ident" id="3687216">b</span><span class="op" id="3687217">[</span><span class="ident" id="3687218">m</span><span class="op" id="3687219">:</span><span class="op" id="3687220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3687223">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3687227">return</span>&nbsp;<span class="ident" id="3687234">n</span><span class="op" id="3687235">,</span>&nbsp;<span class="ident" id="3687237">nil</span><br>
<span class="lineno"></span><span class="op" id="3687241">}</span>
</div>
</body>
</html>
