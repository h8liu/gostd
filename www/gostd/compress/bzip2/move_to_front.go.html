<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6389063">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6389118">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6389172">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6389223">package</span>&nbsp;<span class="ident" id="6389231">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389238">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6389311">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6389388">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="6389467">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6389546">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="6389624">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="6389703">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="6389777">type</span>&nbsp;<span class="ident" id="6389782">moveToFrontDecoder</span>&nbsp;<span class="op" id="6389801">[</span><span class="op" id="6389802">]</span><span class="builtintype" id="6389803">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6389809">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="6389888">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6389903">func</span>&nbsp;<span class="ident" id="6389908">newMTFDecoder</span><span class="op" id="6389921">(</span><span class="ident" id="6389922">symbols</span>&nbsp;<span class="op" id="6389930">[</span><span class="op" id="6389931">]</span><span class="builtintype" id="6389932">byte</span><span class="op" id="6389936">)</span>&nbsp;<span class="ident" id="6389938">moveToFrontDecoder</span>&nbsp;<span class="op" id="6389957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389960">if</span>&nbsp;<span class="builtinfunc" id="6389963">len</span><span class="op" id="6389966">(</span><span class="ident" id="6389967">symbols</span><span class="op" id="6389974">)</span>&nbsp;<span class="op" id="6389976">&gt;</span>&nbsp;<span class="num" id="6389978">256</span>&nbsp;<span class="op" id="6389982">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6389986">panic</span><span class="op" id="6389991">(</span><span class="string" id="6389992">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="6390010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390016">return</span>&nbsp;<span class="ident" id="6390023">moveToFrontDecoder</span><span class="op" id="6390041">(</span><span class="ident" id="6390042">symbols</span><span class="op" id="6390049">)</span><br>
<span class="lineno"></span><span class="op" id="6390051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6390054">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="6390128">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="6390155">func</span>&nbsp;<span class="ident" id="6390160">newMTFDecoderWithRange</span><span class="op" id="6390182">(</span><span class="ident" id="6390183">n</span>&nbsp;<span class="builtintype" id="6390185">int</span><span class="op" id="6390188">)</span>&nbsp;<span class="ident" id="6390190">moveToFrontDecoder</span>&nbsp;<span class="op" id="6390209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390212">if</span>&nbsp;<span class="ident" id="6390215">n</span>&nbsp;<span class="op" id="6390217">&gt;</span>&nbsp;<span class="num" id="6390219">256</span>&nbsp;<span class="op" id="6390223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6390227">panic</span><span class="op" id="6390232">(</span><span class="string" id="6390233">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="6390284">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390291">m</span>&nbsp;<span class="op" id="6390293">:=</span>&nbsp;<span class="builtinfunc" id="6390296">make</span><span class="op" id="6390300">(</span><span class="op" id="6390301">[</span><span class="op" id="6390302">]</span><span class="builtintype" id="6390303">byte</span><span class="op" id="6390307">,</span>&nbsp;<span class="ident" id="6390309">n</span><span class="op" id="6390310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390313">for</span>&nbsp;<span class="ident" id="6390317">i</span>&nbsp;<span class="op" id="6390319">:=</span>&nbsp;<span class="num" id="6390322">0</span><span class="op" id="6390323">;</span>&nbsp;<span class="ident" id="6390325">i</span>&nbsp;<span class="op" id="6390327">&lt;</span>&nbsp;<span class="ident" id="6390329">n</span><span class="op" id="6390330">;</span>&nbsp;<span class="ident" id="6390332">i</span><span class="op" id="6390333">++</span>&nbsp;<span class="op" id="6390336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390340">m</span><span class="op" id="6390341">[</span><span class="ident" id="6390342">i</span><span class="op" id="6390343">]</span>&nbsp;<span class="op" id="6390345">=</span>&nbsp;<span class="builtintype" id="6390347">byte</span><span class="op" id="6390351">(</span><span class="ident" id="6390352">i</span><span class="op" id="6390353">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390359">return</span>&nbsp;<span class="ident" id="6390366">moveToFrontDecoder</span><span class="op" id="6390384">(</span><span class="ident" id="6390385">m</span><span class="op" id="6390386">)</span><br>
<span class="lineno"></span><span class="op" id="6390388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6390391">func</span>&nbsp;<span class="op" id="6390396">(</span><span class="ident" id="6390397">m</span>&nbsp;<span class="ident" id="6390399">moveToFrontDecoder</span><span class="op" id="6390417">)</span>&nbsp;<span class="ident" id="6390419">Decode</span><span class="op" id="6390425">(</span><span class="ident" id="6390426">n</span>&nbsp;<span class="builtintype" id="6390428">int</span><span class="op" id="6390431">)</span>&nbsp;<span class="op" id="6390433">(</span><span class="ident" id="6390434">b</span>&nbsp;<span class="builtintype" id="6390436">byte</span><span class="op" id="6390440">)</span>&nbsp;<span class="op" id="6390442">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390445">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390507">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390573">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390631">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390698">b</span>&nbsp;<span class="op" id="6390700">=</span>&nbsp;<span class="ident" id="6390702">m</span><span class="op" id="6390703">[</span><span class="ident" id="6390704">n</span><span class="op" id="6390705">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6390708">copy</span><span class="op" id="6390712">(</span><span class="ident" id="6390713">m</span><span class="op" id="6390714">[</span><span class="num" id="6390715">1</span><span class="op" id="6390716">:</span><span class="op" id="6390717">]</span><span class="op" id="6390718">,</span>&nbsp;<span class="ident" id="6390720">m</span><span class="op" id="6390721">[</span><span class="op" id="6390722">:</span><span class="ident" id="6390723">n</span><span class="op" id="6390724">]</span><span class="op" id="6390725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390728">m</span><span class="op" id="6390729">[</span><span class="num" id="6390730">0</span><span class="op" id="6390731">]</span>&nbsp;<span class="op" id="6390733">=</span>&nbsp;<span class="ident" id="6390735">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390738">return</span><br>
<span class="lineno"></span><span class="op" id="6390745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6390748">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6390802">func</span>&nbsp;<span class="op" id="6390807">(</span><span class="ident" id="6390808">m</span>&nbsp;<span class="ident" id="6390810">moveToFrontDecoder</span><span class="op" id="6390828">)</span>&nbsp;<span class="ident" id="6390830">First</span><span class="op" id="6390835">(</span><span class="op" id="6390836">)</span>&nbsp;<span class="builtintype" id="6390838">byte</span>&nbsp;<span class="op" id="6390843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390846">return</span>&nbsp;<span class="ident" id="6390853">m</span><span class="op" id="6390854">[</span><span class="num" id="6390855">0</span><span class="op" id="6390856">]</span><br>
<span class="lineno"></span><span class="op" id="6390858">}</span>
</div>
</body>
</html>
