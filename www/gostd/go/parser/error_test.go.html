<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html" class="current">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6633016">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6633071">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6633125">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6633176">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="6633249">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6633322">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6633395">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="6633465">//</span><br>
<span class="lineno">10</span><span class="comment" id="6633468">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6633540">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6633614">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="6633687">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6633730">//</span><br>
<span class="lineno">15</span><span class="comment" id="6633733">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6633806">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="6633865">//</span><br>
<span class="lineno"></span><span class="comment" id="6633868">//&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="6633881">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="6633895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="6633936">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6633942">package</span>&nbsp;<span class="ident" id="6633950">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6633958">import</span>&nbsp;<span class="op" id="6633965">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6633968">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6633982">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6633994">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6634007">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6634024">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6634034">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6634045">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6634055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="6634058">const</span>&nbsp;<span class="ident" id="6634064">testdata</span>&nbsp;<span class="op" id="6634073">=</span>&nbsp;<span class="string" id="6634075">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6634087">var</span>&nbsp;<span class="ident" id="6634091">fsetErrs</span>&nbsp;<span class="op" id="6634100">=</span>&nbsp;<span class="ident" id="6634102">token</span><span class="op" id="6634107">.</span><span class="ident" id="6634108">NewFileSet</span><span class="op" id="6634118">(</span><span class="op" id="6634119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6634122">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="6634180">func</span>&nbsp;<span class="ident" id="6634185">getFile</span><span class="op" id="6634192">(</span><span class="ident" id="6634193">filename</span>&nbsp;<span class="builtintype" id="6634202">string</span><span class="op" id="6634208">)</span>&nbsp;<span class="op" id="6634210">(</span><span class="ident" id="6634211">file</span>&nbsp;<span class="op" id="6634216">*</span><span class="ident" id="6634217">token</span><span class="op" id="6634222">.</span><span class="ident" id="6634223">File</span><span class="op" id="6634227">)</span>&nbsp;<span class="op" id="6634229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634232">fsetErrs</span><span class="op" id="6634240">.</span><span class="ident" id="6634241">Iterate</span><span class="op" id="6634248">(</span><span class="keyword" id="6634249">func</span><span class="op" id="6634253">(</span><span class="ident" id="6634254">f</span>&nbsp;<span class="op" id="6634256">*</span><span class="ident" id="6634257">token</span><span class="op" id="6634262">.</span><span class="ident" id="6634263">File</span><span class="op" id="6634267">)</span>&nbsp;<span class="builtintype" id="6634269">bool</span>&nbsp;<span class="op" id="6634274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634278">if</span>&nbsp;<span class="ident" id="6634281">f</span><span class="op" id="6634282">.</span><span class="ident" id="6634283">Name</span><span class="op" id="6634287">(</span><span class="op" id="6634288">)</span>&nbsp;<span class="op" id="6634290">==</span>&nbsp;<span class="ident" id="6634293">filename</span>&nbsp;<span class="op" id="6634302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634307">if</span>&nbsp;<span class="ident" id="6634310">file</span>&nbsp;<span class="op" id="6634315">!=</span>&nbsp;<span class="builtintype" id="6634318">nil</span>&nbsp;<span class="op" id="6634322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6634328">panic</span><span class="op" id="6634333">(</span><span class="ident" id="6634334">filename</span>&nbsp;<span class="op" id="6634343">+</span>&nbsp;<span class="string" id="6634345">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="6634367">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6634377">file</span>&nbsp;<span class="op" id="6634382">=</span>&nbsp;<span class="ident" id="6634384">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634392">return</span>&nbsp;<span class="builtintype" id="6634399">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634405">}</span><span class="op" id="6634406">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634409">return</span>&nbsp;<span class="ident" id="6634416">file</span><br>
<span class="lineno"></span><span class="op" id="6634421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6634424">func</span>&nbsp;<span class="ident" id="6634429">getPos</span><span class="op" id="6634435">(</span><span class="ident" id="6634436">filename</span>&nbsp;<span class="builtintype" id="6634445">string</span><span class="op" id="6634451">,</span>&nbsp;<span class="ident" id="6634453">offset</span>&nbsp;<span class="builtintype" id="6634460">int</span><span class="op" id="6634463">)</span>&nbsp;<span class="ident" id="6634465">token</span><span class="op" id="6634470">.</span><span class="ident" id="6634471">Pos</span>&nbsp;<span class="op" id="6634475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634478">if</span>&nbsp;<span class="ident" id="6634481">f</span>&nbsp;<span class="op" id="6634483">:=</span>&nbsp;<span class="ident" id="6634486">getFile</span><span class="op" id="6634493">(</span><span class="ident" id="6634494">filename</span><span class="op" id="6634502">)</span><span class="op" id="6634503">;</span>&nbsp;<span class="ident" id="6634505">f</span>&nbsp;<span class="op" id="6634507">!=</span>&nbsp;<span class="builtintype" id="6634510">nil</span>&nbsp;<span class="op" id="6634514">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634518">return</span>&nbsp;<span class="ident" id="6634525">f</span><span class="op" id="6634526">.</span><span class="ident" id="6634527">Pos</span><span class="op" id="6634530">(</span><span class="ident" id="6634531">offset</span><span class="op" id="6634537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6634540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6634543">return</span>&nbsp;<span class="ident" id="6634550">token</span><span class="op" id="6634555">.</span><span class="ident" id="6634556">NoPos</span><br>
<span class="lineno"></span><span class="op" id="6634562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6634565">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6634630">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="6634695">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6634760">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="6634826">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="6634849">//</span><br>
<span class="lineno"></span><span class="keyword" id="6634852">var</span>&nbsp;<span class="ident" id="6634856">errRx</span>&nbsp;<span class="op" id="6634862">=</span>&nbsp;<span class="ident" id="6634864">regexp</span><span class="op" id="6634870">.</span><span class="ident" id="6634871">MustCompile</span><span class="op" id="6634882">(</span><span class="string" id="6634883">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="6634922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6634925">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6635000">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="6635076">//</span><br>
<span class="lineno"></span><span class="keyword" id="6635079">func</span>&nbsp;<span class="ident" id="6635084">expectedErrors</span><span class="op" id="6635098">(</span><span class="ident" id="6635099">t</span>&nbsp;<span class="op" id="6635101">*</span><span class="ident" id="6635102">testing</span><span class="op" id="6635109">.</span><span class="ident" id="6635110">T</span><span class="op" id="6635111">,</span>&nbsp;<span class="ident" id="6635113">filename</span>&nbsp;<span class="builtintype" id="6635122">string</span><span class="op" id="6635128">,</span>&nbsp;<span class="ident" id="6635130">src</span>&nbsp;<span class="op" id="6635134">[</span><span class="op" id="6635135">]</span><span class="builtintype" id="6635136">byte</span><span class="op" id="6635140">)</span>&nbsp;<span class="keyword" id="6635142">map</span><span class="op" id="6635145">[</span><span class="ident" id="6635146">token</span><span class="op" id="6635151">.</span><span class="ident" id="6635152">Pos</span><span class="op" id="6635155">]</span><span class="builtintype" id="6635156">string</span>&nbsp;<span class="op" id="6635163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635166">errors</span>&nbsp;<span class="op" id="6635173">:=</span>&nbsp;<span class="builtinfunc" id="6635176">make</span><span class="op" id="6635180">(</span><span class="keyword" id="6635181">map</span><span class="op" id="6635184">[</span><span class="ident" id="6635185">token</span><span class="op" id="6635190">.</span><span class="ident" id="6635191">Pos</span><span class="op" id="6635194">]</span><span class="builtintype" id="6635195">string</span><span class="op" id="6635201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635205">var</span>&nbsp;<span class="ident" id="6635209">s</span>&nbsp;<span class="ident" id="6635211">scanner</span><span class="op" id="6635218">.</span><span class="ident" id="6635219">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6635228">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6635290">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6635352">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635415">s</span><span class="op" id="6635416">.</span><span class="ident" id="6635417">Init</span><span class="op" id="6635421">(</span><span class="ident" id="6635422">getFile</span><span class="op" id="6635429">(</span><span class="ident" id="6635430">filename</span><span class="op" id="6635438">)</span><span class="op" id="6635439">,</span>&nbsp;<span class="ident" id="6635441">src</span><span class="op" id="6635444">,</span>&nbsp;<span class="builtintype" id="6635446">nil</span><span class="op" id="6635449">,</span>&nbsp;<span class="ident" id="6635451">scanner</span><span class="op" id="6635458">.</span><span class="ident" id="6635459">ScanComments</span><span class="op" id="6635471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635474">var</span>&nbsp;<span class="ident" id="6635478">prev</span>&nbsp;<span class="ident" id="6635483">token</span><span class="op" id="6635488">.</span><span class="ident" id="6635489">Pos</span>&nbsp;<span class="comment" id="6635493">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635547">var</span>&nbsp;<span class="ident" id="6635551">here</span>&nbsp;<span class="ident" id="6635556">token</span><span class="op" id="6635561">.</span><span class="ident" id="6635562">Pos</span>&nbsp;<span class="comment" id="6635566">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635625">for</span>&nbsp;<span class="op" id="6635629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635633">pos</span><span class="op" id="6635636">,</span>&nbsp;<span class="ident" id="6635638">tok</span><span class="op" id="6635641">,</span>&nbsp;<span class="ident" id="6635643">lit</span>&nbsp;<span class="op" id="6635647">:=</span>&nbsp;<span class="ident" id="6635650">s</span><span class="op" id="6635651">.</span><span class="ident" id="6635652">Scan</span><span class="op" id="6635656">(</span><span class="op" id="6635657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635661">switch</span>&nbsp;<span class="ident" id="6635668">tok</span>&nbsp;<span class="op" id="6635672">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635676">case</span>&nbsp;<span class="ident" id="6635681">token</span><span class="op" id="6635686">.</span><span class="ident" id="6635687">EOF</span><span class="op" id="6635690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635695">return</span>&nbsp;<span class="ident" id="6635702">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635711">case</span>&nbsp;<span class="ident" id="6635716">token</span><span class="op" id="6635721">.</span><span class="ident" id="6635722">COMMENT</span><span class="op" id="6635729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635734">s</span>&nbsp;<span class="op" id="6635736">:=</span>&nbsp;<span class="ident" id="6635739">errRx</span><span class="op" id="6635744">.</span><span class="ident" id="6635745">FindStringSubmatch</span><span class="op" id="6635763">(</span><span class="ident" id="6635764">lit</span><span class="op" id="6635767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635772">if</span>&nbsp;<span class="builtinfunc" id="6635775">len</span><span class="op" id="6635778">(</span><span class="ident" id="6635779">s</span><span class="op" id="6635780">)</span>&nbsp;<span class="op" id="6635782">==</span>&nbsp;<span class="num" id="6635785">3</span>&nbsp;<span class="op" id="6635787">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635793">pos</span>&nbsp;<span class="op" id="6635797">:=</span>&nbsp;<span class="ident" id="6635800">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635809">if</span>&nbsp;<span class="ident" id="6635812">s</span><span class="op" id="6635813">[</span><span class="num" id="6635814">1</span><span class="op" id="6635815">]</span>&nbsp;<span class="op" id="6635817">==</span>&nbsp;<span class="string" id="6635820">&#34;HERE&#34;</span>&nbsp;<span class="op" id="6635827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635834">pos</span>&nbsp;<span class="op" id="6635838">=</span>&nbsp;<span class="ident" id="6635840">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6635849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635855">errors</span><span class="op" id="6635861">[</span><span class="ident" id="6635862">pos</span><span class="op" id="6635865">]</span>&nbsp;<span class="op" id="6635867">=</span>&nbsp;<span class="builtintype" id="6635869">string</span><span class="op" id="6635875">(</span><span class="ident" id="6635876">s</span><span class="op" id="6635877">[</span><span class="num" id="6635878">2</span><span class="op" id="6635879">]</span><span class="op" id="6635880">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6635885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635889">default</span><span class="op" id="6635896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635901">prev</span>&nbsp;<span class="op" id="6635906">=</span>&nbsp;<span class="ident" id="6635908">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635915">var</span>&nbsp;<span class="ident" id="6635919">l</span>&nbsp;<span class="builtintype" id="6635921">int</span>&nbsp;<span class="comment" id="6635925">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6635944">if</span>&nbsp;<span class="ident" id="6635947">tok</span><span class="op" id="6635950">.</span><span class="ident" id="6635951">IsLiteral</span><span class="op" id="6635960">(</span><span class="op" id="6635961">)</span>&nbsp;<span class="op" id="6635963">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635969">l</span>&nbsp;<span class="op" id="6635971">=</span>&nbsp;<span class="builtinfunc" id="6635973">len</span><span class="op" id="6635976">(</span><span class="ident" id="6635977">lit</span><span class="op" id="6635980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6635985">}</span>&nbsp;<span class="keyword" id="6635987">else</span>&nbsp;<span class="op" id="6635992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6635998">l</span>&nbsp;<span class="op" id="6636000">=</span>&nbsp;<span class="builtinfunc" id="6636002">len</span><span class="op" id="6636005">(</span><span class="ident" id="6636006">tok</span><span class="op" id="6636009">.</span><span class="ident" id="6636010">String</span><span class="op" id="6636016">(</span><span class="op" id="6636017">)</span><span class="op" id="6636018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6636028">here</span>&nbsp;<span class="op" id="6636033">=</span>&nbsp;<span class="ident" id="6636035">prev</span>&nbsp;<span class="op" id="6636040">+</span>&nbsp;<span class="ident" id="6636042">token</span><span class="op" id="6636047">.</span><span class="ident" id="6636048">Pos</span><span class="op" id="6636051">(</span><span class="ident" id="6636052">l</span><span class="op" id="6636053">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636060">}</span><br>
<span class="lineno"></span><span class="op" id="6636062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6636065">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="6636140">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="6636186">//</span><br>
<span class="lineno"></span><span class="keyword" id="6636189">func</span>&nbsp;<span class="ident" id="6636194">compareErrors</span><span class="op" id="6636207">(</span><span class="ident" id="6636208">t</span>&nbsp;<span class="op" id="6636210">*</span><span class="ident" id="6636211">testing</span><span class="op" id="6636218">.</span><span class="ident" id="6636219">T</span><span class="op" id="6636220">,</span>&nbsp;<span class="ident" id="6636222">expected</span>&nbsp;<span class="keyword" id="6636231">map</span><span class="op" id="6636234">[</span><span class="ident" id="6636235">token</span><span class="op" id="6636240">.</span><span class="ident" id="6636241">Pos</span><span class="op" id="6636244">]</span><span class="builtintype" id="6636245">string</span><span class="op" id="6636251">,</span>&nbsp;<span class="ident" id="6636253">found</span>&nbsp;<span class="ident" id="6636259">scanner</span><span class="op" id="6636266">.</span><span class="ident" id="6636267">ErrorList</span><span class="op" id="6636276">)</span>&nbsp;<span class="op" id="6636278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636281">for</span>&nbsp;<span class="ident" id="6636285">_</span><span class="op" id="6636286">,</span>&nbsp;<span class="builtintype" id="6636288">error</span>&nbsp;<span class="op" id="6636294">:=</span>&nbsp;<span class="keyword" id="6636297">range</span>&nbsp;<span class="ident" id="6636303">found</span>&nbsp;<span class="op" id="6636309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636313">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636361">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6636404">pos</span>&nbsp;<span class="op" id="6636408">:=</span>&nbsp;<span class="ident" id="6636411">getPos</span><span class="op" id="6636417">(</span><span class="builtintype" id="6636418">error</span><span class="op" id="6636423">.</span><span class="ident" id="6636424">Pos</span><span class="op" id="6636427">.</span><span class="ident" id="6636428">Filename</span><span class="op" id="6636436">,</span>&nbsp;<span class="builtintype" id="6636438">error</span><span class="op" id="6636443">.</span><span class="ident" id="6636444">Pos</span><span class="op" id="6636447">.</span><span class="ident" id="6636448">Offset</span><span class="op" id="6636454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636458">if</span>&nbsp;<span class="ident" id="6636461">msg</span><span class="op" id="6636464">,</span>&nbsp;<span class="ident" id="6636466">found</span>&nbsp;<span class="op" id="6636472">:=</span>&nbsp;<span class="ident" id="6636475">expected</span><span class="op" id="6636483">[</span><span class="ident" id="6636484">pos</span><span class="op" id="6636487">]</span><span class="op" id="6636488">;</span>&nbsp;<span class="ident" id="6636490">found</span>&nbsp;<span class="op" id="6636496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636501">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6636555">rx</span><span class="op" id="6636557">,</span>&nbsp;<span class="ident" id="6636559">err</span>&nbsp;<span class="op" id="6636563">:=</span>&nbsp;<span class="ident" id="6636566">regexp</span><span class="op" id="6636572">.</span><span class="ident" id="6636573">Compile</span><span class="op" id="6636580">(</span><span class="ident" id="6636581">msg</span><span class="op" id="6636584">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636589">if</span>&nbsp;<span class="ident" id="6636592">err</span>&nbsp;<span class="op" id="6636596">!=</span>&nbsp;<span class="builtintype" id="6636599">nil</span>&nbsp;<span class="op" id="6636603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6636609">t</span><span class="op" id="6636610">.</span><span class="ident" id="6636611">Errorf</span><span class="op" id="6636617">(</span><span class="string" id="6636618">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6636626">,</span>&nbsp;<span class="builtintype" id="6636628">error</span><span class="op" id="6636633">.</span><span class="ident" id="6636634">Pos</span><span class="op" id="6636637">,</span>&nbsp;<span class="ident" id="6636639">err</span><span class="op" id="6636642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636648">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636665">if</span>&nbsp;<span class="ident" id="6636668">match</span>&nbsp;<span class="op" id="6636674">:=</span>&nbsp;<span class="ident" id="6636677">rx</span><span class="op" id="6636679">.</span><span class="ident" id="6636680">MatchString</span><span class="op" id="6636691">(</span><span class="builtintype" id="6636692">error</span><span class="op" id="6636697">.</span><span class="ident" id="6636698">Msg</span><span class="op" id="6636701">)</span><span class="op" id="6636702">;</span>&nbsp;<span class="op" id="6636704">!</span><span class="ident" id="6636705">match</span>&nbsp;<span class="op" id="6636711">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6636717">t</span><span class="op" id="6636718">.</span><span class="ident" id="6636719">Errorf</span><span class="op" id="6636725">(</span><span class="string" id="6636726">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="6636752">,</span>&nbsp;<span class="builtintype" id="6636754">error</span><span class="op" id="6636759">.</span><span class="ident" id="6636760">Pos</span><span class="op" id="6636763">,</span>&nbsp;<span class="builtintype" id="6636765">error</span><span class="op" id="6636770">.</span><span class="ident" id="6636771">Msg</span><span class="op" id="6636774">,</span>&nbsp;<span class="ident" id="6636776">msg</span><span class="op" id="6636779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6636785">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636802">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6636847">delete</span><span class="op" id="6636853">(</span><span class="ident" id="6636854">expected</span><span class="op" id="6636862">,</span>&nbsp;<span class="ident" id="6636864">pos</span><span class="op" id="6636867">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6636871">}</span>&nbsp;<span class="keyword" id="6636873">else</span>&nbsp;<span class="op" id="6636878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636883">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6636940">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637006">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637071">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637139">t</span><span class="op" id="6637140">.</span><span class="ident" id="6637141">Errorf</span><span class="op" id="6637147">(</span><span class="string" id="6637148">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6637174">,</span>&nbsp;<span class="builtintype" id="6637176">error</span><span class="op" id="6637181">.</span><span class="ident" id="6637182">Pos</span><span class="op" id="6637185">,</span>&nbsp;<span class="builtintype" id="6637187">error</span><span class="op" id="6637192">.</span><span class="ident" id="6637193">Msg</span><span class="op" id="6637196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637207">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637251">if</span>&nbsp;<span class="builtinfunc" id="6637254">len</span><span class="op" id="6637257">(</span><span class="ident" id="6637258">expected</span><span class="op" id="6637266">)</span>&nbsp;<span class="op" id="6637268">&gt;</span>&nbsp;<span class="num" id="6637270">0</span>&nbsp;<span class="op" id="6637272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637276">t</span><span class="op" id="6637277">.</span><span class="ident" id="6637278">Errorf</span><span class="op" id="6637284">(</span><span class="string" id="6637285">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="6637310">,</span>&nbsp;<span class="builtinfunc" id="6637312">len</span><span class="op" id="6637315">(</span><span class="ident" id="6637316">expected</span><span class="op" id="6637324">)</span><span class="op" id="6637325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637329">for</span>&nbsp;<span class="ident" id="6637333">pos</span><span class="op" id="6637336">,</span>&nbsp;<span class="ident" id="6637338">msg</span>&nbsp;<span class="op" id="6637342">:=</span>&nbsp;<span class="keyword" id="6637345">range</span>&nbsp;<span class="ident" id="6637351">expected</span>&nbsp;<span class="op" id="6637360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637365">t</span><span class="op" id="6637366">.</span><span class="ident" id="6637367">Errorf</span><span class="op" id="6637373">(</span><span class="string" id="6637374">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="6637384">,</span>&nbsp;<span class="ident" id="6637386">fsetErrs</span><span class="op" id="6637394">.</span><span class="ident" id="6637395">Position</span><span class="op" id="6637403">(</span><span class="ident" id="6637404">pos</span><span class="op" id="6637407">)</span><span class="op" id="6637408">,</span>&nbsp;<span class="ident" id="6637410">msg</span><span class="op" id="6637413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637417">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637420">}</span><br>
<span class="lineno"></span><span class="op" id="6637422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6637425">func</span>&nbsp;<span class="ident" id="6637430">checkErrors</span><span class="op" id="6637441">(</span><span class="ident" id="6637442">t</span>&nbsp;<span class="op" id="6637444">*</span><span class="ident" id="6637445">testing</span><span class="op" id="6637452">.</span><span class="ident" id="6637453">T</span><span class="op" id="6637454">,</span>&nbsp;<span class="ident" id="6637456">filename</span>&nbsp;<span class="builtintype" id="6637465">string</span><span class="op" id="6637471">,</span>&nbsp;<span class="ident" id="6637473">input</span>&nbsp;<span class="keyword" id="6637479">interface</span><span class="op" id="6637488">{</span><span class="op" id="6637489">}</span><span class="op" id="6637490">)</span>&nbsp;<span class="op" id="6637492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637495">src</span><span class="op" id="6637498">,</span>&nbsp;<span class="ident" id="6637500">err</span>&nbsp;<span class="op" id="6637504">:=</span>&nbsp;<span class="ident" id="6637507">readSource</span><span class="op" id="6637517">(</span><span class="ident" id="6637518">filename</span><span class="op" id="6637526">,</span>&nbsp;<span class="ident" id="6637528">input</span><span class="op" id="6637533">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637536">if</span>&nbsp;<span class="ident" id="6637539">err</span>&nbsp;<span class="op" id="6637543">!=</span>&nbsp;<span class="builtintype" id="6637546">nil</span>&nbsp;<span class="op" id="6637550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637554">t</span><span class="op" id="6637555">.</span><span class="ident" id="6637556">Error</span><span class="op" id="6637561">(</span><span class="ident" id="6637562">err</span><span class="op" id="6637565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637569">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637581">_</span><span class="op" id="6637582">,</span>&nbsp;<span class="ident" id="6637584">err</span>&nbsp;<span class="op" id="6637588">=</span>&nbsp;<span class="ident" id="6637590">ParseFile</span><span class="op" id="6637599">(</span><span class="ident" id="6637600">fsetErrs</span><span class="op" id="6637608">,</span>&nbsp;<span class="ident" id="6637610">filename</span><span class="op" id="6637618">,</span>&nbsp;<span class="ident" id="6637620">src</span><span class="op" id="6637623">,</span>&nbsp;<span class="ident" id="6637625">DeclarationErrors</span><span class="op" id="6637642">|</span><span class="ident" id="6637643">AllErrors</span><span class="op" id="6637652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637655">found</span><span class="op" id="6637660">,</span>&nbsp;<span class="ident" id="6637662">ok</span>&nbsp;<span class="op" id="6637665">:=</span>&nbsp;<span class="ident" id="6637668">err</span><span class="op" id="6637671">.</span><span class="op" id="6637672">(</span><span class="ident" id="6637673">scanner</span><span class="op" id="6637680">.</span><span class="ident" id="6637681">ErrorList</span><span class="op" id="6637690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637693">if</span>&nbsp;<span class="ident" id="6637696">err</span>&nbsp;<span class="op" id="6637700">!=</span>&nbsp;<span class="builtintype" id="6637703">nil</span>&nbsp;<span class="op" id="6637707">&amp;&amp;</span>&nbsp;<span class="op" id="6637710">!</span><span class="ident" id="6637711">ok</span>&nbsp;<span class="op" id="6637714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637718">t</span><span class="op" id="6637719">.</span><span class="ident" id="6637720">Error</span><span class="op" id="6637725">(</span><span class="ident" id="6637726">err</span><span class="op" id="6637729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6637733">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6637741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637744">found</span><span class="op" id="6637749">.</span><span class="ident" id="6637750">RemoveMultiples</span><span class="op" id="6637765">(</span><span class="op" id="6637766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637770">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637812">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637889">expected</span>&nbsp;<span class="op" id="6637898">:=</span>&nbsp;<span class="ident" id="6637901">expectedErrors</span><span class="op" id="6637915">(</span><span class="ident" id="6637916">t</span><span class="op" id="6637917">,</span>&nbsp;<span class="ident" id="6637919">filename</span><span class="op" id="6637927">,</span>&nbsp;<span class="ident" id="6637929">src</span><span class="op" id="6637932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6637936">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6637977">compareErrors</span><span class="op" id="6637990">(</span><span class="ident" id="6637991">t</span><span class="op" id="6637992">,</span>&nbsp;<span class="ident" id="6637994">expected</span><span class="op" id="6638002">,</span>&nbsp;<span class="ident" id="6638004">found</span><span class="op" id="6638009">)</span><br>
<span class="lineno"></span><span class="op" id="6638011">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6638014">func</span>&nbsp;<span class="ident" id="6638019">TestErrors</span><span class="op" id="6638029">(</span><span class="ident" id="6638030">t</span>&nbsp;<span class="op" id="6638032">*</span><span class="ident" id="6638033">testing</span><span class="op" id="6638040">.</span><span class="ident" id="6638041">T</span><span class="op" id="6638042">)</span>&nbsp;<span class="op" id="6638044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6638047">list</span><span class="op" id="6638051">,</span>&nbsp;<span class="ident" id="6638053">err</span>&nbsp;<span class="op" id="6638057">:=</span>&nbsp;<span class="ident" id="6638060">ioutil</span><span class="op" id="6638066">.</span><span class="ident" id="6638067">ReadDir</span><span class="op" id="6638074">(</span><span class="ident" id="6638075">testdata</span><span class="op" id="6638083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6638086">if</span>&nbsp;<span class="ident" id="6638089">err</span>&nbsp;<span class="op" id="6638093">!=</span>&nbsp;<span class="builtintype" id="6638096">nil</span>&nbsp;<span class="op" id="6638100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6638104">t</span><span class="op" id="6638105">.</span><span class="ident" id="6638106">Fatal</span><span class="op" id="6638111">(</span><span class="ident" id="6638112">err</span><span class="op" id="6638115">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6638118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6638121">for</span>&nbsp;<span class="ident" id="6638125">_</span><span class="op" id="6638126">,</span>&nbsp;<span class="ident" id="6638128">fi</span>&nbsp;<span class="op" id="6638131">:=</span>&nbsp;<span class="keyword" id="6638134">range</span>&nbsp;<span class="ident" id="6638140">list</span>&nbsp;<span class="op" id="6638145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6638149">name</span>&nbsp;<span class="op" id="6638154">:=</span>&nbsp;<span class="ident" id="6638157">fi</span><span class="op" id="6638159">.</span><span class="ident" id="6638160">Name</span><span class="op" id="6638164">(</span><span class="op" id="6638165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6638169">if</span>&nbsp;<span class="op" id="6638172">!</span><span class="ident" id="6638173">fi</span><span class="op" id="6638175">.</span><span class="ident" id="6638176">IsDir</span><span class="op" id="6638181">(</span><span class="op" id="6638182">)</span>&nbsp;<span class="op" id="6638184">&amp;&amp;</span>&nbsp;<span class="op" id="6638187">!</span><span class="ident" id="6638188">strings</span><span class="op" id="6638195">.</span><span class="ident" id="6638196">HasPrefix</span><span class="op" id="6638205">(</span><span class="ident" id="6638206">name</span><span class="op" id="6638210">,</span>&nbsp;<span class="string" id="6638212">&#34;.&#34;</span><span class="op" id="6638215">)</span>&nbsp;<span class="op" id="6638217">&amp;&amp;</span>&nbsp;<span class="ident" id="6638220">strings</span><span class="op" id="6638227">.</span><span class="ident" id="6638228">HasSuffix</span><span class="op" id="6638237">(</span><span class="ident" id="6638238">name</span><span class="op" id="6638242">,</span>&nbsp;<span class="string" id="6638244">&#34;.src&#34;</span><span class="op" id="6638250">)</span>&nbsp;<span class="op" id="6638252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6638257">checkErrors</span><span class="op" id="6638268">(</span><span class="ident" id="6638269">t</span><span class="op" id="6638270">,</span>&nbsp;<span class="ident" id="6638272">filepath</span><span class="op" id="6638280">.</span><span class="ident" id="6638281">Join</span><span class="op" id="6638285">(</span><span class="ident" id="6638286">testdata</span><span class="op" id="6638294">,</span>&nbsp;<span class="ident" id="6638296">name</span><span class="op" id="6638300">)</span><span class="op" id="6638301">,</span>&nbsp;<span class="builtintype" id="6638303">nil</span><span class="op" id="6638306">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6638310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6638313">}</span><br>
<span class="lineno"></span><span class="op" id="6638315">}</span>
</div>
</body>
</html>
