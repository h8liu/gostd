<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3482695">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3482750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3482804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3482855">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3482885">//</span><br>
<span class="lineno"></span><span class="comment" id="3482888">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3482932">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3482985">package</span>&nbsp;<span class="ident" id="3482993">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3482999">import</span>&nbsp;<span class="op" id="3483006">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483009">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483028">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483038">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483045">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483051">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483064">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483071">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483082">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483093">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483101">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3483108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3483111">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3483178">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="3483223">//</span><br>
<span class="lineno"></span><span class="comment" id="3483226">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3483293">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="3483360">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="3483431">//</span><br>
<span class="lineno"></span><span class="comment" id="3483434">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3483502">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3483563">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="3483577">type</span>&nbsp;<span class="ident" id="3483582">Client</span>&nbsp;<span class="keyword" id="3483589">struct</span>&nbsp;<span class="op" id="3483596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483599">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483657">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483685">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3483723">Transport</span>&nbsp;<span class="ident" id="3483733">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483748">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483811">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483871">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483933">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3483996">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484059">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484109">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484171">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484200">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484204">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484269">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484321">CheckRedirect</span>&nbsp;<span class="keyword" id="3484335">func</span><span class="op" id="3484339">(</span><span class="ident" id="3484340">req</span>&nbsp;<span class="op" id="3484344">*</span><span class="ident" id="3484345">Request</span><span class="op" id="3484352">,</span>&nbsp;<span class="ident" id="3484354">via</span>&nbsp;<span class="op" id="3484358">[</span><span class="op" id="3484359">]</span><span class="op" id="3484360">*</span><span class="ident" id="3484361">Request</span><span class="op" id="3484368">)</span>&nbsp;<span class="builtintype" id="3484370">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484378">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484412">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484476">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484494">Jar</span>&nbsp;<span class="ident" id="3484498">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484510">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484571">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484625">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484689">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484746">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484790">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484794">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484834">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484838">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484896">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484960">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485020">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485077">Timeout</span>&nbsp;<span class="ident" id="3485085">time</span><span class="op" id="3485089">.</span><span class="ident" id="3485090">Duration</span><br>
<span class="lineno"></span><span class="op" id="3485099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3485102">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="3485177">var</span>&nbsp;<span class="ident" id="3485181">DefaultClient</span>&nbsp;<span class="op" id="3485195">=</span>&nbsp;<span class="op" id="3485197">&amp;</span><span class="ident" id="3485198">Client</span><span class="op" id="3485204">{</span><span class="op" id="3485205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3485208">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3485278">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="3485350">//</span><br>
<span class="lineno">80</span><span class="comment" id="3485353">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="3485415">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3485430">type</span>&nbsp;<span class="ident" id="3485435">RoundTripper</span>&nbsp;<span class="keyword" id="3485448">interface</span>&nbsp;<span class="op" id="3485458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485461">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485521">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485581">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485636">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485700">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485762">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485823">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485877">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485930">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485962">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485966">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486022">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486083">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486140">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486157">RoundTrip</span><span class="op" id="3486166">(</span><span class="op" id="3486167">*</span><span class="ident" id="3486168">Request</span><span class="op" id="3486175">)</span>&nbsp;<span class="op" id="3486177">(</span><span class="op" id="3486178">*</span><span class="ident" id="3486179">Response</span><span class="op" id="3486187">,</span>&nbsp;<span class="builtintype" id="3486189">error</span><span class="op" id="3486194">)</span><br>
<span class="lineno"></span><span class="op" id="3486196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3486199">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3486277">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3486323">func</span>&nbsp;<span class="ident" id="3486328">hasPort</span><span class="op" id="3486335">(</span><span class="ident" id="3486336">s</span>&nbsp;<span class="builtintype" id="3486338">string</span><span class="op" id="3486344">)</span>&nbsp;<span class="builtintype" id="3486346">bool</span>&nbsp;<span class="op" id="3486351">{</span>&nbsp;<span class="keyword" id="3486353">return</span>&nbsp;<span class="ident" id="3486360">strings</span><span class="op" id="3486367">.</span><span class="ident" id="3486368">LastIndex</span><span class="op" id="3486377">(</span><span class="ident" id="3486378">s</span><span class="op" id="3486379">,</span>&nbsp;<span class="string" id="3486381">&#34;:&#34;</span><span class="op" id="3486384">)</span>&nbsp;<span class="op" id="3486386">&gt;</span>&nbsp;<span class="ident" id="3486388">strings</span><span class="op" id="3486395">.</span><span class="ident" id="3486396">LastIndex</span><span class="op" id="3486405">(</span><span class="ident" id="3486406">s</span><span class="op" id="3486407">,</span>&nbsp;<span class="string" id="3486409">&#34;]&#34;</span><span class="op" id="3486412">)</span>&nbsp;<span class="op" id="3486414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3486417">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="3486487">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="3486560">func</span>&nbsp;<span class="ident" id="3486565">refererForURL</span><span class="op" id="3486578">(</span><span class="ident" id="3486579">lastReq</span><span class="op" id="3486586">,</span>&nbsp;<span class="ident" id="3486588">newReq</span>&nbsp;<span class="op" id="3486595">*</span><span class="ident" id="3486596">url</span><span class="op" id="3486599">.</span><span class="ident" id="3486600">URL</span><span class="op" id="3486603">)</span>&nbsp;<span class="builtintype" id="3486605">string</span>&nbsp;<span class="op" id="3486612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486615">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486669">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486731">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486790">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3486834">if</span>&nbsp;<span class="ident" id="3486837">lastReq</span><span class="op" id="3486844">.</span><span class="ident" id="3486845">Scheme</span>&nbsp;<span class="op" id="3486852">==</span>&nbsp;<span class="string" id="3486855">&#34;https&#34;</span>&nbsp;<span class="op" id="3486863">&amp;&amp;</span>&nbsp;<span class="ident" id="3486866">newReq</span><span class="op" id="3486872">.</span><span class="ident" id="3486873">Scheme</span>&nbsp;<span class="op" id="3486880">==</span>&nbsp;<span class="string" id="3486883">&#34;http&#34;</span>&nbsp;<span class="op" id="3486890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3486894">return</span>&nbsp;<span class="string" id="3486901">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3486905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486908">referer</span>&nbsp;<span class="op" id="3486916">:=</span>&nbsp;<span class="ident" id="3486919">lastReq</span><span class="op" id="3486926">.</span><span class="ident" id="3486927">String</span><span class="op" id="3486933">(</span><span class="op" id="3486934">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3486937">if</span>&nbsp;<span class="ident" id="3486940">lastReq</span><span class="op" id="3486947">.</span><span class="ident" id="3486948">User</span>&nbsp;<span class="op" id="3486953">!=</span>&nbsp;<span class="ident" id="3486956">nil</span>&nbsp;<span class="op" id="3486960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486964">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487020">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487037">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487076">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487109">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487167">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487209">auth</span>&nbsp;<span class="op" id="3487214">:=</span>&nbsp;<span class="ident" id="3487217">lastReq</span><span class="op" id="3487224">.</span><span class="ident" id="3487225">User</span><span class="op" id="3487229">.</span><span class="ident" id="3487230">String</span><span class="op" id="3487236">(</span><span class="op" id="3487237">)</span>&nbsp;<span class="op" id="3487239">+</span>&nbsp;<span class="string" id="3487241">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487247">referer</span>&nbsp;<span class="op" id="3487255">=</span>&nbsp;<span class="ident" id="3487257">strings</span><span class="op" id="3487264">.</span><span class="ident" id="3487265">Replace</span><span class="op" id="3487272">(</span><span class="ident" id="3487273">referer</span><span class="op" id="3487280">,</span>&nbsp;<span class="ident" id="3487282">auth</span><span class="op" id="3487286">,</span>&nbsp;<span class="string" id="3487288">&#34;&#34;</span><span class="op" id="3487290">,</span>&nbsp;<span class="num" id="3487292">1</span><span class="op" id="3487293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487296">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487299">return</span>&nbsp;<span class="ident" id="3487306">referer</span><br>
<span class="lineno"></span><span class="op" id="3487314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3487317">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3487385">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="3487456">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3487479">type</span>&nbsp;<span class="ident" id="3487484">readClose</span>&nbsp;<span class="keyword" id="3487494">struct</span>&nbsp;<span class="op" id="3487501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487504">io</span><span class="op" id="3487506">.</span><span class="ident" id="3487507">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487515">io</span><span class="op" id="3487517">.</span><span class="ident" id="3487518">Closer</span><br>
<span class="lineno"></span><span class="op" id="3487525">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="3487528">func</span>&nbsp;<span class="op" id="3487533">(</span><span class="ident" id="3487534">c</span>&nbsp;<span class="op" id="3487536">*</span><span class="ident" id="3487537">Client</span><span class="op" id="3487543">)</span>&nbsp;<span class="ident" id="3487545">send</span><span class="op" id="3487549">(</span><span class="ident" id="3487550">req</span>&nbsp;<span class="op" id="3487554">*</span><span class="ident" id="3487555">Request</span><span class="op" id="3487562">)</span>&nbsp;<span class="op" id="3487564">(</span><span class="op" id="3487565">*</span><span class="ident" id="3487566">Response</span><span class="op" id="3487574">,</span>&nbsp;<span class="builtintype" id="3487576">error</span><span class="op" id="3487581">)</span>&nbsp;<span class="op" id="3487583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487586">if</span>&nbsp;<span class="ident" id="3487589">c</span><span class="op" id="3487590">.</span><span class="ident" id="3487591">Jar</span>&nbsp;<span class="op" id="3487595">!=</span>&nbsp;<span class="ident" id="3487598">nil</span>&nbsp;<span class="op" id="3487602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487606">for</span>&nbsp;<span class="ident" id="3487610">_</span><span class="op" id="3487611">,</span>&nbsp;<span class="ident" id="3487613">cookie</span>&nbsp;<span class="op" id="3487620">:=</span>&nbsp;<span class="keyword" id="3487623">range</span>&nbsp;<span class="ident" id="3487629">c</span><span class="op" id="3487630">.</span><span class="ident" id="3487631">Jar</span><span class="op" id="3487634">.</span><span class="ident" id="3487635">Cookies</span><span class="op" id="3487642">(</span><span class="ident" id="3487643">req</span><span class="op" id="3487646">.</span><span class="ident" id="3487647">URL</span><span class="op" id="3487650">)</span>&nbsp;<span class="op" id="3487652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487657">req</span><span class="op" id="3487660">.</span><span class="ident" id="3487661">AddCookie</span><span class="op" id="3487670">(</span><span class="ident" id="3487671">cookie</span><span class="op" id="3487677">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487687">resp</span><span class="op" id="3487691">,</span>&nbsp;<span class="ident" id="3487693">err</span>&nbsp;<span class="op" id="3487697">:=</span>&nbsp;<span class="ident" id="3487700">send</span><span class="op" id="3487704">(</span><span class="ident" id="3487705">req</span><span class="op" id="3487708">,</span>&nbsp;<span class="ident" id="3487710">c</span><span class="op" id="3487711">.</span><span class="ident" id="3487712">transport</span><span class="op" id="3487721">(</span><span class="op" id="3487722">)</span><span class="op" id="3487723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487726">if</span>&nbsp;<span class="ident" id="3487729">err</span>&nbsp;<span class="op" id="3487733">!=</span>&nbsp;<span class="ident" id="3487736">nil</span>&nbsp;<span class="op" id="3487740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487744">return</span>&nbsp;<span class="ident" id="3487751">nil</span><span class="op" id="3487754">,</span>&nbsp;<span class="ident" id="3487756">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487764">if</span>&nbsp;<span class="ident" id="3487767">c</span><span class="op" id="3487768">.</span><span class="ident" id="3487769">Jar</span>&nbsp;<span class="op" id="3487773">!=</span>&nbsp;<span class="ident" id="3487776">nil</span>&nbsp;<span class="op" id="3487780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487784">if</span>&nbsp;<span class="ident" id="3487787">rc</span>&nbsp;<span class="op" id="3487790">:=</span>&nbsp;<span class="ident" id="3487793">resp</span><span class="op" id="3487797">.</span><span class="ident" id="3487798">Cookies</span><span class="op" id="3487805">(</span><span class="op" id="3487806">)</span><span class="op" id="3487807">;</span>&nbsp;<span class="builtinfunc" id="3487809">len</span><span class="op" id="3487812">(</span><span class="ident" id="3487813">rc</span><span class="op" id="3487815">)</span>&nbsp;<span class="op" id="3487817">&gt;</span>&nbsp;<span class="num" id="3487819">0</span>&nbsp;<span class="op" id="3487821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487826">c</span><span class="op" id="3487827">.</span><span class="ident" id="3487828">Jar</span><span class="op" id="3487831">.</span><span class="ident" id="3487832">SetCookies</span><span class="op" id="3487842">(</span><span class="ident" id="3487843">req</span><span class="op" id="3487846">.</span><span class="ident" id="3487847">URL</span><span class="op" id="3487850">,</span>&nbsp;<span class="ident" id="3487852">rc</span><span class="op" id="3487854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487858">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3487864">return</span>&nbsp;<span class="ident" id="3487871">resp</span><span class="op" id="3487875">,</span>&nbsp;<span class="ident" id="3487877">err</span><br>
<span class="lineno"></span><span class="op" id="3487881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3487884">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="3487952">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3488023">//</span><br>
<span class="lineno"></span><span class="comment" id="3488026">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3488086">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3488145">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="3488191">//</span><br>
<span class="lineno"></span><span class="comment" id="3488194">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3488256">//</span><br>
<span class="lineno"></span><span class="comment" id="3488259">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3488323">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="3488388">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3488456">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3488523">//</span><br>
<span class="lineno"></span><span class="comment" id="3488526">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3488592">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="3488622">//</span><br>
<span class="lineno"></span><span class="comment" id="3488625">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="3488689">func</span>&nbsp;<span class="op" id="3488694">(</span><span class="ident" id="3488695">c</span>&nbsp;<span class="op" id="3488697">*</span><span class="ident" id="3488698">Client</span><span class="op" id="3488704">)</span>&nbsp;<span class="ident" id="3488706">Do</span><span class="op" id="3488708">(</span><span class="ident" id="3488709">req</span>&nbsp;<span class="op" id="3488713">*</span><span class="ident" id="3488714">Request</span><span class="op" id="3488721">)</span>&nbsp;<span class="op" id="3488723">(</span><span class="ident" id="3488724">resp</span>&nbsp;<span class="op" id="3488729">*</span><span class="ident" id="3488730">Response</span><span class="op" id="3488738">,</span>&nbsp;<span class="ident" id="3488740">err</span>&nbsp;<span class="builtintype" id="3488744">error</span><span class="op" id="3488749">)</span>&nbsp;<span class="op" id="3488751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488754">if</span>&nbsp;<span class="ident" id="3488757">req</span><span class="op" id="3488760">.</span><span class="ident" id="3488761">Method</span>&nbsp;<span class="op" id="3488768">==</span>&nbsp;<span class="string" id="3488771">&#34;GET&#34;</span>&nbsp;<span class="op" id="3488777">||</span>&nbsp;<span class="ident" id="3488780">req</span><span class="op" id="3488783">.</span><span class="ident" id="3488784">Method</span>&nbsp;<span class="op" id="3488791">==</span>&nbsp;<span class="string" id="3488794">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3488801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488805">return</span>&nbsp;<span class="ident" id="3488812">c</span><span class="op" id="3488813">.</span><span class="ident" id="3488814">doFollowingRedirects</span><span class="op" id="3488834">(</span><span class="ident" id="3488835">req</span><span class="op" id="3488838">,</span>&nbsp;<span class="ident" id="3488840">shouldRedirectGet</span><span class="op" id="3488857">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488863">if</span>&nbsp;<span class="ident" id="3488866">req</span><span class="op" id="3488869">.</span><span class="ident" id="3488870">Method</span>&nbsp;<span class="op" id="3488877">==</span>&nbsp;<span class="string" id="3488880">&#34;POST&#34;</span>&nbsp;<span class="op" id="3488887">||</span>&nbsp;<span class="ident" id="3488890">req</span><span class="op" id="3488893">.</span><span class="ident" id="3488894">Method</span>&nbsp;<span class="op" id="3488901">==</span>&nbsp;<span class="string" id="3488904">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3488910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488914">return</span>&nbsp;<span class="ident" id="3488921">c</span><span class="op" id="3488922">.</span><span class="ident" id="3488923">doFollowingRedirects</span><span class="op" id="3488943">(</span><span class="ident" id="3488944">req</span><span class="op" id="3488947">,</span>&nbsp;<span class="ident" id="3488949">shouldRedirectPost</span><span class="op" id="3488967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488973">return</span>&nbsp;<span class="ident" id="3488980">c</span><span class="op" id="3488981">.</span><span class="ident" id="3488982">send</span><span class="op" id="3488986">(</span><span class="ident" id="3488987">req</span><span class="op" id="3488990">)</span><br>
<span class="lineno">180</span><span class="op" id="3488992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3488995">func</span>&nbsp;<span class="op" id="3489000">(</span><span class="ident" id="3489001">c</span>&nbsp;<span class="op" id="3489003">*</span><span class="ident" id="3489004">Client</span><span class="op" id="3489010">)</span>&nbsp;<span class="ident" id="3489012">transport</span><span class="op" id="3489021">(</span><span class="op" id="3489022">)</span>&nbsp;<span class="ident" id="3489024">RoundTripper</span>&nbsp;<span class="op" id="3489037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489040">if</span>&nbsp;<span class="ident" id="3489043">c</span><span class="op" id="3489044">.</span><span class="ident" id="3489045">Transport</span>&nbsp;<span class="op" id="3489055">!=</span>&nbsp;<span class="ident" id="3489058">nil</span>&nbsp;<span class="op" id="3489062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489066">return</span>&nbsp;<span class="ident" id="3489073">c</span><span class="op" id="3489074">.</span><span class="ident" id="3489075">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489089">return</span>&nbsp;<span class="ident" id="3489096">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="3489113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3489116">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="3489148">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3489208">func</span>&nbsp;<span class="ident" id="3489213">send</span><span class="op" id="3489217">(</span><span class="ident" id="3489218">req</span>&nbsp;<span class="op" id="3489222">*</span><span class="ident" id="3489223">Request</span><span class="op" id="3489230">,</span>&nbsp;<span class="ident" id="3489232">t</span>&nbsp;<span class="ident" id="3489234">RoundTripper</span><span class="op" id="3489246">)</span>&nbsp;<span class="op" id="3489248">(</span><span class="ident" id="3489249">resp</span>&nbsp;<span class="op" id="3489254">*</span><span class="ident" id="3489255">Response</span><span class="op" id="3489263">,</span>&nbsp;<span class="ident" id="3489265">err</span>&nbsp;<span class="builtintype" id="3489269">error</span><span class="op" id="3489274">)</span>&nbsp;<span class="op" id="3489276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489279">if</span>&nbsp;<span class="ident" id="3489282">t</span>&nbsp;<span class="op" id="3489284">==</span>&nbsp;<span class="ident" id="3489287">nil</span>&nbsp;<span class="op" id="3489291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489295">req</span><span class="op" id="3489298">.</span><span class="ident" id="3489299">closeBody</span><span class="op" id="3489308">(</span><span class="op" id="3489309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489313">return</span>&nbsp;<span class="ident" id="3489320">nil</span><span class="op" id="3489323">,</span>&nbsp;<span class="ident" id="3489325">errors</span><span class="op" id="3489331">.</span><span class="ident" id="3489332">New</span><span class="op" id="3489335">(</span><span class="string" id="3489336">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="3489383">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489390">if</span>&nbsp;<span class="ident" id="3489393">req</span><span class="op" id="3489396">.</span><span class="ident" id="3489397">URL</span>&nbsp;<span class="op" id="3489401">==</span>&nbsp;<span class="ident" id="3489404">nil</span>&nbsp;<span class="op" id="3489408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489412">req</span><span class="op" id="3489415">.</span><span class="ident" id="3489416">closeBody</span><span class="op" id="3489425">(</span><span class="op" id="3489426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489430">return</span>&nbsp;<span class="ident" id="3489437">nil</span><span class="op" id="3489440">,</span>&nbsp;<span class="ident" id="3489442">errors</span><span class="op" id="3489448">.</span><span class="ident" id="3489449">New</span><span class="op" id="3489452">(</span><span class="string" id="3489453">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3489476">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489483">if</span>&nbsp;<span class="ident" id="3489486">req</span><span class="op" id="3489489">.</span><span class="ident" id="3489490">RequestURI</span>&nbsp;<span class="op" id="3489501">!=</span>&nbsp;<span class="string" id="3489504">&#34;&#34;</span>&nbsp;<span class="op" id="3489507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489511">req</span><span class="op" id="3489514">.</span><span class="ident" id="3489515">closeBody</span><span class="op" id="3489524">(</span><span class="op" id="3489525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489529">return</span>&nbsp;<span class="ident" id="3489536">nil</span><span class="op" id="3489539">,</span>&nbsp;<span class="ident" id="3489541">errors</span><span class="op" id="3489547">.</span><span class="ident" id="3489548">New</span><span class="op" id="3489551">(</span><span class="string" id="3489552">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="3489611">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489618">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489677">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489737">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489791">if</span>&nbsp;<span class="ident" id="3489794">req</span><span class="op" id="3489797">.</span><span class="ident" id="3489798">Header</span>&nbsp;<span class="op" id="3489805">==</span>&nbsp;<span class="ident" id="3489808">nil</span>&nbsp;<span class="op" id="3489812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489816">req</span><span class="op" id="3489819">.</span><span class="ident" id="3489820">Header</span>&nbsp;<span class="op" id="3489827">=</span>&nbsp;<span class="builtinfunc" id="3489829">make</span><span class="op" id="3489833">(</span><span class="ident" id="3489834">Header</span><span class="op" id="3489840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489847">if</span>&nbsp;<span class="ident" id="3489850">u</span>&nbsp;<span class="op" id="3489852">:=</span>&nbsp;<span class="ident" id="3489855">req</span><span class="op" id="3489858">.</span><span class="ident" id="3489859">URL</span><span class="op" id="3489862">.</span><span class="ident" id="3489863">User</span><span class="op" id="3489867">;</span>&nbsp;<span class="ident" id="3489869">u</span>&nbsp;<span class="op" id="3489871">!=</span>&nbsp;<span class="ident" id="3489874">nil</span>&nbsp;<span class="op" id="3489878">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489882">username</span>&nbsp;<span class="op" id="3489891">:=</span>&nbsp;<span class="ident" id="3489894">u</span><span class="op" id="3489895">.</span><span class="ident" id="3489896">Username</span><span class="op" id="3489904">(</span><span class="op" id="3489905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489909">password</span><span class="op" id="3489917">,</span>&nbsp;<span class="ident" id="3489919">_</span>&nbsp;<span class="op" id="3489921">:=</span>&nbsp;<span class="ident" id="3489924">u</span><span class="op" id="3489925">.</span><span class="ident" id="3489926">Password</span><span class="op" id="3489934">(</span><span class="op" id="3489935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489939">req</span><span class="op" id="3489942">.</span><span class="ident" id="3489943">Header</span><span class="op" id="3489949">.</span><span class="ident" id="3489950">Set</span><span class="op" id="3489953">(</span><span class="string" id="3489954">&#34;Authorization&#34;</span><span class="op" id="3489969">,</span>&nbsp;<span class="string" id="3489971">&#34;Basic&nbsp;&#34;</span><span class="op" id="3489979">+</span><span class="ident" id="3489980">basicAuth</span><span class="op" id="3489989">(</span><span class="ident" id="3489990">username</span><span class="op" id="3489998">,</span>&nbsp;<span class="ident" id="3490000">password</span><span class="op" id="3490008">)</span><span class="op" id="3490009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490015">resp</span><span class="op" id="3490019">,</span>&nbsp;<span class="ident" id="3490021">err</span>&nbsp;<span class="op" id="3490025">=</span>&nbsp;<span class="ident" id="3490027">t</span><span class="op" id="3490028">.</span><span class="ident" id="3490029">RoundTrip</span><span class="op" id="3490038">(</span><span class="ident" id="3490039">req</span><span class="op" id="3490042">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490045">if</span>&nbsp;<span class="ident" id="3490048">err</span>&nbsp;<span class="op" id="3490052">!=</span>&nbsp;<span class="ident" id="3490055">nil</span>&nbsp;<span class="op" id="3490059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490063">if</span>&nbsp;<span class="ident" id="3490066">resp</span>&nbsp;<span class="op" id="3490071">!=</span>&nbsp;<span class="ident" id="3490074">nil</span>&nbsp;<span class="op" id="3490078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490083">log</span><span class="op" id="3490086">.</span><span class="ident" id="3490087">Printf</span><span class="op" id="3490093">(</span><span class="string" id="3490094">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="3490155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490163">return</span>&nbsp;<span class="ident" id="3490170">nil</span><span class="op" id="3490173">,</span>&nbsp;<span class="ident" id="3490175">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490183">return</span>&nbsp;<span class="ident" id="3490190">resp</span><span class="op" id="3490194">,</span>&nbsp;<span class="ident" id="3490196">nil</span><br>
<span class="lineno"></span><span class="op" id="3490200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490203">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="3490264">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="3490336">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="3490400">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3490439">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="3490476">func</span>&nbsp;<span class="ident" id="3490481">basicAuth</span><span class="op" id="3490490">(</span><span class="ident" id="3490491">username</span><span class="op" id="3490499">,</span>&nbsp;<span class="ident" id="3490501">password</span>&nbsp;<span class="builtintype" id="3490510">string</span><span class="op" id="3490516">)</span>&nbsp;<span class="builtintype" id="3490518">string</span>&nbsp;<span class="op" id="3490525">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3490528">auth</span>&nbsp;<span class="op" id="3490533">:=</span>&nbsp;<span class="ident" id="3490536">username</span>&nbsp;<span class="op" id="3490545">+</span>&nbsp;<span class="string" id="3490547">&#34;:&#34;</span>&nbsp;<span class="op" id="3490551">+</span>&nbsp;<span class="ident" id="3490553">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490563">return</span>&nbsp;<span class="ident" id="3490570">base64</span><span class="op" id="3490576">.</span><span class="ident" id="3490577">StdEncoding</span><span class="op" id="3490588">.</span><span class="ident" id="3490589">EncodeToString</span><span class="op" id="3490603">(</span><span class="op" id="3490604">[</span><span class="op" id="3490605">]</span><span class="builtintype" id="3490606">byte</span><span class="op" id="3490610">(</span><span class="ident" id="3490611">auth</span><span class="op" id="3490615">)</span><span class="op" id="3490616">)</span><br>
<span class="lineno"></span><span class="op" id="3490618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490621">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="3490703">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3490730">func</span>&nbsp;<span class="ident" id="3490735">shouldRedirectGet</span><span class="op" id="3490752">(</span><span class="ident" id="3490753">statusCode</span>&nbsp;<span class="builtintype" id="3490764">int</span><span class="op" id="3490767">)</span>&nbsp;<span class="builtintype" id="3490769">bool</span>&nbsp;<span class="op" id="3490774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490777">switch</span>&nbsp;<span class="ident" id="3490784">statusCode</span>&nbsp;<span class="op" id="3490795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490798">case</span>&nbsp;<span class="ident" id="3490803">StatusMovedPermanently</span><span class="op" id="3490825">,</span>&nbsp;<span class="ident" id="3490827">StatusFound</span><span class="op" id="3490838">,</span>&nbsp;<span class="ident" id="3490840">StatusSeeOther</span><span class="op" id="3490854">,</span>&nbsp;<span class="ident" id="3490856">StatusTemporaryRedirect</span><span class="op" id="3490879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490883">return</span>&nbsp;<span class="ident" id="3490890">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3490896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3490899">return</span>&nbsp;<span class="ident" id="3490906">false</span><br>
<span class="lineno"></span><span class="op" id="3490912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490915">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="3490998">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3491025">func</span>&nbsp;<span class="ident" id="3491030">shouldRedirectPost</span><span class="op" id="3491048">(</span><span class="ident" id="3491049">statusCode</span>&nbsp;<span class="builtintype" id="3491060">int</span><span class="op" id="3491063">)</span>&nbsp;<span class="builtintype" id="3491065">bool</span>&nbsp;<span class="op" id="3491070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491073">switch</span>&nbsp;<span class="ident" id="3491080">statusCode</span>&nbsp;<span class="op" id="3491091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491094">case</span>&nbsp;<span class="ident" id="3491099">StatusFound</span><span class="op" id="3491110">,</span>&nbsp;<span class="ident" id="3491112">StatusSeeOther</span><span class="op" id="3491126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491130">return</span>&nbsp;<span class="ident" id="3491137">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3491143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491146">return</span>&nbsp;<span class="ident" id="3491153">false</span><br>
<span class="lineno"></span><span class="op" id="3491159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491162">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3491245">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="3491323">//</span><br>
<span class="lineno"></span><span class="comment" id="3491326">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3491356">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3491374">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="3491396">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3491427">//</span><br>
<span class="lineno"></span><span class="comment" id="3491430">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3491499">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3491566">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="3491576">//</span><br>
<span class="lineno"></span><span class="comment" id="3491579">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3491641">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3491701">//</span><br>
<span class="lineno"></span><span class="comment" id="3491704">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="3491750">func</span>&nbsp;<span class="ident" id="3491755">Get</span><span class="op" id="3491758">(</span><span class="ident" id="3491759">url</span>&nbsp;<span class="builtintype" id="3491763">string</span><span class="op" id="3491769">)</span>&nbsp;<span class="op" id="3491771">(</span><span class="ident" id="3491772">resp</span>&nbsp;<span class="op" id="3491777">*</span><span class="ident" id="3491778">Response</span><span class="op" id="3491786">,</span>&nbsp;<span class="ident" id="3491788">err</span>&nbsp;<span class="builtintype" id="3491792">error</span><span class="op" id="3491797">)</span>&nbsp;<span class="op" id="3491799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3491802">return</span>&nbsp;<span class="ident" id="3491809">DefaultClient</span><span class="op" id="3491822">.</span><span class="ident" id="3491823">Get</span><span class="op" id="3491826">(</span><span class="ident" id="3491827">url</span><span class="op" id="3491830">)</span><br>
<span class="lineno"></span><span class="op" id="3491832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491835">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="3491908">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3491980">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3492016">//</span><br>
<span class="lineno"></span><span class="comment" id="3492019">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3492049">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="3492067">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3492089">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3492120">//</span><br>
<span class="lineno"></span><span class="comment" id="3492123">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3492192">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="3492262">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3492281">//</span><br>
<span class="lineno"></span><span class="comment" id="3492284">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3492346">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3492406">func</span>&nbsp;<span class="op" id="3492411">(</span><span class="ident" id="3492412">c</span>&nbsp;<span class="op" id="3492414">*</span><span class="ident" id="3492415">Client</span><span class="op" id="3492421">)</span>&nbsp;<span class="ident" id="3492423">Get</span><span class="op" id="3492426">(</span><span class="ident" id="3492427">url</span>&nbsp;<span class="builtintype" id="3492431">string</span><span class="op" id="3492437">)</span>&nbsp;<span class="op" id="3492439">(</span><span class="ident" id="3492440">resp</span>&nbsp;<span class="op" id="3492445">*</span><span class="ident" id="3492446">Response</span><span class="op" id="3492454">,</span>&nbsp;<span class="ident" id="3492456">err</span>&nbsp;<span class="builtintype" id="3492460">error</span><span class="op" id="3492465">)</span>&nbsp;<span class="op" id="3492467">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492470">req</span><span class="op" id="3492473">,</span>&nbsp;<span class="ident" id="3492475">err</span>&nbsp;<span class="op" id="3492479">:=</span>&nbsp;<span class="ident" id="3492482">NewRequest</span><span class="op" id="3492492">(</span><span class="string" id="3492493">&#34;GET&#34;</span><span class="op" id="3492498">,</span>&nbsp;<span class="ident" id="3492500">url</span><span class="op" id="3492503">,</span>&nbsp;<span class="ident" id="3492505">nil</span><span class="op" id="3492508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492511">if</span>&nbsp;<span class="ident" id="3492514">err</span>&nbsp;<span class="op" id="3492518">!=</span>&nbsp;<span class="ident" id="3492521">nil</span>&nbsp;<span class="op" id="3492525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492529">return</span>&nbsp;<span class="ident" id="3492536">nil</span><span class="op" id="3492539">,</span>&nbsp;<span class="ident" id="3492541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492549">return</span>&nbsp;<span class="ident" id="3492556">c</span><span class="op" id="3492557">.</span><span class="ident" id="3492558">doFollowingRedirects</span><span class="op" id="3492578">(</span><span class="ident" id="3492579">req</span><span class="op" id="3492582">,</span>&nbsp;<span class="ident" id="3492584">shouldRedirectGet</span><span class="op" id="3492601">)</span><br>
<span class="lineno">300</span><span class="op" id="3492603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3492606">func</span>&nbsp;<span class="op" id="3492611">(</span><span class="ident" id="3492612">c</span>&nbsp;<span class="op" id="3492614">*</span><span class="ident" id="3492615">Client</span><span class="op" id="3492621">)</span>&nbsp;<span class="ident" id="3492623">doFollowingRedirects</span><span class="op" id="3492643">(</span><span class="ident" id="3492644">ireq</span>&nbsp;<span class="op" id="3492649">*</span><span class="ident" id="3492650">Request</span><span class="op" id="3492657">,</span>&nbsp;<span class="ident" id="3492659">shouldRedirect</span>&nbsp;<span class="keyword" id="3492674">func</span><span class="op" id="3492678">(</span><span class="builtintype" id="3492679">int</span><span class="op" id="3492682">)</span>&nbsp;<span class="builtintype" id="3492684">bool</span><span class="op" id="3492688">)</span>&nbsp;<span class="op" id="3492690">(</span><span class="ident" id="3492691">resp</span>&nbsp;<span class="op" id="3492696">*</span><span class="ident" id="3492697">Response</span><span class="op" id="3492705">,</span>&nbsp;<span class="ident" id="3492707">err</span>&nbsp;<span class="builtintype" id="3492711">error</span><span class="op" id="3492716">)</span>&nbsp;<span class="op" id="3492718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492721">var</span>&nbsp;<span class="ident" id="3492725">base</span>&nbsp;<span class="op" id="3492730">*</span><span class="ident" id="3492731">url</span><span class="op" id="3492734">.</span><span class="ident" id="3492735">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492740">redirectChecker</span>&nbsp;<span class="op" id="3492756">:=</span>&nbsp;<span class="ident" id="3492759">c</span><span class="op" id="3492760">.</span><span class="ident" id="3492761">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492776">if</span>&nbsp;<span class="ident" id="3492779">redirectChecker</span>&nbsp;<span class="op" id="3492795">==</span>&nbsp;<span class="ident" id="3492798">nil</span>&nbsp;<span class="op" id="3492802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492806">redirectChecker</span>&nbsp;<span class="op" id="3492822">=</span>&nbsp;<span class="ident" id="3492824">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492849">var</span>&nbsp;<span class="ident" id="3492853">via</span>&nbsp;<span class="op" id="3492857">[</span><span class="op" id="3492858">]</span><span class="op" id="3492859">*</span><span class="ident" id="3492860">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492870">if</span>&nbsp;<span class="ident" id="3492873">ireq</span><span class="op" id="3492877">.</span><span class="ident" id="3492878">URL</span>&nbsp;<span class="op" id="3492882">==</span>&nbsp;<span class="ident" id="3492885">nil</span>&nbsp;<span class="op" id="3492889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3492893">ireq</span><span class="op" id="3492897">.</span><span class="ident" id="3492898">closeBody</span><span class="op" id="3492907">(</span><span class="op" id="3492908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492912">return</span>&nbsp;<span class="ident" id="3492919">nil</span><span class="op" id="3492922">,</span>&nbsp;<span class="ident" id="3492924">errors</span><span class="op" id="3492930">.</span><span class="ident" id="3492931">New</span><span class="op" id="3492934">(</span><span class="string" id="3492935">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3492958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3492961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3492965">var</span>&nbsp;<span class="ident" id="3492969">reqmu</span>&nbsp;<span class="ident" id="3492975">sync</span><span class="op" id="3492979">.</span><span class="ident" id="3492980">Mutex</span>&nbsp;<span class="comment" id="3492986">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493001">req</span>&nbsp;<span class="op" id="3493005">:=</span>&nbsp;<span class="ident" id="3493008">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493015">var</span>&nbsp;<span class="ident" id="3493019">timer</span>&nbsp;<span class="op" id="3493025">*</span><span class="ident" id="3493026">time</span><span class="op" id="3493030">.</span><span class="ident" id="3493031">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493038">if</span>&nbsp;<span class="ident" id="3493041">c</span><span class="op" id="3493042">.</span><span class="ident" id="3493043">Timeout</span>&nbsp;<span class="op" id="3493051">&gt;</span>&nbsp;<span class="num" id="3493053">0</span>&nbsp;<span class="op" id="3493055">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493059">type</span>&nbsp;<span class="ident" id="3493064">canceler</span>&nbsp;<span class="keyword" id="3493073">interface</span>&nbsp;<span class="op" id="3493083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493088">CancelRequest</span><span class="op" id="3493101">(</span><span class="op" id="3493102">*</span><span class="ident" id="3493103">Request</span><span class="op" id="3493110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493118">tr</span><span class="op" id="3493120">,</span>&nbsp;<span class="ident" id="3493122">ok</span>&nbsp;<span class="op" id="3493125">:=</span>&nbsp;<span class="ident" id="3493128">c</span><span class="op" id="3493129">.</span><span class="ident" id="3493130">transport</span><span class="op" id="3493139">(</span><span class="op" id="3493140">)</span><span class="op" id="3493141">.</span><span class="op" id="3493142">(</span><span class="ident" id="3493143">canceler</span><span class="op" id="3493151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493155">if</span>&nbsp;<span class="op" id="3493158">!</span><span class="ident" id="3493159">ok</span>&nbsp;<span class="op" id="3493162">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493167">return</span>&nbsp;<span class="ident" id="3493174">nil</span><span class="op" id="3493177">,</span>&nbsp;<span class="ident" id="3493179">fmt</span><span class="op" id="3493182">.</span><span class="ident" id="3493183">Errorf</span><span class="op" id="3493189">(</span><span class="string" id="3493190">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3493282">,</span>&nbsp;<span class="ident" id="3493284">c</span><span class="op" id="3493285">.</span><span class="ident" id="3493286">transport</span><span class="op" id="3493295">(</span><span class="op" id="3493296">)</span><span class="op" id="3493297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493305">timer</span>&nbsp;<span class="op" id="3493311">=</span>&nbsp;<span class="ident" id="3493313">time</span><span class="op" id="3493317">.</span><span class="ident" id="3493318">AfterFunc</span><span class="op" id="3493327">(</span><span class="ident" id="3493328">c</span><span class="op" id="3493329">.</span><span class="ident" id="3493330">Timeout</span><span class="op" id="3493337">,</span>&nbsp;<span class="keyword" id="3493339">func</span><span class="op" id="3493343">(</span><span class="op" id="3493344">)</span>&nbsp;<span class="op" id="3493346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493351">reqmu</span><span class="op" id="3493356">.</span><span class="ident" id="3493357">Lock</span><span class="op" id="3493361">(</span><span class="op" id="3493362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493367">defer</span>&nbsp;<span class="ident" id="3493373">reqmu</span><span class="op" id="3493378">.</span><span class="ident" id="3493379">Unlock</span><span class="op" id="3493385">(</span><span class="op" id="3493386">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493391">tr</span><span class="op" id="3493393">.</span><span class="ident" id="3493394">CancelRequest</span><span class="op" id="3493407">(</span><span class="ident" id="3493408">req</span><span class="op" id="3493411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493415">}</span><span class="op" id="3493416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493423">urlStr</span>&nbsp;<span class="op" id="3493430">:=</span>&nbsp;<span class="string" id="3493433">&#34;&#34;</span>&nbsp;<span class="comment" id="3493436">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493501">redirectFailed</span>&nbsp;<span class="op" id="3493516">:=</span>&nbsp;<span class="ident" id="3493519">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493526">for</span>&nbsp;<span class="ident" id="3493530">redirect</span>&nbsp;<span class="op" id="3493539">:=</span>&nbsp;<span class="num" id="3493542">0</span><span class="op" id="3493543">;</span>&nbsp;<span class="op" id="3493545">;</span>&nbsp;<span class="ident" id="3493547">redirect</span><span class="op" id="3493555">++</span>&nbsp;<span class="op" id="3493558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493562">if</span>&nbsp;<span class="ident" id="3493565">redirect</span>&nbsp;<span class="op" id="3493574">!=</span>&nbsp;<span class="num" id="3493577">0</span>&nbsp;<span class="op" id="3493579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493584">nreq</span>&nbsp;<span class="op" id="3493589">:=</span>&nbsp;<span class="builtinfunc" id="3493592">new</span><span class="op" id="3493595">(</span><span class="ident" id="3493596">Request</span><span class="op" id="3493603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493608">nreq</span><span class="op" id="3493612">.</span><span class="ident" id="3493613">Method</span>&nbsp;<span class="op" id="3493620">=</span>&nbsp;<span class="ident" id="3493622">ireq</span><span class="op" id="3493626">.</span><span class="ident" id="3493627">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493637">if</span>&nbsp;<span class="ident" id="3493640">ireq</span><span class="op" id="3493644">.</span><span class="ident" id="3493645">Method</span>&nbsp;<span class="op" id="3493652">==</span>&nbsp;<span class="string" id="3493655">&#34;POST&#34;</span>&nbsp;<span class="op" id="3493662">||</span>&nbsp;<span class="ident" id="3493665">ireq</span><span class="op" id="3493669">.</span><span class="ident" id="3493670">Method</span>&nbsp;<span class="op" id="3493677">==</span>&nbsp;<span class="string" id="3493680">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3493686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493692">nreq</span><span class="op" id="3493696">.</span><span class="ident" id="3493697">Method</span>&nbsp;<span class="op" id="3493704">=</span>&nbsp;<span class="string" id="3493706">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493720">nreq</span><span class="op" id="3493724">.</span><span class="ident" id="3493725">Header</span>&nbsp;<span class="op" id="3493732">=</span>&nbsp;<span class="builtinfunc" id="3493734">make</span><span class="op" id="3493738">(</span><span class="ident" id="3493739">Header</span><span class="op" id="3493745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493750">nreq</span><span class="op" id="3493754">.</span><span class="ident" id="3493755">URL</span><span class="op" id="3493758">,</span>&nbsp;<span class="ident" id="3493760">err</span>&nbsp;<span class="op" id="3493764">=</span>&nbsp;<span class="ident" id="3493766">base</span><span class="op" id="3493770">.</span><span class="ident" id="3493771">Parse</span><span class="op" id="3493776">(</span><span class="ident" id="3493777">urlStr</span><span class="op" id="3493783">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493788">if</span>&nbsp;<span class="ident" id="3493791">err</span>&nbsp;<span class="op" id="3493795">!=</span>&nbsp;<span class="ident" id="3493798">nil</span>&nbsp;<span class="op" id="3493802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493808">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3493817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493822">if</span>&nbsp;<span class="builtinfunc" id="3493825">len</span><span class="op" id="3493828">(</span><span class="ident" id="3493829">via</span><span class="op" id="3493832">)</span>&nbsp;<span class="op" id="3493834">&gt;</span>&nbsp;<span class="num" id="3493836">0</span>&nbsp;<span class="op" id="3493838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3493844">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493875">lastReq</span>&nbsp;<span class="op" id="3493883">:=</span>&nbsp;<span class="ident" id="3493886">via</span><span class="op" id="3493889">[</span><span class="builtinfunc" id="3493890">len</span><span class="op" id="3493893">(</span><span class="ident" id="3493894">via</span><span class="op" id="3493897">)</span><span class="op" id="3493898">-</span><span class="num" id="3493899">1</span><span class="op" id="3493900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3493906">if</span>&nbsp;<span class="ident" id="3493909">ref</span>&nbsp;<span class="op" id="3493913">:=</span>&nbsp;<span class="ident" id="3493916">refererForURL</span><span class="op" id="3493929">(</span><span class="ident" id="3493930">lastReq</span><span class="op" id="3493937">.</span><span class="ident" id="3493938">URL</span><span class="op" id="3493941">,</span>&nbsp;<span class="ident" id="3493943">nreq</span><span class="op" id="3493947">.</span><span class="ident" id="3493948">URL</span><span class="op" id="3493951">)</span><span class="op" id="3493952">;</span>&nbsp;<span class="ident" id="3493954">ref</span>&nbsp;<span class="op" id="3493958">!=</span>&nbsp;<span class="string" id="3493961">&#34;&#34;</span>&nbsp;<span class="op" id="3493964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3493971">nreq</span><span class="op" id="3493975">.</span><span class="ident" id="3493976">Header</span><span class="op" id="3493982">.</span><span class="ident" id="3493983">Set</span><span class="op" id="3493986">(</span><span class="string" id="3493987">&#34;Referer&#34;</span><span class="op" id="3493996">,</span>&nbsp;<span class="ident" id="3493998">ref</span><span class="op" id="3494001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494014">err</span>&nbsp;<span class="op" id="3494018">=</span>&nbsp;<span class="ident" id="3494020">redirectChecker</span><span class="op" id="3494035">(</span><span class="ident" id="3494036">nreq</span><span class="op" id="3494040">,</span>&nbsp;<span class="ident" id="3494042">via</span><span class="op" id="3494045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494051">if</span>&nbsp;<span class="ident" id="3494054">err</span>&nbsp;<span class="op" id="3494058">!=</span>&nbsp;<span class="ident" id="3494061">nil</span>&nbsp;<span class="op" id="3494065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494072">redirectFailed</span>&nbsp;<span class="op" id="3494087">=</span>&nbsp;<span class="ident" id="3494089">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494099">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494109">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494119">reqmu</span><span class="op" id="3494124">.</span><span class="ident" id="3494125">Lock</span><span class="op" id="3494129">(</span><span class="op" id="3494130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494135">req</span>&nbsp;<span class="op" id="3494139">=</span>&nbsp;<span class="ident" id="3494141">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494149">reqmu</span><span class="op" id="3494154">.</span><span class="ident" id="3494155">Unlock</span><span class="op" id="3494161">(</span><span class="op" id="3494162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494166">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494171">urlStr</span>&nbsp;<span class="op" id="3494178">=</span>&nbsp;<span class="ident" id="3494180">req</span><span class="op" id="3494183">.</span><span class="ident" id="3494184">URL</span><span class="op" id="3494187">.</span><span class="ident" id="3494188">String</span><span class="op" id="3494194">(</span><span class="op" id="3494195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494199">if</span>&nbsp;<span class="ident" id="3494202">resp</span><span class="op" id="3494206">,</span>&nbsp;<span class="ident" id="3494208">err</span>&nbsp;<span class="op" id="3494212">=</span>&nbsp;<span class="ident" id="3494214">c</span><span class="op" id="3494215">.</span><span class="ident" id="3494216">send</span><span class="op" id="3494220">(</span><span class="ident" id="3494221">req</span><span class="op" id="3494224">)</span><span class="op" id="3494225">;</span>&nbsp;<span class="ident" id="3494227">err</span>&nbsp;<span class="op" id="3494231">!=</span>&nbsp;<span class="ident" id="3494234">nil</span>&nbsp;<span class="op" id="3494238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494243">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494251">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494256">if</span>&nbsp;<span class="ident" id="3494259">shouldRedirect</span><span class="op" id="3494273">(</span><span class="ident" id="3494274">resp</span><span class="op" id="3494278">.</span><span class="ident" id="3494279">StatusCode</span><span class="op" id="3494289">)</span>&nbsp;<span class="op" id="3494291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494296">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3494371">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494452">const</span>&nbsp;<span class="ident" id="3494458">maxBodySlurpSize</span>&nbsp;<span class="op" id="3494475">=</span>&nbsp;<span class="num" id="3494477">2</span>&nbsp;<span class="op" id="3494479">&lt;&lt;</span>&nbsp;<span class="num" id="3494482">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494488">if</span>&nbsp;<span class="ident" id="3494491">resp</span><span class="op" id="3494495">.</span><span class="ident" id="3494496">ContentLength</span>&nbsp;<span class="op" id="3494510">==</span>&nbsp;<span class="op" id="3494513">-</span><span class="num" id="3494514">1</span>&nbsp;<span class="op" id="3494516">||</span>&nbsp;<span class="ident" id="3494519">resp</span><span class="op" id="3494523">.</span><span class="ident" id="3494524">ContentLength</span>&nbsp;<span class="op" id="3494538">&lt;=</span>&nbsp;<span class="ident" id="3494541">maxBodySlurpSize</span>&nbsp;<span class="op" id="3494558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494564">io</span><span class="op" id="3494566">.</span><span class="ident" id="3494567">CopyN</span><span class="op" id="3494572">(</span><span class="ident" id="3494573">ioutil</span><span class="op" id="3494579">.</span><span class="ident" id="3494580">Discard</span><span class="op" id="3494587">,</span>&nbsp;<span class="ident" id="3494589">resp</span><span class="op" id="3494593">.</span><span class="ident" id="3494594">Body</span><span class="op" id="3494598">,</span>&nbsp;<span class="ident" id="3494600">maxBodySlurpSize</span><span class="op" id="3494616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494626">resp</span><span class="op" id="3494630">.</span><span class="ident" id="3494631">Body</span><span class="op" id="3494635">.</span><span class="ident" id="3494636">Close</span><span class="op" id="3494641">(</span><span class="op" id="3494642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494647">if</span>&nbsp;<span class="ident" id="3494650">urlStr</span>&nbsp;<span class="op" id="3494657">=</span>&nbsp;<span class="ident" id="3494659">resp</span><span class="op" id="3494663">.</span><span class="ident" id="3494664">Header</span><span class="op" id="3494670">.</span><span class="ident" id="3494671">Get</span><span class="op" id="3494674">(</span><span class="string" id="3494675">&#34;Location&#34;</span><span class="op" id="3494685">)</span><span class="op" id="3494686">;</span>&nbsp;<span class="ident" id="3494688">urlStr</span>&nbsp;<span class="op" id="3494695">==</span>&nbsp;<span class="string" id="3494698">&#34;&#34;</span>&nbsp;<span class="op" id="3494701">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494707">err</span>&nbsp;<span class="op" id="3494711">=</span>&nbsp;<span class="ident" id="3494713">errors</span><span class="op" id="3494719">.</span><span class="ident" id="3494720">New</span><span class="op" id="3494723">(</span><span class="ident" id="3494724">fmt</span><span class="op" id="3494727">.</span><span class="ident" id="3494728">Sprintf</span><span class="op" id="3494735">(</span><span class="string" id="3494736">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="3494773">,</span>&nbsp;<span class="ident" id="3494775">resp</span><span class="op" id="3494779">.</span><span class="ident" id="3494780">StatusCode</span><span class="op" id="3494790">)</span><span class="op" id="3494791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494797">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494811">base</span>&nbsp;<span class="op" id="3494816">=</span>&nbsp;<span class="ident" id="3494818">req</span><span class="op" id="3494821">.</span><span class="ident" id="3494822">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494829">via</span>&nbsp;<span class="op" id="3494833">=</span>&nbsp;<span class="builtinfunc" id="3494835">append</span><span class="op" id="3494841">(</span><span class="ident" id="3494842">via</span><span class="op" id="3494845">,</span>&nbsp;<span class="ident" id="3494847">req</span><span class="op" id="3494850">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494855">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494870">if</span>&nbsp;<span class="ident" id="3494873">timer</span>&nbsp;<span class="op" id="3494879">!=</span>&nbsp;<span class="ident" id="3494882">nil</span>&nbsp;<span class="op" id="3494886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494891">resp</span><span class="op" id="3494895">.</span><span class="ident" id="3494896">Body</span>&nbsp;<span class="op" id="3494901">=</span>&nbsp;<span class="op" id="3494903">&amp;</span><span class="ident" id="3494904">cancelTimerBody</span><span class="op" id="3494919">{</span><span class="ident" id="3494920">timer</span><span class="op" id="3494925">,</span>&nbsp;<span class="ident" id="3494927">resp</span><span class="op" id="3494931">.</span><span class="ident" id="3494932">Body</span><span class="op" id="3494936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494940">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3494944">return</span>&nbsp;<span class="ident" id="3494951">resp</span><span class="op" id="3494955">,</span>&nbsp;<span class="ident" id="3494957">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3494962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494966">method</span>&nbsp;<span class="op" id="3494973">:=</span>&nbsp;<span class="ident" id="3494976">ireq</span><span class="op" id="3494980">.</span><span class="ident" id="3494981">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3494989">urlErr</span>&nbsp;<span class="op" id="3494996">:=</span>&nbsp;<span class="op" id="3494999">&amp;</span><span class="ident" id="3495000">url</span><span class="op" id="3495003">.</span><span class="ident" id="3495004">Error</span><span class="op" id="3495009">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495013">Op</span><span class="op" id="3495015">:</span>&nbsp;&nbsp;<span class="ident" id="3495018">method</span><span class="op" id="3495024">[</span><span class="num" id="3495025">0</span><span class="op" id="3495026">:</span><span class="num" id="3495027">1</span><span class="op" id="3495028">]</span>&nbsp;<span class="op" id="3495030">+</span>&nbsp;<span class="ident" id="3495032">strings</span><span class="op" id="3495039">.</span><span class="ident" id="3495040">ToLower</span><span class="op" id="3495047">(</span><span class="ident" id="3495048">method</span><span class="op" id="3495054">[</span><span class="num" id="3495055">1</span><span class="op" id="3495056">:</span><span class="op" id="3495057">]</span><span class="op" id="3495058">)</span><span class="op" id="3495059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495063">URL</span><span class="op" id="3495066">:</span>&nbsp;<span class="ident" id="3495068">urlStr</span><span class="op" id="3495074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495078">Err</span><span class="op" id="3495081">:</span>&nbsp;<span class="ident" id="3495083">err</span><span class="op" id="3495086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495093">if</span>&nbsp;<span class="ident" id="3495096">redirectFailed</span>&nbsp;<span class="op" id="3495111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495115">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495182">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3495238">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495276">return</span>&nbsp;<span class="ident" id="3495283">resp</span><span class="op" id="3495287">,</span>&nbsp;<span class="ident" id="3495289">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495301">if</span>&nbsp;<span class="ident" id="3495304">resp</span>&nbsp;<span class="op" id="3495309">!=</span>&nbsp;<span class="ident" id="3495312">nil</span>&nbsp;<span class="op" id="3495316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495320">resp</span><span class="op" id="3495324">.</span><span class="ident" id="3495325">Body</span><span class="op" id="3495329">.</span><span class="ident" id="3495330">Close</span><span class="op" id="3495335">(</span><span class="op" id="3495336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495339">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495342">return</span>&nbsp;<span class="ident" id="3495349">nil</span><span class="op" id="3495352">,</span>&nbsp;<span class="ident" id="3495354">urlErr</span><br>
<span class="lineno"></span><span class="op" id="3495361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3495364">func</span>&nbsp;<span class="ident" id="3495369">defaultCheckRedirect</span><span class="op" id="3495389">(</span><span class="ident" id="3495390">req</span>&nbsp;<span class="op" id="3495394">*</span><span class="ident" id="3495395">Request</span><span class="op" id="3495402">,</span>&nbsp;<span class="ident" id="3495404">via</span>&nbsp;<span class="op" id="3495408">[</span><span class="op" id="3495409">]</span><span class="op" id="3495410">*</span><span class="ident" id="3495411">Request</span><span class="op" id="3495418">)</span>&nbsp;<span class="builtintype" id="3495420">error</span>&nbsp;<span class="op" id="3495426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495429">if</span>&nbsp;<span class="builtinfunc" id="3495432">len</span><span class="op" id="3495435">(</span><span class="ident" id="3495436">via</span><span class="op" id="3495439">)</span>&nbsp;<span class="op" id="3495441">&gt;=</span>&nbsp;<span class="num" id="3495444">10</span>&nbsp;<span class="op" id="3495447">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495451">return</span>&nbsp;<span class="ident" id="3495458">errors</span><span class="op" id="3495464">.</span><span class="ident" id="3495465">New</span><span class="op" id="3495468">(</span><span class="string" id="3495469">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="3495497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495503">return</span>&nbsp;<span class="ident" id="3495510">nil</span><br>
<span class="lineno"></span><span class="op" id="3495514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3495517">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="3495561">//</span><br>
<span class="lineno"></span><span class="comment" id="3495564">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3495624">//</span><br>
<span class="lineno"></span><span class="comment" id="3495627">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="3495674">func</span>&nbsp;<span class="ident" id="3495679">Post</span><span class="op" id="3495683">(</span><span class="ident" id="3495684">url</span>&nbsp;<span class="builtintype" id="3495688">string</span><span class="op" id="3495694">,</span>&nbsp;<span class="ident" id="3495696">bodyType</span>&nbsp;<span class="builtintype" id="3495705">string</span><span class="op" id="3495711">,</span>&nbsp;<span class="ident" id="3495713">body</span>&nbsp;<span class="ident" id="3495718">io</span><span class="op" id="3495720">.</span><span class="ident" id="3495721">Reader</span><span class="op" id="3495727">)</span>&nbsp;<span class="op" id="3495729">(</span><span class="ident" id="3495730">resp</span>&nbsp;<span class="op" id="3495735">*</span><span class="ident" id="3495736">Response</span><span class="op" id="3495744">,</span>&nbsp;<span class="ident" id="3495746">err</span>&nbsp;<span class="builtintype" id="3495750">error</span><span class="op" id="3495755">)</span>&nbsp;<span class="op" id="3495757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495760">return</span>&nbsp;<span class="ident" id="3495767">DefaultClient</span><span class="op" id="3495780">.</span><span class="ident" id="3495781">Post</span><span class="op" id="3495785">(</span><span class="ident" id="3495786">url</span><span class="op" id="3495789">,</span>&nbsp;<span class="ident" id="3495791">bodyType</span><span class="op" id="3495799">,</span>&nbsp;<span class="ident" id="3495801">body</span><span class="op" id="3495805">)</span><br>
<span class="lineno"></span><span class="op" id="3495807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495810">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="3495854">//</span><br>
<span class="lineno"></span><span class="comment" id="3495857">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3495917">//</span><br>
<span class="lineno"></span><span class="comment" id="3495920">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3495989">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="3496001">func</span>&nbsp;<span class="op" id="3496006">(</span><span class="ident" id="3496007">c</span>&nbsp;<span class="op" id="3496009">*</span><span class="ident" id="3496010">Client</span><span class="op" id="3496016">)</span>&nbsp;<span class="ident" id="3496018">Post</span><span class="op" id="3496022">(</span><span class="ident" id="3496023">url</span>&nbsp;<span class="builtintype" id="3496027">string</span><span class="op" id="3496033">,</span>&nbsp;<span class="ident" id="3496035">bodyType</span>&nbsp;<span class="builtintype" id="3496044">string</span><span class="op" id="3496050">,</span>&nbsp;<span class="ident" id="3496052">body</span>&nbsp;<span class="ident" id="3496057">io</span><span class="op" id="3496059">.</span><span class="ident" id="3496060">Reader</span><span class="op" id="3496066">)</span>&nbsp;<span class="op" id="3496068">(</span><span class="ident" id="3496069">resp</span>&nbsp;<span class="op" id="3496074">*</span><span class="ident" id="3496075">Response</span><span class="op" id="3496083">,</span>&nbsp;<span class="ident" id="3496085">err</span>&nbsp;<span class="builtintype" id="3496089">error</span><span class="op" id="3496094">)</span>&nbsp;<span class="op" id="3496096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496099">req</span><span class="op" id="3496102">,</span>&nbsp;<span class="ident" id="3496104">err</span>&nbsp;<span class="op" id="3496108">:=</span>&nbsp;<span class="ident" id="3496111">NewRequest</span><span class="op" id="3496121">(</span><span class="string" id="3496122">&#34;POST&#34;</span><span class="op" id="3496128">,</span>&nbsp;<span class="ident" id="3496130">url</span><span class="op" id="3496133">,</span>&nbsp;<span class="ident" id="3496135">body</span><span class="op" id="3496139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496142">if</span>&nbsp;<span class="ident" id="3496145">err</span>&nbsp;<span class="op" id="3496149">!=</span>&nbsp;<span class="ident" id="3496152">nil</span>&nbsp;<span class="op" id="3496156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496160">return</span>&nbsp;<span class="ident" id="3496167">nil</span><span class="op" id="3496170">,</span>&nbsp;<span class="ident" id="3496172">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496177">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496180">req</span><span class="op" id="3496183">.</span><span class="ident" id="3496184">Header</span><span class="op" id="3496190">.</span><span class="ident" id="3496191">Set</span><span class="op" id="3496194">(</span><span class="string" id="3496195">&#34;Content-Type&#34;</span><span class="op" id="3496209">,</span>&nbsp;<span class="ident" id="3496211">bodyType</span><span class="op" id="3496219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496222">return</span>&nbsp;<span class="ident" id="3496229">c</span><span class="op" id="3496230">.</span><span class="ident" id="3496231">doFollowingRedirects</span><span class="op" id="3496251">(</span><span class="ident" id="3496252">req</span><span class="op" id="3496255">,</span>&nbsp;<span class="ident" id="3496257">shouldRedirectPost</span><span class="op" id="3496275">)</span><br>
<span class="lineno"></span><span class="op" id="3496277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496280">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="3496349">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3496392">//</span><br>
<span class="lineno"></span><span class="comment" id="3496395">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3496457">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3496517">//</span><br>
<span class="lineno">450</span><span class="comment" id="3496520">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="3496575">func</span>&nbsp;<span class="ident" id="3496580">PostForm</span><span class="op" id="3496588">(</span><span class="ident" id="3496589">url</span>&nbsp;<span class="builtintype" id="3496593">string</span><span class="op" id="3496599">,</span>&nbsp;<span class="ident" id="3496601">data</span>&nbsp;<span class="ident" id="3496606">url</span><span class="op" id="3496609">.</span><span class="ident" id="3496610">Values</span><span class="op" id="3496616">)</span>&nbsp;<span class="op" id="3496618">(</span><span class="ident" id="3496619">resp</span>&nbsp;<span class="op" id="3496624">*</span><span class="ident" id="3496625">Response</span><span class="op" id="3496633">,</span>&nbsp;<span class="ident" id="3496635">err</span>&nbsp;<span class="builtintype" id="3496639">error</span><span class="op" id="3496644">)</span>&nbsp;<span class="op" id="3496646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496649">return</span>&nbsp;<span class="ident" id="3496656">DefaultClient</span><span class="op" id="3496669">.</span><span class="ident" id="3496670">PostForm</span><span class="op" id="3496678">(</span><span class="ident" id="3496679">url</span><span class="op" id="3496682">,</span>&nbsp;<span class="ident" id="3496684">data</span><span class="op" id="3496688">)</span><br>
<span class="lineno"></span><span class="op" id="3496690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3496693">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="3496741">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3496804">//</span><br>
<span class="lineno"></span><span class="comment" id="3496807">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3496869">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="3496929">func</span>&nbsp;<span class="op" id="3496934">(</span><span class="ident" id="3496935">c</span>&nbsp;<span class="op" id="3496937">*</span><span class="ident" id="3496938">Client</span><span class="op" id="3496944">)</span>&nbsp;<span class="ident" id="3496946">PostForm</span><span class="op" id="3496954">(</span><span class="ident" id="3496955">url</span>&nbsp;<span class="builtintype" id="3496959">string</span><span class="op" id="3496965">,</span>&nbsp;<span class="ident" id="3496967">data</span>&nbsp;<span class="ident" id="3496972">url</span><span class="op" id="3496975">.</span><span class="ident" id="3496976">Values</span><span class="op" id="3496982">)</span>&nbsp;<span class="op" id="3496984">(</span><span class="ident" id="3496985">resp</span>&nbsp;<span class="op" id="3496990">*</span><span class="ident" id="3496991">Response</span><span class="op" id="3496999">,</span>&nbsp;<span class="ident" id="3497001">err</span>&nbsp;<span class="builtintype" id="3497005">error</span><span class="op" id="3497010">)</span>&nbsp;<span class="op" id="3497012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497015">return</span>&nbsp;<span class="ident" id="3497022">c</span><span class="op" id="3497023">.</span><span class="ident" id="3497024">Post</span><span class="op" id="3497028">(</span><span class="ident" id="3497029">url</span><span class="op" id="3497032">,</span>&nbsp;<span class="string" id="3497034">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3497069">,</span>&nbsp;<span class="ident" id="3497071">strings</span><span class="op" id="3497078">.</span><span class="ident" id="3497079">NewReader</span><span class="op" id="3497088">(</span><span class="ident" id="3497089">data</span><span class="op" id="3497093">.</span><span class="ident" id="3497094">Encode</span><span class="op" id="3497100">(</span><span class="op" id="3497101">)</span><span class="op" id="3497102">)</span><span class="op" id="3497103">)</span><br>
<span class="lineno"></span><span class="op" id="3497105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3497108">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3497183">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3497256">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3497292">//</span><br>
<span class="lineno"></span><span class="comment" id="3497295">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3497325">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="3497343">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3497365">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3497396">//</span><br>
<span class="lineno"></span><span class="comment" id="3497399">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="3497446">func</span>&nbsp;<span class="ident" id="3497451">Head</span><span class="op" id="3497455">(</span><span class="ident" id="3497456">url</span>&nbsp;<span class="builtintype" id="3497460">string</span><span class="op" id="3497466">)</span>&nbsp;<span class="op" id="3497468">(</span><span class="ident" id="3497469">resp</span>&nbsp;<span class="op" id="3497474">*</span><span class="ident" id="3497475">Response</span><span class="op" id="3497483">,</span>&nbsp;<span class="ident" id="3497485">err</span>&nbsp;<span class="builtintype" id="3497489">error</span><span class="op" id="3497494">)</span>&nbsp;<span class="op" id="3497496">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497499">return</span>&nbsp;<span class="ident" id="3497506">DefaultClient</span><span class="op" id="3497519">.</span><span class="ident" id="3497520">Head</span><span class="op" id="3497524">(</span><span class="ident" id="3497525">url</span><span class="op" id="3497528">)</span><br>
<span class="lineno"></span><span class="op" id="3497530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3497533">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3497608">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="3497681">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3497717">//</span><br>
<span class="lineno"></span><span class="comment" id="3497720">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3497750">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3497768">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="3497790">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="3497821">func</span>&nbsp;<span class="op" id="3497826">(</span><span class="ident" id="3497827">c</span>&nbsp;<span class="op" id="3497829">*</span><span class="ident" id="3497830">Client</span><span class="op" id="3497836">)</span>&nbsp;<span class="ident" id="3497838">Head</span><span class="op" id="3497842">(</span><span class="ident" id="3497843">url</span>&nbsp;<span class="builtintype" id="3497847">string</span><span class="op" id="3497853">)</span>&nbsp;<span class="op" id="3497855">(</span><span class="ident" id="3497856">resp</span>&nbsp;<span class="op" id="3497861">*</span><span class="ident" id="3497862">Response</span><span class="op" id="3497870">,</span>&nbsp;<span class="ident" id="3497872">err</span>&nbsp;<span class="builtintype" id="3497876">error</span><span class="op" id="3497881">)</span>&nbsp;<span class="op" id="3497883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3497886">req</span><span class="op" id="3497889">,</span>&nbsp;<span class="ident" id="3497891">err</span>&nbsp;<span class="op" id="3497895">:=</span>&nbsp;<span class="ident" id="3497898">NewRequest</span><span class="op" id="3497908">(</span><span class="string" id="3497909">&#34;HEAD&#34;</span><span class="op" id="3497915">,</span>&nbsp;<span class="ident" id="3497917">url</span><span class="op" id="3497920">,</span>&nbsp;<span class="ident" id="3497922">nil</span><span class="op" id="3497925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497928">if</span>&nbsp;<span class="ident" id="3497931">err</span>&nbsp;<span class="op" id="3497935">!=</span>&nbsp;<span class="ident" id="3497938">nil</span>&nbsp;<span class="op" id="3497942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497946">return</span>&nbsp;<span class="ident" id="3497953">nil</span><span class="op" id="3497956">,</span>&nbsp;<span class="ident" id="3497958">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3497963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3497966">return</span>&nbsp;<span class="ident" id="3497973">c</span><span class="op" id="3497974">.</span><span class="ident" id="3497975">doFollowingRedirects</span><span class="op" id="3497995">(</span><span class="ident" id="3497996">req</span><span class="op" id="3497999">,</span>&nbsp;<span class="ident" id="3498001">shouldRedirectGet</span><span class="op" id="3498018">)</span><br>
<span class="lineno"></span><span class="op" id="3498020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3498023">type</span>&nbsp;<span class="ident" id="3498028">cancelTimerBody</span>&nbsp;<span class="keyword" id="3498044">struct</span>&nbsp;<span class="op" id="3498051">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498054">t</span>&nbsp;&nbsp;<span class="op" id="3498057">*</span><span class="ident" id="3498058">time</span><span class="op" id="3498062">.</span><span class="ident" id="3498063">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498070">rc</span>&nbsp;<span class="ident" id="3498073">io</span><span class="op" id="3498075">.</span><span class="ident" id="3498076">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="3498087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3498090">func</span>&nbsp;<span class="op" id="3498095">(</span><span class="ident" id="3498096">b</span>&nbsp;<span class="op" id="3498098">*</span><span class="ident" id="3498099">cancelTimerBody</span><span class="op" id="3498114">)</span>&nbsp;<span class="ident" id="3498116">Read</span><span class="op" id="3498120">(</span><span class="ident" id="3498121">p</span>&nbsp;<span class="op" id="3498123">[</span><span class="op" id="3498124">]</span><span class="builtintype" id="3498125">byte</span><span class="op" id="3498129">)</span>&nbsp;<span class="op" id="3498131">(</span><span class="ident" id="3498132">n</span>&nbsp;<span class="builtintype" id="3498134">int</span><span class="op" id="3498137">,</span>&nbsp;<span class="ident" id="3498139">err</span>&nbsp;<span class="builtintype" id="3498143">error</span><span class="op" id="3498148">)</span>&nbsp;<span class="op" id="3498150">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498153">n</span><span class="op" id="3498154">,</span>&nbsp;<span class="ident" id="3498156">err</span>&nbsp;<span class="op" id="3498160">=</span>&nbsp;<span class="ident" id="3498162">b</span><span class="op" id="3498163">.</span><span class="ident" id="3498164">rc</span><span class="op" id="3498166">.</span><span class="ident" id="3498167">Read</span><span class="op" id="3498171">(</span><span class="ident" id="3498172">p</span><span class="op" id="3498173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498176">if</span>&nbsp;<span class="ident" id="3498179">err</span>&nbsp;<span class="op" id="3498183">==</span>&nbsp;<span class="ident" id="3498186">io</span><span class="op" id="3498188">.</span><span class="ident" id="3498189">EOF</span>&nbsp;<span class="op" id="3498193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498197">b</span><span class="op" id="3498198">.</span><span class="ident" id="3498199">t</span><span class="op" id="3498200">.</span><span class="ident" id="3498201">Stop</span><span class="op" id="3498205">(</span><span class="op" id="3498206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3498209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498212">return</span><br>
<span class="lineno">505</span><span class="op" id="3498219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3498222">func</span>&nbsp;<span class="op" id="3498227">(</span><span class="ident" id="3498228">b</span>&nbsp;<span class="op" id="3498230">*</span><span class="ident" id="3498231">cancelTimerBody</span><span class="op" id="3498246">)</span>&nbsp;<span class="ident" id="3498248">Close</span><span class="op" id="3498253">(</span><span class="op" id="3498254">)</span>&nbsp;<span class="builtintype" id="3498256">error</span>&nbsp;<span class="op" id="3498262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498265">err</span>&nbsp;<span class="op" id="3498269">:=</span>&nbsp;<span class="ident" id="3498272">b</span><span class="op" id="3498273">.</span><span class="ident" id="3498274">rc</span><span class="op" id="3498276">.</span><span class="ident" id="3498277">Close</span><span class="op" id="3498282">(</span><span class="op" id="3498283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3498286">b</span><span class="op" id="3498287">.</span><span class="ident" id="3498288">t</span><span class="op" id="3498289">.</span><span class="ident" id="3498290">Stop</span><span class="op" id="3498294">(</span><span class="op" id="3498295">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3498298">return</span>&nbsp;<span class="ident" id="3498305">err</span><br>
<span class="lineno"></span><span class="op" id="3498309">}</span>
</div>
</body>
</html>
