<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5141167">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5141222">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5141276">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5141327">package</span>&nbsp;<span class="ident" id="5141335">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5141343">import</span>&nbsp;<span class="op" id="5141350">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5141353">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5141359">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5141375">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5141378">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5141447">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5141532">type</span>&nbsp;<span class="ident" id="5141537">queue</span>&nbsp;<span class="keyword" id="5141543">struct</span>&nbsp;<span class="op" id="5141550">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5141553">sparse</span>&nbsp;<span class="op" id="5141560">[</span><span class="op" id="5141561">]</span><span class="builtintype" id="5141562">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5141570">dense</span>&nbsp;&nbsp;<span class="op" id="5141577">[</span><span class="op" id="5141578">]</span><span class="ident" id="5141579">entry</span><br>
<span class="lineno"></span><span class="op" id="5141585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5141588">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5141623">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5141682">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5141747">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5141812">type</span>&nbsp;<span class="ident" id="5141817">entry</span>&nbsp;<span class="keyword" id="5141823">struct</span>&nbsp;<span class="op" id="5141830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5141833">pc</span>&nbsp;<span class="builtintype" id="5141836">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5141844">t</span>&nbsp;&nbsp;<span class="op" id="5141847">*</span><span class="ident" id="5141848">thread</span><br>
<span class="lineno"></span><span class="op" id="5141855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5141858">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5141921">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5141974">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5142023">type</span>&nbsp;<span class="ident" id="5142028">thread</span>&nbsp;<span class="keyword" id="5142035">struct</span>&nbsp;<span class="op" id="5142042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142045">inst</span>&nbsp;<span class="op" id="5142050">*</span><span class="ident" id="5142051">syntax</span><span class="op" id="5142057">.</span><span class="ident" id="5142058">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5142064">cap</span>&nbsp;&nbsp;<span class="op" id="5142069">[</span><span class="op" id="5142070">]</span><span class="builtintype" id="5142071">int</span><br>
<span class="lineno"></span><span class="op" id="5142075">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5142078">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5142143">type</span>&nbsp;<span class="ident" id="5142148">machine</span>&nbsp;<span class="keyword" id="5142156">struct</span>&nbsp;<span class="op" id="5142163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142166">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5142175">*</span><span class="ident" id="5142176">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142188">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142213">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5142222">*</span><span class="ident" id="5142223">syntax</span><span class="op" id="5142229">.</span><span class="ident" id="5142230">Prog</span>&nbsp;<span class="comment" id="5142235">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142256">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5142265">*</span><span class="ident" id="5142266">onePassProg</span>&nbsp;<span class="comment" id="5142278">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142322">q0</span><span class="op" id="5142324">,</span>&nbsp;<span class="ident" id="5142326">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5142331">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142344">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142375">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5142384">[</span><span class="op" id="5142385">]</span><span class="op" id="5142386">*</span><span class="ident" id="5142387">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142397">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142427">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5142436">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142449">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142479">matchcap</span>&nbsp;<span class="op" id="5142488">[</span><span class="op" id="5142489">]</span><span class="builtintype" id="5142490">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142501">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5142540">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142579">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5142591">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142603">inputString</span>&nbsp;<span class="ident" id="5142615">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142628">inputReader</span>&nbsp;<span class="ident" id="5142640">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5142652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5142655">func</span>&nbsp;<span class="op" id="5142660">(</span><span class="ident" id="5142661">m</span>&nbsp;<span class="op" id="5142663">*</span><span class="ident" id="5142664">machine</span><span class="op" id="5142671">)</span>&nbsp;<span class="ident" id="5142673">newInputBytes</span><span class="op" id="5142686">(</span><span class="ident" id="5142687">b</span>&nbsp;<span class="op" id="5142689">[</span><span class="op" id="5142690">]</span><span class="builtintype" id="5142691">byte</span><span class="op" id="5142695">)</span>&nbsp;<span class="ident" id="5142697">input</span>&nbsp;<span class="op" id="5142703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142706">m</span><span class="op" id="5142707">.</span><span class="ident" id="5142708">inputBytes</span><span class="op" id="5142718">.</span><span class="ident" id="5142719">str</span>&nbsp;<span class="op" id="5142723">=</span>&nbsp;<span class="ident" id="5142725">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5142728">return</span>&nbsp;<span class="op" id="5142735">&amp;</span><span class="ident" id="5142736">m</span><span class="op" id="5142737">.</span><span class="ident" id="5142738">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5142749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5142752">func</span>&nbsp;<span class="op" id="5142757">(</span><span class="ident" id="5142758">m</span>&nbsp;<span class="op" id="5142760">*</span><span class="ident" id="5142761">machine</span><span class="op" id="5142768">)</span>&nbsp;<span class="ident" id="5142770">newInputString</span><span class="op" id="5142784">(</span><span class="ident" id="5142785">s</span>&nbsp;<span class="builtintype" id="5142787">string</span><span class="op" id="5142793">)</span>&nbsp;<span class="ident" id="5142795">input</span>&nbsp;<span class="op" id="5142801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142804">m</span><span class="op" id="5142805">.</span><span class="ident" id="5142806">inputString</span><span class="op" id="5142817">.</span><span class="ident" id="5142818">str</span>&nbsp;<span class="op" id="5142822">=</span>&nbsp;<span class="ident" id="5142824">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5142827">return</span>&nbsp;<span class="op" id="5142834">&amp;</span><span class="ident" id="5142835">m</span><span class="op" id="5142836">.</span><span class="ident" id="5142837">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5142849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5142852">func</span>&nbsp;<span class="op" id="5142857">(</span><span class="ident" id="5142858">m</span>&nbsp;<span class="op" id="5142860">*</span><span class="ident" id="5142861">machine</span><span class="op" id="5142868">)</span>&nbsp;<span class="ident" id="5142870">newInputReader</span><span class="op" id="5142884">(</span><span class="ident" id="5142885">r</span>&nbsp;<span class="ident" id="5142887">io</span><span class="op" id="5142889">.</span><span class="ident" id="5142890">RuneReader</span><span class="op" id="5142900">)</span>&nbsp;<span class="ident" id="5142902">input</span>&nbsp;<span class="op" id="5142908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142911">m</span><span class="op" id="5142912">.</span><span class="ident" id="5142913">inputReader</span><span class="op" id="5142924">.</span><span class="ident" id="5142925">r</span>&nbsp;<span class="op" id="5142927">=</span>&nbsp;<span class="ident" id="5142929">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142932">m</span><span class="op" id="5142933">.</span><span class="ident" id="5142934">inputReader</span><span class="op" id="5142945">.</span><span class="ident" id="5142946">atEOT</span>&nbsp;<span class="op" id="5142952">=</span>&nbsp;<span class="builtintype" id="5142954">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5142961">m</span><span class="op" id="5142962">.</span><span class="ident" id="5142963">inputReader</span><span class="op" id="5142974">.</span><span class="ident" id="5142975">pos</span>&nbsp;<span class="op" id="5142979">=</span>&nbsp;<span class="num" id="5142981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5142984">return</span>&nbsp;<span class="op" id="5142991">&amp;</span><span class="ident" id="5142992">m</span><span class="op" id="5142993">.</span><span class="ident" id="5142994">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5143006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5143009">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5143066">func</span>&nbsp;<span class="ident" id="5143071">progMachine</span><span class="op" id="5143082">(</span><span class="ident" id="5143083">p</span>&nbsp;<span class="op" id="5143085">*</span><span class="ident" id="5143086">syntax</span><span class="op" id="5143092">.</span><span class="ident" id="5143093">Prog</span><span class="op" id="5143097">,</span>&nbsp;<span class="ident" id="5143099">op</span>&nbsp;<span class="op" id="5143102">*</span><span class="ident" id="5143103">onePassProg</span><span class="op" id="5143114">)</span>&nbsp;<span class="op" id="5143116">*</span><span class="ident" id="5143117">machine</span>&nbsp;<span class="op" id="5143125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143128">m</span>&nbsp;<span class="op" id="5143130">:=</span>&nbsp;<span class="op" id="5143133">&amp;</span><span class="ident" id="5143134">machine</span><span class="op" id="5143141">{</span><span class="ident" id="5143142">p</span><span class="op" id="5143143">:</span>&nbsp;<span class="ident" id="5143145">p</span><span class="op" id="5143146">,</span>&nbsp;<span class="ident" id="5143148">op</span><span class="op" id="5143150">:</span>&nbsp;<span class="ident" id="5143152">op</span><span class="op" id="5143154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143157">n</span>&nbsp;<span class="op" id="5143159">:=</span>&nbsp;<span class="builtinfunc" id="5143162">len</span><span class="op" id="5143165">(</span><span class="ident" id="5143166">m</span><span class="op" id="5143167">.</span><span class="ident" id="5143168">p</span><span class="op" id="5143169">.</span><span class="ident" id="5143170">Inst</span><span class="op" id="5143174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143177">m</span><span class="op" id="5143178">.</span><span class="ident" id="5143179">q0</span>&nbsp;<span class="op" id="5143182">=</span>&nbsp;<span class="ident" id="5143184">queue</span><span class="op" id="5143189">{</span><span class="builtinfunc" id="5143190">make</span><span class="op" id="5143194">(</span><span class="op" id="5143195">[</span><span class="op" id="5143196">]</span><span class="builtintype" id="5143197">uint32</span><span class="op" id="5143203">,</span>&nbsp;<span class="ident" id="5143205">n</span><span class="op" id="5143206">)</span><span class="op" id="5143207">,</span>&nbsp;<span class="builtinfunc" id="5143209">make</span><span class="op" id="5143213">(</span><span class="op" id="5143214">[</span><span class="op" id="5143215">]</span><span class="ident" id="5143216">entry</span><span class="op" id="5143221">,</span>&nbsp;<span class="num" id="5143223">0</span><span class="op" id="5143224">,</span>&nbsp;<span class="ident" id="5143226">n</span><span class="op" id="5143227">)</span><span class="op" id="5143228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143231">m</span><span class="op" id="5143232">.</span><span class="ident" id="5143233">q1</span>&nbsp;<span class="op" id="5143236">=</span>&nbsp;<span class="ident" id="5143238">queue</span><span class="op" id="5143243">{</span><span class="builtinfunc" id="5143244">make</span><span class="op" id="5143248">(</span><span class="op" id="5143249">[</span><span class="op" id="5143250">]</span><span class="builtintype" id="5143251">uint32</span><span class="op" id="5143257">,</span>&nbsp;<span class="ident" id="5143259">n</span><span class="op" id="5143260">)</span><span class="op" id="5143261">,</span>&nbsp;<span class="builtinfunc" id="5143263">make</span><span class="op" id="5143267">(</span><span class="op" id="5143268">[</span><span class="op" id="5143269">]</span><span class="ident" id="5143270">entry</span><span class="op" id="5143275">,</span>&nbsp;<span class="num" id="5143277">0</span><span class="op" id="5143278">,</span>&nbsp;<span class="ident" id="5143280">n</span><span class="op" id="5143281">)</span><span class="op" id="5143282">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143285">ncap</span>&nbsp;<span class="op" id="5143290">:=</span>&nbsp;<span class="ident" id="5143293">p</span><span class="op" id="5143294">.</span><span class="ident" id="5143295">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143303">if</span>&nbsp;<span class="ident" id="5143306">ncap</span>&nbsp;<span class="op" id="5143311">&lt;</span>&nbsp;<span class="num" id="5143313">2</span>&nbsp;<span class="op" id="5143315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143319">ncap</span>&nbsp;<span class="op" id="5143324">=</span>&nbsp;<span class="num" id="5143326">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5143329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143332">m</span><span class="op" id="5143333">.</span><span class="ident" id="5143334">matchcap</span>&nbsp;<span class="op" id="5143343">=</span>&nbsp;<span class="builtinfunc" id="5143345">make</span><span class="op" id="5143349">(</span><span class="op" id="5143350">[</span><span class="op" id="5143351">]</span><span class="builtintype" id="5143352">int</span><span class="op" id="5143355">,</span>&nbsp;<span class="ident" id="5143357">ncap</span><span class="op" id="5143361">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143364">return</span>&nbsp;<span class="ident" id="5143371">m</span><br>
<span class="lineno"></span><span class="op" id="5143373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5143376">func</span>&nbsp;<span class="op" id="5143381">(</span><span class="ident" id="5143382">m</span>&nbsp;<span class="op" id="5143384">*</span><span class="ident" id="5143385">machine</span><span class="op" id="5143392">)</span>&nbsp;<span class="ident" id="5143394">init</span><span class="op" id="5143398">(</span><span class="ident" id="5143399">ncap</span>&nbsp;<span class="builtintype" id="5143404">int</span><span class="op" id="5143407">)</span>&nbsp;<span class="op" id="5143409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143412">for</span>&nbsp;<span class="ident" id="5143416">_</span><span class="op" id="5143417">,</span>&nbsp;<span class="ident" id="5143419">t</span>&nbsp;<span class="op" id="5143421">:=</span>&nbsp;<span class="keyword" id="5143424">range</span>&nbsp;<span class="ident" id="5143430">m</span><span class="op" id="5143431">.</span><span class="ident" id="5143432">pool</span>&nbsp;<span class="op" id="5143437">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143441">t</span><span class="op" id="5143442">.</span><span class="builtinfunc" id="5143443">cap</span>&nbsp;<span class="op" id="5143447">=</span>&nbsp;<span class="ident" id="5143449">t</span><span class="op" id="5143450">.</span><span class="builtinfunc" id="5143451">cap</span><span class="op" id="5143454">[</span><span class="op" id="5143455">:</span><span class="ident" id="5143456">ncap</span><span class="op" id="5143460">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5143463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143466">m</span><span class="op" id="5143467">.</span><span class="ident" id="5143468">matchcap</span>&nbsp;<span class="op" id="5143477">=</span>&nbsp;<span class="ident" id="5143479">m</span><span class="op" id="5143480">.</span><span class="ident" id="5143481">matchcap</span><span class="op" id="5143489">[</span><span class="op" id="5143490">:</span><span class="ident" id="5143491">ncap</span><span class="op" id="5143495">]</span><br>
<span class="lineno"></span><span class="op" id="5143497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5143500">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5143560">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5143598">func</span>&nbsp;<span class="op" id="5143603">(</span><span class="ident" id="5143604">m</span>&nbsp;<span class="op" id="5143606">*</span><span class="ident" id="5143607">machine</span><span class="op" id="5143614">)</span>&nbsp;<span class="ident" id="5143616">alloc</span><span class="op" id="5143621">(</span><span class="ident" id="5143622">i</span>&nbsp;<span class="op" id="5143624">*</span><span class="ident" id="5143625">syntax</span><span class="op" id="5143631">.</span><span class="ident" id="5143632">Inst</span><span class="op" id="5143636">)</span>&nbsp;<span class="op" id="5143638">*</span><span class="ident" id="5143639">thread</span>&nbsp;<span class="op" id="5143646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143649">var</span>&nbsp;<span class="ident" id="5143653">t</span>&nbsp;<span class="op" id="5143655">*</span><span class="ident" id="5143656">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143664">if</span>&nbsp;<span class="ident" id="5143667">n</span>&nbsp;<span class="op" id="5143669">:=</span>&nbsp;<span class="builtinfunc" id="5143672">len</span><span class="op" id="5143675">(</span><span class="ident" id="5143676">m</span><span class="op" id="5143677">.</span><span class="ident" id="5143678">pool</span><span class="op" id="5143682">)</span><span class="op" id="5143683">;</span>&nbsp;<span class="ident" id="5143685">n</span>&nbsp;<span class="op" id="5143687">&gt;</span>&nbsp;<span class="num" id="5143689">0</span>&nbsp;<span class="op" id="5143691">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143695">t</span>&nbsp;<span class="op" id="5143697">=</span>&nbsp;<span class="ident" id="5143699">m</span><span class="op" id="5143700">.</span><span class="ident" id="5143701">pool</span><span class="op" id="5143705">[</span><span class="ident" id="5143706">n</span><span class="op" id="5143707">-</span><span class="num" id="5143708">1</span><span class="op" id="5143709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143713">m</span><span class="op" id="5143714">.</span><span class="ident" id="5143715">pool</span>&nbsp;<span class="op" id="5143720">=</span>&nbsp;<span class="ident" id="5143722">m</span><span class="op" id="5143723">.</span><span class="ident" id="5143724">pool</span><span class="op" id="5143728">[</span><span class="op" id="5143729">:</span><span class="ident" id="5143730">n</span><span class="op" id="5143731">-</span><span class="num" id="5143732">1</span><span class="op" id="5143733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5143736">}</span>&nbsp;<span class="keyword" id="5143738">else</span>&nbsp;<span class="op" id="5143743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143747">t</span>&nbsp;<span class="op" id="5143749">=</span>&nbsp;<span class="builtinfunc" id="5143751">new</span><span class="op" id="5143754">(</span><span class="ident" id="5143755">thread</span><span class="op" id="5143761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143765">t</span><span class="op" id="5143766">.</span><span class="builtinfunc" id="5143767">cap</span>&nbsp;<span class="op" id="5143771">=</span>&nbsp;<span class="builtinfunc" id="5143773">make</span><span class="op" id="5143777">(</span><span class="op" id="5143778">[</span><span class="op" id="5143779">]</span><span class="builtintype" id="5143780">int</span><span class="op" id="5143783">,</span>&nbsp;<span class="builtinfunc" id="5143785">len</span><span class="op" id="5143788">(</span><span class="ident" id="5143789">m</span><span class="op" id="5143790">.</span><span class="ident" id="5143791">matchcap</span><span class="op" id="5143799">)</span><span class="op" id="5143800">,</span>&nbsp;<span class="builtinfunc" id="5143802">cap</span><span class="op" id="5143805">(</span><span class="ident" id="5143806">m</span><span class="op" id="5143807">.</span><span class="ident" id="5143808">matchcap</span><span class="op" id="5143816">)</span><span class="op" id="5143817">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5143820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143823">t</span><span class="op" id="5143824">.</span><span class="ident" id="5143825">inst</span>&nbsp;<span class="op" id="5143830">=</span>&nbsp;<span class="ident" id="5143832">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5143835">return</span>&nbsp;<span class="ident" id="5143842">t</span><br>
<span class="lineno"></span><span class="op" id="5143844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5143847">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5143883">func</span>&nbsp;<span class="op" id="5143888">(</span><span class="ident" id="5143889">m</span>&nbsp;<span class="op" id="5143891">*</span><span class="ident" id="5143892">machine</span><span class="op" id="5143899">)</span>&nbsp;<span class="ident" id="5143901">free</span><span class="op" id="5143905">(</span><span class="ident" id="5143906">t</span>&nbsp;<span class="op" id="5143908">*</span><span class="ident" id="5143909">thread</span><span class="op" id="5143915">)</span>&nbsp;<span class="op" id="5143917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143920">m</span><span class="op" id="5143921">.</span><span class="ident" id="5143922">inputBytes</span><span class="op" id="5143932">.</span><span class="ident" id="5143933">str</span>&nbsp;<span class="op" id="5143937">=</span>&nbsp;<span class="builtintype" id="5143939">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143944">m</span><span class="op" id="5143945">.</span><span class="ident" id="5143946">inputString</span><span class="op" id="5143957">.</span><span class="ident" id="5143958">str</span>&nbsp;<span class="op" id="5143962">=</span>&nbsp;<span class="string" id="5143964">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143968">m</span><span class="op" id="5143969">.</span><span class="ident" id="5143970">inputReader</span><span class="op" id="5143981">.</span><span class="ident" id="5143982">r</span>&nbsp;<span class="op" id="5143984">=</span>&nbsp;<span class="builtintype" id="5143986">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5143991">m</span><span class="op" id="5143992">.</span><span class="ident" id="5143993">pool</span>&nbsp;<span class="op" id="5143998">=</span>&nbsp;<span class="builtinfunc" id="5144000">append</span><span class="op" id="5144006">(</span><span class="ident" id="5144007">m</span><span class="op" id="5144008">.</span><span class="ident" id="5144009">pool</span><span class="op" id="5144013">,</span>&nbsp;<span class="ident" id="5144015">t</span><span class="op" id="5144016">)</span><br>
<span class="lineno"></span><span class="op" id="5144018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5144021">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5144079">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5144120">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5144173">func</span>&nbsp;<span class="op" id="5144178">(</span><span class="ident" id="5144179">m</span>&nbsp;<span class="op" id="5144181">*</span><span class="ident" id="5144182">machine</span><span class="op" id="5144189">)</span>&nbsp;<span class="ident" id="5144191">match</span><span class="op" id="5144196">(</span><span class="ident" id="5144197">i</span>&nbsp;<span class="ident" id="5144199">input</span><span class="op" id="5144204">,</span>&nbsp;<span class="ident" id="5144206">pos</span>&nbsp;<span class="builtintype" id="5144210">int</span><span class="op" id="5144213">)</span>&nbsp;<span class="builtintype" id="5144215">bool</span>&nbsp;<span class="op" id="5144220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144223">startCond</span>&nbsp;<span class="op" id="5144233">:=</span>&nbsp;<span class="ident" id="5144236">m</span><span class="op" id="5144237">.</span><span class="ident" id="5144238">re</span><span class="op" id="5144240">.</span><span class="ident" id="5144241">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144247">if</span>&nbsp;<span class="ident" id="5144250">startCond</span>&nbsp;<span class="op" id="5144260">==</span>&nbsp;<span class="op" id="5144263">^</span><span class="ident" id="5144264">syntax</span><span class="op" id="5144270">.</span><span class="ident" id="5144271">EmptyOp</span><span class="op" id="5144278">(</span><span class="num" id="5144279">0</span><span class="op" id="5144280">)</span>&nbsp;<span class="op" id="5144282">{</span>&nbsp;<span class="comment" id="5144284">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144300">return</span>&nbsp;<span class="builtintype" id="5144307">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144317">m</span><span class="op" id="5144318">.</span><span class="ident" id="5144319">matched</span>&nbsp;<span class="op" id="5144327">=</span>&nbsp;<span class="builtintype" id="5144329">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144336">for</span>&nbsp;<span class="ident" id="5144340">i</span>&nbsp;<span class="op" id="5144342">:=</span>&nbsp;<span class="keyword" id="5144345">range</span>&nbsp;<span class="ident" id="5144351">m</span><span class="op" id="5144352">.</span><span class="ident" id="5144353">matchcap</span>&nbsp;<span class="op" id="5144362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144366">m</span><span class="op" id="5144367">.</span><span class="ident" id="5144368">matchcap</span><span class="op" id="5144376">[</span><span class="ident" id="5144377">i</span><span class="op" id="5144378">]</span>&nbsp;<span class="op" id="5144380">=</span>&nbsp;<span class="op" id="5144382">-</span><span class="num" id="5144383">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144386">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144389">runq</span><span class="op" id="5144393">,</span>&nbsp;<span class="ident" id="5144395">nextq</span>&nbsp;<span class="op" id="5144401">:=</span>&nbsp;<span class="op" id="5144404">&amp;</span><span class="ident" id="5144405">m</span><span class="op" id="5144406">.</span><span class="ident" id="5144407">q0</span><span class="op" id="5144409">,</span>&nbsp;<span class="op" id="5144411">&amp;</span><span class="ident" id="5144412">m</span><span class="op" id="5144413">.</span><span class="ident" id="5144414">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144418">r</span><span class="op" id="5144419">,</span>&nbsp;<span class="ident" id="5144421">r1</span>&nbsp;<span class="op" id="5144424">:=</span>&nbsp;<span class="ident" id="5144427">endOfText</span><span class="op" id="5144436">,</span>&nbsp;<span class="ident" id="5144438">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144449">width</span><span class="op" id="5144454">,</span>&nbsp;<span class="ident" id="5144456">width1</span>&nbsp;<span class="op" id="5144463">:=</span>&nbsp;<span class="num" id="5144466">0</span><span class="op" id="5144467">,</span>&nbsp;<span class="num" id="5144469">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144472">r</span><span class="op" id="5144473">,</span>&nbsp;<span class="ident" id="5144475">width</span>&nbsp;<span class="op" id="5144481">=</span>&nbsp;<span class="ident" id="5144483">i</span><span class="op" id="5144484">.</span><span class="ident" id="5144485">step</span><span class="op" id="5144489">(</span><span class="ident" id="5144490">pos</span><span class="op" id="5144493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144496">if</span>&nbsp;<span class="ident" id="5144499">r</span>&nbsp;<span class="op" id="5144501">!=</span>&nbsp;<span class="ident" id="5144504">endOfText</span>&nbsp;<span class="op" id="5144514">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144518">r1</span><span class="op" id="5144520">,</span>&nbsp;<span class="ident" id="5144522">width1</span>&nbsp;<span class="op" id="5144529">=</span>&nbsp;<span class="ident" id="5144531">i</span><span class="op" id="5144532">.</span><span class="ident" id="5144533">step</span><span class="op" id="5144537">(</span><span class="ident" id="5144538">pos</span>&nbsp;<span class="op" id="5144542">+</span>&nbsp;<span class="ident" id="5144544">width</span><span class="op" id="5144549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144555">var</span>&nbsp;<span class="ident" id="5144559">flag</span>&nbsp;<span class="ident" id="5144564">syntax</span><span class="op" id="5144570">.</span><span class="ident" id="5144571">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144580">if</span>&nbsp;<span class="ident" id="5144583">pos</span>&nbsp;<span class="op" id="5144587">==</span>&nbsp;<span class="num" id="5144590">0</span>&nbsp;<span class="op" id="5144592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144596">flag</span>&nbsp;<span class="op" id="5144601">=</span>&nbsp;<span class="ident" id="5144603">syntax</span><span class="op" id="5144609">.</span><span class="ident" id="5144610">EmptyOpContext</span><span class="op" id="5144624">(</span><span class="op" id="5144625">-</span><span class="num" id="5144626">1</span><span class="op" id="5144627">,</span>&nbsp;<span class="ident" id="5144629">r</span><span class="op" id="5144630">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144633">}</span>&nbsp;<span class="keyword" id="5144635">else</span>&nbsp;<span class="op" id="5144640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5144644">flag</span>&nbsp;<span class="op" id="5144649">=</span>&nbsp;<span class="ident" id="5144651">i</span><span class="op" id="5144652">.</span><span class="ident" id="5144653">context</span><span class="op" id="5144660">(</span><span class="ident" id="5144661">pos</span><span class="op" id="5144664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144670">for</span>&nbsp;<span class="op" id="5144674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144678">if</span>&nbsp;<span class="builtinfunc" id="5144681">len</span><span class="op" id="5144684">(</span><span class="ident" id="5144685">runq</span><span class="op" id="5144689">.</span><span class="ident" id="5144690">dense</span><span class="op" id="5144695">)</span>&nbsp;<span class="op" id="5144697">==</span>&nbsp;<span class="num" id="5144700">0</span>&nbsp;<span class="op" id="5144702">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144707">if</span>&nbsp;<span class="ident" id="5144710">startCond</span><span class="op" id="5144719">&amp;</span><span class="ident" id="5144720">syntax</span><span class="op" id="5144726">.</span><span class="ident" id="5144727">EmptyBeginText</span>&nbsp;<span class="op" id="5144742">!=</span>&nbsp;<span class="num" id="5144745">0</span>&nbsp;<span class="op" id="5144747">&amp;&amp;</span>&nbsp;<span class="ident" id="5144750">pos</span>&nbsp;<span class="op" id="5144754">!=</span>&nbsp;<span class="num" id="5144757">0</span>&nbsp;<span class="op" id="5144759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5144765">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144812">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144826">if</span>&nbsp;<span class="ident" id="5144829">m</span><span class="op" id="5144830">.</span><span class="ident" id="5144831">matched</span>&nbsp;<span class="op" id="5144839">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5144845">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144897">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5144906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5144911">if</span>&nbsp;<span class="builtinfunc" id="5144914">len</span><span class="op" id="5144917">(</span><span class="ident" id="5144918">m</span><span class="op" id="5144919">.</span><span class="ident" id="5144920">re</span><span class="op" id="5144922">.</span><span class="ident" id="5144923">prefix</span><span class="op" id="5144929">)</span>&nbsp;<span class="op" id="5144931">&gt;</span>&nbsp;<span class="num" id="5144933">0</span>&nbsp;<span class="op" id="5144935">&amp;&amp;</span>&nbsp;<span class="ident" id="5144938">r1</span>&nbsp;<span class="op" id="5144941">!=</span>&nbsp;<span class="ident" id="5144944">m</span><span class="op" id="5144945">.</span><span class="ident" id="5144946">re</span><span class="op" id="5144948">.</span><span class="ident" id="5144949">prefixRune</span>&nbsp;<span class="op" id="5144960">&amp;&amp;</span>&nbsp;<span class="ident" id="5144963">i</span><span class="op" id="5144964">.</span><span class="ident" id="5144965">canCheckPrefix</span><span class="op" id="5144979">(</span><span class="op" id="5144980">)</span>&nbsp;<span class="op" id="5144982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5144988">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145046">advance</span>&nbsp;<span class="op" id="5145054">:=</span>&nbsp;<span class="ident" id="5145057">i</span><span class="op" id="5145058">.</span><span class="ident" id="5145059">index</span><span class="op" id="5145064">(</span><span class="ident" id="5145065">m</span><span class="op" id="5145066">.</span><span class="ident" id="5145067">re</span><span class="op" id="5145069">,</span>&nbsp;<span class="ident" id="5145071">pos</span><span class="op" id="5145074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145080">if</span>&nbsp;<span class="ident" id="5145083">advance</span>&nbsp;<span class="op" id="5145091">&lt;</span>&nbsp;<span class="num" id="5145093">0</span>&nbsp;<span class="op" id="5145095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145102">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145118">pos</span>&nbsp;<span class="op" id="5145122">+=</span>&nbsp;<span class="ident" id="5145125">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145137">r</span><span class="op" id="5145138">,</span>&nbsp;<span class="ident" id="5145140">width</span>&nbsp;<span class="op" id="5145146">=</span>&nbsp;<span class="ident" id="5145148">i</span><span class="op" id="5145149">.</span><span class="ident" id="5145150">step</span><span class="op" id="5145154">(</span><span class="ident" id="5145155">pos</span><span class="op" id="5145158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145164">r1</span><span class="op" id="5145166">,</span>&nbsp;<span class="ident" id="5145168">width1</span>&nbsp;<span class="op" id="5145175">=</span>&nbsp;<span class="ident" id="5145177">i</span><span class="op" id="5145178">.</span><span class="ident" id="5145179">step</span><span class="op" id="5145183">(</span><span class="ident" id="5145184">pos</span>&nbsp;<span class="op" id="5145188">+</span>&nbsp;<span class="ident" id="5145190">width</span><span class="op" id="5145195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145208">if</span>&nbsp;<span class="op" id="5145211">!</span><span class="ident" id="5145212">m</span><span class="op" id="5145213">.</span><span class="ident" id="5145214">matched</span>&nbsp;<span class="op" id="5145222">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145227">if</span>&nbsp;<span class="builtinfunc" id="5145230">len</span><span class="op" id="5145233">(</span><span class="ident" id="5145234">m</span><span class="op" id="5145235">.</span><span class="ident" id="5145236">matchcap</span><span class="op" id="5145244">)</span>&nbsp;<span class="op" id="5145246">&gt;</span>&nbsp;<span class="num" id="5145248">0</span>&nbsp;<span class="op" id="5145250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145256">m</span><span class="op" id="5145257">.</span><span class="ident" id="5145258">matchcap</span><span class="op" id="5145266">[</span><span class="num" id="5145267">0</span><span class="op" id="5145268">]</span>&nbsp;<span class="op" id="5145270">=</span>&nbsp;<span class="ident" id="5145272">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145284">m</span><span class="op" id="5145285">.</span><span class="ident" id="5145286">add</span><span class="op" id="5145289">(</span><span class="ident" id="5145290">runq</span><span class="op" id="5145294">,</span>&nbsp;<span class="builtintype" id="5145296">uint32</span><span class="op" id="5145302">(</span><span class="ident" id="5145303">m</span><span class="op" id="5145304">.</span><span class="ident" id="5145305">p</span><span class="op" id="5145306">.</span><span class="ident" id="5145307">Start</span><span class="op" id="5145312">)</span><span class="op" id="5145313">,</span>&nbsp;<span class="ident" id="5145315">pos</span><span class="op" id="5145318">,</span>&nbsp;<span class="ident" id="5145320">m</span><span class="op" id="5145321">.</span><span class="ident" id="5145322">matchcap</span><span class="op" id="5145330">,</span>&nbsp;<span class="ident" id="5145332">flag</span><span class="op" id="5145336">,</span>&nbsp;<span class="builtintype" id="5145338">nil</span><span class="op" id="5145341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145345">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145349">flag</span>&nbsp;<span class="op" id="5145354">=</span>&nbsp;<span class="ident" id="5145356">syntax</span><span class="op" id="5145362">.</span><span class="ident" id="5145363">EmptyOpContext</span><span class="op" id="5145377">(</span><span class="ident" id="5145378">r</span><span class="op" id="5145379">,</span>&nbsp;<span class="ident" id="5145381">r1</span><span class="op" id="5145383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145387">m</span><span class="op" id="5145388">.</span><span class="ident" id="5145389">step</span><span class="op" id="5145393">(</span><span class="ident" id="5145394">runq</span><span class="op" id="5145398">,</span>&nbsp;<span class="ident" id="5145400">nextq</span><span class="op" id="5145405">,</span>&nbsp;<span class="ident" id="5145407">pos</span><span class="op" id="5145410">,</span>&nbsp;<span class="ident" id="5145412">pos</span><span class="op" id="5145415">+</span><span class="ident" id="5145416">width</span><span class="op" id="5145421">,</span>&nbsp;<span class="ident" id="5145423">r</span><span class="op" id="5145424">,</span>&nbsp;<span class="ident" id="5145426">flag</span><span class="op" id="5145430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145434">if</span>&nbsp;<span class="ident" id="5145437">width</span>&nbsp;<span class="op" id="5145443">==</span>&nbsp;<span class="num" id="5145446">0</span>&nbsp;<span class="op" id="5145448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145453">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145461">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145465">if</span>&nbsp;<span class="builtinfunc" id="5145468">len</span><span class="op" id="5145471">(</span><span class="ident" id="5145472">m</span><span class="op" id="5145473">.</span><span class="ident" id="5145474">matchcap</span><span class="op" id="5145482">)</span>&nbsp;<span class="op" id="5145484">==</span>&nbsp;<span class="num" id="5145487">0</span>&nbsp;<span class="op" id="5145489">&amp;&amp;</span>&nbsp;<span class="ident" id="5145492">m</span><span class="op" id="5145493">.</span><span class="ident" id="5145494">matched</span>&nbsp;<span class="op" id="5145502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5145507">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5145552">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145596">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145604">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145608">pos</span>&nbsp;<span class="op" id="5145612">+=</span>&nbsp;<span class="ident" id="5145615">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145623">r</span><span class="op" id="5145624">,</span>&nbsp;<span class="ident" id="5145626">width</span>&nbsp;<span class="op" id="5145632">=</span>&nbsp;<span class="ident" id="5145634">r1</span><span class="op" id="5145636">,</span>&nbsp;<span class="ident" id="5145638">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145647">if</span>&nbsp;<span class="ident" id="5145650">r</span>&nbsp;<span class="op" id="5145652">!=</span>&nbsp;<span class="ident" id="5145655">endOfText</span>&nbsp;<span class="op" id="5145665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145670">r1</span><span class="op" id="5145672">,</span>&nbsp;<span class="ident" id="5145674">width1</span>&nbsp;<span class="op" id="5145681">=</span>&nbsp;<span class="ident" id="5145683">i</span><span class="op" id="5145684">.</span><span class="ident" id="5145685">step</span><span class="op" id="5145689">(</span><span class="ident" id="5145690">pos</span>&nbsp;<span class="op" id="5145694">+</span>&nbsp;<span class="ident" id="5145696">width</span><span class="op" id="5145701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145705">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145709">runq</span><span class="op" id="5145713">,</span>&nbsp;<span class="ident" id="5145715">nextq</span>&nbsp;<span class="op" id="5145721">=</span>&nbsp;<span class="ident" id="5145723">nextq</span><span class="op" id="5145728">,</span>&nbsp;<span class="ident" id="5145730">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145739">m</span><span class="op" id="5145740">.</span><span class="ident" id="5145741">clear</span><span class="op" id="5145746">(</span><span class="ident" id="5145747">nextq</span><span class="op" id="5145752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145755">return</span>&nbsp;<span class="ident" id="5145762">m</span><span class="op" id="5145763">.</span><span class="ident" id="5145764">matched</span><br>
<span class="lineno"></span><span class="op" id="5145772">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5145775">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5145823">func</span>&nbsp;<span class="op" id="5145828">(</span><span class="ident" id="5145829">m</span>&nbsp;<span class="op" id="5145831">*</span><span class="ident" id="5145832">machine</span><span class="op" id="5145839">)</span>&nbsp;<span class="ident" id="5145841">clear</span><span class="op" id="5145846">(</span><span class="ident" id="5145847">q</span>&nbsp;<span class="op" id="5145849">*</span><span class="ident" id="5145850">queue</span><span class="op" id="5145855">)</span>&nbsp;<span class="op" id="5145857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145860">for</span>&nbsp;<span class="ident" id="5145864">_</span><span class="op" id="5145865">,</span>&nbsp;<span class="ident" id="5145867">d</span>&nbsp;<span class="op" id="5145869">:=</span>&nbsp;<span class="keyword" id="5145872">range</span>&nbsp;<span class="ident" id="5145878">q</span><span class="op" id="5145879">.</span><span class="ident" id="5145880">dense</span>&nbsp;<span class="op" id="5145886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5145890">if</span>&nbsp;<span class="ident" id="5145893">d</span><span class="op" id="5145894">.</span><span class="ident" id="5145895">t</span>&nbsp;<span class="op" id="5145897">!=</span>&nbsp;<span class="builtintype" id="5145900">nil</span>&nbsp;<span class="op" id="5145904">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5145909">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145927">m</span><span class="op" id="5145928">.</span><span class="ident" id="5145929">pool</span>&nbsp;<span class="op" id="5145934">=</span>&nbsp;<span class="builtinfunc" id="5145936">append</span><span class="op" id="5145942">(</span><span class="ident" id="5145943">m</span><span class="op" id="5145944">.</span><span class="ident" id="5145945">pool</span><span class="op" id="5145949">,</span>&nbsp;<span class="ident" id="5145951">d</span><span class="op" id="5145952">.</span><span class="ident" id="5145953">t</span><span class="op" id="5145954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5145961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145964">q</span><span class="op" id="5145965">.</span><span class="ident" id="5145966">dense</span>&nbsp;<span class="op" id="5145972">=</span>&nbsp;<span class="ident" id="5145974">q</span><span class="op" id="5145975">.</span><span class="ident" id="5145976">dense</span><span class="op" id="5145981">[</span><span class="op" id="5145982">:</span><span class="num" id="5145983">0</span><span class="op" id="5145984">]</span><br>
<span class="lineno">195</span><span class="op" id="5145986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5145989">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5146059">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5146106">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5146165">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5146218">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5146283">func</span>&nbsp;<span class="op" id="5146288">(</span><span class="ident" id="5146289">m</span>&nbsp;<span class="op" id="5146291">*</span><span class="ident" id="5146292">machine</span><span class="op" id="5146299">)</span>&nbsp;<span class="ident" id="5146301">step</span><span class="op" id="5146305">(</span><span class="ident" id="5146306">runq</span><span class="op" id="5146310">,</span>&nbsp;<span class="ident" id="5146312">nextq</span>&nbsp;<span class="op" id="5146318">*</span><span class="ident" id="5146319">queue</span><span class="op" id="5146324">,</span>&nbsp;<span class="ident" id="5146326">pos</span><span class="op" id="5146329">,</span>&nbsp;<span class="ident" id="5146331">nextPos</span>&nbsp;<span class="builtintype" id="5146339">int</span><span class="op" id="5146342">,</span>&nbsp;<span class="ident" id="5146344">c</span>&nbsp;<span class="builtintype" id="5146346">rune</span><span class="op" id="5146350">,</span>&nbsp;<span class="ident" id="5146352">nextCond</span>&nbsp;<span class="ident" id="5146361">syntax</span><span class="op" id="5146367">.</span><span class="ident" id="5146368">EmptyOp</span><span class="op" id="5146375">)</span>&nbsp;<span class="op" id="5146377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146380">longest</span>&nbsp;<span class="op" id="5146388">:=</span>&nbsp;<span class="ident" id="5146391">m</span><span class="op" id="5146392">.</span><span class="ident" id="5146393">re</span><span class="op" id="5146395">.</span><span class="ident" id="5146396">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146405">for</span>&nbsp;<span class="ident" id="5146409">j</span>&nbsp;<span class="op" id="5146411">:=</span>&nbsp;<span class="num" id="5146414">0</span><span class="op" id="5146415">;</span>&nbsp;<span class="ident" id="5146417">j</span>&nbsp;<span class="op" id="5146419">&lt;</span>&nbsp;<span class="builtinfunc" id="5146421">len</span><span class="op" id="5146424">(</span><span class="ident" id="5146425">runq</span><span class="op" id="5146429">.</span><span class="ident" id="5146430">dense</span><span class="op" id="5146435">)</span><span class="op" id="5146436">;</span>&nbsp;<span class="ident" id="5146438">j</span><span class="op" id="5146439">++</span>&nbsp;<span class="op" id="5146442">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146446">d</span>&nbsp;<span class="op" id="5146448">:=</span>&nbsp;<span class="op" id="5146451">&amp;</span><span class="ident" id="5146452">runq</span><span class="op" id="5146456">.</span><span class="ident" id="5146457">dense</span><span class="op" id="5146462">[</span><span class="ident" id="5146463">j</span><span class="op" id="5146464">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146468">t</span>&nbsp;<span class="op" id="5146470">:=</span>&nbsp;<span class="ident" id="5146473">d</span><span class="op" id="5146474">.</span><span class="ident" id="5146475">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146479">if</span>&nbsp;<span class="ident" id="5146482">t</span>&nbsp;<span class="op" id="5146484">==</span>&nbsp;<span class="builtintype" id="5146487">nil</span>&nbsp;<span class="op" id="5146491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146496">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5146507">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146511">if</span>&nbsp;<span class="ident" id="5146514">longest</span>&nbsp;<span class="op" id="5146522">&amp;&amp;</span>&nbsp;<span class="ident" id="5146525">m</span><span class="op" id="5146526">.</span><span class="ident" id="5146527">matched</span>&nbsp;<span class="op" id="5146535">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5146538">len</span><span class="op" id="5146541">(</span><span class="ident" id="5146542">t</span><span class="op" id="5146543">.</span><span class="builtinfunc" id="5146544">cap</span><span class="op" id="5146547">)</span>&nbsp;<span class="op" id="5146549">&gt;</span>&nbsp;<span class="num" id="5146551">0</span>&nbsp;<span class="op" id="5146553">&amp;&amp;</span>&nbsp;<span class="ident" id="5146556">m</span><span class="op" id="5146557">.</span><span class="ident" id="5146558">matchcap</span><span class="op" id="5146566">[</span><span class="num" id="5146567">0</span><span class="op" id="5146568">]</span>&nbsp;<span class="op" id="5146570">&lt;</span>&nbsp;<span class="ident" id="5146572">t</span><span class="op" id="5146573">.</span><span class="builtinfunc" id="5146574">cap</span><span class="op" id="5146577">[</span><span class="num" id="5146578">0</span><span class="op" id="5146579">]</span>&nbsp;<span class="op" id="5146581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5146586">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146602">m</span><span class="op" id="5146603">.</span><span class="ident" id="5146604">pool</span>&nbsp;<span class="op" id="5146609">=</span>&nbsp;<span class="builtinfunc" id="5146611">append</span><span class="op" id="5146617">(</span><span class="ident" id="5146618">m</span><span class="op" id="5146619">.</span><span class="ident" id="5146620">pool</span><span class="op" id="5146624">,</span>&nbsp;<span class="ident" id="5146626">t</span><span class="op" id="5146627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146632">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5146643">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146647">i</span>&nbsp;<span class="op" id="5146649">:=</span>&nbsp;<span class="ident" id="5146652">t</span><span class="op" id="5146653">.</span><span class="ident" id="5146654">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146661">add</span>&nbsp;<span class="op" id="5146665">:=</span>&nbsp;<span class="builtintype" id="5146668">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146676">switch</span>&nbsp;<span class="ident" id="5146683">i</span><span class="op" id="5146684">.</span><span class="ident" id="5146685">Op</span>&nbsp;<span class="op" id="5146688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146692">default</span><span class="op" id="5146699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5146704">panic</span><span class="op" id="5146709">(</span><span class="string" id="5146710">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5146720">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146725">case</span>&nbsp;<span class="ident" id="5146730">syntax</span><span class="op" id="5146736">.</span><span class="ident" id="5146737">InstMatch</span><span class="op" id="5146746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146751">if</span>&nbsp;<span class="builtinfunc" id="5146754">len</span><span class="op" id="5146757">(</span><span class="ident" id="5146758">t</span><span class="op" id="5146759">.</span><span class="builtinfunc" id="5146760">cap</span><span class="op" id="5146763">)</span>&nbsp;<span class="op" id="5146765">&gt;</span>&nbsp;<span class="num" id="5146767">0</span>&nbsp;<span class="op" id="5146769">&amp;&amp;</span>&nbsp;<span class="op" id="5146772">(</span><span class="op" id="5146773">!</span><span class="ident" id="5146774">longest</span>&nbsp;<span class="op" id="5146782">||</span>&nbsp;<span class="op" id="5146785">!</span><span class="ident" id="5146786">m</span><span class="op" id="5146787">.</span><span class="ident" id="5146788">matched</span>&nbsp;<span class="op" id="5146796">||</span>&nbsp;<span class="ident" id="5146799">m</span><span class="op" id="5146800">.</span><span class="ident" id="5146801">matchcap</span><span class="op" id="5146809">[</span><span class="num" id="5146810">1</span><span class="op" id="5146811">]</span>&nbsp;<span class="op" id="5146813">&lt;</span>&nbsp;<span class="ident" id="5146815">pos</span><span class="op" id="5146818">)</span>&nbsp;<span class="op" id="5146820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5146826">t</span><span class="op" id="5146827">.</span><span class="builtinfunc" id="5146828">cap</span><span class="op" id="5146831">[</span><span class="num" id="5146832">1</span><span class="op" id="5146833">]</span>&nbsp;<span class="op" id="5146835">=</span>&nbsp;<span class="ident" id="5146837">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5146845">copy</span><span class="op" id="5146849">(</span><span class="ident" id="5146850">m</span><span class="op" id="5146851">.</span><span class="ident" id="5146852">matchcap</span><span class="op" id="5146860">,</span>&nbsp;<span class="ident" id="5146862">t</span><span class="op" id="5146863">.</span><span class="builtinfunc" id="5146864">cap</span><span class="op" id="5146867">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5146872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146877">if</span>&nbsp;<span class="op" id="5146880">!</span><span class="ident" id="5146881">longest</span>&nbsp;<span class="op" id="5146889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5146895">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146956">for</span>&nbsp;<span class="ident" id="5146960">_</span><span class="op" id="5146961">,</span>&nbsp;<span class="ident" id="5146963">d</span>&nbsp;<span class="op" id="5146965">:=</span>&nbsp;<span class="keyword" id="5146968">range</span>&nbsp;<span class="ident" id="5146974">runq</span><span class="op" id="5146978">.</span><span class="ident" id="5146979">dense</span><span class="op" id="5146984">[</span><span class="ident" id="5146985">j</span><span class="op" id="5146986">+</span><span class="num" id="5146987">1</span><span class="op" id="5146988">:</span><span class="op" id="5146989">]</span>&nbsp;<span class="op" id="5146991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5146998">if</span>&nbsp;<span class="ident" id="5147001">d</span><span class="op" id="5147002">.</span><span class="ident" id="5147003">t</span>&nbsp;<span class="op" id="5147005">!=</span>&nbsp;<span class="builtintype" id="5147008">nil</span>&nbsp;<span class="op" id="5147012">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5147020">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147041">m</span><span class="op" id="5147042">.</span><span class="ident" id="5147043">pool</span>&nbsp;<span class="op" id="5147048">=</span>&nbsp;<span class="builtinfunc" id="5147050">append</span><span class="op" id="5147056">(</span><span class="ident" id="5147057">m</span><span class="op" id="5147058">.</span><span class="ident" id="5147059">pool</span><span class="op" id="5147063">,</span>&nbsp;<span class="ident" id="5147065">d</span><span class="op" id="5147066">.</span><span class="ident" id="5147067">t</span><span class="op" id="5147068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147087">runq</span><span class="op" id="5147091">.</span><span class="ident" id="5147092">dense</span>&nbsp;<span class="op" id="5147098">=</span>&nbsp;<span class="ident" id="5147100">runq</span><span class="op" id="5147104">.</span><span class="ident" id="5147105">dense</span><span class="op" id="5147110">[</span><span class="op" id="5147111">:</span><span class="num" id="5147112">0</span><span class="op" id="5147113">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147123">m</span><span class="op" id="5147124">.</span><span class="ident" id="5147125">matched</span>&nbsp;<span class="op" id="5147133">=</span>&nbsp;<span class="builtintype" id="5147135">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147143">case</span>&nbsp;<span class="ident" id="5147148">syntax</span><span class="op" id="5147154">.</span><span class="ident" id="5147155">InstRune</span><span class="op" id="5147163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147168">add</span>&nbsp;<span class="op" id="5147172">=</span>&nbsp;<span class="ident" id="5147174">i</span><span class="op" id="5147175">.</span><span class="ident" id="5147176">MatchRune</span><span class="op" id="5147185">(</span><span class="ident" id="5147186">c</span><span class="op" id="5147187">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147191">case</span>&nbsp;<span class="ident" id="5147196">syntax</span><span class="op" id="5147202">.</span><span class="ident" id="5147203">InstRune1</span><span class="op" id="5147212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147217">add</span>&nbsp;<span class="op" id="5147221">=</span>&nbsp;<span class="ident" id="5147223">c</span>&nbsp;<span class="op" id="5147225">==</span>&nbsp;<span class="ident" id="5147228">i</span><span class="op" id="5147229">.</span><span class="ident" id="5147230">Rune</span><span class="op" id="5147234">[</span><span class="num" id="5147235">0</span><span class="op" id="5147236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147240">case</span>&nbsp;<span class="ident" id="5147245">syntax</span><span class="op" id="5147251">.</span><span class="ident" id="5147252">InstRuneAny</span><span class="op" id="5147263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147268">add</span>&nbsp;<span class="op" id="5147272">=</span>&nbsp;<span class="builtintype" id="5147274">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147281">case</span>&nbsp;<span class="ident" id="5147286">syntax</span><span class="op" id="5147292">.</span><span class="ident" id="5147293">InstRuneAnyNotNL</span><span class="op" id="5147309">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147314">add</span>&nbsp;<span class="op" id="5147318">=</span>&nbsp;<span class="ident" id="5147320">c</span>&nbsp;<span class="op" id="5147322">!=</span>&nbsp;<span class="string" id="5147325">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147336">if</span>&nbsp;<span class="ident" id="5147339">add</span>&nbsp;<span class="op" id="5147343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147348">t</span>&nbsp;<span class="op" id="5147350">=</span>&nbsp;<span class="ident" id="5147352">m</span><span class="op" id="5147353">.</span><span class="ident" id="5147354">add</span><span class="op" id="5147357">(</span><span class="ident" id="5147358">nextq</span><span class="op" id="5147363">,</span>&nbsp;<span class="ident" id="5147365">i</span><span class="op" id="5147366">.</span><span class="ident" id="5147367">Out</span><span class="op" id="5147370">,</span>&nbsp;<span class="ident" id="5147372">nextPos</span><span class="op" id="5147379">,</span>&nbsp;<span class="ident" id="5147381">t</span><span class="op" id="5147382">.</span><span class="builtinfunc" id="5147383">cap</span><span class="op" id="5147386">,</span>&nbsp;<span class="ident" id="5147388">nextCond</span><span class="op" id="5147396">,</span>&nbsp;<span class="ident" id="5147398">t</span><span class="op" id="5147399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147403">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147407">if</span>&nbsp;<span class="ident" id="5147410">t</span>&nbsp;<span class="op" id="5147412">!=</span>&nbsp;<span class="builtintype" id="5147415">nil</span>&nbsp;<span class="op" id="5147419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5147424">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147440">m</span><span class="op" id="5147441">.</span><span class="ident" id="5147442">pool</span>&nbsp;<span class="op" id="5147447">=</span>&nbsp;<span class="builtinfunc" id="5147449">append</span><span class="op" id="5147455">(</span><span class="ident" id="5147456">m</span><span class="op" id="5147457">.</span><span class="ident" id="5147458">pool</span><span class="op" id="5147462">,</span>&nbsp;<span class="ident" id="5147464">t</span><span class="op" id="5147465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147472">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147475">runq</span><span class="op" id="5147479">.</span><span class="ident" id="5147480">dense</span>&nbsp;<span class="op" id="5147486">=</span>&nbsp;<span class="ident" id="5147488">runq</span><span class="op" id="5147492">.</span><span class="ident" id="5147493">dense</span><span class="op" id="5147498">[</span><span class="op" id="5147499">:</span><span class="num" id="5147500">0</span><span class="op" id="5147501">]</span><br>
<span class="lineno"></span><span class="op" id="5147503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5147506">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5147580">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5147669">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5147746">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5147763">func</span>&nbsp;<span class="op" id="5147768">(</span><span class="ident" id="5147769">m</span>&nbsp;<span class="op" id="5147771">*</span><span class="ident" id="5147772">machine</span><span class="op" id="5147779">)</span>&nbsp;<span class="ident" id="5147781">add</span><span class="op" id="5147784">(</span><span class="ident" id="5147785">q</span>&nbsp;<span class="op" id="5147787">*</span><span class="ident" id="5147788">queue</span><span class="op" id="5147793">,</span>&nbsp;<span class="ident" id="5147795">pc</span>&nbsp;<span class="builtintype" id="5147798">uint32</span><span class="op" id="5147804">,</span>&nbsp;<span class="ident" id="5147806">pos</span>&nbsp;<span class="builtintype" id="5147810">int</span><span class="op" id="5147813">,</span>&nbsp;<span class="builtinfunc" id="5147815">cap</span>&nbsp;<span class="op" id="5147819">[</span><span class="op" id="5147820">]</span><span class="builtintype" id="5147821">int</span><span class="op" id="5147824">,</span>&nbsp;<span class="ident" id="5147826">cond</span>&nbsp;<span class="ident" id="5147831">syntax</span><span class="op" id="5147837">.</span><span class="ident" id="5147838">EmptyOp</span><span class="op" id="5147845">,</span>&nbsp;<span class="ident" id="5147847">t</span>&nbsp;<span class="op" id="5147849">*</span><span class="ident" id="5147850">thread</span><span class="op" id="5147856">)</span>&nbsp;<span class="op" id="5147858">*</span><span class="ident" id="5147859">thread</span>&nbsp;<span class="op" id="5147866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147869">if</span>&nbsp;<span class="ident" id="5147872">pc</span>&nbsp;<span class="op" id="5147875">==</span>&nbsp;<span class="num" id="5147878">0</span>&nbsp;<span class="op" id="5147880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147884">return</span>&nbsp;<span class="ident" id="5147891">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147897">if</span>&nbsp;<span class="ident" id="5147900">j</span>&nbsp;<span class="op" id="5147902">:=</span>&nbsp;<span class="ident" id="5147905">q</span><span class="op" id="5147906">.</span><span class="ident" id="5147907">sparse</span><span class="op" id="5147913">[</span><span class="ident" id="5147914">pc</span><span class="op" id="5147916">]</span><span class="op" id="5147917">;</span>&nbsp;<span class="ident" id="5147919">j</span>&nbsp;<span class="op" id="5147921">&lt;</span>&nbsp;<span class="builtintype" id="5147923">uint32</span><span class="op" id="5147929">(</span><span class="builtinfunc" id="5147930">len</span><span class="op" id="5147933">(</span><span class="ident" id="5147934">q</span><span class="op" id="5147935">.</span><span class="ident" id="5147936">dense</span><span class="op" id="5147941">)</span><span class="op" id="5147942">)</span>&nbsp;<span class="op" id="5147944">&amp;&amp;</span>&nbsp;<span class="ident" id="5147947">q</span><span class="op" id="5147948">.</span><span class="ident" id="5147949">dense</span><span class="op" id="5147954">[</span><span class="ident" id="5147955">j</span><span class="op" id="5147956">]</span><span class="op" id="5147957">.</span><span class="ident" id="5147958">pc</span>&nbsp;<span class="op" id="5147961">==</span>&nbsp;<span class="ident" id="5147964">pc</span>&nbsp;<span class="op" id="5147967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5147971">return</span>&nbsp;<span class="ident" id="5147978">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5147981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5147985">j</span>&nbsp;<span class="op" id="5147987">:=</span>&nbsp;<span class="builtinfunc" id="5147990">len</span><span class="op" id="5147993">(</span><span class="ident" id="5147994">q</span><span class="op" id="5147995">.</span><span class="ident" id="5147996">dense</span><span class="op" id="5148001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148004">q</span><span class="op" id="5148005">.</span><span class="ident" id="5148006">dense</span>&nbsp;<span class="op" id="5148012">=</span>&nbsp;<span class="ident" id="5148014">q</span><span class="op" id="5148015">.</span><span class="ident" id="5148016">dense</span><span class="op" id="5148021">[</span><span class="op" id="5148022">:</span><span class="ident" id="5148023">j</span><span class="op" id="5148024">+</span><span class="num" id="5148025">1</span><span class="op" id="5148026">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148029">d</span>&nbsp;<span class="op" id="5148031">:=</span>&nbsp;<span class="op" id="5148034">&amp;</span><span class="ident" id="5148035">q</span><span class="op" id="5148036">.</span><span class="ident" id="5148037">dense</span><span class="op" id="5148042">[</span><span class="ident" id="5148043">j</span><span class="op" id="5148044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148047">d</span><span class="op" id="5148048">.</span><span class="ident" id="5148049">t</span>&nbsp;<span class="op" id="5148051">=</span>&nbsp;<span class="builtintype" id="5148053">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148058">d</span><span class="op" id="5148059">.</span><span class="ident" id="5148060">pc</span>&nbsp;<span class="op" id="5148063">=</span>&nbsp;<span class="ident" id="5148065">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148069">q</span><span class="op" id="5148070">.</span><span class="ident" id="5148071">sparse</span><span class="op" id="5148077">[</span><span class="ident" id="5148078">pc</span><span class="op" id="5148080">]</span>&nbsp;<span class="op" id="5148082">=</span>&nbsp;<span class="builtintype" id="5148084">uint32</span><span class="op" id="5148090">(</span><span class="ident" id="5148091">j</span><span class="op" id="5148092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148096">i</span>&nbsp;<span class="op" id="5148098">:=</span>&nbsp;<span class="op" id="5148101">&amp;</span><span class="ident" id="5148102">m</span><span class="op" id="5148103">.</span><span class="ident" id="5148104">p</span><span class="op" id="5148105">.</span><span class="ident" id="5148106">Inst</span><span class="op" id="5148110">[</span><span class="ident" id="5148111">pc</span><span class="op" id="5148113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148116">switch</span>&nbsp;<span class="ident" id="5148123">i</span><span class="op" id="5148124">.</span><span class="ident" id="5148125">Op</span>&nbsp;<span class="op" id="5148128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148131">default</span><span class="op" id="5148138">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5148142">panic</span><span class="op" id="5148147">(</span><span class="string" id="5148148">&#34;unhandled&#34;</span><span class="op" id="5148159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148162">case</span>&nbsp;<span class="ident" id="5148167">syntax</span><span class="op" id="5148173">.</span><span class="ident" id="5148174">InstFail</span><span class="op" id="5148182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5148186">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148198">case</span>&nbsp;<span class="ident" id="5148203">syntax</span><span class="op" id="5148209">.</span><span class="ident" id="5148210">InstAlt</span><span class="op" id="5148217">,</span>&nbsp;<span class="ident" id="5148219">syntax</span><span class="op" id="5148225">.</span><span class="ident" id="5148226">InstAltMatch</span><span class="op" id="5148238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148242">t</span>&nbsp;<span class="op" id="5148244">=</span>&nbsp;<span class="ident" id="5148246">m</span><span class="op" id="5148247">.</span><span class="ident" id="5148248">add</span><span class="op" id="5148251">(</span><span class="ident" id="5148252">q</span><span class="op" id="5148253">,</span>&nbsp;<span class="ident" id="5148255">i</span><span class="op" id="5148256">.</span><span class="ident" id="5148257">Out</span><span class="op" id="5148260">,</span>&nbsp;<span class="ident" id="5148262">pos</span><span class="op" id="5148265">,</span>&nbsp;<span class="builtinfunc" id="5148267">cap</span><span class="op" id="5148270">,</span>&nbsp;<span class="ident" id="5148272">cond</span><span class="op" id="5148276">,</span>&nbsp;<span class="ident" id="5148278">t</span><span class="op" id="5148279">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148283">t</span>&nbsp;<span class="op" id="5148285">=</span>&nbsp;<span class="ident" id="5148287">m</span><span class="op" id="5148288">.</span><span class="ident" id="5148289">add</span><span class="op" id="5148292">(</span><span class="ident" id="5148293">q</span><span class="op" id="5148294">,</span>&nbsp;<span class="ident" id="5148296">i</span><span class="op" id="5148297">.</span><span class="ident" id="5148298">Arg</span><span class="op" id="5148301">,</span>&nbsp;<span class="ident" id="5148303">pos</span><span class="op" id="5148306">,</span>&nbsp;<span class="builtinfunc" id="5148308">cap</span><span class="op" id="5148311">,</span>&nbsp;<span class="ident" id="5148313">cond</span><span class="op" id="5148317">,</span>&nbsp;<span class="ident" id="5148319">t</span><span class="op" id="5148320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148323">case</span>&nbsp;<span class="ident" id="5148328">syntax</span><span class="op" id="5148334">.</span><span class="ident" id="5148335">InstEmptyWidth</span><span class="op" id="5148349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148353">if</span>&nbsp;<span class="ident" id="5148356">syntax</span><span class="op" id="5148362">.</span><span class="ident" id="5148363">EmptyOp</span><span class="op" id="5148370">(</span><span class="ident" id="5148371">i</span><span class="op" id="5148372">.</span><span class="ident" id="5148373">Arg</span><span class="op" id="5148376">)</span><span class="op" id="5148377">&amp;^</span><span class="ident" id="5148379">cond</span>&nbsp;<span class="op" id="5148384">==</span>&nbsp;<span class="num" id="5148387">0</span>&nbsp;<span class="op" id="5148389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148394">t</span>&nbsp;<span class="op" id="5148396">=</span>&nbsp;<span class="ident" id="5148398">m</span><span class="op" id="5148399">.</span><span class="ident" id="5148400">add</span><span class="op" id="5148403">(</span><span class="ident" id="5148404">q</span><span class="op" id="5148405">,</span>&nbsp;<span class="ident" id="5148407">i</span><span class="op" id="5148408">.</span><span class="ident" id="5148409">Out</span><span class="op" id="5148412">,</span>&nbsp;<span class="ident" id="5148414">pos</span><span class="op" id="5148417">,</span>&nbsp;<span class="builtinfunc" id="5148419">cap</span><span class="op" id="5148422">,</span>&nbsp;<span class="ident" id="5148424">cond</span><span class="op" id="5148428">,</span>&nbsp;<span class="ident" id="5148430">t</span><span class="op" id="5148431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148435">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148438">case</span>&nbsp;<span class="ident" id="5148443">syntax</span><span class="op" id="5148449">.</span><span class="ident" id="5148450">InstNop</span><span class="op" id="5148457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148461">t</span>&nbsp;<span class="op" id="5148463">=</span>&nbsp;<span class="ident" id="5148465">m</span><span class="op" id="5148466">.</span><span class="ident" id="5148467">add</span><span class="op" id="5148470">(</span><span class="ident" id="5148471">q</span><span class="op" id="5148472">,</span>&nbsp;<span class="ident" id="5148474">i</span><span class="op" id="5148475">.</span><span class="ident" id="5148476">Out</span><span class="op" id="5148479">,</span>&nbsp;<span class="ident" id="5148481">pos</span><span class="op" id="5148484">,</span>&nbsp;<span class="builtinfunc" id="5148486">cap</span><span class="op" id="5148489">,</span>&nbsp;<span class="ident" id="5148491">cond</span><span class="op" id="5148495">,</span>&nbsp;<span class="ident" id="5148497">t</span><span class="op" id="5148498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148501">case</span>&nbsp;<span class="ident" id="5148506">syntax</span><span class="op" id="5148512">.</span><span class="ident" id="5148513">InstCapture</span><span class="op" id="5148524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148528">if</span>&nbsp;<span class="builtintype" id="5148531">int</span><span class="op" id="5148534">(</span><span class="ident" id="5148535">i</span><span class="op" id="5148536">.</span><span class="ident" id="5148537">Arg</span><span class="op" id="5148540">)</span>&nbsp;<span class="op" id="5148542">&lt;</span>&nbsp;<span class="builtinfunc" id="5148544">len</span><span class="op" id="5148547">(</span><span class="builtinfunc" id="5148548">cap</span><span class="op" id="5148551">)</span>&nbsp;<span class="op" id="5148553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148558">opos</span>&nbsp;<span class="op" id="5148563">:=</span>&nbsp;<span class="builtinfunc" id="5148566">cap</span><span class="op" id="5148569">[</span><span class="ident" id="5148570">i</span><span class="op" id="5148571">.</span><span class="ident" id="5148572">Arg</span><span class="op" id="5148575">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5148580">cap</span><span class="op" id="5148583">[</span><span class="ident" id="5148584">i</span><span class="op" id="5148585">.</span><span class="ident" id="5148586">Arg</span><span class="op" id="5148589">]</span>&nbsp;<span class="op" id="5148591">=</span>&nbsp;<span class="ident" id="5148593">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148600">m</span><span class="op" id="5148601">.</span><span class="ident" id="5148602">add</span><span class="op" id="5148605">(</span><span class="ident" id="5148606">q</span><span class="op" id="5148607">,</span>&nbsp;<span class="ident" id="5148609">i</span><span class="op" id="5148610">.</span><span class="ident" id="5148611">Out</span><span class="op" id="5148614">,</span>&nbsp;<span class="ident" id="5148616">pos</span><span class="op" id="5148619">,</span>&nbsp;<span class="builtinfunc" id="5148621">cap</span><span class="op" id="5148624">,</span>&nbsp;<span class="ident" id="5148626">cond</span><span class="op" id="5148630">,</span>&nbsp;<span class="builtintype" id="5148632">nil</span><span class="op" id="5148635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5148640">cap</span><span class="op" id="5148643">[</span><span class="ident" id="5148644">i</span><span class="op" id="5148645">.</span><span class="ident" id="5148646">Arg</span><span class="op" id="5148649">]</span>&nbsp;<span class="op" id="5148651">=</span>&nbsp;<span class="ident" id="5148653">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148660">}</span>&nbsp;<span class="keyword" id="5148662">else</span>&nbsp;<span class="op" id="5148667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148672">t</span>&nbsp;<span class="op" id="5148674">=</span>&nbsp;<span class="ident" id="5148676">m</span><span class="op" id="5148677">.</span><span class="ident" id="5148678">add</span><span class="op" id="5148681">(</span><span class="ident" id="5148682">q</span><span class="op" id="5148683">,</span>&nbsp;<span class="ident" id="5148685">i</span><span class="op" id="5148686">.</span><span class="ident" id="5148687">Out</span><span class="op" id="5148690">,</span>&nbsp;<span class="ident" id="5148692">pos</span><span class="op" id="5148695">,</span>&nbsp;<span class="builtinfunc" id="5148697">cap</span><span class="op" id="5148700">,</span>&nbsp;<span class="ident" id="5148702">cond</span><span class="op" id="5148706">,</span>&nbsp;<span class="ident" id="5148708">t</span><span class="op" id="5148709">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148716">case</span>&nbsp;<span class="ident" id="5148721">syntax</span><span class="op" id="5148727">.</span><span class="ident" id="5148728">InstMatch</span><span class="op" id="5148737">,</span>&nbsp;<span class="ident" id="5148739">syntax</span><span class="op" id="5148745">.</span><span class="ident" id="5148746">InstRune</span><span class="op" id="5148754">,</span>&nbsp;<span class="ident" id="5148756">syntax</span><span class="op" id="5148762">.</span><span class="ident" id="5148763">InstRune1</span><span class="op" id="5148772">,</span>&nbsp;<span class="ident" id="5148774">syntax</span><span class="op" id="5148780">.</span><span class="ident" id="5148781">InstRuneAny</span><span class="op" id="5148792">,</span>&nbsp;<span class="ident" id="5148794">syntax</span><span class="op" id="5148800">.</span><span class="ident" id="5148801">InstRuneAnyNotNL</span><span class="op" id="5148817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148821">if</span>&nbsp;<span class="ident" id="5148824">t</span>&nbsp;<span class="op" id="5148826">==</span>&nbsp;<span class="builtintype" id="5148829">nil</span>&nbsp;<span class="op" id="5148833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148838">t</span>&nbsp;<span class="op" id="5148840">=</span>&nbsp;<span class="ident" id="5148842">m</span><span class="op" id="5148843">.</span><span class="ident" id="5148844">alloc</span><span class="op" id="5148849">(</span><span class="ident" id="5148850">i</span><span class="op" id="5148851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148855">}</span>&nbsp;<span class="keyword" id="5148857">else</span>&nbsp;<span class="op" id="5148862">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148867">t</span><span class="op" id="5148868">.</span><span class="ident" id="5148869">inst</span>&nbsp;<span class="op" id="5148874">=</span>&nbsp;<span class="ident" id="5148876">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148884">if</span>&nbsp;<span class="builtinfunc" id="5148887">len</span><span class="op" id="5148890">(</span><span class="builtinfunc" id="5148891">cap</span><span class="op" id="5148894">)</span>&nbsp;<span class="op" id="5148896">&gt;</span>&nbsp;<span class="num" id="5148898">0</span>&nbsp;<span class="op" id="5148900">&amp;&amp;</span>&nbsp;<span class="op" id="5148903">&amp;</span><span class="ident" id="5148904">t</span><span class="op" id="5148905">.</span><span class="builtinfunc" id="5148906">cap</span><span class="op" id="5148909">[</span><span class="num" id="5148910">0</span><span class="op" id="5148911">]</span>&nbsp;<span class="op" id="5148913">!=</span>&nbsp;<span class="op" id="5148916">&amp;</span><span class="builtinfunc" id="5148917">cap</span><span class="op" id="5148920">[</span><span class="num" id="5148921">0</span><span class="op" id="5148922">]</span>&nbsp;<span class="op" id="5148924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5148929">copy</span><span class="op" id="5148933">(</span><span class="ident" id="5148934">t</span><span class="op" id="5148935">.</span><span class="builtinfunc" id="5148936">cap</span><span class="op" id="5148939">,</span>&nbsp;<span class="builtinfunc" id="5148941">cap</span><span class="op" id="5148944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148948">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148952">d</span><span class="op" id="5148953">.</span><span class="ident" id="5148954">t</span>&nbsp;<span class="op" id="5148956">=</span>&nbsp;<span class="ident" id="5148958">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5148962">t</span>&nbsp;<span class="op" id="5148964">=</span>&nbsp;<span class="builtintype" id="5148966">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5148971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5148974">return</span>&nbsp;<span class="ident" id="5148981">t</span><br>
<span class="lineno"></span><span class="op" id="5148983">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5148986">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5149046">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5149087">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5149140">func</span>&nbsp;<span class="op" id="5149145">(</span><span class="ident" id="5149146">m</span>&nbsp;<span class="op" id="5149148">*</span><span class="ident" id="5149149">machine</span><span class="op" id="5149156">)</span>&nbsp;<span class="ident" id="5149158">onepass</span><span class="op" id="5149165">(</span><span class="ident" id="5149166">i</span>&nbsp;<span class="ident" id="5149168">input</span><span class="op" id="5149173">,</span>&nbsp;<span class="ident" id="5149175">pos</span>&nbsp;<span class="builtintype" id="5149179">int</span><span class="op" id="5149182">)</span>&nbsp;<span class="builtintype" id="5149184">bool</span>&nbsp;<span class="op" id="5149189">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149192">startCond</span>&nbsp;<span class="op" id="5149202">:=</span>&nbsp;<span class="ident" id="5149205">m</span><span class="op" id="5149206">.</span><span class="ident" id="5149207">re</span><span class="op" id="5149209">.</span><span class="ident" id="5149210">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149216">if</span>&nbsp;<span class="ident" id="5149219">startCond</span>&nbsp;<span class="op" id="5149229">==</span>&nbsp;<span class="op" id="5149232">^</span><span class="ident" id="5149233">syntax</span><span class="op" id="5149239">.</span><span class="ident" id="5149240">EmptyOp</span><span class="op" id="5149247">(</span><span class="num" id="5149248">0</span><span class="op" id="5149249">)</span>&nbsp;<span class="op" id="5149251">{</span>&nbsp;<span class="comment" id="5149253">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149269">return</span>&nbsp;<span class="builtintype" id="5149276">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5149283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149286">m</span><span class="op" id="5149287">.</span><span class="ident" id="5149288">matched</span>&nbsp;<span class="op" id="5149296">=</span>&nbsp;<span class="builtintype" id="5149298">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149305">for</span>&nbsp;<span class="ident" id="5149309">i</span>&nbsp;<span class="op" id="5149311">:=</span>&nbsp;<span class="keyword" id="5149314">range</span>&nbsp;<span class="ident" id="5149320">m</span><span class="op" id="5149321">.</span><span class="ident" id="5149322">matchcap</span>&nbsp;<span class="op" id="5149331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149335">m</span><span class="op" id="5149336">.</span><span class="ident" id="5149337">matchcap</span><span class="op" id="5149345">[</span><span class="ident" id="5149346">i</span><span class="op" id="5149347">]</span>&nbsp;<span class="op" id="5149349">=</span>&nbsp;<span class="op" id="5149351">-</span><span class="num" id="5149352">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5149355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149358">r</span><span class="op" id="5149359">,</span>&nbsp;<span class="ident" id="5149361">r1</span>&nbsp;<span class="op" id="5149364">:=</span>&nbsp;<span class="ident" id="5149367">endOfText</span><span class="op" id="5149376">,</span>&nbsp;<span class="ident" id="5149378">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149389">width</span><span class="op" id="5149394">,</span>&nbsp;<span class="ident" id="5149396">width1</span>&nbsp;<span class="op" id="5149403">:=</span>&nbsp;<span class="num" id="5149406">0</span><span class="op" id="5149407">,</span>&nbsp;<span class="num" id="5149409">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149412">r</span><span class="op" id="5149413">,</span>&nbsp;<span class="ident" id="5149415">width</span>&nbsp;<span class="op" id="5149421">=</span>&nbsp;<span class="ident" id="5149423">i</span><span class="op" id="5149424">.</span><span class="ident" id="5149425">step</span><span class="op" id="5149429">(</span><span class="ident" id="5149430">pos</span><span class="op" id="5149433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149436">if</span>&nbsp;<span class="ident" id="5149439">r</span>&nbsp;<span class="op" id="5149441">!=</span>&nbsp;<span class="ident" id="5149444">endOfText</span>&nbsp;<span class="op" id="5149454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149458">r1</span><span class="op" id="5149460">,</span>&nbsp;<span class="ident" id="5149462">width1</span>&nbsp;<span class="op" id="5149469">=</span>&nbsp;<span class="ident" id="5149471">i</span><span class="op" id="5149472">.</span><span class="ident" id="5149473">step</span><span class="op" id="5149477">(</span><span class="ident" id="5149478">pos</span>&nbsp;<span class="op" id="5149482">+</span>&nbsp;<span class="ident" id="5149484">width</span><span class="op" id="5149489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5149492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149495">var</span>&nbsp;<span class="ident" id="5149499">flag</span>&nbsp;<span class="ident" id="5149504">syntax</span><span class="op" id="5149510">.</span><span class="ident" id="5149511">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149520">if</span>&nbsp;<span class="ident" id="5149523">pos</span>&nbsp;<span class="op" id="5149527">==</span>&nbsp;<span class="num" id="5149530">0</span>&nbsp;<span class="op" id="5149532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149536">flag</span>&nbsp;<span class="op" id="5149541">=</span>&nbsp;<span class="ident" id="5149543">syntax</span><span class="op" id="5149549">.</span><span class="ident" id="5149550">EmptyOpContext</span><span class="op" id="5149564">(</span><span class="op" id="5149565">-</span><span class="num" id="5149566">1</span><span class="op" id="5149567">,</span>&nbsp;<span class="ident" id="5149569">r</span><span class="op" id="5149570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5149573">}</span>&nbsp;<span class="keyword" id="5149575">else</span>&nbsp;<span class="op" id="5149580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149584">flag</span>&nbsp;<span class="op" id="5149589">=</span>&nbsp;<span class="ident" id="5149591">i</span><span class="op" id="5149592">.</span><span class="ident" id="5149593">context</span><span class="op" id="5149600">(</span><span class="ident" id="5149601">pos</span><span class="op" id="5149604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5149607">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149610">pc</span>&nbsp;<span class="op" id="5149613">:=</span>&nbsp;<span class="ident" id="5149616">m</span><span class="op" id="5149617">.</span><span class="ident" id="5149618">op</span><span class="op" id="5149620">.</span><span class="ident" id="5149621">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149628">inst</span>&nbsp;<span class="op" id="5149633">:=</span>&nbsp;<span class="ident" id="5149636">m</span><span class="op" id="5149637">.</span><span class="ident" id="5149638">op</span><span class="op" id="5149640">.</span><span class="ident" id="5149641">Inst</span><span class="op" id="5149645">[</span><span class="ident" id="5149646">pc</span><span class="op" id="5149648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5149651">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149706">if</span>&nbsp;<span class="ident" id="5149709">pos</span>&nbsp;<span class="op" id="5149713">==</span>&nbsp;<span class="num" id="5149716">0</span>&nbsp;<span class="op" id="5149718">&amp;&amp;</span>&nbsp;<span class="ident" id="5149721">syntax</span><span class="op" id="5149727">.</span><span class="ident" id="5149728">EmptyOp</span><span class="op" id="5149735">(</span><span class="ident" id="5149736">inst</span><span class="op" id="5149740">.</span><span class="ident" id="5149741">Arg</span><span class="op" id="5149744">)</span><span class="op" id="5149745">&amp;^</span><span class="ident" id="5149747">flag</span>&nbsp;<span class="op" id="5149752">==</span>&nbsp;<span class="num" id="5149755">0</span>&nbsp;<span class="op" id="5149757">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5149762">len</span><span class="op" id="5149765">(</span><span class="ident" id="5149766">m</span><span class="op" id="5149767">.</span><span class="ident" id="5149768">re</span><span class="op" id="5149770">.</span><span class="ident" id="5149771">prefix</span><span class="op" id="5149777">)</span>&nbsp;<span class="op" id="5149779">&gt;</span>&nbsp;<span class="num" id="5149781">0</span>&nbsp;<span class="op" id="5149783">&amp;&amp;</span>&nbsp;<span class="ident" id="5149786">i</span><span class="op" id="5149787">.</span><span class="ident" id="5149788">canCheckPrefix</span><span class="op" id="5149802">(</span><span class="op" id="5149803">)</span>&nbsp;<span class="op" id="5149805">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5149809">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5149865">if</span>&nbsp;<span class="ident" id="5149868">i</span><span class="op" id="5149869">.</span><span class="ident" id="5149870">hasPrefix</span><span class="op" id="5149879">(</span><span class="ident" id="5149880">m</span><span class="op" id="5149881">.</span><span class="ident" id="5149882">re</span><span class="op" id="5149884">)</span>&nbsp;<span class="op" id="5149886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149891">pos</span>&nbsp;<span class="op" id="5149895">+=</span>&nbsp;<span class="builtinfunc" id="5149898">len</span><span class="op" id="5149901">(</span><span class="ident" id="5149902">m</span><span class="op" id="5149903">.</span><span class="ident" id="5149904">re</span><span class="op" id="5149906">.</span><span class="ident" id="5149907">prefix</span><span class="op" id="5149913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149918">r</span><span class="op" id="5149919">,</span>&nbsp;<span class="ident" id="5149921">width</span>&nbsp;<span class="op" id="5149927">=</span>&nbsp;<span class="ident" id="5149929">i</span><span class="op" id="5149930">.</span><span class="ident" id="5149931">step</span><span class="op" id="5149935">(</span><span class="ident" id="5149936">pos</span><span class="op" id="5149939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149944">r1</span><span class="op" id="5149946">,</span>&nbsp;<span class="ident" id="5149948">width1</span>&nbsp;<span class="op" id="5149955">=</span>&nbsp;<span class="ident" id="5149957">i</span><span class="op" id="5149958">.</span><span class="ident" id="5149959">step</span><span class="op" id="5149963">(</span><span class="ident" id="5149964">pos</span>&nbsp;<span class="op" id="5149968">+</span>&nbsp;<span class="ident" id="5149970">width</span><span class="op" id="5149975">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149980">flag</span>&nbsp;<span class="op" id="5149985">=</span>&nbsp;<span class="ident" id="5149987">i</span><span class="op" id="5149988">.</span><span class="ident" id="5149989">context</span><span class="op" id="5149996">(</span><span class="ident" id="5149997">pos</span><span class="op" id="5150000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150005">pc</span>&nbsp;<span class="op" id="5150008">=</span>&nbsp;<span class="builtintype" id="5150010">int</span><span class="op" id="5150013">(</span><span class="ident" id="5150014">m</span><span class="op" id="5150015">.</span><span class="ident" id="5150016">re</span><span class="op" id="5150018">.</span><span class="ident" id="5150019">prefixEnd</span><span class="op" id="5150028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150032">}</span>&nbsp;<span class="keyword" id="5150034">else</span>&nbsp;<span class="op" id="5150039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150044">return</span>&nbsp;<span class="ident" id="5150051">m</span><span class="op" id="5150052">.</span><span class="ident" id="5150053">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150063">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150069">for</span>&nbsp;<span class="op" id="5150073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150077">inst</span>&nbsp;<span class="op" id="5150082">=</span>&nbsp;<span class="ident" id="5150084">m</span><span class="op" id="5150085">.</span><span class="ident" id="5150086">op</span><span class="op" id="5150088">.</span><span class="ident" id="5150089">Inst</span><span class="op" id="5150093">[</span><span class="ident" id="5150094">pc</span><span class="op" id="5150096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150100">pc</span>&nbsp;<span class="op" id="5150103">=</span>&nbsp;<span class="builtintype" id="5150105">int</span><span class="op" id="5150108">(</span><span class="ident" id="5150109">inst</span><span class="op" id="5150113">.</span><span class="ident" id="5150114">Out</span><span class="op" id="5150117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150121">switch</span>&nbsp;<span class="ident" id="5150128">inst</span><span class="op" id="5150132">.</span><span class="ident" id="5150133">Op</span>&nbsp;<span class="op" id="5150136">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150140">default</span><span class="op" id="5150147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5150152">panic</span><span class="op" id="5150157">(</span><span class="string" id="5150158">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5150168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150172">case</span>&nbsp;<span class="ident" id="5150177">syntax</span><span class="op" id="5150183">.</span><span class="ident" id="5150184">InstMatch</span><span class="op" id="5150193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150198">m</span><span class="op" id="5150199">.</span><span class="ident" id="5150200">matched</span>&nbsp;<span class="op" id="5150208">=</span>&nbsp;<span class="builtintype" id="5150210">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150218">if</span>&nbsp;<span class="builtinfunc" id="5150221">len</span><span class="op" id="5150224">(</span><span class="ident" id="5150225">m</span><span class="op" id="5150226">.</span><span class="ident" id="5150227">matchcap</span><span class="op" id="5150235">)</span>&nbsp;<span class="op" id="5150237">&gt;</span>&nbsp;<span class="num" id="5150239">0</span>&nbsp;<span class="op" id="5150241">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150247">m</span><span class="op" id="5150248">.</span><span class="ident" id="5150249">matchcap</span><span class="op" id="5150257">[</span><span class="num" id="5150258">0</span><span class="op" id="5150259">]</span>&nbsp;<span class="op" id="5150261">=</span>&nbsp;<span class="num" id="5150263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150269">m</span><span class="op" id="5150270">.</span><span class="ident" id="5150271">matchcap</span><span class="op" id="5150279">[</span><span class="num" id="5150280">1</span><span class="op" id="5150281">]</span>&nbsp;<span class="op" id="5150283">=</span>&nbsp;<span class="ident" id="5150285">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150297">return</span>&nbsp;<span class="ident" id="5150304">m</span><span class="op" id="5150305">.</span><span class="ident" id="5150306">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150316">case</span>&nbsp;<span class="ident" id="5150321">syntax</span><span class="op" id="5150327">.</span><span class="ident" id="5150328">InstRune</span><span class="op" id="5150336">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150341">if</span>&nbsp;<span class="op" id="5150344">!</span><span class="ident" id="5150345">inst</span><span class="op" id="5150349">.</span><span class="ident" id="5150350">MatchRune</span><span class="op" id="5150359">(</span><span class="ident" id="5150360">r</span><span class="op" id="5150361">)</span>&nbsp;<span class="op" id="5150363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150369">return</span>&nbsp;<span class="ident" id="5150376">m</span><span class="op" id="5150377">.</span><span class="ident" id="5150378">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150393">case</span>&nbsp;<span class="ident" id="5150398">syntax</span><span class="op" id="5150404">.</span><span class="ident" id="5150405">InstRune1</span><span class="op" id="5150414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150419">if</span>&nbsp;<span class="ident" id="5150422">r</span>&nbsp;<span class="op" id="5150424">!=</span>&nbsp;<span class="ident" id="5150427">inst</span><span class="op" id="5150431">.</span><span class="ident" id="5150432">Rune</span><span class="op" id="5150436">[</span><span class="num" id="5150437">0</span><span class="op" id="5150438">]</span>&nbsp;<span class="op" id="5150440">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150446">return</span>&nbsp;<span class="ident" id="5150453">m</span><span class="op" id="5150454">.</span><span class="ident" id="5150455">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150470">case</span>&nbsp;<span class="ident" id="5150475">syntax</span><span class="op" id="5150481">.</span><span class="ident" id="5150482">InstRuneAny</span><span class="op" id="5150493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5150498">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150511">case</span>&nbsp;<span class="ident" id="5150516">syntax</span><span class="op" id="5150522">.</span><span class="ident" id="5150523">InstRuneAnyNotNL</span><span class="op" id="5150539">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150544">if</span>&nbsp;<span class="ident" id="5150547">r</span>&nbsp;<span class="op" id="5150549">==</span>&nbsp;<span class="string" id="5150552">&#39;\n&#39;</span>&nbsp;<span class="op" id="5150557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150563">return</span>&nbsp;<span class="ident" id="5150570">m</span><span class="op" id="5150571">.</span><span class="ident" id="5150572">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5150587">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150654">case</span>&nbsp;<span class="ident" id="5150659">syntax</span><span class="op" id="5150665">.</span><span class="ident" id="5150666">InstAlt</span><span class="op" id="5150673">,</span>&nbsp;<span class="ident" id="5150675">syntax</span><span class="op" id="5150681">.</span><span class="ident" id="5150682">InstAltMatch</span><span class="op" id="5150694">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5150699">pc</span>&nbsp;<span class="op" id="5150702">=</span>&nbsp;<span class="builtintype" id="5150704">int</span><span class="op" id="5150707">(</span><span class="ident" id="5150708">onePassNext</span><span class="op" id="5150719">(</span><span class="op" id="5150720">&amp;</span><span class="ident" id="5150721">inst</span><span class="op" id="5150725">,</span>&nbsp;<span class="ident" id="5150727">r</span><span class="op" id="5150728">)</span><span class="op" id="5150729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150734">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150745">case</span>&nbsp;<span class="ident" id="5150750">syntax</span><span class="op" id="5150756">.</span><span class="ident" id="5150757">InstFail</span><span class="op" id="5150765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150770">return</span>&nbsp;<span class="ident" id="5150777">m</span><span class="op" id="5150778">.</span><span class="ident" id="5150779">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150789">case</span>&nbsp;<span class="ident" id="5150794">syntax</span><span class="op" id="5150800">.</span><span class="ident" id="5150801">InstNop</span><span class="op" id="5150808">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150813">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150824">case</span>&nbsp;<span class="ident" id="5150829">syntax</span><span class="op" id="5150835">.</span><span class="ident" id="5150836">InstEmptyWidth</span><span class="op" id="5150850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150855">if</span>&nbsp;<span class="ident" id="5150858">syntax</span><span class="op" id="5150864">.</span><span class="ident" id="5150865">EmptyOp</span><span class="op" id="5150872">(</span><span class="ident" id="5150873">inst</span><span class="op" id="5150877">.</span><span class="ident" id="5150878">Arg</span><span class="op" id="5150881">)</span><span class="op" id="5150882">&amp;^</span><span class="ident" id="5150884">flag</span>&nbsp;<span class="op" id="5150889">!=</span>&nbsp;<span class="num" id="5150892">0</span>&nbsp;<span class="op" id="5150894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150900">return</span>&nbsp;<span class="ident" id="5150907">m</span><span class="op" id="5150908">.</span><span class="ident" id="5150909">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5150920">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150925">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150936">case</span>&nbsp;<span class="ident" id="5150941">syntax</span><span class="op" id="5150947">.</span><span class="ident" id="5150948">InstCapture</span><span class="op" id="5150959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5150964">if</span>&nbsp;<span class="builtintype" id="5150967">int</span><span class="op" id="5150970">(</span><span class="ident" id="5150971">inst</span><span class="op" id="5150975">.</span><span class="ident" id="5150976">Arg</span><span class="op" id="5150979">)</span>&nbsp;<span class="op" id="5150981">&lt;</span>&nbsp;<span class="builtinfunc" id="5150983">len</span><span class="op" id="5150986">(</span><span class="ident" id="5150987">m</span><span class="op" id="5150988">.</span><span class="ident" id="5150989">matchcap</span><span class="op" id="5150997">)</span>&nbsp;<span class="op" id="5150999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151005">m</span><span class="op" id="5151006">.</span><span class="ident" id="5151007">matchcap</span><span class="op" id="5151015">[</span><span class="ident" id="5151016">inst</span><span class="op" id="5151020">.</span><span class="ident" id="5151021">Arg</span><span class="op" id="5151024">]</span>&nbsp;<span class="op" id="5151026">=</span>&nbsp;<span class="ident" id="5151028">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151035">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151040">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151055">if</span>&nbsp;<span class="ident" id="5151058">width</span>&nbsp;<span class="op" id="5151064">==</span>&nbsp;<span class="num" id="5151067">0</span>&nbsp;<span class="op" id="5151069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151074">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151082">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151086">flag</span>&nbsp;<span class="op" id="5151091">=</span>&nbsp;<span class="ident" id="5151093">syntax</span><span class="op" id="5151099">.</span><span class="ident" id="5151100">EmptyOpContext</span><span class="op" id="5151114">(</span><span class="ident" id="5151115">r</span><span class="op" id="5151116">,</span>&nbsp;<span class="ident" id="5151118">r1</span><span class="op" id="5151120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151124">pos</span>&nbsp;<span class="op" id="5151128">+=</span>&nbsp;<span class="ident" id="5151131">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151139">r</span><span class="op" id="5151140">,</span>&nbsp;<span class="ident" id="5151142">width</span>&nbsp;<span class="op" id="5151148">=</span>&nbsp;<span class="ident" id="5151150">r1</span><span class="op" id="5151152">,</span>&nbsp;<span class="ident" id="5151154">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151163">if</span>&nbsp;<span class="ident" id="5151166">r</span>&nbsp;<span class="op" id="5151168">!=</span>&nbsp;<span class="ident" id="5151171">endOfText</span>&nbsp;<span class="op" id="5151181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151186">r1</span><span class="op" id="5151188">,</span>&nbsp;<span class="ident" id="5151190">width1</span>&nbsp;<span class="op" id="5151197">=</span>&nbsp;<span class="ident" id="5151199">i</span><span class="op" id="5151200">.</span><span class="ident" id="5151201">step</span><span class="op" id="5151205">(</span><span class="ident" id="5151206">pos</span>&nbsp;<span class="op" id="5151210">+</span>&nbsp;<span class="ident" id="5151212">width</span><span class="op" id="5151217">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151227">return</span>&nbsp;<span class="ident" id="5151234">m</span><span class="op" id="5151235">.</span><span class="ident" id="5151236">matched</span><br>
<span class="lineno"></span><span class="op" id="5151244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5151247">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5151286">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5151326">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5151384">var</span>&nbsp;<span class="ident" id="5151388">empty</span>&nbsp;<span class="op" id="5151394">=</span>&nbsp;<span class="builtinfunc" id="5151396">make</span><span class="op" id="5151400">(</span><span class="op" id="5151401">[</span><span class="op" id="5151402">]</span><span class="builtintype" id="5151403">int</span><span class="op" id="5151406">,</span>&nbsp;<span class="num" id="5151408">0</span><span class="op" id="5151409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5151412">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5151475">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5151514">func</span>&nbsp;<span class="op" id="5151519">(</span><span class="ident" id="5151520">re</span>&nbsp;<span class="op" id="5151523">*</span><span class="ident" id="5151524">Regexp</span><span class="op" id="5151530">)</span>&nbsp;<span class="ident" id="5151532">doExecute</span><span class="op" id="5151541">(</span><span class="ident" id="5151542">r</span>&nbsp;<span class="ident" id="5151544">io</span><span class="op" id="5151546">.</span><span class="ident" id="5151547">RuneReader</span><span class="op" id="5151557">,</span>&nbsp;<span class="ident" id="5151559">b</span>&nbsp;<span class="op" id="5151561">[</span><span class="op" id="5151562">]</span><span class="builtintype" id="5151563">byte</span><span class="op" id="5151567">,</span>&nbsp;<span class="ident" id="5151569">s</span>&nbsp;<span class="builtintype" id="5151571">string</span><span class="op" id="5151577">,</span>&nbsp;<span class="ident" id="5151579">pos</span>&nbsp;<span class="builtintype" id="5151583">int</span><span class="op" id="5151586">,</span>&nbsp;<span class="ident" id="5151588">ncap</span>&nbsp;<span class="builtintype" id="5151593">int</span><span class="op" id="5151596">)</span>&nbsp;<span class="op" id="5151598">[</span><span class="op" id="5151599">]</span><span class="builtintype" id="5151600">int</span>&nbsp;<span class="op" id="5151604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151607">m</span>&nbsp;<span class="op" id="5151609">:=</span>&nbsp;<span class="ident" id="5151612">re</span><span class="op" id="5151614">.</span><span class="ident" id="5151615">get</span><span class="op" id="5151618">(</span><span class="op" id="5151619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151622">var</span>&nbsp;<span class="ident" id="5151626">i</span>&nbsp;<span class="ident" id="5151628">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151635">if</span>&nbsp;<span class="ident" id="5151638">r</span>&nbsp;<span class="op" id="5151640">!=</span>&nbsp;<span class="builtintype" id="5151643">nil</span>&nbsp;<span class="op" id="5151647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151651">i</span>&nbsp;<span class="op" id="5151653">=</span>&nbsp;<span class="ident" id="5151655">m</span><span class="op" id="5151656">.</span><span class="ident" id="5151657">newInputReader</span><span class="op" id="5151671">(</span><span class="ident" id="5151672">r</span><span class="op" id="5151673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151676">}</span>&nbsp;<span class="keyword" id="5151678">else</span>&nbsp;<span class="keyword" id="5151683">if</span>&nbsp;<span class="ident" id="5151686">b</span>&nbsp;<span class="op" id="5151688">!=</span>&nbsp;<span class="builtintype" id="5151691">nil</span>&nbsp;<span class="op" id="5151695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151699">i</span>&nbsp;<span class="op" id="5151701">=</span>&nbsp;<span class="ident" id="5151703">m</span><span class="op" id="5151704">.</span><span class="ident" id="5151705">newInputBytes</span><span class="op" id="5151718">(</span><span class="ident" id="5151719">b</span><span class="op" id="5151720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151723">}</span>&nbsp;<span class="keyword" id="5151725">else</span>&nbsp;<span class="op" id="5151730">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151734">i</span>&nbsp;<span class="op" id="5151736">=</span>&nbsp;<span class="ident" id="5151738">m</span><span class="op" id="5151739">.</span><span class="ident" id="5151740">newInputString</span><span class="op" id="5151754">(</span><span class="ident" id="5151755">s</span><span class="op" id="5151756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151762">if</span>&nbsp;<span class="ident" id="5151765">m</span><span class="op" id="5151766">.</span><span class="ident" id="5151767">op</span>&nbsp;<span class="op" id="5151770">!=</span>&nbsp;<span class="ident" id="5151773">notOnePass</span>&nbsp;<span class="op" id="5151784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151788">if</span>&nbsp;<span class="op" id="5151791">!</span><span class="ident" id="5151792">m</span><span class="op" id="5151793">.</span><span class="ident" id="5151794">onepass</span><span class="op" id="5151801">(</span><span class="ident" id="5151802">i</span><span class="op" id="5151803">,</span>&nbsp;<span class="ident" id="5151805">pos</span><span class="op" id="5151808">)</span>&nbsp;<span class="op" id="5151810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151815">re</span><span class="op" id="5151817">.</span><span class="ident" id="5151818">put</span><span class="op" id="5151821">(</span><span class="ident" id="5151822">m</span><span class="op" id="5151823">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151828">return</span>&nbsp;<span class="builtintype" id="5151835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151844">}</span>&nbsp;<span class="keyword" id="5151846">else</span>&nbsp;<span class="op" id="5151851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151855">m</span><span class="op" id="5151856">.</span><span class="ident" id="5151857">init</span><span class="op" id="5151861">(</span><span class="ident" id="5151862">ncap</span><span class="op" id="5151866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151870">if</span>&nbsp;<span class="op" id="5151873">!</span><span class="ident" id="5151874">m</span><span class="op" id="5151875">.</span><span class="ident" id="5151876">match</span><span class="op" id="5151881">(</span><span class="ident" id="5151882">i</span><span class="op" id="5151883">,</span>&nbsp;<span class="ident" id="5151885">pos</span><span class="op" id="5151888">)</span>&nbsp;<span class="op" id="5151890">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151895">re</span><span class="op" id="5151897">.</span><span class="ident" id="5151898">put</span><span class="op" id="5151901">(</span><span class="ident" id="5151902">m</span><span class="op" id="5151903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151908">return</span>&nbsp;<span class="builtintype" id="5151915">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151927">if</span>&nbsp;<span class="ident" id="5151930">ncap</span>&nbsp;<span class="op" id="5151935">==</span>&nbsp;<span class="num" id="5151938">0</span>&nbsp;<span class="op" id="5151940">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5151944">re</span><span class="op" id="5151946">.</span><span class="ident" id="5151947">put</span><span class="op" id="5151950">(</span><span class="ident" id="5151951">m</span><span class="op" id="5151952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5151956">return</span>&nbsp;<span class="ident" id="5151963">empty</span>&nbsp;<span class="comment" id="5151969">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5151991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5151994">cap</span>&nbsp;<span class="op" id="5151998">:=</span>&nbsp;<span class="builtinfunc" id="5152001">make</span><span class="op" id="5152005">(</span><span class="op" id="5152006">[</span><span class="op" id="5152007">]</span><span class="builtintype" id="5152008">int</span><span class="op" id="5152011">,</span>&nbsp;<span class="builtinfunc" id="5152013">len</span><span class="op" id="5152016">(</span><span class="ident" id="5152017">m</span><span class="op" id="5152018">.</span><span class="ident" id="5152019">matchcap</span><span class="op" id="5152027">)</span><span class="op" id="5152028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5152031">copy</span><span class="op" id="5152035">(</span><span class="builtinfunc" id="5152036">cap</span><span class="op" id="5152039">,</span>&nbsp;<span class="ident" id="5152041">m</span><span class="op" id="5152042">.</span><span class="ident" id="5152043">matchcap</span><span class="op" id="5152051">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5152054">re</span><span class="op" id="5152056">.</span><span class="ident" id="5152057">put</span><span class="op" id="5152060">(</span><span class="ident" id="5152061">m</span><span class="op" id="5152062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5152065">return</span>&nbsp;<span class="builtinfunc" id="5152072">cap</span><br>
<span class="lineno"></span><span class="op" id="5152076">}</span>
</div>
</body>
</html>
