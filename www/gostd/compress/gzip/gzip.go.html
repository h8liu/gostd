<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4343459">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4343514">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4343568">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4343619">package</span>&nbsp;<span class="ident" id="4343627">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343633">import</span>&nbsp;<span class="op" id="4343640">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343643">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343661">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343671">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343678">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343686">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4343700">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4343705">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4343708">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4343788">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4343854">const</span>&nbsp;<span class="op" id="4343860">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343863">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343882">=</span>&nbsp;<span class="ident" id="4343884">flate</span><span class="op" id="4343889">.</span><span class="ident" id="4343890">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343905">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343924">=</span>&nbsp;<span class="ident" id="4343926">flate</span><span class="op" id="4343931">.</span><span class="ident" id="4343932">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343943">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343962">=</span>&nbsp;<span class="ident" id="4343964">flate</span><span class="op" id="4343969">.</span><span class="ident" id="4343970">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343987">DefaultCompression</span>&nbsp;<span class="op" id="4344006">=</span>&nbsp;<span class="ident" id="4344008">flate</span><span class="op" id="4344013">.</span><span class="ident" id="4344014">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4344033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4344036">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4344070">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4344125">type</span>&nbsp;<span class="ident" id="4344130">Writer</span>&nbsp;<span class="keyword" id="4344137">struct</span>&nbsp;<span class="op" id="4344144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344147">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344155">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344167">io</span><span class="op" id="4344169">.</span><span class="ident" id="4344170">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344178">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4344190">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344195">wroteHeader</span>&nbsp;<span class="builtintype" id="4344207">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344213">compressor</span>&nbsp;&nbsp;<span class="op" id="4344225">*</span><span class="ident" id="4344226">flate</span><span class="op" id="4344231">.</span><span class="ident" id="4344232">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344240">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344252">hash</span><span class="op" id="4344256">.</span><span class="ident" id="4344257">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344265">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4344277">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344285">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4344297">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344303">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4344315">[</span><span class="num" id="4344316">10</span><span class="op" id="4344318">]</span><span class="builtintype" id="4344319">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344325">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4344337">error</span><br>
<span class="lineno"></span><span class="op" id="4344343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4344346">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4344381">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4344447">//</span><br>
<span class="lineno"></span><span class="comment" id="4344450">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4344531">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4344586">//</span><br>
<span class="lineno"></span><span class="comment" id="4344589">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4344663">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4344739">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4344817">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4344896">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4344915">func</span>&nbsp;<span class="ident" id="4344920">NewWriter</span><span class="op" id="4344929">(</span><span class="ident" id="4344930">w</span>&nbsp;<span class="ident" id="4344932">io</span><span class="op" id="4344934">.</span><span class="ident" id="4344935">Writer</span><span class="op" id="4344941">)</span>&nbsp;<span class="op" id="4344943">*</span><span class="ident" id="4344944">Writer</span>&nbsp;<span class="op" id="4344951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344954">z</span><span class="op" id="4344955">,</span>&nbsp;<span class="ident" id="4344957">_</span>&nbsp;<span class="op" id="4344959">:=</span>&nbsp;<span class="ident" id="4344962">NewWriterLevel</span><span class="op" id="4344976">(</span><span class="ident" id="4344977">w</span><span class="op" id="4344978">,</span>&nbsp;<span class="ident" id="4344980">DefaultCompression</span><span class="op" id="4344998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345001">return</span>&nbsp;<span class="ident" id="4345008">z</span><br>
<span class="lineno"></span><span class="op" id="4345010">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4345013">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4345093">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4345128">//</span><br>
<span class="lineno"></span><span class="comment" id="4345131">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4345205">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4345281">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4345328">func</span>&nbsp;<span class="ident" id="4345333">NewWriterLevel</span><span class="op" id="4345347">(</span><span class="ident" id="4345348">w</span>&nbsp;<span class="ident" id="4345350">io</span><span class="op" id="4345352">.</span><span class="ident" id="4345353">Writer</span><span class="op" id="4345359">,</span>&nbsp;<span class="ident" id="4345361">level</span>&nbsp;<span class="builtintype" id="4345367">int</span><span class="op" id="4345370">)</span>&nbsp;<span class="op" id="4345372">(</span><span class="op" id="4345373">*</span><span class="ident" id="4345374">Writer</span><span class="op" id="4345380">,</span>&nbsp;<span class="builtintype" id="4345382">error</span><span class="op" id="4345387">)</span>&nbsp;<span class="op" id="4345389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345392">if</span>&nbsp;<span class="ident" id="4345395">level</span>&nbsp;<span class="op" id="4345401">&lt;</span>&nbsp;<span class="ident" id="4345403">DefaultCompression</span>&nbsp;<span class="op" id="4345422">||</span>&nbsp;<span class="ident" id="4345425">level</span>&nbsp;<span class="op" id="4345431">&gt;</span>&nbsp;<span class="ident" id="4345433">BestCompression</span>&nbsp;<span class="op" id="4345449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345453">return</span>&nbsp;<span class="ident" id="4345460">nil</span><span class="op" id="4345463">,</span>&nbsp;<span class="ident" id="4345465">fmt</span><span class="op" id="4345468">.</span><span class="ident" id="4345469">Errorf</span><span class="op" id="4345475">(</span><span class="string" id="4345476">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4345513">,</span>&nbsp;<span class="ident" id="4345515">level</span><span class="op" id="4345520">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345526">z</span>&nbsp;<span class="op" id="4345528">:=</span>&nbsp;<span class="builtinfunc" id="4345531">new</span><span class="op" id="4345534">(</span><span class="ident" id="4345535">Writer</span><span class="op" id="4345541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345544">z</span><span class="op" id="4345545">.</span><span class="ident" id="4345546">init</span><span class="op" id="4345550">(</span><span class="ident" id="4345551">w</span><span class="op" id="4345552">,</span>&nbsp;<span class="ident" id="4345554">level</span><span class="op" id="4345559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345562">return</span>&nbsp;<span class="ident" id="4345569">z</span><span class="op" id="4345570">,</span>&nbsp;<span class="ident" id="4345572">nil</span><br>
<span class="lineno"></span><span class="op" id="4345576">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4345579">func</span>&nbsp;<span class="op" id="4345584">(</span><span class="ident" id="4345585">z</span>&nbsp;<span class="op" id="4345587">*</span><span class="ident" id="4345588">Writer</span><span class="op" id="4345594">)</span>&nbsp;<span class="ident" id="4345596">init</span><span class="op" id="4345600">(</span><span class="ident" id="4345601">w</span>&nbsp;<span class="ident" id="4345603">io</span><span class="op" id="4345605">.</span><span class="ident" id="4345606">Writer</span><span class="op" id="4345612">,</span>&nbsp;<span class="ident" id="4345614">level</span>&nbsp;<span class="builtintype" id="4345620">int</span><span class="op" id="4345623">)</span>&nbsp;<span class="op" id="4345625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345628">digest</span>&nbsp;<span class="op" id="4345635">:=</span>&nbsp;<span class="ident" id="4345638">z</span><span class="op" id="4345639">.</span><span class="ident" id="4345640">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345648">if</span>&nbsp;<span class="ident" id="4345651">digest</span>&nbsp;<span class="op" id="4345658">!=</span>&nbsp;<span class="ident" id="4345661">nil</span>&nbsp;<span class="op" id="4345665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345669">digest</span><span class="op" id="4345675">.</span><span class="ident" id="4345676">Reset</span><span class="op" id="4345681">(</span><span class="op" id="4345682">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345685">}</span>&nbsp;<span class="keyword" id="4345687">else</span>&nbsp;<span class="op" id="4345692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345696">digest</span>&nbsp;<span class="op" id="4345703">=</span>&nbsp;<span class="ident" id="4345705">crc32</span><span class="op" id="4345710">.</span><span class="ident" id="4345711">NewIEEE</span><span class="op" id="4345718">(</span><span class="op" id="4345719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345725">compressor</span>&nbsp;<span class="op" id="4345736">:=</span>&nbsp;<span class="ident" id="4345739">z</span><span class="op" id="4345740">.</span><span class="ident" id="4345741">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4345753">if</span>&nbsp;<span class="ident" id="4345756">compressor</span>&nbsp;<span class="op" id="4345767">!=</span>&nbsp;<span class="ident" id="4345770">nil</span>&nbsp;<span class="op" id="4345774">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345778">compressor</span><span class="op" id="4345788">.</span><span class="ident" id="4345789">Reset</span><span class="op" id="4345794">(</span><span class="ident" id="4345795">w</span><span class="op" id="4345796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345802">*</span><span class="ident" id="4345803">z</span>&nbsp;<span class="op" id="4345805">=</span>&nbsp;<span class="ident" id="4345807">Writer</span><span class="op" id="4345813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345817">Header</span><span class="op" id="4345823">:</span>&nbsp;<span class="ident" id="4345825">Header</span><span class="op" id="4345831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345836">OS</span><span class="op" id="4345838">:</span>&nbsp;<span class="num" id="4345840">255</span><span class="op" id="4345843">,</span>&nbsp;<span class="comment" id="4345845">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345858">}</span><span class="op" id="4345859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345863">w</span><span class="op" id="4345864">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345875">w</span><span class="op" id="4345876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345880">level</span><span class="op" id="4345885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345892">level</span><span class="op" id="4345897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345901">digest</span><span class="op" id="4345907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345913">digest</span><span class="op" id="4345919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4345923">compressor</span><span class="op" id="4345933">:</span>&nbsp;<span class="ident" id="4345935">compressor</span><span class="op" id="4345945">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4345948">}</span><br>
<span class="lineno"></span><span class="op" id="4345950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4345953">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4346023">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4346093">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4346160">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4346185">func</span>&nbsp;<span class="op" id="4346190">(</span><span class="ident" id="4346191">z</span>&nbsp;<span class="op" id="4346193">*</span><span class="ident" id="4346194">Writer</span><span class="op" id="4346200">)</span>&nbsp;<span class="ident" id="4346202">Reset</span><span class="op" id="4346207">(</span><span class="ident" id="4346208">w</span>&nbsp;<span class="ident" id="4346210">io</span><span class="op" id="4346212">.</span><span class="ident" id="4346213">Writer</span><span class="op" id="4346219">)</span>&nbsp;<span class="op" id="4346221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346224">z</span><span class="op" id="4346225">.</span><span class="ident" id="4346226">init</span><span class="op" id="4346230">(</span><span class="ident" id="4346231">w</span><span class="op" id="4346232">,</span>&nbsp;<span class="ident" id="4346234">z</span><span class="op" id="4346235">.</span><span class="ident" id="4346236">level</span><span class="op" id="4346241">)</span><br>
<span class="lineno"></span><span class="op" id="4346243">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4346246">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4346307">func</span>&nbsp;<span class="ident" id="4346312">put2</span><span class="op" id="4346316">(</span><span class="ident" id="4346317">p</span>&nbsp;<span class="op" id="4346319">[</span><span class="op" id="4346320">]</span><span class="builtintype" id="4346321">byte</span><span class="op" id="4346325">,</span>&nbsp;<span class="ident" id="4346327">v</span>&nbsp;<span class="builtintype" id="4346329">uint16</span><span class="op" id="4346335">)</span>&nbsp;<span class="op" id="4346337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346340">p</span><span class="op" id="4346341">[</span><span class="num" id="4346342">0</span><span class="op" id="4346343">]</span>&nbsp;<span class="op" id="4346345">=</span>&nbsp;<span class="builtintype" id="4346347">uint8</span><span class="op" id="4346352">(</span><span class="ident" id="4346353">v</span>&nbsp;<span class="op" id="4346355">&gt;&gt;</span>&nbsp;<span class="num" id="4346358">0</span><span class="op" id="4346359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346362">p</span><span class="op" id="4346363">[</span><span class="num" id="4346364">1</span><span class="op" id="4346365">]</span>&nbsp;<span class="op" id="4346367">=</span>&nbsp;<span class="builtintype" id="4346369">uint8</span><span class="op" id="4346374">(</span><span class="ident" id="4346375">v</span>&nbsp;<span class="op" id="4346377">&gt;&gt;</span>&nbsp;<span class="num" id="4346380">8</span><span class="op" id="4346381">)</span><br>
<span class="lineno">105</span><span class="op" id="4346383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4346386">func</span>&nbsp;<span class="ident" id="4346391">put4</span><span class="op" id="4346395">(</span><span class="ident" id="4346396">p</span>&nbsp;<span class="op" id="4346398">[</span><span class="op" id="4346399">]</span><span class="builtintype" id="4346400">byte</span><span class="op" id="4346404">,</span>&nbsp;<span class="ident" id="4346406">v</span>&nbsp;<span class="builtintype" id="4346408">uint32</span><span class="op" id="4346414">)</span>&nbsp;<span class="op" id="4346416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346419">p</span><span class="op" id="4346420">[</span><span class="num" id="4346421">0</span><span class="op" id="4346422">]</span>&nbsp;<span class="op" id="4346424">=</span>&nbsp;<span class="builtintype" id="4346426">uint8</span><span class="op" id="4346431">(</span><span class="ident" id="4346432">v</span>&nbsp;<span class="op" id="4346434">&gt;&gt;</span>&nbsp;<span class="num" id="4346437">0</span><span class="op" id="4346438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346441">p</span><span class="op" id="4346442">[</span><span class="num" id="4346443">1</span><span class="op" id="4346444">]</span>&nbsp;<span class="op" id="4346446">=</span>&nbsp;<span class="builtintype" id="4346448">uint8</span><span class="op" id="4346453">(</span><span class="ident" id="4346454">v</span>&nbsp;<span class="op" id="4346456">&gt;&gt;</span>&nbsp;<span class="num" id="4346459">8</span><span class="op" id="4346460">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346463">p</span><span class="op" id="4346464">[</span><span class="num" id="4346465">2</span><span class="op" id="4346466">]</span>&nbsp;<span class="op" id="4346468">=</span>&nbsp;<span class="builtintype" id="4346470">uint8</span><span class="op" id="4346475">(</span><span class="ident" id="4346476">v</span>&nbsp;<span class="op" id="4346478">&gt;&gt;</span>&nbsp;<span class="num" id="4346481">16</span><span class="op" id="4346483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346486">p</span><span class="op" id="4346487">[</span><span class="num" id="4346488">3</span><span class="op" id="4346489">]</span>&nbsp;<span class="op" id="4346491">=</span>&nbsp;<span class="builtintype" id="4346493">uint8</span><span class="op" id="4346498">(</span><span class="ident" id="4346499">v</span>&nbsp;<span class="op" id="4346501">&gt;&gt;</span>&nbsp;<span class="num" id="4346504">24</span><span class="op" id="4346506">)</span><br>
<span class="lineno"></span><span class="op" id="4346508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4346511">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4346569">func</span>&nbsp;<span class="op" id="4346574">(</span><span class="ident" id="4346575">z</span>&nbsp;<span class="op" id="4346577">*</span><span class="ident" id="4346578">Writer</span><span class="op" id="4346584">)</span>&nbsp;<span class="ident" id="4346586">writeBytes</span><span class="op" id="4346596">(</span><span class="ident" id="4346597">b</span>&nbsp;<span class="op" id="4346599">[</span><span class="op" id="4346600">]</span><span class="builtintype" id="4346601">byte</span><span class="op" id="4346605">)</span>&nbsp;<span class="builtintype" id="4346607">error</span>&nbsp;<span class="op" id="4346613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4346616">if</span>&nbsp;<span class="builtinfunc" id="4346619">len</span><span class="op" id="4346622">(</span><span class="ident" id="4346623">b</span><span class="op" id="4346624">)</span>&nbsp;<span class="op" id="4346626">&gt;</span>&nbsp;<span class="num" id="4346628">0xffff</span>&nbsp;<span class="op" id="4346635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4346639">return</span>&nbsp;<span class="ident" id="4346646">errors</span><span class="op" id="4346652">.</span><span class="ident" id="4346653">New</span><span class="op" id="4346656">(</span><span class="string" id="4346657">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4346694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4346697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346700">put2</span><span class="op" id="4346704">(</span><span class="ident" id="4346705">z</span><span class="op" id="4346706">.</span><span class="ident" id="4346707">buf</span><span class="op" id="4346710">[</span><span class="num" id="4346711">0</span><span class="op" id="4346712">:</span><span class="num" id="4346713">2</span><span class="op" id="4346714">]</span><span class="op" id="4346715">,</span>&nbsp;<span class="builtintype" id="4346717">uint16</span><span class="op" id="4346723">(</span><span class="builtinfunc" id="4346724">len</span><span class="op" id="4346727">(</span><span class="ident" id="4346728">b</span><span class="op" id="4346729">)</span><span class="op" id="4346730">)</span><span class="op" id="4346731">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346734">_</span><span class="op" id="4346735">,</span>&nbsp;<span class="ident" id="4346737">err</span>&nbsp;<span class="op" id="4346741">:=</span>&nbsp;<span class="ident" id="4346744">z</span><span class="op" id="4346745">.</span><span class="ident" id="4346746">w</span><span class="op" id="4346747">.</span><span class="ident" id="4346748">Write</span><span class="op" id="4346753">(</span><span class="ident" id="4346754">z</span><span class="op" id="4346755">.</span><span class="ident" id="4346756">buf</span><span class="op" id="4346759">[</span><span class="num" id="4346760">0</span><span class="op" id="4346761">:</span><span class="num" id="4346762">2</span><span class="op" id="4346763">]</span><span class="op" id="4346764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4346767">if</span>&nbsp;<span class="ident" id="4346770">err</span>&nbsp;<span class="op" id="4346774">!=</span>&nbsp;<span class="ident" id="4346777">nil</span>&nbsp;<span class="op" id="4346781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4346785">return</span>&nbsp;<span class="ident" id="4346792">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4346797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4346800">_</span><span class="op" id="4346801">,</span>&nbsp;<span class="ident" id="4346803">err</span>&nbsp;<span class="op" id="4346807">=</span>&nbsp;<span class="ident" id="4346809">z</span><span class="op" id="4346810">.</span><span class="ident" id="4346811">w</span><span class="op" id="4346812">.</span><span class="ident" id="4346813">Write</span><span class="op" id="4346818">(</span><span class="ident" id="4346819">b</span><span class="op" id="4346820">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4346823">return</span>&nbsp;<span class="ident" id="4346830">err</span><br>
<span class="lineno"></span><span class="op" id="4346834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4346837">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4346901">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4346984">func</span>&nbsp;<span class="op" id="4346989">(</span><span class="ident" id="4346990">z</span>&nbsp;<span class="op" id="4346992">*</span><span class="ident" id="4346993">Writer</span><span class="op" id="4346999">)</span>&nbsp;<span class="ident" id="4347001">writeString</span><span class="op" id="4347012">(</span><span class="ident" id="4347013">s</span>&nbsp;<span class="builtintype" id="4347015">string</span><span class="op" id="4347021">)</span>&nbsp;<span class="op" id="4347023">(</span><span class="ident" id="4347024">err</span>&nbsp;<span class="builtintype" id="4347028">error</span><span class="op" id="4347033">)</span>&nbsp;<span class="op" id="4347035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4347038">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347115">needconv</span>&nbsp;<span class="op" id="4347124">:=</span>&nbsp;<span class="builtintype" id="4347127">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347134">for</span>&nbsp;<span class="ident" id="4347138">_</span><span class="op" id="4347139">,</span>&nbsp;<span class="ident" id="4347141">v</span>&nbsp;<span class="op" id="4347143">:=</span>&nbsp;<span class="keyword" id="4347146">range</span>&nbsp;<span class="ident" id="4347152">s</span>&nbsp;<span class="op" id="4347154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347158">if</span>&nbsp;<span class="ident" id="4347161">v</span>&nbsp;<span class="op" id="4347163">==</span>&nbsp;<span class="num" id="4347166">0</span>&nbsp;<span class="op" id="4347168">||</span>&nbsp;<span class="ident" id="4347171">v</span>&nbsp;<span class="op" id="4347173">&gt;</span>&nbsp;<span class="num" id="4347175">0xff</span>&nbsp;<span class="op" id="4347180">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347185">return</span>&nbsp;<span class="ident" id="4347192">errors</span><span class="op" id="4347198">.</span><span class="ident" id="4347199">New</span><span class="op" id="4347202">(</span><span class="string" id="4347203">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4347242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347250">if</span>&nbsp;<span class="ident" id="4347253">v</span>&nbsp;<span class="op" id="4347255">&gt;</span>&nbsp;<span class="num" id="4347257">0x7f</span>&nbsp;<span class="op" id="4347262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347267">needconv</span>&nbsp;<span class="op" id="4347276">=</span>&nbsp;<span class="builtintype" id="4347278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347285">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347291">if</span>&nbsp;<span class="ident" id="4347294">needconv</span>&nbsp;<span class="op" id="4347303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347307">b</span>&nbsp;<span class="op" id="4347309">:=</span>&nbsp;<span class="builtinfunc" id="4347312">make</span><span class="op" id="4347316">(</span><span class="op" id="4347317">[</span><span class="op" id="4347318">]</span><span class="builtintype" id="4347319">byte</span><span class="op" id="4347323">,</span>&nbsp;<span class="num" id="4347325">0</span><span class="op" id="4347326">,</span>&nbsp;<span class="builtinfunc" id="4347328">len</span><span class="op" id="4347331">(</span><span class="ident" id="4347332">s</span><span class="op" id="4347333">)</span><span class="op" id="4347334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347338">for</span>&nbsp;<span class="ident" id="4347342">_</span><span class="op" id="4347343">,</span>&nbsp;<span class="ident" id="4347345">v</span>&nbsp;<span class="op" id="4347347">:=</span>&nbsp;<span class="keyword" id="4347350">range</span>&nbsp;<span class="ident" id="4347356">s</span>&nbsp;<span class="op" id="4347358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347363">b</span>&nbsp;<span class="op" id="4347365">=</span>&nbsp;<span class="builtinfunc" id="4347367">append</span><span class="op" id="4347373">(</span><span class="ident" id="4347374">b</span><span class="op" id="4347375">,</span>&nbsp;<span class="builtintype" id="4347377">byte</span><span class="op" id="4347381">(</span><span class="ident" id="4347382">v</span><span class="op" id="4347383">)</span><span class="op" id="4347384">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347392">_</span><span class="op" id="4347393">,</span>&nbsp;<span class="ident" id="4347395">err</span>&nbsp;<span class="op" id="4347399">=</span>&nbsp;<span class="ident" id="4347401">z</span><span class="op" id="4347402">.</span><span class="ident" id="4347403">w</span><span class="op" id="4347404">.</span><span class="ident" id="4347405">Write</span><span class="op" id="4347410">(</span><span class="ident" id="4347411">b</span><span class="op" id="4347412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347415">}</span>&nbsp;<span class="keyword" id="4347417">else</span>&nbsp;<span class="op" id="4347422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347426">_</span><span class="op" id="4347427">,</span>&nbsp;<span class="ident" id="4347429">err</span>&nbsp;<span class="op" id="4347433">=</span>&nbsp;<span class="ident" id="4347435">io</span><span class="op" id="4347437">.</span><span class="ident" id="4347438">WriteString</span><span class="op" id="4347449">(</span><span class="ident" id="4347450">z</span><span class="op" id="4347451">.</span><span class="ident" id="4347452">w</span><span class="op" id="4347453">,</span>&nbsp;<span class="ident" id="4347455">s</span><span class="op" id="4347456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347459">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347462">if</span>&nbsp;<span class="ident" id="4347465">err</span>&nbsp;<span class="op" id="4347469">!=</span>&nbsp;<span class="ident" id="4347472">nil</span>&nbsp;<span class="op" id="4347476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347480">return</span>&nbsp;<span class="ident" id="4347487">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4347495">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347532">z</span><span class="op" id="4347533">.</span><span class="ident" id="4347534">buf</span><span class="op" id="4347537">[</span><span class="num" id="4347538">0</span><span class="op" id="4347539">]</span>&nbsp;<span class="op" id="4347541">=</span>&nbsp;<span class="num" id="4347543">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347546">_</span><span class="op" id="4347547">,</span>&nbsp;<span class="ident" id="4347549">err</span>&nbsp;<span class="op" id="4347553">=</span>&nbsp;<span class="ident" id="4347555">z</span><span class="op" id="4347556">.</span><span class="ident" id="4347557">w</span><span class="op" id="4347558">.</span><span class="ident" id="4347559">Write</span><span class="op" id="4347564">(</span><span class="ident" id="4347565">z</span><span class="op" id="4347566">.</span><span class="ident" id="4347567">buf</span><span class="op" id="4347570">[</span><span class="num" id="4347571">0</span><span class="op" id="4347572">:</span><span class="num" id="4347573">1</span><span class="op" id="4347574">]</span><span class="op" id="4347575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347578">return</span>&nbsp;<span class="ident" id="4347585">err</span><br>
<span class="lineno"></span><span class="op" id="4347589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4347592">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4347664">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4347740">func</span>&nbsp;<span class="op" id="4347745">(</span><span class="ident" id="4347746">z</span>&nbsp;<span class="op" id="4347748">*</span><span class="ident" id="4347749">Writer</span><span class="op" id="4347755">)</span>&nbsp;<span class="ident" id="4347757">Write</span><span class="op" id="4347762">(</span><span class="ident" id="4347763">p</span>&nbsp;<span class="op" id="4347765">[</span><span class="op" id="4347766">]</span><span class="builtintype" id="4347767">byte</span><span class="op" id="4347771">)</span>&nbsp;<span class="op" id="4347773">(</span><span class="builtintype" id="4347774">int</span><span class="op" id="4347777">,</span>&nbsp;<span class="builtintype" id="4347779">error</span><span class="op" id="4347784">)</span>&nbsp;<span class="op" id="4347786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347789">if</span>&nbsp;<span class="ident" id="4347792">z</span><span class="op" id="4347793">.</span><span class="ident" id="4347794">err</span>&nbsp;<span class="op" id="4347798">!=</span>&nbsp;<span class="ident" id="4347801">nil</span>&nbsp;<span class="op" id="4347805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347809">return</span>&nbsp;<span class="num" id="4347816">0</span><span class="op" id="4347817">,</span>&nbsp;<span class="ident" id="4347819">z</span><span class="op" id="4347820">.</span><span class="ident" id="4347821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347826">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347829">var</span>&nbsp;<span class="ident" id="4347833">n</span>&nbsp;<span class="builtintype" id="4347835">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4347840">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347874">if</span>&nbsp;<span class="op" id="4347877">!</span><span class="ident" id="4347878">z</span><span class="op" id="4347879">.</span><span class="ident" id="4347880">wroteHeader</span>&nbsp;<span class="op" id="4347892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347896">z</span><span class="op" id="4347897">.</span><span class="ident" id="4347898">wroteHeader</span>&nbsp;<span class="op" id="4347910">=</span>&nbsp;<span class="builtintype" id="4347912">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347919">z</span><span class="op" id="4347920">.</span><span class="ident" id="4347921">buf</span><span class="op" id="4347924">[</span><span class="num" id="4347925">0</span><span class="op" id="4347926">]</span>&nbsp;<span class="op" id="4347928">=</span>&nbsp;<span class="ident" id="4347930">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347940">z</span><span class="op" id="4347941">.</span><span class="ident" id="4347942">buf</span><span class="op" id="4347945">[</span><span class="num" id="4347946">1</span><span class="op" id="4347947">]</span>&nbsp;<span class="op" id="4347949">=</span>&nbsp;<span class="ident" id="4347951">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347961">z</span><span class="op" id="4347962">.</span><span class="ident" id="4347963">buf</span><span class="op" id="4347966">[</span><span class="num" id="4347967">2</span><span class="op" id="4347968">]</span>&nbsp;<span class="op" id="4347970">=</span>&nbsp;<span class="ident" id="4347972">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347986">z</span><span class="op" id="4347987">.</span><span class="ident" id="4347988">buf</span><span class="op" id="4347991">[</span><span class="num" id="4347992">3</span><span class="op" id="4347993">]</span>&nbsp;<span class="op" id="4347995">=</span>&nbsp;<span class="num" id="4347997">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348001">if</span>&nbsp;<span class="ident" id="4348004">z</span><span class="op" id="4348005">.</span><span class="ident" id="4348006">Extra</span>&nbsp;<span class="op" id="4348012">!=</span>&nbsp;<span class="ident" id="4348015">nil</span>&nbsp;<span class="op" id="4348019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348024">z</span><span class="op" id="4348025">.</span><span class="ident" id="4348026">buf</span><span class="op" id="4348029">[</span><span class="num" id="4348030">3</span><span class="op" id="4348031">]</span>&nbsp;<span class="op" id="4348033">|=</span>&nbsp;<span class="num" id="4348036">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348047">if</span>&nbsp;<span class="ident" id="4348050">z</span><span class="op" id="4348051">.</span><span class="ident" id="4348052">Name</span>&nbsp;<span class="op" id="4348057">!=</span>&nbsp;<span class="string" id="4348060">&#34;&#34;</span>&nbsp;<span class="op" id="4348063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348068">z</span><span class="op" id="4348069">.</span><span class="ident" id="4348070">buf</span><span class="op" id="4348073">[</span><span class="num" id="4348074">3</span><span class="op" id="4348075">]</span>&nbsp;<span class="op" id="4348077">|=</span>&nbsp;<span class="num" id="4348080">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348091">if</span>&nbsp;<span class="ident" id="4348094">z</span><span class="op" id="4348095">.</span><span class="ident" id="4348096">Comment</span>&nbsp;<span class="op" id="4348104">!=</span>&nbsp;<span class="string" id="4348107">&#34;&#34;</span>&nbsp;<span class="op" id="4348110">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348115">z</span><span class="op" id="4348116">.</span><span class="ident" id="4348117">buf</span><span class="op" id="4348120">[</span><span class="num" id="4348121">3</span><span class="op" id="4348122">]</span>&nbsp;<span class="op" id="4348124">|=</span>&nbsp;<span class="num" id="4348127">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348138">put4</span><span class="op" id="4348142">(</span><span class="ident" id="4348143">z</span><span class="op" id="4348144">.</span><span class="ident" id="4348145">buf</span><span class="op" id="4348148">[</span><span class="num" id="4348149">4</span><span class="op" id="4348150">:</span><span class="num" id="4348151">8</span><span class="op" id="4348152">]</span><span class="op" id="4348153">,</span>&nbsp;<span class="builtintype" id="4348155">uint32</span><span class="op" id="4348161">(</span><span class="ident" id="4348162">z</span><span class="op" id="4348163">.</span><span class="ident" id="4348164">ModTime</span><span class="op" id="4348171">.</span><span class="ident" id="4348172">Unix</span><span class="op" id="4348176">(</span><span class="op" id="4348177">)</span><span class="op" id="4348178">)</span><span class="op" id="4348179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348183">if</span>&nbsp;<span class="ident" id="4348186">z</span><span class="op" id="4348187">.</span><span class="ident" id="4348188">level</span>&nbsp;<span class="op" id="4348194">==</span>&nbsp;<span class="ident" id="4348197">BestCompression</span>&nbsp;<span class="op" id="4348213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348218">z</span><span class="op" id="4348219">.</span><span class="ident" id="4348220">buf</span><span class="op" id="4348223">[</span><span class="num" id="4348224">8</span><span class="op" id="4348225">]</span>&nbsp;<span class="op" id="4348227">=</span>&nbsp;<span class="num" id="4348229">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348233">}</span>&nbsp;<span class="keyword" id="4348235">else</span>&nbsp;<span class="keyword" id="4348240">if</span>&nbsp;<span class="ident" id="4348243">z</span><span class="op" id="4348244">.</span><span class="ident" id="4348245">level</span>&nbsp;<span class="op" id="4348251">==</span>&nbsp;<span class="ident" id="4348254">BestSpeed</span>&nbsp;<span class="op" id="4348264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348269">z</span><span class="op" id="4348270">.</span><span class="ident" id="4348271">buf</span><span class="op" id="4348274">[</span><span class="num" id="4348275">8</span><span class="op" id="4348276">]</span>&nbsp;<span class="op" id="4348278">=</span>&nbsp;<span class="num" id="4348280">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348284">}</span>&nbsp;<span class="keyword" id="4348286">else</span>&nbsp;<span class="op" id="4348291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348296">z</span><span class="op" id="4348297">.</span><span class="ident" id="4348298">buf</span><span class="op" id="4348301">[</span><span class="num" id="4348302">8</span><span class="op" id="4348303">]</span>&nbsp;<span class="op" id="4348305">=</span>&nbsp;<span class="num" id="4348307">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348311">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348315">z</span><span class="op" id="4348316">.</span><span class="ident" id="4348317">buf</span><span class="op" id="4348320">[</span><span class="num" id="4348321">9</span><span class="op" id="4348322">]</span>&nbsp;<span class="op" id="4348324">=</span>&nbsp;<span class="ident" id="4348326">z</span><span class="op" id="4348327">.</span><span class="ident" id="4348328">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348333">n</span><span class="op" id="4348334">,</span>&nbsp;<span class="ident" id="4348336">z</span><span class="op" id="4348337">.</span><span class="ident" id="4348338">err</span>&nbsp;<span class="op" id="4348342">=</span>&nbsp;<span class="ident" id="4348344">z</span><span class="op" id="4348345">.</span><span class="ident" id="4348346">w</span><span class="op" id="4348347">.</span><span class="ident" id="4348348">Write</span><span class="op" id="4348353">(</span><span class="ident" id="4348354">z</span><span class="op" id="4348355">.</span><span class="ident" id="4348356">buf</span><span class="op" id="4348359">[</span><span class="num" id="4348360">0</span><span class="op" id="4348361">:</span><span class="num" id="4348362">10</span><span class="op" id="4348364">]</span><span class="op" id="4348365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348369">if</span>&nbsp;<span class="ident" id="4348372">z</span><span class="op" id="4348373">.</span><span class="ident" id="4348374">err</span>&nbsp;<span class="op" id="4348378">!=</span>&nbsp;<span class="ident" id="4348381">nil</span>&nbsp;<span class="op" id="4348385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348390">return</span>&nbsp;<span class="ident" id="4348397">n</span><span class="op" id="4348398">,</span>&nbsp;<span class="ident" id="4348400">z</span><span class="op" id="4348401">.</span><span class="ident" id="4348402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348408">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348412">if</span>&nbsp;<span class="ident" id="4348415">z</span><span class="op" id="4348416">.</span><span class="ident" id="4348417">Extra</span>&nbsp;<span class="op" id="4348423">!=</span>&nbsp;<span class="ident" id="4348426">nil</span>&nbsp;<span class="op" id="4348430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348435">z</span><span class="op" id="4348436">.</span><span class="ident" id="4348437">err</span>&nbsp;<span class="op" id="4348441">=</span>&nbsp;<span class="ident" id="4348443">z</span><span class="op" id="4348444">.</span><span class="ident" id="4348445">writeBytes</span><span class="op" id="4348455">(</span><span class="ident" id="4348456">z</span><span class="op" id="4348457">.</span><span class="ident" id="4348458">Extra</span><span class="op" id="4348463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348468">if</span>&nbsp;<span class="ident" id="4348471">z</span><span class="op" id="4348472">.</span><span class="ident" id="4348473">err</span>&nbsp;<span class="op" id="4348477">!=</span>&nbsp;<span class="ident" id="4348480">nil</span>&nbsp;<span class="op" id="4348484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348490">return</span>&nbsp;<span class="ident" id="4348497">n</span><span class="op" id="4348498">,</span>&nbsp;<span class="ident" id="4348500">z</span><span class="op" id="4348501">.</span><span class="ident" id="4348502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348509">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348517">if</span>&nbsp;<span class="ident" id="4348520">z</span><span class="op" id="4348521">.</span><span class="ident" id="4348522">Name</span>&nbsp;<span class="op" id="4348527">!=</span>&nbsp;<span class="string" id="4348530">&#34;&#34;</span>&nbsp;<span class="op" id="4348533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348538">z</span><span class="op" id="4348539">.</span><span class="ident" id="4348540">err</span>&nbsp;<span class="op" id="4348544">=</span>&nbsp;<span class="ident" id="4348546">z</span><span class="op" id="4348547">.</span><span class="ident" id="4348548">writeString</span><span class="op" id="4348559">(</span><span class="ident" id="4348560">z</span><span class="op" id="4348561">.</span><span class="ident" id="4348562">Name</span><span class="op" id="4348566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348571">if</span>&nbsp;<span class="ident" id="4348574">z</span><span class="op" id="4348575">.</span><span class="ident" id="4348576">err</span>&nbsp;<span class="op" id="4348580">!=</span>&nbsp;<span class="ident" id="4348583">nil</span>&nbsp;<span class="op" id="4348587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348593">return</span>&nbsp;<span class="ident" id="4348600">n</span><span class="op" id="4348601">,</span>&nbsp;<span class="ident" id="4348603">z</span><span class="op" id="4348604">.</span><span class="ident" id="4348605">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348620">if</span>&nbsp;<span class="ident" id="4348623">z</span><span class="op" id="4348624">.</span><span class="ident" id="4348625">Comment</span>&nbsp;<span class="op" id="4348633">!=</span>&nbsp;<span class="string" id="4348636">&#34;&#34;</span>&nbsp;<span class="op" id="4348639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348644">z</span><span class="op" id="4348645">.</span><span class="ident" id="4348646">err</span>&nbsp;<span class="op" id="4348650">=</span>&nbsp;<span class="ident" id="4348652">z</span><span class="op" id="4348653">.</span><span class="ident" id="4348654">writeString</span><span class="op" id="4348665">(</span><span class="ident" id="4348666">z</span><span class="op" id="4348667">.</span><span class="ident" id="4348668">Comment</span><span class="op" id="4348675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348680">if</span>&nbsp;<span class="ident" id="4348683">z</span><span class="op" id="4348684">.</span><span class="ident" id="4348685">err</span>&nbsp;<span class="op" id="4348689">!=</span>&nbsp;<span class="ident" id="4348692">nil</span>&nbsp;<span class="op" id="4348696">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348702">return</span>&nbsp;<span class="ident" id="4348709">n</span><span class="op" id="4348710">,</span>&nbsp;<span class="ident" id="4348712">z</span><span class="op" id="4348713">.</span><span class="ident" id="4348714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348729">if</span>&nbsp;<span class="ident" id="4348732">z</span><span class="op" id="4348733">.</span><span class="ident" id="4348734">compressor</span>&nbsp;<span class="op" id="4348745">==</span>&nbsp;<span class="ident" id="4348748">nil</span>&nbsp;<span class="op" id="4348752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348757">z</span><span class="op" id="4348758">.</span><span class="ident" id="4348759">compressor</span><span class="op" id="4348769">,</span>&nbsp;<span class="ident" id="4348771">_</span>&nbsp;<span class="op" id="4348773">=</span>&nbsp;<span class="ident" id="4348775">flate</span><span class="op" id="4348780">.</span><span class="ident" id="4348781">NewWriter</span><span class="op" id="4348790">(</span><span class="ident" id="4348791">z</span><span class="op" id="4348792">.</span><span class="ident" id="4348793">w</span><span class="op" id="4348794">,</span>&nbsp;<span class="ident" id="4348796">z</span><span class="op" id="4348797">.</span><span class="ident" id="4348798">level</span><span class="op" id="4348803">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4348810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348813">z</span><span class="op" id="4348814">.</span><span class="ident" id="4348815">size</span>&nbsp;<span class="op" id="4348820">+=</span>&nbsp;<span class="builtintype" id="4348823">uint32</span><span class="op" id="4348829">(</span><span class="builtinfunc" id="4348830">len</span><span class="op" id="4348833">(</span><span class="ident" id="4348834">p</span><span class="op" id="4348835">)</span><span class="op" id="4348836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348839">z</span><span class="op" id="4348840">.</span><span class="ident" id="4348841">digest</span><span class="op" id="4348847">.</span><span class="ident" id="4348848">Write</span><span class="op" id="4348853">(</span><span class="ident" id="4348854">p</span><span class="op" id="4348855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4348858">n</span><span class="op" id="4348859">,</span>&nbsp;<span class="ident" id="4348861">z</span><span class="op" id="4348862">.</span><span class="ident" id="4348863">err</span>&nbsp;<span class="op" id="4348867">=</span>&nbsp;<span class="ident" id="4348869">z</span><span class="op" id="4348870">.</span><span class="ident" id="4348871">compressor</span><span class="op" id="4348881">.</span><span class="ident" id="4348882">Write</span><span class="op" id="4348887">(</span><span class="ident" id="4348888">p</span><span class="op" id="4348889">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4348892">return</span>&nbsp;<span class="ident" id="4348899">n</span><span class="op" id="4348900">,</span>&nbsp;<span class="ident" id="4348902">z</span><span class="op" id="4348903">.</span><span class="ident" id="4348904">err</span><br>
<span class="lineno"></span><span class="op" id="4348908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4348911">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4348982">//</span><br>
<span class="lineno">225</span><span class="comment" id="4348985">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4349056">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4349127">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4349192">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4349246">//</span><br>
<span class="lineno">230</span><span class="comment" id="4349249">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4349329">func</span>&nbsp;<span class="op" id="4349334">(</span><span class="ident" id="4349335">z</span>&nbsp;<span class="op" id="4349337">*</span><span class="ident" id="4349338">Writer</span><span class="op" id="4349344">)</span>&nbsp;<span class="ident" id="4349346">Flush</span><span class="op" id="4349351">(</span><span class="op" id="4349352">)</span>&nbsp;<span class="builtintype" id="4349354">error</span>&nbsp;<span class="op" id="4349360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349363">if</span>&nbsp;<span class="ident" id="4349366">z</span><span class="op" id="4349367">.</span><span class="ident" id="4349368">err</span>&nbsp;<span class="op" id="4349372">!=</span>&nbsp;<span class="ident" id="4349375">nil</span>&nbsp;<span class="op" id="4349379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349383">return</span>&nbsp;<span class="ident" id="4349390">z</span><span class="op" id="4349391">.</span><span class="ident" id="4349392">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349397">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349400">if</span>&nbsp;<span class="ident" id="4349403">z</span><span class="op" id="4349404">.</span><span class="ident" id="4349405">closed</span>&nbsp;<span class="op" id="4349412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349416">return</span>&nbsp;<span class="ident" id="4349423">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349431">if</span>&nbsp;<span class="op" id="4349434">!</span><span class="ident" id="4349435">z</span><span class="op" id="4349436">.</span><span class="ident" id="4349437">wroteHeader</span>&nbsp;<span class="op" id="4349449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349453">z</span><span class="op" id="4349454">.</span><span class="ident" id="4349455">Write</span><span class="op" id="4349460">(</span><span class="ident" id="4349461">nil</span><span class="op" id="4349464">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349468">if</span>&nbsp;<span class="ident" id="4349471">z</span><span class="op" id="4349472">.</span><span class="ident" id="4349473">err</span>&nbsp;<span class="op" id="4349477">!=</span>&nbsp;<span class="ident" id="4349480">nil</span>&nbsp;<span class="op" id="4349484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349489">return</span>&nbsp;<span class="ident" id="4349496">z</span><span class="op" id="4349497">.</span><span class="ident" id="4349498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349510">z</span><span class="op" id="4349511">.</span><span class="ident" id="4349512">err</span>&nbsp;<span class="op" id="4349516">=</span>&nbsp;<span class="ident" id="4349518">z</span><span class="op" id="4349519">.</span><span class="ident" id="4349520">compressor</span><span class="op" id="4349530">.</span><span class="ident" id="4349531">Flush</span><span class="op" id="4349536">(</span><span class="op" id="4349537">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349540">return</span>&nbsp;<span class="ident" id="4349547">z</span><span class="op" id="4349548">.</span><span class="ident" id="4349549">err</span><br>
<span class="lineno"></span><span class="op" id="4349553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4349556">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4349630">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4349689">func</span>&nbsp;<span class="op" id="4349694">(</span><span class="ident" id="4349695">z</span>&nbsp;<span class="op" id="4349697">*</span><span class="ident" id="4349698">Writer</span><span class="op" id="4349704">)</span>&nbsp;<span class="ident" id="4349706">Close</span><span class="op" id="4349711">(</span><span class="op" id="4349712">)</span>&nbsp;<span class="builtintype" id="4349714">error</span>&nbsp;<span class="op" id="4349720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349723">if</span>&nbsp;<span class="ident" id="4349726">z</span><span class="op" id="4349727">.</span><span class="ident" id="4349728">err</span>&nbsp;<span class="op" id="4349732">!=</span>&nbsp;<span class="ident" id="4349735">nil</span>&nbsp;<span class="op" id="4349739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349743">return</span>&nbsp;<span class="ident" id="4349750">z</span><span class="op" id="4349751">.</span><span class="ident" id="4349752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349760">if</span>&nbsp;<span class="ident" id="4349763">z</span><span class="op" id="4349764">.</span><span class="ident" id="4349765">closed</span>&nbsp;<span class="op" id="4349772">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349776">return</span>&nbsp;<span class="ident" id="4349783">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349791">z</span><span class="op" id="4349792">.</span><span class="ident" id="4349793">closed</span>&nbsp;<span class="op" id="4349800">=</span>&nbsp;<span class="builtintype" id="4349802">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349808">if</span>&nbsp;<span class="op" id="4349811">!</span><span class="ident" id="4349812">z</span><span class="op" id="4349813">.</span><span class="ident" id="4349814">wroteHeader</span>&nbsp;<span class="op" id="4349826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349830">z</span><span class="op" id="4349831">.</span><span class="ident" id="4349832">Write</span><span class="op" id="4349837">(</span><span class="ident" id="4349838">nil</span><span class="op" id="4349841">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349845">if</span>&nbsp;<span class="ident" id="4349848">z</span><span class="op" id="4349849">.</span><span class="ident" id="4349850">err</span>&nbsp;<span class="op" id="4349854">!=</span>&nbsp;<span class="ident" id="4349857">nil</span>&nbsp;<span class="op" id="4349861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349866">return</span>&nbsp;<span class="ident" id="4349873">z</span><span class="op" id="4349874">.</span><span class="ident" id="4349875">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349887">z</span><span class="op" id="4349888">.</span><span class="ident" id="4349889">err</span>&nbsp;<span class="op" id="4349893">=</span>&nbsp;<span class="ident" id="4349895">z</span><span class="op" id="4349896">.</span><span class="ident" id="4349897">compressor</span><span class="op" id="4349907">.</span><span class="ident" id="4349908">Close</span><span class="op" id="4349913">(</span><span class="op" id="4349914">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349917">if</span>&nbsp;<span class="ident" id="4349920">z</span><span class="op" id="4349921">.</span><span class="ident" id="4349922">err</span>&nbsp;<span class="op" id="4349926">!=</span>&nbsp;<span class="ident" id="4349929">nil</span>&nbsp;<span class="op" id="4349933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4349937">return</span>&nbsp;<span class="ident" id="4349944">z</span><span class="op" id="4349945">.</span><span class="ident" id="4349946">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4349951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349954">put4</span><span class="op" id="4349958">(</span><span class="ident" id="4349959">z</span><span class="op" id="4349960">.</span><span class="ident" id="4349961">buf</span><span class="op" id="4349964">[</span><span class="num" id="4349965">0</span><span class="op" id="4349966">:</span><span class="num" id="4349967">4</span><span class="op" id="4349968">]</span><span class="op" id="4349969">,</span>&nbsp;<span class="ident" id="4349971">z</span><span class="op" id="4349972">.</span><span class="ident" id="4349973">digest</span><span class="op" id="4349979">.</span><span class="ident" id="4349980">Sum32</span><span class="op" id="4349985">(</span><span class="op" id="4349986">)</span><span class="op" id="4349987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4349990">put4</span><span class="op" id="4349994">(</span><span class="ident" id="4349995">z</span><span class="op" id="4349996">.</span><span class="ident" id="4349997">buf</span><span class="op" id="4350000">[</span><span class="num" id="4350001">4</span><span class="op" id="4350002">:</span><span class="num" id="4350003">8</span><span class="op" id="4350004">]</span><span class="op" id="4350005">,</span>&nbsp;<span class="ident" id="4350007">z</span><span class="op" id="4350008">.</span><span class="ident" id="4350009">size</span><span class="op" id="4350013">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4350016">_</span><span class="op" id="4350017">,</span>&nbsp;<span class="ident" id="4350019">z</span><span class="op" id="4350020">.</span><span class="ident" id="4350021">err</span>&nbsp;<span class="op" id="4350025">=</span>&nbsp;<span class="ident" id="4350027">z</span><span class="op" id="4350028">.</span><span class="ident" id="4350029">w</span><span class="op" id="4350030">.</span><span class="ident" id="4350031">Write</span><span class="op" id="4350036">(</span><span class="ident" id="4350037">z</span><span class="op" id="4350038">.</span><span class="ident" id="4350039">buf</span><span class="op" id="4350042">[</span><span class="num" id="4350043">0</span><span class="op" id="4350044">:</span><span class="num" id="4350045">8</span><span class="op" id="4350046">]</span><span class="op" id="4350047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4350050">return</span>&nbsp;<span class="ident" id="4350057">z</span><span class="op" id="4350058">.</span><span class="ident" id="4350059">err</span><br>
<span class="lineno"></span><span class="op" id="4350063">}</span>
</div>
</body>
</html>
