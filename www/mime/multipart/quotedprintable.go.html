<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3751364">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3751419">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3751473">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3751524">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3751597">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3751612">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3751684">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3751758">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3751807">package</span>&nbsp;<span class="ident" id="3751815">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3751826">import</span>&nbsp;<span class="op" id="3751833">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3751836">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3751845">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3751854">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3751861">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3751866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3751869">type</span>&nbsp;<span class="ident" id="3751874">qpReader</span>&nbsp;<span class="keyword" id="3751883">struct</span>&nbsp;<span class="op" id="3751890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751893">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3751898">*</span><span class="ident" id="3751899">bufio</span><span class="op" id="3751904">.</span><span class="ident" id="3751905">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751913">rerr</span>&nbsp;<span class="builtintype" id="3751918">error</span>&nbsp;&nbsp;<span class="comment" id="3751925">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751945">line</span>&nbsp;<span class="op" id="3751950">[</span><span class="op" id="3751951">]</span><span class="builtintype" id="3751952">byte</span>&nbsp;<span class="comment" id="3751957">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3751993">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3751996">func</span>&nbsp;<span class="ident" id="3752001">newQuotedPrintableReader</span><span class="op" id="3752025">(</span><span class="ident" id="3752026">r</span>&nbsp;<span class="ident" id="3752028">io</span><span class="op" id="3752030">.</span><span class="ident" id="3752031">Reader</span><span class="op" id="3752037">)</span>&nbsp;<span class="ident" id="3752039">io</span><span class="op" id="3752041">.</span><span class="ident" id="3752042">Reader</span>&nbsp;<span class="op" id="3752049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752052">return</span>&nbsp;<span class="op" id="3752059">&amp;</span><span class="ident" id="3752060">qpReader</span><span class="op" id="3752068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752072">br</span><span class="op" id="3752074">:</span>&nbsp;<span class="ident" id="3752076">bufio</span><span class="op" id="3752081">.</span><span class="ident" id="3752082">NewReader</span><span class="op" id="3752091">(</span><span class="ident" id="3752092">r</span><span class="op" id="3752093">)</span><span class="op" id="3752094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752097">}</span><br>
<span class="lineno">30</span><span class="op" id="3752099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3752102">func</span>&nbsp;<span class="ident" id="3752107">fromHex</span><span class="op" id="3752114">(</span><span class="ident" id="3752115">b</span>&nbsp;<span class="builtintype" id="3752117">byte</span><span class="op" id="3752121">)</span>&nbsp;<span class="op" id="3752123">(</span><span class="builtintype" id="3752124">byte</span><span class="op" id="3752128">,</span>&nbsp;<span class="builtintype" id="3752130">error</span><span class="op" id="3752135">)</span>&nbsp;<span class="op" id="3752137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752140">switch</span>&nbsp;<span class="op" id="3752147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752150">case</span>&nbsp;<span class="ident" id="3752155">b</span>&nbsp;<span class="op" id="3752157">&gt;=</span>&nbsp;<span class="string" id="3752160">&#39;0&#39;</span>&nbsp;<span class="op" id="3752164">&amp;&amp;</span>&nbsp;<span class="ident" id="3752167">b</span>&nbsp;<span class="op" id="3752169">&lt;=</span>&nbsp;<span class="string" id="3752172">&#39;9&#39;</span><span class="op" id="3752175">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752179">return</span>&nbsp;<span class="ident" id="3752186">b</span>&nbsp;<span class="op" id="3752188">-</span>&nbsp;<span class="string" id="3752190">&#39;0&#39;</span><span class="op" id="3752193">,</span>&nbsp;<span class="ident" id="3752195">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752200">case</span>&nbsp;<span class="ident" id="3752205">b</span>&nbsp;<span class="op" id="3752207">&gt;=</span>&nbsp;<span class="string" id="3752210">&#39;A&#39;</span>&nbsp;<span class="op" id="3752214">&amp;&amp;</span>&nbsp;<span class="ident" id="3752217">b</span>&nbsp;<span class="op" id="3752219">&lt;=</span>&nbsp;<span class="string" id="3752222">&#39;F&#39;</span><span class="op" id="3752225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752229">return</span>&nbsp;<span class="ident" id="3752236">b</span>&nbsp;<span class="op" id="3752238">-</span>&nbsp;<span class="string" id="3752240">&#39;A&#39;</span>&nbsp;<span class="op" id="3752244">+</span>&nbsp;<span class="num" id="3752246">10</span><span class="op" id="3752248">,</span>&nbsp;<span class="ident" id="3752250">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752258">return</span>&nbsp;<span class="num" id="3752265">0</span><span class="op" id="3752266">,</span>&nbsp;<span class="ident" id="3752268">fmt</span><span class="op" id="3752271">.</span><span class="ident" id="3752272">Errorf</span><span class="op" id="3752278">(</span><span class="string" id="3752279">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3752332">,</span>&nbsp;<span class="ident" id="3752334">b</span><span class="op" id="3752335">)</span><br>
<span class="lineno">40</span><span class="op" id="3752337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3752340">func</span>&nbsp;<span class="op" id="3752345">(</span><span class="ident" id="3752346">q</span>&nbsp;<span class="op" id="3752348">*</span><span class="ident" id="3752349">qpReader</span><span class="op" id="3752357">)</span>&nbsp;<span class="ident" id="3752359">readHexByte</span><span class="op" id="3752370">(</span><span class="ident" id="3752371">v</span>&nbsp;<span class="op" id="3752373">[</span><span class="op" id="3752374">]</span><span class="builtintype" id="3752375">byte</span><span class="op" id="3752379">)</span>&nbsp;<span class="op" id="3752381">(</span><span class="ident" id="3752382">b</span>&nbsp;<span class="builtintype" id="3752384">byte</span><span class="op" id="3752388">,</span>&nbsp;<span class="ident" id="3752390">err</span>&nbsp;<span class="builtintype" id="3752394">error</span><span class="op" id="3752399">)</span>&nbsp;<span class="op" id="3752401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752404">if</span>&nbsp;<span class="builtinfunc" id="3752407">len</span><span class="op" id="3752410">(</span><span class="ident" id="3752411">v</span><span class="op" id="3752412">)</span>&nbsp;<span class="op" id="3752414">&lt;</span>&nbsp;<span class="num" id="3752416">2</span>&nbsp;<span class="op" id="3752418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752422">return</span>&nbsp;<span class="num" id="3752429">0</span><span class="op" id="3752430">,</span>&nbsp;<span class="ident" id="3752432">io</span><span class="op" id="3752434">.</span><span class="ident" id="3752435">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752456">var</span>&nbsp;<span class="ident" id="3752460">hb</span><span class="op" id="3752462">,</span>&nbsp;<span class="ident" id="3752464">lb</span>&nbsp;<span class="builtintype" id="3752467">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752473">if</span>&nbsp;<span class="ident" id="3752476">hb</span><span class="op" id="3752478">,</span>&nbsp;<span class="ident" id="3752480">err</span>&nbsp;<span class="op" id="3752484">=</span>&nbsp;<span class="ident" id="3752486">fromHex</span><span class="op" id="3752493">(</span><span class="ident" id="3752494">v</span><span class="op" id="3752495">[</span><span class="num" id="3752496">0</span><span class="op" id="3752497">]</span><span class="op" id="3752498">)</span><span class="op" id="3752499">;</span>&nbsp;<span class="ident" id="3752501">err</span>&nbsp;<span class="op" id="3752505">!=</span>&nbsp;<span class="ident" id="3752508">nil</span>&nbsp;<span class="op" id="3752512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752516">return</span>&nbsp;<span class="num" id="3752523">0</span><span class="op" id="3752524">,</span>&nbsp;<span class="ident" id="3752526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752531">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752534">if</span>&nbsp;<span class="ident" id="3752537">lb</span><span class="op" id="3752539">,</span>&nbsp;<span class="ident" id="3752541">err</span>&nbsp;<span class="op" id="3752545">=</span>&nbsp;<span class="ident" id="3752547">fromHex</span><span class="op" id="3752554">(</span><span class="ident" id="3752555">v</span><span class="op" id="3752556">[</span><span class="num" id="3752557">1</span><span class="op" id="3752558">]</span><span class="op" id="3752559">)</span><span class="op" id="3752560">;</span>&nbsp;<span class="ident" id="3752562">err</span>&nbsp;<span class="op" id="3752566">!=</span>&nbsp;<span class="ident" id="3752569">nil</span>&nbsp;<span class="op" id="3752573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752577">return</span>&nbsp;<span class="num" id="3752584">0</span><span class="op" id="3752585">,</span>&nbsp;<span class="ident" id="3752587">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752595">return</span>&nbsp;<span class="ident" id="3752602">hb</span><span class="op" id="3752604">&lt;&lt;</span><span class="num" id="3752606">4</span>&nbsp;<span class="op" id="3752608">|</span>&nbsp;<span class="ident" id="3752610">lb</span><span class="op" id="3752612">,</span>&nbsp;<span class="ident" id="3752614">nil</span><br>
<span class="lineno"></span><span class="op" id="3752618">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3752621">func</span>&nbsp;<span class="ident" id="3752626">isQPDiscardWhitespace</span><span class="op" id="3752647">(</span><span class="ident" id="3752648">r</span>&nbsp;<span class="builtintype" id="3752650">rune</span><span class="op" id="3752654">)</span>&nbsp;<span class="builtintype" id="3752656">bool</span>&nbsp;<span class="op" id="3752661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752664">switch</span>&nbsp;<span class="ident" id="3752671">r</span>&nbsp;<span class="op" id="3752673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752676">case</span>&nbsp;<span class="string" id="3752681">&#39;\n&#39;</span><span class="op" id="3752685">,</span>&nbsp;<span class="string" id="3752687">&#39;\r&#39;</span><span class="op" id="3752691">,</span>&nbsp;<span class="string" id="3752693">&#39;&nbsp;&#39;</span><span class="op" id="3752696">,</span>&nbsp;<span class="string" id="3752698">&#39;\t&#39;</span><span class="op" id="3752702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752706">return</span>&nbsp;<span class="ident" id="3752713">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752722">return</span>&nbsp;<span class="ident" id="3752729">false</span><br>
<span class="lineno"></span><span class="op" id="3752735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3752738">var</span>&nbsp;<span class="op" id="3752742">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752745">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752756">=</span>&nbsp;<span class="op" id="3752758">[</span><span class="op" id="3752759">]</span><span class="builtintype" id="3752760">byte</span><span class="op" id="3752764">(</span><span class="string" id="3752765">&#34;\r\n&#34;</span><span class="op" id="3752771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752774">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752785">=</span>&nbsp;<span class="op" id="3752787">[</span><span class="op" id="3752788">]</span><span class="builtintype" id="3752789">byte</span><span class="op" id="3752793">(</span><span class="string" id="3752794">&#34;\n&#34;</span><span class="op" id="3752798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752801">softSuffix</span>&nbsp;<span class="op" id="3752812">=</span>&nbsp;<span class="op" id="3752814">[</span><span class="op" id="3752815">]</span><span class="builtintype" id="3752816">byte</span><span class="op" id="3752820">(</span><span class="string" id="3752821">&#34;=&#34;</span><span class="op" id="3752824">)</span><br>
<span class="lineno"></span><span class="op" id="3752826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3752829">func</span>&nbsp;<span class="op" id="3752834">(</span><span class="ident" id="3752835">q</span>&nbsp;<span class="op" id="3752837">*</span><span class="ident" id="3752838">qpReader</span><span class="op" id="3752846">)</span>&nbsp;<span class="ident" id="3752848">Read</span><span class="op" id="3752852">(</span><span class="ident" id="3752853">p</span>&nbsp;<span class="op" id="3752855">[</span><span class="op" id="3752856">]</span><span class="builtintype" id="3752857">byte</span><span class="op" id="3752861">)</span>&nbsp;<span class="op" id="3752863">(</span><span class="ident" id="3752864">n</span>&nbsp;<span class="builtintype" id="3752866">int</span><span class="op" id="3752869">,</span>&nbsp;<span class="ident" id="3752871">err</span>&nbsp;<span class="builtintype" id="3752875">error</span><span class="op" id="3752880">)</span>&nbsp;<span class="op" id="3752882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752885">for</span>&nbsp;<span class="builtinfunc" id="3752889">len</span><span class="op" id="3752892">(</span><span class="ident" id="3752893">p</span><span class="op" id="3752894">)</span>&nbsp;<span class="op" id="3752896">&gt;</span>&nbsp;<span class="num" id="3752898">0</span>&nbsp;<span class="op" id="3752900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752904">if</span>&nbsp;<span class="builtinfunc" id="3752907">len</span><span class="op" id="3752910">(</span><span class="ident" id="3752911">q</span><span class="op" id="3752912">.</span><span class="ident" id="3752913">line</span><span class="op" id="3752917">)</span>&nbsp;<span class="op" id="3752919">==</span>&nbsp;<span class="num" id="3752922">0</span>&nbsp;<span class="op" id="3752924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752929">if</span>&nbsp;<span class="ident" id="3752932">q</span><span class="op" id="3752933">.</span><span class="ident" id="3752934">rerr</span>&nbsp;<span class="op" id="3752939">!=</span>&nbsp;<span class="ident" id="3752942">nil</span>&nbsp;<span class="op" id="3752946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752952">return</span>&nbsp;<span class="ident" id="3752959">n</span><span class="op" id="3752960">,</span>&nbsp;<span class="ident" id="3752962">q</span><span class="op" id="3752963">.</span><span class="ident" id="3752964">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752977">q</span><span class="op" id="3752978">.</span><span class="ident" id="3752979">line</span><span class="op" id="3752983">,</span>&nbsp;<span class="ident" id="3752985">q</span><span class="op" id="3752986">.</span><span class="ident" id="3752987">rerr</span>&nbsp;<span class="op" id="3752992">=</span>&nbsp;<span class="ident" id="3752994">q</span><span class="op" id="3752995">.</span><span class="ident" id="3752996">br</span><span class="op" id="3752998">.</span><span class="ident" id="3752999">ReadSlice</span><span class="op" id="3753008">(</span><span class="string" id="3753009">&#39;\n&#39;</span><span class="op" id="3753013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3753019">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753071">hasLF</span>&nbsp;<span class="op" id="3753077">:=</span>&nbsp;<span class="ident" id="3753080">bytes</span><span class="op" id="3753085">.</span><span class="ident" id="3753086">HasSuffix</span><span class="op" id="3753095">(</span><span class="ident" id="3753096">q</span><span class="op" id="3753097">.</span><span class="ident" id="3753098">line</span><span class="op" id="3753102">,</span>&nbsp;<span class="ident" id="3753104">lf</span><span class="op" id="3753106">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753111">hasCR</span>&nbsp;<span class="op" id="3753117">:=</span>&nbsp;<span class="ident" id="3753120">bytes</span><span class="op" id="3753125">.</span><span class="ident" id="3753126">HasSuffix</span><span class="op" id="3753135">(</span><span class="ident" id="3753136">q</span><span class="op" id="3753137">.</span><span class="ident" id="3753138">line</span><span class="op" id="3753142">,</span>&nbsp;<span class="ident" id="3753144">crlf</span><span class="op" id="3753148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753153">wholeLine</span>&nbsp;<span class="op" id="3753163">:=</span>&nbsp;<span class="ident" id="3753166">q</span><span class="op" id="3753167">.</span><span class="ident" id="3753168">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753176">q</span><span class="op" id="3753177">.</span><span class="ident" id="3753178">line</span>&nbsp;<span class="op" id="3753183">=</span>&nbsp;<span class="ident" id="3753185">bytes</span><span class="op" id="3753190">.</span><span class="ident" id="3753191">TrimRightFunc</span><span class="op" id="3753204">(</span><span class="ident" id="3753205">wholeLine</span><span class="op" id="3753214">,</span>&nbsp;<span class="ident" id="3753216">isQPDiscardWhitespace</span><span class="op" id="3753237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753242">if</span>&nbsp;<span class="ident" id="3753245">bytes</span><span class="op" id="3753250">.</span><span class="ident" id="3753251">HasSuffix</span><span class="op" id="3753260">(</span><span class="ident" id="3753261">q</span><span class="op" id="3753262">.</span><span class="ident" id="3753263">line</span><span class="op" id="3753267">,</span>&nbsp;<span class="ident" id="3753269">softSuffix</span><span class="op" id="3753279">)</span>&nbsp;<span class="op" id="3753281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753287">rightStripped</span>&nbsp;<span class="op" id="3753301">:=</span>&nbsp;<span class="ident" id="3753304">wholeLine</span><span class="op" id="3753313">[</span><span class="builtinfunc" id="3753314">len</span><span class="op" id="3753317">(</span><span class="ident" id="3753318">q</span><span class="op" id="3753319">.</span><span class="ident" id="3753320">line</span><span class="op" id="3753324">)</span><span class="op" id="3753325">:</span><span class="op" id="3753326">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753332">q</span><span class="op" id="3753333">.</span><span class="ident" id="3753334">line</span>&nbsp;<span class="op" id="3753339">=</span>&nbsp;<span class="ident" id="3753341">q</span><span class="op" id="3753342">.</span><span class="ident" id="3753343">line</span><span class="op" id="3753347">[</span><span class="op" id="3753348">:</span><span class="builtinfunc" id="3753349">len</span><span class="op" id="3753352">(</span><span class="ident" id="3753353">q</span><span class="op" id="3753354">.</span><span class="ident" id="3753355">line</span><span class="op" id="3753359">)</span><span class="op" id="3753360">-</span><span class="num" id="3753361">1</span><span class="op" id="3753362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753368">if</span>&nbsp;<span class="op" id="3753371">!</span><span class="ident" id="3753372">bytes</span><span class="op" id="3753377">.</span><span class="ident" id="3753378">HasPrefix</span><span class="op" id="3753387">(</span><span class="ident" id="3753388">rightStripped</span><span class="op" id="3753401">,</span>&nbsp;<span class="ident" id="3753403">lf</span><span class="op" id="3753405">)</span>&nbsp;<span class="op" id="3753407">&amp;&amp;</span>&nbsp;<span class="op" id="3753410">!</span><span class="ident" id="3753411">bytes</span><span class="op" id="3753416">.</span><span class="ident" id="3753417">HasPrefix</span><span class="op" id="3753426">(</span><span class="ident" id="3753427">rightStripped</span><span class="op" id="3753440">,</span>&nbsp;<span class="ident" id="3753442">crlf</span><span class="op" id="3753446">)</span>&nbsp;<span class="op" id="3753448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753455">q</span><span class="op" id="3753456">.</span><span class="ident" id="3753457">rerr</span>&nbsp;<span class="op" id="3753462">=</span>&nbsp;<span class="ident" id="3753464">fmt</span><span class="op" id="3753467">.</span><span class="ident" id="3753468">Errorf</span><span class="op" id="3753474">(</span><span class="string" id="3753475">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3753513">,</span>&nbsp;<span class="ident" id="3753515">rightStripped</span><span class="op" id="3753528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753539">}</span>&nbsp;<span class="keyword" id="3753541">else</span>&nbsp;<span class="keyword" id="3753546">if</span>&nbsp;<span class="ident" id="3753549">hasLF</span>&nbsp;<span class="op" id="3753555">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753561">if</span>&nbsp;<span class="ident" id="3753564">hasCR</span>&nbsp;<span class="op" id="3753570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753577">q</span><span class="op" id="3753578">.</span><span class="ident" id="3753579">line</span>&nbsp;<span class="op" id="3753584">=</span>&nbsp;<span class="builtinfunc" id="3753586">append</span><span class="op" id="3753592">(</span><span class="ident" id="3753593">q</span><span class="op" id="3753594">.</span><span class="ident" id="3753595">line</span><span class="op" id="3753599">,</span>&nbsp;<span class="string" id="3753601">&#39;\r&#39;</span><span class="op" id="3753605">,</span>&nbsp;<span class="string" id="3753607">&#39;\n&#39;</span><span class="op" id="3753611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753617">}</span>&nbsp;<span class="keyword" id="3753619">else</span>&nbsp;<span class="op" id="3753624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753631">q</span><span class="op" id="3753632">.</span><span class="ident" id="3753633">line</span>&nbsp;<span class="op" id="3753638">=</span>&nbsp;<span class="builtinfunc" id="3753640">append</span><span class="op" id="3753646">(</span><span class="ident" id="3753647">q</span><span class="op" id="3753648">.</span><span class="ident" id="3753649">line</span><span class="op" id="3753653">,</span>&nbsp;<span class="string" id="3753655">&#39;\n&#39;</span><span class="op" id="3753659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753665">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753675">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753690">b</span>&nbsp;<span class="op" id="3753692">:=</span>&nbsp;<span class="ident" id="3753695">q</span><span class="op" id="3753696">.</span><span class="ident" id="3753697">line</span><span class="op" id="3753701">[</span><span class="num" id="3753702">0</span><span class="op" id="3753703">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753708">switch</span>&nbsp;<span class="op" id="3753715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753719">case</span>&nbsp;<span class="ident" id="3753724">b</span>&nbsp;<span class="op" id="3753726">==</span>&nbsp;<span class="string" id="3753729">&#39;=&#39;</span><span class="op" id="3753732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753737">b</span><span class="op" id="3753738">,</span>&nbsp;<span class="ident" id="3753740">err</span>&nbsp;<span class="op" id="3753744">=</span>&nbsp;<span class="ident" id="3753746">q</span><span class="op" id="3753747">.</span><span class="ident" id="3753748">readHexByte</span><span class="op" id="3753759">(</span><span class="ident" id="3753760">q</span><span class="op" id="3753761">.</span><span class="ident" id="3753762">line</span><span class="op" id="3753766">[</span><span class="num" id="3753767">1</span><span class="op" id="3753768">:</span><span class="op" id="3753769">]</span><span class="op" id="3753770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753775">if</span>&nbsp;<span class="ident" id="3753778">err</span>&nbsp;<span class="op" id="3753782">!=</span>&nbsp;<span class="ident" id="3753785">nil</span>&nbsp;<span class="op" id="3753789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753795">return</span>&nbsp;<span class="ident" id="3753802">n</span><span class="op" id="3753803">,</span>&nbsp;<span class="ident" id="3753805">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753817">q</span><span class="op" id="3753818">.</span><span class="ident" id="3753819">line</span>&nbsp;<span class="op" id="3753824">=</span>&nbsp;<span class="ident" id="3753826">q</span><span class="op" id="3753827">.</span><span class="ident" id="3753828">line</span><span class="op" id="3753832">[</span><span class="num" id="3753833">2</span><span class="op" id="3753834">:</span><span class="op" id="3753835">]</span>&nbsp;<span class="comment" id="3753837">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753876">case</span>&nbsp;<span class="ident" id="3753881">b</span>&nbsp;<span class="op" id="3753883">==</span>&nbsp;<span class="string" id="3753886">&#39;\t&#39;</span>&nbsp;<span class="op" id="3753891">||</span>&nbsp;<span class="ident" id="3753894">b</span>&nbsp;<span class="op" id="3753896">==</span>&nbsp;<span class="string" id="3753899">&#39;\r&#39;</span>&nbsp;<span class="op" id="3753904">||</span>&nbsp;<span class="ident" id="3753907">b</span>&nbsp;<span class="op" id="3753909">==</span>&nbsp;<span class="string" id="3753912">&#39;\n&#39;</span><span class="op" id="3753916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753921">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753929">case</span>&nbsp;<span class="ident" id="3753934">b</span>&nbsp;<span class="op" id="3753936">&lt;</span>&nbsp;<span class="string" id="3753938">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3753942">||</span>&nbsp;<span class="ident" id="3753945">b</span>&nbsp;<span class="op" id="3753947">&gt;</span>&nbsp;<span class="string" id="3753949">&#39;~&#39;</span><span class="op" id="3753952">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753957">return</span>&nbsp;<span class="ident" id="3753964">n</span><span class="op" id="3753965">,</span>&nbsp;<span class="ident" id="3753967">fmt</span><span class="op" id="3753970">.</span><span class="ident" id="3753971">Errorf</span><span class="op" id="3753977">(</span><span class="string" id="3753978">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3754045">,</span>&nbsp;<span class="ident" id="3754047">b</span><span class="op" id="3754048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3754052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754056">p</span><span class="op" id="3754057">[</span><span class="num" id="3754058">0</span><span class="op" id="3754059">]</span>&nbsp;<span class="op" id="3754061">=</span>&nbsp;<span class="ident" id="3754063">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754067">p</span>&nbsp;<span class="op" id="3754069">=</span>&nbsp;<span class="ident" id="3754071">p</span><span class="op" id="3754072">[</span><span class="num" id="3754073">1</span><span class="op" id="3754074">:</span><span class="op" id="3754075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754079">q</span><span class="op" id="3754080">.</span><span class="ident" id="3754081">line</span>&nbsp;<span class="op" id="3754086">=</span>&nbsp;<span class="ident" id="3754088">q</span><span class="op" id="3754089">.</span><span class="ident" id="3754090">line</span><span class="op" id="3754094">[</span><span class="num" id="3754095">1</span><span class="op" id="3754096">:</span><span class="op" id="3754097">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754101">n</span><span class="op" id="3754102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3754106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754109">return</span>&nbsp;<span class="ident" id="3754116">n</span><span class="op" id="3754117">,</span>&nbsp;<span class="ident" id="3754119">nil</span><br>
<span class="lineno"></span><span class="op" id="3754123">}</span>
</div>
</body>
</html>
