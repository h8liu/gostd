<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5546217">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5546272">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5546326">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5546377">package</span>&nbsp;<span class="ident" id="5546385">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5546393">import</span>&nbsp;<span class="string" id="5546400">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546411">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5546497">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5546576">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5546647">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5546713">//</span><br>
<span class="lineno"></span><span class="comment" id="5546716">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5546794">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5546855">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5546902">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5546972">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5547049">type</span>&nbsp;<span class="ident" id="5547054">patchList</span>&nbsp;<span class="builtintype" id="5547064">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5547072">func</span>&nbsp;<span class="op" id="5547077">(</span><span class="ident" id="5547078">l</span>&nbsp;<span class="ident" id="5547080">patchList</span><span class="op" id="5547089">)</span>&nbsp;<span class="ident" id="5547091">next</span><span class="op" id="5547095">(</span><span class="ident" id="5547096">p</span>&nbsp;<span class="op" id="5547098">*</span><span class="ident" id="5547099">Prog</span><span class="op" id="5547103">)</span>&nbsp;<span class="ident" id="5547105">patchList</span>&nbsp;<span class="op" id="5547115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547118">i</span>&nbsp;<span class="op" id="5547120">:=</span>&nbsp;<span class="op" id="5547123">&amp;</span><span class="ident" id="5547124">p</span><span class="op" id="5547125">.</span><span class="ident" id="5547126">Inst</span><span class="op" id="5547130">[</span><span class="ident" id="5547131">l</span><span class="op" id="5547132">&gt;&gt;</span><span class="num" id="5547134">1</span><span class="op" id="5547135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547138">if</span>&nbsp;<span class="ident" id="5547141">l</span><span class="op" id="5547142">&amp;</span><span class="num" id="5547143">1</span>&nbsp;<span class="op" id="5547145">==</span>&nbsp;<span class="num" id="5547148">0</span>&nbsp;<span class="op" id="5547150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547154">return</span>&nbsp;<span class="ident" id="5547161">patchList</span><span class="op" id="5547170">(</span><span class="ident" id="5547171">i</span><span class="op" id="5547172">.</span><span class="ident" id="5547173">Out</span><span class="op" id="5547176">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547182">return</span>&nbsp;<span class="ident" id="5547189">patchList</span><span class="op" id="5547198">(</span><span class="ident" id="5547199">i</span><span class="op" id="5547200">.</span><span class="ident" id="5547201">Arg</span><span class="op" id="5547204">)</span><br>
<span class="lineno"></span><span class="op" id="5547206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547209">func</span>&nbsp;<span class="op" id="5547214">(</span><span class="ident" id="5547215">l</span>&nbsp;<span class="ident" id="5547217">patchList</span><span class="op" id="5547226">)</span>&nbsp;<span class="ident" id="5547228">patch</span><span class="op" id="5547233">(</span><span class="ident" id="5547234">p</span>&nbsp;<span class="op" id="5547236">*</span><span class="ident" id="5547237">Prog</span><span class="op" id="5547241">,</span>&nbsp;<span class="ident" id="5547243">val</span>&nbsp;<span class="builtintype" id="5547247">uint32</span><span class="op" id="5547253">)</span>&nbsp;<span class="op" id="5547255">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547258">for</span>&nbsp;<span class="ident" id="5547262">l</span>&nbsp;<span class="op" id="5547264">!=</span>&nbsp;<span class="num" id="5547267">0</span>&nbsp;<span class="op" id="5547269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547273">i</span>&nbsp;<span class="op" id="5547275">:=</span>&nbsp;<span class="op" id="5547278">&amp;</span><span class="ident" id="5547279">p</span><span class="op" id="5547280">.</span><span class="ident" id="5547281">Inst</span><span class="op" id="5547285">[</span><span class="ident" id="5547286">l</span><span class="op" id="5547287">&gt;&gt;</span><span class="num" id="5547289">1</span><span class="op" id="5547290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547294">if</span>&nbsp;<span class="ident" id="5547297">l</span><span class="op" id="5547298">&amp;</span><span class="num" id="5547299">1</span>&nbsp;<span class="op" id="5547301">==</span>&nbsp;<span class="num" id="5547304">0</span>&nbsp;<span class="op" id="5547306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547311">l</span>&nbsp;<span class="op" id="5547313">=</span>&nbsp;<span class="ident" id="5547315">patchList</span><span class="op" id="5547324">(</span><span class="ident" id="5547325">i</span><span class="op" id="5547326">.</span><span class="ident" id="5547327">Out</span><span class="op" id="5547330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547335">i</span><span class="op" id="5547336">.</span><span class="ident" id="5547337">Out</span>&nbsp;<span class="op" id="5547341">=</span>&nbsp;<span class="ident" id="5547343">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547349">}</span>&nbsp;<span class="keyword" id="5547351">else</span>&nbsp;<span class="op" id="5547356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547361">l</span>&nbsp;<span class="op" id="5547363">=</span>&nbsp;<span class="ident" id="5547365">patchList</span><span class="op" id="5547374">(</span><span class="ident" id="5547375">i</span><span class="op" id="5547376">.</span><span class="ident" id="5547377">Arg</span><span class="op" id="5547380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547385">i</span><span class="op" id="5547386">.</span><span class="ident" id="5547387">Arg</span>&nbsp;<span class="op" id="5547391">=</span>&nbsp;<span class="ident" id="5547393">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547402">}</span><br>
<span class="lineno">40</span><span class="op" id="5547404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547407">func</span>&nbsp;<span class="op" id="5547412">(</span><span class="ident" id="5547413">l1</span>&nbsp;<span class="ident" id="5547416">patchList</span><span class="op" id="5547425">)</span>&nbsp;<span class="builtinfunc" id="5547427">append</span><span class="op" id="5547433">(</span><span class="ident" id="5547434">p</span>&nbsp;<span class="op" id="5547436">*</span><span class="ident" id="5547437">Prog</span><span class="op" id="5547441">,</span>&nbsp;<span class="ident" id="5547443">l2</span>&nbsp;<span class="ident" id="5547446">patchList</span><span class="op" id="5547455">)</span>&nbsp;<span class="ident" id="5547457">patchList</span>&nbsp;<span class="op" id="5547467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547470">if</span>&nbsp;<span class="ident" id="5547473">l1</span>&nbsp;<span class="op" id="5547476">==</span>&nbsp;<span class="num" id="5547479">0</span>&nbsp;<span class="op" id="5547481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547485">return</span>&nbsp;<span class="ident" id="5547492">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547499">if</span>&nbsp;<span class="ident" id="5547502">l2</span>&nbsp;<span class="op" id="5547505">==</span>&nbsp;<span class="num" id="5547508">0</span>&nbsp;<span class="op" id="5547510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547514">return</span>&nbsp;<span class="ident" id="5547521">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547529">last</span>&nbsp;<span class="op" id="5547534">:=</span>&nbsp;<span class="ident" id="5547537">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547541">for</span>&nbsp;<span class="op" id="5547545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547549">next</span>&nbsp;<span class="op" id="5547554">:=</span>&nbsp;<span class="ident" id="5547557">last</span><span class="op" id="5547561">.</span><span class="ident" id="5547562">next</span><span class="op" id="5547566">(</span><span class="ident" id="5547567">p</span><span class="op" id="5547568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547572">if</span>&nbsp;<span class="ident" id="5547575">next</span>&nbsp;<span class="op" id="5547580">==</span>&nbsp;<span class="num" id="5547583">0</span>&nbsp;<span class="op" id="5547585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547590">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547602">last</span>&nbsp;<span class="op" id="5547607">=</span>&nbsp;<span class="ident" id="5547609">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547619">i</span>&nbsp;<span class="op" id="5547621">:=</span>&nbsp;<span class="op" id="5547624">&amp;</span><span class="ident" id="5547625">p</span><span class="op" id="5547626">.</span><span class="ident" id="5547627">Inst</span><span class="op" id="5547631">[</span><span class="ident" id="5547632">last</span><span class="op" id="5547636">&gt;&gt;</span><span class="num" id="5547638">1</span><span class="op" id="5547639">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547642">if</span>&nbsp;<span class="ident" id="5547645">last</span><span class="op" id="5547649">&amp;</span><span class="num" id="5547650">1</span>&nbsp;<span class="op" id="5547652">==</span>&nbsp;<span class="num" id="5547655">0</span>&nbsp;<span class="op" id="5547657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547661">i</span><span class="op" id="5547662">.</span><span class="ident" id="5547663">Out</span>&nbsp;<span class="op" id="5547667">=</span>&nbsp;<span class="builtintype" id="5547669">uint32</span><span class="op" id="5547675">(</span><span class="ident" id="5547676">l2</span><span class="op" id="5547678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547681">}</span>&nbsp;<span class="keyword" id="5547683">else</span>&nbsp;<span class="op" id="5547688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547692">i</span><span class="op" id="5547693">.</span><span class="ident" id="5547694">Arg</span>&nbsp;<span class="op" id="5547698">=</span>&nbsp;<span class="builtintype" id="5547700">uint32</span><span class="op" id="5547706">(</span><span class="ident" id="5547707">l2</span><span class="op" id="5547709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547712">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547715">return</span>&nbsp;<span class="ident" id="5547722">l1</span><br>
<span class="lineno"></span><span class="op" id="5547725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547728">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5547778">type</span>&nbsp;<span class="ident" id="5547783">frag</span>&nbsp;<span class="keyword" id="5547788">struct</span>&nbsp;<span class="op" id="5547795">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547798">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5547802">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547812">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547843">out</span>&nbsp;<span class="ident" id="5547847">patchList</span>&nbsp;<span class="comment" id="5547857">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5547892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547895">type</span>&nbsp;<span class="ident" id="5547900">compiler</span>&nbsp;<span class="keyword" id="5547909">struct</span>&nbsp;<span class="op" id="5547916">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547919">p</span>&nbsp;<span class="op" id="5547921">*</span><span class="ident" id="5547922">Prog</span><br>
<span class="lineno"></span><span class="op" id="5547927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547930">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5547992">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5548071">func</span>&nbsp;<span class="ident" id="5548076">Compile</span><span class="op" id="5548083">(</span><span class="ident" id="5548084">re</span>&nbsp;<span class="op" id="5548087">*</span><span class="ident" id="5548088">Regexp</span><span class="op" id="5548094">)</span>&nbsp;<span class="op" id="5548096">(</span><span class="op" id="5548097">*</span><span class="ident" id="5548098">Prog</span><span class="op" id="5548102">,</span>&nbsp;<span class="builtintype" id="5548104">error</span><span class="op" id="5548109">)</span>&nbsp;<span class="op" id="5548111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548114">var</span>&nbsp;<span class="ident" id="5548118">c</span>&nbsp;<span class="ident" id="5548120">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548130">c</span><span class="op" id="5548131">.</span><span class="ident" id="5548132">init</span><span class="op" id="5548136">(</span><span class="op" id="5548137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548140">f</span>&nbsp;<span class="op" id="5548142">:=</span>&nbsp;<span class="ident" id="5548145">c</span><span class="op" id="5548146">.</span><span class="ident" id="5548147">compile</span><span class="op" id="5548154">(</span><span class="ident" id="5548155">re</span><span class="op" id="5548157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548160">f</span><span class="op" id="5548161">.</span><span class="ident" id="5548162">out</span><span class="op" id="5548165">.</span><span class="ident" id="5548166">patch</span><span class="op" id="5548171">(</span><span class="ident" id="5548172">c</span><span class="op" id="5548173">.</span><span class="ident" id="5548174">p</span><span class="op" id="5548175">,</span>&nbsp;<span class="ident" id="5548177">c</span><span class="op" id="5548178">.</span><span class="ident" id="5548179">inst</span><span class="op" id="5548183">(</span><span class="ident" id="5548184">InstMatch</span><span class="op" id="5548193">)</span><span class="op" id="5548194">.</span><span class="ident" id="5548195">i</span><span class="op" id="5548196">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548199">c</span><span class="op" id="5548200">.</span><span class="ident" id="5548201">p</span><span class="op" id="5548202">.</span><span class="ident" id="5548203">Start</span>&nbsp;<span class="op" id="5548209">=</span>&nbsp;<span class="builtintype" id="5548211">int</span><span class="op" id="5548214">(</span><span class="ident" id="5548215">f</span><span class="op" id="5548216">.</span><span class="ident" id="5548217">i</span><span class="op" id="5548218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548221">return</span>&nbsp;<span class="ident" id="5548228">c</span><span class="op" id="5548229">.</span><span class="ident" id="5548230">p</span><span class="op" id="5548231">,</span>&nbsp;<span class="ident" id="5548233">nil</span><br>
<span class="lineno"></span><span class="op" id="5548237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5548240">func</span>&nbsp;<span class="op" id="5548245">(</span><span class="ident" id="5548246">c</span>&nbsp;<span class="op" id="5548248">*</span><span class="ident" id="5548249">compiler</span><span class="op" id="5548257">)</span>&nbsp;<span class="ident" id="5548259">init</span><span class="op" id="5548263">(</span><span class="op" id="5548264">)</span>&nbsp;<span class="op" id="5548266">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548269">c</span><span class="op" id="5548270">.</span><span class="ident" id="5548271">p</span>&nbsp;<span class="op" id="5548273">=</span>&nbsp;<span class="builtinfunc" id="5548275">new</span><span class="op" id="5548278">(</span><span class="ident" id="5548279">Prog</span><span class="op" id="5548283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548286">c</span><span class="op" id="5548287">.</span><span class="ident" id="5548288">p</span><span class="op" id="5548289">.</span><span class="ident" id="5548290">NumCap</span>&nbsp;<span class="op" id="5548297">=</span>&nbsp;<span class="num" id="5548299">2</span>&nbsp;<span class="comment" id="5548301">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548341">c</span><span class="op" id="5548342">.</span><span class="ident" id="5548343">inst</span><span class="op" id="5548347">(</span><span class="ident" id="5548348">InstFail</span><span class="op" id="5548356">)</span><br>
<span class="lineno"></span><span class="op" id="5548358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5548361">var</span>&nbsp;<span class="ident" id="5548365">anyRuneNotNL</span>&nbsp;<span class="op" id="5548378">=</span>&nbsp;<span class="op" id="5548380">[</span><span class="op" id="5548381">]</span><span class="builtintype" id="5548382">rune</span><span class="op" id="5548386">{</span><span class="num" id="5548387">0</span><span class="op" id="5548388">,</span>&nbsp;<span class="string" id="5548390">&#39;\n&#39;</span>&nbsp;<span class="op" id="5548395">-</span>&nbsp;<span class="num" id="5548397">1</span><span class="op" id="5548398">,</span>&nbsp;<span class="string" id="5548400">&#39;\n&#39;</span>&nbsp;<span class="op" id="5548405">+</span>&nbsp;<span class="num" id="5548407">1</span><span class="op" id="5548408">,</span>&nbsp;<span class="ident" id="5548410">unicode</span><span class="op" id="5548417">.</span><span class="ident" id="5548418">MaxRune</span><span class="op" id="5548425">}</span><br>
<span class="lineno"></span><span class="keyword" id="5548427">var</span>&nbsp;<span class="ident" id="5548431">anyRune</span>&nbsp;<span class="op" id="5548439">=</span>&nbsp;<span class="op" id="5548441">[</span><span class="op" id="5548442">]</span><span class="builtintype" id="5548443">rune</span><span class="op" id="5548447">{</span><span class="num" id="5548448">0</span><span class="op" id="5548449">,</span>&nbsp;<span class="ident" id="5548451">unicode</span><span class="op" id="5548458">.</span><span class="ident" id="5548459">MaxRune</span><span class="op" id="5548466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5548469">func</span>&nbsp;<span class="op" id="5548474">(</span><span class="ident" id="5548475">c</span>&nbsp;<span class="op" id="5548477">*</span><span class="ident" id="5548478">compiler</span><span class="op" id="5548486">)</span>&nbsp;<span class="ident" id="5548488">compile</span><span class="op" id="5548495">(</span><span class="ident" id="5548496">re</span>&nbsp;<span class="op" id="5548499">*</span><span class="ident" id="5548500">Regexp</span><span class="op" id="5548506">)</span>&nbsp;<span class="ident" id="5548508">frag</span>&nbsp;<span class="op" id="5548513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548516">switch</span>&nbsp;<span class="ident" id="5548523">re</span><span class="op" id="5548525">.</span><span class="ident" id="5548526">Op</span>&nbsp;<span class="op" id="5548529">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548532">case</span>&nbsp;<span class="ident" id="5548537">OpNoMatch</span><span class="op" id="5548546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548550">return</span>&nbsp;<span class="ident" id="5548557">c</span><span class="op" id="5548558">.</span><span class="ident" id="5548559">fail</span><span class="op" id="5548563">(</span><span class="op" id="5548564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548567">case</span>&nbsp;<span class="ident" id="5548572">OpEmptyMatch</span><span class="op" id="5548584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548588">return</span>&nbsp;<span class="ident" id="5548595">c</span><span class="op" id="5548596">.</span><span class="ident" id="5548597">nop</span><span class="op" id="5548600">(</span><span class="op" id="5548601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548604">case</span>&nbsp;<span class="ident" id="5548609">OpLiteral</span><span class="op" id="5548618">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548622">if</span>&nbsp;<span class="builtinfunc" id="5548625">len</span><span class="op" id="5548628">(</span><span class="ident" id="5548629">re</span><span class="op" id="5548631">.</span><span class="ident" id="5548632">Rune</span><span class="op" id="5548636">)</span>&nbsp;<span class="op" id="5548638">==</span>&nbsp;<span class="num" id="5548641">0</span>&nbsp;<span class="op" id="5548643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548648">return</span>&nbsp;<span class="ident" id="5548655">c</span><span class="op" id="5548656">.</span><span class="ident" id="5548657">nop</span><span class="op" id="5548660">(</span><span class="op" id="5548661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548669">var</span>&nbsp;<span class="ident" id="5548673">f</span>&nbsp;<span class="ident" id="5548675">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548682">for</span>&nbsp;<span class="ident" id="5548686">j</span>&nbsp;<span class="op" id="5548688">:=</span>&nbsp;<span class="keyword" id="5548691">range</span>&nbsp;<span class="ident" id="5548697">re</span><span class="op" id="5548699">.</span><span class="ident" id="5548700">Rune</span>&nbsp;<span class="op" id="5548705">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548710">f1</span>&nbsp;<span class="op" id="5548713">:=</span>&nbsp;<span class="ident" id="5548716">c</span><span class="op" id="5548717">.</span><span class="builtintype" id="5548718">rune</span><span class="op" id="5548722">(</span><span class="ident" id="5548723">re</span><span class="op" id="5548725">.</span><span class="ident" id="5548726">Rune</span><span class="op" id="5548730">[</span><span class="ident" id="5548731">j</span><span class="op" id="5548732">:</span><span class="ident" id="5548733">j</span><span class="op" id="5548734">+</span><span class="num" id="5548735">1</span><span class="op" id="5548736">]</span><span class="op" id="5548737">,</span>&nbsp;<span class="ident" id="5548739">re</span><span class="op" id="5548741">.</span><span class="ident" id="5548742">Flags</span><span class="op" id="5548747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548752">if</span>&nbsp;<span class="ident" id="5548755">j</span>&nbsp;<span class="op" id="5548757">==</span>&nbsp;<span class="num" id="5548760">0</span>&nbsp;<span class="op" id="5548762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548768">f</span>&nbsp;<span class="op" id="5548770">=</span>&nbsp;<span class="ident" id="5548772">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548778">}</span>&nbsp;<span class="keyword" id="5548780">else</span>&nbsp;<span class="op" id="5548785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548791">f</span>&nbsp;<span class="op" id="5548793">=</span>&nbsp;<span class="ident" id="5548795">c</span><span class="op" id="5548796">.</span><span class="ident" id="5548797">cat</span><span class="op" id="5548800">(</span><span class="ident" id="5548801">f</span><span class="op" id="5548802">,</span>&nbsp;<span class="ident" id="5548804">f1</span><span class="op" id="5548806">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548819">return</span>&nbsp;<span class="ident" id="5548826">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548829">case</span>&nbsp;<span class="ident" id="5548834">OpCharClass</span><span class="op" id="5548845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548849">return</span>&nbsp;<span class="ident" id="5548856">c</span><span class="op" id="5548857">.</span><span class="builtintype" id="5548858">rune</span><span class="op" id="5548862">(</span><span class="ident" id="5548863">re</span><span class="op" id="5548865">.</span><span class="ident" id="5548866">Rune</span><span class="op" id="5548870">,</span>&nbsp;<span class="ident" id="5548872">re</span><span class="op" id="5548874">.</span><span class="ident" id="5548875">Flags</span><span class="op" id="5548880">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548883">case</span>&nbsp;<span class="ident" id="5548888">OpAnyCharNotNL</span><span class="op" id="5548902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548906">return</span>&nbsp;<span class="ident" id="5548913">c</span><span class="op" id="5548914">.</span><span class="builtintype" id="5548915">rune</span><span class="op" id="5548919">(</span><span class="ident" id="5548920">anyRuneNotNL</span><span class="op" id="5548932">,</span>&nbsp;<span class="num" id="5548934">0</span><span class="op" id="5548935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548938">case</span>&nbsp;<span class="ident" id="5548943">OpAnyChar</span><span class="op" id="5548952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548956">return</span>&nbsp;<span class="ident" id="5548963">c</span><span class="op" id="5548964">.</span><span class="builtintype" id="5548965">rune</span><span class="op" id="5548969">(</span><span class="ident" id="5548970">anyRune</span><span class="op" id="5548977">,</span>&nbsp;<span class="num" id="5548979">0</span><span class="op" id="5548980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548983">case</span>&nbsp;<span class="ident" id="5548988">OpBeginLine</span><span class="op" id="5548999">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549003">return</span>&nbsp;<span class="ident" id="5549010">c</span><span class="op" id="5549011">.</span><span class="ident" id="5549012">empty</span><span class="op" id="5549017">(</span><span class="ident" id="5549018">EmptyBeginLine</span><span class="op" id="5549032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549035">case</span>&nbsp;<span class="ident" id="5549040">OpEndLine</span><span class="op" id="5549049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549053">return</span>&nbsp;<span class="ident" id="5549060">c</span><span class="op" id="5549061">.</span><span class="ident" id="5549062">empty</span><span class="op" id="5549067">(</span><span class="ident" id="5549068">EmptyEndLine</span><span class="op" id="5549080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549083">case</span>&nbsp;<span class="ident" id="5549088">OpBeginText</span><span class="op" id="5549099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549103">return</span>&nbsp;<span class="ident" id="5549110">c</span><span class="op" id="5549111">.</span><span class="ident" id="5549112">empty</span><span class="op" id="5549117">(</span><span class="ident" id="5549118">EmptyBeginText</span><span class="op" id="5549132">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549135">case</span>&nbsp;<span class="ident" id="5549140">OpEndText</span><span class="op" id="5549149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549153">return</span>&nbsp;<span class="ident" id="5549160">c</span><span class="op" id="5549161">.</span><span class="ident" id="5549162">empty</span><span class="op" id="5549167">(</span><span class="ident" id="5549168">EmptyEndText</span><span class="op" id="5549180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549183">case</span>&nbsp;<span class="ident" id="5549188">OpWordBoundary</span><span class="op" id="5549202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549206">return</span>&nbsp;<span class="ident" id="5549213">c</span><span class="op" id="5549214">.</span><span class="ident" id="5549215">empty</span><span class="op" id="5549220">(</span><span class="ident" id="5549221">EmptyWordBoundary</span><span class="op" id="5549238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549241">case</span>&nbsp;<span class="ident" id="5549246">OpNoWordBoundary</span><span class="op" id="5549262">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549266">return</span>&nbsp;<span class="ident" id="5549273">c</span><span class="op" id="5549274">.</span><span class="ident" id="5549275">empty</span><span class="op" id="5549280">(</span><span class="ident" id="5549281">EmptyNoWordBoundary</span><span class="op" id="5549300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549303">case</span>&nbsp;<span class="ident" id="5549308">OpCapture</span><span class="op" id="5549317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549321">bra</span>&nbsp;<span class="op" id="5549325">:=</span>&nbsp;<span class="ident" id="5549328">c</span><span class="op" id="5549329">.</span><span class="builtinfunc" id="5549330">cap</span><span class="op" id="5549333">(</span><span class="builtintype" id="5549334">uint32</span><span class="op" id="5549340">(</span><span class="ident" id="5549341">re</span><span class="op" id="5549343">.</span><span class="ident" id="5549344">Cap</span>&nbsp;<span class="op" id="5549348">&lt;&lt;</span>&nbsp;<span class="num" id="5549351">1</span><span class="op" id="5549352">)</span><span class="op" id="5549353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549357">sub</span>&nbsp;<span class="op" id="5549361">:=</span>&nbsp;<span class="ident" id="5549364">c</span><span class="op" id="5549365">.</span><span class="ident" id="5549366">compile</span><span class="op" id="5549373">(</span><span class="ident" id="5549374">re</span><span class="op" id="5549376">.</span><span class="ident" id="5549377">Sub</span><span class="op" id="5549380">[</span><span class="num" id="5549381">0</span><span class="op" id="5549382">]</span><span class="op" id="5549383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549387">ket</span>&nbsp;<span class="op" id="5549391">:=</span>&nbsp;<span class="ident" id="5549394">c</span><span class="op" id="5549395">.</span><span class="builtinfunc" id="5549396">cap</span><span class="op" id="5549399">(</span><span class="builtintype" id="5549400">uint32</span><span class="op" id="5549406">(</span><span class="ident" id="5549407">re</span><span class="op" id="5549409">.</span><span class="ident" id="5549410">Cap</span><span class="op" id="5549413">&lt;&lt;</span><span class="num" id="5549415">1</span>&nbsp;<span class="op" id="5549417">|</span>&nbsp;<span class="num" id="5549419">1</span><span class="op" id="5549420">)</span><span class="op" id="5549421">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549425">return</span>&nbsp;<span class="ident" id="5549432">c</span><span class="op" id="5549433">.</span><span class="ident" id="5549434">cat</span><span class="op" id="5549437">(</span><span class="ident" id="5549438">c</span><span class="op" id="5549439">.</span><span class="ident" id="5549440">cat</span><span class="op" id="5549443">(</span><span class="ident" id="5549444">bra</span><span class="op" id="5549447">,</span>&nbsp;<span class="ident" id="5549449">sub</span><span class="op" id="5549452">)</span><span class="op" id="5549453">,</span>&nbsp;<span class="ident" id="5549455">ket</span><span class="op" id="5549458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549461">case</span>&nbsp;<span class="ident" id="5549466">OpStar</span><span class="op" id="5549472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549476">return</span>&nbsp;<span class="ident" id="5549483">c</span><span class="op" id="5549484">.</span><span class="ident" id="5549485">star</span><span class="op" id="5549489">(</span><span class="ident" id="5549490">c</span><span class="op" id="5549491">.</span><span class="ident" id="5549492">compile</span><span class="op" id="5549499">(</span><span class="ident" id="5549500">re</span><span class="op" id="5549502">.</span><span class="ident" id="5549503">Sub</span><span class="op" id="5549506">[</span><span class="num" id="5549507">0</span><span class="op" id="5549508">]</span><span class="op" id="5549509">)</span><span class="op" id="5549510">,</span>&nbsp;<span class="ident" id="5549512">re</span><span class="op" id="5549514">.</span><span class="ident" id="5549515">Flags</span><span class="op" id="5549520">&amp;</span><span class="ident" id="5549521">NonGreedy</span>&nbsp;<span class="op" id="5549531">!=</span>&nbsp;<span class="num" id="5549534">0</span><span class="op" id="5549535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549538">case</span>&nbsp;<span class="ident" id="5549543">OpPlus</span><span class="op" id="5549549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549553">return</span>&nbsp;<span class="ident" id="5549560">c</span><span class="op" id="5549561">.</span><span class="ident" id="5549562">plus</span><span class="op" id="5549566">(</span><span class="ident" id="5549567">c</span><span class="op" id="5549568">.</span><span class="ident" id="5549569">compile</span><span class="op" id="5549576">(</span><span class="ident" id="5549577">re</span><span class="op" id="5549579">.</span><span class="ident" id="5549580">Sub</span><span class="op" id="5549583">[</span><span class="num" id="5549584">0</span><span class="op" id="5549585">]</span><span class="op" id="5549586">)</span><span class="op" id="5549587">,</span>&nbsp;<span class="ident" id="5549589">re</span><span class="op" id="5549591">.</span><span class="ident" id="5549592">Flags</span><span class="op" id="5549597">&amp;</span><span class="ident" id="5549598">NonGreedy</span>&nbsp;<span class="op" id="5549608">!=</span>&nbsp;<span class="num" id="5549611">0</span><span class="op" id="5549612">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549615">case</span>&nbsp;<span class="ident" id="5549620">OpQuest</span><span class="op" id="5549627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549631">return</span>&nbsp;<span class="ident" id="5549638">c</span><span class="op" id="5549639">.</span><span class="ident" id="5549640">quest</span><span class="op" id="5549645">(</span><span class="ident" id="5549646">c</span><span class="op" id="5549647">.</span><span class="ident" id="5549648">compile</span><span class="op" id="5549655">(</span><span class="ident" id="5549656">re</span><span class="op" id="5549658">.</span><span class="ident" id="5549659">Sub</span><span class="op" id="5549662">[</span><span class="num" id="5549663">0</span><span class="op" id="5549664">]</span><span class="op" id="5549665">)</span><span class="op" id="5549666">,</span>&nbsp;<span class="ident" id="5549668">re</span><span class="op" id="5549670">.</span><span class="ident" id="5549671">Flags</span><span class="op" id="5549676">&amp;</span><span class="ident" id="5549677">NonGreedy</span>&nbsp;<span class="op" id="5549687">!=</span>&nbsp;<span class="num" id="5549690">0</span><span class="op" id="5549691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549694">case</span>&nbsp;<span class="ident" id="5549699">OpConcat</span><span class="op" id="5549707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549711">if</span>&nbsp;<span class="builtinfunc" id="5549714">len</span><span class="op" id="5549717">(</span><span class="ident" id="5549718">re</span><span class="op" id="5549720">.</span><span class="ident" id="5549721">Sub</span><span class="op" id="5549724">)</span>&nbsp;<span class="op" id="5549726">==</span>&nbsp;<span class="num" id="5549729">0</span>&nbsp;<span class="op" id="5549731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549736">return</span>&nbsp;<span class="ident" id="5549743">c</span><span class="op" id="5549744">.</span><span class="ident" id="5549745">nop</span><span class="op" id="5549748">(</span><span class="op" id="5549749">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549757">var</span>&nbsp;<span class="ident" id="5549761">f</span>&nbsp;<span class="ident" id="5549763">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549770">for</span>&nbsp;<span class="ident" id="5549774">i</span><span class="op" id="5549775">,</span>&nbsp;<span class="ident" id="5549777">sub</span>&nbsp;<span class="op" id="5549781">:=</span>&nbsp;<span class="keyword" id="5549784">range</span>&nbsp;<span class="ident" id="5549790">re</span><span class="op" id="5549792">.</span><span class="ident" id="5549793">Sub</span>&nbsp;<span class="op" id="5549797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549802">if</span>&nbsp;<span class="ident" id="5549805">i</span>&nbsp;<span class="op" id="5549807">==</span>&nbsp;<span class="num" id="5549810">0</span>&nbsp;<span class="op" id="5549812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549818">f</span>&nbsp;<span class="op" id="5549820">=</span>&nbsp;<span class="ident" id="5549822">c</span><span class="op" id="5549823">.</span><span class="ident" id="5549824">compile</span><span class="op" id="5549831">(</span><span class="ident" id="5549832">sub</span><span class="op" id="5549835">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549840">}</span>&nbsp;<span class="keyword" id="5549842">else</span>&nbsp;<span class="op" id="5549847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549853">f</span>&nbsp;<span class="op" id="5549855">=</span>&nbsp;<span class="ident" id="5549857">c</span><span class="op" id="5549858">.</span><span class="ident" id="5549859">cat</span><span class="op" id="5549862">(</span><span class="ident" id="5549863">f</span><span class="op" id="5549864">,</span>&nbsp;<span class="ident" id="5549866">c</span><span class="op" id="5549867">.</span><span class="ident" id="5549868">compile</span><span class="op" id="5549875">(</span><span class="ident" id="5549876">sub</span><span class="op" id="5549879">)</span><span class="op" id="5549880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549893">return</span>&nbsp;<span class="ident" id="5549900">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549903">case</span>&nbsp;<span class="ident" id="5549908">OpAlternate</span><span class="op" id="5549919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549923">var</span>&nbsp;<span class="ident" id="5549927">f</span>&nbsp;<span class="ident" id="5549929">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549936">for</span>&nbsp;<span class="ident" id="5549940">_</span><span class="op" id="5549941">,</span>&nbsp;<span class="ident" id="5549943">sub</span>&nbsp;<span class="op" id="5549947">:=</span>&nbsp;<span class="keyword" id="5549950">range</span>&nbsp;<span class="ident" id="5549956">re</span><span class="op" id="5549958">.</span><span class="ident" id="5549959">Sub</span>&nbsp;<span class="op" id="5549963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549968">f</span>&nbsp;<span class="op" id="5549970">=</span>&nbsp;<span class="ident" id="5549972">c</span><span class="op" id="5549973">.</span><span class="ident" id="5549974">alt</span><span class="op" id="5549977">(</span><span class="ident" id="5549978">f</span><span class="op" id="5549979">,</span>&nbsp;<span class="ident" id="5549981">c</span><span class="op" id="5549982">.</span><span class="ident" id="5549983">compile</span><span class="op" id="5549990">(</span><span class="ident" id="5549991">sub</span><span class="op" id="5549994">)</span><span class="op" id="5549995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549999">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550003">return</span>&nbsp;<span class="ident" id="5550010">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5550016">panic</span><span class="op" id="5550021">(</span><span class="string" id="5550022">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5550057">)</span><br>
<span class="lineno"></span><span class="op" id="5550059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5550062">func</span>&nbsp;<span class="op" id="5550067">(</span><span class="ident" id="5550068">c</span>&nbsp;<span class="op" id="5550070">*</span><span class="ident" id="5550071">compiler</span><span class="op" id="5550079">)</span>&nbsp;<span class="ident" id="5550081">inst</span><span class="op" id="5550085">(</span><span class="ident" id="5550086">op</span>&nbsp;<span class="ident" id="5550089">InstOp</span><span class="op" id="5550095">)</span>&nbsp;<span class="ident" id="5550097">frag</span>&nbsp;<span class="op" id="5550102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550105">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550135">f</span>&nbsp;<span class="op" id="5550137">:=</span>&nbsp;<span class="ident" id="5550140">frag</span><span class="op" id="5550144">{</span><span class="ident" id="5550145">i</span><span class="op" id="5550146">:</span>&nbsp;<span class="builtintype" id="5550148">uint32</span><span class="op" id="5550154">(</span><span class="builtinfunc" id="5550155">len</span><span class="op" id="5550158">(</span><span class="ident" id="5550159">c</span><span class="op" id="5550160">.</span><span class="ident" id="5550161">p</span><span class="op" id="5550162">.</span><span class="ident" id="5550163">Inst</span><span class="op" id="5550167">)</span><span class="op" id="5550168">)</span><span class="op" id="5550169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550172">c</span><span class="op" id="5550173">.</span><span class="ident" id="5550174">p</span><span class="op" id="5550175">.</span><span class="ident" id="5550176">Inst</span>&nbsp;<span class="op" id="5550181">=</span>&nbsp;<span class="builtinfunc" id="5550183">append</span><span class="op" id="5550189">(</span><span class="ident" id="5550190">c</span><span class="op" id="5550191">.</span><span class="ident" id="5550192">p</span><span class="op" id="5550193">.</span><span class="ident" id="5550194">Inst</span><span class="op" id="5550198">,</span>&nbsp;<span class="ident" id="5550200">Inst</span><span class="op" id="5550204">{</span><span class="ident" id="5550205">Op</span><span class="op" id="5550207">:</span>&nbsp;<span class="ident" id="5550209">op</span><span class="op" id="5550211">}</span><span class="op" id="5550212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550215">return</span>&nbsp;<span class="ident" id="5550222">f</span><br>
<span class="lineno">175</span><span class="op" id="5550224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550227">func</span>&nbsp;<span class="op" id="5550232">(</span><span class="ident" id="5550233">c</span>&nbsp;<span class="op" id="5550235">*</span><span class="ident" id="5550236">compiler</span><span class="op" id="5550244">)</span>&nbsp;<span class="ident" id="5550246">nop</span><span class="op" id="5550249">(</span><span class="op" id="5550250">)</span>&nbsp;<span class="ident" id="5550252">frag</span>&nbsp;<span class="op" id="5550257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550260">f</span>&nbsp;<span class="op" id="5550262">:=</span>&nbsp;<span class="ident" id="5550265">c</span><span class="op" id="5550266">.</span><span class="ident" id="5550267">inst</span><span class="op" id="5550271">(</span><span class="ident" id="5550272">InstNop</span><span class="op" id="5550279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550282">f</span><span class="op" id="5550283">.</span><span class="ident" id="5550284">out</span>&nbsp;<span class="op" id="5550288">=</span>&nbsp;<span class="ident" id="5550290">patchList</span><span class="op" id="5550299">(</span><span class="ident" id="5550300">f</span><span class="op" id="5550301">.</span><span class="ident" id="5550302">i</span>&nbsp;<span class="op" id="5550304">&lt;&lt;</span>&nbsp;<span class="num" id="5550307">1</span><span class="op" id="5550308">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550311">return</span>&nbsp;<span class="ident" id="5550318">f</span><br>
<span class="lineno"></span><span class="op" id="5550320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550323">func</span>&nbsp;<span class="op" id="5550328">(</span><span class="ident" id="5550329">c</span>&nbsp;<span class="op" id="5550331">*</span><span class="ident" id="5550332">compiler</span><span class="op" id="5550340">)</span>&nbsp;<span class="ident" id="5550342">fail</span><span class="op" id="5550346">(</span><span class="op" id="5550347">)</span>&nbsp;<span class="ident" id="5550349">frag</span>&nbsp;<span class="op" id="5550354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550357">return</span>&nbsp;<span class="ident" id="5550364">frag</span><span class="op" id="5550368">{</span><span class="op" id="5550369">}</span><br>
<span class="lineno">185</span><span class="op" id="5550371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550374">func</span>&nbsp;<span class="op" id="5550379">(</span><span class="ident" id="5550380">c</span>&nbsp;<span class="op" id="5550382">*</span><span class="ident" id="5550383">compiler</span><span class="op" id="5550391">)</span>&nbsp;<span class="builtinfunc" id="5550393">cap</span><span class="op" id="5550396">(</span><span class="ident" id="5550397">arg</span>&nbsp;<span class="builtintype" id="5550401">uint32</span><span class="op" id="5550407">)</span>&nbsp;<span class="ident" id="5550409">frag</span>&nbsp;<span class="op" id="5550414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550417">f</span>&nbsp;<span class="op" id="5550419">:=</span>&nbsp;<span class="ident" id="5550422">c</span><span class="op" id="5550423">.</span><span class="ident" id="5550424">inst</span><span class="op" id="5550428">(</span><span class="ident" id="5550429">InstCapture</span><span class="op" id="5550440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550443">f</span><span class="op" id="5550444">.</span><span class="ident" id="5550445">out</span>&nbsp;<span class="op" id="5550449">=</span>&nbsp;<span class="ident" id="5550451">patchList</span><span class="op" id="5550460">(</span><span class="ident" id="5550461">f</span><span class="op" id="5550462">.</span><span class="ident" id="5550463">i</span>&nbsp;<span class="op" id="5550465">&lt;&lt;</span>&nbsp;<span class="num" id="5550468">1</span><span class="op" id="5550469">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550472">c</span><span class="op" id="5550473">.</span><span class="ident" id="5550474">p</span><span class="op" id="5550475">.</span><span class="ident" id="5550476">Inst</span><span class="op" id="5550480">[</span><span class="ident" id="5550481">f</span><span class="op" id="5550482">.</span><span class="ident" id="5550483">i</span><span class="op" id="5550484">]</span><span class="op" id="5550485">.</span><span class="ident" id="5550486">Arg</span>&nbsp;<span class="op" id="5550490">=</span>&nbsp;<span class="ident" id="5550492">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550498">if</span>&nbsp;<span class="ident" id="5550501">c</span><span class="op" id="5550502">.</span><span class="ident" id="5550503">p</span><span class="op" id="5550504">.</span><span class="ident" id="5550505">NumCap</span>&nbsp;<span class="op" id="5550512">&lt;</span>&nbsp;<span class="builtintype" id="5550514">int</span><span class="op" id="5550517">(</span><span class="ident" id="5550518">arg</span><span class="op" id="5550521">)</span><span class="op" id="5550522">+</span><span class="num" id="5550523">1</span>&nbsp;<span class="op" id="5550525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550529">c</span><span class="op" id="5550530">.</span><span class="ident" id="5550531">p</span><span class="op" id="5550532">.</span><span class="ident" id="5550533">NumCap</span>&nbsp;<span class="op" id="5550540">=</span>&nbsp;<span class="builtintype" id="5550542">int</span><span class="op" id="5550545">(</span><span class="ident" id="5550546">arg</span><span class="op" id="5550549">)</span>&nbsp;<span class="op" id="5550551">+</span>&nbsp;<span class="num" id="5550553">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550556">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550559">return</span>&nbsp;<span class="ident" id="5550566">f</span><br>
<span class="lineno"></span><span class="op" id="5550568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5550571">func</span>&nbsp;<span class="op" id="5550576">(</span><span class="ident" id="5550577">c</span>&nbsp;<span class="op" id="5550579">*</span><span class="ident" id="5550580">compiler</span><span class="op" id="5550588">)</span>&nbsp;<span class="ident" id="5550590">cat</span><span class="op" id="5550593">(</span><span class="ident" id="5550594">f1</span><span class="op" id="5550596">,</span>&nbsp;<span class="ident" id="5550598">f2</span>&nbsp;<span class="ident" id="5550601">frag</span><span class="op" id="5550605">)</span>&nbsp;<span class="ident" id="5550607">frag</span>&nbsp;<span class="op" id="5550612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550615">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550648">if</span>&nbsp;<span class="ident" id="5550651">f1</span><span class="op" id="5550653">.</span><span class="ident" id="5550654">i</span>&nbsp;<span class="op" id="5550656">==</span>&nbsp;<span class="num" id="5550659">0</span>&nbsp;<span class="op" id="5550661">||</span>&nbsp;<span class="ident" id="5550664">f2</span><span class="op" id="5550666">.</span><span class="ident" id="5550667">i</span>&nbsp;<span class="op" id="5550669">==</span>&nbsp;<span class="num" id="5550672">0</span>&nbsp;<span class="op" id="5550674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550678">return</span>&nbsp;<span class="ident" id="5550685">frag</span><span class="op" id="5550689">{</span><span class="op" id="5550690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550697">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550718">f1</span><span class="op" id="5550720">.</span><span class="ident" id="5550721">out</span><span class="op" id="5550724">.</span><span class="ident" id="5550725">patch</span><span class="op" id="5550730">(</span><span class="ident" id="5550731">c</span><span class="op" id="5550732">.</span><span class="ident" id="5550733">p</span><span class="op" id="5550734">,</span>&nbsp;<span class="ident" id="5550736">f2</span><span class="op" id="5550738">.</span><span class="ident" id="5550739">i</span><span class="op" id="5550740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550743">return</span>&nbsp;<span class="ident" id="5550750">frag</span><span class="op" id="5550754">{</span><span class="ident" id="5550755">f1</span><span class="op" id="5550757">.</span><span class="ident" id="5550758">i</span><span class="op" id="5550759">,</span>&nbsp;<span class="ident" id="5550761">f2</span><span class="op" id="5550763">.</span><span class="ident" id="5550764">out</span><span class="op" id="5550767">}</span><br>
<span class="lineno"></span><span class="op" id="5550769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5550772">func</span>&nbsp;<span class="op" id="5550777">(</span><span class="ident" id="5550778">c</span>&nbsp;<span class="op" id="5550780">*</span><span class="ident" id="5550781">compiler</span><span class="op" id="5550789">)</span>&nbsp;<span class="ident" id="5550791">alt</span><span class="op" id="5550794">(</span><span class="ident" id="5550795">f1</span><span class="op" id="5550797">,</span>&nbsp;<span class="ident" id="5550799">f2</span>&nbsp;<span class="ident" id="5550802">frag</span><span class="op" id="5550806">)</span>&nbsp;<span class="ident" id="5550808">frag</span>&nbsp;<span class="op" id="5550813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5550816">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550844">if</span>&nbsp;<span class="ident" id="5550847">f1</span><span class="op" id="5550849">.</span><span class="ident" id="5550850">i</span>&nbsp;<span class="op" id="5550852">==</span>&nbsp;<span class="num" id="5550855">0</span>&nbsp;<span class="op" id="5550857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550861">return</span>&nbsp;<span class="ident" id="5550868">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550872">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550875">if</span>&nbsp;<span class="ident" id="5550878">f2</span><span class="op" id="5550880">.</span><span class="ident" id="5550881">i</span>&nbsp;<span class="op" id="5550883">==</span>&nbsp;<span class="num" id="5550886">0</span>&nbsp;<span class="op" id="5550888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550892">return</span>&nbsp;<span class="ident" id="5550899">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550907">f</span>&nbsp;<span class="op" id="5550909">:=</span>&nbsp;<span class="ident" id="5550912">c</span><span class="op" id="5550913">.</span><span class="ident" id="5550914">inst</span><span class="op" id="5550918">(</span><span class="ident" id="5550919">InstAlt</span><span class="op" id="5550926">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550929">i</span>&nbsp;<span class="op" id="5550931">:=</span>&nbsp;<span class="op" id="5550934">&amp;</span><span class="ident" id="5550935">c</span><span class="op" id="5550936">.</span><span class="ident" id="5550937">p</span><span class="op" id="5550938">.</span><span class="ident" id="5550939">Inst</span><span class="op" id="5550943">[</span><span class="ident" id="5550944">f</span><span class="op" id="5550945">.</span><span class="ident" id="5550946">i</span><span class="op" id="5550947">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550950">i</span><span class="op" id="5550951">.</span><span class="ident" id="5550952">Out</span>&nbsp;<span class="op" id="5550956">=</span>&nbsp;<span class="ident" id="5550958">f1</span><span class="op" id="5550960">.</span><span class="ident" id="5550961">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550964">i</span><span class="op" id="5550965">.</span><span class="ident" id="5550966">Arg</span>&nbsp;<span class="op" id="5550970">=</span>&nbsp;<span class="ident" id="5550972">f2</span><span class="op" id="5550974">.</span><span class="ident" id="5550975">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550978">f</span><span class="op" id="5550979">.</span><span class="ident" id="5550980">out</span>&nbsp;<span class="op" id="5550984">=</span>&nbsp;<span class="ident" id="5550986">f1</span><span class="op" id="5550988">.</span><span class="ident" id="5550989">out</span><span class="op" id="5550992">.</span><span class="builtinfunc" id="5550993">append</span><span class="op" id="5550999">(</span><span class="ident" id="5551000">c</span><span class="op" id="5551001">.</span><span class="ident" id="5551002">p</span><span class="op" id="5551003">,</span>&nbsp;<span class="ident" id="5551005">f2</span><span class="op" id="5551007">.</span><span class="ident" id="5551008">out</span><span class="op" id="5551011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551014">return</span>&nbsp;<span class="ident" id="5551021">f</span><br>
<span class="lineno">225</span><span class="op" id="5551023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5551026">func</span>&nbsp;<span class="op" id="5551031">(</span><span class="ident" id="5551032">c</span>&nbsp;<span class="op" id="5551034">*</span><span class="ident" id="5551035">compiler</span><span class="op" id="5551043">)</span>&nbsp;<span class="ident" id="5551045">quest</span><span class="op" id="5551050">(</span><span class="ident" id="5551051">f1</span>&nbsp;<span class="ident" id="5551054">frag</span><span class="op" id="5551058">,</span>&nbsp;<span class="ident" id="5551060">nongreedy</span>&nbsp;<span class="builtintype" id="5551070">bool</span><span class="op" id="5551074">)</span>&nbsp;<span class="ident" id="5551076">frag</span>&nbsp;<span class="op" id="5551081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551084">f</span>&nbsp;<span class="op" id="5551086">:=</span>&nbsp;<span class="ident" id="5551089">c</span><span class="op" id="5551090">.</span><span class="ident" id="5551091">inst</span><span class="op" id="5551095">(</span><span class="ident" id="5551096">InstAlt</span><span class="op" id="5551103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551106">i</span>&nbsp;<span class="op" id="5551108">:=</span>&nbsp;<span class="op" id="5551111">&amp;</span><span class="ident" id="5551112">c</span><span class="op" id="5551113">.</span><span class="ident" id="5551114">p</span><span class="op" id="5551115">.</span><span class="ident" id="5551116">Inst</span><span class="op" id="5551120">[</span><span class="ident" id="5551121">f</span><span class="op" id="5551122">.</span><span class="ident" id="5551123">i</span><span class="op" id="5551124">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551127">if</span>&nbsp;<span class="ident" id="5551130">nongreedy</span>&nbsp;<span class="op" id="5551140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551144">i</span><span class="op" id="5551145">.</span><span class="ident" id="5551146">Arg</span>&nbsp;<span class="op" id="5551150">=</span>&nbsp;<span class="ident" id="5551152">f1</span><span class="op" id="5551154">.</span><span class="ident" id="5551155">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551159">f</span><span class="op" id="5551160">.</span><span class="ident" id="5551161">out</span>&nbsp;<span class="op" id="5551165">=</span>&nbsp;<span class="ident" id="5551167">patchList</span><span class="op" id="5551176">(</span><span class="ident" id="5551177">f</span><span class="op" id="5551178">.</span><span class="ident" id="5551179">i</span>&nbsp;<span class="op" id="5551181">&lt;&lt;</span>&nbsp;<span class="num" id="5551184">1</span><span class="op" id="5551185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551188">}</span>&nbsp;<span class="keyword" id="5551190">else</span>&nbsp;<span class="op" id="5551195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551199">i</span><span class="op" id="5551200">.</span><span class="ident" id="5551201">Out</span>&nbsp;<span class="op" id="5551205">=</span>&nbsp;<span class="ident" id="5551207">f1</span><span class="op" id="5551209">.</span><span class="ident" id="5551210">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551214">f</span><span class="op" id="5551215">.</span><span class="ident" id="5551216">out</span>&nbsp;<span class="op" id="5551220">=</span>&nbsp;<span class="ident" id="5551222">patchList</span><span class="op" id="5551231">(</span><span class="ident" id="5551232">f</span><span class="op" id="5551233">.</span><span class="ident" id="5551234">i</span><span class="op" id="5551235">&lt;&lt;</span><span class="num" id="5551237">1</span>&nbsp;<span class="op" id="5551239">|</span>&nbsp;<span class="num" id="5551241">1</span><span class="op" id="5551242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551248">f</span><span class="op" id="5551249">.</span><span class="ident" id="5551250">out</span>&nbsp;<span class="op" id="5551254">=</span>&nbsp;<span class="ident" id="5551256">f</span><span class="op" id="5551257">.</span><span class="ident" id="5551258">out</span><span class="op" id="5551261">.</span><span class="builtinfunc" id="5551262">append</span><span class="op" id="5551268">(</span><span class="ident" id="5551269">c</span><span class="op" id="5551270">.</span><span class="ident" id="5551271">p</span><span class="op" id="5551272">,</span>&nbsp;<span class="ident" id="5551274">f1</span><span class="op" id="5551276">.</span><span class="ident" id="5551277">out</span><span class="op" id="5551280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551283">return</span>&nbsp;<span class="ident" id="5551290">f</span><br>
<span class="lineno"></span><span class="op" id="5551292">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5551295">func</span>&nbsp;<span class="op" id="5551300">(</span><span class="ident" id="5551301">c</span>&nbsp;<span class="op" id="5551303">*</span><span class="ident" id="5551304">compiler</span><span class="op" id="5551312">)</span>&nbsp;<span class="ident" id="5551314">star</span><span class="op" id="5551318">(</span><span class="ident" id="5551319">f1</span>&nbsp;<span class="ident" id="5551322">frag</span><span class="op" id="5551326">,</span>&nbsp;<span class="ident" id="5551328">nongreedy</span>&nbsp;<span class="builtintype" id="5551338">bool</span><span class="op" id="5551342">)</span>&nbsp;<span class="ident" id="5551344">frag</span>&nbsp;<span class="op" id="5551349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551352">f</span>&nbsp;<span class="op" id="5551354">:=</span>&nbsp;<span class="ident" id="5551357">c</span><span class="op" id="5551358">.</span><span class="ident" id="5551359">inst</span><span class="op" id="5551363">(</span><span class="ident" id="5551364">InstAlt</span><span class="op" id="5551371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551374">i</span>&nbsp;<span class="op" id="5551376">:=</span>&nbsp;<span class="op" id="5551379">&amp;</span><span class="ident" id="5551380">c</span><span class="op" id="5551381">.</span><span class="ident" id="5551382">p</span><span class="op" id="5551383">.</span><span class="ident" id="5551384">Inst</span><span class="op" id="5551388">[</span><span class="ident" id="5551389">f</span><span class="op" id="5551390">.</span><span class="ident" id="5551391">i</span><span class="op" id="5551392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551395">if</span>&nbsp;<span class="ident" id="5551398">nongreedy</span>&nbsp;<span class="op" id="5551408">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551412">i</span><span class="op" id="5551413">.</span><span class="ident" id="5551414">Arg</span>&nbsp;<span class="op" id="5551418">=</span>&nbsp;<span class="ident" id="5551420">f1</span><span class="op" id="5551422">.</span><span class="ident" id="5551423">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551427">f</span><span class="op" id="5551428">.</span><span class="ident" id="5551429">out</span>&nbsp;<span class="op" id="5551433">=</span>&nbsp;<span class="ident" id="5551435">patchList</span><span class="op" id="5551444">(</span><span class="ident" id="5551445">f</span><span class="op" id="5551446">.</span><span class="ident" id="5551447">i</span>&nbsp;<span class="op" id="5551449">&lt;&lt;</span>&nbsp;<span class="num" id="5551452">1</span><span class="op" id="5551453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551456">}</span>&nbsp;<span class="keyword" id="5551458">else</span>&nbsp;<span class="op" id="5551463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551467">i</span><span class="op" id="5551468">.</span><span class="ident" id="5551469">Out</span>&nbsp;<span class="op" id="5551473">=</span>&nbsp;<span class="ident" id="5551475">f1</span><span class="op" id="5551477">.</span><span class="ident" id="5551478">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551482">f</span><span class="op" id="5551483">.</span><span class="ident" id="5551484">out</span>&nbsp;<span class="op" id="5551488">=</span>&nbsp;<span class="ident" id="5551490">patchList</span><span class="op" id="5551499">(</span><span class="ident" id="5551500">f</span><span class="op" id="5551501">.</span><span class="ident" id="5551502">i</span><span class="op" id="5551503">&lt;&lt;</span><span class="num" id="5551505">1</span>&nbsp;<span class="op" id="5551507">|</span>&nbsp;<span class="num" id="5551509">1</span><span class="op" id="5551510">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5551513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551516">f1</span><span class="op" id="5551518">.</span><span class="ident" id="5551519">out</span><span class="op" id="5551522">.</span><span class="ident" id="5551523">patch</span><span class="op" id="5551528">(</span><span class="ident" id="5551529">c</span><span class="op" id="5551530">.</span><span class="ident" id="5551531">p</span><span class="op" id="5551532">,</span>&nbsp;<span class="ident" id="5551534">f</span><span class="op" id="5551535">.</span><span class="ident" id="5551536">i</span><span class="op" id="5551537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551540">return</span>&nbsp;<span class="ident" id="5551547">f</span><br>
<span class="lineno"></span><span class="op" id="5551549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5551552">func</span>&nbsp;<span class="op" id="5551557">(</span><span class="ident" id="5551558">c</span>&nbsp;<span class="op" id="5551560">*</span><span class="ident" id="5551561">compiler</span><span class="op" id="5551569">)</span>&nbsp;<span class="ident" id="5551571">plus</span><span class="op" id="5551575">(</span><span class="ident" id="5551576">f1</span>&nbsp;<span class="ident" id="5551579">frag</span><span class="op" id="5551583">,</span>&nbsp;<span class="ident" id="5551585">nongreedy</span>&nbsp;<span class="builtintype" id="5551595">bool</span><span class="op" id="5551599">)</span>&nbsp;<span class="ident" id="5551601">frag</span>&nbsp;<span class="op" id="5551606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551609">return</span>&nbsp;<span class="ident" id="5551616">frag</span><span class="op" id="5551620">{</span><span class="ident" id="5551621">f1</span><span class="op" id="5551623">.</span><span class="ident" id="5551624">i</span><span class="op" id="5551625">,</span>&nbsp;<span class="ident" id="5551627">c</span><span class="op" id="5551628">.</span><span class="ident" id="5551629">star</span><span class="op" id="5551633">(</span><span class="ident" id="5551634">f1</span><span class="op" id="5551636">,</span>&nbsp;<span class="ident" id="5551638">nongreedy</span><span class="op" id="5551647">)</span><span class="op" id="5551648">.</span><span class="ident" id="5551649">out</span><span class="op" id="5551652">}</span><br>
<span class="lineno"></span><span class="op" id="5551654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5551657">func</span>&nbsp;<span class="op" id="5551662">(</span><span class="ident" id="5551663">c</span>&nbsp;<span class="op" id="5551665">*</span><span class="ident" id="5551666">compiler</span><span class="op" id="5551674">)</span>&nbsp;<span class="ident" id="5551676">empty</span><span class="op" id="5551681">(</span><span class="ident" id="5551682">op</span>&nbsp;<span class="ident" id="5551685">EmptyOp</span><span class="op" id="5551692">)</span>&nbsp;<span class="ident" id="5551694">frag</span>&nbsp;<span class="op" id="5551699">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551702">f</span>&nbsp;<span class="op" id="5551704">:=</span>&nbsp;<span class="ident" id="5551707">c</span><span class="op" id="5551708">.</span><span class="ident" id="5551709">inst</span><span class="op" id="5551713">(</span><span class="ident" id="5551714">InstEmptyWidth</span><span class="op" id="5551728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551731">c</span><span class="op" id="5551732">.</span><span class="ident" id="5551733">p</span><span class="op" id="5551734">.</span><span class="ident" id="5551735">Inst</span><span class="op" id="5551739">[</span><span class="ident" id="5551740">f</span><span class="op" id="5551741">.</span><span class="ident" id="5551742">i</span><span class="op" id="5551743">]</span><span class="op" id="5551744">.</span><span class="ident" id="5551745">Arg</span>&nbsp;<span class="op" id="5551749">=</span>&nbsp;<span class="builtintype" id="5551751">uint32</span><span class="op" id="5551757">(</span><span class="ident" id="5551758">op</span><span class="op" id="5551760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551763">f</span><span class="op" id="5551764">.</span><span class="ident" id="5551765">out</span>&nbsp;<span class="op" id="5551769">=</span>&nbsp;<span class="ident" id="5551771">patchList</span><span class="op" id="5551780">(</span><span class="ident" id="5551781">f</span><span class="op" id="5551782">.</span><span class="ident" id="5551783">i</span>&nbsp;<span class="op" id="5551785">&lt;&lt;</span>&nbsp;<span class="num" id="5551788">1</span><span class="op" id="5551789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551792">return</span>&nbsp;<span class="ident" id="5551799">f</span><br>
<span class="lineno"></span><span class="op" id="5551801">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5551804">func</span>&nbsp;<span class="op" id="5551809">(</span><span class="ident" id="5551810">c</span>&nbsp;<span class="op" id="5551812">*</span><span class="ident" id="5551813">compiler</span><span class="op" id="5551821">)</span>&nbsp;<span class="builtintype" id="5551823">rune</span><span class="op" id="5551827">(</span><span class="ident" id="5551828">r</span>&nbsp;<span class="op" id="5551830">[</span><span class="op" id="5551831">]</span><span class="builtintype" id="5551832">rune</span><span class="op" id="5551836">,</span>&nbsp;<span class="ident" id="5551838">flags</span>&nbsp;<span class="ident" id="5551844">Flags</span><span class="op" id="5551849">)</span>&nbsp;<span class="ident" id="5551851">frag</span>&nbsp;<span class="op" id="5551856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551859">f</span>&nbsp;<span class="op" id="5551861">:=</span>&nbsp;<span class="ident" id="5551864">c</span><span class="op" id="5551865">.</span><span class="ident" id="5551866">inst</span><span class="op" id="5551870">(</span><span class="ident" id="5551871">InstRune</span><span class="op" id="5551879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551882">i</span>&nbsp;<span class="op" id="5551884">:=</span>&nbsp;<span class="op" id="5551887">&amp;</span><span class="ident" id="5551888">c</span><span class="op" id="5551889">.</span><span class="ident" id="5551890">p</span><span class="op" id="5551891">.</span><span class="ident" id="5551892">Inst</span><span class="op" id="5551896">[</span><span class="ident" id="5551897">f</span><span class="op" id="5551898">.</span><span class="ident" id="5551899">i</span><span class="op" id="5551900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551903">i</span><span class="op" id="5551904">.</span><span class="ident" id="5551905">Rune</span>&nbsp;<span class="op" id="5551910">=</span>&nbsp;<span class="ident" id="5551912">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551915">flags</span>&nbsp;<span class="op" id="5551921">&amp;=</span>&nbsp;<span class="ident" id="5551924">FoldCase</span>&nbsp;<span class="comment" id="5551933">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551968">if</span>&nbsp;<span class="builtinfunc" id="5551971">len</span><span class="op" id="5551974">(</span><span class="ident" id="5551975">r</span><span class="op" id="5551976">)</span>&nbsp;<span class="op" id="5551978">!=</span>&nbsp;<span class="num" id="5551981">1</span>&nbsp;<span class="op" id="5551983">||</span>&nbsp;<span class="ident" id="5551986">unicode</span><span class="op" id="5551993">.</span><span class="ident" id="5551994">SimpleFold</span><span class="op" id="5552004">(</span><span class="ident" id="5552005">r</span><span class="op" id="5552006">[</span><span class="num" id="5552007">0</span><span class="op" id="5552008">]</span><span class="op" id="5552009">)</span>&nbsp;<span class="op" id="5552011">==</span>&nbsp;<span class="ident" id="5552014">r</span><span class="op" id="5552015">[</span><span class="num" id="5552016">0</span><span class="op" id="5552017">]</span>&nbsp;<span class="op" id="5552019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552023">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552056">flags</span>&nbsp;<span class="op" id="5552062">&amp;^=</span>&nbsp;<span class="ident" id="5552066">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552076">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552079">i</span><span class="op" id="5552080">.</span><span class="ident" id="5552081">Arg</span>&nbsp;<span class="op" id="5552085">=</span>&nbsp;<span class="builtintype" id="5552087">uint32</span><span class="op" id="5552093">(</span><span class="ident" id="5552094">flags</span><span class="op" id="5552099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552102">f</span><span class="op" id="5552103">.</span><span class="ident" id="5552104">out</span>&nbsp;<span class="op" id="5552108">=</span>&nbsp;<span class="ident" id="5552110">patchList</span><span class="op" id="5552119">(</span><span class="ident" id="5552120">f</span><span class="op" id="5552121">.</span><span class="ident" id="5552122">i</span>&nbsp;<span class="op" id="5552124">&lt;&lt;</span>&nbsp;<span class="num" id="5552127">1</span><span class="op" id="5552128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5552132">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552168">switch</span>&nbsp;<span class="op" id="5552175">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552178">case</span>&nbsp;<span class="ident" id="5552183">flags</span><span class="op" id="5552188">&amp;</span><span class="ident" id="5552189">FoldCase</span>&nbsp;<span class="op" id="5552198">==</span>&nbsp;<span class="num" id="5552201">0</span>&nbsp;<span class="op" id="5552203">&amp;&amp;</span>&nbsp;<span class="op" id="5552206">(</span><span class="builtinfunc" id="5552207">len</span><span class="op" id="5552210">(</span><span class="ident" id="5552211">r</span><span class="op" id="5552212">)</span>&nbsp;<span class="op" id="5552214">==</span>&nbsp;<span class="num" id="5552217">1</span>&nbsp;<span class="op" id="5552219">||</span>&nbsp;<span class="builtinfunc" id="5552222">len</span><span class="op" id="5552225">(</span><span class="ident" id="5552226">r</span><span class="op" id="5552227">)</span>&nbsp;<span class="op" id="5552229">==</span>&nbsp;<span class="num" id="5552232">2</span>&nbsp;<span class="op" id="5552234">&amp;&amp;</span>&nbsp;<span class="ident" id="5552237">r</span><span class="op" id="5552238">[</span><span class="num" id="5552239">0</span><span class="op" id="5552240">]</span>&nbsp;<span class="op" id="5552242">==</span>&nbsp;<span class="ident" id="5552245">r</span><span class="op" id="5552246">[</span><span class="num" id="5552247">1</span><span class="op" id="5552248">]</span><span class="op" id="5552249">)</span><span class="op" id="5552250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552254">i</span><span class="op" id="5552255">.</span><span class="ident" id="5552256">Op</span>&nbsp;<span class="op" id="5552259">=</span>&nbsp;<span class="ident" id="5552261">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552272">case</span>&nbsp;<span class="builtinfunc" id="5552277">len</span><span class="op" id="5552280">(</span><span class="ident" id="5552281">r</span><span class="op" id="5552282">)</span>&nbsp;<span class="op" id="5552284">==</span>&nbsp;<span class="num" id="5552287">2</span>&nbsp;<span class="op" id="5552289">&amp;&amp;</span>&nbsp;<span class="ident" id="5552292">r</span><span class="op" id="5552293">[</span><span class="num" id="5552294">0</span><span class="op" id="5552295">]</span>&nbsp;<span class="op" id="5552297">==</span>&nbsp;<span class="num" id="5552300">0</span>&nbsp;<span class="op" id="5552302">&amp;&amp;</span>&nbsp;<span class="ident" id="5552305">r</span><span class="op" id="5552306">[</span><span class="num" id="5552307">1</span><span class="op" id="5552308">]</span>&nbsp;<span class="op" id="5552310">==</span>&nbsp;<span class="ident" id="5552313">unicode</span><span class="op" id="5552320">.</span><span class="ident" id="5552321">MaxRune</span><span class="op" id="5552328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552332">i</span><span class="op" id="5552333">.</span><span class="ident" id="5552334">Op</span>&nbsp;<span class="op" id="5552337">=</span>&nbsp;<span class="ident" id="5552339">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552352">case</span>&nbsp;<span class="builtinfunc" id="5552357">len</span><span class="op" id="5552360">(</span><span class="ident" id="5552361">r</span><span class="op" id="5552362">)</span>&nbsp;<span class="op" id="5552364">==</span>&nbsp;<span class="num" id="5552367">4</span>&nbsp;<span class="op" id="5552369">&amp;&amp;</span>&nbsp;<span class="ident" id="5552372">r</span><span class="op" id="5552373">[</span><span class="num" id="5552374">0</span><span class="op" id="5552375">]</span>&nbsp;<span class="op" id="5552377">==</span>&nbsp;<span class="num" id="5552380">0</span>&nbsp;<span class="op" id="5552382">&amp;&amp;</span>&nbsp;<span class="ident" id="5552385">r</span><span class="op" id="5552386">[</span><span class="num" id="5552387">1</span><span class="op" id="5552388">]</span>&nbsp;<span class="op" id="5552390">==</span>&nbsp;<span class="string" id="5552393">&#39;\n&#39;</span><span class="op" id="5552397">-</span><span class="num" id="5552398">1</span>&nbsp;<span class="op" id="5552400">&amp;&amp;</span>&nbsp;<span class="ident" id="5552403">r</span><span class="op" id="5552404">[</span><span class="num" id="5552405">2</span><span class="op" id="5552406">]</span>&nbsp;<span class="op" id="5552408">==</span>&nbsp;<span class="string" id="5552411">&#39;\n&#39;</span><span class="op" id="5552415">+</span><span class="num" id="5552416">1</span>&nbsp;<span class="op" id="5552418">&amp;&amp;</span>&nbsp;<span class="ident" id="5552421">r</span><span class="op" id="5552422">[</span><span class="num" id="5552423">3</span><span class="op" id="5552424">]</span>&nbsp;<span class="op" id="5552426">==</span>&nbsp;<span class="ident" id="5552429">unicode</span><span class="op" id="5552436">.</span><span class="ident" id="5552437">MaxRune</span><span class="op" id="5552444">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5552448">i</span><span class="op" id="5552449">.</span><span class="ident" id="5552450">Op</span>&nbsp;<span class="op" id="5552453">=</span>&nbsp;<span class="ident" id="5552455">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5552473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5552477">return</span>&nbsp;<span class="ident" id="5552484">f</span><br>
<span class="lineno"></span><span class="op" id="5552486">}</span>
</div>
</body>
</html>
