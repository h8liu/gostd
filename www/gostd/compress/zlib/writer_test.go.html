<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6560635">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6560690">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6560744">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6560795">package</span>&nbsp;<span class="ident" id="6560803">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560809">import</span>&nbsp;<span class="op" id="6560816">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560819">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560828">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560835">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560841">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560854">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560860">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6560870">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6560873">var</span>&nbsp;<span class="ident" id="6560877">filenames</span>&nbsp;<span class="op" id="6560887">=</span>&nbsp;<span class="op" id="6560889">[</span><span class="op" id="6560890">]</span><span class="builtintype" id="6560891">string</span><span class="op" id="6560897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560900">&#34;../testdata/e.txt&#34;</span><span class="op" id="6560919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560922">&#34;../testdata/pi.txt&#34;</span><span class="op" id="6560942">,</span><br>
<span class="lineno"></span><span class="op" id="6560944">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6560947">var</span>&nbsp;<span class="ident" id="6560951">data</span>&nbsp;<span class="op" id="6560956">=</span>&nbsp;<span class="op" id="6560958">[</span><span class="op" id="6560959">]</span><span class="builtintype" id="6560960">string</span><span class="op" id="6560966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6560969">&#34;test&nbsp;a&nbsp;reasonable&nbsp;sized&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;compressed&#34;</span><span class="op" id="6561024">,</span><br>
<span class="lineno"></span><span class="op" id="6561026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6561029">//&nbsp;Tests&nbsp;that&nbsp;compressing&nbsp;and&nbsp;then&nbsp;decompressing&nbsp;the&nbsp;given&nbsp;file&nbsp;at&nbsp;the&nbsp;given&nbsp;compression&nbsp;level&nbsp;and&nbsp;dictionary</span><br>
<span class="lineno"></span><span class="comment" id="6561139">//&nbsp;yields&nbsp;equivalent&nbsp;bytes&nbsp;to&nbsp;the&nbsp;original&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6561188">func</span>&nbsp;<span class="ident" id="6561193">testFileLevelDict</span><span class="op" id="6561210">(</span><span class="ident" id="6561211">t</span>&nbsp;<span class="op" id="6561213">*</span><span class="ident" id="6561214">testing</span><span class="op" id="6561221">.</span><span class="ident" id="6561222">T</span><span class="op" id="6561223">,</span>&nbsp;<span class="ident" id="6561225">fn</span>&nbsp;<span class="builtintype" id="6561228">string</span><span class="op" id="6561234">,</span>&nbsp;<span class="ident" id="6561236">level</span>&nbsp;<span class="builtintype" id="6561242">int</span><span class="op" id="6561245">,</span>&nbsp;<span class="ident" id="6561247">d</span>&nbsp;<span class="builtintype" id="6561249">string</span><span class="op" id="6561255">)</span>&nbsp;<span class="op" id="6561257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561260">//&nbsp;Read&nbsp;the&nbsp;file,&nbsp;as&nbsp;golden&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561297">golden</span><span class="op" id="6561303">,</span>&nbsp;<span class="ident" id="6561305">err</span>&nbsp;<span class="op" id="6561309">:=</span>&nbsp;<span class="ident" id="6561312">os</span><span class="op" id="6561314">.</span><span class="ident" id="6561315">Open</span><span class="op" id="6561319">(</span><span class="ident" id="6561320">fn</span><span class="op" id="6561322">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561325">if</span>&nbsp;<span class="ident" id="6561328">err</span>&nbsp;<span class="op" id="6561332">!=</span>&nbsp;<span class="ident" id="6561335">nil</span>&nbsp;<span class="op" id="6561339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561343">t</span><span class="op" id="6561344">.</span><span class="ident" id="6561345">Errorf</span><span class="op" id="6561351">(</span><span class="string" id="6561352">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6561380">,</span>&nbsp;<span class="ident" id="6561382">fn</span><span class="op" id="6561384">,</span>&nbsp;<span class="ident" id="6561386">level</span><span class="op" id="6561391">,</span>&nbsp;<span class="ident" id="6561393">d</span><span class="op" id="6561394">,</span>&nbsp;<span class="ident" id="6561396">err</span><span class="op" id="6561399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561403">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561414">defer</span>&nbsp;<span class="ident" id="6561420">golden</span><span class="op" id="6561426">.</span><span class="ident" id="6561427">Close</span><span class="op" id="6561432">(</span><span class="op" id="6561433">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561436">b0</span><span class="op" id="6561438">,</span>&nbsp;<span class="ident" id="6561440">err0</span>&nbsp;<span class="op" id="6561445">:=</span>&nbsp;<span class="ident" id="6561448">ioutil</span><span class="op" id="6561454">.</span><span class="ident" id="6561455">ReadAll</span><span class="op" id="6561462">(</span><span class="ident" id="6561463">golden</span><span class="op" id="6561469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561472">if</span>&nbsp;<span class="ident" id="6561475">err0</span>&nbsp;<span class="op" id="6561480">!=</span>&nbsp;<span class="ident" id="6561483">nil</span>&nbsp;<span class="op" id="6561487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561491">t</span><span class="op" id="6561492">.</span><span class="ident" id="6561493">Errorf</span><span class="op" id="6561499">(</span><span class="string" id="6561500">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6561528">,</span>&nbsp;<span class="ident" id="6561530">fn</span><span class="op" id="6561532">,</span>&nbsp;<span class="ident" id="6561534">level</span><span class="op" id="6561539">,</span>&nbsp;<span class="ident" id="6561541">d</span><span class="op" id="6561542">,</span>&nbsp;<span class="ident" id="6561544">err0</span><span class="op" id="6561548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561552">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561560">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561563">testLevelDict</span><span class="op" id="6561576">(</span><span class="ident" id="6561577">t</span><span class="op" id="6561578">,</span>&nbsp;<span class="ident" id="6561580">fn</span><span class="op" id="6561582">,</span>&nbsp;<span class="ident" id="6561584">b0</span><span class="op" id="6561586">,</span>&nbsp;<span class="ident" id="6561588">level</span><span class="op" id="6561593">,</span>&nbsp;<span class="ident" id="6561595">d</span><span class="op" id="6561596">)</span><br>
<span class="lineno"></span><span class="op" id="6561598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6561601">func</span>&nbsp;<span class="ident" id="6561606">testLevelDict</span><span class="op" id="6561619">(</span><span class="ident" id="6561620">t</span>&nbsp;<span class="op" id="6561622">*</span><span class="ident" id="6561623">testing</span><span class="op" id="6561630">.</span><span class="ident" id="6561631">T</span><span class="op" id="6561632">,</span>&nbsp;<span class="ident" id="6561634">fn</span>&nbsp;<span class="builtintype" id="6561637">string</span><span class="op" id="6561643">,</span>&nbsp;<span class="ident" id="6561645">b0</span>&nbsp;<span class="op" id="6561648">[</span><span class="op" id="6561649">]</span><span class="builtintype" id="6561650">byte</span><span class="op" id="6561654">,</span>&nbsp;<span class="ident" id="6561656">level</span>&nbsp;<span class="builtintype" id="6561662">int</span><span class="op" id="6561665">,</span>&nbsp;<span class="ident" id="6561667">d</span>&nbsp;<span class="builtintype" id="6561669">string</span><span class="op" id="6561675">)</span>&nbsp;<span class="op" id="6561677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561680">//&nbsp;Make&nbsp;dictionary,&nbsp;if&nbsp;given.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561711">var</span>&nbsp;<span class="ident" id="6561715">dict</span>&nbsp;<span class="op" id="6561720">[</span><span class="op" id="6561721">]</span><span class="builtintype" id="6561722">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561728">if</span>&nbsp;<span class="ident" id="6561731">d</span>&nbsp;<span class="op" id="6561733">!=</span>&nbsp;<span class="string" id="6561736">&#34;&#34;</span>&nbsp;<span class="op" id="6561739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561743">dict</span>&nbsp;<span class="op" id="6561748">=</span>&nbsp;<span class="op" id="6561750">[</span><span class="op" id="6561751">]</span><span class="builtintype" id="6561752">byte</span><span class="op" id="6561756">(</span><span class="ident" id="6561757">d</span><span class="op" id="6561758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561765">//&nbsp;Push&nbsp;data&nbsp;through&nbsp;a&nbsp;pipe&nbsp;that&nbsp;compresses&nbsp;at&nbsp;the&nbsp;write&nbsp;end,&nbsp;and&nbsp;decompresses&nbsp;at&nbsp;the&nbsp;read&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561862">piper</span><span class="op" id="6561867">,</span>&nbsp;<span class="ident" id="6561869">pipew</span>&nbsp;<span class="op" id="6561875">:=</span>&nbsp;<span class="ident" id="6561878">io</span><span class="op" id="6561880">.</span><span class="ident" id="6561881">Pipe</span><span class="op" id="6561885">(</span><span class="op" id="6561886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561889">defer</span>&nbsp;<span class="ident" id="6561895">piper</span><span class="op" id="6561900">.</span><span class="ident" id="6561901">Close</span><span class="op" id="6561906">(</span><span class="op" id="6561907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561910">go</span>&nbsp;<span class="keyword" id="6561913">func</span><span class="op" id="6561917">(</span><span class="op" id="6561918">)</span>&nbsp;<span class="op" id="6561920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561924">defer</span>&nbsp;<span class="ident" id="6561930">pipew</span><span class="op" id="6561935">.</span><span class="ident" id="6561936">Close</span><span class="op" id="6561941">(</span><span class="op" id="6561942">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561946">zlibw</span><span class="op" id="6561951">,</span>&nbsp;<span class="ident" id="6561953">err</span>&nbsp;<span class="op" id="6561957">:=</span>&nbsp;<span class="ident" id="6561960">NewWriterLevelDict</span><span class="op" id="6561978">(</span><span class="ident" id="6561979">pipew</span><span class="op" id="6561984">,</span>&nbsp;<span class="ident" id="6561986">level</span><span class="op" id="6561991">,</span>&nbsp;<span class="ident" id="6561993">dict</span><span class="op" id="6561997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562001">if</span>&nbsp;<span class="ident" id="6562004">err</span>&nbsp;<span class="op" id="6562008">!=</span>&nbsp;<span class="ident" id="6562011">nil</span>&nbsp;<span class="op" id="6562015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562020">t</span><span class="op" id="6562021">.</span><span class="ident" id="6562022">Errorf</span><span class="op" id="6562028">(</span><span class="string" id="6562029">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6562057">,</span>&nbsp;<span class="ident" id="6562059">fn</span><span class="op" id="6562061">,</span>&nbsp;<span class="ident" id="6562063">level</span><span class="op" id="6562068">,</span>&nbsp;<span class="ident" id="6562070">d</span><span class="op" id="6562071">,</span>&nbsp;<span class="ident" id="6562073">err</span><span class="op" id="6562076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562081">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562090">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562094">defer</span>&nbsp;<span class="ident" id="6562100">zlibw</span><span class="op" id="6562105">.</span><span class="ident" id="6562106">Close</span><span class="op" id="6562111">(</span><span class="op" id="6562112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562116">_</span><span class="op" id="6562117">,</span>&nbsp;<span class="ident" id="6562119">err</span>&nbsp;<span class="op" id="6562123">=</span>&nbsp;<span class="ident" id="6562125">zlibw</span><span class="op" id="6562130">.</span><span class="ident" id="6562131">Write</span><span class="op" id="6562136">(</span><span class="ident" id="6562137">b0</span><span class="op" id="6562139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562143">if</span>&nbsp;<span class="ident" id="6562146">err</span>&nbsp;<span class="op" id="6562150">!=</span>&nbsp;<span class="ident" id="6562153">nil</span>&nbsp;<span class="op" id="6562157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562162">t</span><span class="op" id="6562163">.</span><span class="ident" id="6562164">Errorf</span><span class="op" id="6562170">(</span><span class="string" id="6562171">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6562199">,</span>&nbsp;<span class="ident" id="6562201">fn</span><span class="op" id="6562203">,</span>&nbsp;<span class="ident" id="6562205">level</span><span class="op" id="6562210">,</span>&nbsp;<span class="ident" id="6562212">d</span><span class="op" id="6562213">,</span>&nbsp;<span class="ident" id="6562215">err</span><span class="op" id="6562218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562223">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562235">}</span><span class="op" id="6562236">(</span><span class="op" id="6562237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562240">zlibr</span><span class="op" id="6562245">,</span>&nbsp;<span class="ident" id="6562247">err</span>&nbsp;<span class="op" id="6562251">:=</span>&nbsp;<span class="ident" id="6562254">NewReaderDict</span><span class="op" id="6562267">(</span><span class="ident" id="6562268">piper</span><span class="op" id="6562273">,</span>&nbsp;<span class="ident" id="6562275">dict</span><span class="op" id="6562279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562282">if</span>&nbsp;<span class="ident" id="6562285">err</span>&nbsp;<span class="op" id="6562289">!=</span>&nbsp;<span class="ident" id="6562292">nil</span>&nbsp;<span class="op" id="6562296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562300">t</span><span class="op" id="6562301">.</span><span class="ident" id="6562302">Errorf</span><span class="op" id="6562308">(</span><span class="string" id="6562309">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6562337">,</span>&nbsp;<span class="ident" id="6562339">fn</span><span class="op" id="6562341">,</span>&nbsp;<span class="ident" id="6562343">level</span><span class="op" id="6562348">,</span>&nbsp;<span class="ident" id="6562350">d</span><span class="op" id="6562351">,</span>&nbsp;<span class="ident" id="6562353">err</span><span class="op" id="6562356">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562360">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562371">defer</span>&nbsp;<span class="ident" id="6562377">zlibr</span><span class="op" id="6562382">.</span><span class="ident" id="6562383">Close</span><span class="op" id="6562388">(</span><span class="op" id="6562389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6562393">//&nbsp;Compare&nbsp;the&nbsp;decompressed&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562428">b1</span><span class="op" id="6562430">,</span>&nbsp;<span class="ident" id="6562432">err1</span>&nbsp;<span class="op" id="6562437">:=</span>&nbsp;<span class="ident" id="6562440">ioutil</span><span class="op" id="6562446">.</span><span class="ident" id="6562447">ReadAll</span><span class="op" id="6562454">(</span><span class="ident" id="6562455">zlibr</span><span class="op" id="6562460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562463">if</span>&nbsp;<span class="ident" id="6562466">err1</span>&nbsp;<span class="op" id="6562471">!=</span>&nbsp;<span class="ident" id="6562474">nil</span>&nbsp;<span class="op" id="6562478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562482">t</span><span class="op" id="6562483">.</span><span class="ident" id="6562484">Errorf</span><span class="op" id="6562490">(</span><span class="string" id="6562491">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="6562519">,</span>&nbsp;<span class="ident" id="6562521">fn</span><span class="op" id="6562523">,</span>&nbsp;<span class="ident" id="6562525">level</span><span class="op" id="6562530">,</span>&nbsp;<span class="ident" id="6562532">d</span><span class="op" id="6562533">,</span>&nbsp;<span class="ident" id="6562535">err1</span><span class="op" id="6562539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562551">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562554">if</span>&nbsp;<span class="builtinfunc" id="6562557">len</span><span class="op" id="6562560">(</span><span class="ident" id="6562561">b0</span><span class="op" id="6562563">)</span>&nbsp;<span class="op" id="6562565">!=</span>&nbsp;<span class="builtinfunc" id="6562568">len</span><span class="op" id="6562571">(</span><span class="ident" id="6562572">b1</span><span class="op" id="6562574">)</span>&nbsp;<span class="op" id="6562576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562580">t</span><span class="op" id="6562581">.</span><span class="ident" id="6562582">Errorf</span><span class="op" id="6562588">(</span><span class="string" id="6562589">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;length&nbsp;mismatch&nbsp;%d&nbsp;versus&nbsp;%d&#34;</span><span class="op" id="6562643">,</span>&nbsp;<span class="ident" id="6562645">fn</span><span class="op" id="6562647">,</span>&nbsp;<span class="ident" id="6562649">level</span><span class="op" id="6562654">,</span>&nbsp;<span class="ident" id="6562656">d</span><span class="op" id="6562657">,</span>&nbsp;<span class="builtinfunc" id="6562659">len</span><span class="op" id="6562662">(</span><span class="ident" id="6562663">b0</span><span class="op" id="6562665">)</span><span class="op" id="6562666">,</span>&nbsp;<span class="builtinfunc" id="6562668">len</span><span class="op" id="6562671">(</span><span class="ident" id="6562672">b1</span><span class="op" id="6562674">)</span><span class="op" id="6562675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562679">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562690">for</span>&nbsp;<span class="ident" id="6562694">i</span>&nbsp;<span class="op" id="6562696">:=</span>&nbsp;<span class="num" id="6562699">0</span><span class="op" id="6562700">;</span>&nbsp;<span class="ident" id="6562702">i</span>&nbsp;<span class="op" id="6562704">&lt;</span>&nbsp;<span class="builtinfunc" id="6562706">len</span><span class="op" id="6562709">(</span><span class="ident" id="6562710">b0</span><span class="op" id="6562712">)</span><span class="op" id="6562713">;</span>&nbsp;<span class="ident" id="6562715">i</span><span class="op" id="6562716">++</span>&nbsp;<span class="op" id="6562719">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562723">if</span>&nbsp;<span class="ident" id="6562726">b0</span><span class="op" id="6562728">[</span><span class="ident" id="6562729">i</span><span class="op" id="6562730">]</span>&nbsp;<span class="op" id="6562732">!=</span>&nbsp;<span class="ident" id="6562735">b1</span><span class="op" id="6562737">[</span><span class="ident" id="6562738">i</span><span class="op" id="6562739">]</span>&nbsp;<span class="op" id="6562741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562746">t</span><span class="op" id="6562747">.</span><span class="ident" id="6562748">Errorf</span><span class="op" id="6562754">(</span><span class="string" id="6562755">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;mismatch&nbsp;at&nbsp;%d,&nbsp;0x%02x&nbsp;versus&nbsp;0x%02x\n&#34;</span><span class="op" id="6562819">,</span>&nbsp;<span class="ident" id="6562821">fn</span><span class="op" id="6562823">,</span>&nbsp;<span class="ident" id="6562825">level</span><span class="op" id="6562830">,</span>&nbsp;<span class="ident" id="6562832">d</span><span class="op" id="6562833">,</span>&nbsp;<span class="ident" id="6562835">i</span><span class="op" id="6562836">,</span>&nbsp;<span class="ident" id="6562838">b0</span><span class="op" id="6562840">[</span><span class="ident" id="6562841">i</span><span class="op" id="6562842">]</span><span class="op" id="6562843">,</span>&nbsp;<span class="ident" id="6562845">b1</span><span class="op" id="6562847">[</span><span class="ident" id="6562848">i</span><span class="op" id="6562849">]</span><span class="op" id="6562850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562855">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562867">}</span><br>
<span class="lineno">90</span><span class="op" id="6562869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6562872">func</span>&nbsp;<span class="ident" id="6562877">testFileLevelDictReset</span><span class="op" id="6562899">(</span><span class="ident" id="6562900">t</span>&nbsp;<span class="op" id="6562902">*</span><span class="ident" id="6562903">testing</span><span class="op" id="6562910">.</span><span class="ident" id="6562911">T</span><span class="op" id="6562912">,</span>&nbsp;<span class="ident" id="6562914">fn</span>&nbsp;<span class="builtintype" id="6562917">string</span><span class="op" id="6562923">,</span>&nbsp;<span class="ident" id="6562925">level</span>&nbsp;<span class="builtintype" id="6562931">int</span><span class="op" id="6562934">,</span>&nbsp;<span class="ident" id="6562936">dict</span>&nbsp;<span class="op" id="6562941">[</span><span class="op" id="6562942">]</span><span class="builtintype" id="6562943">byte</span><span class="op" id="6562947">)</span>&nbsp;<span class="op" id="6562949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562952">var</span>&nbsp;<span class="ident" id="6562956">b0</span>&nbsp;<span class="op" id="6562959">[</span><span class="op" id="6562960">]</span><span class="builtintype" id="6562961">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562967">var</span>&nbsp;<span class="ident" id="6562971">err</span>&nbsp;<span class="builtintype" id="6562975">error</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562982">if</span>&nbsp;<span class="ident" id="6562985">fn</span>&nbsp;<span class="op" id="6562988">!=</span>&nbsp;<span class="string" id="6562991">&#34;&#34;</span>&nbsp;<span class="op" id="6562994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562998">b0</span><span class="op" id="6563000">,</span>&nbsp;<span class="ident" id="6563002">err</span>&nbsp;<span class="op" id="6563006">=</span>&nbsp;<span class="ident" id="6563008">ioutil</span><span class="op" id="6563014">.</span><span class="ident" id="6563015">ReadFile</span><span class="op" id="6563023">(</span><span class="ident" id="6563024">fn</span><span class="op" id="6563026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563030">if</span>&nbsp;<span class="ident" id="6563033">err</span>&nbsp;<span class="op" id="6563037">!=</span>&nbsp;<span class="ident" id="6563040">nil</span>&nbsp;<span class="op" id="6563044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563049">t</span><span class="op" id="6563050">.</span><span class="ident" id="6563051">Errorf</span><span class="op" id="6563057">(</span><span class="string" id="6563058">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="6563077">,</span>&nbsp;<span class="ident" id="6563079">fn</span><span class="op" id="6563081">,</span>&nbsp;<span class="ident" id="6563083">level</span><span class="op" id="6563088">,</span>&nbsp;<span class="ident" id="6563090">err</span><span class="op" id="6563093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563098">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6563114">//&nbsp;Compress&nbsp;once.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563133">buf</span>&nbsp;<span class="op" id="6563137">:=</span>&nbsp;<span class="builtinfunc" id="6563140">new</span><span class="op" id="6563143">(</span><span class="ident" id="6563144">bytes</span><span class="op" id="6563149">.</span><span class="ident" id="6563150">Buffer</span><span class="op" id="6563156">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563159">var</span>&nbsp;<span class="ident" id="6563163">zlibw</span>&nbsp;<span class="op" id="6563169">*</span><span class="ident" id="6563170">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563178">if</span>&nbsp;<span class="ident" id="6563181">dict</span>&nbsp;<span class="op" id="6563186">==</span>&nbsp;<span class="ident" id="6563189">nil</span>&nbsp;<span class="op" id="6563193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563197">zlibw</span><span class="op" id="6563202">,</span>&nbsp;<span class="ident" id="6563204">err</span>&nbsp;<span class="op" id="6563208">=</span>&nbsp;<span class="ident" id="6563210">NewWriterLevel</span><span class="op" id="6563224">(</span><span class="ident" id="6563225">buf</span><span class="op" id="6563228">,</span>&nbsp;<span class="ident" id="6563230">level</span><span class="op" id="6563235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563238">}</span>&nbsp;<span class="keyword" id="6563240">else</span>&nbsp;<span class="op" id="6563245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563249">zlibw</span><span class="op" id="6563254">,</span>&nbsp;<span class="ident" id="6563256">err</span>&nbsp;<span class="op" id="6563260">=</span>&nbsp;<span class="ident" id="6563262">NewWriterLevelDict</span><span class="op" id="6563280">(</span><span class="ident" id="6563281">buf</span><span class="op" id="6563284">,</span>&nbsp;<span class="ident" id="6563286">level</span><span class="op" id="6563291">,</span>&nbsp;<span class="ident" id="6563293">dict</span><span class="op" id="6563297">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563303">if</span>&nbsp;<span class="ident" id="6563306">err</span>&nbsp;<span class="op" id="6563310">==</span>&nbsp;<span class="ident" id="6563313">nil</span>&nbsp;<span class="op" id="6563317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563321">_</span><span class="op" id="6563322">,</span>&nbsp;<span class="ident" id="6563324">err</span>&nbsp;<span class="op" id="6563328">=</span>&nbsp;<span class="ident" id="6563330">zlibw</span><span class="op" id="6563335">.</span><span class="ident" id="6563336">Write</span><span class="op" id="6563341">(</span><span class="ident" id="6563342">b0</span><span class="op" id="6563344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563350">if</span>&nbsp;<span class="ident" id="6563353">err</span>&nbsp;<span class="op" id="6563357">==</span>&nbsp;<span class="ident" id="6563360">nil</span>&nbsp;<span class="op" id="6563364">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563368">err</span>&nbsp;<span class="op" id="6563372">=</span>&nbsp;<span class="ident" id="6563374">zlibw</span><span class="op" id="6563379">.</span><span class="ident" id="6563380">Close</span><span class="op" id="6563385">(</span><span class="op" id="6563386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563392">if</span>&nbsp;<span class="ident" id="6563395">err</span>&nbsp;<span class="op" id="6563399">!=</span>&nbsp;<span class="ident" id="6563402">nil</span>&nbsp;<span class="op" id="6563406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563410">t</span><span class="op" id="6563411">.</span><span class="ident" id="6563412">Errorf</span><span class="op" id="6563418">(</span><span class="string" id="6563419">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="6563438">,</span>&nbsp;<span class="ident" id="6563440">fn</span><span class="op" id="6563442">,</span>&nbsp;<span class="ident" id="6563444">level</span><span class="op" id="6563449">,</span>&nbsp;<span class="ident" id="6563451">err</span><span class="op" id="6563454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563458">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563469">out</span>&nbsp;<span class="op" id="6563473">:=</span>&nbsp;<span class="ident" id="6563476">buf</span><span class="op" id="6563479">.</span><span class="ident" id="6563480">String</span><span class="op" id="6563486">(</span><span class="op" id="6563487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6563491">//&nbsp;Reset&nbsp;and&nbsp;compress&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563521">buf2</span>&nbsp;<span class="op" id="6563526">:=</span>&nbsp;<span class="builtinfunc" id="6563529">new</span><span class="op" id="6563532">(</span><span class="ident" id="6563533">bytes</span><span class="op" id="6563538">.</span><span class="ident" id="6563539">Buffer</span><span class="op" id="6563545">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563548">zlibw</span><span class="op" id="6563553">.</span><span class="ident" id="6563554">Reset</span><span class="op" id="6563559">(</span><span class="ident" id="6563560">buf2</span><span class="op" id="6563564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563567">_</span><span class="op" id="6563568">,</span>&nbsp;<span class="ident" id="6563570">err</span>&nbsp;<span class="op" id="6563574">=</span>&nbsp;<span class="ident" id="6563576">zlibw</span><span class="op" id="6563581">.</span><span class="ident" id="6563582">Write</span><span class="op" id="6563587">(</span><span class="ident" id="6563588">b0</span><span class="op" id="6563590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563593">if</span>&nbsp;<span class="ident" id="6563596">err</span>&nbsp;<span class="op" id="6563600">==</span>&nbsp;<span class="ident" id="6563603">nil</span>&nbsp;<span class="op" id="6563607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563611">err</span>&nbsp;<span class="op" id="6563615">=</span>&nbsp;<span class="ident" id="6563617">zlibw</span><span class="op" id="6563622">.</span><span class="ident" id="6563623">Close</span><span class="op" id="6563628">(</span><span class="op" id="6563629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563632">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563635">if</span>&nbsp;<span class="ident" id="6563638">err</span>&nbsp;<span class="op" id="6563642">!=</span>&nbsp;<span class="ident" id="6563645">nil</span>&nbsp;<span class="op" id="6563649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563653">t</span><span class="op" id="6563654">.</span><span class="ident" id="6563655">Errorf</span><span class="op" id="6563661">(</span><span class="string" id="6563662">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="6563681">,</span>&nbsp;<span class="ident" id="6563683">fn</span><span class="op" id="6563685">,</span>&nbsp;<span class="ident" id="6563687">level</span><span class="op" id="6563692">,</span>&nbsp;<span class="ident" id="6563694">err</span><span class="op" id="6563697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563701">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563712">out2</span>&nbsp;<span class="op" id="6563717">:=</span>&nbsp;<span class="ident" id="6563720">buf2</span><span class="op" id="6563724">.</span><span class="ident" id="6563725">String</span><span class="op" id="6563731">(</span><span class="op" id="6563732">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563736">if</span>&nbsp;<span class="ident" id="6563739">out2</span>&nbsp;<span class="op" id="6563744">!=</span>&nbsp;<span class="ident" id="6563747">out</span>&nbsp;<span class="op" id="6563751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563755">t</span><span class="op" id="6563756">.</span><span class="ident" id="6563757">Errorf</span><span class="op" id="6563763">(</span><span class="string" id="6563764">&#34;%s&nbsp;(level=%d):&nbsp;different&nbsp;output&nbsp;after&nbsp;reset&nbsp;(got&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6563836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563841">fn</span><span class="op" id="6563843">,</span>&nbsp;<span class="ident" id="6563845">level</span><span class="op" id="6563850">,</span>&nbsp;<span class="builtinfunc" id="6563852">len</span><span class="op" id="6563855">(</span><span class="ident" id="6563856">out2</span><span class="op" id="6563860">)</span><span class="op" id="6563861">,</span>&nbsp;<span class="builtinfunc" id="6563863">len</span><span class="op" id="6563866">(</span><span class="ident" id="6563867">out</span><span class="op" id="6563870">)</span><span class="op" id="6563871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563874">}</span><br>
<span class="lineno">140</span><span class="op" id="6563876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6563879">func</span>&nbsp;<span class="ident" id="6563884">TestWriter</span><span class="op" id="6563894">(</span><span class="ident" id="6563895">t</span>&nbsp;<span class="op" id="6563897">*</span><span class="ident" id="6563898">testing</span><span class="op" id="6563905">.</span><span class="ident" id="6563906">T</span><span class="op" id="6563907">)</span>&nbsp;<span class="op" id="6563909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563912">for</span>&nbsp;<span class="ident" id="6563916">i</span><span class="op" id="6563917">,</span>&nbsp;<span class="ident" id="6563919">s</span>&nbsp;<span class="op" id="6563921">:=</span>&nbsp;<span class="keyword" id="6563924">range</span>&nbsp;<span class="ident" id="6563930">data</span>&nbsp;<span class="op" id="6563935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563939">b</span>&nbsp;<span class="op" id="6563941">:=</span>&nbsp;<span class="op" id="6563944">[</span><span class="op" id="6563945">]</span><span class="builtintype" id="6563946">byte</span><span class="op" id="6563950">(</span><span class="ident" id="6563951">s</span><span class="op" id="6563952">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563956">tag</span>&nbsp;<span class="op" id="6563960">:=</span>&nbsp;<span class="ident" id="6563963">fmt</span><span class="op" id="6563966">.</span><span class="ident" id="6563967">Sprintf</span><span class="op" id="6563974">(</span><span class="string" id="6563975">&#34;#%d&#34;</span><span class="op" id="6563980">,</span>&nbsp;<span class="ident" id="6563982">i</span><span class="op" id="6563983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563987">testLevelDict</span><span class="op" id="6564000">(</span><span class="ident" id="6564001">t</span><span class="op" id="6564002">,</span>&nbsp;<span class="ident" id="6564004">tag</span><span class="op" id="6564007">,</span>&nbsp;<span class="ident" id="6564009">b</span><span class="op" id="6564010">,</span>&nbsp;<span class="ident" id="6564012">DefaultCompression</span><span class="op" id="6564030">,</span>&nbsp;<span class="string" id="6564032">&#34;&#34;</span><span class="op" id="6564034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564038">testLevelDict</span><span class="op" id="6564051">(</span><span class="ident" id="6564052">t</span><span class="op" id="6564053">,</span>&nbsp;<span class="ident" id="6564055">tag</span><span class="op" id="6564058">,</span>&nbsp;<span class="ident" id="6564060">b</span><span class="op" id="6564061">,</span>&nbsp;<span class="ident" id="6564063">NoCompression</span><span class="op" id="6564076">,</span>&nbsp;<span class="string" id="6564078">&#34;&#34;</span><span class="op" id="6564080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564084">for</span>&nbsp;<span class="ident" id="6564088">level</span>&nbsp;<span class="op" id="6564094">:=</span>&nbsp;<span class="ident" id="6564097">BestSpeed</span><span class="op" id="6564106">;</span>&nbsp;<span class="ident" id="6564108">level</span>&nbsp;<span class="op" id="6564114">&lt;=</span>&nbsp;<span class="ident" id="6564117">BestCompression</span><span class="op" id="6564132">;</span>&nbsp;<span class="ident" id="6564134">level</span><span class="op" id="6564139">++</span>&nbsp;<span class="op" id="6564142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564147">testLevelDict</span><span class="op" id="6564160">(</span><span class="ident" id="6564161">t</span><span class="op" id="6564162">,</span>&nbsp;<span class="ident" id="6564164">tag</span><span class="op" id="6564167">,</span>&nbsp;<span class="ident" id="6564169">b</span><span class="op" id="6564170">,</span>&nbsp;<span class="ident" id="6564172">level</span><span class="op" id="6564177">,</span>&nbsp;<span class="string" id="6564179">&#34;&#34;</span><span class="op" id="6564181">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564188">}</span><br>
<span class="lineno"></span><span class="op" id="6564190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6564193">func</span>&nbsp;<span class="ident" id="6564198">TestWriterBig</span><span class="op" id="6564211">(</span><span class="ident" id="6564212">t</span>&nbsp;<span class="op" id="6564214">*</span><span class="ident" id="6564215">testing</span><span class="op" id="6564222">.</span><span class="ident" id="6564223">T</span><span class="op" id="6564224">)</span>&nbsp;<span class="op" id="6564226">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564229">for</span>&nbsp;<span class="ident" id="6564233">_</span><span class="op" id="6564234">,</span>&nbsp;<span class="ident" id="6564236">fn</span>&nbsp;<span class="op" id="6564239">:=</span>&nbsp;<span class="keyword" id="6564242">range</span>&nbsp;<span class="ident" id="6564248">filenames</span>&nbsp;<span class="op" id="6564258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564262">testFileLevelDict</span><span class="op" id="6564279">(</span><span class="ident" id="6564280">t</span><span class="op" id="6564281">,</span>&nbsp;<span class="ident" id="6564283">fn</span><span class="op" id="6564285">,</span>&nbsp;<span class="ident" id="6564287">DefaultCompression</span><span class="op" id="6564305">,</span>&nbsp;<span class="string" id="6564307">&#34;&#34;</span><span class="op" id="6564309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564313">testFileLevelDict</span><span class="op" id="6564330">(</span><span class="ident" id="6564331">t</span><span class="op" id="6564332">,</span>&nbsp;<span class="ident" id="6564334">fn</span><span class="op" id="6564336">,</span>&nbsp;<span class="ident" id="6564338">NoCompression</span><span class="op" id="6564351">,</span>&nbsp;<span class="string" id="6564353">&#34;&#34;</span><span class="op" id="6564355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564359">for</span>&nbsp;<span class="ident" id="6564363">level</span>&nbsp;<span class="op" id="6564369">:=</span>&nbsp;<span class="ident" id="6564372">BestSpeed</span><span class="op" id="6564381">;</span>&nbsp;<span class="ident" id="6564383">level</span>&nbsp;<span class="op" id="6564389">&lt;=</span>&nbsp;<span class="ident" id="6564392">BestCompression</span><span class="op" id="6564407">;</span>&nbsp;<span class="ident" id="6564409">level</span><span class="op" id="6564414">++</span>&nbsp;<span class="op" id="6564417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564422">testFileLevelDict</span><span class="op" id="6564439">(</span><span class="ident" id="6564440">t</span><span class="op" id="6564441">,</span>&nbsp;<span class="ident" id="6564443">fn</span><span class="op" id="6564445">,</span>&nbsp;<span class="ident" id="6564447">level</span><span class="op" id="6564452">,</span>&nbsp;<span class="string" id="6564454">&#34;&#34;</span><span class="op" id="6564456">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564463">}</span><br>
<span class="lineno"></span><span class="op" id="6564465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6564468">func</span>&nbsp;<span class="ident" id="6564473">TestWriterDict</span><span class="op" id="6564487">(</span><span class="ident" id="6564488">t</span>&nbsp;<span class="op" id="6564490">*</span><span class="ident" id="6564491">testing</span><span class="op" id="6564498">.</span><span class="ident" id="6564499">T</span><span class="op" id="6564500">)</span>&nbsp;<span class="op" id="6564502">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564505">const</span>&nbsp;<span class="ident" id="6564511">dictionary</span>&nbsp;<span class="op" id="6564522">=</span>&nbsp;<span class="string" id="6564524">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564539">for</span>&nbsp;<span class="ident" id="6564543">_</span><span class="op" id="6564544">,</span>&nbsp;<span class="ident" id="6564546">fn</span>&nbsp;<span class="op" id="6564549">:=</span>&nbsp;<span class="keyword" id="6564552">range</span>&nbsp;<span class="ident" id="6564558">filenames</span>&nbsp;<span class="op" id="6564568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564572">testFileLevelDict</span><span class="op" id="6564589">(</span><span class="ident" id="6564590">t</span><span class="op" id="6564591">,</span>&nbsp;<span class="ident" id="6564593">fn</span><span class="op" id="6564595">,</span>&nbsp;<span class="ident" id="6564597">DefaultCompression</span><span class="op" id="6564615">,</span>&nbsp;<span class="ident" id="6564617">dictionary</span><span class="op" id="6564627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564631">testFileLevelDict</span><span class="op" id="6564648">(</span><span class="ident" id="6564649">t</span><span class="op" id="6564650">,</span>&nbsp;<span class="ident" id="6564652">fn</span><span class="op" id="6564654">,</span>&nbsp;<span class="ident" id="6564656">NoCompression</span><span class="op" id="6564669">,</span>&nbsp;<span class="ident" id="6564671">dictionary</span><span class="op" id="6564681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564685">for</span>&nbsp;<span class="ident" id="6564689">level</span>&nbsp;<span class="op" id="6564695">:=</span>&nbsp;<span class="ident" id="6564698">BestSpeed</span><span class="op" id="6564707">;</span>&nbsp;<span class="ident" id="6564709">level</span>&nbsp;<span class="op" id="6564715">&lt;=</span>&nbsp;<span class="ident" id="6564718">BestCompression</span><span class="op" id="6564733">;</span>&nbsp;<span class="ident" id="6564735">level</span><span class="op" id="6564740">++</span>&nbsp;<span class="op" id="6564743">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564748">testFileLevelDict</span><span class="op" id="6564765">(</span><span class="ident" id="6564766">t</span><span class="op" id="6564767">,</span>&nbsp;<span class="ident" id="6564769">fn</span><span class="op" id="6564771">,</span>&nbsp;<span class="ident" id="6564773">level</span><span class="op" id="6564778">,</span>&nbsp;<span class="ident" id="6564780">dictionary</span><span class="op" id="6564790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564797">}</span><br>
<span class="lineno"></span><span class="op" id="6564799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6564802">func</span>&nbsp;<span class="ident" id="6564807">TestWriterReset</span><span class="op" id="6564822">(</span><span class="ident" id="6564823">t</span>&nbsp;<span class="op" id="6564825">*</span><span class="ident" id="6564826">testing</span><span class="op" id="6564833">.</span><span class="ident" id="6564834">T</span><span class="op" id="6564835">)</span>&nbsp;<span class="op" id="6564837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564840">const</span>&nbsp;<span class="ident" id="6564846">dictionary</span>&nbsp;<span class="op" id="6564857">=</span>&nbsp;<span class="string" id="6564859">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564874">for</span>&nbsp;<span class="ident" id="6564878">_</span><span class="op" id="6564879">,</span>&nbsp;<span class="ident" id="6564881">fn</span>&nbsp;<span class="op" id="6564884">:=</span>&nbsp;<span class="keyword" id="6564887">range</span>&nbsp;<span class="ident" id="6564893">filenames</span>&nbsp;<span class="op" id="6564903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564907">testFileLevelDictReset</span><span class="op" id="6564929">(</span><span class="ident" id="6564930">t</span><span class="op" id="6564931">,</span>&nbsp;<span class="ident" id="6564933">fn</span><span class="op" id="6564935">,</span>&nbsp;<span class="ident" id="6564937">NoCompression</span><span class="op" id="6564950">,</span>&nbsp;<span class="ident" id="6564952">nil</span><span class="op" id="6564955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564959">testFileLevelDictReset</span><span class="op" id="6564981">(</span><span class="ident" id="6564982">t</span><span class="op" id="6564983">,</span>&nbsp;<span class="ident" id="6564985">fn</span><span class="op" id="6564987">,</span>&nbsp;<span class="ident" id="6564989">DefaultCompression</span><span class="op" id="6565007">,</span>&nbsp;<span class="ident" id="6565009">nil</span><span class="op" id="6565012">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565016">testFileLevelDictReset</span><span class="op" id="6565038">(</span><span class="ident" id="6565039">t</span><span class="op" id="6565040">,</span>&nbsp;<span class="ident" id="6565042">fn</span><span class="op" id="6565044">,</span>&nbsp;<span class="ident" id="6565046">NoCompression</span><span class="op" id="6565059">,</span>&nbsp;<span class="op" id="6565061">[</span><span class="op" id="6565062">]</span><span class="builtintype" id="6565063">byte</span><span class="op" id="6565067">(</span><span class="ident" id="6565068">dictionary</span><span class="op" id="6565078">)</span><span class="op" id="6565079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565083">testFileLevelDictReset</span><span class="op" id="6565105">(</span><span class="ident" id="6565106">t</span><span class="op" id="6565107">,</span>&nbsp;<span class="ident" id="6565109">fn</span><span class="op" id="6565111">,</span>&nbsp;<span class="ident" id="6565113">DefaultCompression</span><span class="op" id="6565131">,</span>&nbsp;<span class="op" id="6565133">[</span><span class="op" id="6565134">]</span><span class="builtintype" id="6565135">byte</span><span class="op" id="6565139">(</span><span class="ident" id="6565140">dictionary</span><span class="op" id="6565150">)</span><span class="op" id="6565151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565155">if</span>&nbsp;<span class="op" id="6565158">!</span><span class="ident" id="6565159">testing</span><span class="op" id="6565166">.</span><span class="ident" id="6565167">Short</span><span class="op" id="6565172">(</span><span class="op" id="6565173">)</span>&nbsp;<span class="op" id="6565175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565180">for</span>&nbsp;<span class="ident" id="6565184">level</span>&nbsp;<span class="op" id="6565190">:=</span>&nbsp;<span class="ident" id="6565193">BestSpeed</span><span class="op" id="6565202">;</span>&nbsp;<span class="ident" id="6565204">level</span>&nbsp;<span class="op" id="6565210">&lt;=</span>&nbsp;<span class="ident" id="6565213">BestCompression</span><span class="op" id="6565228">;</span>&nbsp;<span class="ident" id="6565230">level</span><span class="op" id="6565235">++</span>&nbsp;<span class="op" id="6565238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565244">testFileLevelDictReset</span><span class="op" id="6565266">(</span><span class="ident" id="6565267">t</span><span class="op" id="6565268">,</span>&nbsp;<span class="ident" id="6565270">fn</span><span class="op" id="6565272">,</span>&nbsp;<span class="ident" id="6565274">level</span><span class="op" id="6565279">,</span>&nbsp;<span class="ident" id="6565281">nil</span><span class="op" id="6565284">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565296">}</span><br>
<span class="lineno"></span><span class="op" id="6565298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6565301">func</span>&nbsp;<span class="ident" id="6565306">TestWriterDictIsUsed</span><span class="op" id="6565326">(</span><span class="ident" id="6565327">t</span>&nbsp;<span class="op" id="6565329">*</span><span class="ident" id="6565330">testing</span><span class="op" id="6565337">.</span><span class="ident" id="6565338">T</span><span class="op" id="6565339">)</span>&nbsp;<span class="op" id="6565341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565344">var</span>&nbsp;<span class="ident" id="6565348">input</span>&nbsp;<span class="op" id="6565354">=</span>&nbsp;<span class="op" id="6565356">[</span><span class="op" id="6565357">]</span><span class="builtintype" id="6565358">byte</span><span class="op" id="6565362">(</span><span class="string" id="6565363">&#34;Lorem&nbsp;ipsum&nbsp;dolor&nbsp;sit&nbsp;amet,&nbsp;consectetur&nbsp;adipisicing&nbsp;elit,&nbsp;sed&nbsp;do&nbsp;eiusmod&nbsp;tempor&nbsp;incididunt&nbsp;ut&nbsp;labore&nbsp;et&nbsp;dolore&nbsp;magna&nbsp;aliqua.&#34;</span><span class="op" id="6565489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565492">var</span>&nbsp;<span class="ident" id="6565496">buf</span>&nbsp;<span class="ident" id="6565500">bytes</span><span class="op" id="6565505">.</span><span class="ident" id="6565506">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565514">compressor</span><span class="op" id="6565524">,</span>&nbsp;<span class="ident" id="6565526">err</span>&nbsp;<span class="op" id="6565530">:=</span>&nbsp;<span class="ident" id="6565533">NewWriterLevelDict</span><span class="op" id="6565551">(</span><span class="op" id="6565552">&amp;</span><span class="ident" id="6565553">buf</span><span class="op" id="6565556">,</span>&nbsp;<span class="ident" id="6565558">BestCompression</span><span class="op" id="6565573">,</span>&nbsp;<span class="ident" id="6565575">input</span><span class="op" id="6565580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565583">if</span>&nbsp;<span class="ident" id="6565586">err</span>&nbsp;<span class="op" id="6565590">!=</span>&nbsp;<span class="ident" id="6565593">nil</span>&nbsp;<span class="op" id="6565597">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565601">t</span><span class="op" id="6565602">.</span><span class="ident" id="6565603">Errorf</span><span class="op" id="6565609">(</span><span class="string" id="6565610">&#34;error&nbsp;in&nbsp;NewWriterLevelDict:&nbsp;%s&#34;</span><span class="op" id="6565643">,</span>&nbsp;<span class="ident" id="6565645">err</span><span class="op" id="6565648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565652">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565663">compressor</span><span class="op" id="6565673">.</span><span class="ident" id="6565674">Write</span><span class="op" id="6565679">(</span><span class="ident" id="6565680">input</span><span class="op" id="6565685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565688">compressor</span><span class="op" id="6565698">.</span><span class="ident" id="6565699">Close</span><span class="op" id="6565704">(</span><span class="op" id="6565705">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565708">const</span>&nbsp;<span class="ident" id="6565714">expectedMaxSize</span>&nbsp;<span class="op" id="6565730">=</span>&nbsp;<span class="num" id="6565732">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565736">output</span>&nbsp;<span class="op" id="6565743">:=</span>&nbsp;<span class="ident" id="6565746">buf</span><span class="op" id="6565749">.</span><span class="ident" id="6565750">Bytes</span><span class="op" id="6565755">(</span><span class="op" id="6565756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565759">if</span>&nbsp;<span class="builtinfunc" id="6565762">len</span><span class="op" id="6565765">(</span><span class="ident" id="6565766">output</span><span class="op" id="6565772">)</span>&nbsp;<span class="op" id="6565774">&gt;</span>&nbsp;<span class="ident" id="6565776">expectedMaxSize</span>&nbsp;<span class="op" id="6565792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565796">t</span><span class="op" id="6565797">.</span><span class="ident" id="6565798">Errorf</span><span class="op" id="6565804">(</span><span class="string" id="6565805">&#34;result&nbsp;too&nbsp;large&nbsp;(got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&nbsp;bytes).&nbsp;Is&nbsp;the&nbsp;dictionary&nbsp;being&nbsp;used?&#34;</span><span class="op" id="6565881">,</span>&nbsp;<span class="builtinfunc" id="6565883">len</span><span class="op" id="6565886">(</span><span class="ident" id="6565887">output</span><span class="op" id="6565893">)</span><span class="op" id="6565894">,</span>&nbsp;<span class="ident" id="6565896">expectedMaxSize</span><span class="op" id="6565911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565914">}</span><br>
<span class="lineno">205</span><span class="op" id="6565916">}</span>
</div>
</body>
</html>
