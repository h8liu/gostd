<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2657461">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2657516">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2657570">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2657621">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2657691">package</span>&nbsp;<span class="ident" id="2657699">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2657708">import</span>&nbsp;<span class="op" id="2657715">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2657718">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2657729">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2657744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2657747">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2657888">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2657951">func</span>&nbsp;<span class="ident" id="2657956">explode</span><span class="op" id="2657963">(</span><span class="ident" id="2657964">s</span>&nbsp;<span class="builtintype" id="2657966">string</span><span class="op" id="2657972">,</span>&nbsp;<span class="ident" id="2657974">n</span>&nbsp;<span class="builtintype" id="2657976">int</span><span class="op" id="2657979">)</span>&nbsp;<span class="op" id="2657981">[</span><span class="op" id="2657982">]</span><span class="builtintype" id="2657983">string</span>&nbsp;<span class="op" id="2657990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657993">if</span>&nbsp;<span class="ident" id="2657996">n</span>&nbsp;<span class="op" id="2657998">==</span>&nbsp;<span class="num" id="2658001">0</span>&nbsp;<span class="op" id="2658003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658007">return</span>&nbsp;<span class="ident" id="2658014">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658022">l</span>&nbsp;<span class="op" id="2658024">:=</span>&nbsp;<span class="ident" id="2658027">utf8</span><span class="op" id="2658031">.</span><span class="ident" id="2658032">RuneCountInString</span><span class="op" id="2658049">(</span><span class="ident" id="2658050">s</span><span class="op" id="2658051">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658054">if</span>&nbsp;<span class="ident" id="2658057">n</span>&nbsp;<span class="op" id="2658059">&lt;=</span>&nbsp;<span class="num" id="2658062">0</span>&nbsp;<span class="op" id="2658064">||</span>&nbsp;<span class="ident" id="2658067">n</span>&nbsp;<span class="op" id="2658069">&gt;</span>&nbsp;<span class="ident" id="2658071">l</span>&nbsp;<span class="op" id="2658073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658077">n</span>&nbsp;<span class="op" id="2658079">=</span>&nbsp;<span class="ident" id="2658081">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658087">a</span>&nbsp;<span class="op" id="2658089">:=</span>&nbsp;<span class="builtinfunc" id="2658092">make</span><span class="op" id="2658096">(</span><span class="op" id="2658097">[</span><span class="op" id="2658098">]</span><span class="builtintype" id="2658099">string</span><span class="op" id="2658105">,</span>&nbsp;<span class="ident" id="2658107">n</span><span class="op" id="2658108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658111">var</span>&nbsp;<span class="ident" id="2658115">size</span>&nbsp;<span class="builtintype" id="2658120">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658125">var</span>&nbsp;<span class="ident" id="2658129">ch</span>&nbsp;<span class="builtintype" id="2658132">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658138">i</span><span class="op" id="2658139">,</span>&nbsp;<span class="ident" id="2658141">cur</span>&nbsp;<span class="op" id="2658145">:=</span>&nbsp;<span class="num" id="2658148">0</span><span class="op" id="2658149">,</span>&nbsp;<span class="num" id="2658151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658154">for</span>&nbsp;<span class="op" id="2658158">;</span>&nbsp;<span class="ident" id="2658160">i</span><span class="op" id="2658161">+</span><span class="num" id="2658162">1</span>&nbsp;<span class="op" id="2658164">&lt;</span>&nbsp;<span class="ident" id="2658166">n</span><span class="op" id="2658167">;</span>&nbsp;<span class="ident" id="2658169">i</span><span class="op" id="2658170">++</span>&nbsp;<span class="op" id="2658173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658177">ch</span><span class="op" id="2658179">,</span>&nbsp;<span class="ident" id="2658181">size</span>&nbsp;<span class="op" id="2658186">=</span>&nbsp;<span class="ident" id="2658188">utf8</span><span class="op" id="2658192">.</span><span class="ident" id="2658193">DecodeRuneInString</span><span class="op" id="2658211">(</span><span class="ident" id="2658212">s</span><span class="op" id="2658213">[</span><span class="ident" id="2658214">cur</span><span class="op" id="2658217">:</span><span class="op" id="2658218">]</span><span class="op" id="2658219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658223">if</span>&nbsp;<span class="ident" id="2658226">ch</span>&nbsp;<span class="op" id="2658229">==</span>&nbsp;<span class="ident" id="2658232">utf8</span><span class="op" id="2658236">.</span><span class="ident" id="2658237">RuneError</span>&nbsp;<span class="op" id="2658247">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658252">a</span><span class="op" id="2658253">[</span><span class="ident" id="2658254">i</span><span class="op" id="2658255">]</span>&nbsp;<span class="op" id="2658257">=</span>&nbsp;<span class="builtintype" id="2658259">string</span><span class="op" id="2658265">(</span><span class="ident" id="2658266">utf8</span><span class="op" id="2658270">.</span><span class="ident" id="2658271">RuneError</span><span class="op" id="2658280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658284">}</span>&nbsp;<span class="keyword" id="2658286">else</span>&nbsp;<span class="op" id="2658291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658296">a</span><span class="op" id="2658297">[</span><span class="ident" id="2658298">i</span><span class="op" id="2658299">]</span>&nbsp;<span class="op" id="2658301">=</span>&nbsp;<span class="ident" id="2658303">s</span><span class="op" id="2658304">[</span><span class="ident" id="2658305">cur</span>&nbsp;<span class="op" id="2658309">:</span>&nbsp;<span class="ident" id="2658311">cur</span><span class="op" id="2658314">+</span><span class="ident" id="2658315">size</span><span class="op" id="2658319">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658327">cur</span>&nbsp;<span class="op" id="2658331">+=</span>&nbsp;<span class="ident" id="2658334">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2658343">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658377">if</span>&nbsp;<span class="ident" id="2658380">cur</span>&nbsp;<span class="op" id="2658384">&lt;</span>&nbsp;<span class="builtinfunc" id="2658386">len</span><span class="op" id="2658389">(</span><span class="ident" id="2658390">s</span><span class="op" id="2658391">)</span>&nbsp;<span class="op" id="2658393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658397">a</span><span class="op" id="2658398">[</span><span class="ident" id="2658399">i</span><span class="op" id="2658400">]</span>&nbsp;<span class="op" id="2658402">=</span>&nbsp;<span class="ident" id="2658404">s</span><span class="op" id="2658405">[</span><span class="ident" id="2658406">cur</span><span class="op" id="2658409">:</span><span class="op" id="2658410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658413">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658416">return</span>&nbsp;<span class="ident" id="2658423">a</span><br>
<span class="lineno"></span><span class="op" id="2658425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2658428">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2658487">const</span>&nbsp;<span class="ident" id="2658493">primeRK</span>&nbsp;<span class="op" id="2658501">=</span>&nbsp;<span class="num" id="2658503">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2658513">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2658576">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2658619">func</span>&nbsp;<span class="ident" id="2658624">hashStr</span><span class="op" id="2658631">(</span><span class="ident" id="2658632">sep</span>&nbsp;<span class="builtintype" id="2658636">string</span><span class="op" id="2658642">)</span>&nbsp;<span class="op" id="2658644">(</span><span class="builtintype" id="2658645">uint32</span><span class="op" id="2658651">,</span>&nbsp;<span class="builtintype" id="2658653">uint32</span><span class="op" id="2658659">)</span>&nbsp;<span class="op" id="2658661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658664">hash</span>&nbsp;<span class="op" id="2658669">:=</span>&nbsp;<span class="builtintype" id="2658672">uint32</span><span class="op" id="2658678">(</span><span class="num" id="2658679">0</span><span class="op" id="2658680">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658683">for</span>&nbsp;<span class="ident" id="2658687">i</span>&nbsp;<span class="op" id="2658689">:=</span>&nbsp;<span class="num" id="2658692">0</span><span class="op" id="2658693">;</span>&nbsp;<span class="ident" id="2658695">i</span>&nbsp;<span class="op" id="2658697">&lt;</span>&nbsp;<span class="builtinfunc" id="2658699">len</span><span class="op" id="2658702">(</span><span class="ident" id="2658703">sep</span><span class="op" id="2658706">)</span><span class="op" id="2658707">;</span>&nbsp;<span class="ident" id="2658709">i</span><span class="op" id="2658710">++</span>&nbsp;<span class="op" id="2658713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658717">hash</span>&nbsp;<span class="op" id="2658722">=</span>&nbsp;<span class="ident" id="2658724">hash</span><span class="op" id="2658728">*</span><span class="ident" id="2658729">primeRK</span>&nbsp;<span class="op" id="2658737">+</span>&nbsp;<span class="builtintype" id="2658739">uint32</span><span class="op" id="2658745">(</span><span class="ident" id="2658746">sep</span><span class="op" id="2658749">[</span><span class="ident" id="2658750">i</span><span class="op" id="2658751">]</span><span class="op" id="2658752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658758">var</span>&nbsp;<span class="ident" id="2658762">pow</span><span class="op" id="2658765">,</span>&nbsp;<span class="ident" id="2658767">sq</span>&nbsp;<span class="builtintype" id="2658770">uint32</span>&nbsp;<span class="op" id="2658777">=</span>&nbsp;<span class="num" id="2658779">1</span><span class="op" id="2658780">,</span>&nbsp;<span class="ident" id="2658782">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658791">for</span>&nbsp;<span class="ident" id="2658795">i</span>&nbsp;<span class="op" id="2658797">:=</span>&nbsp;<span class="builtinfunc" id="2658800">len</span><span class="op" id="2658803">(</span><span class="ident" id="2658804">sep</span><span class="op" id="2658807">)</span><span class="op" id="2658808">;</span>&nbsp;<span class="ident" id="2658810">i</span>&nbsp;<span class="op" id="2658812">&gt;</span>&nbsp;<span class="num" id="2658814">0</span><span class="op" id="2658815">;</span>&nbsp;<span class="ident" id="2658817">i</span>&nbsp;<span class="op" id="2658819">&gt;&gt;=</span>&nbsp;<span class="num" id="2658823">1</span>&nbsp;<span class="op" id="2658825">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658829">if</span>&nbsp;<span class="ident" id="2658832">i</span><span class="op" id="2658833">&amp;</span><span class="num" id="2658834">1</span>&nbsp;<span class="op" id="2658836">!=</span>&nbsp;<span class="num" id="2658839">0</span>&nbsp;<span class="op" id="2658841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658846">pow</span>&nbsp;<span class="op" id="2658850">*=</span>&nbsp;<span class="ident" id="2658853">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2658862">sq</span>&nbsp;<span class="op" id="2658865">*=</span>&nbsp;<span class="ident" id="2658868">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2658872">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2658875">return</span>&nbsp;<span class="ident" id="2658882">hash</span><span class="op" id="2658886">,</span>&nbsp;<span class="ident" id="2658888">pow</span><br>
<span class="lineno"></span><span class="op" id="2658892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2658895">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2658956">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2659026">func</span>&nbsp;<span class="ident" id="2659031">hashStrRev</span><span class="op" id="2659041">(</span><span class="ident" id="2659042">sep</span>&nbsp;<span class="builtintype" id="2659046">string</span><span class="op" id="2659052">)</span>&nbsp;<span class="op" id="2659054">(</span><span class="builtintype" id="2659055">uint32</span><span class="op" id="2659061">,</span>&nbsp;<span class="builtintype" id="2659063">uint32</span><span class="op" id="2659069">)</span>&nbsp;<span class="op" id="2659071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659074">hash</span>&nbsp;<span class="op" id="2659079">:=</span>&nbsp;<span class="builtintype" id="2659082">uint32</span><span class="op" id="2659088">(</span><span class="num" id="2659089">0</span><span class="op" id="2659090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659093">for</span>&nbsp;<span class="ident" id="2659097">i</span>&nbsp;<span class="op" id="2659099">:=</span>&nbsp;<span class="builtinfunc" id="2659102">len</span><span class="op" id="2659105">(</span><span class="ident" id="2659106">sep</span><span class="op" id="2659109">)</span>&nbsp;<span class="op" id="2659111">-</span>&nbsp;<span class="num" id="2659113">1</span><span class="op" id="2659114">;</span>&nbsp;<span class="ident" id="2659116">i</span>&nbsp;<span class="op" id="2659118">&gt;=</span>&nbsp;<span class="num" id="2659121">0</span><span class="op" id="2659122">;</span>&nbsp;<span class="ident" id="2659124">i</span><span class="op" id="2659125">--</span>&nbsp;<span class="op" id="2659128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659132">hash</span>&nbsp;<span class="op" id="2659137">=</span>&nbsp;<span class="ident" id="2659139">hash</span><span class="op" id="2659143">*</span><span class="ident" id="2659144">primeRK</span>&nbsp;<span class="op" id="2659152">+</span>&nbsp;<span class="builtintype" id="2659154">uint32</span><span class="op" id="2659160">(</span><span class="ident" id="2659161">sep</span><span class="op" id="2659164">[</span><span class="ident" id="2659165">i</span><span class="op" id="2659166">]</span><span class="op" id="2659167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659170">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659173">var</span>&nbsp;<span class="ident" id="2659177">pow</span><span class="op" id="2659180">,</span>&nbsp;<span class="ident" id="2659182">sq</span>&nbsp;<span class="builtintype" id="2659185">uint32</span>&nbsp;<span class="op" id="2659192">=</span>&nbsp;<span class="num" id="2659194">1</span><span class="op" id="2659195">,</span>&nbsp;<span class="ident" id="2659197">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659206">for</span>&nbsp;<span class="ident" id="2659210">i</span>&nbsp;<span class="op" id="2659212">:=</span>&nbsp;<span class="builtinfunc" id="2659215">len</span><span class="op" id="2659218">(</span><span class="ident" id="2659219">sep</span><span class="op" id="2659222">)</span><span class="op" id="2659223">;</span>&nbsp;<span class="ident" id="2659225">i</span>&nbsp;<span class="op" id="2659227">&gt;</span>&nbsp;<span class="num" id="2659229">0</span><span class="op" id="2659230">;</span>&nbsp;<span class="ident" id="2659232">i</span>&nbsp;<span class="op" id="2659234">&gt;&gt;=</span>&nbsp;<span class="num" id="2659238">1</span>&nbsp;<span class="op" id="2659240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659244">if</span>&nbsp;<span class="ident" id="2659247">i</span><span class="op" id="2659248">&amp;</span><span class="num" id="2659249">1</span>&nbsp;<span class="op" id="2659251">!=</span>&nbsp;<span class="num" id="2659254">0</span>&nbsp;<span class="op" id="2659256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659261">pow</span>&nbsp;<span class="op" id="2659265">*=</span>&nbsp;<span class="ident" id="2659268">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659273">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659277">sq</span>&nbsp;<span class="op" id="2659280">*=</span>&nbsp;<span class="ident" id="2659283">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659290">return</span>&nbsp;<span class="ident" id="2659297">hash</span><span class="op" id="2659301">,</span>&nbsp;<span class="ident" id="2659303">pow</span><br>
<span class="lineno"></span><span class="op" id="2659307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2659310">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2659379">func</span>&nbsp;<span class="ident" id="2659384">Count</span><span class="op" id="2659389">(</span><span class="ident" id="2659390">s</span><span class="op" id="2659391">,</span>&nbsp;<span class="ident" id="2659393">sep</span>&nbsp;<span class="builtintype" id="2659397">string</span><span class="op" id="2659403">)</span>&nbsp;<span class="builtintype" id="2659405">int</span>&nbsp;<span class="op" id="2659409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659412">n</span>&nbsp;<span class="op" id="2659414">:=</span>&nbsp;<span class="num" id="2659417">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2659420">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659438">switch</span>&nbsp;<span class="op" id="2659445">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659448">case</span>&nbsp;<span class="builtinfunc" id="2659453">len</span><span class="op" id="2659456">(</span><span class="ident" id="2659457">sep</span><span class="op" id="2659460">)</span>&nbsp;<span class="op" id="2659462">==</span>&nbsp;<span class="num" id="2659465">0</span><span class="op" id="2659466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659470">return</span>&nbsp;<span class="ident" id="2659477">utf8</span><span class="op" id="2659481">.</span><span class="ident" id="2659482">RuneCountInString</span><span class="op" id="2659499">(</span><span class="ident" id="2659500">s</span><span class="op" id="2659501">)</span>&nbsp;<span class="op" id="2659503">+</span>&nbsp;<span class="num" id="2659505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659508">case</span>&nbsp;<span class="builtinfunc" id="2659513">len</span><span class="op" id="2659516">(</span><span class="ident" id="2659517">sep</span><span class="op" id="2659520">)</span>&nbsp;<span class="op" id="2659522">==</span>&nbsp;<span class="num" id="2659525">1</span><span class="op" id="2659526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2659530">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659566">c</span>&nbsp;<span class="op" id="2659568">:=</span>&nbsp;<span class="ident" id="2659571">sep</span><span class="op" id="2659574">[</span><span class="num" id="2659575">0</span><span class="op" id="2659576">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659580">for</span>&nbsp;<span class="ident" id="2659584">i</span>&nbsp;<span class="op" id="2659586">:=</span>&nbsp;<span class="num" id="2659589">0</span><span class="op" id="2659590">;</span>&nbsp;<span class="ident" id="2659592">i</span>&nbsp;<span class="op" id="2659594">&lt;</span>&nbsp;<span class="builtinfunc" id="2659596">len</span><span class="op" id="2659599">(</span><span class="ident" id="2659600">s</span><span class="op" id="2659601">)</span><span class="op" id="2659602">;</span>&nbsp;<span class="ident" id="2659604">i</span><span class="op" id="2659605">++</span>&nbsp;<span class="op" id="2659608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659613">if</span>&nbsp;<span class="ident" id="2659616">s</span><span class="op" id="2659617">[</span><span class="ident" id="2659618">i</span><span class="op" id="2659619">]</span>&nbsp;<span class="op" id="2659621">==</span>&nbsp;<span class="ident" id="2659624">c</span>&nbsp;<span class="op" id="2659626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659632">n</span><span class="op" id="2659633">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659643">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659647">return</span>&nbsp;<span class="ident" id="2659654">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659657">case</span>&nbsp;<span class="builtinfunc" id="2659662">len</span><span class="op" id="2659665">(</span><span class="ident" id="2659666">sep</span><span class="op" id="2659669">)</span>&nbsp;<span class="op" id="2659671">&gt;</span>&nbsp;<span class="builtinfunc" id="2659673">len</span><span class="op" id="2659676">(</span><span class="ident" id="2659677">s</span><span class="op" id="2659678">)</span><span class="op" id="2659679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659683">return</span>&nbsp;<span class="num" id="2659690">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659693">case</span>&nbsp;<span class="builtinfunc" id="2659698">len</span><span class="op" id="2659701">(</span><span class="ident" id="2659702">sep</span><span class="op" id="2659705">)</span>&nbsp;<span class="op" id="2659707">==</span>&nbsp;<span class="builtinfunc" id="2659710">len</span><span class="op" id="2659713">(</span><span class="ident" id="2659714">s</span><span class="op" id="2659715">)</span><span class="op" id="2659716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659720">if</span>&nbsp;<span class="ident" id="2659723">sep</span>&nbsp;<span class="op" id="2659727">==</span>&nbsp;<span class="ident" id="2659730">s</span>&nbsp;<span class="op" id="2659732">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659737">return</span>&nbsp;<span class="num" id="2659744">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659752">return</span>&nbsp;<span class="num" id="2659759">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2659765">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659787">hashsep</span><span class="op" id="2659794">,</span>&nbsp;<span class="ident" id="2659796">pow</span>&nbsp;<span class="op" id="2659800">:=</span>&nbsp;<span class="ident" id="2659803">hashStr</span><span class="op" id="2659810">(</span><span class="ident" id="2659811">sep</span><span class="op" id="2659814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659817">h</span>&nbsp;<span class="op" id="2659819">:=</span>&nbsp;<span class="builtintype" id="2659822">uint32</span><span class="op" id="2659828">(</span><span class="num" id="2659829">0</span><span class="op" id="2659830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659833">for</span>&nbsp;<span class="ident" id="2659837">i</span>&nbsp;<span class="op" id="2659839">:=</span>&nbsp;<span class="num" id="2659842">0</span><span class="op" id="2659843">;</span>&nbsp;<span class="ident" id="2659845">i</span>&nbsp;<span class="op" id="2659847">&lt;</span>&nbsp;<span class="builtinfunc" id="2659849">len</span><span class="op" id="2659852">(</span><span class="ident" id="2659853">sep</span><span class="op" id="2659856">)</span><span class="op" id="2659857">;</span>&nbsp;<span class="ident" id="2659859">i</span><span class="op" id="2659860">++</span>&nbsp;<span class="op" id="2659863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659867">h</span>&nbsp;<span class="op" id="2659869">=</span>&nbsp;<span class="ident" id="2659871">h</span><span class="op" id="2659872">*</span><span class="ident" id="2659873">primeRK</span>&nbsp;<span class="op" id="2659881">+</span>&nbsp;<span class="builtintype" id="2659883">uint32</span><span class="op" id="2659889">(</span><span class="ident" id="2659890">s</span><span class="op" id="2659891">[</span><span class="ident" id="2659892">i</span><span class="op" id="2659893">]</span><span class="op" id="2659894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659897">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659900">lastmatch</span>&nbsp;<span class="op" id="2659910">:=</span>&nbsp;<span class="num" id="2659913">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659916">if</span>&nbsp;<span class="ident" id="2659919">h</span>&nbsp;<span class="op" id="2659921">==</span>&nbsp;<span class="ident" id="2659924">hashsep</span>&nbsp;<span class="op" id="2659932">&amp;&amp;</span>&nbsp;<span class="ident" id="2659935">s</span><span class="op" id="2659936">[</span><span class="op" id="2659937">:</span><span class="builtinfunc" id="2659938">len</span><span class="op" id="2659941">(</span><span class="ident" id="2659942">sep</span><span class="op" id="2659945">)</span><span class="op" id="2659946">]</span>&nbsp;<span class="op" id="2659948">==</span>&nbsp;<span class="ident" id="2659951">sep</span>&nbsp;<span class="op" id="2659955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659959">n</span><span class="op" id="2659960">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2659965">lastmatch</span>&nbsp;<span class="op" id="2659975">=</span>&nbsp;<span class="builtinfunc" id="2659977">len</span><span class="op" id="2659980">(</span><span class="ident" id="2659981">sep</span><span class="op" id="2659984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2659987">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2659990">for</span>&nbsp;<span class="ident" id="2659994">i</span>&nbsp;<span class="op" id="2659996">:=</span>&nbsp;<span class="builtinfunc" id="2659999">len</span><span class="op" id="2660002">(</span><span class="ident" id="2660003">sep</span><span class="op" id="2660006">)</span><span class="op" id="2660007">;</span>&nbsp;<span class="ident" id="2660009">i</span>&nbsp;<span class="op" id="2660011">&lt;</span>&nbsp;<span class="builtinfunc" id="2660013">len</span><span class="op" id="2660016">(</span><span class="ident" id="2660017">s</span><span class="op" id="2660018">)</span><span class="op" id="2660019">;</span>&nbsp;<span class="op" id="2660021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660025">h</span>&nbsp;<span class="op" id="2660027">*=</span>&nbsp;<span class="ident" id="2660030">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660040">h</span>&nbsp;<span class="op" id="2660042">+=</span>&nbsp;<span class="builtintype" id="2660045">uint32</span><span class="op" id="2660051">(</span><span class="ident" id="2660052">s</span><span class="op" id="2660053">[</span><span class="ident" id="2660054">i</span><span class="op" id="2660055">]</span><span class="op" id="2660056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660060">h</span>&nbsp;<span class="op" id="2660062">-=</span>&nbsp;<span class="ident" id="2660065">pow</span>&nbsp;<span class="op" id="2660069">*</span>&nbsp;<span class="builtintype" id="2660071">uint32</span><span class="op" id="2660077">(</span><span class="ident" id="2660078">s</span><span class="op" id="2660079">[</span><span class="ident" id="2660080">i</span><span class="op" id="2660081">-</span><span class="builtinfunc" id="2660082">len</span><span class="op" id="2660085">(</span><span class="ident" id="2660086">sep</span><span class="op" id="2660089">)</span><span class="op" id="2660090">]</span><span class="op" id="2660091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660095">i</span><span class="op" id="2660096">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660101">if</span>&nbsp;<span class="ident" id="2660104">h</span>&nbsp;<span class="op" id="2660106">==</span>&nbsp;<span class="ident" id="2660109">hashsep</span>&nbsp;<span class="op" id="2660117">&amp;&amp;</span>&nbsp;<span class="ident" id="2660120">lastmatch</span>&nbsp;<span class="op" id="2660130">&lt;=</span>&nbsp;<span class="ident" id="2660133">i</span><span class="op" id="2660134">-</span><span class="builtinfunc" id="2660135">len</span><span class="op" id="2660138">(</span><span class="ident" id="2660139">sep</span><span class="op" id="2660142">)</span>&nbsp;<span class="op" id="2660144">&amp;&amp;</span>&nbsp;<span class="ident" id="2660147">s</span><span class="op" id="2660148">[</span><span class="ident" id="2660149">i</span><span class="op" id="2660150">-</span><span class="builtinfunc" id="2660151">len</span><span class="op" id="2660154">(</span><span class="ident" id="2660155">sep</span><span class="op" id="2660158">)</span><span class="op" id="2660159">:</span><span class="ident" id="2660160">i</span><span class="op" id="2660161">]</span>&nbsp;<span class="op" id="2660163">==</span>&nbsp;<span class="ident" id="2660166">sep</span>&nbsp;<span class="op" id="2660170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660175">n</span><span class="op" id="2660176">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660182">lastmatch</span>&nbsp;<span class="op" id="2660192">=</span>&nbsp;<span class="ident" id="2660194">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2660198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2660201">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660204">return</span>&nbsp;<span class="ident" id="2660211">n</span><br>
<span class="lineno"></span><span class="op" id="2660213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2660216">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2660264">func</span>&nbsp;<span class="ident" id="2660269">Contains</span><span class="op" id="2660277">(</span><span class="ident" id="2660278">s</span><span class="op" id="2660279">,</span>&nbsp;<span class="ident" id="2660281">substr</span>&nbsp;<span class="builtintype" id="2660288">string</span><span class="op" id="2660294">)</span>&nbsp;<span class="builtintype" id="2660296">bool</span>&nbsp;<span class="op" id="2660301">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660304">return</span>&nbsp;<span class="ident" id="2660311">Index</span><span class="op" id="2660316">(</span><span class="ident" id="2660317">s</span><span class="op" id="2660318">,</span>&nbsp;<span class="ident" id="2660320">substr</span><span class="op" id="2660326">)</span>&nbsp;<span class="op" id="2660328">&gt;=</span>&nbsp;<span class="num" id="2660331">0</span><br>
<span class="lineno"></span><span class="op" id="2660333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2660336">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2660414">func</span>&nbsp;<span class="ident" id="2660419">ContainsAny</span><span class="op" id="2660430">(</span><span class="ident" id="2660431">s</span><span class="op" id="2660432">,</span>&nbsp;<span class="ident" id="2660434">chars</span>&nbsp;<span class="builtintype" id="2660440">string</span><span class="op" id="2660446">)</span>&nbsp;<span class="builtintype" id="2660448">bool</span>&nbsp;<span class="op" id="2660453">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660456">return</span>&nbsp;<span class="ident" id="2660463">IndexAny</span><span class="op" id="2660471">(</span><span class="ident" id="2660472">s</span><span class="op" id="2660473">,</span>&nbsp;<span class="ident" id="2660475">chars</span><span class="op" id="2660480">)</span>&nbsp;<span class="op" id="2660482">&gt;=</span>&nbsp;<span class="num" id="2660485">0</span><br>
<span class="lineno"></span><span class="op" id="2660487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2660490">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2660560">func</span>&nbsp;<span class="ident" id="2660565">ContainsRune</span><span class="op" id="2660577">(</span><span class="ident" id="2660578">s</span>&nbsp;<span class="builtintype" id="2660580">string</span><span class="op" id="2660586">,</span>&nbsp;<span class="ident" id="2660588">r</span>&nbsp;<span class="builtintype" id="2660590">rune</span><span class="op" id="2660594">)</span>&nbsp;<span class="builtintype" id="2660596">bool</span>&nbsp;<span class="op" id="2660601">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660604">return</span>&nbsp;<span class="ident" id="2660611">IndexRune</span><span class="op" id="2660620">(</span><span class="ident" id="2660621">s</span><span class="op" id="2660622">,</span>&nbsp;<span class="ident" id="2660624">r</span><span class="op" id="2660625">)</span>&nbsp;<span class="op" id="2660627">&gt;=</span>&nbsp;<span class="num" id="2660630">0</span><br>
<span class="lineno"></span><span class="op" id="2660632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2660635">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2660731">func</span>&nbsp;<span class="ident" id="2660736">Index</span><span class="op" id="2660741">(</span><span class="ident" id="2660742">s</span><span class="op" id="2660743">,</span>&nbsp;<span class="ident" id="2660745">sep</span>&nbsp;<span class="builtintype" id="2660749">string</span><span class="op" id="2660755">)</span>&nbsp;<span class="builtintype" id="2660757">int</span>&nbsp;<span class="op" id="2660761">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660764">n</span>&nbsp;<span class="op" id="2660766">:=</span>&nbsp;<span class="builtinfunc" id="2660769">len</span><span class="op" id="2660772">(</span><span class="ident" id="2660773">sep</span><span class="op" id="2660776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660779">switch</span>&nbsp;<span class="op" id="2660786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660789">case</span>&nbsp;<span class="ident" id="2660794">n</span>&nbsp;<span class="op" id="2660796">==</span>&nbsp;<span class="num" id="2660799">0</span><span class="op" id="2660800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660804">return</span>&nbsp;<span class="num" id="2660811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660814">case</span>&nbsp;<span class="ident" id="2660819">n</span>&nbsp;<span class="op" id="2660821">==</span>&nbsp;<span class="num" id="2660824">1</span><span class="op" id="2660825">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660829">return</span>&nbsp;<span class="ident" id="2660836">IndexByte</span><span class="op" id="2660845">(</span><span class="ident" id="2660846">s</span><span class="op" id="2660847">,</span>&nbsp;<span class="ident" id="2660849">sep</span><span class="op" id="2660852">[</span><span class="num" id="2660853">0</span><span class="op" id="2660854">]</span><span class="op" id="2660855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660858">case</span>&nbsp;<span class="ident" id="2660863">n</span>&nbsp;<span class="op" id="2660865">==</span>&nbsp;<span class="builtinfunc" id="2660868">len</span><span class="op" id="2660871">(</span><span class="ident" id="2660872">s</span><span class="op" id="2660873">)</span><span class="op" id="2660874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660878">if</span>&nbsp;<span class="ident" id="2660881">sep</span>&nbsp;<span class="op" id="2660885">==</span>&nbsp;<span class="ident" id="2660888">s</span>&nbsp;<span class="op" id="2660890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660895">return</span>&nbsp;<span class="num" id="2660902">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2660906">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660910">return</span>&nbsp;<span class="op" id="2660917">-</span><span class="num" id="2660918">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660921">case</span>&nbsp;<span class="ident" id="2660926">n</span>&nbsp;<span class="op" id="2660928">&gt;</span>&nbsp;<span class="builtinfunc" id="2660930">len</span><span class="op" id="2660933">(</span><span class="ident" id="2660934">s</span><span class="op" id="2660935">)</span><span class="op" id="2660936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2660940">return</span>&nbsp;<span class="op" id="2660947">-</span><span class="num" id="2660948">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2660951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2660954">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2660976">hashsep</span><span class="op" id="2660983">,</span>&nbsp;<span class="ident" id="2660985">pow</span>&nbsp;<span class="op" id="2660989">:=</span>&nbsp;<span class="ident" id="2660992">hashStr</span><span class="op" id="2660999">(</span><span class="ident" id="2661000">sep</span><span class="op" id="2661003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661006">var</span>&nbsp;<span class="ident" id="2661010">h</span>&nbsp;<span class="builtintype" id="2661012">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661020">for</span>&nbsp;<span class="ident" id="2661024">i</span>&nbsp;<span class="op" id="2661026">:=</span>&nbsp;<span class="num" id="2661029">0</span><span class="op" id="2661030">;</span>&nbsp;<span class="ident" id="2661032">i</span>&nbsp;<span class="op" id="2661034">&lt;</span>&nbsp;<span class="ident" id="2661036">n</span><span class="op" id="2661037">;</span>&nbsp;<span class="ident" id="2661039">i</span><span class="op" id="2661040">++</span>&nbsp;<span class="op" id="2661043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661047">h</span>&nbsp;<span class="op" id="2661049">=</span>&nbsp;<span class="ident" id="2661051">h</span><span class="op" id="2661052">*</span><span class="ident" id="2661053">primeRK</span>&nbsp;<span class="op" id="2661061">+</span>&nbsp;<span class="builtintype" id="2661063">uint32</span><span class="op" id="2661069">(</span><span class="ident" id="2661070">s</span><span class="op" id="2661071">[</span><span class="ident" id="2661072">i</span><span class="op" id="2661073">]</span><span class="op" id="2661074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661077">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661080">if</span>&nbsp;<span class="ident" id="2661083">h</span>&nbsp;<span class="op" id="2661085">==</span>&nbsp;<span class="ident" id="2661088">hashsep</span>&nbsp;<span class="op" id="2661096">&amp;&amp;</span>&nbsp;<span class="ident" id="2661099">s</span><span class="op" id="2661100">[</span><span class="op" id="2661101">:</span><span class="ident" id="2661102">n</span><span class="op" id="2661103">]</span>&nbsp;<span class="op" id="2661105">==</span>&nbsp;<span class="ident" id="2661108">sep</span>&nbsp;<span class="op" id="2661112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661116">return</span>&nbsp;<span class="num" id="2661123">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661129">for</span>&nbsp;<span class="ident" id="2661133">i</span>&nbsp;<span class="op" id="2661135">:=</span>&nbsp;<span class="ident" id="2661138">n</span><span class="op" id="2661139">;</span>&nbsp;<span class="ident" id="2661141">i</span>&nbsp;<span class="op" id="2661143">&lt;</span>&nbsp;<span class="builtinfunc" id="2661145">len</span><span class="op" id="2661148">(</span><span class="ident" id="2661149">s</span><span class="op" id="2661150">)</span><span class="op" id="2661151">;</span>&nbsp;<span class="op" id="2661153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661157">h</span>&nbsp;<span class="op" id="2661159">*=</span>&nbsp;<span class="ident" id="2661162">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661172">h</span>&nbsp;<span class="op" id="2661174">+=</span>&nbsp;<span class="builtintype" id="2661177">uint32</span><span class="op" id="2661183">(</span><span class="ident" id="2661184">s</span><span class="op" id="2661185">[</span><span class="ident" id="2661186">i</span><span class="op" id="2661187">]</span><span class="op" id="2661188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661192">h</span>&nbsp;<span class="op" id="2661194">-=</span>&nbsp;<span class="ident" id="2661197">pow</span>&nbsp;<span class="op" id="2661201">*</span>&nbsp;<span class="builtintype" id="2661203">uint32</span><span class="op" id="2661209">(</span><span class="ident" id="2661210">s</span><span class="op" id="2661211">[</span><span class="ident" id="2661212">i</span><span class="op" id="2661213">-</span><span class="ident" id="2661214">n</span><span class="op" id="2661215">]</span><span class="op" id="2661216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661220">i</span><span class="op" id="2661221">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661226">if</span>&nbsp;<span class="ident" id="2661229">h</span>&nbsp;<span class="op" id="2661231">==</span>&nbsp;<span class="ident" id="2661234">hashsep</span>&nbsp;<span class="op" id="2661242">&amp;&amp;</span>&nbsp;<span class="ident" id="2661245">s</span><span class="op" id="2661246">[</span><span class="ident" id="2661247">i</span><span class="op" id="2661248">-</span><span class="ident" id="2661249">n</span><span class="op" id="2661250">:</span><span class="ident" id="2661251">i</span><span class="op" id="2661252">]</span>&nbsp;<span class="op" id="2661254">==</span>&nbsp;<span class="ident" id="2661257">sep</span>&nbsp;<span class="op" id="2661261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661266">return</span>&nbsp;<span class="ident" id="2661273">i</span>&nbsp;<span class="op" id="2661275">-</span>&nbsp;<span class="ident" id="2661277">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661287">return</span>&nbsp;<span class="op" id="2661294">-</span><span class="num" id="2661295">1</span><br>
<span class="lineno"></span><span class="op" id="2661297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2661300">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2661399">func</span>&nbsp;<span class="ident" id="2661404">LastIndex</span><span class="op" id="2661413">(</span><span class="ident" id="2661414">s</span><span class="op" id="2661415">,</span>&nbsp;<span class="ident" id="2661417">sep</span>&nbsp;<span class="builtintype" id="2661421">string</span><span class="op" id="2661427">)</span>&nbsp;<span class="builtintype" id="2661429">int</span>&nbsp;<span class="op" id="2661433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661436">n</span>&nbsp;<span class="op" id="2661438">:=</span>&nbsp;<span class="builtinfunc" id="2661441">len</span><span class="op" id="2661444">(</span><span class="ident" id="2661445">sep</span><span class="op" id="2661448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661451">switch</span>&nbsp;<span class="op" id="2661458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661461">case</span>&nbsp;<span class="ident" id="2661466">n</span>&nbsp;<span class="op" id="2661468">==</span>&nbsp;<span class="num" id="2661471">0</span><span class="op" id="2661472">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661476">return</span>&nbsp;<span class="builtinfunc" id="2661483">len</span><span class="op" id="2661486">(</span><span class="ident" id="2661487">s</span><span class="op" id="2661488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661491">case</span>&nbsp;<span class="ident" id="2661496">n</span>&nbsp;<span class="op" id="2661498">==</span>&nbsp;<span class="num" id="2661501">1</span><span class="op" id="2661502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2661506">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661542">c</span>&nbsp;<span class="op" id="2661544">:=</span>&nbsp;<span class="ident" id="2661547">sep</span><span class="op" id="2661550">[</span><span class="num" id="2661551">0</span><span class="op" id="2661552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661556">for</span>&nbsp;<span class="ident" id="2661560">i</span>&nbsp;<span class="op" id="2661562">:=</span>&nbsp;<span class="builtinfunc" id="2661565">len</span><span class="op" id="2661568">(</span><span class="ident" id="2661569">s</span><span class="op" id="2661570">)</span>&nbsp;<span class="op" id="2661572">-</span>&nbsp;<span class="num" id="2661574">1</span><span class="op" id="2661575">;</span>&nbsp;<span class="ident" id="2661577">i</span>&nbsp;<span class="op" id="2661579">&gt;=</span>&nbsp;<span class="num" id="2661582">0</span><span class="op" id="2661583">;</span>&nbsp;<span class="ident" id="2661585">i</span><span class="op" id="2661586">--</span>&nbsp;<span class="op" id="2661589">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661594">if</span>&nbsp;<span class="ident" id="2661597">s</span><span class="op" id="2661598">[</span><span class="ident" id="2661599">i</span><span class="op" id="2661600">]</span>&nbsp;<span class="op" id="2661602">==</span>&nbsp;<span class="ident" id="2661605">c</span>&nbsp;<span class="op" id="2661607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661613">return</span>&nbsp;<span class="ident" id="2661620">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661633">return</span>&nbsp;<span class="op" id="2661640">-</span><span class="num" id="2661641">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661644">case</span>&nbsp;<span class="ident" id="2661649">n</span>&nbsp;<span class="op" id="2661651">==</span>&nbsp;<span class="builtinfunc" id="2661654">len</span><span class="op" id="2661657">(</span><span class="ident" id="2661658">s</span><span class="op" id="2661659">)</span><span class="op" id="2661660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661664">if</span>&nbsp;<span class="ident" id="2661667">sep</span>&nbsp;<span class="op" id="2661671">==</span>&nbsp;<span class="ident" id="2661674">s</span>&nbsp;<span class="op" id="2661676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661681">return</span>&nbsp;<span class="num" id="2661688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661696">return</span>&nbsp;<span class="op" id="2661703">-</span><span class="num" id="2661704">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661707">case</span>&nbsp;<span class="ident" id="2661712">n</span>&nbsp;<span class="op" id="2661714">&gt;</span>&nbsp;<span class="builtinfunc" id="2661716">len</span><span class="op" id="2661719">(</span><span class="ident" id="2661720">s</span><span class="op" id="2661721">)</span><span class="op" id="2661722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661726">return</span>&nbsp;<span class="op" id="2661733">-</span><span class="num" id="2661734">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2661740">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661789">hashsep</span><span class="op" id="2661796">,</span>&nbsp;<span class="ident" id="2661798">pow</span>&nbsp;<span class="op" id="2661802">:=</span>&nbsp;<span class="ident" id="2661805">hashStrRev</span><span class="op" id="2661815">(</span><span class="ident" id="2661816">sep</span><span class="op" id="2661819">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661822">last</span>&nbsp;<span class="op" id="2661827">:=</span>&nbsp;<span class="builtinfunc" id="2661830">len</span><span class="op" id="2661833">(</span><span class="ident" id="2661834">s</span><span class="op" id="2661835">)</span>&nbsp;<span class="op" id="2661837">-</span>&nbsp;<span class="ident" id="2661839">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661842">var</span>&nbsp;<span class="ident" id="2661846">h</span>&nbsp;<span class="builtintype" id="2661848">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661856">for</span>&nbsp;<span class="ident" id="2661860">i</span>&nbsp;<span class="op" id="2661862">:=</span>&nbsp;<span class="builtinfunc" id="2661865">len</span><span class="op" id="2661868">(</span><span class="ident" id="2661869">s</span><span class="op" id="2661870">)</span>&nbsp;<span class="op" id="2661872">-</span>&nbsp;<span class="num" id="2661874">1</span><span class="op" id="2661875">;</span>&nbsp;<span class="ident" id="2661877">i</span>&nbsp;<span class="op" id="2661879">&gt;=</span>&nbsp;<span class="ident" id="2661882">last</span><span class="op" id="2661886">;</span>&nbsp;<span class="ident" id="2661888">i</span><span class="op" id="2661889">--</span>&nbsp;<span class="op" id="2661892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2661896">h</span>&nbsp;<span class="op" id="2661898">=</span>&nbsp;<span class="ident" id="2661900">h</span><span class="op" id="2661901">*</span><span class="ident" id="2661902">primeRK</span>&nbsp;<span class="op" id="2661910">+</span>&nbsp;<span class="builtintype" id="2661912">uint32</span><span class="op" id="2661918">(</span><span class="ident" id="2661919">s</span><span class="op" id="2661920">[</span><span class="ident" id="2661921">i</span><span class="op" id="2661922">]</span><span class="op" id="2661923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661926">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661929">if</span>&nbsp;<span class="ident" id="2661932">h</span>&nbsp;<span class="op" id="2661934">==</span>&nbsp;<span class="ident" id="2661937">hashsep</span>&nbsp;<span class="op" id="2661945">&amp;&amp;</span>&nbsp;<span class="ident" id="2661948">s</span><span class="op" id="2661949">[</span><span class="ident" id="2661950">last</span><span class="op" id="2661954">:</span><span class="op" id="2661955">]</span>&nbsp;<span class="op" id="2661957">==</span>&nbsp;<span class="ident" id="2661960">sep</span>&nbsp;<span class="op" id="2661964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661968">return</span>&nbsp;<span class="ident" id="2661975">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2661981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2661984">for</span>&nbsp;<span class="ident" id="2661988">i</span>&nbsp;<span class="op" id="2661990">:=</span>&nbsp;<span class="ident" id="2661993">last</span>&nbsp;<span class="op" id="2661998">-</span>&nbsp;<span class="num" id="2662000">1</span><span class="op" id="2662001">;</span>&nbsp;<span class="ident" id="2662003">i</span>&nbsp;<span class="op" id="2662005">&gt;=</span>&nbsp;<span class="num" id="2662008">0</span><span class="op" id="2662009">;</span>&nbsp;<span class="ident" id="2662011">i</span><span class="op" id="2662012">--</span>&nbsp;<span class="op" id="2662015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2662019">h</span>&nbsp;<span class="op" id="2662021">*=</span>&nbsp;<span class="ident" id="2662024">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2662034">h</span>&nbsp;<span class="op" id="2662036">+=</span>&nbsp;<span class="builtintype" id="2662039">uint32</span><span class="op" id="2662045">(</span><span class="ident" id="2662046">s</span><span class="op" id="2662047">[</span><span class="ident" id="2662048">i</span><span class="op" id="2662049">]</span><span class="op" id="2662050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2662054">h</span>&nbsp;<span class="op" id="2662056">-=</span>&nbsp;<span class="ident" id="2662059">pow</span>&nbsp;<span class="op" id="2662063">*</span>&nbsp;<span class="builtintype" id="2662065">uint32</span><span class="op" id="2662071">(</span><span class="ident" id="2662072">s</span><span class="op" id="2662073">[</span><span class="ident" id="2662074">i</span><span class="op" id="2662075">+</span><span class="ident" id="2662076">n</span><span class="op" id="2662077">]</span><span class="op" id="2662078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662082">if</span>&nbsp;<span class="ident" id="2662085">h</span>&nbsp;<span class="op" id="2662087">==</span>&nbsp;<span class="ident" id="2662090">hashsep</span>&nbsp;<span class="op" id="2662098">&amp;&amp;</span>&nbsp;<span class="ident" id="2662101">s</span><span class="op" id="2662102">[</span><span class="ident" id="2662103">i</span><span class="op" id="2662104">:</span><span class="ident" id="2662105">i</span><span class="op" id="2662106">+</span><span class="ident" id="2662107">n</span><span class="op" id="2662108">]</span>&nbsp;<span class="op" id="2662110">==</span>&nbsp;<span class="ident" id="2662113">sep</span>&nbsp;<span class="op" id="2662117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662122">return</span>&nbsp;<span class="ident" id="2662129">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662133">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662139">return</span>&nbsp;<span class="op" id="2662146">-</span><span class="num" id="2662147">1</span><br>
<span class="lineno"></span><span class="op" id="2662149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2662152">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2662231">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2662272">func</span>&nbsp;<span class="ident" id="2662277">IndexRune</span><span class="op" id="2662286">(</span><span class="ident" id="2662287">s</span>&nbsp;<span class="builtintype" id="2662289">string</span><span class="op" id="2662295">,</span>&nbsp;<span class="ident" id="2662297">r</span>&nbsp;<span class="builtintype" id="2662299">rune</span><span class="op" id="2662303">)</span>&nbsp;<span class="builtintype" id="2662305">int</span>&nbsp;<span class="op" id="2662309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662312">switch</span>&nbsp;<span class="op" id="2662319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662322">case</span>&nbsp;<span class="ident" id="2662327">r</span>&nbsp;<span class="op" id="2662329">&lt;</span>&nbsp;<span class="ident" id="2662331">utf8</span><span class="op" id="2662335">.</span><span class="ident" id="2662336">RuneSelf</span><span class="op" id="2662344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662348">return</span>&nbsp;<span class="ident" id="2662355">IndexByte</span><span class="op" id="2662364">(</span><span class="ident" id="2662365">s</span><span class="op" id="2662366">,</span>&nbsp;<span class="builtintype" id="2662368">byte</span><span class="op" id="2662372">(</span><span class="ident" id="2662373">r</span><span class="op" id="2662374">)</span><span class="op" id="2662375">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662378">default</span><span class="op" id="2662385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662389">for</span>&nbsp;<span class="ident" id="2662393">i</span><span class="op" id="2662394">,</span>&nbsp;<span class="ident" id="2662396">c</span>&nbsp;<span class="op" id="2662398">:=</span>&nbsp;<span class="keyword" id="2662401">range</span>&nbsp;<span class="ident" id="2662407">s</span>&nbsp;<span class="op" id="2662409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662414">if</span>&nbsp;<span class="ident" id="2662417">c</span>&nbsp;<span class="op" id="2662419">==</span>&nbsp;<span class="ident" id="2662422">r</span>&nbsp;<span class="op" id="2662424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662430">return</span>&nbsp;<span class="ident" id="2662437">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662442">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662452">return</span>&nbsp;<span class="op" id="2662459">-</span><span class="num" id="2662460">1</span><br>
<span class="lineno"></span><span class="op" id="2662462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2662465">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2662543">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2662622">func</span>&nbsp;<span class="ident" id="2662627">IndexAny</span><span class="op" id="2662635">(</span><span class="ident" id="2662636">s</span><span class="op" id="2662637">,</span>&nbsp;<span class="ident" id="2662639">chars</span>&nbsp;<span class="builtintype" id="2662645">string</span><span class="op" id="2662651">)</span>&nbsp;<span class="builtintype" id="2662653">int</span>&nbsp;<span class="op" id="2662657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662660">if</span>&nbsp;<span class="builtinfunc" id="2662663">len</span><span class="op" id="2662666">(</span><span class="ident" id="2662667">chars</span><span class="op" id="2662672">)</span>&nbsp;<span class="op" id="2662674">&gt;</span>&nbsp;<span class="num" id="2662676">0</span>&nbsp;<span class="op" id="2662678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662682">for</span>&nbsp;<span class="ident" id="2662686">i</span><span class="op" id="2662687">,</span>&nbsp;<span class="ident" id="2662689">c</span>&nbsp;<span class="op" id="2662691">:=</span>&nbsp;<span class="keyword" id="2662694">range</span>&nbsp;<span class="ident" id="2662700">s</span>&nbsp;<span class="op" id="2662702">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662707">for</span>&nbsp;<span class="ident" id="2662711">_</span><span class="op" id="2662712">,</span>&nbsp;<span class="ident" id="2662714">m</span>&nbsp;<span class="op" id="2662716">:=</span>&nbsp;<span class="keyword" id="2662719">range</span>&nbsp;<span class="ident" id="2662725">chars</span>&nbsp;<span class="op" id="2662731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662737">if</span>&nbsp;<span class="ident" id="2662740">c</span>&nbsp;<span class="op" id="2662742">==</span>&nbsp;<span class="ident" id="2662745">m</span>&nbsp;<span class="op" id="2662747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662754">return</span>&nbsp;<span class="ident" id="2662761">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662772">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2662779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2662782">return</span>&nbsp;<span class="op" id="2662789">-</span><span class="num" id="2662790">1</span><br>
<span class="lineno"></span><span class="op" id="2662792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2662795">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2662870">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2662941">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2662958">func</span>&nbsp;<span class="ident" id="2662963">LastIndexAny</span><span class="op" id="2662975">(</span><span class="ident" id="2662976">s</span><span class="op" id="2662977">,</span>&nbsp;<span class="ident" id="2662979">chars</span>&nbsp;<span class="builtintype" id="2662985">string</span><span class="op" id="2662991">)</span>&nbsp;<span class="builtintype" id="2662993">int</span>&nbsp;<span class="op" id="2662997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663000">if</span>&nbsp;<span class="builtinfunc" id="2663003">len</span><span class="op" id="2663006">(</span><span class="ident" id="2663007">chars</span><span class="op" id="2663012">)</span>&nbsp;<span class="op" id="2663014">&gt;</span>&nbsp;<span class="num" id="2663016">0</span>&nbsp;<span class="op" id="2663018">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663022">for</span>&nbsp;<span class="ident" id="2663026">i</span>&nbsp;<span class="op" id="2663028">:=</span>&nbsp;<span class="builtinfunc" id="2663031">len</span><span class="op" id="2663034">(</span><span class="ident" id="2663035">s</span><span class="op" id="2663036">)</span><span class="op" id="2663037">;</span>&nbsp;<span class="ident" id="2663039">i</span>&nbsp;<span class="op" id="2663041">&gt;</span>&nbsp;<span class="num" id="2663043">0</span><span class="op" id="2663044">;</span>&nbsp;<span class="op" id="2663046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2663051">rune</span><span class="op" id="2663055">,</span>&nbsp;<span class="ident" id="2663057">size</span>&nbsp;<span class="op" id="2663062">:=</span>&nbsp;<span class="ident" id="2663065">utf8</span><span class="op" id="2663069">.</span><span class="ident" id="2663070">DecodeLastRuneInString</span><span class="op" id="2663092">(</span><span class="ident" id="2663093">s</span><span class="op" id="2663094">[</span><span class="num" id="2663095">0</span><span class="op" id="2663096">:</span><span class="ident" id="2663097">i</span><span class="op" id="2663098">]</span><span class="op" id="2663099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663104">i</span>&nbsp;<span class="op" id="2663106">-=</span>&nbsp;<span class="ident" id="2663109">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663117">for</span>&nbsp;<span class="ident" id="2663121">_</span><span class="op" id="2663122">,</span>&nbsp;<span class="ident" id="2663124">m</span>&nbsp;<span class="op" id="2663126">:=</span>&nbsp;<span class="keyword" id="2663129">range</span>&nbsp;<span class="ident" id="2663135">chars</span>&nbsp;<span class="op" id="2663141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663147">if</span>&nbsp;<span class="builtintype" id="2663150">rune</span>&nbsp;<span class="op" id="2663155">==</span>&nbsp;<span class="ident" id="2663158">m</span>&nbsp;<span class="op" id="2663160">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663167">return</span>&nbsp;<span class="ident" id="2663174">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663192">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663195">return</span>&nbsp;<span class="op" id="2663202">-</span><span class="num" id="2663203">1</span><br>
<span class="lineno"></span><span class="op" id="2663205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2663208">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2663261">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2663313">func</span>&nbsp;<span class="ident" id="2663318">genSplit</span><span class="op" id="2663326">(</span><span class="ident" id="2663327">s</span><span class="op" id="2663328">,</span>&nbsp;<span class="ident" id="2663330">sep</span>&nbsp;<span class="builtintype" id="2663334">string</span><span class="op" id="2663340">,</span>&nbsp;<span class="ident" id="2663342">sepSave</span><span class="op" id="2663349">,</span>&nbsp;<span class="ident" id="2663351">n</span>&nbsp;<span class="builtintype" id="2663353">int</span><span class="op" id="2663356">)</span>&nbsp;<span class="op" id="2663358">[</span><span class="op" id="2663359">]</span><span class="builtintype" id="2663360">string</span>&nbsp;<span class="op" id="2663367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663370">if</span>&nbsp;<span class="ident" id="2663373">n</span>&nbsp;<span class="op" id="2663375">==</span>&nbsp;<span class="num" id="2663378">0</span>&nbsp;<span class="op" id="2663380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663384">return</span>&nbsp;<span class="ident" id="2663391">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663399">if</span>&nbsp;<span class="ident" id="2663402">sep</span>&nbsp;<span class="op" id="2663406">==</span>&nbsp;<span class="string" id="2663409">&#34;&#34;</span>&nbsp;<span class="op" id="2663412">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663416">return</span>&nbsp;<span class="ident" id="2663423">explode</span><span class="op" id="2663430">(</span><span class="ident" id="2663431">s</span><span class="op" id="2663432">,</span>&nbsp;<span class="ident" id="2663434">n</span><span class="op" id="2663435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663441">if</span>&nbsp;<span class="ident" id="2663444">n</span>&nbsp;<span class="op" id="2663446">&lt;</span>&nbsp;<span class="num" id="2663448">0</span>&nbsp;<span class="op" id="2663450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663454">n</span>&nbsp;<span class="op" id="2663456">=</span>&nbsp;<span class="ident" id="2663458">Count</span><span class="op" id="2663463">(</span><span class="ident" id="2663464">s</span><span class="op" id="2663465">,</span>&nbsp;<span class="ident" id="2663467">sep</span><span class="op" id="2663470">)</span>&nbsp;<span class="op" id="2663472">+</span>&nbsp;<span class="num" id="2663474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663477">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663480">c</span>&nbsp;<span class="op" id="2663482">:=</span>&nbsp;<span class="ident" id="2663485">sep</span><span class="op" id="2663488">[</span><span class="num" id="2663489">0</span><span class="op" id="2663490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663493">start</span>&nbsp;<span class="op" id="2663499">:=</span>&nbsp;<span class="num" id="2663502">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663505">a</span>&nbsp;<span class="op" id="2663507">:=</span>&nbsp;<span class="builtinfunc" id="2663510">make</span><span class="op" id="2663514">(</span><span class="op" id="2663515">[</span><span class="op" id="2663516">]</span><span class="builtintype" id="2663517">string</span><span class="op" id="2663523">,</span>&nbsp;<span class="ident" id="2663525">n</span><span class="op" id="2663526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663529">na</span>&nbsp;<span class="op" id="2663532">:=</span>&nbsp;<span class="num" id="2663535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663538">for</span>&nbsp;<span class="ident" id="2663542">i</span>&nbsp;<span class="op" id="2663544">:=</span>&nbsp;<span class="num" id="2663547">0</span><span class="op" id="2663548">;</span>&nbsp;<span class="ident" id="2663550">i</span><span class="op" id="2663551">+</span><span class="builtinfunc" id="2663552">len</span><span class="op" id="2663555">(</span><span class="ident" id="2663556">sep</span><span class="op" id="2663559">)</span>&nbsp;<span class="op" id="2663561">&lt;=</span>&nbsp;<span class="builtinfunc" id="2663564">len</span><span class="op" id="2663567">(</span><span class="ident" id="2663568">s</span><span class="op" id="2663569">)</span>&nbsp;<span class="op" id="2663571">&amp;&amp;</span>&nbsp;<span class="ident" id="2663574">na</span><span class="op" id="2663576">+</span><span class="num" id="2663577">1</span>&nbsp;<span class="op" id="2663579">&lt;</span>&nbsp;<span class="ident" id="2663581">n</span><span class="op" id="2663582">;</span>&nbsp;<span class="ident" id="2663584">i</span><span class="op" id="2663585">++</span>&nbsp;<span class="op" id="2663588">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663592">if</span>&nbsp;<span class="ident" id="2663595">s</span><span class="op" id="2663596">[</span><span class="ident" id="2663597">i</span><span class="op" id="2663598">]</span>&nbsp;<span class="op" id="2663600">==</span>&nbsp;<span class="ident" id="2663603">c</span>&nbsp;<span class="op" id="2663605">&amp;&amp;</span>&nbsp;<span class="op" id="2663608">(</span><span class="builtinfunc" id="2663609">len</span><span class="op" id="2663612">(</span><span class="ident" id="2663613">sep</span><span class="op" id="2663616">)</span>&nbsp;<span class="op" id="2663618">==</span>&nbsp;<span class="num" id="2663621">1</span>&nbsp;<span class="op" id="2663623">||</span>&nbsp;<span class="ident" id="2663626">s</span><span class="op" id="2663627">[</span><span class="ident" id="2663628">i</span><span class="op" id="2663629">:</span><span class="ident" id="2663630">i</span><span class="op" id="2663631">+</span><span class="builtinfunc" id="2663632">len</span><span class="op" id="2663635">(</span><span class="ident" id="2663636">sep</span><span class="op" id="2663639">)</span><span class="op" id="2663640">]</span>&nbsp;<span class="op" id="2663642">==</span>&nbsp;<span class="ident" id="2663645">sep</span><span class="op" id="2663648">)</span>&nbsp;<span class="op" id="2663650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663655">a</span><span class="op" id="2663656">[</span><span class="ident" id="2663657">na</span><span class="op" id="2663659">]</span>&nbsp;<span class="op" id="2663661">=</span>&nbsp;<span class="ident" id="2663663">s</span><span class="op" id="2663664">[</span><span class="ident" id="2663665">start</span>&nbsp;<span class="op" id="2663671">:</span>&nbsp;<span class="ident" id="2663673">i</span><span class="op" id="2663674">+</span><span class="ident" id="2663675">sepSave</span><span class="op" id="2663682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663687">na</span><span class="op" id="2663689">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663695">start</span>&nbsp;<span class="op" id="2663701">=</span>&nbsp;<span class="ident" id="2663703">i</span>&nbsp;<span class="op" id="2663705">+</span>&nbsp;<span class="builtinfunc" id="2663707">len</span><span class="op" id="2663710">(</span><span class="ident" id="2663711">sep</span><span class="op" id="2663714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663719">i</span>&nbsp;<span class="op" id="2663721">+=</span>&nbsp;<span class="builtinfunc" id="2663724">len</span><span class="op" id="2663727">(</span><span class="ident" id="2663728">sep</span><span class="op" id="2663731">)</span>&nbsp;<span class="op" id="2663733">-</span>&nbsp;<span class="num" id="2663735">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2663742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2663745">a</span><span class="op" id="2663746">[</span><span class="ident" id="2663747">na</span><span class="op" id="2663749">]</span>&nbsp;<span class="op" id="2663751">=</span>&nbsp;<span class="ident" id="2663753">s</span><span class="op" id="2663754">[</span><span class="ident" id="2663755">start</span><span class="op" id="2663760">:</span><span class="op" id="2663761">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2663764">return</span>&nbsp;<span class="ident" id="2663771">a</span><span class="op" id="2663772">[</span><span class="num" id="2663773">0</span>&nbsp;<span class="op" id="2663775">:</span>&nbsp;<span class="ident" id="2663777">na</span><span class="op" id="2663779">+</span><span class="num" id="2663780">1</span><span class="op" id="2663781">]</span><br>
<span class="lineno"></span><span class="op" id="2663783">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2663786">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2663861">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2663905">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2663966">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2664026">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2664110">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2664159">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2664186">func</span>&nbsp;<span class="ident" id="2664191">SplitN</span><span class="op" id="2664197">(</span><span class="ident" id="2664198">s</span><span class="op" id="2664199">,</span>&nbsp;<span class="ident" id="2664201">sep</span>&nbsp;<span class="builtintype" id="2664205">string</span><span class="op" id="2664211">,</span>&nbsp;<span class="ident" id="2664213">n</span>&nbsp;<span class="builtintype" id="2664215">int</span><span class="op" id="2664218">)</span>&nbsp;<span class="op" id="2664220">[</span><span class="op" id="2664221">]</span><span class="builtintype" id="2664222">string</span>&nbsp;<span class="op" id="2664229">{</span>&nbsp;<span class="keyword" id="2664231">return</span>&nbsp;<span class="ident" id="2664238">genSplit</span><span class="op" id="2664246">(</span><span class="ident" id="2664247">s</span><span class="op" id="2664248">,</span>&nbsp;<span class="ident" id="2664250">sep</span><span class="op" id="2664253">,</span>&nbsp;<span class="num" id="2664255">0</span><span class="op" id="2664256">,</span>&nbsp;<span class="ident" id="2664258">n</span><span class="op" id="2664259">)</span>&nbsp;<span class="op" id="2664261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2664264">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2664335">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2664375">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2664441">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2664501">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2664585">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2664634">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2664661">func</span>&nbsp;<span class="ident" id="2664666">SplitAfterN</span><span class="op" id="2664677">(</span><span class="ident" id="2664678">s</span><span class="op" id="2664679">,</span>&nbsp;<span class="ident" id="2664681">sep</span>&nbsp;<span class="builtintype" id="2664685">string</span><span class="op" id="2664691">,</span>&nbsp;<span class="ident" id="2664693">n</span>&nbsp;<span class="builtintype" id="2664695">int</span><span class="op" id="2664698">)</span>&nbsp;<span class="op" id="2664700">[</span><span class="op" id="2664701">]</span><span class="builtintype" id="2664702">string</span>&nbsp;<span class="op" id="2664709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2664712">return</span>&nbsp;<span class="ident" id="2664719">genSplit</span><span class="op" id="2664727">(</span><span class="ident" id="2664728">s</span><span class="op" id="2664729">,</span>&nbsp;<span class="ident" id="2664731">sep</span><span class="op" id="2664734">,</span>&nbsp;<span class="builtinfunc" id="2664736">len</span><span class="op" id="2664739">(</span><span class="ident" id="2664740">sep</span><span class="op" id="2664743">)</span><span class="op" id="2664744">,</span>&nbsp;<span class="ident" id="2664746">n</span><span class="op" id="2664747">)</span><br>
<span class="lineno"></span><span class="op" id="2664749">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2664752">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2664830">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2664874">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2664934">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2664984">func</span>&nbsp;<span class="ident" id="2664989">Split</span><span class="op" id="2664994">(</span><span class="ident" id="2664995">s</span><span class="op" id="2664996">,</span>&nbsp;<span class="ident" id="2664998">sep</span>&nbsp;<span class="builtintype" id="2665002">string</span><span class="op" id="2665008">)</span>&nbsp;<span class="op" id="2665010">[</span><span class="op" id="2665011">]</span><span class="builtintype" id="2665012">string</span>&nbsp;<span class="op" id="2665019">{</span>&nbsp;<span class="keyword" id="2665021">return</span>&nbsp;<span class="ident" id="2665028">genSplit</span><span class="op" id="2665036">(</span><span class="ident" id="2665037">s</span><span class="op" id="2665038">,</span>&nbsp;<span class="ident" id="2665040">sep</span><span class="op" id="2665043">,</span>&nbsp;<span class="num" id="2665045">0</span><span class="op" id="2665046">,</span>&nbsp;<span class="op" id="2665048">-</span><span class="num" id="2665049">1</span><span class="op" id="2665050">)</span>&nbsp;<span class="op" id="2665052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2665055">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2665129">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2665169">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2665234">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2665289">func</span>&nbsp;<span class="ident" id="2665294">SplitAfter</span><span class="op" id="2665304">(</span><span class="ident" id="2665305">s</span><span class="op" id="2665306">,</span>&nbsp;<span class="ident" id="2665308">sep</span>&nbsp;<span class="builtintype" id="2665312">string</span><span class="op" id="2665318">)</span>&nbsp;<span class="op" id="2665320">[</span><span class="op" id="2665321">]</span><span class="builtintype" id="2665322">string</span>&nbsp;<span class="op" id="2665329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2665332">return</span>&nbsp;<span class="ident" id="2665339">genSplit</span><span class="op" id="2665347">(</span><span class="ident" id="2665348">s</span><span class="op" id="2665349">,</span>&nbsp;<span class="ident" id="2665351">sep</span><span class="op" id="2665354">,</span>&nbsp;<span class="builtinfunc" id="2665356">len</span><span class="op" id="2665359">(</span><span class="ident" id="2665360">sep</span><span class="op" id="2665363">)</span><span class="op" id="2665364">,</span>&nbsp;<span class="op" id="2665366">-</span><span class="num" id="2665367">1</span><span class="op" id="2665368">)</span><br>
<span class="lineno"></span><span class="op" id="2665370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2665373">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2665463">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2665553">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2665599">func</span>&nbsp;<span class="ident" id="2665604">Fields</span><span class="op" id="2665610">(</span><span class="ident" id="2665611">s</span>&nbsp;<span class="builtintype" id="2665613">string</span><span class="op" id="2665619">)</span>&nbsp;<span class="op" id="2665621">[</span><span class="op" id="2665622">]</span><span class="builtintype" id="2665623">string</span>&nbsp;<span class="op" id="2665630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2665633">return</span>&nbsp;<span class="ident" id="2665640">FieldsFunc</span><span class="op" id="2665650">(</span><span class="ident" id="2665651">s</span><span class="op" id="2665652">,</span>&nbsp;<span class="ident" id="2665654">unicode</span><span class="op" id="2665661">.</span><span class="ident" id="2665662">IsSpace</span><span class="op" id="2665669">)</span><br>
<span class="lineno">340</span><span class="op" id="2665671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2665674">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2665761">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2665845">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2665893">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2665967">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2666047">func</span>&nbsp;<span class="ident" id="2666052">FieldsFunc</span><span class="op" id="2666062">(</span><span class="ident" id="2666063">s</span>&nbsp;<span class="builtintype" id="2666065">string</span><span class="op" id="2666071">,</span>&nbsp;<span class="ident" id="2666073">f</span>&nbsp;<span class="keyword" id="2666075">func</span><span class="op" id="2666079">(</span><span class="builtintype" id="2666080">rune</span><span class="op" id="2666084">)</span>&nbsp;<span class="builtintype" id="2666086">bool</span><span class="op" id="2666090">)</span>&nbsp;<span class="op" id="2666092">[</span><span class="op" id="2666093">]</span><span class="builtintype" id="2666094">string</span>&nbsp;<span class="op" id="2666101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2666104">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666132">n</span>&nbsp;<span class="op" id="2666134">:=</span>&nbsp;<span class="num" id="2666137">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666140">inField</span>&nbsp;<span class="op" id="2666148">:=</span>&nbsp;<span class="builtintype" id="2666151">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666158">for</span>&nbsp;<span class="ident" id="2666162">_</span><span class="op" id="2666163">,</span>&nbsp;<span class="builtintype" id="2666165">rune</span>&nbsp;<span class="op" id="2666170">:=</span>&nbsp;<span class="keyword" id="2666173">range</span>&nbsp;<span class="ident" id="2666179">s</span>&nbsp;<span class="op" id="2666181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666185">wasInField</span>&nbsp;<span class="op" id="2666196">:=</span>&nbsp;<span class="ident" id="2666199">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666209">inField</span>&nbsp;<span class="op" id="2666217">=</span>&nbsp;<span class="op" id="2666219">!</span><span class="ident" id="2666220">f</span><span class="op" id="2666221">(</span><span class="builtintype" id="2666222">rune</span><span class="op" id="2666226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666230">if</span>&nbsp;<span class="ident" id="2666233">inField</span>&nbsp;<span class="op" id="2666241">&amp;&amp;</span>&nbsp;<span class="op" id="2666244">!</span><span class="ident" id="2666245">wasInField</span>&nbsp;<span class="op" id="2666256">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666261">n</span><span class="op" id="2666262">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2666274">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666295">a</span>&nbsp;<span class="op" id="2666297">:=</span>&nbsp;<span class="builtinfunc" id="2666300">make</span><span class="op" id="2666304">(</span><span class="op" id="2666305">[</span><span class="op" id="2666306">]</span><span class="builtintype" id="2666307">string</span><span class="op" id="2666313">,</span>&nbsp;<span class="ident" id="2666315">n</span><span class="op" id="2666316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666319">na</span>&nbsp;<span class="op" id="2666322">:=</span>&nbsp;<span class="num" id="2666325">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666328">fieldStart</span>&nbsp;<span class="op" id="2666339">:=</span>&nbsp;<span class="op" id="2666342">-</span><span class="num" id="2666343">1</span>&nbsp;<span class="comment" id="2666345">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666392">for</span>&nbsp;<span class="ident" id="2666396">i</span><span class="op" id="2666397">,</span>&nbsp;<span class="builtintype" id="2666399">rune</span>&nbsp;<span class="op" id="2666404">:=</span>&nbsp;<span class="keyword" id="2666407">range</span>&nbsp;<span class="ident" id="2666413">s</span>&nbsp;<span class="op" id="2666415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666419">if</span>&nbsp;<span class="ident" id="2666422">f</span><span class="op" id="2666423">(</span><span class="builtintype" id="2666424">rune</span><span class="op" id="2666428">)</span>&nbsp;<span class="op" id="2666430">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666435">if</span>&nbsp;<span class="ident" id="2666438">fieldStart</span>&nbsp;<span class="op" id="2666449">&gt;=</span>&nbsp;<span class="num" id="2666452">0</span>&nbsp;<span class="op" id="2666454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666460">a</span><span class="op" id="2666461">[</span><span class="ident" id="2666462">na</span><span class="op" id="2666464">]</span>&nbsp;<span class="op" id="2666466">=</span>&nbsp;<span class="ident" id="2666468">s</span><span class="op" id="2666469">[</span><span class="ident" id="2666470">fieldStart</span><span class="op" id="2666480">:</span><span class="ident" id="2666481">i</span><span class="op" id="2666482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666488">na</span><span class="op" id="2666490">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666497">fieldStart</span>&nbsp;<span class="op" id="2666508">=</span>&nbsp;<span class="op" id="2666510">-</span><span class="num" id="2666511">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666516">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666520">}</span>&nbsp;<span class="keyword" id="2666522">else</span>&nbsp;<span class="keyword" id="2666527">if</span>&nbsp;<span class="ident" id="2666530">fieldStart</span>&nbsp;<span class="op" id="2666541">==</span>&nbsp;<span class="op" id="2666544">-</span><span class="num" id="2666545">1</span>&nbsp;<span class="op" id="2666547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666552">fieldStart</span>&nbsp;<span class="op" id="2666563">=</span>&nbsp;<span class="ident" id="2666565">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666575">if</span>&nbsp;<span class="ident" id="2666578">fieldStart</span>&nbsp;<span class="op" id="2666589">&gt;=</span>&nbsp;<span class="num" id="2666592">0</span>&nbsp;<span class="op" id="2666594">{</span>&nbsp;<span class="comment" id="2666596">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666630">a</span><span class="op" id="2666631">[</span><span class="ident" id="2666632">na</span><span class="op" id="2666634">]</span>&nbsp;<span class="op" id="2666636">=</span>&nbsp;<span class="ident" id="2666638">s</span><span class="op" id="2666639">[</span><span class="ident" id="2666640">fieldStart</span><span class="op" id="2666650">:</span><span class="op" id="2666651">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666657">return</span>&nbsp;<span class="ident" id="2666664">a</span><br>
<span class="lineno"></span><span class="op" id="2666666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2666669">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2666758">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2666817">func</span>&nbsp;<span class="ident" id="2666822">Join</span><span class="op" id="2666826">(</span><span class="ident" id="2666827">a</span>&nbsp;<span class="op" id="2666829">[</span><span class="op" id="2666830">]</span><span class="builtintype" id="2666831">string</span><span class="op" id="2666837">,</span>&nbsp;<span class="ident" id="2666839">sep</span>&nbsp;<span class="builtintype" id="2666843">string</span><span class="op" id="2666849">)</span>&nbsp;<span class="builtintype" id="2666851">string</span>&nbsp;<span class="op" id="2666858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666861">if</span>&nbsp;<span class="builtinfunc" id="2666864">len</span><span class="op" id="2666867">(</span><span class="ident" id="2666868">a</span><span class="op" id="2666869">)</span>&nbsp;<span class="op" id="2666871">==</span>&nbsp;<span class="num" id="2666874">0</span>&nbsp;<span class="op" id="2666876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666880">return</span>&nbsp;<span class="string" id="2666887">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666894">if</span>&nbsp;<span class="builtinfunc" id="2666897">len</span><span class="op" id="2666900">(</span><span class="ident" id="2666901">a</span><span class="op" id="2666902">)</span>&nbsp;<span class="op" id="2666904">==</span>&nbsp;<span class="num" id="2666907">1</span>&nbsp;<span class="op" id="2666909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666913">return</span>&nbsp;<span class="ident" id="2666920">a</span><span class="op" id="2666921">[</span><span class="num" id="2666922">0</span><span class="op" id="2666923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2666926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666929">n</span>&nbsp;<span class="op" id="2666931">:=</span>&nbsp;<span class="builtinfunc" id="2666934">len</span><span class="op" id="2666937">(</span><span class="ident" id="2666938">sep</span><span class="op" id="2666941">)</span>&nbsp;<span class="op" id="2666943">*</span>&nbsp;<span class="op" id="2666945">(</span><span class="builtinfunc" id="2666946">len</span><span class="op" id="2666949">(</span><span class="ident" id="2666950">a</span><span class="op" id="2666951">)</span>&nbsp;<span class="op" id="2666953">-</span>&nbsp;<span class="num" id="2666955">1</span><span class="op" id="2666956">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2666959">for</span>&nbsp;<span class="ident" id="2666963">i</span>&nbsp;<span class="op" id="2666965">:=</span>&nbsp;<span class="num" id="2666968">0</span><span class="op" id="2666969">;</span>&nbsp;<span class="ident" id="2666971">i</span>&nbsp;<span class="op" id="2666973">&lt;</span>&nbsp;<span class="builtinfunc" id="2666975">len</span><span class="op" id="2666978">(</span><span class="ident" id="2666979">a</span><span class="op" id="2666980">)</span><span class="op" id="2666981">;</span>&nbsp;<span class="ident" id="2666983">i</span><span class="op" id="2666984">++</span>&nbsp;<span class="op" id="2666987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2666991">n</span>&nbsp;<span class="op" id="2666993">+=</span>&nbsp;<span class="builtinfunc" id="2666996">len</span><span class="op" id="2666999">(</span><span class="ident" id="2667000">a</span><span class="op" id="2667001">[</span><span class="ident" id="2667002">i</span><span class="op" id="2667003">]</span><span class="op" id="2667004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2667007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667011">b</span>&nbsp;<span class="op" id="2667013">:=</span>&nbsp;<span class="builtinfunc" id="2667016">make</span><span class="op" id="2667020">(</span><span class="op" id="2667021">[</span><span class="op" id="2667022">]</span><span class="builtintype" id="2667023">byte</span><span class="op" id="2667027">,</span>&nbsp;<span class="ident" id="2667029">n</span><span class="op" id="2667030">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667033">bp</span>&nbsp;<span class="op" id="2667036">:=</span>&nbsp;<span class="builtinfunc" id="2667039">copy</span><span class="op" id="2667043">(</span><span class="ident" id="2667044">b</span><span class="op" id="2667045">,</span>&nbsp;<span class="ident" id="2667047">a</span><span class="op" id="2667048">[</span><span class="num" id="2667049">0</span><span class="op" id="2667050">]</span><span class="op" id="2667051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2667054">for</span>&nbsp;<span class="ident" id="2667058">_</span><span class="op" id="2667059">,</span>&nbsp;<span class="ident" id="2667061">s</span>&nbsp;<span class="op" id="2667063">:=</span>&nbsp;<span class="keyword" id="2667066">range</span>&nbsp;<span class="ident" id="2667072">a</span><span class="op" id="2667073">[</span><span class="num" id="2667074">1</span><span class="op" id="2667075">:</span><span class="op" id="2667076">]</span>&nbsp;<span class="op" id="2667078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667082">bp</span>&nbsp;<span class="op" id="2667085">+=</span>&nbsp;<span class="builtinfunc" id="2667088">copy</span><span class="op" id="2667092">(</span><span class="ident" id="2667093">b</span><span class="op" id="2667094">[</span><span class="ident" id="2667095">bp</span><span class="op" id="2667097">:</span><span class="op" id="2667098">]</span><span class="op" id="2667099">,</span>&nbsp;<span class="ident" id="2667101">sep</span><span class="op" id="2667104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667108">bp</span>&nbsp;<span class="op" id="2667111">+=</span>&nbsp;<span class="builtinfunc" id="2667114">copy</span><span class="op" id="2667118">(</span><span class="ident" id="2667119">b</span><span class="op" id="2667120">[</span><span class="ident" id="2667121">bp</span><span class="op" id="2667123">:</span><span class="op" id="2667124">]</span><span class="op" id="2667125">,</span>&nbsp;<span class="ident" id="2667127">s</span><span class="op" id="2667128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2667131">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2667134">return</span>&nbsp;<span class="builtintype" id="2667141">string</span><span class="op" id="2667147">(</span><span class="ident" id="2667148">b</span><span class="op" id="2667149">)</span><br>
<span class="lineno"></span><span class="op" id="2667151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2667154">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2667214">func</span>&nbsp;<span class="ident" id="2667219">HasPrefix</span><span class="op" id="2667228">(</span><span class="ident" id="2667229">s</span><span class="op" id="2667230">,</span>&nbsp;<span class="ident" id="2667232">prefix</span>&nbsp;<span class="builtintype" id="2667239">string</span><span class="op" id="2667245">)</span>&nbsp;<span class="builtintype" id="2667247">bool</span>&nbsp;<span class="op" id="2667252">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2667255">return</span>&nbsp;<span class="builtinfunc" id="2667262">len</span><span class="op" id="2667265">(</span><span class="ident" id="2667266">s</span><span class="op" id="2667267">)</span>&nbsp;<span class="op" id="2667269">&gt;=</span>&nbsp;<span class="builtinfunc" id="2667272">len</span><span class="op" id="2667275">(</span><span class="ident" id="2667276">prefix</span><span class="op" id="2667282">)</span>&nbsp;<span class="op" id="2667284">&amp;&amp;</span>&nbsp;<span class="ident" id="2667287">s</span><span class="op" id="2667288">[</span><span class="num" id="2667289">0</span><span class="op" id="2667290">:</span><span class="builtinfunc" id="2667291">len</span><span class="op" id="2667294">(</span><span class="ident" id="2667295">prefix</span><span class="op" id="2667301">)</span><span class="op" id="2667302">]</span>&nbsp;<span class="op" id="2667304">==</span>&nbsp;<span class="ident" id="2667307">prefix</span><br>
<span class="lineno"></span><span class="op" id="2667314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2667317">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2667375">func</span>&nbsp;<span class="ident" id="2667380">HasSuffix</span><span class="op" id="2667389">(</span><span class="ident" id="2667390">s</span><span class="op" id="2667391">,</span>&nbsp;<span class="ident" id="2667393">suffix</span>&nbsp;<span class="builtintype" id="2667400">string</span><span class="op" id="2667406">)</span>&nbsp;<span class="builtintype" id="2667408">bool</span>&nbsp;<span class="op" id="2667413">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2667416">return</span>&nbsp;<span class="builtinfunc" id="2667423">len</span><span class="op" id="2667426">(</span><span class="ident" id="2667427">s</span><span class="op" id="2667428">)</span>&nbsp;<span class="op" id="2667430">&gt;=</span>&nbsp;<span class="builtinfunc" id="2667433">len</span><span class="op" id="2667436">(</span><span class="ident" id="2667437">suffix</span><span class="op" id="2667443">)</span>&nbsp;<span class="op" id="2667445">&amp;&amp;</span>&nbsp;<span class="ident" id="2667448">s</span><span class="op" id="2667449">[</span><span class="builtinfunc" id="2667450">len</span><span class="op" id="2667453">(</span><span class="ident" id="2667454">s</span><span class="op" id="2667455">)</span><span class="op" id="2667456">-</span><span class="builtinfunc" id="2667457">len</span><span class="op" id="2667460">(</span><span class="ident" id="2667461">suffix</span><span class="op" id="2667467">)</span><span class="op" id="2667468">:</span><span class="op" id="2667469">]</span>&nbsp;<span class="op" id="2667471">==</span>&nbsp;<span class="ident" id="2667474">suffix</span><br>
<span class="lineno"></span><span class="op" id="2667481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2667484">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2667555">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2667647">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2667695">func</span>&nbsp;<span class="ident" id="2667700">Map</span><span class="op" id="2667703">(</span><span class="ident" id="2667704">mapping</span>&nbsp;<span class="keyword" id="2667712">func</span><span class="op" id="2667716">(</span><span class="builtintype" id="2667717">rune</span><span class="op" id="2667721">)</span>&nbsp;<span class="builtintype" id="2667723">rune</span><span class="op" id="2667727">,</span>&nbsp;<span class="ident" id="2667729">s</span>&nbsp;<span class="builtintype" id="2667731">string</span><span class="op" id="2667737">)</span>&nbsp;<span class="builtintype" id="2667739">string</span>&nbsp;<span class="op" id="2667746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2667749">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2667812">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2667879">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667941">maxbytes</span>&nbsp;<span class="op" id="2667950">:=</span>&nbsp;<span class="builtinfunc" id="2667953">len</span><span class="op" id="2667956">(</span><span class="ident" id="2667957">s</span><span class="op" id="2667958">)</span>&nbsp;<span class="comment" id="2667960">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2667976">nbytes</span>&nbsp;<span class="op" id="2667983">:=</span>&nbsp;<span class="num" id="2667986">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2667995">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2668028">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2668088">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668118">var</span>&nbsp;<span class="ident" id="2668122">b</span>&nbsp;<span class="op" id="2668124">[</span><span class="op" id="2668125">]</span><span class="builtintype" id="2668126">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668133">for</span>&nbsp;<span class="ident" id="2668137">i</span><span class="op" id="2668138">,</span>&nbsp;<span class="ident" id="2668140">c</span>&nbsp;<span class="op" id="2668142">:=</span>&nbsp;<span class="keyword" id="2668145">range</span>&nbsp;<span class="ident" id="2668151">s</span>&nbsp;<span class="op" id="2668153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668157">r</span>&nbsp;<span class="op" id="2668159">:=</span>&nbsp;<span class="ident" id="2668162">mapping</span><span class="op" id="2668169">(</span><span class="ident" id="2668170">c</span><span class="op" id="2668171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668175">if</span>&nbsp;<span class="ident" id="2668178">b</span>&nbsp;<span class="op" id="2668180">==</span>&nbsp;<span class="ident" id="2668183">nil</span>&nbsp;<span class="op" id="2668187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668192">if</span>&nbsp;<span class="ident" id="2668195">r</span>&nbsp;<span class="op" id="2668197">==</span>&nbsp;<span class="ident" id="2668200">c</span>&nbsp;<span class="op" id="2668202">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668208">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668225">b</span>&nbsp;<span class="op" id="2668227">=</span>&nbsp;<span class="builtinfunc" id="2668229">make</span><span class="op" id="2668233">(</span><span class="op" id="2668234">[</span><span class="op" id="2668235">]</span><span class="builtintype" id="2668236">byte</span><span class="op" id="2668240">,</span>&nbsp;<span class="ident" id="2668242">maxbytes</span><span class="op" id="2668250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668255">nbytes</span>&nbsp;<span class="op" id="2668262">=</span>&nbsp;<span class="builtinfunc" id="2668264">copy</span><span class="op" id="2668268">(</span><span class="ident" id="2668269">b</span><span class="op" id="2668270">,</span>&nbsp;<span class="ident" id="2668272">s</span><span class="op" id="2668273">[</span><span class="op" id="2668274">:</span><span class="ident" id="2668275">i</span><span class="op" id="2668276">]</span><span class="op" id="2668277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668281">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668285">if</span>&nbsp;<span class="ident" id="2668288">r</span>&nbsp;<span class="op" id="2668290">&gt;=</span>&nbsp;<span class="num" id="2668293">0</span>&nbsp;<span class="op" id="2668295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668300">wid</span>&nbsp;<span class="op" id="2668304">:=</span>&nbsp;<span class="num" id="2668307">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668312">if</span>&nbsp;<span class="ident" id="2668315">r</span>&nbsp;<span class="op" id="2668317">&gt;=</span>&nbsp;<span class="ident" id="2668320">utf8</span><span class="op" id="2668324">.</span><span class="ident" id="2668325">RuneSelf</span>&nbsp;<span class="op" id="2668334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668340">wid</span>&nbsp;<span class="op" id="2668344">=</span>&nbsp;<span class="ident" id="2668346">utf8</span><span class="op" id="2668350">.</span><span class="ident" id="2668351">RuneLen</span><span class="op" id="2668358">(</span><span class="ident" id="2668359">r</span><span class="op" id="2668360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668365">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668370">if</span>&nbsp;<span class="ident" id="2668373">nbytes</span><span class="op" id="2668379">+</span><span class="ident" id="2668380">wid</span>&nbsp;<span class="op" id="2668384">&gt;</span>&nbsp;<span class="ident" id="2668386">maxbytes</span>&nbsp;<span class="op" id="2668395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2668401">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668425">maxbytes</span>&nbsp;<span class="op" id="2668434">=</span>&nbsp;<span class="ident" id="2668436">maxbytes</span><span class="op" id="2668444">*</span><span class="num" id="2668445">2</span>&nbsp;<span class="op" id="2668447">+</span>&nbsp;<span class="ident" id="2668449">utf8</span><span class="op" id="2668453">.</span><span class="ident" id="2668454">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668465">nb</span>&nbsp;<span class="op" id="2668468">:=</span>&nbsp;<span class="builtinfunc" id="2668471">make</span><span class="op" id="2668475">(</span><span class="op" id="2668476">[</span><span class="op" id="2668477">]</span><span class="builtintype" id="2668478">byte</span><span class="op" id="2668482">,</span>&nbsp;<span class="ident" id="2668484">maxbytes</span><span class="op" id="2668492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2668498">copy</span><span class="op" id="2668502">(</span><span class="ident" id="2668503">nb</span><span class="op" id="2668505">,</span>&nbsp;<span class="ident" id="2668507">b</span><span class="op" id="2668508">[</span><span class="num" id="2668509">0</span><span class="op" id="2668510">:</span><span class="ident" id="2668511">nbytes</span><span class="op" id="2668517">]</span><span class="op" id="2668518">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668524">b</span>&nbsp;<span class="op" id="2668526">=</span>&nbsp;<span class="ident" id="2668528">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668539">nbytes</span>&nbsp;<span class="op" id="2668546">+=</span>&nbsp;<span class="ident" id="2668549">utf8</span><span class="op" id="2668553">.</span><span class="ident" id="2668554">EncodeRune</span><span class="op" id="2668564">(</span><span class="ident" id="2668565">b</span><span class="op" id="2668566">[</span><span class="ident" id="2668567">nbytes</span><span class="op" id="2668573">:</span><span class="ident" id="2668574">maxbytes</span><span class="op" id="2668582">]</span><span class="op" id="2668583">,</span>&nbsp;<span class="ident" id="2668585">r</span><span class="op" id="2668586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668593">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668596">if</span>&nbsp;<span class="ident" id="2668599">b</span>&nbsp;<span class="op" id="2668601">==</span>&nbsp;<span class="ident" id="2668604">nil</span>&nbsp;<span class="op" id="2668608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668612">return</span>&nbsp;<span class="ident" id="2668619">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668625">return</span>&nbsp;<span class="builtintype" id="2668632">string</span><span class="op" id="2668638">(</span><span class="ident" id="2668639">b</span><span class="op" id="2668640">[</span><span class="num" id="2668641">0</span><span class="op" id="2668642">:</span><span class="ident" id="2668643">nbytes</span><span class="op" id="2668649">]</span><span class="op" id="2668650">)</span><br>
<span class="lineno"></span><span class="op" id="2668652">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2668655">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2668730">func</span>&nbsp;<span class="ident" id="2668735">Repeat</span><span class="op" id="2668741">(</span><span class="ident" id="2668742">s</span>&nbsp;<span class="builtintype" id="2668744">string</span><span class="op" id="2668750">,</span>&nbsp;<span class="ident" id="2668752">count</span>&nbsp;<span class="builtintype" id="2668758">int</span><span class="op" id="2668761">)</span>&nbsp;<span class="builtintype" id="2668763">string</span>&nbsp;<span class="op" id="2668770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668773">b</span>&nbsp;<span class="op" id="2668775">:=</span>&nbsp;<span class="builtinfunc" id="2668778">make</span><span class="op" id="2668782">(</span><span class="op" id="2668783">[</span><span class="op" id="2668784">]</span><span class="builtintype" id="2668785">byte</span><span class="op" id="2668789">,</span>&nbsp;<span class="builtinfunc" id="2668791">len</span><span class="op" id="2668794">(</span><span class="ident" id="2668795">s</span><span class="op" id="2668796">)</span><span class="op" id="2668797">*</span><span class="ident" id="2668798">count</span><span class="op" id="2668803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668806">bp</span>&nbsp;<span class="op" id="2668809">:=</span>&nbsp;<span class="builtinfunc" id="2668812">copy</span><span class="op" id="2668816">(</span><span class="ident" id="2668817">b</span><span class="op" id="2668818">,</span>&nbsp;<span class="ident" id="2668820">s</span><span class="op" id="2668821">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668824">for</span>&nbsp;<span class="ident" id="2668828">bp</span>&nbsp;<span class="op" id="2668831">&lt;</span>&nbsp;<span class="builtinfunc" id="2668833">len</span><span class="op" id="2668836">(</span><span class="ident" id="2668837">b</span><span class="op" id="2668838">)</span>&nbsp;<span class="op" id="2668840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2668844">copy</span><span class="op" id="2668848">(</span><span class="ident" id="2668849">b</span><span class="op" id="2668850">[</span><span class="ident" id="2668851">bp</span><span class="op" id="2668853">:</span><span class="op" id="2668854">]</span><span class="op" id="2668855">,</span>&nbsp;<span class="ident" id="2668857">b</span><span class="op" id="2668858">[</span><span class="op" id="2668859">:</span><span class="ident" id="2668860">bp</span><span class="op" id="2668862">]</span><span class="op" id="2668863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2668867">bp</span>&nbsp;<span class="op" id="2668870">*=</span>&nbsp;<span class="num" id="2668873">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2668876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2668879">return</span>&nbsp;<span class="builtintype" id="2668886">string</span><span class="op" id="2668892">(</span><span class="ident" id="2668893">b</span><span class="op" id="2668894">)</span><br>
<span class="lineno">465</span><span class="op" id="2668896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2668899">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2668994">func</span>&nbsp;<span class="ident" id="2668999">ToUpper</span><span class="op" id="2669006">(</span><span class="ident" id="2669007">s</span>&nbsp;<span class="builtintype" id="2669009">string</span><span class="op" id="2669015">)</span>&nbsp;<span class="builtintype" id="2669017">string</span>&nbsp;<span class="op" id="2669024">{</span>&nbsp;<span class="keyword" id="2669026">return</span>&nbsp;<span class="ident" id="2669033">Map</span><span class="op" id="2669036">(</span><span class="ident" id="2669037">unicode</span><span class="op" id="2669044">.</span><span class="ident" id="2669045">ToUpper</span><span class="op" id="2669052">,</span>&nbsp;<span class="ident" id="2669054">s</span><span class="op" id="2669055">)</span>&nbsp;<span class="op" id="2669057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2669060">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2669155">func</span>&nbsp;<span class="ident" id="2669160">ToLower</span><span class="op" id="2669167">(</span><span class="ident" id="2669168">s</span>&nbsp;<span class="builtintype" id="2669170">string</span><span class="op" id="2669176">)</span>&nbsp;<span class="builtintype" id="2669178">string</span>&nbsp;<span class="op" id="2669185">{</span>&nbsp;<span class="keyword" id="2669187">return</span>&nbsp;<span class="ident" id="2669194">Map</span><span class="op" id="2669197">(</span><span class="ident" id="2669198">unicode</span><span class="op" id="2669205">.</span><span class="ident" id="2669206">ToLower</span><span class="op" id="2669213">,</span>&nbsp;<span class="ident" id="2669215">s</span><span class="op" id="2669216">)</span>&nbsp;<span class="op" id="2669218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2669221">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2669316">func</span>&nbsp;<span class="ident" id="2669321">ToTitle</span><span class="op" id="2669328">(</span><span class="ident" id="2669329">s</span>&nbsp;<span class="builtintype" id="2669331">string</span><span class="op" id="2669337">)</span>&nbsp;<span class="builtintype" id="2669339">string</span>&nbsp;<span class="op" id="2669346">{</span>&nbsp;<span class="keyword" id="2669348">return</span>&nbsp;<span class="ident" id="2669355">Map</span><span class="op" id="2669358">(</span><span class="ident" id="2669359">unicode</span><span class="op" id="2669366">.</span><span class="ident" id="2669367">ToTitle</span><span class="op" id="2669374">,</span>&nbsp;<span class="ident" id="2669376">s</span><span class="op" id="2669377">)</span>&nbsp;<span class="op" id="2669379">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2669382">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2669472">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2669532">func</span>&nbsp;<span class="ident" id="2669537">ToUpperSpecial</span><span class="op" id="2669551">(</span><span class="ident" id="2669552">_case</span>&nbsp;<span class="ident" id="2669558">unicode</span><span class="op" id="2669565">.</span><span class="ident" id="2669566">SpecialCase</span><span class="op" id="2669577">,</span>&nbsp;<span class="ident" id="2669579">s</span>&nbsp;<span class="builtintype" id="2669581">string</span><span class="op" id="2669587">)</span>&nbsp;<span class="builtintype" id="2669589">string</span>&nbsp;<span class="op" id="2669596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2669599">return</span>&nbsp;<span class="ident" id="2669606">Map</span><span class="op" id="2669609">(</span><span class="keyword" id="2669610">func</span><span class="op" id="2669614">(</span><span class="ident" id="2669615">r</span>&nbsp;<span class="builtintype" id="2669617">rune</span><span class="op" id="2669621">)</span>&nbsp;<span class="builtintype" id="2669623">rune</span>&nbsp;<span class="op" id="2669628">{</span>&nbsp;<span class="keyword" id="2669630">return</span>&nbsp;<span class="ident" id="2669637">_case</span><span class="op" id="2669642">.</span><span class="ident" id="2669643">ToUpper</span><span class="op" id="2669650">(</span><span class="ident" id="2669651">r</span><span class="op" id="2669652">)</span>&nbsp;<span class="op" id="2669654">}</span><span class="op" id="2669655">,</span>&nbsp;<span class="ident" id="2669657">s</span><span class="op" id="2669658">)</span><br>
<span class="lineno">480</span><span class="op" id="2669660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2669663">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2669753">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2669813">func</span>&nbsp;<span class="ident" id="2669818">ToLowerSpecial</span><span class="op" id="2669832">(</span><span class="ident" id="2669833">_case</span>&nbsp;<span class="ident" id="2669839">unicode</span><span class="op" id="2669846">.</span><span class="ident" id="2669847">SpecialCase</span><span class="op" id="2669858">,</span>&nbsp;<span class="ident" id="2669860">s</span>&nbsp;<span class="builtintype" id="2669862">string</span><span class="op" id="2669868">)</span>&nbsp;<span class="builtintype" id="2669870">string</span>&nbsp;<span class="op" id="2669877">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2669880">return</span>&nbsp;<span class="ident" id="2669887">Map</span><span class="op" id="2669890">(</span><span class="keyword" id="2669891">func</span><span class="op" id="2669895">(</span><span class="ident" id="2669896">r</span>&nbsp;<span class="builtintype" id="2669898">rune</span><span class="op" id="2669902">)</span>&nbsp;<span class="builtintype" id="2669904">rune</span>&nbsp;<span class="op" id="2669909">{</span>&nbsp;<span class="keyword" id="2669911">return</span>&nbsp;<span class="ident" id="2669918">_case</span><span class="op" id="2669923">.</span><span class="ident" id="2669924">ToLower</span><span class="op" id="2669931">(</span><span class="ident" id="2669932">r</span><span class="op" id="2669933">)</span>&nbsp;<span class="op" id="2669935">}</span><span class="op" id="2669936">,</span>&nbsp;<span class="ident" id="2669938">s</span><span class="op" id="2669939">)</span><br>
<span class="lineno"></span><span class="op" id="2669941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2669944">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2670034">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2670094">func</span>&nbsp;<span class="ident" id="2670099">ToTitleSpecial</span><span class="op" id="2670113">(</span><span class="ident" id="2670114">_case</span>&nbsp;<span class="ident" id="2670120">unicode</span><span class="op" id="2670127">.</span><span class="ident" id="2670128">SpecialCase</span><span class="op" id="2670139">,</span>&nbsp;<span class="ident" id="2670141">s</span>&nbsp;<span class="builtintype" id="2670143">string</span><span class="op" id="2670149">)</span>&nbsp;<span class="builtintype" id="2670151">string</span>&nbsp;<span class="op" id="2670158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670161">return</span>&nbsp;<span class="ident" id="2670168">Map</span><span class="op" id="2670171">(</span><span class="keyword" id="2670172">func</span><span class="op" id="2670176">(</span><span class="ident" id="2670177">r</span>&nbsp;<span class="builtintype" id="2670179">rune</span><span class="op" id="2670183">)</span>&nbsp;<span class="builtintype" id="2670185">rune</span>&nbsp;<span class="op" id="2670190">{</span>&nbsp;<span class="keyword" id="2670192">return</span>&nbsp;<span class="ident" id="2670199">_case</span><span class="op" id="2670204">.</span><span class="ident" id="2670205">ToTitle</span><span class="op" id="2670212">(</span><span class="ident" id="2670213">r</span><span class="op" id="2670214">)</span>&nbsp;<span class="op" id="2670216">}</span><span class="op" id="2670217">,</span>&nbsp;<span class="ident" id="2670219">s</span><span class="op" id="2670220">)</span><br>
<span class="lineno"></span><span class="op" id="2670222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2670225">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2670293">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2670363">func</span>&nbsp;<span class="ident" id="2670368">isSeparator</span><span class="op" id="2670379">(</span><span class="ident" id="2670380">r</span>&nbsp;<span class="builtintype" id="2670382">rune</span><span class="op" id="2670386">)</span>&nbsp;<span class="builtintype" id="2670388">bool</span>&nbsp;<span class="op" id="2670393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2670396">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670454">if</span>&nbsp;<span class="ident" id="2670457">r</span>&nbsp;<span class="op" id="2670459">&lt;=</span>&nbsp;<span class="num" id="2670462">0x7F</span>&nbsp;<span class="op" id="2670467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670471">switch</span>&nbsp;<span class="op" id="2670478">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670482">case</span>&nbsp;<span class="string" id="2670487">&#39;0&#39;</span>&nbsp;<span class="op" id="2670491">&lt;=</span>&nbsp;<span class="ident" id="2670494">r</span>&nbsp;<span class="op" id="2670496">&amp;&amp;</span>&nbsp;<span class="ident" id="2670499">r</span>&nbsp;<span class="op" id="2670501">&lt;=</span>&nbsp;<span class="string" id="2670504">&#39;9&#39;</span><span class="op" id="2670507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670512">return</span>&nbsp;<span class="builtintype" id="2670519">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670527">case</span>&nbsp;<span class="string" id="2670532">&#39;a&#39;</span>&nbsp;<span class="op" id="2670536">&lt;=</span>&nbsp;<span class="ident" id="2670539">r</span>&nbsp;<span class="op" id="2670541">&amp;&amp;</span>&nbsp;<span class="ident" id="2670544">r</span>&nbsp;<span class="op" id="2670546">&lt;=</span>&nbsp;<span class="string" id="2670549">&#39;z&#39;</span><span class="op" id="2670552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670557">return</span>&nbsp;<span class="builtintype" id="2670564">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670572">case</span>&nbsp;<span class="string" id="2670577">&#39;A&#39;</span>&nbsp;<span class="op" id="2670581">&lt;=</span>&nbsp;<span class="ident" id="2670584">r</span>&nbsp;<span class="op" id="2670586">&amp;&amp;</span>&nbsp;<span class="ident" id="2670589">r</span>&nbsp;<span class="op" id="2670591">&lt;=</span>&nbsp;<span class="string" id="2670594">&#39;Z&#39;</span><span class="op" id="2670597">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670602">return</span>&nbsp;<span class="builtintype" id="2670609">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670617">case</span>&nbsp;<span class="ident" id="2670622">r</span>&nbsp;<span class="op" id="2670624">==</span>&nbsp;<span class="string" id="2670627">&#39;_&#39;</span><span class="op" id="2670630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670635">return</span>&nbsp;<span class="builtintype" id="2670642">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2670650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670654">return</span>&nbsp;<span class="builtintype" id="2670661">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2670667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2670670">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670712">if</span>&nbsp;<span class="ident" id="2670715">unicode</span><span class="op" id="2670722">.</span><span class="ident" id="2670723">IsLetter</span><span class="op" id="2670731">(</span><span class="ident" id="2670732">r</span><span class="op" id="2670733">)</span>&nbsp;<span class="op" id="2670735">||</span>&nbsp;<span class="ident" id="2670738">unicode</span><span class="op" id="2670745">.</span><span class="ident" id="2670746">IsDigit</span><span class="op" id="2670753">(</span><span class="ident" id="2670754">r</span><span class="op" id="2670755">)</span>&nbsp;<span class="op" id="2670757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670761">return</span>&nbsp;<span class="builtintype" id="2670768">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2670775">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2670778">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2670846">return</span>&nbsp;<span class="ident" id="2670853">unicode</span><span class="op" id="2670860">.</span><span class="ident" id="2670861">IsSpace</span><span class="op" id="2670868">(</span><span class="ident" id="2670869">r</span><span class="op" id="2670870">)</span><br>
<span class="lineno"></span><span class="op" id="2670872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2670875">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2670957">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2670988">//</span><br>
<span class="lineno"></span><span class="comment" id="2670991">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2671085">func</span>&nbsp;<span class="ident" id="2671090">Title</span><span class="op" id="2671095">(</span><span class="ident" id="2671096">s</span>&nbsp;<span class="builtintype" id="2671098">string</span><span class="op" id="2671104">)</span>&nbsp;<span class="builtintype" id="2671106">string</span>&nbsp;<span class="op" id="2671113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2671116">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2671158">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2671230">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671261">prev</span>&nbsp;<span class="op" id="2671266">:=</span>&nbsp;<span class="string" id="2671269">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671274">return</span>&nbsp;<span class="ident" id="2671281">Map</span><span class="op" id="2671284">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671288">func</span><span class="op" id="2671292">(</span><span class="ident" id="2671293">r</span>&nbsp;<span class="builtintype" id="2671295">rune</span><span class="op" id="2671299">)</span>&nbsp;<span class="builtintype" id="2671301">rune</span>&nbsp;<span class="op" id="2671306">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671311">if</span>&nbsp;<span class="ident" id="2671314">isSeparator</span><span class="op" id="2671325">(</span><span class="ident" id="2671326">prev</span><span class="op" id="2671330">)</span>&nbsp;<span class="op" id="2671332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671338">prev</span>&nbsp;<span class="op" id="2671343">=</span>&nbsp;<span class="ident" id="2671345">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671351">return</span>&nbsp;<span class="ident" id="2671358">unicode</span><span class="op" id="2671365">.</span><span class="ident" id="2671366">ToTitle</span><span class="op" id="2671373">(</span><span class="ident" id="2671374">r</span><span class="op" id="2671375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2671380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671385">prev</span>&nbsp;<span class="op" id="2671390">=</span>&nbsp;<span class="ident" id="2671392">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671397">return</span>&nbsp;<span class="ident" id="2671404">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2671408">}</span><span class="op" id="2671409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671413">s</span><span class="op" id="2671414">)</span><br>
<span class="lineno"></span><span class="op" id="2671416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2671419">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2671484">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2671534">func</span>&nbsp;<span class="ident" id="2671539">TrimLeftFunc</span><span class="op" id="2671551">(</span><span class="ident" id="2671552">s</span>&nbsp;<span class="builtintype" id="2671554">string</span><span class="op" id="2671560">,</span>&nbsp;<span class="ident" id="2671562">f</span>&nbsp;<span class="keyword" id="2671564">func</span><span class="op" id="2671568">(</span><span class="builtintype" id="2671569">rune</span><span class="op" id="2671573">)</span>&nbsp;<span class="builtintype" id="2671575">bool</span><span class="op" id="2671579">)</span>&nbsp;<span class="builtintype" id="2671581">string</span>&nbsp;<span class="op" id="2671588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671591">i</span>&nbsp;<span class="op" id="2671593">:=</span>&nbsp;<span class="ident" id="2671596">indexFunc</span><span class="op" id="2671605">(</span><span class="ident" id="2671606">s</span><span class="op" id="2671607">,</span>&nbsp;<span class="ident" id="2671609">f</span><span class="op" id="2671610">,</span>&nbsp;<span class="builtintype" id="2671612">false</span><span class="op" id="2671617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671620">if</span>&nbsp;<span class="ident" id="2671623">i</span>&nbsp;<span class="op" id="2671625">==</span>&nbsp;<span class="op" id="2671628">-</span><span class="num" id="2671629">1</span>&nbsp;<span class="op" id="2671631">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671635">return</span>&nbsp;<span class="string" id="2671642">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2671646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671649">return</span>&nbsp;<span class="ident" id="2671656">s</span><span class="op" id="2671657">[</span><span class="ident" id="2671658">i</span><span class="op" id="2671659">:</span><span class="op" id="2671660">]</span><br>
<span class="lineno"></span><span class="op" id="2671662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2671665">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2671732">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2671782">func</span>&nbsp;<span class="ident" id="2671787">TrimRightFunc</span><span class="op" id="2671800">(</span><span class="ident" id="2671801">s</span>&nbsp;<span class="builtintype" id="2671803">string</span><span class="op" id="2671809">,</span>&nbsp;<span class="ident" id="2671811">f</span>&nbsp;<span class="keyword" id="2671813">func</span><span class="op" id="2671817">(</span><span class="builtintype" id="2671818">rune</span><span class="op" id="2671822">)</span>&nbsp;<span class="builtintype" id="2671824">bool</span><span class="op" id="2671828">)</span>&nbsp;<span class="builtintype" id="2671830">string</span>&nbsp;<span class="op" id="2671837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671840">i</span>&nbsp;<span class="op" id="2671842">:=</span>&nbsp;<span class="ident" id="2671845">lastIndexFunc</span><span class="op" id="2671858">(</span><span class="ident" id="2671859">s</span><span class="op" id="2671860">,</span>&nbsp;<span class="ident" id="2671862">f</span><span class="op" id="2671863">,</span>&nbsp;<span class="builtintype" id="2671865">false</span><span class="op" id="2671870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671873">if</span>&nbsp;<span class="ident" id="2671876">i</span>&nbsp;<span class="op" id="2671878">&gt;=</span>&nbsp;<span class="num" id="2671881">0</span>&nbsp;<span class="op" id="2671883">&amp;&amp;</span>&nbsp;<span class="ident" id="2671886">s</span><span class="op" id="2671887">[</span><span class="ident" id="2671888">i</span><span class="op" id="2671889">]</span>&nbsp;<span class="op" id="2671891">&gt;=</span>&nbsp;<span class="ident" id="2671894">utf8</span><span class="op" id="2671898">.</span><span class="ident" id="2671899">RuneSelf</span>&nbsp;<span class="op" id="2671908">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671912">_</span><span class="op" id="2671913">,</span>&nbsp;<span class="ident" id="2671915">wid</span>&nbsp;<span class="op" id="2671919">:=</span>&nbsp;<span class="ident" id="2671922">utf8</span><span class="op" id="2671926">.</span><span class="ident" id="2671927">DecodeRuneInString</span><span class="op" id="2671945">(</span><span class="ident" id="2671946">s</span><span class="op" id="2671947">[</span><span class="ident" id="2671948">i</span><span class="op" id="2671949">:</span><span class="op" id="2671950">]</span><span class="op" id="2671951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671955">i</span>&nbsp;<span class="op" id="2671957">+=</span>&nbsp;<span class="ident" id="2671960">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2671965">}</span>&nbsp;<span class="keyword" id="2671967">else</span>&nbsp;<span class="op" id="2671972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2671976">i</span><span class="op" id="2671977">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2671981">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2671984">return</span>&nbsp;<span class="ident" id="2671991">s</span><span class="op" id="2671992">[</span><span class="num" id="2671993">0</span><span class="op" id="2671994">:</span><span class="ident" id="2671995">i</span><span class="op" id="2671996">]</span><br>
<span class="lineno"></span><span class="op" id="2671998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2672001">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2672062">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2672125">func</span>&nbsp;<span class="ident" id="2672130">TrimFunc</span><span class="op" id="2672138">(</span><span class="ident" id="2672139">s</span>&nbsp;<span class="builtintype" id="2672141">string</span><span class="op" id="2672147">,</span>&nbsp;<span class="ident" id="2672149">f</span>&nbsp;<span class="keyword" id="2672151">func</span><span class="op" id="2672155">(</span><span class="builtintype" id="2672156">rune</span><span class="op" id="2672160">)</span>&nbsp;<span class="builtintype" id="2672162">bool</span><span class="op" id="2672166">)</span>&nbsp;<span class="builtintype" id="2672168">string</span>&nbsp;<span class="op" id="2672175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672178">return</span>&nbsp;<span class="ident" id="2672185">TrimRightFunc</span><span class="op" id="2672198">(</span><span class="ident" id="2672199">TrimLeftFunc</span><span class="op" id="2672211">(</span><span class="ident" id="2672212">s</span><span class="op" id="2672213">,</span>&nbsp;<span class="ident" id="2672215">f</span><span class="op" id="2672216">)</span><span class="op" id="2672217">,</span>&nbsp;<span class="ident" id="2672219">f</span><span class="op" id="2672220">)</span><br>
<span class="lineno"></span><span class="op" id="2672222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2672225">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2672284">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2672333">func</span>&nbsp;<span class="ident" id="2672338">IndexFunc</span><span class="op" id="2672347">(</span><span class="ident" id="2672348">s</span>&nbsp;<span class="builtintype" id="2672350">string</span><span class="op" id="2672356">,</span>&nbsp;<span class="ident" id="2672358">f</span>&nbsp;<span class="keyword" id="2672360">func</span><span class="op" id="2672364">(</span><span class="builtintype" id="2672365">rune</span><span class="op" id="2672369">)</span>&nbsp;<span class="builtintype" id="2672371">bool</span><span class="op" id="2672375">)</span>&nbsp;<span class="builtintype" id="2672377">int</span>&nbsp;<span class="op" id="2672381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672384">return</span>&nbsp;<span class="ident" id="2672391">indexFunc</span><span class="op" id="2672400">(</span><span class="ident" id="2672401">s</span><span class="op" id="2672402">,</span>&nbsp;<span class="ident" id="2672404">f</span><span class="op" id="2672405">,</span>&nbsp;<span class="builtintype" id="2672407">true</span><span class="op" id="2672411">)</span><br>
<span class="lineno"></span><span class="op" id="2672413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2672416">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2672470">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2672527">func</span>&nbsp;<span class="ident" id="2672532">LastIndexFunc</span><span class="op" id="2672545">(</span><span class="ident" id="2672546">s</span>&nbsp;<span class="builtintype" id="2672548">string</span><span class="op" id="2672554">,</span>&nbsp;<span class="ident" id="2672556">f</span>&nbsp;<span class="keyword" id="2672558">func</span><span class="op" id="2672562">(</span><span class="builtintype" id="2672563">rune</span><span class="op" id="2672567">)</span>&nbsp;<span class="builtintype" id="2672569">bool</span><span class="op" id="2672573">)</span>&nbsp;<span class="builtintype" id="2672575">int</span>&nbsp;<span class="op" id="2672579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672582">return</span>&nbsp;<span class="ident" id="2672589">lastIndexFunc</span><span class="op" id="2672602">(</span><span class="ident" id="2672603">s</span><span class="op" id="2672604">,</span>&nbsp;<span class="ident" id="2672606">f</span><span class="op" id="2672607">,</span>&nbsp;<span class="builtintype" id="2672609">true</span><span class="op" id="2672613">)</span><br>
<span class="lineno"></span><span class="op" id="2672615">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2672618">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2672671">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2672727">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2672740">func</span>&nbsp;<span class="ident" id="2672745">indexFunc</span><span class="op" id="2672754">(</span><span class="ident" id="2672755">s</span>&nbsp;<span class="builtintype" id="2672757">string</span><span class="op" id="2672763">,</span>&nbsp;<span class="ident" id="2672765">f</span>&nbsp;<span class="keyword" id="2672767">func</span><span class="op" id="2672771">(</span><span class="builtintype" id="2672772">rune</span><span class="op" id="2672776">)</span>&nbsp;<span class="builtintype" id="2672778">bool</span><span class="op" id="2672782">,</span>&nbsp;<span class="ident" id="2672784">truth</span>&nbsp;<span class="builtintype" id="2672790">bool</span><span class="op" id="2672794">)</span>&nbsp;<span class="builtintype" id="2672796">int</span>&nbsp;<span class="op" id="2672800">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2672803">start</span>&nbsp;<span class="op" id="2672809">:=</span>&nbsp;<span class="num" id="2672812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672815">for</span>&nbsp;<span class="ident" id="2672819">start</span>&nbsp;<span class="op" id="2672825">&lt;</span>&nbsp;<span class="builtinfunc" id="2672827">len</span><span class="op" id="2672830">(</span><span class="ident" id="2672831">s</span><span class="op" id="2672832">)</span>&nbsp;<span class="op" id="2672834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2672838">wid</span>&nbsp;<span class="op" id="2672842">:=</span>&nbsp;<span class="num" id="2672845">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2672849">r</span>&nbsp;<span class="op" id="2672851">:=</span>&nbsp;<span class="builtintype" id="2672854">rune</span><span class="op" id="2672858">(</span><span class="ident" id="2672859">s</span><span class="op" id="2672860">[</span><span class="ident" id="2672861">start</span><span class="op" id="2672866">]</span><span class="op" id="2672867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672871">if</span>&nbsp;<span class="ident" id="2672874">r</span>&nbsp;<span class="op" id="2672876">&gt;=</span>&nbsp;<span class="ident" id="2672879">utf8</span><span class="op" id="2672883">.</span><span class="ident" id="2672884">RuneSelf</span>&nbsp;<span class="op" id="2672893">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2672898">r</span><span class="op" id="2672899">,</span>&nbsp;<span class="ident" id="2672901">wid</span>&nbsp;<span class="op" id="2672905">=</span>&nbsp;<span class="ident" id="2672907">utf8</span><span class="op" id="2672911">.</span><span class="ident" id="2672912">DecodeRuneInString</span><span class="op" id="2672930">(</span><span class="ident" id="2672931">s</span><span class="op" id="2672932">[</span><span class="ident" id="2672933">start</span><span class="op" id="2672938">:</span><span class="op" id="2672939">]</span><span class="op" id="2672940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2672944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672948">if</span>&nbsp;<span class="ident" id="2672951">f</span><span class="op" id="2672952">(</span><span class="ident" id="2672953">r</span><span class="op" id="2672954">)</span>&nbsp;<span class="op" id="2672956">==</span>&nbsp;<span class="ident" id="2672959">truth</span>&nbsp;<span class="op" id="2672965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2672970">return</span>&nbsp;<span class="ident" id="2672977">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2672985">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2672989">start</span>&nbsp;<span class="op" id="2672995">+=</span>&nbsp;<span class="ident" id="2672998">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2673003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673006">return</span>&nbsp;<span class="op" id="2673013">-</span><span class="num" id="2673014">1</span><br>
<span class="lineno"></span><span class="op" id="2673016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2673019">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2673080">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2673136">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2673149">func</span>&nbsp;<span class="ident" id="2673154">lastIndexFunc</span><span class="op" id="2673167">(</span><span class="ident" id="2673168">s</span>&nbsp;<span class="builtintype" id="2673170">string</span><span class="op" id="2673176">,</span>&nbsp;<span class="ident" id="2673178">f</span>&nbsp;<span class="keyword" id="2673180">func</span><span class="op" id="2673184">(</span><span class="builtintype" id="2673185">rune</span><span class="op" id="2673189">)</span>&nbsp;<span class="builtintype" id="2673191">bool</span><span class="op" id="2673195">,</span>&nbsp;<span class="ident" id="2673197">truth</span>&nbsp;<span class="builtintype" id="2673203">bool</span><span class="op" id="2673207">)</span>&nbsp;<span class="builtintype" id="2673209">int</span>&nbsp;<span class="op" id="2673213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673216">for</span>&nbsp;<span class="ident" id="2673220">i</span>&nbsp;<span class="op" id="2673222">:=</span>&nbsp;<span class="builtinfunc" id="2673225">len</span><span class="op" id="2673228">(</span><span class="ident" id="2673229">s</span><span class="op" id="2673230">)</span><span class="op" id="2673231">;</span>&nbsp;<span class="ident" id="2673233">i</span>&nbsp;<span class="op" id="2673235">&gt;</span>&nbsp;<span class="num" id="2673237">0</span><span class="op" id="2673238">;</span>&nbsp;<span class="op" id="2673240">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2673244">r</span><span class="op" id="2673245">,</span>&nbsp;<span class="ident" id="2673247">size</span>&nbsp;<span class="op" id="2673252">:=</span>&nbsp;<span class="ident" id="2673255">utf8</span><span class="op" id="2673259">.</span><span class="ident" id="2673260">DecodeLastRuneInString</span><span class="op" id="2673282">(</span><span class="ident" id="2673283">s</span><span class="op" id="2673284">[</span><span class="num" id="2673285">0</span><span class="op" id="2673286">:</span><span class="ident" id="2673287">i</span><span class="op" id="2673288">]</span><span class="op" id="2673289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2673293">i</span>&nbsp;<span class="op" id="2673295">-=</span>&nbsp;<span class="ident" id="2673298">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673305">if</span>&nbsp;<span class="ident" id="2673308">f</span><span class="op" id="2673309">(</span><span class="ident" id="2673310">r</span><span class="op" id="2673311">)</span>&nbsp;<span class="op" id="2673313">==</span>&nbsp;<span class="ident" id="2673316">truth</span>&nbsp;<span class="op" id="2673322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673327">return</span>&nbsp;<span class="ident" id="2673334">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2673338">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2673341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673344">return</span>&nbsp;<span class="op" id="2673351">-</span><span class="num" id="2673352">1</span><br>
<span class="lineno"></span><span class="op" id="2673354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2673357">func</span>&nbsp;<span class="ident" id="2673362">makeCutsetFunc</span><span class="op" id="2673376">(</span><span class="ident" id="2673377">cutset</span>&nbsp;<span class="builtintype" id="2673384">string</span><span class="op" id="2673390">)</span>&nbsp;<span class="keyword" id="2673392">func</span><span class="op" id="2673396">(</span><span class="builtintype" id="2673397">rune</span><span class="op" id="2673401">)</span>&nbsp;<span class="builtintype" id="2673403">bool</span>&nbsp;<span class="op" id="2673408">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673411">return</span>&nbsp;<span class="keyword" id="2673418">func</span><span class="op" id="2673422">(</span><span class="ident" id="2673423">r</span>&nbsp;<span class="builtintype" id="2673425">rune</span><span class="op" id="2673429">)</span>&nbsp;<span class="builtintype" id="2673431">bool</span>&nbsp;<span class="op" id="2673436">{</span>&nbsp;<span class="keyword" id="2673438">return</span>&nbsp;<span class="ident" id="2673445">IndexRune</span><span class="op" id="2673454">(</span><span class="ident" id="2673455">cutset</span><span class="op" id="2673461">,</span>&nbsp;<span class="ident" id="2673463">r</span><span class="op" id="2673464">)</span>&nbsp;<span class="op" id="2673466">&gt;=</span>&nbsp;<span class="num" id="2673469">0</span>&nbsp;<span class="op" id="2673471">}</span><br>
<span class="lineno"></span><span class="op" id="2673473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2673476">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2673537">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2673598">func</span>&nbsp;<span class="ident" id="2673603">Trim</span><span class="op" id="2673607">(</span><span class="ident" id="2673608">s</span>&nbsp;<span class="builtintype" id="2673610">string</span><span class="op" id="2673616">,</span>&nbsp;<span class="ident" id="2673618">cutset</span>&nbsp;<span class="builtintype" id="2673625">string</span><span class="op" id="2673631">)</span>&nbsp;<span class="builtintype" id="2673633">string</span>&nbsp;<span class="op" id="2673640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673643">if</span>&nbsp;<span class="ident" id="2673646">s</span>&nbsp;<span class="op" id="2673648">==</span>&nbsp;<span class="string" id="2673651">&#34;&#34;</span>&nbsp;<span class="op" id="2673654">||</span>&nbsp;<span class="ident" id="2673657">cutset</span>&nbsp;<span class="op" id="2673664">==</span>&nbsp;<span class="string" id="2673667">&#34;&#34;</span>&nbsp;<span class="op" id="2673670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673674">return</span>&nbsp;<span class="ident" id="2673681">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2673684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673687">return</span>&nbsp;<span class="ident" id="2673694">TrimFunc</span><span class="op" id="2673702">(</span><span class="ident" id="2673703">s</span><span class="op" id="2673704">,</span>&nbsp;<span class="ident" id="2673706">makeCutsetFunc</span><span class="op" id="2673720">(</span><span class="ident" id="2673721">cutset</span><span class="op" id="2673727">)</span><span class="op" id="2673728">)</span><br>
<span class="lineno">625</span><span class="op" id="2673730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2673733">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2673794">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2673846">func</span>&nbsp;<span class="ident" id="2673851">TrimLeft</span><span class="op" id="2673859">(</span><span class="ident" id="2673860">s</span>&nbsp;<span class="builtintype" id="2673862">string</span><span class="op" id="2673868">,</span>&nbsp;<span class="ident" id="2673870">cutset</span>&nbsp;<span class="builtintype" id="2673877">string</span><span class="op" id="2673883">)</span>&nbsp;<span class="builtintype" id="2673885">string</span>&nbsp;<span class="op" id="2673892">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673895">if</span>&nbsp;<span class="ident" id="2673898">s</span>&nbsp;<span class="op" id="2673900">==</span>&nbsp;<span class="string" id="2673903">&#34;&#34;</span>&nbsp;<span class="op" id="2673906">||</span>&nbsp;<span class="ident" id="2673909">cutset</span>&nbsp;<span class="op" id="2673916">==</span>&nbsp;<span class="string" id="2673919">&#34;&#34;</span>&nbsp;<span class="op" id="2673922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673926">return</span>&nbsp;<span class="ident" id="2673933">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2673936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2673939">return</span>&nbsp;<span class="ident" id="2673946">TrimLeftFunc</span><span class="op" id="2673958">(</span><span class="ident" id="2673959">s</span><span class="op" id="2673960">,</span>&nbsp;<span class="ident" id="2673962">makeCutsetFunc</span><span class="op" id="2673976">(</span><span class="ident" id="2673977">cutset</span><span class="op" id="2673983">)</span><span class="op" id="2673984">)</span><br>
<span class="lineno"></span><span class="op" id="2673986">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2673989">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2674053">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2674105">func</span>&nbsp;<span class="ident" id="2674110">TrimRight</span><span class="op" id="2674119">(</span><span class="ident" id="2674120">s</span>&nbsp;<span class="builtintype" id="2674122">string</span><span class="op" id="2674128">,</span>&nbsp;<span class="ident" id="2674130">cutset</span>&nbsp;<span class="builtintype" id="2674137">string</span><span class="op" id="2674143">)</span>&nbsp;<span class="builtintype" id="2674145">string</span>&nbsp;<span class="op" id="2674152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674155">if</span>&nbsp;<span class="ident" id="2674158">s</span>&nbsp;<span class="op" id="2674160">==</span>&nbsp;<span class="string" id="2674163">&#34;&#34;</span>&nbsp;<span class="op" id="2674166">||</span>&nbsp;<span class="ident" id="2674169">cutset</span>&nbsp;<span class="op" id="2674176">==</span>&nbsp;<span class="string" id="2674179">&#34;&#34;</span>&nbsp;<span class="op" id="2674182">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674186">return</span>&nbsp;<span class="ident" id="2674193">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2674196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674199">return</span>&nbsp;<span class="ident" id="2674206">TrimRightFunc</span><span class="op" id="2674219">(</span><span class="ident" id="2674220">s</span><span class="op" id="2674221">,</span>&nbsp;<span class="ident" id="2674223">makeCutsetFunc</span><span class="op" id="2674237">(</span><span class="ident" id="2674238">cutset</span><span class="op" id="2674244">)</span><span class="op" id="2674245">)</span><br>
<span class="lineno"></span><span class="op" id="2674247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2674250">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2674313">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2674373">func</span>&nbsp;<span class="ident" id="2674378">TrimSpace</span><span class="op" id="2674387">(</span><span class="ident" id="2674388">s</span>&nbsp;<span class="builtintype" id="2674390">string</span><span class="op" id="2674396">)</span>&nbsp;<span class="builtintype" id="2674398">string</span>&nbsp;<span class="op" id="2674405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674408">return</span>&nbsp;<span class="ident" id="2674415">TrimFunc</span><span class="op" id="2674423">(</span><span class="ident" id="2674424">s</span><span class="op" id="2674425">,</span>&nbsp;<span class="ident" id="2674427">unicode</span><span class="op" id="2674434">.</span><span class="ident" id="2674435">IsSpace</span><span class="op" id="2674442">)</span><br>
<span class="lineno"></span><span class="op" id="2674444">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2674447">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2674515">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2674575">func</span>&nbsp;<span class="ident" id="2674580">TrimPrefix</span><span class="op" id="2674590">(</span><span class="ident" id="2674591">s</span><span class="op" id="2674592">,</span>&nbsp;<span class="ident" id="2674594">prefix</span>&nbsp;<span class="builtintype" id="2674601">string</span><span class="op" id="2674607">)</span>&nbsp;<span class="builtintype" id="2674609">string</span>&nbsp;<span class="op" id="2674616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674619">if</span>&nbsp;<span class="ident" id="2674622">HasPrefix</span><span class="op" id="2674631">(</span><span class="ident" id="2674632">s</span><span class="op" id="2674633">,</span>&nbsp;<span class="ident" id="2674635">prefix</span><span class="op" id="2674641">)</span>&nbsp;<span class="op" id="2674643">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674647">return</span>&nbsp;<span class="ident" id="2674654">s</span><span class="op" id="2674655">[</span><span class="builtinfunc" id="2674656">len</span><span class="op" id="2674659">(</span><span class="ident" id="2674660">prefix</span><span class="op" id="2674666">)</span><span class="op" id="2674667">:</span><span class="op" id="2674668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2674671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674674">return</span>&nbsp;<span class="ident" id="2674681">s</span><br>
<span class="lineno"></span><span class="op" id="2674683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2674686">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2674755">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2674813">func</span>&nbsp;<span class="ident" id="2674818">TrimSuffix</span><span class="op" id="2674828">(</span><span class="ident" id="2674829">s</span><span class="op" id="2674830">,</span>&nbsp;<span class="ident" id="2674832">suffix</span>&nbsp;<span class="builtintype" id="2674839">string</span><span class="op" id="2674845">)</span>&nbsp;<span class="builtintype" id="2674847">string</span>&nbsp;<span class="op" id="2674854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674857">if</span>&nbsp;<span class="ident" id="2674860">HasSuffix</span><span class="op" id="2674869">(</span><span class="ident" id="2674870">s</span><span class="op" id="2674871">,</span>&nbsp;<span class="ident" id="2674873">suffix</span><span class="op" id="2674879">)</span>&nbsp;<span class="op" id="2674881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674885">return</span>&nbsp;<span class="ident" id="2674892">s</span><span class="op" id="2674893">[</span><span class="op" id="2674894">:</span><span class="builtinfunc" id="2674895">len</span><span class="op" id="2674898">(</span><span class="ident" id="2674899">s</span><span class="op" id="2674900">)</span><span class="op" id="2674901">-</span><span class="builtinfunc" id="2674902">len</span><span class="op" id="2674905">(</span><span class="ident" id="2674906">suffix</span><span class="op" id="2674912">)</span><span class="op" id="2674913">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2674916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2674919">return</span>&nbsp;<span class="ident" id="2674926">s</span><br>
<span class="lineno"></span><span class="op" id="2674928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2674931">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2674990">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2675043">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2675105">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2675171">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2675195">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2675257">func</span>&nbsp;<span class="ident" id="2675262">Replace</span><span class="op" id="2675269">(</span><span class="ident" id="2675270">s</span><span class="op" id="2675271">,</span>&nbsp;<span class="ident" id="2675273">old</span><span class="op" id="2675276">,</span>&nbsp;<span class="builtinfunc" id="2675278">new</span>&nbsp;<span class="builtintype" id="2675282">string</span><span class="op" id="2675288">,</span>&nbsp;<span class="ident" id="2675290">n</span>&nbsp;<span class="builtintype" id="2675292">int</span><span class="op" id="2675295">)</span>&nbsp;<span class="builtintype" id="2675297">string</span>&nbsp;<span class="op" id="2675304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675307">if</span>&nbsp;<span class="ident" id="2675310">old</span>&nbsp;<span class="op" id="2675314">==</span>&nbsp;<span class="builtinfunc" id="2675317">new</span>&nbsp;<span class="op" id="2675321">||</span>&nbsp;<span class="ident" id="2675324">n</span>&nbsp;<span class="op" id="2675326">==</span>&nbsp;<span class="num" id="2675329">0</span>&nbsp;<span class="op" id="2675331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675335">return</span>&nbsp;<span class="ident" id="2675342">s</span>&nbsp;<span class="comment" id="2675344">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2675369">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675405">if</span>&nbsp;<span class="ident" id="2675408">m</span>&nbsp;<span class="op" id="2675410">:=</span>&nbsp;<span class="ident" id="2675413">Count</span><span class="op" id="2675418">(</span><span class="ident" id="2675419">s</span><span class="op" id="2675420">,</span>&nbsp;<span class="ident" id="2675422">old</span><span class="op" id="2675425">)</span><span class="op" id="2675426">;</span>&nbsp;<span class="ident" id="2675428">m</span>&nbsp;<span class="op" id="2675430">==</span>&nbsp;<span class="num" id="2675433">0</span>&nbsp;<span class="op" id="2675435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675439">return</span>&nbsp;<span class="ident" id="2675446">s</span>&nbsp;<span class="comment" id="2675448">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675469">}</span>&nbsp;<span class="keyword" id="2675471">else</span>&nbsp;<span class="keyword" id="2675476">if</span>&nbsp;<span class="ident" id="2675479">n</span>&nbsp;<span class="op" id="2675481">&lt;</span>&nbsp;<span class="num" id="2675483">0</span>&nbsp;<span class="op" id="2675485">||</span>&nbsp;<span class="ident" id="2675488">m</span>&nbsp;<span class="op" id="2675490">&lt;</span>&nbsp;<span class="ident" id="2675492">n</span>&nbsp;<span class="op" id="2675494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675498">n</span>&nbsp;<span class="op" id="2675500">=</span>&nbsp;<span class="ident" id="2675502">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2675509">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675543">t</span>&nbsp;<span class="op" id="2675545">:=</span>&nbsp;<span class="builtinfunc" id="2675548">make</span><span class="op" id="2675552">(</span><span class="op" id="2675553">[</span><span class="op" id="2675554">]</span><span class="builtintype" id="2675555">byte</span><span class="op" id="2675559">,</span>&nbsp;<span class="builtinfunc" id="2675561">len</span><span class="op" id="2675564">(</span><span class="ident" id="2675565">s</span><span class="op" id="2675566">)</span><span class="op" id="2675567">+</span><span class="ident" id="2675568">n</span><span class="op" id="2675569">*</span><span class="op" id="2675570">(</span><span class="builtinfunc" id="2675571">len</span><span class="op" id="2675574">(</span><span class="builtinfunc" id="2675575">new</span><span class="op" id="2675578">)</span><span class="op" id="2675579">-</span><span class="builtinfunc" id="2675580">len</span><span class="op" id="2675583">(</span><span class="ident" id="2675584">old</span><span class="op" id="2675587">)</span><span class="op" id="2675588">)</span><span class="op" id="2675589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675592">w</span>&nbsp;<span class="op" id="2675594">:=</span>&nbsp;<span class="num" id="2675597">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675600">start</span>&nbsp;<span class="op" id="2675606">:=</span>&nbsp;<span class="num" id="2675609">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675612">for</span>&nbsp;<span class="ident" id="2675616">i</span>&nbsp;<span class="op" id="2675618">:=</span>&nbsp;<span class="num" id="2675621">0</span><span class="op" id="2675622">;</span>&nbsp;<span class="ident" id="2675624">i</span>&nbsp;<span class="op" id="2675626">&lt;</span>&nbsp;<span class="ident" id="2675628">n</span><span class="op" id="2675629">;</span>&nbsp;<span class="ident" id="2675631">i</span><span class="op" id="2675632">++</span>&nbsp;<span class="op" id="2675635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675639">j</span>&nbsp;<span class="op" id="2675641">:=</span>&nbsp;<span class="ident" id="2675644">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675652">if</span>&nbsp;<span class="builtinfunc" id="2675655">len</span><span class="op" id="2675658">(</span><span class="ident" id="2675659">old</span><span class="op" id="2675662">)</span>&nbsp;<span class="op" id="2675664">==</span>&nbsp;<span class="num" id="2675667">0</span>&nbsp;<span class="op" id="2675669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675674">if</span>&nbsp;<span class="ident" id="2675677">i</span>&nbsp;<span class="op" id="2675679">&gt;</span>&nbsp;<span class="num" id="2675681">0</span>&nbsp;<span class="op" id="2675683">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675689">_</span><span class="op" id="2675690">,</span>&nbsp;<span class="ident" id="2675692">wid</span>&nbsp;<span class="op" id="2675696">:=</span>&nbsp;<span class="ident" id="2675699">utf8</span><span class="op" id="2675703">.</span><span class="ident" id="2675704">DecodeRuneInString</span><span class="op" id="2675722">(</span><span class="ident" id="2675723">s</span><span class="op" id="2675724">[</span><span class="ident" id="2675725">start</span><span class="op" id="2675730">:</span><span class="op" id="2675731">]</span><span class="op" id="2675732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675738">j</span>&nbsp;<span class="op" id="2675740">+=</span>&nbsp;<span class="ident" id="2675743">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675754">}</span>&nbsp;<span class="keyword" id="2675756">else</span>&nbsp;<span class="op" id="2675761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675766">j</span>&nbsp;<span class="op" id="2675768">+=</span>&nbsp;<span class="ident" id="2675771">Index</span><span class="op" id="2675776">(</span><span class="ident" id="2675777">s</span><span class="op" id="2675778">[</span><span class="ident" id="2675779">start</span><span class="op" id="2675784">:</span><span class="op" id="2675785">]</span><span class="op" id="2675786">,</span>&nbsp;<span class="ident" id="2675788">old</span><span class="op" id="2675791">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675799">w</span>&nbsp;<span class="op" id="2675801">+=</span>&nbsp;<span class="builtinfunc" id="2675804">copy</span><span class="op" id="2675808">(</span><span class="ident" id="2675809">t</span><span class="op" id="2675810">[</span><span class="ident" id="2675811">w</span><span class="op" id="2675812">:</span><span class="op" id="2675813">]</span><span class="op" id="2675814">,</span>&nbsp;<span class="ident" id="2675816">s</span><span class="op" id="2675817">[</span><span class="ident" id="2675818">start</span><span class="op" id="2675823">:</span><span class="ident" id="2675824">j</span><span class="op" id="2675825">]</span><span class="op" id="2675826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675830">w</span>&nbsp;<span class="op" id="2675832">+=</span>&nbsp;<span class="builtinfunc" id="2675835">copy</span><span class="op" id="2675839">(</span><span class="ident" id="2675840">t</span><span class="op" id="2675841">[</span><span class="ident" id="2675842">w</span><span class="op" id="2675843">:</span><span class="op" id="2675844">]</span><span class="op" id="2675845">,</span>&nbsp;<span class="builtinfunc" id="2675847">new</span><span class="op" id="2675850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675854">start</span>&nbsp;<span class="op" id="2675860">=</span>&nbsp;<span class="ident" id="2675862">j</span>&nbsp;<span class="op" id="2675864">+</span>&nbsp;<span class="builtinfunc" id="2675866">len</span><span class="op" id="2675869">(</span><span class="ident" id="2675870">old</span><span class="op" id="2675873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2675876">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2675879">w</span>&nbsp;<span class="op" id="2675881">+=</span>&nbsp;<span class="builtinfunc" id="2675884">copy</span><span class="op" id="2675888">(</span><span class="ident" id="2675889">t</span><span class="op" id="2675890">[</span><span class="ident" id="2675891">w</span><span class="op" id="2675892">:</span><span class="op" id="2675893">]</span><span class="op" id="2675894">,</span>&nbsp;<span class="ident" id="2675896">s</span><span class="op" id="2675897">[</span><span class="ident" id="2675898">start</span><span class="op" id="2675903">:</span><span class="op" id="2675904">]</span><span class="op" id="2675905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2675908">return</span>&nbsp;<span class="builtintype" id="2675915">string</span><span class="op" id="2675921">(</span><span class="ident" id="2675922">t</span><span class="op" id="2675923">[</span><span class="num" id="2675924">0</span><span class="op" id="2675925">:</span><span class="ident" id="2675926">w</span><span class="op" id="2675927">]</span><span class="op" id="2675928">)</span><br>
<span class="lineno"></span><span class="op" id="2675930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2675933">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2676001">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2676042">func</span>&nbsp;<span class="ident" id="2676047">EqualFold</span><span class="op" id="2676056">(</span><span class="ident" id="2676057">s</span><span class="op" id="2676058">,</span>&nbsp;<span class="ident" id="2676060">t</span>&nbsp;<span class="builtintype" id="2676062">string</span><span class="op" id="2676068">)</span>&nbsp;<span class="builtintype" id="2676070">bool</span>&nbsp;<span class="op" id="2676075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676078">for</span>&nbsp;<span class="ident" id="2676082">s</span>&nbsp;<span class="op" id="2676084">!=</span>&nbsp;<span class="string" id="2676087">&#34;&#34;</span>&nbsp;<span class="op" id="2676090">&amp;&amp;</span>&nbsp;<span class="ident" id="2676093">t</span>&nbsp;<span class="op" id="2676095">!=</span>&nbsp;<span class="string" id="2676098">&#34;&#34;</span>&nbsp;<span class="op" id="2676101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676105">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676147">var</span>&nbsp;<span class="ident" id="2676151">sr</span><span class="op" id="2676153">,</span>&nbsp;<span class="ident" id="2676155">tr</span>&nbsp;<span class="builtintype" id="2676158">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676165">if</span>&nbsp;<span class="ident" id="2676168">s</span><span class="op" id="2676169">[</span><span class="num" id="2676170">0</span><span class="op" id="2676171">]</span>&nbsp;<span class="op" id="2676173">&lt;</span>&nbsp;<span class="ident" id="2676175">utf8</span><span class="op" id="2676179">.</span><span class="ident" id="2676180">RuneSelf</span>&nbsp;<span class="op" id="2676189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676194">sr</span><span class="op" id="2676196">,</span>&nbsp;<span class="ident" id="2676198">s</span>&nbsp;<span class="op" id="2676200">=</span>&nbsp;<span class="builtintype" id="2676202">rune</span><span class="op" id="2676206">(</span><span class="ident" id="2676207">s</span><span class="op" id="2676208">[</span><span class="num" id="2676209">0</span><span class="op" id="2676210">]</span><span class="op" id="2676211">)</span><span class="op" id="2676212">,</span>&nbsp;<span class="ident" id="2676214">s</span><span class="op" id="2676215">[</span><span class="num" id="2676216">1</span><span class="op" id="2676217">:</span><span class="op" id="2676218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676222">}</span>&nbsp;<span class="keyword" id="2676224">else</span>&nbsp;<span class="op" id="2676229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676234">r</span><span class="op" id="2676235">,</span>&nbsp;<span class="ident" id="2676237">size</span>&nbsp;<span class="op" id="2676242">:=</span>&nbsp;<span class="ident" id="2676245">utf8</span><span class="op" id="2676249">.</span><span class="ident" id="2676250">DecodeRuneInString</span><span class="op" id="2676268">(</span><span class="ident" id="2676269">s</span><span class="op" id="2676270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676275">sr</span><span class="op" id="2676277">,</span>&nbsp;<span class="ident" id="2676279">s</span>&nbsp;<span class="op" id="2676281">=</span>&nbsp;<span class="ident" id="2676283">r</span><span class="op" id="2676284">,</span>&nbsp;<span class="ident" id="2676286">s</span><span class="op" id="2676287">[</span><span class="ident" id="2676288">size</span><span class="op" id="2676292">:</span><span class="op" id="2676293">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676301">if</span>&nbsp;<span class="ident" id="2676304">t</span><span class="op" id="2676305">[</span><span class="num" id="2676306">0</span><span class="op" id="2676307">]</span>&nbsp;<span class="op" id="2676309">&lt;</span>&nbsp;<span class="ident" id="2676311">utf8</span><span class="op" id="2676315">.</span><span class="ident" id="2676316">RuneSelf</span>&nbsp;<span class="op" id="2676325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676330">tr</span><span class="op" id="2676332">,</span>&nbsp;<span class="ident" id="2676334">t</span>&nbsp;<span class="op" id="2676336">=</span>&nbsp;<span class="builtintype" id="2676338">rune</span><span class="op" id="2676342">(</span><span class="ident" id="2676343">t</span><span class="op" id="2676344">[</span><span class="num" id="2676345">0</span><span class="op" id="2676346">]</span><span class="op" id="2676347">)</span><span class="op" id="2676348">,</span>&nbsp;<span class="ident" id="2676350">t</span><span class="op" id="2676351">[</span><span class="num" id="2676352">1</span><span class="op" id="2676353">:</span><span class="op" id="2676354">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676358">}</span>&nbsp;<span class="keyword" id="2676360">else</span>&nbsp;<span class="op" id="2676365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676370">r</span><span class="op" id="2676371">,</span>&nbsp;<span class="ident" id="2676373">size</span>&nbsp;<span class="op" id="2676378">:=</span>&nbsp;<span class="ident" id="2676381">utf8</span><span class="op" id="2676385">.</span><span class="ident" id="2676386">DecodeRuneInString</span><span class="op" id="2676404">(</span><span class="ident" id="2676405">t</span><span class="op" id="2676406">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676411">tr</span><span class="op" id="2676413">,</span>&nbsp;<span class="ident" id="2676415">t</span>&nbsp;<span class="op" id="2676417">=</span>&nbsp;<span class="ident" id="2676419">r</span><span class="op" id="2676420">,</span>&nbsp;<span class="ident" id="2676422">t</span><span class="op" id="2676423">[</span><span class="ident" id="2676424">size</span><span class="op" id="2676428">:</span><span class="op" id="2676429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676438">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676493">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676509">if</span>&nbsp;<span class="ident" id="2676512">tr</span>&nbsp;<span class="op" id="2676515">==</span>&nbsp;<span class="ident" id="2676518">sr</span>&nbsp;<span class="op" id="2676521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676526">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676542">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676586">if</span>&nbsp;<span class="ident" id="2676589">tr</span>&nbsp;<span class="op" id="2676592">&lt;</span>&nbsp;<span class="ident" id="2676594">sr</span>&nbsp;<span class="op" id="2676597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676602">tr</span><span class="op" id="2676604">,</span>&nbsp;<span class="ident" id="2676606">sr</span>&nbsp;<span class="op" id="2676609">=</span>&nbsp;<span class="ident" id="2676611">sr</span><span class="op" id="2676613">,</span>&nbsp;<span class="ident" id="2676615">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676624">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676651">if</span>&nbsp;<span class="ident" id="2676654">tr</span>&nbsp;<span class="op" id="2676657">&lt;</span>&nbsp;<span class="ident" id="2676659">utf8</span><span class="op" id="2676663">.</span><span class="ident" id="2676664">RuneSelf</span>&nbsp;<span class="op" id="2676673">&amp;&amp;</span>&nbsp;<span class="string" id="2676676">&#39;A&#39;</span>&nbsp;<span class="op" id="2676680">&lt;=</span>&nbsp;<span class="ident" id="2676683">sr</span>&nbsp;<span class="op" id="2676686">&amp;&amp;</span>&nbsp;<span class="ident" id="2676689">sr</span>&nbsp;<span class="op" id="2676692">&lt;=</span>&nbsp;<span class="string" id="2676695">&#39;Z&#39;</span>&nbsp;<span class="op" id="2676699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676704">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676763">if</span>&nbsp;<span class="ident" id="2676766">tr</span>&nbsp;<span class="op" id="2676769">==</span>&nbsp;<span class="ident" id="2676772">sr</span><span class="op" id="2676774">+</span><span class="string" id="2676775">&#39;a&#39;</span><span class="op" id="2676778">-</span><span class="string" id="2676779">&#39;A&#39;</span>&nbsp;<span class="op" id="2676783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676789">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676801">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676806">return</span>&nbsp;<span class="builtintype" id="2676813">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676826">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676897">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676937">r</span>&nbsp;<span class="op" id="2676939">:=</span>&nbsp;<span class="ident" id="2676942">unicode</span><span class="op" id="2676949">.</span><span class="ident" id="2676950">SimpleFold</span><span class="op" id="2676960">(</span><span class="ident" id="2676961">sr</span><span class="op" id="2676963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676967">for</span>&nbsp;<span class="ident" id="2676971">r</span>&nbsp;<span class="op" id="2676973">!=</span>&nbsp;<span class="ident" id="2676976">sr</span>&nbsp;<span class="op" id="2676979">&amp;&amp;</span>&nbsp;<span class="ident" id="2676982">r</span>&nbsp;<span class="op" id="2676984">&lt;</span>&nbsp;<span class="ident" id="2676986">tr</span>&nbsp;<span class="op" id="2676989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676994">r</span>&nbsp;<span class="op" id="2676996">=</span>&nbsp;<span class="ident" id="2676998">unicode</span><span class="op" id="2677005">.</span><span class="ident" id="2677006">SimpleFold</span><span class="op" id="2677016">(</span><span class="ident" id="2677017">r</span><span class="op" id="2677018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2677022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677026">if</span>&nbsp;<span class="ident" id="2677029">r</span>&nbsp;<span class="op" id="2677031">==</span>&nbsp;<span class="ident" id="2677034">tr</span>&nbsp;<span class="op" id="2677037">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677042">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2677053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677057">return</span>&nbsp;<span class="builtintype" id="2677064">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2677071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677075">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677111">return</span>&nbsp;<span class="ident" id="2677118">s</span>&nbsp;<span class="op" id="2677120">==</span>&nbsp;<span class="ident" id="2677123">t</span><br>
<span class="lineno"></span><span class="op" id="2677125">}</span>
</div>
</body>
</html>
