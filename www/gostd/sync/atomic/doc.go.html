<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html" class="current">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1460133">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1460189">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1460243">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1460294">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1460356">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1460411">//</span><br>
<span class="lineno"></span><span class="comment" id="1460414">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1460474">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1460547">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1460608">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1460642">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1460682">//</span><br>
<span class="lineno"></span><span class="comment" id="1460685">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1460758">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1460776">//</span><br>
<span class="lineno"></span><span class="comment" id="1460779">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1460794">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1460809">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1460823">//</span><br>
<span class="lineno"></span><span class="comment" id="1460826">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1460896">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1460939">//</span><br>
<span class="lineno"></span><span class="comment" id="1460942">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1460963">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1460979">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1460995">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1461000">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1461016">//</span><br>
<span class="lineno">30</span><span class="comment" id="1461019">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1461090">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1461108">//</span><br>
<span class="lineno"></span><span class="comment" id="1461111">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1461129">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1461145">//</span><br>
<span class="lineno"></span><span class="comment" id="1461148">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1461218">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1461281">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1461299">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1461302">package</span>&nbsp;<span class="ident" id="1461310">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1461318">import</span>&nbsp;<span class="op" id="1461325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1461328">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1461337">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1461340">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1461438">//</span><br>
<span class="lineno"></span><span class="comment" id="1461441">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1461536">//</span><br>
<span class="lineno">50</span><span class="comment" id="1461539">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1461622">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1461699">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1461771">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1461791">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1461875">func</span>&nbsp;<span class="ident" id="1461880">SwapInt32</span><span class="op" id="1461889">(</span><span class="ident" id="1461890">addr</span>&nbsp;<span class="op" id="1461895">*</span><span class="builtintype" id="1461896">int32</span><span class="op" id="1461901">,</span>&nbsp;<span class="builtinfunc" id="1461903">new</span>&nbsp;<span class="builtintype" id="1461907">int32</span><span class="op" id="1461912">)</span>&nbsp;<span class="op" id="1461914">(</span><span class="ident" id="1461915">old</span>&nbsp;<span class="builtintype" id="1461919">int32</span><span class="op" id="1461924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1461927">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462011">func</span>&nbsp;<span class="ident" id="1462016">SwapInt64</span><span class="op" id="1462025">(</span><span class="ident" id="1462026">addr</span>&nbsp;<span class="op" id="1462031">*</span><span class="ident" id="1462032">int64</span><span class="op" id="1462037">,</span>&nbsp;<span class="builtinfunc" id="1462039">new</span>&nbsp;<span class="ident" id="1462043">int64</span><span class="op" id="1462048">)</span>&nbsp;<span class="op" id="1462050">(</span><span class="ident" id="1462051">old</span>&nbsp;<span class="ident" id="1462055">int64</span><span class="op" id="1462060">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1462063">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462148">func</span>&nbsp;<span class="ident" id="1462153">SwapUint32</span><span class="op" id="1462163">(</span><span class="ident" id="1462164">addr</span>&nbsp;<span class="op" id="1462169">*</span><span class="builtintype" id="1462170">uint32</span><span class="op" id="1462176">,</span>&nbsp;<span class="builtinfunc" id="1462178">new</span>&nbsp;<span class="builtintype" id="1462182">uint32</span><span class="op" id="1462188">)</span>&nbsp;<span class="op" id="1462190">(</span><span class="ident" id="1462191">old</span>&nbsp;<span class="builtintype" id="1462195">uint32</span><span class="op" id="1462201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462204">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1462289">func</span>&nbsp;<span class="ident" id="1462294">SwapUint64</span><span class="op" id="1462304">(</span><span class="ident" id="1462305">addr</span>&nbsp;<span class="op" id="1462310">*</span><span class="ident" id="1462311">uint64</span><span class="op" id="1462317">,</span>&nbsp;<span class="builtinfunc" id="1462319">new</span>&nbsp;<span class="ident" id="1462323">uint64</span><span class="op" id="1462329">)</span>&nbsp;<span class="op" id="1462331">(</span><span class="ident" id="1462332">old</span>&nbsp;<span class="ident" id="1462336">uint64</span><span class="op" id="1462342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462345">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462431">func</span>&nbsp;<span class="ident" id="1462436">SwapUintptr</span><span class="op" id="1462447">(</span><span class="ident" id="1462448">addr</span>&nbsp;<span class="op" id="1462453">*</span><span class="builtintype" id="1462454">uintptr</span><span class="op" id="1462461">,</span>&nbsp;<span class="builtinfunc" id="1462463">new</span>&nbsp;<span class="builtintype" id="1462467">uintptr</span><span class="op" id="1462474">)</span>&nbsp;<span class="op" id="1462476">(</span><span class="ident" id="1462477">old</span>&nbsp;<span class="builtintype" id="1462481">uintptr</span><span class="op" id="1462488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1462491">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462577">func</span>&nbsp;<span class="ident" id="1462582">SwapPointer</span><span class="op" id="1462593">(</span><span class="ident" id="1462594">addr</span>&nbsp;<span class="op" id="1462599">*</span><span class="ident" id="1462600">unsafe</span><span class="op" id="1462606">.</span><span class="ident" id="1462607">Pointer</span><span class="op" id="1462614">,</span>&nbsp;<span class="builtinfunc" id="1462616">new</span>&nbsp;<span class="ident" id="1462620">unsafe</span><span class="op" id="1462626">.</span><span class="ident" id="1462627">Pointer</span><span class="op" id="1462634">)</span>&nbsp;<span class="op" id="1462636">(</span><span class="ident" id="1462637">old</span>&nbsp;<span class="ident" id="1462641">unsafe</span><span class="op" id="1462647">.</span><span class="ident" id="1462648">Pointer</span><span class="op" id="1462655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462658">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462741">func</span>&nbsp;<span class="ident" id="1462746">CompareAndSwapInt32</span><span class="op" id="1462765">(</span><span class="ident" id="1462766">addr</span>&nbsp;<span class="op" id="1462771">*</span><span class="builtintype" id="1462772">int32</span><span class="op" id="1462777">,</span>&nbsp;<span class="ident" id="1462779">old</span><span class="op" id="1462782">,</span>&nbsp;<span class="builtinfunc" id="1462784">new</span>&nbsp;<span class="builtintype" id="1462788">int32</span><span class="op" id="1462793">)</span>&nbsp;<span class="op" id="1462795">(</span><span class="ident" id="1462796">swapped</span>&nbsp;<span class="builtintype" id="1462804">bool</span><span class="op" id="1462808">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1462811">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1462894">func</span>&nbsp;<span class="ident" id="1462899">CompareAndSwapInt64</span><span class="op" id="1462918">(</span><span class="ident" id="1462919">addr</span>&nbsp;<span class="op" id="1462924">*</span><span class="ident" id="1462925">int64</span><span class="op" id="1462930">,</span>&nbsp;<span class="ident" id="1462932">old</span><span class="op" id="1462935">,</span>&nbsp;<span class="builtinfunc" id="1462937">new</span>&nbsp;<span class="ident" id="1462941">int64</span><span class="op" id="1462946">)</span>&nbsp;<span class="op" id="1462948">(</span><span class="ident" id="1462949">swapped</span>&nbsp;<span class="builtintype" id="1462957">bool</span><span class="op" id="1462961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462964">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1463048">func</span>&nbsp;<span class="ident" id="1463053">CompareAndSwapUint32</span><span class="op" id="1463073">(</span><span class="ident" id="1463074">addr</span>&nbsp;<span class="op" id="1463079">*</span><span class="builtintype" id="1463080">uint32</span><span class="op" id="1463086">,</span>&nbsp;<span class="ident" id="1463088">old</span><span class="op" id="1463091">,</span>&nbsp;<span class="builtinfunc" id="1463093">new</span>&nbsp;<span class="builtintype" id="1463097">uint32</span><span class="op" id="1463103">)</span>&nbsp;<span class="op" id="1463105">(</span><span class="ident" id="1463106">swapped</span>&nbsp;<span class="builtintype" id="1463114">bool</span><span class="op" id="1463118">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1463121">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1463205">func</span>&nbsp;<span class="ident" id="1463210">CompareAndSwapUint64</span><span class="op" id="1463230">(</span><span class="ident" id="1463231">addr</span>&nbsp;<span class="op" id="1463236">*</span><span class="ident" id="1463237">uint64</span><span class="op" id="1463243">,</span>&nbsp;<span class="ident" id="1463245">old</span><span class="op" id="1463248">,</span>&nbsp;<span class="builtinfunc" id="1463250">new</span>&nbsp;<span class="ident" id="1463254">uint64</span><span class="op" id="1463260">)</span>&nbsp;<span class="op" id="1463262">(</span><span class="ident" id="1463263">swapped</span>&nbsp;<span class="builtintype" id="1463271">bool</span><span class="op" id="1463275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1463278">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1463364">func</span>&nbsp;<span class="ident" id="1463369">CompareAndSwapUintptr</span><span class="op" id="1463390">(</span><span class="ident" id="1463391">addr</span>&nbsp;<span class="op" id="1463396">*</span><span class="builtintype" id="1463397">uintptr</span><span class="op" id="1463404">,</span>&nbsp;<span class="ident" id="1463406">old</span><span class="op" id="1463409">,</span>&nbsp;<span class="builtinfunc" id="1463411">new</span>&nbsp;<span class="builtintype" id="1463415">uintptr</span><span class="op" id="1463422">)</span>&nbsp;<span class="op" id="1463424">(</span><span class="ident" id="1463425">swapped</span>&nbsp;<span class="builtintype" id="1463433">bool</span><span class="op" id="1463437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1463440">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1463533">func</span>&nbsp;<span class="ident" id="1463538">CompareAndSwapPointer</span><span class="op" id="1463559">(</span><span class="ident" id="1463560">addr</span>&nbsp;<span class="op" id="1463565">*</span><span class="ident" id="1463566">unsafe</span><span class="op" id="1463572">.</span><span class="ident" id="1463573">Pointer</span><span class="op" id="1463580">,</span>&nbsp;<span class="ident" id="1463582">old</span><span class="op" id="1463585">,</span>&nbsp;<span class="builtinfunc" id="1463587">new</span>&nbsp;<span class="ident" id="1463591">unsafe</span><span class="op" id="1463597">.</span><span class="ident" id="1463598">Pointer</span><span class="op" id="1463605">)</span>&nbsp;<span class="op" id="1463607">(</span><span class="ident" id="1463608">swapped</span>&nbsp;<span class="builtintype" id="1463616">bool</span><span class="op" id="1463620">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1463623">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1463693">func</span>&nbsp;<span class="ident" id="1463698">AddInt32</span><span class="op" id="1463706">(</span><span class="ident" id="1463707">addr</span>&nbsp;<span class="op" id="1463712">*</span><span class="builtintype" id="1463713">int32</span><span class="op" id="1463718">,</span>&nbsp;<span class="ident" id="1463720">delta</span>&nbsp;<span class="builtintype" id="1463726">int32</span><span class="op" id="1463731">)</span>&nbsp;<span class="op" id="1463733">(</span><span class="builtinfunc" id="1463734">new</span>&nbsp;<span class="builtintype" id="1463738">int32</span><span class="op" id="1463743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1463746">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1463817">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1463907">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1463971">func</span>&nbsp;<span class="ident" id="1463976">AddUint32</span><span class="op" id="1463985">(</span><span class="ident" id="1463986">addr</span>&nbsp;<span class="op" id="1463991">*</span><span class="builtintype" id="1463992">uint32</span><span class="op" id="1463998">,</span>&nbsp;<span class="ident" id="1464000">delta</span>&nbsp;<span class="builtintype" id="1464006">uint32</span><span class="op" id="1464012">)</span>&nbsp;<span class="op" id="1464014">(</span><span class="builtinfunc" id="1464015">new</span>&nbsp;<span class="builtintype" id="1464019">uint32</span><span class="op" id="1464025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464028">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1464098">func</span>&nbsp;<span class="ident" id="1464103">AddInt64</span><span class="op" id="1464111">(</span><span class="ident" id="1464112">addr</span>&nbsp;<span class="op" id="1464117">*</span><span class="ident" id="1464118">int64</span><span class="op" id="1464123">,</span>&nbsp;<span class="ident" id="1464125">delta</span>&nbsp;<span class="ident" id="1464131">int64</span><span class="op" id="1464136">)</span>&nbsp;<span class="op" id="1464138">(</span><span class="builtinfunc" id="1464139">new</span>&nbsp;<span class="ident" id="1464143">int64</span><span class="op" id="1464148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464151">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1464222">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1464312">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1464376">func</span>&nbsp;<span class="ident" id="1464381">AddUint64</span><span class="op" id="1464390">(</span><span class="ident" id="1464391">addr</span>&nbsp;<span class="op" id="1464396">*</span><span class="ident" id="1464397">uint64</span><span class="op" id="1464403">,</span>&nbsp;<span class="ident" id="1464405">delta</span>&nbsp;<span class="ident" id="1464411">uint64</span><span class="op" id="1464417">)</span>&nbsp;<span class="op" id="1464419">(</span><span class="builtinfunc" id="1464420">new</span>&nbsp;<span class="ident" id="1464424">uint64</span><span class="op" id="1464430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464433">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1464505">func</span>&nbsp;<span class="ident" id="1464510">AddUintptr</span><span class="op" id="1464520">(</span><span class="ident" id="1464521">addr</span>&nbsp;<span class="op" id="1464526">*</span><span class="builtintype" id="1464527">uintptr</span><span class="op" id="1464534">,</span>&nbsp;<span class="ident" id="1464536">delta</span>&nbsp;<span class="builtintype" id="1464542">uintptr</span><span class="op" id="1464549">)</span>&nbsp;<span class="op" id="1464551">(</span><span class="builtinfunc" id="1464552">new</span>&nbsp;<span class="builtintype" id="1464556">uintptr</span><span class="op" id="1464563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1464566">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1464603">func</span>&nbsp;<span class="ident" id="1464608">LoadInt32</span><span class="op" id="1464617">(</span><span class="ident" id="1464618">addr</span>&nbsp;<span class="op" id="1464623">*</span><span class="builtintype" id="1464624">int32</span><span class="op" id="1464629">)</span>&nbsp;<span class="op" id="1464631">(</span><span class="ident" id="1464632">val</span>&nbsp;<span class="builtintype" id="1464636">int32</span><span class="op" id="1464641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464644">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1464681">func</span>&nbsp;<span class="ident" id="1464686">LoadInt64</span><span class="op" id="1464695">(</span><span class="ident" id="1464696">addr</span>&nbsp;<span class="op" id="1464701">*</span><span class="ident" id="1464702">int64</span><span class="op" id="1464707">)</span>&nbsp;<span class="op" id="1464709">(</span><span class="ident" id="1464710">val</span>&nbsp;<span class="ident" id="1464714">int64</span><span class="op" id="1464719">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1464722">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1464760">func</span>&nbsp;<span class="ident" id="1464765">LoadUint32</span><span class="op" id="1464775">(</span><span class="ident" id="1464776">addr</span>&nbsp;<span class="op" id="1464781">*</span><span class="builtintype" id="1464782">uint32</span><span class="op" id="1464788">)</span>&nbsp;<span class="op" id="1464790">(</span><span class="ident" id="1464791">val</span>&nbsp;<span class="builtintype" id="1464795">uint32</span><span class="op" id="1464801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464804">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1464842">func</span>&nbsp;<span class="ident" id="1464847">LoadUint64</span><span class="op" id="1464857">(</span><span class="ident" id="1464858">addr</span>&nbsp;<span class="op" id="1464863">*</span><span class="ident" id="1464864">uint64</span><span class="op" id="1464870">)</span>&nbsp;<span class="op" id="1464872">(</span><span class="ident" id="1464873">val</span>&nbsp;<span class="ident" id="1464877">uint64</span><span class="op" id="1464883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1464886">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1464925">func</span>&nbsp;<span class="ident" id="1464930">LoadUintptr</span><span class="op" id="1464941">(</span><span class="ident" id="1464942">addr</span>&nbsp;<span class="op" id="1464947">*</span><span class="builtintype" id="1464948">uintptr</span><span class="op" id="1464955">)</span>&nbsp;<span class="op" id="1464957">(</span><span class="ident" id="1464958">val</span>&nbsp;<span class="builtintype" id="1464962">uintptr</span><span class="op" id="1464969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1464972">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465011">func</span>&nbsp;<span class="ident" id="1465016">LoadPointer</span><span class="op" id="1465027">(</span><span class="ident" id="1465028">addr</span>&nbsp;<span class="op" id="1465033">*</span><span class="ident" id="1465034">unsafe</span><span class="op" id="1465040">.</span><span class="ident" id="1465041">Pointer</span><span class="op" id="1465048">)</span>&nbsp;<span class="op" id="1465050">(</span><span class="ident" id="1465051">val</span>&nbsp;<span class="ident" id="1465055">unsafe</span><span class="op" id="1465061">.</span><span class="ident" id="1465062">Pointer</span><span class="op" id="1465069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1465072">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465120">func</span>&nbsp;<span class="ident" id="1465125">StoreInt32</span><span class="op" id="1465135">(</span><span class="ident" id="1465136">addr</span>&nbsp;<span class="op" id="1465141">*</span><span class="builtintype" id="1465142">int32</span><span class="op" id="1465147">,</span>&nbsp;<span class="ident" id="1465149">val</span>&nbsp;<span class="builtintype" id="1465153">int32</span><span class="op" id="1465158">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1465161">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465209">func</span>&nbsp;<span class="ident" id="1465214">StoreInt64</span><span class="op" id="1465224">(</span><span class="ident" id="1465225">addr</span>&nbsp;<span class="op" id="1465230">*</span><span class="ident" id="1465231">int64</span><span class="op" id="1465236">,</span>&nbsp;<span class="ident" id="1465238">val</span>&nbsp;<span class="ident" id="1465242">int64</span><span class="op" id="1465247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1465250">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1465299">func</span>&nbsp;<span class="ident" id="1465304">StoreUint32</span><span class="op" id="1465315">(</span><span class="ident" id="1465316">addr</span>&nbsp;<span class="op" id="1465321">*</span><span class="builtintype" id="1465322">uint32</span><span class="op" id="1465328">,</span>&nbsp;<span class="ident" id="1465330">val</span>&nbsp;<span class="builtintype" id="1465334">uint32</span><span class="op" id="1465340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1465343">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465392">func</span>&nbsp;<span class="ident" id="1465397">StoreUint64</span><span class="op" id="1465408">(</span><span class="ident" id="1465409">addr</span>&nbsp;<span class="op" id="1465414">*</span><span class="ident" id="1465415">uint64</span><span class="op" id="1465421">,</span>&nbsp;<span class="ident" id="1465423">val</span>&nbsp;<span class="ident" id="1465427">uint64</span><span class="op" id="1465433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1465436">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465486">func</span>&nbsp;<span class="ident" id="1465491">StoreUintptr</span><span class="op" id="1465503">(</span><span class="ident" id="1465504">addr</span>&nbsp;<span class="op" id="1465509">*</span><span class="builtintype" id="1465510">uintptr</span><span class="op" id="1465517">,</span>&nbsp;<span class="ident" id="1465519">val</span>&nbsp;<span class="builtintype" id="1465523">uintptr</span><span class="op" id="1465530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1465533">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1465583">func</span>&nbsp;<span class="ident" id="1465588">StorePointer</span><span class="op" id="1465600">(</span><span class="ident" id="1465601">addr</span>&nbsp;<span class="op" id="1465606">*</span><span class="ident" id="1465607">unsafe</span><span class="op" id="1465613">.</span><span class="ident" id="1465614">Pointer</span><span class="op" id="1465621">,</span>&nbsp;<span class="ident" id="1465623">val</span>&nbsp;<span class="ident" id="1465627">unsafe</span><span class="op" id="1465633">.</span><span class="ident" id="1465634">Pointer</span><span class="op" id="1465641">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1465644">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1465701">func</span>&nbsp;<span class="ident" id="1465706">panic64</span><span class="op" id="1465713">(</span><span class="op" id="1465714">)</span>&nbsp;<span class="op" id="1465716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1465719">panic</span><span class="op" id="1465724">(</span><span class="string" id="1465725">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1465784">)</span><br>
<span class="lineno"></span><span class="op" id="1465786">}</span>
</div>
</body>
</html>
