<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html" class="current">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8543229">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8543284">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8543338">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8543389">package</span>&nbsp;<span class="ident" id="8543397">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8543404">import</span>&nbsp;<span class="op" id="8543411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8543414">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8543421">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8543434">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8543442">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8543452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8543455">func</span>&nbsp;<span class="ident" id="8543460">checkPos</span><span class="op" id="8543468">(</span><span class="ident" id="8543469">t</span>&nbsp;<span class="op" id="8543471">*</span><span class="ident" id="8543472">testing</span><span class="op" id="8543479">.</span><span class="ident" id="8543480">T</span><span class="op" id="8543481">,</span>&nbsp;<span class="ident" id="8543483">msg</span>&nbsp;<span class="builtintype" id="8543487">string</span><span class="op" id="8543493">,</span>&nbsp;<span class="ident" id="8543495">got</span><span class="op" id="8543498">,</span>&nbsp;<span class="ident" id="8543500">want</span>&nbsp;<span class="ident" id="8543505">Position</span><span class="op" id="8543513">)</span>&nbsp;<span class="op" id="8543515">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8543518">if</span>&nbsp;<span class="ident" id="8543521">got</span><span class="op" id="8543524">.</span><span class="ident" id="8543525">Filename</span>&nbsp;<span class="op" id="8543534">!=</span>&nbsp;<span class="ident" id="8543537">want</span><span class="op" id="8543541">.</span><span class="ident" id="8543542">Filename</span>&nbsp;<span class="op" id="8543551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8543555">t</span><span class="op" id="8543556">.</span><span class="ident" id="8543557">Errorf</span><span class="op" id="8543563">(</span><span class="string" id="8543564">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8543596">,</span>&nbsp;<span class="ident" id="8543598">msg</span><span class="op" id="8543601">,</span>&nbsp;<span class="ident" id="8543603">got</span><span class="op" id="8543606">.</span><span class="ident" id="8543607">Filename</span><span class="op" id="8543615">,</span>&nbsp;<span class="ident" id="8543617">want</span><span class="op" id="8543621">.</span><span class="ident" id="8543622">Filename</span><span class="op" id="8543630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8543633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8543636">if</span>&nbsp;<span class="ident" id="8543639">got</span><span class="op" id="8543642">.</span><span class="ident" id="8543643">Offset</span>&nbsp;<span class="op" id="8543650">!=</span>&nbsp;<span class="ident" id="8543653">want</span><span class="op" id="8543657">.</span><span class="ident" id="8543658">Offset</span>&nbsp;<span class="op" id="8543665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8543669">t</span><span class="op" id="8543670">.</span><span class="ident" id="8543671">Errorf</span><span class="op" id="8543677">(</span><span class="string" id="8543678">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8543708">,</span>&nbsp;<span class="ident" id="8543710">msg</span><span class="op" id="8543713">,</span>&nbsp;<span class="ident" id="8543715">got</span><span class="op" id="8543718">.</span><span class="ident" id="8543719">Offset</span><span class="op" id="8543725">,</span>&nbsp;<span class="ident" id="8543727">want</span><span class="op" id="8543731">.</span><span class="ident" id="8543732">Offset</span><span class="op" id="8543738">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8543741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8543744">if</span>&nbsp;<span class="ident" id="8543747">got</span><span class="op" id="8543750">.</span><span class="ident" id="8543751">Line</span>&nbsp;<span class="op" id="8543756">!=</span>&nbsp;<span class="ident" id="8543759">want</span><span class="op" id="8543763">.</span><span class="ident" id="8543764">Line</span>&nbsp;<span class="op" id="8543769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8543773">t</span><span class="op" id="8543774">.</span><span class="ident" id="8543775">Errorf</span><span class="op" id="8543781">(</span><span class="string" id="8543782">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8543810">,</span>&nbsp;<span class="ident" id="8543812">msg</span><span class="op" id="8543815">,</span>&nbsp;<span class="ident" id="8543817">got</span><span class="op" id="8543820">.</span><span class="ident" id="8543821">Line</span><span class="op" id="8543825">,</span>&nbsp;<span class="ident" id="8543827">want</span><span class="op" id="8543831">.</span><span class="ident" id="8543832">Line</span><span class="op" id="8543836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8543839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8543842">if</span>&nbsp;<span class="ident" id="8543845">got</span><span class="op" id="8543848">.</span><span class="ident" id="8543849">Column</span>&nbsp;<span class="op" id="8543856">!=</span>&nbsp;<span class="ident" id="8543859">want</span><span class="op" id="8543863">.</span><span class="ident" id="8543864">Column</span>&nbsp;<span class="op" id="8543871">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8543875">t</span><span class="op" id="8543876">.</span><span class="ident" id="8543877">Errorf</span><span class="op" id="8543883">(</span><span class="string" id="8543884">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8543914">,</span>&nbsp;<span class="ident" id="8543916">msg</span><span class="op" id="8543919">,</span>&nbsp;<span class="ident" id="8543921">got</span><span class="op" id="8543924">.</span><span class="ident" id="8543925">Column</span><span class="op" id="8543931">,</span>&nbsp;<span class="ident" id="8543933">want</span><span class="op" id="8543937">.</span><span class="ident" id="8543938">Column</span><span class="op" id="8543944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8543947">}</span><br>
<span class="lineno"></span><span class="op" id="8543949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8543952">func</span>&nbsp;<span class="ident" id="8543957">TestNoPos</span><span class="op" id="8543966">(</span><span class="ident" id="8543967">t</span>&nbsp;<span class="op" id="8543969">*</span><span class="ident" id="8543970">testing</span><span class="op" id="8543977">.</span><span class="ident" id="8543978">T</span><span class="op" id="8543979">)</span>&nbsp;<span class="op" id="8543981">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8543984">if</span>&nbsp;<span class="ident" id="8543987">NoPos</span><span class="op" id="8543992">.</span><span class="ident" id="8543993">IsValid</span><span class="op" id="8544000">(</span><span class="op" id="8544001">)</span>&nbsp;<span class="op" id="8544003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544007">t</span><span class="op" id="8544008">.</span><span class="ident" id="8544009">Errorf</span><span class="op" id="8544015">(</span><span class="string" id="8544016">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="8544043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8544049">var</span>&nbsp;<span class="ident" id="8544053">fset</span>&nbsp;<span class="op" id="8544058">*</span><span class="ident" id="8544059">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544068">checkPos</span><span class="op" id="8544076">(</span><span class="ident" id="8544077">t</span><span class="op" id="8544078">,</span>&nbsp;<span class="string" id="8544080">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="8544091">,</span>&nbsp;<span class="ident" id="8544093">fset</span><span class="op" id="8544097">.</span><span class="ident" id="8544098">Position</span><span class="op" id="8544106">(</span><span class="ident" id="8544107">NoPos</span><span class="op" id="8544112">)</span><span class="op" id="8544113">,</span>&nbsp;<span class="ident" id="8544115">Position</span><span class="op" id="8544123">{</span><span class="op" id="8544124">}</span><span class="op" id="8544125">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544128">fset</span>&nbsp;<span class="op" id="8544133">=</span>&nbsp;<span class="ident" id="8544135">NewFileSet</span><span class="op" id="8544145">(</span><span class="op" id="8544146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544149">checkPos</span><span class="op" id="8544157">(</span><span class="ident" id="8544158">t</span><span class="op" id="8544159">,</span>&nbsp;<span class="string" id="8544161">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="8544173">,</span>&nbsp;<span class="ident" id="8544175">fset</span><span class="op" id="8544179">.</span><span class="ident" id="8544180">Position</span><span class="op" id="8544188">(</span><span class="ident" id="8544189">NoPos</span><span class="op" id="8544194">)</span><span class="op" id="8544195">,</span>&nbsp;<span class="ident" id="8544197">Position</span><span class="op" id="8544205">{</span><span class="op" id="8544206">}</span><span class="op" id="8544207">)</span><br>
<span class="lineno"></span><span class="op" id="8544209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8544212">var</span>&nbsp;<span class="ident" id="8544216">tests</span>&nbsp;<span class="op" id="8544222">=</span>&nbsp;<span class="op" id="8544224">[</span><span class="op" id="8544225">]</span><span class="keyword" id="8544226">struct</span>&nbsp;<span class="op" id="8544233">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544236">filename</span>&nbsp;<span class="builtintype" id="8544245">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544253">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8544262">[</span><span class="op" id="8544263">]</span><span class="builtintype" id="8544264">byte</span>&nbsp;<span class="comment" id="8544269">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544284">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8544293">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544298">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544307">[</span><span class="op" id="8544308">]</span><span class="builtintype" id="8544309">int</span><br>
<span class="lineno"></span><span class="op" id="8544313">}</span><span class="op" id="8544314">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544317">{</span><span class="string" id="8544318">&#34;a&#34;</span><span class="op" id="8544321">,</span>&nbsp;<span class="op" id="8544323">[</span><span class="op" id="8544324">]</span><span class="builtintype" id="8544325">byte</span><span class="op" id="8544329">{</span><span class="op" id="8544330">}</span><span class="op" id="8544331">,</span>&nbsp;<span class="num" id="8544333">0</span><span class="op" id="8544334">,</span>&nbsp;<span class="op" id="8544336">[</span><span class="op" id="8544337">]</span><span class="builtintype" id="8544338">int</span><span class="op" id="8544341">{</span><span class="op" id="8544342">}</span><span class="op" id="8544343">}</span><span class="op" id="8544344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544347">{</span><span class="string" id="8544348">&#34;b&#34;</span><span class="op" id="8544351">,</span>&nbsp;<span class="op" id="8544353">[</span><span class="op" id="8544354">]</span><span class="builtintype" id="8544355">byte</span><span class="op" id="8544359">(</span><span class="string" id="8544360">&#34;01234&#34;</span><span class="op" id="8544367">)</span><span class="op" id="8544368">,</span>&nbsp;<span class="num" id="8544370">5</span><span class="op" id="8544371">,</span>&nbsp;<span class="op" id="8544373">[</span><span class="op" id="8544374">]</span><span class="builtintype" id="8544375">int</span><span class="op" id="8544378">{</span><span class="num" id="8544379">0</span><span class="op" id="8544380">}</span><span class="op" id="8544381">}</span><span class="op" id="8544382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544385">{</span><span class="string" id="8544386">&#34;c&#34;</span><span class="op" id="8544389">,</span>&nbsp;<span class="op" id="8544391">[</span><span class="op" id="8544392">]</span><span class="builtintype" id="8544393">byte</span><span class="op" id="8544397">(</span><span class="string" id="8544398">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="8544418">)</span><span class="op" id="8544419">,</span>&nbsp;<span class="num" id="8544421">9</span><span class="op" id="8544422">,</span>&nbsp;<span class="op" id="8544424">[</span><span class="op" id="8544425">]</span><span class="builtintype" id="8544426">int</span><span class="op" id="8544429">{</span><span class="num" id="8544430">0</span><span class="op" id="8544431">,</span>&nbsp;<span class="num" id="8544433">1</span><span class="op" id="8544434">,</span>&nbsp;<span class="num" id="8544436">2</span><span class="op" id="8544437">,</span>&nbsp;<span class="num" id="8544439">3</span><span class="op" id="8544440">,</span>&nbsp;<span class="num" id="8544442">4</span><span class="op" id="8544443">,</span>&nbsp;<span class="num" id="8544445">5</span><span class="op" id="8544446">,</span>&nbsp;<span class="num" id="8544448">6</span><span class="op" id="8544449">,</span>&nbsp;<span class="num" id="8544451">7</span><span class="op" id="8544452">,</span>&nbsp;<span class="num" id="8544454">8</span><span class="op" id="8544455">}</span><span class="op" id="8544456">}</span><span class="op" id="8544457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544460">{</span><span class="string" id="8544461">&#34;d&#34;</span><span class="op" id="8544464">,</span>&nbsp;<span class="ident" id="8544466">nil</span><span class="op" id="8544469">,</span>&nbsp;<span class="num" id="8544471">100</span><span class="op" id="8544474">,</span>&nbsp;<span class="op" id="8544476">[</span><span class="op" id="8544477">]</span><span class="builtintype" id="8544478">int</span><span class="op" id="8544481">{</span><span class="num" id="8544482">0</span><span class="op" id="8544483">,</span>&nbsp;<span class="num" id="8544485">5</span><span class="op" id="8544486">,</span>&nbsp;<span class="num" id="8544488">10</span><span class="op" id="8544490">,</span>&nbsp;<span class="num" id="8544492">20</span><span class="op" id="8544494">,</span>&nbsp;<span class="num" id="8544496">30</span><span class="op" id="8544498">,</span>&nbsp;<span class="num" id="8544500">70</span><span class="op" id="8544502">,</span>&nbsp;<span class="num" id="8544504">71</span><span class="op" id="8544506">,</span>&nbsp;<span class="num" id="8544508">72</span><span class="op" id="8544510">,</span>&nbsp;<span class="num" id="8544512">80</span><span class="op" id="8544514">,</span>&nbsp;<span class="num" id="8544516">85</span><span class="op" id="8544518">,</span>&nbsp;<span class="num" id="8544520">90</span><span class="op" id="8544522">,</span>&nbsp;<span class="num" id="8544524">99</span><span class="op" id="8544526">}</span><span class="op" id="8544527">}</span><span class="op" id="8544528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544531">{</span><span class="string" id="8544532">&#34;e&#34;</span><span class="op" id="8544535">,</span>&nbsp;<span class="ident" id="8544537">nil</span><span class="op" id="8544540">,</span>&nbsp;<span class="num" id="8544542">777</span><span class="op" id="8544545">,</span>&nbsp;<span class="op" id="8544547">[</span><span class="op" id="8544548">]</span><span class="builtintype" id="8544549">int</span><span class="op" id="8544552">{</span><span class="num" id="8544553">0</span><span class="op" id="8544554">,</span>&nbsp;<span class="num" id="8544556">80</span><span class="op" id="8544558">,</span>&nbsp;<span class="num" id="8544560">100</span><span class="op" id="8544563">,</span>&nbsp;<span class="num" id="8544565">120</span><span class="op" id="8544568">,</span>&nbsp;<span class="num" id="8544570">130</span><span class="op" id="8544573">,</span>&nbsp;<span class="num" id="8544575">180</span><span class="op" id="8544578">,</span>&nbsp;<span class="num" id="8544580">267</span><span class="op" id="8544583">,</span>&nbsp;<span class="num" id="8544585">455</span><span class="op" id="8544588">,</span>&nbsp;<span class="num" id="8544590">500</span><span class="op" id="8544593">,</span>&nbsp;<span class="num" id="8544595">567</span><span class="op" id="8544598">,</span>&nbsp;<span class="num" id="8544600">620</span><span class="op" id="8544603">}</span><span class="op" id="8544604">}</span><span class="op" id="8544605">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544608">{</span><span class="string" id="8544609">&#34;f&#34;</span><span class="op" id="8544612">,</span>&nbsp;<span class="op" id="8544614">[</span><span class="op" id="8544615">]</span><span class="builtintype" id="8544616">byte</span><span class="op" id="8544620">(</span><span class="string" id="8544621">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="8544650">)</span><span class="op" id="8544651">,</span>&nbsp;<span class="num" id="8544653">23</span><span class="op" id="8544655">,</span>&nbsp;<span class="op" id="8544657">[</span><span class="op" id="8544658">]</span><span class="builtintype" id="8544659">int</span><span class="op" id="8544662">{</span><span class="num" id="8544663">0</span><span class="op" id="8544664">,</span>&nbsp;<span class="num" id="8544666">10</span><span class="op" id="8544668">,</span>&nbsp;<span class="num" id="8544670">11</span><span class="op" id="8544672">}</span><span class="op" id="8544673">}</span><span class="op" id="8544674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544677">{</span><span class="string" id="8544678">&#34;g&#34;</span><span class="op" id="8544681">,</span>&nbsp;<span class="op" id="8544683">[</span><span class="op" id="8544684">]</span><span class="builtintype" id="8544685">byte</span><span class="op" id="8544689">(</span><span class="string" id="8544690">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="8544721">)</span><span class="op" id="8544722">,</span>&nbsp;<span class="num" id="8544724">24</span><span class="op" id="8544726">,</span>&nbsp;<span class="op" id="8544728">[</span><span class="op" id="8544729">]</span><span class="builtintype" id="8544730">int</span><span class="op" id="8544733">{</span><span class="num" id="8544734">0</span><span class="op" id="8544735">,</span>&nbsp;<span class="num" id="8544737">10</span><span class="op" id="8544739">,</span>&nbsp;<span class="num" id="8544741">11</span><span class="op" id="8544743">}</span><span class="op" id="8544744">}</span><span class="op" id="8544745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544748">{</span><span class="string" id="8544749">&#34;h&#34;</span><span class="op" id="8544752">,</span>&nbsp;<span class="op" id="8544754">[</span><span class="op" id="8544755">]</span><span class="builtintype" id="8544756">byte</span><span class="op" id="8544760">(</span><span class="string" id="8544761">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="8544793">)</span><span class="op" id="8544794">,</span>&nbsp;<span class="num" id="8544796">25</span><span class="op" id="8544798">,</span>&nbsp;<span class="op" id="8544800">[</span><span class="op" id="8544801">]</span><span class="builtintype" id="8544802">int</span><span class="op" id="8544805">{</span><span class="num" id="8544806">0</span><span class="op" id="8544807">,</span>&nbsp;<span class="num" id="8544809">10</span><span class="op" id="8544811">,</span>&nbsp;<span class="num" id="8544813">11</span><span class="op" id="8544815">,</span>&nbsp;<span class="num" id="8544817">24</span><span class="op" id="8544819">}</span><span class="op" id="8544820">}</span><span class="op" id="8544821">,</span><br>
<span class="lineno"></span><span class="op" id="8544823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8544826">func</span>&nbsp;<span class="ident" id="8544831">linecol</span><span class="op" id="8544838">(</span><span class="ident" id="8544839">lines</span>&nbsp;<span class="op" id="8544845">[</span><span class="op" id="8544846">]</span><span class="builtintype" id="8544847">int</span><span class="op" id="8544850">,</span>&nbsp;<span class="ident" id="8544852">offs</span>&nbsp;<span class="builtintype" id="8544857">int</span><span class="op" id="8544860">)</span>&nbsp;<span class="op" id="8544862">(</span><span class="builtintype" id="8544863">int</span><span class="op" id="8544866">,</span>&nbsp;<span class="builtintype" id="8544868">int</span><span class="op" id="8544871">)</span>&nbsp;<span class="op" id="8544873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8544876">prevLineOffs</span>&nbsp;<span class="op" id="8544889">:=</span>&nbsp;<span class="num" id="8544892">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8544895">for</span>&nbsp;<span class="ident" id="8544899">line</span><span class="op" id="8544903">,</span>&nbsp;<span class="ident" id="8544905">lineOffs</span>&nbsp;<span class="op" id="8544914">:=</span>&nbsp;<span class="keyword" id="8544917">range</span>&nbsp;<span class="ident" id="8544923">lines</span>&nbsp;<span class="op" id="8544929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8544933">if</span>&nbsp;<span class="ident" id="8544936">offs</span>&nbsp;<span class="op" id="8544941">&lt;</span>&nbsp;<span class="ident" id="8544943">lineOffs</span>&nbsp;<span class="op" id="8544952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8544957">return</span>&nbsp;<span class="ident" id="8544964">line</span><span class="op" id="8544968">,</span>&nbsp;<span class="ident" id="8544970">offs</span>&nbsp;<span class="op" id="8544975">-</span>&nbsp;<span class="ident" id="8544977">prevLineOffs</span>&nbsp;<span class="op" id="8544990">+</span>&nbsp;<span class="num" id="8544992">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8544996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545000">prevLineOffs</span>&nbsp;<span class="op" id="8545013">=</span>&nbsp;<span class="ident" id="8545015">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8545025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545028">return</span>&nbsp;<span class="builtinfunc" id="8545035">len</span><span class="op" id="8545038">(</span><span class="ident" id="8545039">lines</span><span class="op" id="8545044">)</span><span class="op" id="8545045">,</span>&nbsp;<span class="ident" id="8545047">offs</span>&nbsp;<span class="op" id="8545052">-</span>&nbsp;<span class="ident" id="8545054">prevLineOffs</span>&nbsp;<span class="op" id="8545067">+</span>&nbsp;<span class="num" id="8545069">1</span><br>
<span class="lineno"></span><span class="op" id="8545071">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8545074">func</span>&nbsp;<span class="ident" id="8545079">verifyPositions</span><span class="op" id="8545094">(</span><span class="ident" id="8545095">t</span>&nbsp;<span class="op" id="8545097">*</span><span class="ident" id="8545098">testing</span><span class="op" id="8545105">.</span><span class="ident" id="8545106">T</span><span class="op" id="8545107">,</span>&nbsp;<span class="ident" id="8545109">fset</span>&nbsp;<span class="op" id="8545114">*</span><span class="ident" id="8545115">FileSet</span><span class="op" id="8545122">,</span>&nbsp;<span class="ident" id="8545124">f</span>&nbsp;<span class="op" id="8545126">*</span><span class="ident" id="8545127">File</span><span class="op" id="8545131">,</span>&nbsp;<span class="ident" id="8545133">lines</span>&nbsp;<span class="op" id="8545139">[</span><span class="op" id="8545140">]</span><span class="builtintype" id="8545141">int</span><span class="op" id="8545144">)</span>&nbsp;<span class="op" id="8545146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545149">for</span>&nbsp;<span class="ident" id="8545153">offs</span>&nbsp;<span class="op" id="8545158">:=</span>&nbsp;<span class="num" id="8545161">0</span><span class="op" id="8545162">;</span>&nbsp;<span class="ident" id="8545164">offs</span>&nbsp;<span class="op" id="8545169">&lt;</span>&nbsp;<span class="ident" id="8545171">f</span><span class="op" id="8545172">.</span><span class="ident" id="8545173">Size</span><span class="op" id="8545177">(</span><span class="op" id="8545178">)</span><span class="op" id="8545179">;</span>&nbsp;<span class="ident" id="8545181">offs</span><span class="op" id="8545185">++</span>&nbsp;<span class="op" id="8545188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545192">p</span>&nbsp;<span class="op" id="8545194">:=</span>&nbsp;<span class="ident" id="8545197">f</span><span class="op" id="8545198">.</span><span class="ident" id="8545199">Pos</span><span class="op" id="8545202">(</span><span class="ident" id="8545203">offs</span><span class="op" id="8545207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545211">offs2</span>&nbsp;<span class="op" id="8545217">:=</span>&nbsp;<span class="ident" id="8545220">f</span><span class="op" id="8545221">.</span><span class="ident" id="8545222">Offset</span><span class="op" id="8545228">(</span><span class="ident" id="8545229">p</span><span class="op" id="8545230">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545234">if</span>&nbsp;<span class="ident" id="8545237">offs2</span>&nbsp;<span class="op" id="8545243">!=</span>&nbsp;<span class="ident" id="8545246">offs</span>&nbsp;<span class="op" id="8545251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545256">t</span><span class="op" id="8545257">.</span><span class="ident" id="8545258">Errorf</span><span class="op" id="8545264">(</span><span class="string" id="8545265">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8545301">,</span>&nbsp;<span class="ident" id="8545303">f</span><span class="op" id="8545304">.</span><span class="ident" id="8545305">Name</span><span class="op" id="8545309">(</span><span class="op" id="8545310">)</span><span class="op" id="8545311">,</span>&nbsp;<span class="ident" id="8545313">offs2</span><span class="op" id="8545318">,</span>&nbsp;<span class="ident" id="8545320">offs</span><span class="op" id="8545324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8545328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545332">line</span><span class="op" id="8545336">,</span>&nbsp;<span class="ident" id="8545338">col</span>&nbsp;<span class="op" id="8545342">:=</span>&nbsp;<span class="ident" id="8545345">linecol</span><span class="op" id="8545352">(</span><span class="ident" id="8545353">lines</span><span class="op" id="8545358">,</span>&nbsp;<span class="ident" id="8545360">offs</span><span class="op" id="8545364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545368">msg</span>&nbsp;<span class="op" id="8545372">:=</span>&nbsp;<span class="ident" id="8545375">fmt</span><span class="op" id="8545378">.</span><span class="ident" id="8545379">Sprintf</span><span class="op" id="8545386">(</span><span class="string" id="8545387">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="8545411">,</span>&nbsp;<span class="ident" id="8545413">f</span><span class="op" id="8545414">.</span><span class="ident" id="8545415">Name</span><span class="op" id="8545419">(</span><span class="op" id="8545420">)</span><span class="op" id="8545421">,</span>&nbsp;<span class="ident" id="8545423">offs</span><span class="op" id="8545427">,</span>&nbsp;<span class="ident" id="8545429">p</span><span class="op" id="8545430">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545434">checkPos</span><span class="op" id="8545442">(</span><span class="ident" id="8545443">t</span><span class="op" id="8545444">,</span>&nbsp;<span class="ident" id="8545446">msg</span><span class="op" id="8545449">,</span>&nbsp;<span class="ident" id="8545451">f</span><span class="op" id="8545452">.</span><span class="ident" id="8545453">Position</span><span class="op" id="8545461">(</span><span class="ident" id="8545462">f</span><span class="op" id="8545463">.</span><span class="ident" id="8545464">Pos</span><span class="op" id="8545467">(</span><span class="ident" id="8545468">offs</span><span class="op" id="8545472">)</span><span class="op" id="8545473">)</span><span class="op" id="8545474">,</span>&nbsp;<span class="ident" id="8545476">Position</span><span class="op" id="8545484">{</span><span class="ident" id="8545485">f</span><span class="op" id="8545486">.</span><span class="ident" id="8545487">Name</span><span class="op" id="8545491">(</span><span class="op" id="8545492">)</span><span class="op" id="8545493">,</span>&nbsp;<span class="ident" id="8545495">offs</span><span class="op" id="8545499">,</span>&nbsp;<span class="ident" id="8545501">line</span><span class="op" id="8545505">,</span>&nbsp;<span class="ident" id="8545507">col</span><span class="op" id="8545510">}</span><span class="op" id="8545511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545515">checkPos</span><span class="op" id="8545523">(</span><span class="ident" id="8545524">t</span><span class="op" id="8545525">,</span>&nbsp;<span class="ident" id="8545527">msg</span><span class="op" id="8545530">,</span>&nbsp;<span class="ident" id="8545532">fset</span><span class="op" id="8545536">.</span><span class="ident" id="8545537">Position</span><span class="op" id="8545545">(</span><span class="ident" id="8545546">p</span><span class="op" id="8545547">)</span><span class="op" id="8545548">,</span>&nbsp;<span class="ident" id="8545550">Position</span><span class="op" id="8545558">{</span><span class="ident" id="8545559">f</span><span class="op" id="8545560">.</span><span class="ident" id="8545561">Name</span><span class="op" id="8545565">(</span><span class="op" id="8545566">)</span><span class="op" id="8545567">,</span>&nbsp;<span class="ident" id="8545569">offs</span><span class="op" id="8545573">,</span>&nbsp;<span class="ident" id="8545575">line</span><span class="op" id="8545579">,</span>&nbsp;<span class="ident" id="8545581">col</span><span class="op" id="8545584">}</span><span class="op" id="8545585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8545588">}</span><br>
<span class="lineno"></span><span class="op" id="8545590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8545593">func</span>&nbsp;<span class="ident" id="8545598">makeTestSource</span><span class="op" id="8545612">(</span><span class="ident" id="8545613">size</span>&nbsp;<span class="builtintype" id="8545618">int</span><span class="op" id="8545621">,</span>&nbsp;<span class="ident" id="8545623">lines</span>&nbsp;<span class="op" id="8545629">[</span><span class="op" id="8545630">]</span><span class="builtintype" id="8545631">int</span><span class="op" id="8545634">)</span>&nbsp;<span class="op" id="8545636">[</span><span class="op" id="8545637">]</span><span class="builtintype" id="8545638">byte</span>&nbsp;<span class="op" id="8545643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545646">src</span>&nbsp;<span class="op" id="8545650">:=</span>&nbsp;<span class="builtinfunc" id="8545653">make</span><span class="op" id="8545657">(</span><span class="op" id="8545658">[</span><span class="op" id="8545659">]</span><span class="builtintype" id="8545660">byte</span><span class="op" id="8545664">,</span>&nbsp;<span class="ident" id="8545666">size</span><span class="op" id="8545670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545673">for</span>&nbsp;<span class="ident" id="8545677">_</span><span class="op" id="8545678">,</span>&nbsp;<span class="ident" id="8545680">offs</span>&nbsp;<span class="op" id="8545685">:=</span>&nbsp;<span class="keyword" id="8545688">range</span>&nbsp;<span class="ident" id="8545694">lines</span>&nbsp;<span class="op" id="8545700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545704">if</span>&nbsp;<span class="ident" id="8545707">offs</span>&nbsp;<span class="op" id="8545712">&gt;</span>&nbsp;<span class="num" id="8545714">0</span>&nbsp;<span class="op" id="8545716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545721">src</span><span class="op" id="8545724">[</span><span class="ident" id="8545725">offs</span><span class="op" id="8545729">-</span><span class="num" id="8545730">1</span><span class="op" id="8545731">]</span>&nbsp;<span class="op" id="8545733">=</span>&nbsp;<span class="string" id="8545735">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8545742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8545745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545748">return</span>&nbsp;<span class="ident" id="8545755">src</span><br>
<span class="lineno"></span><span class="op" id="8545759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8545762">func</span>&nbsp;<span class="ident" id="8545767">TestPositions</span><span class="op" id="8545780">(</span><span class="ident" id="8545781">t</span>&nbsp;<span class="op" id="8545783">*</span><span class="ident" id="8545784">testing</span><span class="op" id="8545791">.</span><span class="ident" id="8545792">T</span><span class="op" id="8545793">)</span>&nbsp;<span class="op" id="8545795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545798">const</span>&nbsp;<span class="ident" id="8545804">delta</span>&nbsp;<span class="op" id="8545810">=</span>&nbsp;<span class="num" id="8545812">7</span>&nbsp;<span class="comment" id="8545814">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8545851">fset</span>&nbsp;<span class="op" id="8545856">:=</span>&nbsp;<span class="ident" id="8545859">NewFileSet</span><span class="op" id="8545869">(</span><span class="op" id="8545870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545873">for</span>&nbsp;<span class="ident" id="8545877">_</span><span class="op" id="8545878">,</span>&nbsp;<span class="ident" id="8545880">test</span>&nbsp;<span class="op" id="8545885">:=</span>&nbsp;<span class="keyword" id="8545888">range</span>&nbsp;<span class="ident" id="8545894">tests</span>&nbsp;<span class="op" id="8545900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8545904">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8545941">if</span>&nbsp;<span class="ident" id="8545944">test</span><span class="op" id="8545948">.</span><span class="ident" id="8545949">source</span>&nbsp;<span class="op" id="8545956">!=</span>&nbsp;<span class="ident" id="8545959">nil</span>&nbsp;<span class="op" id="8545963">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8545966">len</span><span class="op" id="8545969">(</span><span class="ident" id="8545970">test</span><span class="op" id="8545974">.</span><span class="ident" id="8545975">source</span><span class="op" id="8545981">)</span>&nbsp;<span class="op" id="8545983">!=</span>&nbsp;<span class="ident" id="8545986">test</span><span class="op" id="8545990">.</span><span class="ident" id="8545991">size</span>&nbsp;<span class="op" id="8545996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546001">t</span><span class="op" id="8546002">.</span><span class="ident" id="8546003">Errorf</span><span class="op" id="8546009">(</span><span class="string" id="8546010">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8546065">,</span>&nbsp;<span class="ident" id="8546067">test</span><span class="op" id="8546071">.</span><span class="ident" id="8546072">filename</span><span class="op" id="8546080">,</span>&nbsp;<span class="builtinfunc" id="8546082">len</span><span class="op" id="8546085">(</span><span class="ident" id="8546086">test</span><span class="op" id="8546090">.</span><span class="ident" id="8546091">source</span><span class="op" id="8546097">)</span><span class="op" id="8546098">,</span>&nbsp;<span class="ident" id="8546100">test</span><span class="op" id="8546104">.</span><span class="ident" id="8546105">size</span><span class="op" id="8546109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8546118">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546157">f</span>&nbsp;<span class="op" id="8546159">:=</span>&nbsp;<span class="ident" id="8546162">fset</span><span class="op" id="8546166">.</span><span class="ident" id="8546167">AddFile</span><span class="op" id="8546174">(</span><span class="ident" id="8546175">test</span><span class="op" id="8546179">.</span><span class="ident" id="8546180">filename</span><span class="op" id="8546188">,</span>&nbsp;<span class="ident" id="8546190">fset</span><span class="op" id="8546194">.</span><span class="ident" id="8546195">Base</span><span class="op" id="8546199">(</span><span class="op" id="8546200">)</span><span class="op" id="8546201">+</span><span class="ident" id="8546202">delta</span><span class="op" id="8546207">,</span>&nbsp;<span class="ident" id="8546209">test</span><span class="op" id="8546213">.</span><span class="ident" id="8546214">size</span><span class="op" id="8546218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546222">if</span>&nbsp;<span class="ident" id="8546225">f</span><span class="op" id="8546226">.</span><span class="ident" id="8546227">Name</span><span class="op" id="8546231">(</span><span class="op" id="8546232">)</span>&nbsp;<span class="op" id="8546234">!=</span>&nbsp;<span class="ident" id="8546237">test</span><span class="op" id="8546241">.</span><span class="ident" id="8546242">filename</span>&nbsp;<span class="op" id="8546251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546256">t</span><span class="op" id="8546257">.</span><span class="ident" id="8546258">Errorf</span><span class="op" id="8546264">(</span><span class="string" id="8546265">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8546291">,</span>&nbsp;<span class="ident" id="8546293">f</span><span class="op" id="8546294">.</span><span class="ident" id="8546295">Name</span><span class="op" id="8546299">(</span><span class="op" id="8546300">)</span><span class="op" id="8546301">,</span>&nbsp;<span class="ident" id="8546303">test</span><span class="op" id="8546307">.</span><span class="ident" id="8546308">filename</span><span class="op" id="8546316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546324">if</span>&nbsp;<span class="ident" id="8546327">f</span><span class="op" id="8546328">.</span><span class="ident" id="8546329">Size</span><span class="op" id="8546333">(</span><span class="op" id="8546334">)</span>&nbsp;<span class="op" id="8546336">!=</span>&nbsp;<span class="ident" id="8546339">test</span><span class="op" id="8546343">.</span><span class="ident" id="8546344">size</span>&nbsp;<span class="op" id="8546349">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546354">t</span><span class="op" id="8546355">.</span><span class="ident" id="8546356">Errorf</span><span class="op" id="8546362">(</span><span class="string" id="8546363">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8546394">,</span>&nbsp;<span class="ident" id="8546396">f</span><span class="op" id="8546397">.</span><span class="ident" id="8546398">Name</span><span class="op" id="8546402">(</span><span class="op" id="8546403">)</span><span class="op" id="8546404">,</span>&nbsp;<span class="ident" id="8546406">f</span><span class="op" id="8546407">.</span><span class="ident" id="8546408">Size</span><span class="op" id="8546412">(</span><span class="op" id="8546413">)</span><span class="op" id="8546414">,</span>&nbsp;<span class="ident" id="8546416">test</span><span class="op" id="8546420">.</span><span class="ident" id="8546421">size</span><span class="op" id="8546425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546433">if</span>&nbsp;<span class="ident" id="8546436">fset</span><span class="op" id="8546440">.</span><span class="ident" id="8546441">File</span><span class="op" id="8546445">(</span><span class="ident" id="8546446">f</span><span class="op" id="8546447">.</span><span class="ident" id="8546448">Pos</span><span class="op" id="8546451">(</span><span class="num" id="8546452">0</span><span class="op" id="8546453">)</span><span class="op" id="8546454">)</span>&nbsp;<span class="op" id="8546456">!=</span>&nbsp;<span class="ident" id="8546459">f</span>&nbsp;<span class="op" id="8546461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546466">t</span><span class="op" id="8546467">.</span><span class="ident" id="8546468">Errorf</span><span class="op" id="8546474">(</span><span class="string" id="8546475">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="8546508">,</span>&nbsp;<span class="ident" id="8546510">f</span><span class="op" id="8546511">.</span><span class="ident" id="8546512">Name</span><span class="op" id="8546516">(</span><span class="op" id="8546517">)</span><span class="op" id="8546518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546522">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8546527">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546580">for</span>&nbsp;<span class="ident" id="8546584">i</span><span class="op" id="8546585">,</span>&nbsp;<span class="ident" id="8546587">offset</span>&nbsp;<span class="op" id="8546594">:=</span>&nbsp;<span class="keyword" id="8546597">range</span>&nbsp;<span class="ident" id="8546603">test</span><span class="op" id="8546607">.</span><span class="ident" id="8546608">lines</span>&nbsp;<span class="op" id="8546614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546619">f</span><span class="op" id="8546620">.</span><span class="ident" id="8546621">AddLine</span><span class="op" id="8546628">(</span><span class="ident" id="8546629">offset</span><span class="op" id="8546635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546640">if</span>&nbsp;<span class="ident" id="8546643">f</span><span class="op" id="8546644">.</span><span class="ident" id="8546645">LineCount</span><span class="op" id="8546654">(</span><span class="op" id="8546655">)</span>&nbsp;<span class="op" id="8546657">!=</span>&nbsp;<span class="ident" id="8546660">i</span><span class="op" id="8546661">+</span><span class="num" id="8546662">1</span>&nbsp;<span class="op" id="8546664">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546670">t</span><span class="op" id="8546671">.</span><span class="ident" id="8546672">Errorf</span><span class="op" id="8546678">(</span><span class="string" id="8546679">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8546720">,</span>&nbsp;<span class="ident" id="8546722">f</span><span class="op" id="8546723">.</span><span class="ident" id="8546724">Name</span><span class="op" id="8546728">(</span><span class="op" id="8546729">)</span><span class="op" id="8546730">,</span>&nbsp;<span class="ident" id="8546732">f</span><span class="op" id="8546733">.</span><span class="ident" id="8546734">LineCount</span><span class="op" id="8546743">(</span><span class="op" id="8546744">)</span><span class="op" id="8546745">,</span>&nbsp;<span class="ident" id="8546747">i</span><span class="op" id="8546748">+</span><span class="num" id="8546749">1</span><span class="op" id="8546750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8546760">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546813">f</span><span class="op" id="8546814">.</span><span class="ident" id="8546815">AddLine</span><span class="op" id="8546822">(</span><span class="ident" id="8546823">offset</span><span class="op" id="8546829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8546834">if</span>&nbsp;<span class="ident" id="8546837">f</span><span class="op" id="8546838">.</span><span class="ident" id="8546839">LineCount</span><span class="op" id="8546848">(</span><span class="op" id="8546849">)</span>&nbsp;<span class="op" id="8546851">!=</span>&nbsp;<span class="ident" id="8546854">i</span><span class="op" id="8546855">+</span><span class="num" id="8546856">1</span>&nbsp;<span class="op" id="8546858">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546864">t</span><span class="op" id="8546865">.</span><span class="ident" id="8546866">Errorf</span><span class="op" id="8546872">(</span><span class="string" id="8546873">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8546924">,</span>&nbsp;<span class="ident" id="8546926">f</span><span class="op" id="8546927">.</span><span class="ident" id="8546928">Name</span><span class="op" id="8546932">(</span><span class="op" id="8546933">)</span><span class="op" id="8546934">,</span>&nbsp;<span class="ident" id="8546936">f</span><span class="op" id="8546937">.</span><span class="ident" id="8546938">LineCount</span><span class="op" id="8546947">(</span><span class="op" id="8546948">)</span><span class="op" id="8546949">,</span>&nbsp;<span class="ident" id="8546951">i</span><span class="op" id="8546952">+</span><span class="num" id="8546953">1</span><span class="op" id="8546954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8546959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8546964">verifyPositions</span><span class="op" id="8546979">(</span><span class="ident" id="8546980">t</span><span class="op" id="8546981">,</span>&nbsp;<span class="ident" id="8546983">fset</span><span class="op" id="8546987">,</span>&nbsp;<span class="ident" id="8546989">f</span><span class="op" id="8546990">,</span>&nbsp;<span class="ident" id="8546992">test</span><span class="op" id="8546996">.</span><span class="ident" id="8546997">lines</span><span class="op" id="8547002">[</span><span class="num" id="8547003">0</span><span class="op" id="8547004">:</span><span class="ident" id="8547005">i</span><span class="op" id="8547006">+</span><span class="num" id="8547007">1</span><span class="op" id="8547008">]</span><span class="op" id="8547009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8547018">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8547072">if</span>&nbsp;<span class="ident" id="8547075">ok</span>&nbsp;<span class="op" id="8547078">:=</span>&nbsp;<span class="ident" id="8547081">f</span><span class="op" id="8547082">.</span><span class="ident" id="8547083">SetLines</span><span class="op" id="8547091">(</span><span class="ident" id="8547092">test</span><span class="op" id="8547096">.</span><span class="ident" id="8547097">lines</span><span class="op" id="8547102">)</span><span class="op" id="8547103">;</span>&nbsp;<span class="op" id="8547105">!</span><span class="ident" id="8547106">ok</span>&nbsp;<span class="op" id="8547109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547114">t</span><span class="op" id="8547115">.</span><span class="ident" id="8547116">Errorf</span><span class="op" id="8547122">(</span><span class="string" id="8547123">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="8547144">,</span>&nbsp;<span class="ident" id="8547146">f</span><span class="op" id="8547147">.</span><span class="ident" id="8547148">Name</span><span class="op" id="8547152">(</span><span class="op" id="8547153">)</span><span class="op" id="8547154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8547162">if</span>&nbsp;<span class="ident" id="8547165">f</span><span class="op" id="8547166">.</span><span class="ident" id="8547167">LineCount</span><span class="op" id="8547176">(</span><span class="op" id="8547177">)</span>&nbsp;<span class="op" id="8547179">!=</span>&nbsp;<span class="builtinfunc" id="8547182">len</span><span class="op" id="8547185">(</span><span class="ident" id="8547186">test</span><span class="op" id="8547190">.</span><span class="ident" id="8547191">lines</span><span class="op" id="8547196">)</span>&nbsp;<span class="op" id="8547198">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547203">t</span><span class="op" id="8547204">.</span><span class="ident" id="8547205">Errorf</span><span class="op" id="8547211">(</span><span class="string" id="8547212">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8547254">,</span>&nbsp;<span class="ident" id="8547256">f</span><span class="op" id="8547257">.</span><span class="ident" id="8547258">Name</span><span class="op" id="8547262">(</span><span class="op" id="8547263">)</span><span class="op" id="8547264">,</span>&nbsp;<span class="ident" id="8547266">f</span><span class="op" id="8547267">.</span><span class="ident" id="8547268">LineCount</span><span class="op" id="8547277">(</span><span class="op" id="8547278">)</span><span class="op" id="8547279">,</span>&nbsp;<span class="builtinfunc" id="8547281">len</span><span class="op" id="8547284">(</span><span class="ident" id="8547285">test</span><span class="op" id="8547289">.</span><span class="ident" id="8547290">lines</span><span class="op" id="8547295">)</span><span class="op" id="8547296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547304">verifyPositions</span><span class="op" id="8547319">(</span><span class="ident" id="8547320">t</span><span class="op" id="8547321">,</span>&nbsp;<span class="ident" id="8547323">fset</span><span class="op" id="8547327">,</span>&nbsp;<span class="ident" id="8547329">f</span><span class="op" id="8547330">,</span>&nbsp;<span class="ident" id="8547332">test</span><span class="op" id="8547336">.</span><span class="ident" id="8547337">lines</span><span class="op" id="8547342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8547347">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547411">src</span>&nbsp;<span class="op" id="8547415">:=</span>&nbsp;<span class="ident" id="8547418">test</span><span class="op" id="8547422">.</span><span class="ident" id="8547423">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8547432">if</span>&nbsp;<span class="ident" id="8547435">src</span>&nbsp;<span class="op" id="8547439">==</span>&nbsp;<span class="ident" id="8547442">nil</span>&nbsp;<span class="op" id="8547446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8547451">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547508">src</span>&nbsp;<span class="op" id="8547512">=</span>&nbsp;<span class="ident" id="8547514">makeTestSource</span><span class="op" id="8547528">(</span><span class="ident" id="8547529">test</span><span class="op" id="8547533">.</span><span class="ident" id="8547534">size</span><span class="op" id="8547538">,</span>&nbsp;<span class="ident" id="8547540">test</span><span class="op" id="8547544">.</span><span class="ident" id="8547545">lines</span><span class="op" id="8547550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547554">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547558">f</span><span class="op" id="8547559">.</span><span class="ident" id="8547560">SetLinesForContent</span><span class="op" id="8547578">(</span><span class="ident" id="8547579">src</span><span class="op" id="8547582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8547586">if</span>&nbsp;<span class="ident" id="8547589">f</span><span class="op" id="8547590">.</span><span class="ident" id="8547591">LineCount</span><span class="op" id="8547600">(</span><span class="op" id="8547601">)</span>&nbsp;<span class="op" id="8547603">!=</span>&nbsp;<span class="builtinfunc" id="8547606">len</span><span class="op" id="8547609">(</span><span class="ident" id="8547610">test</span><span class="op" id="8547614">.</span><span class="ident" id="8547615">lines</span><span class="op" id="8547620">)</span>&nbsp;<span class="op" id="8547622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547627">t</span><span class="op" id="8547628">.</span><span class="ident" id="8547629">Errorf</span><span class="op" id="8547635">(</span><span class="string" id="8547636">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8547688">,</span>&nbsp;<span class="ident" id="8547690">f</span><span class="op" id="8547691">.</span><span class="ident" id="8547692">Name</span><span class="op" id="8547696">(</span><span class="op" id="8547697">)</span><span class="op" id="8547698">,</span>&nbsp;<span class="ident" id="8547700">f</span><span class="op" id="8547701">.</span><span class="ident" id="8547702">LineCount</span><span class="op" id="8547711">(</span><span class="op" id="8547712">)</span><span class="op" id="8547713">,</span>&nbsp;<span class="builtinfunc" id="8547715">len</span><span class="op" id="8547718">(</span><span class="ident" id="8547719">test</span><span class="op" id="8547723">.</span><span class="ident" id="8547724">lines</span><span class="op" id="8547729">)</span><span class="op" id="8547730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547738">verifyPositions</span><span class="op" id="8547753">(</span><span class="ident" id="8547754">t</span><span class="op" id="8547755">,</span>&nbsp;<span class="ident" id="8547757">fset</span><span class="op" id="8547761">,</span>&nbsp;<span class="ident" id="8547763">f</span><span class="op" id="8547764">,</span>&nbsp;<span class="ident" id="8547766">test</span><span class="op" id="8547770">.</span><span class="ident" id="8547771">lines</span><span class="op" id="8547776">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8547779">}</span><br>
<span class="lineno"></span><span class="op" id="8547781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8547784">func</span>&nbsp;<span class="ident" id="8547789">TestLineInfo</span><span class="op" id="8547801">(</span><span class="ident" id="8547802">t</span>&nbsp;<span class="op" id="8547804">*</span><span class="ident" id="8547805">testing</span><span class="op" id="8547812">.</span><span class="ident" id="8547813">T</span><span class="op" id="8547814">)</span>&nbsp;<span class="op" id="8547816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547819">fset</span>&nbsp;<span class="op" id="8547824">:=</span>&nbsp;<span class="ident" id="8547827">NewFileSet</span><span class="op" id="8547837">(</span><span class="op" id="8547838">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547841">f</span>&nbsp;<span class="op" id="8547843">:=</span>&nbsp;<span class="ident" id="8547846">fset</span><span class="op" id="8547850">.</span><span class="ident" id="8547851">AddFile</span><span class="op" id="8547858">(</span><span class="string" id="8547859">&#34;foo&#34;</span><span class="op" id="8547864">,</span>&nbsp;<span class="ident" id="8547866">fset</span><span class="op" id="8547870">.</span><span class="ident" id="8547871">Base</span><span class="op" id="8547875">(</span><span class="op" id="8547876">)</span><span class="op" id="8547877">,</span>&nbsp;<span class="num" id="8547879">500</span><span class="op" id="8547882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8547885">lines</span>&nbsp;<span class="op" id="8547891">:=</span>&nbsp;<span class="op" id="8547894">[</span><span class="op" id="8547895">]</span><span class="builtintype" id="8547896">int</span><span class="op" id="8547899">{</span><span class="num" id="8547900">0</span><span class="op" id="8547901">,</span>&nbsp;<span class="num" id="8547903">42</span><span class="op" id="8547905">,</span>&nbsp;<span class="num" id="8547907">77</span><span class="op" id="8547909">,</span>&nbsp;<span class="num" id="8547911">100</span><span class="op" id="8547914">,</span>&nbsp;<span class="num" id="8547916">210</span><span class="op" id="8547919">,</span>&nbsp;<span class="num" id="8547921">220</span><span class="op" id="8547924">,</span>&nbsp;<span class="num" id="8547926">277</span><span class="op" id="8547929">,</span>&nbsp;<span class="num" id="8547931">300</span><span class="op" id="8547934">,</span>&nbsp;<span class="num" id="8547936">333</span><span class="op" id="8547939">,</span>&nbsp;<span class="num" id="8547941">401</span><span class="op" id="8547944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8547947">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548015">for</span>&nbsp;<span class="ident" id="8548019">_</span><span class="op" id="8548020">,</span>&nbsp;<span class="ident" id="8548022">offs</span>&nbsp;<span class="op" id="8548027">:=</span>&nbsp;<span class="keyword" id="8548030">range</span>&nbsp;<span class="ident" id="8548036">lines</span>&nbsp;<span class="op" id="8548042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548046">f</span><span class="op" id="8548047">.</span><span class="ident" id="8548048">AddLine</span><span class="op" id="8548055">(</span><span class="ident" id="8548056">offs</span><span class="op" id="8548060">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548064">f</span><span class="op" id="8548065">.</span><span class="ident" id="8548066">AddLineInfo</span><span class="op" id="8548077">(</span><span class="ident" id="8548078">offs</span><span class="op" id="8548082">,</span>&nbsp;<span class="string" id="8548084">&#34;bar&#34;</span><span class="op" id="8548089">,</span>&nbsp;<span class="num" id="8548091">42</span><span class="op" id="8548093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8548099">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548136">for</span>&nbsp;<span class="ident" id="8548140">offs</span>&nbsp;<span class="op" id="8548145">:=</span>&nbsp;<span class="num" id="8548148">0</span><span class="op" id="8548149">;</span>&nbsp;<span class="ident" id="8548151">offs</span>&nbsp;<span class="op" id="8548156">&lt;=</span>&nbsp;<span class="ident" id="8548159">f</span><span class="op" id="8548160">.</span><span class="ident" id="8548161">Size</span><span class="op" id="8548165">(</span><span class="op" id="8548166">)</span><span class="op" id="8548167">;</span>&nbsp;<span class="ident" id="8548169">offs</span><span class="op" id="8548173">++</span>&nbsp;<span class="op" id="8548176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548180">p</span>&nbsp;<span class="op" id="8548182">:=</span>&nbsp;<span class="ident" id="8548185">f</span><span class="op" id="8548186">.</span><span class="ident" id="8548187">Pos</span><span class="op" id="8548190">(</span><span class="ident" id="8548191">offs</span><span class="op" id="8548195">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548199">_</span><span class="op" id="8548200">,</span>&nbsp;<span class="ident" id="8548202">col</span>&nbsp;<span class="op" id="8548206">:=</span>&nbsp;<span class="ident" id="8548209">linecol</span><span class="op" id="8548216">(</span><span class="ident" id="8548217">lines</span><span class="op" id="8548222">,</span>&nbsp;<span class="ident" id="8548224">offs</span><span class="op" id="8548228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548232">msg</span>&nbsp;<span class="op" id="8548236">:=</span>&nbsp;<span class="ident" id="8548239">fmt</span><span class="op" id="8548242">.</span><span class="ident" id="8548243">Sprintf</span><span class="op" id="8548250">(</span><span class="string" id="8548251">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="8548275">,</span>&nbsp;<span class="ident" id="8548277">f</span><span class="op" id="8548278">.</span><span class="ident" id="8548279">Name</span><span class="op" id="8548283">(</span><span class="op" id="8548284">)</span><span class="op" id="8548285">,</span>&nbsp;<span class="ident" id="8548287">offs</span><span class="op" id="8548291">,</span>&nbsp;<span class="ident" id="8548293">p</span><span class="op" id="8548294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548298">checkPos</span><span class="op" id="8548306">(</span><span class="ident" id="8548307">t</span><span class="op" id="8548308">,</span>&nbsp;<span class="ident" id="8548310">msg</span><span class="op" id="8548313">,</span>&nbsp;<span class="ident" id="8548315">f</span><span class="op" id="8548316">.</span><span class="ident" id="8548317">Position</span><span class="op" id="8548325">(</span><span class="ident" id="8548326">f</span><span class="op" id="8548327">.</span><span class="ident" id="8548328">Pos</span><span class="op" id="8548331">(</span><span class="ident" id="8548332">offs</span><span class="op" id="8548336">)</span><span class="op" id="8548337">)</span><span class="op" id="8548338">,</span>&nbsp;<span class="ident" id="8548340">Position</span><span class="op" id="8548348">{</span><span class="string" id="8548349">&#34;bar&#34;</span><span class="op" id="8548354">,</span>&nbsp;<span class="ident" id="8548356">offs</span><span class="op" id="8548360">,</span>&nbsp;<span class="num" id="8548362">42</span><span class="op" id="8548364">,</span>&nbsp;<span class="ident" id="8548366">col</span><span class="op" id="8548369">}</span><span class="op" id="8548370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548374">checkPos</span><span class="op" id="8548382">(</span><span class="ident" id="8548383">t</span><span class="op" id="8548384">,</span>&nbsp;<span class="ident" id="8548386">msg</span><span class="op" id="8548389">,</span>&nbsp;<span class="ident" id="8548391">fset</span><span class="op" id="8548395">.</span><span class="ident" id="8548396">Position</span><span class="op" id="8548404">(</span><span class="ident" id="8548405">p</span><span class="op" id="8548406">)</span><span class="op" id="8548407">,</span>&nbsp;<span class="ident" id="8548409">Position</span><span class="op" id="8548417">{</span><span class="string" id="8548418">&#34;bar&#34;</span><span class="op" id="8548423">,</span>&nbsp;<span class="ident" id="8548425">offs</span><span class="op" id="8548429">,</span>&nbsp;<span class="num" id="8548431">42</span><span class="op" id="8548433">,</span>&nbsp;<span class="ident" id="8548435">col</span><span class="op" id="8548438">}</span><span class="op" id="8548439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548442">}</span><br>
<span class="lineno">165</span><span class="op" id="8548444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8548447">func</span>&nbsp;<span class="ident" id="8548452">TestFiles</span><span class="op" id="8548461">(</span><span class="ident" id="8548462">t</span>&nbsp;<span class="op" id="8548464">*</span><span class="ident" id="8548465">testing</span><span class="op" id="8548472">.</span><span class="ident" id="8548473">T</span><span class="op" id="8548474">)</span>&nbsp;<span class="op" id="8548476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548479">fset</span>&nbsp;<span class="op" id="8548484">:=</span>&nbsp;<span class="ident" id="8548487">NewFileSet</span><span class="op" id="8548497">(</span><span class="op" id="8548498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548501">for</span>&nbsp;<span class="ident" id="8548505">i</span><span class="op" id="8548506">,</span>&nbsp;<span class="ident" id="8548508">test</span>&nbsp;<span class="op" id="8548513">:=</span>&nbsp;<span class="keyword" id="8548516">range</span>&nbsp;<span class="ident" id="8548522">tests</span>&nbsp;<span class="op" id="8548528">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548532">base</span>&nbsp;<span class="op" id="8548537">:=</span>&nbsp;<span class="ident" id="8548540">fset</span><span class="op" id="8548544">.</span><span class="ident" id="8548545">Base</span><span class="op" id="8548549">(</span><span class="op" id="8548550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548554">if</span>&nbsp;<span class="ident" id="8548557">i</span><span class="op" id="8548558">%</span><span class="num" id="8548559">2</span>&nbsp;<span class="op" id="8548561">==</span>&nbsp;<span class="num" id="8548564">1</span>&nbsp;<span class="op" id="8548566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8548571">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8548618">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548659">base</span>&nbsp;<span class="op" id="8548664">=</span>&nbsp;<span class="op" id="8548666">-</span><span class="num" id="8548667">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548675">fset</span><span class="op" id="8548679">.</span><span class="ident" id="8548680">AddFile</span><span class="op" id="8548687">(</span><span class="ident" id="8548688">test</span><span class="op" id="8548692">.</span><span class="ident" id="8548693">filename</span><span class="op" id="8548701">,</span>&nbsp;<span class="ident" id="8548703">base</span><span class="op" id="8548707">,</span>&nbsp;<span class="ident" id="8548709">test</span><span class="op" id="8548713">.</span><span class="ident" id="8548714">size</span><span class="op" id="8548718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548722">j</span>&nbsp;<span class="op" id="8548724">:=</span>&nbsp;<span class="num" id="8548727">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548731">fset</span><span class="op" id="8548735">.</span><span class="ident" id="8548736">Iterate</span><span class="op" id="8548743">(</span><span class="keyword" id="8548744">func</span><span class="op" id="8548748">(</span><span class="ident" id="8548749">f</span>&nbsp;<span class="op" id="8548751">*</span><span class="ident" id="8548752">File</span><span class="op" id="8548756">)</span>&nbsp;<span class="builtintype" id="8548758">bool</span>&nbsp;<span class="op" id="8548763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548768">if</span>&nbsp;<span class="ident" id="8548771">f</span><span class="op" id="8548772">.</span><span class="ident" id="8548773">Name</span><span class="op" id="8548777">(</span><span class="op" id="8548778">)</span>&nbsp;<span class="op" id="8548780">!=</span>&nbsp;<span class="ident" id="8548783">tests</span><span class="op" id="8548788">[</span><span class="ident" id="8548789">j</span><span class="op" id="8548790">]</span><span class="op" id="8548791">.</span><span class="ident" id="8548792">filename</span>&nbsp;<span class="op" id="8548801">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548807">t</span><span class="op" id="8548808">.</span><span class="ident" id="8548809">Errorf</span><span class="op" id="8548815">(</span><span class="string" id="8548816">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8548844">,</span>&nbsp;<span class="ident" id="8548846">f</span><span class="op" id="8548847">.</span><span class="ident" id="8548848">Name</span><span class="op" id="8548852">(</span><span class="op" id="8548853">)</span><span class="op" id="8548854">,</span>&nbsp;<span class="ident" id="8548856">tests</span><span class="op" id="8548861">[</span><span class="ident" id="8548862">j</span><span class="op" id="8548863">]</span><span class="op" id="8548864">.</span><span class="ident" id="8548865">filename</span><span class="op" id="8548873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548883">j</span><span class="op" id="8548884">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548890">return</span>&nbsp;<span class="builtintype" id="8548897">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548904">}</span><span class="op" id="8548905">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8548909">if</span>&nbsp;<span class="ident" id="8548912">j</span>&nbsp;<span class="op" id="8548914">!=</span>&nbsp;<span class="ident" id="8548917">i</span><span class="op" id="8548918">+</span><span class="num" id="8548919">1</span>&nbsp;<span class="op" id="8548921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8548926">t</span><span class="op" id="8548927">.</span><span class="ident" id="8548928">Errorf</span><span class="op" id="8548934">(</span><span class="string" id="8548935">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8548958">,</span>&nbsp;<span class="ident" id="8548960">j</span><span class="op" id="8548961">,</span>&nbsp;<span class="ident" id="8548963">i</span><span class="op" id="8548964">+</span><span class="num" id="8548965">1</span><span class="op" id="8548966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8548973">}</span><br>
<span class="lineno"></span><span class="op" id="8548975">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="8548978">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="8549051">func</span>&nbsp;<span class="ident" id="8549056">TestFileSetPastEnd</span><span class="op" id="8549074">(</span><span class="ident" id="8549075">t</span>&nbsp;<span class="op" id="8549077">*</span><span class="ident" id="8549078">testing</span><span class="op" id="8549085">.</span><span class="ident" id="8549086">T</span><span class="op" id="8549087">)</span>&nbsp;<span class="op" id="8549089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549092">fset</span>&nbsp;<span class="op" id="8549097">:=</span>&nbsp;<span class="ident" id="8549100">NewFileSet</span><span class="op" id="8549110">(</span><span class="op" id="8549111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549114">for</span>&nbsp;<span class="ident" id="8549118">_</span><span class="op" id="8549119">,</span>&nbsp;<span class="ident" id="8549121">test</span>&nbsp;<span class="op" id="8549126">:=</span>&nbsp;<span class="keyword" id="8549129">range</span>&nbsp;<span class="ident" id="8549135">tests</span>&nbsp;<span class="op" id="8549141">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549145">fset</span><span class="op" id="8549149">.</span><span class="ident" id="8549150">AddFile</span><span class="op" id="8549157">(</span><span class="ident" id="8549158">test</span><span class="op" id="8549162">.</span><span class="ident" id="8549163">filename</span><span class="op" id="8549171">,</span>&nbsp;<span class="ident" id="8549173">fset</span><span class="op" id="8549177">.</span><span class="ident" id="8549178">Base</span><span class="op" id="8549182">(</span><span class="op" id="8549183">)</span><span class="op" id="8549184">,</span>&nbsp;<span class="ident" id="8549186">test</span><span class="op" id="8549190">.</span><span class="ident" id="8549191">size</span><span class="op" id="8549195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549201">if</span>&nbsp;<span class="ident" id="8549204">f</span>&nbsp;<span class="op" id="8549206">:=</span>&nbsp;<span class="ident" id="8549209">fset</span><span class="op" id="8549213">.</span><span class="ident" id="8549214">File</span><span class="op" id="8549218">(</span><span class="ident" id="8549219">Pos</span><span class="op" id="8549222">(</span><span class="ident" id="8549223">fset</span><span class="op" id="8549227">.</span><span class="ident" id="8549228">Base</span><span class="op" id="8549232">(</span><span class="op" id="8549233">)</span><span class="op" id="8549234">)</span><span class="op" id="8549235">)</span><span class="op" id="8549236">;</span>&nbsp;<span class="ident" id="8549238">f</span>&nbsp;<span class="op" id="8549240">!=</span>&nbsp;<span class="ident" id="8549243">nil</span>&nbsp;<span class="op" id="8549247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549251">t</span><span class="op" id="8549252">.</span><span class="ident" id="8549253">Errorf</span><span class="op" id="8549259">(</span><span class="string" id="8549260">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="8549278">,</span>&nbsp;<span class="ident" id="8549280">f</span><span class="op" id="8549281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549284">}</span><br>
<span class="lineno">200</span><span class="op" id="8549286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8549289">func</span>&nbsp;<span class="ident" id="8549294">TestFileSetCacheUnlikely</span><span class="op" id="8549318">(</span><span class="ident" id="8549319">t</span>&nbsp;<span class="op" id="8549321">*</span><span class="ident" id="8549322">testing</span><span class="op" id="8549329">.</span><span class="ident" id="8549330">T</span><span class="op" id="8549331">)</span>&nbsp;<span class="op" id="8549333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549336">fset</span>&nbsp;<span class="op" id="8549341">:=</span>&nbsp;<span class="ident" id="8549344">NewFileSet</span><span class="op" id="8549354">(</span><span class="op" id="8549355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549358">offsets</span>&nbsp;<span class="op" id="8549366">:=</span>&nbsp;<span class="builtinfunc" id="8549369">make</span><span class="op" id="8549373">(</span><span class="keyword" id="8549374">map</span><span class="op" id="8549377">[</span><span class="builtintype" id="8549378">string</span><span class="op" id="8549384">]</span><span class="builtintype" id="8549385">int</span><span class="op" id="8549388">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549391">for</span>&nbsp;<span class="ident" id="8549395">_</span><span class="op" id="8549396">,</span>&nbsp;<span class="ident" id="8549398">test</span>&nbsp;<span class="op" id="8549403">:=</span>&nbsp;<span class="keyword" id="8549406">range</span>&nbsp;<span class="ident" id="8549412">tests</span>&nbsp;<span class="op" id="8549418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549422">offsets</span><span class="op" id="8549429">[</span><span class="ident" id="8549430">test</span><span class="op" id="8549434">.</span><span class="ident" id="8549435">filename</span><span class="op" id="8549443">]</span>&nbsp;<span class="op" id="8549445">=</span>&nbsp;<span class="ident" id="8549447">fset</span><span class="op" id="8549451">.</span><span class="ident" id="8549452">Base</span><span class="op" id="8549456">(</span><span class="op" id="8549457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549461">fset</span><span class="op" id="8549465">.</span><span class="ident" id="8549466">AddFile</span><span class="op" id="8549473">(</span><span class="ident" id="8549474">test</span><span class="op" id="8549478">.</span><span class="ident" id="8549479">filename</span><span class="op" id="8549487">,</span>&nbsp;<span class="ident" id="8549489">fset</span><span class="op" id="8549493">.</span><span class="ident" id="8549494">Base</span><span class="op" id="8549498">(</span><span class="op" id="8549499">)</span><span class="op" id="8549500">,</span>&nbsp;<span class="ident" id="8549502">test</span><span class="op" id="8549506">.</span><span class="ident" id="8549507">size</span><span class="op" id="8549511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549517">for</span>&nbsp;<span class="ident" id="8549521">file</span><span class="op" id="8549525">,</span>&nbsp;<span class="ident" id="8549527">pos</span>&nbsp;<span class="op" id="8549531">:=</span>&nbsp;<span class="keyword" id="8549534">range</span>&nbsp;<span class="ident" id="8549540">offsets</span>&nbsp;<span class="op" id="8549548">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549552">f</span>&nbsp;<span class="op" id="8549554">:=</span>&nbsp;<span class="ident" id="8549557">fset</span><span class="op" id="8549561">.</span><span class="ident" id="8549562">File</span><span class="op" id="8549566">(</span><span class="ident" id="8549567">Pos</span><span class="op" id="8549570">(</span><span class="ident" id="8549571">pos</span><span class="op" id="8549574">)</span><span class="op" id="8549575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549579">if</span>&nbsp;<span class="ident" id="8549582">f</span><span class="op" id="8549583">.</span><span class="ident" id="8549584">Name</span><span class="op" id="8549588">(</span><span class="op" id="8549589">)</span>&nbsp;<span class="op" id="8549591">!=</span>&nbsp;<span class="ident" id="8549594">file</span>&nbsp;<span class="op" id="8549599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549604">t</span><span class="op" id="8549605">.</span><span class="ident" id="8549606">Errorf</span><span class="op" id="8549612">(</span><span class="string" id="8549613">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8549645">,</span>&nbsp;<span class="ident" id="8549647">f</span><span class="op" id="8549648">.</span><span class="ident" id="8549649">Name</span><span class="op" id="8549653">(</span><span class="op" id="8549654">)</span><span class="op" id="8549655">,</span>&nbsp;<span class="ident" id="8549657">pos</span><span class="op" id="8549660">,</span>&nbsp;<span class="ident" id="8549662">file</span><span class="op" id="8549666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549673">}</span><br>
<span class="lineno">215</span><span class="op" id="8549675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8549678">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8549747">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="8549786">func</span>&nbsp;<span class="ident" id="8549791">TestFileSetRace</span><span class="op" id="8549806">(</span><span class="ident" id="8549807">t</span>&nbsp;<span class="op" id="8549809">*</span><span class="ident" id="8549810">testing</span><span class="op" id="8549817">.</span><span class="ident" id="8549818">T</span><span class="op" id="8549819">)</span>&nbsp;<span class="op" id="8549821">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549824">fset</span>&nbsp;<span class="op" id="8549829">:=</span>&nbsp;<span class="ident" id="8549832">NewFileSet</span><span class="op" id="8549842">(</span><span class="op" id="8549843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549846">for</span>&nbsp;<span class="ident" id="8549850">i</span>&nbsp;<span class="op" id="8549852">:=</span>&nbsp;<span class="num" id="8549855">0</span><span class="op" id="8549856">;</span>&nbsp;<span class="ident" id="8549858">i</span>&nbsp;<span class="op" id="8549860">&lt;</span>&nbsp;<span class="num" id="8549862">100</span><span class="op" id="8549865">;</span>&nbsp;<span class="ident" id="8549867">i</span><span class="op" id="8549868">++</span>&nbsp;<span class="op" id="8549871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549875">fset</span><span class="op" id="8549879">.</span><span class="ident" id="8549880">AddFile</span><span class="op" id="8549887">(</span><span class="ident" id="8549888">fmt</span><span class="op" id="8549891">.</span><span class="ident" id="8549892">Sprintf</span><span class="op" id="8549899">(</span><span class="string" id="8549900">&#34;file-%d&#34;</span><span class="op" id="8549909">,</span>&nbsp;<span class="ident" id="8549911">i</span><span class="op" id="8549912">)</span><span class="op" id="8549913">,</span>&nbsp;<span class="ident" id="8549915">fset</span><span class="op" id="8549919">.</span><span class="ident" id="8549920">Base</span><span class="op" id="8549924">(</span><span class="op" id="8549925">)</span><span class="op" id="8549926">,</span>&nbsp;<span class="num" id="8549928">1031</span><span class="op" id="8549932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8549935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549938">max</span>&nbsp;<span class="op" id="8549942">:=</span>&nbsp;<span class="builtintype" id="8549945">int32</span><span class="op" id="8549950">(</span><span class="ident" id="8549951">fset</span><span class="op" id="8549955">.</span><span class="ident" id="8549956">Base</span><span class="op" id="8549960">(</span><span class="op" id="8549961">)</span><span class="op" id="8549962">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8549965">var</span>&nbsp;<span class="ident" id="8549969">stop</span>&nbsp;<span class="ident" id="8549974">sync</span><span class="op" id="8549978">.</span><span class="ident" id="8549979">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8549990">r</span>&nbsp;<span class="op" id="8549992">:=</span>&nbsp;<span class="ident" id="8549995">rand</span><span class="op" id="8549999">.</span><span class="ident" id="8550000">New</span><span class="op" id="8550003">(</span><span class="ident" id="8550004">rand</span><span class="op" id="8550008">.</span><span class="ident" id="8550009">NewSource</span><span class="op" id="8550018">(</span><span class="num" id="8550019">7</span><span class="op" id="8550020">)</span><span class="op" id="8550021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550024">for</span>&nbsp;<span class="ident" id="8550028">i</span>&nbsp;<span class="op" id="8550030">:=</span>&nbsp;<span class="num" id="8550033">0</span><span class="op" id="8550034">;</span>&nbsp;<span class="ident" id="8550036">i</span>&nbsp;<span class="op" id="8550038">&lt;</span>&nbsp;<span class="num" id="8550040">2</span><span class="op" id="8550041">;</span>&nbsp;<span class="ident" id="8550043">i</span><span class="op" id="8550044">++</span>&nbsp;<span class="op" id="8550047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550051">r</span>&nbsp;<span class="op" id="8550053">:=</span>&nbsp;<span class="ident" id="8550056">rand</span><span class="op" id="8550060">.</span><span class="ident" id="8550061">New</span><span class="op" id="8550064">(</span><span class="ident" id="8550065">rand</span><span class="op" id="8550069">.</span><span class="ident" id="8550070">NewSource</span><span class="op" id="8550079">(</span><span class="ident" id="8550080">r</span><span class="op" id="8550081">.</span><span class="ident" id="8550082">Int63</span><span class="op" id="8550087">(</span><span class="op" id="8550088">)</span><span class="op" id="8550089">)</span><span class="op" id="8550090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550094">stop</span><span class="op" id="8550098">.</span><span class="ident" id="8550099">Add</span><span class="op" id="8550102">(</span><span class="num" id="8550103">1</span><span class="op" id="8550104">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550108">go</span>&nbsp;<span class="keyword" id="8550111">func</span><span class="op" id="8550115">(</span><span class="op" id="8550116">)</span>&nbsp;<span class="op" id="8550118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550123">for</span>&nbsp;<span class="ident" id="8550127">i</span>&nbsp;<span class="op" id="8550129">:=</span>&nbsp;<span class="num" id="8550132">0</span><span class="op" id="8550133">;</span>&nbsp;<span class="ident" id="8550135">i</span>&nbsp;<span class="op" id="8550137">&lt;</span>&nbsp;<span class="num" id="8550139">1000</span><span class="op" id="8550143">;</span>&nbsp;<span class="ident" id="8550145">i</span><span class="op" id="8550146">++</span>&nbsp;<span class="op" id="8550149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550155">fset</span><span class="op" id="8550159">.</span><span class="ident" id="8550160">Position</span><span class="op" id="8550168">(</span><span class="ident" id="8550169">Pos</span><span class="op" id="8550172">(</span><span class="ident" id="8550173">r</span><span class="op" id="8550174">.</span><span class="ident" id="8550175">Int31n</span><span class="op" id="8550181">(</span><span class="ident" id="8550182">max</span><span class="op" id="8550185">)</span><span class="op" id="8550186">)</span><span class="op" id="8550187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8550192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550197">stop</span><span class="op" id="8550201">.</span><span class="ident" id="8550202">Done</span><span class="op" id="8550206">(</span><span class="op" id="8550207">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8550211">}</span><span class="op" id="8550212">(</span><span class="op" id="8550213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8550216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550219">stop</span><span class="op" id="8550223">.</span><span class="ident" id="8550224">Wait</span><span class="op" id="8550228">(</span><span class="op" id="8550229">)</span><br>
<span class="lineno"></span><span class="op" id="8550231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8550234">func</span>&nbsp;<span class="ident" id="8550239">TestPositionFor</span><span class="op" id="8550254">(</span><span class="ident" id="8550255">t</span>&nbsp;<span class="op" id="8550257">*</span><span class="ident" id="8550258">testing</span><span class="op" id="8550265">.</span><span class="ident" id="8550266">T</span><span class="op" id="8550267">)</span>&nbsp;<span class="op" id="8550269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550272">src</span>&nbsp;<span class="op" id="8550276">:=</span>&nbsp;<span class="op" id="8550279">[</span><span class="op" id="8550280">]</span><span class="builtintype" id="8550281">byte</span><span class="op" id="8550285">(</span><span class="string" id="8550286">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="8550335">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550339">const</span>&nbsp;<span class="ident" id="8550345">filename</span>&nbsp;<span class="op" id="8550354">=</span>&nbsp;<span class="string" id="8550356">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550363">fset</span>&nbsp;<span class="op" id="8550368">:=</span>&nbsp;<span class="ident" id="8550371">NewFileSet</span><span class="op" id="8550381">(</span><span class="op" id="8550382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550385">f</span>&nbsp;<span class="op" id="8550387">:=</span>&nbsp;<span class="ident" id="8550390">fset</span><span class="op" id="8550394">.</span><span class="ident" id="8550395">AddFile</span><span class="op" id="8550402">(</span><span class="ident" id="8550403">filename</span><span class="op" id="8550411">,</span>&nbsp;<span class="ident" id="8550413">fset</span><span class="op" id="8550417">.</span><span class="ident" id="8550418">Base</span><span class="op" id="8550422">(</span><span class="op" id="8550423">)</span><span class="op" id="8550424">,</span>&nbsp;<span class="builtinfunc" id="8550426">len</span><span class="op" id="8550429">(</span><span class="ident" id="8550430">src</span><span class="op" id="8550433">)</span><span class="op" id="8550434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550437">f</span><span class="op" id="8550438">.</span><span class="ident" id="8550439">SetLinesForContent</span><span class="op" id="8550457">(</span><span class="ident" id="8550458">src</span><span class="op" id="8550461">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8550465">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550490">for</span>&nbsp;<span class="ident" id="8550494">i</span><span class="op" id="8550495">,</span>&nbsp;<span class="ident" id="8550497">offs</span>&nbsp;<span class="op" id="8550502">:=</span>&nbsp;<span class="keyword" id="8550505">range</span>&nbsp;<span class="ident" id="8550511">f</span><span class="op" id="8550512">.</span><span class="ident" id="8550513">lines</span>&nbsp;<span class="op" id="8550519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550523">got1</span>&nbsp;<span class="op" id="8550528">:=</span>&nbsp;<span class="ident" id="8550531">f</span><span class="op" id="8550532">.</span><span class="ident" id="8550533">PositionFor</span><span class="op" id="8550544">(</span><span class="ident" id="8550545">f</span><span class="op" id="8550546">.</span><span class="ident" id="8550547">Pos</span><span class="op" id="8550550">(</span><span class="ident" id="8550551">offs</span><span class="op" id="8550555">)</span><span class="op" id="8550556">,</span>&nbsp;<span class="builtintype" id="8550558">false</span><span class="op" id="8550563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550567">got2</span>&nbsp;<span class="op" id="8550572">:=</span>&nbsp;<span class="ident" id="8550575">f</span><span class="op" id="8550576">.</span><span class="ident" id="8550577">PositionFor</span><span class="op" id="8550588">(</span><span class="ident" id="8550589">f</span><span class="op" id="8550590">.</span><span class="ident" id="8550591">Pos</span><span class="op" id="8550594">(</span><span class="ident" id="8550595">offs</span><span class="op" id="8550599">)</span><span class="op" id="8550600">,</span>&nbsp;<span class="builtintype" id="8550602">true</span><span class="op" id="8550606">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550610">got3</span>&nbsp;<span class="op" id="8550615">:=</span>&nbsp;<span class="ident" id="8550618">f</span><span class="op" id="8550619">.</span><span class="ident" id="8550620">Position</span><span class="op" id="8550628">(</span><span class="ident" id="8550629">f</span><span class="op" id="8550630">.</span><span class="ident" id="8550631">Pos</span><span class="op" id="8550634">(</span><span class="ident" id="8550635">offs</span><span class="op" id="8550639">)</span><span class="op" id="8550640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550644">want</span>&nbsp;<span class="op" id="8550649">:=</span>&nbsp;<span class="ident" id="8550652">Position</span><span class="op" id="8550660">{</span><span class="ident" id="8550661">filename</span><span class="op" id="8550669">,</span>&nbsp;<span class="ident" id="8550671">offs</span><span class="op" id="8550675">,</span>&nbsp;<span class="ident" id="8550677">i</span>&nbsp;<span class="op" id="8550679">+</span>&nbsp;<span class="num" id="8550681">1</span><span class="op" id="8550682">,</span>&nbsp;<span class="num" id="8550684">1</span><span class="op" id="8550685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550689">checkPos</span><span class="op" id="8550697">(</span><span class="ident" id="8550698">t</span><span class="op" id="8550699">,</span>&nbsp;<span class="string" id="8550701">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="8550728">,</span>&nbsp;<span class="ident" id="8550730">got1</span><span class="op" id="8550734">,</span>&nbsp;<span class="ident" id="8550736">want</span><span class="op" id="8550740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550744">checkPos</span><span class="op" id="8550752">(</span><span class="ident" id="8550753">t</span><span class="op" id="8550754">,</span>&nbsp;<span class="string" id="8550756">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="8550781">,</span>&nbsp;<span class="ident" id="8550783">got2</span><span class="op" id="8550787">,</span>&nbsp;<span class="ident" id="8550789">want</span><span class="op" id="8550793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550797">checkPos</span><span class="op" id="8550805">(</span><span class="ident" id="8550806">t</span><span class="op" id="8550807">,</span>&nbsp;<span class="string" id="8550809">&#34;1.&nbsp;Position&#34;</span><span class="op" id="8550822">,</span>&nbsp;<span class="ident" id="8550824">got3</span><span class="op" id="8550828">,</span>&nbsp;<span class="ident" id="8550830">want</span><span class="op" id="8550834">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8550837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8550841">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8550886">const</span>&nbsp;<span class="ident" id="8550892">l1</span><span class="op" id="8550894">,</span>&nbsp;<span class="ident" id="8550896">l2</span>&nbsp;<span class="op" id="8550899">=</span>&nbsp;<span class="num" id="8550901">5</span><span class="op" id="8550902">,</span>&nbsp;<span class="num" id="8550904">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550907">f</span><span class="op" id="8550908">.</span><span class="ident" id="8550909">AddLineInfo</span><span class="op" id="8550920">(</span><span class="ident" id="8550921">f</span><span class="op" id="8550922">.</span><span class="ident" id="8550923">lines</span><span class="op" id="8550928">[</span><span class="ident" id="8550929">l1</span><span class="op" id="8550931">-</span><span class="num" id="8550932">1</span><span class="op" id="8550933">]</span><span class="op" id="8550934">,</span>&nbsp;<span class="string" id="8550936">&#34;&#34;</span><span class="op" id="8550938">,</span>&nbsp;<span class="num" id="8550940">100</span><span class="op" id="8550943">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8550946">f</span><span class="op" id="8550947">.</span><span class="ident" id="8550948">AddLineInfo</span><span class="op" id="8550959">(</span><span class="ident" id="8550960">f</span><span class="op" id="8550961">.</span><span class="ident" id="8550962">lines</span><span class="op" id="8550967">[</span><span class="ident" id="8550968">l2</span><span class="op" id="8550970">-</span><span class="num" id="8550971">1</span><span class="op" id="8550972">]</span><span class="op" id="8550973">,</span>&nbsp;<span class="string" id="8550975">&#34;bar&#34;</span><span class="op" id="8550980">,</span>&nbsp;<span class="num" id="8550982">3</span><span class="op" id="8550983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8550987">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8551038">for</span>&nbsp;<span class="ident" id="8551042">i</span><span class="op" id="8551043">,</span>&nbsp;<span class="ident" id="8551045">offs</span>&nbsp;<span class="op" id="8551050">:=</span>&nbsp;<span class="keyword" id="8551053">range</span>&nbsp;<span class="ident" id="8551059">f</span><span class="op" id="8551060">.</span><span class="ident" id="8551061">lines</span>&nbsp;<span class="op" id="8551067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551071">got1</span>&nbsp;<span class="op" id="8551076">:=</span>&nbsp;<span class="ident" id="8551079">f</span><span class="op" id="8551080">.</span><span class="ident" id="8551081">PositionFor</span><span class="op" id="8551092">(</span><span class="ident" id="8551093">f</span><span class="op" id="8551094">.</span><span class="ident" id="8551095">Pos</span><span class="op" id="8551098">(</span><span class="ident" id="8551099">offs</span><span class="op" id="8551103">)</span><span class="op" id="8551104">,</span>&nbsp;<span class="builtintype" id="8551106">false</span><span class="op" id="8551111">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551115">want</span>&nbsp;<span class="op" id="8551120">:=</span>&nbsp;<span class="ident" id="8551123">Position</span><span class="op" id="8551131">{</span><span class="ident" id="8551132">filename</span><span class="op" id="8551140">,</span>&nbsp;<span class="ident" id="8551142">offs</span><span class="op" id="8551146">,</span>&nbsp;<span class="ident" id="8551148">i</span>&nbsp;<span class="op" id="8551150">+</span>&nbsp;<span class="num" id="8551152">1</span><span class="op" id="8551153">,</span>&nbsp;<span class="num" id="8551155">1</span><span class="op" id="8551156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551160">checkPos</span><span class="op" id="8551168">(</span><span class="ident" id="8551169">t</span><span class="op" id="8551170">,</span>&nbsp;<span class="string" id="8551172">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="8551199">,</span>&nbsp;<span class="ident" id="8551201">got1</span><span class="op" id="8551205">,</span>&nbsp;<span class="ident" id="8551207">want</span><span class="op" id="8551211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8551214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8551218">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8551265">for</span>&nbsp;<span class="ident" id="8551269">i</span><span class="op" id="8551270">,</span>&nbsp;<span class="ident" id="8551272">offs</span>&nbsp;<span class="op" id="8551277">:=</span>&nbsp;<span class="keyword" id="8551280">range</span>&nbsp;<span class="ident" id="8551286">f</span><span class="op" id="8551287">.</span><span class="ident" id="8551288">lines</span>&nbsp;<span class="op" id="8551294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551298">got2</span>&nbsp;<span class="op" id="8551303">:=</span>&nbsp;<span class="ident" id="8551306">f</span><span class="op" id="8551307">.</span><span class="ident" id="8551308">PositionFor</span><span class="op" id="8551319">(</span><span class="ident" id="8551320">f</span><span class="op" id="8551321">.</span><span class="ident" id="8551322">Pos</span><span class="op" id="8551325">(</span><span class="ident" id="8551326">offs</span><span class="op" id="8551330">)</span><span class="op" id="8551331">,</span>&nbsp;<span class="builtintype" id="8551333">true</span><span class="op" id="8551337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551341">got3</span>&nbsp;<span class="op" id="8551346">:=</span>&nbsp;<span class="ident" id="8551349">f</span><span class="op" id="8551350">.</span><span class="ident" id="8551351">Position</span><span class="op" id="8551359">(</span><span class="ident" id="8551360">f</span><span class="op" id="8551361">.</span><span class="ident" id="8551362">Pos</span><span class="op" id="8551365">(</span><span class="ident" id="8551366">offs</span><span class="op" id="8551370">)</span><span class="op" id="8551371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551375">want</span>&nbsp;<span class="op" id="8551380">:=</span>&nbsp;<span class="ident" id="8551383">Position</span><span class="op" id="8551391">{</span><span class="ident" id="8551392">filename</span><span class="op" id="8551400">,</span>&nbsp;<span class="ident" id="8551402">offs</span><span class="op" id="8551406">,</span>&nbsp;<span class="ident" id="8551408">i</span>&nbsp;<span class="op" id="8551410">+</span>&nbsp;<span class="num" id="8551412">1</span><span class="op" id="8551413">,</span>&nbsp;<span class="num" id="8551415">1</span><span class="op" id="8551416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8551420">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551467">line</span>&nbsp;<span class="op" id="8551472">:=</span>&nbsp;<span class="ident" id="8551475">want</span><span class="op" id="8551479">.</span><span class="ident" id="8551480">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8551487">if</span>&nbsp;<span class="ident" id="8551490">i</span><span class="op" id="8551491">+</span><span class="num" id="8551492">1</span>&nbsp;<span class="op" id="8551494">&gt;=</span>&nbsp;<span class="ident" id="8551497">l1</span>&nbsp;<span class="op" id="8551500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551505">want</span><span class="op" id="8551509">.</span><span class="ident" id="8551510">Filename</span>&nbsp;<span class="op" id="8551519">=</span>&nbsp;<span class="string" id="8551521">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551527">want</span><span class="op" id="8551531">.</span><span class="ident" id="8551532">Line</span>&nbsp;<span class="op" id="8551537">=</span>&nbsp;<span class="ident" id="8551539">line</span>&nbsp;<span class="op" id="8551544">-</span>&nbsp;<span class="ident" id="8551546">l1</span>&nbsp;<span class="op" id="8551549">+</span>&nbsp;<span class="num" id="8551551">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8551557">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8551561">if</span>&nbsp;<span class="ident" id="8551564">i</span><span class="op" id="8551565">+</span><span class="num" id="8551566">1</span>&nbsp;<span class="op" id="8551568">&gt;=</span>&nbsp;<span class="ident" id="8551571">l2</span>&nbsp;<span class="op" id="8551574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551579">want</span><span class="op" id="8551583">.</span><span class="ident" id="8551584">Filename</span>&nbsp;<span class="op" id="8551593">=</span>&nbsp;<span class="string" id="8551595">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551604">want</span><span class="op" id="8551608">.</span><span class="ident" id="8551609">Line</span>&nbsp;<span class="op" id="8551614">=</span>&nbsp;<span class="ident" id="8551616">line</span>&nbsp;<span class="op" id="8551621">-</span>&nbsp;<span class="ident" id="8551623">l2</span>&nbsp;<span class="op" id="8551626">+</span>&nbsp;<span class="num" id="8551628">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8551632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551636">checkPos</span><span class="op" id="8551644">(</span><span class="ident" id="8551645">t</span><span class="op" id="8551646">,</span>&nbsp;<span class="string" id="8551648">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="8551673">,</span>&nbsp;<span class="ident" id="8551675">got2</span><span class="op" id="8551679">,</span>&nbsp;<span class="ident" id="8551681">want</span><span class="op" id="8551685">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8551689">checkPos</span><span class="op" id="8551697">(</span><span class="ident" id="8551698">t</span><span class="op" id="8551699">,</span>&nbsp;<span class="string" id="8551701">&#34;3.&nbsp;Position&#34;</span><span class="op" id="8551714">,</span>&nbsp;<span class="ident" id="8551716">got3</span><span class="op" id="8551720">,</span>&nbsp;<span class="ident" id="8551722">want</span><span class="op" id="8551726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8551729">}</span><br>
<span class="lineno"></span><span class="op" id="8551731">}</span>
</div>
</body>
</html>
