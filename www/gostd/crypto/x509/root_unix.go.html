<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4249696">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4249751">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4249805">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4249856">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4249919">package</span>&nbsp;<span class="ident" id="4249927">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4249933">import</span>&nbsp;<span class="string" id="4249940">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4249953">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4250008">var</span>&nbsp;<span class="ident" id="4250012">certFiles</span>&nbsp;<span class="op" id="4250022">=</span>&nbsp;<span class="op" id="4250024">[</span><span class="op" id="4250025">]</span><span class="builtintype" id="4250026">string</span><span class="op" id="4250032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250035">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4250071">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250077">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250107">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4250141">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250149">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250165">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4250189">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250207">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250220">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4250239">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250262">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250274">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4250314">,</span>&nbsp;<span class="comment" id="4250316">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250338">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4250363">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250380">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250393">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4250425">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250435">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4250452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250455">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4250527">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4250574">var</span>&nbsp;<span class="ident" id="4250578">certDirectories</span>&nbsp;<span class="op" id="4250594">=</span>&nbsp;<span class="op" id="4250596">[</span><span class="op" id="4250597">]</span><span class="builtintype" id="4250598">string</span><span class="op" id="4250604">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4250607">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4250637">,</span>&nbsp;<span class="comment" id="4250639">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4250651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250654">func</span>&nbsp;<span class="op" id="4250659">(</span><span class="ident" id="4250660">c</span>&nbsp;<span class="op" id="4250662">*</span><span class="ident" id="4250663">Certificate</span><span class="op" id="4250674">)</span>&nbsp;<span class="ident" id="4250676">systemVerify</span><span class="op" id="4250688">(</span><span class="ident" id="4250689">opts</span>&nbsp;<span class="op" id="4250694">*</span><span class="ident" id="4250695">VerifyOptions</span><span class="op" id="4250708">)</span>&nbsp;<span class="op" id="4250710">(</span><span class="ident" id="4250711">chains</span>&nbsp;<span class="op" id="4250718">[</span><span class="op" id="4250719">]</span><span class="op" id="4250720">[</span><span class="op" id="4250721">]</span><span class="op" id="4250722">*</span><span class="ident" id="4250723">Certificate</span><span class="op" id="4250734">,</span>&nbsp;<span class="ident" id="4250736">err</span>&nbsp;<span class="builtintype" id="4250740">error</span><span class="op" id="4250745">)</span>&nbsp;<span class="op" id="4250747">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250750">return</span>&nbsp;<span class="ident" id="4250757">nil</span><span class="op" id="4250760">,</span>&nbsp;<span class="ident" id="4250762">nil</span><br>
<span class="lineno"></span><span class="op" id="4250766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250769">func</span>&nbsp;<span class="ident" id="4250774">initSystemRoots</span><span class="op" id="4250789">(</span><span class="op" id="4250790">)</span>&nbsp;<span class="op" id="4250792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250795">roots</span>&nbsp;<span class="op" id="4250801">:=</span>&nbsp;<span class="ident" id="4250804">NewCertPool</span><span class="op" id="4250815">(</span><span class="op" id="4250816">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250819">for</span>&nbsp;<span class="ident" id="4250823">_</span><span class="op" id="4250824">,</span>&nbsp;<span class="ident" id="4250826">file</span>&nbsp;<span class="op" id="4250831">:=</span>&nbsp;<span class="keyword" id="4250834">range</span>&nbsp;<span class="ident" id="4250840">certFiles</span>&nbsp;<span class="op" id="4250850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250854">data</span><span class="op" id="4250858">,</span>&nbsp;<span class="ident" id="4250860">err</span>&nbsp;<span class="op" id="4250864">:=</span>&nbsp;<span class="ident" id="4250867">ioutil</span><span class="op" id="4250873">.</span><span class="ident" id="4250874">ReadFile</span><span class="op" id="4250882">(</span><span class="ident" id="4250883">file</span><span class="op" id="4250887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250891">if</span>&nbsp;<span class="ident" id="4250894">err</span>&nbsp;<span class="op" id="4250898">==</span>&nbsp;<span class="ident" id="4250901">nil</span>&nbsp;<span class="op" id="4250905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250910">roots</span><span class="op" id="4250915">.</span><span class="ident" id="4250916">AppendCertsFromPEM</span><span class="op" id="4250934">(</span><span class="ident" id="4250935">data</span><span class="op" id="4250939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4250944">systemRoots</span>&nbsp;<span class="op" id="4250956">=</span>&nbsp;<span class="ident" id="4250958">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250967">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4250979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4250983">for</span>&nbsp;<span class="ident" id="4250987">_</span><span class="op" id="4250988">,</span>&nbsp;<span class="ident" id="4250990">directory</span>&nbsp;<span class="op" id="4251000">:=</span>&nbsp;<span class="keyword" id="4251003">range</span>&nbsp;<span class="ident" id="4251009">certDirectories</span>&nbsp;<span class="op" id="4251025">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251029">fis</span><span class="op" id="4251032">,</span>&nbsp;<span class="ident" id="4251034">err</span>&nbsp;<span class="op" id="4251038">:=</span>&nbsp;<span class="ident" id="4251041">ioutil</span><span class="op" id="4251047">.</span><span class="ident" id="4251048">ReadDir</span><span class="op" id="4251055">(</span><span class="ident" id="4251056">directory</span><span class="op" id="4251065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251069">if</span>&nbsp;<span class="ident" id="4251072">err</span>&nbsp;<span class="op" id="4251076">!=</span>&nbsp;<span class="ident" id="4251079">nil</span>&nbsp;<span class="op" id="4251083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251088">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251103">rootsAdded</span>&nbsp;<span class="op" id="4251114">:=</span>&nbsp;<span class="builtintype" id="4251117">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251125">for</span>&nbsp;<span class="ident" id="4251129">_</span><span class="op" id="4251130">,</span>&nbsp;<span class="ident" id="4251132">fi</span>&nbsp;<span class="op" id="4251135">:=</span>&nbsp;<span class="keyword" id="4251138">range</span>&nbsp;<span class="ident" id="4251144">fis</span>&nbsp;<span class="op" id="4251148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251153">data</span><span class="op" id="4251157">,</span>&nbsp;<span class="ident" id="4251159">err</span>&nbsp;<span class="op" id="4251163">:=</span>&nbsp;<span class="ident" id="4251166">ioutil</span><span class="op" id="4251172">.</span><span class="ident" id="4251173">ReadFile</span><span class="op" id="4251181">(</span><span class="ident" id="4251182">directory</span>&nbsp;<span class="op" id="4251192">+</span>&nbsp;<span class="string" id="4251194">&#34;/&#34;</span>&nbsp;<span class="op" id="4251198">+</span>&nbsp;<span class="ident" id="4251200">fi</span><span class="op" id="4251202">.</span><span class="ident" id="4251203">Name</span><span class="op" id="4251207">(</span><span class="op" id="4251208">)</span><span class="op" id="4251209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251214">if</span>&nbsp;<span class="ident" id="4251217">err</span>&nbsp;<span class="op" id="4251221">==</span>&nbsp;<span class="ident" id="4251224">nil</span>&nbsp;<span class="op" id="4251228">&amp;&amp;</span>&nbsp;<span class="ident" id="4251231">roots</span><span class="op" id="4251236">.</span><span class="ident" id="4251237">AppendCertsFromPEM</span><span class="op" id="4251255">(</span><span class="ident" id="4251256">data</span><span class="op" id="4251260">)</span>&nbsp;<span class="op" id="4251262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251268">rootsAdded</span>&nbsp;<span class="op" id="4251279">=</span>&nbsp;<span class="builtintype" id="4251281">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251289">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251297">if</span>&nbsp;<span class="ident" id="4251300">rootsAdded</span>&nbsp;<span class="op" id="4251311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4251316">systemRoots</span>&nbsp;<span class="op" id="4251328">=</span>&nbsp;<span class="ident" id="4251330">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4251339">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251348">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4251351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4251355">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4251427">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4251477">}</span>
</div>
</body>
</html>
