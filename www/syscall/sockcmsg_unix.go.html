<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1660528">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1660584">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1660638">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1660689">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660754">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1660782">package</span>&nbsp;<span class="ident" id="1660790">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1660799">import</span>&nbsp;<span class="string" id="1660806">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660816">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="1660879">func</span>&nbsp;<span class="ident" id="1660884">cmsgAlignOf</span><span class="op" id="1660895">(</span><span class="ident" id="1660896">salen</span>&nbsp;<span class="builtintype" id="1660902">int</span><span class="op" id="1660905">)</span>&nbsp;<span class="builtintype" id="1660907">int</span>&nbsp;<span class="op" id="1660911">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660914">salign</span>&nbsp;<span class="op" id="1660921">:=</span>&nbsp;<span class="ident" id="1660924"><a href="/syscall/ztypes_linux_amd64.go.html#1821624">sizeofPtr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660935">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660999">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661061">if</span>&nbsp;<span class="ident" id="1661064"><a href="/syscall/syscall_unix.go.html#1699018">darwin64Bit</a></span>&nbsp;<span class="op" id="1661076">||</span>&nbsp;<span class="ident" id="1661079"><a href="/syscall/syscall_unix.go.html#1699079">dragonfly64Bit</a></span>&nbsp;<span class="op" id="1661094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661098"><a href="/syscall/sockcmsg_unix.go.html#1660914">salign</a></span>&nbsp;<span class="op" id="1661105">=</span>&nbsp;<span class="num" id="1661107">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661113">return</span>&nbsp;<span class="op" id="1661120">(</span><span class="ident" id="1661121"><a href="/syscall/sockcmsg_unix.go.html#1660896">salen</a></span>&nbsp;<span class="op" id="1661127">+</span>&nbsp;<span class="ident" id="1661129"><a href="/syscall/sockcmsg_unix.go.html#1660914">salign</a></span>&nbsp;<span class="op" id="1661136">-</span>&nbsp;<span class="num" id="1661138">1</span><span class="op" id="1661139">)</span>&nbsp;<span class="op" id="1661141">&amp;</span>&nbsp;<span class="op" id="1661143">^</span><span class="op" id="1661144">(</span><span class="ident" id="1661145"><a href="/syscall/sockcmsg_unix.go.html#1660914">salign</a></span>&nbsp;<span class="op" id="1661152">-</span>&nbsp;<span class="num" id="1661154">1</span><span class="op" id="1661155">)</span><br>
<span class="lineno"></span><span class="op" id="1661157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1661160">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="1661230">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="1661289">func</span>&nbsp;<span class="ident" id="1661294">CmsgLen</span><span class="op" id="1661301">(</span><span class="ident" id="1661302">datalen</span>&nbsp;<span class="builtintype" id="1661310">int</span><span class="op" id="1661313">)</span>&nbsp;<span class="builtintype" id="1661315">int</span>&nbsp;<span class="op" id="1661319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661322">return</span>&nbsp;<span class="ident" id="1661329"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1661340">(</span><span class="ident" id="1661341"><a href="/syscall/ztypes_linux_amd64.go.html#1826569">SizeofCmsghdr</a></span><span class="op" id="1661354">)</span>&nbsp;<span class="op" id="1661356">+</span>&nbsp;<span class="ident" id="1661358"><a href="/syscall/sockcmsg_unix.go.html#1661302">datalen</a></span><br>
<span class="lineno"></span><span class="op" id="1661366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1661369">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1661436">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="1661483">func</span>&nbsp;<span class="ident" id="1661488">CmsgSpace</span><span class="op" id="1661497">(</span><span class="ident" id="1661498">datalen</span>&nbsp;<span class="builtintype" id="1661506">int</span><span class="op" id="1661509">)</span>&nbsp;<span class="builtintype" id="1661511">int</span>&nbsp;<span class="op" id="1661515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661518">return</span>&nbsp;<span class="ident" id="1661525"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1661536">(</span><span class="ident" id="1661537"><a href="/syscall/ztypes_linux_amd64.go.html#1826569">SizeofCmsghdr</a></span><span class="op" id="1661550">)</span>&nbsp;<span class="op" id="1661552">+</span>&nbsp;<span class="ident" id="1661554"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1661565">(</span><span class="ident" id="1661566"><a href="/syscall/sockcmsg_unix.go.html#1661498">datalen</a></span><span class="op" id="1661573">)</span><br>
<span class="lineno"></span><span class="op" id="1661575">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="1661578">func</span>&nbsp;<span class="ident" id="1661583">cmsgData</span><span class="op" id="1661591">(</span><span class="ident" id="1661592">h</span>&nbsp;<span class="op" id="1661594">*</span><span class="ident" id="1661595"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><span class="op" id="1661602">)</span>&nbsp;<span class="ident" id="1661604"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1661610">.</span><span class="ident" id="1661611">Pointer</span>&nbsp;<span class="op" id="1661619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661622">return</span>&nbsp;<span class="ident" id="1661629"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1661635">.</span><span class="ident" id="1661636">Pointer</span><span class="op" id="1661643">(</span><span class="builtintype" id="1661644">uintptr</span><span class="op" id="1661651">(</span><span class="ident" id="1661652"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1661658">.</span><span class="ident" id="1661659">Pointer</span><span class="op" id="1661666">(</span><span class="ident" id="1661667"><a href="/syscall/sockcmsg_unix.go.html#1661592">h</a></span><span class="op" id="1661668">)</span><span class="op" id="1661669">)</span>&nbsp;<span class="op" id="1661671">+</span>&nbsp;<span class="builtintype" id="1661673">uintptr</span><span class="op" id="1661680">(</span><span class="ident" id="1661681"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1661692">(</span><span class="ident" id="1661693"><a href="/syscall/ztypes_linux_amd64.go.html#1826569">SizeofCmsghdr</a></span><span class="op" id="1661706">)</span><span class="op" id="1661707">)</span><span class="op" id="1661708">)</span><br>
<span class="lineno"></span><span class="op" id="1661710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="1661713">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="1661774">type</span>&nbsp;<span class="ident" id="1661779">SocketControlMessage</span>&nbsp;<span class="keyword" id="1661800">struct</span>&nbsp;<span class="op" id="1661807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661810">Header</span>&nbsp;<span class="ident" id="1661817"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661826">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1661833">[</span><span class="op" id="1661834">]</span><span class="builtintype" id="1661835">byte</span><br>
<span class="lineno"></span><span class="op" id="1661840">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1661843">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="1661911">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="1661924">func</span>&nbsp;<span class="ident" id="1661929">ParseSocketControlMessage</span><span class="op" id="1661954">(</span><span class="ident" id="1661955">b</span>&nbsp;<span class="op" id="1661957">[</span><span class="op" id="1661958">]</span><span class="builtintype" id="1661959">byte</span><span class="op" id="1661963">)</span>&nbsp;<span class="op" id="1661965">(</span><span class="op" id="1661966">[</span><span class="op" id="1661967">]</span><span class="ident" id="1661968"><a href="/syscall/sockcmsg_unix.go.html#1661779">SocketControlMessage</a></span><span class="op" id="1661988">,</span>&nbsp;<span class="builtintype" id="1661990">error</span><span class="op" id="1661995">)</span>&nbsp;<span class="op" id="1661997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662000">var</span>&nbsp;<span class="ident" id="1662004">msgs</span>&nbsp;<span class="op" id="1662009">[</span><span class="op" id="1662010">]</span><span class="ident" id="1662011"><a href="/syscall/sockcmsg_unix.go.html#1661779">SocketControlMessage</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662033">i</span>&nbsp;<span class="op" id="1662035">:=</span>&nbsp;<span class="num" id="1662038">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662041">for</span>&nbsp;<span class="ident" id="1662045"><a href="/syscall/sockcmsg_unix.go.html#1662033">i</a></span><span class="op" id="1662046">+</span><span class="ident" id="1662047"><a href="/syscall/sockcmsg_unix.go.html#1661294">CmsgLen</a></span><span class="op" id="1662054">(</span><span class="num" id="1662055">0</span><span class="op" id="1662056">)</span>&nbsp;<span class="op" id="1662058">&lt;=</span>&nbsp;<span class="builtinfunc" id="1662061">len</span><span class="op" id="1662064">(</span><span class="ident" id="1662065"><a href="/syscall/sockcmsg_unix.go.html#1661955">b</a></span><span class="op" id="1662066">)</span>&nbsp;<span class="op" id="1662068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662072">h</span><span class="op" id="1662073">,</span>&nbsp;<span class="ident" id="1662075">dbuf</span><span class="op" id="1662079">,</span>&nbsp;<span class="ident" id="1662081">err</span>&nbsp;<span class="op" id="1662085">:=</span>&nbsp;<span class="ident" id="1662088"><a href="/syscall/sockcmsg_unix.go.html#1662307">socketControlMessageHeaderAndData</a></span><span class="op" id="1662121">(</span><span class="ident" id="1662122"><a href="/syscall/sockcmsg_unix.go.html#1661955">b</a></span><span class="op" id="1662123">[</span><span class="ident" id="1662124"><a href="/syscall/sockcmsg_unix.go.html#1662033">i</a></span><span class="op" id="1662125">:</span><span class="op" id="1662126">]</span><span class="op" id="1662127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662131">if</span>&nbsp;<span class="ident" id="1662134"><a href="/syscall/sockcmsg_unix.go.html#1662081">err</a></span>&nbsp;<span class="op" id="1662138">!=</span>&nbsp;<span class="ident" id="1662141">nil</span>&nbsp;<span class="op" id="1662145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662150">return</span>&nbsp;<span class="ident" id="1662157">nil</span><span class="op" id="1662160">,</span>&nbsp;<span class="ident" id="1662162"><a href="/syscall/sockcmsg_unix.go.html#1662081">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662172">m</span>&nbsp;<span class="op" id="1662174">:=</span>&nbsp;<span class="ident" id="1662177"><a href="/syscall/sockcmsg_unix.go.html#1661779">SocketControlMessage</a></span><span class="op" id="1662197">{</span><span class="ident" id="1662198">Header</span><span class="op" id="1662204">:</span>&nbsp;<span class="op" id="1662206">*</span><span class="ident" id="1662207"><a href="/syscall/sockcmsg_unix.go.html#1662072">h</a></span><span class="op" id="1662208">,</span>&nbsp;<span class="ident" id="1662210">Data</span><span class="op" id="1662214">:</span>&nbsp;<span class="ident" id="1662216"><a href="/syscall/sockcmsg_unix.go.html#1662075">dbuf</a></span><span class="op" id="1662220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662224"><a href="/syscall/sockcmsg_unix.go.html#1662004">msgs</a></span>&nbsp;<span class="op" id="1662229">=</span>&nbsp;<span class="builtinfunc" id="1662231">append</span><span class="op" id="1662237">(</span><span class="ident" id="1662238"><a href="/syscall/sockcmsg_unix.go.html#1662004">msgs</a></span><span class="op" id="1662242">,</span>&nbsp;<span class="ident" id="1662244"><a href="/syscall/sockcmsg_unix.go.html#1662172">m</a></span><span class="op" id="1662245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662249"><a href="/syscall/sockcmsg_unix.go.html#1662033">i</a></span>&nbsp;<span class="op" id="1662251">+=</span>&nbsp;<span class="ident" id="1662254"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1662265">(</span><span class="builtintype" id="1662266">int</span><span class="op" id="1662269">(</span><span class="ident" id="1662270"><a href="/syscall/sockcmsg_unix.go.html#1662072">h</a></span><span class="op" id="1662271">.</span><span class="ident" id="1662272">Len</span><span class="op" id="1662275">)</span><span class="op" id="1662276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662279">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662282">return</span>&nbsp;<span class="ident" id="1662289"><a href="/syscall/sockcmsg_unix.go.html#1662004">msgs</a></span><span class="op" id="1662293">,</span>&nbsp;<span class="ident" id="1662295">nil</span><br>
<span class="lineno"></span><span class="op" id="1662299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1662302">func</span>&nbsp;<span class="ident" id="1662307">socketControlMessageHeaderAndData</span><span class="op" id="1662340">(</span><span class="ident" id="1662341">b</span>&nbsp;<span class="op" id="1662343">[</span><span class="op" id="1662344">]</span><span class="builtintype" id="1662345">byte</span><span class="op" id="1662349">)</span>&nbsp;<span class="op" id="1662351">(</span><span class="op" id="1662352">*</span><span class="ident" id="1662353"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><span class="op" id="1662360">,</span>&nbsp;<span class="op" id="1662362">[</span><span class="op" id="1662363">]</span><span class="builtintype" id="1662364">byte</span><span class="op" id="1662368">,</span>&nbsp;<span class="builtintype" id="1662370">error</span><span class="op" id="1662375">)</span>&nbsp;<span class="op" id="1662377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662380">h</span>&nbsp;<span class="op" id="1662382">:=</span>&nbsp;<span class="op" id="1662385">(</span><span class="op" id="1662386">*</span><span class="ident" id="1662387"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><span class="op" id="1662394">)</span><span class="op" id="1662395">(</span><span class="ident" id="1662396"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1662402">.</span><span class="ident" id="1662403">Pointer</span><span class="op" id="1662410">(</span><span class="op" id="1662411">&amp;</span><span class="ident" id="1662412"><a href="/syscall/sockcmsg_unix.go.html#1662341">b</a></span><span class="op" id="1662413">[</span><span class="num" id="1662414">0</span><span class="op" id="1662415">]</span><span class="op" id="1662416">)</span><span class="op" id="1662417">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662420">if</span>&nbsp;<span class="ident" id="1662423"><a href="/syscall/sockcmsg_unix.go.html#1662380">h</a></span><span class="op" id="1662424">.</span><span class="ident" id="1662425">Len</span>&nbsp;<span class="op" id="1662429">&lt;</span>&nbsp;<span class="ident" id="1662431"><a href="/syscall/ztypes_linux_amd64.go.html#1826569">SizeofCmsghdr</a></span>&nbsp;<span class="op" id="1662445">||</span>&nbsp;<span class="builtintype" id="1662448">int</span><span class="op" id="1662451">(</span><span class="ident" id="1662452"><a href="/syscall/sockcmsg_unix.go.html#1662380">h</a></span><span class="op" id="1662453">.</span><span class="ident" id="1662454">Len</span><span class="op" id="1662457">)</span>&nbsp;<span class="op" id="1662459">&gt;</span>&nbsp;<span class="builtinfunc" id="1662461">len</span><span class="op" id="1662464">(</span><span class="ident" id="1662465"><a href="/syscall/sockcmsg_unix.go.html#1662341">b</a></span><span class="op" id="1662466">)</span>&nbsp;<span class="op" id="1662468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662472">return</span>&nbsp;<span class="ident" id="1662479">nil</span><span class="op" id="1662482">,</span>&nbsp;<span class="ident" id="1662484">nil</span><span class="op" id="1662487">,</span>&nbsp;<span class="ident" id="1662489"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662500">return</span>&nbsp;<span class="ident" id="1662507"><a href="/syscall/sockcmsg_unix.go.html#1662380">h</a></span><span class="op" id="1662508">,</span>&nbsp;<span class="ident" id="1662510"><a href="/syscall/sockcmsg_unix.go.html#1662341">b</a></span><span class="op" id="1662511">[</span><span class="ident" id="1662512"><a href="/syscall/sockcmsg_unix.go.html#1660884">cmsgAlignOf</a></span><span class="op" id="1662523">(</span><span class="ident" id="1662524"><a href="/syscall/ztypes_linux_amd64.go.html#1826569">SizeofCmsghdr</a></span><span class="op" id="1662537">)</span><span class="op" id="1662538">:</span><span class="ident" id="1662539"><a href="/syscall/sockcmsg_unix.go.html#1662380">h</a></span><span class="op" id="1662540">.</span><span class="ident" id="1662541">Len</span><span class="op" id="1662544">]</span><span class="op" id="1662545">,</span>&nbsp;<span class="ident" id="1662547">nil</span><br>
<span class="lineno"></span><span class="op" id="1662551">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="1662554">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="1662621">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="1662672">func</span>&nbsp;<span class="ident" id="1662677">UnixRights</span><span class="op" id="1662687">(</span><span class="ident" id="1662688">fds</span>&nbsp;<span class="op" id="1662692">...</span><span class="builtintype" id="1662695">int</span><span class="op" id="1662698">)</span>&nbsp;<span class="op" id="1662700">[</span><span class="op" id="1662701">]</span><span class="builtintype" id="1662702">byte</span>&nbsp;<span class="op" id="1662707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662710">datalen</span>&nbsp;<span class="op" id="1662718">:=</span>&nbsp;<span class="builtinfunc" id="1662721">len</span><span class="op" id="1662724">(</span><span class="ident" id="1662725"><a href="/syscall/sockcmsg_unix.go.html#1662688">fds</a></span><span class="op" id="1662728">)</span>&nbsp;<span class="op" id="1662730">*</span>&nbsp;<span class="num" id="1662732">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662735">b</span>&nbsp;<span class="op" id="1662737">:=</span>&nbsp;<span class="builtinfunc" id="1662740">make</span><span class="op" id="1662744">(</span><span class="op" id="1662745">[</span><span class="op" id="1662746">]</span><span class="builtintype" id="1662747">byte</span><span class="op" id="1662751">,</span>&nbsp;<span class="ident" id="1662753"><a href="/syscall/sockcmsg_unix.go.html#1661488">CmsgSpace</a></span><span class="op" id="1662762">(</span><span class="ident" id="1662763"><a href="/syscall/sockcmsg_unix.go.html#1662710">datalen</a></span><span class="op" id="1662770">)</span><span class="op" id="1662771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662774">h</span>&nbsp;<span class="op" id="1662776">:=</span>&nbsp;<span class="op" id="1662779">(</span><span class="op" id="1662780">*</span><span class="ident" id="1662781"><a href="/syscall/ztypes_linux_amd64.go.html#1825017">Cmsghdr</a></span><span class="op" id="1662788">)</span><span class="op" id="1662789">(</span><span class="ident" id="1662790"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1662796">.</span><span class="ident" id="1662797">Pointer</span><span class="op" id="1662804">(</span><span class="op" id="1662805">&amp;</span><span class="ident" id="1662806"><a href="/syscall/sockcmsg_unix.go.html#1662735">b</a></span><span class="op" id="1662807">[</span><span class="num" id="1662808">0</span><span class="op" id="1662809">]</span><span class="op" id="1662810">)</span><span class="op" id="1662811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662814"><a href="/syscall/sockcmsg_unix.go.html#1662774">h</a></span><span class="op" id="1662815">.</span><span class="ident" id="1662816">Level</span>&nbsp;<span class="op" id="1662822">=</span>&nbsp;<span class="ident" id="1662824"><a href="/syscall/zerrors_linux_amd64.go.html#1747792">SOL_SOCKET</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662836"><a href="/syscall/sockcmsg_unix.go.html#1662774">h</a></span><span class="op" id="1662837">.</span><span class="ident" id="1662838">Type</span>&nbsp;<span class="op" id="1662843">=</span>&nbsp;<span class="ident" id="1662845"><a href="/syscall/zerrors_linux_amd64.go.html#1744276">SCM_RIGHTS</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662857"><a href="/syscall/sockcmsg_unix.go.html#1662774">h</a></span><span class="op" id="1662858">.</span><span class="ident" id="1662859">SetLen</span><span class="op" id="1662865">(</span><span class="ident" id="1662866"><a href="/syscall/sockcmsg_unix.go.html#1661294">CmsgLen</a></span><span class="op" id="1662873">(</span><span class="ident" id="1662874"><a href="/syscall/sockcmsg_unix.go.html#1662710">datalen</a></span><span class="op" id="1662881">)</span><span class="op" id="1662882">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662885">data</span>&nbsp;<span class="op" id="1662890">:=</span>&nbsp;<span class="builtintype" id="1662893">uintptr</span><span class="op" id="1662900">(</span><span class="ident" id="1662901"><a href="/syscall/sockcmsg_unix.go.html#1661583">cmsgData</a></span><span class="op" id="1662909">(</span><span class="ident" id="1662910"><a href="/syscall/sockcmsg_unix.go.html#1662774">h</a></span><span class="op" id="1662911">)</span><span class="op" id="1662912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662915">for</span>&nbsp;<span class="ident" id="1662919">_</span><span class="op" id="1662920">,</span>&nbsp;<span class="ident" id="1662922">fd</span>&nbsp;<span class="op" id="1662925">:=</span>&nbsp;<span class="keyword" id="1662928">range</span>&nbsp;<span class="ident" id="1662934"><a href="/syscall/sockcmsg_unix.go.html#1662688">fds</a></span>&nbsp;<span class="op" id="1662938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662942">*</span><span class="op" id="1662943">(</span><span class="op" id="1662944">*</span><span class="builtintype" id="1662945">int32</span><span class="op" id="1662950">)</span><span class="op" id="1662951">(</span><span class="ident" id="1662952"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1662958">.</span><span class="ident" id="1662959">Pointer</span><span class="op" id="1662966">(</span><span class="ident" id="1662967"><a href="/syscall/sockcmsg_unix.go.html#1662885">data</a></span><span class="op" id="1662971">)</span><span class="op" id="1662972">)</span>&nbsp;<span class="op" id="1662974">=</span>&nbsp;<span class="builtintype" id="1662976">int32</span><span class="op" id="1662981">(</span><span class="ident" id="1662982"><a href="/syscall/sockcmsg_unix.go.html#1662922">fd</a></span><span class="op" id="1662984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662988"><a href="/syscall/sockcmsg_unix.go.html#1662885">data</a></span>&nbsp;<span class="op" id="1662993">+=</span>&nbsp;<span class="num" id="1662996">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662999">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663002">return</span>&nbsp;<span class="ident" id="1663009"><a href="/syscall/sockcmsg_unix.go.html#1662735">b</a></span><br>
<span class="lineno"></span><span class="op" id="1663011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1663014">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1663083">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="1663147">func</span>&nbsp;<span class="ident" id="1663152">ParseUnixRights</span><span class="op" id="1663167">(</span><span class="ident" id="1663168">m</span>&nbsp;<span class="op" id="1663170">*</span><span class="ident" id="1663171"><a href="/syscall/sockcmsg_unix.go.html#1661779">SocketControlMessage</a></span><span class="op" id="1663191">)</span>&nbsp;<span class="op" id="1663193">(</span><span class="op" id="1663194">[</span><span class="op" id="1663195">]</span><span class="builtintype" id="1663196">int</span><span class="op" id="1663199">,</span>&nbsp;<span class="builtintype" id="1663201">error</span><span class="op" id="1663206">)</span>&nbsp;<span class="op" id="1663208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663211">if</span>&nbsp;<span class="ident" id="1663214"><a href="/syscall/sockcmsg_unix.go.html#1663168">m</a></span><span class="op" id="1663215">.</span><span class="ident" id="1663216">Header</span><span class="op" id="1663222">.</span><span class="ident" id="1663223">Level</span>&nbsp;<span class="op" id="1663229">!=</span>&nbsp;<span class="ident" id="1663232"><a href="/syscall/zerrors_linux_amd64.go.html#1747792">SOL_SOCKET</a></span>&nbsp;<span class="op" id="1663243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663247">return</span>&nbsp;<span class="ident" id="1663254">nil</span><span class="op" id="1663257">,</span>&nbsp;<span class="ident" id="1663259"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1663267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663270">if</span>&nbsp;<span class="ident" id="1663273"><a href="/syscall/sockcmsg_unix.go.html#1663168">m</a></span><span class="op" id="1663274">.</span><span class="ident" id="1663275">Header</span><span class="op" id="1663281">.</span><span class="ident" id="1663282">Type</span>&nbsp;<span class="op" id="1663287">!=</span>&nbsp;<span class="ident" id="1663290"><a href="/syscall/zerrors_linux_amd64.go.html#1744276">SCM_RIGHTS</a></span>&nbsp;<span class="op" id="1663301">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663305">return</span>&nbsp;<span class="ident" id="1663312">nil</span><span class="op" id="1663315">,</span>&nbsp;<span class="ident" id="1663317"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1663325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663328">fds</span>&nbsp;<span class="op" id="1663332">:=</span>&nbsp;<span class="builtinfunc" id="1663335">make</span><span class="op" id="1663339">(</span><span class="op" id="1663340">[</span><span class="op" id="1663341">]</span><span class="builtintype" id="1663342">int</span><span class="op" id="1663345">,</span>&nbsp;<span class="builtinfunc" id="1663347">len</span><span class="op" id="1663350">(</span><span class="ident" id="1663351"><a href="/syscall/sockcmsg_unix.go.html#1663168">m</a></span><span class="op" id="1663352">.</span><span class="ident" id="1663353">Data</span><span class="op" id="1663357">)</span><span class="op" id="1663358">&gt;&gt;</span><span class="num" id="1663360">2</span><span class="op" id="1663361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663364">for</span>&nbsp;<span class="ident" id="1663368">i</span><span class="op" id="1663369">,</span>&nbsp;<span class="ident" id="1663371">j</span>&nbsp;<span class="op" id="1663373">:=</span>&nbsp;<span class="num" id="1663376">0</span><span class="op" id="1663377">,</span>&nbsp;<span class="num" id="1663379">0</span><span class="op" id="1663380">;</span>&nbsp;<span class="ident" id="1663382"><a href="/syscall/sockcmsg_unix.go.html#1663368">i</a></span>&nbsp;<span class="op" id="1663384">&lt;</span>&nbsp;<span class="builtinfunc" id="1663386">len</span><span class="op" id="1663389">(</span><span class="ident" id="1663390"><a href="/syscall/sockcmsg_unix.go.html#1663168">m</a></span><span class="op" id="1663391">.</span><span class="ident" id="1663392">Data</span><span class="op" id="1663396">)</span><span class="op" id="1663397">;</span>&nbsp;<span class="ident" id="1663399"><a href="/syscall/sockcmsg_unix.go.html#1663368">i</a></span>&nbsp;<span class="op" id="1663401">+=</span>&nbsp;<span class="num" id="1663404">4</span>&nbsp;<span class="op" id="1663406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663410"><a href="/syscall/sockcmsg_unix.go.html#1663328">fds</a></span><span class="op" id="1663413">[</span><span class="ident" id="1663414"><a href="/syscall/sockcmsg_unix.go.html#1663371">j</a></span><span class="op" id="1663415">]</span>&nbsp;<span class="op" id="1663417">=</span>&nbsp;<span class="builtintype" id="1663419">int</span><span class="op" id="1663422">(</span><span class="op" id="1663423">*</span><span class="op" id="1663424">(</span><span class="op" id="1663425">*</span><span class="builtintype" id="1663426">int32</span><span class="op" id="1663431">)</span><span class="op" id="1663432">(</span><span class="ident" id="1663433"><a href="/syscall/sockcmsg_unix.go.html#1660806">unsafe</a></span><span class="op" id="1663439">.</span><span class="ident" id="1663440">Pointer</span><span class="op" id="1663447">(</span><span class="op" id="1663448">&amp;</span><span class="ident" id="1663449"><a href="/syscall/sockcmsg_unix.go.html#1663168">m</a></span><span class="op" id="1663450">.</span><span class="ident" id="1663451">Data</span><span class="op" id="1663455">[</span><span class="ident" id="1663456"><a href="/syscall/sockcmsg_unix.go.html#1663368">i</a></span><span class="op" id="1663457">]</span><span class="op" id="1663458">)</span><span class="op" id="1663459">)</span><span class="op" id="1663460">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663464"><a href="/syscall/sockcmsg_unix.go.html#1663371">j</a></span><span class="op" id="1663465">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1663469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663472">return</span>&nbsp;<span class="ident" id="1663479"><a href="/syscall/sockcmsg_unix.go.html#1663328">fds</a></span><span class="op" id="1663482">,</span>&nbsp;<span class="ident" id="1663484">nil</span><br>
<span class="lineno"></span><span class="op" id="1663488">}</span>
</div>
</body>
</html>
