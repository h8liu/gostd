<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1855051">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1855106">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1855160">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1855211">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855289">package</span>&nbsp;<span class="ident" id="1855297">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855306">import</span>&nbsp;<span class="string" id="1855313">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1855323">func</span>&nbsp;<span class="ident" id="1855328">environ</span><span class="op" id="1855335">(</span><span class="op" id="1855336">)</span>&nbsp;<span class="op" id="1855338">[</span><span class="op" id="1855339">]</span><span class="builtintype" id="1855340">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855348">func</span>&nbsp;<span class="ident" id="1855353">getenv</span><span class="op" id="1855359">(</span><span class="ident" id="1855360">s</span>&nbsp;<span class="op" id="1855362">*</span><span class="builtintype" id="1855363">byte</span><span class="op" id="1855367">)</span>&nbsp;<span class="op" id="1855369">*</span><span class="builtintype" id="1855370">byte</span>&nbsp;<span class="op" id="1855375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855378">val</span>&nbsp;<span class="op" id="1855382">:=</span>&nbsp;<span class="ident" id="1855385">gogetenv</span><span class="op" id="1855393">(</span><span class="ident" id="1855394">gostringnocopy</span><span class="op" id="1855408">(</span><span class="ident" id="1855409">s</span><span class="op" id="1855410">)</span><span class="op" id="1855411">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855414">if</span>&nbsp;<span class="ident" id="1855417">val</span>&nbsp;<span class="op" id="1855421">==</span>&nbsp;<span class="string" id="1855424">&#34;&#34;</span>&nbsp;<span class="op" id="1855427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855431">return</span>&nbsp;<span class="ident" id="1855438">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855446">//&nbsp;Strings&nbsp;found&nbsp;in&nbsp;environment&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855499">return</span>&nbsp;<span class="op" id="1855506">&amp;</span><span class="ident" id="1855507">bytes</span><span class="op" id="1855512">(</span><span class="ident" id="1855513">val</span><span class="op" id="1855516">)</span><span class="op" id="1855517">[</span><span class="num" id="1855518">0</span><span class="op" id="1855519">]</span><br>
<span class="lineno">20</span><span class="op" id="1855521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855524">func</span>&nbsp;<span class="ident" id="1855529">gogetenv</span><span class="op" id="1855537">(</span><span class="ident" id="1855538">key</span>&nbsp;<span class="builtintype" id="1855542">string</span><span class="op" id="1855548">)</span>&nbsp;<span class="builtintype" id="1855550">string</span>&nbsp;<span class="op" id="1855557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855560">env</span>&nbsp;<span class="op" id="1855564">:=</span>&nbsp;<span class="ident" id="1855567">environ</span><span class="op" id="1855574">(</span><span class="op" id="1855575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855578">if</span>&nbsp;<span class="ident" id="1855581">env</span>&nbsp;<span class="op" id="1855585">==</span>&nbsp;<span class="ident" id="1855588">nil</span>&nbsp;<span class="op" id="1855592">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855596">gothrow</span><span class="op" id="1855603">(</span><span class="string" id="1855604">&#34;getenv&nbsp;before&nbsp;env&nbsp;init&#34;</span><span class="op" id="1855628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855634">for</span>&nbsp;<span class="ident" id="1855638">_</span><span class="op" id="1855639">,</span>&nbsp;<span class="ident" id="1855641">s</span>&nbsp;<span class="op" id="1855643">:=</span>&nbsp;<span class="keyword" id="1855646">range</span>&nbsp;<span class="ident" id="1855652">environ</span><span class="op" id="1855659">(</span><span class="op" id="1855660">)</span>&nbsp;<span class="op" id="1855662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855666">if</span>&nbsp;<span class="builtinfunc" id="1855669">len</span><span class="op" id="1855672">(</span><span class="ident" id="1855673">s</span><span class="op" id="1855674">)</span>&nbsp;<span class="op" id="1855676">&gt;</span>&nbsp;<span class="builtinfunc" id="1855678">len</span><span class="op" id="1855681">(</span><span class="ident" id="1855682">key</span><span class="op" id="1855685">)</span>&nbsp;<span class="op" id="1855687">&amp;&amp;</span>&nbsp;<span class="ident" id="1855690">s</span><span class="op" id="1855691">[</span><span class="builtinfunc" id="1855692">len</span><span class="op" id="1855695">(</span><span class="ident" id="1855696">key</span><span class="op" id="1855699">)</span><span class="op" id="1855700">]</span>&nbsp;<span class="op" id="1855702">==</span>&nbsp;<span class="string" id="1855705">&#39;=&#39;</span>&nbsp;<span class="op" id="1855709">&amp;&amp;</span>&nbsp;<span class="ident" id="1855712">s</span><span class="op" id="1855713">[</span><span class="op" id="1855714">:</span><span class="builtinfunc" id="1855715">len</span><span class="op" id="1855718">(</span><span class="ident" id="1855719">key</span><span class="op" id="1855722">)</span><span class="op" id="1855723">]</span>&nbsp;<span class="op" id="1855725">==</span>&nbsp;<span class="ident" id="1855728">key</span>&nbsp;<span class="op" id="1855732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855737">return</span>&nbsp;<span class="ident" id="1855744">s</span><span class="op" id="1855745">[</span><span class="builtinfunc" id="1855746">len</span><span class="op" id="1855749">(</span><span class="ident" id="1855750">key</span><span class="op" id="1855753">)</span><span class="op" id="1855754">+</span><span class="num" id="1855755">1</span><span class="op" id="1855756">:</span><span class="op" id="1855757">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855767">return</span>&nbsp;<span class="string" id="1855774">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1855777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1855780">var</span>&nbsp;<span class="ident" id="1855784">_cgo_setenv</span>&nbsp;<span class="builtintype" id="1855796">uintptr</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1855806">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="1855831">var</span>&nbsp;<span class="ident" id="1855835">_cgo_unsetenv</span>&nbsp;<span class="builtintype" id="1855849">uintptr</span>&nbsp;<span class="comment" id="1855857">//&nbsp;pointer&nbsp;to&nbsp;C&nbsp;function</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1855883">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1855929">//&nbsp;Called&nbsp;from&nbsp;syscall.Setenv.</span><br>
<span class="lineno">40</span><span class="keyword" id="1855960">func</span>&nbsp;<span class="ident" id="1855965">syscall_setenv_c</span><span class="op" id="1855981">(</span><span class="ident" id="1855982">k</span>&nbsp;<span class="builtintype" id="1855984">string</span><span class="op" id="1855990">,</span>&nbsp;<span class="ident" id="1855992">v</span>&nbsp;<span class="builtintype" id="1855994">string</span><span class="op" id="1856000">)</span>&nbsp;<span class="op" id="1856002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856005">if</span>&nbsp;<span class="ident" id="1856008">_cgo_setenv</span>&nbsp;<span class="op" id="1856020">==</span>&nbsp;<span class="num" id="1856023">0</span>&nbsp;<span class="op" id="1856025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856029">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856040">arg</span>&nbsp;<span class="op" id="1856044">:=</span>&nbsp;<span class="op" id="1856047">[</span><span class="num" id="1856048">2</span><span class="op" id="1856049">]</span><span class="ident" id="1856050">unsafe</span><span class="op" id="1856056">.</span><span class="ident" id="1856057">Pointer</span><span class="op" id="1856064">{</span><span class="ident" id="1856065">cstring</span><span class="op" id="1856072">(</span><span class="ident" id="1856073">k</span><span class="op" id="1856074">)</span><span class="op" id="1856075">,</span>&nbsp;<span class="ident" id="1856077">cstring</span><span class="op" id="1856084">(</span><span class="ident" id="1856085">v</span><span class="op" id="1856086">)</span><span class="op" id="1856087">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856090">asmcgocall</span><span class="op" id="1856100">(</span><span class="ident" id="1856101">unsafe</span><span class="op" id="1856107">.</span><span class="ident" id="1856108">Pointer</span><span class="op" id="1856115">(</span><span class="ident" id="1856116">_cgo_setenv</span><span class="op" id="1856127">)</span><span class="op" id="1856128">,</span>&nbsp;<span class="ident" id="1856130">unsafe</span><span class="op" id="1856136">.</span><span class="ident" id="1856137">Pointer</span><span class="op" id="1856144">(</span><span class="op" id="1856145">&amp;</span><span class="ident" id="1856146">arg</span><span class="op" id="1856149">)</span><span class="op" id="1856150">)</span><br>
<span class="lineno"></span><span class="op" id="1856152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1856155">//&nbsp;Update&nbsp;the&nbsp;C&nbsp;environment&nbsp;if&nbsp;cgo&nbsp;is&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="comment" id="1856201">//&nbsp;Called&nbsp;from&nbsp;syscall.unsetenv.</span><br>
<span class="lineno">50</span><span class="keyword" id="1856234">func</span>&nbsp;<span class="ident" id="1856239">syscall_unsetenv_c</span><span class="op" id="1856257">(</span><span class="ident" id="1856258">k</span>&nbsp;<span class="builtintype" id="1856260">string</span><span class="op" id="1856266">)</span>&nbsp;<span class="op" id="1856268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856271">if</span>&nbsp;<span class="ident" id="1856274">_cgo_unsetenv</span>&nbsp;<span class="op" id="1856288">==</span>&nbsp;<span class="num" id="1856291">0</span>&nbsp;<span class="op" id="1856293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856308">arg</span>&nbsp;<span class="op" id="1856312">:=</span>&nbsp;<span class="op" id="1856315">[</span><span class="num" id="1856316">1</span><span class="op" id="1856317">]</span><span class="ident" id="1856318">unsafe</span><span class="op" id="1856324">.</span><span class="ident" id="1856325">Pointer</span><span class="op" id="1856332">{</span><span class="ident" id="1856333">cstring</span><span class="op" id="1856340">(</span><span class="ident" id="1856341">k</span><span class="op" id="1856342">)</span><span class="op" id="1856343">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856346">asmcgocall</span><span class="op" id="1856356">(</span><span class="ident" id="1856357">unsafe</span><span class="op" id="1856363">.</span><span class="ident" id="1856364">Pointer</span><span class="op" id="1856371">(</span><span class="ident" id="1856372">_cgo_unsetenv</span><span class="op" id="1856385">)</span><span class="op" id="1856386">,</span>&nbsp;<span class="ident" id="1856388">unsafe</span><span class="op" id="1856394">.</span><span class="ident" id="1856395">Pointer</span><span class="op" id="1856402">(</span><span class="op" id="1856403">&amp;</span><span class="ident" id="1856404">arg</span><span class="op" id="1856407">)</span><span class="op" id="1856408">)</span><br>
<span class="lineno"></span><span class="op" id="1856410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1856413">func</span>&nbsp;<span class="ident" id="1856418">cstring</span><span class="op" id="1856425">(</span><span class="ident" id="1856426">s</span>&nbsp;<span class="builtintype" id="1856428">string</span><span class="op" id="1856434">)</span>&nbsp;<span class="ident" id="1856436">unsafe</span><span class="op" id="1856442">.</span><span class="ident" id="1856443">Pointer</span>&nbsp;<span class="op" id="1856451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856454">p</span>&nbsp;<span class="op" id="1856456">:=</span>&nbsp;<span class="builtinfunc" id="1856459">make</span><span class="op" id="1856463">(</span><span class="op" id="1856464">[</span><span class="op" id="1856465">]</span><span class="builtintype" id="1856466">byte</span><span class="op" id="1856470">,</span>&nbsp;<span class="builtinfunc" id="1856472">len</span><span class="op" id="1856475">(</span><span class="ident" id="1856476">s</span><span class="op" id="1856477">)</span><span class="op" id="1856478">+</span><span class="num" id="1856479">1</span><span class="op" id="1856480">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856483">sp</span>&nbsp;<span class="op" id="1856486">:=</span>&nbsp;<span class="op" id="1856489">(</span><span class="op" id="1856490">*</span><span class="ident" id="1856491">_string</span><span class="op" id="1856498">)</span><span class="op" id="1856499">(</span><span class="ident" id="1856500">unsafe</span><span class="op" id="1856506">.</span><span class="ident" id="1856507">Pointer</span><span class="op" id="1856514">(</span><span class="op" id="1856515">&amp;</span><span class="ident" id="1856516">s</span><span class="op" id="1856517">)</span><span class="op" id="1856518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856521">memmove</span><span class="op" id="1856528">(</span><span class="ident" id="1856529">unsafe</span><span class="op" id="1856535">.</span><span class="ident" id="1856536">Pointer</span><span class="op" id="1856543">(</span><span class="op" id="1856544">&amp;</span><span class="ident" id="1856545">p</span><span class="op" id="1856546">[</span><span class="num" id="1856547">0</span><span class="op" id="1856548">]</span><span class="op" id="1856549">)</span><span class="op" id="1856550">,</span>&nbsp;<span class="ident" id="1856552">unsafe</span><span class="op" id="1856558">.</span><span class="ident" id="1856559">Pointer</span><span class="op" id="1856566">(</span><span class="ident" id="1856567">sp</span><span class="op" id="1856569">.</span><span class="ident" id="1856570">str</span><span class="op" id="1856573">)</span><span class="op" id="1856574">,</span>&nbsp;<span class="builtintype" id="1856576">uintptr</span><span class="op" id="1856583">(</span><span class="builtinfunc" id="1856584">len</span><span class="op" id="1856587">(</span><span class="ident" id="1856588">s</span><span class="op" id="1856589">)</span><span class="op" id="1856590">)</span><span class="op" id="1856591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856594">return</span>&nbsp;<span class="ident" id="1856601">unsafe</span><span class="op" id="1856607">.</span><span class="ident" id="1856608">Pointer</span><span class="op" id="1856615">(</span><span class="op" id="1856616">&amp;</span><span class="ident" id="1856617">p</span><span class="op" id="1856618">[</span><span class="num" id="1856619">0</span><span class="op" id="1856620">]</span><span class="op" id="1856621">)</span><br>
<span class="lineno"></span><span class="op" id="1856623">}</span>
</div>
</body>
</html>
