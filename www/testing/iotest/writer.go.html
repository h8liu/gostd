<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6273294">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6273349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6273403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6273454">package</span>&nbsp;<span class="ident" id="6273462">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6273470">import</span>&nbsp;<span class="string" id="6273477">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6273483">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="6273535">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6273572">func</span>&nbsp;<span class="ident" id="6273577">TruncateWriter</span><span class="op" id="6273591">(</span><span class="ident" id="6273592">w</span>&nbsp;<span class="ident" id="6273594">io</span><span class="op" id="6273596">.</span><span class="ident" id="6273597">Writer</span><span class="op" id="6273603">,</span>&nbsp;<span class="ident" id="6273605">n</span>&nbsp;<span class="ident" id="6273607">int64</span><span class="op" id="6273612">)</span>&nbsp;<span class="ident" id="6273614">io</span><span class="op" id="6273616">.</span><span class="ident" id="6273617">Writer</span>&nbsp;<span class="op" id="6273624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273627">return</span>&nbsp;<span class="op" id="6273634">&amp;</span><span class="ident" id="6273635">truncateWriter</span><span class="op" id="6273649">{</span><span class="ident" id="6273650">w</span><span class="op" id="6273651">,</span>&nbsp;<span class="ident" id="6273653">n</span><span class="op" id="6273654">}</span><br>
<span class="lineno"></span><span class="op" id="6273656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6273659">type</span>&nbsp;<span class="ident" id="6273664">truncateWriter</span>&nbsp;<span class="keyword" id="6273679">struct</span>&nbsp;<span class="op" id="6273686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273689">w</span>&nbsp;<span class="ident" id="6273691">io</span><span class="op" id="6273693">.</span><span class="ident" id="6273694">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273702">n</span>&nbsp;<span class="ident" id="6273704">int64</span><br>
<span class="lineno"></span><span class="op" id="6273710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6273713">func</span>&nbsp;<span class="op" id="6273718">(</span><span class="ident" id="6273719">t</span>&nbsp;<span class="op" id="6273721">*</span><span class="ident" id="6273722">truncateWriter</span><span class="op" id="6273736">)</span>&nbsp;<span class="ident" id="6273738">Write</span><span class="op" id="6273743">(</span><span class="ident" id="6273744">p</span>&nbsp;<span class="op" id="6273746">[</span><span class="op" id="6273747">]</span><span class="builtintype" id="6273748">byte</span><span class="op" id="6273752">)</span>&nbsp;<span class="op" id="6273754">(</span><span class="ident" id="6273755">n</span>&nbsp;<span class="builtintype" id="6273757">int</span><span class="op" id="6273760">,</span>&nbsp;<span class="ident" id="6273762">err</span>&nbsp;<span class="builtintype" id="6273766">error</span><span class="op" id="6273771">)</span>&nbsp;<span class="op" id="6273773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273776">if</span>&nbsp;<span class="ident" id="6273779">t</span><span class="op" id="6273780">.</span><span class="ident" id="6273781">n</span>&nbsp;<span class="op" id="6273783">&lt;=</span>&nbsp;<span class="num" id="6273786">0</span>&nbsp;<span class="op" id="6273788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273792">return</span>&nbsp;<span class="builtinfunc" id="6273799">len</span><span class="op" id="6273802">(</span><span class="ident" id="6273803">p</span><span class="op" id="6273804">)</span><span class="op" id="6273805">,</span>&nbsp;<span class="ident" id="6273807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6273815">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273830">n</span>&nbsp;<span class="op" id="6273832">=</span>&nbsp;<span class="builtinfunc" id="6273834">len</span><span class="op" id="6273837">(</span><span class="ident" id="6273838">p</span><span class="op" id="6273839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273842">if</span>&nbsp;<span class="ident" id="6273845">int64</span><span class="op" id="6273850">(</span><span class="ident" id="6273851">n</span><span class="op" id="6273852">)</span>&nbsp;<span class="op" id="6273854">&gt;</span>&nbsp;<span class="ident" id="6273856">t</span><span class="op" id="6273857">.</span><span class="ident" id="6273858">n</span>&nbsp;<span class="op" id="6273860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273864">n</span>&nbsp;<span class="op" id="6273866">=</span>&nbsp;<span class="builtintype" id="6273868">int</span><span class="op" id="6273871">(</span><span class="ident" id="6273872">t</span><span class="op" id="6273873">.</span><span class="ident" id="6273874">n</span><span class="op" id="6273875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273881">n</span><span class="op" id="6273882">,</span>&nbsp;<span class="ident" id="6273884">err</span>&nbsp;<span class="op" id="6273888">=</span>&nbsp;<span class="ident" id="6273890">t</span><span class="op" id="6273891">.</span><span class="ident" id="6273892">w</span><span class="op" id="6273893">.</span><span class="ident" id="6273894">Write</span><span class="op" id="6273899">(</span><span class="ident" id="6273900">p</span><span class="op" id="6273901">[</span><span class="num" id="6273902">0</span><span class="op" id="6273903">:</span><span class="ident" id="6273904">n</span><span class="op" id="6273905">]</span><span class="op" id="6273906">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273909">t</span><span class="op" id="6273910">.</span><span class="ident" id="6273911">n</span>&nbsp;<span class="op" id="6273913">-=</span>&nbsp;<span class="ident" id="6273916">int64</span><span class="op" id="6273921">(</span><span class="ident" id="6273922">n</span><span class="op" id="6273923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273926">if</span>&nbsp;<span class="ident" id="6273929">err</span>&nbsp;<span class="op" id="6273933">==</span>&nbsp;<span class="ident" id="6273936">nil</span>&nbsp;<span class="op" id="6273940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6273944">n</span>&nbsp;<span class="op" id="6273946">=</span>&nbsp;<span class="builtinfunc" id="6273948">len</span><span class="op" id="6273951">(</span><span class="ident" id="6273952">p</span><span class="op" id="6273953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6273956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6273959">return</span><br>
<span class="lineno">35</span><span class="op" id="6273966">}</span>
</div>
</body>
</html>
