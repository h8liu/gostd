<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3756326">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3756382">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3756436">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3756487">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3756565">package</span>&nbsp;<span class="ident" id="3756573">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3756578">import</span>&nbsp;<span class="op" id="3756585">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756588">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756598">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756604">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3756615">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3756622">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3756625">func</span>&nbsp;<span class="ident" id="3756630">unixSocket</span><span class="op" id="3756640">(</span><span class="ident" id="3756641">net</span>&nbsp;<span class="builtintype" id="3756645">string</span><span class="op" id="3756651">,</span>&nbsp;<span class="ident" id="3756653">laddr</span><span class="op" id="3756658">,</span>&nbsp;<span class="ident" id="3756660">raddr</span>&nbsp;<span class="ident" id="3756666">sockaddr</span><span class="op" id="3756674">,</span>&nbsp;<span class="ident" id="3756676">mode</span>&nbsp;<span class="builtintype" id="3756681">string</span><span class="op" id="3756687">,</span>&nbsp;<span class="ident" id="3756689">deadline</span>&nbsp;<span class="ident" id="3756698">time</span><span class="op" id="3756702">.</span><span class="ident" id="3756703">Time</span><span class="op" id="3756707">)</span>&nbsp;<span class="op" id="3756709">(</span><span class="op" id="3756710">*</span><span class="ident" id="3756711">netFD</span><span class="op" id="3756716">,</span>&nbsp;<span class="builtintype" id="3756718">error</span><span class="op" id="3756723">)</span>&nbsp;<span class="op" id="3756725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756728">var</span>&nbsp;<span class="ident" id="3756732">sotype</span>&nbsp;<span class="builtintype" id="3756739">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756744">switch</span>&nbsp;<span class="ident" id="3756751">net</span>&nbsp;<span class="op" id="3756755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756758">case</span>&nbsp;<span class="string" id="3756763">&#34;unix&#34;</span><span class="op" id="3756769">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756773">sotype</span>&nbsp;<span class="op" id="3756780">=</span>&nbsp;<span class="ident" id="3756782">syscall</span><span class="op" id="3756789">.</span><span class="ident" id="3756790">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756803">case</span>&nbsp;<span class="string" id="3756808">&#34;unixgram&#34;</span><span class="op" id="3756818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756822">sotype</span>&nbsp;<span class="op" id="3756829">=</span>&nbsp;<span class="ident" id="3756831">syscall</span><span class="op" id="3756838">.</span><span class="ident" id="3756839">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756851">case</span>&nbsp;<span class="string" id="3756856">&#34;unixpacket&#34;</span><span class="op" id="3756868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756872">sotype</span>&nbsp;<span class="op" id="3756879">=</span>&nbsp;<span class="ident" id="3756881">syscall</span><span class="op" id="3756888">.</span><span class="ident" id="3756889">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756905">default</span><span class="op" id="3756912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756916">return</span>&nbsp;<span class="ident" id="3756923">nil</span><span class="op" id="3756926">,</span>&nbsp;<span class="ident" id="3756928">UnknownNetworkError</span><span class="op" id="3756947">(</span><span class="ident" id="3756948">net</span><span class="op" id="3756951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3756954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756958">switch</span>&nbsp;<span class="ident" id="3756965">mode</span>&nbsp;<span class="op" id="3756970">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756973">case</span>&nbsp;<span class="string" id="3756978">&#34;dial&#34;</span><span class="op" id="3756984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756988">if</span>&nbsp;<span class="ident" id="3756991">laddr</span>&nbsp;<span class="op" id="3756997">!=</span>&nbsp;<span class="ident" id="3757000">nil</span>&nbsp;<span class="op" id="3757004">&amp;&amp;</span>&nbsp;<span class="ident" id="3757007">laddr</span><span class="op" id="3757012">.</span><span class="ident" id="3757013">isWildcard</span><span class="op" id="3757023">(</span><span class="op" id="3757024">)</span>&nbsp;<span class="op" id="3757026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757031">laddr</span>&nbsp;<span class="op" id="3757037">=</span>&nbsp;<span class="ident" id="3757039">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757049">if</span>&nbsp;<span class="ident" id="3757052">raddr</span>&nbsp;<span class="op" id="3757058">!=</span>&nbsp;<span class="ident" id="3757061">nil</span>&nbsp;<span class="op" id="3757065">&amp;&amp;</span>&nbsp;<span class="ident" id="3757068">raddr</span><span class="op" id="3757073">.</span><span class="ident" id="3757074">isWildcard</span><span class="op" id="3757084">(</span><span class="op" id="3757085">)</span>&nbsp;<span class="op" id="3757087">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757092">raddr</span>&nbsp;<span class="op" id="3757098">=</span>&nbsp;<span class="ident" id="3757100">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757110">if</span>&nbsp;<span class="ident" id="3757113">raddr</span>&nbsp;<span class="op" id="3757119">==</span>&nbsp;<span class="ident" id="3757122">nil</span>&nbsp;<span class="op" id="3757126">&amp;&amp;</span>&nbsp;<span class="op" id="3757129">(</span><span class="ident" id="3757130">sotype</span>&nbsp;<span class="op" id="3757137">!=</span>&nbsp;<span class="ident" id="3757140">syscall</span><span class="op" id="3757147">.</span><span class="ident" id="3757148">SOCK_DGRAM</span>&nbsp;<span class="op" id="3757159">||</span>&nbsp;<span class="ident" id="3757162">laddr</span>&nbsp;<span class="op" id="3757168">==</span>&nbsp;<span class="ident" id="3757171">nil</span><span class="op" id="3757174">)</span>&nbsp;<span class="op" id="3757176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757181">return</span>&nbsp;<span class="ident" id="3757188">nil</span><span class="op" id="3757191">,</span>&nbsp;<span class="ident" id="3757193">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757213">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757216">case</span>&nbsp;<span class="string" id="3757221">&#34;listen&#34;</span><span class="op" id="3757229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757232">default</span><span class="op" id="3757239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757243">return</span>&nbsp;<span class="ident" id="3757250">nil</span><span class="op" id="3757253">,</span>&nbsp;<span class="ident" id="3757255">errors</span><span class="op" id="3757261">.</span><span class="ident" id="3757262">New</span><span class="op" id="3757265">(</span><span class="string" id="3757266">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3757283">+</span>&nbsp;<span class="ident" id="3757285">mode</span><span class="op" id="3757289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757296">fd</span><span class="op" id="3757298">,</span>&nbsp;<span class="ident" id="3757300">err</span>&nbsp;<span class="op" id="3757304">:=</span>&nbsp;<span class="ident" id="3757307">socket</span><span class="op" id="3757313">(</span><span class="ident" id="3757314">net</span><span class="op" id="3757317">,</span>&nbsp;<span class="ident" id="3757319">syscall</span><span class="op" id="3757326">.</span><span class="ident" id="3757327">AF_UNIX</span><span class="op" id="3757334">,</span>&nbsp;<span class="ident" id="3757336">sotype</span><span class="op" id="3757342">,</span>&nbsp;<span class="num" id="3757344">0</span><span class="op" id="3757345">,</span>&nbsp;<span class="builtintype" id="3757347">false</span><span class="op" id="3757352">,</span>&nbsp;<span class="ident" id="3757354">laddr</span><span class="op" id="3757359">,</span>&nbsp;<span class="ident" id="3757361">raddr</span><span class="op" id="3757366">,</span>&nbsp;<span class="ident" id="3757368">deadline</span><span class="op" id="3757376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757379">if</span>&nbsp;<span class="ident" id="3757382">err</span>&nbsp;<span class="op" id="3757386">!=</span>&nbsp;<span class="ident" id="3757389">nil</span>&nbsp;<span class="op" id="3757393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757397">return</span>&nbsp;<span class="ident" id="3757404">nil</span><span class="op" id="3757407">,</span>&nbsp;<span class="ident" id="3757409">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757417">return</span>&nbsp;<span class="ident" id="3757424">fd</span><span class="op" id="3757426">,</span>&nbsp;<span class="ident" id="3757428">nil</span><br>
<span class="lineno">50</span><span class="op" id="3757432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757435">func</span>&nbsp;<span class="ident" id="3757440">sockaddrToUnix</span><span class="op" id="3757454">(</span><span class="ident" id="3757455">sa</span>&nbsp;<span class="ident" id="3757458">syscall</span><span class="op" id="3757465">.</span><span class="ident" id="3757466">Sockaddr</span><span class="op" id="3757474">)</span>&nbsp;<span class="ident" id="3757476">Addr</span>&nbsp;<span class="op" id="3757481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757484">if</span>&nbsp;<span class="ident" id="3757487">s</span><span class="op" id="3757488">,</span>&nbsp;<span class="ident" id="3757490">ok</span>&nbsp;<span class="op" id="3757493">:=</span>&nbsp;<span class="ident" id="3757496">sa</span><span class="op" id="3757498">.</span><span class="op" id="3757499">(</span><span class="op" id="3757500">*</span><span class="ident" id="3757501">syscall</span><span class="op" id="3757508">.</span><span class="ident" id="3757509">SockaddrUnix</span><span class="op" id="3757521">)</span><span class="op" id="3757522">;</span>&nbsp;<span class="ident" id="3757524">ok</span>&nbsp;<span class="op" id="3757527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757531">return</span>&nbsp;<span class="op" id="3757538">&amp;</span><span class="ident" id="3757539">UnixAddr</span><span class="op" id="3757547">{</span><span class="ident" id="3757548">Name</span><span class="op" id="3757552">:</span>&nbsp;<span class="ident" id="3757554">s</span><span class="op" id="3757555">.</span><span class="ident" id="3757556">Name</span><span class="op" id="3757560">,</span>&nbsp;<span class="ident" id="3757562">Net</span><span class="op" id="3757565">:</span>&nbsp;<span class="string" id="3757567">&#34;unix&#34;</span><span class="op" id="3757573">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757579">return</span>&nbsp;<span class="ident" id="3757586">nil</span><br>
<span class="lineno"></span><span class="op" id="3757590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757593">func</span>&nbsp;<span class="ident" id="3757598">sockaddrToUnixgram</span><span class="op" id="3757616">(</span><span class="ident" id="3757617">sa</span>&nbsp;<span class="ident" id="3757620">syscall</span><span class="op" id="3757627">.</span><span class="ident" id="3757628">Sockaddr</span><span class="op" id="3757636">)</span>&nbsp;<span class="ident" id="3757638">Addr</span>&nbsp;<span class="op" id="3757643">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757646">if</span>&nbsp;<span class="ident" id="3757649">s</span><span class="op" id="3757650">,</span>&nbsp;<span class="ident" id="3757652">ok</span>&nbsp;<span class="op" id="3757655">:=</span>&nbsp;<span class="ident" id="3757658">sa</span><span class="op" id="3757660">.</span><span class="op" id="3757661">(</span><span class="op" id="3757662">*</span><span class="ident" id="3757663">syscall</span><span class="op" id="3757670">.</span><span class="ident" id="3757671">SockaddrUnix</span><span class="op" id="3757683">)</span><span class="op" id="3757684">;</span>&nbsp;<span class="ident" id="3757686">ok</span>&nbsp;<span class="op" id="3757689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757693">return</span>&nbsp;<span class="op" id="3757700">&amp;</span><span class="ident" id="3757701">UnixAddr</span><span class="op" id="3757709">{</span><span class="ident" id="3757710">Name</span><span class="op" id="3757714">:</span>&nbsp;<span class="ident" id="3757716">s</span><span class="op" id="3757717">.</span><span class="ident" id="3757718">Name</span><span class="op" id="3757722">,</span>&nbsp;<span class="ident" id="3757724">Net</span><span class="op" id="3757727">:</span>&nbsp;<span class="string" id="3757729">&#34;unixgram&#34;</span><span class="op" id="3757739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757745">return</span>&nbsp;<span class="ident" id="3757752">nil</span><br>
<span class="lineno"></span><span class="op" id="3757756">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3757759">func</span>&nbsp;<span class="ident" id="3757764">sockaddrToUnixpacket</span><span class="op" id="3757784">(</span><span class="ident" id="3757785">sa</span>&nbsp;<span class="ident" id="3757788">syscall</span><span class="op" id="3757795">.</span><span class="ident" id="3757796">Sockaddr</span><span class="op" id="3757804">)</span>&nbsp;<span class="ident" id="3757806">Addr</span>&nbsp;<span class="op" id="3757811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757814">if</span>&nbsp;<span class="ident" id="3757817">s</span><span class="op" id="3757818">,</span>&nbsp;<span class="ident" id="3757820">ok</span>&nbsp;<span class="op" id="3757823">:=</span>&nbsp;<span class="ident" id="3757826">sa</span><span class="op" id="3757828">.</span><span class="op" id="3757829">(</span><span class="op" id="3757830">*</span><span class="ident" id="3757831">syscall</span><span class="op" id="3757838">.</span><span class="ident" id="3757839">SockaddrUnix</span><span class="op" id="3757851">)</span><span class="op" id="3757852">;</span>&nbsp;<span class="ident" id="3757854">ok</span>&nbsp;<span class="op" id="3757857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757861">return</span>&nbsp;<span class="op" id="3757868">&amp;</span><span class="ident" id="3757869">UnixAddr</span><span class="op" id="3757877">{</span><span class="ident" id="3757878">Name</span><span class="op" id="3757882">:</span>&nbsp;<span class="ident" id="3757884">s</span><span class="op" id="3757885">.</span><span class="ident" id="3757886">Name</span><span class="op" id="3757890">,</span>&nbsp;<span class="ident" id="3757892">Net</span><span class="op" id="3757895">:</span>&nbsp;<span class="string" id="3757897">&#34;unixpacket&#34;</span><span class="op" id="3757909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757912">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757915">return</span>&nbsp;<span class="ident" id="3757922">nil</span><br>
<span class="lineno"></span><span class="op" id="3757926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3757929">func</span>&nbsp;<span class="ident" id="3757934">sotypeToNet</span><span class="op" id="3757945">(</span><span class="ident" id="3757946">sotype</span>&nbsp;<span class="builtintype" id="3757953">int</span><span class="op" id="3757956">)</span>&nbsp;<span class="builtintype" id="3757958">string</span>&nbsp;<span class="op" id="3757965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757968">switch</span>&nbsp;<span class="ident" id="3757975">sotype</span>&nbsp;<span class="op" id="3757982">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757985">case</span>&nbsp;<span class="ident" id="3757990">syscall</span><span class="op" id="3757997">.</span><span class="ident" id="3757998">SOCK_STREAM</span><span class="op" id="3758009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758013">return</span>&nbsp;<span class="string" id="3758020">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758028">case</span>&nbsp;<span class="ident" id="3758033">syscall</span><span class="op" id="3758040">.</span><span class="ident" id="3758041">SOCK_DGRAM</span><span class="op" id="3758051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758055">return</span>&nbsp;<span class="string" id="3758062">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758074">case</span>&nbsp;<span class="ident" id="3758079">syscall</span><span class="op" id="3758086">.</span><span class="ident" id="3758087">SOCK_SEQPACKET</span><span class="op" id="3758101">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758105">return</span>&nbsp;<span class="string" id="3758112">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758126">default</span><span class="op" id="3758133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3758137">panic</span><span class="op" id="3758142">(</span><span class="string" id="3758143">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3758176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758179">}</span><br>
<span class="lineno"></span><span class="op" id="3758181">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3758184">func</span>&nbsp;<span class="op" id="3758189">(</span><span class="ident" id="3758190">a</span>&nbsp;<span class="op" id="3758192">*</span><span class="ident" id="3758193">UnixAddr</span><span class="op" id="3758201">)</span>&nbsp;<span class="ident" id="3758203">family</span><span class="op" id="3758209">(</span><span class="op" id="3758210">)</span>&nbsp;<span class="builtintype" id="3758212">int</span>&nbsp;<span class="op" id="3758216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758219">return</span>&nbsp;<span class="ident" id="3758226">syscall</span><span class="op" id="3758233">.</span><span class="ident" id="3758234">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3758242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3758245">func</span>&nbsp;<span class="op" id="3758250">(</span><span class="ident" id="3758251">a</span>&nbsp;<span class="op" id="3758253">*</span><span class="ident" id="3758254">UnixAddr</span><span class="op" id="3758262">)</span>&nbsp;<span class="ident" id="3758264">isWildcard</span><span class="op" id="3758274">(</span><span class="op" id="3758275">)</span>&nbsp;<span class="builtintype" id="3758277">bool</span>&nbsp;<span class="op" id="3758282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758285">return</span>&nbsp;<span class="ident" id="3758292">a</span>&nbsp;<span class="op" id="3758294">==</span>&nbsp;<span class="ident" id="3758297">nil</span>&nbsp;<span class="op" id="3758301">||</span>&nbsp;<span class="ident" id="3758304">a</span><span class="op" id="3758305">.</span><span class="ident" id="3758306">Name</span>&nbsp;<span class="op" id="3758311">==</span>&nbsp;<span class="string" id="3758314">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3758317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758320">func</span>&nbsp;<span class="op" id="3758325">(</span><span class="ident" id="3758326">a</span>&nbsp;<span class="op" id="3758328">*</span><span class="ident" id="3758329">UnixAddr</span><span class="op" id="3758337">)</span>&nbsp;<span class="ident" id="3758339">sockaddr</span><span class="op" id="3758347">(</span><span class="ident" id="3758348">family</span>&nbsp;<span class="builtintype" id="3758355">int</span><span class="op" id="3758358">)</span>&nbsp;<span class="op" id="3758360">(</span><span class="ident" id="3758361">syscall</span><span class="op" id="3758368">.</span><span class="ident" id="3758369">Sockaddr</span><span class="op" id="3758377">,</span>&nbsp;<span class="builtintype" id="3758379">error</span><span class="op" id="3758384">)</span>&nbsp;<span class="op" id="3758386">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758389">if</span>&nbsp;<span class="ident" id="3758392">a</span>&nbsp;<span class="op" id="3758394">==</span>&nbsp;<span class="ident" id="3758397">nil</span>&nbsp;<span class="op" id="3758401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758405">return</span>&nbsp;<span class="ident" id="3758412">nil</span><span class="op" id="3758415">,</span>&nbsp;<span class="ident" id="3758417">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758425">return</span>&nbsp;<span class="op" id="3758432">&amp;</span><span class="ident" id="3758433">syscall</span><span class="op" id="3758440">.</span><span class="ident" id="3758441">SockaddrUnix</span><span class="op" id="3758453">{</span><span class="ident" id="3758454">Name</span><span class="op" id="3758458">:</span>&nbsp;<span class="ident" id="3758460">a</span><span class="op" id="3758461">.</span><span class="ident" id="3758462">Name</span><span class="op" id="3758466">}</span><span class="op" id="3758467">,</span>&nbsp;<span class="ident" id="3758469">nil</span><br>
<span class="lineno"></span><span class="op" id="3758473">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3758476">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3758547">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3758574">type</span>&nbsp;<span class="ident" id="3758579">UnixConn</span>&nbsp;<span class="keyword" id="3758588">struct</span>&nbsp;<span class="op" id="3758595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758598">conn</span><br>
<span class="lineno">105</span><span class="op" id="3758603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758606">func</span>&nbsp;<span class="ident" id="3758611">newUnixConn</span><span class="op" id="3758622">(</span><span class="ident" id="3758623">fd</span>&nbsp;<span class="op" id="3758626">*</span><span class="ident" id="3758627">netFD</span><span class="op" id="3758632">)</span>&nbsp;<span class="op" id="3758634">*</span><span class="ident" id="3758635">UnixConn</span>&nbsp;<span class="op" id="3758644">{</span>&nbsp;<span class="keyword" id="3758646">return</span>&nbsp;<span class="op" id="3758653">&amp;</span><span class="ident" id="3758654">UnixConn</span><span class="op" id="3758662">{</span><span class="ident" id="3758663">conn</span><span class="op" id="3758667">{</span><span class="ident" id="3758668">fd</span><span class="op" id="3758670">}</span><span class="op" id="3758671">}</span>&nbsp;<span class="op" id="3758673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3758676">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3758747">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3758818">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3758833">//</span><br>
<span class="lineno"></span><span class="comment" id="3758836">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3758901">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3758968">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3758988">func</span>&nbsp;<span class="op" id="3758993">(</span><span class="ident" id="3758994">c</span>&nbsp;<span class="op" id="3758996">*</span><span class="ident" id="3758997">UnixConn</span><span class="op" id="3759005">)</span>&nbsp;<span class="ident" id="3759007">ReadFromUnix</span><span class="op" id="3759019">(</span><span class="ident" id="3759020">b</span>&nbsp;<span class="op" id="3759022">[</span><span class="op" id="3759023">]</span><span class="builtintype" id="3759024">byte</span><span class="op" id="3759028">)</span>&nbsp;<span class="op" id="3759030">(</span><span class="ident" id="3759031">n</span>&nbsp;<span class="builtintype" id="3759033">int</span><span class="op" id="3759036">,</span>&nbsp;<span class="ident" id="3759038">addr</span>&nbsp;<span class="op" id="3759043">*</span><span class="ident" id="3759044">UnixAddr</span><span class="op" id="3759052">,</span>&nbsp;<span class="ident" id="3759054">err</span>&nbsp;<span class="builtintype" id="3759058">error</span><span class="op" id="3759063">)</span>&nbsp;<span class="op" id="3759065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759068">if</span>&nbsp;<span class="op" id="3759071">!</span><span class="ident" id="3759072">c</span><span class="op" id="3759073">.</span><span class="ident" id="3759074">ok</span><span class="op" id="3759076">(</span><span class="op" id="3759077">)</span>&nbsp;<span class="op" id="3759079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759083">return</span>&nbsp;<span class="num" id="3759090">0</span><span class="op" id="3759091">,</span>&nbsp;<span class="ident" id="3759093">nil</span><span class="op" id="3759096">,</span>&nbsp;<span class="ident" id="3759098">syscall</span><span class="op" id="3759105">.</span><span class="ident" id="3759106">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759114">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759117">n</span><span class="op" id="3759118">,</span>&nbsp;<span class="ident" id="3759120">sa</span><span class="op" id="3759122">,</span>&nbsp;<span class="ident" id="3759124">err</span>&nbsp;<span class="op" id="3759128">:=</span>&nbsp;<span class="ident" id="3759131">c</span><span class="op" id="3759132">.</span><span class="ident" id="3759133">fd</span><span class="op" id="3759135">.</span><span class="ident" id="3759136">readFrom</span><span class="op" id="3759144">(</span><span class="ident" id="3759145">b</span><span class="op" id="3759146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759149">switch</span>&nbsp;<span class="ident" id="3759156">sa</span>&nbsp;<span class="op" id="3759159">:=</span>&nbsp;<span class="ident" id="3759162">sa</span><span class="op" id="3759164">.</span><span class="op" id="3759165">(</span><span class="keyword" id="3759166">type</span><span class="op" id="3759170">)</span>&nbsp;<span class="op" id="3759172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759175">case</span>&nbsp;<span class="op" id="3759180">*</span><span class="ident" id="3759181">syscall</span><span class="op" id="3759188">.</span><span class="ident" id="3759189">SockaddrUnix</span><span class="op" id="3759201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759205">if</span>&nbsp;<span class="ident" id="3759208">sa</span><span class="op" id="3759210">.</span><span class="ident" id="3759211">Name</span>&nbsp;<span class="op" id="3759216">!=</span>&nbsp;<span class="string" id="3759219">&#34;&#34;</span>&nbsp;<span class="op" id="3759222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759227">addr</span>&nbsp;<span class="op" id="3759232">=</span>&nbsp;<span class="op" id="3759234">&amp;</span><span class="ident" id="3759235">UnixAddr</span><span class="op" id="3759243">{</span><span class="ident" id="3759244">Name</span><span class="op" id="3759248">:</span>&nbsp;<span class="ident" id="3759250">sa</span><span class="op" id="3759252">.</span><span class="ident" id="3759253">Name</span><span class="op" id="3759257">,</span>&nbsp;<span class="ident" id="3759259">Net</span><span class="op" id="3759262">:</span>&nbsp;<span class="ident" id="3759264">sotypeToNet</span><span class="op" id="3759275">(</span><span class="ident" id="3759276">c</span><span class="op" id="3759277">.</span><span class="ident" id="3759278">fd</span><span class="op" id="3759280">.</span><span class="ident" id="3759281">sotype</span><span class="op" id="3759287">)</span><span class="op" id="3759288">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759298">return</span><br>
<span class="lineno"></span><span class="op" id="3759305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3759308">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3759363">func</span>&nbsp;<span class="op" id="3759368">(</span><span class="ident" id="3759369">c</span>&nbsp;<span class="op" id="3759371">*</span><span class="ident" id="3759372">UnixConn</span><span class="op" id="3759380">)</span>&nbsp;<span class="ident" id="3759382">ReadFrom</span><span class="op" id="3759390">(</span><span class="ident" id="3759391">b</span>&nbsp;<span class="op" id="3759393">[</span><span class="op" id="3759394">]</span><span class="builtintype" id="3759395">byte</span><span class="op" id="3759399">)</span>&nbsp;<span class="op" id="3759401">(</span><span class="builtintype" id="3759402">int</span><span class="op" id="3759405">,</span>&nbsp;<span class="ident" id="3759407">Addr</span><span class="op" id="3759411">,</span>&nbsp;<span class="builtintype" id="3759413">error</span><span class="op" id="3759418">)</span>&nbsp;<span class="op" id="3759420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759423">if</span>&nbsp;<span class="op" id="3759426">!</span><span class="ident" id="3759427">c</span><span class="op" id="3759428">.</span><span class="ident" id="3759429">ok</span><span class="op" id="3759431">(</span><span class="op" id="3759432">)</span>&nbsp;<span class="op" id="3759434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759438">return</span>&nbsp;<span class="num" id="3759445">0</span><span class="op" id="3759446">,</span>&nbsp;<span class="ident" id="3759448">nil</span><span class="op" id="3759451">,</span>&nbsp;<span class="ident" id="3759453">syscall</span><span class="op" id="3759460">.</span><span class="ident" id="3759461">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759469">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759472">n</span><span class="op" id="3759473">,</span>&nbsp;<span class="ident" id="3759475">addr</span><span class="op" id="3759479">,</span>&nbsp;<span class="ident" id="3759481">err</span>&nbsp;<span class="op" id="3759485">:=</span>&nbsp;<span class="ident" id="3759488">c</span><span class="op" id="3759489">.</span><span class="ident" id="3759490">ReadFromUnix</span><span class="op" id="3759502">(</span><span class="ident" id="3759503">b</span><span class="op" id="3759504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759507">return</span>&nbsp;<span class="ident" id="3759514">n</span><span class="op" id="3759515">,</span>&nbsp;<span class="ident" id="3759517">addr</span><span class="op" id="3759521">.</span><span class="ident" id="3759522">toAddr</span><span class="op" id="3759528">(</span><span class="op" id="3759529">)</span><span class="op" id="3759530">,</span>&nbsp;<span class="ident" id="3759532">err</span><br>
<span class="lineno"></span><span class="op" id="3759536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3759539">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3759608">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3759679">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3759750">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3759820">func</span>&nbsp;<span class="op" id="3759825">(</span><span class="ident" id="3759826">c</span>&nbsp;<span class="op" id="3759828">*</span><span class="ident" id="3759829">UnixConn</span><span class="op" id="3759837">)</span>&nbsp;<span class="ident" id="3759839">ReadMsgUnix</span><span class="op" id="3759850">(</span><span class="ident" id="3759851">b</span><span class="op" id="3759852">,</span>&nbsp;<span class="ident" id="3759854">oob</span>&nbsp;<span class="op" id="3759858">[</span><span class="op" id="3759859">]</span><span class="builtintype" id="3759860">byte</span><span class="op" id="3759864">)</span>&nbsp;<span class="op" id="3759866">(</span><span class="ident" id="3759867">n</span><span class="op" id="3759868">,</span>&nbsp;<span class="ident" id="3759870">oobn</span><span class="op" id="3759874">,</span>&nbsp;<span class="ident" id="3759876">flags</span>&nbsp;<span class="builtintype" id="3759882">int</span><span class="op" id="3759885">,</span>&nbsp;<span class="ident" id="3759887">addr</span>&nbsp;<span class="op" id="3759892">*</span><span class="ident" id="3759893">UnixAddr</span><span class="op" id="3759901">,</span>&nbsp;<span class="ident" id="3759903">err</span>&nbsp;<span class="builtintype" id="3759907">error</span><span class="op" id="3759912">)</span>&nbsp;<span class="op" id="3759914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759917">if</span>&nbsp;<span class="op" id="3759920">!</span><span class="ident" id="3759921">c</span><span class="op" id="3759922">.</span><span class="ident" id="3759923">ok</span><span class="op" id="3759925">(</span><span class="op" id="3759926">)</span>&nbsp;<span class="op" id="3759928">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759932">return</span>&nbsp;<span class="num" id="3759939">0</span><span class="op" id="3759940">,</span>&nbsp;<span class="num" id="3759942">0</span><span class="op" id="3759943">,</span>&nbsp;<span class="num" id="3759945">0</span><span class="op" id="3759946">,</span>&nbsp;<span class="ident" id="3759948">nil</span><span class="op" id="3759951">,</span>&nbsp;<span class="ident" id="3759953">syscall</span><span class="op" id="3759960">.</span><span class="ident" id="3759961">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759972">n</span><span class="op" id="3759973">,</span>&nbsp;<span class="ident" id="3759975">oobn</span><span class="op" id="3759979">,</span>&nbsp;<span class="ident" id="3759981">flags</span><span class="op" id="3759986">,</span>&nbsp;<span class="ident" id="3759988">sa</span><span class="op" id="3759990">,</span>&nbsp;<span class="ident" id="3759992">err</span>&nbsp;<span class="op" id="3759996">:=</span>&nbsp;<span class="ident" id="3759999">c</span><span class="op" id="3760000">.</span><span class="ident" id="3760001">fd</span><span class="op" id="3760003">.</span><span class="ident" id="3760004">readMsg</span><span class="op" id="3760011">(</span><span class="ident" id="3760012">b</span><span class="op" id="3760013">,</span>&nbsp;<span class="ident" id="3760015">oob</span><span class="op" id="3760018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760021">switch</span>&nbsp;<span class="ident" id="3760028">sa</span>&nbsp;<span class="op" id="3760031">:=</span>&nbsp;<span class="ident" id="3760034">sa</span><span class="op" id="3760036">.</span><span class="op" id="3760037">(</span><span class="keyword" id="3760038">type</span><span class="op" id="3760042">)</span>&nbsp;<span class="op" id="3760044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760047">case</span>&nbsp;<span class="op" id="3760052">*</span><span class="ident" id="3760053">syscall</span><span class="op" id="3760060">.</span><span class="ident" id="3760061">SockaddrUnix</span><span class="op" id="3760073">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760077">if</span>&nbsp;<span class="ident" id="3760080">sa</span><span class="op" id="3760082">.</span><span class="ident" id="3760083">Name</span>&nbsp;<span class="op" id="3760088">!=</span>&nbsp;<span class="string" id="3760091">&#34;&#34;</span>&nbsp;<span class="op" id="3760094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760099">addr</span>&nbsp;<span class="op" id="3760104">=</span>&nbsp;<span class="op" id="3760106">&amp;</span><span class="ident" id="3760107">UnixAddr</span><span class="op" id="3760115">{</span><span class="ident" id="3760116">Name</span><span class="op" id="3760120">:</span>&nbsp;<span class="ident" id="3760122">sa</span><span class="op" id="3760124">.</span><span class="ident" id="3760125">Name</span><span class="op" id="3760129">,</span>&nbsp;<span class="ident" id="3760131">Net</span><span class="op" id="3760134">:</span>&nbsp;<span class="ident" id="3760136">sotypeToNet</span><span class="op" id="3760147">(</span><span class="ident" id="3760148">c</span><span class="op" id="3760149">.</span><span class="ident" id="3760150">fd</span><span class="op" id="3760152">.</span><span class="ident" id="3760153">sotype</span><span class="op" id="3760159">)</span><span class="op" id="3760160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760170">return</span><br>
<span class="lineno">155</span><span class="op" id="3760177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3760180">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3760254">//</span><br>
<span class="lineno"></span><span class="comment" id="3760257">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3760321">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3760388">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3760457">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3760470">func</span>&nbsp;<span class="op" id="3760475">(</span><span class="ident" id="3760476">c</span>&nbsp;<span class="op" id="3760478">*</span><span class="ident" id="3760479">UnixConn</span><span class="op" id="3760487">)</span>&nbsp;<span class="ident" id="3760489">WriteToUnix</span><span class="op" id="3760500">(</span><span class="ident" id="3760501">b</span>&nbsp;<span class="op" id="3760503">[</span><span class="op" id="3760504">]</span><span class="builtintype" id="3760505">byte</span><span class="op" id="3760509">,</span>&nbsp;<span class="ident" id="3760511">addr</span>&nbsp;<span class="op" id="3760516">*</span><span class="ident" id="3760517">UnixAddr</span><span class="op" id="3760525">)</span>&nbsp;<span class="op" id="3760527">(</span><span class="ident" id="3760528">n</span>&nbsp;<span class="builtintype" id="3760530">int</span><span class="op" id="3760533">,</span>&nbsp;<span class="ident" id="3760535">err</span>&nbsp;<span class="builtintype" id="3760539">error</span><span class="op" id="3760544">)</span>&nbsp;<span class="op" id="3760546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760549">if</span>&nbsp;<span class="op" id="3760552">!</span><span class="ident" id="3760553">c</span><span class="op" id="3760554">.</span><span class="ident" id="3760555">ok</span><span class="op" id="3760557">(</span><span class="op" id="3760558">)</span>&nbsp;<span class="op" id="3760560">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760564">return</span>&nbsp;<span class="num" id="3760571">0</span><span class="op" id="3760572">,</span>&nbsp;<span class="ident" id="3760574">syscall</span><span class="op" id="3760581">.</span><span class="ident" id="3760582">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760593">if</span>&nbsp;<span class="ident" id="3760596">c</span><span class="op" id="3760597">.</span><span class="ident" id="3760598">fd</span><span class="op" id="3760600">.</span><span class="ident" id="3760601">isConnected</span>&nbsp;<span class="op" id="3760613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760617">return</span>&nbsp;<span class="num" id="3760624">0</span><span class="op" id="3760625">,</span>&nbsp;<span class="op" id="3760627">&amp;</span><span class="ident" id="3760628">OpError</span><span class="op" id="3760635">{</span><span class="ident" id="3760636">Op</span><span class="op" id="3760638">:</span>&nbsp;<span class="string" id="3760640">&#34;write&#34;</span><span class="op" id="3760647">,</span>&nbsp;<span class="ident" id="3760649">Net</span><span class="op" id="3760652">:</span>&nbsp;<span class="ident" id="3760654">c</span><span class="op" id="3760655">.</span><span class="ident" id="3760656">fd</span><span class="op" id="3760658">.</span><span class="ident" id="3760659">net</span><span class="op" id="3760662">,</span>&nbsp;<span class="ident" id="3760664">Addr</span><span class="op" id="3760668">:</span>&nbsp;<span class="ident" id="3760670">addr</span><span class="op" id="3760674">,</span>&nbsp;<span class="ident" id="3760676">Err</span><span class="op" id="3760679">:</span>&nbsp;<span class="ident" id="3760681">ErrWriteToConnected</span><span class="op" id="3760700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760703">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760706">if</span>&nbsp;<span class="ident" id="3760709">addr</span>&nbsp;<span class="op" id="3760714">==</span>&nbsp;<span class="ident" id="3760717">nil</span>&nbsp;<span class="op" id="3760721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760725">return</span>&nbsp;<span class="num" id="3760732">0</span><span class="op" id="3760733">,</span>&nbsp;<span class="op" id="3760735">&amp;</span><span class="ident" id="3760736">OpError</span><span class="op" id="3760743">{</span><span class="ident" id="3760744">Op</span><span class="op" id="3760746">:</span>&nbsp;<span class="string" id="3760748">&#34;write&#34;</span><span class="op" id="3760755">,</span>&nbsp;<span class="ident" id="3760757">Net</span><span class="op" id="3760760">:</span>&nbsp;<span class="ident" id="3760762">c</span><span class="op" id="3760763">.</span><span class="ident" id="3760764">fd</span><span class="op" id="3760766">.</span><span class="ident" id="3760767">net</span><span class="op" id="3760770">,</span>&nbsp;<span class="ident" id="3760772">Addr</span><span class="op" id="3760776">:</span>&nbsp;<span class="ident" id="3760778">nil</span><span class="op" id="3760781">,</span>&nbsp;<span class="ident" id="3760783">Err</span><span class="op" id="3760786">:</span>&nbsp;<span class="ident" id="3760788">errMissingAddress</span><span class="op" id="3760805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760811">if</span>&nbsp;<span class="ident" id="3760814">addr</span><span class="op" id="3760818">.</span><span class="ident" id="3760819">Net</span>&nbsp;<span class="op" id="3760823">!=</span>&nbsp;<span class="ident" id="3760826">sotypeToNet</span><span class="op" id="3760837">(</span><span class="ident" id="3760838">c</span><span class="op" id="3760839">.</span><span class="ident" id="3760840">fd</span><span class="op" id="3760842">.</span><span class="ident" id="3760843">sotype</span><span class="op" id="3760849">)</span>&nbsp;<span class="op" id="3760851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760855">return</span>&nbsp;<span class="num" id="3760862">0</span><span class="op" id="3760863">,</span>&nbsp;<span class="ident" id="3760865">syscall</span><span class="op" id="3760872">.</span><span class="ident" id="3760873">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760890">sa</span>&nbsp;<span class="op" id="3760893">:=</span>&nbsp;<span class="op" id="3760896">&amp;</span><span class="ident" id="3760897">syscall</span><span class="op" id="3760904">.</span><span class="ident" id="3760905">SockaddrUnix</span><span class="op" id="3760917">{</span><span class="ident" id="3760918">Name</span><span class="op" id="3760922">:</span>&nbsp;<span class="ident" id="3760924">addr</span><span class="op" id="3760928">.</span><span class="ident" id="3760929">Name</span><span class="op" id="3760933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760936">return</span>&nbsp;<span class="ident" id="3760943">c</span><span class="op" id="3760944">.</span><span class="ident" id="3760945">fd</span><span class="op" id="3760947">.</span><span class="ident" id="3760948">writeTo</span><span class="op" id="3760955">(</span><span class="ident" id="3760956">b</span><span class="op" id="3760957">,</span>&nbsp;<span class="ident" id="3760959">sa</span><span class="op" id="3760961">)</span><br>
<span class="lineno"></span><span class="op" id="3760963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3760966">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3761019">func</span>&nbsp;<span class="op" id="3761024">(</span><span class="ident" id="3761025">c</span>&nbsp;<span class="op" id="3761027">*</span><span class="ident" id="3761028">UnixConn</span><span class="op" id="3761036">)</span>&nbsp;<span class="ident" id="3761038">WriteTo</span><span class="op" id="3761045">(</span><span class="ident" id="3761046">b</span>&nbsp;<span class="op" id="3761048">[</span><span class="op" id="3761049">]</span><span class="builtintype" id="3761050">byte</span><span class="op" id="3761054">,</span>&nbsp;<span class="ident" id="3761056">addr</span>&nbsp;<span class="ident" id="3761061">Addr</span><span class="op" id="3761065">)</span>&nbsp;<span class="op" id="3761067">(</span><span class="ident" id="3761068">n</span>&nbsp;<span class="builtintype" id="3761070">int</span><span class="op" id="3761073">,</span>&nbsp;<span class="ident" id="3761075">err</span>&nbsp;<span class="builtintype" id="3761079">error</span><span class="op" id="3761084">)</span>&nbsp;<span class="op" id="3761086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761089">if</span>&nbsp;<span class="op" id="3761092">!</span><span class="ident" id="3761093">c</span><span class="op" id="3761094">.</span><span class="ident" id="3761095">ok</span><span class="op" id="3761097">(</span><span class="op" id="3761098">)</span>&nbsp;<span class="op" id="3761100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761104">return</span>&nbsp;<span class="num" id="3761111">0</span><span class="op" id="3761112">,</span>&nbsp;<span class="ident" id="3761114">syscall</span><span class="op" id="3761121">.</span><span class="ident" id="3761122">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761130">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761133">a</span><span class="op" id="3761134">,</span>&nbsp;<span class="ident" id="3761136">ok</span>&nbsp;<span class="op" id="3761139">:=</span>&nbsp;<span class="ident" id="3761142">addr</span><span class="op" id="3761146">.</span><span class="op" id="3761147">(</span><span class="op" id="3761148">*</span><span class="ident" id="3761149">UnixAddr</span><span class="op" id="3761157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761160">if</span>&nbsp;<span class="op" id="3761163">!</span><span class="ident" id="3761164">ok</span>&nbsp;<span class="op" id="3761167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761171">return</span>&nbsp;<span class="num" id="3761178">0</span><span class="op" id="3761179">,</span>&nbsp;<span class="op" id="3761181">&amp;</span><span class="ident" id="3761182">OpError</span><span class="op" id="3761189">{</span><span class="string" id="3761190">&#34;write&#34;</span><span class="op" id="3761197">,</span>&nbsp;<span class="ident" id="3761199">c</span><span class="op" id="3761200">.</span><span class="ident" id="3761201">fd</span><span class="op" id="3761203">.</span><span class="ident" id="3761204">net</span><span class="op" id="3761207">,</span>&nbsp;<span class="ident" id="3761209">addr</span><span class="op" id="3761213">,</span>&nbsp;<span class="ident" id="3761215">syscall</span><span class="op" id="3761222">.</span><span class="ident" id="3761223">EINVAL</span><span class="op" id="3761229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761235">return</span>&nbsp;<span class="ident" id="3761242">c</span><span class="op" id="3761243">.</span><span class="ident" id="3761244">WriteToUnix</span><span class="op" id="3761255">(</span><span class="ident" id="3761256">b</span><span class="op" id="3761257">,</span>&nbsp;<span class="ident" id="3761259">a</span><span class="op" id="3761260">)</span><br>
<span class="lineno">190</span><span class="op" id="3761262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3761265">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3761332">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3761400">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3761456">func</span>&nbsp;<span class="op" id="3761461">(</span><span class="ident" id="3761462">c</span>&nbsp;<span class="op" id="3761464">*</span><span class="ident" id="3761465">UnixConn</span><span class="op" id="3761473">)</span>&nbsp;<span class="ident" id="3761475">WriteMsgUnix</span><span class="op" id="3761487">(</span><span class="ident" id="3761488">b</span><span class="op" id="3761489">,</span>&nbsp;<span class="ident" id="3761491">oob</span>&nbsp;<span class="op" id="3761495">[</span><span class="op" id="3761496">]</span><span class="builtintype" id="3761497">byte</span><span class="op" id="3761501">,</span>&nbsp;<span class="ident" id="3761503">addr</span>&nbsp;<span class="op" id="3761508">*</span><span class="ident" id="3761509">UnixAddr</span><span class="op" id="3761517">)</span>&nbsp;<span class="op" id="3761519">(</span><span class="ident" id="3761520">n</span><span class="op" id="3761521">,</span>&nbsp;<span class="ident" id="3761523">oobn</span>&nbsp;<span class="builtintype" id="3761528">int</span><span class="op" id="3761531">,</span>&nbsp;<span class="ident" id="3761533">err</span>&nbsp;<span class="builtintype" id="3761537">error</span><span class="op" id="3761542">)</span>&nbsp;<span class="op" id="3761544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761547">if</span>&nbsp;<span class="op" id="3761550">!</span><span class="ident" id="3761551">c</span><span class="op" id="3761552">.</span><span class="ident" id="3761553">ok</span><span class="op" id="3761555">(</span><span class="op" id="3761556">)</span>&nbsp;<span class="op" id="3761558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761562">return</span>&nbsp;<span class="num" id="3761569">0</span><span class="op" id="3761570">,</span>&nbsp;<span class="num" id="3761572">0</span><span class="op" id="3761573">,</span>&nbsp;<span class="ident" id="3761575">syscall</span><span class="op" id="3761582">.</span><span class="ident" id="3761583">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761594">if</span>&nbsp;<span class="ident" id="3761597">c</span><span class="op" id="3761598">.</span><span class="ident" id="3761599">fd</span><span class="op" id="3761601">.</span><span class="ident" id="3761602">sotype</span>&nbsp;<span class="op" id="3761609">==</span>&nbsp;<span class="ident" id="3761612">syscall</span><span class="op" id="3761619">.</span><span class="ident" id="3761620">SOCK_DGRAM</span>&nbsp;<span class="op" id="3761631">&amp;&amp;</span>&nbsp;<span class="ident" id="3761634">c</span><span class="op" id="3761635">.</span><span class="ident" id="3761636">fd</span><span class="op" id="3761638">.</span><span class="ident" id="3761639">isConnected</span>&nbsp;<span class="op" id="3761651">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761655">return</span>&nbsp;<span class="num" id="3761662">0</span><span class="op" id="3761663">,</span>&nbsp;<span class="num" id="3761665">0</span><span class="op" id="3761666">,</span>&nbsp;<span class="op" id="3761668">&amp;</span><span class="ident" id="3761669">OpError</span><span class="op" id="3761676">{</span><span class="ident" id="3761677">Op</span><span class="op" id="3761679">:</span>&nbsp;<span class="string" id="3761681">&#34;write&#34;</span><span class="op" id="3761688">,</span>&nbsp;<span class="ident" id="3761690">Net</span><span class="op" id="3761693">:</span>&nbsp;<span class="ident" id="3761695">c</span><span class="op" id="3761696">.</span><span class="ident" id="3761697">fd</span><span class="op" id="3761699">.</span><span class="ident" id="3761700">net</span><span class="op" id="3761703">,</span>&nbsp;<span class="ident" id="3761705">Addr</span><span class="op" id="3761709">:</span>&nbsp;<span class="ident" id="3761711">addr</span><span class="op" id="3761715">,</span>&nbsp;<span class="ident" id="3761717">Err</span><span class="op" id="3761720">:</span>&nbsp;<span class="ident" id="3761722">ErrWriteToConnected</span><span class="op" id="3761741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761747">if</span>&nbsp;<span class="ident" id="3761750">addr</span>&nbsp;<span class="op" id="3761755">!=</span>&nbsp;<span class="ident" id="3761758">nil</span>&nbsp;<span class="op" id="3761762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761766">if</span>&nbsp;<span class="ident" id="3761769">addr</span><span class="op" id="3761773">.</span><span class="ident" id="3761774">Net</span>&nbsp;<span class="op" id="3761778">!=</span>&nbsp;<span class="ident" id="3761781">sotypeToNet</span><span class="op" id="3761792">(</span><span class="ident" id="3761793">c</span><span class="op" id="3761794">.</span><span class="ident" id="3761795">fd</span><span class="op" id="3761797">.</span><span class="ident" id="3761798">sotype</span><span class="op" id="3761804">)</span>&nbsp;<span class="op" id="3761806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761811">return</span>&nbsp;<span class="num" id="3761818">0</span><span class="op" id="3761819">,</span>&nbsp;<span class="num" id="3761821">0</span><span class="op" id="3761822">,</span>&nbsp;<span class="ident" id="3761824">syscall</span><span class="op" id="3761831">.</span><span class="ident" id="3761832">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761851">sa</span>&nbsp;<span class="op" id="3761854">:=</span>&nbsp;<span class="op" id="3761857">&amp;</span><span class="ident" id="3761858">syscall</span><span class="op" id="3761865">.</span><span class="ident" id="3761866">SockaddrUnix</span><span class="op" id="3761878">{</span><span class="ident" id="3761879">Name</span><span class="op" id="3761883">:</span>&nbsp;<span class="ident" id="3761885">addr</span><span class="op" id="3761889">.</span><span class="ident" id="3761890">Name</span><span class="op" id="3761894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761898">return</span>&nbsp;<span class="ident" id="3761905">c</span><span class="op" id="3761906">.</span><span class="ident" id="3761907">fd</span><span class="op" id="3761909">.</span><span class="ident" id="3761910">writeMsg</span><span class="op" id="3761918">(</span><span class="ident" id="3761919">b</span><span class="op" id="3761920">,</span>&nbsp;<span class="ident" id="3761922">oob</span><span class="op" id="3761925">,</span>&nbsp;<span class="ident" id="3761927">sa</span><span class="op" id="3761929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761935">return</span>&nbsp;<span class="ident" id="3761942">c</span><span class="op" id="3761943">.</span><span class="ident" id="3761944">fd</span><span class="op" id="3761946">.</span><span class="ident" id="3761947">writeMsg</span><span class="op" id="3761955">(</span><span class="ident" id="3761956">b</span><span class="op" id="3761957">,</span>&nbsp;<span class="ident" id="3761959">oob</span><span class="op" id="3761962">,</span>&nbsp;<span class="ident" id="3761964">nil</span><span class="op" id="3761967">)</span><br>
<span class="lineno">210</span><span class="op" id="3761969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3761972">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3762044">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3762083">func</span>&nbsp;<span class="op" id="3762088">(</span><span class="ident" id="3762089">c</span>&nbsp;<span class="op" id="3762091">*</span><span class="ident" id="3762092">UnixConn</span><span class="op" id="3762100">)</span>&nbsp;<span class="ident" id="3762102">CloseRead</span><span class="op" id="3762111">(</span><span class="op" id="3762112">)</span>&nbsp;<span class="builtintype" id="3762114">error</span>&nbsp;<span class="op" id="3762120">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762123">if</span>&nbsp;<span class="op" id="3762126">!</span><span class="ident" id="3762127">c</span><span class="op" id="3762128">.</span><span class="ident" id="3762129">ok</span><span class="op" id="3762131">(</span><span class="op" id="3762132">)</span>&nbsp;<span class="op" id="3762134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762138">return</span>&nbsp;<span class="ident" id="3762145">syscall</span><span class="op" id="3762152">.</span><span class="ident" id="3762153">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762164">return</span>&nbsp;<span class="ident" id="3762171">c</span><span class="op" id="3762172">.</span><span class="ident" id="3762173">fd</span><span class="op" id="3762175">.</span><span class="ident" id="3762176">closeRead</span><span class="op" id="3762185">(</span><span class="op" id="3762186">)</span><br>
<span class="lineno"></span><span class="op" id="3762188">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3762191">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3762264">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3762303">func</span>&nbsp;<span class="op" id="3762308">(</span><span class="ident" id="3762309">c</span>&nbsp;<span class="op" id="3762311">*</span><span class="ident" id="3762312">UnixConn</span><span class="op" id="3762320">)</span>&nbsp;<span class="ident" id="3762322">CloseWrite</span><span class="op" id="3762332">(</span><span class="op" id="3762333">)</span>&nbsp;<span class="builtintype" id="3762335">error</span>&nbsp;<span class="op" id="3762341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762344">if</span>&nbsp;<span class="op" id="3762347">!</span><span class="ident" id="3762348">c</span><span class="op" id="3762349">.</span><span class="ident" id="3762350">ok</span><span class="op" id="3762352">(</span><span class="op" id="3762353">)</span>&nbsp;<span class="op" id="3762355">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762359">return</span>&nbsp;<span class="ident" id="3762366">syscall</span><span class="op" id="3762373">.</span><span class="ident" id="3762374">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762385">return</span>&nbsp;<span class="ident" id="3762392">c</span><span class="op" id="3762393">.</span><span class="ident" id="3762394">fd</span><span class="op" id="3762396">.</span><span class="ident" id="3762397">closeWrite</span><span class="op" id="3762407">(</span><span class="op" id="3762408">)</span><br>
<span class="lineno"></span><span class="op" id="3762410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3762413">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3762482">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3762552">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3762612">func</span>&nbsp;<span class="ident" id="3762617">DialUnix</span><span class="op" id="3762625">(</span><span class="ident" id="3762626">net</span>&nbsp;<span class="builtintype" id="3762630">string</span><span class="op" id="3762636">,</span>&nbsp;<span class="ident" id="3762638">laddr</span><span class="op" id="3762643">,</span>&nbsp;<span class="ident" id="3762645">raddr</span>&nbsp;<span class="op" id="3762651">*</span><span class="ident" id="3762652">UnixAddr</span><span class="op" id="3762660">)</span>&nbsp;<span class="op" id="3762662">(</span><span class="op" id="3762663">*</span><span class="ident" id="3762664">UnixConn</span><span class="op" id="3762672">,</span>&nbsp;<span class="builtintype" id="3762674">error</span><span class="op" id="3762679">)</span>&nbsp;<span class="op" id="3762681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762684">switch</span>&nbsp;<span class="ident" id="3762691">net</span>&nbsp;<span class="op" id="3762695">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762698">case</span>&nbsp;<span class="string" id="3762703">&#34;unix&#34;</span><span class="op" id="3762709">,</span>&nbsp;<span class="string" id="3762711">&#34;unixgram&#34;</span><span class="op" id="3762721">,</span>&nbsp;<span class="string" id="3762723">&#34;unixpacket&#34;</span><span class="op" id="3762735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762738">default</span><span class="op" id="3762745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762749">return</span>&nbsp;<span class="ident" id="3762756">nil</span><span class="op" id="3762759">,</span>&nbsp;<span class="op" id="3762761">&amp;</span><span class="ident" id="3762762">OpError</span><span class="op" id="3762769">{</span><span class="ident" id="3762770">Op</span><span class="op" id="3762772">:</span>&nbsp;<span class="string" id="3762774">&#34;dial&#34;</span><span class="op" id="3762780">,</span>&nbsp;<span class="ident" id="3762782">Net</span><span class="op" id="3762785">:</span>&nbsp;<span class="ident" id="3762787">net</span><span class="op" id="3762790">,</span>&nbsp;<span class="ident" id="3762792">Addr</span><span class="op" id="3762796">:</span>&nbsp;<span class="ident" id="3762798">raddr</span><span class="op" id="3762803">,</span>&nbsp;<span class="ident" id="3762805">Err</span><span class="op" id="3762808">:</span>&nbsp;<span class="ident" id="3762810">UnknownNetworkError</span><span class="op" id="3762829">(</span><span class="ident" id="3762830">net</span><span class="op" id="3762833">)</span><span class="op" id="3762834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762840">return</span>&nbsp;<span class="ident" id="3762847">dialUnix</span><span class="op" id="3762855">(</span><span class="ident" id="3762856">net</span><span class="op" id="3762859">,</span>&nbsp;<span class="ident" id="3762861">laddr</span><span class="op" id="3762866">,</span>&nbsp;<span class="ident" id="3762868">raddr</span><span class="op" id="3762873">,</span>&nbsp;<span class="ident" id="3762875">noDeadline</span><span class="op" id="3762885">)</span><br>
<span class="lineno">240</span><span class="op" id="3762887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3762890">func</span>&nbsp;<span class="ident" id="3762895">dialUnix</span><span class="op" id="3762903">(</span><span class="ident" id="3762904">net</span>&nbsp;<span class="builtintype" id="3762908">string</span><span class="op" id="3762914">,</span>&nbsp;<span class="ident" id="3762916">laddr</span><span class="op" id="3762921">,</span>&nbsp;<span class="ident" id="3762923">raddr</span>&nbsp;<span class="op" id="3762929">*</span><span class="ident" id="3762930">UnixAddr</span><span class="op" id="3762938">,</span>&nbsp;<span class="ident" id="3762940">deadline</span>&nbsp;<span class="ident" id="3762949">time</span><span class="op" id="3762953">.</span><span class="ident" id="3762954">Time</span><span class="op" id="3762958">)</span>&nbsp;<span class="op" id="3762960">(</span><span class="op" id="3762961">*</span><span class="ident" id="3762962">UnixConn</span><span class="op" id="3762970">,</span>&nbsp;<span class="builtintype" id="3762972">error</span><span class="op" id="3762977">)</span>&nbsp;<span class="op" id="3762979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762982">fd</span><span class="op" id="3762984">,</span>&nbsp;<span class="ident" id="3762986">err</span>&nbsp;<span class="op" id="3762990">:=</span>&nbsp;<span class="ident" id="3762993">unixSocket</span><span class="op" id="3763003">(</span><span class="ident" id="3763004">net</span><span class="op" id="3763007">,</span>&nbsp;<span class="ident" id="3763009">laddr</span><span class="op" id="3763014">,</span>&nbsp;<span class="ident" id="3763016">raddr</span><span class="op" id="3763021">,</span>&nbsp;<span class="string" id="3763023">&#34;dial&#34;</span><span class="op" id="3763029">,</span>&nbsp;<span class="ident" id="3763031">deadline</span><span class="op" id="3763039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763042">if</span>&nbsp;<span class="ident" id="3763045">err</span>&nbsp;<span class="op" id="3763049">!=</span>&nbsp;<span class="ident" id="3763052">nil</span>&nbsp;<span class="op" id="3763056">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763060">return</span>&nbsp;<span class="ident" id="3763067">nil</span><span class="op" id="3763070">,</span>&nbsp;<span class="op" id="3763072">&amp;</span><span class="ident" id="3763073">OpError</span><span class="op" id="3763080">{</span><span class="ident" id="3763081">Op</span><span class="op" id="3763083">:</span>&nbsp;<span class="string" id="3763085">&#34;dial&#34;</span><span class="op" id="3763091">,</span>&nbsp;<span class="ident" id="3763093">Net</span><span class="op" id="3763096">:</span>&nbsp;<span class="ident" id="3763098">net</span><span class="op" id="3763101">,</span>&nbsp;<span class="ident" id="3763103">Addr</span><span class="op" id="3763107">:</span>&nbsp;<span class="ident" id="3763109">raddr</span><span class="op" id="3763114">,</span>&nbsp;<span class="ident" id="3763116">Err</span><span class="op" id="3763119">:</span>&nbsp;<span class="ident" id="3763121">err</span><span class="op" id="3763124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763130">return</span>&nbsp;<span class="ident" id="3763137">newUnixConn</span><span class="op" id="3763148">(</span><span class="ident" id="3763149">fd</span><span class="op" id="3763151">)</span><span class="op" id="3763152">,</span>&nbsp;<span class="ident" id="3763154">nil</span><br>
<span class="lineno"></span><span class="op" id="3763158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3763161">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3763227">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3763296">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3763315">type</span>&nbsp;<span class="ident" id="3763320">UnixListener</span>&nbsp;<span class="keyword" id="3763333">struct</span>&nbsp;<span class="op" id="3763340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763343">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3763348">*</span><span class="ident" id="3763349">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763356">path</span>&nbsp;<span class="builtintype" id="3763361">string</span><br>
<span class="lineno"></span><span class="op" id="3763368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3763371">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3763441">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3763508">func</span>&nbsp;<span class="ident" id="3763513">ListenUnix</span><span class="op" id="3763523">(</span><span class="ident" id="3763524">net</span>&nbsp;<span class="builtintype" id="3763528">string</span><span class="op" id="3763534">,</span>&nbsp;<span class="ident" id="3763536">laddr</span>&nbsp;<span class="op" id="3763542">*</span><span class="ident" id="3763543">UnixAddr</span><span class="op" id="3763551">)</span>&nbsp;<span class="op" id="3763553">(</span><span class="op" id="3763554">*</span><span class="ident" id="3763555">UnixListener</span><span class="op" id="3763567">,</span>&nbsp;<span class="builtintype" id="3763569">error</span><span class="op" id="3763574">)</span>&nbsp;<span class="op" id="3763576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763579">switch</span>&nbsp;<span class="ident" id="3763586">net</span>&nbsp;<span class="op" id="3763590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763593">case</span>&nbsp;<span class="string" id="3763598">&#34;unix&#34;</span><span class="op" id="3763604">,</span>&nbsp;<span class="string" id="3763606">&#34;unixpacket&#34;</span><span class="op" id="3763618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763621">default</span><span class="op" id="3763628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763632">return</span>&nbsp;<span class="ident" id="3763639">nil</span><span class="op" id="3763642">,</span>&nbsp;<span class="op" id="3763644">&amp;</span><span class="ident" id="3763645">OpError</span><span class="op" id="3763652">{</span><span class="ident" id="3763653">Op</span><span class="op" id="3763655">:</span>&nbsp;<span class="string" id="3763657">&#34;listen&#34;</span><span class="op" id="3763665">,</span>&nbsp;<span class="ident" id="3763667">Net</span><span class="op" id="3763670">:</span>&nbsp;<span class="ident" id="3763672">net</span><span class="op" id="3763675">,</span>&nbsp;<span class="ident" id="3763677">Addr</span><span class="op" id="3763681">:</span>&nbsp;<span class="ident" id="3763683">laddr</span><span class="op" id="3763688">,</span>&nbsp;<span class="ident" id="3763690">Err</span><span class="op" id="3763693">:</span>&nbsp;<span class="ident" id="3763695">UnknownNetworkError</span><span class="op" id="3763714">(</span><span class="ident" id="3763715">net</span><span class="op" id="3763718">)</span><span class="op" id="3763719">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763725">if</span>&nbsp;<span class="ident" id="3763728">laddr</span>&nbsp;<span class="op" id="3763734">==</span>&nbsp;<span class="ident" id="3763737">nil</span>&nbsp;<span class="op" id="3763741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763745">return</span>&nbsp;<span class="ident" id="3763752">nil</span><span class="op" id="3763755">,</span>&nbsp;<span class="op" id="3763757">&amp;</span><span class="ident" id="3763758">OpError</span><span class="op" id="3763765">{</span><span class="ident" id="3763766">Op</span><span class="op" id="3763768">:</span>&nbsp;<span class="string" id="3763770">&#34;listen&#34;</span><span class="op" id="3763778">,</span>&nbsp;<span class="ident" id="3763780">Net</span><span class="op" id="3763783">:</span>&nbsp;<span class="ident" id="3763785">net</span><span class="op" id="3763788">,</span>&nbsp;<span class="ident" id="3763790">Addr</span><span class="op" id="3763794">:</span>&nbsp;<span class="ident" id="3763796">nil</span><span class="op" id="3763799">,</span>&nbsp;<span class="ident" id="3763801">Err</span><span class="op" id="3763804">:</span>&nbsp;<span class="ident" id="3763806">errMissingAddress</span><span class="op" id="3763823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763829">fd</span><span class="op" id="3763831">,</span>&nbsp;<span class="ident" id="3763833">err</span>&nbsp;<span class="op" id="3763837">:=</span>&nbsp;<span class="ident" id="3763840">unixSocket</span><span class="op" id="3763850">(</span><span class="ident" id="3763851">net</span><span class="op" id="3763854">,</span>&nbsp;<span class="ident" id="3763856">laddr</span><span class="op" id="3763861">,</span>&nbsp;<span class="ident" id="3763863">nil</span><span class="op" id="3763866">,</span>&nbsp;<span class="string" id="3763868">&#34;listen&#34;</span><span class="op" id="3763876">,</span>&nbsp;<span class="ident" id="3763878">noDeadline</span><span class="op" id="3763888">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763891">if</span>&nbsp;<span class="ident" id="3763894">err</span>&nbsp;<span class="op" id="3763898">!=</span>&nbsp;<span class="ident" id="3763901">nil</span>&nbsp;<span class="op" id="3763905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763909">return</span>&nbsp;<span class="ident" id="3763916">nil</span><span class="op" id="3763919">,</span>&nbsp;<span class="op" id="3763921">&amp;</span><span class="ident" id="3763922">OpError</span><span class="op" id="3763929">{</span><span class="ident" id="3763930">Op</span><span class="op" id="3763932">:</span>&nbsp;<span class="string" id="3763934">&#34;listen&#34;</span><span class="op" id="3763942">,</span>&nbsp;<span class="ident" id="3763944">Net</span><span class="op" id="3763947">:</span>&nbsp;<span class="ident" id="3763949">net</span><span class="op" id="3763952">,</span>&nbsp;<span class="ident" id="3763954">Addr</span><span class="op" id="3763958">:</span>&nbsp;<span class="ident" id="3763960">laddr</span><span class="op" id="3763965">,</span>&nbsp;<span class="ident" id="3763967">Err</span><span class="op" id="3763970">:</span>&nbsp;<span class="ident" id="3763972">err</span><span class="op" id="3763975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3763978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763981">return</span>&nbsp;<span class="op" id="3763988">&amp;</span><span class="ident" id="3763989">UnixListener</span><span class="op" id="3764001">{</span><span class="ident" id="3764002">fd</span><span class="op" id="3764004">,</span>&nbsp;<span class="ident" id="3764006">fd</span><span class="op" id="3764008">.</span><span class="ident" id="3764009">laddr</span><span class="op" id="3764014">.</span><span class="ident" id="3764015">String</span><span class="op" id="3764021">(</span><span class="op" id="3764022">)</span><span class="op" id="3764023">}</span><span class="op" id="3764024">,</span>&nbsp;<span class="ident" id="3764026">nil</span><br>
<span class="lineno"></span><span class="op" id="3764030">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3764033">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3764098">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3764113">func</span>&nbsp;<span class="op" id="3764118">(</span><span class="ident" id="3764119">l</span>&nbsp;<span class="op" id="3764121">*</span><span class="ident" id="3764122">UnixListener</span><span class="op" id="3764134">)</span>&nbsp;<span class="ident" id="3764136">AcceptUnix</span><span class="op" id="3764146">(</span><span class="op" id="3764147">)</span>&nbsp;<span class="op" id="3764149">(</span><span class="op" id="3764150">*</span><span class="ident" id="3764151">UnixConn</span><span class="op" id="3764159">,</span>&nbsp;<span class="builtintype" id="3764161">error</span><span class="op" id="3764166">)</span>&nbsp;<span class="op" id="3764168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764171">if</span>&nbsp;<span class="ident" id="3764174">l</span>&nbsp;<span class="op" id="3764176">==</span>&nbsp;<span class="ident" id="3764179">nil</span>&nbsp;<span class="op" id="3764183">||</span>&nbsp;<span class="ident" id="3764186">l</span><span class="op" id="3764187">.</span><span class="ident" id="3764188">fd</span>&nbsp;<span class="op" id="3764191">==</span>&nbsp;<span class="ident" id="3764194">nil</span>&nbsp;<span class="op" id="3764198">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764202">return</span>&nbsp;<span class="ident" id="3764209">nil</span><span class="op" id="3764212">,</span>&nbsp;<span class="ident" id="3764214">syscall</span><span class="op" id="3764221">.</span><span class="ident" id="3764222">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764233">fd</span><span class="op" id="3764235">,</span>&nbsp;<span class="ident" id="3764237">err</span>&nbsp;<span class="op" id="3764241">:=</span>&nbsp;<span class="ident" id="3764244">l</span><span class="op" id="3764245">.</span><span class="ident" id="3764246">fd</span><span class="op" id="3764248">.</span><span class="ident" id="3764249">accept</span><span class="op" id="3764255">(</span><span class="op" id="3764256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764259">if</span>&nbsp;<span class="ident" id="3764262">err</span>&nbsp;<span class="op" id="3764266">!=</span>&nbsp;<span class="ident" id="3764269">nil</span>&nbsp;<span class="op" id="3764273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764277">return</span>&nbsp;<span class="ident" id="3764284">nil</span><span class="op" id="3764287">,</span>&nbsp;<span class="ident" id="3764289">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764297">c</span>&nbsp;<span class="op" id="3764299">:=</span>&nbsp;<span class="ident" id="3764302">newUnixConn</span><span class="op" id="3764313">(</span><span class="ident" id="3764314">fd</span><span class="op" id="3764316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764319">return</span>&nbsp;<span class="ident" id="3764326">c</span><span class="op" id="3764327">,</span>&nbsp;<span class="ident" id="3764329">nil</span><br>
<span class="lineno"></span><span class="op" id="3764333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3764336">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3764405">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3764460">func</span>&nbsp;<span class="op" id="3764465">(</span><span class="ident" id="3764466">l</span>&nbsp;<span class="op" id="3764468">*</span><span class="ident" id="3764469">UnixListener</span><span class="op" id="3764481">)</span>&nbsp;<span class="ident" id="3764483">Accept</span><span class="op" id="3764489">(</span><span class="op" id="3764490">)</span>&nbsp;<span class="op" id="3764492">(</span><span class="ident" id="3764493">c</span>&nbsp;<span class="ident" id="3764495">Conn</span><span class="op" id="3764499">,</span>&nbsp;<span class="ident" id="3764501">err</span>&nbsp;<span class="builtintype" id="3764505">error</span><span class="op" id="3764510">)</span>&nbsp;<span class="op" id="3764512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764515">c1</span><span class="op" id="3764517">,</span>&nbsp;<span class="ident" id="3764519">err</span>&nbsp;<span class="op" id="3764523">:=</span>&nbsp;<span class="ident" id="3764526">l</span><span class="op" id="3764527">.</span><span class="ident" id="3764528">AcceptUnix</span><span class="op" id="3764538">(</span><span class="op" id="3764539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764542">if</span>&nbsp;<span class="ident" id="3764545">err</span>&nbsp;<span class="op" id="3764549">!=</span>&nbsp;<span class="ident" id="3764552">nil</span>&nbsp;<span class="op" id="3764556">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764560">return</span>&nbsp;<span class="ident" id="3764567">nil</span><span class="op" id="3764570">,</span>&nbsp;<span class="ident" id="3764572">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764580">return</span>&nbsp;<span class="ident" id="3764587">c1</span><span class="op" id="3764589">,</span>&nbsp;<span class="ident" id="3764591">nil</span><br>
<span class="lineno"></span><span class="op" id="3764595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3764598">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3764662">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3764693">func</span>&nbsp;<span class="op" id="3764698">(</span><span class="ident" id="3764699">l</span>&nbsp;<span class="op" id="3764701">*</span><span class="ident" id="3764702">UnixListener</span><span class="op" id="3764714">)</span>&nbsp;<span class="ident" id="3764716">Close</span><span class="op" id="3764721">(</span><span class="op" id="3764722">)</span>&nbsp;<span class="builtintype" id="3764724">error</span>&nbsp;<span class="op" id="3764730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764733">if</span>&nbsp;<span class="ident" id="3764736">l</span>&nbsp;<span class="op" id="3764738">==</span>&nbsp;<span class="ident" id="3764741">nil</span>&nbsp;<span class="op" id="3764745">||</span>&nbsp;<span class="ident" id="3764748">l</span><span class="op" id="3764749">.</span><span class="ident" id="3764750">fd</span>&nbsp;<span class="op" id="3764753">==</span>&nbsp;<span class="ident" id="3764756">nil</span>&nbsp;<span class="op" id="3764760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764764">return</span>&nbsp;<span class="ident" id="3764771">syscall</span><span class="op" id="3764778">.</span><span class="ident" id="3764779">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764791">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764833">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764874">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764912">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764955">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765000">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765043">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765085">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765133">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765179">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765213">if</span>&nbsp;<span class="ident" id="3765216">l</span><span class="op" id="3765217">.</span><span class="ident" id="3765218">path</span><span class="op" id="3765222">[</span><span class="num" id="3765223">0</span><span class="op" id="3765224">]</span>&nbsp;<span class="op" id="3765226">!=</span>&nbsp;<span class="string" id="3765229">&#39;@&#39;</span>&nbsp;<span class="op" id="3765233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765237">syscall</span><span class="op" id="3765244">.</span><span class="ident" id="3765245">Unlink</span><span class="op" id="3765251">(</span><span class="ident" id="3765252">l</span><span class="op" id="3765253">.</span><span class="ident" id="3765254">path</span><span class="op" id="3765258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765261">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765264">return</span>&nbsp;<span class="ident" id="3765271">l</span><span class="op" id="3765272">.</span><span class="ident" id="3765273">fd</span><span class="op" id="3765275">.</span><span class="ident" id="3765276">Close</span><span class="op" id="3765281">(</span><span class="op" id="3765282">)</span><br>
<span class="lineno"></span><span class="op" id="3765284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3765287">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3765335">func</span>&nbsp;<span class="op" id="3765340">(</span><span class="ident" id="3765341">l</span>&nbsp;<span class="op" id="3765343">*</span><span class="ident" id="3765344">UnixListener</span><span class="op" id="3765356">)</span>&nbsp;<span class="ident" id="3765358">Addr</span><span class="op" id="3765362">(</span><span class="op" id="3765363">)</span>&nbsp;<span class="ident" id="3765365">Addr</span>&nbsp;<span class="op" id="3765370">{</span>&nbsp;<span class="keyword" id="3765372">return</span>&nbsp;<span class="ident" id="3765379">l</span><span class="op" id="3765380">.</span><span class="ident" id="3765381">fd</span><span class="op" id="3765383">.</span><span class="ident" id="3765384">laddr</span>&nbsp;<span class="op" id="3765390">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3765393">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3765456">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3765500">func</span>&nbsp;<span class="op" id="3765505">(</span><span class="ident" id="3765506">l</span>&nbsp;<span class="op" id="3765508">*</span><span class="ident" id="3765509">UnixListener</span><span class="op" id="3765521">)</span>&nbsp;<span class="ident" id="3765523">SetDeadline</span><span class="op" id="3765534">(</span><span class="ident" id="3765535">t</span>&nbsp;<span class="ident" id="3765537">time</span><span class="op" id="3765541">.</span><span class="ident" id="3765542">Time</span><span class="op" id="3765546">)</span>&nbsp;<span class="op" id="3765548">(</span><span class="ident" id="3765549">err</span>&nbsp;<span class="builtintype" id="3765553">error</span><span class="op" id="3765558">)</span>&nbsp;<span class="op" id="3765560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765563">if</span>&nbsp;<span class="ident" id="3765566">l</span>&nbsp;<span class="op" id="3765568">==</span>&nbsp;<span class="ident" id="3765571">nil</span>&nbsp;<span class="op" id="3765575">||</span>&nbsp;<span class="ident" id="3765578">l</span><span class="op" id="3765579">.</span><span class="ident" id="3765580">fd</span>&nbsp;<span class="op" id="3765583">==</span>&nbsp;<span class="ident" id="3765586">nil</span>&nbsp;<span class="op" id="3765590">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765594">return</span>&nbsp;<span class="ident" id="3765601">syscall</span><span class="op" id="3765608">.</span><span class="ident" id="3765609">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765620">return</span>&nbsp;<span class="ident" id="3765627">l</span><span class="op" id="3765628">.</span><span class="ident" id="3765629">fd</span><span class="op" id="3765631">.</span><span class="ident" id="3765632">setDeadline</span><span class="op" id="3765643">(</span><span class="ident" id="3765644">t</span><span class="op" id="3765645">)</span><br>
<span class="lineno"></span><span class="op" id="3765647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3765650">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3765716">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3765786">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3765851">//</span><br>
<span class="lineno"></span><span class="comment" id="3765854">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3765918">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3765984">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3766048">func</span>&nbsp;<span class="op" id="3766053">(</span><span class="ident" id="3766054">l</span>&nbsp;<span class="op" id="3766056">*</span><span class="ident" id="3766057">UnixListener</span><span class="op" id="3766069">)</span>&nbsp;<span class="ident" id="3766071">File</span><span class="op" id="3766075">(</span><span class="op" id="3766076">)</span>&nbsp;<span class="op" id="3766078">(</span><span class="ident" id="3766079">f</span>&nbsp;<span class="op" id="3766081">*</span><span class="ident" id="3766082">os</span><span class="op" id="3766084">.</span><span class="ident" id="3766085">File</span><span class="op" id="3766089">,</span>&nbsp;<span class="ident" id="3766091">err</span>&nbsp;<span class="builtintype" id="3766095">error</span><span class="op" id="3766100">)</span>&nbsp;<span class="op" id="3766102">{</span>&nbsp;<span class="keyword" id="3766104">return</span>&nbsp;<span class="ident" id="3766111">l</span><span class="op" id="3766112">.</span><span class="ident" id="3766113">fd</span><span class="op" id="3766115">.</span><span class="ident" id="3766116">dup</span><span class="op" id="3766119">(</span><span class="op" id="3766120">)</span>&nbsp;<span class="op" id="3766122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766125">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3766196">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3766264">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3766334">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3766393">func</span>&nbsp;<span class="ident" id="3766398">ListenUnixgram</span><span class="op" id="3766412">(</span><span class="ident" id="3766413">net</span>&nbsp;<span class="builtintype" id="3766417">string</span><span class="op" id="3766423">,</span>&nbsp;<span class="ident" id="3766425">laddr</span>&nbsp;<span class="op" id="3766431">*</span><span class="ident" id="3766432">UnixAddr</span><span class="op" id="3766440">)</span>&nbsp;<span class="op" id="3766442">(</span><span class="op" id="3766443">*</span><span class="ident" id="3766444">UnixConn</span><span class="op" id="3766452">,</span>&nbsp;<span class="builtintype" id="3766454">error</span><span class="op" id="3766459">)</span>&nbsp;<span class="op" id="3766461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766464">switch</span>&nbsp;<span class="ident" id="3766471">net</span>&nbsp;<span class="op" id="3766475">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766478">case</span>&nbsp;<span class="string" id="3766483">&#34;unixgram&#34;</span><span class="op" id="3766493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766496">default</span><span class="op" id="3766503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766507">return</span>&nbsp;<span class="ident" id="3766514">nil</span><span class="op" id="3766517">,</span>&nbsp;<span class="op" id="3766519">&amp;</span><span class="ident" id="3766520">OpError</span><span class="op" id="3766527">{</span><span class="ident" id="3766528">Op</span><span class="op" id="3766530">:</span>&nbsp;<span class="string" id="3766532">&#34;listen&#34;</span><span class="op" id="3766540">,</span>&nbsp;<span class="ident" id="3766542">Net</span><span class="op" id="3766545">:</span>&nbsp;<span class="ident" id="3766547">net</span><span class="op" id="3766550">,</span>&nbsp;<span class="ident" id="3766552">Addr</span><span class="op" id="3766556">:</span>&nbsp;<span class="ident" id="3766558">laddr</span><span class="op" id="3766563">,</span>&nbsp;<span class="ident" id="3766565">Err</span><span class="op" id="3766568">:</span>&nbsp;<span class="ident" id="3766570">UnknownNetworkError</span><span class="op" id="3766589">(</span><span class="ident" id="3766590">net</span><span class="op" id="3766593">)</span><span class="op" id="3766594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766600">if</span>&nbsp;<span class="ident" id="3766603">laddr</span>&nbsp;<span class="op" id="3766609">==</span>&nbsp;<span class="ident" id="3766612">nil</span>&nbsp;<span class="op" id="3766616">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766620">return</span>&nbsp;<span class="ident" id="3766627">nil</span><span class="op" id="3766630">,</span>&nbsp;<span class="op" id="3766632">&amp;</span><span class="ident" id="3766633">OpError</span><span class="op" id="3766640">{</span><span class="ident" id="3766641">Op</span><span class="op" id="3766643">:</span>&nbsp;<span class="string" id="3766645">&#34;listen&#34;</span><span class="op" id="3766653">,</span>&nbsp;<span class="ident" id="3766655">Net</span><span class="op" id="3766658">:</span>&nbsp;<span class="ident" id="3766660">net</span><span class="op" id="3766663">,</span>&nbsp;<span class="ident" id="3766665">Addr</span><span class="op" id="3766669">:</span>&nbsp;<span class="ident" id="3766671">nil</span><span class="op" id="3766674">,</span>&nbsp;<span class="ident" id="3766676">Err</span><span class="op" id="3766679">:</span>&nbsp;<span class="ident" id="3766681">errMissingAddress</span><span class="op" id="3766698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766704">fd</span><span class="op" id="3766706">,</span>&nbsp;<span class="ident" id="3766708">err</span>&nbsp;<span class="op" id="3766712">:=</span>&nbsp;<span class="ident" id="3766715">unixSocket</span><span class="op" id="3766725">(</span><span class="ident" id="3766726">net</span><span class="op" id="3766729">,</span>&nbsp;<span class="ident" id="3766731">laddr</span><span class="op" id="3766736">,</span>&nbsp;<span class="ident" id="3766738">nil</span><span class="op" id="3766741">,</span>&nbsp;<span class="string" id="3766743">&#34;listen&#34;</span><span class="op" id="3766751">,</span>&nbsp;<span class="ident" id="3766753">noDeadline</span><span class="op" id="3766763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766766">if</span>&nbsp;<span class="ident" id="3766769">err</span>&nbsp;<span class="op" id="3766773">!=</span>&nbsp;<span class="ident" id="3766776">nil</span>&nbsp;<span class="op" id="3766780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766784">return</span>&nbsp;<span class="ident" id="3766791">nil</span><span class="op" id="3766794">,</span>&nbsp;<span class="op" id="3766796">&amp;</span><span class="ident" id="3766797">OpError</span><span class="op" id="3766804">{</span><span class="ident" id="3766805">Op</span><span class="op" id="3766807">:</span>&nbsp;<span class="string" id="3766809">&#34;listen&#34;</span><span class="op" id="3766817">,</span>&nbsp;<span class="ident" id="3766819">Net</span><span class="op" id="3766822">:</span>&nbsp;<span class="ident" id="3766824">net</span><span class="op" id="3766827">,</span>&nbsp;<span class="ident" id="3766829">Addr</span><span class="op" id="3766833">:</span>&nbsp;<span class="ident" id="3766835">laddr</span><span class="op" id="3766840">,</span>&nbsp;<span class="ident" id="3766842">Err</span><span class="op" id="3766845">:</span>&nbsp;<span class="ident" id="3766847">err</span><span class="op" id="3766850">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766856">return</span>&nbsp;<span class="ident" id="3766863">newUnixConn</span><span class="op" id="3766874">(</span><span class="ident" id="3766875">fd</span><span class="op" id="3766877">)</span><span class="op" id="3766878">,</span>&nbsp;<span class="ident" id="3766880">nil</span><br>
<span class="lineno"></span><span class="op" id="3766884">}</span>
</div>
</body>
</html>
