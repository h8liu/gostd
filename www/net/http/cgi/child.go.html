<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5487098">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5487153">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5487207">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5487258">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;CGI&nbsp;from&nbsp;the&nbsp;perspective&nbsp;of&nbsp;a&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5487318">//&nbsp;process.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5487331">package</span>&nbsp;<span class="ident" id="5487339">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5487344">import</span>&nbsp;<span class="op" id="5487351">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487354">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487363">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487377">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487387">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487394">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487400">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487413">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487420">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487432">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487443">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487449">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5487460">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5487470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5487473">//&nbsp;Request&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;as&nbsp;represented&nbsp;in&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5487539">//&nbsp;environment.&nbsp;This&nbsp;assumes&nbsp;the&nbsp;current&nbsp;program&nbsp;is&nbsp;being&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5487601">//&nbsp;by&nbsp;a&nbsp;web&nbsp;server&nbsp;in&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="comment" id="5487642">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;populated,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="5487702">func</span>&nbsp;<span class="ident" id="5487707">Request</span><span class="op" id="5487714">(</span><span class="op" id="5487715">)</span>&nbsp;<span class="op" id="5487717">(</span><span class="op" id="5487718">*</span><span class="ident" id="5487719"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5487723">.</span><span class="ident" id="5487724">Request</span><span class="op" id="5487731">,</span>&nbsp;<span class="builtintype" id="5487733">error</span><span class="op" id="5487738">)</span>&nbsp;<span class="op" id="5487740">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487743">r</span><span class="op" id="5487744">,</span>&nbsp;<span class="ident" id="5487746">err</span>&nbsp;<span class="op" id="5487750">:=</span>&nbsp;<span class="ident" id="5487753"><a href="/net/http/cgi/child.go.html#5488266">RequestFromMap</a></span><span class="op" id="5487767">(</span><span class="ident" id="5487768"><a href="/net/http/cgi/child.go.html#5487951">envMap</a></span><span class="op" id="5487774">(</span><span class="ident" id="5487775"><a href="/net/http/cgi/child.go.html#5487443">os</a></span><span class="op" id="5487777">.</span><span class="ident" id="5487778">Environ</span><span class="op" id="5487785">(</span><span class="op" id="5487786">)</span><span class="op" id="5487787">)</span><span class="op" id="5487788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487791">if</span>&nbsp;<span class="ident" id="5487794"><a href="/net/http/cgi/child.go.html#5487746">err</a></span>&nbsp;<span class="op" id="5487798">!=</span>&nbsp;<span class="ident" id="5487801">nil</span>&nbsp;<span class="op" id="5487805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487809">return</span>&nbsp;<span class="ident" id="5487816">nil</span><span class="op" id="5487819">,</span>&nbsp;<span class="ident" id="5487821"><a href="/net/http/cgi/child.go.html#5487746">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487829">if</span>&nbsp;<span class="ident" id="5487832"><a href="/net/http/cgi/child.go.html#5487743">r</a></span><span class="op" id="5487833">.</span><span class="ident" id="5487834">ContentLength</span>&nbsp;<span class="op" id="5487848">&gt;</span>&nbsp;<span class="num" id="5487850">0</span>&nbsp;<span class="op" id="5487852">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487856"><a href="/net/http/cgi/child.go.html#5487743">r</a></span><span class="op" id="5487857">.</span><span class="ident" id="5487858">Body</span>&nbsp;<span class="op" id="5487863">=</span>&nbsp;<span class="ident" id="5487865"><a href="/net/http/cgi/child.go.html#5487400">ioutil</a></span><span class="op" id="5487871">.</span><span class="ident" id="5487872">NopCloser</span><span class="op" id="5487881">(</span><span class="ident" id="5487882"><a href="/net/http/cgi/child.go.html#5487394">io</a></span><span class="op" id="5487884">.</span><span class="ident" id="5487885">LimitReader</span><span class="op" id="5487896">(</span><span class="ident" id="5487897"><a href="/net/http/cgi/child.go.html#5487443">os</a></span><span class="op" id="5487899">.</span><span class="ident" id="5487900">Stdin</span><span class="op" id="5487905">,</span>&nbsp;<span class="ident" id="5487907"><a href="/net/http/cgi/child.go.html#5487743">r</a></span><span class="op" id="5487908">.</span><span class="ident" id="5487909">ContentLength</span><span class="op" id="5487922">)</span><span class="op" id="5487923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487929">return</span>&nbsp;<span class="ident" id="5487936"><a href="/net/http/cgi/child.go.html#5487743">r</a></span><span class="op" id="5487937">,</span>&nbsp;<span class="ident" id="5487939">nil</span><br>
<span class="lineno"></span><span class="op" id="5487943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5487946">func</span>&nbsp;<span class="ident" id="5487951">envMap</span><span class="op" id="5487957">(</span><span class="ident" id="5487958">env</span>&nbsp;<span class="op" id="5487962">[</span><span class="op" id="5487963">]</span><span class="builtintype" id="5487964">string</span><span class="op" id="5487970">)</span>&nbsp;<span class="keyword" id="5487972">map</span><span class="op" id="5487975">[</span><span class="builtintype" id="5487976">string</span><span class="op" id="5487982">]</span><span class="builtintype" id="5487983">string</span>&nbsp;<span class="op" id="5487990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487993">m</span>&nbsp;<span class="op" id="5487995">:=</span>&nbsp;<span class="builtinfunc" id="5487998">make</span><span class="op" id="5488002">(</span><span class="keyword" id="5488003">map</span><span class="op" id="5488006">[</span><span class="builtintype" id="5488007">string</span><span class="op" id="5488013">]</span><span class="builtintype" id="5488014">string</span><span class="op" id="5488020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488023">for</span>&nbsp;<span class="ident" id="5488027">_</span><span class="op" id="5488028">,</span>&nbsp;<span class="ident" id="5488030">kv</span>&nbsp;<span class="op" id="5488033">:=</span>&nbsp;<span class="keyword" id="5488036">range</span>&nbsp;<span class="ident" id="5488042"><a href="/net/http/cgi/child.go.html#5487958">env</a></span>&nbsp;<span class="op" id="5488046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488050">if</span>&nbsp;<span class="ident" id="5488053">idx</span>&nbsp;<span class="op" id="5488057">:=</span>&nbsp;<span class="ident" id="5488060"><a href="/net/http/cgi/child.go.html#5487460">strings</a></span><span class="op" id="5488067">.</span><span class="ident" id="5488068">Index</span><span class="op" id="5488073">(</span><span class="ident" id="5488074"><a href="/net/http/cgi/child.go.html#5488030">kv</a></span><span class="op" id="5488076">,</span>&nbsp;<span class="string" id="5488078">&#34;=&#34;</span><span class="op" id="5488081">)</span><span class="op" id="5488082">;</span>&nbsp;<span class="ident" id="5488084"><a href="/net/http/cgi/child.go.html#5488053">idx</a></span>&nbsp;<span class="op" id="5488088">!=</span>&nbsp;<span class="op" id="5488091">-</span><span class="num" id="5488092">1</span>&nbsp;<span class="op" id="5488094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488099"><a href="/net/http/cgi/child.go.html#5487993">m</a></span><span class="op" id="5488100">[</span><span class="ident" id="5488101"><a href="/net/http/cgi/child.go.html#5488030">kv</a></span><span class="op" id="5488103">[</span><span class="op" id="5488104">:</span><span class="ident" id="5488105"><a href="/net/http/cgi/child.go.html#5488053">idx</a></span><span class="op" id="5488108">]</span><span class="op" id="5488109">]</span>&nbsp;<span class="op" id="5488111">=</span>&nbsp;<span class="ident" id="5488113"><a href="/net/http/cgi/child.go.html#5488030">kv</a></span><span class="op" id="5488115">[</span><span class="ident" id="5488116"><a href="/net/http/cgi/child.go.html#5488053">idx</a></span><span class="op" id="5488119">+</span><span class="num" id="5488120">1</span><span class="op" id="5488121">:</span><span class="op" id="5488122">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488132">return</span>&nbsp;<span class="ident" id="5488139"><a href="/net/http/cgi/child.go.html#5487993">m</a></span><br>
<span class="lineno"></span><span class="op" id="5488141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5488144">//&nbsp;RequestFromMap&nbsp;creates&nbsp;an&nbsp;http.Request&nbsp;from&nbsp;CGI&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="5488206">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;field&nbsp;is&nbsp;not&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5488261">func</span>&nbsp;<span class="ident" id="5488266">RequestFromMap</span><span class="op" id="5488280">(</span><span class="ident" id="5488281">params</span>&nbsp;<span class="keyword" id="5488288">map</span><span class="op" id="5488291">[</span><span class="builtintype" id="5488292">string</span><span class="op" id="5488298">]</span><span class="builtintype" id="5488299">string</span><span class="op" id="5488305">)</span>&nbsp;<span class="op" id="5488307">(</span><span class="op" id="5488308">*</span><span class="ident" id="5488309"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5488313">.</span><span class="ident" id="5488314">Request</span><span class="op" id="5488321">,</span>&nbsp;<span class="builtintype" id="5488323">error</span><span class="op" id="5488328">)</span>&nbsp;<span class="op" id="5488330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488333">r</span>&nbsp;<span class="op" id="5488335">:=</span>&nbsp;<span class="builtinfunc" id="5488338">new</span><span class="op" id="5488341">(</span><span class="ident" id="5488342"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5488346">.</span><span class="ident" id="5488347">Request</span><span class="op" id="5488354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488357"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488358">.</span><span class="ident" id="5488359">Method</span>&nbsp;<span class="op" id="5488366">=</span>&nbsp;<span class="ident" id="5488368"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5488374">[</span><span class="string" id="5488375">&#34;REQUEST_METHOD&#34;</span><span class="op" id="5488391">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488394">if</span>&nbsp;<span class="ident" id="5488397"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488398">.</span><span class="ident" id="5488399">Method</span>&nbsp;<span class="op" id="5488406">==</span>&nbsp;<span class="string" id="5488409">&#34;&#34;</span>&nbsp;<span class="op" id="5488412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488416">return</span>&nbsp;<span class="ident" id="5488423">nil</span><span class="op" id="5488426">,</span>&nbsp;<span class="ident" id="5488428"><a href="/net/http/cgi/child.go.html#5487377">errors</a></span><span class="op" id="5488434">.</span><span class="ident" id="5488435">New</span><span class="op" id="5488438">(</span><span class="string" id="5488439">&#34;cgi:&nbsp;no&nbsp;REQUEST_METHOD&nbsp;in&nbsp;environment&#34;</span><span class="op" id="5488478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488485"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488486">.</span><span class="ident" id="5488487">Proto</span>&nbsp;<span class="op" id="5488493">=</span>&nbsp;<span class="ident" id="5488495"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5488501">[</span><span class="string" id="5488502">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="5488519">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488522">var</span>&nbsp;<span class="ident" id="5488526">ok</span>&nbsp;<span class="builtintype" id="5488529">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488535"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488536">.</span><span class="ident" id="5488537">ProtoMajor</span><span class="op" id="5488547">,</span>&nbsp;<span class="ident" id="5488549"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488550">.</span><span class="ident" id="5488551">ProtoMinor</span><span class="op" id="5488561">,</span>&nbsp;<span class="ident" id="5488563"><a href="/net/http/cgi/child.go.html#5488526">ok</a></span>&nbsp;<span class="op" id="5488566">=</span>&nbsp;<span class="ident" id="5488568"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5488572">.</span><span class="ident" id="5488573">ParseHTTPVersion</span><span class="op" id="5488589">(</span><span class="ident" id="5488590"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488591">.</span><span class="ident" id="5488592">Proto</span><span class="op" id="5488597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488600">if</span>&nbsp;<span class="op" id="5488603">!</span><span class="ident" id="5488604"><a href="/net/http/cgi/child.go.html#5488526">ok</a></span>&nbsp;<span class="op" id="5488607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488611">return</span>&nbsp;<span class="ident" id="5488618">nil</span><span class="op" id="5488621">,</span>&nbsp;<span class="ident" id="5488623"><a href="/net/http/cgi/child.go.html#5487377">errors</a></span><span class="op" id="5488629">.</span><span class="ident" id="5488630">New</span><span class="op" id="5488633">(</span><span class="string" id="5488634">&#34;cgi:&nbsp;invalid&nbsp;SERVER_PROTOCOL&nbsp;version&#34;</span><span class="op" id="5488672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488675">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488679"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488680">.</span><span class="ident" id="5488681">Close</span>&nbsp;<span class="op" id="5488687">=</span>&nbsp;<span class="ident" id="5488689">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488695"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488696">.</span><span class="ident" id="5488697">Trailer</span>&nbsp;<span class="op" id="5488705">=</span>&nbsp;<span class="ident" id="5488707"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5488711">.</span><span class="ident" id="5488712">Header</span><span class="op" id="5488718">{</span><span class="op" id="5488719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488722"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488723">.</span><span class="ident" id="5488724">Header</span>&nbsp;<span class="op" id="5488731">=</span>&nbsp;<span class="ident" id="5488733"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5488737">.</span><span class="ident" id="5488738">Header</span><span class="op" id="5488744">{</span><span class="op" id="5488745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488749"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488750">.</span><span class="ident" id="5488751">Host</span>&nbsp;<span class="op" id="5488756">=</span>&nbsp;<span class="ident" id="5488758"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5488764">[</span><span class="string" id="5488765">&#34;HTTP_HOST&#34;</span><span class="op" id="5488776">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488780">if</span>&nbsp;<span class="ident" id="5488783">lenstr</span>&nbsp;<span class="op" id="5488790">:=</span>&nbsp;<span class="ident" id="5488793"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5488799">[</span><span class="string" id="5488800">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="5488816">]</span><span class="op" id="5488817">;</span>&nbsp;<span class="ident" id="5488819"><a href="/net/http/cgi/child.go.html#5488783">lenstr</a></span>&nbsp;<span class="op" id="5488826">!=</span>&nbsp;<span class="string" id="5488829">&#34;&#34;</span>&nbsp;<span class="op" id="5488832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488836">clen</span><span class="op" id="5488840">,</span>&nbsp;<span class="ident" id="5488842">err</span>&nbsp;<span class="op" id="5488846">:=</span>&nbsp;<span class="ident" id="5488849"><a href="/net/http/cgi/child.go.html#5487449">strconv</a></span><span class="op" id="5488856">.</span><span class="ident" id="5488857">ParseInt</span><span class="op" id="5488865">(</span><span class="ident" id="5488866"><a href="/net/http/cgi/child.go.html#5488783">lenstr</a></span><span class="op" id="5488872">,</span>&nbsp;<span class="num" id="5488874">10</span><span class="op" id="5488876">,</span>&nbsp;<span class="num" id="5488878">64</span><span class="op" id="5488880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488884">if</span>&nbsp;<span class="ident" id="5488887"><a href="/net/http/cgi/child.go.html#5488842">err</a></span>&nbsp;<span class="op" id="5488891">!=</span>&nbsp;<span class="ident" id="5488894">nil</span>&nbsp;<span class="op" id="5488898">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488903">return</span>&nbsp;<span class="ident" id="5488910">nil</span><span class="op" id="5488913">,</span>&nbsp;<span class="ident" id="5488915"><a href="/net/http/cgi/child.go.html#5487377">errors</a></span><span class="op" id="5488921">.</span><span class="ident" id="5488922">New</span><span class="op" id="5488925">(</span><span class="string" id="5488926">&#34;cgi:&nbsp;bad&nbsp;CONTENT_LENGTH&nbsp;in&nbsp;environment:&nbsp;&#34;</span>&nbsp;<span class="op" id="5488969">+</span>&nbsp;<span class="ident" id="5488971"><a href="/net/http/cgi/child.go.html#5488783">lenstr</a></span><span class="op" id="5488977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488985"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5488986">.</span><span class="ident" id="5488987">ContentLength</span>&nbsp;<span class="op" id="5489001">=</span>&nbsp;<span class="ident" id="5489003"><a href="/net/http/cgi/child.go.html#5488836">clen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489013">if</span>&nbsp;<span class="ident" id="5489016">ct</span>&nbsp;<span class="op" id="5489019">:=</span>&nbsp;<span class="ident" id="5489022"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489028">[</span><span class="string" id="5489029">&#34;CONTENT_TYPE&#34;</span><span class="op" id="5489043">]</span><span class="op" id="5489044">;</span>&nbsp;<span class="ident" id="5489046"><a href="/net/http/cgi/child.go.html#5489016">ct</a></span>&nbsp;<span class="op" id="5489049">!=</span>&nbsp;<span class="string" id="5489052">&#34;&#34;</span>&nbsp;<span class="op" id="5489055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489059"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489060">.</span><span class="ident" id="5489061">Header</span><span class="op" id="5489067">.</span><span class="ident" id="5489068">Set</span><span class="op" id="5489071">(</span><span class="string" id="5489072">&#34;Content-Type&#34;</span><span class="op" id="5489086">,</span>&nbsp;<span class="ident" id="5489088"><a href="/net/http/cgi/child.go.html#5489016">ct</a></span><span class="op" id="5489090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489097">//&nbsp;Copy&nbsp;&#34;HTTP_FOO_BAR&#34;&nbsp;variables&nbsp;to&nbsp;&#34;Foo-Bar&#34;&nbsp;Headers</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489152">for</span>&nbsp;<span class="ident" id="5489156">k</span><span class="op" id="5489157">,</span>&nbsp;<span class="ident" id="5489159">v</span>&nbsp;<span class="op" id="5489161">:=</span>&nbsp;<span class="keyword" id="5489164">range</span>&nbsp;<span class="ident" id="5489170"><a href="/net/http/cgi/child.go.html#5488281">params</a></span>&nbsp;<span class="op" id="5489177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489181">if</span>&nbsp;<span class="op" id="5489184">!</span><span class="ident" id="5489185"><a href="/net/http/cgi/child.go.html#5487460">strings</a></span><span class="op" id="5489192">.</span><span class="ident" id="5489193">HasPrefix</span><span class="op" id="5489202">(</span><span class="ident" id="5489203"><a href="/net/http/cgi/child.go.html#5489156">k</a></span><span class="op" id="5489204">,</span>&nbsp;<span class="string" id="5489206">&#34;HTTP_&#34;</span><span class="op" id="5489213">)</span>&nbsp;<span class="op" id="5489215">||</span>&nbsp;<span class="ident" id="5489218"><a href="/net/http/cgi/child.go.html#5489156">k</a></span>&nbsp;<span class="op" id="5489220">==</span>&nbsp;<span class="string" id="5489223">&#34;HTTP_HOST&#34;</span>&nbsp;<span class="op" id="5489235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489240">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489255"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489256">.</span><span class="ident" id="5489257">Header</span><span class="op" id="5489263">.</span><span class="ident" id="5489264">Add</span><span class="op" id="5489267">(</span><span class="ident" id="5489268"><a href="/net/http/cgi/child.go.html#5487460">strings</a></span><span class="op" id="5489275">.</span><span class="ident" id="5489276">Replace</span><span class="op" id="5489283">(</span><span class="ident" id="5489284"><a href="/net/http/cgi/child.go.html#5489156">k</a></span><span class="op" id="5489285">[</span><span class="num" id="5489286">5</span><span class="op" id="5489287">:</span><span class="op" id="5489288">]</span><span class="op" id="5489289">,</span>&nbsp;<span class="string" id="5489291">&#34;_&#34;</span><span class="op" id="5489294">,</span>&nbsp;<span class="string" id="5489296">&#34;-&#34;</span><span class="op" id="5489299">,</span>&nbsp;<span class="op" id="5489301">-</span><span class="num" id="5489302">1</span><span class="op" id="5489303">)</span><span class="op" id="5489304">,</span>&nbsp;<span class="ident" id="5489306"><a href="/net/http/cgi/child.go.html#5489159">v</a></span><span class="op" id="5489307">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489314">//&nbsp;TODO:&nbsp;cookies.&nbsp;&nbsp;parsing&nbsp;them&nbsp;isn&#39;t&nbsp;exported,&nbsp;though.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489372">uriStr</span>&nbsp;<span class="op" id="5489379">:=</span>&nbsp;<span class="ident" id="5489382"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489388">[</span><span class="string" id="5489389">&#34;REQUEST_URI&#34;</span><span class="op" id="5489402">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489405">if</span>&nbsp;<span class="ident" id="5489408"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span>&nbsp;<span class="op" id="5489415">==</span>&nbsp;<span class="string" id="5489418">&#34;&#34;</span>&nbsp;<span class="op" id="5489421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489425">//&nbsp;Fallback&nbsp;to&nbsp;SCRIPT_NAME,&nbsp;PATH_INFO&nbsp;and&nbsp;QUERY_STRING.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489483"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span>&nbsp;<span class="op" id="5489490">=</span>&nbsp;<span class="ident" id="5489492"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489498">[</span><span class="string" id="5489499">&#34;SCRIPT_NAME&#34;</span><span class="op" id="5489512">]</span>&nbsp;<span class="op" id="5489514">+</span>&nbsp;<span class="ident" id="5489516"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489522">[</span><span class="string" id="5489523">&#34;PATH_INFO&#34;</span><span class="op" id="5489534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489538">s</span>&nbsp;<span class="op" id="5489540">:=</span>&nbsp;<span class="ident" id="5489543"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489549">[</span><span class="string" id="5489550">&#34;QUERY_STRING&#34;</span><span class="op" id="5489564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489568">if</span>&nbsp;<span class="ident" id="5489571"><a href="/net/http/cgi/child.go.html#5489538">s</a></span>&nbsp;<span class="op" id="5489573">!=</span>&nbsp;<span class="string" id="5489576">&#34;&#34;</span>&nbsp;<span class="op" id="5489579">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489584"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span>&nbsp;<span class="op" id="5489591">+=</span>&nbsp;<span class="string" id="5489594">&#34;?&#34;</span>&nbsp;<span class="op" id="5489598">+</span>&nbsp;<span class="ident" id="5489600"><a href="/net/http/cgi/child.go.html#5489538">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489611">//&nbsp;There&#39;s&nbsp;apparently&nbsp;a&nbsp;de-facto&nbsp;standard&nbsp;for&nbsp;this.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489664">//&nbsp;http://docstore.mik.ua/orelly/linux/cgi/ch03_02.htm#ch03-35636</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489731">if</span>&nbsp;<span class="ident" id="5489734">s</span>&nbsp;<span class="op" id="5489736">:=</span>&nbsp;<span class="ident" id="5489739"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5489745">[</span><span class="string" id="5489746">&#34;HTTPS&#34;</span><span class="op" id="5489753">]</span><span class="op" id="5489754">;</span>&nbsp;<span class="ident" id="5489756"><a href="/net/http/cgi/child.go.html#5489734">s</a></span>&nbsp;<span class="op" id="5489758">==</span>&nbsp;<span class="string" id="5489761">&#34;on&#34;</span>&nbsp;<span class="op" id="5489766">||</span>&nbsp;<span class="ident" id="5489769"><a href="/net/http/cgi/child.go.html#5489734">s</a></span>&nbsp;<span class="op" id="5489771">==</span>&nbsp;<span class="string" id="5489774">&#34;ON&#34;</span>&nbsp;<span class="op" id="5489779">||</span>&nbsp;<span class="ident" id="5489782"><a href="/net/http/cgi/child.go.html#5489734">s</a></span>&nbsp;<span class="op" id="5489784">==</span>&nbsp;<span class="string" id="5489787">&#34;1&#34;</span>&nbsp;<span class="op" id="5489791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489795"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489796">.</span><span class="ident" id="5489797">TLS</span>&nbsp;<span class="op" id="5489801">=</span>&nbsp;<span class="op" id="5489803">&amp;</span><span class="ident" id="5489804"><a href="/net/http/cgi/child.go.html#5487363">tls</a></span><span class="op" id="5489807">.</span><span class="ident" id="5489808">ConnectionState</span><span class="op" id="5489823">{</span><span class="ident" id="5489824">HandshakeComplete</span><span class="op" id="5489841">:</span>&nbsp;<span class="ident" id="5489843">true</span><span class="op" id="5489847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489854">if</span>&nbsp;<span class="ident" id="5489857"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489858">.</span><span class="ident" id="5489859">Host</span>&nbsp;<span class="op" id="5489864">!=</span>&nbsp;<span class="string" id="5489867">&#34;&#34;</span>&nbsp;<span class="op" id="5489870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489874">//&nbsp;Hostname&nbsp;is&nbsp;provided,&nbsp;so&nbsp;we&nbsp;can&nbsp;reasonably&nbsp;construct&nbsp;a&nbsp;URL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489939">rawurl</span>&nbsp;<span class="op" id="5489946">:=</span>&nbsp;<span class="ident" id="5489949"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489950">.</span><span class="ident" id="5489951">Host</span>&nbsp;<span class="op" id="5489956">+</span>&nbsp;<span class="ident" id="5489958"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489967">if</span>&nbsp;<span class="ident" id="5489970"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5489971">.</span><span class="ident" id="5489972">TLS</span>&nbsp;<span class="op" id="5489976">==</span>&nbsp;<span class="ident" id="5489979">nil</span>&nbsp;<span class="op" id="5489983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489988"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span>&nbsp;<span class="op" id="5489995">=</span>&nbsp;<span class="string" id="5489997">&#34;http://&#34;</span>&nbsp;<span class="op" id="5490007">+</span>&nbsp;<span class="ident" id="5490009"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490018">}</span>&nbsp;<span class="keyword" id="5490020">else</span>&nbsp;<span class="op" id="5490025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490030"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span>&nbsp;<span class="op" id="5490037">=</span>&nbsp;<span class="string" id="5490039">&#34;https://&#34;</span>&nbsp;<span class="op" id="5490050">+</span>&nbsp;<span class="ident" id="5490052"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490065">url</span><span class="op" id="5490068">,</span>&nbsp;<span class="ident" id="5490070">err</span>&nbsp;<span class="op" id="5490074">:=</span>&nbsp;<span class="ident" id="5490077"><a href="/net/http/cgi/child.go.html#5487432">url</a></span><span class="op" id="5490080">.</span><span class="ident" id="5490081">Parse</span><span class="op" id="5490086">(</span><span class="ident" id="5490087"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span><span class="op" id="5490093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490097">if</span>&nbsp;<span class="ident" id="5490100"><a href="/net/http/cgi/child.go.html#5490070">err</a></span>&nbsp;<span class="op" id="5490104">!=</span>&nbsp;<span class="ident" id="5490107">nil</span>&nbsp;<span class="op" id="5490111">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490116">return</span>&nbsp;<span class="ident" id="5490123">nil</span><span class="op" id="5490126">,</span>&nbsp;<span class="ident" id="5490128"><a href="/net/http/cgi/child.go.html#5487377">errors</a></span><span class="op" id="5490134">.</span><span class="ident" id="5490135">New</span><span class="op" id="5490138">(</span><span class="string" id="5490139">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;host&nbsp;and&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="5490196">+</span>&nbsp;<span class="ident" id="5490198"><a href="/net/http/cgi/child.go.html#5489939">rawurl</a></span><span class="op" id="5490204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490212"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5490213">.</span><span class="ident" id="5490214">URL</span>&nbsp;<span class="op" id="5490218">=</span>&nbsp;<span class="ident" id="5490220"><a href="/net/http/cgi/child.go.html#5490065">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490228">//&nbsp;Fallback&nbsp;logic&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;Host&nbsp;header&nbsp;or&nbsp;the&nbsp;URL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490289">//&nbsp;failed&nbsp;to&nbsp;parse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490309">if</span>&nbsp;<span class="ident" id="5490312"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5490313">.</span><span class="ident" id="5490314">URL</span>&nbsp;<span class="op" id="5490318">==</span>&nbsp;<span class="ident" id="5490321">nil</span>&nbsp;<span class="op" id="5490325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490329">url</span><span class="op" id="5490332">,</span>&nbsp;<span class="ident" id="5490334">err</span>&nbsp;<span class="op" id="5490338">:=</span>&nbsp;<span class="ident" id="5490341"><a href="/net/http/cgi/child.go.html#5487432">url</a></span><span class="op" id="5490344">.</span><span class="ident" id="5490345">Parse</span><span class="op" id="5490350">(</span><span class="ident" id="5490351"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span><span class="op" id="5490357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490361">if</span>&nbsp;<span class="ident" id="5490364"><a href="/net/http/cgi/child.go.html#5490334">err</a></span>&nbsp;<span class="op" id="5490368">!=</span>&nbsp;<span class="ident" id="5490371">nil</span>&nbsp;<span class="op" id="5490375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490380">return</span>&nbsp;<span class="ident" id="5490387">nil</span><span class="op" id="5490390">,</span>&nbsp;<span class="ident" id="5490392"><a href="/net/http/cgi/child.go.html#5487377">errors</a></span><span class="op" id="5490398">.</span><span class="ident" id="5490399">New</span><span class="op" id="5490402">(</span><span class="string" id="5490403">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="5490451">+</span>&nbsp;<span class="ident" id="5490453"><a href="/net/http/cgi/child.go.html#5489372">uriStr</a></span><span class="op" id="5490459">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490467"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5490468">.</span><span class="ident" id="5490469">URL</span>&nbsp;<span class="op" id="5490473">=</span>&nbsp;<span class="ident" id="5490475"><a href="/net/http/cgi/child.go.html#5490329">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490484">//&nbsp;Request.RemoteAddr&nbsp;has&nbsp;its&nbsp;port&nbsp;set&nbsp;by&nbsp;Go&#39;s&nbsp;standard&nbsp;http</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490546">//&nbsp;server,&nbsp;so&nbsp;we&nbsp;do&nbsp;here&nbsp;too.&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;one,&nbsp;though,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490610">//&nbsp;use&nbsp;a&nbsp;dummy&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490631"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5490632">.</span><span class="ident" id="5490633">RemoteAddr</span>&nbsp;<span class="op" id="5490644">=</span>&nbsp;<span class="ident" id="5490646"><a href="/net/http/cgi/child.go.html#5487413">net</a></span><span class="op" id="5490649">.</span><span class="ident" id="5490650">JoinHostPort</span><span class="op" id="5490662">(</span><span class="ident" id="5490663"><a href="/net/http/cgi/child.go.html#5488281">params</a></span><span class="op" id="5490669">[</span><span class="string" id="5490670">&#34;REMOTE_ADDR&#34;</span><span class="op" id="5490683">]</span><span class="op" id="5490684">,</span>&nbsp;<span class="string" id="5490686">&#34;0&#34;</span><span class="op" id="5490689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490693">return</span>&nbsp;<span class="ident" id="5490700"><a href="/net/http/cgi/child.go.html#5488333">r</a></span><span class="op" id="5490701">,</span>&nbsp;<span class="ident" id="5490703">nil</span><br>
<span class="lineno">140</span><span class="op" id="5490707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5490710">//&nbsp;Serve&nbsp;executes&nbsp;the&nbsp;provided&nbsp;Handler&nbsp;on&nbsp;the&nbsp;currently&nbsp;active&nbsp;CGI</span><br>
<span class="lineno"></span><span class="comment" id="5490777">//&nbsp;request,&nbsp;if&nbsp;any.&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;current&nbsp;CGI&nbsp;environment</span><br>
<span class="lineno"></span><span class="comment" id="5490835">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;The&nbsp;provided&nbsp;handler&nbsp;may&nbsp;be&nbsp;nil&nbsp;to&nbsp;use</span><br>
<span class="lineno">145</span><span class="comment" id="5490899">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span><span class="keyword" id="5490924">func</span>&nbsp;<span class="ident" id="5490929">Serve</span><span class="op" id="5490934">(</span><span class="ident" id="5490935">handler</span>&nbsp;<span class="ident" id="5490943"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5490947">.</span><span class="ident" id="5490948">Handler</span><span class="op" id="5490955">)</span>&nbsp;<span class="builtintype" id="5490957">error</span>&nbsp;<span class="op" id="5490963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490966">req</span><span class="op" id="5490969">,</span>&nbsp;<span class="ident" id="5490971">err</span>&nbsp;<span class="op" id="5490975">:=</span>&nbsp;<span class="ident" id="5490978"><a href="/net/http/cgi/child.go.html#5487707">Request</a></span><span class="op" id="5490985">(</span><span class="op" id="5490986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490989">if</span>&nbsp;<span class="ident" id="5490992"><a href="/net/http/cgi/child.go.html#5490971">err</a></span>&nbsp;<span class="op" id="5490996">!=</span>&nbsp;<span class="ident" id="5490999">nil</span>&nbsp;<span class="op" id="5491003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491007">return</span>&nbsp;<span class="ident" id="5491014"><a href="/net/http/cgi/child.go.html#5490971">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491022">if</span>&nbsp;<span class="ident" id="5491025"><a href="/net/http/cgi/child.go.html#5490935">handler</a></span>&nbsp;<span class="op" id="5491033">==</span>&nbsp;<span class="ident" id="5491036">nil</span>&nbsp;<span class="op" id="5491040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491044"><a href="/net/http/cgi/child.go.html#5490935">handler</a></span>&nbsp;<span class="op" id="5491052">=</span>&nbsp;<span class="ident" id="5491054"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491058">.</span><span class="ident" id="5491059">DefaultServeMux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491079">rw</span>&nbsp;<span class="op" id="5491082">:=</span>&nbsp;<span class="op" id="5491085">&amp;</span><span class="ident" id="5491086"><a href="/net/http/cgi/child.go.html#5491332">response</a></span><span class="op" id="5491094">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491098">req</span><span class="op" id="5491101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491106"><a href="/net/http/cgi/child.go.html#5490966">req</a></span><span class="op" id="5491109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491113">header</span><span class="op" id="5491119">:</span>&nbsp;<span class="builtinfunc" id="5491121">make</span><span class="op" id="5491125">(</span><span class="ident" id="5491126"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491130">.</span><span class="ident" id="5491131">Header</span><span class="op" id="5491137">)</span><span class="op" id="5491138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491142">bufw</span><span class="op" id="5491146">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5491150"><a href="/net/http/cgi/child.go.html#5487354">bufio</a></span><span class="op" id="5491155">.</span><span class="ident" id="5491156">NewWriter</span><span class="op" id="5491165">(</span><span class="ident" id="5491166"><a href="/net/http/cgi/child.go.html#5487443">os</a></span><span class="op" id="5491168">.</span><span class="ident" id="5491169">Stdout</span><span class="op" id="5491175">)</span><span class="op" id="5491176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491182"><a href="/net/http/cgi/child.go.html#5490935">handler</a></span><span class="op" id="5491189">.</span><span class="ident" id="5491190">ServeHTTP</span><span class="op" id="5491199">(</span><span class="ident" id="5491200"><a href="/net/http/cgi/child.go.html#5491079">rw</a></span><span class="op" id="5491202">,</span>&nbsp;<span class="ident" id="5491204"><a href="/net/http/cgi/child.go.html#5490966">req</a></span><span class="op" id="5491207">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491210"><a href="/net/http/cgi/child.go.html#5491079">rw</a></span><span class="op" id="5491212">.</span><span class="ident" id="5491213">Write</span><span class="op" id="5491218">(</span><span class="ident" id="5491219">nil</span><span class="op" id="5491222">)</span>&nbsp;<span class="comment" id="5491224">//&nbsp;make&nbsp;sure&nbsp;a&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491257">if</span>&nbsp;<span class="ident" id="5491260"><a href="/net/http/cgi/child.go.html#5490971">err</a></span>&nbsp;<span class="op" id="5491264">=</span>&nbsp;<span class="ident" id="5491266"><a href="/net/http/cgi/child.go.html#5491079">rw</a></span><span class="op" id="5491268">.</span><span class="ident" id="5491269">bufw</span><span class="op" id="5491273">.</span><span class="ident" id="5491274">Flush</span><span class="op" id="5491279">(</span><span class="op" id="5491280">)</span><span class="op" id="5491281">;</span>&nbsp;<span class="ident" id="5491283"><a href="/net/http/cgi/child.go.html#5490971">err</a></span>&nbsp;<span class="op" id="5491287">!=</span>&nbsp;<span class="ident" id="5491290">nil</span>&nbsp;<span class="op" id="5491294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491298">return</span>&nbsp;<span class="ident" id="5491305"><a href="/net/http/cgi/child.go.html#5490971">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491313">return</span>&nbsp;<span class="ident" id="5491320">nil</span><br>
<span class="lineno">165</span><span class="op" id="5491324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491327">type</span>&nbsp;<span class="ident" id="5491332">response</span>&nbsp;<span class="keyword" id="5491341">struct</span>&nbsp;<span class="op" id="5491348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491351">req</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491362">*</span><span class="ident" id="5491363"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491367">.</span><span class="ident" id="5491368">Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491377">header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491388"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491392">.</span><span class="ident" id="5491393">Header</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491401">bufw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491412">*</span><span class="ident" id="5491413"><a href="/net/http/cgi/child.go.html#5487354">bufio</a></span><span class="op" id="5491418">.</span><span class="ident" id="5491419">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491427">headerSent</span>&nbsp;<span class="builtintype" id="5491438">bool</span><br>
<span class="lineno"></span><span class="op" id="5491443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491446">func</span>&nbsp;<span class="op" id="5491451">(</span><span class="ident" id="5491452">r</span>&nbsp;<span class="op" id="5491454">*</span><span class="ident" id="5491455"><a href="/net/http/cgi/child.go.html#5491332">response</a></span><span class="op" id="5491463">)</span>&nbsp;<span class="ident" id="5491465">Flush</span><span class="op" id="5491470">(</span><span class="op" id="5491471">)</span>&nbsp;<span class="op" id="5491473">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491476"><a href="/net/http/cgi/child.go.html#5491452">r</a></span><span class="op" id="5491477">.</span><span class="ident" id="5491478">bufw</span><span class="op" id="5491482">.</span><span class="ident" id="5491483">Flush</span><span class="op" id="5491488">(</span><span class="op" id="5491489">)</span><br>
<span class="lineno"></span><span class="op" id="5491491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491494">func</span>&nbsp;<span class="op" id="5491499">(</span><span class="ident" id="5491500">r</span>&nbsp;<span class="op" id="5491502">*</span><span class="ident" id="5491503"><a href="/net/http/cgi/child.go.html#5491332">response</a></span><span class="op" id="5491511">)</span>&nbsp;<span class="ident" id="5491513">Header</span><span class="op" id="5491519">(</span><span class="op" id="5491520">)</span>&nbsp;<span class="ident" id="5491522"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491526">.</span><span class="ident" id="5491527">Header</span>&nbsp;<span class="op" id="5491534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491537">return</span>&nbsp;<span class="ident" id="5491544"><a href="/net/http/cgi/child.go.html#5491500">r</a></span><span class="op" id="5491545">.</span><span class="ident" id="5491546">header</span><br>
<span class="lineno">180</span><span class="op" id="5491553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491556">func</span>&nbsp;<span class="op" id="5491561">(</span><span class="ident" id="5491562">r</span>&nbsp;<span class="op" id="5491564">*</span><span class="ident" id="5491565"><a href="/net/http/cgi/child.go.html#5491332">response</a></span><span class="op" id="5491573">)</span>&nbsp;<span class="ident" id="5491575">Write</span><span class="op" id="5491580">(</span><span class="ident" id="5491581">p</span>&nbsp;<span class="op" id="5491583">[</span><span class="op" id="5491584">]</span><span class="builtintype" id="5491585">byte</span><span class="op" id="5491589">)</span>&nbsp;<span class="op" id="5491591">(</span><span class="ident" id="5491592">n</span>&nbsp;<span class="builtintype" id="5491594">int</span><span class="op" id="5491597">,</span>&nbsp;<span class="ident" id="5491599">err</span>&nbsp;<span class="builtintype" id="5491603">error</span><span class="op" id="5491608">)</span>&nbsp;<span class="op" id="5491610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491613">if</span>&nbsp;<span class="op" id="5491616">!</span><span class="ident" id="5491617"><a href="/net/http/cgi/child.go.html#5491562">r</a></span><span class="op" id="5491618">.</span><span class="ident" id="5491619">headerSent</span>&nbsp;<span class="op" id="5491630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491634"><a href="/net/http/cgi/child.go.html#5491562">r</a></span><span class="op" id="5491635">.</span><span class="ident" id="5491636">WriteHeader</span><span class="op" id="5491647">(</span><span class="ident" id="5491648"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491652">.</span><span class="ident" id="5491653">StatusOK</span><span class="op" id="5491661">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491667">return</span>&nbsp;<span class="ident" id="5491674"><a href="/net/http/cgi/child.go.html#5491562">r</a></span><span class="op" id="5491675">.</span><span class="ident" id="5491676">bufw</span><span class="op" id="5491680">.</span><span class="ident" id="5491681">Write</span><span class="op" id="5491686">(</span><span class="ident" id="5491687"><a href="/net/http/cgi/child.go.html#5491581">p</a></span><span class="op" id="5491688">)</span><br>
<span class="lineno"></span><span class="op" id="5491690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5491693">func</span>&nbsp;<span class="op" id="5491698">(</span><span class="ident" id="5491699">r</span>&nbsp;<span class="op" id="5491701">*</span><span class="ident" id="5491702"><a href="/net/http/cgi/child.go.html#5491332">response</a></span><span class="op" id="5491710">)</span>&nbsp;<span class="ident" id="5491712">WriteHeader</span><span class="op" id="5491723">(</span><span class="ident" id="5491724">code</span>&nbsp;<span class="builtintype" id="5491729">int</span><span class="op" id="5491732">)</span>&nbsp;<span class="op" id="5491734">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491737">if</span>&nbsp;<span class="ident" id="5491740"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5491741">.</span><span class="ident" id="5491742">headerSent</span>&nbsp;<span class="op" id="5491753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491757">//&nbsp;Note:&nbsp;explicitly&nbsp;using&nbsp;Stderr,&nbsp;as&nbsp;Stdout&nbsp;is&nbsp;our&nbsp;HTTP&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491823"><a href="/net/http/cgi/child.go.html#5487387">fmt</a></span><span class="op" id="5491826">.</span><span class="ident" id="5491827">Fprintf</span><span class="op" id="5491834">(</span><span class="ident" id="5491835"><a href="/net/http/cgi/child.go.html#5487443">os</a></span><span class="op" id="5491837">.</span><span class="ident" id="5491838">Stderr</span><span class="op" id="5491844">,</span>&nbsp;<span class="string" id="5491846">&#34;CGI&nbsp;attempted&nbsp;to&nbsp;write&nbsp;header&nbsp;twice&nbsp;on&nbsp;request&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5491901">,</span>&nbsp;<span class="ident" id="5491903"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5491904">.</span><span class="ident" id="5491905">req</span><span class="op" id="5491908">.</span><span class="ident" id="5491909">URL</span><span class="op" id="5491912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491924">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491927"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5491928">.</span><span class="ident" id="5491929">headerSent</span>&nbsp;<span class="op" id="5491940">=</span>&nbsp;<span class="ident" id="5491942">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491948"><a href="/net/http/cgi/child.go.html#5487387">fmt</a></span><span class="op" id="5491951">.</span><span class="ident" id="5491952">Fprintf</span><span class="op" id="5491959">(</span><span class="ident" id="5491960"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5491961">.</span><span class="ident" id="5491962">bufw</span><span class="op" id="5491966">,</span>&nbsp;<span class="string" id="5491968">&#34;Status:&nbsp;%d&nbsp;%s\r\n&#34;</span><span class="op" id="5491987">,</span>&nbsp;<span class="ident" id="5491989"><a href="/net/http/cgi/child.go.html#5491724">code</a></span><span class="op" id="5491993">,</span>&nbsp;<span class="ident" id="5491995"><a href="/net/http/cgi/child.go.html#5487420">http</a></span><span class="op" id="5491999">.</span><span class="ident" id="5492000">StatusText</span><span class="op" id="5492010">(</span><span class="ident" id="5492011"><a href="/net/http/cgi/child.go.html#5491724">code</a></span><span class="op" id="5492015">)</span><span class="op" id="5492016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5492020">//&nbsp;Set&nbsp;a&nbsp;default&nbsp;Content-Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492051">if</span>&nbsp;<span class="ident" id="5492054">_</span><span class="op" id="5492055">,</span>&nbsp;<span class="ident" id="5492057">hasType</span>&nbsp;<span class="op" id="5492065">:=</span>&nbsp;<span class="ident" id="5492068"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492069">.</span><span class="ident" id="5492070">header</span><span class="op" id="5492076">[</span><span class="string" id="5492077">&#34;Content-Type&#34;</span><span class="op" id="5492091">]</span><span class="op" id="5492092">;</span>&nbsp;<span class="op" id="5492094">!</span><span class="ident" id="5492095"><a href="/net/http/cgi/child.go.html#5492057">hasType</a></span>&nbsp;<span class="op" id="5492103">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492107"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492108">.</span><span class="ident" id="5492109">header</span><span class="op" id="5492115">.</span><span class="ident" id="5492116">Add</span><span class="op" id="5492119">(</span><span class="string" id="5492120">&#34;Content-Type&#34;</span><span class="op" id="5492134">,</span>&nbsp;<span class="string" id="5492136">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="5492162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492169"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492170">.</span><span class="ident" id="5492171">header</span><span class="op" id="5492177">.</span><span class="ident" id="5492178">Write</span><span class="op" id="5492183">(</span><span class="ident" id="5492184"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492185">.</span><span class="ident" id="5492186">bufw</span><span class="op" id="5492190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492193"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492194">.</span><span class="ident" id="5492195">bufw</span><span class="op" id="5492199">.</span><span class="ident" id="5492200">WriteString</span><span class="op" id="5492211">(</span><span class="string" id="5492212">&#34;\r\n&#34;</span><span class="op" id="5492218">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492221"><a href="/net/http/cgi/child.go.html#5491699">r</a></span><span class="op" id="5492222">.</span><span class="ident" id="5492223">bufw</span><span class="op" id="5492227">.</span><span class="ident" id="5492228">Flush</span><span class="op" id="5492233">(</span><span class="op" id="5492234">)</span><br>
<span class="lineno"></span><span class="op" id="5492236">}</span>
</div>
</body>
</html>
