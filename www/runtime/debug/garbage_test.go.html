<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6746905">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6746961">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6747015">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6747066">package</span>&nbsp;<span class="ident" id="6747074">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6747081">import</span>&nbsp;<span class="op" id="6747088">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6747091">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6747102">&#34;testing&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6747113">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6747120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6747123">func</span>&nbsp;<span class="ident" id="6747128">TestReadGCStats</span><span class="op" id="6747143">(</span><span class="ident" id="6747144">t</span>&nbsp;<span class="op" id="6747146">*</span><span class="ident" id="6747147"><a href="/runtime/debug/garbage_test.go.html#6747102">testing</a></span><span class="op" id="6747154">.</span><span class="ident" id="6747155">T</span><span class="op" id="6747156">)</span>&nbsp;<span class="op" id="6747158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747161">defer</span>&nbsp;<span class="ident" id="6747167"><a href="/runtime/debug/garbage.go.html#6452355">SetGCPercent</a></span><span class="op" id="6747179">(</span><span class="ident" id="6747180"><a href="/runtime/debug/garbage.go.html#6452355">SetGCPercent</a></span><span class="op" id="6747192">(</span><span class="op" id="6747193">-</span><span class="num" id="6747194">1</span><span class="op" id="6747195">)</span><span class="op" id="6747196">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747200">var</span>&nbsp;<span class="ident" id="6747204">stats</span>&nbsp;<span class="ident" id="6747210"><a href="/runtime/debug/garbage.go.html#6448928">GCStats</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747219">var</span>&nbsp;<span class="ident" id="6747223">mstats</span>&nbsp;<span class="ident" id="6747230"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6747237">.</span><span class="ident" id="6747238">MemStats</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747248">var</span>&nbsp;<span class="ident" id="6747252">min</span><span class="op" id="6747255">,</span>&nbsp;<span class="ident" id="6747257">max</span>&nbsp;<span class="ident" id="6747261"><a href="/runtime/debug/garbage_test.go.html#6747113">time</a></span><span class="op" id="6747265">.</span><span class="ident" id="6747266">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6747277">//&nbsp;First&nbsp;ReadGCStats&nbsp;will&nbsp;allocate,&nbsp;second&nbsp;should&nbsp;not,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6747333">//&nbsp;especially&nbsp;if&nbsp;we&nbsp;follow&nbsp;up&nbsp;with&nbsp;an&nbsp;explicit&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747401"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747406">.</span><span class="ident" id="6747407">PauseQuantiles</span>&nbsp;<span class="op" id="6747422">=</span>&nbsp;<span class="builtinfunc" id="6747424">make</span><span class="op" id="6747428">(</span><span class="op" id="6747429">[</span><span class="op" id="6747430">]</span><span class="ident" id="6747431"><a href="/runtime/debug/garbage_test.go.html#6747113">time</a></span><span class="op" id="6747435">.</span><span class="ident" id="6747436">Duration</span><span class="op" id="6747444">,</span>&nbsp;<span class="num" id="6747446">10</span><span class="op" id="6747448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747451"><a href="/runtime/debug/garbage.go.html#6449855">ReadGCStats</a></span><span class="op" id="6747462">(</span><span class="op" id="6747463">&amp;</span><span class="ident" id="6747464"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747472"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6747479">.</span><span class="ident" id="6747480">GC</span><span class="op" id="6747482">(</span><span class="op" id="6747483">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6747487">//&nbsp;Assume&nbsp;these&nbsp;will&nbsp;return&nbsp;same&nbsp;data:&nbsp;no&nbsp;GC&nbsp;during&nbsp;ReadGCStats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747553"><a href="/runtime/debug/garbage.go.html#6449855">ReadGCStats</a></span><span class="op" id="6747564">(</span><span class="op" id="6747565">&amp;</span><span class="ident" id="6747566"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747574"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6747581">.</span><span class="ident" id="6747582">ReadMemStats</span><span class="op" id="6747594">(</span><span class="op" id="6747595">&amp;</span><span class="ident" id="6747596"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747606">if</span>&nbsp;<span class="ident" id="6747609"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747614">.</span><span class="ident" id="6747615">NumGC</span>&nbsp;<span class="op" id="6747621">!=</span>&nbsp;<span class="ident" id="6747624">int64</span><span class="op" id="6747629">(</span><span class="ident" id="6747630"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747636">.</span><span class="ident" id="6747637">NumGC</span><span class="op" id="6747642">)</span>&nbsp;<span class="op" id="6747644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747648"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6747649">.</span><span class="ident" id="6747650">Errorf</span><span class="op" id="6747656">(</span><span class="string" id="6747657">&#34;stats.NumGC&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.NumGC&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6747698">,</span>&nbsp;<span class="ident" id="6747700"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747705">.</span><span class="ident" id="6747706">NumGC</span><span class="op" id="6747711">,</span>&nbsp;<span class="ident" id="6747713"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747719">.</span><span class="ident" id="6747720">NumGC</span><span class="op" id="6747725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747731">if</span>&nbsp;<span class="ident" id="6747734"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747739">.</span><span class="ident" id="6747740">PauseTotal</span>&nbsp;<span class="op" id="6747751">!=</span>&nbsp;<span class="ident" id="6747754"><a href="/runtime/debug/garbage_test.go.html#6747113">time</a></span><span class="op" id="6747758">.</span><span class="ident" id="6747759">Duration</span><span class="op" id="6747767">(</span><span class="ident" id="6747768"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747774">.</span><span class="ident" id="6747775">PauseTotalNs</span><span class="op" id="6747787">)</span>&nbsp;<span class="op" id="6747789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747793"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6747794">.</span><span class="ident" id="6747795">Errorf</span><span class="op" id="6747801">(</span><span class="string" id="6747802">&#34;stats.PauseTotal&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.PauseTotalNs&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6747855">,</span>&nbsp;<span class="ident" id="6747857"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747862">.</span><span class="ident" id="6747863">PauseTotal</span><span class="op" id="6747873">,</span>&nbsp;<span class="ident" id="6747875"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747881">.</span><span class="ident" id="6747882">PauseTotalNs</span><span class="op" id="6747894">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6747897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6747900">if</span>&nbsp;<span class="ident" id="6747903"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6747908">.</span><span class="ident" id="6747909">LastGC</span><span class="op" id="6747915">.</span><span class="ident" id="6747916">UnixNano</span><span class="op" id="6747924">(</span><span class="op" id="6747925">)</span>&nbsp;<span class="op" id="6747927">!=</span>&nbsp;<span class="ident" id="6747930">int64</span><span class="op" id="6747935">(</span><span class="ident" id="6747936"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6747942">.</span><span class="ident" id="6747943">LastGC</span><span class="op" id="6747949">)</span>&nbsp;<span class="op" id="6747951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6747955"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6747956">.</span><span class="ident" id="6747957">Errorf</span><span class="op" id="6747963">(</span><span class="string" id="6747964">&#34;stats.LastGC.UnixNano&nbsp;=&nbsp;%d,&nbsp;but&nbsp;mstats.LastGC&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6748016">,</span>&nbsp;<span class="ident" id="6748018"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6748023">.</span><span class="ident" id="6748024">LastGC</span><span class="op" id="6748030">.</span><span class="ident" id="6748031">UnixNano</span><span class="op" id="6748039">(</span><span class="op" id="6748040">)</span><span class="op" id="6748041">,</span>&nbsp;<span class="ident" id="6748043"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748049">.</span><span class="ident" id="6748050">LastGC</span><span class="op" id="6748056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748062">n</span>&nbsp;<span class="op" id="6748064">:=</span>&nbsp;<span class="builtintype" id="6748067">int</span><span class="op" id="6748070">(</span><span class="ident" id="6748071"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748077">.</span><span class="ident" id="6748078">NumGC</span><span class="op" id="6748083">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748086">if</span>&nbsp;<span class="ident" id="6748089"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span>&nbsp;<span class="op" id="6748091">&gt;</span>&nbsp;<span class="builtinfunc" id="6748093">len</span><span class="op" id="6748096">(</span><span class="ident" id="6748097"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748103">.</span><span class="ident" id="6748104">PauseNs</span><span class="op" id="6748111">)</span>&nbsp;<span class="op" id="6748113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748117"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span>&nbsp;<span class="op" id="6748119">=</span>&nbsp;<span class="builtinfunc" id="6748121">len</span><span class="op" id="6748124">(</span><span class="ident" id="6748125"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748131">.</span><span class="ident" id="6748132">PauseNs</span><span class="op" id="6748139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748145">if</span>&nbsp;<span class="builtinfunc" id="6748148">len</span><span class="op" id="6748151">(</span><span class="ident" id="6748152"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6748157">.</span><span class="ident" id="6748158">Pause</span><span class="op" id="6748163">)</span>&nbsp;<span class="op" id="6748165">!=</span>&nbsp;<span class="ident" id="6748168"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span>&nbsp;<span class="op" id="6748170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748174"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6748175">.</span><span class="ident" id="6748176">Errorf</span><span class="op" id="6748182">(</span><span class="string" id="6748183">&#34;len(stats.Pause)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6748215">,</span>&nbsp;<span class="builtinfunc" id="6748217">len</span><span class="op" id="6748220">(</span><span class="ident" id="6748221"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6748226">.</span><span class="ident" id="6748227">Pause</span><span class="op" id="6748232">)</span><span class="op" id="6748233">,</span>&nbsp;<span class="ident" id="6748235"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span><span class="op" id="6748236">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748239">}</span>&nbsp;<span class="keyword" id="6748241">else</span>&nbsp;<span class="op" id="6748246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748250">off</span>&nbsp;<span class="op" id="6748254">:=</span>&nbsp;<span class="op" id="6748257">(</span><span class="builtintype" id="6748258">int</span><span class="op" id="6748261">(</span><span class="ident" id="6748262"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748268">.</span><span class="ident" id="6748269">NumGC</span><span class="op" id="6748274">)</span>&nbsp;<span class="op" id="6748276">+</span>&nbsp;<span class="builtinfunc" id="6748278">len</span><span class="op" id="6748281">(</span><span class="ident" id="6748282"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748288">.</span><span class="ident" id="6748289">PauseNs</span><span class="op" id="6748296">)</span>&nbsp;<span class="op" id="6748298">-</span>&nbsp;<span class="num" id="6748300">1</span><span class="op" id="6748301">)</span>&nbsp;<span class="op" id="6748303">%</span>&nbsp;<span class="builtinfunc" id="6748305">len</span><span class="op" id="6748308">(</span><span class="ident" id="6748309"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748315">.</span><span class="ident" id="6748316">PauseNs</span><span class="op" id="6748323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748327">for</span>&nbsp;<span class="ident" id="6748331">i</span>&nbsp;<span class="op" id="6748333">:=</span>&nbsp;<span class="num" id="6748336">0</span><span class="op" id="6748337">;</span>&nbsp;<span class="ident" id="6748339"><a href="/runtime/debug/garbage_test.go.html#6748331">i</a></span>&nbsp;<span class="op" id="6748341">&lt;</span>&nbsp;<span class="ident" id="6748343"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span><span class="op" id="6748344">;</span>&nbsp;<span class="ident" id="6748346"><a href="/runtime/debug/garbage_test.go.html#6748331">i</a></span><span class="op" id="6748347">++</span>&nbsp;<span class="op" id="6748350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748355">dt</span>&nbsp;<span class="op" id="6748358">:=</span>&nbsp;<span class="ident" id="6748361"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6748366">.</span><span class="ident" id="6748367">Pause</span><span class="op" id="6748372">[</span><span class="ident" id="6748373"><a href="/runtime/debug/garbage_test.go.html#6748331">i</a></span><span class="op" id="6748374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748379">if</span>&nbsp;<span class="ident" id="6748382"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span>&nbsp;<span class="op" id="6748385">!=</span>&nbsp;<span class="ident" id="6748388"><a href="/runtime/debug/garbage_test.go.html#6747113">time</a></span><span class="op" id="6748392">.</span><span class="ident" id="6748393">Duration</span><span class="op" id="6748401">(</span><span class="ident" id="6748402"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748408">.</span><span class="ident" id="6748409">PauseNs</span><span class="op" id="6748416">[</span><span class="ident" id="6748417"><a href="/runtime/debug/garbage_test.go.html#6748250">off</a></span><span class="op" id="6748420">]</span><span class="op" id="6748421">)</span>&nbsp;<span class="op" id="6748423">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748429"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6748430">.</span><span class="ident" id="6748431">Errorf</span><span class="op" id="6748437">(</span><span class="string" id="6748438">&#34;stats.Pause[%d]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6748469">,</span>&nbsp;<span class="ident" id="6748471"><a href="/runtime/debug/garbage_test.go.html#6748331">i</a></span><span class="op" id="6748472">,</span>&nbsp;<span class="ident" id="6748474"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span><span class="op" id="6748476">,</span>&nbsp;<span class="ident" id="6748478"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748484">.</span><span class="ident" id="6748485">PauseNs</span><span class="op" id="6748492">[</span><span class="ident" id="6748493"><a href="/runtime/debug/garbage_test.go.html#6748250">off</a></span><span class="op" id="6748496">]</span><span class="op" id="6748497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748507">if</span>&nbsp;<span class="ident" id="6748510"><a href="/runtime/debug/garbage_test.go.html#6747257">max</a></span>&nbsp;<span class="op" id="6748514">&lt;</span>&nbsp;<span class="ident" id="6748516"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span>&nbsp;<span class="op" id="6748519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748525"><a href="/runtime/debug/garbage_test.go.html#6747257">max</a></span>&nbsp;<span class="op" id="6748529">=</span>&nbsp;<span class="ident" id="6748531"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748537">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748542">if</span>&nbsp;<span class="ident" id="6748545"><a href="/runtime/debug/garbage_test.go.html#6747252">min</a></span>&nbsp;<span class="op" id="6748549">&gt;</span>&nbsp;<span class="ident" id="6748551"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span>&nbsp;<span class="op" id="6748554">||</span>&nbsp;<span class="ident" id="6748557"><a href="/runtime/debug/garbage_test.go.html#6748331">i</a></span>&nbsp;<span class="op" id="6748559">==</span>&nbsp;<span class="num" id="6748562">0</span>&nbsp;<span class="op" id="6748564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748570"><a href="/runtime/debug/garbage_test.go.html#6747252">min</a></span>&nbsp;<span class="op" id="6748574">=</span>&nbsp;<span class="ident" id="6748576"><a href="/runtime/debug/garbage_test.go.html#6748355">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748587"><a href="/runtime/debug/garbage_test.go.html#6748250">off</a></span>&nbsp;<span class="op" id="6748591">=</span>&nbsp;<span class="op" id="6748593">(</span><span class="ident" id="6748594"><a href="/runtime/debug/garbage_test.go.html#6748250">off</a></span>&nbsp;<span class="op" id="6748598">+</span>&nbsp;<span class="builtinfunc" id="6748600">len</span><span class="op" id="6748603">(</span><span class="ident" id="6748604"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748610">.</span><span class="ident" id="6748611">PauseNs</span><span class="op" id="6748618">)</span>&nbsp;<span class="op" id="6748620">-</span>&nbsp;<span class="num" id="6748622">1</span><span class="op" id="6748623">)</span>&nbsp;<span class="op" id="6748625">%</span>&nbsp;<span class="builtinfunc" id="6748627">len</span><span class="op" id="6748630">(</span><span class="ident" id="6748631"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6748637">.</span><span class="ident" id="6748638">PauseNs</span><span class="op" id="6748645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748649">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748656">q</span>&nbsp;<span class="op" id="6748658">:=</span>&nbsp;<span class="ident" id="6748661"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6748666">.</span><span class="ident" id="6748667">PauseQuantiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748683">nq</span>&nbsp;<span class="op" id="6748686">:=</span>&nbsp;<span class="builtinfunc" id="6748689">len</span><span class="op" id="6748692">(</span><span class="ident" id="6748693"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748697">if</span>&nbsp;<span class="ident" id="6748700"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748701">[</span><span class="num" id="6748702">0</span><span class="op" id="6748703">]</span>&nbsp;<span class="op" id="6748705">!=</span>&nbsp;<span class="ident" id="6748708"><a href="/runtime/debug/garbage_test.go.html#6747252">min</a></span>&nbsp;<span class="op" id="6748712">||</span>&nbsp;<span class="ident" id="6748715"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748716">[</span><span class="ident" id="6748717"><a href="/runtime/debug/garbage_test.go.html#6748683">nq</a></span><span class="op" id="6748719">-</span><span class="num" id="6748720">1</span><span class="op" id="6748721">]</span>&nbsp;<span class="op" id="6748723">!=</span>&nbsp;<span class="ident" id="6748726"><a href="/runtime/debug/garbage_test.go.html#6747257">max</a></span>&nbsp;<span class="op" id="6748730">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748734"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6748735">.</span><span class="ident" id="6748736">Errorf</span><span class="op" id="6748742">(</span><span class="string" id="6748743">&#34;stats.PauseQuantiles&nbsp;=&nbsp;[%d,&nbsp;...,&nbsp;%d],&nbsp;want&nbsp;[%d,&nbsp;...,&nbsp;%d]&#34;</span><span class="op" id="6748801">,</span>&nbsp;<span class="ident" id="6748803"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748804">[</span><span class="num" id="6748805">0</span><span class="op" id="6748806">]</span><span class="op" id="6748807">,</span>&nbsp;<span class="ident" id="6748809"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748810">[</span><span class="ident" id="6748811"><a href="/runtime/debug/garbage_test.go.html#6748683">nq</a></span><span class="op" id="6748813">-</span><span class="num" id="6748814">1</span><span class="op" id="6748815">]</span><span class="op" id="6748816">,</span>&nbsp;<span class="ident" id="6748818"><a href="/runtime/debug/garbage_test.go.html#6747252">min</a></span><span class="op" id="6748821">,</span>&nbsp;<span class="ident" id="6748823"><a href="/runtime/debug/garbage_test.go.html#6747257">max</a></span><span class="op" id="6748826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748833">for</span>&nbsp;<span class="ident" id="6748837">i</span>&nbsp;<span class="op" id="6748839">:=</span>&nbsp;<span class="num" id="6748842">0</span><span class="op" id="6748843">;</span>&nbsp;<span class="ident" id="6748845"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span>&nbsp;<span class="op" id="6748847">&lt;</span>&nbsp;<span class="ident" id="6748849"><a href="/runtime/debug/garbage_test.go.html#6748683">nq</a></span><span class="op" id="6748851">-</span><span class="num" id="6748852">1</span><span class="op" id="6748853">;</span>&nbsp;<span class="ident" id="6748855"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748856">++</span>&nbsp;<span class="op" id="6748859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6748863">if</span>&nbsp;<span class="ident" id="6748866"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748867">[</span><span class="ident" id="6748868"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748869">]</span>&nbsp;<span class="op" id="6748871">&gt;</span>&nbsp;<span class="ident" id="6748873"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748874">[</span><span class="ident" id="6748875"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748876">+</span><span class="num" id="6748877">1</span><span class="op" id="6748878">]</span>&nbsp;<span class="op" id="6748880">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6748885"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6748886">.</span><span class="ident" id="6748887">Errorf</span><span class="op" id="6748893">(</span><span class="string" id="6748894">&#34;stats.PauseQuantiles[%d]=%d&nbsp;&gt;&nbsp;stats.PauseQuantiles[%d]=%d&#34;</span><span class="op" id="6748953">,</span>&nbsp;<span class="ident" id="6748955"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748956">,</span>&nbsp;<span class="ident" id="6748958"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748959">[</span><span class="ident" id="6748960"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748961">]</span><span class="op" id="6748962">,</span>&nbsp;<span class="ident" id="6748964"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748965">+</span><span class="num" id="6748966">1</span><span class="op" id="6748967">,</span>&nbsp;<span class="ident" id="6748969"><a href="/runtime/debug/garbage_test.go.html#6748656">q</a></span><span class="op" id="6748970">[</span><span class="ident" id="6748971"><a href="/runtime/debug/garbage_test.go.html#6748837">i</a></span><span class="op" id="6748972">+</span><span class="num" id="6748973">1</span><span class="op" id="6748974">]</span><span class="op" id="6748975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6748982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6748986">//&nbsp;compare&nbsp;memory&nbsp;stats&nbsp;with&nbsp;gc&nbsp;stats:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749026">if</span>&nbsp;<span class="builtinfunc" id="6749029">len</span><span class="op" id="6749032">(</span><span class="ident" id="6749033"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6749038">.</span><span class="ident" id="6749039">PauseEnd</span><span class="op" id="6749047">)</span>&nbsp;<span class="op" id="6749049">!=</span>&nbsp;<span class="ident" id="6749052"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span>&nbsp;<span class="op" id="6749054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749058"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6749059">.</span><span class="ident" id="6749060">Fatalf</span><span class="op" id="6749066">(</span><span class="string" id="6749067">&#34;len(stats.PauseEnd)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6749102">,</span>&nbsp;<span class="builtinfunc" id="6749104">len</span><span class="op" id="6749107">(</span><span class="ident" id="6749108"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6749113">.</span><span class="ident" id="6749114">PauseEnd</span><span class="op" id="6749122">)</span><span class="op" id="6749123">,</span>&nbsp;<span class="ident" id="6749125"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span><span class="op" id="6749126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749132">off</span>&nbsp;<span class="op" id="6749136">:=</span>&nbsp;<span class="op" id="6749139">(</span><span class="builtintype" id="6749140">int</span><span class="op" id="6749143">(</span><span class="ident" id="6749144"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749150">.</span><span class="ident" id="6749151">NumGC</span><span class="op" id="6749156">)</span>&nbsp;<span class="op" id="6749158">+</span>&nbsp;<span class="builtinfunc" id="6749160">len</span><span class="op" id="6749163">(</span><span class="ident" id="6749164"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749170">.</span><span class="ident" id="6749171">PauseEnd</span><span class="op" id="6749179">)</span>&nbsp;<span class="op" id="6749181">-</span>&nbsp;<span class="num" id="6749183">1</span><span class="op" id="6749184">)</span>&nbsp;<span class="op" id="6749186">%</span>&nbsp;<span class="builtinfunc" id="6749188">len</span><span class="op" id="6749191">(</span><span class="ident" id="6749192"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749198">.</span><span class="ident" id="6749199">PauseEnd</span><span class="op" id="6749207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749210">for</span>&nbsp;<span class="ident" id="6749214">i</span>&nbsp;<span class="op" id="6749216">:=</span>&nbsp;<span class="num" id="6749219">0</span><span class="op" id="6749220">;</span>&nbsp;<span class="ident" id="6749222"><a href="/runtime/debug/garbage_test.go.html#6749214">i</a></span>&nbsp;<span class="op" id="6749224">&lt;</span>&nbsp;<span class="ident" id="6749226"><a href="/runtime/debug/garbage_test.go.html#6748062">n</a></span><span class="op" id="6749227">;</span>&nbsp;<span class="ident" id="6749229"><a href="/runtime/debug/garbage_test.go.html#6749214">i</a></span><span class="op" id="6749230">++</span>&nbsp;<span class="op" id="6749233">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749237">dt</span>&nbsp;<span class="op" id="6749240">:=</span>&nbsp;<span class="ident" id="6749243"><a href="/runtime/debug/garbage_test.go.html#6747204">stats</a></span><span class="op" id="6749248">.</span><span class="ident" id="6749249">PauseEnd</span><span class="op" id="6749257">[</span><span class="ident" id="6749258"><a href="/runtime/debug/garbage_test.go.html#6749214">i</a></span><span class="op" id="6749259">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749263">if</span>&nbsp;<span class="ident" id="6749266"><a href="/runtime/debug/garbage_test.go.html#6749237">dt</a></span><span class="op" id="6749268">.</span><span class="ident" id="6749269">UnixNano</span><span class="op" id="6749277">(</span><span class="op" id="6749278">)</span>&nbsp;<span class="op" id="6749280">!=</span>&nbsp;<span class="ident" id="6749283">int64</span><span class="op" id="6749288">(</span><span class="ident" id="6749289"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749295">.</span><span class="ident" id="6749296">PauseEnd</span><span class="op" id="6749304">[</span><span class="ident" id="6749305"><a href="/runtime/debug/garbage_test.go.html#6749132">off</a></span><span class="op" id="6749308">]</span><span class="op" id="6749309">)</span>&nbsp;<span class="op" id="6749311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749316"><a href="/runtime/debug/garbage_test.go.html#6747144">t</a></span><span class="op" id="6749317">.</span><span class="ident" id="6749318">Errorf</span><span class="op" id="6749324">(</span><span class="string" id="6749325">&#34;stats.PauseEnd[%d]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6749359">,</span>&nbsp;<span class="ident" id="6749361"><a href="/runtime/debug/garbage_test.go.html#6749214">i</a></span><span class="op" id="6749362">,</span>&nbsp;<span class="ident" id="6749364"><a href="/runtime/debug/garbage_test.go.html#6749237">dt</a></span><span class="op" id="6749366">,</span>&nbsp;<span class="ident" id="6749368"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749374">.</span><span class="ident" id="6749375">PauseEnd</span><span class="op" id="6749383">[</span><span class="ident" id="6749384"><a href="/runtime/debug/garbage_test.go.html#6749132">off</a></span><span class="op" id="6749387">]</span><span class="op" id="6749388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749396"><a href="/runtime/debug/garbage_test.go.html#6749132">off</a></span>&nbsp;<span class="op" id="6749400">=</span>&nbsp;<span class="op" id="6749402">(</span><span class="ident" id="6749403"><a href="/runtime/debug/garbage_test.go.html#6749132">off</a></span>&nbsp;<span class="op" id="6749407">+</span>&nbsp;<span class="builtinfunc" id="6749409">len</span><span class="op" id="6749412">(</span><span class="ident" id="6749413"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749419">.</span><span class="ident" id="6749420">PauseEnd</span><span class="op" id="6749428">)</span>&nbsp;<span class="op" id="6749430">-</span>&nbsp;<span class="num" id="6749432">1</span><span class="op" id="6749433">)</span>&nbsp;<span class="op" id="6749435">%</span>&nbsp;<span class="builtinfunc" id="6749437">len</span><span class="op" id="6749440">(</span><span class="ident" id="6749441"><a href="/runtime/debug/garbage_test.go.html#6747223">mstats</a></span><span class="op" id="6749447">.</span><span class="ident" id="6749448">PauseEnd</span><span class="op" id="6749456">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749459">}</span><br>
<span class="lineno"></span><span class="op" id="6749461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6749464">var</span>&nbsp;<span class="ident" id="6749468">big</span>&nbsp;<span class="op" id="6749472">=</span>&nbsp;<span class="builtinfunc" id="6749474">make</span><span class="op" id="6749478">(</span><span class="op" id="6749479">[</span><span class="op" id="6749480">]</span><span class="builtintype" id="6749481">byte</span><span class="op" id="6749485">,</span>&nbsp;<span class="num" id="6749487">1</span><span class="op" id="6749488">&lt;&lt;</span><span class="num" id="6749490">20</span><span class="op" id="6749492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6749495">func</span>&nbsp;<span class="ident" id="6749500">TestFreeOSMemory</span><span class="op" id="6749516">(</span><span class="ident" id="6749517">t</span>&nbsp;<span class="op" id="6749519">*</span><span class="ident" id="6749520"><a href="/runtime/debug/garbage_test.go.html#6747102">testing</a></span><span class="op" id="6749527">.</span><span class="ident" id="6749528">T</span><span class="op" id="6749529">)</span>&nbsp;<span class="op" id="6749531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749534">var</span>&nbsp;<span class="ident" id="6749538">ms1</span><span class="op" id="6749541">,</span>&nbsp;<span class="ident" id="6749543">ms2</span>&nbsp;<span class="ident" id="6749547"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6749554">.</span><span class="ident" id="6749555">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749566">if</span>&nbsp;<span class="ident" id="6749569"><a href="/runtime/debug/garbage_test.go.html#6749468">big</a></span>&nbsp;<span class="op" id="6749573">==</span>&nbsp;<span class="ident" id="6749576">nil</span>&nbsp;<span class="op" id="6749580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749584"><a href="/runtime/debug/garbage_test.go.html#6749517">t</a></span><span class="op" id="6749585">.</span><span class="ident" id="6749586">Skip</span><span class="op" id="6749590">(</span><span class="string" id="6749591">&#34;test&nbsp;is&nbsp;not&nbsp;reliable&nbsp;when&nbsp;run&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="6749637">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749643"><a href="/runtime/debug/garbage_test.go.html#6749468">big</a></span>&nbsp;<span class="op" id="6749647">=</span>&nbsp;<span class="ident" id="6749649">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749654"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6749661">.</span><span class="ident" id="6749662">GC</span><span class="op" id="6749664">(</span><span class="op" id="6749665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749668"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6749675">.</span><span class="ident" id="6749676">ReadMemStats</span><span class="op" id="6749688">(</span><span class="op" id="6749689">&amp;</span><span class="ident" id="6749690"><a href="/runtime/debug/garbage_test.go.html#6749538">ms1</a></span><span class="op" id="6749693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749696"><a href="/runtime/debug/garbage.go.html#6452714">FreeOSMemory</a></span><span class="op" id="6749708">(</span><span class="op" id="6749709">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749712"><a href="/runtime/debug/garbage_test.go.html#6747091">runtime</a></span><span class="op" id="6749719">.</span><span class="ident" id="6749720">ReadMemStats</span><span class="op" id="6749732">(</span><span class="op" id="6749733">&amp;</span><span class="ident" id="6749734"><a href="/runtime/debug/garbage_test.go.html#6749543">ms2</a></span><span class="op" id="6749737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6749740">if</span>&nbsp;<span class="ident" id="6749743"><a href="/runtime/debug/garbage_test.go.html#6749538">ms1</a></span><span class="op" id="6749746">.</span><span class="ident" id="6749747">HeapReleased</span>&nbsp;<span class="op" id="6749760">&gt;=</span>&nbsp;<span class="ident" id="6749763"><a href="/runtime/debug/garbage_test.go.html#6749543">ms2</a></span><span class="op" id="6749766">.</span><span class="ident" id="6749767">HeapReleased</span>&nbsp;<span class="op" id="6749780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6749784"><a href="/runtime/debug/garbage_test.go.html#6749517">t</a></span><span class="op" id="6749785">.</span><span class="ident" id="6749786">Errorf</span><span class="op" id="6749792">(</span><span class="string" id="6749793">&#34;released&nbsp;before=%d;&nbsp;released&nbsp;after=%d;&nbsp;did&nbsp;not&nbsp;go&nbsp;up&#34;</span><span class="op" id="6749847">,</span>&nbsp;<span class="ident" id="6749849"><a href="/runtime/debug/garbage_test.go.html#6749538">ms1</a></span><span class="op" id="6749852">.</span><span class="ident" id="6749853">HeapReleased</span><span class="op" id="6749865">,</span>&nbsp;<span class="ident" id="6749867"><a href="/runtime/debug/garbage_test.go.html#6749543">ms2</a></span><span class="op" id="6749870">.</span><span class="ident" id="6749871">HeapReleased</span><span class="op" id="6749883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6749886">}</span><br>
<span class="lineno"></span><span class="op" id="6749888">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6749891">func</span>&nbsp;<span class="ident" id="6749896">TestSetGCPercent</span><span class="op" id="6749912">(</span><span class="ident" id="6749913">t</span>&nbsp;<span class="op" id="6749915">*</span><span class="ident" id="6749916"><a href="/runtime/debug/garbage_test.go.html#6747102">testing</a></span><span class="op" id="6749923">.</span><span class="ident" id="6749924">T</span><span class="op" id="6749925">)</span>&nbsp;<span class="op" id="6749927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749930">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;variable&nbsp;is&nbsp;being&nbsp;set&nbsp;and&nbsp;returned&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6749994">//&nbsp;Assume&nbsp;the&nbsp;percentage&nbsp;itself&nbsp;is&nbsp;implemented&nbsp;fine&nbsp;during&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6750058">//&nbsp;which&nbsp;is&nbsp;harder&nbsp;to&nbsp;test.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750087">old</span>&nbsp;<span class="op" id="6750091">:=</span>&nbsp;<span class="ident" id="6750094"><a href="/runtime/debug/garbage.go.html#6452355">SetGCPercent</a></span><span class="op" id="6750106">(</span><span class="num" id="6750107">123</span><span class="op" id="6750110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6750113">new</span>&nbsp;<span class="op" id="6750117">:=</span>&nbsp;<span class="ident" id="6750120"><a href="/runtime/debug/garbage.go.html#6452355">SetGCPercent</a></span><span class="op" id="6750132">(</span><span class="ident" id="6750133"><a href="/runtime/debug/garbage_test.go.html#6750087">old</a></span><span class="op" id="6750136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750139">if</span>&nbsp;<span class="builtinfunc" id="6750142"><a href="/runtime/debug/garbage_test.go.html#6750113">new</a></span>&nbsp;<span class="op" id="6750146">!=</span>&nbsp;<span class="num" id="6750149">123</span>&nbsp;<span class="op" id="6750153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750157"><a href="/runtime/debug/garbage_test.go.html#6749913">t</a></span><span class="op" id="6750158">.</span><span class="ident" id="6750159">Errorf</span><span class="op" id="6750165">(</span><span class="string" id="6750166">&#34;SetGCPercent(123);&nbsp;SetGCPercent(x)&nbsp;=&nbsp;%d,&nbsp;want&nbsp;123&#34;</span><span class="op" id="6750217">,</span>&nbsp;<span class="builtinfunc" id="6750219"><a href="/runtime/debug/garbage_test.go.html#6750113">new</a></span><span class="op" id="6750222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750225">}</span><br>
<span class="lineno">115</span><span class="op" id="6750227">}</span>
</div>
</body>
</html>
