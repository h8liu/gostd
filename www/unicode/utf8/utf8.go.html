<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2182870">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2182925">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2182979">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2183030">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2183108">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="2183193">package</span>&nbsp;<span class="ident" id="2183201">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2183207">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="2183264">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="2183319">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2183395">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="2183435">const</span>&nbsp;<span class="op" id="2183441">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183444">RuneError</span>&nbsp;<span class="op" id="2183454">=</span>&nbsp;<span class="string" id="2183456">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2183469">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183525">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="2183535">=</span>&nbsp;<span class="num" id="2183537">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2183550">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183628">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2183638">=</span>&nbsp;<span class="string" id="2183640">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="2183653">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183691">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2183701">=</span>&nbsp;<span class="num" id="2183703">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2183716">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="2183781">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2183784">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="2183847">const</span>&nbsp;<span class="op" id="2183853">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183856">surrogateMin</span>&nbsp;<span class="op" id="2183869">=</span>&nbsp;<span class="num" id="2183871">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183879">surrogateMax</span>&nbsp;<span class="op" id="2183892">=</span>&nbsp;<span class="num" id="2183894">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="2183901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2183904">const</span>&nbsp;<span class="op" id="2183910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183913">t1</span>&nbsp;<span class="op" id="2183916">=</span>&nbsp;<span class="num" id="2183918">0x00</span>&nbsp;<span class="comment" id="2183923">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183937">tx</span>&nbsp;<span class="op" id="2183940">=</span>&nbsp;<span class="num" id="2183942">0x80</span>&nbsp;<span class="comment" id="2183947">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183961">t2</span>&nbsp;<span class="op" id="2183964">=</span>&nbsp;<span class="num" id="2183966">0xC0</span>&nbsp;<span class="comment" id="2183971">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2183985">t3</span>&nbsp;<span class="op" id="2183988">=</span>&nbsp;<span class="num" id="2183990">0xE0</span>&nbsp;<span class="comment" id="2183995">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184009">t4</span>&nbsp;<span class="op" id="2184012">=</span>&nbsp;<span class="num" id="2184014">0xF0</span>&nbsp;<span class="comment" id="2184019">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184033">t5</span>&nbsp;<span class="op" id="2184036">=</span>&nbsp;<span class="num" id="2184038">0xF8</span>&nbsp;<span class="comment" id="2184043">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184058">maskx</span>&nbsp;<span class="op" id="2184064">=</span>&nbsp;<span class="num" id="2184066">0x3F</span>&nbsp;<span class="comment" id="2184071">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184085">mask2</span>&nbsp;<span class="op" id="2184091">=</span>&nbsp;<span class="num" id="2184093">0x1F</span>&nbsp;<span class="comment" id="2184098">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184112">mask3</span>&nbsp;<span class="op" id="2184118">=</span>&nbsp;<span class="num" id="2184120">0x0F</span>&nbsp;<span class="comment" id="2184125">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184139">mask4</span>&nbsp;<span class="op" id="2184145">=</span>&nbsp;<span class="num" id="2184147">0x07</span>&nbsp;<span class="comment" id="2184152">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184167">rune1Max</span>&nbsp;<span class="op" id="2184176">=</span>&nbsp;<span class="num" id="2184178">1</span><span class="op" id="2184179">&lt;&lt;</span><span class="num" id="2184181">7</span>&nbsp;<span class="op" id="2184183">-</span>&nbsp;<span class="num" id="2184185">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184188">rune2Max</span>&nbsp;<span class="op" id="2184197">=</span>&nbsp;<span class="num" id="2184199">1</span><span class="op" id="2184200">&lt;&lt;</span><span class="num" id="2184202">11</span>&nbsp;<span class="op" id="2184205">-</span>&nbsp;<span class="num" id="2184207">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184210">rune3Max</span>&nbsp;<span class="op" id="2184219">=</span>&nbsp;<span class="num" id="2184221">1</span><span class="op" id="2184222">&lt;&lt;</span><span class="num" id="2184224">16</span>&nbsp;<span class="op" id="2184227">-</span>&nbsp;<span class="num" id="2184229">1</span><br>
<span class="lineno"></span><span class="op" id="2184231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="2184234">func</span>&nbsp;<span class="ident" id="2184239">decodeRuneInternal</span><span class="op" id="2184257">(</span><span class="ident" id="2184258">p</span>&nbsp;<span class="op" id="2184260">[</span><span class="op" id="2184261">]</span><span class="builtintype" id="2184262">byte</span><span class="op" id="2184266">)</span>&nbsp;<span class="op" id="2184268">(</span><span class="ident" id="2184269">r</span>&nbsp;<span class="builtintype" id="2184271">rune</span><span class="op" id="2184275">,</span>&nbsp;<span class="ident" id="2184277">size</span>&nbsp;<span class="builtintype" id="2184282">int</span><span class="op" id="2184285">,</span>&nbsp;<span class="ident" id="2184287">short</span>&nbsp;<span class="builtintype" id="2184293">bool</span><span class="op" id="2184297">)</span>&nbsp;<span class="op" id="2184299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184302">n</span>&nbsp;<span class="op" id="2184304">:=</span>&nbsp;<span class="builtinfunc" id="2184307">len</span><span class="op" id="2184310">(</span><span class="ident" id="2184311">p</span><span class="op" id="2184312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184315">if</span>&nbsp;<span class="ident" id="2184318">n</span>&nbsp;<span class="op" id="2184320">&lt;</span>&nbsp;<span class="num" id="2184322">1</span>&nbsp;<span class="op" id="2184324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184328">return</span>&nbsp;<span class="ident" id="2184335">RuneError</span><span class="op" id="2184344">,</span>&nbsp;<span class="num" id="2184346">0</span><span class="op" id="2184347">,</span>&nbsp;<span class="ident" id="2184349">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184355">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184358">c0</span>&nbsp;<span class="op" id="2184361">:=</span>&nbsp;<span class="ident" id="2184364">p</span><span class="op" id="2184365">[</span><span class="num" id="2184366">0</span><span class="op" id="2184367">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184371">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184399">if</span>&nbsp;<span class="ident" id="2184402">c0</span>&nbsp;<span class="op" id="2184405">&lt;</span>&nbsp;<span class="ident" id="2184407">tx</span>&nbsp;<span class="op" id="2184410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184414">return</span>&nbsp;<span class="builtintype" id="2184421">rune</span><span class="op" id="2184425">(</span><span class="ident" id="2184426">c0</span><span class="op" id="2184428">)</span><span class="op" id="2184429">,</span>&nbsp;<span class="num" id="2184431">1</span><span class="op" id="2184432">,</span>&nbsp;<span class="ident" id="2184434">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184445">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184479">if</span>&nbsp;<span class="ident" id="2184482">c0</span>&nbsp;<span class="op" id="2184485">&lt;</span>&nbsp;<span class="ident" id="2184487">t2</span>&nbsp;<span class="op" id="2184490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184494">return</span>&nbsp;<span class="ident" id="2184501">RuneError</span><span class="op" id="2184510">,</span>&nbsp;<span class="num" id="2184512">1</span><span class="op" id="2184513">,</span>&nbsp;<span class="ident" id="2184515">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184526">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184559">if</span>&nbsp;<span class="ident" id="2184562">n</span>&nbsp;<span class="op" id="2184564">&lt;</span>&nbsp;<span class="num" id="2184566">2</span>&nbsp;<span class="op" id="2184568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184572">return</span>&nbsp;<span class="ident" id="2184579">RuneError</span><span class="op" id="2184588">,</span>&nbsp;<span class="num" id="2184590">1</span><span class="op" id="2184591">,</span>&nbsp;<span class="ident" id="2184593">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184602">c1</span>&nbsp;<span class="op" id="2184605">:=</span>&nbsp;<span class="ident" id="2184608">p</span><span class="op" id="2184609">[</span><span class="num" id="2184610">1</span><span class="op" id="2184611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184614">if</span>&nbsp;<span class="ident" id="2184617">c1</span>&nbsp;<span class="op" id="2184620">&lt;</span>&nbsp;<span class="ident" id="2184622">tx</span>&nbsp;<span class="op" id="2184625">||</span>&nbsp;<span class="ident" id="2184628">t2</span>&nbsp;<span class="op" id="2184631">&lt;=</span>&nbsp;<span class="ident" id="2184634">c1</span>&nbsp;<span class="op" id="2184637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184641">return</span>&nbsp;<span class="ident" id="2184648">RuneError</span><span class="op" id="2184657">,</span>&nbsp;<span class="num" id="2184659">1</span><span class="op" id="2184660">,</span>&nbsp;<span class="ident" id="2184662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184669">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184673">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184702">if</span>&nbsp;<span class="ident" id="2184705">c0</span>&nbsp;<span class="op" id="2184708">&lt;</span>&nbsp;<span class="ident" id="2184710">t3</span>&nbsp;<span class="op" id="2184713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184717">r</span>&nbsp;<span class="op" id="2184719">=</span>&nbsp;<span class="builtintype" id="2184721">rune</span><span class="op" id="2184725">(</span><span class="ident" id="2184726">c0</span><span class="op" id="2184728">&amp;</span><span class="ident" id="2184729">mask2</span><span class="op" id="2184734">)</span><span class="op" id="2184735">&lt;&lt;</span><span class="num" id="2184737">6</span>&nbsp;<span class="op" id="2184739">|</span>&nbsp;<span class="builtintype" id="2184741">rune</span><span class="op" id="2184745">(</span><span class="ident" id="2184746">c1</span><span class="op" id="2184748">&amp;</span><span class="ident" id="2184749">maskx</span><span class="op" id="2184754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184758">if</span>&nbsp;<span class="ident" id="2184761">r</span>&nbsp;<span class="op" id="2184763">&lt;=</span>&nbsp;<span class="ident" id="2184766">rune1Max</span>&nbsp;<span class="op" id="2184775">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184780">return</span>&nbsp;<span class="ident" id="2184787">RuneError</span><span class="op" id="2184796">,</span>&nbsp;<span class="num" id="2184798">1</span><span class="op" id="2184799">,</span>&nbsp;<span class="ident" id="2184801">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184813">return</span>&nbsp;<span class="ident" id="2184820">r</span><span class="op" id="2184821">,</span>&nbsp;<span class="num" id="2184823">2</span><span class="op" id="2184824">,</span>&nbsp;<span class="ident" id="2184826">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184837">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184871">if</span>&nbsp;<span class="ident" id="2184874">n</span>&nbsp;<span class="op" id="2184876">&lt;</span>&nbsp;<span class="num" id="2184878">3</span>&nbsp;<span class="op" id="2184880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184884">return</span>&nbsp;<span class="ident" id="2184891">RuneError</span><span class="op" id="2184900">,</span>&nbsp;<span class="num" id="2184902">1</span><span class="op" id="2184903">,</span>&nbsp;<span class="ident" id="2184905">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2184914">c2</span>&nbsp;<span class="op" id="2184917">:=</span>&nbsp;<span class="ident" id="2184920">p</span><span class="op" id="2184921">[</span><span class="num" id="2184922">2</span><span class="op" id="2184923">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184926">if</span>&nbsp;<span class="ident" id="2184929">c2</span>&nbsp;<span class="op" id="2184932">&lt;</span>&nbsp;<span class="ident" id="2184934">tx</span>&nbsp;<span class="op" id="2184937">||</span>&nbsp;<span class="ident" id="2184940">t2</span>&nbsp;<span class="op" id="2184943">&lt;=</span>&nbsp;<span class="ident" id="2184946">c2</span>&nbsp;<span class="op" id="2184949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2184953">return</span>&nbsp;<span class="ident" id="2184960">RuneError</span><span class="op" id="2184969">,</span>&nbsp;<span class="num" id="2184971">1</span><span class="op" id="2184972">,</span>&nbsp;<span class="ident" id="2184974">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2184981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2184985">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185014">if</span>&nbsp;<span class="ident" id="2185017">c0</span>&nbsp;<span class="op" id="2185020">&lt;</span>&nbsp;<span class="ident" id="2185022">t4</span>&nbsp;<span class="op" id="2185025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185029">r</span>&nbsp;<span class="op" id="2185031">=</span>&nbsp;<span class="builtintype" id="2185033">rune</span><span class="op" id="2185037">(</span><span class="ident" id="2185038">c0</span><span class="op" id="2185040">&amp;</span><span class="ident" id="2185041">mask3</span><span class="op" id="2185046">)</span><span class="op" id="2185047">&lt;&lt;</span><span class="num" id="2185049">12</span>&nbsp;<span class="op" id="2185052">|</span>&nbsp;<span class="builtintype" id="2185054">rune</span><span class="op" id="2185058">(</span><span class="ident" id="2185059">c1</span><span class="op" id="2185061">&amp;</span><span class="ident" id="2185062">maskx</span><span class="op" id="2185067">)</span><span class="op" id="2185068">&lt;&lt;</span><span class="num" id="2185070">6</span>&nbsp;<span class="op" id="2185072">|</span>&nbsp;<span class="builtintype" id="2185074">rune</span><span class="op" id="2185078">(</span><span class="ident" id="2185079">c2</span><span class="op" id="2185081">&amp;</span><span class="ident" id="2185082">maskx</span><span class="op" id="2185087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185091">if</span>&nbsp;<span class="ident" id="2185094">r</span>&nbsp;<span class="op" id="2185096">&lt;=</span>&nbsp;<span class="ident" id="2185099">rune2Max</span>&nbsp;<span class="op" id="2185108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185113">return</span>&nbsp;<span class="ident" id="2185120">RuneError</span><span class="op" id="2185129">,</span>&nbsp;<span class="num" id="2185131">1</span><span class="op" id="2185132">,</span>&nbsp;<span class="ident" id="2185134">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185142">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185146">if</span>&nbsp;<span class="ident" id="2185149">surrogateMin</span>&nbsp;<span class="op" id="2185162">&lt;=</span>&nbsp;<span class="ident" id="2185165">r</span>&nbsp;<span class="op" id="2185167">&amp;&amp;</span>&nbsp;<span class="ident" id="2185170">r</span>&nbsp;<span class="op" id="2185172">&lt;=</span>&nbsp;<span class="ident" id="2185175">surrogateMax</span>&nbsp;<span class="op" id="2185188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185193">return</span>&nbsp;<span class="ident" id="2185200">RuneError</span><span class="op" id="2185209">,</span>&nbsp;<span class="num" id="2185211">1</span><span class="op" id="2185212">,</span>&nbsp;<span class="ident" id="2185214">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185226">return</span>&nbsp;<span class="ident" id="2185233">r</span><span class="op" id="2185234">,</span>&nbsp;<span class="num" id="2185236">3</span><span class="op" id="2185237">,</span>&nbsp;<span class="ident" id="2185239">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185246">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185250">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185283">if</span>&nbsp;<span class="ident" id="2185286">n</span>&nbsp;<span class="op" id="2185288">&lt;</span>&nbsp;<span class="num" id="2185290">4</span>&nbsp;<span class="op" id="2185292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185296">return</span>&nbsp;<span class="ident" id="2185303">RuneError</span><span class="op" id="2185312">,</span>&nbsp;<span class="num" id="2185314">1</span><span class="op" id="2185315">,</span>&nbsp;<span class="ident" id="2185317">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185323">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185326">c3</span>&nbsp;<span class="op" id="2185329">:=</span>&nbsp;<span class="ident" id="2185332">p</span><span class="op" id="2185333">[</span><span class="num" id="2185334">3</span><span class="op" id="2185335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185338">if</span>&nbsp;<span class="ident" id="2185341">c3</span>&nbsp;<span class="op" id="2185344">&lt;</span>&nbsp;<span class="ident" id="2185346">tx</span>&nbsp;<span class="op" id="2185349">||</span>&nbsp;<span class="ident" id="2185352">t2</span>&nbsp;<span class="op" id="2185355">&lt;=</span>&nbsp;<span class="ident" id="2185358">c3</span>&nbsp;<span class="op" id="2185361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185365">return</span>&nbsp;<span class="ident" id="2185372">RuneError</span><span class="op" id="2185381">,</span>&nbsp;<span class="num" id="2185383">1</span><span class="op" id="2185384">,</span>&nbsp;<span class="ident" id="2185386">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185397">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185426">if</span>&nbsp;<span class="ident" id="2185429">c0</span>&nbsp;<span class="op" id="2185432">&lt;</span>&nbsp;<span class="ident" id="2185434">t5</span>&nbsp;<span class="op" id="2185437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185441">r</span>&nbsp;<span class="op" id="2185443">=</span>&nbsp;<span class="builtintype" id="2185445">rune</span><span class="op" id="2185449">(</span><span class="ident" id="2185450">c0</span><span class="op" id="2185452">&amp;</span><span class="ident" id="2185453">mask4</span><span class="op" id="2185458">)</span><span class="op" id="2185459">&lt;&lt;</span><span class="num" id="2185461">18</span>&nbsp;<span class="op" id="2185464">|</span>&nbsp;<span class="builtintype" id="2185466">rune</span><span class="op" id="2185470">(</span><span class="ident" id="2185471">c1</span><span class="op" id="2185473">&amp;</span><span class="ident" id="2185474">maskx</span><span class="op" id="2185479">)</span><span class="op" id="2185480">&lt;&lt;</span><span class="num" id="2185482">12</span>&nbsp;<span class="op" id="2185485">|</span>&nbsp;<span class="builtintype" id="2185487">rune</span><span class="op" id="2185491">(</span><span class="ident" id="2185492">c2</span><span class="op" id="2185494">&amp;</span><span class="ident" id="2185495">maskx</span><span class="op" id="2185500">)</span><span class="op" id="2185501">&lt;&lt;</span><span class="num" id="2185503">6</span>&nbsp;<span class="op" id="2185505">|</span>&nbsp;<span class="builtintype" id="2185507">rune</span><span class="op" id="2185511">(</span><span class="ident" id="2185512">c3</span><span class="op" id="2185514">&amp;</span><span class="ident" id="2185515">maskx</span><span class="op" id="2185520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185524">if</span>&nbsp;<span class="ident" id="2185527">r</span>&nbsp;<span class="op" id="2185529">&lt;=</span>&nbsp;<span class="ident" id="2185532">rune3Max</span>&nbsp;<span class="op" id="2185541">||</span>&nbsp;<span class="ident" id="2185544">MaxRune</span>&nbsp;<span class="op" id="2185552">&lt;</span>&nbsp;<span class="ident" id="2185554">r</span>&nbsp;<span class="op" id="2185556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185561">return</span>&nbsp;<span class="ident" id="2185568">RuneError</span><span class="op" id="2185577">,</span>&nbsp;<span class="num" id="2185579">1</span><span class="op" id="2185580">,</span>&nbsp;<span class="ident" id="2185582">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185594">return</span>&nbsp;<span class="ident" id="2185601">r</span><span class="op" id="2185602">,</span>&nbsp;<span class="num" id="2185604">4</span><span class="op" id="2185605">,</span>&nbsp;<span class="ident" id="2185607">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185618">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185628">return</span>&nbsp;<span class="ident" id="2185635">RuneError</span><span class="op" id="2185644">,</span>&nbsp;<span class="num" id="2185646">1</span><span class="op" id="2185647">,</span>&nbsp;<span class="ident" id="2185649">false</span><br>
<span class="lineno"></span><span class="op" id="2185655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2185658">func</span>&nbsp;<span class="ident" id="2185663">decodeRuneInStringInternal</span><span class="op" id="2185689">(</span><span class="ident" id="2185690">s</span>&nbsp;<span class="builtintype" id="2185692">string</span><span class="op" id="2185698">)</span>&nbsp;<span class="op" id="2185700">(</span><span class="ident" id="2185701">r</span>&nbsp;<span class="builtintype" id="2185703">rune</span><span class="op" id="2185707">,</span>&nbsp;<span class="ident" id="2185709">size</span>&nbsp;<span class="builtintype" id="2185714">int</span><span class="op" id="2185717">,</span>&nbsp;<span class="ident" id="2185719">short</span>&nbsp;<span class="builtintype" id="2185725">bool</span><span class="op" id="2185729">)</span>&nbsp;<span class="op" id="2185731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185734">n</span>&nbsp;<span class="op" id="2185736">:=</span>&nbsp;<span class="builtinfunc" id="2185739">len</span><span class="op" id="2185742">(</span><span class="ident" id="2185743">s</span><span class="op" id="2185744">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185747">if</span>&nbsp;<span class="ident" id="2185750">n</span>&nbsp;<span class="op" id="2185752">&lt;</span>&nbsp;<span class="num" id="2185754">1</span>&nbsp;<span class="op" id="2185756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185760">return</span>&nbsp;<span class="ident" id="2185767">RuneError</span><span class="op" id="2185776">,</span>&nbsp;<span class="num" id="2185778">0</span><span class="op" id="2185779">,</span>&nbsp;<span class="ident" id="2185781">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185790">c0</span>&nbsp;<span class="op" id="2185793">:=</span>&nbsp;<span class="ident" id="2185796">s</span><span class="op" id="2185797">[</span><span class="num" id="2185798">0</span><span class="op" id="2185799">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185803">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185831">if</span>&nbsp;<span class="ident" id="2185834">c0</span>&nbsp;<span class="op" id="2185837">&lt;</span>&nbsp;<span class="ident" id="2185839">tx</span>&nbsp;<span class="op" id="2185842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185846">return</span>&nbsp;<span class="builtintype" id="2185853">rune</span><span class="op" id="2185857">(</span><span class="ident" id="2185858">c0</span><span class="op" id="2185860">)</span><span class="op" id="2185861">,</span>&nbsp;<span class="num" id="2185863">1</span><span class="op" id="2185864">,</span>&nbsp;<span class="ident" id="2185866">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185877">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185911">if</span>&nbsp;<span class="ident" id="2185914">c0</span>&nbsp;<span class="op" id="2185917">&lt;</span>&nbsp;<span class="ident" id="2185919">t2</span>&nbsp;<span class="op" id="2185922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185926">return</span>&nbsp;<span class="ident" id="2185933">RuneError</span><span class="op" id="2185942">,</span>&nbsp;<span class="num" id="2185944">1</span><span class="op" id="2185945">,</span>&nbsp;<span class="ident" id="2185947">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2185954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2185958">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2185991">if</span>&nbsp;<span class="ident" id="2185994">n</span>&nbsp;<span class="op" id="2185996">&lt;</span>&nbsp;<span class="num" id="2185998">2</span>&nbsp;<span class="op" id="2186000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186004">return</span>&nbsp;<span class="ident" id="2186011">RuneError</span><span class="op" id="2186020">,</span>&nbsp;<span class="num" id="2186022">1</span><span class="op" id="2186023">,</span>&nbsp;<span class="ident" id="2186025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186034">c1</span>&nbsp;<span class="op" id="2186037">:=</span>&nbsp;<span class="ident" id="2186040">s</span><span class="op" id="2186041">[</span><span class="num" id="2186042">1</span><span class="op" id="2186043">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186046">if</span>&nbsp;<span class="ident" id="2186049">c1</span>&nbsp;<span class="op" id="2186052">&lt;</span>&nbsp;<span class="ident" id="2186054">tx</span>&nbsp;<span class="op" id="2186057">||</span>&nbsp;<span class="ident" id="2186060">t2</span>&nbsp;<span class="op" id="2186063">&lt;=</span>&nbsp;<span class="ident" id="2186066">c1</span>&nbsp;<span class="op" id="2186069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186073">return</span>&nbsp;<span class="ident" id="2186080">RuneError</span><span class="op" id="2186089">,</span>&nbsp;<span class="num" id="2186091">1</span><span class="op" id="2186092">,</span>&nbsp;<span class="ident" id="2186094">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186105">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186134">if</span>&nbsp;<span class="ident" id="2186137">c0</span>&nbsp;<span class="op" id="2186140">&lt;</span>&nbsp;<span class="ident" id="2186142">t3</span>&nbsp;<span class="op" id="2186145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186149">r</span>&nbsp;<span class="op" id="2186151">=</span>&nbsp;<span class="builtintype" id="2186153">rune</span><span class="op" id="2186157">(</span><span class="ident" id="2186158">c0</span><span class="op" id="2186160">&amp;</span><span class="ident" id="2186161">mask2</span><span class="op" id="2186166">)</span><span class="op" id="2186167">&lt;&lt;</span><span class="num" id="2186169">6</span>&nbsp;<span class="op" id="2186171">|</span>&nbsp;<span class="builtintype" id="2186173">rune</span><span class="op" id="2186177">(</span><span class="ident" id="2186178">c1</span><span class="op" id="2186180">&amp;</span><span class="ident" id="2186181">maskx</span><span class="op" id="2186186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186190">if</span>&nbsp;<span class="ident" id="2186193">r</span>&nbsp;<span class="op" id="2186195">&lt;=</span>&nbsp;<span class="ident" id="2186198">rune1Max</span>&nbsp;<span class="op" id="2186207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186212">return</span>&nbsp;<span class="ident" id="2186219">RuneError</span><span class="op" id="2186228">,</span>&nbsp;<span class="num" id="2186230">1</span><span class="op" id="2186231">,</span>&nbsp;<span class="ident" id="2186233">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186241">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186245">return</span>&nbsp;<span class="ident" id="2186252">r</span><span class="op" id="2186253">,</span>&nbsp;<span class="num" id="2186255">2</span><span class="op" id="2186256">,</span>&nbsp;<span class="ident" id="2186258">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186269">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186303">if</span>&nbsp;<span class="ident" id="2186306">n</span>&nbsp;<span class="op" id="2186308">&lt;</span>&nbsp;<span class="num" id="2186310">3</span>&nbsp;<span class="op" id="2186312">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186316">return</span>&nbsp;<span class="ident" id="2186323">RuneError</span><span class="op" id="2186332">,</span>&nbsp;<span class="num" id="2186334">1</span><span class="op" id="2186335">,</span>&nbsp;<span class="ident" id="2186337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186346">c2</span>&nbsp;<span class="op" id="2186349">:=</span>&nbsp;<span class="ident" id="2186352">s</span><span class="op" id="2186353">[</span><span class="num" id="2186354">2</span><span class="op" id="2186355">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186358">if</span>&nbsp;<span class="ident" id="2186361">c2</span>&nbsp;<span class="op" id="2186364">&lt;</span>&nbsp;<span class="ident" id="2186366">tx</span>&nbsp;<span class="op" id="2186369">||</span>&nbsp;<span class="ident" id="2186372">t2</span>&nbsp;<span class="op" id="2186375">&lt;=</span>&nbsp;<span class="ident" id="2186378">c2</span>&nbsp;<span class="op" id="2186381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186385">return</span>&nbsp;<span class="ident" id="2186392">RuneError</span><span class="op" id="2186401">,</span>&nbsp;<span class="num" id="2186403">1</span><span class="op" id="2186404">,</span>&nbsp;<span class="ident" id="2186406">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186417">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186446">if</span>&nbsp;<span class="ident" id="2186449">c0</span>&nbsp;<span class="op" id="2186452">&lt;</span>&nbsp;<span class="ident" id="2186454">t4</span>&nbsp;<span class="op" id="2186457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186461">r</span>&nbsp;<span class="op" id="2186463">=</span>&nbsp;<span class="builtintype" id="2186465">rune</span><span class="op" id="2186469">(</span><span class="ident" id="2186470">c0</span><span class="op" id="2186472">&amp;</span><span class="ident" id="2186473">mask3</span><span class="op" id="2186478">)</span><span class="op" id="2186479">&lt;&lt;</span><span class="num" id="2186481">12</span>&nbsp;<span class="op" id="2186484">|</span>&nbsp;<span class="builtintype" id="2186486">rune</span><span class="op" id="2186490">(</span><span class="ident" id="2186491">c1</span><span class="op" id="2186493">&amp;</span><span class="ident" id="2186494">maskx</span><span class="op" id="2186499">)</span><span class="op" id="2186500">&lt;&lt;</span><span class="num" id="2186502">6</span>&nbsp;<span class="op" id="2186504">|</span>&nbsp;<span class="builtintype" id="2186506">rune</span><span class="op" id="2186510">(</span><span class="ident" id="2186511">c2</span><span class="op" id="2186513">&amp;</span><span class="ident" id="2186514">maskx</span><span class="op" id="2186519">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186523">if</span>&nbsp;<span class="ident" id="2186526">r</span>&nbsp;<span class="op" id="2186528">&lt;=</span>&nbsp;<span class="ident" id="2186531">rune2Max</span>&nbsp;<span class="op" id="2186540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186545">return</span>&nbsp;<span class="ident" id="2186552">RuneError</span><span class="op" id="2186561">,</span>&nbsp;<span class="num" id="2186563">1</span><span class="op" id="2186564">,</span>&nbsp;<span class="ident" id="2186566">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186578">if</span>&nbsp;<span class="ident" id="2186581">surrogateMin</span>&nbsp;<span class="op" id="2186594">&lt;=</span>&nbsp;<span class="ident" id="2186597">r</span>&nbsp;<span class="op" id="2186599">&amp;&amp;</span>&nbsp;<span class="ident" id="2186602">r</span>&nbsp;<span class="op" id="2186604">&lt;=</span>&nbsp;<span class="ident" id="2186607">surrogateMax</span>&nbsp;<span class="op" id="2186620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186625">return</span>&nbsp;<span class="ident" id="2186632">RuneError</span><span class="op" id="2186641">,</span>&nbsp;<span class="num" id="2186643">1</span><span class="op" id="2186644">,</span>&nbsp;<span class="ident" id="2186646">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186658">return</span>&nbsp;<span class="ident" id="2186665">r</span><span class="op" id="2186666">,</span>&nbsp;<span class="num" id="2186668">3</span><span class="op" id="2186669">,</span>&nbsp;<span class="ident" id="2186671">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186682">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186715">if</span>&nbsp;<span class="ident" id="2186718">n</span>&nbsp;<span class="op" id="2186720">&lt;</span>&nbsp;<span class="num" id="2186722">4</span>&nbsp;<span class="op" id="2186724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186728">return</span>&nbsp;<span class="ident" id="2186735">RuneError</span><span class="op" id="2186744">,</span>&nbsp;<span class="num" id="2186746">1</span><span class="op" id="2186747">,</span>&nbsp;<span class="ident" id="2186749">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186758">c3</span>&nbsp;<span class="op" id="2186761">:=</span>&nbsp;<span class="ident" id="2186764">s</span><span class="op" id="2186765">[</span><span class="num" id="2186766">3</span><span class="op" id="2186767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186770">if</span>&nbsp;<span class="ident" id="2186773">c3</span>&nbsp;<span class="op" id="2186776">&lt;</span>&nbsp;<span class="ident" id="2186778">tx</span>&nbsp;<span class="op" id="2186781">||</span>&nbsp;<span class="ident" id="2186784">t2</span>&nbsp;<span class="op" id="2186787">&lt;=</span>&nbsp;<span class="ident" id="2186790">c3</span>&nbsp;<span class="op" id="2186793">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186797">return</span>&nbsp;<span class="ident" id="2186804">RuneError</span><span class="op" id="2186813">,</span>&nbsp;<span class="num" id="2186815">1</span><span class="op" id="2186816">,</span>&nbsp;<span class="ident" id="2186818">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186829">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186858">if</span>&nbsp;<span class="ident" id="2186861">c0</span>&nbsp;<span class="op" id="2186864">&lt;</span>&nbsp;<span class="ident" id="2186866">t5</span>&nbsp;<span class="op" id="2186869">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186873">r</span>&nbsp;<span class="op" id="2186875">=</span>&nbsp;<span class="builtintype" id="2186877">rune</span><span class="op" id="2186881">(</span><span class="ident" id="2186882">c0</span><span class="op" id="2186884">&amp;</span><span class="ident" id="2186885">mask4</span><span class="op" id="2186890">)</span><span class="op" id="2186891">&lt;&lt;</span><span class="num" id="2186893">18</span>&nbsp;<span class="op" id="2186896">|</span>&nbsp;<span class="builtintype" id="2186898">rune</span><span class="op" id="2186902">(</span><span class="ident" id="2186903">c1</span><span class="op" id="2186905">&amp;</span><span class="ident" id="2186906">maskx</span><span class="op" id="2186911">)</span><span class="op" id="2186912">&lt;&lt;</span><span class="num" id="2186914">12</span>&nbsp;<span class="op" id="2186917">|</span>&nbsp;<span class="builtintype" id="2186919">rune</span><span class="op" id="2186923">(</span><span class="ident" id="2186924">c2</span><span class="op" id="2186926">&amp;</span><span class="ident" id="2186927">maskx</span><span class="op" id="2186932">)</span><span class="op" id="2186933">&lt;&lt;</span><span class="num" id="2186935">6</span>&nbsp;<span class="op" id="2186937">|</span>&nbsp;<span class="builtintype" id="2186939">rune</span><span class="op" id="2186943">(</span><span class="ident" id="2186944">c3</span><span class="op" id="2186946">&amp;</span><span class="ident" id="2186947">maskx</span><span class="op" id="2186952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186956">if</span>&nbsp;<span class="ident" id="2186959">r</span>&nbsp;<span class="op" id="2186961">&lt;=</span>&nbsp;<span class="ident" id="2186964">rune3Max</span>&nbsp;<span class="op" id="2186973">||</span>&nbsp;<span class="ident" id="2186976">MaxRune</span>&nbsp;<span class="op" id="2186984">&lt;</span>&nbsp;<span class="ident" id="2186986">r</span>&nbsp;<span class="op" id="2186988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186993">return</span>&nbsp;<span class="ident" id="2187000">RuneError</span><span class="op" id="2187009">,</span>&nbsp;<span class="num" id="2187011">1</span><span class="op" id="2187012">,</span>&nbsp;<span class="ident" id="2187014">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187026">return</span>&nbsp;<span class="ident" id="2187033">r</span><span class="op" id="2187034">,</span>&nbsp;<span class="num" id="2187036">4</span><span class="op" id="2187037">,</span>&nbsp;<span class="ident" id="2187039">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2187050">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187060">return</span>&nbsp;<span class="ident" id="2187067">RuneError</span><span class="op" id="2187076">,</span>&nbsp;<span class="num" id="2187078">1</span><span class="op" id="2187079">,</span>&nbsp;<span class="ident" id="2187081">false</span><br>
<span class="lineno"></span><span class="op" id="2187087">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="2187090">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2187177">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="2187273">func</span>&nbsp;<span class="ident" id="2187278">FullRune</span><span class="op" id="2187286">(</span><span class="ident" id="2187287">p</span>&nbsp;<span class="op" id="2187289">[</span><span class="op" id="2187290">]</span><span class="builtintype" id="2187291">byte</span><span class="op" id="2187295">)</span>&nbsp;<span class="builtintype" id="2187297">bool</span>&nbsp;<span class="op" id="2187302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187305">_</span><span class="op" id="2187306">,</span>&nbsp;<span class="ident" id="2187308">_</span><span class="op" id="2187309">,</span>&nbsp;<span class="ident" id="2187311">short</span>&nbsp;<span class="op" id="2187317">:=</span>&nbsp;<span class="ident" id="2187320">decodeRuneInternal</span><span class="op" id="2187338">(</span><span class="ident" id="2187339">p</span><span class="op" id="2187340">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187343">return</span>&nbsp;<span class="op" id="2187350">!</span><span class="ident" id="2187351">short</span><br>
<span class="lineno"></span><span class="op" id="2187357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187360">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2187424">func</span>&nbsp;<span class="ident" id="2187429">FullRuneInString</span><span class="op" id="2187445">(</span><span class="ident" id="2187446">s</span>&nbsp;<span class="builtintype" id="2187448">string</span><span class="op" id="2187454">)</span>&nbsp;<span class="builtintype" id="2187456">bool</span>&nbsp;<span class="op" id="2187461">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187464">_</span><span class="op" id="2187465">,</span>&nbsp;<span class="ident" id="2187467">_</span><span class="op" id="2187468">,</span>&nbsp;<span class="ident" id="2187470">short</span>&nbsp;<span class="op" id="2187476">:=</span>&nbsp;<span class="ident" id="2187479">decodeRuneInStringInternal</span><span class="op" id="2187505">(</span><span class="ident" id="2187506">s</span><span class="op" id="2187507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187510">return</span>&nbsp;<span class="op" id="2187517">!</span><span class="ident" id="2187518">short</span><br>
<span class="lineno"></span><span class="op" id="2187524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187527">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="2187604">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2187682">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="2187757">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="2187787">//</span><br>
<span class="lineno"></span><span class="comment" id="2187790">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="2187865">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2187937">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2187981">func</span>&nbsp;<span class="ident" id="2187986">DecodeRune</span><span class="op" id="2187996">(</span><span class="ident" id="2187997">p</span>&nbsp;<span class="op" id="2187999">[</span><span class="op" id="2188000">]</span><span class="builtintype" id="2188001">byte</span><span class="op" id="2188005">)</span>&nbsp;<span class="op" id="2188007">(</span><span class="ident" id="2188008">r</span>&nbsp;<span class="builtintype" id="2188010">rune</span><span class="op" id="2188014">,</span>&nbsp;<span class="ident" id="2188016">size</span>&nbsp;<span class="builtintype" id="2188021">int</span><span class="op" id="2188024">)</span>&nbsp;<span class="op" id="2188026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188029">r</span><span class="op" id="2188030">,</span>&nbsp;<span class="ident" id="2188032">size</span><span class="op" id="2188036">,</span>&nbsp;<span class="ident" id="2188038">_</span>&nbsp;<span class="op" id="2188040">=</span>&nbsp;<span class="ident" id="2188042">decodeRuneInternal</span><span class="op" id="2188060">(</span><span class="ident" id="2188061">p</span><span class="op" id="2188062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188065">return</span><br>
<span class="lineno">225</span><span class="op" id="2188072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2188075">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2188151">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2188229">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="2188303">//</span><br>
<span class="lineno"></span><span class="comment" id="2188306">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2188381">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2188453">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2188497">func</span>&nbsp;<span class="ident" id="2188502">DecodeRuneInString</span><span class="op" id="2188520">(</span><span class="ident" id="2188521">s</span>&nbsp;<span class="builtintype" id="2188523">string</span><span class="op" id="2188529">)</span>&nbsp;<span class="op" id="2188531">(</span><span class="ident" id="2188532">r</span>&nbsp;<span class="builtintype" id="2188534">rune</span><span class="op" id="2188538">,</span>&nbsp;<span class="ident" id="2188540">size</span>&nbsp;<span class="builtintype" id="2188545">int</span><span class="op" id="2188548">)</span>&nbsp;<span class="op" id="2188550">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188553">r</span><span class="op" id="2188554">,</span>&nbsp;<span class="ident" id="2188556">size</span><span class="op" id="2188560">,</span>&nbsp;<span class="ident" id="2188562">_</span>&nbsp;<span class="op" id="2188564">=</span>&nbsp;<span class="ident" id="2188566">decodeRuneInStringInternal</span><span class="op" id="2188592">(</span><span class="ident" id="2188593">s</span><span class="op" id="2188594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188597">return</span><br>
<span class="lineno"></span><span class="op" id="2188604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2188607">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="2188687">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2188765">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="2188840">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="2188870">//</span><br>
<span class="lineno"></span><span class="comment" id="2188873">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="2188948">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2189020">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2189064">func</span>&nbsp;<span class="ident" id="2189069">DecodeLastRune</span><span class="op" id="2189083">(</span><span class="ident" id="2189084">p</span>&nbsp;<span class="op" id="2189086">[</span><span class="op" id="2189087">]</span><span class="builtintype" id="2189088">byte</span><span class="op" id="2189092">)</span>&nbsp;<span class="op" id="2189094">(</span><span class="ident" id="2189095">r</span>&nbsp;<span class="builtintype" id="2189097">rune</span><span class="op" id="2189101">,</span>&nbsp;<span class="ident" id="2189103">size</span>&nbsp;<span class="builtintype" id="2189108">int</span><span class="op" id="2189111">)</span>&nbsp;<span class="op" id="2189113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189116">end</span>&nbsp;<span class="op" id="2189120">:=</span>&nbsp;<span class="builtinfunc" id="2189123">len</span><span class="op" id="2189126">(</span><span class="ident" id="2189127">p</span><span class="op" id="2189128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189131">if</span>&nbsp;<span class="ident" id="2189134">end</span>&nbsp;<span class="op" id="2189138">==</span>&nbsp;<span class="num" id="2189141">0</span>&nbsp;<span class="op" id="2189143">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189147">return</span>&nbsp;<span class="ident" id="2189154">RuneError</span><span class="op" id="2189163">,</span>&nbsp;<span class="num" id="2189165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189171">start</span>&nbsp;<span class="op" id="2189177">:=</span>&nbsp;<span class="ident" id="2189180">end</span>&nbsp;<span class="op" id="2189184">-</span>&nbsp;<span class="num" id="2189186">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189189">r</span>&nbsp;<span class="op" id="2189191">=</span>&nbsp;<span class="builtintype" id="2189193">rune</span><span class="op" id="2189197">(</span><span class="ident" id="2189198">p</span><span class="op" id="2189199">[</span><span class="ident" id="2189200">start</span><span class="op" id="2189205">]</span><span class="op" id="2189206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189209">if</span>&nbsp;<span class="ident" id="2189212">r</span>&nbsp;<span class="op" id="2189214">&lt;</span>&nbsp;<span class="ident" id="2189216">RuneSelf</span>&nbsp;<span class="op" id="2189225">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189229">return</span>&nbsp;<span class="ident" id="2189236">r</span><span class="op" id="2189237">,</span>&nbsp;<span class="num" id="2189239">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2189245">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2189295">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2189348">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189367">lim</span>&nbsp;<span class="op" id="2189371">:=</span>&nbsp;<span class="ident" id="2189374">end</span>&nbsp;<span class="op" id="2189378">-</span>&nbsp;<span class="ident" id="2189380">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189388">if</span>&nbsp;<span class="ident" id="2189391">lim</span>&nbsp;<span class="op" id="2189395">&lt;</span>&nbsp;<span class="num" id="2189397">0</span>&nbsp;<span class="op" id="2189399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189403">lim</span>&nbsp;<span class="op" id="2189407">=</span>&nbsp;<span class="num" id="2189409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189415">for</span>&nbsp;<span class="ident" id="2189419">start</span><span class="op" id="2189424">--</span><span class="op" id="2189426">;</span>&nbsp;<span class="ident" id="2189428">start</span>&nbsp;<span class="op" id="2189434">&gt;=</span>&nbsp;<span class="ident" id="2189437">lim</span><span class="op" id="2189440">;</span>&nbsp;<span class="ident" id="2189442">start</span><span class="op" id="2189447">--</span>&nbsp;<span class="op" id="2189450">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189454">if</span>&nbsp;<span class="ident" id="2189457">RuneStart</span><span class="op" id="2189466">(</span><span class="ident" id="2189467">p</span><span class="op" id="2189468">[</span><span class="ident" id="2189469">start</span><span class="op" id="2189474">]</span><span class="op" id="2189475">)</span>&nbsp;<span class="op" id="2189477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189496">if</span>&nbsp;<span class="ident" id="2189499">start</span>&nbsp;<span class="op" id="2189505">&lt;</span>&nbsp;<span class="num" id="2189507">0</span>&nbsp;<span class="op" id="2189509">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189513">start</span>&nbsp;<span class="op" id="2189519">=</span>&nbsp;<span class="num" id="2189521">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189527">r</span><span class="op" id="2189528">,</span>&nbsp;<span class="ident" id="2189530">size</span>&nbsp;<span class="op" id="2189535">=</span>&nbsp;<span class="ident" id="2189537">DecodeRune</span><span class="op" id="2189547">(</span><span class="ident" id="2189548">p</span><span class="op" id="2189549">[</span><span class="ident" id="2189550">start</span><span class="op" id="2189555">:</span><span class="ident" id="2189556">end</span><span class="op" id="2189559">]</span><span class="op" id="2189560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189563">if</span>&nbsp;<span class="ident" id="2189566">start</span><span class="op" id="2189571">+</span><span class="ident" id="2189572">size</span>&nbsp;<span class="op" id="2189577">!=</span>&nbsp;<span class="ident" id="2189580">end</span>&nbsp;<span class="op" id="2189584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189588">return</span>&nbsp;<span class="ident" id="2189595">RuneError</span><span class="op" id="2189604">,</span>&nbsp;<span class="num" id="2189606">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189612">return</span>&nbsp;<span class="ident" id="2189619">r</span><span class="op" id="2189620">,</span>&nbsp;<span class="ident" id="2189622">size</span><br>
<span class="lineno"></span><span class="op" id="2189627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2189630">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="2189709">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="2189789">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="2189866">//</span><br>
<span class="lineno"></span><span class="comment" id="2189869">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2189944">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="2190016">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2190060">func</span>&nbsp;<span class="ident" id="2190065">DecodeLastRuneInString</span><span class="op" id="2190087">(</span><span class="ident" id="2190088">s</span>&nbsp;<span class="builtintype" id="2190090">string</span><span class="op" id="2190096">)</span>&nbsp;<span class="op" id="2190098">(</span><span class="ident" id="2190099">r</span>&nbsp;<span class="builtintype" id="2190101">rune</span><span class="op" id="2190105">,</span>&nbsp;<span class="ident" id="2190107">size</span>&nbsp;<span class="builtintype" id="2190112">int</span><span class="op" id="2190115">)</span>&nbsp;<span class="op" id="2190117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190120">end</span>&nbsp;<span class="op" id="2190124">:=</span>&nbsp;<span class="builtinfunc" id="2190127">len</span><span class="op" id="2190130">(</span><span class="ident" id="2190131">s</span><span class="op" id="2190132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190135">if</span>&nbsp;<span class="ident" id="2190138">end</span>&nbsp;<span class="op" id="2190142">==</span>&nbsp;<span class="num" id="2190145">0</span>&nbsp;<span class="op" id="2190147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190151">return</span>&nbsp;<span class="ident" id="2190158">RuneError</span><span class="op" id="2190167">,</span>&nbsp;<span class="num" id="2190169">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190175">start</span>&nbsp;<span class="op" id="2190181">:=</span>&nbsp;<span class="ident" id="2190184">end</span>&nbsp;<span class="op" id="2190188">-</span>&nbsp;<span class="num" id="2190190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190193">r</span>&nbsp;<span class="op" id="2190195">=</span>&nbsp;<span class="builtintype" id="2190197">rune</span><span class="op" id="2190201">(</span><span class="ident" id="2190202">s</span><span class="op" id="2190203">[</span><span class="ident" id="2190204">start</span><span class="op" id="2190209">]</span><span class="op" id="2190210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190213">if</span>&nbsp;<span class="ident" id="2190216">r</span>&nbsp;<span class="op" id="2190218">&lt;</span>&nbsp;<span class="ident" id="2190220">RuneSelf</span>&nbsp;<span class="op" id="2190229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190233">return</span>&nbsp;<span class="ident" id="2190240">r</span><span class="op" id="2190241">,</span>&nbsp;<span class="num" id="2190243">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190249">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190299">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190352">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190371">lim</span>&nbsp;<span class="op" id="2190375">:=</span>&nbsp;<span class="ident" id="2190378">end</span>&nbsp;<span class="op" id="2190382">-</span>&nbsp;<span class="ident" id="2190384">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190392">if</span>&nbsp;<span class="ident" id="2190395">lim</span>&nbsp;<span class="op" id="2190399">&lt;</span>&nbsp;<span class="num" id="2190401">0</span>&nbsp;<span class="op" id="2190403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190407">lim</span>&nbsp;<span class="op" id="2190411">=</span>&nbsp;<span class="num" id="2190413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190419">for</span>&nbsp;<span class="ident" id="2190423">start</span><span class="op" id="2190428">--</span><span class="op" id="2190430">;</span>&nbsp;<span class="ident" id="2190432">start</span>&nbsp;<span class="op" id="2190438">&gt;=</span>&nbsp;<span class="ident" id="2190441">lim</span><span class="op" id="2190444">;</span>&nbsp;<span class="ident" id="2190446">start</span><span class="op" id="2190451">--</span>&nbsp;<span class="op" id="2190454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190458">if</span>&nbsp;<span class="ident" id="2190461">RuneStart</span><span class="op" id="2190470">(</span><span class="ident" id="2190471">s</span><span class="op" id="2190472">[</span><span class="ident" id="2190473">start</span><span class="op" id="2190478">]</span><span class="op" id="2190479">)</span>&nbsp;<span class="op" id="2190481">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190500">if</span>&nbsp;<span class="ident" id="2190503">start</span>&nbsp;<span class="op" id="2190509">&lt;</span>&nbsp;<span class="num" id="2190511">0</span>&nbsp;<span class="op" id="2190513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190517">start</span>&nbsp;<span class="op" id="2190523">=</span>&nbsp;<span class="num" id="2190525">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190531">r</span><span class="op" id="2190532">,</span>&nbsp;<span class="ident" id="2190534">size</span>&nbsp;<span class="op" id="2190539">=</span>&nbsp;<span class="ident" id="2190541">DecodeRuneInString</span><span class="op" id="2190559">(</span><span class="ident" id="2190560">s</span><span class="op" id="2190561">[</span><span class="ident" id="2190562">start</span><span class="op" id="2190567">:</span><span class="ident" id="2190568">end</span><span class="op" id="2190571">]</span><span class="op" id="2190572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190575">if</span>&nbsp;<span class="ident" id="2190578">start</span><span class="op" id="2190583">+</span><span class="ident" id="2190584">size</span>&nbsp;<span class="op" id="2190589">!=</span>&nbsp;<span class="ident" id="2190592">end</span>&nbsp;<span class="op" id="2190596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190600">return</span>&nbsp;<span class="ident" id="2190607">RuneError</span><span class="op" id="2190616">,</span>&nbsp;<span class="num" id="2190618">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190621">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190624">return</span>&nbsp;<span class="ident" id="2190631">r</span><span class="op" id="2190632">,</span>&nbsp;<span class="ident" id="2190634">size</span><br>
<span class="lineno"></span><span class="op" id="2190639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2190642">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2190710">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="2190780">func</span>&nbsp;<span class="ident" id="2190785">RuneLen</span><span class="op" id="2190792">(</span><span class="ident" id="2190793">r</span>&nbsp;<span class="builtintype" id="2190795">rune</span><span class="op" id="2190799">)</span>&nbsp;<span class="builtintype" id="2190801">int</span>&nbsp;<span class="op" id="2190805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190808">switch</span>&nbsp;<span class="op" id="2190815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190818">case</span>&nbsp;<span class="ident" id="2190823">r</span>&nbsp;<span class="op" id="2190825">&lt;</span>&nbsp;<span class="num" id="2190827">0</span><span class="op" id="2190828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190832">return</span>&nbsp;<span class="op" id="2190839">-</span><span class="num" id="2190840">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190843">case</span>&nbsp;<span class="ident" id="2190848">r</span>&nbsp;<span class="op" id="2190850">&lt;=</span>&nbsp;<span class="ident" id="2190853">rune1Max</span><span class="op" id="2190861">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190865">return</span>&nbsp;<span class="num" id="2190872">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190875">case</span>&nbsp;<span class="ident" id="2190880">r</span>&nbsp;<span class="op" id="2190882">&lt;=</span>&nbsp;<span class="ident" id="2190885">rune2Max</span><span class="op" id="2190893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190897">return</span>&nbsp;<span class="num" id="2190904">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190907">case</span>&nbsp;<span class="ident" id="2190912">surrogateMin</span>&nbsp;<span class="op" id="2190925">&lt;=</span>&nbsp;<span class="ident" id="2190928">r</span>&nbsp;<span class="op" id="2190930">&amp;&amp;</span>&nbsp;<span class="ident" id="2190933">r</span>&nbsp;<span class="op" id="2190935">&lt;=</span>&nbsp;<span class="ident" id="2190938">surrogateMax</span><span class="op" id="2190950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190954">return</span>&nbsp;<span class="op" id="2190961">-</span><span class="num" id="2190962">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190965">case</span>&nbsp;<span class="ident" id="2190970">r</span>&nbsp;<span class="op" id="2190972">&lt;=</span>&nbsp;<span class="ident" id="2190975">rune3Max</span><span class="op" id="2190983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190987">return</span>&nbsp;<span class="num" id="2190994">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190997">case</span>&nbsp;<span class="ident" id="2191002">r</span>&nbsp;<span class="op" id="2191004">&lt;=</span>&nbsp;<span class="ident" id="2191007">MaxRune</span><span class="op" id="2191014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191018">return</span>&nbsp;<span class="num" id="2191025">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191028">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191031">return</span>&nbsp;<span class="op" id="2191038">-</span><span class="num" id="2191039">1</span><br>
<span class="lineno"></span><span class="op" id="2191041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2191044">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2191133">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="2191176">func</span>&nbsp;<span class="ident" id="2191181">EncodeRune</span><span class="op" id="2191191">(</span><span class="ident" id="2191192">p</span>&nbsp;<span class="op" id="2191194">[</span><span class="op" id="2191195">]</span><span class="builtintype" id="2191196">byte</span><span class="op" id="2191200">,</span>&nbsp;<span class="ident" id="2191202">r</span>&nbsp;<span class="builtintype" id="2191204">rune</span><span class="op" id="2191208">)</span>&nbsp;<span class="builtintype" id="2191210">int</span>&nbsp;<span class="op" id="2191214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2191217">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191295">switch</span>&nbsp;<span class="ident" id="2191302">i</span>&nbsp;<span class="op" id="2191304">:=</span>&nbsp;<span class="builtintype" id="2191307">uint32</span><span class="op" id="2191313">(</span><span class="ident" id="2191314">r</span><span class="op" id="2191315">)</span><span class="op" id="2191316">;</span>&nbsp;<span class="op" id="2191318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191321">case</span>&nbsp;<span class="ident" id="2191326">i</span>&nbsp;<span class="op" id="2191328">&lt;=</span>&nbsp;<span class="ident" id="2191331">rune1Max</span><span class="op" id="2191339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191343">p</span><span class="op" id="2191344">[</span><span class="num" id="2191345">0</span><span class="op" id="2191346">]</span>&nbsp;<span class="op" id="2191348">=</span>&nbsp;<span class="builtintype" id="2191350">byte</span><span class="op" id="2191354">(</span><span class="ident" id="2191355">r</span><span class="op" id="2191356">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191360">return</span>&nbsp;<span class="num" id="2191367">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191370">case</span>&nbsp;<span class="ident" id="2191375">i</span>&nbsp;<span class="op" id="2191377">&lt;=</span>&nbsp;<span class="ident" id="2191380">rune2Max</span><span class="op" id="2191388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191392">p</span><span class="op" id="2191393">[</span><span class="num" id="2191394">0</span><span class="op" id="2191395">]</span>&nbsp;<span class="op" id="2191397">=</span>&nbsp;<span class="ident" id="2191399">t2</span>&nbsp;<span class="op" id="2191402">|</span>&nbsp;<span class="builtintype" id="2191404">byte</span><span class="op" id="2191408">(</span><span class="ident" id="2191409">r</span><span class="op" id="2191410">&gt;&gt;</span><span class="num" id="2191412">6</span><span class="op" id="2191413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191417">p</span><span class="op" id="2191418">[</span><span class="num" id="2191419">1</span><span class="op" id="2191420">]</span>&nbsp;<span class="op" id="2191422">=</span>&nbsp;<span class="ident" id="2191424">tx</span>&nbsp;<span class="op" id="2191427">|</span>&nbsp;<span class="builtintype" id="2191429">byte</span><span class="op" id="2191433">(</span><span class="ident" id="2191434">r</span><span class="op" id="2191435">)</span><span class="op" id="2191436">&amp;</span><span class="ident" id="2191437">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191445">return</span>&nbsp;<span class="num" id="2191452">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191455">case</span>&nbsp;<span class="ident" id="2191460">i</span>&nbsp;<span class="op" id="2191462">&gt;</span>&nbsp;<span class="ident" id="2191464">MaxRune</span><span class="op" id="2191471">,</span>&nbsp;<span class="ident" id="2191473">surrogateMin</span>&nbsp;<span class="op" id="2191486">&lt;=</span>&nbsp;<span class="ident" id="2191489">i</span>&nbsp;<span class="op" id="2191491">&amp;&amp;</span>&nbsp;<span class="ident" id="2191494">i</span>&nbsp;<span class="op" id="2191496">&lt;=</span>&nbsp;<span class="ident" id="2191499">surrogateMax</span><span class="op" id="2191511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191515">r</span>&nbsp;<span class="op" id="2191517">=</span>&nbsp;<span class="ident" id="2191519">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191531">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191544">case</span>&nbsp;<span class="ident" id="2191549">i</span>&nbsp;<span class="op" id="2191551">&lt;=</span>&nbsp;<span class="ident" id="2191554">rune3Max</span><span class="op" id="2191562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191566">p</span><span class="op" id="2191567">[</span><span class="num" id="2191568">0</span><span class="op" id="2191569">]</span>&nbsp;<span class="op" id="2191571">=</span>&nbsp;<span class="ident" id="2191573">t3</span>&nbsp;<span class="op" id="2191576">|</span>&nbsp;<span class="builtintype" id="2191578">byte</span><span class="op" id="2191582">(</span><span class="ident" id="2191583">r</span><span class="op" id="2191584">&gt;&gt;</span><span class="num" id="2191586">12</span><span class="op" id="2191588">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191592">p</span><span class="op" id="2191593">[</span><span class="num" id="2191594">1</span><span class="op" id="2191595">]</span>&nbsp;<span class="op" id="2191597">=</span>&nbsp;<span class="ident" id="2191599">tx</span>&nbsp;<span class="op" id="2191602">|</span>&nbsp;<span class="builtintype" id="2191604">byte</span><span class="op" id="2191608">(</span><span class="ident" id="2191609">r</span><span class="op" id="2191610">&gt;&gt;</span><span class="num" id="2191612">6</span><span class="op" id="2191613">)</span><span class="op" id="2191614">&amp;</span><span class="ident" id="2191615">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191623">p</span><span class="op" id="2191624">[</span><span class="num" id="2191625">2</span><span class="op" id="2191626">]</span>&nbsp;<span class="op" id="2191628">=</span>&nbsp;<span class="ident" id="2191630">tx</span>&nbsp;<span class="op" id="2191633">|</span>&nbsp;<span class="builtintype" id="2191635">byte</span><span class="op" id="2191639">(</span><span class="ident" id="2191640">r</span><span class="op" id="2191641">)</span><span class="op" id="2191642">&amp;</span><span class="ident" id="2191643">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191651">return</span>&nbsp;<span class="num" id="2191658">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191661">default</span><span class="op" id="2191668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191672">p</span><span class="op" id="2191673">[</span><span class="num" id="2191674">0</span><span class="op" id="2191675">]</span>&nbsp;<span class="op" id="2191677">=</span>&nbsp;<span class="ident" id="2191679">t4</span>&nbsp;<span class="op" id="2191682">|</span>&nbsp;<span class="builtintype" id="2191684">byte</span><span class="op" id="2191688">(</span><span class="ident" id="2191689">r</span><span class="op" id="2191690">&gt;&gt;</span><span class="num" id="2191692">18</span><span class="op" id="2191694">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191698">p</span><span class="op" id="2191699">[</span><span class="num" id="2191700">1</span><span class="op" id="2191701">]</span>&nbsp;<span class="op" id="2191703">=</span>&nbsp;<span class="ident" id="2191705">tx</span>&nbsp;<span class="op" id="2191708">|</span>&nbsp;<span class="builtintype" id="2191710">byte</span><span class="op" id="2191714">(</span><span class="ident" id="2191715">r</span><span class="op" id="2191716">&gt;&gt;</span><span class="num" id="2191718">12</span><span class="op" id="2191720">)</span><span class="op" id="2191721">&amp;</span><span class="ident" id="2191722">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191730">p</span><span class="op" id="2191731">[</span><span class="num" id="2191732">2</span><span class="op" id="2191733">]</span>&nbsp;<span class="op" id="2191735">=</span>&nbsp;<span class="ident" id="2191737">tx</span>&nbsp;<span class="op" id="2191740">|</span>&nbsp;<span class="builtintype" id="2191742">byte</span><span class="op" id="2191746">(</span><span class="ident" id="2191747">r</span><span class="op" id="2191748">&gt;&gt;</span><span class="num" id="2191750">6</span><span class="op" id="2191751">)</span><span class="op" id="2191752">&amp;</span><span class="ident" id="2191753">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191761">p</span><span class="op" id="2191762">[</span><span class="num" id="2191763">3</span><span class="op" id="2191764">]</span>&nbsp;<span class="op" id="2191766">=</span>&nbsp;<span class="ident" id="2191768">tx</span>&nbsp;<span class="op" id="2191771">|</span>&nbsp;<span class="builtintype" id="2191773">byte</span><span class="op" id="2191777">(</span><span class="ident" id="2191778">r</span><span class="op" id="2191779">)</span><span class="op" id="2191780">&amp;</span><span class="ident" id="2191781">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191789">return</span>&nbsp;<span class="num" id="2191796">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191799">}</span><br>
<span class="lineno">365</span><span class="op" id="2191801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2191804">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="2191872">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2191930">func</span>&nbsp;<span class="ident" id="2191935">RuneCount</span><span class="op" id="2191944">(</span><span class="ident" id="2191945">p</span>&nbsp;<span class="op" id="2191947">[</span><span class="op" id="2191948">]</span><span class="builtintype" id="2191949">byte</span><span class="op" id="2191953">)</span>&nbsp;<span class="builtintype" id="2191955">int</span>&nbsp;<span class="op" id="2191959">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191962">i</span>&nbsp;<span class="op" id="2191964">:=</span>&nbsp;<span class="num" id="2191967">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191970">var</span>&nbsp;<span class="ident" id="2191974">n</span>&nbsp;<span class="builtintype" id="2191976">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191981">for</span>&nbsp;<span class="ident" id="2191985">n</span>&nbsp;<span class="op" id="2191987">=</span>&nbsp;<span class="num" id="2191989">0</span><span class="op" id="2191990">;</span>&nbsp;<span class="ident" id="2191992">i</span>&nbsp;<span class="op" id="2191994">&lt;</span>&nbsp;<span class="builtinfunc" id="2191996">len</span><span class="op" id="2191999">(</span><span class="ident" id="2192000">p</span><span class="op" id="2192001">)</span><span class="op" id="2192002">;</span>&nbsp;<span class="ident" id="2192004">n</span><span class="op" id="2192005">++</span>&nbsp;<span class="op" id="2192008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192012">if</span>&nbsp;<span class="ident" id="2192015">p</span><span class="op" id="2192016">[</span><span class="ident" id="2192017">i</span><span class="op" id="2192018">]</span>&nbsp;<span class="op" id="2192020">&lt;</span>&nbsp;<span class="ident" id="2192022">RuneSelf</span>&nbsp;<span class="op" id="2192031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192036">i</span><span class="op" id="2192037">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192042">}</span>&nbsp;<span class="keyword" id="2192044">else</span>&nbsp;<span class="op" id="2192049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192054">_</span><span class="op" id="2192055">,</span>&nbsp;<span class="ident" id="2192057">size</span>&nbsp;<span class="op" id="2192062">:=</span>&nbsp;<span class="ident" id="2192065">DecodeRune</span><span class="op" id="2192075">(</span><span class="ident" id="2192076">p</span><span class="op" id="2192077">[</span><span class="ident" id="2192078">i</span><span class="op" id="2192079">:</span><span class="op" id="2192080">]</span><span class="op" id="2192081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192086">i</span>&nbsp;<span class="op" id="2192088">+=</span>&nbsp;<span class="ident" id="2192091">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192101">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192104">return</span>&nbsp;<span class="ident" id="2192111">n</span><br>
<span class="lineno"></span><span class="op" id="2192113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2192116">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2192182">func</span>&nbsp;<span class="ident" id="2192187">RuneCountInString</span><span class="op" id="2192204">(</span><span class="ident" id="2192205">s</span>&nbsp;<span class="builtintype" id="2192207">string</span><span class="op" id="2192213">)</span>&nbsp;<span class="op" id="2192215">(</span><span class="ident" id="2192216">n</span>&nbsp;<span class="builtintype" id="2192218">int</span><span class="op" id="2192221">)</span>&nbsp;<span class="op" id="2192223">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192226">for</span>&nbsp;<span class="keyword" id="2192230">range</span>&nbsp;<span class="ident" id="2192236">s</span>&nbsp;<span class="op" id="2192238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192242">n</span><span class="op" id="2192243">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192250">return</span><br>
<span class="lineno"></span><span class="op" id="2192257">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="2192260">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2192325">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="2192394">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="2192417">func</span>&nbsp;<span class="ident" id="2192422">RuneStart</span><span class="op" id="2192431">(</span><span class="ident" id="2192432">b</span>&nbsp;<span class="builtintype" id="2192434">byte</span><span class="op" id="2192438">)</span>&nbsp;<span class="builtintype" id="2192440">bool</span>&nbsp;<span class="op" id="2192445">{</span>&nbsp;<span class="keyword" id="2192447">return</span>&nbsp;<span class="ident" id="2192454">b</span><span class="op" id="2192455">&amp;</span><span class="num" id="2192456">0xC0</span>&nbsp;<span class="op" id="2192461">!=</span>&nbsp;<span class="num" id="2192464">0x80</span>&nbsp;<span class="op" id="2192469">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="2192472">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="2192547">func</span>&nbsp;<span class="ident" id="2192552">Valid</span><span class="op" id="2192557">(</span><span class="ident" id="2192558">p</span>&nbsp;<span class="op" id="2192560">[</span><span class="op" id="2192561">]</span><span class="builtintype" id="2192562">byte</span><span class="op" id="2192566">)</span>&nbsp;<span class="builtintype" id="2192568">bool</span>&nbsp;<span class="op" id="2192573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192576">i</span>&nbsp;<span class="op" id="2192578">:=</span>&nbsp;<span class="num" id="2192581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192584">for</span>&nbsp;<span class="ident" id="2192588">i</span>&nbsp;<span class="op" id="2192590">&lt;</span>&nbsp;<span class="builtinfunc" id="2192592">len</span><span class="op" id="2192595">(</span><span class="ident" id="2192596">p</span><span class="op" id="2192597">)</span>&nbsp;<span class="op" id="2192599">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192603">if</span>&nbsp;<span class="ident" id="2192606">p</span><span class="op" id="2192607">[</span><span class="ident" id="2192608">i</span><span class="op" id="2192609">]</span>&nbsp;<span class="op" id="2192611">&lt;</span>&nbsp;<span class="ident" id="2192613">RuneSelf</span>&nbsp;<span class="op" id="2192622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192627">i</span><span class="op" id="2192628">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192633">}</span>&nbsp;<span class="keyword" id="2192635">else</span>&nbsp;<span class="op" id="2192640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192645">_</span><span class="op" id="2192646">,</span>&nbsp;<span class="ident" id="2192648">size</span>&nbsp;<span class="op" id="2192653">:=</span>&nbsp;<span class="ident" id="2192656">DecodeRune</span><span class="op" id="2192666">(</span><span class="ident" id="2192667">p</span><span class="op" id="2192668">[</span><span class="ident" id="2192669">i</span><span class="op" id="2192670">:</span><span class="op" id="2192671">]</span><span class="op" id="2192672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192677">if</span>&nbsp;<span class="ident" id="2192680">size</span>&nbsp;<span class="op" id="2192685">==</span>&nbsp;<span class="num" id="2192688">1</span>&nbsp;<span class="op" id="2192690">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2192696">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2192736">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2192779">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192812">return</span>&nbsp;<span class="ident" id="2192819">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192828">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192833">i</span>&nbsp;<span class="op" id="2192835">+=</span>&nbsp;<span class="ident" id="2192838">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192851">return</span>&nbsp;<span class="ident" id="2192858">true</span><br>
<span class="lineno"></span><span class="op" id="2192863">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="2192866">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="2192947">func</span>&nbsp;<span class="ident" id="2192952">ValidString</span><span class="op" id="2192963">(</span><span class="ident" id="2192964">s</span>&nbsp;<span class="builtintype" id="2192966">string</span><span class="op" id="2192972">)</span>&nbsp;<span class="builtintype" id="2192974">bool</span>&nbsp;<span class="op" id="2192979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192982">for</span>&nbsp;<span class="ident" id="2192986">i</span><span class="op" id="2192987">,</span>&nbsp;<span class="ident" id="2192989">r</span>&nbsp;<span class="op" id="2192991">:=</span>&nbsp;<span class="keyword" id="2192994">range</span>&nbsp;<span class="ident" id="2193000">s</span>&nbsp;<span class="op" id="2193002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193006">if</span>&nbsp;<span class="ident" id="2193009">r</span>&nbsp;<span class="op" id="2193011">==</span>&nbsp;<span class="ident" id="2193014">RuneError</span>&nbsp;<span class="op" id="2193024">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193029">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193071">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193121">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193171">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193209">_</span><span class="op" id="2193210">,</span>&nbsp;<span class="ident" id="2193212">size</span>&nbsp;<span class="op" id="2193217">:=</span>&nbsp;<span class="ident" id="2193220">DecodeRuneInString</span><span class="op" id="2193238">(</span><span class="ident" id="2193239">s</span><span class="op" id="2193240">[</span><span class="ident" id="2193241">i</span><span class="op" id="2193242">:</span><span class="op" id="2193243">]</span><span class="op" id="2193244">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193249">if</span>&nbsp;<span class="ident" id="2193252">size</span>&nbsp;<span class="op" id="2193257">==</span>&nbsp;<span class="num" id="2193260">1</span>&nbsp;<span class="op" id="2193262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193268">return</span>&nbsp;<span class="ident" id="2193275">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193291">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193294">return</span>&nbsp;<span class="ident" id="2193301">true</span><br>
<span class="lineno"></span><span class="op" id="2193306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2193309">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="2193373">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="2193443">func</span>&nbsp;<span class="ident" id="2193448">ValidRune</span><span class="op" id="2193457">(</span><span class="ident" id="2193458">r</span>&nbsp;<span class="builtintype" id="2193460">rune</span><span class="op" id="2193464">)</span>&nbsp;<span class="builtintype" id="2193466">bool</span>&nbsp;<span class="op" id="2193471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193474">switch</span>&nbsp;<span class="op" id="2193481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193484">case</span>&nbsp;<span class="ident" id="2193489">r</span>&nbsp;<span class="op" id="2193491">&lt;</span>&nbsp;<span class="num" id="2193493">0</span><span class="op" id="2193494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193498">return</span>&nbsp;<span class="ident" id="2193505">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193512">case</span>&nbsp;<span class="ident" id="2193517">surrogateMin</span>&nbsp;<span class="op" id="2193530">&lt;=</span>&nbsp;<span class="ident" id="2193533">r</span>&nbsp;<span class="op" id="2193535">&amp;&amp;</span>&nbsp;<span class="ident" id="2193538">r</span>&nbsp;<span class="op" id="2193540">&lt;=</span>&nbsp;<span class="ident" id="2193543">surrogateMax</span><span class="op" id="2193555">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193559">return</span>&nbsp;<span class="ident" id="2193566">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193573">case</span>&nbsp;<span class="ident" id="2193578">r</span>&nbsp;<span class="op" id="2193580">&gt;</span>&nbsp;<span class="ident" id="2193582">MaxRune</span><span class="op" id="2193589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193593">return</span>&nbsp;<span class="ident" id="2193600">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193610">return</span>&nbsp;<span class="ident" id="2193617">true</span><br>
<span class="lineno">445</span><span class="op" id="2193622">}</span>
</div>
</body>
</html>
