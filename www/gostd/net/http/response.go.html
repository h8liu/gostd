<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html" class="current">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3496441">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3496496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3496550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3496601">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3496640">package</span>&nbsp;<span class="ident" id="3496648">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3496654">import</span>&nbsp;<span class="op" id="3496661">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496664">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496673">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496682">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496696">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496706">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496712">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496729">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496740">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496751">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3496761">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3496764">var</span>&nbsp;<span class="ident" id="3496768">respExcludeHeader</span>&nbsp;<span class="op" id="3496786">=</span>&nbsp;<span class="keyword" id="3496788">map</span><span class="op" id="3496791">[</span><span class="builtintype" id="3496792">string</span><span class="op" id="3496798">]</span><span class="builtintype" id="3496799">bool</span><span class="op" id="3496803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496806">&#34;Content-Length&#34;</span><span class="op" id="3496822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3496827">true</span><span class="op" id="3496831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496834">&#34;Transfer-Encoding&#34;</span><span class="op" id="3496853">:</span>&nbsp;<span class="builtintype" id="3496855">true</span><span class="op" id="3496859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3496862">&#34;Trailer&#34;</span><span class="op" id="3496871">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3496883">true</span><span class="op" id="3496887">,</span><br>
<span class="lineno">25</span><span class="op" id="3496889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496892">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3496950">//</span><br>
<span class="lineno"></span><span class="keyword" id="3496953">type</span>&nbsp;<span class="ident" id="3496958">Response</span>&nbsp;<span class="keyword" id="3496967">struct</span>&nbsp;<span class="op" id="3496974">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496977">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3496988">string</span>&nbsp;<span class="comment" id="3496995">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497013">StatusCode</span>&nbsp;<span class="builtintype" id="3497024">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497031">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497044">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3497055">string</span>&nbsp;<span class="comment" id="3497062">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497082">ProtoMajor</span>&nbsp;<span class="builtintype" id="3497093">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497100">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497111">ProtoMinor</span>&nbsp;<span class="builtintype" id="3497122">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497129">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497141">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497210">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497278">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497351">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497421">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497493">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497518">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497522">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497586">Header</span>&nbsp;<span class="ident" id="3497593">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497602">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497641">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497645">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497709">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497773">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497834">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497850">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497854">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497916">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497956">Body</span>&nbsp;<span class="ident" id="3497961">io</span><span class="op" id="3497963">.</span><span class="ident" id="3497964">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497977">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498046">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498120">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498191">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498214">ContentLength</span>&nbsp;<span class="ident" id="3498228">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498236">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498308">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498357">TransferEncoding</span>&nbsp;<span class="op" id="3498374">[</span><span class="op" id="3498375">]</span><span class="builtintype" id="3498376">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498385">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498454">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498527">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498589">Close</span>&nbsp;<span class="builtintype" id="3498595">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498602">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498655">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498681">Trailer</span>&nbsp;<span class="ident" id="3498689">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498698">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498753">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498811">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498859">Request</span>&nbsp;<span class="op" id="3498867">*</span><span class="ident" id="3498868">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498878">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3498945">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3499009">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3499071">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499085">TLS</span>&nbsp;<span class="op" id="3499089">*</span><span class="ident" id="3499090">tls</span><span class="op" id="3499093">.</span><span class="ident" id="3499094">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3499110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3499113">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3499186">func</span>&nbsp;<span class="op" id="3499191">(</span><span class="ident" id="3499192">r</span>&nbsp;<span class="op" id="3499194">*</span><span class="ident" id="3499195">Response</span><span class="op" id="3499203">)</span>&nbsp;<span class="ident" id="3499205">Cookies</span><span class="op" id="3499212">(</span><span class="op" id="3499213">)</span>&nbsp;<span class="op" id="3499215">[</span><span class="op" id="3499216">]</span><span class="op" id="3499217">*</span><span class="ident" id="3499218">Cookie</span>&nbsp;<span class="op" id="3499225">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499228">return</span>&nbsp;<span class="ident" id="3499235">readSetCookies</span><span class="op" id="3499249">(</span><span class="ident" id="3499250">r</span><span class="op" id="3499251">.</span><span class="ident" id="3499252">Header</span><span class="op" id="3499258">)</span><br>
<span class="lineno"></span><span class="op" id="3499260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3499263">var</span>&nbsp;<span class="ident" id="3499267">ErrNoLocation</span>&nbsp;<span class="op" id="3499281">=</span>&nbsp;<span class="ident" id="3499283">errors</span><span class="op" id="3499289">.</span><span class="ident" id="3499290">New</span><span class="op" id="3499293">(</span><span class="string" id="3499294">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3499332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3499335">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3499400">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3499460">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3499520">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3499551">func</span>&nbsp;<span class="op" id="3499556">(</span><span class="ident" id="3499557">r</span>&nbsp;<span class="op" id="3499559">*</span><span class="ident" id="3499560">Response</span><span class="op" id="3499568">)</span>&nbsp;<span class="ident" id="3499570">Location</span><span class="op" id="3499578">(</span><span class="op" id="3499579">)</span>&nbsp;<span class="op" id="3499581">(</span><span class="op" id="3499582">*</span><span class="ident" id="3499583">url</span><span class="op" id="3499586">.</span><span class="ident" id="3499587">URL</span><span class="op" id="3499590">,</span>&nbsp;<span class="builtintype" id="3499592">error</span><span class="op" id="3499597">)</span>&nbsp;<span class="op" id="3499599">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499602">lv</span>&nbsp;<span class="op" id="3499605">:=</span>&nbsp;<span class="ident" id="3499608">r</span><span class="op" id="3499609">.</span><span class="ident" id="3499610">Header</span><span class="op" id="3499616">.</span><span class="ident" id="3499617">Get</span><span class="op" id="3499620">(</span><span class="string" id="3499621">&#34;Location&#34;</span><span class="op" id="3499631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499634">if</span>&nbsp;<span class="ident" id="3499637">lv</span>&nbsp;<span class="op" id="3499640">==</span>&nbsp;<span class="string" id="3499643">&#34;&#34;</span>&nbsp;<span class="op" id="3499646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499650">return</span>&nbsp;<span class="ident" id="3499657">nil</span><span class="op" id="3499660">,</span>&nbsp;<span class="ident" id="3499662">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499680">if</span>&nbsp;<span class="ident" id="3499683">r</span><span class="op" id="3499684">.</span><span class="ident" id="3499685">Request</span>&nbsp;<span class="op" id="3499693">!=</span>&nbsp;<span class="ident" id="3499696">nil</span>&nbsp;<span class="op" id="3499700">&amp;&amp;</span>&nbsp;<span class="ident" id="3499703">r</span><span class="op" id="3499704">.</span><span class="ident" id="3499705">Request</span><span class="op" id="3499712">.</span><span class="ident" id="3499713">URL</span>&nbsp;<span class="op" id="3499717">!=</span>&nbsp;<span class="ident" id="3499720">nil</span>&nbsp;<span class="op" id="3499724">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499728">return</span>&nbsp;<span class="ident" id="3499735">r</span><span class="op" id="3499736">.</span><span class="ident" id="3499737">Request</span><span class="op" id="3499744">.</span><span class="ident" id="3499745">URL</span><span class="op" id="3499748">.</span><span class="ident" id="3499749">Parse</span><span class="op" id="3499754">(</span><span class="ident" id="3499755">lv</span><span class="op" id="3499757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499763">return</span>&nbsp;<span class="ident" id="3499770">url</span><span class="op" id="3499773">.</span><span class="ident" id="3499774">Parse</span><span class="op" id="3499779">(</span><span class="ident" id="3499780">lv</span><span class="op" id="3499782">)</span><br>
<span class="lineno"></span><span class="op" id="3499784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3499787">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3499846">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3499917">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3499972">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3500042">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3500113">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3500156">func</span>&nbsp;<span class="ident" id="3500161">ReadResponse</span><span class="op" id="3500173">(</span><span class="ident" id="3500174">r</span>&nbsp;<span class="op" id="3500176">*</span><span class="ident" id="3500177">bufio</span><span class="op" id="3500182">.</span><span class="ident" id="3500183">Reader</span><span class="op" id="3500189">,</span>&nbsp;<span class="ident" id="3500191">req</span>&nbsp;<span class="op" id="3500195">*</span><span class="ident" id="3500196">Request</span><span class="op" id="3500203">)</span>&nbsp;<span class="op" id="3500205">(</span><span class="op" id="3500206">*</span><span class="ident" id="3500207">Response</span><span class="op" id="3500215">,</span>&nbsp;<span class="builtintype" id="3500217">error</span><span class="op" id="3500222">)</span>&nbsp;<span class="op" id="3500224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500227">tp</span>&nbsp;<span class="op" id="3500230">:=</span>&nbsp;<span class="ident" id="3500233">textproto</span><span class="op" id="3500242">.</span><span class="ident" id="3500243">NewReader</span><span class="op" id="3500252">(</span><span class="ident" id="3500253">r</span><span class="op" id="3500254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500257">resp</span>&nbsp;<span class="op" id="3500262">:=</span>&nbsp;<span class="op" id="3500265">&amp;</span><span class="ident" id="3500266">Response</span><span class="op" id="3500274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500278">Request</span><span class="op" id="3500285">:</span>&nbsp;<span class="ident" id="3500287">req</span><span class="op" id="3500290">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3500297">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500339">line</span><span class="op" id="3500343">,</span>&nbsp;<span class="ident" id="3500345">err</span>&nbsp;<span class="op" id="3500349">:=</span>&nbsp;<span class="ident" id="3500352">tp</span><span class="op" id="3500354">.</span><span class="ident" id="3500355">ReadLine</span><span class="op" id="3500363">(</span><span class="op" id="3500364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500367">if</span>&nbsp;<span class="ident" id="3500370">err</span>&nbsp;<span class="op" id="3500374">!=</span>&nbsp;<span class="ident" id="3500377">nil</span>&nbsp;<span class="op" id="3500381">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500385">if</span>&nbsp;<span class="ident" id="3500388">err</span>&nbsp;<span class="op" id="3500392">==</span>&nbsp;<span class="ident" id="3500395">io</span><span class="op" id="3500397">.</span><span class="ident" id="3500398">EOF</span>&nbsp;<span class="op" id="3500402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500407">err</span>&nbsp;<span class="op" id="3500411">=</span>&nbsp;<span class="ident" id="3500413">io</span><span class="op" id="3500415">.</span><span class="ident" id="3500416">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500439">return</span>&nbsp;<span class="ident" id="3500446">nil</span><span class="op" id="3500449">,</span>&nbsp;<span class="ident" id="3500451">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500456">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500459">f</span>&nbsp;<span class="op" id="3500461">:=</span>&nbsp;<span class="ident" id="3500464">strings</span><span class="op" id="3500471">.</span><span class="ident" id="3500472">SplitN</span><span class="op" id="3500478">(</span><span class="ident" id="3500479">line</span><span class="op" id="3500483">,</span>&nbsp;<span class="string" id="3500485">&#34;&nbsp;&#34;</span><span class="op" id="3500488">,</span>&nbsp;<span class="num" id="3500490">3</span><span class="op" id="3500491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500494">if</span>&nbsp;<span class="builtinfunc" id="3500497">len</span><span class="op" id="3500500">(</span><span class="ident" id="3500501">f</span><span class="op" id="3500502">)</span>&nbsp;<span class="op" id="3500504">&lt;</span>&nbsp;<span class="num" id="3500506">2</span>&nbsp;<span class="op" id="3500508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500512">return</span>&nbsp;<span class="ident" id="3500519">nil</span><span class="op" id="3500522">,</span>&nbsp;<span class="op" id="3500524">&amp;</span><span class="ident" id="3500525">badStringError</span><span class="op" id="3500539">{</span><span class="string" id="3500540">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3500565">,</span>&nbsp;<span class="ident" id="3500567">line</span><span class="op" id="3500571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500577">reasonPhrase</span>&nbsp;<span class="op" id="3500590">:=</span>&nbsp;<span class="string" id="3500593">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500597">if</span>&nbsp;<span class="builtinfunc" id="3500600">len</span><span class="op" id="3500603">(</span><span class="ident" id="3500604">f</span><span class="op" id="3500605">)</span>&nbsp;<span class="op" id="3500607">&gt;</span>&nbsp;<span class="num" id="3500609">2</span>&nbsp;<span class="op" id="3500611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500615">reasonPhrase</span>&nbsp;<span class="op" id="3500628">=</span>&nbsp;<span class="ident" id="3500630">f</span><span class="op" id="3500631">[</span><span class="num" id="3500632">2</span><span class="op" id="3500633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500639">resp</span><span class="op" id="3500643">.</span><span class="ident" id="3500644">Status</span>&nbsp;<span class="op" id="3500651">=</span>&nbsp;<span class="ident" id="3500653">f</span><span class="op" id="3500654">[</span><span class="num" id="3500655">1</span><span class="op" id="3500656">]</span>&nbsp;<span class="op" id="3500658">+</span>&nbsp;<span class="string" id="3500660">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3500664">+</span>&nbsp;<span class="ident" id="3500666">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500680">resp</span><span class="op" id="3500684">.</span><span class="ident" id="3500685">StatusCode</span><span class="op" id="3500695">,</span>&nbsp;<span class="ident" id="3500697">err</span>&nbsp;<span class="op" id="3500701">=</span>&nbsp;<span class="ident" id="3500703">strconv</span><span class="op" id="3500710">.</span><span class="ident" id="3500711">Atoi</span><span class="op" id="3500715">(</span><span class="ident" id="3500716">f</span><span class="op" id="3500717">[</span><span class="num" id="3500718">1</span><span class="op" id="3500719">]</span><span class="op" id="3500720">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500723">if</span>&nbsp;<span class="ident" id="3500726">err</span>&nbsp;<span class="op" id="3500730">!=</span>&nbsp;<span class="ident" id="3500733">nil</span>&nbsp;<span class="op" id="3500737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500741">return</span>&nbsp;<span class="ident" id="3500748">nil</span><span class="op" id="3500751">,</span>&nbsp;<span class="op" id="3500753">&amp;</span><span class="ident" id="3500754">badStringError</span><span class="op" id="3500768">{</span><span class="string" id="3500769">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3500797">,</span>&nbsp;<span class="ident" id="3500799">f</span><span class="op" id="3500800">[</span><span class="num" id="3500801">1</span><span class="op" id="3500802">]</span><span class="op" id="3500803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500810">resp</span><span class="op" id="3500814">.</span><span class="ident" id="3500815">Proto</span>&nbsp;<span class="op" id="3500821">=</span>&nbsp;<span class="ident" id="3500823">f</span><span class="op" id="3500824">[</span><span class="num" id="3500825">0</span><span class="op" id="3500826">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500829">var</span>&nbsp;<span class="ident" id="3500833">ok</span>&nbsp;<span class="builtintype" id="3500836">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500842">if</span>&nbsp;<span class="ident" id="3500845">resp</span><span class="op" id="3500849">.</span><span class="ident" id="3500850">ProtoMajor</span><span class="op" id="3500860">,</span>&nbsp;<span class="ident" id="3500862">resp</span><span class="op" id="3500866">.</span><span class="ident" id="3500867">ProtoMinor</span><span class="op" id="3500877">,</span>&nbsp;<span class="ident" id="3500879">ok</span>&nbsp;<span class="op" id="3500882">=</span>&nbsp;<span class="ident" id="3500884">ParseHTTPVersion</span><span class="op" id="3500900">(</span><span class="ident" id="3500901">resp</span><span class="op" id="3500905">.</span><span class="ident" id="3500906">Proto</span><span class="op" id="3500911">)</span><span class="op" id="3500912">;</span>&nbsp;<span class="op" id="3500914">!</span><span class="ident" id="3500915">ok</span>&nbsp;<span class="op" id="3500918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500922">return</span>&nbsp;<span class="ident" id="3500929">nil</span><span class="op" id="3500932">,</span>&nbsp;<span class="op" id="3500934">&amp;</span><span class="ident" id="3500935">badStringError</span><span class="op" id="3500949">{</span><span class="string" id="3500950">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3500974">,</span>&nbsp;<span class="ident" id="3500976">resp</span><span class="op" id="3500980">.</span><span class="ident" id="3500981">Proto</span><span class="op" id="3500986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3500993">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501025">mimeHeader</span><span class="op" id="3501035">,</span>&nbsp;<span class="ident" id="3501037">err</span>&nbsp;<span class="op" id="3501041">:=</span>&nbsp;<span class="ident" id="3501044">tp</span><span class="op" id="3501046">.</span><span class="ident" id="3501047">ReadMIMEHeader</span><span class="op" id="3501061">(</span><span class="op" id="3501062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501065">if</span>&nbsp;<span class="ident" id="3501068">err</span>&nbsp;<span class="op" id="3501072">!=</span>&nbsp;<span class="ident" id="3501075">nil</span>&nbsp;<span class="op" id="3501079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501083">if</span>&nbsp;<span class="ident" id="3501086">err</span>&nbsp;<span class="op" id="3501090">==</span>&nbsp;<span class="ident" id="3501093">io</span><span class="op" id="3501095">.</span><span class="ident" id="3501096">EOF</span>&nbsp;<span class="op" id="3501100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501105">err</span>&nbsp;<span class="op" id="3501109">=</span>&nbsp;<span class="ident" id="3501111">io</span><span class="op" id="3501113">.</span><span class="ident" id="3501114">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501137">return</span>&nbsp;<span class="ident" id="3501144">nil</span><span class="op" id="3501147">,</span>&nbsp;<span class="ident" id="3501149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501157">resp</span><span class="op" id="3501161">.</span><span class="ident" id="3501162">Header</span>&nbsp;<span class="op" id="3501169">=</span>&nbsp;<span class="ident" id="3501171">Header</span><span class="op" id="3501177">(</span><span class="ident" id="3501178">mimeHeader</span><span class="op" id="3501188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501192">fixPragmaCacheControl</span><span class="op" id="3501213">(</span><span class="ident" id="3501214">resp</span><span class="op" id="3501218">.</span><span class="ident" id="3501219">Header</span><span class="op" id="3501225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501229">err</span>&nbsp;<span class="op" id="3501233">=</span>&nbsp;<span class="ident" id="3501235">readTransfer</span><span class="op" id="3501247">(</span><span class="ident" id="3501248">resp</span><span class="op" id="3501252">,</span>&nbsp;<span class="ident" id="3501254">r</span><span class="op" id="3501255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501258">if</span>&nbsp;<span class="ident" id="3501261">err</span>&nbsp;<span class="op" id="3501265">!=</span>&nbsp;<span class="ident" id="3501268">nil</span>&nbsp;<span class="op" id="3501272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501276">return</span>&nbsp;<span class="ident" id="3501283">nil</span><span class="op" id="3501286">,</span>&nbsp;<span class="ident" id="3501288">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501297">return</span>&nbsp;<span class="ident" id="3501304">resp</span><span class="op" id="3501308">,</span>&nbsp;<span class="ident" id="3501310">nil</span><br>
<span class="lineno"></span><span class="op" id="3501314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3501317">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3501342">//&nbsp;&nbsp;&nbsp;&nbsp;Pragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3501362">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3501370">//&nbsp;&nbsp;&nbsp;&nbsp;Cache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3501397">func</span>&nbsp;<span class="ident" id="3501402">fixPragmaCacheControl</span><span class="op" id="3501423">(</span><span class="ident" id="3501424">header</span>&nbsp;<span class="ident" id="3501431">Header</span><span class="op" id="3501437">)</span>&nbsp;<span class="op" id="3501439">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501442">if</span>&nbsp;<span class="ident" id="3501445">hp</span><span class="op" id="3501447">,</span>&nbsp;<span class="ident" id="3501449">ok</span>&nbsp;<span class="op" id="3501452">:=</span>&nbsp;<span class="ident" id="3501455">header</span><span class="op" id="3501461">[</span><span class="string" id="3501462">&#34;Pragma&#34;</span><span class="op" id="3501470">]</span><span class="op" id="3501471">;</span>&nbsp;<span class="ident" id="3501473">ok</span>&nbsp;<span class="op" id="3501476">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3501479">len</span><span class="op" id="3501482">(</span><span class="ident" id="3501483">hp</span><span class="op" id="3501485">)</span>&nbsp;<span class="op" id="3501487">&gt;</span>&nbsp;<span class="num" id="3501489">0</span>&nbsp;<span class="op" id="3501491">&amp;&amp;</span>&nbsp;<span class="ident" id="3501494">hp</span><span class="op" id="3501496">[</span><span class="num" id="3501497">0</span><span class="op" id="3501498">]</span>&nbsp;<span class="op" id="3501500">==</span>&nbsp;<span class="string" id="3501503">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3501514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501518">if</span>&nbsp;<span class="ident" id="3501521">_</span><span class="op" id="3501522">,</span>&nbsp;<span class="ident" id="3501524">presentcc</span>&nbsp;<span class="op" id="3501534">:=</span>&nbsp;<span class="ident" id="3501537">header</span><span class="op" id="3501543">[</span><span class="string" id="3501544">&#34;Cache-Control&#34;</span><span class="op" id="3501559">]</span><span class="op" id="3501560">;</span>&nbsp;<span class="op" id="3501562">!</span><span class="ident" id="3501563">presentcc</span>&nbsp;<span class="op" id="3501573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501578">header</span><span class="op" id="3501584">[</span><span class="string" id="3501585">&#34;Cache-Control&#34;</span><span class="op" id="3501600">]</span>&nbsp;<span class="op" id="3501602">=</span>&nbsp;<span class="op" id="3501604">[</span><span class="op" id="3501605">]</span><span class="builtintype" id="3501606">string</span><span class="op" id="3501612">{</span><span class="string" id="3501613">&#34;no-cache&#34;</span><span class="op" id="3501623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501630">}</span><br>
<span class="lineno">180</span><span class="op" id="3501632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3501635">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3501690">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3501734">func</span>&nbsp;<span class="op" id="3501739">(</span><span class="ident" id="3501740">r</span>&nbsp;<span class="op" id="3501742">*</span><span class="ident" id="3501743">Response</span><span class="op" id="3501751">)</span>&nbsp;<span class="ident" id="3501753">ProtoAtLeast</span><span class="op" id="3501765">(</span><span class="ident" id="3501766">major</span><span class="op" id="3501771">,</span>&nbsp;<span class="ident" id="3501773">minor</span>&nbsp;<span class="builtintype" id="3501779">int</span><span class="op" id="3501782">)</span>&nbsp;<span class="builtintype" id="3501784">bool</span>&nbsp;<span class="op" id="3501789">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501792">return</span>&nbsp;<span class="ident" id="3501799">r</span><span class="op" id="3501800">.</span><span class="ident" id="3501801">ProtoMajor</span>&nbsp;<span class="op" id="3501812">&gt;</span>&nbsp;<span class="ident" id="3501814">major</span>&nbsp;<span class="op" id="3501820">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501825">r</span><span class="op" id="3501826">.</span><span class="ident" id="3501827">ProtoMajor</span>&nbsp;<span class="op" id="3501838">==</span>&nbsp;<span class="ident" id="3501841">major</span>&nbsp;<span class="op" id="3501847">&amp;&amp;</span>&nbsp;<span class="ident" id="3501850">r</span><span class="op" id="3501851">.</span><span class="ident" id="3501852">ProtoMinor</span>&nbsp;<span class="op" id="3501863">&gt;=</span>&nbsp;<span class="ident" id="3501866">minor</span><br>
<span class="lineno"></span><span class="op" id="3501872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3501875">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3501953">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3502003">//</span><br>
<span class="lineno"></span><span class="comment" id="3502006">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3502021">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3502036">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3502051">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3502070">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3502091">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3502103">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3502112">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3502130">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3502205">//</span><br>
<span class="lineno"></span><span class="comment" id="3502208">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3502244">func</span>&nbsp;<span class="op" id="3502249">(</span><span class="ident" id="3502250">r</span>&nbsp;<span class="op" id="3502252">*</span><span class="ident" id="3502253">Response</span><span class="op" id="3502261">)</span>&nbsp;<span class="ident" id="3502263">Write</span><span class="op" id="3502268">(</span><span class="ident" id="3502269">w</span>&nbsp;<span class="ident" id="3502271">io</span><span class="op" id="3502273">.</span><span class="ident" id="3502274">Writer</span><span class="op" id="3502280">)</span>&nbsp;<span class="builtintype" id="3502282">error</span>&nbsp;<span class="op" id="3502288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502291">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502307">text</span>&nbsp;<span class="op" id="3502312">:=</span>&nbsp;<span class="ident" id="3502315">r</span><span class="op" id="3502316">.</span><span class="ident" id="3502317">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502325">if</span>&nbsp;<span class="ident" id="3502328">text</span>&nbsp;<span class="op" id="3502333">==</span>&nbsp;<span class="string" id="3502336">&#34;&#34;</span>&nbsp;<span class="op" id="3502339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502343">var</span>&nbsp;<span class="ident" id="3502347">ok</span>&nbsp;<span class="builtintype" id="3502350">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502357">text</span><span class="op" id="3502361">,</span>&nbsp;<span class="ident" id="3502363">ok</span>&nbsp;<span class="op" id="3502366">=</span>&nbsp;<span class="ident" id="3502368">statusText</span><span class="op" id="3502378">[</span><span class="ident" id="3502379">r</span><span class="op" id="3502380">.</span><span class="ident" id="3502381">StatusCode</span><span class="op" id="3502391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502395">if</span>&nbsp;<span class="op" id="3502398">!</span><span class="ident" id="3502399">ok</span>&nbsp;<span class="op" id="3502402">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502407">text</span>&nbsp;<span class="op" id="3502412">=</span>&nbsp;<span class="string" id="3502414">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3502429">+</span>&nbsp;<span class="ident" id="3502431">strconv</span><span class="op" id="3502438">.</span><span class="ident" id="3502439">Itoa</span><span class="op" id="3502443">(</span><span class="ident" id="3502444">r</span><span class="op" id="3502445">.</span><span class="ident" id="3502446">StatusCode</span><span class="op" id="3502456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502466">protoMajor</span><span class="op" id="3502476">,</span>&nbsp;<span class="ident" id="3502478">protoMinor</span>&nbsp;<span class="op" id="3502489">:=</span>&nbsp;<span class="ident" id="3502492">strconv</span><span class="op" id="3502499">.</span><span class="ident" id="3502500">Itoa</span><span class="op" id="3502504">(</span><span class="ident" id="3502505">r</span><span class="op" id="3502506">.</span><span class="ident" id="3502507">ProtoMajor</span><span class="op" id="3502517">)</span><span class="op" id="3502518">,</span>&nbsp;<span class="ident" id="3502520">strconv</span><span class="op" id="3502527">.</span><span class="ident" id="3502528">Itoa</span><span class="op" id="3502532">(</span><span class="ident" id="3502533">r</span><span class="op" id="3502534">.</span><span class="ident" id="3502535">ProtoMinor</span><span class="op" id="3502545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502548">statusCode</span>&nbsp;<span class="op" id="3502559">:=</span>&nbsp;<span class="ident" id="3502562">strconv</span><span class="op" id="3502569">.</span><span class="ident" id="3502570">Itoa</span><span class="op" id="3502574">(</span><span class="ident" id="3502575">r</span><span class="op" id="3502576">.</span><span class="ident" id="3502577">StatusCode</span><span class="op" id="3502587">)</span>&nbsp;<span class="op" id="3502589">+</span>&nbsp;<span class="string" id="3502591">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502596">text</span>&nbsp;<span class="op" id="3502601">=</span>&nbsp;<span class="ident" id="3502603">strings</span><span class="op" id="3502610">.</span><span class="ident" id="3502611">TrimPrefix</span><span class="op" id="3502621">(</span><span class="ident" id="3502622">text</span><span class="op" id="3502626">,</span>&nbsp;<span class="ident" id="3502628">statusCode</span><span class="op" id="3502638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502641">if</span>&nbsp;<span class="ident" id="3502644">_</span><span class="op" id="3502645">,</span>&nbsp;<span class="ident" id="3502647">err</span>&nbsp;<span class="op" id="3502651">:=</span>&nbsp;<span class="ident" id="3502654">io</span><span class="op" id="3502656">.</span><span class="ident" id="3502657">WriteString</span><span class="op" id="3502668">(</span><span class="ident" id="3502669">w</span><span class="op" id="3502670">,</span>&nbsp;<span class="string" id="3502672">&#34;HTTP/&#34;</span><span class="op" id="3502679">+</span><span class="ident" id="3502680">protoMajor</span><span class="op" id="3502690">+</span><span class="string" id="3502691">&#34;.&#34;</span><span class="op" id="3502694">+</span><span class="ident" id="3502695">protoMinor</span><span class="op" id="3502705">+</span><span class="string" id="3502706">&#34;&nbsp;&#34;</span><span class="op" id="3502709">+</span><span class="ident" id="3502710">statusCode</span><span class="op" id="3502720">+</span><span class="ident" id="3502721">text</span><span class="op" id="3502725">+</span><span class="string" id="3502726">&#34;\r\n&#34;</span><span class="op" id="3502732">)</span><span class="op" id="3502733">;</span>&nbsp;<span class="ident" id="3502735">err</span>&nbsp;<span class="op" id="3502739">!=</span>&nbsp;<span class="ident" id="3502742">nil</span>&nbsp;<span class="op" id="3502746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502750">return</span>&nbsp;<span class="ident" id="3502757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502766">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502811">r1</span>&nbsp;<span class="op" id="3502814">:=</span>&nbsp;<span class="builtinfunc" id="3502817">new</span><span class="op" id="3502820">(</span><span class="ident" id="3502821">Response</span><span class="op" id="3502829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502832">*</span><span class="ident" id="3502833">r1</span>&nbsp;<span class="op" id="3502836">=</span>&nbsp;<span class="op" id="3502838">*</span><span class="ident" id="3502839">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502842">if</span>&nbsp;<span class="ident" id="3502845">r1</span><span class="op" id="3502847">.</span><span class="ident" id="3502848">ContentLength</span>&nbsp;<span class="op" id="3502862">==</span>&nbsp;<span class="num" id="3502865">0</span>&nbsp;<span class="op" id="3502867">&amp;&amp;</span>&nbsp;<span class="ident" id="3502870">r1</span><span class="op" id="3502872">.</span><span class="ident" id="3502873">Body</span>&nbsp;<span class="op" id="3502878">!=</span>&nbsp;<span class="ident" id="3502881">nil</span>&nbsp;<span class="op" id="3502885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502889">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502936">var</span>&nbsp;<span class="ident" id="3502940">buf</span>&nbsp;<span class="op" id="3502944">[</span><span class="num" id="3502945">1</span><span class="op" id="3502946">]</span><span class="builtintype" id="3502947">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502954">n</span><span class="op" id="3502955">,</span>&nbsp;<span class="ident" id="3502957">err</span>&nbsp;<span class="op" id="3502961">:=</span>&nbsp;<span class="ident" id="3502964">r1</span><span class="op" id="3502966">.</span><span class="ident" id="3502967">Body</span><span class="op" id="3502971">.</span><span class="ident" id="3502972">Read</span><span class="op" id="3502976">(</span><span class="ident" id="3502977">buf</span><span class="op" id="3502980">[</span><span class="op" id="3502981">:</span><span class="op" id="3502982">]</span><span class="op" id="3502983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502987">if</span>&nbsp;<span class="ident" id="3502990">err</span>&nbsp;<span class="op" id="3502994">!=</span>&nbsp;<span class="ident" id="3502997">nil</span>&nbsp;<span class="op" id="3503001">&amp;&amp;</span>&nbsp;<span class="ident" id="3503004">err</span>&nbsp;<span class="op" id="3503008">!=</span>&nbsp;<span class="ident" id="3503011">io</span><span class="op" id="3503013">.</span><span class="ident" id="3503014">EOF</span>&nbsp;<span class="op" id="3503018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503023">return</span>&nbsp;<span class="ident" id="3503030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503036">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503040">if</span>&nbsp;<span class="ident" id="3503043">n</span>&nbsp;<span class="op" id="3503045">==</span>&nbsp;<span class="num" id="3503048">0</span>&nbsp;<span class="op" id="3503050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503055">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503117">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503157">r1</span><span class="op" id="3503159">.</span><span class="ident" id="3503160">Body</span>&nbsp;<span class="op" id="3503165">=</span>&nbsp;<span class="ident" id="3503167">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503179">}</span>&nbsp;<span class="keyword" id="3503181">else</span>&nbsp;<span class="op" id="3503186">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503191">r1</span><span class="op" id="3503193">.</span><span class="ident" id="3503194">ContentLength</span>&nbsp;<span class="op" id="3503208">=</span>&nbsp;<span class="op" id="3503210">-</span><span class="num" id="3503211">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503216">r1</span><span class="op" id="3503218">.</span><span class="ident" id="3503219">Body</span>&nbsp;<span class="op" id="3503224">=</span>&nbsp;<span class="keyword" id="3503226">struct</span>&nbsp;<span class="op" id="3503233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503239">io</span><span class="op" id="3503241">.</span><span class="ident" id="3503242">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503253">io</span><span class="op" id="3503255">.</span><span class="ident" id="3503256">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503266">}</span><span class="op" id="3503267">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503273">io</span><span class="op" id="3503275">.</span><span class="ident" id="3503276">MultiReader</span><span class="op" id="3503287">(</span><span class="ident" id="3503288">bytes</span><span class="op" id="3503293">.</span><span class="ident" id="3503294">NewReader</span><span class="op" id="3503303">(</span><span class="ident" id="3503304">buf</span><span class="op" id="3503307">[</span><span class="op" id="3503308">:</span><span class="num" id="3503309">1</span><span class="op" id="3503310">]</span><span class="op" id="3503311">)</span><span class="op" id="3503312">,</span>&nbsp;<span class="ident" id="3503314">r</span><span class="op" id="3503315">.</span><span class="ident" id="3503316">Body</span><span class="op" id="3503320">)</span><span class="op" id="3503321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503327">r</span><span class="op" id="3503328">.</span><span class="ident" id="3503329">Body</span><span class="op" id="3503333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503345">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503348">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503411">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503475">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503538">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503556">if</span>&nbsp;<span class="ident" id="3503559">r1</span><span class="op" id="3503561">.</span><span class="ident" id="3503562">ContentLength</span>&nbsp;<span class="op" id="3503576">==</span>&nbsp;<span class="op" id="3503579">-</span><span class="num" id="3503580">1</span>&nbsp;<span class="op" id="3503582">&amp;&amp;</span>&nbsp;<span class="op" id="3503585">!</span><span class="ident" id="3503586">r1</span><span class="op" id="3503588">.</span><span class="ident" id="3503589">Close</span>&nbsp;<span class="op" id="3503595">&amp;&amp;</span>&nbsp;<span class="ident" id="3503598">r1</span><span class="op" id="3503600">.</span><span class="ident" id="3503601">ProtoAtLeast</span><span class="op" id="3503613">(</span><span class="num" id="3503614">1</span><span class="op" id="3503615">,</span>&nbsp;<span class="num" id="3503617">1</span><span class="op" id="3503618">)</span>&nbsp;<span class="op" id="3503620">&amp;&amp;</span>&nbsp;<span class="op" id="3503623">!</span><span class="ident" id="3503624">chunked</span><span class="op" id="3503631">(</span><span class="ident" id="3503632">r1</span><span class="op" id="3503634">.</span><span class="ident" id="3503635">TransferEncoding</span><span class="op" id="3503651">)</span>&nbsp;<span class="op" id="3503653">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503657">r1</span><span class="op" id="3503659">.</span><span class="ident" id="3503660">Close</span>&nbsp;<span class="op" id="3503666">=</span>&nbsp;<span class="builtintype" id="3503668">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503678">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503723">tw</span><span class="op" id="3503725">,</span>&nbsp;<span class="ident" id="3503727">err</span>&nbsp;<span class="op" id="3503731">:=</span>&nbsp;<span class="ident" id="3503734">newTransferWriter</span><span class="op" id="3503751">(</span><span class="ident" id="3503752">r1</span><span class="op" id="3503754">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503757">if</span>&nbsp;<span class="ident" id="3503760">err</span>&nbsp;<span class="op" id="3503764">!=</span>&nbsp;<span class="ident" id="3503767">nil</span>&nbsp;<span class="op" id="3503771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503775">return</span>&nbsp;<span class="ident" id="3503782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503790">err</span>&nbsp;<span class="op" id="3503794">=</span>&nbsp;<span class="ident" id="3503796">tw</span><span class="op" id="3503798">.</span><span class="ident" id="3503799">WriteHeader</span><span class="op" id="3503810">(</span><span class="ident" id="3503811">w</span><span class="op" id="3503812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503815">if</span>&nbsp;<span class="ident" id="3503818">err</span>&nbsp;<span class="op" id="3503822">!=</span>&nbsp;<span class="ident" id="3503825">nil</span>&nbsp;<span class="op" id="3503829">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503833">return</span>&nbsp;<span class="ident" id="3503840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503849">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503868">err</span>&nbsp;<span class="op" id="3503872">=</span>&nbsp;<span class="ident" id="3503874">r</span><span class="op" id="3503875">.</span><span class="ident" id="3503876">Header</span><span class="op" id="3503882">.</span><span class="ident" id="3503883">WriteSubset</span><span class="op" id="3503894">(</span><span class="ident" id="3503895">w</span><span class="op" id="3503896">,</span>&nbsp;<span class="ident" id="3503898">respExcludeHeader</span><span class="op" id="3503915">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503918">if</span>&nbsp;<span class="ident" id="3503921">err</span>&nbsp;<span class="op" id="3503925">!=</span>&nbsp;<span class="ident" id="3503928">nil</span>&nbsp;<span class="op" id="3503932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503936">return</span>&nbsp;<span class="ident" id="3503943">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503952">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504012">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504072">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3504097">:=</span>&nbsp;<span class="ident" id="3504100">tw</span><span class="op" id="3504102">.</span><span class="ident" id="3504103">shouldSendContentLength</span><span class="op" id="3504126">(</span><span class="op" id="3504127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504130">if</span>&nbsp;<span class="ident" id="3504133">r1</span><span class="op" id="3504135">.</span><span class="ident" id="3504136">ContentLength</span>&nbsp;<span class="op" id="3504150">==</span>&nbsp;<span class="num" id="3504153">0</span>&nbsp;<span class="op" id="3504155">&amp;&amp;</span>&nbsp;<span class="op" id="3504158">!</span><span class="ident" id="3504159">chunked</span><span class="op" id="3504166">(</span><span class="ident" id="3504167">r1</span><span class="op" id="3504169">.</span><span class="ident" id="3504170">TransferEncoding</span><span class="op" id="3504186">)</span>&nbsp;<span class="op" id="3504188">&amp;&amp;</span>&nbsp;<span class="op" id="3504191">!</span><span class="ident" id="3504192">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3504217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504221">if</span>&nbsp;<span class="ident" id="3504224">_</span><span class="op" id="3504225">,</span>&nbsp;<span class="ident" id="3504227">err</span>&nbsp;<span class="op" id="3504231">:=</span>&nbsp;<span class="ident" id="3504234">io</span><span class="op" id="3504236">.</span><span class="ident" id="3504237">WriteString</span><span class="op" id="3504248">(</span><span class="ident" id="3504249">w</span><span class="op" id="3504250">,</span>&nbsp;<span class="string" id="3504252">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3504275">)</span><span class="op" id="3504276">;</span>&nbsp;<span class="ident" id="3504278">err</span>&nbsp;<span class="op" id="3504282">!=</span>&nbsp;<span class="ident" id="3504285">nil</span>&nbsp;<span class="op" id="3504289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504294">return</span>&nbsp;<span class="ident" id="3504301">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504314">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504332">if</span>&nbsp;<span class="ident" id="3504335">_</span><span class="op" id="3504336">,</span>&nbsp;<span class="ident" id="3504338">err</span>&nbsp;<span class="op" id="3504342">:=</span>&nbsp;<span class="ident" id="3504345">io</span><span class="op" id="3504347">.</span><span class="ident" id="3504348">WriteString</span><span class="op" id="3504359">(</span><span class="ident" id="3504360">w</span><span class="op" id="3504361">,</span>&nbsp;<span class="string" id="3504363">&#34;\r\n&#34;</span><span class="op" id="3504369">)</span><span class="op" id="3504370">;</span>&nbsp;<span class="ident" id="3504372">err</span>&nbsp;<span class="op" id="3504376">!=</span>&nbsp;<span class="ident" id="3504379">nil</span>&nbsp;<span class="op" id="3504383">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504387">return</span>&nbsp;<span class="ident" id="3504394">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504403">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504430">err</span>&nbsp;<span class="op" id="3504434">=</span>&nbsp;<span class="ident" id="3504436">tw</span><span class="op" id="3504438">.</span><span class="ident" id="3504439">WriteBody</span><span class="op" id="3504448">(</span><span class="ident" id="3504449">w</span><span class="op" id="3504450">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504453">if</span>&nbsp;<span class="ident" id="3504456">err</span>&nbsp;<span class="op" id="3504460">!=</span>&nbsp;<span class="ident" id="3504463">nil</span>&nbsp;<span class="op" id="3504467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504471">return</span>&nbsp;<span class="ident" id="3504478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504487">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504499">return</span>&nbsp;<span class="ident" id="3504506">nil</span><br>
<span class="lineno"></span><span class="op" id="3504510">}</span>
</div>
</body>
</html>
