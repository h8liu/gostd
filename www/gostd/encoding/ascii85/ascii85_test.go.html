<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7478381">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7478436">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7478490">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7478541">package</span>&nbsp;<span class="ident" id="7478549">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7478558">import</span>&nbsp;<span class="op" id="7478565">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478568">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478577">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478583">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478596">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478607">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7478617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7478620">type</span>&nbsp;<span class="ident" id="7478625">testpair</span>&nbsp;<span class="keyword" id="7478634">struct</span>&nbsp;<span class="op" id="7478641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7478644">decoded</span><span class="op" id="7478651">,</span>&nbsp;<span class="ident" id="7478653">encoded</span>&nbsp;<span class="builtintype" id="7478661">string</span><br>
<span class="lineno"></span><span class="op" id="7478668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7478671">var</span>&nbsp;<span class="ident" id="7478675">pairs</span>&nbsp;<span class="op" id="7478681">=</span>&nbsp;<span class="op" id="7478683">[</span><span class="op" id="7478684">]</span><span class="ident" id="7478685">testpair</span><span class="op" id="7478693">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478696">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478740">&#34;&#34;</span><span class="op" id="7478742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478746">&#34;&#34;</span><span class="op" id="7478748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478751">}</span><span class="op" id="7478752">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7478755">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7478777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478781">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7478864">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478869">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7478953">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7478958">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7479036">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479041">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7479076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479080">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7479158">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479163">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7479245">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479250">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7479330">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479335">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7479415">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479420">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7479463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479466">}</span><span class="op" id="7479467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7479470">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479519">&#34;\000\000\000\000&#34;</span><span class="op" id="7479537">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7479541">&#34;z&#34;</span><span class="op" id="7479544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479547">}</span><span class="op" id="7479548">,</span><br>
<span class="lineno"></span><span class="op" id="7479550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7479553">var</span>&nbsp;<span class="ident" id="7479557">bigtest</span>&nbsp;<span class="op" id="7479565">=</span>&nbsp;<span class="ident" id="7479567">pairs</span><span class="op" id="7479572">[</span><span class="builtinfunc" id="7479573">len</span><span class="op" id="7479576">(</span><span class="ident" id="7479577">pairs</span><span class="op" id="7479582">)</span><span class="op" id="7479583">-</span><span class="num" id="7479584">1</span><span class="op" id="7479585">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7479588">func</span>&nbsp;<span class="ident" id="7479593">testEqual</span><span class="op" id="7479602">(</span><span class="ident" id="7479603">t</span>&nbsp;<span class="op" id="7479605">*</span><span class="ident" id="7479606">testing</span><span class="op" id="7479613">.</span><span class="ident" id="7479614">T</span><span class="op" id="7479615">,</span>&nbsp;<span class="ident" id="7479617">msg</span>&nbsp;<span class="builtintype" id="7479621">string</span><span class="op" id="7479627">,</span>&nbsp;<span class="ident" id="7479629">args</span>&nbsp;<span class="op" id="7479634">...</span><span class="keyword" id="7479637">interface</span><span class="op" id="7479646">{</span><span class="op" id="7479647">}</span><span class="op" id="7479648">)</span>&nbsp;<span class="builtintype" id="7479650">bool</span>&nbsp;<span class="op" id="7479655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479658">if</span>&nbsp;<span class="ident" id="7479661">args</span><span class="op" id="7479665">[</span><span class="builtinfunc" id="7479666">len</span><span class="op" id="7479669">(</span><span class="ident" id="7479670">args</span><span class="op" id="7479674">)</span><span class="op" id="7479675">-</span><span class="num" id="7479676">2</span><span class="op" id="7479677">]</span>&nbsp;<span class="op" id="7479679">!=</span>&nbsp;<span class="ident" id="7479682">args</span><span class="op" id="7479686">[</span><span class="builtinfunc" id="7479687">len</span><span class="op" id="7479690">(</span><span class="ident" id="7479691">args</span><span class="op" id="7479695">)</span><span class="op" id="7479696">-</span><span class="num" id="7479697">1</span><span class="op" id="7479698">]</span>&nbsp;<span class="op" id="7479700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479704">t</span><span class="op" id="7479705">.</span><span class="ident" id="7479706">Errorf</span><span class="op" id="7479712">(</span><span class="ident" id="7479713">msg</span><span class="op" id="7479716">,</span>&nbsp;<span class="ident" id="7479718">args</span><span class="op" id="7479722">...</span><span class="op" id="7479725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479729">return</span>&nbsp;<span class="builtintype" id="7479736">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479746">return</span>&nbsp;<span class="builtintype" id="7479753">true</span><br>
<span class="lineno"></span><span class="op" id="7479758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7479761">func</span>&nbsp;<span class="ident" id="7479766">strip85</span><span class="op" id="7479773">(</span><span class="ident" id="7479774">s</span>&nbsp;<span class="builtintype" id="7479776">string</span><span class="op" id="7479782">)</span>&nbsp;<span class="builtintype" id="7479784">string</span>&nbsp;<span class="op" id="7479791">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479794">t</span>&nbsp;<span class="op" id="7479796">:=</span>&nbsp;<span class="builtinfunc" id="7479799">make</span><span class="op" id="7479803">(</span><span class="op" id="7479804">[</span><span class="op" id="7479805">]</span><span class="builtintype" id="7479806">byte</span><span class="op" id="7479810">,</span>&nbsp;<span class="builtinfunc" id="7479812">len</span><span class="op" id="7479815">(</span><span class="ident" id="7479816">s</span><span class="op" id="7479817">)</span><span class="op" id="7479818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479821">w</span>&nbsp;<span class="op" id="7479823">:=</span>&nbsp;<span class="num" id="7479826">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479829">for</span>&nbsp;<span class="ident" id="7479833">r</span>&nbsp;<span class="op" id="7479835">:=</span>&nbsp;<span class="num" id="7479838">0</span><span class="op" id="7479839">;</span>&nbsp;<span class="ident" id="7479841">r</span>&nbsp;<span class="op" id="7479843">&lt;</span>&nbsp;<span class="builtinfunc" id="7479845">len</span><span class="op" id="7479848">(</span><span class="ident" id="7479849">s</span><span class="op" id="7479850">)</span><span class="op" id="7479851">;</span>&nbsp;<span class="ident" id="7479853">r</span><span class="op" id="7479854">++</span>&nbsp;<span class="op" id="7479857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479861">c</span>&nbsp;<span class="op" id="7479863">:=</span>&nbsp;<span class="ident" id="7479866">s</span><span class="op" id="7479867">[</span><span class="ident" id="7479868">r</span><span class="op" id="7479869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479873">if</span>&nbsp;<span class="ident" id="7479876">c</span>&nbsp;<span class="op" id="7479878">&gt;</span>&nbsp;<span class="string" id="7479880">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7479884">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479889">t</span><span class="op" id="7479890">[</span><span class="ident" id="7479891">w</span><span class="op" id="7479892">]</span>&nbsp;<span class="op" id="7479894">=</span>&nbsp;<span class="ident" id="7479896">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479901">w</span><span class="op" id="7479902">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7479910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479913">return</span>&nbsp;<span class="builtintype" id="7479920">string</span><span class="op" id="7479926">(</span><span class="ident" id="7479927">t</span><span class="op" id="7479928">[</span><span class="num" id="7479929">0</span><span class="op" id="7479930">:</span><span class="ident" id="7479931">w</span><span class="op" id="7479932">]</span><span class="op" id="7479933">)</span><br>
<span class="lineno">65</span><span class="op" id="7479935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7479938">func</span>&nbsp;<span class="ident" id="7479943">TestEncode</span><span class="op" id="7479953">(</span><span class="ident" id="7479954">t</span>&nbsp;<span class="op" id="7479956">*</span><span class="ident" id="7479957">testing</span><span class="op" id="7479964">.</span><span class="ident" id="7479965">T</span><span class="op" id="7479966">)</span>&nbsp;<span class="op" id="7479968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7479971">for</span>&nbsp;<span class="ident" id="7479975">_</span><span class="op" id="7479976">,</span>&nbsp;<span class="ident" id="7479978">p</span>&nbsp;<span class="op" id="7479980">:=</span>&nbsp;<span class="keyword" id="7479983">range</span>&nbsp;<span class="ident" id="7479989">pairs</span>&nbsp;<span class="op" id="7479995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7479999">buf</span>&nbsp;<span class="op" id="7480003">:=</span>&nbsp;<span class="builtinfunc" id="7480006">make</span><span class="op" id="7480010">(</span><span class="op" id="7480011">[</span><span class="op" id="7480012">]</span><span class="builtintype" id="7480013">byte</span><span class="op" id="7480017">,</span>&nbsp;<span class="ident" id="7480019">MaxEncodedLen</span><span class="op" id="7480032">(</span><span class="builtinfunc" id="7480033">len</span><span class="op" id="7480036">(</span><span class="ident" id="7480037">p</span><span class="op" id="7480038">.</span><span class="ident" id="7480039">decoded</span><span class="op" id="7480046">)</span><span class="op" id="7480047">)</span><span class="op" id="7480048">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480052">n</span>&nbsp;<span class="op" id="7480054">:=</span>&nbsp;<span class="ident" id="7480057">Encode</span><span class="op" id="7480063">(</span><span class="ident" id="7480064">buf</span><span class="op" id="7480067">,</span>&nbsp;<span class="op" id="7480069">[</span><span class="op" id="7480070">]</span><span class="builtintype" id="7480071">byte</span><span class="op" id="7480075">(</span><span class="ident" id="7480076">p</span><span class="op" id="7480077">.</span><span class="ident" id="7480078">decoded</span><span class="op" id="7480085">)</span><span class="op" id="7480086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480090">buf</span>&nbsp;<span class="op" id="7480094">=</span>&nbsp;<span class="ident" id="7480096">buf</span><span class="op" id="7480099">[</span><span class="num" id="7480100">0</span><span class="op" id="7480101">:</span><span class="ident" id="7480102">n</span><span class="op" id="7480103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480107">testEqual</span><span class="op" id="7480116">(</span><span class="ident" id="7480117">t</span><span class="op" id="7480118">,</span>&nbsp;<span class="string" id="7480120">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7480146">,</span>&nbsp;<span class="ident" id="7480148">p</span><span class="op" id="7480149">.</span><span class="ident" id="7480150">decoded</span><span class="op" id="7480157">,</span>&nbsp;<span class="ident" id="7480159">strip85</span><span class="op" id="7480166">(</span><span class="builtintype" id="7480167">string</span><span class="op" id="7480173">(</span><span class="ident" id="7480174">buf</span><span class="op" id="7480177">)</span><span class="op" id="7480178">)</span><span class="op" id="7480179">,</span>&nbsp;<span class="ident" id="7480181">strip85</span><span class="op" id="7480188">(</span><span class="ident" id="7480189">p</span><span class="op" id="7480190">.</span><span class="ident" id="7480191">encoded</span><span class="op" id="7480198">)</span><span class="op" id="7480199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480202">}</span><br>
<span class="lineno"></span><span class="op" id="7480204">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7480207">func</span>&nbsp;<span class="ident" id="7480212">TestEncoder</span><span class="op" id="7480223">(</span><span class="ident" id="7480224">t</span>&nbsp;<span class="op" id="7480226">*</span><span class="ident" id="7480227">testing</span><span class="op" id="7480234">.</span><span class="ident" id="7480235">T</span><span class="op" id="7480236">)</span>&nbsp;<span class="op" id="7480238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480241">for</span>&nbsp;<span class="ident" id="7480245">_</span><span class="op" id="7480246">,</span>&nbsp;<span class="ident" id="7480248">p</span>&nbsp;<span class="op" id="7480250">:=</span>&nbsp;<span class="keyword" id="7480253">range</span>&nbsp;<span class="ident" id="7480259">pairs</span>&nbsp;<span class="op" id="7480265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480269">bb</span>&nbsp;<span class="op" id="7480272">:=</span>&nbsp;<span class="op" id="7480275">&amp;</span><span class="ident" id="7480276">bytes</span><span class="op" id="7480281">.</span><span class="ident" id="7480282">Buffer</span><span class="op" id="7480288">{</span><span class="op" id="7480289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480293">encoder</span>&nbsp;<span class="op" id="7480301">:=</span>&nbsp;<span class="ident" id="7480304">NewEncoder</span><span class="op" id="7480314">(</span><span class="ident" id="7480315">bb</span><span class="op" id="7480317">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480321">encoder</span><span class="op" id="7480328">.</span><span class="ident" id="7480329">Write</span><span class="op" id="7480334">(</span><span class="op" id="7480335">[</span><span class="op" id="7480336">]</span><span class="builtintype" id="7480337">byte</span><span class="op" id="7480341">(</span><span class="ident" id="7480342">p</span><span class="op" id="7480343">.</span><span class="ident" id="7480344">decoded</span><span class="op" id="7480351">)</span><span class="op" id="7480352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480356">encoder</span><span class="op" id="7480363">.</span><span class="ident" id="7480364">Close</span><span class="op" id="7480369">(</span><span class="op" id="7480370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480374">testEqual</span><span class="op" id="7480383">(</span><span class="ident" id="7480384">t</span><span class="op" id="7480385">,</span>&nbsp;<span class="string" id="7480387">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7480413">,</span>&nbsp;<span class="ident" id="7480415">p</span><span class="op" id="7480416">.</span><span class="ident" id="7480417">decoded</span><span class="op" id="7480424">,</span>&nbsp;<span class="ident" id="7480426">strip85</span><span class="op" id="7480433">(</span><span class="ident" id="7480434">bb</span><span class="op" id="7480436">.</span><span class="ident" id="7480437">String</span><span class="op" id="7480443">(</span><span class="op" id="7480444">)</span><span class="op" id="7480445">)</span><span class="op" id="7480446">,</span>&nbsp;<span class="ident" id="7480448">strip85</span><span class="op" id="7480455">(</span><span class="ident" id="7480456">p</span><span class="op" id="7480457">.</span><span class="ident" id="7480458">encoded</span><span class="op" id="7480465">)</span><span class="op" id="7480466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480469">}</span><br>
<span class="lineno"></span><span class="op" id="7480471">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7480474">func</span>&nbsp;<span class="ident" id="7480479">TestEncoderBuffering</span><span class="op" id="7480499">(</span><span class="ident" id="7480500">t</span>&nbsp;<span class="op" id="7480502">*</span><span class="ident" id="7480503">testing</span><span class="op" id="7480510">.</span><span class="ident" id="7480511">T</span><span class="op" id="7480512">)</span>&nbsp;<span class="op" id="7480514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480517">input</span>&nbsp;<span class="op" id="7480523">:=</span>&nbsp;<span class="op" id="7480526">[</span><span class="op" id="7480527">]</span><span class="builtintype" id="7480528">byte</span><span class="op" id="7480532">(</span><span class="ident" id="7480533">bigtest</span><span class="op" id="7480540">.</span><span class="ident" id="7480541">decoded</span><span class="op" id="7480548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480551">for</span>&nbsp;<span class="ident" id="7480555">bs</span>&nbsp;<span class="op" id="7480558">:=</span>&nbsp;<span class="num" id="7480561">1</span><span class="op" id="7480562">;</span>&nbsp;<span class="ident" id="7480564">bs</span>&nbsp;<span class="op" id="7480567">&lt;=</span>&nbsp;<span class="num" id="7480570">12</span><span class="op" id="7480572">;</span>&nbsp;<span class="ident" id="7480574">bs</span><span class="op" id="7480576">++</span>&nbsp;<span class="op" id="7480579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480583">bb</span>&nbsp;<span class="op" id="7480586">:=</span>&nbsp;<span class="op" id="7480589">&amp;</span><span class="ident" id="7480590">bytes</span><span class="op" id="7480595">.</span><span class="ident" id="7480596">Buffer</span><span class="op" id="7480602">{</span><span class="op" id="7480603">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480607">encoder</span>&nbsp;<span class="op" id="7480615">:=</span>&nbsp;<span class="ident" id="7480618">NewEncoder</span><span class="op" id="7480628">(</span><span class="ident" id="7480629">bb</span><span class="op" id="7480631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480635">for</span>&nbsp;<span class="ident" id="7480639">pos</span>&nbsp;<span class="op" id="7480643">:=</span>&nbsp;<span class="num" id="7480646">0</span><span class="op" id="7480647">;</span>&nbsp;<span class="ident" id="7480649">pos</span>&nbsp;<span class="op" id="7480653">&lt;</span>&nbsp;<span class="builtinfunc" id="7480655">len</span><span class="op" id="7480658">(</span><span class="ident" id="7480659">input</span><span class="op" id="7480664">)</span><span class="op" id="7480665">;</span>&nbsp;<span class="ident" id="7480667">pos</span>&nbsp;<span class="op" id="7480671">+=</span>&nbsp;<span class="ident" id="7480674">bs</span>&nbsp;<span class="op" id="7480677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480682">end</span>&nbsp;<span class="op" id="7480686">:=</span>&nbsp;<span class="ident" id="7480689">pos</span>&nbsp;<span class="op" id="7480693">+</span>&nbsp;<span class="ident" id="7480695">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7480701">if</span>&nbsp;<span class="ident" id="7480704">end</span>&nbsp;<span class="op" id="7480708">&gt;</span>&nbsp;<span class="builtinfunc" id="7480710">len</span><span class="op" id="7480713">(</span><span class="ident" id="7480714">input</span><span class="op" id="7480719">)</span>&nbsp;<span class="op" id="7480721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480727">end</span>&nbsp;<span class="op" id="7480731">=</span>&nbsp;<span class="builtinfunc" id="7480733">len</span><span class="op" id="7480736">(</span><span class="ident" id="7480737">input</span><span class="op" id="7480742">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480752">n</span><span class="op" id="7480753">,</span>&nbsp;<span class="ident" id="7480755">err</span>&nbsp;<span class="op" id="7480759">:=</span>&nbsp;<span class="ident" id="7480762">encoder</span><span class="op" id="7480769">.</span><span class="ident" id="7480770">Write</span><span class="op" id="7480775">(</span><span class="ident" id="7480776">input</span><span class="op" id="7480781">[</span><span class="ident" id="7480782">pos</span><span class="op" id="7480785">:</span><span class="ident" id="7480786">end</span><span class="op" id="7480789">]</span><span class="op" id="7480790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480795">testEqual</span><span class="op" id="7480804">(</span><span class="ident" id="7480805">t</span><span class="op" id="7480806">,</span>&nbsp;<span class="string" id="7480808">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7480842">,</span>&nbsp;<span class="ident" id="7480844">input</span><span class="op" id="7480849">[</span><span class="ident" id="7480850">pos</span><span class="op" id="7480853">:</span><span class="ident" id="7480854">end</span><span class="op" id="7480857">]</span><span class="op" id="7480858">,</span>&nbsp;<span class="ident" id="7480860">err</span><span class="op" id="7480863">,</span>&nbsp;<span class="builtintype" id="7480865">error</span><span class="op" id="7480870">(</span><span class="ident" id="7480871">nil</span><span class="op" id="7480874">)</span><span class="op" id="7480875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480880">testEqual</span><span class="op" id="7480889">(</span><span class="ident" id="7480890">t</span><span class="op" id="7480891">,</span>&nbsp;<span class="string" id="7480893">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7480928">,</span>&nbsp;<span class="ident" id="7480930">input</span><span class="op" id="7480935">[</span><span class="ident" id="7480936">pos</span><span class="op" id="7480939">:</span><span class="ident" id="7480940">end</span><span class="op" id="7480943">]</span><span class="op" id="7480944">,</span>&nbsp;<span class="ident" id="7480946">n</span><span class="op" id="7480947">,</span>&nbsp;<span class="ident" id="7480949">end</span><span class="op" id="7480952">-</span><span class="ident" id="7480953">pos</span><span class="op" id="7480956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7480960">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480964">err</span>&nbsp;<span class="op" id="7480968">:=</span>&nbsp;<span class="ident" id="7480971">encoder</span><span class="op" id="7480978">.</span><span class="ident" id="7480979">Close</span><span class="op" id="7480984">(</span><span class="op" id="7480985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7480989">testEqual</span><span class="op" id="7480998">(</span><span class="ident" id="7480999">t</span><span class="op" id="7481000">,</span>&nbsp;<span class="string" id="7481002">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7481032">,</span>&nbsp;<span class="ident" id="7481034">err</span><span class="op" id="7481037">,</span>&nbsp;<span class="builtintype" id="7481039">error</span><span class="op" id="7481044">(</span><span class="ident" id="7481045">nil</span><span class="op" id="7481048">)</span><span class="op" id="7481049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481053">testEqual</span><span class="op" id="7481062">(</span><span class="ident" id="7481063">t</span><span class="op" id="7481064">,</span>&nbsp;<span class="string" id="7481066">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7481099">,</span>&nbsp;<span class="ident" id="7481101">bs</span><span class="op" id="7481103">,</span>&nbsp;<span class="ident" id="7481105">bigtest</span><span class="op" id="7481112">.</span><span class="ident" id="7481113">decoded</span><span class="op" id="7481120">,</span>&nbsp;<span class="ident" id="7481122">strip85</span><span class="op" id="7481129">(</span><span class="ident" id="7481130">bb</span><span class="op" id="7481132">.</span><span class="ident" id="7481133">String</span><span class="op" id="7481139">(</span><span class="op" id="7481140">)</span><span class="op" id="7481141">)</span><span class="op" id="7481142">,</span>&nbsp;<span class="ident" id="7481144">strip85</span><span class="op" id="7481151">(</span><span class="ident" id="7481152">bigtest</span><span class="op" id="7481159">.</span><span class="ident" id="7481160">encoded</span><span class="op" id="7481167">)</span><span class="op" id="7481168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481171">}</span><br>
<span class="lineno"></span><span class="op" id="7481173">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7481176">func</span>&nbsp;<span class="ident" id="7481181">TestDecode</span><span class="op" id="7481191">(</span><span class="ident" id="7481192">t</span>&nbsp;<span class="op" id="7481194">*</span><span class="ident" id="7481195">testing</span><span class="op" id="7481202">.</span><span class="ident" id="7481203">T</span><span class="op" id="7481204">)</span>&nbsp;<span class="op" id="7481206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481209">for</span>&nbsp;<span class="ident" id="7481213">_</span><span class="op" id="7481214">,</span>&nbsp;<span class="ident" id="7481216">p</span>&nbsp;<span class="op" id="7481218">:=</span>&nbsp;<span class="keyword" id="7481221">range</span>&nbsp;<span class="ident" id="7481227">pairs</span>&nbsp;<span class="op" id="7481233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481237">dbuf</span>&nbsp;<span class="op" id="7481242">:=</span>&nbsp;<span class="builtinfunc" id="7481245">make</span><span class="op" id="7481249">(</span><span class="op" id="7481250">[</span><span class="op" id="7481251">]</span><span class="builtintype" id="7481252">byte</span><span class="op" id="7481256">,</span>&nbsp;<span class="num" id="7481258">4</span><span class="op" id="7481259">*</span><span class="builtinfunc" id="7481260">len</span><span class="op" id="7481263">(</span><span class="ident" id="7481264">p</span><span class="op" id="7481265">.</span><span class="ident" id="7481266">encoded</span><span class="op" id="7481273">)</span><span class="op" id="7481274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481278">ndst</span><span class="op" id="7481282">,</span>&nbsp;<span class="ident" id="7481284">nsrc</span><span class="op" id="7481288">,</span>&nbsp;<span class="ident" id="7481290">err</span>&nbsp;<span class="op" id="7481294">:=</span>&nbsp;<span class="ident" id="7481297">Decode</span><span class="op" id="7481303">(</span><span class="ident" id="7481304">dbuf</span><span class="op" id="7481308">,</span>&nbsp;<span class="op" id="7481310">[</span><span class="op" id="7481311">]</span><span class="builtintype" id="7481312">byte</span><span class="op" id="7481316">(</span><span class="ident" id="7481317">p</span><span class="op" id="7481318">.</span><span class="ident" id="7481319">encoded</span><span class="op" id="7481326">)</span><span class="op" id="7481327">,</span>&nbsp;<span class="builtintype" id="7481329">true</span><span class="op" id="7481333">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481337">testEqual</span><span class="op" id="7481346">(</span><span class="ident" id="7481347">t</span><span class="op" id="7481348">,</span>&nbsp;<span class="string" id="7481350">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7481382">,</span>&nbsp;<span class="ident" id="7481384">p</span><span class="op" id="7481385">.</span><span class="ident" id="7481386">encoded</span><span class="op" id="7481393">,</span>&nbsp;<span class="ident" id="7481395">err</span><span class="op" id="7481398">,</span>&nbsp;<span class="builtintype" id="7481400">error</span><span class="op" id="7481405">(</span><span class="ident" id="7481406">nil</span><span class="op" id="7481409">)</span><span class="op" id="7481410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481414">testEqual</span><span class="op" id="7481423">(</span><span class="ident" id="7481424">t</span><span class="op" id="7481425">,</span>&nbsp;<span class="string" id="7481427">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7481458">,</span>&nbsp;<span class="ident" id="7481460">p</span><span class="op" id="7481461">.</span><span class="ident" id="7481462">encoded</span><span class="op" id="7481469">,</span>&nbsp;<span class="ident" id="7481471">nsrc</span><span class="op" id="7481475">,</span>&nbsp;<span class="builtinfunc" id="7481477">len</span><span class="op" id="7481480">(</span><span class="ident" id="7481481">p</span><span class="op" id="7481482">.</span><span class="ident" id="7481483">encoded</span><span class="op" id="7481490">)</span><span class="op" id="7481491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481495">testEqual</span><span class="op" id="7481504">(</span><span class="ident" id="7481505">t</span><span class="op" id="7481506">,</span>&nbsp;<span class="string" id="7481508">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7481539">,</span>&nbsp;<span class="ident" id="7481541">p</span><span class="op" id="7481542">.</span><span class="ident" id="7481543">encoded</span><span class="op" id="7481550">,</span>&nbsp;<span class="ident" id="7481552">ndst</span><span class="op" id="7481556">,</span>&nbsp;<span class="builtinfunc" id="7481558">len</span><span class="op" id="7481561">(</span><span class="ident" id="7481562">p</span><span class="op" id="7481563">.</span><span class="ident" id="7481564">decoded</span><span class="op" id="7481571">)</span><span class="op" id="7481572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481576">testEqual</span><span class="op" id="7481585">(</span><span class="ident" id="7481586">t</span><span class="op" id="7481587">,</span>&nbsp;<span class="string" id="7481589">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7481615">,</span>&nbsp;<span class="ident" id="7481617">p</span><span class="op" id="7481618">.</span><span class="ident" id="7481619">encoded</span><span class="op" id="7481626">,</span>&nbsp;<span class="builtintype" id="7481628">string</span><span class="op" id="7481634">(</span><span class="ident" id="7481635">dbuf</span><span class="op" id="7481639">[</span><span class="num" id="7481640">0</span><span class="op" id="7481641">:</span><span class="ident" id="7481642">ndst</span><span class="op" id="7481646">]</span><span class="op" id="7481647">)</span><span class="op" id="7481648">,</span>&nbsp;<span class="ident" id="7481650">p</span><span class="op" id="7481651">.</span><span class="ident" id="7481652">decoded</span><span class="op" id="7481659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481662">}</span><br>
<span class="lineno">115</span><span class="op" id="7481664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7481667">func</span>&nbsp;<span class="ident" id="7481672">TestDecoder</span><span class="op" id="7481683">(</span><span class="ident" id="7481684">t</span>&nbsp;<span class="op" id="7481686">*</span><span class="ident" id="7481687">testing</span><span class="op" id="7481694">.</span><span class="ident" id="7481695">T</span><span class="op" id="7481696">)</span>&nbsp;<span class="op" id="7481698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481701">for</span>&nbsp;<span class="ident" id="7481705">_</span><span class="op" id="7481706">,</span>&nbsp;<span class="ident" id="7481708">p</span>&nbsp;<span class="op" id="7481710">:=</span>&nbsp;<span class="keyword" id="7481713">range</span>&nbsp;<span class="ident" id="7481719">pairs</span>&nbsp;<span class="op" id="7481725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481729">decoder</span>&nbsp;<span class="op" id="7481737">:=</span>&nbsp;<span class="ident" id="7481740">NewDecoder</span><span class="op" id="7481750">(</span><span class="ident" id="7481751">strings</span><span class="op" id="7481758">.</span><span class="ident" id="7481759">NewReader</span><span class="op" id="7481768">(</span><span class="ident" id="7481769">p</span><span class="op" id="7481770">.</span><span class="ident" id="7481771">encoded</span><span class="op" id="7481778">)</span><span class="op" id="7481779">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481783">dbuf</span><span class="op" id="7481787">,</span>&nbsp;<span class="ident" id="7481789">err</span>&nbsp;<span class="op" id="7481793">:=</span>&nbsp;<span class="ident" id="7481796">ioutil</span><span class="op" id="7481802">.</span><span class="ident" id="7481803">ReadAll</span><span class="op" id="7481810">(</span><span class="ident" id="7481811">decoder</span><span class="op" id="7481818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7481822">if</span>&nbsp;<span class="ident" id="7481825">err</span>&nbsp;<span class="op" id="7481829">!=</span>&nbsp;<span class="ident" id="7481832">nil</span>&nbsp;<span class="op" id="7481836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481841">t</span><span class="op" id="7481842">.</span><span class="ident" id="7481843">Fatal</span><span class="op" id="7481848">(</span><span class="string" id="7481849">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7481862">,</span>&nbsp;<span class="ident" id="7481864">err</span><span class="op" id="7481867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7481871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481875">testEqual</span><span class="op" id="7481884">(</span><span class="ident" id="7481885">t</span><span class="op" id="7481886">,</span>&nbsp;<span class="string" id="7481888">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7481923">,</span>&nbsp;<span class="ident" id="7481925">p</span><span class="op" id="7481926">.</span><span class="ident" id="7481927">encoded</span><span class="op" id="7481934">,</span>&nbsp;<span class="builtinfunc" id="7481936">len</span><span class="op" id="7481939">(</span><span class="ident" id="7481940">dbuf</span><span class="op" id="7481944">)</span><span class="op" id="7481945">,</span>&nbsp;<span class="builtinfunc" id="7481947">len</span><span class="op" id="7481950">(</span><span class="ident" id="7481951">p</span><span class="op" id="7481952">.</span><span class="ident" id="7481953">decoded</span><span class="op" id="7481960">)</span><span class="op" id="7481961">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7481965">testEqual</span><span class="op" id="7481974">(</span><span class="ident" id="7481975">t</span><span class="op" id="7481976">,</span>&nbsp;<span class="string" id="7481978">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7482008">,</span>&nbsp;<span class="ident" id="7482010">p</span><span class="op" id="7482011">.</span><span class="ident" id="7482012">encoded</span><span class="op" id="7482019">,</span>&nbsp;<span class="builtintype" id="7482021">string</span><span class="op" id="7482027">(</span><span class="ident" id="7482028">dbuf</span><span class="op" id="7482032">)</span><span class="op" id="7482033">,</span>&nbsp;<span class="ident" id="7482035">p</span><span class="op" id="7482036">.</span><span class="ident" id="7482037">decoded</span><span class="op" id="7482044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482048">if</span>&nbsp;<span class="ident" id="7482051">err</span>&nbsp;<span class="op" id="7482055">!=</span>&nbsp;<span class="ident" id="7482058">nil</span>&nbsp;<span class="op" id="7482062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482067">testEqual</span><span class="op" id="7482076">(</span><span class="ident" id="7482077">t</span><span class="op" id="7482078">,</span>&nbsp;<span class="string" id="7482080">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7482108">,</span>&nbsp;<span class="ident" id="7482110">p</span><span class="op" id="7482111">.</span><span class="ident" id="7482112">encoded</span><span class="op" id="7482119">,</span>&nbsp;<span class="ident" id="7482121">err</span><span class="op" id="7482124">,</span>&nbsp;<span class="ident" id="7482126">io</span><span class="op" id="7482128">.</span><span class="ident" id="7482129">EOF</span><span class="op" id="7482132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482139">}</span><br>
<span class="lineno">130</span><span class="op" id="7482141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7482144">func</span>&nbsp;<span class="ident" id="7482149">TestDecoderBuffering</span><span class="op" id="7482169">(</span><span class="ident" id="7482170">t</span>&nbsp;<span class="op" id="7482172">*</span><span class="ident" id="7482173">testing</span><span class="op" id="7482180">.</span><span class="ident" id="7482181">T</span><span class="op" id="7482182">)</span>&nbsp;<span class="op" id="7482184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482187">for</span>&nbsp;<span class="ident" id="7482191">bs</span>&nbsp;<span class="op" id="7482194">:=</span>&nbsp;<span class="num" id="7482197">1</span><span class="op" id="7482198">;</span>&nbsp;<span class="ident" id="7482200">bs</span>&nbsp;<span class="op" id="7482203">&lt;=</span>&nbsp;<span class="num" id="7482206">12</span><span class="op" id="7482208">;</span>&nbsp;<span class="ident" id="7482210">bs</span><span class="op" id="7482212">++</span>&nbsp;<span class="op" id="7482215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482219">decoder</span>&nbsp;<span class="op" id="7482227">:=</span>&nbsp;<span class="ident" id="7482230">NewDecoder</span><span class="op" id="7482240">(</span><span class="ident" id="7482241">strings</span><span class="op" id="7482248">.</span><span class="ident" id="7482249">NewReader</span><span class="op" id="7482258">(</span><span class="ident" id="7482259">bigtest</span><span class="op" id="7482266">.</span><span class="ident" id="7482267">encoded</span><span class="op" id="7482274">)</span><span class="op" id="7482275">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482279">buf</span>&nbsp;<span class="op" id="7482283">:=</span>&nbsp;<span class="builtinfunc" id="7482286">make</span><span class="op" id="7482290">(</span><span class="op" id="7482291">[</span><span class="op" id="7482292">]</span><span class="builtintype" id="7482293">byte</span><span class="op" id="7482297">,</span>&nbsp;<span class="builtinfunc" id="7482299">len</span><span class="op" id="7482302">(</span><span class="ident" id="7482303">bigtest</span><span class="op" id="7482310">.</span><span class="ident" id="7482311">decoded</span><span class="op" id="7482318">)</span><span class="op" id="7482319">+</span><span class="num" id="7482320">12</span><span class="op" id="7482322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482326">var</span>&nbsp;<span class="ident" id="7482330">total</span>&nbsp;<span class="builtintype" id="7482336">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482342">for</span>&nbsp;<span class="ident" id="7482346">total</span>&nbsp;<span class="op" id="7482352">=</span>&nbsp;<span class="num" id="7482354">0</span><span class="op" id="7482355">;</span>&nbsp;<span class="ident" id="7482357">total</span>&nbsp;<span class="op" id="7482363">&lt;</span>&nbsp;<span class="builtinfunc" id="7482365">len</span><span class="op" id="7482368">(</span><span class="ident" id="7482369">bigtest</span><span class="op" id="7482376">.</span><span class="ident" id="7482377">decoded</span><span class="op" id="7482384">)</span><span class="op" id="7482385">;</span>&nbsp;<span class="op" id="7482387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482392">n</span><span class="op" id="7482393">,</span>&nbsp;<span class="ident" id="7482395">err</span>&nbsp;<span class="op" id="7482399">:=</span>&nbsp;<span class="ident" id="7482402">decoder</span><span class="op" id="7482409">.</span><span class="ident" id="7482410">Read</span><span class="op" id="7482414">(</span><span class="ident" id="7482415">buf</span><span class="op" id="7482418">[</span><span class="ident" id="7482419">total</span>&nbsp;<span class="op" id="7482425">:</span>&nbsp;<span class="ident" id="7482427">total</span><span class="op" id="7482432">+</span><span class="ident" id="7482433">bs</span><span class="op" id="7482435">]</span><span class="op" id="7482436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482441">testEqual</span><span class="op" id="7482450">(</span><span class="ident" id="7482451">t</span><span class="op" id="7482452">,</span>&nbsp;<span class="string" id="7482454">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7482499">,</span>&nbsp;<span class="ident" id="7482501">bigtest</span><span class="op" id="7482508">.</span><span class="ident" id="7482509">encoded</span><span class="op" id="7482516">,</span>&nbsp;<span class="ident" id="7482518">total</span><span class="op" id="7482523">,</span>&nbsp;<span class="ident" id="7482525">n</span><span class="op" id="7482526">,</span>&nbsp;<span class="ident" id="7482528">err</span><span class="op" id="7482531">,</span>&nbsp;<span class="builtintype" id="7482533">error</span><span class="op" id="7482538">(</span><span class="ident" id="7482539">nil</span><span class="op" id="7482542">)</span><span class="op" id="7482543">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482548">total</span>&nbsp;<span class="op" id="7482554">+=</span>&nbsp;<span class="ident" id="7482557">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482565">testEqual</span><span class="op" id="7482574">(</span><span class="ident" id="7482575">t</span><span class="op" id="7482576">,</span>&nbsp;<span class="string" id="7482578">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7482611">,</span>&nbsp;<span class="ident" id="7482613">bs</span><span class="op" id="7482615">,</span>&nbsp;<span class="ident" id="7482617">bigtest</span><span class="op" id="7482624">.</span><span class="ident" id="7482625">encoded</span><span class="op" id="7482632">,</span>&nbsp;<span class="builtintype" id="7482634">string</span><span class="op" id="7482640">(</span><span class="ident" id="7482641">buf</span><span class="op" id="7482644">[</span><span class="num" id="7482645">0</span><span class="op" id="7482646">:</span><span class="ident" id="7482647">total</span><span class="op" id="7482652">]</span><span class="op" id="7482653">)</span><span class="op" id="7482654">,</span>&nbsp;<span class="ident" id="7482656">bigtest</span><span class="op" id="7482663">.</span><span class="ident" id="7482664">decoded</span><span class="op" id="7482671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482674">}</span><br>
<span class="lineno"></span><span class="op" id="7482676">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7482679">func</span>&nbsp;<span class="ident" id="7482684">TestDecodeCorrupt</span><span class="op" id="7482701">(</span><span class="ident" id="7482702">t</span>&nbsp;<span class="op" id="7482704">*</span><span class="ident" id="7482705">testing</span><span class="op" id="7482712">.</span><span class="ident" id="7482713">T</span><span class="op" id="7482714">)</span>&nbsp;<span class="op" id="7482716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482719">type</span>&nbsp;<span class="ident" id="7482724">corrupt</span>&nbsp;<span class="keyword" id="7482732">struct</span>&nbsp;<span class="op" id="7482739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482743">e</span>&nbsp;<span class="builtintype" id="7482745">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482754">p</span>&nbsp;<span class="builtintype" id="7482756">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482764">examples</span>&nbsp;<span class="op" id="7482773">:=</span>&nbsp;<span class="op" id="7482776">[</span><span class="op" id="7482777">]</span><span class="ident" id="7482778">corrupt</span><span class="op" id="7482785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482789">{</span><span class="string" id="7482790">&#34;v&#34;</span><span class="op" id="7482793">,</span>&nbsp;<span class="num" id="7482795">0</span><span class="op" id="7482796">}</span><span class="op" id="7482797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482801">{</span><span class="string" id="7482802">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7482815">,</span>&nbsp;<span class="num" id="7482817">1</span><span class="op" id="7482818">}</span><span class="op" id="7482819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7482822">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482826">for</span>&nbsp;<span class="ident" id="7482830">_</span><span class="op" id="7482831">,</span>&nbsp;<span class="ident" id="7482833">e</span>&nbsp;<span class="op" id="7482835">:=</span>&nbsp;<span class="keyword" id="7482838">range</span>&nbsp;<span class="ident" id="7482844">examples</span>&nbsp;<span class="op" id="7482853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482857">dbuf</span>&nbsp;<span class="op" id="7482862">:=</span>&nbsp;<span class="builtinfunc" id="7482865">make</span><span class="op" id="7482869">(</span><span class="op" id="7482870">[</span><span class="op" id="7482871">]</span><span class="builtintype" id="7482872">byte</span><span class="op" id="7482876">,</span>&nbsp;<span class="num" id="7482878">4</span><span class="op" id="7482879">*</span><span class="builtinfunc" id="7482880">len</span><span class="op" id="7482883">(</span><span class="ident" id="7482884">e</span><span class="op" id="7482885">.</span><span class="ident" id="7482886">e</span><span class="op" id="7482887">)</span><span class="op" id="7482888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482892">_</span><span class="op" id="7482893">,</span>&nbsp;<span class="ident" id="7482895">_</span><span class="op" id="7482896">,</span>&nbsp;<span class="ident" id="7482898">err</span>&nbsp;<span class="op" id="7482902">:=</span>&nbsp;<span class="ident" id="7482905">Decode</span><span class="op" id="7482911">(</span><span class="ident" id="7482912">dbuf</span><span class="op" id="7482916">,</span>&nbsp;<span class="op" id="7482918">[</span><span class="op" id="7482919">]</span><span class="builtintype" id="7482920">byte</span><span class="op" id="7482924">(</span><span class="ident" id="7482925">e</span><span class="op" id="7482926">.</span><span class="ident" id="7482927">e</span><span class="op" id="7482928">)</span><span class="op" id="7482929">,</span>&nbsp;<span class="builtintype" id="7482931">true</span><span class="op" id="7482935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482939">switch</span>&nbsp;<span class="ident" id="7482946">err</span>&nbsp;<span class="op" id="7482950">:=</span>&nbsp;<span class="ident" id="7482953">err</span><span class="op" id="7482956">.</span><span class="op" id="7482957">(</span><span class="keyword" id="7482958">type</span><span class="op" id="7482962">)</span>&nbsp;<span class="op" id="7482964">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7482968">case</span>&nbsp;<span class="ident" id="7482973">CorruptInputError</span><span class="op" id="7482990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7482995">testEqual</span><span class="op" id="7483004">(</span><span class="ident" id="7483005">t</span><span class="op" id="7483006">,</span>&nbsp;<span class="string" id="7483008">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7483048">,</span>&nbsp;<span class="ident" id="7483050">e</span><span class="op" id="7483051">.</span><span class="ident" id="7483052">e</span><span class="op" id="7483053">,</span>&nbsp;<span class="builtintype" id="7483055">int</span><span class="op" id="7483058">(</span><span class="ident" id="7483059">err</span><span class="op" id="7483062">)</span><span class="op" id="7483063">,</span>&nbsp;<span class="ident" id="7483065">e</span><span class="op" id="7483066">.</span><span class="ident" id="7483067">p</span><span class="op" id="7483068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483072">default</span><span class="op" id="7483079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483084">t</span><span class="op" id="7483085">.</span><span class="ident" id="7483086">Error</span><span class="op" id="7483091">(</span><span class="string" id="7483092">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7483132">,</span>&nbsp;<span class="ident" id="7483134">e</span><span class="op" id="7483135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483139">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483142">}</span><br>
<span class="lineno"></span><span class="op" id="7483144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7483147">func</span>&nbsp;<span class="ident" id="7483152">TestBig</span><span class="op" id="7483159">(</span><span class="ident" id="7483160">t</span>&nbsp;<span class="op" id="7483162">*</span><span class="ident" id="7483163">testing</span><span class="op" id="7483170">.</span><span class="ident" id="7483171">T</span><span class="op" id="7483172">)</span>&nbsp;<span class="op" id="7483174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483177">n</span>&nbsp;<span class="op" id="7483179">:=</span>&nbsp;<span class="num" id="7483182">3</span><span class="op" id="7483183">*</span><span class="num" id="7483184">1000</span>&nbsp;<span class="op" id="7483189">+</span>&nbsp;<span class="num" id="7483191">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483194">raw</span>&nbsp;<span class="op" id="7483198">:=</span>&nbsp;<span class="builtinfunc" id="7483201">make</span><span class="op" id="7483205">(</span><span class="op" id="7483206">[</span><span class="op" id="7483207">]</span><span class="builtintype" id="7483208">byte</span><span class="op" id="7483212">,</span>&nbsp;<span class="ident" id="7483214">n</span><span class="op" id="7483215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483218">const</span>&nbsp;<span class="ident" id="7483224">alpha</span>&nbsp;<span class="op" id="7483230">=</span>&nbsp;<span class="string" id="7483232">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483298">for</span>&nbsp;<span class="ident" id="7483302">i</span>&nbsp;<span class="op" id="7483304">:=</span>&nbsp;<span class="num" id="7483307">0</span><span class="op" id="7483308">;</span>&nbsp;<span class="ident" id="7483310">i</span>&nbsp;<span class="op" id="7483312">&lt;</span>&nbsp;<span class="ident" id="7483314">n</span><span class="op" id="7483315">;</span>&nbsp;<span class="ident" id="7483317">i</span><span class="op" id="7483318">++</span>&nbsp;<span class="op" id="7483321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483325">raw</span><span class="op" id="7483328">[</span><span class="ident" id="7483329">i</span><span class="op" id="7483330">]</span>&nbsp;<span class="op" id="7483332">=</span>&nbsp;<span class="ident" id="7483334">alpha</span><span class="op" id="7483339">[</span><span class="ident" id="7483340">i</span><span class="op" id="7483341">%</span><span class="builtinfunc" id="7483342">len</span><span class="op" id="7483345">(</span><span class="ident" id="7483346">alpha</span><span class="op" id="7483351">)</span><span class="op" id="7483352">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483355">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483358">encoded</span>&nbsp;<span class="op" id="7483366">:=</span>&nbsp;<span class="builtinfunc" id="7483369">new</span><span class="op" id="7483372">(</span><span class="ident" id="7483373">bytes</span><span class="op" id="7483378">.</span><span class="ident" id="7483379">Buffer</span><span class="op" id="7483385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483388">w</span>&nbsp;<span class="op" id="7483390">:=</span>&nbsp;<span class="ident" id="7483393">NewEncoder</span><span class="op" id="7483403">(</span><span class="ident" id="7483404">encoded</span><span class="op" id="7483411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483414">nn</span><span class="op" id="7483416">,</span>&nbsp;<span class="ident" id="7483418">err</span>&nbsp;<span class="op" id="7483422">:=</span>&nbsp;<span class="ident" id="7483425">w</span><span class="op" id="7483426">.</span><span class="ident" id="7483427">Write</span><span class="op" id="7483432">(</span><span class="ident" id="7483433">raw</span><span class="op" id="7483436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483439">if</span>&nbsp;<span class="ident" id="7483442">nn</span>&nbsp;<span class="op" id="7483445">!=</span>&nbsp;<span class="ident" id="7483448">n</span>&nbsp;<span class="op" id="7483450">||</span>&nbsp;<span class="ident" id="7483453">err</span>&nbsp;<span class="op" id="7483457">!=</span>&nbsp;<span class="ident" id="7483460">nil</span>&nbsp;<span class="op" id="7483464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483468">t</span><span class="op" id="7483469">.</span><span class="ident" id="7483470">Fatalf</span><span class="op" id="7483476">(</span><span class="string" id="7483477">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7483519">,</span>&nbsp;<span class="ident" id="7483521">nn</span><span class="op" id="7483523">,</span>&nbsp;<span class="ident" id="7483525">err</span><span class="op" id="7483528">,</span>&nbsp;<span class="ident" id="7483530">n</span><span class="op" id="7483531">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483537">err</span>&nbsp;<span class="op" id="7483541">=</span>&nbsp;<span class="ident" id="7483543">w</span><span class="op" id="7483544">.</span><span class="ident" id="7483545">Close</span><span class="op" id="7483550">(</span><span class="op" id="7483551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483554">if</span>&nbsp;<span class="ident" id="7483557">err</span>&nbsp;<span class="op" id="7483561">!=</span>&nbsp;<span class="ident" id="7483564">nil</span>&nbsp;<span class="op" id="7483568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483572">t</span><span class="op" id="7483573">.</span><span class="ident" id="7483574">Fatalf</span><span class="op" id="7483580">(</span><span class="string" id="7483581">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7483612">,</span>&nbsp;<span class="ident" id="7483614">err</span><span class="op" id="7483617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483620">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483623">decoded</span><span class="op" id="7483630">,</span>&nbsp;<span class="ident" id="7483632">err</span>&nbsp;<span class="op" id="7483636">:=</span>&nbsp;<span class="ident" id="7483639">ioutil</span><span class="op" id="7483645">.</span><span class="ident" id="7483646">ReadAll</span><span class="op" id="7483653">(</span><span class="ident" id="7483654">NewDecoder</span><span class="op" id="7483664">(</span><span class="ident" id="7483665">encoded</span><span class="op" id="7483672">)</span><span class="op" id="7483673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483676">if</span>&nbsp;<span class="ident" id="7483679">err</span>&nbsp;<span class="op" id="7483683">!=</span>&nbsp;<span class="ident" id="7483686">nil</span>&nbsp;<span class="op" id="7483690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483694">t</span><span class="op" id="7483695">.</span><span class="ident" id="7483696">Fatalf</span><span class="op" id="7483702">(</span><span class="string" id="7483703">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7483736">,</span>&nbsp;<span class="ident" id="7483738">err</span><span class="op" id="7483741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483748">if</span>&nbsp;<span class="op" id="7483751">!</span><span class="ident" id="7483752">bytes</span><span class="op" id="7483757">.</span><span class="ident" id="7483758">Equal</span><span class="op" id="7483763">(</span><span class="ident" id="7483764">raw</span><span class="op" id="7483767">,</span>&nbsp;<span class="ident" id="7483769">decoded</span><span class="op" id="7483776">)</span>&nbsp;<span class="op" id="7483778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483782">var</span>&nbsp;<span class="ident" id="7483786">i</span>&nbsp;<span class="builtintype" id="7483788">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483794">for</span>&nbsp;<span class="ident" id="7483798">i</span>&nbsp;<span class="op" id="7483800">=</span>&nbsp;<span class="num" id="7483802">0</span><span class="op" id="7483803">;</span>&nbsp;<span class="ident" id="7483805">i</span>&nbsp;<span class="op" id="7483807">&lt;</span>&nbsp;<span class="builtinfunc" id="7483809">len</span><span class="op" id="7483812">(</span><span class="ident" id="7483813">decoded</span><span class="op" id="7483820">)</span>&nbsp;<span class="op" id="7483822">&amp;&amp;</span>&nbsp;<span class="ident" id="7483825">i</span>&nbsp;<span class="op" id="7483827">&lt;</span>&nbsp;<span class="builtinfunc" id="7483829">len</span><span class="op" id="7483832">(</span><span class="ident" id="7483833">raw</span><span class="op" id="7483836">)</span><span class="op" id="7483837">;</span>&nbsp;<span class="ident" id="7483839">i</span><span class="op" id="7483840">++</span>&nbsp;<span class="op" id="7483843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483848">if</span>&nbsp;<span class="ident" id="7483851">decoded</span><span class="op" id="7483858">[</span><span class="ident" id="7483859">i</span><span class="op" id="7483860">]</span>&nbsp;<span class="op" id="7483862">!=</span>&nbsp;<span class="ident" id="7483865">raw</span><span class="op" id="7483868">[</span><span class="ident" id="7483869">i</span><span class="op" id="7483870">]</span>&nbsp;<span class="op" id="7483872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7483878">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7483895">t</span><span class="op" id="7483896">.</span><span class="ident" id="7483897">Errorf</span><span class="op" id="7483903">(</span><span class="string" id="7483904">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7483956">,</span>&nbsp;<span class="ident" id="7483958">n</span><span class="op" id="7483959">,</span>&nbsp;<span class="ident" id="7483961">i</span><span class="op" id="7483962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7483965">}</span><br>
<span class="lineno"></span><span class="op" id="7483967">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7483970">func</span>&nbsp;<span class="ident" id="7483975">TestDecoderInternalWhitespace</span><span class="op" id="7484004">(</span><span class="ident" id="7484005">t</span>&nbsp;<span class="op" id="7484007">*</span><span class="ident" id="7484008">testing</span><span class="op" id="7484015">.</span><span class="ident" id="7484016">T</span><span class="op" id="7484017">)</span>&nbsp;<span class="op" id="7484019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484022">s</span>&nbsp;<span class="op" id="7484024">:=</span>&nbsp;<span class="ident" id="7484027">strings</span><span class="op" id="7484034">.</span><span class="ident" id="7484035">Repeat</span><span class="op" id="7484041">(</span><span class="string" id="7484042">&#34;&nbsp;&#34;</span><span class="op" id="7484045">,</span>&nbsp;<span class="num" id="7484047">2048</span><span class="op" id="7484051">)</span>&nbsp;<span class="op" id="7484053">+</span>&nbsp;<span class="string" id="7484055">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484060">decoded</span><span class="op" id="7484067">,</span>&nbsp;<span class="ident" id="7484069">err</span>&nbsp;<span class="op" id="7484073">:=</span>&nbsp;<span class="ident" id="7484076">ioutil</span><span class="op" id="7484082">.</span><span class="ident" id="7484083">ReadAll</span><span class="op" id="7484090">(</span><span class="ident" id="7484091">NewDecoder</span><span class="op" id="7484101">(</span><span class="ident" id="7484102">strings</span><span class="op" id="7484109">.</span><span class="ident" id="7484110">NewReader</span><span class="op" id="7484119">(</span><span class="ident" id="7484120">s</span><span class="op" id="7484121">)</span><span class="op" id="7484122">)</span><span class="op" id="7484123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484126">if</span>&nbsp;<span class="ident" id="7484129">err</span>&nbsp;<span class="op" id="7484133">!=</span>&nbsp;<span class="ident" id="7484136">nil</span>&nbsp;<span class="op" id="7484140">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484144">t</span><span class="op" id="7484145">.</span><span class="ident" id="7484146">Errorf</span><span class="op" id="7484152">(</span><span class="string" id="7484153">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7484175">,</span>&nbsp;<span class="ident" id="7484177">err</span><span class="op" id="7484180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7484186">if</span>&nbsp;<span class="ident" id="7484189">want</span>&nbsp;<span class="op" id="7484194">:=</span>&nbsp;<span class="op" id="7484197">[</span><span class="op" id="7484198">]</span><span class="builtintype" id="7484199">byte</span><span class="op" id="7484203">(</span><span class="string" id="7484204">&#34;\000\000\000\000&#34;</span><span class="op" id="7484222">)</span><span class="op" id="7484223">;</span>&nbsp;<span class="op" id="7484225">!</span><span class="ident" id="7484226">bytes</span><span class="op" id="7484231">.</span><span class="ident" id="7484232">Equal</span><span class="op" id="7484237">(</span><span class="ident" id="7484238">want</span><span class="op" id="7484242">,</span>&nbsp;<span class="ident" id="7484244">decoded</span><span class="op" id="7484251">)</span>&nbsp;<span class="op" id="7484253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7484257">t</span><span class="op" id="7484258">.</span><span class="ident" id="7484259">Errorf</span><span class="op" id="7484265">(</span><span class="string" id="7484266">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7484298">,</span>&nbsp;<span class="ident" id="7484300">decoded</span><span class="op" id="7484307">,</span>&nbsp;<span class="ident" id="7484309">want</span><span class="op" id="7484313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7484316">}</span><br>
<span class="lineno">210</span><span class="op" id="7484318">}</span>
</div>
</body>
</html>
