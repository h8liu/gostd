<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html" class="current">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6130939">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6130994">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6131048">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6131099">//&nbsp;Package&nbsp;debug&nbsp;contains&nbsp;facilities&nbsp;for&nbsp;programs&nbsp;to&nbsp;debug&nbsp;themselves&nbsp;while</span><br>
<span class="lineno"></span><span class="comment" id="6131175">//&nbsp;they&nbsp;are&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6131196">package</span>&nbsp;<span class="ident" id="6131204">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6131211">import</span>&nbsp;<span class="op" id="6131218">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6131221">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6131230">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6131237">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6131250">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6131256">&#34;runtime&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6131266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6131269">var</span>&nbsp;<span class="op" id="6131273">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131276">dunno</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6131286">=</span>&nbsp;<span class="op" id="6131288">[</span><span class="op" id="6131289">]</span><span class="builtintype" id="6131290">byte</span><span class="op" id="6131294">(</span><span class="string" id="6131295">&#34;???&#34;</span><span class="op" id="6131300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131303">centerDot</span>&nbsp;<span class="op" id="6131313">=</span>&nbsp;<span class="op" id="6131315">[</span><span class="op" id="6131316">]</span><span class="builtintype" id="6131317">byte</span><span class="op" id="6131321">(</span><span class="string" id="6131322">&#34;Â·&#34;</span><span class="op" id="6131326">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131329">dot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6131339">=</span>&nbsp;<span class="op" id="6131341">[</span><span class="op" id="6131342">]</span><span class="builtintype" id="6131343">byte</span><span class="op" id="6131347">(</span><span class="string" id="6131348">&#34;.&#34;</span><span class="op" id="6131351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131354">slash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6131364">=</span>&nbsp;<span class="op" id="6131366">[</span><span class="op" id="6131367">]</span><span class="builtintype" id="6131368">byte</span><span class="op" id="6131372">(</span><span class="string" id="6131373">&#34;/&#34;</span><span class="op" id="6131376">)</span><br>
<span class="lineno"></span><span class="op" id="6131378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6131381">//&nbsp;PrintStack&nbsp;prints&nbsp;to&nbsp;standard&nbsp;error&nbsp;the&nbsp;stack&nbsp;trace&nbsp;returned&nbsp;by&nbsp;Stack.</span><br>
<span class="lineno">25</span><span class="keyword" id="6131455">func</span>&nbsp;<span class="ident" id="6131460">PrintStack</span><span class="op" id="6131470">(</span><span class="op" id="6131471">)</span>&nbsp;<span class="op" id="6131473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131476">os</span><span class="op" id="6131478">.</span><span class="ident" id="6131479">Stderr</span><span class="op" id="6131485">.</span><span class="ident" id="6131486">Write</span><span class="op" id="6131491">(</span><span class="ident" id="6131492">stack</span><span class="op" id="6131497">(</span><span class="op" id="6131498">)</span><span class="op" id="6131499">)</span><br>
<span class="lineno"></span><span class="op" id="6131501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6131504">//&nbsp;Stack&nbsp;returns&nbsp;a&nbsp;formatted&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.</span><br>
<span class="lineno">30</span><span class="comment" id="6131577">//&nbsp;For&nbsp;each&nbsp;routine,&nbsp;it&nbsp;includes&nbsp;the&nbsp;source&nbsp;line&nbsp;information&nbsp;and&nbsp;PC&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="6131652">//&nbsp;then&nbsp;attempts&nbsp;to&nbsp;discover,&nbsp;for&nbsp;Go&nbsp;functions,&nbsp;the&nbsp;calling&nbsp;function&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6131724">//&nbsp;method&nbsp;and&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;line&nbsp;containing&nbsp;the&nbsp;invocation.</span><br>
<span class="lineno"></span><span class="comment" id="6131786">//</span><br>
<span class="lineno"></span><span class="comment" id="6131789">//&nbsp;This&nbsp;function&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;package&nbsp;runtime&#39;s&nbsp;Stack&nbsp;instead.</span><br>
<span class="lineno">35</span><span class="keyword" id="6131858">func</span>&nbsp;<span class="ident" id="6131863">Stack</span><span class="op" id="6131868">(</span><span class="op" id="6131869">)</span>&nbsp;<span class="op" id="6131871">[</span><span class="op" id="6131872">]</span><span class="builtintype" id="6131873">byte</span>&nbsp;<span class="op" id="6131878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6131881">return</span>&nbsp;<span class="ident" id="6131888">stack</span><span class="op" id="6131893">(</span><span class="op" id="6131894">)</span><br>
<span class="lineno"></span><span class="op" id="6131896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6131899">//&nbsp;stack&nbsp;implements&nbsp;Stack,&nbsp;skipping&nbsp;2&nbsp;frames</span><br>
<span class="lineno">40</span><span class="keyword" id="6131944">func</span>&nbsp;<span class="ident" id="6131949">stack</span><span class="op" id="6131954">(</span><span class="op" id="6131955">)</span>&nbsp;<span class="op" id="6131957">[</span><span class="op" id="6131958">]</span><span class="builtintype" id="6131959">byte</span>&nbsp;<span class="op" id="6131964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6131967">buf</span>&nbsp;<span class="op" id="6131971">:=</span>&nbsp;<span class="builtinfunc" id="6131974">new</span><span class="op" id="6131977">(</span><span class="ident" id="6131978">bytes</span><span class="op" id="6131983">.</span><span class="ident" id="6131984">Buffer</span><span class="op" id="6131990">)</span>&nbsp;<span class="comment" id="6131992">//&nbsp;the&nbsp;returned&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6132014">//&nbsp;As&nbsp;we&nbsp;loop,&nbsp;we&nbsp;open&nbsp;files&nbsp;and&nbsp;read&nbsp;them.&nbsp;These&nbsp;variables&nbsp;record&nbsp;the&nbsp;currently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6132096">//&nbsp;loaded&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132113">var</span>&nbsp;<span class="ident" id="6132117">lines</span>&nbsp;<span class="op" id="6132123">[</span><span class="op" id="6132124">]</span><span class="op" id="6132125">[</span><span class="op" id="6132126">]</span><span class="builtintype" id="6132127">byte</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132133">var</span>&nbsp;<span class="ident" id="6132137">lastFile</span>&nbsp;<span class="builtintype" id="6132146">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132154">for</span>&nbsp;<span class="ident" id="6132158">i</span>&nbsp;<span class="op" id="6132160">:=</span>&nbsp;<span class="num" id="6132163">2</span><span class="op" id="6132164">;</span>&nbsp;<span class="op" id="6132166">;</span>&nbsp;<span class="ident" id="6132168">i</span><span class="op" id="6132169">++</span>&nbsp;<span class="op" id="6132172">{</span>&nbsp;<span class="comment" id="6132174">//&nbsp;Caller&nbsp;we&nbsp;care&nbsp;about&nbsp;is&nbsp;the&nbsp;user,&nbsp;2&nbsp;frames&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132225">pc</span><span class="op" id="6132227">,</span>&nbsp;<span class="ident" id="6132229">file</span><span class="op" id="6132233">,</span>&nbsp;<span class="ident" id="6132235">line</span><span class="op" id="6132239">,</span>&nbsp;<span class="ident" id="6132241">ok</span>&nbsp;<span class="op" id="6132244">:=</span>&nbsp;<span class="ident" id="6132247">runtime</span><span class="op" id="6132254">.</span><span class="ident" id="6132255">Caller</span><span class="op" id="6132261">(</span><span class="ident" id="6132262">i</span><span class="op" id="6132263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132267">if</span>&nbsp;<span class="op" id="6132270">!</span><span class="ident" id="6132271">ok</span>&nbsp;<span class="op" id="6132274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132279">break</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6132287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6132291">//&nbsp;Print&nbsp;this&nbsp;much&nbsp;at&nbsp;least.&nbsp;&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;find&nbsp;the&nbsp;source,&nbsp;it&nbsp;won&#39;t&nbsp;show.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132367">fmt</span><span class="op" id="6132370">.</span><span class="ident" id="6132371">Fprintf</span><span class="op" id="6132378">(</span><span class="ident" id="6132379">buf</span><span class="op" id="6132382">,</span>&nbsp;<span class="string" id="6132384">&#34;%s:%d&nbsp;(0x%x)\n&#34;</span><span class="op" id="6132400">,</span>&nbsp;<span class="ident" id="6132402">file</span><span class="op" id="6132406">,</span>&nbsp;<span class="ident" id="6132408">line</span><span class="op" id="6132412">,</span>&nbsp;<span class="ident" id="6132414">pc</span><span class="op" id="6132416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132420">if</span>&nbsp;<span class="ident" id="6132423">file</span>&nbsp;<span class="op" id="6132428">!=</span>&nbsp;<span class="ident" id="6132431">lastFile</span>&nbsp;<span class="op" id="6132440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132445">data</span><span class="op" id="6132449">,</span>&nbsp;<span class="ident" id="6132451">err</span>&nbsp;<span class="op" id="6132455">:=</span>&nbsp;<span class="ident" id="6132458">ioutil</span><span class="op" id="6132464">.</span><span class="ident" id="6132465">ReadFile</span><span class="op" id="6132473">(</span><span class="ident" id="6132474">file</span><span class="op" id="6132478">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132483">if</span>&nbsp;<span class="ident" id="6132486">err</span>&nbsp;<span class="op" id="6132490">!=</span>&nbsp;<span class="builtintype" id="6132493">nil</span>&nbsp;<span class="op" id="6132497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132503">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6132515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132520">lines</span>&nbsp;<span class="op" id="6132526">=</span>&nbsp;<span class="ident" id="6132528">bytes</span><span class="op" id="6132533">.</span><span class="ident" id="6132534">Split</span><span class="op" id="6132539">(</span><span class="ident" id="6132540">data</span><span class="op" id="6132544">,</span>&nbsp;<span class="op" id="6132546">[</span><span class="op" id="6132547">]</span><span class="builtintype" id="6132548">byte</span><span class="op" id="6132552">{</span><span class="string" id="6132553">&#39;\n&#39;</span><span class="op" id="6132557">}</span><span class="op" id="6132558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132563">lastFile</span>&nbsp;<span class="op" id="6132572">=</span>&nbsp;<span class="ident" id="6132574">file</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6132581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132585">line</span><span class="op" id="6132589">--</span>&nbsp;<span class="comment" id="6132592">//&nbsp;in&nbsp;stack&nbsp;trace,&nbsp;lines&nbsp;are&nbsp;1-indexed&nbsp;but&nbsp;our&nbsp;array&nbsp;is&nbsp;0-indexed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6132660">fmt</span><span class="op" id="6132663">.</span><span class="ident" id="6132664">Fprintf</span><span class="op" id="6132671">(</span><span class="ident" id="6132672">buf</span><span class="op" id="6132675">,</span>&nbsp;<span class="string" id="6132677">&#34;\t%s:&nbsp;%s\n&#34;</span><span class="op" id="6132689">,</span>&nbsp;<span class="ident" id="6132691">function</span><span class="op" id="6132699">(</span><span class="ident" id="6132700">pc</span><span class="op" id="6132702">)</span><span class="op" id="6132703">,</span>&nbsp;<span class="ident" id="6132705">source</span><span class="op" id="6132711">(</span><span class="ident" id="6132712">lines</span><span class="op" id="6132717">,</span>&nbsp;<span class="ident" id="6132719">line</span><span class="op" id="6132723">)</span><span class="op" id="6132724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6132727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132730">return</span>&nbsp;<span class="ident" id="6132737">buf</span><span class="op" id="6132740">.</span><span class="ident" id="6132741">Bytes</span><span class="op" id="6132746">(</span><span class="op" id="6132747">)</span><br>
<span class="lineno">65</span><span class="op" id="6132749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6132752">//&nbsp;source&nbsp;returns&nbsp;a&nbsp;space-trimmed&nbsp;slice&nbsp;of&nbsp;the&nbsp;n&#39;th&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="6132810">func</span>&nbsp;<span class="ident" id="6132815">source</span><span class="op" id="6132821">(</span><span class="ident" id="6132822">lines</span>&nbsp;<span class="op" id="6132828">[</span><span class="op" id="6132829">]</span><span class="op" id="6132830">[</span><span class="op" id="6132831">]</span><span class="builtintype" id="6132832">byte</span><span class="op" id="6132836">,</span>&nbsp;<span class="ident" id="6132838">n</span>&nbsp;<span class="builtintype" id="6132840">int</span><span class="op" id="6132843">)</span>&nbsp;<span class="op" id="6132845">[</span><span class="op" id="6132846">]</span><span class="builtintype" id="6132847">byte</span>&nbsp;<span class="op" id="6132852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132855">if</span>&nbsp;<span class="ident" id="6132858">n</span>&nbsp;<span class="op" id="6132860">&lt;</span>&nbsp;<span class="num" id="6132862">0</span>&nbsp;<span class="op" id="6132864">||</span>&nbsp;<span class="ident" id="6132867">n</span>&nbsp;<span class="op" id="6132869">&gt;=</span>&nbsp;<span class="builtinfunc" id="6132872">len</span><span class="op" id="6132875">(</span><span class="ident" id="6132876">lines</span><span class="op" id="6132881">)</span>&nbsp;<span class="op" id="6132883">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132887">return</span>&nbsp;<span class="ident" id="6132894">dunno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6132901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6132904">return</span>&nbsp;<span class="ident" id="6132911">bytes</span><span class="op" id="6132916">.</span><span class="ident" id="6132917">Trim</span><span class="op" id="6132921">(</span><span class="ident" id="6132922">lines</span><span class="op" id="6132927">[</span><span class="ident" id="6132928">n</span><span class="op" id="6132929">]</span><span class="op" id="6132930">,</span>&nbsp;<span class="string" id="6132932">&#34;&nbsp;\t&#34;</span><span class="op" id="6132937">)</span><br>
<span class="lineno"></span><span class="op" id="6132939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6132942">//&nbsp;function&nbsp;returns,&nbsp;if&nbsp;possible,&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;function&nbsp;containing&nbsp;the&nbsp;PC.</span><br>
<span class="lineno"></span><span class="keyword" id="6133020">func</span>&nbsp;<span class="ident" id="6133025">function</span><span class="op" id="6133033">(</span><span class="ident" id="6133034">pc</span>&nbsp;<span class="builtintype" id="6133037">uintptr</span><span class="op" id="6133044">)</span>&nbsp;<span class="op" id="6133046">[</span><span class="op" id="6133047">]</span><span class="builtintype" id="6133048">byte</span>&nbsp;<span class="op" id="6133053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133056">fn</span>&nbsp;<span class="op" id="6133059">:=</span>&nbsp;<span class="ident" id="6133062">runtime</span><span class="op" id="6133069">.</span><span class="ident" id="6133070">FuncForPC</span><span class="op" id="6133079">(</span><span class="ident" id="6133080">pc</span><span class="op" id="6133082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133085">if</span>&nbsp;<span class="ident" id="6133088">fn</span>&nbsp;<span class="op" id="6133091">==</span>&nbsp;<span class="builtintype" id="6133094">nil</span>&nbsp;<span class="op" id="6133098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133102">return</span>&nbsp;<span class="ident" id="6133109">dunno</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6133116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133119">name</span>&nbsp;<span class="op" id="6133124">:=</span>&nbsp;<span class="op" id="6133127">[</span><span class="op" id="6133128">]</span><span class="builtintype" id="6133129">byte</span><span class="op" id="6133133">(</span><span class="ident" id="6133134">fn</span><span class="op" id="6133136">.</span><span class="ident" id="6133137">Name</span><span class="op" id="6133141">(</span><span class="op" id="6133142">)</span><span class="op" id="6133143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133146">//&nbsp;The&nbsp;name&nbsp;includes&nbsp;the&nbsp;path&nbsp;name&nbsp;to&nbsp;the&nbsp;package,&nbsp;which&nbsp;is&nbsp;unnecessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133219">//&nbsp;since&nbsp;the&nbsp;file&nbsp;name&nbsp;is&nbsp;already&nbsp;included.&nbsp;&nbsp;Plus,&nbsp;it&nbsp;has&nbsp;center&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133291">//&nbsp;That&nbsp;is,&nbsp;we&nbsp;see</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133311">//&nbsp;&nbsp;&nbsp;&nbsp;runtime/debug.*TÂ·ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133343">//&nbsp;and&nbsp;want</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133356">//&nbsp;&nbsp;&nbsp;&nbsp;*T.ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133373">//&nbsp;Since&nbsp;the&nbsp;package&nbsp;path&nbsp;might&nbsp;contains&nbsp;dots&nbsp;(e.g.&nbsp;code.google.com/...),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6133448">//&nbsp;we&nbsp;first&nbsp;remove&nbsp;the&nbsp;path&nbsp;prefix&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133501">if</span>&nbsp;<span class="ident" id="6133504">lastslash</span>&nbsp;<span class="op" id="6133514">:=</span>&nbsp;<span class="ident" id="6133517">bytes</span><span class="op" id="6133522">.</span><span class="ident" id="6133523">LastIndex</span><span class="op" id="6133532">(</span><span class="ident" id="6133533">name</span><span class="op" id="6133537">,</span>&nbsp;<span class="ident" id="6133539">slash</span><span class="op" id="6133544">)</span><span class="op" id="6133545">;</span>&nbsp;<span class="ident" id="6133547">lastslash</span>&nbsp;<span class="op" id="6133557">&gt;=</span>&nbsp;<span class="num" id="6133560">0</span>&nbsp;<span class="op" id="6133562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133566">name</span>&nbsp;<span class="op" id="6133571">=</span>&nbsp;<span class="ident" id="6133573">name</span><span class="op" id="6133577">[</span><span class="ident" id="6133578">lastslash</span><span class="op" id="6133587">+</span><span class="num" id="6133588">1</span><span class="op" id="6133589">:</span><span class="op" id="6133590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6133593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133596">if</span>&nbsp;<span class="ident" id="6133599">period</span>&nbsp;<span class="op" id="6133606">:=</span>&nbsp;<span class="ident" id="6133609">bytes</span><span class="op" id="6133614">.</span><span class="ident" id="6133615">Index</span><span class="op" id="6133620">(</span><span class="ident" id="6133621">name</span><span class="op" id="6133625">,</span>&nbsp;<span class="ident" id="6133627">dot</span><span class="op" id="6133630">)</span><span class="op" id="6133631">;</span>&nbsp;<span class="ident" id="6133633">period</span>&nbsp;<span class="op" id="6133640">&gt;=</span>&nbsp;<span class="num" id="6133643">0</span>&nbsp;<span class="op" id="6133645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133649">name</span>&nbsp;<span class="op" id="6133654">=</span>&nbsp;<span class="ident" id="6133656">name</span><span class="op" id="6133660">[</span><span class="ident" id="6133661">period</span><span class="op" id="6133667">+</span><span class="num" id="6133668">1</span><span class="op" id="6133669">:</span><span class="op" id="6133670">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6133673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6133676">name</span>&nbsp;<span class="op" id="6133681">=</span>&nbsp;<span class="ident" id="6133683">bytes</span><span class="op" id="6133688">.</span><span class="ident" id="6133689">Replace</span><span class="op" id="6133696">(</span><span class="ident" id="6133697">name</span><span class="op" id="6133701">,</span>&nbsp;<span class="ident" id="6133703">centerDot</span><span class="op" id="6133712">,</span>&nbsp;<span class="ident" id="6133714">dot</span><span class="op" id="6133717">,</span>&nbsp;<span class="op" id="6133719">-</span><span class="num" id="6133720">1</span><span class="op" id="6133721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6133724">return</span>&nbsp;<span class="ident" id="6133731">name</span><br>
<span class="lineno"></span><span class="op" id="6133736">}</span>
</div>
</body>
</html>
