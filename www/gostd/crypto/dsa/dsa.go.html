<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4507968">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4508023">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4508077">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4508128">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4508213">package</span>&nbsp;<span class="ident" id="4508221">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4508226">import</span>&nbsp;<span class="op" id="4508233">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4508236">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4508246">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4508252">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4508263">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508266">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4508345">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4508421">type</span>&nbsp;<span class="ident" id="4508426">Parameters</span>&nbsp;<span class="keyword" id="4508437">struct</span>&nbsp;<span class="op" id="4508444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508447">P</span><span class="op" id="4508448">,</span>&nbsp;<span class="ident" id="4508450">Q</span><span class="op" id="4508451">,</span>&nbsp;<span class="ident" id="4508453">G</span>&nbsp;<span class="op" id="4508455">*</span><span class="ident" id="4508456">big</span><span class="op" id="4508459">.</span><span class="ident" id="4508460">Int</span><br>
<span class="lineno"></span><span class="op" id="4508464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4508467">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4508509">type</span>&nbsp;<span class="ident" id="4508514">PublicKey</span>&nbsp;<span class="keyword" id="4508524">struct</span>&nbsp;<span class="op" id="4508531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508534">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508546">Y</span>&nbsp;<span class="op" id="4508548">*</span><span class="ident" id="4508549">big</span><span class="op" id="4508552">.</span><span class="ident" id="4508553">Int</span><br>
<span class="lineno"></span><span class="op" id="4508557">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4508560">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4508604">type</span>&nbsp;<span class="ident" id="4508609">PrivateKey</span>&nbsp;<span class="keyword" id="4508620">struct</span>&nbsp;<span class="op" id="4508627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508630">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508641">X</span>&nbsp;<span class="op" id="4508643">*</span><span class="ident" id="4508644">big</span><span class="op" id="4508647">.</span><span class="ident" id="4508648">Int</span><br>
<span class="lineno">30</span><span class="op" id="4508652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508655">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4508732">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4508808">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4508887">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4508918">var</span>&nbsp;<span class="ident" id="4508922">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4508942">=</span>&nbsp;<span class="ident" id="4508944">errors</span><span class="op" id="4508950">.</span><span class="ident" id="4508951">New</span><span class="op" id="4508954">(</span><span class="string" id="4508955">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4508987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508990">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4509069">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4509129">type</span>&nbsp;<span class="ident" id="4509134">ParameterSizes</span>&nbsp;<span class="builtintype" id="4509149">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4509154">const</span>&nbsp;<span class="op" id="4509160">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509163">L1024N160</span>&nbsp;<span class="ident" id="4509173">ParameterSizes</span>&nbsp;<span class="op" id="4509188">=</span>&nbsp;<span class="ident" id="4509190">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509196">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509207">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509218">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4509228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509231">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4509311">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4509380">const</span>&nbsp;<span class="ident" id="4509386">numMRTests</span>&nbsp;<span class="op" id="4509397">=</span>&nbsp;<span class="num" id="4509399">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509403">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4509481">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4509541">func</span>&nbsp;<span class="ident" id="4509546">GenerateParameters</span><span class="op" id="4509564">(</span><span class="ident" id="4509565">params</span>&nbsp;<span class="op" id="4509572">*</span><span class="ident" id="4509573">Parameters</span><span class="op" id="4509583">,</span>&nbsp;<span class="ident" id="4509585">rand</span>&nbsp;<span class="ident" id="4509590">io</span><span class="op" id="4509592">.</span><span class="ident" id="4509593">Reader</span><span class="op" id="4509599">,</span>&nbsp;<span class="ident" id="4509601">sizes</span>&nbsp;<span class="ident" id="4509607">ParameterSizes</span><span class="op" id="4509621">)</span>&nbsp;<span class="op" id="4509623">(</span><span class="ident" id="4509624">err</span>&nbsp;<span class="builtintype" id="4509628">error</span><span class="op" id="4509633">)</span>&nbsp;<span class="op" id="4509635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509638">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509709">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509778">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4509843">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509884">var</span>&nbsp;<span class="ident" id="4509888">L</span><span class="op" id="4509889">,</span>&nbsp;<span class="ident" id="4509891">N</span>&nbsp;<span class="builtintype" id="4509893">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509898">switch</span>&nbsp;<span class="ident" id="4509905">sizes</span>&nbsp;<span class="op" id="4509911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509914">case</span>&nbsp;<span class="ident" id="4509919">L1024N160</span><span class="op" id="4509928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509932">L</span>&nbsp;<span class="op" id="4509934">=</span>&nbsp;<span class="num" id="4509936">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509943">N</span>&nbsp;<span class="op" id="4509945">=</span>&nbsp;<span class="num" id="4509947">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509952">case</span>&nbsp;<span class="ident" id="4509957">L2048N224</span><span class="op" id="4509966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509970">L</span>&nbsp;<span class="op" id="4509972">=</span>&nbsp;<span class="num" id="4509974">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509981">N</span>&nbsp;<span class="op" id="4509983">=</span>&nbsp;<span class="num" id="4509985">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509990">case</span>&nbsp;<span class="ident" id="4509995">L2048N256</span><span class="op" id="4510004">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510008">L</span>&nbsp;<span class="op" id="4510010">=</span>&nbsp;<span class="num" id="4510012">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510019">N</span>&nbsp;<span class="op" id="4510021">=</span>&nbsp;<span class="num" id="4510023">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510028">case</span>&nbsp;<span class="ident" id="4510033">L3072N256</span><span class="op" id="4510042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510046">L</span>&nbsp;<span class="op" id="4510048">=</span>&nbsp;<span class="num" id="4510050">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510057">N</span>&nbsp;<span class="op" id="4510059">=</span>&nbsp;<span class="num" id="4510061">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510066">default</span><span class="op" id="4510073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510077">return</span>&nbsp;<span class="ident" id="4510084">errors</span><span class="op" id="4510090">.</span><span class="ident" id="4510091">New</span><span class="op" id="4510094">(</span><span class="string" id="4510095">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4510131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510138">qBytes</span>&nbsp;<span class="op" id="4510145">:=</span>&nbsp;<span class="builtinfunc" id="4510148">make</span><span class="op" id="4510152">(</span><span class="op" id="4510153">[</span><span class="op" id="4510154">]</span><span class="builtintype" id="4510155">byte</span><span class="op" id="4510159">,</span>&nbsp;<span class="ident" id="4510161">N</span><span class="op" id="4510162">/</span><span class="num" id="4510163">8</span><span class="op" id="4510164">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510167">pBytes</span>&nbsp;<span class="op" id="4510174">:=</span>&nbsp;<span class="builtinfunc" id="4510177">make</span><span class="op" id="4510181">(</span><span class="op" id="4510182">[</span><span class="op" id="4510183">]</span><span class="builtintype" id="4510184">byte</span><span class="op" id="4510188">,</span>&nbsp;<span class="ident" id="4510190">L</span><span class="op" id="4510191">/</span><span class="num" id="4510192">8</span><span class="op" id="4510193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510197">q</span>&nbsp;<span class="op" id="4510199">:=</span>&nbsp;<span class="builtinfunc" id="4510202">new</span><span class="op" id="4510205">(</span><span class="ident" id="4510206">big</span><span class="op" id="4510209">.</span><span class="ident" id="4510210">Int</span><span class="op" id="4510213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510216">p</span>&nbsp;<span class="op" id="4510218">:=</span>&nbsp;<span class="builtinfunc" id="4510221">new</span><span class="op" id="4510224">(</span><span class="ident" id="4510225">big</span><span class="op" id="4510228">.</span><span class="ident" id="4510229">Int</span><span class="op" id="4510232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510235">rem</span>&nbsp;<span class="op" id="4510239">:=</span>&nbsp;<span class="builtinfunc" id="4510242">new</span><span class="op" id="4510245">(</span><span class="ident" id="4510246">big</span><span class="op" id="4510249">.</span><span class="ident" id="4510250">Int</span><span class="op" id="4510253">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510256">one</span>&nbsp;<span class="op" id="4510260">:=</span>&nbsp;<span class="builtinfunc" id="4510263">new</span><span class="op" id="4510266">(</span><span class="ident" id="4510267">big</span><span class="op" id="4510270">.</span><span class="ident" id="4510271">Int</span><span class="op" id="4510274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510277">one</span><span class="op" id="4510280">.</span><span class="ident" id="4510281">SetInt64</span><span class="op" id="4510289">(</span><span class="num" id="4510290">1</span><span class="op" id="4510291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4510294">GeneratePrimes</span><span class="op" id="4510308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510311">for</span>&nbsp;<span class="op" id="4510315">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510319">_</span><span class="op" id="4510320">,</span>&nbsp;<span class="ident" id="4510322">err</span>&nbsp;<span class="op" id="4510326">=</span>&nbsp;<span class="ident" id="4510328">io</span><span class="op" id="4510330">.</span><span class="ident" id="4510331">ReadFull</span><span class="op" id="4510339">(</span><span class="ident" id="4510340">rand</span><span class="op" id="4510344">,</span>&nbsp;<span class="ident" id="4510346">qBytes</span><span class="op" id="4510352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510356">if</span>&nbsp;<span class="ident" id="4510359">err</span>&nbsp;<span class="op" id="4510363">!=</span>&nbsp;<span class="ident" id="4510366">nil</span>&nbsp;<span class="op" id="4510370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510375">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510389">qBytes</span><span class="op" id="4510395">[</span><span class="builtinfunc" id="4510396">len</span><span class="op" id="4510399">(</span><span class="ident" id="4510400">qBytes</span><span class="op" id="4510406">)</span><span class="op" id="4510407">-</span><span class="num" id="4510408">1</span><span class="op" id="4510409">]</span>&nbsp;<span class="op" id="4510411">|=</span>&nbsp;<span class="num" id="4510414">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510418">qBytes</span><span class="op" id="4510424">[</span><span class="num" id="4510425">0</span><span class="op" id="4510426">]</span>&nbsp;<span class="op" id="4510428">|=</span>&nbsp;<span class="num" id="4510431">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510438">q</span><span class="op" id="4510439">.</span><span class="ident" id="4510440">SetBytes</span><span class="op" id="4510448">(</span><span class="ident" id="4510449">qBytes</span><span class="op" id="4510455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510460">if</span>&nbsp;<span class="op" id="4510463">!</span><span class="ident" id="4510464">q</span><span class="op" id="4510465">.</span><span class="ident" id="4510466">ProbablyPrime</span><span class="op" id="4510479">(</span><span class="ident" id="4510480">numMRTests</span><span class="op" id="4510490">)</span>&nbsp;<span class="op" id="4510492">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510497">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510513">for</span>&nbsp;<span class="ident" id="4510517">i</span>&nbsp;<span class="op" id="4510519">:=</span>&nbsp;<span class="num" id="4510522">0</span><span class="op" id="4510523">;</span>&nbsp;<span class="ident" id="4510525">i</span>&nbsp;<span class="op" id="4510527">&lt;</span>&nbsp;<span class="num" id="4510529">4</span><span class="op" id="4510530">*</span><span class="ident" id="4510531">L</span><span class="op" id="4510532">;</span>&nbsp;<span class="ident" id="4510534">i</span><span class="op" id="4510535">++</span>&nbsp;<span class="op" id="4510538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510543">_</span><span class="op" id="4510544">,</span>&nbsp;<span class="ident" id="4510546">err</span>&nbsp;<span class="op" id="4510550">=</span>&nbsp;<span class="ident" id="4510552">io</span><span class="op" id="4510554">.</span><span class="ident" id="4510555">ReadFull</span><span class="op" id="4510563">(</span><span class="ident" id="4510564">rand</span><span class="op" id="4510568">,</span>&nbsp;<span class="ident" id="4510570">pBytes</span><span class="op" id="4510576">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510581">if</span>&nbsp;<span class="ident" id="4510584">err</span>&nbsp;<span class="op" id="4510588">!=</span>&nbsp;<span class="ident" id="4510591">nil</span>&nbsp;<span class="op" id="4510595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510601">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510617">pBytes</span><span class="op" id="4510623">[</span><span class="builtinfunc" id="4510624">len</span><span class="op" id="4510627">(</span><span class="ident" id="4510628">pBytes</span><span class="op" id="4510634">)</span><span class="op" id="4510635">-</span><span class="num" id="4510636">1</span><span class="op" id="4510637">]</span>&nbsp;<span class="op" id="4510639">|=</span>&nbsp;<span class="num" id="4510642">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510647">pBytes</span><span class="op" id="4510653">[</span><span class="num" id="4510654">0</span><span class="op" id="4510655">]</span>&nbsp;<span class="op" id="4510657">|=</span>&nbsp;<span class="num" id="4510660">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510669">p</span><span class="op" id="4510670">.</span><span class="ident" id="4510671">SetBytes</span><span class="op" id="4510679">(</span><span class="ident" id="4510680">pBytes</span><span class="op" id="4510686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510691">rem</span><span class="op" id="4510694">.</span><span class="ident" id="4510695">Mod</span><span class="op" id="4510698">(</span><span class="ident" id="4510699">p</span><span class="op" id="4510700">,</span>&nbsp;<span class="ident" id="4510702">q</span><span class="op" id="4510703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510708">rem</span><span class="op" id="4510711">.</span><span class="ident" id="4510712">Sub</span><span class="op" id="4510715">(</span><span class="ident" id="4510716">rem</span><span class="op" id="4510719">,</span>&nbsp;<span class="ident" id="4510721">one</span><span class="op" id="4510724">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510729">p</span><span class="op" id="4510730">.</span><span class="ident" id="4510731">Sub</span><span class="op" id="4510734">(</span><span class="ident" id="4510735">p</span><span class="op" id="4510736">,</span>&nbsp;<span class="ident" id="4510738">rem</span><span class="op" id="4510741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510746">if</span>&nbsp;<span class="ident" id="4510749">p</span><span class="op" id="4510750">.</span><span class="ident" id="4510751">BitLen</span><span class="op" id="4510757">(</span><span class="op" id="4510758">)</span>&nbsp;<span class="op" id="4510760">&lt;</span>&nbsp;<span class="ident" id="4510762">L</span>&nbsp;<span class="op" id="4510764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510770">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510788">if</span>&nbsp;<span class="op" id="4510791">!</span><span class="ident" id="4510792">p</span><span class="op" id="4510793">.</span><span class="ident" id="4510794">ProbablyPrime</span><span class="op" id="4510807">(</span><span class="ident" id="4510808">numMRTests</span><span class="op" id="4510818">)</span>&nbsp;<span class="op" id="4510820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510826">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510844">params</span><span class="op" id="4510850">.</span><span class="ident" id="4510851">P</span>&nbsp;<span class="op" id="4510853">=</span>&nbsp;<span class="ident" id="4510855">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510860">params</span><span class="op" id="4510866">.</span><span class="ident" id="4510867">Q</span>&nbsp;<span class="op" id="4510869">=</span>&nbsp;<span class="ident" id="4510871">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510876">break</span>&nbsp;<span class="ident" id="4510882">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510906">h</span>&nbsp;<span class="op" id="4510908">:=</span>&nbsp;<span class="builtinfunc" id="4510911">new</span><span class="op" id="4510914">(</span><span class="ident" id="4510915">big</span><span class="op" id="4510918">.</span><span class="ident" id="4510919">Int</span><span class="op" id="4510922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510925">h</span><span class="op" id="4510926">.</span><span class="ident" id="4510927">SetInt64</span><span class="op" id="4510935">(</span><span class="num" id="4510936">2</span><span class="op" id="4510937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510940">g</span>&nbsp;<span class="op" id="4510942">:=</span>&nbsp;<span class="builtinfunc" id="4510945">new</span><span class="op" id="4510948">(</span><span class="ident" id="4510949">big</span><span class="op" id="4510952">.</span><span class="ident" id="4510953">Int</span><span class="op" id="4510956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510960">pm1</span>&nbsp;<span class="op" id="4510964">:=</span>&nbsp;<span class="builtinfunc" id="4510967">new</span><span class="op" id="4510970">(</span><span class="ident" id="4510971">big</span><span class="op" id="4510974">.</span><span class="ident" id="4510975">Int</span><span class="op" id="4510978">)</span><span class="op" id="4510979">.</span><span class="ident" id="4510980">Sub</span><span class="op" id="4510983">(</span><span class="ident" id="4510984">p</span><span class="op" id="4510985">,</span>&nbsp;<span class="ident" id="4510987">one</span><span class="op" id="4510990">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510993">e</span>&nbsp;<span class="op" id="4510995">:=</span>&nbsp;<span class="builtinfunc" id="4510998">new</span><span class="op" id="4511001">(</span><span class="ident" id="4511002">big</span><span class="op" id="4511005">.</span><span class="ident" id="4511006">Int</span><span class="op" id="4511009">)</span><span class="op" id="4511010">.</span><span class="ident" id="4511011">Div</span><span class="op" id="4511014">(</span><span class="ident" id="4511015">pm1</span><span class="op" id="4511018">,</span>&nbsp;<span class="ident" id="4511020">q</span><span class="op" id="4511021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511025">for</span>&nbsp;<span class="op" id="4511029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511033">g</span><span class="op" id="4511034">.</span><span class="ident" id="4511035">Exp</span><span class="op" id="4511038">(</span><span class="ident" id="4511039">h</span><span class="op" id="4511040">,</span>&nbsp;<span class="ident" id="4511042">e</span><span class="op" id="4511043">,</span>&nbsp;<span class="ident" id="4511045">p</span><span class="op" id="4511046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511050">if</span>&nbsp;<span class="ident" id="4511053">g</span><span class="op" id="4511054">.</span><span class="ident" id="4511055">Cmp</span><span class="op" id="4511058">(</span><span class="ident" id="4511059">one</span><span class="op" id="4511062">)</span>&nbsp;<span class="op" id="4511064">==</span>&nbsp;<span class="num" id="4511067">0</span>&nbsp;<span class="op" id="4511069">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511074">h</span><span class="op" id="4511075">.</span><span class="ident" id="4511076">Add</span><span class="op" id="4511079">(</span><span class="ident" id="4511080">h</span><span class="op" id="4511081">,</span>&nbsp;<span class="ident" id="4511083">one</span><span class="op" id="4511086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511091">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511107">params</span><span class="op" id="4511113">.</span><span class="ident" id="4511114">G</span>&nbsp;<span class="op" id="4511116">=</span>&nbsp;<span class="ident" id="4511118">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511130">}</span><br>
<span class="lineno"></span><span class="op" id="4511132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4511135">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4511209">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4511271">func</span>&nbsp;<span class="ident" id="4511276">GenerateKey</span><span class="op" id="4511287">(</span><span class="ident" id="4511288">priv</span>&nbsp;<span class="op" id="4511293">*</span><span class="ident" id="4511294">PrivateKey</span><span class="op" id="4511304">,</span>&nbsp;<span class="ident" id="4511306">rand</span>&nbsp;<span class="ident" id="4511311">io</span><span class="op" id="4511313">.</span><span class="ident" id="4511314">Reader</span><span class="op" id="4511320">)</span>&nbsp;<span class="builtintype" id="4511322">error</span>&nbsp;<span class="op" id="4511328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511331">if</span>&nbsp;<span class="ident" id="4511334">priv</span><span class="op" id="4511338">.</span><span class="ident" id="4511339">P</span>&nbsp;<span class="op" id="4511341">==</span>&nbsp;<span class="ident" id="4511344">nil</span>&nbsp;<span class="op" id="4511348">||</span>&nbsp;<span class="ident" id="4511351">priv</span><span class="op" id="4511355">.</span><span class="ident" id="4511356">Q</span>&nbsp;<span class="op" id="4511358">==</span>&nbsp;<span class="ident" id="4511361">nil</span>&nbsp;<span class="op" id="4511365">||</span>&nbsp;<span class="ident" id="4511368">priv</span><span class="op" id="4511372">.</span><span class="ident" id="4511373">G</span>&nbsp;<span class="op" id="4511375">==</span>&nbsp;<span class="ident" id="4511378">nil</span>&nbsp;<span class="op" id="4511382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511386">return</span>&nbsp;<span class="ident" id="4511393">errors</span><span class="op" id="4511399">.</span><span class="ident" id="4511400">New</span><span class="op" id="4511403">(</span><span class="string" id="4511404">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4511461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511464">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511468">x</span>&nbsp;<span class="op" id="4511470">:=</span>&nbsp;<span class="builtinfunc" id="4511473">new</span><span class="op" id="4511476">(</span><span class="ident" id="4511477">big</span><span class="op" id="4511480">.</span><span class="ident" id="4511481">Int</span><span class="op" id="4511484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511487">xBytes</span>&nbsp;<span class="op" id="4511494">:=</span>&nbsp;<span class="builtinfunc" id="4511497">make</span><span class="op" id="4511501">(</span><span class="op" id="4511502">[</span><span class="op" id="4511503">]</span><span class="builtintype" id="4511504">byte</span><span class="op" id="4511508">,</span>&nbsp;<span class="ident" id="4511510">priv</span><span class="op" id="4511514">.</span><span class="ident" id="4511515">Q</span><span class="op" id="4511516">.</span><span class="ident" id="4511517">BitLen</span><span class="op" id="4511523">(</span><span class="op" id="4511524">)</span><span class="op" id="4511525">/</span><span class="num" id="4511526">8</span><span class="op" id="4511527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511531">for</span>&nbsp;<span class="op" id="4511535">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511539">_</span><span class="op" id="4511540">,</span>&nbsp;<span class="ident" id="4511542">err</span>&nbsp;<span class="op" id="4511546">:=</span>&nbsp;<span class="ident" id="4511549">io</span><span class="op" id="4511551">.</span><span class="ident" id="4511552">ReadFull</span><span class="op" id="4511560">(</span><span class="ident" id="4511561">rand</span><span class="op" id="4511565">,</span>&nbsp;<span class="ident" id="4511567">xBytes</span><span class="op" id="4511573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511577">if</span>&nbsp;<span class="ident" id="4511580">err</span>&nbsp;<span class="op" id="4511584">!=</span>&nbsp;<span class="ident" id="4511587">nil</span>&nbsp;<span class="op" id="4511591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511596">return</span>&nbsp;<span class="ident" id="4511603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511613">x</span><span class="op" id="4511614">.</span><span class="ident" id="4511615">SetBytes</span><span class="op" id="4511623">(</span><span class="ident" id="4511624">xBytes</span><span class="op" id="4511630">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511634">if</span>&nbsp;<span class="ident" id="4511637">x</span><span class="op" id="4511638">.</span><span class="ident" id="4511639">Sign</span><span class="op" id="4511643">(</span><span class="op" id="4511644">)</span>&nbsp;<span class="op" id="4511646">!=</span>&nbsp;<span class="num" id="4511649">0</span>&nbsp;<span class="op" id="4511651">&amp;&amp;</span>&nbsp;<span class="ident" id="4511654">x</span><span class="op" id="4511655">.</span><span class="ident" id="4511656">Cmp</span><span class="op" id="4511659">(</span><span class="ident" id="4511660">priv</span><span class="op" id="4511664">.</span><span class="ident" id="4511665">Q</span><span class="op" id="4511666">)</span>&nbsp;<span class="op" id="4511668">&lt;</span>&nbsp;<span class="num" id="4511670">0</span>&nbsp;<span class="op" id="4511672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511692">priv</span><span class="op" id="4511696">.</span><span class="ident" id="4511697">X</span>&nbsp;<span class="op" id="4511699">=</span>&nbsp;<span class="ident" id="4511701">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511704">priv</span><span class="op" id="4511708">.</span><span class="ident" id="4511709">Y</span>&nbsp;<span class="op" id="4511711">=</span>&nbsp;<span class="builtinfunc" id="4511713">new</span><span class="op" id="4511716">(</span><span class="ident" id="4511717">big</span><span class="op" id="4511720">.</span><span class="ident" id="4511721">Int</span><span class="op" id="4511724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511727">priv</span><span class="op" id="4511731">.</span><span class="ident" id="4511732">Y</span><span class="op" id="4511733">.</span><span class="ident" id="4511734">Exp</span><span class="op" id="4511737">(</span><span class="ident" id="4511738">priv</span><span class="op" id="4511742">.</span><span class="ident" id="4511743">G</span><span class="op" id="4511744">,</span>&nbsp;<span class="ident" id="4511746">x</span><span class="op" id="4511747">,</span>&nbsp;<span class="ident" id="4511749">priv</span><span class="op" id="4511753">.</span><span class="ident" id="4511754">P</span><span class="op" id="4511755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511758">return</span>&nbsp;<span class="ident" id="4511765">nil</span><br>
<span class="lineno"></span><span class="op" id="4511769">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4511772">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4511849">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4511927">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4511998">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4512036">func</span>&nbsp;<span class="ident" id="4512041">fermatInverse</span><span class="op" id="4512054">(</span><span class="ident" id="4512055">k</span><span class="op" id="4512056">,</span>&nbsp;<span class="ident" id="4512058">P</span>&nbsp;<span class="op" id="4512060">*</span><span class="ident" id="4512061">big</span><span class="op" id="4512064">.</span><span class="ident" id="4512065">Int</span><span class="op" id="4512068">)</span>&nbsp;<span class="op" id="4512070">*</span><span class="ident" id="4512071">big</span><span class="op" id="4512074">.</span><span class="ident" id="4512075">Int</span>&nbsp;<span class="op" id="4512079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512082">two</span>&nbsp;<span class="op" id="4512086">:=</span>&nbsp;<span class="ident" id="4512089">big</span><span class="op" id="4512092">.</span><span class="ident" id="4512093">NewInt</span><span class="op" id="4512099">(</span><span class="num" id="4512100">2</span><span class="op" id="4512101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512104">pMinus2</span>&nbsp;<span class="op" id="4512112">:=</span>&nbsp;<span class="builtinfunc" id="4512115">new</span><span class="op" id="4512118">(</span><span class="ident" id="4512119">big</span><span class="op" id="4512122">.</span><span class="ident" id="4512123">Int</span><span class="op" id="4512126">)</span><span class="op" id="4512127">.</span><span class="ident" id="4512128">Sub</span><span class="op" id="4512131">(</span><span class="ident" id="4512132">P</span><span class="op" id="4512133">,</span>&nbsp;<span class="ident" id="4512135">two</span><span class="op" id="4512138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512141">return</span>&nbsp;<span class="builtinfunc" id="4512148">new</span><span class="op" id="4512151">(</span><span class="ident" id="4512152">big</span><span class="op" id="4512155">.</span><span class="ident" id="4512156">Int</span><span class="op" id="4512159">)</span><span class="op" id="4512160">.</span><span class="ident" id="4512161">Exp</span><span class="op" id="4512164">(</span><span class="ident" id="4512165">k</span><span class="op" id="4512166">,</span>&nbsp;<span class="ident" id="4512168">pMinus2</span><span class="op" id="4512175">,</span>&nbsp;<span class="ident" id="4512177">P</span><span class="op" id="4512178">)</span><br>
<span class="lineno"></span><span class="op" id="4512180">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4512183">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4512263">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4512341">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4512420">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4512429">//</span><br>
<span class="lineno"></span><span class="comment" id="4512432">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4512512">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4512587">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4512609">func</span>&nbsp;<span class="ident" id="4512614">Sign</span><span class="op" id="4512618">(</span><span class="ident" id="4512619">rand</span>&nbsp;<span class="ident" id="4512624">io</span><span class="op" id="4512626">.</span><span class="ident" id="4512627">Reader</span><span class="op" id="4512633">,</span>&nbsp;<span class="ident" id="4512635">priv</span>&nbsp;<span class="op" id="4512640">*</span><span class="ident" id="4512641">PrivateKey</span><span class="op" id="4512651">,</span>&nbsp;<span class="ident" id="4512653">hash</span>&nbsp;<span class="op" id="4512658">[</span><span class="op" id="4512659">]</span><span class="builtintype" id="4512660">byte</span><span class="op" id="4512664">)</span>&nbsp;<span class="op" id="4512666">(</span><span class="ident" id="4512667">r</span><span class="op" id="4512668">,</span>&nbsp;<span class="ident" id="4512670">s</span>&nbsp;<span class="op" id="4512672">*</span><span class="ident" id="4512673">big</span><span class="op" id="4512676">.</span><span class="ident" id="4512677">Int</span><span class="op" id="4512680">,</span>&nbsp;<span class="ident" id="4512682">err</span>&nbsp;<span class="builtintype" id="4512686">error</span><span class="op" id="4512691">)</span>&nbsp;<span class="op" id="4512693">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512696">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512725">n</span>&nbsp;<span class="op" id="4512727">:=</span>&nbsp;<span class="ident" id="4512730">priv</span><span class="op" id="4512734">.</span><span class="ident" id="4512735">Q</span><span class="op" id="4512736">.</span><span class="ident" id="4512737">BitLen</span><span class="op" id="4512743">(</span><span class="op" id="4512744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512747">if</span>&nbsp;<span class="ident" id="4512750">n</span><span class="op" id="4512751">&amp;</span><span class="num" id="4512752">7</span>&nbsp;<span class="op" id="4512754">!=</span>&nbsp;<span class="num" id="4512757">0</span>&nbsp;<span class="op" id="4512759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512763">err</span>&nbsp;<span class="op" id="4512767">=</span>&nbsp;<span class="ident" id="4512769">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512791">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512802">n</span>&nbsp;<span class="op" id="4512804">&gt;&gt;=</span>&nbsp;<span class="num" id="4512808">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512812">for</span>&nbsp;<span class="op" id="4512816">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512820">k</span>&nbsp;<span class="op" id="4512822">:=</span>&nbsp;<span class="builtinfunc" id="4512825">new</span><span class="op" id="4512828">(</span><span class="ident" id="4512829">big</span><span class="op" id="4512832">.</span><span class="ident" id="4512833">Int</span><span class="op" id="4512836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512840">buf</span>&nbsp;<span class="op" id="4512844">:=</span>&nbsp;<span class="builtinfunc" id="4512847">make</span><span class="op" id="4512851">(</span><span class="op" id="4512852">[</span><span class="op" id="4512853">]</span><span class="builtintype" id="4512854">byte</span><span class="op" id="4512858">,</span>&nbsp;<span class="ident" id="4512860">n</span><span class="op" id="4512861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512865">for</span>&nbsp;<span class="op" id="4512869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512874">_</span><span class="op" id="4512875">,</span>&nbsp;<span class="ident" id="4512877">err</span>&nbsp;<span class="op" id="4512881">=</span>&nbsp;<span class="ident" id="4512883">io</span><span class="op" id="4512885">.</span><span class="ident" id="4512886">ReadFull</span><span class="op" id="4512894">(</span><span class="ident" id="4512895">rand</span><span class="op" id="4512899">,</span>&nbsp;<span class="ident" id="4512901">buf</span><span class="op" id="4512904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512909">if</span>&nbsp;<span class="ident" id="4512912">err</span>&nbsp;<span class="op" id="4512916">!=</span>&nbsp;<span class="ident" id="4512919">nil</span>&nbsp;<span class="op" id="4512923">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512929">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512944">k</span><span class="op" id="4512945">.</span><span class="ident" id="4512946">SetBytes</span><span class="op" id="4512954">(</span><span class="ident" id="4512955">buf</span><span class="op" id="4512958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512963">if</span>&nbsp;<span class="ident" id="4512966">k</span><span class="op" id="4512967">.</span><span class="ident" id="4512968">Sign</span><span class="op" id="4512972">(</span><span class="op" id="4512973">)</span>&nbsp;<span class="op" id="4512975">&gt;</span>&nbsp;<span class="num" id="4512977">0</span>&nbsp;<span class="op" id="4512979">&amp;&amp;</span>&nbsp;<span class="ident" id="4512982">k</span><span class="op" id="4512983">.</span><span class="ident" id="4512984">Cmp</span><span class="op" id="4512987">(</span><span class="ident" id="4512988">priv</span><span class="op" id="4512992">.</span><span class="ident" id="4512993">Q</span><span class="op" id="4512994">)</span>&nbsp;<span class="op" id="4512996">&lt;</span>&nbsp;<span class="num" id="4512998">0</span>&nbsp;<span class="op" id="4513000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513006">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513024">kInv</span>&nbsp;<span class="op" id="4513029">:=</span>&nbsp;<span class="ident" id="4513032">fermatInverse</span><span class="op" id="4513045">(</span><span class="ident" id="4513046">k</span><span class="op" id="4513047">,</span>&nbsp;<span class="ident" id="4513049">priv</span><span class="op" id="4513053">.</span><span class="ident" id="4513054">Q</span><span class="op" id="4513055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513060">r</span>&nbsp;<span class="op" id="4513062">=</span>&nbsp;<span class="builtinfunc" id="4513064">new</span><span class="op" id="4513067">(</span><span class="ident" id="4513068">big</span><span class="op" id="4513071">.</span><span class="ident" id="4513072">Int</span><span class="op" id="4513075">)</span><span class="op" id="4513076">.</span><span class="ident" id="4513077">Exp</span><span class="op" id="4513080">(</span><span class="ident" id="4513081">priv</span><span class="op" id="4513085">.</span><span class="ident" id="4513086">G</span><span class="op" id="4513087">,</span>&nbsp;<span class="ident" id="4513089">k</span><span class="op" id="4513090">,</span>&nbsp;<span class="ident" id="4513092">priv</span><span class="op" id="4513096">.</span><span class="ident" id="4513097">P</span><span class="op" id="4513098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513102">r</span><span class="op" id="4513103">.</span><span class="ident" id="4513104">Mod</span><span class="op" id="4513107">(</span><span class="ident" id="4513108">r</span><span class="op" id="4513109">,</span>&nbsp;<span class="ident" id="4513111">priv</span><span class="op" id="4513115">.</span><span class="ident" id="4513116">Q</span><span class="op" id="4513117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513122">if</span>&nbsp;<span class="ident" id="4513125">r</span><span class="op" id="4513126">.</span><span class="ident" id="4513127">Sign</span><span class="op" id="4513131">(</span><span class="op" id="4513132">)</span>&nbsp;<span class="op" id="4513134">==</span>&nbsp;<span class="num" id="4513137">0</span>&nbsp;<span class="op" id="4513139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513144">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513160">z</span>&nbsp;<span class="op" id="4513162">:=</span>&nbsp;<span class="ident" id="4513165">k</span><span class="op" id="4513166">.</span><span class="ident" id="4513167">SetBytes</span><span class="op" id="4513175">(</span><span class="ident" id="4513176">hash</span><span class="op" id="4513180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513185">s</span>&nbsp;<span class="op" id="4513187">=</span>&nbsp;<span class="builtinfunc" id="4513189">new</span><span class="op" id="4513192">(</span><span class="ident" id="4513193">big</span><span class="op" id="4513196">.</span><span class="ident" id="4513197">Int</span><span class="op" id="4513200">)</span><span class="op" id="4513201">.</span><span class="ident" id="4513202">Mul</span><span class="op" id="4513205">(</span><span class="ident" id="4513206">priv</span><span class="op" id="4513210">.</span><span class="ident" id="4513211">X</span><span class="op" id="4513212">,</span>&nbsp;<span class="ident" id="4513214">r</span><span class="op" id="4513215">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513219">s</span><span class="op" id="4513220">.</span><span class="ident" id="4513221">Add</span><span class="op" id="4513224">(</span><span class="ident" id="4513225">s</span><span class="op" id="4513226">,</span>&nbsp;<span class="ident" id="4513228">z</span><span class="op" id="4513229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513233">s</span><span class="op" id="4513234">.</span><span class="ident" id="4513235">Mod</span><span class="op" id="4513238">(</span><span class="ident" id="4513239">s</span><span class="op" id="4513240">,</span>&nbsp;<span class="ident" id="4513242">priv</span><span class="op" id="4513246">.</span><span class="ident" id="4513247">Q</span><span class="op" id="4513248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513252">s</span><span class="op" id="4513253">.</span><span class="ident" id="4513254">Mul</span><span class="op" id="4513257">(</span><span class="ident" id="4513258">s</span><span class="op" id="4513259">,</span>&nbsp;<span class="ident" id="4513261">kInv</span><span class="op" id="4513265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513269">s</span><span class="op" id="4513270">.</span><span class="ident" id="4513271">Mod</span><span class="op" id="4513274">(</span><span class="ident" id="4513275">s</span><span class="op" id="4513276">,</span>&nbsp;<span class="ident" id="4513278">priv</span><span class="op" id="4513282">.</span><span class="ident" id="4513283">Q</span><span class="op" id="4513284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513289">if</span>&nbsp;<span class="ident" id="4513292">s</span><span class="op" id="4513293">.</span><span class="ident" id="4513294">Sign</span><span class="op" id="4513298">(</span><span class="op" id="4513299">)</span>&nbsp;<span class="op" id="4513301">!=</span>&nbsp;<span class="num" id="4513304">0</span>&nbsp;<span class="op" id="4513306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513311">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513326">return</span><br>
<span class="lineno"></span><span class="op" id="4513333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4513336">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4513415">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4513458">//</span><br>
<span class="lineno"></span><span class="comment" id="4513461">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4513541">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4513616">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4513638">func</span>&nbsp;<span class="ident" id="4513643">Verify</span><span class="op" id="4513649">(</span><span class="ident" id="4513650">pub</span>&nbsp;<span class="op" id="4513654">*</span><span class="ident" id="4513655">PublicKey</span><span class="op" id="4513664">,</span>&nbsp;<span class="ident" id="4513666">hash</span>&nbsp;<span class="op" id="4513671">[</span><span class="op" id="4513672">]</span><span class="builtintype" id="4513673">byte</span><span class="op" id="4513677">,</span>&nbsp;<span class="ident" id="4513679">r</span><span class="op" id="4513680">,</span>&nbsp;<span class="ident" id="4513682">s</span>&nbsp;<span class="op" id="4513684">*</span><span class="ident" id="4513685">big</span><span class="op" id="4513688">.</span><span class="ident" id="4513689">Int</span><span class="op" id="4513692">)</span>&nbsp;<span class="builtintype" id="4513694">bool</span>&nbsp;<span class="op" id="4513699">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4513702">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513731">if</span>&nbsp;<span class="ident" id="4513734">r</span><span class="op" id="4513735">.</span><span class="ident" id="4513736">Sign</span><span class="op" id="4513740">(</span><span class="op" id="4513741">)</span>&nbsp;<span class="op" id="4513743">&lt;</span>&nbsp;<span class="num" id="4513745">1</span>&nbsp;<span class="op" id="4513747">||</span>&nbsp;<span class="ident" id="4513750">r</span><span class="op" id="4513751">.</span><span class="ident" id="4513752">Cmp</span><span class="op" id="4513755">(</span><span class="ident" id="4513756">pub</span><span class="op" id="4513759">.</span><span class="ident" id="4513760">Q</span><span class="op" id="4513761">)</span>&nbsp;<span class="op" id="4513763">&gt;=</span>&nbsp;<span class="num" id="4513766">0</span>&nbsp;<span class="op" id="4513768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513772">return</span>&nbsp;<span class="builtintype" id="4513779">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513786">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513789">if</span>&nbsp;<span class="ident" id="4513792">s</span><span class="op" id="4513793">.</span><span class="ident" id="4513794">Sign</span><span class="op" id="4513798">(</span><span class="op" id="4513799">)</span>&nbsp;<span class="op" id="4513801">&lt;</span>&nbsp;<span class="num" id="4513803">1</span>&nbsp;<span class="op" id="4513805">||</span>&nbsp;<span class="ident" id="4513808">s</span><span class="op" id="4513809">.</span><span class="ident" id="4513810">Cmp</span><span class="op" id="4513813">(</span><span class="ident" id="4513814">pub</span><span class="op" id="4513817">.</span><span class="ident" id="4513818">Q</span><span class="op" id="4513819">)</span>&nbsp;<span class="op" id="4513821">&gt;=</span>&nbsp;<span class="num" id="4513824">0</span>&nbsp;<span class="op" id="4513826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513830">return</span>&nbsp;<span class="builtintype" id="4513837">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513848">w</span>&nbsp;<span class="op" id="4513850">:=</span>&nbsp;<span class="builtinfunc" id="4513853">new</span><span class="op" id="4513856">(</span><span class="ident" id="4513857">big</span><span class="op" id="4513860">.</span><span class="ident" id="4513861">Int</span><span class="op" id="4513864">)</span><span class="op" id="4513865">.</span><span class="ident" id="4513866">ModInverse</span><span class="op" id="4513876">(</span><span class="ident" id="4513877">s</span><span class="op" id="4513878">,</span>&nbsp;<span class="ident" id="4513880">pub</span><span class="op" id="4513883">.</span><span class="ident" id="4513884">Q</span><span class="op" id="4513885">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513889">n</span>&nbsp;<span class="op" id="4513891">:=</span>&nbsp;<span class="ident" id="4513894">pub</span><span class="op" id="4513897">.</span><span class="ident" id="4513898">Q</span><span class="op" id="4513899">.</span><span class="ident" id="4513900">BitLen</span><span class="op" id="4513906">(</span><span class="op" id="4513907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513910">if</span>&nbsp;<span class="ident" id="4513913">n</span><span class="op" id="4513914">&amp;</span><span class="num" id="4513915">7</span>&nbsp;<span class="op" id="4513917">!=</span>&nbsp;<span class="num" id="4513920">0</span>&nbsp;<span class="op" id="4513922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513926">return</span>&nbsp;<span class="builtintype" id="4513933">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513940">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513943">z</span>&nbsp;<span class="op" id="4513945">:=</span>&nbsp;<span class="builtinfunc" id="4513948">new</span><span class="op" id="4513951">(</span><span class="ident" id="4513952">big</span><span class="op" id="4513955">.</span><span class="ident" id="4513956">Int</span><span class="op" id="4513959">)</span><span class="op" id="4513960">.</span><span class="ident" id="4513961">SetBytes</span><span class="op" id="4513969">(</span><span class="ident" id="4513970">hash</span><span class="op" id="4513974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4513978">u1</span>&nbsp;<span class="op" id="4513981">:=</span>&nbsp;<span class="builtinfunc" id="4513984">new</span><span class="op" id="4513987">(</span><span class="ident" id="4513988">big</span><span class="op" id="4513991">.</span><span class="ident" id="4513992">Int</span><span class="op" id="4513995">)</span><span class="op" id="4513996">.</span><span class="ident" id="4513997">Mul</span><span class="op" id="4514000">(</span><span class="ident" id="4514001">z</span><span class="op" id="4514002">,</span>&nbsp;<span class="ident" id="4514004">w</span><span class="op" id="4514005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514008">u1</span><span class="op" id="4514010">.</span><span class="ident" id="4514011">Mod</span><span class="op" id="4514014">(</span><span class="ident" id="4514015">u1</span><span class="op" id="4514017">,</span>&nbsp;<span class="ident" id="4514019">pub</span><span class="op" id="4514022">.</span><span class="ident" id="4514023">Q</span><span class="op" id="4514024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514027">u2</span>&nbsp;<span class="op" id="4514030">:=</span>&nbsp;<span class="ident" id="4514033">w</span><span class="op" id="4514034">.</span><span class="ident" id="4514035">Mul</span><span class="op" id="4514038">(</span><span class="ident" id="4514039">r</span><span class="op" id="4514040">,</span>&nbsp;<span class="ident" id="4514042">w</span><span class="op" id="4514043">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514046">u2</span><span class="op" id="4514048">.</span><span class="ident" id="4514049">Mod</span><span class="op" id="4514052">(</span><span class="ident" id="4514053">u2</span><span class="op" id="4514055">,</span>&nbsp;<span class="ident" id="4514057">pub</span><span class="op" id="4514060">.</span><span class="ident" id="4514061">Q</span><span class="op" id="4514062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514065">v</span>&nbsp;<span class="op" id="4514067">:=</span>&nbsp;<span class="ident" id="4514070">u1</span><span class="op" id="4514072">.</span><span class="ident" id="4514073">Exp</span><span class="op" id="4514076">(</span><span class="ident" id="4514077">pub</span><span class="op" id="4514080">.</span><span class="ident" id="4514081">G</span><span class="op" id="4514082">,</span>&nbsp;<span class="ident" id="4514084">u1</span><span class="op" id="4514086">,</span>&nbsp;<span class="ident" id="4514088">pub</span><span class="op" id="4514091">.</span><span class="ident" id="4514092">P</span><span class="op" id="4514093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514096">u2</span><span class="op" id="4514098">.</span><span class="ident" id="4514099">Exp</span><span class="op" id="4514102">(</span><span class="ident" id="4514103">pub</span><span class="op" id="4514106">.</span><span class="ident" id="4514107">Y</span><span class="op" id="4514108">,</span>&nbsp;<span class="ident" id="4514110">u2</span><span class="op" id="4514112">,</span>&nbsp;<span class="ident" id="4514114">pub</span><span class="op" id="4514117">.</span><span class="ident" id="4514118">P</span><span class="op" id="4514119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514122">v</span><span class="op" id="4514123">.</span><span class="ident" id="4514124">Mul</span><span class="op" id="4514127">(</span><span class="ident" id="4514128">v</span><span class="op" id="4514129">,</span>&nbsp;<span class="ident" id="4514131">u2</span><span class="op" id="4514133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514136">v</span><span class="op" id="4514137">.</span><span class="ident" id="4514138">Mod</span><span class="op" id="4514141">(</span><span class="ident" id="4514142">v</span><span class="op" id="4514143">,</span>&nbsp;<span class="ident" id="4514145">pub</span><span class="op" id="4514148">.</span><span class="ident" id="4514149">P</span><span class="op" id="4514150">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4514153">v</span><span class="op" id="4514154">.</span><span class="ident" id="4514155">Mod</span><span class="op" id="4514158">(</span><span class="ident" id="4514159">v</span><span class="op" id="4514160">,</span>&nbsp;<span class="ident" id="4514162">pub</span><span class="op" id="4514165">.</span><span class="ident" id="4514166">Q</span><span class="op" id="4514167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4514171">return</span>&nbsp;<span class="ident" id="4514178">v</span><span class="op" id="4514179">.</span><span class="ident" id="4514180">Cmp</span><span class="op" id="4514183">(</span><span class="ident" id="4514184">r</span><span class="op" id="4514185">)</span>&nbsp;<span class="op" id="4514187">==</span>&nbsp;<span class="num" id="4514190">0</span><br>
<span class="lineno"></span><span class="op" id="4514192">}</span>
</div>
</body>
</html>
