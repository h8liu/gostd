<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2356951">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2357006">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2357060">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2357111">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2357159">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2357173">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2357222">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2357256">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2357290">package</span>&nbsp;<span class="ident" id="2357298">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2357307">import</span>&nbsp;<span class="string" id="2357314">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2357322">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2357347">type</span>&nbsp;<span class="ident" id="2357352">floatInfo</span>&nbsp;<span class="keyword" id="2357362">struct</span>&nbsp;<span class="op" id="2357369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357372">mantbits</span>&nbsp;<span class="builtintype" id="2357381">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357387">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2357396">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2357402">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2357411">int</span><br>
<span class="lineno">20</span><span class="op" id="2357415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2357418">var</span>&nbsp;<span class="ident" id="2357422">float32info</span>&nbsp;<span class="op" id="2357434">=</span>&nbsp;<span class="ident" id="2357436">floatInfo</span><span class="op" id="2357445">{</span><span class="num" id="2357446">23</span><span class="op" id="2357448">,</span>&nbsp;<span class="num" id="2357450">8</span><span class="op" id="2357451">,</span>&nbsp;<span class="op" id="2357453">-</span><span class="num" id="2357454">127</span><span class="op" id="2357457">}</span><br>
<span class="lineno"></span><span class="keyword" id="2357459">var</span>&nbsp;<span class="ident" id="2357463">float64info</span>&nbsp;<span class="op" id="2357475">=</span>&nbsp;<span class="ident" id="2357477">floatInfo</span><span class="op" id="2357486">{</span><span class="num" id="2357487">52</span><span class="op" id="2357489">,</span>&nbsp;<span class="num" id="2357491">11</span><span class="op" id="2357493">,</span>&nbsp;<span class="op" id="2357495">-</span><span class="num" id="2357496">1023</span><span class="op" id="2357500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2357503">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2357568">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2357634">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2357706">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2357765">//</span><br>
<span class="lineno">30</span><span class="comment" id="2357768">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2357796">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2357837">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2357880">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2357923">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2357956">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2358008">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2358057">//</span><br>
<span class="lineno"></span><span class="comment" id="2358060">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2358112">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2358192">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2358269">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2358322">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2358385">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2358442">func</span>&nbsp;<span class="ident" id="2358447">FormatFloat</span><span class="op" id="2358458">(</span><span class="ident" id="2358459">f</span>&nbsp;<span class="builtintype" id="2358461">float64</span><span class="op" id="2358468">,</span>&nbsp;<span class="ident" id="2358470">fmt</span>&nbsp;<span class="builtintype" id="2358474">byte</span><span class="op" id="2358478">,</span>&nbsp;<span class="ident" id="2358480">prec</span><span class="op" id="2358484">,</span>&nbsp;<span class="ident" id="2358486">bitSize</span>&nbsp;<span class="builtintype" id="2358494">int</span><span class="op" id="2358497">)</span>&nbsp;<span class="builtintype" id="2358499">string</span>&nbsp;<span class="op" id="2358506">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2358509">return</span>&nbsp;<span class="builtintype" id="2358516">string</span><span class="op" id="2358522">(</span><span class="ident" id="2358523">genericFtoa</span><span class="op" id="2358534">(</span><span class="builtinfunc" id="2358535">make</span><span class="op" id="2358539">(</span><span class="op" id="2358540">[</span><span class="op" id="2358541">]</span><span class="builtintype" id="2358542">byte</span><span class="op" id="2358546">,</span>&nbsp;<span class="num" id="2358548">0</span><span class="op" id="2358549">,</span>&nbsp;<span class="ident" id="2358551">max</span><span class="op" id="2358554">(</span><span class="ident" id="2358555">prec</span><span class="op" id="2358559">+</span><span class="num" id="2358560">4</span><span class="op" id="2358561">,</span>&nbsp;<span class="num" id="2358563">24</span><span class="op" id="2358565">)</span><span class="op" id="2358566">)</span><span class="op" id="2358567">,</span>&nbsp;<span class="ident" id="2358569">f</span><span class="op" id="2358570">,</span>&nbsp;<span class="ident" id="2358572">fmt</span><span class="op" id="2358575">,</span>&nbsp;<span class="ident" id="2358577">prec</span><span class="op" id="2358581">,</span>&nbsp;<span class="ident" id="2358583">bitSize</span><span class="op" id="2358590">)</span><span class="op" id="2358591">)</span><br>
<span class="lineno"></span><span class="op" id="2358593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2358596">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2358667">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2358739">func</span>&nbsp;<span class="ident" id="2358744">AppendFloat</span><span class="op" id="2358755">(</span><span class="ident" id="2358756">dst</span>&nbsp;<span class="op" id="2358760">[</span><span class="op" id="2358761">]</span><span class="builtintype" id="2358762">byte</span><span class="op" id="2358766">,</span>&nbsp;<span class="ident" id="2358768">f</span>&nbsp;<span class="builtintype" id="2358770">float64</span><span class="op" id="2358777">,</span>&nbsp;<span class="ident" id="2358779">fmt</span>&nbsp;<span class="builtintype" id="2358783">byte</span><span class="op" id="2358787">,</span>&nbsp;<span class="ident" id="2358789">prec</span>&nbsp;<span class="builtintype" id="2358794">int</span><span class="op" id="2358797">,</span>&nbsp;<span class="ident" id="2358799">bitSize</span>&nbsp;<span class="builtintype" id="2358807">int</span><span class="op" id="2358810">)</span>&nbsp;<span class="op" id="2358812">[</span><span class="op" id="2358813">]</span><span class="builtintype" id="2358814">byte</span>&nbsp;<span class="op" id="2358819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2358822">return</span>&nbsp;<span class="ident" id="2358829">genericFtoa</span><span class="op" id="2358840">(</span><span class="ident" id="2358841">dst</span><span class="op" id="2358844">,</span>&nbsp;<span class="ident" id="2358846">f</span><span class="op" id="2358847">,</span>&nbsp;<span class="ident" id="2358849">fmt</span><span class="op" id="2358852">,</span>&nbsp;<span class="ident" id="2358854">prec</span><span class="op" id="2358858">,</span>&nbsp;<span class="ident" id="2358860">bitSize</span><span class="op" id="2358867">)</span><br>
<span class="lineno"></span><span class="op" id="2358869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2358872">func</span>&nbsp;<span class="ident" id="2358877">genericFtoa</span><span class="op" id="2358888">(</span><span class="ident" id="2358889">dst</span>&nbsp;<span class="op" id="2358893">[</span><span class="op" id="2358894">]</span><span class="builtintype" id="2358895">byte</span><span class="op" id="2358899">,</span>&nbsp;<span class="ident" id="2358901">val</span>&nbsp;<span class="builtintype" id="2358905">float64</span><span class="op" id="2358912">,</span>&nbsp;<span class="ident" id="2358914">fmt</span>&nbsp;<span class="builtintype" id="2358918">byte</span><span class="op" id="2358922">,</span>&nbsp;<span class="ident" id="2358924">prec</span><span class="op" id="2358928">,</span>&nbsp;<span class="ident" id="2358930">bitSize</span>&nbsp;<span class="builtintype" id="2358938">int</span><span class="op" id="2358941">)</span>&nbsp;<span class="op" id="2358943">[</span><span class="op" id="2358944">]</span><span class="builtintype" id="2358945">byte</span>&nbsp;<span class="op" id="2358950">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2358953">var</span>&nbsp;<span class="ident" id="2358957">bits</span>&nbsp;<span class="ident" id="2358962">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2358970">var</span>&nbsp;<span class="ident" id="2358974">flt</span>&nbsp;<span class="op" id="2358978">*</span><span class="ident" id="2358979">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2358990">switch</span>&nbsp;<span class="ident" id="2358997">bitSize</span>&nbsp;<span class="op" id="2359005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359008">case</span>&nbsp;<span class="num" id="2359013">32</span><span class="op" id="2359015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359019">bits</span>&nbsp;<span class="op" id="2359024">=</span>&nbsp;<span class="ident" id="2359026">uint64</span><span class="op" id="2359032">(</span><span class="ident" id="2359033">math</span><span class="op" id="2359037">.</span><span class="ident" id="2359038">Float32bits</span><span class="op" id="2359049">(</span><span class="builtintype" id="2359050">float32</span><span class="op" id="2359057">(</span><span class="ident" id="2359058">val</span><span class="op" id="2359061">)</span><span class="op" id="2359062">)</span><span class="op" id="2359063">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359067">flt</span>&nbsp;<span class="op" id="2359071">=</span>&nbsp;<span class="op" id="2359073">&amp;</span><span class="ident" id="2359074">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359087">case</span>&nbsp;<span class="num" id="2359092">64</span><span class="op" id="2359094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359098">bits</span>&nbsp;<span class="op" id="2359103">=</span>&nbsp;<span class="ident" id="2359105">math</span><span class="op" id="2359109">.</span><span class="ident" id="2359110">Float64bits</span><span class="op" id="2359121">(</span><span class="ident" id="2359122">val</span><span class="op" id="2359125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359129">flt</span>&nbsp;<span class="op" id="2359133">=</span>&nbsp;<span class="op" id="2359135">&amp;</span><span class="ident" id="2359136">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359149">default</span><span class="op" id="2359156">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2359160">panic</span><span class="op" id="2359165">(</span><span class="string" id="2359166">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2359216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2359219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359223">neg</span>&nbsp;<span class="op" id="2359227">:=</span>&nbsp;<span class="ident" id="2359230">bits</span><span class="op" id="2359234">&gt;&gt;</span><span class="op" id="2359236">(</span><span class="ident" id="2359237">flt</span><span class="op" id="2359240">.</span><span class="ident" id="2359241">expbits</span><span class="op" id="2359248">+</span><span class="ident" id="2359249">flt</span><span class="op" id="2359252">.</span><span class="ident" id="2359253">mantbits</span><span class="op" id="2359261">)</span>&nbsp;<span class="op" id="2359263">!=</span>&nbsp;<span class="num" id="2359266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359269">exp</span>&nbsp;<span class="op" id="2359273">:=</span>&nbsp;<span class="builtintype" id="2359276">int</span><span class="op" id="2359279">(</span><span class="ident" id="2359280">bits</span><span class="op" id="2359284">&gt;&gt;</span><span class="ident" id="2359286">flt</span><span class="op" id="2359289">.</span><span class="ident" id="2359290">mantbits</span><span class="op" id="2359298">)</span>&nbsp;<span class="op" id="2359300">&amp;</span>&nbsp;<span class="op" id="2359302">(</span><span class="num" id="2359303">1</span><span class="op" id="2359304">&lt;&lt;</span><span class="ident" id="2359306">flt</span><span class="op" id="2359309">.</span><span class="ident" id="2359310">expbits</span>&nbsp;<span class="op" id="2359318">-</span>&nbsp;<span class="num" id="2359320">1</span><span class="op" id="2359321">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359324">mant</span>&nbsp;<span class="op" id="2359329">:=</span>&nbsp;<span class="ident" id="2359332">bits</span>&nbsp;<span class="op" id="2359337">&amp;</span>&nbsp;<span class="op" id="2359339">(</span><span class="ident" id="2359340">uint64</span><span class="op" id="2359346">(</span><span class="num" id="2359347">1</span><span class="op" id="2359348">)</span><span class="op" id="2359349">&lt;&lt;</span><span class="ident" id="2359351">flt</span><span class="op" id="2359354">.</span><span class="ident" id="2359355">mantbits</span>&nbsp;<span class="op" id="2359364">-</span>&nbsp;<span class="num" id="2359366">1</span><span class="op" id="2359367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359371">switch</span>&nbsp;<span class="ident" id="2359378">exp</span>&nbsp;<span class="op" id="2359382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359385">case</span>&nbsp;<span class="num" id="2359390">1</span><span class="op" id="2359391">&lt;&lt;</span><span class="ident" id="2359393">flt</span><span class="op" id="2359396">.</span><span class="ident" id="2359397">expbits</span>&nbsp;<span class="op" id="2359405">-</span>&nbsp;<span class="num" id="2359407">1</span><span class="op" id="2359408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2359412">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359426">var</span>&nbsp;<span class="ident" id="2359430">s</span>&nbsp;<span class="builtintype" id="2359432">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359441">switch</span>&nbsp;<span class="op" id="2359448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359452">case</span>&nbsp;<span class="ident" id="2359457">mant</span>&nbsp;<span class="op" id="2359462">!=</span>&nbsp;<span class="num" id="2359465">0</span><span class="op" id="2359466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359471">s</span>&nbsp;<span class="op" id="2359473">=</span>&nbsp;<span class="string" id="2359475">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359483">case</span>&nbsp;<span class="ident" id="2359488">neg</span><span class="op" id="2359491">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359496">s</span>&nbsp;<span class="op" id="2359498">=</span>&nbsp;<span class="string" id="2359500">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359509">default</span><span class="op" id="2359516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359521">s</span>&nbsp;<span class="op" id="2359523">=</span>&nbsp;<span class="string" id="2359525">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2359534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359538">return</span>&nbsp;<span class="builtinfunc" id="2359545">append</span><span class="op" id="2359551">(</span><span class="ident" id="2359552">dst</span><span class="op" id="2359555">,</span>&nbsp;<span class="ident" id="2359557">s</span><span class="op" id="2359558">...</span><span class="op" id="2359561">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359565">case</span>&nbsp;<span class="num" id="2359570">0</span><span class="op" id="2359571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2359575">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359593">exp</span><span class="op" id="2359596">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359601">default</span><span class="op" id="2359608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2359612">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359638">mant</span>&nbsp;<span class="op" id="2359643">|=</span>&nbsp;<span class="ident" id="2359646">uint64</span><span class="op" id="2359652">(</span><span class="num" id="2359653">1</span><span class="op" id="2359654">)</span>&nbsp;<span class="op" id="2359656">&lt;&lt;</span>&nbsp;<span class="ident" id="2359659">flt</span><span class="op" id="2359662">.</span><span class="ident" id="2359663">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2359673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359676">exp</span>&nbsp;<span class="op" id="2359680">+=</span>&nbsp;<span class="ident" id="2359683">flt</span><span class="op" id="2359686">.</span><span class="ident" id="2359687">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2359694">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359727">if</span>&nbsp;<span class="ident" id="2359730">fmt</span>&nbsp;<span class="op" id="2359734">==</span>&nbsp;<span class="string" id="2359737">&#39;b&#39;</span>&nbsp;<span class="op" id="2359741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359745">return</span>&nbsp;<span class="ident" id="2359752">fmtB</span><span class="op" id="2359756">(</span><span class="ident" id="2359757">dst</span><span class="op" id="2359760">,</span>&nbsp;<span class="ident" id="2359762">neg</span><span class="op" id="2359765">,</span>&nbsp;<span class="ident" id="2359767">mant</span><span class="op" id="2359771">,</span>&nbsp;<span class="ident" id="2359773">exp</span><span class="op" id="2359776">,</span>&nbsp;<span class="ident" id="2359778">flt</span><span class="op" id="2359781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2359784">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359788">if</span>&nbsp;<span class="op" id="2359791">!</span><span class="ident" id="2359792">optimize</span>&nbsp;<span class="op" id="2359801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359805">return</span>&nbsp;<span class="ident" id="2359812">bigFtoa</span><span class="op" id="2359819">(</span><span class="ident" id="2359820">dst</span><span class="op" id="2359823">,</span>&nbsp;<span class="ident" id="2359825">prec</span><span class="op" id="2359829">,</span>&nbsp;<span class="ident" id="2359831">fmt</span><span class="op" id="2359834">,</span>&nbsp;<span class="ident" id="2359836">neg</span><span class="op" id="2359839">,</span>&nbsp;<span class="ident" id="2359841">mant</span><span class="op" id="2359845">,</span>&nbsp;<span class="ident" id="2359847">exp</span><span class="op" id="2359850">,</span>&nbsp;<span class="ident" id="2359852">flt</span><span class="op" id="2359855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2359858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359862">var</span>&nbsp;<span class="ident" id="2359866">digs</span>&nbsp;<span class="ident" id="2359871">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359885">ok</span>&nbsp;<span class="op" id="2359888">:=</span>&nbsp;<span class="builtintype" id="2359891">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2359898">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2359965">shortest</span>&nbsp;<span class="op" id="2359974">:=</span>&nbsp;<span class="ident" id="2359977">prec</span>&nbsp;<span class="op" id="2359982">&lt;</span>&nbsp;<span class="num" id="2359984">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2359987">if</span>&nbsp;<span class="ident" id="2359990">shortest</span>&nbsp;<span class="op" id="2359999">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2360003">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360030">f</span>&nbsp;<span class="op" id="2360032">:=</span>&nbsp;<span class="builtinfunc" id="2360035">new</span><span class="op" id="2360038">(</span><span class="ident" id="2360039">extFloat</span><span class="op" id="2360047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360051">lower</span><span class="op" id="2360056">,</span>&nbsp;<span class="ident" id="2360058">upper</span>&nbsp;<span class="op" id="2360064">:=</span>&nbsp;<span class="ident" id="2360067">f</span><span class="op" id="2360068">.</span><span class="ident" id="2360069">AssignComputeBounds</span><span class="op" id="2360088">(</span><span class="ident" id="2360089">mant</span><span class="op" id="2360093">,</span>&nbsp;<span class="ident" id="2360095">exp</span><span class="op" id="2360098">,</span>&nbsp;<span class="ident" id="2360100">neg</span><span class="op" id="2360103">,</span>&nbsp;<span class="ident" id="2360105">flt</span><span class="op" id="2360108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360112">var</span>&nbsp;<span class="ident" id="2360116">buf</span>&nbsp;<span class="op" id="2360120">[</span><span class="num" id="2360121">32</span><span class="op" id="2360123">]</span><span class="builtintype" id="2360124">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360131">digs</span><span class="op" id="2360135">.</span><span class="ident" id="2360136">d</span>&nbsp;<span class="op" id="2360138">=</span>&nbsp;<span class="ident" id="2360140">buf</span><span class="op" id="2360143">[</span><span class="op" id="2360144">:</span><span class="op" id="2360145">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360149">ok</span>&nbsp;<span class="op" id="2360152">=</span>&nbsp;<span class="ident" id="2360154">f</span><span class="op" id="2360155">.</span><span class="ident" id="2360156">ShortestDecimal</span><span class="op" id="2360171">(</span><span class="op" id="2360172">&amp;</span><span class="ident" id="2360173">digs</span><span class="op" id="2360177">,</span>&nbsp;<span class="op" id="2360179">&amp;</span><span class="ident" id="2360180">lower</span><span class="op" id="2360185">,</span>&nbsp;<span class="op" id="2360187">&amp;</span><span class="ident" id="2360188">upper</span><span class="op" id="2360193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360197">if</span>&nbsp;<span class="op" id="2360200">!</span><span class="ident" id="2360201">ok</span>&nbsp;<span class="op" id="2360204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360209">return</span>&nbsp;<span class="ident" id="2360216">bigFtoa</span><span class="op" id="2360223">(</span><span class="ident" id="2360224">dst</span><span class="op" id="2360227">,</span>&nbsp;<span class="ident" id="2360229">prec</span><span class="op" id="2360233">,</span>&nbsp;<span class="ident" id="2360235">fmt</span><span class="op" id="2360238">,</span>&nbsp;<span class="ident" id="2360240">neg</span><span class="op" id="2360243">,</span>&nbsp;<span class="ident" id="2360245">mant</span><span class="op" id="2360249">,</span>&nbsp;<span class="ident" id="2360251">exp</span><span class="op" id="2360254">,</span>&nbsp;<span class="ident" id="2360256">flt</span><span class="op" id="2360259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2360267">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360316">switch</span>&nbsp;<span class="ident" id="2360323">fmt</span>&nbsp;<span class="op" id="2360327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360331">case</span>&nbsp;<span class="string" id="2360336">&#39;e&#39;</span><span class="op" id="2360339">,</span>&nbsp;<span class="string" id="2360341">&#39;E&#39;</span><span class="op" id="2360344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360349">prec</span>&nbsp;<span class="op" id="2360354">=</span>&nbsp;<span class="ident" id="2360356">digs</span><span class="op" id="2360360">.</span><span class="ident" id="2360361">nd</span>&nbsp;<span class="op" id="2360364">-</span>&nbsp;<span class="num" id="2360366">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360370">case</span>&nbsp;<span class="string" id="2360375">&#39;f&#39;</span><span class="op" id="2360378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360383">prec</span>&nbsp;<span class="op" id="2360388">=</span>&nbsp;<span class="ident" id="2360390">max</span><span class="op" id="2360393">(</span><span class="ident" id="2360394">digs</span><span class="op" id="2360398">.</span><span class="ident" id="2360399">nd</span><span class="op" id="2360401">-</span><span class="ident" id="2360402">digs</span><span class="op" id="2360406">.</span><span class="ident" id="2360407">dp</span><span class="op" id="2360409">,</span>&nbsp;<span class="num" id="2360411">0</span><span class="op" id="2360412">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360416">case</span>&nbsp;<span class="string" id="2360421">&#39;g&#39;</span><span class="op" id="2360424">,</span>&nbsp;<span class="string" id="2360426">&#39;G&#39;</span><span class="op" id="2360429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360434">prec</span>&nbsp;<span class="op" id="2360439">=</span>&nbsp;<span class="ident" id="2360441">digs</span><span class="op" id="2360445">.</span><span class="ident" id="2360446">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360454">}</span>&nbsp;<span class="keyword" id="2360456">else</span>&nbsp;<span class="keyword" id="2360461">if</span>&nbsp;<span class="ident" id="2360464">fmt</span>&nbsp;<span class="op" id="2360468">!=</span>&nbsp;<span class="string" id="2360471">&#39;f&#39;</span>&nbsp;<span class="op" id="2360475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2360479">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360508">digits</span>&nbsp;<span class="op" id="2360515">:=</span>&nbsp;<span class="ident" id="2360518">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360525">switch</span>&nbsp;<span class="ident" id="2360532">fmt</span>&nbsp;<span class="op" id="2360536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360540">case</span>&nbsp;<span class="string" id="2360545">&#39;e&#39;</span><span class="op" id="2360548">,</span>&nbsp;<span class="string" id="2360550">&#39;E&#39;</span><span class="op" id="2360553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360558">digits</span><span class="op" id="2360564">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360569">case</span>&nbsp;<span class="string" id="2360574">&#39;g&#39;</span><span class="op" id="2360577">,</span>&nbsp;<span class="string" id="2360579">&#39;G&#39;</span><span class="op" id="2360582">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360587">if</span>&nbsp;<span class="ident" id="2360590">prec</span>&nbsp;<span class="op" id="2360595">==</span>&nbsp;<span class="num" id="2360598">0</span>&nbsp;<span class="op" id="2360600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360606">prec</span>&nbsp;<span class="op" id="2360611">=</span>&nbsp;<span class="num" id="2360613">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360623">digits</span>&nbsp;<span class="op" id="2360630">=</span>&nbsp;<span class="ident" id="2360632">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360639">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360643">if</span>&nbsp;<span class="ident" id="2360646">digits</span>&nbsp;<span class="op" id="2360653">&lt;=</span>&nbsp;<span class="num" id="2360656">15</span>&nbsp;<span class="op" id="2360659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2360664">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360730">var</span>&nbsp;<span class="ident" id="2360734">buf</span>&nbsp;<span class="op" id="2360738">[</span><span class="num" id="2360739">24</span><span class="op" id="2360741">]</span><span class="builtintype" id="2360742">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360750">digs</span><span class="op" id="2360754">.</span><span class="ident" id="2360755">d</span>&nbsp;<span class="op" id="2360757">=</span>&nbsp;<span class="ident" id="2360759">buf</span><span class="op" id="2360762">[</span><span class="op" id="2360763">:</span><span class="op" id="2360764">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360769">f</span>&nbsp;<span class="op" id="2360771">:=</span>&nbsp;<span class="ident" id="2360774">extFloat</span><span class="op" id="2360782">{</span><span class="ident" id="2360783">mant</span><span class="op" id="2360787">,</span>&nbsp;<span class="ident" id="2360789">exp</span>&nbsp;<span class="op" id="2360793">-</span>&nbsp;<span class="builtintype" id="2360795">int</span><span class="op" id="2360798">(</span><span class="ident" id="2360799">flt</span><span class="op" id="2360802">.</span><span class="ident" id="2360803">mantbits</span><span class="op" id="2360811">)</span><span class="op" id="2360812">,</span>&nbsp;<span class="ident" id="2360814">neg</span><span class="op" id="2360817">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2360822">ok</span>&nbsp;<span class="op" id="2360825">=</span>&nbsp;<span class="ident" id="2360827">f</span><span class="op" id="2360828">.</span><span class="ident" id="2360829">FixedDecimal</span><span class="op" id="2360841">(</span><span class="op" id="2360842">&amp;</span><span class="ident" id="2360843">digs</span><span class="op" id="2360847">,</span>&nbsp;<span class="ident" id="2360849">digits</span><span class="op" id="2360855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360865">if</span>&nbsp;<span class="op" id="2360868">!</span><span class="ident" id="2360869">ok</span>&nbsp;<span class="op" id="2360872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360876">return</span>&nbsp;<span class="ident" id="2360883">bigFtoa</span><span class="op" id="2360890">(</span><span class="ident" id="2360891">dst</span><span class="op" id="2360894">,</span>&nbsp;<span class="ident" id="2360896">prec</span><span class="op" id="2360900">,</span>&nbsp;<span class="ident" id="2360902">fmt</span><span class="op" id="2360905">,</span>&nbsp;<span class="ident" id="2360907">neg</span><span class="op" id="2360910">,</span>&nbsp;<span class="ident" id="2360912">mant</span><span class="op" id="2360916">,</span>&nbsp;<span class="ident" id="2360918">exp</span><span class="op" id="2360921">,</span>&nbsp;<span class="ident" id="2360923">flt</span><span class="op" id="2360926">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2360929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2360932">return</span>&nbsp;<span class="ident" id="2360939">formatDigits</span><span class="op" id="2360951">(</span><span class="ident" id="2360952">dst</span><span class="op" id="2360955">,</span>&nbsp;<span class="ident" id="2360957">shortest</span><span class="op" id="2360965">,</span>&nbsp;<span class="ident" id="2360967">neg</span><span class="op" id="2360970">,</span>&nbsp;<span class="ident" id="2360972">digs</span><span class="op" id="2360976">,</span>&nbsp;<span class="ident" id="2360978">prec</span><span class="op" id="2360982">,</span>&nbsp;<span class="ident" id="2360984">fmt</span><span class="op" id="2360987">)</span><br>
<span class="lineno"></span><span class="op" id="2360989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2360992">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2361055">func</span>&nbsp;<span class="ident" id="2361060">bigFtoa</span><span class="op" id="2361067">(</span><span class="ident" id="2361068">dst</span>&nbsp;<span class="op" id="2361072">[</span><span class="op" id="2361073">]</span><span class="builtintype" id="2361074">byte</span><span class="op" id="2361078">,</span>&nbsp;<span class="ident" id="2361080">prec</span>&nbsp;<span class="builtintype" id="2361085">int</span><span class="op" id="2361088">,</span>&nbsp;<span class="ident" id="2361090">fmt</span>&nbsp;<span class="builtintype" id="2361094">byte</span><span class="op" id="2361098">,</span>&nbsp;<span class="ident" id="2361100">neg</span>&nbsp;<span class="builtintype" id="2361104">bool</span><span class="op" id="2361108">,</span>&nbsp;<span class="ident" id="2361110">mant</span>&nbsp;<span class="ident" id="2361115">uint64</span><span class="op" id="2361121">,</span>&nbsp;<span class="ident" id="2361123">exp</span>&nbsp;<span class="builtintype" id="2361127">int</span><span class="op" id="2361130">,</span>&nbsp;<span class="ident" id="2361132">flt</span>&nbsp;<span class="op" id="2361136">*</span><span class="ident" id="2361137">floatInfo</span><span class="op" id="2361146">)</span>&nbsp;<span class="op" id="2361148">[</span><span class="op" id="2361149">]</span><span class="builtintype" id="2361150">byte</span>&nbsp;<span class="op" id="2361155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361158">d</span>&nbsp;<span class="op" id="2361160">:=</span>&nbsp;<span class="builtinfunc" id="2361163">new</span><span class="op" id="2361166">(</span><span class="ident" id="2361167">decimal</span><span class="op" id="2361174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361177">d</span><span class="op" id="2361178">.</span><span class="ident" id="2361179">Assign</span><span class="op" id="2361185">(</span><span class="ident" id="2361186">mant</span><span class="op" id="2361190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361193">d</span><span class="op" id="2361194">.</span><span class="ident" id="2361195">Shift</span><span class="op" id="2361200">(</span><span class="ident" id="2361201">exp</span>&nbsp;<span class="op" id="2361205">-</span>&nbsp;<span class="builtintype" id="2361207">int</span><span class="op" id="2361210">(</span><span class="ident" id="2361211">flt</span><span class="op" id="2361214">.</span><span class="ident" id="2361215">mantbits</span><span class="op" id="2361223">)</span><span class="op" id="2361224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361227">var</span>&nbsp;<span class="ident" id="2361231">digs</span>&nbsp;<span class="ident" id="2361236">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361250">shortest</span>&nbsp;<span class="op" id="2361259">:=</span>&nbsp;<span class="ident" id="2361262">prec</span>&nbsp;<span class="op" id="2361267">&lt;</span>&nbsp;<span class="num" id="2361269">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361272">if</span>&nbsp;<span class="ident" id="2361275">shortest</span>&nbsp;<span class="op" id="2361284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361288">roundShortest</span><span class="op" id="2361301">(</span><span class="ident" id="2361302">d</span><span class="op" id="2361303">,</span>&nbsp;<span class="ident" id="2361305">mant</span><span class="op" id="2361309">,</span>&nbsp;<span class="ident" id="2361311">exp</span><span class="op" id="2361314">,</span>&nbsp;<span class="ident" id="2361316">flt</span><span class="op" id="2361319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361323">digs</span>&nbsp;<span class="op" id="2361328">=</span>&nbsp;<span class="ident" id="2361330">decimalSlice</span><span class="op" id="2361342">{</span><span class="ident" id="2361343">d</span><span class="op" id="2361344">:</span>&nbsp;<span class="ident" id="2361346">d</span><span class="op" id="2361347">.</span><span class="ident" id="2361348">d</span><span class="op" id="2361349">[</span><span class="op" id="2361350">:</span><span class="op" id="2361351">]</span><span class="op" id="2361352">,</span>&nbsp;<span class="ident" id="2361354">nd</span><span class="op" id="2361356">:</span>&nbsp;<span class="ident" id="2361358">d</span><span class="op" id="2361359">.</span><span class="ident" id="2361360">nd</span><span class="op" id="2361362">,</span>&nbsp;<span class="ident" id="2361364">dp</span><span class="op" id="2361366">:</span>&nbsp;<span class="ident" id="2361368">d</span><span class="op" id="2361369">.</span><span class="ident" id="2361370">dp</span><span class="op" id="2361372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2361376">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361425">switch</span>&nbsp;<span class="ident" id="2361432">fmt</span>&nbsp;<span class="op" id="2361436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361440">case</span>&nbsp;<span class="string" id="2361445">&#39;e&#39;</span><span class="op" id="2361448">,</span>&nbsp;<span class="string" id="2361450">&#39;E&#39;</span><span class="op" id="2361453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361458">prec</span>&nbsp;<span class="op" id="2361463">=</span>&nbsp;<span class="ident" id="2361465">digs</span><span class="op" id="2361469">.</span><span class="ident" id="2361470">nd</span>&nbsp;<span class="op" id="2361473">-</span>&nbsp;<span class="num" id="2361475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361479">case</span>&nbsp;<span class="string" id="2361484">&#39;f&#39;</span><span class="op" id="2361487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361492">prec</span>&nbsp;<span class="op" id="2361497">=</span>&nbsp;<span class="ident" id="2361499">max</span><span class="op" id="2361502">(</span><span class="ident" id="2361503">digs</span><span class="op" id="2361507">.</span><span class="ident" id="2361508">nd</span><span class="op" id="2361510">-</span><span class="ident" id="2361511">digs</span><span class="op" id="2361515">.</span><span class="ident" id="2361516">dp</span><span class="op" id="2361518">,</span>&nbsp;<span class="num" id="2361520">0</span><span class="op" id="2361521">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361525">case</span>&nbsp;<span class="string" id="2361530">&#39;g&#39;</span><span class="op" id="2361533">,</span>&nbsp;<span class="string" id="2361535">&#39;G&#39;</span><span class="op" id="2361538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361543">prec</span>&nbsp;<span class="op" id="2361548">=</span>&nbsp;<span class="ident" id="2361550">digs</span><span class="op" id="2361554">.</span><span class="ident" id="2361555">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2361560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2361563">}</span>&nbsp;<span class="keyword" id="2361565">else</span>&nbsp;<span class="op" id="2361570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2361574">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361600">switch</span>&nbsp;<span class="ident" id="2361607">fmt</span>&nbsp;<span class="op" id="2361611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361615">case</span>&nbsp;<span class="string" id="2361620">&#39;e&#39;</span><span class="op" id="2361623">,</span>&nbsp;<span class="string" id="2361625">&#39;E&#39;</span><span class="op" id="2361628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361633">d</span><span class="op" id="2361634">.</span><span class="ident" id="2361635">Round</span><span class="op" id="2361640">(</span><span class="ident" id="2361641">prec</span>&nbsp;<span class="op" id="2361646">+</span>&nbsp;<span class="num" id="2361648">1</span><span class="op" id="2361649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361653">case</span>&nbsp;<span class="string" id="2361658">&#39;f&#39;</span><span class="op" id="2361661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361666">d</span><span class="op" id="2361667">.</span><span class="ident" id="2361668">Round</span><span class="op" id="2361673">(</span><span class="ident" id="2361674">d</span><span class="op" id="2361675">.</span><span class="ident" id="2361676">dp</span>&nbsp;<span class="op" id="2361679">+</span>&nbsp;<span class="ident" id="2361681">prec</span><span class="op" id="2361685">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361689">case</span>&nbsp;<span class="string" id="2361694">&#39;g&#39;</span><span class="op" id="2361697">,</span>&nbsp;<span class="string" id="2361699">&#39;G&#39;</span><span class="op" id="2361702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361707">if</span>&nbsp;<span class="ident" id="2361710">prec</span>&nbsp;<span class="op" id="2361715">==</span>&nbsp;<span class="num" id="2361718">0</span>&nbsp;<span class="op" id="2361720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361726">prec</span>&nbsp;<span class="op" id="2361731">=</span>&nbsp;<span class="num" id="2361733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2361738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361743">d</span><span class="op" id="2361744">.</span><span class="ident" id="2361745">Round</span><span class="op" id="2361750">(</span><span class="ident" id="2361751">prec</span><span class="op" id="2361755">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2361759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2361763">digs</span>&nbsp;<span class="op" id="2361768">=</span>&nbsp;<span class="ident" id="2361770">decimalSlice</span><span class="op" id="2361782">{</span><span class="ident" id="2361783">d</span><span class="op" id="2361784">:</span>&nbsp;<span class="ident" id="2361786">d</span><span class="op" id="2361787">.</span><span class="ident" id="2361788">d</span><span class="op" id="2361789">[</span><span class="op" id="2361790">:</span><span class="op" id="2361791">]</span><span class="op" id="2361792">,</span>&nbsp;<span class="ident" id="2361794">nd</span><span class="op" id="2361796">:</span>&nbsp;<span class="ident" id="2361798">d</span><span class="op" id="2361799">.</span><span class="ident" id="2361800">nd</span><span class="op" id="2361802">,</span>&nbsp;<span class="ident" id="2361804">dp</span><span class="op" id="2361806">:</span>&nbsp;<span class="ident" id="2361808">d</span><span class="op" id="2361809">.</span><span class="ident" id="2361810">dp</span><span class="op" id="2361812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2361815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361818">return</span>&nbsp;<span class="ident" id="2361825">formatDigits</span><span class="op" id="2361837">(</span><span class="ident" id="2361838">dst</span><span class="op" id="2361841">,</span>&nbsp;<span class="ident" id="2361843">shortest</span><span class="op" id="2361851">,</span>&nbsp;<span class="ident" id="2361853">neg</span><span class="op" id="2361856">,</span>&nbsp;<span class="ident" id="2361858">digs</span><span class="op" id="2361862">,</span>&nbsp;<span class="ident" id="2361864">prec</span><span class="op" id="2361868">,</span>&nbsp;<span class="ident" id="2361870">fmt</span><span class="op" id="2361873">)</span><br>
<span class="lineno"></span><span class="op" id="2361875">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2361878">func</span>&nbsp;<span class="ident" id="2361883">formatDigits</span><span class="op" id="2361895">(</span><span class="ident" id="2361896">dst</span>&nbsp;<span class="op" id="2361900">[</span><span class="op" id="2361901">]</span><span class="builtintype" id="2361902">byte</span><span class="op" id="2361906">,</span>&nbsp;<span class="ident" id="2361908">shortest</span>&nbsp;<span class="builtintype" id="2361917">bool</span><span class="op" id="2361921">,</span>&nbsp;<span class="ident" id="2361923">neg</span>&nbsp;<span class="builtintype" id="2361927">bool</span><span class="op" id="2361931">,</span>&nbsp;<span class="ident" id="2361933">digs</span>&nbsp;<span class="ident" id="2361938">decimalSlice</span><span class="op" id="2361950">,</span>&nbsp;<span class="ident" id="2361952">prec</span>&nbsp;<span class="builtintype" id="2361957">int</span><span class="op" id="2361960">,</span>&nbsp;<span class="ident" id="2361962">fmt</span>&nbsp;<span class="builtintype" id="2361966">byte</span><span class="op" id="2361970">)</span>&nbsp;<span class="op" id="2361972">[</span><span class="op" id="2361973">]</span><span class="builtintype" id="2361974">byte</span>&nbsp;<span class="op" id="2361979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361982">switch</span>&nbsp;<span class="ident" id="2361989">fmt</span>&nbsp;<span class="op" id="2361993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2361996">case</span>&nbsp;<span class="string" id="2362001">&#39;e&#39;</span><span class="op" id="2362004">,</span>&nbsp;<span class="string" id="2362006">&#39;E&#39;</span><span class="op" id="2362009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362013">return</span>&nbsp;<span class="ident" id="2362020">fmtE</span><span class="op" id="2362024">(</span><span class="ident" id="2362025">dst</span><span class="op" id="2362028">,</span>&nbsp;<span class="ident" id="2362030">neg</span><span class="op" id="2362033">,</span>&nbsp;<span class="ident" id="2362035">digs</span><span class="op" id="2362039">,</span>&nbsp;<span class="ident" id="2362041">prec</span><span class="op" id="2362045">,</span>&nbsp;<span class="ident" id="2362047">fmt</span><span class="op" id="2362050">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362053">case</span>&nbsp;<span class="string" id="2362058">&#39;f&#39;</span><span class="op" id="2362061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362065">return</span>&nbsp;<span class="ident" id="2362072">fmtF</span><span class="op" id="2362076">(</span><span class="ident" id="2362077">dst</span><span class="op" id="2362080">,</span>&nbsp;<span class="ident" id="2362082">neg</span><span class="op" id="2362085">,</span>&nbsp;<span class="ident" id="2362087">digs</span><span class="op" id="2362091">,</span>&nbsp;<span class="ident" id="2362093">prec</span><span class="op" id="2362097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362100">case</span>&nbsp;<span class="string" id="2362105">&#39;g&#39;</span><span class="op" id="2362108">,</span>&nbsp;<span class="string" id="2362110">&#39;G&#39;</span><span class="op" id="2362113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2362117">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362177">eprec</span>&nbsp;<span class="op" id="2362183">:=</span>&nbsp;<span class="ident" id="2362186">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362193">if</span>&nbsp;<span class="ident" id="2362196">eprec</span>&nbsp;<span class="op" id="2362202">&gt;</span>&nbsp;<span class="ident" id="2362204">digs</span><span class="op" id="2362208">.</span><span class="ident" id="2362209">nd</span>&nbsp;<span class="op" id="2362212">&amp;&amp;</span>&nbsp;<span class="ident" id="2362215">digs</span><span class="op" id="2362219">.</span><span class="ident" id="2362220">nd</span>&nbsp;<span class="op" id="2362223">&gt;=</span>&nbsp;<span class="ident" id="2362226">digs</span><span class="op" id="2362230">.</span><span class="ident" id="2362231">dp</span>&nbsp;<span class="op" id="2362234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362239">eprec</span>&nbsp;<span class="op" id="2362245">=</span>&nbsp;<span class="ident" id="2362247">digs</span><span class="op" id="2362251">.</span><span class="ident" id="2362252">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2362261">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2362313">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2362377">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362457">if</span>&nbsp;<span class="ident" id="2362460">shortest</span>&nbsp;<span class="op" id="2362469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362474">eprec</span>&nbsp;<span class="op" id="2362480">=</span>&nbsp;<span class="num" id="2362482">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362490">exp</span>&nbsp;<span class="op" id="2362494">:=</span>&nbsp;<span class="ident" id="2362497">digs</span><span class="op" id="2362501">.</span><span class="ident" id="2362502">dp</span>&nbsp;<span class="op" id="2362505">-</span>&nbsp;<span class="num" id="2362507">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362511">if</span>&nbsp;<span class="ident" id="2362514">exp</span>&nbsp;<span class="op" id="2362518">&lt;</span>&nbsp;<span class="op" id="2362520">-</span><span class="num" id="2362521">4</span>&nbsp;<span class="op" id="2362523">||</span>&nbsp;<span class="ident" id="2362526">exp</span>&nbsp;<span class="op" id="2362530">&gt;=</span>&nbsp;<span class="ident" id="2362533">eprec</span>&nbsp;<span class="op" id="2362539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362544">if</span>&nbsp;<span class="ident" id="2362547">prec</span>&nbsp;<span class="op" id="2362552">&gt;</span>&nbsp;<span class="ident" id="2362554">digs</span><span class="op" id="2362558">.</span><span class="ident" id="2362559">nd</span>&nbsp;<span class="op" id="2362562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362568">prec</span>&nbsp;<span class="op" id="2362573">=</span>&nbsp;<span class="ident" id="2362575">digs</span><span class="op" id="2362579">.</span><span class="ident" id="2362580">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362591">return</span>&nbsp;<span class="ident" id="2362598">fmtE</span><span class="op" id="2362602">(</span><span class="ident" id="2362603">dst</span><span class="op" id="2362606">,</span>&nbsp;<span class="ident" id="2362608">neg</span><span class="op" id="2362611">,</span>&nbsp;<span class="ident" id="2362613">digs</span><span class="op" id="2362617">,</span>&nbsp;<span class="ident" id="2362619">prec</span><span class="op" id="2362623">-</span><span class="num" id="2362624">1</span><span class="op" id="2362625">,</span>&nbsp;<span class="ident" id="2362627">fmt</span><span class="op" id="2362630">+</span><span class="string" id="2362631">&#39;e&#39;</span><span class="op" id="2362634">-</span><span class="string" id="2362635">&#39;g&#39;</span><span class="op" id="2362638">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362646">if</span>&nbsp;<span class="ident" id="2362649">prec</span>&nbsp;<span class="op" id="2362654">&gt;</span>&nbsp;<span class="ident" id="2362656">digs</span><span class="op" id="2362660">.</span><span class="ident" id="2362661">dp</span>&nbsp;<span class="op" id="2362664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2362669">prec</span>&nbsp;<span class="op" id="2362674">=</span>&nbsp;<span class="ident" id="2362676">digs</span><span class="op" id="2362680">.</span><span class="ident" id="2362681">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362690">return</span>&nbsp;<span class="ident" id="2362697">fmtF</span><span class="op" id="2362701">(</span><span class="ident" id="2362702">dst</span><span class="op" id="2362705">,</span>&nbsp;<span class="ident" id="2362707">neg</span><span class="op" id="2362710">,</span>&nbsp;<span class="ident" id="2362712">digs</span><span class="op" id="2362716">,</span>&nbsp;<span class="ident" id="2362718">max</span><span class="op" id="2362721">(</span><span class="ident" id="2362722">prec</span><span class="op" id="2362726">-</span><span class="ident" id="2362727">digs</span><span class="op" id="2362731">.</span><span class="ident" id="2362732">dp</span><span class="op" id="2362734">,</span>&nbsp;<span class="num" id="2362736">0</span><span class="op" id="2362737">)</span><span class="op" id="2362738">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2362741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2362745">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2362764">return</span>&nbsp;<span class="builtinfunc" id="2362771">append</span><span class="op" id="2362777">(</span><span class="ident" id="2362778">dst</span><span class="op" id="2362781">,</span>&nbsp;<span class="string" id="2362783">&#39;%&#39;</span><span class="op" id="2362786">,</span>&nbsp;<span class="ident" id="2362788">fmt</span><span class="op" id="2362791">)</span><br>
<span class="lineno"></span><span class="op" id="2362793">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2362796">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2362857">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2362921">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2362989">func</span>&nbsp;<span class="ident" id="2362994">roundShortest</span><span class="op" id="2363007">(</span><span class="ident" id="2363008">d</span>&nbsp;<span class="op" id="2363010">*</span><span class="ident" id="2363011">decimal</span><span class="op" id="2363018">,</span>&nbsp;<span class="ident" id="2363020">mant</span>&nbsp;<span class="ident" id="2363025">uint64</span><span class="op" id="2363031">,</span>&nbsp;<span class="ident" id="2363033">exp</span>&nbsp;<span class="builtintype" id="2363037">int</span><span class="op" id="2363040">,</span>&nbsp;<span class="ident" id="2363042">flt</span>&nbsp;<span class="op" id="2363046">*</span><span class="ident" id="2363047">floatInfo</span><span class="op" id="2363056">)</span>&nbsp;<span class="op" id="2363058">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363061">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2363116">if</span>&nbsp;<span class="ident" id="2363119">mant</span>&nbsp;<span class="op" id="2363124">==</span>&nbsp;<span class="num" id="2363127">0</span>&nbsp;<span class="op" id="2363129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2363133">d</span><span class="op" id="2363134">.</span><span class="ident" id="2363135">nd</span>&nbsp;<span class="op" id="2363138">=</span>&nbsp;<span class="num" id="2363140">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2363144">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2363152">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363156">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363213">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363262">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363317">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363377">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363381">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363440">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363500">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363558">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363588">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363592">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363664">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363717">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2363786">minexp</span>&nbsp;<span class="op" id="2363793">:=</span>&nbsp;<span class="ident" id="2363796">flt</span><span class="op" id="2363799">.</span><span class="ident" id="2363800">bias</span>&nbsp;<span class="op" id="2363805">+</span>&nbsp;<span class="num" id="2363807">1</span>&nbsp;<span class="comment" id="2363809">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2363839">if</span>&nbsp;<span class="ident" id="2363842">exp</span>&nbsp;<span class="op" id="2363846">&gt;</span>&nbsp;<span class="ident" id="2363848">minexp</span>&nbsp;<span class="op" id="2363855">&amp;&amp;</span>&nbsp;<span class="num" id="2363858">332</span><span class="op" id="2363861">*</span><span class="op" id="2363862">(</span><span class="ident" id="2363863">d</span><span class="op" id="2363864">.</span><span class="ident" id="2363865">dp</span><span class="op" id="2363867">-</span><span class="ident" id="2363868">d</span><span class="op" id="2363869">.</span><span class="ident" id="2363870">nd</span><span class="op" id="2363872">)</span>&nbsp;<span class="op" id="2363874">&gt;=</span>&nbsp;<span class="num" id="2363877">100</span><span class="op" id="2363880">*</span><span class="op" id="2363881">(</span><span class="ident" id="2363882">exp</span><span class="op" id="2363885">-</span><span class="builtintype" id="2363886">int</span><span class="op" id="2363889">(</span><span class="ident" id="2363890">flt</span><span class="op" id="2363893">.</span><span class="ident" id="2363894">mantbits</span><span class="op" id="2363902">)</span><span class="op" id="2363903">)</span>&nbsp;<span class="op" id="2363905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363909">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2363946">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2363954">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363958">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2363991">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364057">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364125">upper</span>&nbsp;<span class="op" id="2364131">:=</span>&nbsp;<span class="builtinfunc" id="2364134">new</span><span class="op" id="2364137">(</span><span class="ident" id="2364138">decimal</span><span class="op" id="2364145">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364148">upper</span><span class="op" id="2364153">.</span><span class="ident" id="2364154">Assign</span><span class="op" id="2364160">(</span><span class="ident" id="2364161">mant</span><span class="op" id="2364165">*</span><span class="num" id="2364166">2</span>&nbsp;<span class="op" id="2364168">+</span>&nbsp;<span class="num" id="2364170">1</span><span class="op" id="2364171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364174">upper</span><span class="op" id="2364179">.</span><span class="ident" id="2364180">Shift</span><span class="op" id="2364185">(</span><span class="ident" id="2364186">exp</span>&nbsp;<span class="op" id="2364190">-</span>&nbsp;<span class="builtintype" id="2364192">int</span><span class="op" id="2364195">(</span><span class="ident" id="2364196">flt</span><span class="op" id="2364199">.</span><span class="ident" id="2364200">mantbits</span><span class="op" id="2364208">)</span>&nbsp;<span class="op" id="2364210">-</span>&nbsp;<span class="num" id="2364212">1</span><span class="op" id="2364213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364217">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364250">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364315">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364391">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364456">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364506">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2364578">var</span>&nbsp;<span class="ident" id="2364582">mantlo</span>&nbsp;<span class="ident" id="2364589">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2364597">var</span>&nbsp;<span class="ident" id="2364601">explo</span>&nbsp;<span class="builtintype" id="2364607">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2364612">if</span>&nbsp;<span class="ident" id="2364615">mant</span>&nbsp;<span class="op" id="2364620">&gt;</span>&nbsp;<span class="num" id="2364622">1</span><span class="op" id="2364623">&lt;&lt;</span><span class="ident" id="2364625">flt</span><span class="op" id="2364628">.</span><span class="ident" id="2364629">mantbits</span>&nbsp;<span class="op" id="2364638">||</span>&nbsp;<span class="ident" id="2364641">exp</span>&nbsp;<span class="op" id="2364645">==</span>&nbsp;<span class="ident" id="2364648">minexp</span>&nbsp;<span class="op" id="2364655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364659">mantlo</span>&nbsp;<span class="op" id="2364666">=</span>&nbsp;<span class="ident" id="2364668">mant</span>&nbsp;<span class="op" id="2364673">-</span>&nbsp;<span class="num" id="2364675">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364679">explo</span>&nbsp;<span class="op" id="2364685">=</span>&nbsp;<span class="ident" id="2364687">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2364692">}</span>&nbsp;<span class="keyword" id="2364694">else</span>&nbsp;<span class="op" id="2364699">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364703">mantlo</span>&nbsp;<span class="op" id="2364710">=</span>&nbsp;<span class="ident" id="2364712">mant</span><span class="op" id="2364716">*</span><span class="num" id="2364717">2</span>&nbsp;<span class="op" id="2364719">-</span>&nbsp;<span class="num" id="2364721">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364725">explo</span>&nbsp;<span class="op" id="2364731">=</span>&nbsp;<span class="ident" id="2364733">exp</span>&nbsp;<span class="op" id="2364737">-</span>&nbsp;<span class="num" id="2364739">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2364742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364745">lower</span>&nbsp;<span class="op" id="2364751">:=</span>&nbsp;<span class="builtinfunc" id="2364754">new</span><span class="op" id="2364757">(</span><span class="ident" id="2364758">decimal</span><span class="op" id="2364765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364768">lower</span><span class="op" id="2364773">.</span><span class="ident" id="2364774">Assign</span><span class="op" id="2364780">(</span><span class="ident" id="2364781">mantlo</span><span class="op" id="2364787">*</span><span class="num" id="2364788">2</span>&nbsp;<span class="op" id="2364790">+</span>&nbsp;<span class="num" id="2364792">1</span><span class="op" id="2364793">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2364796">lower</span><span class="op" id="2364801">.</span><span class="ident" id="2364802">Shift</span><span class="op" id="2364807">(</span><span class="ident" id="2364808">explo</span>&nbsp;<span class="op" id="2364814">-</span>&nbsp;<span class="builtintype" id="2364816">int</span><span class="op" id="2364819">(</span><span class="ident" id="2364820">flt</span><span class="op" id="2364823">.</span><span class="ident" id="2364824">mantbits</span><span class="op" id="2364832">)</span>&nbsp;<span class="op" id="2364834">-</span>&nbsp;<span class="num" id="2364836">1</span><span class="op" id="2364837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364841">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364901">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2364963">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365027">inclusive</span>&nbsp;<span class="op" id="2365037">:=</span>&nbsp;<span class="ident" id="2365040">mant</span><span class="op" id="2365044">%</span><span class="num" id="2365045">2</span>&nbsp;<span class="op" id="2365047">==</span>&nbsp;<span class="num" id="2365050">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365054">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365119">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365189">for</span>&nbsp;<span class="ident" id="2365193">i</span>&nbsp;<span class="op" id="2365195">:=</span>&nbsp;<span class="num" id="2365198">0</span><span class="op" id="2365199">;</span>&nbsp;<span class="ident" id="2365201">i</span>&nbsp;<span class="op" id="2365203">&lt;</span>&nbsp;<span class="ident" id="2365205">d</span><span class="op" id="2365206">.</span><span class="ident" id="2365207">nd</span><span class="op" id="2365209">;</span>&nbsp;<span class="ident" id="2365211">i</span><span class="op" id="2365212">++</span>&nbsp;<span class="op" id="2365215">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365219">var</span>&nbsp;<span class="ident" id="2365223">l</span><span class="op" id="2365224">,</span>&nbsp;<span class="ident" id="2365226">m</span><span class="op" id="2365227">,</span>&nbsp;<span class="ident" id="2365229">u</span>&nbsp;<span class="builtintype" id="2365231">byte</span>&nbsp;<span class="comment" id="2365236">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365269">if</span>&nbsp;<span class="ident" id="2365272">i</span>&nbsp;<span class="op" id="2365274">&lt;</span>&nbsp;<span class="ident" id="2365276">lower</span><span class="op" id="2365281">.</span><span class="ident" id="2365282">nd</span>&nbsp;<span class="op" id="2365285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365290">l</span>&nbsp;<span class="op" id="2365292">=</span>&nbsp;<span class="ident" id="2365294">lower</span><span class="op" id="2365299">.</span><span class="ident" id="2365300">d</span><span class="op" id="2365301">[</span><span class="ident" id="2365302">i</span><span class="op" id="2365303">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2365307">}</span>&nbsp;<span class="keyword" id="2365309">else</span>&nbsp;<span class="op" id="2365314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365319">l</span>&nbsp;<span class="op" id="2365321">=</span>&nbsp;<span class="string" id="2365323">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2365329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365333">m</span>&nbsp;<span class="op" id="2365335">=</span>&nbsp;<span class="ident" id="2365337">d</span><span class="op" id="2365338">.</span><span class="ident" id="2365339">d</span><span class="op" id="2365340">[</span><span class="ident" id="2365341">i</span><span class="op" id="2365342">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365346">if</span>&nbsp;<span class="ident" id="2365349">i</span>&nbsp;<span class="op" id="2365351">&lt;</span>&nbsp;<span class="ident" id="2365353">upper</span><span class="op" id="2365358">.</span><span class="ident" id="2365359">nd</span>&nbsp;<span class="op" id="2365362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365367">u</span>&nbsp;<span class="op" id="2365369">=</span>&nbsp;<span class="ident" id="2365371">upper</span><span class="op" id="2365376">.</span><span class="ident" id="2365377">d</span><span class="op" id="2365378">[</span><span class="ident" id="2365379">i</span><span class="op" id="2365380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2365384">}</span>&nbsp;<span class="keyword" id="2365386">else</span>&nbsp;<span class="op" id="2365391">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365396">u</span>&nbsp;<span class="op" id="2365398">=</span>&nbsp;<span class="string" id="2365400">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2365406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365411">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365477">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365551">okdown</span>&nbsp;<span class="op" id="2365558">:=</span>&nbsp;<span class="ident" id="2365561">l</span>&nbsp;<span class="op" id="2365563">!=</span>&nbsp;<span class="ident" id="2365566">m</span>&nbsp;<span class="op" id="2365568">||</span>&nbsp;<span class="op" id="2365571">(</span><span class="ident" id="2365572">inclusive</span>&nbsp;<span class="op" id="2365582">&amp;&amp;</span>&nbsp;<span class="ident" id="2365585">l</span>&nbsp;<span class="op" id="2365587">==</span>&nbsp;<span class="ident" id="2365590">m</span>&nbsp;<span class="op" id="2365592">&amp;&amp;</span>&nbsp;<span class="ident" id="2365595">i</span><span class="op" id="2365596">+</span><span class="num" id="2365597">1</span>&nbsp;<span class="op" id="2365599">==</span>&nbsp;<span class="ident" id="2365602">lower</span><span class="op" id="2365607">.</span><span class="ident" id="2365608">nd</span><span class="op" id="2365610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365615">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365672">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365754">okup</span>&nbsp;<span class="op" id="2365759">:=</span>&nbsp;<span class="ident" id="2365762">m</span>&nbsp;<span class="op" id="2365764">!=</span>&nbsp;<span class="ident" id="2365767">u</span>&nbsp;<span class="op" id="2365769">&amp;&amp;</span>&nbsp;<span class="op" id="2365772">(</span><span class="ident" id="2365773">inclusive</span>&nbsp;<span class="op" id="2365783">||</span>&nbsp;<span class="ident" id="2365786">m</span><span class="op" id="2365787">+</span><span class="num" id="2365788">1</span>&nbsp;<span class="op" id="2365790">&lt;</span>&nbsp;<span class="ident" id="2365792">u</span>&nbsp;<span class="op" id="2365794">||</span>&nbsp;<span class="ident" id="2365797">i</span><span class="op" id="2365798">+</span><span class="num" id="2365799">1</span>&nbsp;<span class="op" id="2365801">&lt;</span>&nbsp;<span class="ident" id="2365803">upper</span><span class="op" id="2365808">.</span><span class="ident" id="2365809">nd</span><span class="op" id="2365811">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365816">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2365879">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365920">switch</span>&nbsp;<span class="op" id="2365927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365931">case</span>&nbsp;<span class="ident" id="2365936">okdown</span>&nbsp;<span class="op" id="2365943">&amp;&amp;</span>&nbsp;<span class="ident" id="2365946">okup</span><span class="op" id="2365950">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365955">d</span><span class="op" id="2365956">.</span><span class="ident" id="2365957">Round</span><span class="op" id="2365962">(</span><span class="ident" id="2365963">i</span>&nbsp;<span class="op" id="2365965">+</span>&nbsp;<span class="num" id="2365967">1</span><span class="op" id="2365968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2365982">case</span>&nbsp;<span class="ident" id="2365987">okdown</span><span class="op" id="2365993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2365998">d</span><span class="op" id="2365999">.</span><span class="ident" id="2366000">RoundDown</span><span class="op" id="2366009">(</span><span class="ident" id="2366010">i</span>&nbsp;<span class="op" id="2366012">+</span>&nbsp;<span class="num" id="2366014">1</span><span class="op" id="2366015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366020">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366029">case</span>&nbsp;<span class="ident" id="2366034">okup</span><span class="op" id="2366038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366043">d</span><span class="op" id="2366044">.</span><span class="ident" id="2366045">RoundUp</span><span class="op" id="2366052">(</span><span class="ident" id="2366053">i</span>&nbsp;<span class="op" id="2366055">+</span>&nbsp;<span class="num" id="2366057">1</span><span class="op" id="2366058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366063">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366075">}</span><br>
<span class="lineno">325</span><span class="op" id="2366077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2366080">type</span>&nbsp;<span class="ident" id="2366085">decimalSlice</span>&nbsp;<span class="keyword" id="2366098">struct</span>&nbsp;<span class="op" id="2366105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366108">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366115">[</span><span class="op" id="2366116">]</span><span class="builtintype" id="2366117">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366123">nd</span><span class="op" id="2366125">,</span>&nbsp;<span class="ident" id="2366127">dp</span>&nbsp;<span class="builtintype" id="2366130">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366135">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2366142">bool</span><br>
<span class="lineno"></span><span class="op" id="2366147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2366150">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2366171">func</span>&nbsp;<span class="ident" id="2366176">fmtE</span><span class="op" id="2366180">(</span><span class="ident" id="2366181">dst</span>&nbsp;<span class="op" id="2366185">[</span><span class="op" id="2366186">]</span><span class="builtintype" id="2366187">byte</span><span class="op" id="2366191">,</span>&nbsp;<span class="ident" id="2366193">neg</span>&nbsp;<span class="builtintype" id="2366197">bool</span><span class="op" id="2366201">,</span>&nbsp;<span class="ident" id="2366203">d</span>&nbsp;<span class="ident" id="2366205">decimalSlice</span><span class="op" id="2366217">,</span>&nbsp;<span class="ident" id="2366219">prec</span>&nbsp;<span class="builtintype" id="2366224">int</span><span class="op" id="2366227">,</span>&nbsp;<span class="ident" id="2366229">fmt</span>&nbsp;<span class="builtintype" id="2366233">byte</span><span class="op" id="2366237">)</span>&nbsp;<span class="op" id="2366239">[</span><span class="op" id="2366240">]</span><span class="builtintype" id="2366241">byte</span>&nbsp;<span class="op" id="2366246">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366249">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366258">if</span>&nbsp;<span class="ident" id="2366261">neg</span>&nbsp;<span class="op" id="2366265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366269">dst</span>&nbsp;<span class="op" id="2366273">=</span>&nbsp;<span class="builtinfunc" id="2366275">append</span><span class="op" id="2366281">(</span><span class="ident" id="2366282">dst</span><span class="op" id="2366285">,</span>&nbsp;<span class="string" id="2366287">&#39;-&#39;</span><span class="op" id="2366290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366297">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366313">ch</span>&nbsp;<span class="op" id="2366316">:=</span>&nbsp;<span class="builtintype" id="2366319">byte</span><span class="op" id="2366323">(</span><span class="string" id="2366324">&#39;0&#39;</span><span class="op" id="2366327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366330">if</span>&nbsp;<span class="ident" id="2366333">d</span><span class="op" id="2366334">.</span><span class="ident" id="2366335">nd</span>&nbsp;<span class="op" id="2366338">!=</span>&nbsp;<span class="num" id="2366341">0</span>&nbsp;<span class="op" id="2366343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366347">ch</span>&nbsp;<span class="op" id="2366350">=</span>&nbsp;<span class="ident" id="2366352">d</span><span class="op" id="2366353">.</span><span class="ident" id="2366354">d</span><span class="op" id="2366355">[</span><span class="num" id="2366356">0</span><span class="op" id="2366357">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366360">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366363">dst</span>&nbsp;<span class="op" id="2366367">=</span>&nbsp;<span class="builtinfunc" id="2366369">append</span><span class="op" id="2366375">(</span><span class="ident" id="2366376">dst</span><span class="op" id="2366379">,</span>&nbsp;<span class="ident" id="2366381">ch</span><span class="op" id="2366383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366387">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366403">if</span>&nbsp;<span class="ident" id="2366406">prec</span>&nbsp;<span class="op" id="2366411">&gt;</span>&nbsp;<span class="num" id="2366413">0</span>&nbsp;<span class="op" id="2366415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366419">dst</span>&nbsp;<span class="op" id="2366423">=</span>&nbsp;<span class="builtinfunc" id="2366425">append</span><span class="op" id="2366431">(</span><span class="ident" id="2366432">dst</span><span class="op" id="2366435">,</span>&nbsp;<span class="string" id="2366437">&#39;.&#39;</span><span class="op" id="2366440">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366444">i</span>&nbsp;<span class="op" id="2366446">:=</span>&nbsp;<span class="num" id="2366449">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366453">m</span>&nbsp;<span class="op" id="2366455">:=</span>&nbsp;<span class="ident" id="2366458">d</span><span class="op" id="2366459">.</span><span class="ident" id="2366460">nd</span>&nbsp;<span class="op" id="2366463">+</span>&nbsp;<span class="ident" id="2366465">prec</span>&nbsp;<span class="op" id="2366470">+</span>&nbsp;<span class="num" id="2366472">1</span>&nbsp;<span class="op" id="2366474">-</span>&nbsp;<span class="ident" id="2366476">max</span><span class="op" id="2366479">(</span><span class="ident" id="2366480">d</span><span class="op" id="2366481">.</span><span class="ident" id="2366482">nd</span><span class="op" id="2366484">,</span>&nbsp;<span class="ident" id="2366486">prec</span><span class="op" id="2366490">+</span><span class="num" id="2366491">1</span><span class="op" id="2366492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366496">for</span>&nbsp;<span class="ident" id="2366500">i</span>&nbsp;<span class="op" id="2366502">&lt;</span>&nbsp;<span class="ident" id="2366504">m</span>&nbsp;<span class="op" id="2366506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366511">dst</span>&nbsp;<span class="op" id="2366515">=</span>&nbsp;<span class="builtinfunc" id="2366517">append</span><span class="op" id="2366523">(</span><span class="ident" id="2366524">dst</span><span class="op" id="2366527">,</span>&nbsp;<span class="ident" id="2366529">d</span><span class="op" id="2366530">.</span><span class="ident" id="2366531">d</span><span class="op" id="2366532">[</span><span class="ident" id="2366533">i</span><span class="op" id="2366534">]</span><span class="op" id="2366535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366540">i</span><span class="op" id="2366541">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366550">for</span>&nbsp;<span class="ident" id="2366554">i</span>&nbsp;<span class="op" id="2366556">&lt;=</span>&nbsp;<span class="ident" id="2366559">prec</span>&nbsp;<span class="op" id="2366564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366569">dst</span>&nbsp;<span class="op" id="2366573">=</span>&nbsp;<span class="builtinfunc" id="2366575">append</span><span class="op" id="2366581">(</span><span class="ident" id="2366582">dst</span><span class="op" id="2366585">,</span>&nbsp;<span class="string" id="2366587">&#39;0&#39;</span><span class="op" id="2366590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366595">i</span><span class="op" id="2366596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366601">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366608">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366616">dst</span>&nbsp;<span class="op" id="2366620">=</span>&nbsp;<span class="builtinfunc" id="2366622">append</span><span class="op" id="2366628">(</span><span class="ident" id="2366629">dst</span><span class="op" id="2366632">,</span>&nbsp;<span class="ident" id="2366634">fmt</span><span class="op" id="2366637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366640">exp</span>&nbsp;<span class="op" id="2366644">:=</span>&nbsp;<span class="ident" id="2366647">d</span><span class="op" id="2366648">.</span><span class="ident" id="2366649">dp</span>&nbsp;<span class="op" id="2366652">-</span>&nbsp;<span class="num" id="2366654">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366657">if</span>&nbsp;<span class="ident" id="2366660">d</span><span class="op" id="2366661">.</span><span class="ident" id="2366662">nd</span>&nbsp;<span class="op" id="2366665">==</span>&nbsp;<span class="num" id="2366668">0</span>&nbsp;<span class="op" id="2366670">{</span>&nbsp;<span class="comment" id="2366672">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366708">exp</span>&nbsp;<span class="op" id="2366712">=</span>&nbsp;<span class="num" id="2366714">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366720">if</span>&nbsp;<span class="ident" id="2366723">exp</span>&nbsp;<span class="op" id="2366727">&lt;</span>&nbsp;<span class="num" id="2366729">0</span>&nbsp;<span class="op" id="2366731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366735">ch</span>&nbsp;<span class="op" id="2366738">=</span>&nbsp;<span class="string" id="2366740">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366746">exp</span>&nbsp;<span class="op" id="2366750">=</span>&nbsp;<span class="op" id="2366752">-</span><span class="ident" id="2366753">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366758">}</span>&nbsp;<span class="keyword" id="2366760">else</span>&nbsp;<span class="op" id="2366765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366769">ch</span>&nbsp;<span class="op" id="2366772">=</span>&nbsp;<span class="string" id="2366774">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366782">dst</span>&nbsp;<span class="op" id="2366786">=</span>&nbsp;<span class="builtinfunc" id="2366788">append</span><span class="op" id="2366794">(</span><span class="ident" id="2366795">dst</span><span class="op" id="2366798">,</span>&nbsp;<span class="ident" id="2366800">ch</span><span class="op" id="2366802">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366806">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366815">var</span>&nbsp;<span class="ident" id="2366819">buf</span>&nbsp;<span class="op" id="2366823">[</span><span class="num" id="2366824">3</span><span class="op" id="2366825">]</span><span class="builtintype" id="2366826">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366832">i</span>&nbsp;<span class="op" id="2366834">:=</span>&nbsp;<span class="builtinfunc" id="2366837">len</span><span class="op" id="2366840">(</span><span class="ident" id="2366841">buf</span><span class="op" id="2366844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366847">for</span>&nbsp;<span class="ident" id="2366851">exp</span>&nbsp;<span class="op" id="2366855">&gt;=</span>&nbsp;<span class="num" id="2366858">10</span>&nbsp;<span class="op" id="2366861">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366865">i</span><span class="op" id="2366866">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366871">buf</span><span class="op" id="2366874">[</span><span class="ident" id="2366875">i</span><span class="op" id="2366876">]</span>&nbsp;<span class="op" id="2366878">=</span>&nbsp;<span class="builtintype" id="2366880">byte</span><span class="op" id="2366884">(</span><span class="ident" id="2366885">exp</span><span class="op" id="2366888">%</span><span class="num" id="2366889">10</span>&nbsp;<span class="op" id="2366892">+</span>&nbsp;<span class="string" id="2366894">&#39;0&#39;</span><span class="op" id="2366897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366901">exp</span>&nbsp;<span class="op" id="2366905">/=</span>&nbsp;<span class="num" id="2366908">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2366912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2366915">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366928">i</span><span class="op" id="2366929">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366933">buf</span><span class="op" id="2366936">[</span><span class="ident" id="2366937">i</span><span class="op" id="2366938">]</span>&nbsp;<span class="op" id="2366940">=</span>&nbsp;<span class="builtintype" id="2366942">byte</span><span class="op" id="2366946">(</span><span class="ident" id="2366947">exp</span>&nbsp;<span class="op" id="2366951">+</span>&nbsp;<span class="string" id="2366953">&#39;0&#39;</span><span class="op" id="2366956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366960">switch</span>&nbsp;<span class="ident" id="2366967">i</span>&nbsp;<span class="op" id="2366969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2366972">case</span>&nbsp;<span class="num" id="2366977">0</span><span class="op" id="2366978">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2366982">dst</span>&nbsp;<span class="op" id="2366986">=</span>&nbsp;<span class="builtinfunc" id="2366988">append</span><span class="op" id="2366994">(</span><span class="ident" id="2366995">dst</span><span class="op" id="2366998">,</span>&nbsp;<span class="ident" id="2367000">buf</span><span class="op" id="2367003">[</span><span class="num" id="2367004">0</span><span class="op" id="2367005">]</span><span class="op" id="2367006">,</span>&nbsp;<span class="ident" id="2367008">buf</span><span class="op" id="2367011">[</span><span class="num" id="2367012">1</span><span class="op" id="2367013">]</span><span class="op" id="2367014">,</span>&nbsp;<span class="ident" id="2367016">buf</span><span class="op" id="2367019">[</span><span class="num" id="2367020">2</span><span class="op" id="2367021">]</span><span class="op" id="2367022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367025">case</span>&nbsp;<span class="num" id="2367030">1</span><span class="op" id="2367031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367035">dst</span>&nbsp;<span class="op" id="2367039">=</span>&nbsp;<span class="builtinfunc" id="2367041">append</span><span class="op" id="2367047">(</span><span class="ident" id="2367048">dst</span><span class="op" id="2367051">,</span>&nbsp;<span class="ident" id="2367053">buf</span><span class="op" id="2367056">[</span><span class="num" id="2367057">1</span><span class="op" id="2367058">]</span><span class="op" id="2367059">,</span>&nbsp;<span class="ident" id="2367061">buf</span><span class="op" id="2367064">[</span><span class="num" id="2367065">2</span><span class="op" id="2367066">]</span><span class="op" id="2367067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367070">case</span>&nbsp;<span class="num" id="2367075">2</span><span class="op" id="2367076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2367080">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367100">dst</span>&nbsp;<span class="op" id="2367104">=</span>&nbsp;<span class="builtinfunc" id="2367106">append</span><span class="op" id="2367112">(</span><span class="ident" id="2367113">dst</span><span class="op" id="2367116">,</span>&nbsp;<span class="string" id="2367118">&#39;0&#39;</span><span class="op" id="2367121">,</span>&nbsp;<span class="ident" id="2367123">buf</span><span class="op" id="2367126">[</span><span class="num" id="2367127">2</span><span class="op" id="2367128">]</span><span class="op" id="2367129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367135">return</span>&nbsp;<span class="ident" id="2367142">dst</span><br>
<span class="lineno"></span><span class="op" id="2367146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2367149">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2367171">func</span>&nbsp;<span class="ident" id="2367176">fmtF</span><span class="op" id="2367180">(</span><span class="ident" id="2367181">dst</span>&nbsp;<span class="op" id="2367185">[</span><span class="op" id="2367186">]</span><span class="builtintype" id="2367187">byte</span><span class="op" id="2367191">,</span>&nbsp;<span class="ident" id="2367193">neg</span>&nbsp;<span class="builtintype" id="2367197">bool</span><span class="op" id="2367201">,</span>&nbsp;<span class="ident" id="2367203">d</span>&nbsp;<span class="ident" id="2367205">decimalSlice</span><span class="op" id="2367217">,</span>&nbsp;<span class="ident" id="2367219">prec</span>&nbsp;<span class="builtintype" id="2367224">int</span><span class="op" id="2367227">)</span>&nbsp;<span class="op" id="2367229">[</span><span class="op" id="2367230">]</span><span class="builtintype" id="2367231">byte</span>&nbsp;<span class="op" id="2367236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2367239">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367248">if</span>&nbsp;<span class="ident" id="2367251">neg</span>&nbsp;<span class="op" id="2367255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367259">dst</span>&nbsp;<span class="op" id="2367263">=</span>&nbsp;<span class="builtinfunc" id="2367265">append</span><span class="op" id="2367271">(</span><span class="ident" id="2367272">dst</span><span class="op" id="2367275">,</span>&nbsp;<span class="string" id="2367277">&#39;-&#39;</span><span class="op" id="2367280">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2367287">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367329">if</span>&nbsp;<span class="ident" id="2367332">d</span><span class="op" id="2367333">.</span><span class="ident" id="2367334">dp</span>&nbsp;<span class="op" id="2367337">&gt;</span>&nbsp;<span class="num" id="2367339">0</span>&nbsp;<span class="op" id="2367341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367345">var</span>&nbsp;<span class="ident" id="2367349">i</span>&nbsp;<span class="builtintype" id="2367351">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367357">for</span>&nbsp;<span class="ident" id="2367361">i</span>&nbsp;<span class="op" id="2367363">=</span>&nbsp;<span class="num" id="2367365">0</span><span class="op" id="2367366">;</span>&nbsp;<span class="ident" id="2367368">i</span>&nbsp;<span class="op" id="2367370">&lt;</span>&nbsp;<span class="ident" id="2367372">d</span><span class="op" id="2367373">.</span><span class="ident" id="2367374">dp</span>&nbsp;<span class="op" id="2367377">&amp;&amp;</span>&nbsp;<span class="ident" id="2367380">i</span>&nbsp;<span class="op" id="2367382">&lt;</span>&nbsp;<span class="ident" id="2367384">d</span><span class="op" id="2367385">.</span><span class="ident" id="2367386">nd</span><span class="op" id="2367388">;</span>&nbsp;<span class="ident" id="2367390">i</span><span class="op" id="2367391">++</span>&nbsp;<span class="op" id="2367394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367399">dst</span>&nbsp;<span class="op" id="2367403">=</span>&nbsp;<span class="builtinfunc" id="2367405">append</span><span class="op" id="2367411">(</span><span class="ident" id="2367412">dst</span><span class="op" id="2367415">,</span>&nbsp;<span class="ident" id="2367417">d</span><span class="op" id="2367418">.</span><span class="ident" id="2367419">d</span><span class="op" id="2367420">[</span><span class="ident" id="2367421">i</span><span class="op" id="2367422">]</span><span class="op" id="2367423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367431">for</span>&nbsp;<span class="op" id="2367435">;</span>&nbsp;<span class="ident" id="2367437">i</span>&nbsp;<span class="op" id="2367439">&lt;</span>&nbsp;<span class="ident" id="2367441">d</span><span class="op" id="2367442">.</span><span class="ident" id="2367443">dp</span><span class="op" id="2367445">;</span>&nbsp;<span class="ident" id="2367447">i</span><span class="op" id="2367448">++</span>&nbsp;<span class="op" id="2367451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367456">dst</span>&nbsp;<span class="op" id="2367460">=</span>&nbsp;<span class="builtinfunc" id="2367462">append</span><span class="op" id="2367468">(</span><span class="ident" id="2367469">dst</span><span class="op" id="2367472">,</span>&nbsp;<span class="string" id="2367474">&#39;0&#39;</span><span class="op" id="2367477">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367484">}</span>&nbsp;<span class="keyword" id="2367486">else</span>&nbsp;<span class="op" id="2367491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367495">dst</span>&nbsp;<span class="op" id="2367499">=</span>&nbsp;<span class="builtinfunc" id="2367501">append</span><span class="op" id="2367507">(</span><span class="ident" id="2367508">dst</span><span class="op" id="2367511">,</span>&nbsp;<span class="string" id="2367513">&#39;0&#39;</span><span class="op" id="2367516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2367523">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367536">if</span>&nbsp;<span class="ident" id="2367539">prec</span>&nbsp;<span class="op" id="2367544">&gt;</span>&nbsp;<span class="num" id="2367546">0</span>&nbsp;<span class="op" id="2367548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367552">dst</span>&nbsp;<span class="op" id="2367556">=</span>&nbsp;<span class="builtinfunc" id="2367558">append</span><span class="op" id="2367564">(</span><span class="ident" id="2367565">dst</span><span class="op" id="2367568">,</span>&nbsp;<span class="string" id="2367570">&#39;.&#39;</span><span class="op" id="2367573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367577">for</span>&nbsp;<span class="ident" id="2367581">i</span>&nbsp;<span class="op" id="2367583">:=</span>&nbsp;<span class="num" id="2367586">0</span><span class="op" id="2367587">;</span>&nbsp;<span class="ident" id="2367589">i</span>&nbsp;<span class="op" id="2367591">&lt;</span>&nbsp;<span class="ident" id="2367593">prec</span><span class="op" id="2367597">;</span>&nbsp;<span class="ident" id="2367599">i</span><span class="op" id="2367600">++</span>&nbsp;<span class="op" id="2367603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367608">ch</span>&nbsp;<span class="op" id="2367611">:=</span>&nbsp;<span class="builtintype" id="2367614">byte</span><span class="op" id="2367618">(</span><span class="string" id="2367619">&#39;0&#39;</span><span class="op" id="2367622">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367627">if</span>&nbsp;<span class="ident" id="2367630">j</span>&nbsp;<span class="op" id="2367632">:=</span>&nbsp;<span class="ident" id="2367635">d</span><span class="op" id="2367636">.</span><span class="ident" id="2367637">dp</span>&nbsp;<span class="op" id="2367640">+</span>&nbsp;<span class="ident" id="2367642">i</span><span class="op" id="2367643">;</span>&nbsp;<span class="num" id="2367645">0</span>&nbsp;<span class="op" id="2367647">&lt;=</span>&nbsp;<span class="ident" id="2367650">j</span>&nbsp;<span class="op" id="2367652">&amp;&amp;</span>&nbsp;<span class="ident" id="2367655">j</span>&nbsp;<span class="op" id="2367657">&lt;</span>&nbsp;<span class="ident" id="2367659">d</span><span class="op" id="2367660">.</span><span class="ident" id="2367661">nd</span>&nbsp;<span class="op" id="2367664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367670">ch</span>&nbsp;<span class="op" id="2367673">=</span>&nbsp;<span class="ident" id="2367675">d</span><span class="op" id="2367676">.</span><span class="ident" id="2367677">d</span><span class="op" id="2367678">[</span><span class="ident" id="2367679">j</span><span class="op" id="2367680">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367690">dst</span>&nbsp;<span class="op" id="2367694">=</span>&nbsp;<span class="builtinfunc" id="2367696">append</span><span class="op" id="2367702">(</span><span class="ident" id="2367703">dst</span><span class="op" id="2367706">,</span>&nbsp;<span class="ident" id="2367708">ch</span><span class="op" id="2367710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367714">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367721">return</span>&nbsp;<span class="ident" id="2367728">dst</span><br>
<span class="lineno"></span><span class="op" id="2367732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2367735">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2367757">func</span>&nbsp;<span class="ident" id="2367762">fmtB</span><span class="op" id="2367766">(</span><span class="ident" id="2367767">dst</span>&nbsp;<span class="op" id="2367771">[</span><span class="op" id="2367772">]</span><span class="builtintype" id="2367773">byte</span><span class="op" id="2367777">,</span>&nbsp;<span class="ident" id="2367779">neg</span>&nbsp;<span class="builtintype" id="2367783">bool</span><span class="op" id="2367787">,</span>&nbsp;<span class="ident" id="2367789">mant</span>&nbsp;<span class="ident" id="2367794">uint64</span><span class="op" id="2367800">,</span>&nbsp;<span class="ident" id="2367802">exp</span>&nbsp;<span class="builtintype" id="2367806">int</span><span class="op" id="2367809">,</span>&nbsp;<span class="ident" id="2367811">flt</span>&nbsp;<span class="op" id="2367815">*</span><span class="ident" id="2367816">floatInfo</span><span class="op" id="2367825">)</span>&nbsp;<span class="op" id="2367827">[</span><span class="op" id="2367828">]</span><span class="builtintype" id="2367829">byte</span>&nbsp;<span class="op" id="2367834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367837">var</span>&nbsp;<span class="ident" id="2367841">buf</span>&nbsp;<span class="op" id="2367845">[</span><span class="num" id="2367846">50</span><span class="op" id="2367848">]</span><span class="builtintype" id="2367849">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367855">w</span>&nbsp;<span class="op" id="2367857">:=</span>&nbsp;<span class="builtinfunc" id="2367860">len</span><span class="op" id="2367863">(</span><span class="ident" id="2367864">buf</span><span class="op" id="2367867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367870">exp</span>&nbsp;<span class="op" id="2367874">-=</span>&nbsp;<span class="builtintype" id="2367877">int</span><span class="op" id="2367880">(</span><span class="ident" id="2367881">flt</span><span class="op" id="2367884">.</span><span class="ident" id="2367885">mantbits</span><span class="op" id="2367893">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367896">esign</span>&nbsp;<span class="op" id="2367902">:=</span>&nbsp;<span class="builtintype" id="2367905">byte</span><span class="op" id="2367909">(</span><span class="string" id="2367910">&#39;+&#39;</span><span class="op" id="2367913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367916">if</span>&nbsp;<span class="ident" id="2367919">exp</span>&nbsp;<span class="op" id="2367923">&lt;</span>&nbsp;<span class="num" id="2367925">0</span>&nbsp;<span class="op" id="2367927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367931">esign</span>&nbsp;<span class="op" id="2367937">=</span>&nbsp;<span class="string" id="2367939">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367945">exp</span>&nbsp;<span class="op" id="2367949">=</span>&nbsp;<span class="op" id="2367951">-</span><span class="ident" id="2367952">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2367957">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367960">n</span>&nbsp;<span class="op" id="2367962">:=</span>&nbsp;<span class="num" id="2367965">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2367968">for</span>&nbsp;<span class="ident" id="2367972">exp</span>&nbsp;<span class="op" id="2367976">&gt;</span>&nbsp;<span class="num" id="2367978">0</span>&nbsp;<span class="op" id="2367980">||</span>&nbsp;<span class="ident" id="2367983">n</span>&nbsp;<span class="op" id="2367985">&lt;</span>&nbsp;<span class="num" id="2367987">1</span>&nbsp;<span class="op" id="2367989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367993">n</span><span class="op" id="2367994">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2367999">w</span><span class="op" id="2368000">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368005">buf</span><span class="op" id="2368008">[</span><span class="ident" id="2368009">w</span><span class="op" id="2368010">]</span>&nbsp;<span class="op" id="2368012">=</span>&nbsp;<span class="builtintype" id="2368014">byte</span><span class="op" id="2368018">(</span><span class="ident" id="2368019">exp</span><span class="op" id="2368022">%</span><span class="num" id="2368023">10</span>&nbsp;<span class="op" id="2368026">+</span>&nbsp;<span class="string" id="2368028">&#39;0&#39;</span><span class="op" id="2368031">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368035">exp</span>&nbsp;<span class="op" id="2368039">/=</span>&nbsp;<span class="num" id="2368042">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2368046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368049">w</span><span class="op" id="2368050">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368054">buf</span><span class="op" id="2368057">[</span><span class="ident" id="2368058">w</span><span class="op" id="2368059">]</span>&nbsp;<span class="op" id="2368061">=</span>&nbsp;<span class="ident" id="2368063">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368070">w</span><span class="op" id="2368071">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368075">buf</span><span class="op" id="2368078">[</span><span class="ident" id="2368079">w</span><span class="op" id="2368080">]</span>&nbsp;<span class="op" id="2368082">=</span>&nbsp;<span class="string" id="2368084">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368089">n</span>&nbsp;<span class="op" id="2368091">=</span>&nbsp;<span class="num" id="2368093">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368096">for</span>&nbsp;<span class="ident" id="2368100">mant</span>&nbsp;<span class="op" id="2368105">&gt;</span>&nbsp;<span class="num" id="2368107">0</span>&nbsp;<span class="op" id="2368109">||</span>&nbsp;<span class="ident" id="2368112">n</span>&nbsp;<span class="op" id="2368114">&lt;</span>&nbsp;<span class="num" id="2368116">1</span>&nbsp;<span class="op" id="2368118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368122">n</span><span class="op" id="2368123">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368128">w</span><span class="op" id="2368129">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368134">buf</span><span class="op" id="2368137">[</span><span class="ident" id="2368138">w</span><span class="op" id="2368139">]</span>&nbsp;<span class="op" id="2368141">=</span>&nbsp;<span class="builtintype" id="2368143">byte</span><span class="op" id="2368147">(</span><span class="ident" id="2368148">mant</span><span class="op" id="2368152">%</span><span class="num" id="2368153">10</span>&nbsp;<span class="op" id="2368156">+</span>&nbsp;<span class="string" id="2368158">&#39;0&#39;</span><span class="op" id="2368161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368165">mant</span>&nbsp;<span class="op" id="2368170">/=</span>&nbsp;<span class="num" id="2368173">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2368177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368180">if</span>&nbsp;<span class="ident" id="2368183">neg</span>&nbsp;<span class="op" id="2368187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368191">w</span><span class="op" id="2368192">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2368197">buf</span><span class="op" id="2368200">[</span><span class="ident" id="2368201">w</span><span class="op" id="2368202">]</span>&nbsp;<span class="op" id="2368204">=</span>&nbsp;<span class="string" id="2368206">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2368211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368214">return</span>&nbsp;<span class="builtinfunc" id="2368221">append</span><span class="op" id="2368227">(</span><span class="ident" id="2368228">dst</span><span class="op" id="2368231">,</span>&nbsp;<span class="ident" id="2368233">buf</span><span class="op" id="2368236">[</span><span class="ident" id="2368237">w</span><span class="op" id="2368238">:</span><span class="op" id="2368239">]</span><span class="op" id="2368240">...</span><span class="op" id="2368243">)</span><br>
<span class="lineno"></span><span class="op" id="2368245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2368248">func</span>&nbsp;<span class="ident" id="2368253">max</span><span class="op" id="2368256">(</span><span class="ident" id="2368257">a</span><span class="op" id="2368258">,</span>&nbsp;<span class="ident" id="2368260">b</span>&nbsp;<span class="builtintype" id="2368262">int</span><span class="op" id="2368265">)</span>&nbsp;<span class="builtintype" id="2368267">int</span>&nbsp;<span class="op" id="2368271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368274">if</span>&nbsp;<span class="ident" id="2368277">a</span>&nbsp;<span class="op" id="2368279">&gt;</span>&nbsp;<span class="ident" id="2368281">b</span>&nbsp;<span class="op" id="2368283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368287">return</span>&nbsp;<span class="ident" id="2368294">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2368297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2368300">return</span>&nbsp;<span class="ident" id="2368307">b</span><br>
<span class="lineno">475</span><span class="op" id="2368309">}</span>
</div>
</body>
</html>
