<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2180893">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2180948">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2181002">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2181053">package</span>&nbsp;<span class="ident" id="2181061">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2181067">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2181127">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2181187">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2181246">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2181276">//</span><br>
<span class="lineno"></span><span class="comment" id="2181279">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2181335">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2181404">//</span><br>
<span class="lineno">15</span><span class="comment" id="2181407">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2181466">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2181522">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2181579">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2181596">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2181652">//</span><br>
<span class="lineno"></span><span class="comment" id="2181655">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2181667">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2181718">//</span><br>
<span class="lineno"></span><span class="comment" id="2181721">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2181731">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2181759">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2181807">//</span><br>
<span class="lineno"></span><span class="comment" id="2181810">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2181868">//</span><br>
<span class="lineno">30</span><span class="comment" id="2181871">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2181935">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2181999">//</span><br>
<span class="lineno"></span><span class="comment" id="2182002">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2182067">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2182101">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2182115">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2182180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2182209">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2182267">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2182284">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2182342">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2182403">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2182470">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2182535">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2182598">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2182664">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2182699">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2182770">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2182820">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2182870">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2182920">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2182970">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2183020">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2183087">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2183117">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2183170">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2183220">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2183265">//</span><br>
<span class="lineno"></span><span class="comment" id="2183268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2183330">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2183399">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2183438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2183502">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2183566">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2183630">//</span><br>
<span class="lineno"></span><span class="comment" id="2183633">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2183699">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2183754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2183802">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2183866">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2183931">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2183949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2184021">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2184093">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2184165">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2184237">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2184309">//</span><br>
<span class="lineno"></span><span class="comment" id="2184312">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2184339">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2184378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2184407">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2184458">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2184515">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2184545">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2184614">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2184666">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2184731">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2184802">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2184837">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2184883">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2184942">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2185002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2185073">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2185136">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2185181">//</span><br>
<span class="lineno"></span><span class="comment" id="2185184">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2185202">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2185248">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2185279">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2185334">//</span><br>
<span class="lineno"></span><span class="comment" id="2185337">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2185350">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2185420">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2185460">//</span><br>
<span class="lineno">105</span><span class="comment" id="2185463">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2185478">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2185502">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2185572">//</span><br>
<span class="lineno"></span><span class="comment" id="2185575">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2185589">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2185655">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2185719">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2185785">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2185829">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2185833">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2185897">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2185957">//</span><br>
<span class="lineno"></span><span class="comment" id="2185960">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2185982">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2186004">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2186024">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2186044">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2186089">func</span>&nbsp;<span class="ident" id="2186094">Expm1</span><span class="op" id="2186099">(</span><span class="ident" id="2186100">x</span>&nbsp;<span class="builtintype" id="2186102">float64</span><span class="op" id="2186109">)</span>&nbsp;<span class="builtintype" id="2186111">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2186120">func</span>&nbsp;<span class="ident" id="2186125">expm1</span><span class="op" id="2186130">(</span><span class="ident" id="2186131">x</span>&nbsp;<span class="builtintype" id="2186133">float64</span><span class="op" id="2186140">)</span>&nbsp;<span class="builtintype" id="2186142">float64</span>&nbsp;<span class="op" id="2186150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2186153">const</span>&nbsp;<span class="op" id="2186159">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186163">Othreshold</span>&nbsp;<span class="op" id="2186174">=</span>&nbsp;<span class="num" id="2186176">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2186203">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186227">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186238">=</span>&nbsp;<span class="num" id="2186240">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2186267">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186291">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2186302">=</span>&nbsp;<span class="num" id="2186304">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2186331">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186355">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186366">=</span>&nbsp;<span class="num" id="2186368">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2186395">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186419">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186430">=</span>&nbsp;<span class="num" id="2186432">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2186459">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186483">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186494">=</span>&nbsp;<span class="num" id="2186496">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2186523">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186547">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186558">=</span>&nbsp;<span class="num" id="2186560">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2186587">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186611">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2186622">=</span>&nbsp;<span class="num" id="2186624">1.0</span>&nbsp;<span class="op" id="2186628">/</span>&nbsp;<span class="op" id="2186630">(</span><span class="num" id="2186631">1</span>&nbsp;<span class="op" id="2186633">&lt;&lt;</span>&nbsp;<span class="num" id="2186636">54</span><span class="op" id="2186638">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2186651">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2186684">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186726">Q1</span>&nbsp;<span class="op" id="2186729">=</span>&nbsp;<span class="op" id="2186731">-</span><span class="num" id="2186732">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2186759">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186783">Q2</span>&nbsp;<span class="op" id="2186786">=</span>&nbsp;<span class="num" id="2186788">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2186816">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186840">Q3</span>&nbsp;<span class="op" id="2186843">=</span>&nbsp;<span class="op" id="2186845">-</span><span class="num" id="2186846">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2186873">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186897">Q4</span>&nbsp;<span class="op" id="2186900">=</span>&nbsp;<span class="num" id="2186902">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2186930">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186954">Q5</span>&nbsp;<span class="op" id="2186957">=</span>&nbsp;<span class="op" id="2186959">-</span><span class="num" id="2186960">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2186987">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2187014">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187032">switch</span>&nbsp;<span class="op" id="2187039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187042">case</span>&nbsp;<span class="ident" id="2187047">IsInf</span><span class="op" id="2187052">(</span><span class="ident" id="2187053">x</span><span class="op" id="2187054">,</span>&nbsp;<span class="num" id="2187056">1</span><span class="op" id="2187057">)</span>&nbsp;<span class="op" id="2187059">||</span>&nbsp;<span class="ident" id="2187062">IsNaN</span><span class="op" id="2187067">(</span><span class="ident" id="2187068">x</span><span class="op" id="2187069">)</span><span class="op" id="2187070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187074">return</span>&nbsp;<span class="ident" id="2187081">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187084">case</span>&nbsp;<span class="ident" id="2187089">IsInf</span><span class="op" id="2187094">(</span><span class="ident" id="2187095">x</span><span class="op" id="2187096">,</span>&nbsp;<span class="op" id="2187098">-</span><span class="num" id="2187099">1</span><span class="op" id="2187100">)</span><span class="op" id="2187101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187105">return</span>&nbsp;<span class="op" id="2187112">-</span><span class="num" id="2187113">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187120">absx</span>&nbsp;<span class="op" id="2187125">:=</span>&nbsp;<span class="ident" id="2187128">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187131">sign</span>&nbsp;<span class="op" id="2187136">:=</span>&nbsp;<span class="builtintype" id="2187139">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187146">if</span>&nbsp;<span class="ident" id="2187149">x</span>&nbsp;<span class="op" id="2187151">&lt;</span>&nbsp;<span class="num" id="2187153">0</span>&nbsp;<span class="op" id="2187155">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187159">absx</span>&nbsp;<span class="op" id="2187164">=</span>&nbsp;<span class="op" id="2187166">-</span><span class="ident" id="2187167">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187174">sign</span>&nbsp;<span class="op" id="2187179">=</span>&nbsp;<span class="builtintype" id="2187181">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2187191">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187220">if</span>&nbsp;<span class="ident" id="2187223">absx</span>&nbsp;<span class="op" id="2187228">&gt;=</span>&nbsp;<span class="ident" id="2187231">Ln2X56</span>&nbsp;<span class="op" id="2187238">{</span>&nbsp;<span class="comment" id="2187240">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187264">if</span>&nbsp;<span class="ident" id="2187267">absx</span>&nbsp;<span class="op" id="2187272">&gt;=</span>&nbsp;<span class="ident" id="2187275">Othreshold</span>&nbsp;<span class="op" id="2187286">{</span>&nbsp;<span class="comment" id="2187288">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187314">return</span>&nbsp;<span class="ident" id="2187321">Inf</span><span class="op" id="2187324">(</span><span class="num" id="2187325">1</span><span class="op" id="2187326">)</span>&nbsp;<span class="comment" id="2187328">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187346">if</span>&nbsp;<span class="ident" id="2187349">sign</span>&nbsp;<span class="op" id="2187354">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187359">return</span>&nbsp;<span class="op" id="2187366">-</span><span class="num" id="2187367">1</span>&nbsp;<span class="comment" id="2187369">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2187406">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187429">var</span>&nbsp;<span class="ident" id="2187433">c</span>&nbsp;<span class="builtintype" id="2187435">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187444">var</span>&nbsp;<span class="ident" id="2187448">k</span>&nbsp;<span class="builtintype" id="2187450">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187455">if</span>&nbsp;<span class="ident" id="2187458">absx</span>&nbsp;<span class="op" id="2187463">&gt;</span>&nbsp;<span class="ident" id="2187465">Ln2Half</span>&nbsp;<span class="op" id="2187473">{</span>&nbsp;<span class="comment" id="2187475">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187500">var</span>&nbsp;<span class="ident" id="2187504">hi</span><span class="op" id="2187506">,</span>&nbsp;<span class="ident" id="2187508">lo</span>&nbsp;<span class="builtintype" id="2187511">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187521">if</span>&nbsp;<span class="ident" id="2187524">absx</span>&nbsp;<span class="op" id="2187529">&lt;</span>&nbsp;<span class="ident" id="2187531">Ln2HalfX3</span>&nbsp;<span class="op" id="2187541">{</span>&nbsp;<span class="comment" id="2187543">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187569">if</span>&nbsp;<span class="op" id="2187572">!</span><span class="ident" id="2187573">sign</span>&nbsp;<span class="op" id="2187578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187584">hi</span>&nbsp;<span class="op" id="2187587">=</span>&nbsp;<span class="ident" id="2187589">x</span>&nbsp;<span class="op" id="2187591">-</span>&nbsp;<span class="ident" id="2187593">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187603">lo</span>&nbsp;<span class="op" id="2187606">=</span>&nbsp;<span class="ident" id="2187608">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187618">k</span>&nbsp;<span class="op" id="2187620">=</span>&nbsp;<span class="num" id="2187622">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187627">}</span>&nbsp;<span class="keyword" id="2187629">else</span>&nbsp;<span class="op" id="2187634">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187640">hi</span>&nbsp;<span class="op" id="2187643">=</span>&nbsp;<span class="ident" id="2187645">x</span>&nbsp;<span class="op" id="2187647">+</span>&nbsp;<span class="ident" id="2187649">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187659">lo</span>&nbsp;<span class="op" id="2187662">=</span>&nbsp;<span class="op" id="2187664">-</span><span class="ident" id="2187665">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187675">k</span>&nbsp;<span class="op" id="2187677">=</span>&nbsp;<span class="op" id="2187679">-</span><span class="num" id="2187680">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187689">}</span>&nbsp;<span class="keyword" id="2187691">else</span>&nbsp;<span class="op" id="2187696">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187701">if</span>&nbsp;<span class="op" id="2187704">!</span><span class="ident" id="2187705">sign</span>&nbsp;<span class="op" id="2187710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187716">k</span>&nbsp;<span class="op" id="2187718">=</span>&nbsp;<span class="builtintype" id="2187720">int</span><span class="op" id="2187723">(</span><span class="ident" id="2187724">InvLn2</span><span class="op" id="2187730">*</span><span class="ident" id="2187731">x</span>&nbsp;<span class="op" id="2187733">+</span>&nbsp;<span class="num" id="2187735">0.5</span><span class="op" id="2187738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187743">}</span>&nbsp;<span class="keyword" id="2187745">else</span>&nbsp;<span class="op" id="2187750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187756">k</span>&nbsp;<span class="op" id="2187758">=</span>&nbsp;<span class="builtintype" id="2187760">int</span><span class="op" id="2187763">(</span><span class="ident" id="2187764">InvLn2</span><span class="op" id="2187770">*</span><span class="ident" id="2187771">x</span>&nbsp;<span class="op" id="2187773">-</span>&nbsp;<span class="num" id="2187775">0.5</span><span class="op" id="2187778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187783">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187788">t</span>&nbsp;<span class="op" id="2187790">:=</span>&nbsp;<span class="builtintype" id="2187793">float64</span><span class="op" id="2187800">(</span><span class="ident" id="2187801">k</span><span class="op" id="2187802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187807">hi</span>&nbsp;<span class="op" id="2187810">=</span>&nbsp;<span class="ident" id="2187812">x</span>&nbsp;<span class="op" id="2187814">-</span>&nbsp;<span class="ident" id="2187816">t</span><span class="op" id="2187817">*</span><span class="ident" id="2187818">Ln2Hi</span>&nbsp;<span class="comment" id="2187824">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187854">lo</span>&nbsp;<span class="op" id="2187857">=</span>&nbsp;<span class="ident" id="2187859">t</span>&nbsp;<span class="op" id="2187861">*</span>&nbsp;<span class="ident" id="2187863">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187875">x</span>&nbsp;<span class="op" id="2187877">=</span>&nbsp;<span class="ident" id="2187879">hi</span>&nbsp;<span class="op" id="2187882">-</span>&nbsp;<span class="ident" id="2187884">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187889">c</span>&nbsp;<span class="op" id="2187891">=</span>&nbsp;<span class="op" id="2187893">(</span><span class="ident" id="2187894">hi</span>&nbsp;<span class="op" id="2187897">-</span>&nbsp;<span class="ident" id="2187899">x</span><span class="op" id="2187900">)</span>&nbsp;<span class="op" id="2187902">-</span>&nbsp;<span class="ident" id="2187904">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187908">}</span>&nbsp;<span class="keyword" id="2187910">else</span>&nbsp;<span class="keyword" id="2187915">if</span>&nbsp;<span class="ident" id="2187918">absx</span>&nbsp;<span class="op" id="2187923">&lt;</span>&nbsp;<span class="ident" id="2187925">Tiny</span>&nbsp;<span class="op" id="2187930">{</span>&nbsp;<span class="comment" id="2187932">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2187965">return</span>&nbsp;<span class="ident" id="2187972">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187975">}</span>&nbsp;<span class="keyword" id="2187977">else</span>&nbsp;<span class="op" id="2187982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2187986">k</span>&nbsp;<span class="op" id="2187988">=</span>&nbsp;<span class="num" id="2187990">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2187993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2187997">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188027">hfx</span>&nbsp;<span class="op" id="2188031">:=</span>&nbsp;<span class="num" id="2188034">0.5</span>&nbsp;<span class="op" id="2188038">*</span>&nbsp;<span class="ident" id="2188040">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188043">hxs</span>&nbsp;<span class="op" id="2188047">:=</span>&nbsp;<span class="ident" id="2188050">x</span>&nbsp;<span class="op" id="2188052">*</span>&nbsp;<span class="ident" id="2188054">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188059">r1</span>&nbsp;<span class="op" id="2188062">:=</span>&nbsp;<span class="num" id="2188065">1</span>&nbsp;<span class="op" id="2188067">+</span>&nbsp;<span class="ident" id="2188069">hxs</span><span class="op" id="2188072">*</span><span class="op" id="2188073">(</span><span class="ident" id="2188074">Q1</span><span class="op" id="2188076">+</span><span class="ident" id="2188077">hxs</span><span class="op" id="2188080">*</span><span class="op" id="2188081">(</span><span class="ident" id="2188082">Q2</span><span class="op" id="2188084">+</span><span class="ident" id="2188085">hxs</span><span class="op" id="2188088">*</span><span class="op" id="2188089">(</span><span class="ident" id="2188090">Q3</span><span class="op" id="2188092">+</span><span class="ident" id="2188093">hxs</span><span class="op" id="2188096">*</span><span class="op" id="2188097">(</span><span class="ident" id="2188098">Q4</span><span class="op" id="2188100">+</span><span class="ident" id="2188101">hxs</span><span class="op" id="2188104">*</span><span class="ident" id="2188105">Q5</span><span class="op" id="2188107">)</span><span class="op" id="2188108">)</span><span class="op" id="2188109">)</span><span class="op" id="2188110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188113">t</span>&nbsp;<span class="op" id="2188115">:=</span>&nbsp;<span class="num" id="2188118">3</span>&nbsp;<span class="op" id="2188120">-</span>&nbsp;<span class="ident" id="2188122">r1</span><span class="op" id="2188124">*</span><span class="ident" id="2188125">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188130">e</span>&nbsp;<span class="op" id="2188132">:=</span>&nbsp;<span class="ident" id="2188135">hxs</span>&nbsp;<span class="op" id="2188139">*</span>&nbsp;<span class="op" id="2188141">(</span><span class="op" id="2188142">(</span><span class="ident" id="2188143">r1</span>&nbsp;<span class="op" id="2188146">-</span>&nbsp;<span class="ident" id="2188148">t</span><span class="op" id="2188149">)</span>&nbsp;<span class="op" id="2188151">/</span>&nbsp;<span class="op" id="2188153">(</span><span class="num" id="2188154">6.0</span>&nbsp;<span class="op" id="2188158">-</span>&nbsp;<span class="ident" id="2188160">x</span><span class="op" id="2188161">*</span><span class="ident" id="2188162">t</span><span class="op" id="2188163">)</span><span class="op" id="2188164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188167">if</span>&nbsp;<span class="ident" id="2188170">k</span>&nbsp;<span class="op" id="2188172">!=</span>&nbsp;<span class="num" id="2188175">0</span>&nbsp;<span class="op" id="2188177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188181">e</span>&nbsp;<span class="op" id="2188183">=</span>&nbsp;<span class="op" id="2188185">(</span><span class="ident" id="2188186">x</span><span class="op" id="2188187">*</span><span class="op" id="2188188">(</span><span class="ident" id="2188189">e</span><span class="op" id="2188190">-</span><span class="ident" id="2188191">c</span><span class="op" id="2188192">)</span>&nbsp;<span class="op" id="2188194">-</span>&nbsp;<span class="ident" id="2188196">c</span><span class="op" id="2188197">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188201">e</span>&nbsp;<span class="op" id="2188203">-=</span>&nbsp;<span class="ident" id="2188206">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188212">switch</span>&nbsp;<span class="op" id="2188219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188223">case</span>&nbsp;<span class="ident" id="2188228">k</span>&nbsp;<span class="op" id="2188230">==</span>&nbsp;<span class="op" id="2188233">-</span><span class="num" id="2188234">1</span><span class="op" id="2188235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188240">return</span>&nbsp;<span class="num" id="2188247">0.5</span><span class="op" id="2188250">*</span><span class="op" id="2188251">(</span><span class="ident" id="2188252">x</span><span class="op" id="2188253">-</span><span class="ident" id="2188254">e</span><span class="op" id="2188255">)</span>&nbsp;<span class="op" id="2188257">-</span>&nbsp;<span class="num" id="2188259">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188265">case</span>&nbsp;<span class="ident" id="2188270">k</span>&nbsp;<span class="op" id="2188272">==</span>&nbsp;<span class="num" id="2188275">1</span><span class="op" id="2188276">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188281">if</span>&nbsp;<span class="ident" id="2188284">x</span>&nbsp;<span class="op" id="2188286">&lt;</span>&nbsp;<span class="op" id="2188288">-</span><span class="num" id="2188289">0.25</span>&nbsp;<span class="op" id="2188294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188300">return</span>&nbsp;<span class="op" id="2188307">-</span><span class="num" id="2188308">2</span>&nbsp;<span class="op" id="2188310">*</span>&nbsp;<span class="op" id="2188312">(</span><span class="ident" id="2188313">e</span>&nbsp;<span class="op" id="2188315">-</span>&nbsp;<span class="op" id="2188317">(</span><span class="ident" id="2188318">x</span>&nbsp;<span class="op" id="2188320">+</span>&nbsp;<span class="num" id="2188322">0.5</span><span class="op" id="2188325">)</span><span class="op" id="2188326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2188331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188336">return</span>&nbsp;<span class="num" id="2188343">1</span>&nbsp;<span class="op" id="2188345">+</span>&nbsp;<span class="num" id="2188347">2</span><span class="op" id="2188348">*</span><span class="op" id="2188349">(</span><span class="ident" id="2188350">x</span><span class="op" id="2188351">-</span><span class="ident" id="2188352">e</span><span class="op" id="2188353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188357">case</span>&nbsp;<span class="ident" id="2188362">k</span>&nbsp;<span class="op" id="2188364">&lt;=</span>&nbsp;<span class="op" id="2188367">-</span><span class="num" id="2188368">2</span>&nbsp;<span class="op" id="2188370">||</span>&nbsp;<span class="ident" id="2188373">k</span>&nbsp;<span class="op" id="2188375">&gt;</span>&nbsp;<span class="num" id="2188377">56</span><span class="op" id="2188379">:</span>&nbsp;<span class="comment" id="2188381">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188414">y</span>&nbsp;<span class="op" id="2188416">:=</span>&nbsp;<span class="num" id="2188419">1</span>&nbsp;<span class="op" id="2188421">-</span>&nbsp;<span class="op" id="2188423">(</span><span class="ident" id="2188424">e</span>&nbsp;<span class="op" id="2188426">-</span>&nbsp;<span class="ident" id="2188428">x</span><span class="op" id="2188429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188434">y</span>&nbsp;<span class="op" id="2188436">=</span>&nbsp;<span class="ident" id="2188438">Float64frombits</span><span class="op" id="2188453">(</span><span class="ident" id="2188454">Float64bits</span><span class="op" id="2188465">(</span><span class="ident" id="2188466">y</span><span class="op" id="2188467">)</span>&nbsp;<span class="op" id="2188469">+</span>&nbsp;<span class="ident" id="2188471">uint64</span><span class="op" id="2188477">(</span><span class="ident" id="2188478">k</span><span class="op" id="2188479">)</span><span class="op" id="2188480">&lt;&lt;</span><span class="num" id="2188482">52</span><span class="op" id="2188484">)</span>&nbsp;<span class="comment" id="2188486">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188514">return</span>&nbsp;<span class="ident" id="2188521">y</span>&nbsp;<span class="op" id="2188523">-</span>&nbsp;<span class="num" id="2188525">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2188529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188533">if</span>&nbsp;<span class="ident" id="2188536">k</span>&nbsp;<span class="op" id="2188538">&lt;</span>&nbsp;<span class="num" id="2188540">20</span>&nbsp;<span class="op" id="2188543">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188548">t</span>&nbsp;<span class="op" id="2188550">:=</span>&nbsp;<span class="ident" id="2188553">Float64frombits</span><span class="op" id="2188568">(</span><span class="num" id="2188569">0x3ff0000000000000</span>&nbsp;<span class="op" id="2188588">-</span>&nbsp;<span class="op" id="2188590">(</span><span class="num" id="2188591">0x20000000000000</span>&nbsp;<span class="op" id="2188608">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2188611">uint</span><span class="op" id="2188615">(</span><span class="ident" id="2188616">k</span><span class="op" id="2188617">)</span><span class="op" id="2188618">)</span><span class="op" id="2188619">)</span>&nbsp;<span class="comment" id="2188621">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188637">y</span>&nbsp;<span class="op" id="2188639">:=</span>&nbsp;<span class="ident" id="2188642">t</span>&nbsp;<span class="op" id="2188644">-</span>&nbsp;<span class="op" id="2188646">(</span><span class="ident" id="2188647">e</span>&nbsp;<span class="op" id="2188649">-</span>&nbsp;<span class="ident" id="2188651">x</span><span class="op" id="2188652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188657">y</span>&nbsp;<span class="op" id="2188659">=</span>&nbsp;<span class="ident" id="2188661">Float64frombits</span><span class="op" id="2188676">(</span><span class="ident" id="2188677">Float64bits</span><span class="op" id="2188688">(</span><span class="ident" id="2188689">y</span><span class="op" id="2188690">)</span>&nbsp;<span class="op" id="2188692">+</span>&nbsp;<span class="ident" id="2188694">uint64</span><span class="op" id="2188700">(</span><span class="ident" id="2188701">k</span><span class="op" id="2188702">)</span><span class="op" id="2188703">&lt;&lt;</span><span class="num" id="2188705">52</span><span class="op" id="2188707">)</span>&nbsp;<span class="comment" id="2188709">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188737">return</span>&nbsp;<span class="ident" id="2188744">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2188748">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188752">t</span>&nbsp;<span class="op" id="2188754">:=</span>&nbsp;<span class="ident" id="2188757">Float64frombits</span><span class="op" id="2188772">(</span><span class="ident" id="2188773">uint64</span><span class="op" id="2188779">(</span><span class="op" id="2188780">(</span><span class="num" id="2188781">0x3ff</span>&nbsp;<span class="op" id="2188787">-</span>&nbsp;<span class="ident" id="2188789">k</span><span class="op" id="2188790">)</span>&nbsp;<span class="op" id="2188792">&lt;&lt;</span>&nbsp;<span class="num" id="2188795">52</span><span class="op" id="2188797">)</span><span class="op" id="2188798">)</span>&nbsp;<span class="comment" id="2188800">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188811">y</span>&nbsp;<span class="op" id="2188813">:=</span>&nbsp;<span class="ident" id="2188816">x</span>&nbsp;<span class="op" id="2188818">-</span>&nbsp;<span class="op" id="2188820">(</span><span class="ident" id="2188821">e</span>&nbsp;<span class="op" id="2188823">+</span>&nbsp;<span class="ident" id="2188825">t</span><span class="op" id="2188826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188830">y</span>&nbsp;<span class="op" id="2188832">+=</span>&nbsp;<span class="num" id="2188835">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2188839">y</span>&nbsp;<span class="op" id="2188841">=</span>&nbsp;<span class="ident" id="2188843">Float64frombits</span><span class="op" id="2188858">(</span><span class="ident" id="2188859">Float64bits</span><span class="op" id="2188870">(</span><span class="ident" id="2188871">y</span><span class="op" id="2188872">)</span>&nbsp;<span class="op" id="2188874">+</span>&nbsp;<span class="ident" id="2188876">uint64</span><span class="op" id="2188882">(</span><span class="ident" id="2188883">k</span><span class="op" id="2188884">)</span><span class="op" id="2188885">&lt;&lt;</span><span class="num" id="2188887">52</span><span class="op" id="2188889">)</span>&nbsp;<span class="comment" id="2188891">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188918">return</span>&nbsp;<span class="ident" id="2188925">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2188928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2188931">return</span>&nbsp;<span class="ident" id="2188938">x</span>&nbsp;<span class="op" id="2188940">-</span>&nbsp;<span class="op" id="2188942">(</span><span class="ident" id="2188943">x</span><span class="op" id="2188944">*</span><span class="ident" id="2188945">e</span>&nbsp;<span class="op" id="2188947">-</span>&nbsp;<span class="ident" id="2188949">hxs</span><span class="op" id="2188952">)</span>&nbsp;<span class="comment" id="2188954">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2188964">}</span>
</div>
</body>
</html>
