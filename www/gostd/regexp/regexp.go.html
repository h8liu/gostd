<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5512173">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5512228">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5512282">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5512333">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="5512389">//</span><br>
<span class="lineno"></span><span class="comment" id="5512392">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5512454">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="5512515">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="5512584">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="5512644">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5512682">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="5512707">//</span><br>
<span class="lineno"></span><span class="comment" id="5512710">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="5512767">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5512829">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="5512887">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5512952">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5512980">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="5513025">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="5513063">//</span><br>
<span class="lineno"></span><span class="comment" id="5513066">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="5513115">//</span><br>
<span class="lineno"></span><span class="comment" id="5513118">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="5513197">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="5513271">//</span><br>
<span class="lineno"></span><span class="comment" id="5513274">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="5513316">//</span><br>
<span class="lineno"></span><span class="comment" id="5513319">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="5513390">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5513463">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5513540">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="5513618">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5513693">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="5513716">//</span><br>
<span class="lineno"></span><span class="comment" id="5513719">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5513796">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="5513852">//</span><br>
<span class="lineno"></span><span class="comment" id="5513855">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="5513928">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5513998">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5514074">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="5514145">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5514222">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="5514288">//</span><br>
<span class="lineno"></span><span class="comment" id="5514291">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="5514369">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5514447">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5514522">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="5514596">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5514667">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5514723">//</span><br>
<span class="lineno"></span><span class="comment" id="5514726">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="5514800">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="5514822">//</span><br>
<span class="lineno"></span><span class="comment" id="5514825">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="5514882">//</span><br>
<span class="lineno"></span><span class="comment" id="5514885">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5514957">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="5515030">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="5515102">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="5515123">//</span><br>
<span class="lineno"></span><span class="comment" id="5515126">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="5515193">//</span><br>
<span class="lineno">65</span><span class="keyword" id="5515196">package</span>&nbsp;<span class="ident" id="5515204">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515212">import</span>&nbsp;<span class="op" id="5515219">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515222">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515231">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515237">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515254">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515265">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515276">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515284">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5515295">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5515310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515313">var</span>&nbsp;<span class="ident" id="5515317">debug</span>&nbsp;<span class="op" id="5515323">=</span>&nbsp;<span class="builtintype" id="5515325">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5515332">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5515398">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5515461">type</span>&nbsp;<span class="ident" id="5515466">Regexp</span>&nbsp;<span class="keyword" id="5515473">struct</span>&nbsp;<span class="op" id="5515480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515483">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515511">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5515526">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515541">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515566">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515581">*</span><span class="ident" id="5515582">syntax</span><span class="op" id="5515588">.</span><span class="ident" id="5515589">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5515596">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515617">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515632">*</span><span class="ident" id="5515633">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5515647">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515673">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5515688">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515703">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515745">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515760">[</span><span class="op" id="5515761">]</span><span class="builtintype" id="5515762">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515775">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515799">prefixComplete</span>&nbsp;<span class="builtintype" id="5515814">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515829">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515861">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5515876">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515891">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515916">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5515931">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515946">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515977">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515992">syntax</span><span class="op" id="5515998">.</span><span class="ident" id="5515999">EmptyOp</span>&nbsp;<span class="comment" id="5516007">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516061">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5516076">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516081">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516096">[</span><span class="op" id="5516097">]</span><span class="builtintype" id="5516098">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516106">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5516121">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516128">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516169">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516177">sync</span><span class="op" id="5516181">.</span><span class="ident" id="5516182">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516189">machine</span>&nbsp;<span class="op" id="5516197">[</span><span class="op" id="5516198">]</span><span class="op" id="5516199">*</span><span class="ident" id="5516200">machine</span><br>
<span class="lineno">100</span><span class="op" id="5516208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516211">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5516285">func</span>&nbsp;<span class="op" id="5516290">(</span><span class="ident" id="5516291">re</span>&nbsp;<span class="op" id="5516294">*</span><span class="ident" id="5516295">Regexp</span><span class="op" id="5516301">)</span>&nbsp;<span class="ident" id="5516303">String</span><span class="op" id="5516309">(</span><span class="op" id="5516310">)</span>&nbsp;<span class="builtintype" id="5516312">string</span>&nbsp;<span class="op" id="5516319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516322">return</span>&nbsp;<span class="ident" id="5516329">re</span><span class="op" id="5516331">.</span><span class="ident" id="5516332">expr</span><br>
<span class="lineno">105</span><span class="op" id="5516337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516340">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="5516407">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5516466">//</span><br>
<span class="lineno">110</span><span class="comment" id="5516469">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5516532">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5516604">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="5516677">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5516741">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="5516808">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="5516870">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="5516928">func</span>&nbsp;<span class="ident" id="5516933">Compile</span><span class="op" id="5516940">(</span><span class="ident" id="5516941">expr</span>&nbsp;<span class="builtintype" id="5516946">string</span><span class="op" id="5516952">)</span>&nbsp;<span class="op" id="5516954">(</span><span class="op" id="5516955">*</span><span class="ident" id="5516956">Regexp</span><span class="op" id="5516962">,</span>&nbsp;<span class="builtintype" id="5516964">error</span><span class="op" id="5516969">)</span>&nbsp;<span class="op" id="5516971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516974">return</span>&nbsp;<span class="ident" id="5516981">compile</span><span class="op" id="5516988">(</span><span class="ident" id="5516989">expr</span><span class="op" id="5516993">,</span>&nbsp;<span class="ident" id="5516995">syntax</span><span class="op" id="5517001">.</span><span class="ident" id="5517002">Perl</span><span class="op" id="5517006">,</span>&nbsp;<span class="builtintype" id="5517008">false</span><span class="op" id="5517013">)</span><br>
<span class="lineno"></span><span class="op" id="5517015">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5517018">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5517087">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5517153">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="5517174">//</span><br>
<span class="lineno">125</span><span class="comment" id="5517177">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5517249">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5517321">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="5517372">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5517438">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="5517507">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="5517521">//</span><br>
<span class="lineno"></span><span class="comment" id="5517524">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="5517599">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="5517663">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="5517732">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="5517806">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5517880">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="5517945">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="5518021">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="5518089">func</span>&nbsp;<span class="ident" id="5518094">CompilePOSIX</span><span class="op" id="5518106">(</span><span class="ident" id="5518107">expr</span>&nbsp;<span class="builtintype" id="5518112">string</span><span class="op" id="5518118">)</span>&nbsp;<span class="op" id="5518120">(</span><span class="op" id="5518121">*</span><span class="ident" id="5518122">Regexp</span><span class="op" id="5518128">,</span>&nbsp;<span class="builtintype" id="5518130">error</span><span class="op" id="5518135">)</span>&nbsp;<span class="op" id="5518137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518140">return</span>&nbsp;<span class="ident" id="5518147">compile</span><span class="op" id="5518154">(</span><span class="ident" id="5518155">expr</span><span class="op" id="5518159">,</span>&nbsp;<span class="ident" id="5518161">syntax</span><span class="op" id="5518167">.</span><span class="ident" id="5518168">POSIX</span><span class="op" id="5518173">,</span>&nbsp;<span class="builtintype" id="5518175">true</span><span class="op" id="5518179">)</span><br>
<span class="lineno"></span><span class="op" id="5518181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5518184">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="5518252">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5518324">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5518396">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5518447">func</span>&nbsp;<span class="op" id="5518452">(</span><span class="ident" id="5518453">re</span>&nbsp;<span class="op" id="5518456">*</span><span class="ident" id="5518457">Regexp</span><span class="op" id="5518463">)</span>&nbsp;<span class="ident" id="5518465">Longest</span><span class="op" id="5518472">(</span><span class="op" id="5518473">)</span>&nbsp;<span class="op" id="5518475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518478">re</span><span class="op" id="5518480">.</span><span class="ident" id="5518481">longest</span>&nbsp;<span class="op" id="5518489">=</span>&nbsp;<span class="builtintype" id="5518491">true</span><br>
<span class="lineno">150</span><span class="op" id="5518496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5518499">func</span>&nbsp;<span class="ident" id="5518504">compile</span><span class="op" id="5518511">(</span><span class="ident" id="5518512">expr</span>&nbsp;<span class="builtintype" id="5518517">string</span><span class="op" id="5518523">,</span>&nbsp;<span class="ident" id="5518525">mode</span>&nbsp;<span class="ident" id="5518530">syntax</span><span class="op" id="5518536">.</span><span class="ident" id="5518537">Flags</span><span class="op" id="5518542">,</span>&nbsp;<span class="ident" id="5518544">longest</span>&nbsp;<span class="builtintype" id="5518552">bool</span><span class="op" id="5518556">)</span>&nbsp;<span class="op" id="5518558">(</span><span class="op" id="5518559">*</span><span class="ident" id="5518560">Regexp</span><span class="op" id="5518566">,</span>&nbsp;<span class="builtintype" id="5518568">error</span><span class="op" id="5518573">)</span>&nbsp;<span class="op" id="5518575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518578">re</span><span class="op" id="5518580">,</span>&nbsp;<span class="ident" id="5518582">err</span>&nbsp;<span class="op" id="5518586">:=</span>&nbsp;<span class="ident" id="5518589">syntax</span><span class="op" id="5518595">.</span><span class="ident" id="5518596">Parse</span><span class="op" id="5518601">(</span><span class="ident" id="5518602">expr</span><span class="op" id="5518606">,</span>&nbsp;<span class="ident" id="5518608">mode</span><span class="op" id="5518612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518615">if</span>&nbsp;<span class="ident" id="5518618">err</span>&nbsp;<span class="op" id="5518622">!=</span>&nbsp;<span class="ident" id="5518625">nil</span>&nbsp;<span class="op" id="5518629">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518633">return</span>&nbsp;<span class="ident" id="5518640">nil</span><span class="op" id="5518643">,</span>&nbsp;<span class="ident" id="5518645">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518653">maxCap</span>&nbsp;<span class="op" id="5518660">:=</span>&nbsp;<span class="ident" id="5518663">re</span><span class="op" id="5518665">.</span><span class="ident" id="5518666">MaxCap</span><span class="op" id="5518672">(</span><span class="op" id="5518673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518676">capNames</span>&nbsp;<span class="op" id="5518685">:=</span>&nbsp;<span class="ident" id="5518688">re</span><span class="op" id="5518690">.</span><span class="ident" id="5518691">CapNames</span><span class="op" id="5518699">(</span><span class="op" id="5518700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518704">re</span>&nbsp;<span class="op" id="5518707">=</span>&nbsp;<span class="ident" id="5518709">re</span><span class="op" id="5518711">.</span><span class="ident" id="5518712">Simplify</span><span class="op" id="5518720">(</span><span class="op" id="5518721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518724">prog</span><span class="op" id="5518728">,</span>&nbsp;<span class="ident" id="5518730">err</span>&nbsp;<span class="op" id="5518734">:=</span>&nbsp;<span class="ident" id="5518737">syntax</span><span class="op" id="5518743">.</span><span class="ident" id="5518744">Compile</span><span class="op" id="5518751">(</span><span class="ident" id="5518752">re</span><span class="op" id="5518754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518757">if</span>&nbsp;<span class="ident" id="5518760">err</span>&nbsp;<span class="op" id="5518764">!=</span>&nbsp;<span class="ident" id="5518767">nil</span>&nbsp;<span class="op" id="5518771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518775">return</span>&nbsp;<span class="ident" id="5518782">nil</span><span class="op" id="5518785">,</span>&nbsp;<span class="ident" id="5518787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518792">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518795">regexp</span>&nbsp;<span class="op" id="5518802">:=</span>&nbsp;<span class="op" id="5518805">&amp;</span><span class="ident" id="5518806">Regexp</span><span class="op" id="5518812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518816">expr</span><span class="op" id="5518820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518829">expr</span><span class="op" id="5518833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518837">prog</span><span class="op" id="5518841">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518850">prog</span><span class="op" id="5518854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518858">onepass</span><span class="op" id="5518865">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518871">compileOnePass</span><span class="op" id="5518885">(</span><span class="ident" id="5518886">prog</span><span class="op" id="5518890">)</span><span class="op" id="5518891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518895">numSubexp</span><span class="op" id="5518904">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5518908">maxCap</span><span class="op" id="5518914">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518918">subexpNames</span><span class="op" id="5518929">:</span>&nbsp;<span class="ident" id="5518931">capNames</span><span class="op" id="5518939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518943">cond</span><span class="op" id="5518947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518956">prog</span><span class="op" id="5518960">.</span><span class="ident" id="5518961">StartCond</span><span class="op" id="5518970">(</span><span class="op" id="5518971">)</span><span class="op" id="5518972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518976">longest</span><span class="op" id="5518983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518989">longest</span><span class="op" id="5518996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519002">if</span>&nbsp;<span class="ident" id="5519005">regexp</span><span class="op" id="5519011">.</span><span class="ident" id="5519012">onepass</span>&nbsp;<span class="op" id="5519020">==</span>&nbsp;<span class="ident" id="5519023">notOnePass</span>&nbsp;<span class="op" id="5519034">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519038">regexp</span><span class="op" id="5519044">.</span><span class="ident" id="5519045">prefix</span><span class="op" id="5519051">,</span>&nbsp;<span class="ident" id="5519053">regexp</span><span class="op" id="5519059">.</span><span class="ident" id="5519060">prefixComplete</span>&nbsp;<span class="op" id="5519075">=</span>&nbsp;<span class="ident" id="5519077">prog</span><span class="op" id="5519081">.</span><span class="ident" id="5519082">Prefix</span><span class="op" id="5519088">(</span><span class="op" id="5519089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519092">}</span>&nbsp;<span class="keyword" id="5519094">else</span>&nbsp;<span class="op" id="5519099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519103">regexp</span><span class="op" id="5519109">.</span><span class="ident" id="5519110">prefix</span><span class="op" id="5519116">,</span>&nbsp;<span class="ident" id="5519118">regexp</span><span class="op" id="5519124">.</span><span class="ident" id="5519125">prefixComplete</span><span class="op" id="5519139">,</span>&nbsp;<span class="ident" id="5519141">regexp</span><span class="op" id="5519147">.</span><span class="ident" id="5519148">prefixEnd</span>&nbsp;<span class="op" id="5519158">=</span>&nbsp;<span class="ident" id="5519160">onePassPrefix</span><span class="op" id="5519173">(</span><span class="ident" id="5519174">prog</span><span class="op" id="5519178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519184">if</span>&nbsp;<span class="ident" id="5519187">regexp</span><span class="op" id="5519193">.</span><span class="ident" id="5519194">prefix</span>&nbsp;<span class="op" id="5519201">!=</span>&nbsp;<span class="string" id="5519204">&#34;&#34;</span>&nbsp;<span class="op" id="5519207">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519211">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519260">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519295">regexp</span><span class="op" id="5519301">.</span><span class="ident" id="5519302">prefixBytes</span>&nbsp;<span class="op" id="5519314">=</span>&nbsp;<span class="op" id="5519316">[</span><span class="op" id="5519317">]</span><span class="builtintype" id="5519318">byte</span><span class="op" id="5519322">(</span><span class="ident" id="5519323">regexp</span><span class="op" id="5519329">.</span><span class="ident" id="5519330">prefix</span><span class="op" id="5519336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519340">regexp</span><span class="op" id="5519346">.</span><span class="ident" id="5519347">prefixRune</span><span class="op" id="5519357">,</span>&nbsp;<span class="ident" id="5519359">_</span>&nbsp;<span class="op" id="5519361">=</span>&nbsp;<span class="ident" id="5519363">utf8</span><span class="op" id="5519367">.</span><span class="ident" id="5519368">DecodeRuneInString</span><span class="op" id="5519386">(</span><span class="ident" id="5519387">regexp</span><span class="op" id="5519393">.</span><span class="ident" id="5519394">prefix</span><span class="op" id="5519400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519403">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519406">return</span>&nbsp;<span class="ident" id="5519413">regexp</span><span class="op" id="5519419">,</span>&nbsp;<span class="ident" id="5519421">nil</span><br>
<span class="lineno"></span><span class="op" id="5519425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519428">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5519477">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="5519533">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5519560">func</span>&nbsp;<span class="op" id="5519565">(</span><span class="ident" id="5519566">re</span>&nbsp;<span class="op" id="5519569">*</span><span class="ident" id="5519570">Regexp</span><span class="op" id="5519576">)</span>&nbsp;<span class="ident" id="5519578">get</span><span class="op" id="5519581">(</span><span class="op" id="5519582">)</span>&nbsp;<span class="op" id="5519584">*</span><span class="ident" id="5519585">machine</span>&nbsp;<span class="op" id="5519593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519596">re</span><span class="op" id="5519598">.</span><span class="ident" id="5519599">mu</span><span class="op" id="5519601">.</span><span class="ident" id="5519602">Lock</span><span class="op" id="5519606">(</span><span class="op" id="5519607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519610">if</span>&nbsp;<span class="ident" id="5519613">n</span>&nbsp;<span class="op" id="5519615">:=</span>&nbsp;<span class="builtinfunc" id="5519618">len</span><span class="op" id="5519621">(</span><span class="ident" id="5519622">re</span><span class="op" id="5519624">.</span><span class="ident" id="5519625">machine</span><span class="op" id="5519632">)</span><span class="op" id="5519633">;</span>&nbsp;<span class="ident" id="5519635">n</span>&nbsp;<span class="op" id="5519637">&gt;</span>&nbsp;<span class="num" id="5519639">0</span>&nbsp;<span class="op" id="5519641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519645">z</span>&nbsp;<span class="op" id="5519647">:=</span>&nbsp;<span class="ident" id="5519650">re</span><span class="op" id="5519652">.</span><span class="ident" id="5519653">machine</span><span class="op" id="5519660">[</span><span class="ident" id="5519661">n</span><span class="op" id="5519662">-</span><span class="num" id="5519663">1</span><span class="op" id="5519664">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519668">re</span><span class="op" id="5519670">.</span><span class="ident" id="5519671">machine</span>&nbsp;<span class="op" id="5519679">=</span>&nbsp;<span class="ident" id="5519681">re</span><span class="op" id="5519683">.</span><span class="ident" id="5519684">machine</span><span class="op" id="5519691">[</span><span class="op" id="5519692">:</span><span class="ident" id="5519693">n</span><span class="op" id="5519694">-</span><span class="num" id="5519695">1</span><span class="op" id="5519696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519700">re</span><span class="op" id="5519702">.</span><span class="ident" id="5519703">mu</span><span class="op" id="5519705">.</span><span class="ident" id="5519706">Unlock</span><span class="op" id="5519712">(</span><span class="op" id="5519713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519717">return</span>&nbsp;<span class="ident" id="5519724">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519730">re</span><span class="op" id="5519732">.</span><span class="ident" id="5519733">mu</span><span class="op" id="5519735">.</span><span class="ident" id="5519736">Unlock</span><span class="op" id="5519742">(</span><span class="op" id="5519743">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519746">z</span>&nbsp;<span class="op" id="5519748">:=</span>&nbsp;<span class="ident" id="5519751">progMachine</span><span class="op" id="5519762">(</span><span class="ident" id="5519763">re</span><span class="op" id="5519765">.</span><span class="ident" id="5519766">prog</span><span class="op" id="5519770">,</span>&nbsp;<span class="ident" id="5519772">re</span><span class="op" id="5519774">.</span><span class="ident" id="5519775">onepass</span><span class="op" id="5519782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519785">z</span><span class="op" id="5519786">.</span><span class="ident" id="5519787">re</span>&nbsp;<span class="op" id="5519790">=</span>&nbsp;<span class="ident" id="5519792">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519796">return</span>&nbsp;<span class="ident" id="5519803">z</span><br>
<span class="lineno"></span><span class="op" id="5519805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5519808">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="5519860">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5519926">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5519980">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="5520050">func</span>&nbsp;<span class="op" id="5520055">(</span><span class="ident" id="5520056">re</span>&nbsp;<span class="op" id="5520059">*</span><span class="ident" id="5520060">Regexp</span><span class="op" id="5520066">)</span>&nbsp;<span class="ident" id="5520068">put</span><span class="op" id="5520071">(</span><span class="ident" id="5520072">z</span>&nbsp;<span class="op" id="5520074">*</span><span class="ident" id="5520075">machine</span><span class="op" id="5520082">)</span>&nbsp;<span class="op" id="5520084">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520087">re</span><span class="op" id="5520089">.</span><span class="ident" id="5520090">mu</span><span class="op" id="5520092">.</span><span class="ident" id="5520093">Lock</span><span class="op" id="5520097">(</span><span class="op" id="5520098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520101">re</span><span class="op" id="5520103">.</span><span class="ident" id="5520104">machine</span>&nbsp;<span class="op" id="5520112">=</span>&nbsp;<span class="builtinfunc" id="5520114">append</span><span class="op" id="5520120">(</span><span class="ident" id="5520121">re</span><span class="op" id="5520123">.</span><span class="ident" id="5520124">machine</span><span class="op" id="5520131">,</span>&nbsp;<span class="ident" id="5520133">z</span><span class="op" id="5520134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520137">re</span><span class="op" id="5520139">.</span><span class="ident" id="5520140">mu</span><span class="op" id="5520142">.</span><span class="ident" id="5520143">Unlock</span><span class="op" id="5520149">(</span><span class="op" id="5520150">)</span><br>
<span class="lineno"></span><span class="op" id="5520152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5520155">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5520233">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5520315">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5520331">func</span>&nbsp;<span class="ident" id="5520336">MustCompile</span><span class="op" id="5520347">(</span><span class="ident" id="5520348">str</span>&nbsp;<span class="builtintype" id="5520352">string</span><span class="op" id="5520358">)</span>&nbsp;<span class="op" id="5520360">*</span><span class="ident" id="5520361">Regexp</span>&nbsp;<span class="op" id="5520368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520371">regexp</span><span class="op" id="5520377">,</span>&nbsp;<span class="builtintype" id="5520379">error</span>&nbsp;<span class="op" id="5520385">:=</span>&nbsp;<span class="ident" id="5520388">Compile</span><span class="op" id="5520395">(</span><span class="ident" id="5520396">str</span><span class="op" id="5520399">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520402">if</span>&nbsp;<span class="builtintype" id="5520405">error</span>&nbsp;<span class="op" id="5520411">!=</span>&nbsp;<span class="ident" id="5520414">nil</span>&nbsp;<span class="op" id="5520418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5520422">panic</span><span class="op" id="5520427">(</span><span class="string" id="5520428">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="5520447">+</span>&nbsp;<span class="ident" id="5520449">quote</span><span class="op" id="5520454">(</span><span class="ident" id="5520455">str</span><span class="op" id="5520458">)</span>&nbsp;<span class="op" id="5520460">+</span>&nbsp;<span class="string" id="5520462">`):&nbsp;`</span>&nbsp;<span class="op" id="5520468">+</span>&nbsp;<span class="builtintype" id="5520470">error</span><span class="op" id="5520475">.</span><span class="ident" id="5520476">Error</span><span class="op" id="5520481">(</span><span class="op" id="5520482">)</span><span class="op" id="5520483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520489">return</span>&nbsp;<span class="ident" id="5520496">regexp</span><br>
<span class="lineno"></span><span class="op" id="5520503">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5520506">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5520594">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5520676">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5520692">func</span>&nbsp;<span class="ident" id="5520697">MustCompilePOSIX</span><span class="op" id="5520713">(</span><span class="ident" id="5520714">str</span>&nbsp;<span class="builtintype" id="5520718">string</span><span class="op" id="5520724">)</span>&nbsp;<span class="op" id="5520726">*</span><span class="ident" id="5520727">Regexp</span>&nbsp;<span class="op" id="5520734">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520737">regexp</span><span class="op" id="5520743">,</span>&nbsp;<span class="builtintype" id="5520745">error</span>&nbsp;<span class="op" id="5520751">:=</span>&nbsp;<span class="ident" id="5520754">CompilePOSIX</span><span class="op" id="5520766">(</span><span class="ident" id="5520767">str</span><span class="op" id="5520770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520773">if</span>&nbsp;<span class="builtintype" id="5520776">error</span>&nbsp;<span class="op" id="5520782">!=</span>&nbsp;<span class="ident" id="5520785">nil</span>&nbsp;<span class="op" id="5520789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5520793">panic</span><span class="op" id="5520798">(</span><span class="string" id="5520799">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="5520823">+</span>&nbsp;<span class="ident" id="5520825">quote</span><span class="op" id="5520830">(</span><span class="ident" id="5520831">str</span><span class="op" id="5520834">)</span>&nbsp;<span class="op" id="5520836">+</span>&nbsp;<span class="string" id="5520838">`):&nbsp;`</span>&nbsp;<span class="op" id="5520844">+</span>&nbsp;<span class="builtintype" id="5520846">error</span><span class="op" id="5520851">.</span><span class="ident" id="5520852">Error</span><span class="op" id="5520857">(</span><span class="op" id="5520858">)</span><span class="op" id="5520859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520865">return</span>&nbsp;<span class="ident" id="5520872">regexp</span><br>
<span class="lineno">235</span><span class="op" id="5520879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520882">func</span>&nbsp;<span class="ident" id="5520887">quote</span><span class="op" id="5520892">(</span><span class="ident" id="5520893">s</span>&nbsp;<span class="builtintype" id="5520895">string</span><span class="op" id="5520901">)</span>&nbsp;<span class="builtintype" id="5520903">string</span>&nbsp;<span class="op" id="5520910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520913">if</span>&nbsp;<span class="ident" id="5520916">strconv</span><span class="op" id="5520923">.</span><span class="ident" id="5520924">CanBackquote</span><span class="op" id="5520936">(</span><span class="ident" id="5520937">s</span><span class="op" id="5520938">)</span>&nbsp;<span class="op" id="5520940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520944">return</span>&nbsp;<span class="string" id="5520951">&#34;`&#34;</span>&nbsp;<span class="op" id="5520955">+</span>&nbsp;<span class="ident" id="5520957">s</span>&nbsp;<span class="op" id="5520959">+</span>&nbsp;<span class="string" id="5520961">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520969">return</span>&nbsp;<span class="ident" id="5520976">strconv</span><span class="op" id="5520983">.</span><span class="ident" id="5520984">Quote</span><span class="op" id="5520989">(</span><span class="ident" id="5520990">s</span><span class="op" id="5520991">)</span><br>
<span class="lineno"></span><span class="op" id="5520993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520996">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="5521076">func</span>&nbsp;<span class="op" id="5521081">(</span><span class="ident" id="5521082">re</span>&nbsp;<span class="op" id="5521085">*</span><span class="ident" id="5521086">Regexp</span><span class="op" id="5521092">)</span>&nbsp;<span class="ident" id="5521094">NumSubexp</span><span class="op" id="5521103">(</span><span class="op" id="5521104">)</span>&nbsp;<span class="builtintype" id="5521106">int</span>&nbsp;<span class="op" id="5521110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521113">return</span>&nbsp;<span class="ident" id="5521120">re</span><span class="op" id="5521122">.</span><span class="ident" id="5521123">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="5521133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5521136">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="5521205">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="5521276">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="5521349">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="5521416">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="5521472">func</span>&nbsp;<span class="op" id="5521477">(</span><span class="ident" id="5521478">re</span>&nbsp;<span class="op" id="5521481">*</span><span class="ident" id="5521482">Regexp</span><span class="op" id="5521488">)</span>&nbsp;<span class="ident" id="5521490">SubexpNames</span><span class="op" id="5521501">(</span><span class="op" id="5521502">)</span>&nbsp;<span class="op" id="5521504">[</span><span class="op" id="5521505">]</span><span class="builtintype" id="5521506">string</span>&nbsp;<span class="op" id="5521513">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521516">return</span>&nbsp;<span class="ident" id="5521523">re</span><span class="op" id="5521525">.</span><span class="ident" id="5521526">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="5521538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521541">const</span>&nbsp;<span class="ident" id="5521547">endOfText</span>&nbsp;<span class="builtintype" id="5521557">rune</span>&nbsp;<span class="op" id="5521562">=</span>&nbsp;<span class="op" id="5521564">-</span><span class="num" id="5521565">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5521568">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="5521644">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="5521672">type</span>&nbsp;<span class="ident" id="5521677">input</span>&nbsp;<span class="keyword" id="5521683">interface</span>&nbsp;<span class="op" id="5521693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521696">step</span><span class="op" id="5521700">(</span><span class="ident" id="5521701">pos</span>&nbsp;<span class="builtintype" id="5521705">int</span><span class="op" id="5521708">)</span>&nbsp;<span class="op" id="5521710">(</span><span class="ident" id="5521711">r</span>&nbsp;<span class="builtintype" id="5521713">rune</span><span class="op" id="5521717">,</span>&nbsp;<span class="ident" id="5521719">width</span>&nbsp;<span class="builtintype" id="5521725">int</span><span class="op" id="5521728">)</span>&nbsp;<span class="comment" id="5521730">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521751">canCheckPrefix</span><span class="op" id="5521765">(</span><span class="op" id="5521766">)</span>&nbsp;<span class="builtintype" id="5521768">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5521785">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521828">hasPrefix</span><span class="op" id="5521837">(</span><span class="ident" id="5521838">re</span>&nbsp;<span class="op" id="5521841">*</span><span class="ident" id="5521842">Regexp</span><span class="op" id="5521848">)</span>&nbsp;<span class="builtintype" id="5521850">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521856">index</span><span class="op" id="5521861">(</span><span class="ident" id="5521862">re</span>&nbsp;<span class="op" id="5521865">*</span><span class="ident" id="5521866">Regexp</span><span class="op" id="5521872">,</span>&nbsp;<span class="ident" id="5521874">pos</span>&nbsp;<span class="builtintype" id="5521878">int</span><span class="op" id="5521881">)</span>&nbsp;<span class="builtintype" id="5521883">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521888">context</span><span class="op" id="5521895">(</span><span class="ident" id="5521896">pos</span>&nbsp;<span class="builtintype" id="5521900">int</span><span class="op" id="5521903">)</span>&nbsp;<span class="ident" id="5521905">syntax</span><span class="op" id="5521911">.</span><span class="ident" id="5521912">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="5521920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5521923">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5521954">type</span>&nbsp;<span class="ident" id="5521959">inputString</span>&nbsp;<span class="keyword" id="5521971">struct</span>&nbsp;<span class="op" id="5521978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521981">str</span>&nbsp;<span class="builtintype" id="5521985">string</span><br>
<span class="lineno"></span><span class="op" id="5521992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5521995">func</span>&nbsp;<span class="op" id="5522000">(</span><span class="ident" id="5522001">i</span>&nbsp;<span class="op" id="5522003">*</span><span class="ident" id="5522004">inputString</span><span class="op" id="5522015">)</span>&nbsp;<span class="ident" id="5522017">step</span><span class="op" id="5522021">(</span><span class="ident" id="5522022">pos</span>&nbsp;<span class="builtintype" id="5522026">int</span><span class="op" id="5522029">)</span>&nbsp;<span class="op" id="5522031">(</span><span class="builtintype" id="5522032">rune</span><span class="op" id="5522036">,</span>&nbsp;<span class="builtintype" id="5522038">int</span><span class="op" id="5522041">)</span>&nbsp;<span class="op" id="5522043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522046">if</span>&nbsp;<span class="ident" id="5522049">pos</span>&nbsp;<span class="op" id="5522053">&lt;</span>&nbsp;<span class="builtinfunc" id="5522055">len</span><span class="op" id="5522058">(</span><span class="ident" id="5522059">i</span><span class="op" id="5522060">.</span><span class="ident" id="5522061">str</span><span class="op" id="5522064">)</span>&nbsp;<span class="op" id="5522066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522070">c</span>&nbsp;<span class="op" id="5522072">:=</span>&nbsp;<span class="ident" id="5522075">i</span><span class="op" id="5522076">.</span><span class="ident" id="5522077">str</span><span class="op" id="5522080">[</span><span class="ident" id="5522081">pos</span><span class="op" id="5522084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522088">if</span>&nbsp;<span class="ident" id="5522091">c</span>&nbsp;<span class="op" id="5522093">&lt;</span>&nbsp;<span class="ident" id="5522095">utf8</span><span class="op" id="5522099">.</span><span class="ident" id="5522100">RuneSelf</span>&nbsp;<span class="op" id="5522109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522114">return</span>&nbsp;<span class="builtintype" id="5522121">rune</span><span class="op" id="5522125">(</span><span class="ident" id="5522126">c</span><span class="op" id="5522127">)</span><span class="op" id="5522128">,</span>&nbsp;<span class="num" id="5522130">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522138">return</span>&nbsp;<span class="ident" id="5522145">utf8</span><span class="op" id="5522149">.</span><span class="ident" id="5522150">DecodeRuneInString</span><span class="op" id="5522168">(</span><span class="ident" id="5522169">i</span><span class="op" id="5522170">.</span><span class="ident" id="5522171">str</span><span class="op" id="5522174">[</span><span class="ident" id="5522175">pos</span><span class="op" id="5522178">:</span><span class="op" id="5522179">]</span><span class="op" id="5522180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522186">return</span>&nbsp;<span class="ident" id="5522193">endOfText</span><span class="op" id="5522202">,</span>&nbsp;<span class="num" id="5522204">0</span><br>
<span class="lineno"></span><span class="op" id="5522206">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5522209">func</span>&nbsp;<span class="op" id="5522214">(</span><span class="ident" id="5522215">i</span>&nbsp;<span class="op" id="5522217">*</span><span class="ident" id="5522218">inputString</span><span class="op" id="5522229">)</span>&nbsp;<span class="ident" id="5522231">canCheckPrefix</span><span class="op" id="5522245">(</span><span class="op" id="5522246">)</span>&nbsp;<span class="builtintype" id="5522248">bool</span>&nbsp;<span class="op" id="5522253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522256">return</span>&nbsp;<span class="builtintype" id="5522263">true</span><br>
<span class="lineno"></span><span class="op" id="5522268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="5522271">func</span>&nbsp;<span class="op" id="5522276">(</span><span class="ident" id="5522277">i</span>&nbsp;<span class="op" id="5522279">*</span><span class="ident" id="5522280">inputString</span><span class="op" id="5522291">)</span>&nbsp;<span class="ident" id="5522293">hasPrefix</span><span class="op" id="5522302">(</span><span class="ident" id="5522303">re</span>&nbsp;<span class="op" id="5522306">*</span><span class="ident" id="5522307">Regexp</span><span class="op" id="5522313">)</span>&nbsp;<span class="builtintype" id="5522315">bool</span>&nbsp;<span class="op" id="5522320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522323">return</span>&nbsp;<span class="ident" id="5522330">strings</span><span class="op" id="5522337">.</span><span class="ident" id="5522338">HasPrefix</span><span class="op" id="5522347">(</span><span class="ident" id="5522348">i</span><span class="op" id="5522349">.</span><span class="ident" id="5522350">str</span><span class="op" id="5522353">,</span>&nbsp;<span class="ident" id="5522355">re</span><span class="op" id="5522357">.</span><span class="ident" id="5522358">prefix</span><span class="op" id="5522364">)</span><br>
<span class="lineno"></span><span class="op" id="5522366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522369">func</span>&nbsp;<span class="op" id="5522374">(</span><span class="ident" id="5522375">i</span>&nbsp;<span class="op" id="5522377">*</span><span class="ident" id="5522378">inputString</span><span class="op" id="5522389">)</span>&nbsp;<span class="ident" id="5522391">index</span><span class="op" id="5522396">(</span><span class="ident" id="5522397">re</span>&nbsp;<span class="op" id="5522400">*</span><span class="ident" id="5522401">Regexp</span><span class="op" id="5522407">,</span>&nbsp;<span class="ident" id="5522409">pos</span>&nbsp;<span class="builtintype" id="5522413">int</span><span class="op" id="5522416">)</span>&nbsp;<span class="builtintype" id="5522418">int</span>&nbsp;<span class="op" id="5522422">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522425">return</span>&nbsp;<span class="ident" id="5522432">strings</span><span class="op" id="5522439">.</span><span class="ident" id="5522440">Index</span><span class="op" id="5522445">(</span><span class="ident" id="5522446">i</span><span class="op" id="5522447">.</span><span class="ident" id="5522448">str</span><span class="op" id="5522451">[</span><span class="ident" id="5522452">pos</span><span class="op" id="5522455">:</span><span class="op" id="5522456">]</span><span class="op" id="5522457">,</span>&nbsp;<span class="ident" id="5522459">re</span><span class="op" id="5522461">.</span><span class="ident" id="5522462">prefix</span><span class="op" id="5522468">)</span><br>
<span class="lineno"></span><span class="op" id="5522470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522473">func</span>&nbsp;<span class="op" id="5522478">(</span><span class="ident" id="5522479">i</span>&nbsp;<span class="op" id="5522481">*</span><span class="ident" id="5522482">inputString</span><span class="op" id="5522493">)</span>&nbsp;<span class="ident" id="5522495">context</span><span class="op" id="5522502">(</span><span class="ident" id="5522503">pos</span>&nbsp;<span class="builtintype" id="5522507">int</span><span class="op" id="5522510">)</span>&nbsp;<span class="ident" id="5522512">syntax</span><span class="op" id="5522518">.</span><span class="ident" id="5522519">EmptyOp</span>&nbsp;<span class="op" id="5522527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522530">r1</span><span class="op" id="5522532">,</span>&nbsp;<span class="ident" id="5522534">r2</span>&nbsp;<span class="op" id="5522537">:=</span>&nbsp;<span class="ident" id="5522540">endOfText</span><span class="op" id="5522549">,</span>&nbsp;<span class="ident" id="5522551">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522562">if</span>&nbsp;<span class="ident" id="5522565">pos</span>&nbsp;<span class="op" id="5522569">&gt;</span>&nbsp;<span class="num" id="5522571">0</span>&nbsp;<span class="op" id="5522573">&amp;&amp;</span>&nbsp;<span class="ident" id="5522576">pos</span>&nbsp;<span class="op" id="5522580">&lt;=</span>&nbsp;<span class="builtinfunc" id="5522583">len</span><span class="op" id="5522586">(</span><span class="ident" id="5522587">i</span><span class="op" id="5522588">.</span><span class="ident" id="5522589">str</span><span class="op" id="5522592">)</span>&nbsp;<span class="op" id="5522594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522598">r1</span><span class="op" id="5522600">,</span>&nbsp;<span class="ident" id="5522602">_</span>&nbsp;<span class="op" id="5522604">=</span>&nbsp;<span class="ident" id="5522606">utf8</span><span class="op" id="5522610">.</span><span class="ident" id="5522611">DecodeLastRuneInString</span><span class="op" id="5522633">(</span><span class="ident" id="5522634">i</span><span class="op" id="5522635">.</span><span class="ident" id="5522636">str</span><span class="op" id="5522639">[</span><span class="op" id="5522640">:</span><span class="ident" id="5522641">pos</span><span class="op" id="5522644">]</span><span class="op" id="5522645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522651">if</span>&nbsp;<span class="ident" id="5522654">pos</span>&nbsp;<span class="op" id="5522658">&lt;</span>&nbsp;<span class="builtinfunc" id="5522660">len</span><span class="op" id="5522663">(</span><span class="ident" id="5522664">i</span><span class="op" id="5522665">.</span><span class="ident" id="5522666">str</span><span class="op" id="5522669">)</span>&nbsp;<span class="op" id="5522671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522675">r2</span><span class="op" id="5522677">,</span>&nbsp;<span class="ident" id="5522679">_</span>&nbsp;<span class="op" id="5522681">=</span>&nbsp;<span class="ident" id="5522683">utf8</span><span class="op" id="5522687">.</span><span class="ident" id="5522688">DecodeRuneInString</span><span class="op" id="5522706">(</span><span class="ident" id="5522707">i</span><span class="op" id="5522708">.</span><span class="ident" id="5522709">str</span><span class="op" id="5522712">[</span><span class="ident" id="5522713">pos</span><span class="op" id="5522716">:</span><span class="op" id="5522717">]</span><span class="op" id="5522718">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522724">return</span>&nbsp;<span class="ident" id="5522731">syntax</span><span class="op" id="5522737">.</span><span class="ident" id="5522738">EmptyOpContext</span><span class="op" id="5522752">(</span><span class="ident" id="5522753">r1</span><span class="op" id="5522755">,</span>&nbsp;<span class="ident" id="5522757">r2</span><span class="op" id="5522759">)</span><br>
<span class="lineno"></span><span class="op" id="5522761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522764">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="5522798">type</span>&nbsp;<span class="ident" id="5522803">inputBytes</span>&nbsp;<span class="keyword" id="5522814">struct</span>&nbsp;<span class="op" id="5522821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522824">str</span>&nbsp;<span class="op" id="5522828">[</span><span class="op" id="5522829">]</span><span class="builtintype" id="5522830">byte</span><br>
<span class="lineno"></span><span class="op" id="5522835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522838">func</span>&nbsp;<span class="op" id="5522843">(</span><span class="ident" id="5522844">i</span>&nbsp;<span class="op" id="5522846">*</span><span class="ident" id="5522847">inputBytes</span><span class="op" id="5522857">)</span>&nbsp;<span class="ident" id="5522859">step</span><span class="op" id="5522863">(</span><span class="ident" id="5522864">pos</span>&nbsp;<span class="builtintype" id="5522868">int</span><span class="op" id="5522871">)</span>&nbsp;<span class="op" id="5522873">(</span><span class="builtintype" id="5522874">rune</span><span class="op" id="5522878">,</span>&nbsp;<span class="builtintype" id="5522880">int</span><span class="op" id="5522883">)</span>&nbsp;<span class="op" id="5522885">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522888">if</span>&nbsp;<span class="ident" id="5522891">pos</span>&nbsp;<span class="op" id="5522895">&lt;</span>&nbsp;<span class="builtinfunc" id="5522897">len</span><span class="op" id="5522900">(</span><span class="ident" id="5522901">i</span><span class="op" id="5522902">.</span><span class="ident" id="5522903">str</span><span class="op" id="5522906">)</span>&nbsp;<span class="op" id="5522908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522912">c</span>&nbsp;<span class="op" id="5522914">:=</span>&nbsp;<span class="ident" id="5522917">i</span><span class="op" id="5522918">.</span><span class="ident" id="5522919">str</span><span class="op" id="5522922">[</span><span class="ident" id="5522923">pos</span><span class="op" id="5522926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522930">if</span>&nbsp;<span class="ident" id="5522933">c</span>&nbsp;<span class="op" id="5522935">&lt;</span>&nbsp;<span class="ident" id="5522937">utf8</span><span class="op" id="5522941">.</span><span class="ident" id="5522942">RuneSelf</span>&nbsp;<span class="op" id="5522951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522956">return</span>&nbsp;<span class="builtintype" id="5522963">rune</span><span class="op" id="5522967">(</span><span class="ident" id="5522968">c</span><span class="op" id="5522969">)</span><span class="op" id="5522970">,</span>&nbsp;<span class="num" id="5522972">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522976">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522980">return</span>&nbsp;<span class="ident" id="5522987">utf8</span><span class="op" id="5522991">.</span><span class="ident" id="5522992">DecodeRune</span><span class="op" id="5523002">(</span><span class="ident" id="5523003">i</span><span class="op" id="5523004">.</span><span class="ident" id="5523005">str</span><span class="op" id="5523008">[</span><span class="ident" id="5523009">pos</span><span class="op" id="5523012">:</span><span class="op" id="5523013">]</span><span class="op" id="5523014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523020">return</span>&nbsp;<span class="ident" id="5523027">endOfText</span><span class="op" id="5523036">,</span>&nbsp;<span class="num" id="5523038">0</span><br>
<span class="lineno"></span><span class="op" id="5523040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="5523043">func</span>&nbsp;<span class="op" id="5523048">(</span><span class="ident" id="5523049">i</span>&nbsp;<span class="op" id="5523051">*</span><span class="ident" id="5523052">inputBytes</span><span class="op" id="5523062">)</span>&nbsp;<span class="ident" id="5523064">canCheckPrefix</span><span class="op" id="5523078">(</span><span class="op" id="5523079">)</span>&nbsp;<span class="builtintype" id="5523081">bool</span>&nbsp;<span class="op" id="5523086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523089">return</span>&nbsp;<span class="builtintype" id="5523096">true</span><br>
<span class="lineno"></span><span class="op" id="5523101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523104">func</span>&nbsp;<span class="op" id="5523109">(</span><span class="ident" id="5523110">i</span>&nbsp;<span class="op" id="5523112">*</span><span class="ident" id="5523113">inputBytes</span><span class="op" id="5523123">)</span>&nbsp;<span class="ident" id="5523125">hasPrefix</span><span class="op" id="5523134">(</span><span class="ident" id="5523135">re</span>&nbsp;<span class="op" id="5523138">*</span><span class="ident" id="5523139">Regexp</span><span class="op" id="5523145">)</span>&nbsp;<span class="builtintype" id="5523147">bool</span>&nbsp;<span class="op" id="5523152">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523155">return</span>&nbsp;<span class="ident" id="5523162">bytes</span><span class="op" id="5523167">.</span><span class="ident" id="5523168">HasPrefix</span><span class="op" id="5523177">(</span><span class="ident" id="5523178">i</span><span class="op" id="5523179">.</span><span class="ident" id="5523180">str</span><span class="op" id="5523183">,</span>&nbsp;<span class="ident" id="5523185">re</span><span class="op" id="5523187">.</span><span class="ident" id="5523188">prefixBytes</span><span class="op" id="5523199">)</span><br>
<span class="lineno"></span><span class="op" id="5523201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523204">func</span>&nbsp;<span class="op" id="5523209">(</span><span class="ident" id="5523210">i</span>&nbsp;<span class="op" id="5523212">*</span><span class="ident" id="5523213">inputBytes</span><span class="op" id="5523223">)</span>&nbsp;<span class="ident" id="5523225">index</span><span class="op" id="5523230">(</span><span class="ident" id="5523231">re</span>&nbsp;<span class="op" id="5523234">*</span><span class="ident" id="5523235">Regexp</span><span class="op" id="5523241">,</span>&nbsp;<span class="ident" id="5523243">pos</span>&nbsp;<span class="builtintype" id="5523247">int</span><span class="op" id="5523250">)</span>&nbsp;<span class="builtintype" id="5523252">int</span>&nbsp;<span class="op" id="5523256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523259">return</span>&nbsp;<span class="ident" id="5523266">bytes</span><span class="op" id="5523271">.</span><span class="ident" id="5523272">Index</span><span class="op" id="5523277">(</span><span class="ident" id="5523278">i</span><span class="op" id="5523279">.</span><span class="ident" id="5523280">str</span><span class="op" id="5523283">[</span><span class="ident" id="5523284">pos</span><span class="op" id="5523287">:</span><span class="op" id="5523288">]</span><span class="op" id="5523289">,</span>&nbsp;<span class="ident" id="5523291">re</span><span class="op" id="5523293">.</span><span class="ident" id="5523294">prefixBytes</span><span class="op" id="5523305">)</span><br>
<span class="lineno">335</span><span class="op" id="5523307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523310">func</span>&nbsp;<span class="op" id="5523315">(</span><span class="ident" id="5523316">i</span>&nbsp;<span class="op" id="5523318">*</span><span class="ident" id="5523319">inputBytes</span><span class="op" id="5523329">)</span>&nbsp;<span class="ident" id="5523331">context</span><span class="op" id="5523338">(</span><span class="ident" id="5523339">pos</span>&nbsp;<span class="builtintype" id="5523343">int</span><span class="op" id="5523346">)</span>&nbsp;<span class="ident" id="5523348">syntax</span><span class="op" id="5523354">.</span><span class="ident" id="5523355">EmptyOp</span>&nbsp;<span class="op" id="5523363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523366">r1</span><span class="op" id="5523368">,</span>&nbsp;<span class="ident" id="5523370">r2</span>&nbsp;<span class="op" id="5523373">:=</span>&nbsp;<span class="ident" id="5523376">endOfText</span><span class="op" id="5523385">,</span>&nbsp;<span class="ident" id="5523387">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523398">if</span>&nbsp;<span class="ident" id="5523401">pos</span>&nbsp;<span class="op" id="5523405">&gt;</span>&nbsp;<span class="num" id="5523407">0</span>&nbsp;<span class="op" id="5523409">&amp;&amp;</span>&nbsp;<span class="ident" id="5523412">pos</span>&nbsp;<span class="op" id="5523416">&lt;=</span>&nbsp;<span class="builtinfunc" id="5523419">len</span><span class="op" id="5523422">(</span><span class="ident" id="5523423">i</span><span class="op" id="5523424">.</span><span class="ident" id="5523425">str</span><span class="op" id="5523428">)</span>&nbsp;<span class="op" id="5523430">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523434">r1</span><span class="op" id="5523436">,</span>&nbsp;<span class="ident" id="5523438">_</span>&nbsp;<span class="op" id="5523440">=</span>&nbsp;<span class="ident" id="5523442">utf8</span><span class="op" id="5523446">.</span><span class="ident" id="5523447">DecodeLastRune</span><span class="op" id="5523461">(</span><span class="ident" id="5523462">i</span><span class="op" id="5523463">.</span><span class="ident" id="5523464">str</span><span class="op" id="5523467">[</span><span class="op" id="5523468">:</span><span class="ident" id="5523469">pos</span><span class="op" id="5523472">]</span><span class="op" id="5523473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523479">if</span>&nbsp;<span class="ident" id="5523482">pos</span>&nbsp;<span class="op" id="5523486">&lt;</span>&nbsp;<span class="builtinfunc" id="5523488">len</span><span class="op" id="5523491">(</span><span class="ident" id="5523492">i</span><span class="op" id="5523493">.</span><span class="ident" id="5523494">str</span><span class="op" id="5523497">)</span>&nbsp;<span class="op" id="5523499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523503">r2</span><span class="op" id="5523505">,</span>&nbsp;<span class="ident" id="5523507">_</span>&nbsp;<span class="op" id="5523509">=</span>&nbsp;<span class="ident" id="5523511">utf8</span><span class="op" id="5523515">.</span><span class="ident" id="5523516">DecodeRune</span><span class="op" id="5523526">(</span><span class="ident" id="5523527">i</span><span class="op" id="5523528">.</span><span class="ident" id="5523529">str</span><span class="op" id="5523532">[</span><span class="ident" id="5523533">pos</span><span class="op" id="5523536">:</span><span class="op" id="5523537">]</span><span class="op" id="5523538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523541">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523544">return</span>&nbsp;<span class="ident" id="5523551">syntax</span><span class="op" id="5523557">.</span><span class="ident" id="5523558">EmptyOpContext</span><span class="op" id="5523572">(</span><span class="ident" id="5523573">r1</span><span class="op" id="5523575">,</span>&nbsp;<span class="ident" id="5523577">r2</span><span class="op" id="5523579">)</span><br>
<span class="lineno"></span><span class="op" id="5523581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5523584">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5523619">type</span>&nbsp;<span class="ident" id="5523624">inputReader</span>&nbsp;<span class="keyword" id="5523636">struct</span>&nbsp;<span class="op" id="5523643">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523646">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523652">io</span><span class="op" id="5523654">.</span><span class="ident" id="5523655">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523667">atEOT</span>&nbsp;<span class="builtintype" id="5523673">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523679">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5523685">int</span><br>
<span class="lineno"></span><span class="op" id="5523689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5523692">func</span>&nbsp;<span class="op" id="5523697">(</span><span class="ident" id="5523698">i</span>&nbsp;<span class="op" id="5523700">*</span><span class="ident" id="5523701">inputReader</span><span class="op" id="5523712">)</span>&nbsp;<span class="ident" id="5523714">step</span><span class="op" id="5523718">(</span><span class="ident" id="5523719">pos</span>&nbsp;<span class="builtintype" id="5523723">int</span><span class="op" id="5523726">)</span>&nbsp;<span class="op" id="5523728">(</span><span class="builtintype" id="5523729">rune</span><span class="op" id="5523733">,</span>&nbsp;<span class="builtintype" id="5523735">int</span><span class="op" id="5523738">)</span>&nbsp;<span class="op" id="5523740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523743">if</span>&nbsp;<span class="op" id="5523746">!</span><span class="ident" id="5523747">i</span><span class="op" id="5523748">.</span><span class="ident" id="5523749">atEOT</span>&nbsp;<span class="op" id="5523755">&amp;&amp;</span>&nbsp;<span class="ident" id="5523758">pos</span>&nbsp;<span class="op" id="5523762">!=</span>&nbsp;<span class="ident" id="5523765">i</span><span class="op" id="5523766">.</span><span class="ident" id="5523767">pos</span>&nbsp;<span class="op" id="5523771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523775">return</span>&nbsp;<span class="ident" id="5523782">endOfText</span><span class="op" id="5523791">,</span>&nbsp;<span class="num" id="5523793">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523797">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523800">r</span><span class="op" id="5523801">,</span>&nbsp;<span class="ident" id="5523803">w</span><span class="op" id="5523804">,</span>&nbsp;<span class="ident" id="5523806">err</span>&nbsp;<span class="op" id="5523810">:=</span>&nbsp;<span class="ident" id="5523813">i</span><span class="op" id="5523814">.</span><span class="ident" id="5523815">r</span><span class="op" id="5523816">.</span><span class="ident" id="5523817">ReadRune</span><span class="op" id="5523825">(</span><span class="op" id="5523826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523829">if</span>&nbsp;<span class="ident" id="5523832">err</span>&nbsp;<span class="op" id="5523836">!=</span>&nbsp;<span class="ident" id="5523839">nil</span>&nbsp;<span class="op" id="5523843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523847">i</span><span class="op" id="5523848">.</span><span class="ident" id="5523849">atEOT</span>&nbsp;<span class="op" id="5523855">=</span>&nbsp;<span class="builtintype" id="5523857">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523864">return</span>&nbsp;<span class="ident" id="5523871">endOfText</span><span class="op" id="5523880">,</span>&nbsp;<span class="num" id="5523882">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523885">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523888">i</span><span class="op" id="5523889">.</span><span class="ident" id="5523890">pos</span>&nbsp;<span class="op" id="5523894">+=</span>&nbsp;<span class="ident" id="5523897">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523900">return</span>&nbsp;<span class="ident" id="5523907">r</span><span class="op" id="5523908">,</span>&nbsp;<span class="ident" id="5523910">w</span><br>
<span class="lineno"></span><span class="op" id="5523912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523915">func</span>&nbsp;<span class="op" id="5523920">(</span><span class="ident" id="5523921">i</span>&nbsp;<span class="op" id="5523923">*</span><span class="ident" id="5523924">inputReader</span><span class="op" id="5523935">)</span>&nbsp;<span class="ident" id="5523937">canCheckPrefix</span><span class="op" id="5523951">(</span><span class="op" id="5523952">)</span>&nbsp;<span class="builtintype" id="5523954">bool</span>&nbsp;<span class="op" id="5523959">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523962">return</span>&nbsp;<span class="builtintype" id="5523969">false</span><br>
<span class="lineno"></span><span class="op" id="5523975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523978">func</span>&nbsp;<span class="op" id="5523983">(</span><span class="ident" id="5523984">i</span>&nbsp;<span class="op" id="5523986">*</span><span class="ident" id="5523987">inputReader</span><span class="op" id="5523998">)</span>&nbsp;<span class="ident" id="5524000">hasPrefix</span><span class="op" id="5524009">(</span><span class="ident" id="5524010">re</span>&nbsp;<span class="op" id="5524013">*</span><span class="ident" id="5524014">Regexp</span><span class="op" id="5524020">)</span>&nbsp;<span class="builtintype" id="5524022">bool</span>&nbsp;<span class="op" id="5524027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524030">return</span>&nbsp;<span class="builtintype" id="5524037">false</span><br>
<span class="lineno">375</span><span class="op" id="5524043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5524046">func</span>&nbsp;<span class="op" id="5524051">(</span><span class="ident" id="5524052">i</span>&nbsp;<span class="op" id="5524054">*</span><span class="ident" id="5524055">inputReader</span><span class="op" id="5524066">)</span>&nbsp;<span class="ident" id="5524068">index</span><span class="op" id="5524073">(</span><span class="ident" id="5524074">re</span>&nbsp;<span class="op" id="5524077">*</span><span class="ident" id="5524078">Regexp</span><span class="op" id="5524084">,</span>&nbsp;<span class="ident" id="5524086">pos</span>&nbsp;<span class="builtintype" id="5524090">int</span><span class="op" id="5524093">)</span>&nbsp;<span class="builtintype" id="5524095">int</span>&nbsp;<span class="op" id="5524099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524102">return</span>&nbsp;<span class="op" id="5524109">-</span><span class="num" id="5524110">1</span><br>
<span class="lineno"></span><span class="op" id="5524112">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5524115">func</span>&nbsp;<span class="op" id="5524120">(</span><span class="ident" id="5524121">i</span>&nbsp;<span class="op" id="5524123">*</span><span class="ident" id="5524124">inputReader</span><span class="op" id="5524135">)</span>&nbsp;<span class="ident" id="5524137">context</span><span class="op" id="5524144">(</span><span class="ident" id="5524145">pos</span>&nbsp;<span class="builtintype" id="5524149">int</span><span class="op" id="5524152">)</span>&nbsp;<span class="ident" id="5524154">syntax</span><span class="op" id="5524160">.</span><span class="ident" id="5524161">EmptyOp</span>&nbsp;<span class="op" id="5524169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524172">return</span>&nbsp;<span class="num" id="5524179">0</span><br>
<span class="lineno"></span><span class="op" id="5524181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5524184">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5524252">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5524321">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5524380">func</span>&nbsp;<span class="op" id="5524385">(</span><span class="ident" id="5524386">re</span>&nbsp;<span class="op" id="5524389">*</span><span class="ident" id="5524390">Regexp</span><span class="op" id="5524396">)</span>&nbsp;<span class="ident" id="5524398">LiteralPrefix</span><span class="op" id="5524411">(</span><span class="op" id="5524412">)</span>&nbsp;<span class="op" id="5524414">(</span><span class="ident" id="5524415">prefix</span>&nbsp;<span class="builtintype" id="5524422">string</span><span class="op" id="5524428">,</span>&nbsp;<span class="ident" id="5524430">complete</span>&nbsp;<span class="builtintype" id="5524439">bool</span><span class="op" id="5524443">)</span>&nbsp;<span class="op" id="5524445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524448">return</span>&nbsp;<span class="ident" id="5524455">re</span><span class="op" id="5524457">.</span><span class="ident" id="5524458">prefix</span><span class="op" id="5524464">,</span>&nbsp;<span class="ident" id="5524466">re</span><span class="op" id="5524468">.</span><span class="ident" id="5524469">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="5524484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524487">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5524558">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5524573">func</span>&nbsp;<span class="op" id="5524578">(</span><span class="ident" id="5524579">re</span>&nbsp;<span class="op" id="5524582">*</span><span class="ident" id="5524583">Regexp</span><span class="op" id="5524589">)</span>&nbsp;<span class="ident" id="5524591">MatchReader</span><span class="op" id="5524602">(</span><span class="ident" id="5524603">r</span>&nbsp;<span class="ident" id="5524605">io</span><span class="op" id="5524607">.</span><span class="ident" id="5524608">RuneReader</span><span class="op" id="5524618">)</span>&nbsp;<span class="builtintype" id="5524620">bool</span>&nbsp;<span class="op" id="5524625">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524628">return</span>&nbsp;<span class="ident" id="5524635">re</span><span class="op" id="5524637">.</span><span class="ident" id="5524638">doExecute</span><span class="op" id="5524647">(</span><span class="ident" id="5524648">r</span><span class="op" id="5524649">,</span>&nbsp;<span class="ident" id="5524651">nil</span><span class="op" id="5524654">,</span>&nbsp;<span class="string" id="5524656">&#34;&#34;</span><span class="op" id="5524658">,</span>&nbsp;<span class="num" id="5524660">0</span><span class="op" id="5524661">,</span>&nbsp;<span class="num" id="5524663">0</span><span class="op" id="5524664">)</span>&nbsp;<span class="op" id="5524666">!=</span>&nbsp;<span class="ident" id="5524669">nil</span><br>
<span class="lineno"></span><span class="op" id="5524673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524676">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5524740">func</span>&nbsp;<span class="op" id="5524745">(</span><span class="ident" id="5524746">re</span>&nbsp;<span class="op" id="5524749">*</span><span class="ident" id="5524750">Regexp</span><span class="op" id="5524756">)</span>&nbsp;<span class="ident" id="5524758">MatchString</span><span class="op" id="5524769">(</span><span class="ident" id="5524770">s</span>&nbsp;<span class="builtintype" id="5524772">string</span><span class="op" id="5524778">)</span>&nbsp;<span class="builtintype" id="5524780">bool</span>&nbsp;<span class="op" id="5524785">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524788">return</span>&nbsp;<span class="ident" id="5524795">re</span><span class="op" id="5524797">.</span><span class="ident" id="5524798">doExecute</span><span class="op" id="5524807">(</span><span class="ident" id="5524808">nil</span><span class="op" id="5524811">,</span>&nbsp;<span class="ident" id="5524813">nil</span><span class="op" id="5524816">,</span>&nbsp;<span class="ident" id="5524818">s</span><span class="op" id="5524819">,</span>&nbsp;<span class="num" id="5524821">0</span><span class="op" id="5524822">,</span>&nbsp;<span class="num" id="5524824">0</span><span class="op" id="5524825">)</span>&nbsp;<span class="op" id="5524827">!=</span>&nbsp;<span class="ident" id="5524830">nil</span><br>
<span class="lineno"></span><span class="op" id="5524834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524837">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5524899">func</span>&nbsp;<span class="op" id="5524904">(</span><span class="ident" id="5524905">re</span>&nbsp;<span class="op" id="5524908">*</span><span class="ident" id="5524909">Regexp</span><span class="op" id="5524915">)</span>&nbsp;<span class="ident" id="5524917">Match</span><span class="op" id="5524922">(</span><span class="ident" id="5524923">b</span>&nbsp;<span class="op" id="5524925">[</span><span class="op" id="5524926">]</span><span class="builtintype" id="5524927">byte</span><span class="op" id="5524931">)</span>&nbsp;<span class="builtintype" id="5524933">bool</span>&nbsp;<span class="op" id="5524938">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524941">return</span>&nbsp;<span class="ident" id="5524948">re</span><span class="op" id="5524950">.</span><span class="ident" id="5524951">doExecute</span><span class="op" id="5524960">(</span><span class="ident" id="5524961">nil</span><span class="op" id="5524964">,</span>&nbsp;<span class="ident" id="5524966">b</span><span class="op" id="5524967">,</span>&nbsp;<span class="string" id="5524969">&#34;&#34;</span><span class="op" id="5524971">,</span>&nbsp;<span class="num" id="5524973">0</span><span class="op" id="5524974">,</span>&nbsp;<span class="num" id="5524976">0</span><span class="op" id="5524977">)</span>&nbsp;<span class="op" id="5524979">!=</span>&nbsp;<span class="ident" id="5524982">nil</span><br>
<span class="lineno"></span><span class="op" id="5524986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524989">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="5525065">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="5525142">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5525172">func</span>&nbsp;<span class="ident" id="5525177">MatchReader</span><span class="op" id="5525188">(</span><span class="ident" id="5525189">pattern</span>&nbsp;<span class="builtintype" id="5525197">string</span><span class="op" id="5525203">,</span>&nbsp;<span class="ident" id="5525205">r</span>&nbsp;<span class="ident" id="5525207">io</span><span class="op" id="5525209">.</span><span class="ident" id="5525210">RuneReader</span><span class="op" id="5525220">)</span>&nbsp;<span class="op" id="5525222">(</span><span class="ident" id="5525223">matched</span>&nbsp;<span class="builtintype" id="5525231">bool</span><span class="op" id="5525235">,</span>&nbsp;<span class="ident" id="5525237">err</span>&nbsp;<span class="builtintype" id="5525241">error</span><span class="op" id="5525246">)</span>&nbsp;<span class="op" id="5525248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525251">re</span><span class="op" id="5525253">,</span>&nbsp;<span class="ident" id="5525255">err</span>&nbsp;<span class="op" id="5525259">:=</span>&nbsp;<span class="ident" id="5525262">Compile</span><span class="op" id="5525269">(</span><span class="ident" id="5525270">pattern</span><span class="op" id="5525277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525280">if</span>&nbsp;<span class="ident" id="5525283">err</span>&nbsp;<span class="op" id="5525287">!=</span>&nbsp;<span class="ident" id="5525290">nil</span>&nbsp;<span class="op" id="5525294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525298">return</span>&nbsp;<span class="builtintype" id="5525305">false</span><span class="op" id="5525310">,</span>&nbsp;<span class="ident" id="5525312">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525320">return</span>&nbsp;<span class="ident" id="5525327">re</span><span class="op" id="5525329">.</span><span class="ident" id="5525330">MatchReader</span><span class="op" id="5525341">(</span><span class="ident" id="5525342">r</span><span class="op" id="5525343">)</span><span class="op" id="5525344">,</span>&nbsp;<span class="ident" id="5525346">nil</span><br>
<span class="lineno"></span><span class="op" id="5525350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5525353">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="5525412">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5525464">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5525513">func</span>&nbsp;<span class="ident" id="5525518">MatchString</span><span class="op" id="5525529">(</span><span class="ident" id="5525530">pattern</span>&nbsp;<span class="builtintype" id="5525538">string</span><span class="op" id="5525544">,</span>&nbsp;<span class="ident" id="5525546">s</span>&nbsp;<span class="builtintype" id="5525548">string</span><span class="op" id="5525554">)</span>&nbsp;<span class="op" id="5525556">(</span><span class="ident" id="5525557">matched</span>&nbsp;<span class="builtintype" id="5525565">bool</span><span class="op" id="5525569">,</span>&nbsp;<span class="ident" id="5525571">err</span>&nbsp;<span class="builtintype" id="5525575">error</span><span class="op" id="5525580">)</span>&nbsp;<span class="op" id="5525582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525585">re</span><span class="op" id="5525587">,</span>&nbsp;<span class="ident" id="5525589">err</span>&nbsp;<span class="op" id="5525593">:=</span>&nbsp;<span class="ident" id="5525596">Compile</span><span class="op" id="5525603">(</span><span class="ident" id="5525604">pattern</span><span class="op" id="5525611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525614">if</span>&nbsp;<span class="ident" id="5525617">err</span>&nbsp;<span class="op" id="5525621">!=</span>&nbsp;<span class="ident" id="5525624">nil</span>&nbsp;<span class="op" id="5525628">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525632">return</span>&nbsp;<span class="builtintype" id="5525639">false</span><span class="op" id="5525644">,</span>&nbsp;<span class="ident" id="5525646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525654">return</span>&nbsp;<span class="ident" id="5525661">re</span><span class="op" id="5525663">.</span><span class="ident" id="5525664">MatchString</span><span class="op" id="5525675">(</span><span class="ident" id="5525676">s</span><span class="op" id="5525677">)</span><span class="op" id="5525678">,</span>&nbsp;<span class="ident" id="5525680">nil</span><br>
<span class="lineno"></span><span class="op" id="5525684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="5525687">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5525740">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5525796">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5525845">func</span>&nbsp;<span class="ident" id="5525850">Match</span><span class="op" id="5525855">(</span><span class="ident" id="5525856">pattern</span>&nbsp;<span class="builtintype" id="5525864">string</span><span class="op" id="5525870">,</span>&nbsp;<span class="ident" id="5525872">b</span>&nbsp;<span class="op" id="5525874">[</span><span class="op" id="5525875">]</span><span class="builtintype" id="5525876">byte</span><span class="op" id="5525880">)</span>&nbsp;<span class="op" id="5525882">(</span><span class="ident" id="5525883">matched</span>&nbsp;<span class="builtintype" id="5525891">bool</span><span class="op" id="5525895">,</span>&nbsp;<span class="ident" id="5525897">err</span>&nbsp;<span class="builtintype" id="5525901">error</span><span class="op" id="5525906">)</span>&nbsp;<span class="op" id="5525908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525911">re</span><span class="op" id="5525913">,</span>&nbsp;<span class="ident" id="5525915">err</span>&nbsp;<span class="op" id="5525919">:=</span>&nbsp;<span class="ident" id="5525922">Compile</span><span class="op" id="5525929">(</span><span class="ident" id="5525930">pattern</span><span class="op" id="5525937">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525940">if</span>&nbsp;<span class="ident" id="5525943">err</span>&nbsp;<span class="op" id="5525947">!=</span>&nbsp;<span class="ident" id="5525950">nil</span>&nbsp;<span class="op" id="5525954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525958">return</span>&nbsp;<span class="builtintype" id="5525965">false</span><span class="op" id="5525970">,</span>&nbsp;<span class="ident" id="5525972">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525980">return</span>&nbsp;<span class="ident" id="5525987">re</span><span class="op" id="5525989">.</span><span class="ident" id="5525990">Match</span><span class="op" id="5525995">(</span><span class="ident" id="5525996">b</span><span class="op" id="5525997">)</span><span class="op" id="5525998">,</span>&nbsp;<span class="ident" id="5526000">nil</span><br>
<span class="lineno"></span><span class="op" id="5526004">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="5526007">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5526082">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5526160">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5526236">func</span>&nbsp;<span class="op" id="5526241">(</span><span class="ident" id="5526242">re</span>&nbsp;<span class="op" id="5526245">*</span><span class="ident" id="5526246">Regexp</span><span class="op" id="5526252">)</span>&nbsp;<span class="ident" id="5526254">ReplaceAllString</span><span class="op" id="5526270">(</span><span class="ident" id="5526271">src</span><span class="op" id="5526274">,</span>&nbsp;<span class="ident" id="5526276">repl</span>&nbsp;<span class="builtintype" id="5526281">string</span><span class="op" id="5526287">)</span>&nbsp;<span class="builtintype" id="5526289">string</span>&nbsp;<span class="op" id="5526296">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526299">n</span>&nbsp;<span class="op" id="5526301">:=</span>&nbsp;<span class="num" id="5526304">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526307">if</span>&nbsp;<span class="ident" id="5526310">strings</span><span class="op" id="5526317">.</span><span class="ident" id="5526318">Index</span><span class="op" id="5526323">(</span><span class="ident" id="5526324">repl</span><span class="op" id="5526328">,</span>&nbsp;<span class="string" id="5526330">&#34;$&#34;</span><span class="op" id="5526333">)</span>&nbsp;<span class="op" id="5526335">&gt;=</span>&nbsp;<span class="num" id="5526338">0</span>&nbsp;<span class="op" id="5526340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526344">n</span>&nbsp;<span class="op" id="5526346">=</span>&nbsp;<span class="num" id="5526348">2</span>&nbsp;<span class="op" id="5526350">*</span>&nbsp;<span class="op" id="5526352">(</span><span class="ident" id="5526353">re</span><span class="op" id="5526355">.</span><span class="ident" id="5526356">numSubexp</span>&nbsp;<span class="op" id="5526366">+</span>&nbsp;<span class="num" id="5526368">1</span><span class="op" id="5526369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526375">b</span>&nbsp;<span class="op" id="5526377">:=</span>&nbsp;<span class="ident" id="5526380">re</span><span class="op" id="5526382">.</span><span class="ident" id="5526383">replaceAll</span><span class="op" id="5526393">(</span><span class="ident" id="5526394">nil</span><span class="op" id="5526397">,</span>&nbsp;<span class="ident" id="5526399">src</span><span class="op" id="5526402">,</span>&nbsp;<span class="ident" id="5526404">n</span><span class="op" id="5526405">,</span>&nbsp;<span class="keyword" id="5526407">func</span><span class="op" id="5526411">(</span><span class="ident" id="5526412">dst</span>&nbsp;<span class="op" id="5526416">[</span><span class="op" id="5526417">]</span><span class="builtintype" id="5526418">byte</span><span class="op" id="5526422">,</span>&nbsp;<span class="ident" id="5526424">match</span>&nbsp;<span class="op" id="5526430">[</span><span class="op" id="5526431">]</span><span class="builtintype" id="5526432">int</span><span class="op" id="5526435">)</span>&nbsp;<span class="op" id="5526437">[</span><span class="op" id="5526438">]</span><span class="builtintype" id="5526439">byte</span>&nbsp;<span class="op" id="5526444">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526448">return</span>&nbsp;<span class="ident" id="5526455">re</span><span class="op" id="5526457">.</span><span class="ident" id="5526458">expand</span><span class="op" id="5526464">(</span><span class="ident" id="5526465">dst</span><span class="op" id="5526468">,</span>&nbsp;<span class="ident" id="5526470">repl</span><span class="op" id="5526474">,</span>&nbsp;<span class="ident" id="5526476">nil</span><span class="op" id="5526479">,</span>&nbsp;<span class="ident" id="5526481">src</span><span class="op" id="5526484">,</span>&nbsp;<span class="ident" id="5526486">match</span><span class="op" id="5526491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526494">}</span><span class="op" id="5526495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526498">return</span>&nbsp;<span class="builtintype" id="5526505">string</span><span class="op" id="5526511">(</span><span class="ident" id="5526512">b</span><span class="op" id="5526513">)</span><br>
<span class="lineno"></span><span class="op" id="5526515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="5526518">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5526600">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="5526684">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5526709">func</span>&nbsp;<span class="op" id="5526714">(</span><span class="ident" id="5526715">re</span>&nbsp;<span class="op" id="5526718">*</span><span class="ident" id="5526719">Regexp</span><span class="op" id="5526725">)</span>&nbsp;<span class="ident" id="5526727">ReplaceAllLiteralString</span><span class="op" id="5526750">(</span><span class="ident" id="5526751">src</span><span class="op" id="5526754">,</span>&nbsp;<span class="ident" id="5526756">repl</span>&nbsp;<span class="builtintype" id="5526761">string</span><span class="op" id="5526767">)</span>&nbsp;<span class="builtintype" id="5526769">string</span>&nbsp;<span class="op" id="5526776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526779">return</span>&nbsp;<span class="builtintype" id="5526786">string</span><span class="op" id="5526792">(</span><span class="ident" id="5526793">re</span><span class="op" id="5526795">.</span><span class="ident" id="5526796">replaceAll</span><span class="op" id="5526806">(</span><span class="ident" id="5526807">nil</span><span class="op" id="5526810">,</span>&nbsp;<span class="ident" id="5526812">src</span><span class="op" id="5526815">,</span>&nbsp;<span class="num" id="5526817">2</span><span class="op" id="5526818">,</span>&nbsp;<span class="keyword" id="5526820">func</span><span class="op" id="5526824">(</span><span class="ident" id="5526825">dst</span>&nbsp;<span class="op" id="5526829">[</span><span class="op" id="5526830">]</span><span class="builtintype" id="5526831">byte</span><span class="op" id="5526835">,</span>&nbsp;<span class="ident" id="5526837">match</span>&nbsp;<span class="op" id="5526843">[</span><span class="op" id="5526844">]</span><span class="builtintype" id="5526845">int</span><span class="op" id="5526848">)</span>&nbsp;<span class="op" id="5526850">[</span><span class="op" id="5526851">]</span><span class="builtintype" id="5526852">byte</span>&nbsp;<span class="op" id="5526857">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526861">return</span>&nbsp;<span class="builtinfunc" id="5526868">append</span><span class="op" id="5526874">(</span><span class="ident" id="5526875">dst</span><span class="op" id="5526878">,</span>&nbsp;<span class="ident" id="5526880">repl</span><span class="op" id="5526884">...</span><span class="op" id="5526887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526890">}</span><span class="op" id="5526891">)</span><span class="op" id="5526892">)</span><br>
<span class="lineno"></span><span class="op" id="5526894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5526897">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="5526971">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5527045">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="5527123">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5527158">func</span>&nbsp;<span class="op" id="5527163">(</span><span class="ident" id="5527164">re</span>&nbsp;<span class="op" id="5527167">*</span><span class="ident" id="5527168">Regexp</span><span class="op" id="5527174">)</span>&nbsp;<span class="ident" id="5527176">ReplaceAllStringFunc</span><span class="op" id="5527196">(</span><span class="ident" id="5527197">src</span>&nbsp;<span class="builtintype" id="5527201">string</span><span class="op" id="5527207">,</span>&nbsp;<span class="ident" id="5527209">repl</span>&nbsp;<span class="keyword" id="5527214">func</span><span class="op" id="5527218">(</span><span class="builtintype" id="5527219">string</span><span class="op" id="5527225">)</span>&nbsp;<span class="builtintype" id="5527227">string</span><span class="op" id="5527233">)</span>&nbsp;<span class="builtintype" id="5527235">string</span>&nbsp;<span class="op" id="5527242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527245">b</span>&nbsp;<span class="op" id="5527247">:=</span>&nbsp;<span class="ident" id="5527250">re</span><span class="op" id="5527252">.</span><span class="ident" id="5527253">replaceAll</span><span class="op" id="5527263">(</span><span class="ident" id="5527264">nil</span><span class="op" id="5527267">,</span>&nbsp;<span class="ident" id="5527269">src</span><span class="op" id="5527272">,</span>&nbsp;<span class="num" id="5527274">2</span><span class="op" id="5527275">,</span>&nbsp;<span class="keyword" id="5527277">func</span><span class="op" id="5527281">(</span><span class="ident" id="5527282">dst</span>&nbsp;<span class="op" id="5527286">[</span><span class="op" id="5527287">]</span><span class="builtintype" id="5527288">byte</span><span class="op" id="5527292">,</span>&nbsp;<span class="ident" id="5527294">match</span>&nbsp;<span class="op" id="5527300">[</span><span class="op" id="5527301">]</span><span class="builtintype" id="5527302">int</span><span class="op" id="5527305">)</span>&nbsp;<span class="op" id="5527307">[</span><span class="op" id="5527308">]</span><span class="builtintype" id="5527309">byte</span>&nbsp;<span class="op" id="5527314">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527318">return</span>&nbsp;<span class="builtinfunc" id="5527325">append</span><span class="op" id="5527331">(</span><span class="ident" id="5527332">dst</span><span class="op" id="5527335">,</span>&nbsp;<span class="ident" id="5527337">repl</span><span class="op" id="5527341">(</span><span class="ident" id="5527342">src</span><span class="op" id="5527345">[</span><span class="ident" id="5527346">match</span><span class="op" id="5527351">[</span><span class="num" id="5527352">0</span><span class="op" id="5527353">]</span><span class="op" id="5527354">:</span><span class="ident" id="5527355">match</span><span class="op" id="5527360">[</span><span class="num" id="5527361">1</span><span class="op" id="5527362">]</span><span class="op" id="5527363">]</span><span class="op" id="5527364">)</span><span class="op" id="5527365">...</span><span class="op" id="5527368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527371">}</span><span class="op" id="5527372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527375">return</span>&nbsp;<span class="builtintype" id="5527382">string</span><span class="op" id="5527388">(</span><span class="ident" id="5527389">b</span><span class="op" id="5527390">)</span><br>
<span class="lineno"></span><span class="op" id="5527392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="5527395">func</span>&nbsp;<span class="op" id="5527400">(</span><span class="ident" id="5527401">re</span>&nbsp;<span class="op" id="5527404">*</span><span class="ident" id="5527405">Regexp</span><span class="op" id="5527411">)</span>&nbsp;<span class="ident" id="5527413">replaceAll</span><span class="op" id="5527423">(</span><span class="ident" id="5527424">bsrc</span>&nbsp;<span class="op" id="5527429">[</span><span class="op" id="5527430">]</span><span class="builtintype" id="5527431">byte</span><span class="op" id="5527435">,</span>&nbsp;<span class="ident" id="5527437">src</span>&nbsp;<span class="builtintype" id="5527441">string</span><span class="op" id="5527447">,</span>&nbsp;<span class="ident" id="5527449">nmatch</span>&nbsp;<span class="builtintype" id="5527456">int</span><span class="op" id="5527459">,</span>&nbsp;<span class="ident" id="5527461">repl</span>&nbsp;<span class="keyword" id="5527466">func</span><span class="op" id="5527470">(</span><span class="ident" id="5527471">dst</span>&nbsp;<span class="op" id="5527475">[</span><span class="op" id="5527476">]</span><span class="builtintype" id="5527477">byte</span><span class="op" id="5527481">,</span>&nbsp;<span class="ident" id="5527483">m</span>&nbsp;<span class="op" id="5527485">[</span><span class="op" id="5527486">]</span><span class="builtintype" id="5527487">int</span><span class="op" id="5527490">)</span>&nbsp;<span class="op" id="5527492">[</span><span class="op" id="5527493">]</span><span class="builtintype" id="5527494">byte</span><span class="op" id="5527498">)</span>&nbsp;<span class="op" id="5527500">[</span><span class="op" id="5527501">]</span><span class="builtintype" id="5527502">byte</span>&nbsp;<span class="op" id="5527507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527510">lastMatchEnd</span>&nbsp;<span class="op" id="5527523">:=</span>&nbsp;<span class="num" id="5527526">0</span>&nbsp;<span class="comment" id="5527528">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527570">searchPos</span>&nbsp;<span class="op" id="5527580">:=</span>&nbsp;<span class="num" id="5527583">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5527588">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527632">var</span>&nbsp;<span class="ident" id="5527636">buf</span>&nbsp;<span class="op" id="5527640">[</span><span class="op" id="5527641">]</span><span class="builtintype" id="5527642">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527648">var</span>&nbsp;<span class="ident" id="5527652">endPos</span>&nbsp;<span class="builtintype" id="5527659">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527664">if</span>&nbsp;<span class="ident" id="5527667">bsrc</span>&nbsp;<span class="op" id="5527672">!=</span>&nbsp;<span class="ident" id="5527675">nil</span>&nbsp;<span class="op" id="5527679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527683">endPos</span>&nbsp;<span class="op" id="5527690">=</span>&nbsp;<span class="builtinfunc" id="5527692">len</span><span class="op" id="5527695">(</span><span class="ident" id="5527696">bsrc</span><span class="op" id="5527700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527703">}</span>&nbsp;<span class="keyword" id="5527705">else</span>&nbsp;<span class="op" id="5527710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527714">endPos</span>&nbsp;<span class="op" id="5527721">=</span>&nbsp;<span class="builtinfunc" id="5527723">len</span><span class="op" id="5527726">(</span><span class="ident" id="5527727">src</span><span class="op" id="5527730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527733">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527736">for</span>&nbsp;<span class="ident" id="5527740">searchPos</span>&nbsp;<span class="op" id="5527750">&lt;=</span>&nbsp;<span class="ident" id="5527753">endPos</span>&nbsp;<span class="op" id="5527760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527764">a</span>&nbsp;<span class="op" id="5527766">:=</span>&nbsp;<span class="ident" id="5527769">re</span><span class="op" id="5527771">.</span><span class="ident" id="5527772">doExecute</span><span class="op" id="5527781">(</span><span class="ident" id="5527782">nil</span><span class="op" id="5527785">,</span>&nbsp;<span class="ident" id="5527787">bsrc</span><span class="op" id="5527791">,</span>&nbsp;<span class="ident" id="5527793">src</span><span class="op" id="5527796">,</span>&nbsp;<span class="ident" id="5527798">searchPos</span><span class="op" id="5527807">,</span>&nbsp;<span class="ident" id="5527809">nmatch</span><span class="op" id="5527815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527819">if</span>&nbsp;<span class="builtinfunc" id="5527822">len</span><span class="op" id="5527825">(</span><span class="ident" id="5527826">a</span><span class="op" id="5527827">)</span>&nbsp;<span class="op" id="5527829">==</span>&nbsp;<span class="num" id="5527832">0</span>&nbsp;<span class="op" id="5527834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527839">break</span>&nbsp;<span class="comment" id="5527845">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527866">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527871">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527925">if</span>&nbsp;<span class="ident" id="5527928">bsrc</span>&nbsp;<span class="op" id="5527933">!=</span>&nbsp;<span class="ident" id="5527936">nil</span>&nbsp;<span class="op" id="5527940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527945">buf</span>&nbsp;<span class="op" id="5527949">=</span>&nbsp;<span class="builtinfunc" id="5527951">append</span><span class="op" id="5527957">(</span><span class="ident" id="5527958">buf</span><span class="op" id="5527961">,</span>&nbsp;<span class="ident" id="5527963">bsrc</span><span class="op" id="5527967">[</span><span class="ident" id="5527968">lastMatchEnd</span><span class="op" id="5527980">:</span><span class="ident" id="5527981">a</span><span class="op" id="5527982">[</span><span class="num" id="5527983">0</span><span class="op" id="5527984">]</span><span class="op" id="5527985">]</span><span class="op" id="5527986">...</span><span class="op" id="5527989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527993">}</span>&nbsp;<span class="keyword" id="5527995">else</span>&nbsp;<span class="op" id="5528000">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528005">buf</span>&nbsp;<span class="op" id="5528009">=</span>&nbsp;<span class="builtinfunc" id="5528011">append</span><span class="op" id="5528017">(</span><span class="ident" id="5528018">buf</span><span class="op" id="5528021">,</span>&nbsp;<span class="ident" id="5528023">src</span><span class="op" id="5528026">[</span><span class="ident" id="5528027">lastMatchEnd</span><span class="op" id="5528039">:</span><span class="ident" id="5528040">a</span><span class="op" id="5528041">[</span><span class="num" id="5528042">0</span><span class="op" id="5528043">]</span><span class="op" id="5528044">]</span><span class="op" id="5528045">...</span><span class="op" id="5528048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528057">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528121">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528185">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528246">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528291">if</span>&nbsp;<span class="ident" id="5528294">a</span><span class="op" id="5528295">[</span><span class="num" id="5528296">1</span><span class="op" id="5528297">]</span>&nbsp;<span class="op" id="5528299">&gt;</span>&nbsp;<span class="ident" id="5528301">lastMatchEnd</span>&nbsp;<span class="op" id="5528314">||</span>&nbsp;<span class="ident" id="5528317">a</span><span class="op" id="5528318">[</span><span class="num" id="5528319">0</span><span class="op" id="5528320">]</span>&nbsp;<span class="op" id="5528322">==</span>&nbsp;<span class="num" id="5528325">0</span>&nbsp;<span class="op" id="5528327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528332">buf</span>&nbsp;<span class="op" id="5528336">=</span>&nbsp;<span class="ident" id="5528338">repl</span><span class="op" id="5528342">(</span><span class="ident" id="5528343">buf</span><span class="op" id="5528346">,</span>&nbsp;<span class="ident" id="5528348">a</span><span class="op" id="5528349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528353">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528357">lastMatchEnd</span>&nbsp;<span class="op" id="5528370">=</span>&nbsp;<span class="ident" id="5528372">a</span><span class="op" id="5528373">[</span><span class="num" id="5528374">1</span><span class="op" id="5528375">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528380">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528449">var</span>&nbsp;<span class="ident" id="5528453">width</span>&nbsp;<span class="builtintype" id="5528459">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528465">if</span>&nbsp;<span class="ident" id="5528468">bsrc</span>&nbsp;<span class="op" id="5528473">!=</span>&nbsp;<span class="ident" id="5528476">nil</span>&nbsp;<span class="op" id="5528480">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528485">_</span><span class="op" id="5528486">,</span>&nbsp;<span class="ident" id="5528488">width</span>&nbsp;<span class="op" id="5528494">=</span>&nbsp;<span class="ident" id="5528496">utf8</span><span class="op" id="5528500">.</span><span class="ident" id="5528501">DecodeRune</span><span class="op" id="5528511">(</span><span class="ident" id="5528512">bsrc</span><span class="op" id="5528516">[</span><span class="ident" id="5528517">searchPos</span><span class="op" id="5528526">:</span><span class="op" id="5528527">]</span><span class="op" id="5528528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528532">}</span>&nbsp;<span class="keyword" id="5528534">else</span>&nbsp;<span class="op" id="5528539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528544">_</span><span class="op" id="5528545">,</span>&nbsp;<span class="ident" id="5528547">width</span>&nbsp;<span class="op" id="5528553">=</span>&nbsp;<span class="ident" id="5528555">utf8</span><span class="op" id="5528559">.</span><span class="ident" id="5528560">DecodeRuneInString</span><span class="op" id="5528578">(</span><span class="ident" id="5528579">src</span><span class="op" id="5528582">[</span><span class="ident" id="5528583">searchPos</span><span class="op" id="5528592">:</span><span class="op" id="5528593">]</span><span class="op" id="5528594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528602">if</span>&nbsp;<span class="ident" id="5528605">searchPos</span><span class="op" id="5528614">+</span><span class="ident" id="5528615">width</span>&nbsp;<span class="op" id="5528621">&gt;</span>&nbsp;<span class="ident" id="5528623">a</span><span class="op" id="5528624">[</span><span class="num" id="5528625">1</span><span class="op" id="5528626">]</span>&nbsp;<span class="op" id="5528628">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528633">searchPos</span>&nbsp;<span class="op" id="5528643">+=</span>&nbsp;<span class="ident" id="5528646">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528654">}</span>&nbsp;<span class="keyword" id="5528656">else</span>&nbsp;<span class="keyword" id="5528661">if</span>&nbsp;<span class="ident" id="5528664">searchPos</span><span class="op" id="5528673">+</span><span class="num" id="5528674">1</span>&nbsp;<span class="op" id="5528676">&gt;</span>&nbsp;<span class="ident" id="5528678">a</span><span class="op" id="5528679">[</span><span class="num" id="5528680">1</span><span class="op" id="5528681">]</span>&nbsp;<span class="op" id="5528683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528688">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528745">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528810">searchPos</span><span class="op" id="5528819">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528824">}</span>&nbsp;<span class="keyword" id="5528826">else</span>&nbsp;<span class="op" id="5528831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528836">searchPos</span>&nbsp;<span class="op" id="5528846">=</span>&nbsp;<span class="ident" id="5528848">a</span><span class="op" id="5528849">[</span><span class="num" id="5528850">1</span><span class="op" id="5528851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528862">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528918">if</span>&nbsp;<span class="ident" id="5528921">bsrc</span>&nbsp;<span class="op" id="5528926">!=</span>&nbsp;<span class="ident" id="5528929">nil</span>&nbsp;<span class="op" id="5528933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528937">buf</span>&nbsp;<span class="op" id="5528941">=</span>&nbsp;<span class="builtinfunc" id="5528943">append</span><span class="op" id="5528949">(</span><span class="ident" id="5528950">buf</span><span class="op" id="5528953">,</span>&nbsp;<span class="ident" id="5528955">bsrc</span><span class="op" id="5528959">[</span><span class="ident" id="5528960">lastMatchEnd</span><span class="op" id="5528972">:</span><span class="op" id="5528973">]</span><span class="op" id="5528974">...</span><span class="op" id="5528977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528980">}</span>&nbsp;<span class="keyword" id="5528982">else</span>&nbsp;<span class="op" id="5528987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528991">buf</span>&nbsp;<span class="op" id="5528995">=</span>&nbsp;<span class="builtinfunc" id="5528997">append</span><span class="op" id="5529003">(</span><span class="ident" id="5529004">buf</span><span class="op" id="5529007">,</span>&nbsp;<span class="ident" id="5529009">src</span><span class="op" id="5529012">[</span><span class="ident" id="5529013">lastMatchEnd</span><span class="op" id="5529025">:</span><span class="op" id="5529026">]</span><span class="op" id="5529027">...</span><span class="op" id="5529030">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529037">return</span>&nbsp;<span class="ident" id="5529044">buf</span><br>
<span class="lineno"></span><span class="op" id="5529048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="5529051">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5529120">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5529196">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5529272">func</span>&nbsp;<span class="op" id="5529277">(</span><span class="ident" id="5529278">re</span>&nbsp;<span class="op" id="5529281">*</span><span class="ident" id="5529282">Regexp</span><span class="op" id="5529288">)</span>&nbsp;<span class="ident" id="5529290">ReplaceAll</span><span class="op" id="5529300">(</span><span class="ident" id="5529301">src</span><span class="op" id="5529304">,</span>&nbsp;<span class="ident" id="5529306">repl</span>&nbsp;<span class="op" id="5529311">[</span><span class="op" id="5529312">]</span><span class="builtintype" id="5529313">byte</span><span class="op" id="5529317">)</span>&nbsp;<span class="op" id="5529319">[</span><span class="op" id="5529320">]</span><span class="builtintype" id="5529321">byte</span>&nbsp;<span class="op" id="5529326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529329">n</span>&nbsp;<span class="op" id="5529331">:=</span>&nbsp;<span class="num" id="5529334">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529337">if</span>&nbsp;<span class="ident" id="5529340">bytes</span><span class="op" id="5529345">.</span><span class="ident" id="5529346">IndexByte</span><span class="op" id="5529355">(</span><span class="ident" id="5529356">repl</span><span class="op" id="5529360">,</span>&nbsp;<span class="string" id="5529362">&#39;$&#39;</span><span class="op" id="5529365">)</span>&nbsp;<span class="op" id="5529367">&gt;=</span>&nbsp;<span class="num" id="5529370">0</span>&nbsp;<span class="op" id="5529372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529376">n</span>&nbsp;<span class="op" id="5529378">=</span>&nbsp;<span class="num" id="5529380">2</span>&nbsp;<span class="op" id="5529382">*</span>&nbsp;<span class="op" id="5529384">(</span><span class="ident" id="5529385">re</span><span class="op" id="5529387">.</span><span class="ident" id="5529388">numSubexp</span>&nbsp;<span class="op" id="5529398">+</span>&nbsp;<span class="num" id="5529400">1</span><span class="op" id="5529401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529407">srepl</span>&nbsp;<span class="op" id="5529413">:=</span>&nbsp;<span class="string" id="5529416">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529420">b</span>&nbsp;<span class="op" id="5529422">:=</span>&nbsp;<span class="ident" id="5529425">re</span><span class="op" id="5529427">.</span><span class="ident" id="5529428">replaceAll</span><span class="op" id="5529438">(</span><span class="ident" id="5529439">src</span><span class="op" id="5529442">,</span>&nbsp;<span class="string" id="5529444">&#34;&#34;</span><span class="op" id="5529446">,</span>&nbsp;<span class="ident" id="5529448">n</span><span class="op" id="5529449">,</span>&nbsp;<span class="keyword" id="5529451">func</span><span class="op" id="5529455">(</span><span class="ident" id="5529456">dst</span>&nbsp;<span class="op" id="5529460">[</span><span class="op" id="5529461">]</span><span class="builtintype" id="5529462">byte</span><span class="op" id="5529466">,</span>&nbsp;<span class="ident" id="5529468">match</span>&nbsp;<span class="op" id="5529474">[</span><span class="op" id="5529475">]</span><span class="builtintype" id="5529476">int</span><span class="op" id="5529479">)</span>&nbsp;<span class="op" id="5529481">[</span><span class="op" id="5529482">]</span><span class="builtintype" id="5529483">byte</span>&nbsp;<span class="op" id="5529488">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529492">if</span>&nbsp;<span class="builtinfunc" id="5529495">len</span><span class="op" id="5529498">(</span><span class="ident" id="5529499">srepl</span><span class="op" id="5529504">)</span>&nbsp;<span class="op" id="5529506">!=</span>&nbsp;<span class="builtinfunc" id="5529509">len</span><span class="op" id="5529512">(</span><span class="ident" id="5529513">repl</span><span class="op" id="5529517">)</span>&nbsp;<span class="op" id="5529519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529524">srepl</span>&nbsp;<span class="op" id="5529530">=</span>&nbsp;<span class="builtintype" id="5529532">string</span><span class="op" id="5529538">(</span><span class="ident" id="5529539">repl</span><span class="op" id="5529543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529551">return</span>&nbsp;<span class="ident" id="5529558">re</span><span class="op" id="5529560">.</span><span class="ident" id="5529561">expand</span><span class="op" id="5529567">(</span><span class="ident" id="5529568">dst</span><span class="op" id="5529571">,</span>&nbsp;<span class="ident" id="5529573">srepl</span><span class="op" id="5529578">,</span>&nbsp;<span class="ident" id="5529580">src</span><span class="op" id="5529583">,</span>&nbsp;<span class="string" id="5529585">&#34;&#34;</span><span class="op" id="5529587">,</span>&nbsp;<span class="ident" id="5529589">match</span><span class="op" id="5529594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529597">}</span><span class="op" id="5529598">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529601">return</span>&nbsp;<span class="ident" id="5529608">b</span><br>
<span class="lineno"></span><span class="op" id="5529610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5529613">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5529689">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="5529772">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5529797">func</span>&nbsp;<span class="op" id="5529802">(</span><span class="ident" id="5529803">re</span>&nbsp;<span class="op" id="5529806">*</span><span class="ident" id="5529807">Regexp</span><span class="op" id="5529813">)</span>&nbsp;<span class="ident" id="5529815">ReplaceAllLiteral</span><span class="op" id="5529832">(</span><span class="ident" id="5529833">src</span><span class="op" id="5529836">,</span>&nbsp;<span class="ident" id="5529838">repl</span>&nbsp;<span class="op" id="5529843">[</span><span class="op" id="5529844">]</span><span class="builtintype" id="5529845">byte</span><span class="op" id="5529849">)</span>&nbsp;<span class="op" id="5529851">[</span><span class="op" id="5529852">]</span><span class="builtintype" id="5529853">byte</span>&nbsp;<span class="op" id="5529858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529861">return</span>&nbsp;<span class="ident" id="5529868">re</span><span class="op" id="5529870">.</span><span class="ident" id="5529871">replaceAll</span><span class="op" id="5529881">(</span><span class="ident" id="5529882">src</span><span class="op" id="5529885">,</span>&nbsp;<span class="string" id="5529887">&#34;&#34;</span><span class="op" id="5529889">,</span>&nbsp;<span class="num" id="5529891">2</span><span class="op" id="5529892">,</span>&nbsp;<span class="keyword" id="5529894">func</span><span class="op" id="5529898">(</span><span class="ident" id="5529899">dst</span>&nbsp;<span class="op" id="5529903">[</span><span class="op" id="5529904">]</span><span class="builtintype" id="5529905">byte</span><span class="op" id="5529909">,</span>&nbsp;<span class="ident" id="5529911">match</span>&nbsp;<span class="op" id="5529917">[</span><span class="op" id="5529918">]</span><span class="builtintype" id="5529919">int</span><span class="op" id="5529922">)</span>&nbsp;<span class="op" id="5529924">[</span><span class="op" id="5529925">]</span><span class="builtintype" id="5529926">byte</span>&nbsp;<span class="op" id="5529931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529935">return</span>&nbsp;<span class="builtinfunc" id="5529942">append</span><span class="op" id="5529948">(</span><span class="ident" id="5529949">dst</span><span class="op" id="5529952">,</span>&nbsp;<span class="ident" id="5529954">repl</span><span class="op" id="5529958">...</span><span class="op" id="5529961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529964">}</span><span class="op" id="5529965">)</span><br>
<span class="lineno">560</span><span class="op" id="5529967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5529970">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5530038">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5530112">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="5530191">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5530226">func</span>&nbsp;<span class="op" id="5530231">(</span><span class="ident" id="5530232">re</span>&nbsp;<span class="op" id="5530235">*</span><span class="ident" id="5530236">Regexp</span><span class="op" id="5530242">)</span>&nbsp;<span class="ident" id="5530244">ReplaceAllFunc</span><span class="op" id="5530258">(</span><span class="ident" id="5530259">src</span>&nbsp;<span class="op" id="5530263">[</span><span class="op" id="5530264">]</span><span class="builtintype" id="5530265">byte</span><span class="op" id="5530269">,</span>&nbsp;<span class="ident" id="5530271">repl</span>&nbsp;<span class="keyword" id="5530276">func</span><span class="op" id="5530280">(</span><span class="op" id="5530281">[</span><span class="op" id="5530282">]</span><span class="builtintype" id="5530283">byte</span><span class="op" id="5530287">)</span>&nbsp;<span class="op" id="5530289">[</span><span class="op" id="5530290">]</span><span class="builtintype" id="5530291">byte</span><span class="op" id="5530295">)</span>&nbsp;<span class="op" id="5530297">[</span><span class="op" id="5530298">]</span><span class="builtintype" id="5530299">byte</span>&nbsp;<span class="op" id="5530304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530307">return</span>&nbsp;<span class="ident" id="5530314">re</span><span class="op" id="5530316">.</span><span class="ident" id="5530317">replaceAll</span><span class="op" id="5530327">(</span><span class="ident" id="5530328">src</span><span class="op" id="5530331">,</span>&nbsp;<span class="string" id="5530333">&#34;&#34;</span><span class="op" id="5530335">,</span>&nbsp;<span class="num" id="5530337">2</span><span class="op" id="5530338">,</span>&nbsp;<span class="keyword" id="5530340">func</span><span class="op" id="5530344">(</span><span class="ident" id="5530345">dst</span>&nbsp;<span class="op" id="5530349">[</span><span class="op" id="5530350">]</span><span class="builtintype" id="5530351">byte</span><span class="op" id="5530355">,</span>&nbsp;<span class="ident" id="5530357">match</span>&nbsp;<span class="op" id="5530363">[</span><span class="op" id="5530364">]</span><span class="builtintype" id="5530365">int</span><span class="op" id="5530368">)</span>&nbsp;<span class="op" id="5530370">[</span><span class="op" id="5530371">]</span><span class="builtintype" id="5530372">byte</span>&nbsp;<span class="op" id="5530377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530381">return</span>&nbsp;<span class="builtinfunc" id="5530388">append</span><span class="op" id="5530394">(</span><span class="ident" id="5530395">dst</span><span class="op" id="5530398">,</span>&nbsp;<span class="ident" id="5530400">repl</span><span class="op" id="5530404">(</span><span class="ident" id="5530405">src</span><span class="op" id="5530408">[</span><span class="ident" id="5530409">match</span><span class="op" id="5530414">[</span><span class="num" id="5530415">0</span><span class="op" id="5530416">]</span><span class="op" id="5530417">:</span><span class="ident" id="5530418">match</span><span class="op" id="5530423">[</span><span class="num" id="5530424">1</span><span class="op" id="5530425">]</span><span class="op" id="5530426">]</span><span class="op" id="5530427">)</span><span class="op" id="5530428">...</span><span class="op" id="5530431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530434">}</span><span class="op" id="5530435">)</span><br>
<span class="lineno">570</span><span class="op" id="5530437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530440">var</span>&nbsp;<span class="ident" id="5530444">specialBytes</span>&nbsp;<span class="op" id="5530457">=</span>&nbsp;<span class="op" id="5530459">[</span><span class="op" id="5530460">]</span><span class="builtintype" id="5530461">byte</span><span class="op" id="5530465">(</span><span class="string" id="5530466">`\.+*?()|[]{}^$`</span><span class="op" id="5530482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530485">func</span>&nbsp;<span class="ident" id="5530490">special</span><span class="op" id="5530497">(</span><span class="ident" id="5530498">b</span>&nbsp;<span class="builtintype" id="5530500">byte</span><span class="op" id="5530504">)</span>&nbsp;<span class="builtintype" id="5530506">bool</span>&nbsp;<span class="op" id="5530511">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530514">return</span>&nbsp;<span class="ident" id="5530521">bytes</span><span class="op" id="5530526">.</span><span class="ident" id="5530527">IndexByte</span><span class="op" id="5530536">(</span><span class="ident" id="5530537">specialBytes</span><span class="op" id="5530549">,</span>&nbsp;<span class="ident" id="5530551">b</span><span class="op" id="5530552">)</span>&nbsp;<span class="op" id="5530554">&gt;=</span>&nbsp;<span class="num" id="5530557">0</span><br>
<span class="lineno"></span><span class="op" id="5530559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5530562">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="5530642">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="5530724">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="5530797">func</span>&nbsp;<span class="ident" id="5530802">QuoteMeta</span><span class="op" id="5530811">(</span><span class="ident" id="5530812">s</span>&nbsp;<span class="builtintype" id="5530814">string</span><span class="op" id="5530820">)</span>&nbsp;<span class="builtintype" id="5530822">string</span>&nbsp;<span class="op" id="5530829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530832">b</span>&nbsp;<span class="op" id="5530834">:=</span>&nbsp;<span class="builtinfunc" id="5530837">make</span><span class="op" id="5530841">(</span><span class="op" id="5530842">[</span><span class="op" id="5530843">]</span><span class="builtintype" id="5530844">byte</span><span class="op" id="5530848">,</span>&nbsp;<span class="num" id="5530850">2</span><span class="op" id="5530851">*</span><span class="builtinfunc" id="5530852">len</span><span class="op" id="5530855">(</span><span class="ident" id="5530856">s</span><span class="op" id="5530857">)</span><span class="op" id="5530858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530862">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530927">j</span>&nbsp;<span class="op" id="5530929">:=</span>&nbsp;<span class="num" id="5530932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530935">for</span>&nbsp;<span class="ident" id="5530939">i</span>&nbsp;<span class="op" id="5530941">:=</span>&nbsp;<span class="num" id="5530944">0</span><span class="op" id="5530945">;</span>&nbsp;<span class="ident" id="5530947">i</span>&nbsp;<span class="op" id="5530949">&lt;</span>&nbsp;<span class="builtinfunc" id="5530951">len</span><span class="op" id="5530954">(</span><span class="ident" id="5530955">s</span><span class="op" id="5530956">)</span><span class="op" id="5530957">;</span>&nbsp;<span class="ident" id="5530959">i</span><span class="op" id="5530960">++</span>&nbsp;<span class="op" id="5530963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530967">if</span>&nbsp;<span class="ident" id="5530970">special</span><span class="op" id="5530977">(</span><span class="ident" id="5530978">s</span><span class="op" id="5530979">[</span><span class="ident" id="5530980">i</span><span class="op" id="5530981">]</span><span class="op" id="5530982">)</span>&nbsp;<span class="op" id="5530984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530989">b</span><span class="op" id="5530990">[</span><span class="ident" id="5530991">j</span><span class="op" id="5530992">]</span>&nbsp;<span class="op" id="5530994">=</span>&nbsp;<span class="string" id="5530996">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531004">j</span><span class="op" id="5531005">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531014">b</span><span class="op" id="5531015">[</span><span class="ident" id="5531016">j</span><span class="op" id="5531017">]</span>&nbsp;<span class="op" id="5531019">=</span>&nbsp;<span class="ident" id="5531021">s</span><span class="op" id="5531022">[</span><span class="ident" id="5531023">i</span><span class="op" id="5531024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531028">j</span><span class="op" id="5531029">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531036">return</span>&nbsp;<span class="builtintype" id="5531043">string</span><span class="op" id="5531049">(</span><span class="ident" id="5531050">b</span><span class="op" id="5531051">[</span><span class="num" id="5531052">0</span><span class="op" id="5531053">:</span><span class="ident" id="5531054">j</span><span class="op" id="5531055">]</span><span class="op" id="5531056">)</span><br>
<span class="lineno">595</span><span class="op" id="5531058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5531061">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5531123">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="5531181">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="5531242">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5531303">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5531371">func</span>&nbsp;<span class="op" id="5531376">(</span><span class="ident" id="5531377">re</span>&nbsp;<span class="op" id="5531380">*</span><span class="ident" id="5531381">Regexp</span><span class="op" id="5531387">)</span>&nbsp;<span class="ident" id="5531389">pad</span><span class="op" id="5531392">(</span><span class="ident" id="5531393">a</span>&nbsp;<span class="op" id="5531395">[</span><span class="op" id="5531396">]</span><span class="builtintype" id="5531397">int</span><span class="op" id="5531400">)</span>&nbsp;<span class="op" id="5531402">[</span><span class="op" id="5531403">]</span><span class="builtintype" id="5531404">int</span>&nbsp;<span class="op" id="5531408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531411">if</span>&nbsp;<span class="ident" id="5531414">a</span>&nbsp;<span class="op" id="5531416">==</span>&nbsp;<span class="ident" id="5531419">nil</span>&nbsp;<span class="op" id="5531423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531427">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531442">return</span>&nbsp;<span class="ident" id="5531449">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531457">n</span>&nbsp;<span class="op" id="5531459">:=</span>&nbsp;<span class="op" id="5531462">(</span><span class="num" id="5531463">1</span>&nbsp;<span class="op" id="5531465">+</span>&nbsp;<span class="ident" id="5531467">re</span><span class="op" id="5531469">.</span><span class="ident" id="5531470">numSubexp</span><span class="op" id="5531479">)</span>&nbsp;<span class="op" id="5531481">*</span>&nbsp;<span class="num" id="5531483">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531486">for</span>&nbsp;<span class="builtinfunc" id="5531490">len</span><span class="op" id="5531493">(</span><span class="ident" id="5531494">a</span><span class="op" id="5531495">)</span>&nbsp;<span class="op" id="5531497">&lt;</span>&nbsp;<span class="ident" id="5531499">n</span>&nbsp;<span class="op" id="5531501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531505">a</span>&nbsp;<span class="op" id="5531507">=</span>&nbsp;<span class="builtinfunc" id="5531509">append</span><span class="op" id="5531515">(</span><span class="ident" id="5531516">a</span><span class="op" id="5531517">,</span>&nbsp;<span class="op" id="5531519">-</span><span class="num" id="5531520">1</span><span class="op" id="5531521">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531527">return</span>&nbsp;<span class="ident" id="5531534">a</span><br>
<span class="lineno"></span><span class="op" id="5531536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5531539">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="5531619">func</span>&nbsp;<span class="op" id="5531624">(</span><span class="ident" id="5531625">re</span>&nbsp;<span class="op" id="5531628">*</span><span class="ident" id="5531629">Regexp</span><span class="op" id="5531635">)</span>&nbsp;<span class="ident" id="5531637">allMatches</span><span class="op" id="5531647">(</span><span class="ident" id="5531648">s</span>&nbsp;<span class="builtintype" id="5531650">string</span><span class="op" id="5531656">,</span>&nbsp;<span class="ident" id="5531658">b</span>&nbsp;<span class="op" id="5531660">[</span><span class="op" id="5531661">]</span><span class="builtintype" id="5531662">byte</span><span class="op" id="5531666">,</span>&nbsp;<span class="ident" id="5531668">n</span>&nbsp;<span class="builtintype" id="5531670">int</span><span class="op" id="5531673">,</span>&nbsp;<span class="ident" id="5531675">deliver</span>&nbsp;<span class="keyword" id="5531683">func</span><span class="op" id="5531687">(</span><span class="op" id="5531688">[</span><span class="op" id="5531689">]</span><span class="builtintype" id="5531690">int</span><span class="op" id="5531693">)</span><span class="op" id="5531694">)</span>&nbsp;<span class="op" id="5531696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531699">var</span>&nbsp;<span class="ident" id="5531703">end</span>&nbsp;<span class="builtintype" id="5531707">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531712">if</span>&nbsp;<span class="ident" id="5531715">b</span>&nbsp;<span class="op" id="5531717">==</span>&nbsp;<span class="ident" id="5531720">nil</span>&nbsp;<span class="op" id="5531724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531728">end</span>&nbsp;<span class="op" id="5531732">=</span>&nbsp;<span class="builtinfunc" id="5531734">len</span><span class="op" id="5531737">(</span><span class="ident" id="5531738">s</span><span class="op" id="5531739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531742">}</span>&nbsp;<span class="keyword" id="5531744">else</span>&nbsp;<span class="op" id="5531749">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531753">end</span>&nbsp;<span class="op" id="5531757">=</span>&nbsp;<span class="builtinfunc" id="5531759">len</span><span class="op" id="5531762">(</span><span class="ident" id="5531763">b</span><span class="op" id="5531764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531771">for</span>&nbsp;<span class="ident" id="5531775">pos</span><span class="op" id="5531778">,</span>&nbsp;<span class="ident" id="5531780">i</span><span class="op" id="5531781">,</span>&nbsp;<span class="ident" id="5531783">prevMatchEnd</span>&nbsp;<span class="op" id="5531796">:=</span>&nbsp;<span class="num" id="5531799">0</span><span class="op" id="5531800">,</span>&nbsp;<span class="num" id="5531802">0</span><span class="op" id="5531803">,</span>&nbsp;<span class="op" id="5531805">-</span><span class="num" id="5531806">1</span><span class="op" id="5531807">;</span>&nbsp;<span class="ident" id="5531809">i</span>&nbsp;<span class="op" id="5531811">&lt;</span>&nbsp;<span class="ident" id="5531813">n</span>&nbsp;<span class="op" id="5531815">&amp;&amp;</span>&nbsp;<span class="ident" id="5531818">pos</span>&nbsp;<span class="op" id="5531822">&lt;=</span>&nbsp;<span class="ident" id="5531825">end</span><span class="op" id="5531828">;</span>&nbsp;<span class="op" id="5531830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531834">matches</span>&nbsp;<span class="op" id="5531842">:=</span>&nbsp;<span class="ident" id="5531845">re</span><span class="op" id="5531847">.</span><span class="ident" id="5531848">doExecute</span><span class="op" id="5531857">(</span><span class="ident" id="5531858">nil</span><span class="op" id="5531861">,</span>&nbsp;<span class="ident" id="5531863">b</span><span class="op" id="5531864">,</span>&nbsp;<span class="ident" id="5531866">s</span><span class="op" id="5531867">,</span>&nbsp;<span class="ident" id="5531869">pos</span><span class="op" id="5531872">,</span>&nbsp;<span class="ident" id="5531874">re</span><span class="op" id="5531876">.</span><span class="ident" id="5531877">prog</span><span class="op" id="5531881">.</span><span class="ident" id="5531882">NumCap</span><span class="op" id="5531888">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531892">if</span>&nbsp;<span class="builtinfunc" id="5531895">len</span><span class="op" id="5531898">(</span><span class="ident" id="5531899">matches</span><span class="op" id="5531906">)</span>&nbsp;<span class="op" id="5531908">==</span>&nbsp;<span class="num" id="5531911">0</span>&nbsp;<span class="op" id="5531913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531918">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531931">accept</span>&nbsp;<span class="op" id="5531938">:=</span>&nbsp;<span class="builtintype" id="5531941">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531948">if</span>&nbsp;<span class="ident" id="5531951">matches</span><span class="op" id="5531958">[</span><span class="num" id="5531959">1</span><span class="op" id="5531960">]</span>&nbsp;<span class="op" id="5531962">==</span>&nbsp;<span class="ident" id="5531965">pos</span>&nbsp;<span class="op" id="5531969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531974">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532008">if</span>&nbsp;<span class="ident" id="5532011">matches</span><span class="op" id="5532018">[</span><span class="num" id="5532019">0</span><span class="op" id="5532020">]</span>&nbsp;<span class="op" id="5532022">==</span>&nbsp;<span class="ident" id="5532025">prevMatchEnd</span>&nbsp;<span class="op" id="5532038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532044">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532087">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532132">accept</span>&nbsp;<span class="op" id="5532139">=</span>&nbsp;<span class="builtintype" id="5532141">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532155">var</span>&nbsp;<span class="ident" id="5532159">width</span>&nbsp;<span class="builtintype" id="5532165">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532172">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532195">if</span>&nbsp;<span class="ident" id="5532198">b</span>&nbsp;<span class="op" id="5532200">==</span>&nbsp;<span class="ident" id="5532203">nil</span>&nbsp;<span class="op" id="5532207">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532213">_</span><span class="op" id="5532214">,</span>&nbsp;<span class="ident" id="5532216">width</span>&nbsp;<span class="op" id="5532222">=</span>&nbsp;<span class="ident" id="5532224">utf8</span><span class="op" id="5532228">.</span><span class="ident" id="5532229">DecodeRuneInString</span><span class="op" id="5532247">(</span><span class="ident" id="5532248">s</span><span class="op" id="5532249">[</span><span class="ident" id="5532250">pos</span><span class="op" id="5532253">:</span><span class="ident" id="5532254">end</span><span class="op" id="5532257">]</span><span class="op" id="5532258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532263">}</span>&nbsp;<span class="keyword" id="5532265">else</span>&nbsp;<span class="op" id="5532270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532276">_</span><span class="op" id="5532277">,</span>&nbsp;<span class="ident" id="5532279">width</span>&nbsp;<span class="op" id="5532285">=</span>&nbsp;<span class="ident" id="5532287">utf8</span><span class="op" id="5532291">.</span><span class="ident" id="5532292">DecodeRune</span><span class="op" id="5532302">(</span><span class="ident" id="5532303">b</span><span class="op" id="5532304">[</span><span class="ident" id="5532305">pos</span><span class="op" id="5532308">:</span><span class="ident" id="5532309">end</span><span class="op" id="5532312">]</span><span class="op" id="5532313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532323">if</span>&nbsp;<span class="ident" id="5532326">width</span>&nbsp;<span class="op" id="5532332">&gt;</span>&nbsp;<span class="num" id="5532334">0</span>&nbsp;<span class="op" id="5532336">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532342">pos</span>&nbsp;<span class="op" id="5532346">+=</span>&nbsp;<span class="ident" id="5532349">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532358">}</span>&nbsp;<span class="keyword" id="5532360">else</span>&nbsp;<span class="op" id="5532365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532371">pos</span>&nbsp;<span class="op" id="5532375">=</span>&nbsp;<span class="ident" id="5532377">end</span>&nbsp;<span class="op" id="5532381">+</span>&nbsp;<span class="num" id="5532383">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532392">}</span>&nbsp;<span class="keyword" id="5532394">else</span>&nbsp;<span class="op" id="5532399">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532404">pos</span>&nbsp;<span class="op" id="5532408">=</span>&nbsp;<span class="ident" id="5532410">matches</span><span class="op" id="5532417">[</span><span class="num" id="5532418">1</span><span class="op" id="5532419">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532427">prevMatchEnd</span>&nbsp;<span class="op" id="5532440">=</span>&nbsp;<span class="ident" id="5532442">matches</span><span class="op" id="5532449">[</span><span class="num" id="5532450">1</span><span class="op" id="5532451">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532456">if</span>&nbsp;<span class="ident" id="5532459">accept</span>&nbsp;<span class="op" id="5532466">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532471">deliver</span><span class="op" id="5532478">(</span><span class="ident" id="5532479">re</span><span class="op" id="5532481">.</span><span class="ident" id="5532482">pad</span><span class="op" id="5532485">(</span><span class="ident" id="5532486">matches</span><span class="op" id="5532493">)</span><span class="op" id="5532494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532499">i</span><span class="op" id="5532500">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532508">}</span><br>
<span class="lineno"></span><span class="op" id="5532510">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5532513">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5532608">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5532653">func</span>&nbsp;<span class="op" id="5532658">(</span><span class="ident" id="5532659">re</span>&nbsp;<span class="op" id="5532662">*</span><span class="ident" id="5532663">Regexp</span><span class="op" id="5532669">)</span>&nbsp;<span class="ident" id="5532671">Find</span><span class="op" id="5532675">(</span><span class="ident" id="5532676">b</span>&nbsp;<span class="op" id="5532678">[</span><span class="op" id="5532679">]</span><span class="builtintype" id="5532680">byte</span><span class="op" id="5532684">)</span>&nbsp;<span class="op" id="5532686">[</span><span class="op" id="5532687">]</span><span class="builtintype" id="5532688">byte</span>&nbsp;<span class="op" id="5532693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532696">a</span>&nbsp;<span class="op" id="5532698">:=</span>&nbsp;<span class="ident" id="5532701">re</span><span class="op" id="5532703">.</span><span class="ident" id="5532704">doExecute</span><span class="op" id="5532713">(</span><span class="ident" id="5532714">nil</span><span class="op" id="5532717">,</span>&nbsp;<span class="ident" id="5532719">b</span><span class="op" id="5532720">,</span>&nbsp;<span class="string" id="5532722">&#34;&#34;</span><span class="op" id="5532724">,</span>&nbsp;<span class="num" id="5532726">0</span><span class="op" id="5532727">,</span>&nbsp;<span class="num" id="5532729">2</span><span class="op" id="5532730">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532733">if</span>&nbsp;<span class="ident" id="5532736">a</span>&nbsp;<span class="op" id="5532738">==</span>&nbsp;<span class="ident" id="5532741">nil</span>&nbsp;<span class="op" id="5532745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532749">return</span>&nbsp;<span class="ident" id="5532756">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532764">return</span>&nbsp;<span class="ident" id="5532771">b</span><span class="op" id="5532772">[</span><span class="ident" id="5532773">a</span><span class="op" id="5532774">[</span><span class="num" id="5532775">0</span><span class="op" id="5532776">]</span><span class="op" id="5532777">:</span><span class="ident" id="5532778">a</span><span class="op" id="5532779">[</span><span class="num" id="5532780">1</span><span class="op" id="5532781">]</span><span class="op" id="5532782">]</span><br>
<span class="lineno"></span><span class="op" id="5532784">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5532787">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5532865">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5532943">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5532964">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="5533009">func</span>&nbsp;<span class="op" id="5533014">(</span><span class="ident" id="5533015">re</span>&nbsp;<span class="op" id="5533018">*</span><span class="ident" id="5533019">Regexp</span><span class="op" id="5533025">)</span>&nbsp;<span class="ident" id="5533027">FindIndex</span><span class="op" id="5533036">(</span><span class="ident" id="5533037">b</span>&nbsp;<span class="op" id="5533039">[</span><span class="op" id="5533040">]</span><span class="builtintype" id="5533041">byte</span><span class="op" id="5533045">)</span>&nbsp;<span class="op" id="5533047">(</span><span class="ident" id="5533048">loc</span>&nbsp;<span class="op" id="5533052">[</span><span class="op" id="5533053">]</span><span class="builtintype" id="5533054">int</span><span class="op" id="5533057">)</span>&nbsp;<span class="op" id="5533059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533062">a</span>&nbsp;<span class="op" id="5533064">:=</span>&nbsp;<span class="ident" id="5533067">re</span><span class="op" id="5533069">.</span><span class="ident" id="5533070">doExecute</span><span class="op" id="5533079">(</span><span class="ident" id="5533080">nil</span><span class="op" id="5533083">,</span>&nbsp;<span class="ident" id="5533085">b</span><span class="op" id="5533086">,</span>&nbsp;<span class="string" id="5533088">&#34;&#34;</span><span class="op" id="5533090">,</span>&nbsp;<span class="num" id="5533092">0</span><span class="op" id="5533093">,</span>&nbsp;<span class="num" id="5533095">2</span><span class="op" id="5533096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533099">if</span>&nbsp;<span class="ident" id="5533102">a</span>&nbsp;<span class="op" id="5533104">==</span>&nbsp;<span class="ident" id="5533107">nil</span>&nbsp;<span class="op" id="5533111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533115">return</span>&nbsp;<span class="ident" id="5533122">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533127">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533130">return</span>&nbsp;<span class="ident" id="5533137">a</span><span class="op" id="5533138">[</span><span class="num" id="5533139">0</span><span class="op" id="5533140">:</span><span class="num" id="5533141">2</span><span class="op" id="5533142">]</span><br>
<span class="lineno"></span><span class="op" id="5533144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533147">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5533237">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="5533312">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5533388">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5533460">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="5533501">func</span>&nbsp;<span class="op" id="5533506">(</span><span class="ident" id="5533507">re</span>&nbsp;<span class="op" id="5533510">*</span><span class="ident" id="5533511">Regexp</span><span class="op" id="5533517">)</span>&nbsp;<span class="ident" id="5533519">FindString</span><span class="op" id="5533529">(</span><span class="ident" id="5533530">s</span>&nbsp;<span class="builtintype" id="5533532">string</span><span class="op" id="5533538">)</span>&nbsp;<span class="builtintype" id="5533540">string</span>&nbsp;<span class="op" id="5533547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533550">a</span>&nbsp;<span class="op" id="5533552">:=</span>&nbsp;<span class="ident" id="5533555">re</span><span class="op" id="5533557">.</span><span class="ident" id="5533558">doExecute</span><span class="op" id="5533567">(</span><span class="ident" id="5533568">nil</span><span class="op" id="5533571">,</span>&nbsp;<span class="ident" id="5533573">nil</span><span class="op" id="5533576">,</span>&nbsp;<span class="ident" id="5533578">s</span><span class="op" id="5533579">,</span>&nbsp;<span class="num" id="5533581">0</span><span class="op" id="5533582">,</span>&nbsp;<span class="num" id="5533584">2</span><span class="op" id="5533585">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533588">if</span>&nbsp;<span class="ident" id="5533591">a</span>&nbsp;<span class="op" id="5533593">==</span>&nbsp;<span class="ident" id="5533596">nil</span>&nbsp;<span class="op" id="5533600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533604">return</span>&nbsp;<span class="string" id="5533611">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533618">return</span>&nbsp;<span class="ident" id="5533625">s</span><span class="op" id="5533626">[</span><span class="ident" id="5533627">a</span><span class="op" id="5533628">[</span><span class="num" id="5533629">0</span><span class="op" id="5533630">]</span><span class="op" id="5533631">:</span><span class="ident" id="5533632">a</span><span class="op" id="5533633">[</span><span class="num" id="5533634">1</span><span class="op" id="5533635">]</span><span class="op" id="5533636">]</span><br>
<span class="lineno"></span><span class="op" id="5533638">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5533641">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5533713">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5533790">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5533824">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="5533869">func</span>&nbsp;<span class="op" id="5533874">(</span><span class="ident" id="5533875">re</span>&nbsp;<span class="op" id="5533878">*</span><span class="ident" id="5533879">Regexp</span><span class="op" id="5533885">)</span>&nbsp;<span class="ident" id="5533887">FindStringIndex</span><span class="op" id="5533902">(</span><span class="ident" id="5533903">s</span>&nbsp;<span class="builtintype" id="5533905">string</span><span class="op" id="5533911">)</span>&nbsp;<span class="op" id="5533913">(</span><span class="ident" id="5533914">loc</span>&nbsp;<span class="op" id="5533918">[</span><span class="op" id="5533919">]</span><span class="builtintype" id="5533920">int</span><span class="op" id="5533923">)</span>&nbsp;<span class="op" id="5533925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533928">a</span>&nbsp;<span class="op" id="5533930">:=</span>&nbsp;<span class="ident" id="5533933">re</span><span class="op" id="5533935">.</span><span class="ident" id="5533936">doExecute</span><span class="op" id="5533945">(</span><span class="ident" id="5533946">nil</span><span class="op" id="5533949">,</span>&nbsp;<span class="ident" id="5533951">nil</span><span class="op" id="5533954">,</span>&nbsp;<span class="ident" id="5533956">s</span><span class="op" id="5533957">,</span>&nbsp;<span class="num" id="5533959">0</span><span class="op" id="5533960">,</span>&nbsp;<span class="num" id="5533962">2</span><span class="op" id="5533963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533966">if</span>&nbsp;<span class="ident" id="5533969">a</span>&nbsp;<span class="op" id="5533971">==</span>&nbsp;<span class="ident" id="5533974">nil</span>&nbsp;<span class="op" id="5533978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533982">return</span>&nbsp;<span class="ident" id="5533989">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533994">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533997">return</span>&nbsp;<span class="ident" id="5534004">a</span><span class="op" id="5534005">[</span><span class="num" id="5534006">0</span><span class="op" id="5534007">:</span><span class="num" id="5534008">2</span><span class="op" id="5534009">]</span><br>
<span class="lineno"></span><span class="op" id="5534011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534014">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5534086">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="5534164">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5534232">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="5534272">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5534317">func</span>&nbsp;<span class="op" id="5534322">(</span><span class="ident" id="5534323">re</span>&nbsp;<span class="op" id="5534326">*</span><span class="ident" id="5534327">Regexp</span><span class="op" id="5534333">)</span>&nbsp;<span class="ident" id="5534335">FindReaderIndex</span><span class="op" id="5534350">(</span><span class="ident" id="5534351">r</span>&nbsp;<span class="ident" id="5534353">io</span><span class="op" id="5534355">.</span><span class="ident" id="5534356">RuneReader</span><span class="op" id="5534366">)</span>&nbsp;<span class="op" id="5534368">(</span><span class="ident" id="5534369">loc</span>&nbsp;<span class="op" id="5534373">[</span><span class="op" id="5534374">]</span><span class="builtintype" id="5534375">int</span><span class="op" id="5534378">)</span>&nbsp;<span class="op" id="5534380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534383">a</span>&nbsp;<span class="op" id="5534385">:=</span>&nbsp;<span class="ident" id="5534388">re</span><span class="op" id="5534390">.</span><span class="ident" id="5534391">doExecute</span><span class="op" id="5534400">(</span><span class="ident" id="5534401">r</span><span class="op" id="5534402">,</span>&nbsp;<span class="ident" id="5534404">nil</span><span class="op" id="5534407">,</span>&nbsp;<span class="string" id="5534409">&#34;&#34;</span><span class="op" id="5534411">,</span>&nbsp;<span class="num" id="5534413">0</span><span class="op" id="5534414">,</span>&nbsp;<span class="num" id="5534416">2</span><span class="op" id="5534417">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534420">if</span>&nbsp;<span class="ident" id="5534423">a</span>&nbsp;<span class="op" id="5534425">==</span>&nbsp;<span class="ident" id="5534428">nil</span>&nbsp;<span class="op" id="5534432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534436">return</span>&nbsp;<span class="ident" id="5534443">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534451">return</span>&nbsp;<span class="ident" id="5534458">a</span><span class="op" id="5534459">[</span><span class="num" id="5534460">0</span><span class="op" id="5534461">:</span><span class="num" id="5534462">2</span><span class="op" id="5534463">]</span><br>
<span class="lineno"></span><span class="op" id="5534465">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="5534468">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="5534543">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5534615">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5534691">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="5534703">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5534748">func</span>&nbsp;<span class="op" id="5534753">(</span><span class="ident" id="5534754">re</span>&nbsp;<span class="op" id="5534757">*</span><span class="ident" id="5534758">Regexp</span><span class="op" id="5534764">)</span>&nbsp;<span class="ident" id="5534766">FindSubmatch</span><span class="op" id="5534778">(</span><span class="ident" id="5534779">b</span>&nbsp;<span class="op" id="5534781">[</span><span class="op" id="5534782">]</span><span class="builtintype" id="5534783">byte</span><span class="op" id="5534787">)</span>&nbsp;<span class="op" id="5534789">[</span><span class="op" id="5534790">]</span><span class="op" id="5534791">[</span><span class="op" id="5534792">]</span><span class="builtintype" id="5534793">byte</span>&nbsp;<span class="op" id="5534798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534801">a</span>&nbsp;<span class="op" id="5534803">:=</span>&nbsp;<span class="ident" id="5534806">re</span><span class="op" id="5534808">.</span><span class="ident" id="5534809">doExecute</span><span class="op" id="5534818">(</span><span class="ident" id="5534819">nil</span><span class="op" id="5534822">,</span>&nbsp;<span class="ident" id="5534824">b</span><span class="op" id="5534825">,</span>&nbsp;<span class="string" id="5534827">&#34;&#34;</span><span class="op" id="5534829">,</span>&nbsp;<span class="num" id="5534831">0</span><span class="op" id="5534832">,</span>&nbsp;<span class="ident" id="5534834">re</span><span class="op" id="5534836">.</span><span class="ident" id="5534837">prog</span><span class="op" id="5534841">.</span><span class="ident" id="5534842">NumCap</span><span class="op" id="5534848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534851">if</span>&nbsp;<span class="ident" id="5534854">a</span>&nbsp;<span class="op" id="5534856">==</span>&nbsp;<span class="ident" id="5534859">nil</span>&nbsp;<span class="op" id="5534863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534867">return</span>&nbsp;<span class="ident" id="5534874">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534882">ret</span>&nbsp;<span class="op" id="5534886">:=</span>&nbsp;<span class="builtinfunc" id="5534889">make</span><span class="op" id="5534893">(</span><span class="op" id="5534894">[</span><span class="op" id="5534895">]</span><span class="op" id="5534896">[</span><span class="op" id="5534897">]</span><span class="builtintype" id="5534898">byte</span><span class="op" id="5534902">,</span>&nbsp;<span class="num" id="5534904">1</span><span class="op" id="5534905">+</span><span class="ident" id="5534906">re</span><span class="op" id="5534908">.</span><span class="ident" id="5534909">numSubexp</span><span class="op" id="5534918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534921">for</span>&nbsp;<span class="ident" id="5534925">i</span>&nbsp;<span class="op" id="5534927">:=</span>&nbsp;<span class="keyword" id="5534930">range</span>&nbsp;<span class="ident" id="5534936">ret</span>&nbsp;<span class="op" id="5534940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534944">if</span>&nbsp;<span class="num" id="5534947">2</span><span class="op" id="5534948">*</span><span class="ident" id="5534949">i</span>&nbsp;<span class="op" id="5534951">&lt;</span>&nbsp;<span class="builtinfunc" id="5534953">len</span><span class="op" id="5534956">(</span><span class="ident" id="5534957">a</span><span class="op" id="5534958">)</span>&nbsp;<span class="op" id="5534960">&amp;&amp;</span>&nbsp;<span class="ident" id="5534963">a</span><span class="op" id="5534964">[</span><span class="num" id="5534965">2</span><span class="op" id="5534966">*</span><span class="ident" id="5534967">i</span><span class="op" id="5534968">]</span>&nbsp;<span class="op" id="5534970">&gt;=</span>&nbsp;<span class="num" id="5534973">0</span>&nbsp;<span class="op" id="5534975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534980">ret</span><span class="op" id="5534983">[</span><span class="ident" id="5534984">i</span><span class="op" id="5534985">]</span>&nbsp;<span class="op" id="5534987">=</span>&nbsp;<span class="ident" id="5534989">b</span><span class="op" id="5534990">[</span><span class="ident" id="5534991">a</span><span class="op" id="5534992">[</span><span class="num" id="5534993">2</span><span class="op" id="5534994">*</span><span class="ident" id="5534995">i</span><span class="op" id="5534996">]</span><span class="op" id="5534997">:</span><span class="ident" id="5534998">a</span><span class="op" id="5534999">[</span><span class="num" id="5535000">2</span><span class="op" id="5535001">*</span><span class="ident" id="5535002">i</span><span class="op" id="5535003">+</span><span class="num" id="5535004">1</span><span class="op" id="5535005">]</span><span class="op" id="5535006">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535016">return</span>&nbsp;<span class="ident" id="5535023">ret</span><br>
<span class="lineno"></span><span class="op" id="5535027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5535030">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5535099">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5535171">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5535244">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="5535266">//</span><br>
<span class="lineno">745</span><span class="comment" id="5535269">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5535338">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="5535406">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5535475">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5535542">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="5535607">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5535680">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="5535750">//</span><br>
<span class="lineno"></span><span class="comment" id="5535753">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5535823">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="5535902">//</span><br>
<span class="lineno"></span><span class="comment" id="5535905">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5535969">func</span>&nbsp;<span class="op" id="5535974">(</span><span class="ident" id="5535975">re</span>&nbsp;<span class="op" id="5535978">*</span><span class="ident" id="5535979">Regexp</span><span class="op" id="5535985">)</span>&nbsp;<span class="ident" id="5535987">Expand</span><span class="op" id="5535993">(</span><span class="ident" id="5535994">dst</span>&nbsp;<span class="op" id="5535998">[</span><span class="op" id="5535999">]</span><span class="builtintype" id="5536000">byte</span><span class="op" id="5536004">,</span>&nbsp;<span class="ident" id="5536006">template</span>&nbsp;<span class="op" id="5536015">[</span><span class="op" id="5536016">]</span><span class="builtintype" id="5536017">byte</span><span class="op" id="5536021">,</span>&nbsp;<span class="ident" id="5536023">src</span>&nbsp;<span class="op" id="5536027">[</span><span class="op" id="5536028">]</span><span class="builtintype" id="5536029">byte</span><span class="op" id="5536033">,</span>&nbsp;<span class="ident" id="5536035">match</span>&nbsp;<span class="op" id="5536041">[</span><span class="op" id="5536042">]</span><span class="builtintype" id="5536043">int</span><span class="op" id="5536046">)</span>&nbsp;<span class="op" id="5536048">[</span><span class="op" id="5536049">]</span><span class="builtintype" id="5536050">byte</span>&nbsp;<span class="op" id="5536055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536058">return</span>&nbsp;<span class="ident" id="5536065">re</span><span class="op" id="5536067">.</span><span class="ident" id="5536068">expand</span><span class="op" id="5536074">(</span><span class="ident" id="5536075">dst</span><span class="op" id="5536078">,</span>&nbsp;<span class="builtintype" id="5536080">string</span><span class="op" id="5536086">(</span><span class="ident" id="5536087">template</span><span class="op" id="5536095">)</span><span class="op" id="5536096">,</span>&nbsp;<span class="ident" id="5536098">src</span><span class="op" id="5536101">,</span>&nbsp;<span class="string" id="5536103">&#34;&#34;</span><span class="op" id="5536105">,</span>&nbsp;<span class="ident" id="5536107">match</span><span class="op" id="5536112">)</span><br>
<span class="lineno"></span><span class="op" id="5536114">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="5536117">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="5536189">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5536260">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5536293">func</span>&nbsp;<span class="op" id="5536298">(</span><span class="ident" id="5536299">re</span>&nbsp;<span class="op" id="5536302">*</span><span class="ident" id="5536303">Regexp</span><span class="op" id="5536309">)</span>&nbsp;<span class="ident" id="5536311">ExpandString</span><span class="op" id="5536323">(</span><span class="ident" id="5536324">dst</span>&nbsp;<span class="op" id="5536328">[</span><span class="op" id="5536329">]</span><span class="builtintype" id="5536330">byte</span><span class="op" id="5536334">,</span>&nbsp;<span class="ident" id="5536336">template</span>&nbsp;<span class="builtintype" id="5536345">string</span><span class="op" id="5536351">,</span>&nbsp;<span class="ident" id="5536353">src</span>&nbsp;<span class="builtintype" id="5536357">string</span><span class="op" id="5536363">,</span>&nbsp;<span class="ident" id="5536365">match</span>&nbsp;<span class="op" id="5536371">[</span><span class="op" id="5536372">]</span><span class="builtintype" id="5536373">int</span><span class="op" id="5536376">)</span>&nbsp;<span class="op" id="5536378">[</span><span class="op" id="5536379">]</span><span class="builtintype" id="5536380">byte</span>&nbsp;<span class="op" id="5536385">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536388">return</span>&nbsp;<span class="ident" id="5536395">re</span><span class="op" id="5536397">.</span><span class="ident" id="5536398">expand</span><span class="op" id="5536404">(</span><span class="ident" id="5536405">dst</span><span class="op" id="5536408">,</span>&nbsp;<span class="ident" id="5536410">template</span><span class="op" id="5536418">,</span>&nbsp;<span class="ident" id="5536420">nil</span><span class="op" id="5536423">,</span>&nbsp;<span class="ident" id="5536425">src</span><span class="op" id="5536428">,</span>&nbsp;<span class="ident" id="5536430">match</span><span class="op" id="5536435">)</span><br>
<span class="lineno"></span><span class="op" id="5536437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5536440">func</span>&nbsp;<span class="op" id="5536445">(</span><span class="ident" id="5536446">re</span>&nbsp;<span class="op" id="5536449">*</span><span class="ident" id="5536450">Regexp</span><span class="op" id="5536456">)</span>&nbsp;<span class="ident" id="5536458">expand</span><span class="op" id="5536464">(</span><span class="ident" id="5536465">dst</span>&nbsp;<span class="op" id="5536469">[</span><span class="op" id="5536470">]</span><span class="builtintype" id="5536471">byte</span><span class="op" id="5536475">,</span>&nbsp;<span class="ident" id="5536477">template</span>&nbsp;<span class="builtintype" id="5536486">string</span><span class="op" id="5536492">,</span>&nbsp;<span class="ident" id="5536494">bsrc</span>&nbsp;<span class="op" id="5536499">[</span><span class="op" id="5536500">]</span><span class="builtintype" id="5536501">byte</span><span class="op" id="5536505">,</span>&nbsp;<span class="ident" id="5536507">src</span>&nbsp;<span class="builtintype" id="5536511">string</span><span class="op" id="5536517">,</span>&nbsp;<span class="ident" id="5536519">match</span>&nbsp;<span class="op" id="5536525">[</span><span class="op" id="5536526">]</span><span class="builtintype" id="5536527">int</span><span class="op" id="5536530">)</span>&nbsp;<span class="op" id="5536532">[</span><span class="op" id="5536533">]</span><span class="builtintype" id="5536534">byte</span>&nbsp;<span class="op" id="5536539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536542">for</span>&nbsp;<span class="builtinfunc" id="5536546">len</span><span class="op" id="5536549">(</span><span class="ident" id="5536550">template</span><span class="op" id="5536558">)</span>&nbsp;<span class="op" id="5536560">&gt;</span>&nbsp;<span class="num" id="5536562">0</span>&nbsp;<span class="op" id="5536564">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536568">i</span>&nbsp;<span class="op" id="5536570">:=</span>&nbsp;<span class="ident" id="5536573">strings</span><span class="op" id="5536580">.</span><span class="ident" id="5536581">Index</span><span class="op" id="5536586">(</span><span class="ident" id="5536587">template</span><span class="op" id="5536595">,</span>&nbsp;<span class="string" id="5536597">&#34;$&#34;</span><span class="op" id="5536600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536604">if</span>&nbsp;<span class="ident" id="5536607">i</span>&nbsp;<span class="op" id="5536609">&lt;</span>&nbsp;<span class="num" id="5536611">0</span>&nbsp;<span class="op" id="5536613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536618">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536630">dst</span>&nbsp;<span class="op" id="5536634">=</span>&nbsp;<span class="builtinfunc" id="5536636">append</span><span class="op" id="5536642">(</span><span class="ident" id="5536643">dst</span><span class="op" id="5536646">,</span>&nbsp;<span class="ident" id="5536648">template</span><span class="op" id="5536656">[</span><span class="op" id="5536657">:</span><span class="ident" id="5536658">i</span><span class="op" id="5536659">]</span><span class="op" id="5536660">...</span><span class="op" id="5536663">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536667">template</span>&nbsp;<span class="op" id="5536676">=</span>&nbsp;<span class="ident" id="5536678">template</span><span class="op" id="5536686">[</span><span class="ident" id="5536687">i</span><span class="op" id="5536688">:</span><span class="op" id="5536689">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536693">if</span>&nbsp;<span class="builtinfunc" id="5536696">len</span><span class="op" id="5536699">(</span><span class="ident" id="5536700">template</span><span class="op" id="5536708">)</span>&nbsp;<span class="op" id="5536710">&gt;</span>&nbsp;<span class="num" id="5536712">1</span>&nbsp;<span class="op" id="5536714">&amp;&amp;</span>&nbsp;<span class="ident" id="5536717">template</span><span class="op" id="5536725">[</span><span class="num" id="5536726">1</span><span class="op" id="5536727">]</span>&nbsp;<span class="op" id="5536729">==</span>&nbsp;<span class="string" id="5536732">&#39;$&#39;</span>&nbsp;<span class="op" id="5536736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536741">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536762">dst</span>&nbsp;<span class="op" id="5536766">=</span>&nbsp;<span class="builtinfunc" id="5536768">append</span><span class="op" id="5536774">(</span><span class="ident" id="5536775">dst</span><span class="op" id="5536778">,</span>&nbsp;<span class="string" id="5536780">&#39;$&#39;</span><span class="op" id="5536783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536788">template</span>&nbsp;<span class="op" id="5536797">=</span>&nbsp;<span class="ident" id="5536799">template</span><span class="op" id="5536807">[</span><span class="num" id="5536808">2</span><span class="op" id="5536809">:</span><span class="op" id="5536810">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536815">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536830">name</span><span class="op" id="5536834">,</span>&nbsp;<span class="ident" id="5536836">num</span><span class="op" id="5536839">,</span>&nbsp;<span class="ident" id="5536841">rest</span><span class="op" id="5536845">,</span>&nbsp;<span class="ident" id="5536847">ok</span>&nbsp;<span class="op" id="5536850">:=</span>&nbsp;<span class="ident" id="5536853">extract</span><span class="op" id="5536860">(</span><span class="ident" id="5536861">template</span><span class="op" id="5536869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536873">if</span>&nbsp;<span class="op" id="5536876">!</span><span class="ident" id="5536877">ok</span>&nbsp;<span class="op" id="5536880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536885">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536923">dst</span>&nbsp;<span class="op" id="5536927">=</span>&nbsp;<span class="builtinfunc" id="5536929">append</span><span class="op" id="5536935">(</span><span class="ident" id="5536936">dst</span><span class="op" id="5536939">,</span>&nbsp;<span class="string" id="5536941">&#39;$&#39;</span><span class="op" id="5536944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536949">template</span>&nbsp;<span class="op" id="5536958">=</span>&nbsp;<span class="ident" id="5536960">template</span><span class="op" id="5536968">[</span><span class="num" id="5536969">1</span><span class="op" id="5536970">:</span><span class="op" id="5536971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536976">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536991">template</span>&nbsp;<span class="op" id="5537000">=</span>&nbsp;<span class="ident" id="5537002">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537009">if</span>&nbsp;<span class="ident" id="5537012">num</span>&nbsp;<span class="op" id="5537016">&gt;=</span>&nbsp;<span class="num" id="5537019">0</span>&nbsp;<span class="op" id="5537021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537026">if</span>&nbsp;<span class="num" id="5537029">2</span><span class="op" id="5537030">*</span><span class="ident" id="5537031">num</span><span class="op" id="5537034">+</span><span class="num" id="5537035">1</span>&nbsp;<span class="op" id="5537037">&lt;</span>&nbsp;<span class="builtinfunc" id="5537039">len</span><span class="op" id="5537042">(</span><span class="ident" id="5537043">match</span><span class="op" id="5537048">)</span>&nbsp;<span class="op" id="5537050">&amp;&amp;</span>&nbsp;<span class="ident" id="5537053">match</span><span class="op" id="5537058">[</span><span class="num" id="5537059">2</span><span class="op" id="5537060">*</span><span class="ident" id="5537061">num</span><span class="op" id="5537064">]</span>&nbsp;<span class="op" id="5537066">&gt;=</span>&nbsp;<span class="num" id="5537069">0</span>&nbsp;<span class="op" id="5537071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537077">if</span>&nbsp;<span class="ident" id="5537080">bsrc</span>&nbsp;<span class="op" id="5537085">!=</span>&nbsp;<span class="ident" id="5537088">nil</span>&nbsp;<span class="op" id="5537092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537099">dst</span>&nbsp;<span class="op" id="5537103">=</span>&nbsp;<span class="builtinfunc" id="5537105">append</span><span class="op" id="5537111">(</span><span class="ident" id="5537112">dst</span><span class="op" id="5537115">,</span>&nbsp;<span class="ident" id="5537117">bsrc</span><span class="op" id="5537121">[</span><span class="ident" id="5537122">match</span><span class="op" id="5537127">[</span><span class="num" id="5537128">2</span><span class="op" id="5537129">*</span><span class="ident" id="5537130">num</span><span class="op" id="5537133">]</span><span class="op" id="5537134">:</span><span class="ident" id="5537135">match</span><span class="op" id="5537140">[</span><span class="num" id="5537141">2</span><span class="op" id="5537142">*</span><span class="ident" id="5537143">num</span><span class="op" id="5537146">+</span><span class="num" id="5537147">1</span><span class="op" id="5537148">]</span><span class="op" id="5537149">]</span><span class="op" id="5537150">...</span><span class="op" id="5537153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537159">}</span>&nbsp;<span class="keyword" id="5537161">else</span>&nbsp;<span class="op" id="5537166">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537173">dst</span>&nbsp;<span class="op" id="5537177">=</span>&nbsp;<span class="builtinfunc" id="5537179">append</span><span class="op" id="5537185">(</span><span class="ident" id="5537186">dst</span><span class="op" id="5537189">,</span>&nbsp;<span class="ident" id="5537191">src</span><span class="op" id="5537194">[</span><span class="ident" id="5537195">match</span><span class="op" id="5537200">[</span><span class="num" id="5537201">2</span><span class="op" id="5537202">*</span><span class="ident" id="5537203">num</span><span class="op" id="5537206">]</span><span class="op" id="5537207">:</span><span class="ident" id="5537208">match</span><span class="op" id="5537213">[</span><span class="num" id="5537214">2</span><span class="op" id="5537215">*</span><span class="ident" id="5537216">num</span><span class="op" id="5537219">+</span><span class="num" id="5537220">1</span><span class="op" id="5537221">]</span><span class="op" id="5537222">]</span><span class="op" id="5537223">...</span><span class="op" id="5537226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537241">}</span>&nbsp;<span class="keyword" id="5537243">else</span>&nbsp;<span class="op" id="5537248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537253">for</span>&nbsp;<span class="ident" id="5537257">i</span><span class="op" id="5537258">,</span>&nbsp;<span class="ident" id="5537260">namei</span>&nbsp;<span class="op" id="5537266">:=</span>&nbsp;<span class="keyword" id="5537269">range</span>&nbsp;<span class="ident" id="5537275">re</span><span class="op" id="5537277">.</span><span class="ident" id="5537278">subexpNames</span>&nbsp;<span class="op" id="5537290">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537296">if</span>&nbsp;<span class="ident" id="5537299">name</span>&nbsp;<span class="op" id="5537304">==</span>&nbsp;<span class="ident" id="5537307">namei</span>&nbsp;<span class="op" id="5537313">&amp;&amp;</span>&nbsp;<span class="num" id="5537316">2</span><span class="op" id="5537317">*</span><span class="ident" id="5537318">i</span><span class="op" id="5537319">+</span><span class="num" id="5537320">1</span>&nbsp;<span class="op" id="5537322">&lt;</span>&nbsp;<span class="builtinfunc" id="5537324">len</span><span class="op" id="5537327">(</span><span class="ident" id="5537328">match</span><span class="op" id="5537333">)</span>&nbsp;<span class="op" id="5537335">&amp;&amp;</span>&nbsp;<span class="ident" id="5537338">match</span><span class="op" id="5537343">[</span><span class="num" id="5537344">2</span><span class="op" id="5537345">*</span><span class="ident" id="5537346">i</span><span class="op" id="5537347">]</span>&nbsp;<span class="op" id="5537349">&gt;=</span>&nbsp;<span class="num" id="5537352">0</span>&nbsp;<span class="op" id="5537354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537361">if</span>&nbsp;<span class="ident" id="5537364">bsrc</span>&nbsp;<span class="op" id="5537369">!=</span>&nbsp;<span class="ident" id="5537372">nil</span>&nbsp;<span class="op" id="5537376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537384">dst</span>&nbsp;<span class="op" id="5537388">=</span>&nbsp;<span class="builtinfunc" id="5537390">append</span><span class="op" id="5537396">(</span><span class="ident" id="5537397">dst</span><span class="op" id="5537400">,</span>&nbsp;<span class="ident" id="5537402">bsrc</span><span class="op" id="5537406">[</span><span class="ident" id="5537407">match</span><span class="op" id="5537412">[</span><span class="num" id="5537413">2</span><span class="op" id="5537414">*</span><span class="ident" id="5537415">i</span><span class="op" id="5537416">]</span><span class="op" id="5537417">:</span><span class="ident" id="5537418">match</span><span class="op" id="5537423">[</span><span class="num" id="5537424">2</span><span class="op" id="5537425">*</span><span class="ident" id="5537426">i</span><span class="op" id="5537427">+</span><span class="num" id="5537428">1</span><span class="op" id="5537429">]</span><span class="op" id="5537430">]</span><span class="op" id="5537431">...</span><span class="op" id="5537434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537441">}</span>&nbsp;<span class="keyword" id="5537443">else</span>&nbsp;<span class="op" id="5537448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537456">dst</span>&nbsp;<span class="op" id="5537460">=</span>&nbsp;<span class="builtinfunc" id="5537462">append</span><span class="op" id="5537468">(</span><span class="ident" id="5537469">dst</span><span class="op" id="5537472">,</span>&nbsp;<span class="ident" id="5537474">src</span><span class="op" id="5537477">[</span><span class="ident" id="5537478">match</span><span class="op" id="5537483">[</span><span class="num" id="5537484">2</span><span class="op" id="5537485">*</span><span class="ident" id="5537486">i</span><span class="op" id="5537487">]</span><span class="op" id="5537488">:</span><span class="ident" id="5537489">match</span><span class="op" id="5537494">[</span><span class="num" id="5537495">2</span><span class="op" id="5537496">*</span><span class="ident" id="5537497">i</span><span class="op" id="5537498">+</span><span class="num" id="5537499">1</span><span class="op" id="5537500">]</span><span class="op" id="5537501">]</span><span class="op" id="5537502">...</span><span class="op" id="5537505">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537519">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537538">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537544">dst</span>&nbsp;<span class="op" id="5537548">=</span>&nbsp;<span class="builtinfunc" id="5537550">append</span><span class="op" id="5537556">(</span><span class="ident" id="5537557">dst</span><span class="op" id="5537560">,</span>&nbsp;<span class="ident" id="5537562">template</span><span class="op" id="5537570">...</span><span class="op" id="5537573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537576">return</span>&nbsp;<span class="ident" id="5537583">dst</span><br>
<span class="lineno"></span><span class="op" id="5537587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="5537590">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="5537662">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5537744">func</span>&nbsp;<span class="ident" id="5537749">extract</span><span class="op" id="5537756">(</span><span class="ident" id="5537757">str</span>&nbsp;<span class="builtintype" id="5537761">string</span><span class="op" id="5537767">)</span>&nbsp;<span class="op" id="5537769">(</span><span class="ident" id="5537770">name</span>&nbsp;<span class="builtintype" id="5537775">string</span><span class="op" id="5537781">,</span>&nbsp;<span class="ident" id="5537783">num</span>&nbsp;<span class="builtintype" id="5537787">int</span><span class="op" id="5537790">,</span>&nbsp;<span class="ident" id="5537792">rest</span>&nbsp;<span class="builtintype" id="5537797">string</span><span class="op" id="5537803">,</span>&nbsp;<span class="ident" id="5537805">ok</span>&nbsp;<span class="builtintype" id="5537808">bool</span><span class="op" id="5537812">)</span>&nbsp;<span class="op" id="5537814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537817">if</span>&nbsp;<span class="builtinfunc" id="5537820">len</span><span class="op" id="5537823">(</span><span class="ident" id="5537824">str</span><span class="op" id="5537827">)</span>&nbsp;<span class="op" id="5537829">&lt;</span>&nbsp;<span class="num" id="5537831">2</span>&nbsp;<span class="op" id="5537833">||</span>&nbsp;<span class="ident" id="5537836">str</span><span class="op" id="5537839">[</span><span class="num" id="5537840">0</span><span class="op" id="5537841">]</span>&nbsp;<span class="op" id="5537843">!=</span>&nbsp;<span class="string" id="5537846">&#39;$&#39;</span>&nbsp;<span class="op" id="5537850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537854">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537865">brace</span>&nbsp;<span class="op" id="5537871">:=</span>&nbsp;<span class="builtintype" id="5537874">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537881">if</span>&nbsp;<span class="ident" id="5537884">str</span><span class="op" id="5537887">[</span><span class="num" id="5537888">1</span><span class="op" id="5537889">]</span>&nbsp;<span class="op" id="5537891">==</span>&nbsp;<span class="string" id="5537894">&#39;{&#39;</span>&nbsp;<span class="op" id="5537898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537902">brace</span>&nbsp;<span class="op" id="5537908">=</span>&nbsp;<span class="builtintype" id="5537910">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537917">str</span>&nbsp;<span class="op" id="5537921">=</span>&nbsp;<span class="ident" id="5537923">str</span><span class="op" id="5537926">[</span><span class="num" id="5537927">2</span><span class="op" id="5537928">:</span><span class="op" id="5537929">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537932">}</span>&nbsp;<span class="keyword" id="5537934">else</span>&nbsp;<span class="op" id="5537939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537943">str</span>&nbsp;<span class="op" id="5537947">=</span>&nbsp;<span class="ident" id="5537949">str</span><span class="op" id="5537952">[</span><span class="num" id="5537953">1</span><span class="op" id="5537954">:</span><span class="op" id="5537955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537961">i</span>&nbsp;<span class="op" id="5537963">:=</span>&nbsp;<span class="num" id="5537966">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537969">for</span>&nbsp;<span class="ident" id="5537973">i</span>&nbsp;<span class="op" id="5537975">&lt;</span>&nbsp;<span class="builtinfunc" id="5537977">len</span><span class="op" id="5537980">(</span><span class="ident" id="5537981">str</span><span class="op" id="5537984">)</span>&nbsp;<span class="op" id="5537986">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5537990">rune</span><span class="op" id="5537994">,</span>&nbsp;<span class="ident" id="5537996">size</span>&nbsp;<span class="op" id="5538001">:=</span>&nbsp;<span class="ident" id="5538004">utf8</span><span class="op" id="5538008">.</span><span class="ident" id="5538009">DecodeRuneInString</span><span class="op" id="5538027">(</span><span class="ident" id="5538028">str</span><span class="op" id="5538031">[</span><span class="ident" id="5538032">i</span><span class="op" id="5538033">:</span><span class="op" id="5538034">]</span><span class="op" id="5538035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538039">if</span>&nbsp;<span class="op" id="5538042">!</span><span class="ident" id="5538043">unicode</span><span class="op" id="5538050">.</span><span class="ident" id="5538051">IsLetter</span><span class="op" id="5538059">(</span><span class="builtintype" id="5538060">rune</span><span class="op" id="5538064">)</span>&nbsp;<span class="op" id="5538066">&amp;&amp;</span>&nbsp;<span class="op" id="5538069">!</span><span class="ident" id="5538070">unicode</span><span class="op" id="5538077">.</span><span class="ident" id="5538078">IsDigit</span><span class="op" id="5538085">(</span><span class="builtintype" id="5538086">rune</span><span class="op" id="5538090">)</span>&nbsp;<span class="op" id="5538092">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5538095">rune</span>&nbsp;<span class="op" id="5538100">!=</span>&nbsp;<span class="string" id="5538103">&#39;_&#39;</span>&nbsp;<span class="op" id="5538107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538112">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538124">i</span>&nbsp;<span class="op" id="5538126">+=</span>&nbsp;<span class="ident" id="5538129">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538138">if</span>&nbsp;<span class="ident" id="5538141">i</span>&nbsp;<span class="op" id="5538143">==</span>&nbsp;<span class="num" id="5538146">0</span>&nbsp;<span class="op" id="5538148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538152">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538188">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538191">name</span>&nbsp;<span class="op" id="5538196">=</span>&nbsp;<span class="ident" id="5538198">str</span><span class="op" id="5538201">[</span><span class="op" id="5538202">:</span><span class="ident" id="5538203">i</span><span class="op" id="5538204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538207">if</span>&nbsp;<span class="ident" id="5538210">brace</span>&nbsp;<span class="op" id="5538216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538220">if</span>&nbsp;<span class="ident" id="5538223">i</span>&nbsp;<span class="op" id="5538225">&gt;=</span>&nbsp;<span class="builtinfunc" id="5538228">len</span><span class="op" id="5538231">(</span><span class="ident" id="5538232">str</span><span class="op" id="5538235">)</span>&nbsp;<span class="op" id="5538237">||</span>&nbsp;<span class="ident" id="5538240">str</span><span class="op" id="5538243">[</span><span class="ident" id="5538244">i</span><span class="op" id="5538245">]</span>&nbsp;<span class="op" id="5538247">!=</span>&nbsp;<span class="string" id="5538250">&#39;}&#39;</span>&nbsp;<span class="op" id="5538254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538259">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538287">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538300">i</span><span class="op" id="5538301">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538309">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538327">num</span>&nbsp;<span class="op" id="5538331">=</span>&nbsp;<span class="num" id="5538333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538336">for</span>&nbsp;<span class="ident" id="5538340">i</span>&nbsp;<span class="op" id="5538342">:=</span>&nbsp;<span class="num" id="5538345">0</span><span class="op" id="5538346">;</span>&nbsp;<span class="ident" id="5538348">i</span>&nbsp;<span class="op" id="5538350">&lt;</span>&nbsp;<span class="builtinfunc" id="5538352">len</span><span class="op" id="5538355">(</span><span class="ident" id="5538356">name</span><span class="op" id="5538360">)</span><span class="op" id="5538361">;</span>&nbsp;<span class="ident" id="5538363">i</span><span class="op" id="5538364">++</span>&nbsp;<span class="op" id="5538367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538371">if</span>&nbsp;<span class="ident" id="5538374">name</span><span class="op" id="5538378">[</span><span class="ident" id="5538379">i</span><span class="op" id="5538380">]</span>&nbsp;<span class="op" id="5538382">&lt;</span>&nbsp;<span class="string" id="5538384">&#39;0&#39;</span>&nbsp;<span class="op" id="5538388">||</span>&nbsp;<span class="string" id="5538391">&#39;9&#39;</span>&nbsp;<span class="op" id="5538395">&lt;</span>&nbsp;<span class="ident" id="5538397">name</span><span class="op" id="5538401">[</span><span class="ident" id="5538402">i</span><span class="op" id="5538403">]</span>&nbsp;<span class="op" id="5538405">||</span>&nbsp;<span class="ident" id="5538408">num</span>&nbsp;<span class="op" id="5538412">&gt;=</span>&nbsp;<span class="num" id="5538415">1e8</span>&nbsp;<span class="op" id="5538419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538424">num</span>&nbsp;<span class="op" id="5538428">=</span>&nbsp;<span class="op" id="5538430">-</span><span class="num" id="5538431">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538436">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538448">num</span>&nbsp;<span class="op" id="5538452">=</span>&nbsp;<span class="ident" id="5538454">num</span><span class="op" id="5538457">*</span><span class="num" id="5538458">10</span>&nbsp;<span class="op" id="5538461">+</span>&nbsp;<span class="builtintype" id="5538463">int</span><span class="op" id="5538466">(</span><span class="ident" id="5538467">name</span><span class="op" id="5538471">[</span><span class="ident" id="5538472">i</span><span class="op" id="5538473">]</span><span class="op" id="5538474">)</span>&nbsp;<span class="op" id="5538476">-</span>&nbsp;<span class="string" id="5538478">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538486">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538514">if</span>&nbsp;<span class="ident" id="5538517">name</span><span class="op" id="5538521">[</span><span class="num" id="5538522">0</span><span class="op" id="5538523">]</span>&nbsp;<span class="op" id="5538525">==</span>&nbsp;<span class="string" id="5538528">&#39;0&#39;</span>&nbsp;<span class="op" id="5538532">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5538535">len</span><span class="op" id="5538538">(</span><span class="ident" id="5538539">name</span><span class="op" id="5538543">)</span>&nbsp;<span class="op" id="5538545">&gt;</span>&nbsp;<span class="num" id="5538547">1</span>&nbsp;<span class="op" id="5538549">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538553">num</span>&nbsp;<span class="op" id="5538557">=</span>&nbsp;<span class="op" id="5538559">-</span><span class="num" id="5538560">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538567">rest</span>&nbsp;<span class="op" id="5538572">=</span>&nbsp;<span class="ident" id="5538574">str</span><span class="op" id="5538577">[</span><span class="ident" id="5538578">i</span><span class="op" id="5538579">:</span><span class="op" id="5538580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538583">ok</span>&nbsp;<span class="op" id="5538586">=</span>&nbsp;<span class="builtintype" id="5538588">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538594">return</span><br>
<span class="lineno"></span><span class="op" id="5538601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538604">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5538681">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="5538758">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="5538835">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5538862">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5538907">func</span>&nbsp;<span class="op" id="5538912">(</span><span class="ident" id="5538913">re</span>&nbsp;<span class="op" id="5538916">*</span><span class="ident" id="5538917">Regexp</span><span class="op" id="5538923">)</span>&nbsp;<span class="ident" id="5538925">FindSubmatchIndex</span><span class="op" id="5538942">(</span><span class="ident" id="5538943">b</span>&nbsp;<span class="op" id="5538945">[</span><span class="op" id="5538946">]</span><span class="builtintype" id="5538947">byte</span><span class="op" id="5538951">)</span>&nbsp;<span class="op" id="5538953">[</span><span class="op" id="5538954">]</span><span class="builtintype" id="5538955">int</span>&nbsp;<span class="op" id="5538959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538962">return</span>&nbsp;<span class="ident" id="5538969">re</span><span class="op" id="5538971">.</span><span class="ident" id="5538972">pad</span><span class="op" id="5538975">(</span><span class="ident" id="5538976">re</span><span class="op" id="5538978">.</span><span class="ident" id="5538979">doExecute</span><span class="op" id="5538988">(</span><span class="ident" id="5538989">nil</span><span class="op" id="5538992">,</span>&nbsp;<span class="ident" id="5538994">b</span><span class="op" id="5538995">,</span>&nbsp;<span class="string" id="5538997">&#34;&#34;</span><span class="op" id="5538999">,</span>&nbsp;<span class="num" id="5539001">0</span><span class="op" id="5539002">,</span>&nbsp;<span class="ident" id="5539004">re</span><span class="op" id="5539006">.</span><span class="ident" id="5539007">prog</span><span class="op" id="5539011">.</span><span class="ident" id="5539012">NumCap</span><span class="op" id="5539018">)</span><span class="op" id="5539019">)</span><br>
<span class="lineno">875</span><span class="op" id="5539021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539024">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5539097">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5539174">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="5539245">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5539265">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5539310">func</span>&nbsp;<span class="op" id="5539315">(</span><span class="ident" id="5539316">re</span>&nbsp;<span class="op" id="5539319">*</span><span class="ident" id="5539320">Regexp</span><span class="op" id="5539326">)</span>&nbsp;<span class="ident" id="5539328">FindStringSubmatch</span><span class="op" id="5539346">(</span><span class="ident" id="5539347">s</span>&nbsp;<span class="builtintype" id="5539349">string</span><span class="op" id="5539355">)</span>&nbsp;<span class="op" id="5539357">[</span><span class="op" id="5539358">]</span><span class="builtintype" id="5539359">string</span>&nbsp;<span class="op" id="5539366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539369">a</span>&nbsp;<span class="op" id="5539371">:=</span>&nbsp;<span class="ident" id="5539374">re</span><span class="op" id="5539376">.</span><span class="ident" id="5539377">doExecute</span><span class="op" id="5539386">(</span><span class="ident" id="5539387">nil</span><span class="op" id="5539390">,</span>&nbsp;<span class="ident" id="5539392">nil</span><span class="op" id="5539395">,</span>&nbsp;<span class="ident" id="5539397">s</span><span class="op" id="5539398">,</span>&nbsp;<span class="num" id="5539400">0</span><span class="op" id="5539401">,</span>&nbsp;<span class="ident" id="5539403">re</span><span class="op" id="5539405">.</span><span class="ident" id="5539406">prog</span><span class="op" id="5539410">.</span><span class="ident" id="5539411">NumCap</span><span class="op" id="5539417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539420">if</span>&nbsp;<span class="ident" id="5539423">a</span>&nbsp;<span class="op" id="5539425">==</span>&nbsp;<span class="ident" id="5539428">nil</span>&nbsp;<span class="op" id="5539432">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539436">return</span>&nbsp;<span class="ident" id="5539443">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539451">ret</span>&nbsp;<span class="op" id="5539455">:=</span>&nbsp;<span class="builtinfunc" id="5539458">make</span><span class="op" id="5539462">(</span><span class="op" id="5539463">[</span><span class="op" id="5539464">]</span><span class="builtintype" id="5539465">string</span><span class="op" id="5539471">,</span>&nbsp;<span class="num" id="5539473">1</span><span class="op" id="5539474">+</span><span class="ident" id="5539475">re</span><span class="op" id="5539477">.</span><span class="ident" id="5539478">numSubexp</span><span class="op" id="5539487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539490">for</span>&nbsp;<span class="ident" id="5539494">i</span>&nbsp;<span class="op" id="5539496">:=</span>&nbsp;<span class="keyword" id="5539499">range</span>&nbsp;<span class="ident" id="5539505">ret</span>&nbsp;<span class="op" id="5539509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539513">if</span>&nbsp;<span class="num" id="5539516">2</span><span class="op" id="5539517">*</span><span class="ident" id="5539518">i</span>&nbsp;<span class="op" id="5539520">&lt;</span>&nbsp;<span class="builtinfunc" id="5539522">len</span><span class="op" id="5539525">(</span><span class="ident" id="5539526">a</span><span class="op" id="5539527">)</span>&nbsp;<span class="op" id="5539529">&amp;&amp;</span>&nbsp;<span class="ident" id="5539532">a</span><span class="op" id="5539533">[</span><span class="num" id="5539534">2</span><span class="op" id="5539535">*</span><span class="ident" id="5539536">i</span><span class="op" id="5539537">]</span>&nbsp;<span class="op" id="5539539">&gt;=</span>&nbsp;<span class="num" id="5539542">0</span>&nbsp;<span class="op" id="5539544">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539549">ret</span><span class="op" id="5539552">[</span><span class="ident" id="5539553">i</span><span class="op" id="5539554">]</span>&nbsp;<span class="op" id="5539556">=</span>&nbsp;<span class="ident" id="5539558">s</span><span class="op" id="5539559">[</span><span class="ident" id="5539560">a</span><span class="op" id="5539561">[</span><span class="num" id="5539562">2</span><span class="op" id="5539563">*</span><span class="ident" id="5539564">i</span><span class="op" id="5539565">]</span><span class="op" id="5539566">:</span><span class="ident" id="5539567">a</span><span class="op" id="5539568">[</span><span class="num" id="5539569">2</span><span class="op" id="5539570">*</span><span class="ident" id="5539571">i</span><span class="op" id="5539572">+</span><span class="num" id="5539573">1</span><span class="op" id="5539574">]</span><span class="op" id="5539575">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539585">return</span>&nbsp;<span class="ident" id="5539592">ret</span><br>
<span class="lineno"></span><span class="op" id="5539596">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="5539599">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5539666">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5539739">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5539815">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="5539863">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5539908">func</span>&nbsp;<span class="op" id="5539913">(</span><span class="ident" id="5539914">re</span>&nbsp;<span class="op" id="5539917">*</span><span class="ident" id="5539918">Regexp</span><span class="op" id="5539924">)</span>&nbsp;<span class="ident" id="5539926">FindStringSubmatchIndex</span><span class="op" id="5539949">(</span><span class="ident" id="5539950">s</span>&nbsp;<span class="builtintype" id="5539952">string</span><span class="op" id="5539958">)</span>&nbsp;<span class="op" id="5539960">[</span><span class="op" id="5539961">]</span><span class="builtintype" id="5539962">int</span>&nbsp;<span class="op" id="5539966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539969">return</span>&nbsp;<span class="ident" id="5539976">re</span><span class="op" id="5539978">.</span><span class="ident" id="5539979">pad</span><span class="op" id="5539982">(</span><span class="ident" id="5539983">re</span><span class="op" id="5539985">.</span><span class="ident" id="5539986">doExecute</span><span class="op" id="5539995">(</span><span class="ident" id="5539996">nil</span><span class="op" id="5539999">,</span>&nbsp;<span class="ident" id="5540001">nil</span><span class="op" id="5540004">,</span>&nbsp;<span class="ident" id="5540006">s</span><span class="op" id="5540007">,</span>&nbsp;<span class="num" id="5540009">0</span><span class="op" id="5540010">,</span>&nbsp;<span class="ident" id="5540012">re</span><span class="op" id="5540014">.</span><span class="ident" id="5540015">prog</span><span class="op" id="5540019">.</span><span class="ident" id="5540020">NumCap</span><span class="op" id="5540026">)</span><span class="op" id="5540027">)</span><br>
<span class="lineno"></span><span class="op" id="5540029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5540032">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5540099">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5540175">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="5540253">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="5540326">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="5540369">func</span>&nbsp;<span class="op" id="5540374">(</span><span class="ident" id="5540375">re</span>&nbsp;<span class="op" id="5540378">*</span><span class="ident" id="5540379">Regexp</span><span class="op" id="5540385">)</span>&nbsp;<span class="ident" id="5540387">FindReaderSubmatchIndex</span><span class="op" id="5540410">(</span><span class="ident" id="5540411">r</span>&nbsp;<span class="ident" id="5540413">io</span><span class="op" id="5540415">.</span><span class="ident" id="5540416">RuneReader</span><span class="op" id="5540426">)</span>&nbsp;<span class="op" id="5540428">[</span><span class="op" id="5540429">]</span><span class="builtintype" id="5540430">int</span>&nbsp;<span class="op" id="5540434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540437">return</span>&nbsp;<span class="ident" id="5540444">re</span><span class="op" id="5540446">.</span><span class="ident" id="5540447">pad</span><span class="op" id="5540450">(</span><span class="ident" id="5540451">re</span><span class="op" id="5540453">.</span><span class="ident" id="5540454">doExecute</span><span class="op" id="5540463">(</span><span class="ident" id="5540464">r</span><span class="op" id="5540465">,</span>&nbsp;<span class="ident" id="5540467">nil</span><span class="op" id="5540470">,</span>&nbsp;<span class="string" id="5540472">&#34;&#34;</span><span class="op" id="5540474">,</span>&nbsp;<span class="num" id="5540476">0</span><span class="op" id="5540477">,</span>&nbsp;<span class="ident" id="5540479">re</span><span class="op" id="5540481">.</span><span class="ident" id="5540482">prog</span><span class="op" id="5540486">.</span><span class="ident" id="5540487">NumCap</span><span class="op" id="5540493">)</span><span class="op" id="5540494">)</span><br>
<span class="lineno"></span><span class="op" id="5540496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5540499">const</span>&nbsp;<span class="ident" id="5540505">startSize</span>&nbsp;<span class="op" id="5540515">=</span>&nbsp;<span class="num" id="5540517">10</span>&nbsp;<span class="comment" id="5540520">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="5540582">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5540660">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5540733">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5540753">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="5540798">func</span>&nbsp;<span class="op" id="5540803">(</span><span class="ident" id="5540804">re</span>&nbsp;<span class="op" id="5540807">*</span><span class="ident" id="5540808">Regexp</span><span class="op" id="5540814">)</span>&nbsp;<span class="ident" id="5540816">FindAll</span><span class="op" id="5540823">(</span><span class="ident" id="5540824">b</span>&nbsp;<span class="op" id="5540826">[</span><span class="op" id="5540827">]</span><span class="builtintype" id="5540828">byte</span><span class="op" id="5540832">,</span>&nbsp;<span class="ident" id="5540834">n</span>&nbsp;<span class="builtintype" id="5540836">int</span><span class="op" id="5540839">)</span>&nbsp;<span class="op" id="5540841">[</span><span class="op" id="5540842">]</span><span class="op" id="5540843">[</span><span class="op" id="5540844">]</span><span class="builtintype" id="5540845">byte</span>&nbsp;<span class="op" id="5540850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540853">if</span>&nbsp;<span class="ident" id="5540856">n</span>&nbsp;<span class="op" id="5540858">&lt;</span>&nbsp;<span class="num" id="5540860">0</span>&nbsp;<span class="op" id="5540862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540866">n</span>&nbsp;<span class="op" id="5540868">=</span>&nbsp;<span class="builtinfunc" id="5540870">len</span><span class="op" id="5540873">(</span><span class="ident" id="5540874">b</span><span class="op" id="5540875">)</span>&nbsp;<span class="op" id="5540877">+</span>&nbsp;<span class="num" id="5540879">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540885">result</span>&nbsp;<span class="op" id="5540892">:=</span>&nbsp;<span class="builtinfunc" id="5540895">make</span><span class="op" id="5540899">(</span><span class="op" id="5540900">[</span><span class="op" id="5540901">]</span><span class="op" id="5540902">[</span><span class="op" id="5540903">]</span><span class="builtintype" id="5540904">byte</span><span class="op" id="5540908">,</span>&nbsp;<span class="num" id="5540910">0</span><span class="op" id="5540911">,</span>&nbsp;<span class="ident" id="5540913">startSize</span><span class="op" id="5540922">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540925">re</span><span class="op" id="5540927">.</span><span class="ident" id="5540928">allMatches</span><span class="op" id="5540938">(</span><span class="string" id="5540939">&#34;&#34;</span><span class="op" id="5540941">,</span>&nbsp;<span class="ident" id="5540943">b</span><span class="op" id="5540944">,</span>&nbsp;<span class="ident" id="5540946">n</span><span class="op" id="5540947">,</span>&nbsp;<span class="keyword" id="5540949">func</span><span class="op" id="5540953">(</span><span class="ident" id="5540954">match</span>&nbsp;<span class="op" id="5540960">[</span><span class="op" id="5540961">]</span><span class="builtintype" id="5540962">int</span><span class="op" id="5540965">)</span>&nbsp;<span class="op" id="5540967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540971">result</span>&nbsp;<span class="op" id="5540978">=</span>&nbsp;<span class="builtinfunc" id="5540980">append</span><span class="op" id="5540986">(</span><span class="ident" id="5540987">result</span><span class="op" id="5540993">,</span>&nbsp;<span class="ident" id="5540995">b</span><span class="op" id="5540996">[</span><span class="ident" id="5540997">match</span><span class="op" id="5541002">[</span><span class="num" id="5541003">0</span><span class="op" id="5541004">]</span><span class="op" id="5541005">:</span><span class="ident" id="5541006">match</span><span class="op" id="5541011">[</span><span class="num" id="5541012">1</span><span class="op" id="5541013">]</span><span class="op" id="5541014">]</span><span class="op" id="5541015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541018">}</span><span class="op" id="5541019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541022">if</span>&nbsp;<span class="builtinfunc" id="5541025">len</span><span class="op" id="5541028">(</span><span class="ident" id="5541029">result</span><span class="op" id="5541035">)</span>&nbsp;<span class="op" id="5541037">==</span>&nbsp;<span class="num" id="5541040">0</span>&nbsp;<span class="op" id="5541042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541046">return</span>&nbsp;<span class="ident" id="5541053">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541061">return</span>&nbsp;<span class="ident" id="5541068">result</span><br>
<span class="lineno"></span><span class="op" id="5541075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541078">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="5541155">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5541232">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5541259">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5541304">func</span>&nbsp;<span class="op" id="5541309">(</span><span class="ident" id="5541310">re</span>&nbsp;<span class="op" id="5541313">*</span><span class="ident" id="5541314">Regexp</span><span class="op" id="5541320">)</span>&nbsp;<span class="ident" id="5541322">FindAllIndex</span><span class="op" id="5541334">(</span><span class="ident" id="5541335">b</span>&nbsp;<span class="op" id="5541337">[</span><span class="op" id="5541338">]</span><span class="builtintype" id="5541339">byte</span><span class="op" id="5541343">,</span>&nbsp;<span class="ident" id="5541345">n</span>&nbsp;<span class="builtintype" id="5541347">int</span><span class="op" id="5541350">)</span>&nbsp;<span class="op" id="5541352">[</span><span class="op" id="5541353">]</span><span class="op" id="5541354">[</span><span class="op" id="5541355">]</span><span class="builtintype" id="5541356">int</span>&nbsp;<span class="op" id="5541360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541363">if</span>&nbsp;<span class="ident" id="5541366">n</span>&nbsp;<span class="op" id="5541368">&lt;</span>&nbsp;<span class="num" id="5541370">0</span>&nbsp;<span class="op" id="5541372">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541376">n</span>&nbsp;<span class="op" id="5541378">=</span>&nbsp;<span class="builtinfunc" id="5541380">len</span><span class="op" id="5541383">(</span><span class="ident" id="5541384">b</span><span class="op" id="5541385">)</span>&nbsp;<span class="op" id="5541387">+</span>&nbsp;<span class="num" id="5541389">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541395">result</span>&nbsp;<span class="op" id="5541402">:=</span>&nbsp;<span class="builtinfunc" id="5541405">make</span><span class="op" id="5541409">(</span><span class="op" id="5541410">[</span><span class="op" id="5541411">]</span><span class="op" id="5541412">[</span><span class="op" id="5541413">]</span><span class="builtintype" id="5541414">int</span><span class="op" id="5541417">,</span>&nbsp;<span class="num" id="5541419">0</span><span class="op" id="5541420">,</span>&nbsp;<span class="ident" id="5541422">startSize</span><span class="op" id="5541431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541434">re</span><span class="op" id="5541436">.</span><span class="ident" id="5541437">allMatches</span><span class="op" id="5541447">(</span><span class="string" id="5541448">&#34;&#34;</span><span class="op" id="5541450">,</span>&nbsp;<span class="ident" id="5541452">b</span><span class="op" id="5541453">,</span>&nbsp;<span class="ident" id="5541455">n</span><span class="op" id="5541456">,</span>&nbsp;<span class="keyword" id="5541458">func</span><span class="op" id="5541462">(</span><span class="ident" id="5541463">match</span>&nbsp;<span class="op" id="5541469">[</span><span class="op" id="5541470">]</span><span class="builtintype" id="5541471">int</span><span class="op" id="5541474">)</span>&nbsp;<span class="op" id="5541476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541480">result</span>&nbsp;<span class="op" id="5541487">=</span>&nbsp;<span class="builtinfunc" id="5541489">append</span><span class="op" id="5541495">(</span><span class="ident" id="5541496">result</span><span class="op" id="5541502">,</span>&nbsp;<span class="ident" id="5541504">match</span><span class="op" id="5541509">[</span><span class="num" id="5541510">0</span><span class="op" id="5541511">:</span><span class="num" id="5541512">2</span><span class="op" id="5541513">]</span><span class="op" id="5541514">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541517">}</span><span class="op" id="5541518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541521">if</span>&nbsp;<span class="builtinfunc" id="5541524">len</span><span class="op" id="5541527">(</span><span class="ident" id="5541528">result</span><span class="op" id="5541534">)</span>&nbsp;<span class="op" id="5541536">==</span>&nbsp;<span class="num" id="5541539">0</span>&nbsp;<span class="op" id="5541541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541545">return</span>&nbsp;<span class="ident" id="5541552">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541560">return</span>&nbsp;<span class="ident" id="5541567">result</span><br>
<span class="lineno">950</span><span class="op" id="5541574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541577">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5541656">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5541733">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="5541760">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5541805">func</span>&nbsp;<span class="op" id="5541810">(</span><span class="ident" id="5541811">re</span>&nbsp;<span class="op" id="5541814">*</span><span class="ident" id="5541815">Regexp</span><span class="op" id="5541821">)</span>&nbsp;<span class="ident" id="5541823">FindAllString</span><span class="op" id="5541836">(</span><span class="ident" id="5541837">s</span>&nbsp;<span class="builtintype" id="5541839">string</span><span class="op" id="5541845">,</span>&nbsp;<span class="ident" id="5541847">n</span>&nbsp;<span class="builtintype" id="5541849">int</span><span class="op" id="5541852">)</span>&nbsp;<span class="op" id="5541854">[</span><span class="op" id="5541855">]</span><span class="builtintype" id="5541856">string</span>&nbsp;<span class="op" id="5541863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541866">if</span>&nbsp;<span class="ident" id="5541869">n</span>&nbsp;<span class="op" id="5541871">&lt;</span>&nbsp;<span class="num" id="5541873">0</span>&nbsp;<span class="op" id="5541875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541879">n</span>&nbsp;<span class="op" id="5541881">=</span>&nbsp;<span class="builtinfunc" id="5541883">len</span><span class="op" id="5541886">(</span><span class="ident" id="5541887">s</span><span class="op" id="5541888">)</span>&nbsp;<span class="op" id="5541890">+</span>&nbsp;<span class="num" id="5541892">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541895">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541898">result</span>&nbsp;<span class="op" id="5541905">:=</span>&nbsp;<span class="builtinfunc" id="5541908">make</span><span class="op" id="5541912">(</span><span class="op" id="5541913">[</span><span class="op" id="5541914">]</span><span class="builtintype" id="5541915">string</span><span class="op" id="5541921">,</span>&nbsp;<span class="num" id="5541923">0</span><span class="op" id="5541924">,</span>&nbsp;<span class="ident" id="5541926">startSize</span><span class="op" id="5541935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541938">re</span><span class="op" id="5541940">.</span><span class="ident" id="5541941">allMatches</span><span class="op" id="5541951">(</span><span class="ident" id="5541952">s</span><span class="op" id="5541953">,</span>&nbsp;<span class="ident" id="5541955">nil</span><span class="op" id="5541958">,</span>&nbsp;<span class="ident" id="5541960">n</span><span class="op" id="5541961">,</span>&nbsp;<span class="keyword" id="5541963">func</span><span class="op" id="5541967">(</span><span class="ident" id="5541968">match</span>&nbsp;<span class="op" id="5541974">[</span><span class="op" id="5541975">]</span><span class="builtintype" id="5541976">int</span><span class="op" id="5541979">)</span>&nbsp;<span class="op" id="5541981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541985">result</span>&nbsp;<span class="op" id="5541992">=</span>&nbsp;<span class="builtinfunc" id="5541994">append</span><span class="op" id="5542000">(</span><span class="ident" id="5542001">result</span><span class="op" id="5542007">,</span>&nbsp;<span class="ident" id="5542009">s</span><span class="op" id="5542010">[</span><span class="ident" id="5542011">match</span><span class="op" id="5542016">[</span><span class="num" id="5542017">0</span><span class="op" id="5542018">]</span><span class="op" id="5542019">:</span><span class="ident" id="5542020">match</span><span class="op" id="5542025">[</span><span class="num" id="5542026">1</span><span class="op" id="5542027">]</span><span class="op" id="5542028">]</span><span class="op" id="5542029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542032">}</span><span class="op" id="5542033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542036">if</span>&nbsp;<span class="builtinfunc" id="5542039">len</span><span class="op" id="5542042">(</span><span class="ident" id="5542043">result</span><span class="op" id="5542049">)</span>&nbsp;<span class="op" id="5542051">==</span>&nbsp;<span class="num" id="5542054">0</span>&nbsp;<span class="op" id="5542056">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542060">return</span>&nbsp;<span class="ident" id="5542067">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542075">return</span>&nbsp;<span class="ident" id="5542082">result</span><br>
<span class="lineno"></span><span class="op" id="5542089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="5542092">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5542168">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="5542246">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5542285">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5542330">func</span>&nbsp;<span class="op" id="5542335">(</span><span class="ident" id="5542336">re</span>&nbsp;<span class="op" id="5542339">*</span><span class="ident" id="5542340">Regexp</span><span class="op" id="5542346">)</span>&nbsp;<span class="ident" id="5542348">FindAllStringIndex</span><span class="op" id="5542366">(</span><span class="ident" id="5542367">s</span>&nbsp;<span class="builtintype" id="5542369">string</span><span class="op" id="5542375">,</span>&nbsp;<span class="ident" id="5542377">n</span>&nbsp;<span class="builtintype" id="5542379">int</span><span class="op" id="5542382">)</span>&nbsp;<span class="op" id="5542384">[</span><span class="op" id="5542385">]</span><span class="op" id="5542386">[</span><span class="op" id="5542387">]</span><span class="builtintype" id="5542388">int</span>&nbsp;<span class="op" id="5542392">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542395">if</span>&nbsp;<span class="ident" id="5542398">n</span>&nbsp;<span class="op" id="5542400">&lt;</span>&nbsp;<span class="num" id="5542402">0</span>&nbsp;<span class="op" id="5542404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542408">n</span>&nbsp;<span class="op" id="5542410">=</span>&nbsp;<span class="builtinfunc" id="5542412">len</span><span class="op" id="5542415">(</span><span class="ident" id="5542416">s</span><span class="op" id="5542417">)</span>&nbsp;<span class="op" id="5542419">+</span>&nbsp;<span class="num" id="5542421">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542427">result</span>&nbsp;<span class="op" id="5542434">:=</span>&nbsp;<span class="builtinfunc" id="5542437">make</span><span class="op" id="5542441">(</span><span class="op" id="5542442">[</span><span class="op" id="5542443">]</span><span class="op" id="5542444">[</span><span class="op" id="5542445">]</span><span class="builtintype" id="5542446">int</span><span class="op" id="5542449">,</span>&nbsp;<span class="num" id="5542451">0</span><span class="op" id="5542452">,</span>&nbsp;<span class="ident" id="5542454">startSize</span><span class="op" id="5542463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542466">re</span><span class="op" id="5542468">.</span><span class="ident" id="5542469">allMatches</span><span class="op" id="5542479">(</span><span class="ident" id="5542480">s</span><span class="op" id="5542481">,</span>&nbsp;<span class="ident" id="5542483">nil</span><span class="op" id="5542486">,</span>&nbsp;<span class="ident" id="5542488">n</span><span class="op" id="5542489">,</span>&nbsp;<span class="keyword" id="5542491">func</span><span class="op" id="5542495">(</span><span class="ident" id="5542496">match</span>&nbsp;<span class="op" id="5542502">[</span><span class="op" id="5542503">]</span><span class="builtintype" id="5542504">int</span><span class="op" id="5542507">)</span>&nbsp;<span class="op" id="5542509">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542513">result</span>&nbsp;<span class="op" id="5542520">=</span>&nbsp;<span class="builtinfunc" id="5542522">append</span><span class="op" id="5542528">(</span><span class="ident" id="5542529">result</span><span class="op" id="5542535">,</span>&nbsp;<span class="ident" id="5542537">match</span><span class="op" id="5542542">[</span><span class="num" id="5542543">0</span><span class="op" id="5542544">:</span><span class="num" id="5542545">2</span><span class="op" id="5542546">]</span><span class="op" id="5542547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542550">}</span><span class="op" id="5542551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542554">if</span>&nbsp;<span class="builtinfunc" id="5542557">len</span><span class="op" id="5542560">(</span><span class="ident" id="5542561">result</span><span class="op" id="5542567">)</span>&nbsp;<span class="op" id="5542569">==</span>&nbsp;<span class="num" id="5542572">0</span>&nbsp;<span class="op" id="5542574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542578">return</span>&nbsp;<span class="ident" id="5542585">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542590">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542593">return</span>&nbsp;<span class="ident" id="5542600">result</span><br>
<span class="lineno"></span><span class="op" id="5542607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5542610">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5542686">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="5542758">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5542797">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5542842">func</span>&nbsp;<span class="op" id="5542847">(</span><span class="ident" id="5542848">re</span>&nbsp;<span class="op" id="5542851">*</span><span class="ident" id="5542852">Regexp</span><span class="op" id="5542858">)</span>&nbsp;<span class="ident" id="5542860">FindAllSubmatch</span><span class="op" id="5542875">(</span><span class="ident" id="5542876">b</span>&nbsp;<span class="op" id="5542878">[</span><span class="op" id="5542879">]</span><span class="builtintype" id="5542880">byte</span><span class="op" id="5542884">,</span>&nbsp;<span class="ident" id="5542886">n</span>&nbsp;<span class="builtintype" id="5542888">int</span><span class="op" id="5542891">)</span>&nbsp;<span class="op" id="5542893">[</span><span class="op" id="5542894">]</span><span class="op" id="5542895">[</span><span class="op" id="5542896">]</span><span class="op" id="5542897">[</span><span class="op" id="5542898">]</span><span class="builtintype" id="5542899">byte</span>&nbsp;<span class="op" id="5542904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542907">if</span>&nbsp;<span class="ident" id="5542910">n</span>&nbsp;<span class="op" id="5542912">&lt;</span>&nbsp;<span class="num" id="5542914">0</span>&nbsp;<span class="op" id="5542916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542920">n</span>&nbsp;<span class="op" id="5542922">=</span>&nbsp;<span class="builtinfunc" id="5542924">len</span><span class="op" id="5542927">(</span><span class="ident" id="5542928">b</span><span class="op" id="5542929">)</span>&nbsp;<span class="op" id="5542931">+</span>&nbsp;<span class="num" id="5542933">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542939">result</span>&nbsp;<span class="op" id="5542946">:=</span>&nbsp;<span class="builtinfunc" id="5542949">make</span><span class="op" id="5542953">(</span><span class="op" id="5542954">[</span><span class="op" id="5542955">]</span><span class="op" id="5542956">[</span><span class="op" id="5542957">]</span><span class="op" id="5542958">[</span><span class="op" id="5542959">]</span><span class="builtintype" id="5542960">byte</span><span class="op" id="5542964">,</span>&nbsp;<span class="num" id="5542966">0</span><span class="op" id="5542967">,</span>&nbsp;<span class="ident" id="5542969">startSize</span><span class="op" id="5542978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542981">re</span><span class="op" id="5542983">.</span><span class="ident" id="5542984">allMatches</span><span class="op" id="5542994">(</span><span class="string" id="5542995">&#34;&#34;</span><span class="op" id="5542997">,</span>&nbsp;<span class="ident" id="5542999">b</span><span class="op" id="5543000">,</span>&nbsp;<span class="ident" id="5543002">n</span><span class="op" id="5543003">,</span>&nbsp;<span class="keyword" id="5543005">func</span><span class="op" id="5543009">(</span><span class="ident" id="5543010">match</span>&nbsp;<span class="op" id="5543016">[</span><span class="op" id="5543017">]</span><span class="builtintype" id="5543018">int</span><span class="op" id="5543021">)</span>&nbsp;<span class="op" id="5543023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543027">slice</span>&nbsp;<span class="op" id="5543033">:=</span>&nbsp;<span class="builtinfunc" id="5543036">make</span><span class="op" id="5543040">(</span><span class="op" id="5543041">[</span><span class="op" id="5543042">]</span><span class="op" id="5543043">[</span><span class="op" id="5543044">]</span><span class="builtintype" id="5543045">byte</span><span class="op" id="5543049">,</span>&nbsp;<span class="builtinfunc" id="5543051">len</span><span class="op" id="5543054">(</span><span class="ident" id="5543055">match</span><span class="op" id="5543060">)</span><span class="op" id="5543061">/</span><span class="num" id="5543062">2</span><span class="op" id="5543063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543067">for</span>&nbsp;<span class="ident" id="5543071">j</span>&nbsp;<span class="op" id="5543073">:=</span>&nbsp;<span class="keyword" id="5543076">range</span>&nbsp;<span class="ident" id="5543082">slice</span>&nbsp;<span class="op" id="5543088">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543093">if</span>&nbsp;<span class="ident" id="5543096">match</span><span class="op" id="5543101">[</span><span class="num" id="5543102">2</span><span class="op" id="5543103">*</span><span class="ident" id="5543104">j</span><span class="op" id="5543105">]</span>&nbsp;<span class="op" id="5543107">&gt;=</span>&nbsp;<span class="num" id="5543110">0</span>&nbsp;<span class="op" id="5543112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543118">slice</span><span class="op" id="5543123">[</span><span class="ident" id="5543124">j</span><span class="op" id="5543125">]</span>&nbsp;<span class="op" id="5543127">=</span>&nbsp;<span class="ident" id="5543129">b</span><span class="op" id="5543130">[</span><span class="ident" id="5543131">match</span><span class="op" id="5543136">[</span><span class="num" id="5543137">2</span><span class="op" id="5543138">*</span><span class="ident" id="5543139">j</span><span class="op" id="5543140">]</span><span class="op" id="5543141">:</span><span class="ident" id="5543142">match</span><span class="op" id="5543147">[</span><span class="num" id="5543148">2</span><span class="op" id="5543149">*</span><span class="ident" id="5543150">j</span><span class="op" id="5543151">+</span><span class="num" id="5543152">1</span><span class="op" id="5543153">]</span><span class="op" id="5543154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543167">result</span>&nbsp;<span class="op" id="5543174">=</span>&nbsp;<span class="builtinfunc" id="5543176">append</span><span class="op" id="5543182">(</span><span class="ident" id="5543183">result</span><span class="op" id="5543189">,</span>&nbsp;<span class="ident" id="5543191">slice</span><span class="op" id="5543196">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543199">}</span><span class="op" id="5543200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543203">if</span>&nbsp;<span class="builtinfunc" id="5543206">len</span><span class="op" id="5543209">(</span><span class="ident" id="5543210">result</span><span class="op" id="5543216">)</span>&nbsp;<span class="op" id="5543218">==</span>&nbsp;<span class="num" id="5543221">0</span>&nbsp;<span class="op" id="5543223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543227">return</span>&nbsp;<span class="ident" id="5543234">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543242">return</span>&nbsp;<span class="ident" id="5543249">result</span><br>
<span class="lineno">1010</span><span class="op" id="5543256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5543259">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5543337">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5543411">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="5543456">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5543501">func</span>&nbsp;<span class="op" id="5543506">(</span><span class="ident" id="5543507">re</span>&nbsp;<span class="op" id="5543510">*</span><span class="ident" id="5543511">Regexp</span><span class="op" id="5543517">)</span>&nbsp;<span class="ident" id="5543519">FindAllSubmatchIndex</span><span class="op" id="5543539">(</span><span class="ident" id="5543540">b</span>&nbsp;<span class="op" id="5543542">[</span><span class="op" id="5543543">]</span><span class="builtintype" id="5543544">byte</span><span class="op" id="5543548">,</span>&nbsp;<span class="ident" id="5543550">n</span>&nbsp;<span class="builtintype" id="5543552">int</span><span class="op" id="5543555">)</span>&nbsp;<span class="op" id="5543557">[</span><span class="op" id="5543558">]</span><span class="op" id="5543559">[</span><span class="op" id="5543560">]</span><span class="builtintype" id="5543561">int</span>&nbsp;<span class="op" id="5543565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543568">if</span>&nbsp;<span class="ident" id="5543571">n</span>&nbsp;<span class="op" id="5543573">&lt;</span>&nbsp;<span class="num" id="5543575">0</span>&nbsp;<span class="op" id="5543577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543581">n</span>&nbsp;<span class="op" id="5543583">=</span>&nbsp;<span class="builtinfunc" id="5543585">len</span><span class="op" id="5543588">(</span><span class="ident" id="5543589">b</span><span class="op" id="5543590">)</span>&nbsp;<span class="op" id="5543592">+</span>&nbsp;<span class="num" id="5543594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543597">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543600">result</span>&nbsp;<span class="op" id="5543607">:=</span>&nbsp;<span class="builtinfunc" id="5543610">make</span><span class="op" id="5543614">(</span><span class="op" id="5543615">[</span><span class="op" id="5543616">]</span><span class="op" id="5543617">[</span><span class="op" id="5543618">]</span><span class="builtintype" id="5543619">int</span><span class="op" id="5543622">,</span>&nbsp;<span class="num" id="5543624">0</span><span class="op" id="5543625">,</span>&nbsp;<span class="ident" id="5543627">startSize</span><span class="op" id="5543636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543639">re</span><span class="op" id="5543641">.</span><span class="ident" id="5543642">allMatches</span><span class="op" id="5543652">(</span><span class="string" id="5543653">&#34;&#34;</span><span class="op" id="5543655">,</span>&nbsp;<span class="ident" id="5543657">b</span><span class="op" id="5543658">,</span>&nbsp;<span class="ident" id="5543660">n</span><span class="op" id="5543661">,</span>&nbsp;<span class="keyword" id="5543663">func</span><span class="op" id="5543667">(</span><span class="ident" id="5543668">match</span>&nbsp;<span class="op" id="5543674">[</span><span class="op" id="5543675">]</span><span class="builtintype" id="5543676">int</span><span class="op" id="5543679">)</span>&nbsp;<span class="op" id="5543681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543685">result</span>&nbsp;<span class="op" id="5543692">=</span>&nbsp;<span class="builtinfunc" id="5543694">append</span><span class="op" id="5543700">(</span><span class="ident" id="5543701">result</span><span class="op" id="5543707">,</span>&nbsp;<span class="ident" id="5543709">match</span><span class="op" id="5543714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543717">}</span><span class="op" id="5543718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543721">if</span>&nbsp;<span class="builtinfunc" id="5543724">len</span><span class="op" id="5543727">(</span><span class="ident" id="5543728">result</span><span class="op" id="5543734">)</span>&nbsp;<span class="op" id="5543736">==</span>&nbsp;<span class="num" id="5543739">0</span>&nbsp;<span class="op" id="5543741">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543745">return</span>&nbsp;<span class="ident" id="5543752">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543760">return</span>&nbsp;<span class="ident" id="5543767">result</span><br>
<span class="lineno"></span><span class="op" id="5543774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="5543777">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5543849">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5543927">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5543976">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5544021">func</span>&nbsp;<span class="op" id="5544026">(</span><span class="ident" id="5544027">re</span>&nbsp;<span class="op" id="5544030">*</span><span class="ident" id="5544031">Regexp</span><span class="op" id="5544037">)</span>&nbsp;<span class="ident" id="5544039">FindAllStringSubmatch</span><span class="op" id="5544060">(</span><span class="ident" id="5544061">s</span>&nbsp;<span class="builtintype" id="5544063">string</span><span class="op" id="5544069">,</span>&nbsp;<span class="ident" id="5544071">n</span>&nbsp;<span class="builtintype" id="5544073">int</span><span class="op" id="5544076">)</span>&nbsp;<span class="op" id="5544078">[</span><span class="op" id="5544079">]</span><span class="op" id="5544080">[</span><span class="op" id="5544081">]</span><span class="builtintype" id="5544082">string</span>&nbsp;<span class="op" id="5544089">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544092">if</span>&nbsp;<span class="ident" id="5544095">n</span>&nbsp;<span class="op" id="5544097">&lt;</span>&nbsp;<span class="num" id="5544099">0</span>&nbsp;<span class="op" id="5544101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544105">n</span>&nbsp;<span class="op" id="5544107">=</span>&nbsp;<span class="builtinfunc" id="5544109">len</span><span class="op" id="5544112">(</span><span class="ident" id="5544113">s</span><span class="op" id="5544114">)</span>&nbsp;<span class="op" id="5544116">+</span>&nbsp;<span class="num" id="5544118">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544124">result</span>&nbsp;<span class="op" id="5544131">:=</span>&nbsp;<span class="builtinfunc" id="5544134">make</span><span class="op" id="5544138">(</span><span class="op" id="5544139">[</span><span class="op" id="5544140">]</span><span class="op" id="5544141">[</span><span class="op" id="5544142">]</span><span class="builtintype" id="5544143">string</span><span class="op" id="5544149">,</span>&nbsp;<span class="num" id="5544151">0</span><span class="op" id="5544152">,</span>&nbsp;<span class="ident" id="5544154">startSize</span><span class="op" id="5544163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544166">re</span><span class="op" id="5544168">.</span><span class="ident" id="5544169">allMatches</span><span class="op" id="5544179">(</span><span class="ident" id="5544180">s</span><span class="op" id="5544181">,</span>&nbsp;<span class="ident" id="5544183">nil</span><span class="op" id="5544186">,</span>&nbsp;<span class="ident" id="5544188">n</span><span class="op" id="5544189">,</span>&nbsp;<span class="keyword" id="5544191">func</span><span class="op" id="5544195">(</span><span class="ident" id="5544196">match</span>&nbsp;<span class="op" id="5544202">[</span><span class="op" id="5544203">]</span><span class="builtintype" id="5544204">int</span><span class="op" id="5544207">)</span>&nbsp;<span class="op" id="5544209">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544213">slice</span>&nbsp;<span class="op" id="5544219">:=</span>&nbsp;<span class="builtinfunc" id="5544222">make</span><span class="op" id="5544226">(</span><span class="op" id="5544227">[</span><span class="op" id="5544228">]</span><span class="builtintype" id="5544229">string</span><span class="op" id="5544235">,</span>&nbsp;<span class="builtinfunc" id="5544237">len</span><span class="op" id="5544240">(</span><span class="ident" id="5544241">match</span><span class="op" id="5544246">)</span><span class="op" id="5544247">/</span><span class="num" id="5544248">2</span><span class="op" id="5544249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544253">for</span>&nbsp;<span class="ident" id="5544257">j</span>&nbsp;<span class="op" id="5544259">:=</span>&nbsp;<span class="keyword" id="5544262">range</span>&nbsp;<span class="ident" id="5544268">slice</span>&nbsp;<span class="op" id="5544274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544279">if</span>&nbsp;<span class="ident" id="5544282">match</span><span class="op" id="5544287">[</span><span class="num" id="5544288">2</span><span class="op" id="5544289">*</span><span class="ident" id="5544290">j</span><span class="op" id="5544291">]</span>&nbsp;<span class="op" id="5544293">&gt;=</span>&nbsp;<span class="num" id="5544296">0</span>&nbsp;<span class="op" id="5544298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544304">slice</span><span class="op" id="5544309">[</span><span class="ident" id="5544310">j</span><span class="op" id="5544311">]</span>&nbsp;<span class="op" id="5544313">=</span>&nbsp;<span class="ident" id="5544315">s</span><span class="op" id="5544316">[</span><span class="ident" id="5544317">match</span><span class="op" id="5544322">[</span><span class="num" id="5544323">2</span><span class="op" id="5544324">*</span><span class="ident" id="5544325">j</span><span class="op" id="5544326">]</span><span class="op" id="5544327">:</span><span class="ident" id="5544328">match</span><span class="op" id="5544333">[</span><span class="num" id="5544334">2</span><span class="op" id="5544335">*</span><span class="ident" id="5544336">j</span><span class="op" id="5544337">+</span><span class="num" id="5544338">1</span><span class="op" id="5544339">]</span><span class="op" id="5544340">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544345">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544353">result</span>&nbsp;<span class="op" id="5544360">=</span>&nbsp;<span class="builtinfunc" id="5544362">append</span><span class="op" id="5544368">(</span><span class="ident" id="5544369">result</span><span class="op" id="5544375">,</span>&nbsp;<span class="ident" id="5544377">slice</span><span class="op" id="5544382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544385">}</span><span class="op" id="5544386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544389">if</span>&nbsp;<span class="builtinfunc" id="5544392">len</span><span class="op" id="5544395">(</span><span class="ident" id="5544396">result</span><span class="op" id="5544402">)</span>&nbsp;<span class="op" id="5544404">==</span>&nbsp;<span class="num" id="5544407">0</span>&nbsp;<span class="op" id="5544409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544413">return</span>&nbsp;<span class="ident" id="5544420">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544428">return</span>&nbsp;<span class="ident" id="5544435">result</span><br>
<span class="lineno"></span><span class="op" id="5544442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5544445">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="5544499">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5544575">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5544645">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5544657">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5544702">func</span>&nbsp;<span class="op" id="5544707">(</span><span class="ident" id="5544708">re</span>&nbsp;<span class="op" id="5544711">*</span><span class="ident" id="5544712">Regexp</span><span class="op" id="5544718">)</span>&nbsp;<span class="ident" id="5544720">FindAllStringSubmatchIndex</span><span class="op" id="5544746">(</span><span class="ident" id="5544747">s</span>&nbsp;<span class="builtintype" id="5544749">string</span><span class="op" id="5544755">,</span>&nbsp;<span class="ident" id="5544757">n</span>&nbsp;<span class="builtintype" id="5544759">int</span><span class="op" id="5544762">)</span>&nbsp;<span class="op" id="5544764">[</span><span class="op" id="5544765">]</span><span class="op" id="5544766">[</span><span class="op" id="5544767">]</span><span class="builtintype" id="5544768">int</span>&nbsp;<span class="op" id="5544772">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544775">if</span>&nbsp;<span class="ident" id="5544778">n</span>&nbsp;<span class="op" id="5544780">&lt;</span>&nbsp;<span class="num" id="5544782">0</span>&nbsp;<span class="op" id="5544784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544788">n</span>&nbsp;<span class="op" id="5544790">=</span>&nbsp;<span class="builtinfunc" id="5544792">len</span><span class="op" id="5544795">(</span><span class="ident" id="5544796">s</span><span class="op" id="5544797">)</span>&nbsp;<span class="op" id="5544799">+</span>&nbsp;<span class="num" id="5544801">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544807">result</span>&nbsp;<span class="op" id="5544814">:=</span>&nbsp;<span class="builtinfunc" id="5544817">make</span><span class="op" id="5544821">(</span><span class="op" id="5544822">[</span><span class="op" id="5544823">]</span><span class="op" id="5544824">[</span><span class="op" id="5544825">]</span><span class="builtintype" id="5544826">int</span><span class="op" id="5544829">,</span>&nbsp;<span class="num" id="5544831">0</span><span class="op" id="5544832">,</span>&nbsp;<span class="ident" id="5544834">startSize</span><span class="op" id="5544843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544846">re</span><span class="op" id="5544848">.</span><span class="ident" id="5544849">allMatches</span><span class="op" id="5544859">(</span><span class="ident" id="5544860">s</span><span class="op" id="5544861">,</span>&nbsp;<span class="ident" id="5544863">nil</span><span class="op" id="5544866">,</span>&nbsp;<span class="ident" id="5544868">n</span><span class="op" id="5544869">,</span>&nbsp;<span class="keyword" id="5544871">func</span><span class="op" id="5544875">(</span><span class="ident" id="5544876">match</span>&nbsp;<span class="op" id="5544882">[</span><span class="op" id="5544883">]</span><span class="builtintype" id="5544884">int</span><span class="op" id="5544887">)</span>&nbsp;<span class="op" id="5544889">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544893">result</span>&nbsp;<span class="op" id="5544900">=</span>&nbsp;<span class="builtinfunc" id="5544902">append</span><span class="op" id="5544908">(</span><span class="ident" id="5544909">result</span><span class="op" id="5544915">,</span>&nbsp;<span class="ident" id="5544917">match</span><span class="op" id="5544922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544925">}</span><span class="op" id="5544926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544929">if</span>&nbsp;<span class="builtinfunc" id="5544932">len</span><span class="op" id="5544935">(</span><span class="ident" id="5544936">result</span><span class="op" id="5544942">)</span>&nbsp;<span class="op" id="5544944">==</span>&nbsp;<span class="num" id="5544947">0</span>&nbsp;<span class="op" id="5544949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544953">return</span>&nbsp;<span class="ident" id="5544960">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544965">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544968">return</span>&nbsp;<span class="ident" id="5544975">result</span><br>
<span class="lineno"></span><span class="op" id="5544982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5544985">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5545070">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="5545122">//</span><br>
<span class="lineno"></span><span class="comment" id="5545125">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5545198">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5545284">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="5545356">//</span><br>
<span class="lineno">1080</span><span class="comment" id="5545359">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="5545371">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="5545433">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="5545475">//</span><br>
<span class="lineno"></span><span class="comment" id="5545478">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="5545538">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="5545622">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="5545671">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="5545698">func</span>&nbsp;<span class="op" id="5545703">(</span><span class="ident" id="5545704">re</span>&nbsp;<span class="op" id="5545707">*</span><span class="ident" id="5545708">Regexp</span><span class="op" id="5545714">)</span>&nbsp;<span class="ident" id="5545716">Split</span><span class="op" id="5545721">(</span><span class="ident" id="5545722">s</span>&nbsp;<span class="builtintype" id="5545724">string</span><span class="op" id="5545730">,</span>&nbsp;<span class="ident" id="5545732">n</span>&nbsp;<span class="builtintype" id="5545734">int</span><span class="op" id="5545737">)</span>&nbsp;<span class="op" id="5545739">[</span><span class="op" id="5545740">]</span><span class="builtintype" id="5545741">string</span>&nbsp;<span class="op" id="5545748">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545752">if</span>&nbsp;<span class="ident" id="5545755">n</span>&nbsp;<span class="op" id="5545757">==</span>&nbsp;<span class="num" id="5545760">0</span>&nbsp;<span class="op" id="5545762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545766">return</span>&nbsp;<span class="ident" id="5545773">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545782">if</span>&nbsp;<span class="builtinfunc" id="5545785">len</span><span class="op" id="5545788">(</span><span class="ident" id="5545789">re</span><span class="op" id="5545791">.</span><span class="ident" id="5545792">expr</span><span class="op" id="5545796">)</span>&nbsp;<span class="op" id="5545798">&gt;</span>&nbsp;<span class="num" id="5545800">0</span>&nbsp;<span class="op" id="5545802">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5545805">len</span><span class="op" id="5545808">(</span><span class="ident" id="5545809">s</span><span class="op" id="5545810">)</span>&nbsp;<span class="op" id="5545812">==</span>&nbsp;<span class="num" id="5545815">0</span>&nbsp;<span class="op" id="5545817">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545821">return</span>&nbsp;<span class="op" id="5545828">[</span><span class="op" id="5545829">]</span><span class="builtintype" id="5545830">string</span><span class="op" id="5545836">{</span><span class="string" id="5545837">&#34;&#34;</span><span class="op" id="5545839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545846">matches</span>&nbsp;<span class="op" id="5545854">:=</span>&nbsp;<span class="ident" id="5545857">re</span><span class="op" id="5545859">.</span><span class="ident" id="5545860">FindAllStringIndex</span><span class="op" id="5545878">(</span><span class="ident" id="5545879">s</span><span class="op" id="5545880">,</span>&nbsp;<span class="ident" id="5545882">n</span><span class="op" id="5545883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545886">strings</span>&nbsp;<span class="op" id="5545894">:=</span>&nbsp;<span class="builtinfunc" id="5545897">make</span><span class="op" id="5545901">(</span><span class="op" id="5545902">[</span><span class="op" id="5545903">]</span><span class="builtintype" id="5545904">string</span><span class="op" id="5545910">,</span>&nbsp;<span class="num" id="5545912">0</span><span class="op" id="5545913">,</span>&nbsp;<span class="builtinfunc" id="5545915">len</span><span class="op" id="5545918">(</span><span class="ident" id="5545919">matches</span><span class="op" id="5545926">)</span><span class="op" id="5545927">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545931">beg</span>&nbsp;<span class="op" id="5545935">:=</span>&nbsp;<span class="num" id="5545938">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545941">end</span>&nbsp;<span class="op" id="5545945">:=</span>&nbsp;<span class="num" id="5545948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545951">for</span>&nbsp;<span class="ident" id="5545955">_</span><span class="op" id="5545956">,</span>&nbsp;<span class="ident" id="5545958">match</span>&nbsp;<span class="op" id="5545964">:=</span>&nbsp;<span class="keyword" id="5545967">range</span>&nbsp;<span class="ident" id="5545973">matches</span>&nbsp;<span class="op" id="5545981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545985">if</span>&nbsp;<span class="ident" id="5545988">n</span>&nbsp;<span class="op" id="5545990">&gt;</span>&nbsp;<span class="num" id="5545992">0</span>&nbsp;<span class="op" id="5545994">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5545997">len</span><span class="op" id="5546000">(</span><span class="ident" id="5546001">strings</span><span class="op" id="5546008">)</span>&nbsp;<span class="op" id="5546010">&gt;=</span>&nbsp;<span class="ident" id="5546013">n</span><span class="op" id="5546014">-</span><span class="num" id="5546015">1</span>&nbsp;<span class="op" id="5546017">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546022">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5546030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546035">end</span>&nbsp;<span class="op" id="5546039">=</span>&nbsp;<span class="ident" id="5546041">match</span><span class="op" id="5546046">[</span><span class="num" id="5546047">0</span><span class="op" id="5546048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546052">if</span>&nbsp;<span class="ident" id="5546055">match</span><span class="op" id="5546060">[</span><span class="num" id="5546061">1</span><span class="op" id="5546062">]</span>&nbsp;<span class="op" id="5546064">!=</span>&nbsp;<span class="num" id="5546067">0</span>&nbsp;<span class="op" id="5546069">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546074">strings</span>&nbsp;<span class="op" id="5546082">=</span>&nbsp;<span class="builtinfunc" id="5546084">append</span><span class="op" id="5546090">(</span><span class="ident" id="5546091">strings</span><span class="op" id="5546098">,</span>&nbsp;<span class="ident" id="5546100">s</span><span class="op" id="5546101">[</span><span class="ident" id="5546102">beg</span><span class="op" id="5546105">:</span><span class="ident" id="5546106">end</span><span class="op" id="5546109">]</span><span class="op" id="5546110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5546114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546118">beg</span>&nbsp;<span class="op" id="5546122">=</span>&nbsp;<span class="ident" id="5546124">match</span><span class="op" id="5546129">[</span><span class="num" id="5546130">1</span><span class="op" id="5546131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5546134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546138">if</span>&nbsp;<span class="ident" id="5546141">end</span>&nbsp;<span class="op" id="5546145">!=</span>&nbsp;<span class="builtinfunc" id="5546148">len</span><span class="op" id="5546151">(</span><span class="ident" id="5546152">s</span><span class="op" id="5546153">)</span>&nbsp;<span class="op" id="5546155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546159">strings</span>&nbsp;<span class="op" id="5546167">=</span>&nbsp;<span class="builtinfunc" id="5546169">append</span><span class="op" id="5546175">(</span><span class="ident" id="5546176">strings</span><span class="op" id="5546183">,</span>&nbsp;<span class="ident" id="5546185">s</span><span class="op" id="5546186">[</span><span class="ident" id="5546187">beg</span><span class="op" id="5546190">:</span><span class="op" id="5546191">]</span><span class="op" id="5546192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5546195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546199">return</span>&nbsp;<span class="ident" id="5546206">strings</span><br>
<span class="lineno">1120</span><span class="op" id="5546214">}</span>
</div>
</body>
</html>
