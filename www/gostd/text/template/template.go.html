<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3593685">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3593740">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3593794">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3593845">package</span>&nbsp;<span class="ident" id="3593853">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3593863">import</span>&nbsp;<span class="op" id="3593870">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3593873">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3593880">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3593891">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3593913">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3593916">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3593977">type</span>&nbsp;<span class="ident" id="3593982">common</span>&nbsp;<span class="keyword" id="3593989">struct</span>&nbsp;<span class="op" id="3593996">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3593999">tmpl</span>&nbsp;<span class="keyword" id="3594004">map</span><span class="op" id="3594007">[</span><span class="builtintype" id="3594008">string</span><span class="op" id="3594014">]</span><span class="op" id="3594015">*</span><span class="ident" id="3594016">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3594026">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3594086">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3594145">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594182">parseFuncs</span>&nbsp;<span class="ident" id="3594193">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594202">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3594213">map</span><span class="op" id="3594216">[</span><span class="builtintype" id="3594217">string</span><span class="op" id="3594223">]</span><span class="ident" id="3594224">reflect</span><span class="op" id="3594231">.</span><span class="ident" id="3594232">Value</span><br>
<span class="lineno"></span><span class="op" id="3594238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3594241">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3594313">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3594386">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3594425">type</span>&nbsp;<span class="ident" id="3594430">Template</span>&nbsp;<span class="keyword" id="3594439">struct</span>&nbsp;<span class="op" id="3594446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594449">name</span>&nbsp;<span class="builtintype" id="3594454">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3594462">*</span><span class="ident" id="3594463">parse</span><span class="op" id="3594468">.</span><span class="ident" id="3594469">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3594475">*</span><span class="ident" id="3594476">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594484">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3594495">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594503">rightDelim</span>&nbsp;<span class="builtintype" id="3594514">string</span><br>
<span class="lineno"></span><span class="op" id="3594521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3594524">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3594577">func</span>&nbsp;<span class="ident" id="3594582">New</span><span class="op" id="3594585">(</span><span class="ident" id="3594586">name</span>&nbsp;<span class="builtintype" id="3594591">string</span><span class="op" id="3594597">)</span>&nbsp;<span class="op" id="3594599">*</span><span class="ident" id="3594600">Template</span>&nbsp;<span class="op" id="3594609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3594612">return</span>&nbsp;<span class="op" id="3594619">&amp;</span><span class="ident" id="3594620">Template</span><span class="op" id="3594628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594632">name</span><span class="op" id="3594636">:</span>&nbsp;<span class="ident" id="3594638">name</span><span class="op" id="3594642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3594645">}</span><br>
<span class="lineno"></span><span class="op" id="3594647">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3594650">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3594692">func</span>&nbsp;<span class="op" id="3594697">(</span><span class="ident" id="3594698">t</span>&nbsp;<span class="op" id="3594700">*</span><span class="ident" id="3594701">Template</span><span class="op" id="3594709">)</span>&nbsp;<span class="ident" id="3594711">Name</span><span class="op" id="3594715">(</span><span class="op" id="3594716">)</span>&nbsp;<span class="builtintype" id="3594718">string</span>&nbsp;<span class="op" id="3594725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3594728">return</span>&nbsp;<span class="ident" id="3594735">t</span><span class="op" id="3594736">.</span><span class="ident" id="3594737">name</span><br>
<span class="lineno"></span><span class="op" id="3594742">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3594745">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3594825">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3594901">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3594947">func</span>&nbsp;<span class="op" id="3594952">(</span><span class="ident" id="3594953">t</span>&nbsp;<span class="op" id="3594955">*</span><span class="ident" id="3594956">Template</span><span class="op" id="3594964">)</span>&nbsp;<span class="ident" id="3594966">New</span><span class="op" id="3594969">(</span><span class="ident" id="3594970">name</span>&nbsp;<span class="builtintype" id="3594975">string</span><span class="op" id="3594981">)</span>&nbsp;<span class="op" id="3594983">*</span><span class="ident" id="3594984">Template</span>&nbsp;<span class="op" id="3594993">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594996">t</span><span class="op" id="3594997">.</span><span class="ident" id="3594998">init</span><span class="op" id="3595002">(</span><span class="op" id="3595003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595006">return</span>&nbsp;<span class="op" id="3595013">&amp;</span><span class="ident" id="3595014">Template</span><span class="op" id="3595022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595026">name</span><span class="op" id="3595030">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595038">name</span><span class="op" id="3595042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595046">common</span><span class="op" id="3595052">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595058">t</span><span class="op" id="3595059">.</span><span class="ident" id="3595060">common</span><span class="op" id="3595066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595070">leftDelim</span><span class="op" id="3595079">:</span>&nbsp;&nbsp;<span class="ident" id="3595082">t</span><span class="op" id="3595083">.</span><span class="ident" id="3595084">leftDelim</span><span class="op" id="3595093">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595097">rightDelim</span><span class="op" id="3595107">:</span>&nbsp;<span class="ident" id="3595109">t</span><span class="op" id="3595110">.</span><span class="ident" id="3595111">rightDelim</span><span class="op" id="3595121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595124">}</span><br>
<span class="lineno"></span><span class="op" id="3595126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3595129">func</span>&nbsp;<span class="op" id="3595134">(</span><span class="ident" id="3595135">t</span>&nbsp;<span class="op" id="3595137">*</span><span class="ident" id="3595138">Template</span><span class="op" id="3595146">)</span>&nbsp;<span class="ident" id="3595148">init</span><span class="op" id="3595152">(</span><span class="op" id="3595153">)</span>&nbsp;<span class="op" id="3595155">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595158">if</span>&nbsp;<span class="ident" id="3595161">t</span><span class="op" id="3595162">.</span><span class="ident" id="3595163">common</span>&nbsp;<span class="op" id="3595170">==</span>&nbsp;<span class="builtintype" id="3595173">nil</span>&nbsp;<span class="op" id="3595177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595181">t</span><span class="op" id="3595182">.</span><span class="ident" id="3595183">common</span>&nbsp;<span class="op" id="3595190">=</span>&nbsp;<span class="builtinfunc" id="3595192">new</span><span class="op" id="3595195">(</span><span class="ident" id="3595196">common</span><span class="op" id="3595202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595206">t</span><span class="op" id="3595207">.</span><span class="ident" id="3595208">tmpl</span>&nbsp;<span class="op" id="3595213">=</span>&nbsp;<span class="builtinfunc" id="3595215">make</span><span class="op" id="3595219">(</span><span class="keyword" id="3595220">map</span><span class="op" id="3595223">[</span><span class="builtintype" id="3595224">string</span><span class="op" id="3595230">]</span><span class="op" id="3595231">*</span><span class="ident" id="3595232">Template</span><span class="op" id="3595240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595244">t</span><span class="op" id="3595245">.</span><span class="ident" id="3595246">parseFuncs</span>&nbsp;<span class="op" id="3595257">=</span>&nbsp;<span class="builtinfunc" id="3595259">make</span><span class="op" id="3595263">(</span><span class="ident" id="3595264">FuncMap</span><span class="op" id="3595271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595275">t</span><span class="op" id="3595276">.</span><span class="ident" id="3595277">execFuncs</span>&nbsp;<span class="op" id="3595287">=</span>&nbsp;<span class="builtinfunc" id="3595289">make</span><span class="op" id="3595293">(</span><span class="keyword" id="3595294">map</span><span class="op" id="3595297">[</span><span class="builtintype" id="3595298">string</span><span class="op" id="3595304">]</span><span class="ident" id="3595305">reflect</span><span class="op" id="3595312">.</span><span class="ident" id="3595313">Value</span><span class="op" id="3595318">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595321">}</span><br>
<span class="lineno"></span><span class="op" id="3595323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3595326">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3595397">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3595474">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3595549">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3595628">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3595706">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3595757">func</span>&nbsp;<span class="op" id="3595762">(</span><span class="ident" id="3595763">t</span>&nbsp;<span class="op" id="3595765">*</span><span class="ident" id="3595766">Template</span><span class="op" id="3595774">)</span>&nbsp;<span class="ident" id="3595776">Clone</span><span class="op" id="3595781">(</span><span class="op" id="3595782">)</span>&nbsp;<span class="op" id="3595784">(</span><span class="op" id="3595785">*</span><span class="ident" id="3595786">Template</span><span class="op" id="3595794">,</span>&nbsp;<span class="builtintype" id="3595796">error</span><span class="op" id="3595801">)</span>&nbsp;<span class="op" id="3595803">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595806">nt</span>&nbsp;<span class="op" id="3595809">:=</span>&nbsp;<span class="ident" id="3595812">t</span><span class="op" id="3595813">.</span><span class="builtinfunc" id="3595814">copy</span><span class="op" id="3595818">(</span><span class="builtintype" id="3595819">nil</span><span class="op" id="3595822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595825">nt</span><span class="op" id="3595827">.</span><span class="ident" id="3595828">init</span><span class="op" id="3595832">(</span><span class="op" id="3595833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595836">nt</span><span class="op" id="3595838">.</span><span class="ident" id="3595839">tmpl</span><span class="op" id="3595843">[</span><span class="ident" id="3595844">t</span><span class="op" id="3595845">.</span><span class="ident" id="3595846">name</span><span class="op" id="3595850">]</span>&nbsp;<span class="op" id="3595852">=</span>&nbsp;<span class="ident" id="3595854">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595858">for</span>&nbsp;<span class="ident" id="3595862">k</span><span class="op" id="3595863">,</span>&nbsp;<span class="ident" id="3595865">v</span>&nbsp;<span class="op" id="3595867">:=</span>&nbsp;<span class="keyword" id="3595870">range</span>&nbsp;<span class="ident" id="3595876">t</span><span class="op" id="3595877">.</span><span class="ident" id="3595878">tmpl</span>&nbsp;<span class="op" id="3595883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595887">if</span>&nbsp;<span class="ident" id="3595890">k</span>&nbsp;<span class="op" id="3595892">==</span>&nbsp;<span class="ident" id="3595895">t</span><span class="op" id="3595896">.</span><span class="ident" id="3595897">name</span>&nbsp;<span class="op" id="3595902">{</span>&nbsp;<span class="comment" id="3595904">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595929">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3595944">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596003">tmpl</span>&nbsp;<span class="op" id="3596008">:=</span>&nbsp;<span class="ident" id="3596011">v</span><span class="op" id="3596012">.</span><span class="builtinfunc" id="3596013">copy</span><span class="op" id="3596017">(</span><span class="ident" id="3596018">nt</span><span class="op" id="3596020">.</span><span class="ident" id="3596021">common</span><span class="op" id="3596027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596031">nt</span><span class="op" id="3596033">.</span><span class="ident" id="3596034">tmpl</span><span class="op" id="3596038">[</span><span class="ident" id="3596039">k</span><span class="op" id="3596040">]</span>&nbsp;<span class="op" id="3596042">=</span>&nbsp;<span class="ident" id="3596044">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596053">for</span>&nbsp;<span class="ident" id="3596057">k</span><span class="op" id="3596058">,</span>&nbsp;<span class="ident" id="3596060">v</span>&nbsp;<span class="op" id="3596062">:=</span>&nbsp;<span class="keyword" id="3596065">range</span>&nbsp;<span class="ident" id="3596071">t</span><span class="op" id="3596072">.</span><span class="ident" id="3596073">parseFuncs</span>&nbsp;<span class="op" id="3596084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596088">nt</span><span class="op" id="3596090">.</span><span class="ident" id="3596091">parseFuncs</span><span class="op" id="3596101">[</span><span class="ident" id="3596102">k</span><span class="op" id="3596103">]</span>&nbsp;<span class="op" id="3596105">=</span>&nbsp;<span class="ident" id="3596107">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596113">for</span>&nbsp;<span class="ident" id="3596117">k</span><span class="op" id="3596118">,</span>&nbsp;<span class="ident" id="3596120">v</span>&nbsp;<span class="op" id="3596122">:=</span>&nbsp;<span class="keyword" id="3596125">range</span>&nbsp;<span class="ident" id="3596131">t</span><span class="op" id="3596132">.</span><span class="ident" id="3596133">execFuncs</span>&nbsp;<span class="op" id="3596143">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596147">nt</span><span class="op" id="3596149">.</span><span class="ident" id="3596150">execFuncs</span><span class="op" id="3596159">[</span><span class="ident" id="3596160">k</span><span class="op" id="3596161">]</span>&nbsp;<span class="op" id="3596163">=</span>&nbsp;<span class="ident" id="3596165">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596171">return</span>&nbsp;<span class="ident" id="3596178">nt</span><span class="op" id="3596180">,</span>&nbsp;<span class="builtintype" id="3596182">nil</span><br>
<span class="lineno"></span><span class="op" id="3596186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3596189">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3596259">func</span>&nbsp;<span class="op" id="3596264">(</span><span class="ident" id="3596265">t</span>&nbsp;<span class="op" id="3596267">*</span><span class="ident" id="3596268">Template</span><span class="op" id="3596276">)</span>&nbsp;<span class="builtinfunc" id="3596278">copy</span><span class="op" id="3596282">(</span><span class="ident" id="3596283">c</span>&nbsp;<span class="op" id="3596285">*</span><span class="ident" id="3596286">common</span><span class="op" id="3596292">)</span>&nbsp;<span class="op" id="3596294">*</span><span class="ident" id="3596295">Template</span>&nbsp;<span class="op" id="3596304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596307">nt</span>&nbsp;<span class="op" id="3596310">:=</span>&nbsp;<span class="ident" id="3596313">New</span><span class="op" id="3596316">(</span><span class="ident" id="3596317">t</span><span class="op" id="3596318">.</span><span class="ident" id="3596319">name</span><span class="op" id="3596323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596326">nt</span><span class="op" id="3596328">.</span><span class="ident" id="3596329">Tree</span>&nbsp;<span class="op" id="3596334">=</span>&nbsp;<span class="ident" id="3596336">t</span><span class="op" id="3596337">.</span><span class="ident" id="3596338">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596344">nt</span><span class="op" id="3596346">.</span><span class="ident" id="3596347">common</span>&nbsp;<span class="op" id="3596354">=</span>&nbsp;<span class="ident" id="3596356">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596359">nt</span><span class="op" id="3596361">.</span><span class="ident" id="3596362">leftDelim</span>&nbsp;<span class="op" id="3596372">=</span>&nbsp;<span class="ident" id="3596374">t</span><span class="op" id="3596375">.</span><span class="ident" id="3596376">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596387">nt</span><span class="op" id="3596389">.</span><span class="ident" id="3596390">rightDelim</span>&nbsp;<span class="op" id="3596401">=</span>&nbsp;<span class="ident" id="3596403">t</span><span class="op" id="3596404">.</span><span class="ident" id="3596405">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596417">return</span>&nbsp;<span class="ident" id="3596424">nt</span><br>
<span class="lineno"></span><span class="op" id="3596427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3596430">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3596498">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3596527">func</span>&nbsp;<span class="op" id="3596532">(</span><span class="ident" id="3596533">t</span>&nbsp;<span class="op" id="3596535">*</span><span class="ident" id="3596536">Template</span><span class="op" id="3596544">)</span>&nbsp;<span class="ident" id="3596546">AddParseTree</span><span class="op" id="3596558">(</span><span class="ident" id="3596559">name</span>&nbsp;<span class="builtintype" id="3596564">string</span><span class="op" id="3596570">,</span>&nbsp;<span class="ident" id="3596572">tree</span>&nbsp;<span class="op" id="3596577">*</span><span class="ident" id="3596578">parse</span><span class="op" id="3596583">.</span><span class="ident" id="3596584">Tree</span><span class="op" id="3596588">)</span>&nbsp;<span class="op" id="3596590">(</span><span class="op" id="3596591">*</span><span class="ident" id="3596592">Template</span><span class="op" id="3596600">,</span>&nbsp;<span class="builtintype" id="3596602">error</span><span class="op" id="3596607">)</span>&nbsp;<span class="op" id="3596609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596612">if</span>&nbsp;<span class="ident" id="3596615">t</span><span class="op" id="3596616">.</span><span class="ident" id="3596617">common</span>&nbsp;<span class="op" id="3596624">!=</span>&nbsp;<span class="builtintype" id="3596627">nil</span>&nbsp;<span class="op" id="3596631">&amp;&amp;</span>&nbsp;<span class="ident" id="3596634">t</span><span class="op" id="3596635">.</span><span class="ident" id="3596636">tmpl</span><span class="op" id="3596640">[</span><span class="ident" id="3596641">name</span><span class="op" id="3596645">]</span>&nbsp;<span class="op" id="3596647">!=</span>&nbsp;<span class="builtintype" id="3596650">nil</span>&nbsp;<span class="op" id="3596654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596658">return</span>&nbsp;<span class="builtintype" id="3596665">nil</span><span class="op" id="3596668">,</span>&nbsp;<span class="ident" id="3596670">fmt</span><span class="op" id="3596673">.</span><span class="ident" id="3596674">Errorf</span><span class="op" id="3596680">(</span><span class="string" id="3596681">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3596720">,</span>&nbsp;<span class="ident" id="3596722">name</span><span class="op" id="3596726">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596732">nt</span>&nbsp;<span class="op" id="3596735">:=</span>&nbsp;<span class="ident" id="3596738">t</span><span class="op" id="3596739">.</span><span class="ident" id="3596740">New</span><span class="op" id="3596743">(</span><span class="ident" id="3596744">name</span><span class="op" id="3596748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596751">nt</span><span class="op" id="3596753">.</span><span class="ident" id="3596754">Tree</span>&nbsp;<span class="op" id="3596759">=</span>&nbsp;<span class="ident" id="3596761">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596767">t</span><span class="op" id="3596768">.</span><span class="ident" id="3596769">tmpl</span><span class="op" id="3596773">[</span><span class="ident" id="3596774">name</span><span class="op" id="3596778">]</span>&nbsp;<span class="op" id="3596780">=</span>&nbsp;<span class="ident" id="3596782">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596786">return</span>&nbsp;<span class="ident" id="3596793">nt</span><span class="op" id="3596795">,</span>&nbsp;<span class="builtintype" id="3596797">nil</span><br>
<span class="lineno">115</span><span class="op" id="3596801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3596804">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3596881">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3596892">func</span>&nbsp;<span class="op" id="3596897">(</span><span class="ident" id="3596898">t</span>&nbsp;<span class="op" id="3596900">*</span><span class="ident" id="3596901">Template</span><span class="op" id="3596909">)</span>&nbsp;<span class="ident" id="3596911">Templates</span><span class="op" id="3596920">(</span><span class="op" id="3596921">)</span>&nbsp;<span class="op" id="3596923">[</span><span class="op" id="3596924">]</span><span class="op" id="3596925">*</span><span class="ident" id="3596926">Template</span>&nbsp;<span class="op" id="3596935">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596938">if</span>&nbsp;<span class="ident" id="3596941">t</span><span class="op" id="3596942">.</span><span class="ident" id="3596943">common</span>&nbsp;<span class="op" id="3596950">==</span>&nbsp;<span class="builtintype" id="3596953">nil</span>&nbsp;<span class="op" id="3596957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596961">return</span>&nbsp;<span class="builtintype" id="3596968">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3596976">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597023">m</span>&nbsp;<span class="op" id="3597025">:=</span>&nbsp;<span class="builtinfunc" id="3597028">make</span><span class="op" id="3597032">(</span><span class="op" id="3597033">[</span><span class="op" id="3597034">]</span><span class="op" id="3597035">*</span><span class="ident" id="3597036">Template</span><span class="op" id="3597044">,</span>&nbsp;<span class="num" id="3597046">0</span><span class="op" id="3597047">,</span>&nbsp;<span class="builtinfunc" id="3597049">len</span><span class="op" id="3597052">(</span><span class="ident" id="3597053">t</span><span class="op" id="3597054">.</span><span class="ident" id="3597055">tmpl</span><span class="op" id="3597059">)</span><span class="op" id="3597060">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3597063">for</span>&nbsp;<span class="ident" id="3597067">_</span><span class="op" id="3597068">,</span>&nbsp;<span class="ident" id="3597070">v</span>&nbsp;<span class="op" id="3597072">:=</span>&nbsp;<span class="keyword" id="3597075">range</span>&nbsp;<span class="ident" id="3597081">t</span><span class="op" id="3597082">.</span><span class="ident" id="3597083">tmpl</span>&nbsp;<span class="op" id="3597088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597092">m</span>&nbsp;<span class="op" id="3597094">=</span>&nbsp;<span class="builtinfunc" id="3597096">append</span><span class="op" id="3597102">(</span><span class="ident" id="3597103">m</span><span class="op" id="3597104">,</span>&nbsp;<span class="ident" id="3597106">v</span><span class="op" id="3597107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3597110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3597113">return</span>&nbsp;<span class="ident" id="3597120">m</span><br>
<span class="lineno"></span><span class="op" id="3597122">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3597125">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3597202">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3597274">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3597350">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3597386">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3597448">func</span>&nbsp;<span class="op" id="3597453">(</span><span class="ident" id="3597454">t</span>&nbsp;<span class="op" id="3597456">*</span><span class="ident" id="3597457">Template</span><span class="op" id="3597465">)</span>&nbsp;<span class="ident" id="3597467">Delims</span><span class="op" id="3597473">(</span><span class="ident" id="3597474">left</span><span class="op" id="3597478">,</span>&nbsp;<span class="ident" id="3597480">right</span>&nbsp;<span class="builtintype" id="3597486">string</span><span class="op" id="3597492">)</span>&nbsp;<span class="op" id="3597494">*</span><span class="ident" id="3597495">Template</span>&nbsp;<span class="op" id="3597504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597507">t</span><span class="op" id="3597508">.</span><span class="ident" id="3597509">leftDelim</span>&nbsp;<span class="op" id="3597519">=</span>&nbsp;<span class="ident" id="3597521">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597527">t</span><span class="op" id="3597528">.</span><span class="ident" id="3597529">rightDelim</span>&nbsp;<span class="op" id="3597540">=</span>&nbsp;<span class="ident" id="3597542">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3597549">return</span>&nbsp;<span class="ident" id="3597556">t</span><br>
<span class="lineno">140</span><span class="op" id="3597558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3597561">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3597640">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3597717">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3597792">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3597843">func</span>&nbsp;<span class="op" id="3597848">(</span><span class="ident" id="3597849">t</span>&nbsp;<span class="op" id="3597851">*</span><span class="ident" id="3597852">Template</span><span class="op" id="3597860">)</span>&nbsp;<span class="ident" id="3597862">Funcs</span><span class="op" id="3597867">(</span><span class="ident" id="3597868">funcMap</span>&nbsp;<span class="ident" id="3597876">FuncMap</span><span class="op" id="3597883">)</span>&nbsp;<span class="op" id="3597885">*</span><span class="ident" id="3597886">Template</span>&nbsp;<span class="op" id="3597895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597898">t</span><span class="op" id="3597899">.</span><span class="ident" id="3597900">init</span><span class="op" id="3597904">(</span><span class="op" id="3597905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597908">addValueFuncs</span><span class="op" id="3597921">(</span><span class="ident" id="3597922">t</span><span class="op" id="3597923">.</span><span class="ident" id="3597924">execFuncs</span><span class="op" id="3597933">,</span>&nbsp;<span class="ident" id="3597935">funcMap</span><span class="op" id="3597942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597945">addFuncs</span><span class="op" id="3597953">(</span><span class="ident" id="3597954">t</span><span class="op" id="3597955">.</span><span class="ident" id="3597956">parseFuncs</span><span class="op" id="3597966">,</span>&nbsp;<span class="ident" id="3597968">funcMap</span><span class="op" id="3597975">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3597978">return</span>&nbsp;<span class="ident" id="3597985">t</span><br>
<span class="lineno"></span><span class="op" id="3597987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3597990">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3598068">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3598108">func</span>&nbsp;<span class="op" id="3598113">(</span><span class="ident" id="3598114">t</span>&nbsp;<span class="op" id="3598116">*</span><span class="ident" id="3598117">Template</span><span class="op" id="3598125">)</span>&nbsp;<span class="ident" id="3598127">Lookup</span><span class="op" id="3598133">(</span><span class="ident" id="3598134">name</span>&nbsp;<span class="builtintype" id="3598139">string</span><span class="op" id="3598145">)</span>&nbsp;<span class="op" id="3598147">*</span><span class="ident" id="3598148">Template</span>&nbsp;<span class="op" id="3598157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3598160">if</span>&nbsp;<span class="ident" id="3598163">t</span><span class="op" id="3598164">.</span><span class="ident" id="3598165">common</span>&nbsp;<span class="op" id="3598172">==</span>&nbsp;<span class="builtintype" id="3598175">nil</span>&nbsp;<span class="op" id="3598179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3598183">return</span>&nbsp;<span class="builtintype" id="3598190">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3598195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3598198">return</span>&nbsp;<span class="ident" id="3598205">t</span><span class="op" id="3598206">.</span><span class="ident" id="3598207">tmpl</span><span class="op" id="3598211">[</span><span class="ident" id="3598212">name</span><span class="op" id="3598216">]</span><br>
<span class="lineno">160</span><span class="op" id="3598218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3598221">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3598299">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3598379">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3598457">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3598530">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3598605">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3598683">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3598758">func</span>&nbsp;<span class="op" id="3598763">(</span><span class="ident" id="3598764">t</span>&nbsp;<span class="op" id="3598766">*</span><span class="ident" id="3598767">Template</span><span class="op" id="3598775">)</span>&nbsp;<span class="ident" id="3598777">Parse</span><span class="op" id="3598782">(</span><span class="ident" id="3598783">text</span>&nbsp;<span class="builtintype" id="3598788">string</span><span class="op" id="3598794">)</span>&nbsp;<span class="op" id="3598796">(</span><span class="op" id="3598797">*</span><span class="ident" id="3598798">Template</span><span class="op" id="3598806">,</span>&nbsp;<span class="builtintype" id="3598808">error</span><span class="op" id="3598813">)</span>&nbsp;<span class="op" id="3598815">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3598818">t</span><span class="op" id="3598819">.</span><span class="ident" id="3598820">init</span><span class="op" id="3598824">(</span><span class="op" id="3598825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3598828">trees</span><span class="op" id="3598833">,</span>&nbsp;<span class="ident" id="3598835">err</span>&nbsp;<span class="op" id="3598839">:=</span>&nbsp;<span class="ident" id="3598842">parse</span><span class="op" id="3598847">.</span><span class="ident" id="3598848">Parse</span><span class="op" id="3598853">(</span><span class="ident" id="3598854">t</span><span class="op" id="3598855">.</span><span class="ident" id="3598856">name</span><span class="op" id="3598860">,</span>&nbsp;<span class="ident" id="3598862">text</span><span class="op" id="3598866">,</span>&nbsp;<span class="ident" id="3598868">t</span><span class="op" id="3598869">.</span><span class="ident" id="3598870">leftDelim</span><span class="op" id="3598879">,</span>&nbsp;<span class="ident" id="3598881">t</span><span class="op" id="3598882">.</span><span class="ident" id="3598883">rightDelim</span><span class="op" id="3598893">,</span>&nbsp;<span class="ident" id="3598895">t</span><span class="op" id="3598896">.</span><span class="ident" id="3598897">parseFuncs</span><span class="op" id="3598907">,</span>&nbsp;<span class="ident" id="3598909">builtins</span><span class="op" id="3598917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3598920">if</span>&nbsp;<span class="ident" id="3598923">err</span>&nbsp;<span class="op" id="3598927">!=</span>&nbsp;<span class="builtintype" id="3598930">nil</span>&nbsp;<span class="op" id="3598934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3598938">return</span>&nbsp;<span class="builtintype" id="3598945">nil</span><span class="op" id="3598948">,</span>&nbsp;<span class="ident" id="3598950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3598955">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3598958">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599042">for</span>&nbsp;<span class="ident" id="3599046">name</span><span class="op" id="3599050">,</span>&nbsp;<span class="ident" id="3599052">tree</span>&nbsp;<span class="op" id="3599057">:=</span>&nbsp;<span class="keyword" id="3599060">range</span>&nbsp;<span class="ident" id="3599066">trees</span>&nbsp;<span class="op" id="3599072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3599076">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3599158">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599216">tmpl</span>&nbsp;<span class="op" id="3599221">:=</span>&nbsp;<span class="ident" id="3599224">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599228">if</span>&nbsp;<span class="ident" id="3599231">name</span>&nbsp;<span class="op" id="3599236">!=</span>&nbsp;<span class="ident" id="3599239">t</span><span class="op" id="3599240">.</span><span class="ident" id="3599241">name</span>&nbsp;<span class="op" id="3599246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599251">tmpl</span>&nbsp;<span class="op" id="3599256">=</span>&nbsp;<span class="ident" id="3599258">t</span><span class="op" id="3599259">.</span><span class="ident" id="3599260">New</span><span class="op" id="3599263">(</span><span class="ident" id="3599264">name</span><span class="op" id="3599268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3599276">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599346">if</span>&nbsp;<span class="ident" id="3599349">replace</span><span class="op" id="3599356">,</span>&nbsp;<span class="ident" id="3599358">err</span>&nbsp;<span class="op" id="3599362">:=</span>&nbsp;<span class="ident" id="3599365">t</span><span class="op" id="3599366">.</span><span class="ident" id="3599367">associate</span><span class="op" id="3599376">(</span><span class="ident" id="3599377">tmpl</span><span class="op" id="3599381">,</span>&nbsp;<span class="ident" id="3599383">tree</span><span class="op" id="3599387">)</span><span class="op" id="3599388">;</span>&nbsp;<span class="ident" id="3599390">err</span>&nbsp;<span class="op" id="3599394">!=</span>&nbsp;<span class="builtintype" id="3599397">nil</span>&nbsp;<span class="op" id="3599401">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599406">return</span>&nbsp;<span class="builtintype" id="3599413">nil</span><span class="op" id="3599416">,</span>&nbsp;<span class="ident" id="3599418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599424">}</span>&nbsp;<span class="keyword" id="3599426">else</span>&nbsp;<span class="keyword" id="3599431">if</span>&nbsp;<span class="ident" id="3599434">replace</span>&nbsp;<span class="op" id="3599442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599447">tmpl</span><span class="op" id="3599451">.</span><span class="ident" id="3599452">Tree</span>&nbsp;<span class="op" id="3599457">=</span>&nbsp;<span class="ident" id="3599459">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599470">tmpl</span><span class="op" id="3599474">.</span><span class="ident" id="3599475">leftDelim</span>&nbsp;<span class="op" id="3599485">=</span>&nbsp;<span class="ident" id="3599487">t</span><span class="op" id="3599488">.</span><span class="ident" id="3599489">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599501">tmpl</span><span class="op" id="3599505">.</span><span class="ident" id="3599506">rightDelim</span>&nbsp;<span class="op" id="3599517">=</span>&nbsp;<span class="ident" id="3599519">t</span><span class="op" id="3599520">.</span><span class="ident" id="3599521">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599536">return</span>&nbsp;<span class="ident" id="3599543">t</span><span class="op" id="3599544">,</span>&nbsp;<span class="builtintype" id="3599546">nil</span><br>
<span class="lineno"></span><span class="op" id="3599550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3599553">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3599631">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3599702">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3599772">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3599845">func</span>&nbsp;<span class="op" id="3599850">(</span><span class="ident" id="3599851">t</span>&nbsp;<span class="op" id="3599853">*</span><span class="ident" id="3599854">Template</span><span class="op" id="3599862">)</span>&nbsp;<span class="ident" id="3599864">associate</span><span class="op" id="3599873">(</span><span class="builtinfunc" id="3599874">new</span>&nbsp;<span class="op" id="3599878">*</span><span class="ident" id="3599879">Template</span><span class="op" id="3599887">,</span>&nbsp;<span class="ident" id="3599889">tree</span>&nbsp;<span class="op" id="3599894">*</span><span class="ident" id="3599895">parse</span><span class="op" id="3599900">.</span><span class="ident" id="3599901">Tree</span><span class="op" id="3599905">)</span>&nbsp;<span class="op" id="3599907">(</span><span class="builtintype" id="3599908">bool</span><span class="op" id="3599912">,</span>&nbsp;<span class="builtintype" id="3599914">error</span><span class="op" id="3599919">)</span>&nbsp;<span class="op" id="3599921">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599924">if</span>&nbsp;<span class="builtinfunc" id="3599927">new</span><span class="op" id="3599930">.</span><span class="ident" id="3599931">common</span>&nbsp;<span class="op" id="3599938">!=</span>&nbsp;<span class="ident" id="3599941">t</span><span class="op" id="3599942">.</span><span class="ident" id="3599943">common</span>&nbsp;<span class="op" id="3599950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3599954">panic</span><span class="op" id="3599959">(</span><span class="string" id="3599960">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3599998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600004">name</span>&nbsp;<span class="op" id="3600009">:=</span>&nbsp;<span class="builtinfunc" id="3600012">new</span><span class="op" id="3600015">.</span><span class="ident" id="3600016">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600022">if</span>&nbsp;<span class="ident" id="3600025">old</span>&nbsp;<span class="op" id="3600029">:=</span>&nbsp;<span class="ident" id="3600032">t</span><span class="op" id="3600033">.</span><span class="ident" id="3600034">tmpl</span><span class="op" id="3600038">[</span><span class="ident" id="3600039">name</span><span class="op" id="3600043">]</span><span class="op" id="3600044">;</span>&nbsp;<span class="ident" id="3600046">old</span>&nbsp;<span class="op" id="3600050">!=</span>&nbsp;<span class="builtintype" id="3600053">nil</span>&nbsp;<span class="op" id="3600057">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600061">oldIsEmpty</span>&nbsp;<span class="op" id="3600072">:=</span>&nbsp;<span class="ident" id="3600075">parse</span><span class="op" id="3600080">.</span><span class="ident" id="3600081">IsEmptyTree</span><span class="op" id="3600092">(</span><span class="ident" id="3600093">old</span><span class="op" id="3600096">.</span><span class="ident" id="3600097">Root</span><span class="op" id="3600101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600105">newIsEmpty</span>&nbsp;<span class="op" id="3600116">:=</span>&nbsp;<span class="ident" id="3600119">parse</span><span class="op" id="3600124">.</span><span class="ident" id="3600125">IsEmptyTree</span><span class="op" id="3600136">(</span><span class="ident" id="3600137">tree</span><span class="op" id="3600141">.</span><span class="ident" id="3600142">Root</span><span class="op" id="3600146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600150">if</span>&nbsp;<span class="ident" id="3600153">newIsEmpty</span>&nbsp;<span class="op" id="3600164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3600169">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600244">return</span>&nbsp;<span class="builtintype" id="3600251">false</span><span class="op" id="3600256">,</span>&nbsp;<span class="builtintype" id="3600258">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600268">if</span>&nbsp;<span class="op" id="3600271">!</span><span class="ident" id="3600272">oldIsEmpty</span>&nbsp;<span class="op" id="3600283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600288">return</span>&nbsp;<span class="builtintype" id="3600295">false</span><span class="op" id="3600300">,</span>&nbsp;<span class="ident" id="3600302">fmt</span><span class="op" id="3600305">.</span><span class="ident" id="3600306">Errorf</span><span class="op" id="3600312">(</span><span class="string" id="3600313">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3600352">,</span>&nbsp;<span class="ident" id="3600354">name</span><span class="op" id="3600358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600365">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600368">t</span><span class="op" id="3600369">.</span><span class="ident" id="3600370">tmpl</span><span class="op" id="3600374">[</span><span class="ident" id="3600375">name</span><span class="op" id="3600379">]</span>&nbsp;<span class="op" id="3600381">=</span>&nbsp;<span class="builtinfunc" id="3600383">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600388">return</span>&nbsp;<span class="builtintype" id="3600395">true</span><span class="op" id="3600399">,</span>&nbsp;<span class="builtintype" id="3600401">nil</span><br>
<span class="lineno"></span><span class="op" id="3600405">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
