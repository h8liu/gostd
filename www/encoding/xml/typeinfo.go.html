<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6452601">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6452657">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6452711">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6452762">package</span>&nbsp;<span class="ident" id="6452770">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6452775">import</span>&nbsp;<span class="op" id="6452782">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6452785">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6452792">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6452803">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6452814">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6452821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6452824">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6452888">type</span>&nbsp;<span class="ident" id="6452893">typeInfo</span>&nbsp;<span class="keyword" id="6452902">struct</span>&nbsp;<span class="op" id="6452909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6452912">xmlname</span>&nbsp;<span class="op" id="6452920">*</span><span class="ident" id="6452921">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6452932">fields</span>&nbsp;&nbsp;<span class="op" id="6452940">[</span><span class="op" id="6452941">]</span><span class="ident" id="6452942">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6452952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6452955">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6453028">type</span>&nbsp;<span class="ident" id="6453033">fieldInfo</span>&nbsp;<span class="keyword" id="6453043">struct</span>&nbsp;<span class="op" id="6453050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453053">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6453061">[</span><span class="op" id="6453062">]</span><span class="builtintype" id="6453063">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453068">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6453076">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453084">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6453092">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453100">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6453108">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453120">parents</span>&nbsp;<span class="op" id="6453128">[</span><span class="op" id="6453129">]</span><span class="builtintype" id="6453130">string</span><br>
<span class="lineno"></span><span class="op" id="6453137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6453140">type</span>&nbsp;<span class="ident" id="6453145">fieldFlags</span>&nbsp;<span class="builtintype" id="6453156">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6453161">const</span>&nbsp;<span class="op" id="6453167">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453170">fElement</span>&nbsp;<span class="ident" id="6453179">fieldFlags</span>&nbsp;<span class="op" id="6453190">=</span>&nbsp;<span class="num" id="6453192">1</span>&nbsp;<span class="op" id="6453194">&lt;&lt;</span>&nbsp;<span class="ident" id="6453197">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453203">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453210">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453221">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453232">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453242">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453249">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453262">fMode</span>&nbsp;<span class="op" id="6453268">=</span>&nbsp;<span class="ident" id="6453270">fElement</span>&nbsp;<span class="op" id="6453279">|</span>&nbsp;<span class="ident" id="6453281">fAttr</span>&nbsp;<span class="op" id="6453287">|</span>&nbsp;<span class="ident" id="6453289">fCharData</span>&nbsp;<span class="op" id="6453299">|</span>&nbsp;<span class="ident" id="6453301">fInnerXml</span>&nbsp;<span class="op" id="6453311">|</span>&nbsp;<span class="ident" id="6453313">fComment</span>&nbsp;<span class="op" id="6453322">|</span>&nbsp;<span class="ident" id="6453324">fAny</span><br>
<span class="lineno"></span><span class="op" id="6453329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6453332">var</span>&nbsp;<span class="ident" id="6453336">tinfoMap</span>&nbsp;<span class="op" id="6453345">=</span>&nbsp;<span class="builtinfunc" id="6453347">make</span><span class="op" id="6453351">(</span><span class="keyword" id="6453352">map</span><span class="op" id="6453355">[</span><span class="ident" id="6453356">reflect</span><span class="op" id="6453363">.</span><span class="ident" id="6453364">Type</span><span class="op" id="6453368">]</span><span class="op" id="6453369">*</span><span class="ident" id="6453370">typeInfo</span><span class="op" id="6453378">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6453380">var</span>&nbsp;<span class="ident" id="6453384">tinfoLock</span>&nbsp;<span class="ident" id="6453394">sync</span><span class="op" id="6453398">.</span><span class="ident" id="6453399">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6453408">var</span>&nbsp;<span class="ident" id="6453412">nameType</span>&nbsp;<span class="op" id="6453421">=</span>&nbsp;<span class="ident" id="6453423">reflect</span><span class="op" id="6453430">.</span><span class="ident" id="6453431">TypeOf</span><span class="op" id="6453437">(</span><span class="ident" id="6453438">Name</span><span class="op" id="6453442">{</span><span class="op" id="6453443">}</span><span class="op" id="6453444">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6453447">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6453516">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6453558">func</span>&nbsp;<span class="ident" id="6453563">getTypeInfo</span><span class="op" id="6453574">(</span><span class="ident" id="6453575">typ</span>&nbsp;<span class="ident" id="6453579">reflect</span><span class="op" id="6453586">.</span><span class="ident" id="6453587">Type</span><span class="op" id="6453591">)</span>&nbsp;<span class="op" id="6453593">(</span><span class="op" id="6453594">*</span><span class="ident" id="6453595">typeInfo</span><span class="op" id="6453603">,</span>&nbsp;<span class="builtintype" id="6453605">error</span><span class="op" id="6453610">)</span>&nbsp;<span class="op" id="6453612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453615">tinfoLock</span><span class="op" id="6453624">.</span><span class="ident" id="6453625">RLock</span><span class="op" id="6453630">(</span><span class="op" id="6453631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453634">tinfo</span><span class="op" id="6453639">,</span>&nbsp;<span class="ident" id="6453641">ok</span>&nbsp;<span class="op" id="6453644">:=</span>&nbsp;<span class="ident" id="6453647">tinfoMap</span><span class="op" id="6453655">[</span><span class="ident" id="6453656">typ</span><span class="op" id="6453659">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453662">tinfoLock</span><span class="op" id="6453671">.</span><span class="ident" id="6453672">RUnlock</span><span class="op" id="6453679">(</span><span class="op" id="6453680">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453683">if</span>&nbsp;<span class="ident" id="6453686">ok</span>&nbsp;<span class="op" id="6453689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453693">return</span>&nbsp;<span class="ident" id="6453700">tinfo</span><span class="op" id="6453705">,</span>&nbsp;<span class="ident" id="6453707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453715">tinfo</span>&nbsp;<span class="op" id="6453721">=</span>&nbsp;<span class="op" id="6453723">&amp;</span><span class="ident" id="6453724">typeInfo</span><span class="op" id="6453732">{</span><span class="op" id="6453733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453736">if</span>&nbsp;<span class="ident" id="6453739">typ</span><span class="op" id="6453742">.</span><span class="ident" id="6453743">Kind</span><span class="op" id="6453747">(</span><span class="op" id="6453748">)</span>&nbsp;<span class="op" id="6453750">==</span>&nbsp;<span class="ident" id="6453753">reflect</span><span class="op" id="6453760">.</span><span class="ident" id="6453761">Struct</span>&nbsp;<span class="op" id="6453768">&amp;&amp;</span>&nbsp;<span class="ident" id="6453771">typ</span>&nbsp;<span class="op" id="6453775">!=</span>&nbsp;<span class="ident" id="6453778">nameType</span>&nbsp;<span class="op" id="6453787">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453791">n</span>&nbsp;<span class="op" id="6453793">:=</span>&nbsp;<span class="ident" id="6453796">typ</span><span class="op" id="6453799">.</span><span class="ident" id="6453800">NumField</span><span class="op" id="6453808">(</span><span class="op" id="6453809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453813">for</span>&nbsp;<span class="ident" id="6453817">i</span>&nbsp;<span class="op" id="6453819">:=</span>&nbsp;<span class="num" id="6453822">0</span><span class="op" id="6453823">;</span>&nbsp;<span class="ident" id="6453825">i</span>&nbsp;<span class="op" id="6453827">&lt;</span>&nbsp;<span class="ident" id="6453829">n</span><span class="op" id="6453830">;</span>&nbsp;<span class="ident" id="6453832">i</span><span class="op" id="6453833">++</span>&nbsp;<span class="op" id="6453836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453841">f</span>&nbsp;<span class="op" id="6453843">:=</span>&nbsp;<span class="ident" id="6453846">typ</span><span class="op" id="6453849">.</span><span class="ident" id="6453850">Field</span><span class="op" id="6453855">(</span><span class="ident" id="6453856">i</span><span class="op" id="6453857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453862">if</span>&nbsp;<span class="ident" id="6453865">f</span><span class="op" id="6453866">.</span><span class="ident" id="6453867">PkgPath</span>&nbsp;<span class="op" id="6453875">!=</span>&nbsp;<span class="string" id="6453878">&#34;&#34;</span>&nbsp;<span class="op" id="6453881">||</span>&nbsp;<span class="ident" id="6453884">f</span><span class="op" id="6453885">.</span><span class="ident" id="6453886">Tag</span><span class="op" id="6453889">.</span><span class="ident" id="6453890">Get</span><span class="op" id="6453893">(</span><span class="string" id="6453894">&#34;xml&#34;</span><span class="op" id="6453899">)</span>&nbsp;<span class="op" id="6453901">==</span>&nbsp;<span class="string" id="6453904">&#34;-&#34;</span>&nbsp;<span class="op" id="6453908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453914">continue</span>&nbsp;<span class="comment" id="6453923">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6453949">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453995">if</span>&nbsp;<span class="ident" id="6453998">f</span><span class="op" id="6453999">.</span><span class="ident" id="6454000">Anonymous</span>&nbsp;<span class="op" id="6454010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454016">t</span>&nbsp;<span class="op" id="6454018">:=</span>&nbsp;<span class="ident" id="6454021">f</span><span class="op" id="6454022">.</span><span class="ident" id="6454023">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454032">if</span>&nbsp;<span class="ident" id="6454035">t</span><span class="op" id="6454036">.</span><span class="ident" id="6454037">Kind</span><span class="op" id="6454041">(</span><span class="op" id="6454042">)</span>&nbsp;<span class="op" id="6454044">==</span>&nbsp;<span class="ident" id="6454047">reflect</span><span class="op" id="6454054">.</span><span class="ident" id="6454055">Ptr</span>&nbsp;<span class="op" id="6454059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454066">t</span>&nbsp;<span class="op" id="6454068">=</span>&nbsp;<span class="ident" id="6454070">t</span><span class="op" id="6454071">.</span><span class="ident" id="6454072">Elem</span><span class="op" id="6454076">(</span><span class="op" id="6454077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454089">if</span>&nbsp;<span class="ident" id="6454092">t</span><span class="op" id="6454093">.</span><span class="ident" id="6454094">Kind</span><span class="op" id="6454098">(</span><span class="op" id="6454099">)</span>&nbsp;<span class="op" id="6454101">==</span>&nbsp;<span class="ident" id="6454104">reflect</span><span class="op" id="6454111">.</span><span class="ident" id="6454112">Struct</span>&nbsp;<span class="op" id="6454119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454126">inner</span><span class="op" id="6454131">,</span>&nbsp;<span class="ident" id="6454133">err</span>&nbsp;<span class="op" id="6454137">:=</span>&nbsp;<span class="ident" id="6454140">getTypeInfo</span><span class="op" id="6454151">(</span><span class="ident" id="6454152">t</span><span class="op" id="6454153">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454160">if</span>&nbsp;<span class="ident" id="6454163">err</span>&nbsp;<span class="op" id="6454167">!=</span>&nbsp;<span class="ident" id="6454170">nil</span>&nbsp;<span class="op" id="6454174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454182">return</span>&nbsp;<span class="ident" id="6454189">nil</span><span class="op" id="6454192">,</span>&nbsp;<span class="ident" id="6454194">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454210">if</span>&nbsp;<span class="ident" id="6454213">tinfo</span><span class="op" id="6454218">.</span><span class="ident" id="6454219">xmlname</span>&nbsp;<span class="op" id="6454227">==</span>&nbsp;<span class="ident" id="6454230">nil</span>&nbsp;<span class="op" id="6454234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454242">tinfo</span><span class="op" id="6454247">.</span><span class="ident" id="6454248">xmlname</span>&nbsp;<span class="op" id="6454256">=</span>&nbsp;<span class="ident" id="6454258">inner</span><span class="op" id="6454263">.</span><span class="ident" id="6454264">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454284">for</span>&nbsp;<span class="ident" id="6454288">_</span><span class="op" id="6454289">,</span>&nbsp;<span class="ident" id="6454291">finfo</span>&nbsp;<span class="op" id="6454297">:=</span>&nbsp;<span class="keyword" id="6454300">range</span>&nbsp;<span class="ident" id="6454306">inner</span><span class="op" id="6454311">.</span><span class="ident" id="6454312">fields</span>&nbsp;<span class="op" id="6454319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454327">finfo</span><span class="op" id="6454332">.</span><span class="ident" id="6454333">idx</span>&nbsp;<span class="op" id="6454337">=</span>&nbsp;<span class="builtinfunc" id="6454339">append</span><span class="op" id="6454345">(</span><span class="op" id="6454346">[</span><span class="op" id="6454347">]</span><span class="builtintype" id="6454348">int</span><span class="op" id="6454351">{</span><span class="ident" id="6454352">i</span><span class="op" id="6454353">}</span><span class="op" id="6454354">,</span>&nbsp;<span class="ident" id="6454356">finfo</span><span class="op" id="6454361">.</span><span class="ident" id="6454362">idx</span><span class="op" id="6454365">...</span><span class="op" id="6454368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454376">if</span>&nbsp;<span class="ident" id="6454379">err</span>&nbsp;<span class="op" id="6454383">:=</span>&nbsp;<span class="ident" id="6454386">addFieldInfo</span><span class="op" id="6454398">(</span><span class="ident" id="6454399">typ</span><span class="op" id="6454402">,</span>&nbsp;<span class="ident" id="6454404">tinfo</span><span class="op" id="6454409">,</span>&nbsp;<span class="op" id="6454411">&amp;</span><span class="ident" id="6454412">finfo</span><span class="op" id="6454417">)</span><span class="op" id="6454418">;</span>&nbsp;<span class="ident" id="6454420">err</span>&nbsp;<span class="op" id="6454424">!=</span>&nbsp;<span class="ident" id="6454427">nil</span>&nbsp;<span class="op" id="6454431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454440">return</span>&nbsp;<span class="ident" id="6454447">nil</span><span class="op" id="6454450">,</span>&nbsp;<span class="ident" id="6454452">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454476">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454494">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454500">finfo</span><span class="op" id="6454505">,</span>&nbsp;<span class="ident" id="6454507">err</span>&nbsp;<span class="op" id="6454511">:=</span>&nbsp;<span class="ident" id="6454514">structFieldInfo</span><span class="op" id="6454529">(</span><span class="ident" id="6454530">typ</span><span class="op" id="6454533">,</span>&nbsp;<span class="op" id="6454535">&amp;</span><span class="ident" id="6454536">f</span><span class="op" id="6454537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454542">if</span>&nbsp;<span class="ident" id="6454545">err</span>&nbsp;<span class="op" id="6454549">!=</span>&nbsp;<span class="ident" id="6454552">nil</span>&nbsp;<span class="op" id="6454556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454562">return</span>&nbsp;<span class="ident" id="6454569">nil</span><span class="op" id="6454572">,</span>&nbsp;<span class="ident" id="6454574">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454581">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454587">if</span>&nbsp;<span class="ident" id="6454590">f</span><span class="op" id="6454591">.</span><span class="ident" id="6454592">Name</span>&nbsp;<span class="op" id="6454597">==</span>&nbsp;<span class="string" id="6454600">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6454610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454616">tinfo</span><span class="op" id="6454621">.</span><span class="ident" id="6454622">xmlname</span>&nbsp;<span class="op" id="6454630">=</span>&nbsp;<span class="ident" id="6454632">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454642">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454654">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6454660">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454722">if</span>&nbsp;<span class="ident" id="6454725">err</span>&nbsp;<span class="op" id="6454729">:=</span>&nbsp;<span class="ident" id="6454732">addFieldInfo</span><span class="op" id="6454744">(</span><span class="ident" id="6454745">typ</span><span class="op" id="6454748">,</span>&nbsp;<span class="ident" id="6454750">tinfo</span><span class="op" id="6454755">,</span>&nbsp;<span class="ident" id="6454757">finfo</span><span class="op" id="6454762">)</span><span class="op" id="6454763">;</span>&nbsp;<span class="ident" id="6454765">err</span>&nbsp;<span class="op" id="6454769">!=</span>&nbsp;<span class="ident" id="6454772">nil</span>&nbsp;<span class="op" id="6454776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454782">return</span>&nbsp;<span class="ident" id="6454789">nil</span><span class="op" id="6454792">,</span>&nbsp;<span class="ident" id="6454794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454801">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6454808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454811">tinfoLock</span><span class="op" id="6454820">.</span><span class="ident" id="6454821">Lock</span><span class="op" id="6454825">(</span><span class="op" id="6454826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454829">tinfoMap</span><span class="op" id="6454837">[</span><span class="ident" id="6454838">typ</span><span class="op" id="6454841">]</span>&nbsp;<span class="op" id="6454843">=</span>&nbsp;<span class="ident" id="6454845">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6454852">tinfoLock</span><span class="op" id="6454861">.</span><span class="ident" id="6454862">Unlock</span><span class="op" id="6454868">(</span><span class="op" id="6454869">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6454872">return</span>&nbsp;<span class="ident" id="6454879">tinfo</span><span class="op" id="6454884">,</span>&nbsp;<span class="ident" id="6454886">nil</span><br>
<span class="lineno"></span><span class="op" id="6454890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6454893">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6454950">func</span>&nbsp;<span class="ident" id="6454955">structFieldInfo</span><span class="op" id="6454970">(</span><span class="ident" id="6454971">typ</span>&nbsp;<span class="ident" id="6454975">reflect</span><span class="op" id="6454982">.</span><span class="ident" id="6454983">Type</span><span class="op" id="6454987">,</span>&nbsp;<span class="ident" id="6454989">f</span>&nbsp;<span class="op" id="6454991">*</span><span class="ident" id="6454992">reflect</span><span class="op" id="6454999">.</span><span class="ident" id="6455000">StructField</span><span class="op" id="6455011">)</span>&nbsp;<span class="op" id="6455013">(</span><span class="op" id="6455014">*</span><span class="ident" id="6455015">fieldInfo</span><span class="op" id="6455024">,</span>&nbsp;<span class="builtintype" id="6455026">error</span><span class="op" id="6455031">)</span>&nbsp;<span class="op" id="6455033">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455036">finfo</span>&nbsp;<span class="op" id="6455042">:=</span>&nbsp;<span class="op" id="6455045">&amp;</span><span class="ident" id="6455046">fieldInfo</span><span class="op" id="6455055">{</span><span class="ident" id="6455056">idx</span><span class="op" id="6455059">:</span>&nbsp;<span class="ident" id="6455061">f</span><span class="op" id="6455062">.</span><span class="ident" id="6455063">Index</span><span class="op" id="6455068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6455072">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455127">tag</span>&nbsp;<span class="op" id="6455131">:=</span>&nbsp;<span class="ident" id="6455134">f</span><span class="op" id="6455135">.</span><span class="ident" id="6455136">Tag</span><span class="op" id="6455139">.</span><span class="ident" id="6455140">Get</span><span class="op" id="6455143">(</span><span class="string" id="6455144">&#34;xml&#34;</span><span class="op" id="6455149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455152">if</span>&nbsp;<span class="ident" id="6455155">i</span>&nbsp;<span class="op" id="6455157">:=</span>&nbsp;<span class="ident" id="6455160">strings</span><span class="op" id="6455167">.</span><span class="ident" id="6455168">Index</span><span class="op" id="6455173">(</span><span class="ident" id="6455174">tag</span><span class="op" id="6455177">,</span>&nbsp;<span class="string" id="6455179">&#34;&nbsp;&#34;</span><span class="op" id="6455182">)</span><span class="op" id="6455183">;</span>&nbsp;<span class="ident" id="6455185">i</span>&nbsp;<span class="op" id="6455187">&gt;=</span>&nbsp;<span class="num" id="6455190">0</span>&nbsp;<span class="op" id="6455192">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455196">finfo</span><span class="op" id="6455201">.</span><span class="ident" id="6455202">xmlns</span><span class="op" id="6455207">,</span>&nbsp;<span class="ident" id="6455209">tag</span>&nbsp;<span class="op" id="6455213">=</span>&nbsp;<span class="ident" id="6455215">tag</span><span class="op" id="6455218">[</span><span class="op" id="6455219">:</span><span class="ident" id="6455220">i</span><span class="op" id="6455221">]</span><span class="op" id="6455222">,</span>&nbsp;<span class="ident" id="6455224">tag</span><span class="op" id="6455227">[</span><span class="ident" id="6455228">i</span><span class="op" id="6455229">+</span><span class="num" id="6455230">1</span><span class="op" id="6455231">:</span><span class="op" id="6455232">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6455235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6455239">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455256">tokens</span>&nbsp;<span class="op" id="6455263">:=</span>&nbsp;<span class="ident" id="6455266">strings</span><span class="op" id="6455273">.</span><span class="ident" id="6455274">Split</span><span class="op" id="6455279">(</span><span class="ident" id="6455280">tag</span><span class="op" id="6455283">,</span>&nbsp;<span class="string" id="6455285">&#34;,&#34;</span><span class="op" id="6455288">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455291">if</span>&nbsp;<span class="builtinfunc" id="6455294">len</span><span class="op" id="6455297">(</span><span class="ident" id="6455298">tokens</span><span class="op" id="6455304">)</span>&nbsp;<span class="op" id="6455306">==</span>&nbsp;<span class="num" id="6455309">1</span>&nbsp;<span class="op" id="6455311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455315">finfo</span><span class="op" id="6455320">.</span><span class="ident" id="6455321">flags</span>&nbsp;<span class="op" id="6455327">=</span>&nbsp;<span class="ident" id="6455329">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6455339">}</span>&nbsp;<span class="keyword" id="6455341">else</span>&nbsp;<span class="op" id="6455346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455350">tag</span>&nbsp;<span class="op" id="6455354">=</span>&nbsp;<span class="ident" id="6455356">tokens</span><span class="op" id="6455362">[</span><span class="num" id="6455363">0</span><span class="op" id="6455364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455368">for</span>&nbsp;<span class="ident" id="6455372">_</span><span class="op" id="6455373">,</span>&nbsp;<span class="ident" id="6455375">flag</span>&nbsp;<span class="op" id="6455380">:=</span>&nbsp;<span class="keyword" id="6455383">range</span>&nbsp;<span class="ident" id="6455389">tokens</span><span class="op" id="6455395">[</span><span class="num" id="6455396">1</span><span class="op" id="6455397">:</span><span class="op" id="6455398">]</span>&nbsp;<span class="op" id="6455400">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455405">switch</span>&nbsp;<span class="ident" id="6455412">flag</span>&nbsp;<span class="op" id="6455417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455422">case</span>&nbsp;<span class="string" id="6455427">&#34;attr&#34;</span><span class="op" id="6455433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455439">finfo</span><span class="op" id="6455444">.</span><span class="ident" id="6455445">flags</span>&nbsp;<span class="op" id="6455451">|=</span>&nbsp;<span class="ident" id="6455454">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455463">case</span>&nbsp;<span class="string" id="6455468">&#34;chardata&#34;</span><span class="op" id="6455478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455484">finfo</span><span class="op" id="6455489">.</span><span class="ident" id="6455490">flags</span>&nbsp;<span class="op" id="6455496">|=</span>&nbsp;<span class="ident" id="6455499">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455512">case</span>&nbsp;<span class="string" id="6455517">&#34;innerxml&#34;</span><span class="op" id="6455527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455533">finfo</span><span class="op" id="6455538">.</span><span class="ident" id="6455539">flags</span>&nbsp;<span class="op" id="6455545">|=</span>&nbsp;<span class="ident" id="6455548">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455561">case</span>&nbsp;<span class="string" id="6455566">&#34;comment&#34;</span><span class="op" id="6455575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455581">finfo</span><span class="op" id="6455586">.</span><span class="ident" id="6455587">flags</span>&nbsp;<span class="op" id="6455593">|=</span>&nbsp;<span class="ident" id="6455596">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455608">case</span>&nbsp;<span class="string" id="6455613">&#34;any&#34;</span><span class="op" id="6455618">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455624">finfo</span><span class="op" id="6455629">.</span><span class="ident" id="6455630">flags</span>&nbsp;<span class="op" id="6455636">|=</span>&nbsp;<span class="ident" id="6455639">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455647">case</span>&nbsp;<span class="string" id="6455652">&#34;omitempty&#34;</span><span class="op" id="6455663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455669">finfo</span><span class="op" id="6455674">.</span><span class="ident" id="6455675">flags</span>&nbsp;<span class="op" id="6455681">|=</span>&nbsp;<span class="ident" id="6455684">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6455698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6455702">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6455707">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455737">valid</span>&nbsp;<span class="op" id="6455743">:=</span>&nbsp;<span class="ident" id="6455746">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455753">switch</span>&nbsp;<span class="ident" id="6455760">mode</span>&nbsp;<span class="op" id="6455765">:=</span>&nbsp;<span class="ident" id="6455768">finfo</span><span class="op" id="6455773">.</span><span class="ident" id="6455774">flags</span>&nbsp;<span class="op" id="6455780">&amp;</span>&nbsp;<span class="ident" id="6455782">fMode</span><span class="op" id="6455787">;</span>&nbsp;<span class="ident" id="6455789">mode</span>&nbsp;<span class="op" id="6455794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455798">case</span>&nbsp;<span class="num" id="6455803">0</span><span class="op" id="6455804">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455809">finfo</span><span class="op" id="6455814">.</span><span class="ident" id="6455815">flags</span>&nbsp;<span class="op" id="6455821">|=</span>&nbsp;<span class="ident" id="6455824">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455835">case</span>&nbsp;<span class="ident" id="6455840">fAttr</span><span class="op" id="6455845">,</span>&nbsp;<span class="ident" id="6455847">fCharData</span><span class="op" id="6455856">,</span>&nbsp;<span class="ident" id="6455858">fInnerXml</span><span class="op" id="6455867">,</span>&nbsp;<span class="ident" id="6455869">fComment</span><span class="op" id="6455877">,</span>&nbsp;<span class="ident" id="6455879">fAny</span><span class="op" id="6455883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455888">if</span>&nbsp;<span class="ident" id="6455891">f</span><span class="op" id="6455892">.</span><span class="ident" id="6455893">Name</span>&nbsp;<span class="op" id="6455898">==</span>&nbsp;<span class="string" id="6455901">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6455911">||</span>&nbsp;<span class="ident" id="6455914">tag</span>&nbsp;<span class="op" id="6455918">!=</span>&nbsp;<span class="string" id="6455921">&#34;&#34;</span>&nbsp;<span class="op" id="6455924">&amp;&amp;</span>&nbsp;<span class="ident" id="6455927">mode</span>&nbsp;<span class="op" id="6455932">!=</span>&nbsp;<span class="ident" id="6455935">fAttr</span>&nbsp;<span class="op" id="6455941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6455947">valid</span>&nbsp;<span class="op" id="6455953">=</span>&nbsp;<span class="ident" id="6455955">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6455964">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6455968">default</span><span class="op" id="6455975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6455980">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456041">valid</span>&nbsp;<span class="op" id="6456047">=</span>&nbsp;<span class="ident" id="6456049">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456061">if</span>&nbsp;<span class="ident" id="6456064">finfo</span><span class="op" id="6456069">.</span><span class="ident" id="6456070">flags</span><span class="op" id="6456075">&amp;</span><span class="ident" id="6456076">fMode</span>&nbsp;<span class="op" id="6456082">==</span>&nbsp;<span class="ident" id="6456085">fAny</span>&nbsp;<span class="op" id="6456090">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456095">finfo</span><span class="op" id="6456100">.</span><span class="ident" id="6456101">flags</span>&nbsp;<span class="op" id="6456107">|=</span>&nbsp;<span class="ident" id="6456110">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456125">if</span>&nbsp;<span class="ident" id="6456128">finfo</span><span class="op" id="6456133">.</span><span class="ident" id="6456134">flags</span><span class="op" id="6456139">&amp;</span><span class="ident" id="6456140">fOmitEmpty</span>&nbsp;<span class="op" id="6456151">!=</span>&nbsp;<span class="num" id="6456154">0</span>&nbsp;<span class="op" id="6456156">&amp;&amp;</span>&nbsp;<span class="ident" id="6456159">finfo</span><span class="op" id="6456164">.</span><span class="ident" id="6456165">flags</span><span class="op" id="6456170">&amp;</span><span class="op" id="6456171">(</span><span class="ident" id="6456172">fElement</span><span class="op" id="6456180">|</span><span class="ident" id="6456181">fAttr</span><span class="op" id="6456186">)</span>&nbsp;<span class="op" id="6456188">==</span>&nbsp;<span class="num" id="6456191">0</span>&nbsp;<span class="op" id="6456193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456198">valid</span>&nbsp;<span class="op" id="6456204">=</span>&nbsp;<span class="ident" id="6456206">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456214">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456218">if</span>&nbsp;<span class="op" id="6456221">!</span><span class="ident" id="6456222">valid</span>&nbsp;<span class="op" id="6456228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456233">return</span>&nbsp;<span class="ident" id="6456240">nil</span><span class="op" id="6456243">,</span>&nbsp;<span class="ident" id="6456245">fmt</span><span class="op" id="6456248">.</span><span class="ident" id="6456249">Errorf</span><span class="op" id="6456255">(</span><span class="string" id="6456256">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6456301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456307">f</span><span class="op" id="6456308">.</span><span class="ident" id="6456309">Name</span><span class="op" id="6456313">,</span>&nbsp;<span class="ident" id="6456315">typ</span><span class="op" id="6456318">,</span>&nbsp;<span class="ident" id="6456320">f</span><span class="op" id="6456321">.</span><span class="ident" id="6456322">Tag</span><span class="op" id="6456325">.</span><span class="ident" id="6456326">Get</span><span class="op" id="6456329">(</span><span class="string" id="6456330">&#34;xml&#34;</span><span class="op" id="6456335">)</span><span class="op" id="6456336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456343">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456347">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456395">if</span>&nbsp;<span class="ident" id="6456398">finfo</span><span class="op" id="6456403">.</span><span class="ident" id="6456404">xmlns</span>&nbsp;<span class="op" id="6456410">!=</span>&nbsp;<span class="string" id="6456413">&#34;&#34;</span>&nbsp;<span class="op" id="6456416">&amp;&amp;</span>&nbsp;<span class="ident" id="6456419">tag</span>&nbsp;<span class="op" id="6456423">==</span>&nbsp;<span class="string" id="6456426">&#34;&#34;</span>&nbsp;<span class="op" id="6456429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456433">return</span>&nbsp;<span class="ident" id="6456440">nil</span><span class="op" id="6456443">,</span>&nbsp;<span class="ident" id="6456445">fmt</span><span class="op" id="6456448">.</span><span class="ident" id="6456449">Errorf</span><span class="op" id="6456455">(</span><span class="string" id="6456456">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6456512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456517">f</span><span class="op" id="6456518">.</span><span class="ident" id="6456519">Name</span><span class="op" id="6456523">,</span>&nbsp;<span class="ident" id="6456525">typ</span><span class="op" id="6456528">,</span>&nbsp;<span class="ident" id="6456530">f</span><span class="op" id="6456531">.</span><span class="ident" id="6456532">Tag</span><span class="op" id="6456535">.</span><span class="ident" id="6456536">Get</span><span class="op" id="6456539">(</span><span class="string" id="6456540">&#34;xml&#34;</span><span class="op" id="6456545">)</span><span class="op" id="6456546">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456553">if</span>&nbsp;<span class="ident" id="6456556">f</span><span class="op" id="6456557">.</span><span class="ident" id="6456558">Name</span>&nbsp;<span class="op" id="6456563">==</span>&nbsp;<span class="string" id="6456566">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6456576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456580">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456639">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456699">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6456741">finfo</span><span class="op" id="6456746">.</span><span class="ident" id="6456747">name</span>&nbsp;<span class="op" id="6456752">=</span>&nbsp;<span class="ident" id="6456754">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456760">return</span>&nbsp;<span class="ident" id="6456767">finfo</span><span class="op" id="6456772">,</span>&nbsp;<span class="ident" id="6456774">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6456779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456783">if</span>&nbsp;<span class="ident" id="6456786">tag</span>&nbsp;<span class="op" id="6456790">==</span>&nbsp;<span class="string" id="6456793">&#34;&#34;</span>&nbsp;<span class="op" id="6456796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456800">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456858">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6456918">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6456948">if</span>&nbsp;<span class="ident" id="6456951">xmlname</span>&nbsp;<span class="op" id="6456959">:=</span>&nbsp;<span class="ident" id="6456962">lookupXMLName</span><span class="op" id="6456975">(</span><span class="ident" id="6456976">f</span><span class="op" id="6456977">.</span><span class="ident" id="6456978">Type</span><span class="op" id="6456982">)</span><span class="op" id="6456983">;</span>&nbsp;<span class="ident" id="6456985">xmlname</span>&nbsp;<span class="op" id="6456993">!=</span>&nbsp;<span class="ident" id="6456996">nil</span>&nbsp;<span class="op" id="6457000">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457005">finfo</span><span class="op" id="6457010">.</span><span class="ident" id="6457011">xmlns</span><span class="op" id="6457016">,</span>&nbsp;<span class="ident" id="6457018">finfo</span><span class="op" id="6457023">.</span><span class="ident" id="6457024">name</span>&nbsp;<span class="op" id="6457029">=</span>&nbsp;<span class="ident" id="6457031">xmlname</span><span class="op" id="6457038">.</span><span class="ident" id="6457039">xmlns</span><span class="op" id="6457044">,</span>&nbsp;<span class="ident" id="6457046">xmlname</span><span class="op" id="6457053">.</span><span class="ident" id="6457054">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457061">}</span>&nbsp;<span class="keyword" id="6457063">else</span>&nbsp;<span class="op" id="6457068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457073">finfo</span><span class="op" id="6457078">.</span><span class="ident" id="6457079">name</span>&nbsp;<span class="op" id="6457084">=</span>&nbsp;<span class="ident" id="6457086">f</span><span class="op" id="6457087">.</span><span class="ident" id="6457088">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457099">return</span>&nbsp;<span class="ident" id="6457106">finfo</span><span class="op" id="6457111">,</span>&nbsp;<span class="ident" id="6457113">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6457122">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457158">parents</span>&nbsp;<span class="op" id="6457166">:=</span>&nbsp;<span class="ident" id="6457169">strings</span><span class="op" id="6457176">.</span><span class="ident" id="6457177">Split</span><span class="op" id="6457182">(</span><span class="ident" id="6457183">tag</span><span class="op" id="6457186">,</span>&nbsp;<span class="string" id="6457188">&#34;&gt;&#34;</span><span class="op" id="6457191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457194">if</span>&nbsp;<span class="ident" id="6457197">parents</span><span class="op" id="6457204">[</span><span class="num" id="6457205">0</span><span class="op" id="6457206">]</span>&nbsp;<span class="op" id="6457208">==</span>&nbsp;<span class="string" id="6457211">&#34;&#34;</span>&nbsp;<span class="op" id="6457214">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457218">parents</span><span class="op" id="6457225">[</span><span class="num" id="6457226">0</span><span class="op" id="6457227">]</span>&nbsp;<span class="op" id="6457229">=</span>&nbsp;<span class="ident" id="6457231">f</span><span class="op" id="6457232">.</span><span class="ident" id="6457233">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457242">if</span>&nbsp;<span class="ident" id="6457245">parents</span><span class="op" id="6457252">[</span><span class="builtinfunc" id="6457253">len</span><span class="op" id="6457256">(</span><span class="ident" id="6457257">parents</span><span class="op" id="6457264">)</span><span class="op" id="6457265">-</span><span class="num" id="6457266">1</span><span class="op" id="6457267">]</span>&nbsp;<span class="op" id="6457269">==</span>&nbsp;<span class="string" id="6457272">&#34;&#34;</span>&nbsp;<span class="op" id="6457275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457279">return</span>&nbsp;<span class="ident" id="6457286">nil</span><span class="op" id="6457289">,</span>&nbsp;<span class="ident" id="6457291">fmt</span><span class="op" id="6457294">.</span><span class="ident" id="6457295">Errorf</span><span class="op" id="6457301">(</span><span class="string" id="6457302">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6457344">,</span>&nbsp;<span class="ident" id="6457346">f</span><span class="op" id="6457347">.</span><span class="ident" id="6457348">Name</span><span class="op" id="6457352">,</span>&nbsp;<span class="ident" id="6457354">typ</span><span class="op" id="6457357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457360">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457363">finfo</span><span class="op" id="6457368">.</span><span class="ident" id="6457369">name</span>&nbsp;<span class="op" id="6457374">=</span>&nbsp;<span class="ident" id="6457376">parents</span><span class="op" id="6457383">[</span><span class="builtinfunc" id="6457384">len</span><span class="op" id="6457387">(</span><span class="ident" id="6457388">parents</span><span class="op" id="6457395">)</span><span class="op" id="6457396">-</span><span class="num" id="6457397">1</span><span class="op" id="6457398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457401">if</span>&nbsp;<span class="builtinfunc" id="6457404">len</span><span class="op" id="6457407">(</span><span class="ident" id="6457408">parents</span><span class="op" id="6457415">)</span>&nbsp;<span class="op" id="6457417">&gt;</span>&nbsp;<span class="num" id="6457419">1</span>&nbsp;<span class="op" id="6457421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457425">if</span>&nbsp;<span class="op" id="6457428">(</span><span class="ident" id="6457429">finfo</span><span class="op" id="6457434">.</span><span class="ident" id="6457435">flags</span>&nbsp;<span class="op" id="6457441">&amp;</span>&nbsp;<span class="ident" id="6457443">fElement</span><span class="op" id="6457451">)</span>&nbsp;<span class="op" id="6457453">==</span>&nbsp;<span class="num" id="6457456">0</span>&nbsp;<span class="op" id="6457458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457463">return</span>&nbsp;<span class="ident" id="6457470">nil</span><span class="op" id="6457473">,</span>&nbsp;<span class="ident" id="6457475">fmt</span><span class="op" id="6457478">.</span><span class="ident" id="6457479">Errorf</span><span class="op" id="6457485">(</span><span class="string" id="6457486">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6457524">,</span>&nbsp;<span class="ident" id="6457526">tag</span><span class="op" id="6457529">,</span>&nbsp;<span class="ident" id="6457531">strings</span><span class="op" id="6457538">.</span><span class="ident" id="6457539">Join</span><span class="op" id="6457543">(</span><span class="ident" id="6457544">tokens</span><span class="op" id="6457550">[</span><span class="num" id="6457551">1</span><span class="op" id="6457552">:</span><span class="op" id="6457553">]</span><span class="op" id="6457554">,</span>&nbsp;<span class="string" id="6457556">&#34;,&#34;</span><span class="op" id="6457559">)</span><span class="op" id="6457560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457564">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457568">finfo</span><span class="op" id="6457573">.</span><span class="ident" id="6457574">parents</span>&nbsp;<span class="op" id="6457582">=</span>&nbsp;<span class="ident" id="6457584">parents</span><span class="op" id="6457591">[</span><span class="op" id="6457592">:</span><span class="builtinfunc" id="6457593">len</span><span class="op" id="6457596">(</span><span class="ident" id="6457597">parents</span><span class="op" id="6457604">)</span><span class="op" id="6457605">-</span><span class="num" id="6457606">1</span><span class="op" id="6457607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6457610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6457614">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6457679">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6457742">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457782">if</span>&nbsp;<span class="ident" id="6457785">finfo</span><span class="op" id="6457790">.</span><span class="ident" id="6457791">flags</span><span class="op" id="6457796">&amp;</span><span class="ident" id="6457797">fElement</span>&nbsp;<span class="op" id="6457806">!=</span>&nbsp;<span class="num" id="6457809">0</span>&nbsp;<span class="op" id="6457811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457815">ftyp</span>&nbsp;<span class="op" id="6457820">:=</span>&nbsp;<span class="ident" id="6457823">f</span><span class="op" id="6457824">.</span><span class="ident" id="6457825">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6457832">xmlname</span>&nbsp;<span class="op" id="6457840">:=</span>&nbsp;<span class="ident" id="6457843">lookupXMLName</span><span class="op" id="6457856">(</span><span class="ident" id="6457857">ftyp</span><span class="op" id="6457861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457865">if</span>&nbsp;<span class="ident" id="6457868">xmlname</span>&nbsp;<span class="op" id="6457876">!=</span>&nbsp;<span class="ident" id="6457879">nil</span>&nbsp;<span class="op" id="6457883">&amp;&amp;</span>&nbsp;<span class="ident" id="6457886">xmlname</span><span class="op" id="6457893">.</span><span class="ident" id="6457894">name</span>&nbsp;<span class="op" id="6457899">!=</span>&nbsp;<span class="ident" id="6457902">finfo</span><span class="op" id="6457907">.</span><span class="ident" id="6457908">name</span>&nbsp;<span class="op" id="6457913">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6457918">return</span>&nbsp;<span class="ident" id="6457925">nil</span><span class="op" id="6457928">,</span>&nbsp;<span class="ident" id="6457930">fmt</span><span class="op" id="6457933">.</span><span class="ident" id="6457934">Errorf</span><span class="op" id="6457940">(</span><span class="string" id="6457941">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6458008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6458014">finfo</span><span class="op" id="6458019">.</span><span class="ident" id="6458020">name</span><span class="op" id="6458024">,</span>&nbsp;<span class="ident" id="6458026">typ</span><span class="op" id="6458029">,</span>&nbsp;<span class="ident" id="6458031">f</span><span class="op" id="6458032">.</span><span class="ident" id="6458033">Name</span><span class="op" id="6458037">,</span>&nbsp;<span class="ident" id="6458039">xmlname</span><span class="op" id="6458046">.</span><span class="ident" id="6458047">name</span><span class="op" id="6458051">,</span>&nbsp;<span class="ident" id="6458053">ftyp</span><span class="op" id="6458057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458067">return</span>&nbsp;<span class="ident" id="6458074">finfo</span><span class="op" id="6458079">,</span>&nbsp;<span class="ident" id="6458081">nil</span><br>
<span class="lineno">225</span><span class="op" id="6458085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6458088">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6458151">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6458213">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6458232">func</span>&nbsp;<span class="ident" id="6458237">lookupXMLName</span><span class="op" id="6458250">(</span><span class="ident" id="6458251">typ</span>&nbsp;<span class="ident" id="6458255">reflect</span><span class="op" id="6458262">.</span><span class="ident" id="6458263">Type</span><span class="op" id="6458267">)</span>&nbsp;<span class="op" id="6458269">(</span><span class="ident" id="6458270">xmlname</span>&nbsp;<span class="op" id="6458278">*</span><span class="ident" id="6458279">fieldInfo</span><span class="op" id="6458288">)</span>&nbsp;<span class="op" id="6458290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458293">for</span>&nbsp;<span class="ident" id="6458297">typ</span><span class="op" id="6458300">.</span><span class="ident" id="6458301">Kind</span><span class="op" id="6458305">(</span><span class="op" id="6458306">)</span>&nbsp;<span class="op" id="6458308">==</span>&nbsp;<span class="ident" id="6458311">reflect</span><span class="op" id="6458318">.</span><span class="ident" id="6458319">Ptr</span>&nbsp;<span class="op" id="6458323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6458327">typ</span>&nbsp;<span class="op" id="6458331">=</span>&nbsp;<span class="ident" id="6458333">typ</span><span class="op" id="6458336">.</span><span class="ident" id="6458337">Elem</span><span class="op" id="6458341">(</span><span class="op" id="6458342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458348">if</span>&nbsp;<span class="ident" id="6458351">typ</span><span class="op" id="6458354">.</span><span class="ident" id="6458355">Kind</span><span class="op" id="6458359">(</span><span class="op" id="6458360">)</span>&nbsp;<span class="op" id="6458362">!=</span>&nbsp;<span class="ident" id="6458365">reflect</span><span class="op" id="6458372">.</span><span class="ident" id="6458373">Struct</span>&nbsp;<span class="op" id="6458380">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458384">return</span>&nbsp;<span class="ident" id="6458391">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458399">for</span>&nbsp;<span class="ident" id="6458403">i</span><span class="op" id="6458404">,</span>&nbsp;<span class="ident" id="6458406">n</span>&nbsp;<span class="op" id="6458408">:=</span>&nbsp;<span class="num" id="6458411">0</span><span class="op" id="6458412">,</span>&nbsp;<span class="ident" id="6458414">typ</span><span class="op" id="6458417">.</span><span class="ident" id="6458418">NumField</span><span class="op" id="6458426">(</span><span class="op" id="6458427">)</span><span class="op" id="6458428">;</span>&nbsp;<span class="ident" id="6458430">i</span>&nbsp;<span class="op" id="6458432">&lt;</span>&nbsp;<span class="ident" id="6458434">n</span><span class="op" id="6458435">;</span>&nbsp;<span class="ident" id="6458437">i</span><span class="op" id="6458438">++</span>&nbsp;<span class="op" id="6458441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6458445">f</span>&nbsp;<span class="op" id="6458447">:=</span>&nbsp;<span class="ident" id="6458450">typ</span><span class="op" id="6458453">.</span><span class="ident" id="6458454">Field</span><span class="op" id="6458459">(</span><span class="ident" id="6458460">i</span><span class="op" id="6458461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458465">if</span>&nbsp;<span class="ident" id="6458468">f</span><span class="op" id="6458469">.</span><span class="ident" id="6458470">Name</span>&nbsp;<span class="op" id="6458475">!=</span>&nbsp;<span class="string" id="6458478">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6458488">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458493">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6458508">finfo</span><span class="op" id="6458513">,</span>&nbsp;<span class="ident" id="6458515">err</span>&nbsp;<span class="op" id="6458519">:=</span>&nbsp;<span class="ident" id="6458522">structFieldInfo</span><span class="op" id="6458537">(</span><span class="ident" id="6458538">typ</span><span class="op" id="6458541">,</span>&nbsp;<span class="op" id="6458543">&amp;</span><span class="ident" id="6458544">f</span><span class="op" id="6458545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458549">if</span>&nbsp;<span class="ident" id="6458552">finfo</span><span class="op" id="6458557">.</span><span class="ident" id="6458558">name</span>&nbsp;<span class="op" id="6458563">!=</span>&nbsp;<span class="string" id="6458566">&#34;&#34;</span>&nbsp;<span class="op" id="6458569">&amp;&amp;</span>&nbsp;<span class="ident" id="6458572">err</span>&nbsp;<span class="op" id="6458576">==</span>&nbsp;<span class="ident" id="6458579">nil</span>&nbsp;<span class="op" id="6458583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458588">return</span>&nbsp;<span class="ident" id="6458595">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6458607">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6458661">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458711">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458718">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458721">return</span>&nbsp;<span class="ident" id="6458728">nil</span><br>
<span class="lineno"></span><span class="op" id="6458732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6458735">func</span>&nbsp;<span class="ident" id="6458740">min</span><span class="op" id="6458743">(</span><span class="ident" id="6458744">a</span><span class="op" id="6458745">,</span>&nbsp;<span class="ident" id="6458747">b</span>&nbsp;<span class="builtintype" id="6458749">int</span><span class="op" id="6458752">)</span>&nbsp;<span class="builtintype" id="6458754">int</span>&nbsp;<span class="op" id="6458758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458761">if</span>&nbsp;<span class="ident" id="6458764">a</span>&nbsp;<span class="op" id="6458766">&lt;=</span>&nbsp;<span class="ident" id="6458769">b</span>&nbsp;<span class="op" id="6458771">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458775">return</span>&nbsp;<span class="ident" id="6458782">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6458785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6458788">return</span>&nbsp;<span class="ident" id="6458795">b</span><br>
<span class="lineno"></span><span class="op" id="6458797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6458800">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6458859">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6458926">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6458996">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6459042">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6459107">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6459176">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6459241">func</span>&nbsp;<span class="ident" id="6459246">addFieldInfo</span><span class="op" id="6459258">(</span><span class="ident" id="6459259">typ</span>&nbsp;<span class="ident" id="6459263">reflect</span><span class="op" id="6459270">.</span><span class="ident" id="6459271">Type</span><span class="op" id="6459275">,</span>&nbsp;<span class="ident" id="6459277">tinfo</span>&nbsp;<span class="op" id="6459283">*</span><span class="ident" id="6459284">typeInfo</span><span class="op" id="6459292">,</span>&nbsp;<span class="ident" id="6459294">newf</span>&nbsp;<span class="op" id="6459299">*</span><span class="ident" id="6459300">fieldInfo</span><span class="op" id="6459309">)</span>&nbsp;<span class="builtintype" id="6459311">error</span>&nbsp;<span class="op" id="6459317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459320">var</span>&nbsp;<span class="ident" id="6459324">conflicts</span>&nbsp;<span class="op" id="6459334">[</span><span class="op" id="6459335">]</span><span class="builtintype" id="6459336">int</span><br>
<span class="lineno"></span><span class="ident" id="6459340">Loop</span><span class="op" id="6459344">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6459347">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459414">for</span>&nbsp;<span class="ident" id="6459418">i</span>&nbsp;<span class="op" id="6459420">:=</span>&nbsp;<span class="keyword" id="6459423">range</span>&nbsp;<span class="ident" id="6459429">tinfo</span><span class="op" id="6459434">.</span><span class="ident" id="6459435">fields</span>&nbsp;<span class="op" id="6459442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6459446">oldf</span>&nbsp;<span class="op" id="6459451">:=</span>&nbsp;<span class="op" id="6459454">&amp;</span><span class="ident" id="6459455">tinfo</span><span class="op" id="6459460">.</span><span class="ident" id="6459461">fields</span><span class="op" id="6459467">[</span><span class="ident" id="6459468">i</span><span class="op" id="6459469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459473">if</span>&nbsp;<span class="ident" id="6459476">oldf</span><span class="op" id="6459480">.</span><span class="ident" id="6459481">flags</span><span class="op" id="6459486">&amp;</span><span class="ident" id="6459487">fMode</span>&nbsp;<span class="op" id="6459493">!=</span>&nbsp;<span class="ident" id="6459496">newf</span><span class="op" id="6459500">.</span><span class="ident" id="6459501">flags</span><span class="op" id="6459506">&amp;</span><span class="ident" id="6459507">fMode</span>&nbsp;<span class="op" id="6459513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459518">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459533">if</span>&nbsp;<span class="ident" id="6459536">oldf</span><span class="op" id="6459540">.</span><span class="ident" id="6459541">xmlns</span>&nbsp;<span class="op" id="6459547">!=</span>&nbsp;<span class="string" id="6459550">&#34;&#34;</span>&nbsp;<span class="op" id="6459553">&amp;&amp;</span>&nbsp;<span class="ident" id="6459556">newf</span><span class="op" id="6459560">.</span><span class="ident" id="6459561">xmlns</span>&nbsp;<span class="op" id="6459567">!=</span>&nbsp;<span class="string" id="6459570">&#34;&#34;</span>&nbsp;<span class="op" id="6459573">&amp;&amp;</span>&nbsp;<span class="ident" id="6459576">oldf</span><span class="op" id="6459580">.</span><span class="ident" id="6459581">xmlns</span>&nbsp;<span class="op" id="6459587">!=</span>&nbsp;<span class="ident" id="6459590">newf</span><span class="op" id="6459594">.</span><span class="ident" id="6459595">xmlns</span>&nbsp;<span class="op" id="6459601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459606">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6459621">minl</span>&nbsp;<span class="op" id="6459626">:=</span>&nbsp;<span class="ident" id="6459629">min</span><span class="op" id="6459632">(</span><span class="builtinfunc" id="6459633">len</span><span class="op" id="6459636">(</span><span class="ident" id="6459637">newf</span><span class="op" id="6459641">.</span><span class="ident" id="6459642">parents</span><span class="op" id="6459649">)</span><span class="op" id="6459650">,</span>&nbsp;<span class="builtinfunc" id="6459652">len</span><span class="op" id="6459655">(</span><span class="ident" id="6459656">oldf</span><span class="op" id="6459660">.</span><span class="ident" id="6459661">parents</span><span class="op" id="6459668">)</span><span class="op" id="6459669">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459673">for</span>&nbsp;<span class="ident" id="6459677">p</span>&nbsp;<span class="op" id="6459679">:=</span>&nbsp;<span class="num" id="6459682">0</span><span class="op" id="6459683">;</span>&nbsp;<span class="ident" id="6459685">p</span>&nbsp;<span class="op" id="6459687">&lt;</span>&nbsp;<span class="ident" id="6459689">minl</span><span class="op" id="6459693">;</span>&nbsp;<span class="ident" id="6459695">p</span><span class="op" id="6459696">++</span>&nbsp;<span class="op" id="6459699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459704">if</span>&nbsp;<span class="ident" id="6459707">oldf</span><span class="op" id="6459711">.</span><span class="ident" id="6459712">parents</span><span class="op" id="6459719">[</span><span class="ident" id="6459720">p</span><span class="op" id="6459721">]</span>&nbsp;<span class="op" id="6459723">!=</span>&nbsp;<span class="ident" id="6459726">newf</span><span class="op" id="6459730">.</span><span class="ident" id="6459731">parents</span><span class="op" id="6459738">[</span><span class="ident" id="6459739">p</span><span class="op" id="6459740">]</span>&nbsp;<span class="op" id="6459742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459748">continue</span>&nbsp;<span class="ident" id="6459757">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459769">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459773">if</span>&nbsp;<span class="builtinfunc" id="6459776">len</span><span class="op" id="6459779">(</span><span class="ident" id="6459780">oldf</span><span class="op" id="6459784">.</span><span class="ident" id="6459785">parents</span><span class="op" id="6459792">)</span>&nbsp;<span class="op" id="6459794">&gt;</span>&nbsp;<span class="builtinfunc" id="6459796">len</span><span class="op" id="6459799">(</span><span class="ident" id="6459800">newf</span><span class="op" id="6459804">.</span><span class="ident" id="6459805">parents</span><span class="op" id="6459812">)</span>&nbsp;<span class="op" id="6459814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459819">if</span>&nbsp;<span class="ident" id="6459822">oldf</span><span class="op" id="6459826">.</span><span class="ident" id="6459827">parents</span><span class="op" id="6459834">[</span><span class="builtinfunc" id="6459835">len</span><span class="op" id="6459838">(</span><span class="ident" id="6459839">newf</span><span class="op" id="6459843">.</span><span class="ident" id="6459844">parents</span><span class="op" id="6459851">)</span><span class="op" id="6459852">]</span>&nbsp;<span class="op" id="6459854">==</span>&nbsp;<span class="ident" id="6459857">newf</span><span class="op" id="6459861">.</span><span class="ident" id="6459862">name</span>&nbsp;<span class="op" id="6459867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6459873">conflicts</span>&nbsp;<span class="op" id="6459883">=</span>&nbsp;<span class="builtinfunc" id="6459885">append</span><span class="op" id="6459891">(</span><span class="ident" id="6459892">conflicts</span><span class="op" id="6459901">,</span>&nbsp;<span class="ident" id="6459903">i</span><span class="op" id="6459904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6459913">}</span>&nbsp;<span class="keyword" id="6459915">else</span>&nbsp;<span class="keyword" id="6459920">if</span>&nbsp;<span class="builtinfunc" id="6459923">len</span><span class="op" id="6459926">(</span><span class="ident" id="6459927">oldf</span><span class="op" id="6459931">.</span><span class="ident" id="6459932">parents</span><span class="op" id="6459939">)</span>&nbsp;<span class="op" id="6459941">&lt;</span>&nbsp;<span class="builtinfunc" id="6459943">len</span><span class="op" id="6459946">(</span><span class="ident" id="6459947">newf</span><span class="op" id="6459951">.</span><span class="ident" id="6459952">parents</span><span class="op" id="6459959">)</span>&nbsp;<span class="op" id="6459961">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6459966">if</span>&nbsp;<span class="ident" id="6459969">newf</span><span class="op" id="6459973">.</span><span class="ident" id="6459974">parents</span><span class="op" id="6459981">[</span><span class="builtinfunc" id="6459982">len</span><span class="op" id="6459985">(</span><span class="ident" id="6459986">oldf</span><span class="op" id="6459990">.</span><span class="ident" id="6459991">parents</span><span class="op" id="6459998">)</span><span class="op" id="6459999">]</span>&nbsp;<span class="op" id="6460001">==</span>&nbsp;<span class="ident" id="6460004">oldf</span><span class="op" id="6460008">.</span><span class="ident" id="6460009">name</span>&nbsp;<span class="op" id="6460014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460020">conflicts</span>&nbsp;<span class="op" id="6460030">=</span>&nbsp;<span class="builtinfunc" id="6460032">append</span><span class="op" id="6460038">(</span><span class="ident" id="6460039">conflicts</span><span class="op" id="6460048">,</span>&nbsp;<span class="ident" id="6460050">i</span><span class="op" id="6460051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460060">}</span>&nbsp;<span class="keyword" id="6460062">else</span>&nbsp;<span class="op" id="6460067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460072">if</span>&nbsp;<span class="ident" id="6460075">newf</span><span class="op" id="6460079">.</span><span class="ident" id="6460080">name</span>&nbsp;<span class="op" id="6460085">==</span>&nbsp;<span class="ident" id="6460088">oldf</span><span class="op" id="6460092">.</span><span class="ident" id="6460093">name</span>&nbsp;<span class="op" id="6460098">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460104">conflicts</span>&nbsp;<span class="op" id="6460114">=</span>&nbsp;<span class="builtinfunc" id="6460116">append</span><span class="op" id="6460122">(</span><span class="ident" id="6460123">conflicts</span><span class="op" id="6460132">,</span>&nbsp;<span class="ident" id="6460134">i</span><span class="op" id="6460135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460150">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460203">if</span>&nbsp;<span class="ident" id="6460206">conflicts</span>&nbsp;<span class="op" id="6460216">==</span>&nbsp;<span class="ident" id="6460219">nil</span>&nbsp;<span class="op" id="6460223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460227">tinfo</span><span class="op" id="6460232">.</span><span class="ident" id="6460233">fields</span>&nbsp;<span class="op" id="6460240">=</span>&nbsp;<span class="builtinfunc" id="6460242">append</span><span class="op" id="6460248">(</span><span class="ident" id="6460249">tinfo</span><span class="op" id="6460254">.</span><span class="ident" id="6460255">fields</span><span class="op" id="6460261">,</span>&nbsp;<span class="op" id="6460263">*</span><span class="ident" id="6460264">newf</span><span class="op" id="6460268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460272">return</span>&nbsp;<span class="ident" id="6460279">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460288">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460344">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460399">for</span>&nbsp;<span class="ident" id="6460403">_</span><span class="op" id="6460404">,</span>&nbsp;<span class="ident" id="6460406">i</span>&nbsp;<span class="op" id="6460408">:=</span>&nbsp;<span class="keyword" id="6460411">range</span>&nbsp;<span class="ident" id="6460417">conflicts</span>&nbsp;<span class="op" id="6460427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460431">if</span>&nbsp;<span class="builtinfunc" id="6460434">len</span><span class="op" id="6460437">(</span><span class="ident" id="6460438">tinfo</span><span class="op" id="6460443">.</span><span class="ident" id="6460444">fields</span><span class="op" id="6460450">[</span><span class="ident" id="6460451">i</span><span class="op" id="6460452">]</span><span class="op" id="6460453">.</span><span class="ident" id="6460454">idx</span><span class="op" id="6460457">)</span>&nbsp;<span class="op" id="6460459">&lt;</span>&nbsp;<span class="builtinfunc" id="6460461">len</span><span class="op" id="6460464">(</span><span class="ident" id="6460465">newf</span><span class="op" id="6460469">.</span><span class="ident" id="6460470">idx</span><span class="op" id="6460473">)</span>&nbsp;<span class="op" id="6460475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460480">return</span>&nbsp;<span class="ident" id="6460487">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460500">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460573">for</span>&nbsp;<span class="ident" id="6460577">_</span><span class="op" id="6460578">,</span>&nbsp;<span class="ident" id="6460580">i</span>&nbsp;<span class="op" id="6460582">:=</span>&nbsp;<span class="keyword" id="6460585">range</span>&nbsp;<span class="ident" id="6460591">conflicts</span>&nbsp;<span class="op" id="6460601">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460605">oldf</span>&nbsp;<span class="op" id="6460610">:=</span>&nbsp;<span class="op" id="6460613">&amp;</span><span class="ident" id="6460614">tinfo</span><span class="op" id="6460619">.</span><span class="ident" id="6460620">fields</span><span class="op" id="6460626">[</span><span class="ident" id="6460627">i</span><span class="op" id="6460628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460632">if</span>&nbsp;<span class="builtinfunc" id="6460635">len</span><span class="op" id="6460638">(</span><span class="ident" id="6460639">oldf</span><span class="op" id="6460643">.</span><span class="ident" id="6460644">idx</span><span class="op" id="6460647">)</span>&nbsp;<span class="op" id="6460649">==</span>&nbsp;<span class="builtinfunc" id="6460652">len</span><span class="op" id="6460655">(</span><span class="ident" id="6460656">newf</span><span class="op" id="6460660">.</span><span class="ident" id="6460661">idx</span><span class="op" id="6460664">)</span>&nbsp;<span class="op" id="6460666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460671">f1</span>&nbsp;<span class="op" id="6460674">:=</span>&nbsp;<span class="ident" id="6460677">typ</span><span class="op" id="6460680">.</span><span class="ident" id="6460681">FieldByIndex</span><span class="op" id="6460693">(</span><span class="ident" id="6460694">oldf</span><span class="op" id="6460698">.</span><span class="ident" id="6460699">idx</span><span class="op" id="6460702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6460707">f2</span>&nbsp;<span class="op" id="6460710">:=</span>&nbsp;<span class="ident" id="6460713">typ</span><span class="op" id="6460716">.</span><span class="ident" id="6460717">FieldByIndex</span><span class="op" id="6460729">(</span><span class="ident" id="6460730">newf</span><span class="op" id="6460734">.</span><span class="ident" id="6460735">idx</span><span class="op" id="6460738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460743">return</span>&nbsp;<span class="op" id="6460750">&amp;</span><span class="ident" id="6460751">TagPathError</span><span class="op" id="6460763">{</span><span class="ident" id="6460764">typ</span><span class="op" id="6460767">,</span>&nbsp;<span class="ident" id="6460769">f1</span><span class="op" id="6460771">.</span><span class="ident" id="6460772">Name</span><span class="op" id="6460776">,</span>&nbsp;<span class="ident" id="6460778">f1</span><span class="op" id="6460780">.</span><span class="ident" id="6460781">Tag</span><span class="op" id="6460784">.</span><span class="ident" id="6460785">Get</span><span class="op" id="6460788">(</span><span class="string" id="6460789">&#34;xml&#34;</span><span class="op" id="6460794">)</span><span class="op" id="6460795">,</span>&nbsp;<span class="ident" id="6460797">f2</span><span class="op" id="6460799">.</span><span class="ident" id="6460800">Name</span><span class="op" id="6460804">,</span>&nbsp;<span class="ident" id="6460806">f2</span><span class="op" id="6460808">.</span><span class="ident" id="6460809">Tag</span><span class="op" id="6460812">.</span><span class="ident" id="6460813">Get</span><span class="op" id="6460816">(</span><span class="string" id="6460817">&#34;xml&#34;</span><span class="op" id="6460822">)</span><span class="op" id="6460823">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6460830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460834">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6460904">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6460974">for</span>&nbsp;<span class="ident" id="6460978">c</span>&nbsp;<span class="op" id="6460980">:=</span>&nbsp;<span class="builtinfunc" id="6460983">len</span><span class="op" id="6460986">(</span><span class="ident" id="6460987">conflicts</span><span class="op" id="6460996">)</span>&nbsp;<span class="op" id="6460998">-</span>&nbsp;<span class="num" id="6461000">1</span><span class="op" id="6461001">;</span>&nbsp;<span class="ident" id="6461003">c</span>&nbsp;<span class="op" id="6461005">&gt;=</span>&nbsp;<span class="num" id="6461008">0</span><span class="op" id="6461009">;</span>&nbsp;<span class="ident" id="6461011">c</span><span class="op" id="6461012">--</span>&nbsp;<span class="op" id="6461015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461019">i</span>&nbsp;<span class="op" id="6461021">:=</span>&nbsp;<span class="ident" id="6461024">conflicts</span><span class="op" id="6461033">[</span><span class="ident" id="6461034">c</span><span class="op" id="6461035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6461039">copy</span><span class="op" id="6461043">(</span><span class="ident" id="6461044">tinfo</span><span class="op" id="6461049">.</span><span class="ident" id="6461050">fields</span><span class="op" id="6461056">[</span><span class="ident" id="6461057">i</span><span class="op" id="6461058">:</span><span class="op" id="6461059">]</span><span class="op" id="6461060">,</span>&nbsp;<span class="ident" id="6461062">tinfo</span><span class="op" id="6461067">.</span><span class="ident" id="6461068">fields</span><span class="op" id="6461074">[</span><span class="ident" id="6461075">i</span><span class="op" id="6461076">+</span><span class="num" id="6461077">1</span><span class="op" id="6461078">:</span><span class="op" id="6461079">]</span><span class="op" id="6461080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461084">tinfo</span><span class="op" id="6461089">.</span><span class="ident" id="6461090">fields</span>&nbsp;<span class="op" id="6461097">=</span>&nbsp;<span class="ident" id="6461099">tinfo</span><span class="op" id="6461104">.</span><span class="ident" id="6461105">fields</span><span class="op" id="6461111">[</span><span class="op" id="6461112">:</span><span class="builtinfunc" id="6461113">len</span><span class="op" id="6461116">(</span><span class="ident" id="6461117">tinfo</span><span class="op" id="6461122">.</span><span class="ident" id="6461123">fields</span><span class="op" id="6461129">)</span><span class="op" id="6461130">-</span><span class="num" id="6461131">1</span><span class="op" id="6461132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6461135">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461138">tinfo</span><span class="op" id="6461143">.</span><span class="ident" id="6461144">fields</span>&nbsp;<span class="op" id="6461151">=</span>&nbsp;<span class="builtinfunc" id="6461153">append</span><span class="op" id="6461159">(</span><span class="ident" id="6461160">tinfo</span><span class="op" id="6461165">.</span><span class="ident" id="6461166">fields</span><span class="op" id="6461172">,</span>&nbsp;<span class="op" id="6461174">*</span><span class="ident" id="6461175">newf</span><span class="op" id="6461179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461182">return</span>&nbsp;<span class="ident" id="6461189">nil</span><br>
<span class="lineno"></span><span class="op" id="6461193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6461196">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6461263">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6461322">type</span>&nbsp;<span class="ident" id="6461327">TagPathError</span>&nbsp;<span class="keyword" id="6461340">struct</span>&nbsp;<span class="op" id="6461347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461350">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461363">reflect</span><span class="op" id="6461370">.</span><span class="ident" id="6461371">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461377">Field1</span><span class="op" id="6461383">,</span>&nbsp;<span class="ident" id="6461385">Tag1</span>&nbsp;<span class="builtintype" id="6461390">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461398">Field2</span><span class="op" id="6461404">,</span>&nbsp;<span class="ident" id="6461406">Tag2</span>&nbsp;<span class="builtintype" id="6461411">string</span><br>
<span class="lineno">340</span><span class="op" id="6461418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6461421">func</span>&nbsp;<span class="op" id="6461426">(</span><span class="ident" id="6461427">e</span>&nbsp;<span class="op" id="6461429">*</span><span class="ident" id="6461430">TagPathError</span><span class="op" id="6461442">)</span>&nbsp;<span class="ident" id="6461444">Error</span><span class="op" id="6461449">(</span><span class="op" id="6461450">)</span>&nbsp;<span class="builtintype" id="6461452">string</span>&nbsp;<span class="op" id="6461459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461462">return</span>&nbsp;<span class="ident" id="6461469">fmt</span><span class="op" id="6461472">.</span><span class="ident" id="6461473">Sprintf</span><span class="op" id="6461480">(</span><span class="string" id="6461481">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6461542">,</span>&nbsp;<span class="ident" id="6461544">e</span><span class="op" id="6461545">.</span><span class="ident" id="6461546">Struct</span><span class="op" id="6461552">,</span>&nbsp;<span class="ident" id="6461554">e</span><span class="op" id="6461555">.</span><span class="ident" id="6461556">Field1</span><span class="op" id="6461562">,</span>&nbsp;<span class="ident" id="6461564">e</span><span class="op" id="6461565">.</span><span class="ident" id="6461566">Tag1</span><span class="op" id="6461570">,</span>&nbsp;<span class="ident" id="6461572">e</span><span class="op" id="6461573">.</span><span class="ident" id="6461574">Field2</span><span class="op" id="6461580">,</span>&nbsp;<span class="ident" id="6461582">e</span><span class="op" id="6461583">.</span><span class="ident" id="6461584">Tag2</span><span class="op" id="6461588">)</span><br>
<span class="lineno"></span><span class="op" id="6461590">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6461593">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6461650">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6461715">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6461758">func</span>&nbsp;<span class="op" id="6461763">(</span><span class="ident" id="6461764">finfo</span>&nbsp;<span class="op" id="6461770">*</span><span class="ident" id="6461771">fieldInfo</span><span class="op" id="6461780">)</span>&nbsp;<span class="ident" id="6461782">value</span><span class="op" id="6461787">(</span><span class="ident" id="6461788">v</span>&nbsp;<span class="ident" id="6461790">reflect</span><span class="op" id="6461797">.</span><span class="ident" id="6461798">Value</span><span class="op" id="6461803">)</span>&nbsp;<span class="ident" id="6461805">reflect</span><span class="op" id="6461812">.</span><span class="ident" id="6461813">Value</span>&nbsp;<span class="op" id="6461819">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461822">for</span>&nbsp;<span class="ident" id="6461826">i</span><span class="op" id="6461827">,</span>&nbsp;<span class="ident" id="6461829">x</span>&nbsp;<span class="op" id="6461831">:=</span>&nbsp;<span class="keyword" id="6461834">range</span>&nbsp;<span class="ident" id="6461840">finfo</span><span class="op" id="6461845">.</span><span class="ident" id="6461846">idx</span>&nbsp;<span class="op" id="6461850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461854">if</span>&nbsp;<span class="ident" id="6461857">i</span>&nbsp;<span class="op" id="6461859">&gt;</span>&nbsp;<span class="num" id="6461861">0</span>&nbsp;<span class="op" id="6461863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461868">t</span>&nbsp;<span class="op" id="6461870">:=</span>&nbsp;<span class="ident" id="6461873">v</span><span class="op" id="6461874">.</span><span class="ident" id="6461875">Type</span><span class="op" id="6461879">(</span><span class="op" id="6461880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461885">if</span>&nbsp;<span class="ident" id="6461888">t</span><span class="op" id="6461889">.</span><span class="ident" id="6461890">Kind</span><span class="op" id="6461894">(</span><span class="op" id="6461895">)</span>&nbsp;<span class="op" id="6461897">==</span>&nbsp;<span class="ident" id="6461900">reflect</span><span class="op" id="6461907">.</span><span class="ident" id="6461908">Ptr</span>&nbsp;<span class="op" id="6461912">&amp;&amp;</span>&nbsp;<span class="ident" id="6461915">t</span><span class="op" id="6461916">.</span><span class="ident" id="6461917">Elem</span><span class="op" id="6461921">(</span><span class="op" id="6461922">)</span><span class="op" id="6461923">.</span><span class="ident" id="6461924">Kind</span><span class="op" id="6461928">(</span><span class="op" id="6461929">)</span>&nbsp;<span class="op" id="6461931">==</span>&nbsp;<span class="ident" id="6461934">reflect</span><span class="op" id="6461941">.</span><span class="ident" id="6461942">Struct</span>&nbsp;<span class="op" id="6461949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6461955">if</span>&nbsp;<span class="ident" id="6461958">v</span><span class="op" id="6461959">.</span><span class="ident" id="6461960">IsNil</span><span class="op" id="6461965">(</span><span class="op" id="6461966">)</span>&nbsp;<span class="op" id="6461968">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6461975">v</span><span class="op" id="6461976">.</span><span class="ident" id="6461977">Set</span><span class="op" id="6461980">(</span><span class="ident" id="6461981">reflect</span><span class="op" id="6461988">.</span><span class="ident" id="6461989">New</span><span class="op" id="6461992">(</span><span class="ident" id="6461993">v</span><span class="op" id="6461994">.</span><span class="ident" id="6461995">Type</span><span class="op" id="6461999">(</span><span class="op" id="6462000">)</span><span class="op" id="6462001">.</span><span class="ident" id="6462002">Elem</span><span class="op" id="6462006">(</span><span class="op" id="6462007">)</span><span class="op" id="6462008">)</span><span class="op" id="6462009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462021">v</span>&nbsp;<span class="op" id="6462023">=</span>&nbsp;<span class="ident" id="6462025">v</span><span class="op" id="6462026">.</span><span class="ident" id="6462027">Elem</span><span class="op" id="6462031">(</span><span class="op" id="6462032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462041">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6462045">v</span>&nbsp;<span class="op" id="6462047">=</span>&nbsp;<span class="ident" id="6462049">v</span><span class="op" id="6462050">.</span><span class="ident" id="6462051">Field</span><span class="op" id="6462056">(</span><span class="ident" id="6462057">x</span><span class="op" id="6462058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6462061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6462064">return</span>&nbsp;<span class="ident" id="6462071">v</span><br>
<span class="lineno"></span><span class="op" id="6462073">}</span>
</div>
</body>
</html>
