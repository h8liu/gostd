<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3135485">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3135540">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3135594">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3135645">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3135700">package</span>&nbsp;<span class="ident" id="3135708">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3135713">import</span>&nbsp;<span class="op" id="3135720">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135723">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135735">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135745">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135751">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3135759">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3135769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3135772">var</span>&nbsp;<span class="op" id="3135776">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135779">errBadUint</span>&nbsp;<span class="op" id="3135790">=</span>&nbsp;<span class="ident" id="3135792">errors</span><span class="op" id="3135798">.</span><span class="ident" id="3135799">New</span><span class="op" id="3135802">(</span><span class="string" id="3135803">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="3135847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135850">errBadType</span>&nbsp;<span class="op" id="3135861">=</span>&nbsp;<span class="ident" id="3135863">errors</span><span class="op" id="3135869">.</span><span class="ident" id="3135870">New</span><span class="op" id="3135873">(</span><span class="string" id="3135874">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="3135914">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135917">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3135928">=</span>&nbsp;<span class="ident" id="3135930">errors</span><span class="op" id="3135936">.</span><span class="ident" id="3135937">New</span><span class="op" id="3135940">(</span><span class="string" id="3135941">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="3135985">)</span><br>
<span class="lineno"></span><span class="op" id="3135987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3135990">type</span>&nbsp;<span class="ident" id="3135995">decHelper</span>&nbsp;<span class="keyword" id="3136005">func</span><span class="op" id="3136009">(</span><span class="ident" id="3136010">state</span>&nbsp;<span class="op" id="3136016">*</span><span class="ident" id="3136017">decoderState</span><span class="op" id="3136029">,</span>&nbsp;<span class="ident" id="3136031">v</span>&nbsp;<span class="ident" id="3136033">reflect</span><span class="op" id="3136040">.</span><span class="ident" id="3136041">Value</span><span class="op" id="3136046">,</span>&nbsp;<span class="ident" id="3136048">length</span>&nbsp;<span class="builtintype" id="3136055">int</span><span class="op" id="3136058">,</span>&nbsp;<span class="ident" id="3136060">ovfl</span>&nbsp;<span class="builtintype" id="3136065">error</span><span class="op" id="3136070">)</span>&nbsp;<span class="builtintype" id="3136072">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3136078">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="3136160">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="3136194">type</span>&nbsp;<span class="ident" id="3136199">decoderState</span>&nbsp;<span class="keyword" id="3136212">struct</span>&nbsp;<span class="op" id="3136219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136222">dec</span>&nbsp;<span class="op" id="3136226">*</span><span class="ident" id="3136227">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136236">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136314">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136385">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3136394">*</span><span class="ident" id="3136395">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136406">fieldnum</span>&nbsp;<span class="builtintype" id="3136415">int</span>&nbsp;<span class="comment" id="3136419">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136451">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3136460">[</span><span class="op" id="3136461">]</span><span class="builtintype" id="3136462">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136468">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3136477">*</span><span class="ident" id="3136478">decoderState</span>&nbsp;<span class="comment" id="3136491">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="3136508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3136511">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3136596">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="3136695">type</span>&nbsp;<span class="ident" id="3136700">decBuffer</span>&nbsp;<span class="keyword" id="3136710">struct</span>&nbsp;<span class="op" id="3136717">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136720">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3136727">[</span><span class="op" id="3136728">]</span><span class="builtintype" id="3136729">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136735">offset</span>&nbsp;<span class="builtintype" id="3136742">int</span>&nbsp;<span class="comment" id="3136746">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="3136762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136765">func</span>&nbsp;<span class="op" id="3136770">(</span><span class="ident" id="3136771">d</span>&nbsp;<span class="op" id="3136773">*</span><span class="ident" id="3136774">decBuffer</span><span class="op" id="3136783">)</span>&nbsp;<span class="ident" id="3136785">Read</span><span class="op" id="3136789">(</span><span class="ident" id="3136790">p</span>&nbsp;<span class="op" id="3136792">[</span><span class="op" id="3136793">]</span><span class="builtintype" id="3136794">byte</span><span class="op" id="3136798">)</span>&nbsp;<span class="op" id="3136800">(</span><span class="builtintype" id="3136801">int</span><span class="op" id="3136804">,</span>&nbsp;<span class="builtintype" id="3136806">error</span><span class="op" id="3136811">)</span>&nbsp;<span class="op" id="3136813">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136816">n</span>&nbsp;<span class="op" id="3136818">:=</span>&nbsp;<span class="builtinfunc" id="3136821">copy</span><span class="op" id="3136825">(</span><span class="ident" id="3136826">p</span><span class="op" id="3136827">,</span>&nbsp;<span class="ident" id="3136829">d</span><span class="op" id="3136830">.</span><span class="ident" id="3136831">data</span><span class="op" id="3136835">[</span><span class="ident" id="3136836">d</span><span class="op" id="3136837">.</span><span class="ident" id="3136838">offset</span><span class="op" id="3136844">:</span><span class="op" id="3136845">]</span><span class="op" id="3136846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136849">if</span>&nbsp;<span class="ident" id="3136852">n</span>&nbsp;<span class="op" id="3136854">==</span>&nbsp;<span class="num" id="3136857">0</span>&nbsp;<span class="op" id="3136859">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3136862">len</span><span class="op" id="3136865">(</span><span class="ident" id="3136866">p</span><span class="op" id="3136867">)</span>&nbsp;<span class="op" id="3136869">!=</span>&nbsp;<span class="num" id="3136872">0</span>&nbsp;<span class="op" id="3136874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136878">return</span>&nbsp;<span class="num" id="3136885">0</span><span class="op" id="3136886">,</span>&nbsp;<span class="ident" id="3136888">io</span><span class="op" id="3136890">.</span><span class="ident" id="3136891">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136899">d</span><span class="op" id="3136900">.</span><span class="ident" id="3136901">offset</span>&nbsp;<span class="op" id="3136908">+=</span>&nbsp;<span class="ident" id="3136911">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136914">return</span>&nbsp;<span class="ident" id="3136921">n</span><span class="op" id="3136922">,</span>&nbsp;<span class="ident" id="3136924">nil</span><br>
<span class="lineno"></span><span class="op" id="3136928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3136931">func</span>&nbsp;<span class="op" id="3136936">(</span><span class="ident" id="3136937">d</span>&nbsp;<span class="op" id="3136939">*</span><span class="ident" id="3136940">decBuffer</span><span class="op" id="3136949">)</span>&nbsp;<span class="ident" id="3136951">Drop</span><span class="op" id="3136955">(</span><span class="ident" id="3136956">n</span>&nbsp;<span class="builtintype" id="3136958">int</span><span class="op" id="3136961">)</span>&nbsp;<span class="op" id="3136963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136966">if</span>&nbsp;<span class="ident" id="3136969">n</span>&nbsp;<span class="op" id="3136971">&gt;</span>&nbsp;<span class="ident" id="3136973">d</span><span class="op" id="3136974">.</span><span class="ident" id="3136975">Len</span><span class="op" id="3136978">(</span><span class="op" id="3136979">)</span>&nbsp;<span class="op" id="3136981">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3136985">panic</span><span class="op" id="3136990">(</span><span class="string" id="3136991">&#34;drop&#34;</span><span class="op" id="3136997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137003">d</span><span class="op" id="3137004">.</span><span class="ident" id="3137005">offset</span>&nbsp;<span class="op" id="3137012">+=</span>&nbsp;<span class="ident" id="3137015">n</span><br>
<span class="lineno"></span><span class="op" id="3137017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3137020">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3137083">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3137148">func</span>&nbsp;<span class="op" id="3137153">(</span><span class="ident" id="3137154">d</span>&nbsp;<span class="op" id="3137156">*</span><span class="ident" id="3137157">decBuffer</span><span class="op" id="3137166">)</span>&nbsp;<span class="ident" id="3137168">Size</span><span class="op" id="3137172">(</span><span class="ident" id="3137173">n</span>&nbsp;<span class="builtintype" id="3137175">int</span><span class="op" id="3137178">)</span>&nbsp;<span class="op" id="3137180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137183">d</span><span class="op" id="3137184">.</span><span class="ident" id="3137185">Reset</span><span class="op" id="3137190">(</span><span class="op" id="3137191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137194">if</span>&nbsp;<span class="builtinfunc" id="3137197">cap</span><span class="op" id="3137200">(</span><span class="ident" id="3137201">d</span><span class="op" id="3137202">.</span><span class="ident" id="3137203">data</span><span class="op" id="3137207">)</span>&nbsp;<span class="op" id="3137209">&lt;</span>&nbsp;<span class="ident" id="3137211">n</span>&nbsp;<span class="op" id="3137213">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137217">d</span><span class="op" id="3137218">.</span><span class="ident" id="3137219">data</span>&nbsp;<span class="op" id="3137224">=</span>&nbsp;<span class="builtinfunc" id="3137226">make</span><span class="op" id="3137230">(</span><span class="op" id="3137231">[</span><span class="op" id="3137232">]</span><span class="builtintype" id="3137233">byte</span><span class="op" id="3137237">,</span>&nbsp;<span class="ident" id="3137239">n</span><span class="op" id="3137240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137243">}</span>&nbsp;<span class="keyword" id="3137245">else</span>&nbsp;<span class="op" id="3137250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137254">d</span><span class="op" id="3137255">.</span><span class="ident" id="3137256">data</span>&nbsp;<span class="op" id="3137261">=</span>&nbsp;<span class="ident" id="3137263">d</span><span class="op" id="3137264">.</span><span class="ident" id="3137265">data</span><span class="op" id="3137269">[</span><span class="num" id="3137270">0</span><span class="op" id="3137271">:</span><span class="ident" id="3137272">n</span><span class="op" id="3137273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137276">}</span><br>
<span class="lineno"></span><span class="op" id="3137278">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3137281">func</span>&nbsp;<span class="op" id="3137286">(</span><span class="ident" id="3137287">d</span>&nbsp;<span class="op" id="3137289">*</span><span class="ident" id="3137290">decBuffer</span><span class="op" id="3137299">)</span>&nbsp;<span class="ident" id="3137301">ReadByte</span><span class="op" id="3137309">(</span><span class="op" id="3137310">)</span>&nbsp;<span class="op" id="3137312">(</span><span class="builtintype" id="3137313">byte</span><span class="op" id="3137317">,</span>&nbsp;<span class="builtintype" id="3137319">error</span><span class="op" id="3137324">)</span>&nbsp;<span class="op" id="3137326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137329">if</span>&nbsp;<span class="ident" id="3137332">d</span><span class="op" id="3137333">.</span><span class="ident" id="3137334">offset</span>&nbsp;<span class="op" id="3137341">&gt;=</span>&nbsp;<span class="builtinfunc" id="3137344">len</span><span class="op" id="3137347">(</span><span class="ident" id="3137348">d</span><span class="op" id="3137349">.</span><span class="ident" id="3137350">data</span><span class="op" id="3137354">)</span>&nbsp;<span class="op" id="3137356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137360">return</span>&nbsp;<span class="num" id="3137367">0</span><span class="op" id="3137368">,</span>&nbsp;<span class="ident" id="3137370">io</span><span class="op" id="3137372">.</span><span class="ident" id="3137373">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137378">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137381">c</span>&nbsp;<span class="op" id="3137383">:=</span>&nbsp;<span class="ident" id="3137386">d</span><span class="op" id="3137387">.</span><span class="ident" id="3137388">data</span><span class="op" id="3137392">[</span><span class="ident" id="3137393">d</span><span class="op" id="3137394">.</span><span class="ident" id="3137395">offset</span><span class="op" id="3137401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137404">d</span><span class="op" id="3137405">.</span><span class="ident" id="3137406">offset</span><span class="op" id="3137412">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137416">return</span>&nbsp;<span class="ident" id="3137423">c</span><span class="op" id="3137424">,</span>&nbsp;<span class="ident" id="3137426">nil</span><br>
<span class="lineno"></span><span class="op" id="3137430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3137433">func</span>&nbsp;<span class="op" id="3137438">(</span><span class="ident" id="3137439">d</span>&nbsp;<span class="op" id="3137441">*</span><span class="ident" id="3137442">decBuffer</span><span class="op" id="3137451">)</span>&nbsp;<span class="ident" id="3137453">Len</span><span class="op" id="3137456">(</span><span class="op" id="3137457">)</span>&nbsp;<span class="builtintype" id="3137459">int</span>&nbsp;<span class="op" id="3137463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137466">return</span>&nbsp;<span class="builtinfunc" id="3137473">len</span><span class="op" id="3137476">(</span><span class="ident" id="3137477">d</span><span class="op" id="3137478">.</span><span class="ident" id="3137479">data</span><span class="op" id="3137483">)</span>&nbsp;<span class="op" id="3137485">-</span>&nbsp;<span class="ident" id="3137487">d</span><span class="op" id="3137488">.</span><span class="ident" id="3137489">offset</span><br>
<span class="lineno"></span><span class="op" id="3137496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3137499">func</span>&nbsp;<span class="op" id="3137504">(</span><span class="ident" id="3137505">d</span>&nbsp;<span class="op" id="3137507">*</span><span class="ident" id="3137508">decBuffer</span><span class="op" id="3137517">)</span>&nbsp;<span class="ident" id="3137519">Bytes</span><span class="op" id="3137524">(</span><span class="op" id="3137525">)</span>&nbsp;<span class="op" id="3137527">[</span><span class="op" id="3137528">]</span><span class="builtintype" id="3137529">byte</span>&nbsp;<span class="op" id="3137534">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137537">return</span>&nbsp;<span class="ident" id="3137544">d</span><span class="op" id="3137545">.</span><span class="ident" id="3137546">data</span><span class="op" id="3137550">[</span><span class="ident" id="3137551">d</span><span class="op" id="3137552">.</span><span class="ident" id="3137553">offset</span><span class="op" id="3137559">:</span><span class="op" id="3137560">]</span><br>
<span class="lineno"></span><span class="op" id="3137562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3137565">func</span>&nbsp;<span class="op" id="3137570">(</span><span class="ident" id="3137571">d</span>&nbsp;<span class="op" id="3137573">*</span><span class="ident" id="3137574">decBuffer</span><span class="op" id="3137583">)</span>&nbsp;<span class="ident" id="3137585">Reset</span><span class="op" id="3137590">(</span><span class="op" id="3137591">)</span>&nbsp;<span class="op" id="3137593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137596">d</span><span class="op" id="3137597">.</span><span class="ident" id="3137598">data</span>&nbsp;<span class="op" id="3137603">=</span>&nbsp;<span class="ident" id="3137605">d</span><span class="op" id="3137606">.</span><span class="ident" id="3137607">data</span><span class="op" id="3137611">[</span><span class="num" id="3137612">0</span><span class="op" id="3137613">:</span><span class="num" id="3137614">0</span><span class="op" id="3137615">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137618">d</span><span class="op" id="3137619">.</span><span class="ident" id="3137620">offset</span>&nbsp;<span class="op" id="3137627">=</span>&nbsp;<span class="num" id="3137629">0</span><br>
<span class="lineno"></span><span class="op" id="3137631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3137634">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="3137714">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="3137751">func</span>&nbsp;<span class="op" id="3137756">(</span><span class="ident" id="3137757">dec</span>&nbsp;<span class="op" id="3137761">*</span><span class="ident" id="3137762">Decoder</span><span class="op" id="3137769">)</span>&nbsp;<span class="ident" id="3137771">newDecoderState</span><span class="op" id="3137786">(</span><span class="ident" id="3137787">buf</span>&nbsp;<span class="op" id="3137791">*</span><span class="ident" id="3137792">decBuffer</span><span class="op" id="3137801">)</span>&nbsp;<span class="op" id="3137803">*</span><span class="ident" id="3137804">decoderState</span>&nbsp;<span class="op" id="3137817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137820">d</span>&nbsp;<span class="op" id="3137822">:=</span>&nbsp;<span class="ident" id="3137825">dec</span><span class="op" id="3137828">.</span><span class="ident" id="3137829">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137839">if</span>&nbsp;<span class="ident" id="3137842">d</span>&nbsp;<span class="op" id="3137844">==</span>&nbsp;<span class="ident" id="3137847">nil</span>&nbsp;<span class="op" id="3137851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137855">d</span>&nbsp;<span class="op" id="3137857">=</span>&nbsp;<span class="builtinfunc" id="3137859">new</span><span class="op" id="3137862">(</span><span class="ident" id="3137863">decoderState</span><span class="op" id="3137875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137879">d</span><span class="op" id="3137880">.</span><span class="ident" id="3137881">dec</span>&nbsp;<span class="op" id="3137885">=</span>&nbsp;<span class="ident" id="3137887">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137893">d</span><span class="op" id="3137894">.</span><span class="ident" id="3137895">buf</span>&nbsp;<span class="op" id="3137899">=</span>&nbsp;<span class="builtinfunc" id="3137901">make</span><span class="op" id="3137905">(</span><span class="op" id="3137906">[</span><span class="op" id="3137907">]</span><span class="builtintype" id="3137908">byte</span><span class="op" id="3137912">,</span>&nbsp;<span class="ident" id="3137914">uint64Size</span><span class="op" id="3137924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137927">}</span>&nbsp;<span class="keyword" id="3137929">else</span>&nbsp;<span class="op" id="3137934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137938">dec</span><span class="op" id="3137941">.</span><span class="ident" id="3137942">freeList</span>&nbsp;<span class="op" id="3137951">=</span>&nbsp;<span class="ident" id="3137953">d</span><span class="op" id="3137954">.</span><span class="ident" id="3137955">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137964">d</span><span class="op" id="3137965">.</span><span class="ident" id="3137966">b</span>&nbsp;<span class="op" id="3137968">=</span>&nbsp;<span class="ident" id="3137970">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137975">return</span>&nbsp;<span class="ident" id="3137982">d</span><br>
<span class="lineno"></span><span class="op" id="3137984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3137987">func</span>&nbsp;<span class="op" id="3137992">(</span><span class="ident" id="3137993">dec</span>&nbsp;<span class="op" id="3137997">*</span><span class="ident" id="3137998">Decoder</span><span class="op" id="3138005">)</span>&nbsp;<span class="ident" id="3138007">freeDecoderState</span><span class="op" id="3138023">(</span><span class="ident" id="3138024">d</span>&nbsp;<span class="op" id="3138026">*</span><span class="ident" id="3138027">decoderState</span><span class="op" id="3138039">)</span>&nbsp;<span class="op" id="3138041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138044">d</span><span class="op" id="3138045">.</span><span class="ident" id="3138046">next</span>&nbsp;<span class="op" id="3138051">=</span>&nbsp;<span class="ident" id="3138053">dec</span><span class="op" id="3138056">.</span><span class="ident" id="3138057">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138067">dec</span><span class="op" id="3138070">.</span><span class="ident" id="3138071">freeList</span>&nbsp;<span class="op" id="3138080">=</span>&nbsp;<span class="ident" id="3138082">d</span><br>
<span class="lineno"></span><span class="op" id="3138084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3138087">func</span>&nbsp;<span class="ident" id="3138092">overflow</span><span class="op" id="3138100">(</span><span class="ident" id="3138101">name</span>&nbsp;<span class="builtintype" id="3138106">string</span><span class="op" id="3138112">)</span>&nbsp;<span class="builtintype" id="3138114">error</span>&nbsp;<span class="op" id="3138120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138123">return</span>&nbsp;<span class="ident" id="3138130">errors</span><span class="op" id="3138136">.</span><span class="ident" id="3138137">New</span><span class="op" id="3138140">(</span><span class="string" id="3138141">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3138155">+</span>&nbsp;<span class="ident" id="3138157">name</span>&nbsp;<span class="op" id="3138162">+</span>&nbsp;<span class="string" id="3138164">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3138180">)</span><br>
<span class="lineno">115</span><span class="op" id="3138182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3138185">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="3138258">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3138314">func</span>&nbsp;<span class="ident" id="3138319">decodeUintReader</span><span class="op" id="3138335">(</span><span class="ident" id="3138336">r</span>&nbsp;<span class="ident" id="3138338">io</span><span class="op" id="3138340">.</span><span class="ident" id="3138341">Reader</span><span class="op" id="3138347">,</span>&nbsp;<span class="ident" id="3138349">buf</span>&nbsp;<span class="op" id="3138353">[</span><span class="op" id="3138354">]</span><span class="builtintype" id="3138355">byte</span><span class="op" id="3138359">)</span>&nbsp;<span class="op" id="3138361">(</span><span class="ident" id="3138362">x</span>&nbsp;<span class="ident" id="3138364">uint64</span><span class="op" id="3138370">,</span>&nbsp;<span class="ident" id="3138372">width</span>&nbsp;<span class="builtintype" id="3138378">int</span><span class="op" id="3138381">,</span>&nbsp;<span class="ident" id="3138383">err</span>&nbsp;<span class="builtintype" id="3138387">error</span><span class="op" id="3138392">)</span>&nbsp;<span class="op" id="3138394">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138397">width</span>&nbsp;<span class="op" id="3138403">=</span>&nbsp;<span class="num" id="3138405">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138408">n</span><span class="op" id="3138409">,</span>&nbsp;<span class="ident" id="3138411">err</span>&nbsp;<span class="op" id="3138415">:=</span>&nbsp;<span class="ident" id="3138418">io</span><span class="op" id="3138420">.</span><span class="ident" id="3138421">ReadFull</span><span class="op" id="3138429">(</span><span class="ident" id="3138430">r</span><span class="op" id="3138431">,</span>&nbsp;<span class="ident" id="3138433">buf</span><span class="op" id="3138436">[</span><span class="num" id="3138437">0</span><span class="op" id="3138438">:</span><span class="ident" id="3138439">width</span><span class="op" id="3138444">]</span><span class="op" id="3138445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138448">if</span>&nbsp;<span class="ident" id="3138451">n</span>&nbsp;<span class="op" id="3138453">==</span>&nbsp;<span class="num" id="3138456">0</span>&nbsp;<span class="op" id="3138458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138462">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138470">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138473">b</span>&nbsp;<span class="op" id="3138475">:=</span>&nbsp;<span class="ident" id="3138478">buf</span><span class="op" id="3138481">[</span><span class="num" id="3138482">0</span><span class="op" id="3138483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138486">if</span>&nbsp;<span class="ident" id="3138489">b</span>&nbsp;<span class="op" id="3138491">&lt;=</span>&nbsp;<span class="num" id="3138494">0x7f</span>&nbsp;<span class="op" id="3138499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138503">return</span>&nbsp;<span class="ident" id="3138510">uint64</span><span class="op" id="3138516">(</span><span class="ident" id="3138517">b</span><span class="op" id="3138518">)</span><span class="op" id="3138519">,</span>&nbsp;<span class="ident" id="3138521">width</span><span class="op" id="3138526">,</span>&nbsp;<span class="ident" id="3138528">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138536">n</span>&nbsp;<span class="op" id="3138538">=</span>&nbsp;<span class="op" id="3138540">-</span><span class="builtintype" id="3138541">int</span><span class="op" id="3138544">(</span><span class="builtintype" id="3138545">int8</span><span class="op" id="3138549">(</span><span class="ident" id="3138550">b</span><span class="op" id="3138551">)</span><span class="op" id="3138552">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138555">if</span>&nbsp;<span class="ident" id="3138558">n</span>&nbsp;<span class="op" id="3138560">&gt;</span>&nbsp;<span class="ident" id="3138562">uint64Size</span>&nbsp;<span class="op" id="3138573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138577">err</span>&nbsp;<span class="op" id="3138581">=</span>&nbsp;<span class="ident" id="3138583">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138607">width</span><span class="op" id="3138612">,</span>&nbsp;<span class="ident" id="3138614">err</span>&nbsp;<span class="op" id="3138618">=</span>&nbsp;<span class="ident" id="3138620">io</span><span class="op" id="3138622">.</span><span class="ident" id="3138623">ReadFull</span><span class="op" id="3138631">(</span><span class="ident" id="3138632">r</span><span class="op" id="3138633">,</span>&nbsp;<span class="ident" id="3138635">buf</span><span class="op" id="3138638">[</span><span class="num" id="3138639">0</span><span class="op" id="3138640">:</span><span class="ident" id="3138641">n</span><span class="op" id="3138642">]</span><span class="op" id="3138643">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138646">if</span>&nbsp;<span class="ident" id="3138649">err</span>&nbsp;<span class="op" id="3138653">!=</span>&nbsp;<span class="ident" id="3138656">nil</span>&nbsp;<span class="op" id="3138660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138664">if</span>&nbsp;<span class="ident" id="3138667">err</span>&nbsp;<span class="op" id="3138671">==</span>&nbsp;<span class="ident" id="3138674">io</span><span class="op" id="3138676">.</span><span class="ident" id="3138677">EOF</span>&nbsp;<span class="op" id="3138681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138686">err</span>&nbsp;<span class="op" id="3138690">=</span>&nbsp;<span class="ident" id="3138692">io</span><span class="op" id="3138694">.</span><span class="ident" id="3138695">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138718">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138729">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138795">for</span>&nbsp;<span class="ident" id="3138799">_</span><span class="op" id="3138800">,</span>&nbsp;<span class="ident" id="3138802">b</span>&nbsp;<span class="op" id="3138804">:=</span>&nbsp;<span class="keyword" id="3138807">range</span>&nbsp;<span class="ident" id="3138813">buf</span><span class="op" id="3138816">[</span><span class="num" id="3138817">0</span><span class="op" id="3138818">:</span><span class="ident" id="3138819">width</span><span class="op" id="3138824">]</span>&nbsp;<span class="op" id="3138826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138830">x</span>&nbsp;<span class="op" id="3138832">=</span>&nbsp;<span class="ident" id="3138834">x</span><span class="op" id="3138835">&lt;&lt;</span><span class="num" id="3138837">8</span>&nbsp;<span class="op" id="3138839">|</span>&nbsp;<span class="ident" id="3138841">uint64</span><span class="op" id="3138847">(</span><span class="ident" id="3138848">b</span><span class="op" id="3138849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138852">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138855">width</span><span class="op" id="3138860">++</span>&nbsp;<span class="comment" id="3138863">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138886">return</span><br>
<span class="lineno"></span><span class="op" id="3138893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3138896">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="3138958">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3138990">func</span>&nbsp;<span class="op" id="3138995">(</span><span class="ident" id="3138996">state</span>&nbsp;<span class="op" id="3139002">*</span><span class="ident" id="3139003">decoderState</span><span class="op" id="3139015">)</span>&nbsp;<span class="ident" id="3139017">decodeUint</span><span class="op" id="3139027">(</span><span class="op" id="3139028">)</span>&nbsp;<span class="op" id="3139030">(</span><span class="ident" id="3139031">x</span>&nbsp;<span class="ident" id="3139033">uint64</span><span class="op" id="3139039">)</span>&nbsp;<span class="op" id="3139041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139044">b</span><span class="op" id="3139045">,</span>&nbsp;<span class="ident" id="3139047">err</span>&nbsp;<span class="op" id="3139051">:=</span>&nbsp;<span class="ident" id="3139054">state</span><span class="op" id="3139059">.</span><span class="ident" id="3139060">b</span><span class="op" id="3139061">.</span><span class="ident" id="3139062">ReadByte</span><span class="op" id="3139070">(</span><span class="op" id="3139071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139074">if</span>&nbsp;<span class="ident" id="3139077">err</span>&nbsp;<span class="op" id="3139081">!=</span>&nbsp;<span class="ident" id="3139084">nil</span>&nbsp;<span class="op" id="3139088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139092">error_</span><span class="op" id="3139098">(</span><span class="ident" id="3139099">err</span><span class="op" id="3139102">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139108">if</span>&nbsp;<span class="ident" id="3139111">b</span>&nbsp;<span class="op" id="3139113">&lt;=</span>&nbsp;<span class="num" id="3139116">0x7f</span>&nbsp;<span class="op" id="3139121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139125">return</span>&nbsp;<span class="ident" id="3139132">uint64</span><span class="op" id="3139138">(</span><span class="ident" id="3139139">b</span><span class="op" id="3139140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139146">n</span>&nbsp;<span class="op" id="3139148">:=</span>&nbsp;<span class="op" id="3139151">-</span><span class="builtintype" id="3139152">int</span><span class="op" id="3139155">(</span><span class="builtintype" id="3139156">int8</span><span class="op" id="3139160">(</span><span class="ident" id="3139161">b</span><span class="op" id="3139162">)</span><span class="op" id="3139163">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139166">if</span>&nbsp;<span class="ident" id="3139169">n</span>&nbsp;<span class="op" id="3139171">&gt;</span>&nbsp;<span class="ident" id="3139173">uint64Size</span>&nbsp;<span class="op" id="3139184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139188">error_</span><span class="op" id="3139194">(</span><span class="ident" id="3139195">errBadUint</span><span class="op" id="3139205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139211">width</span><span class="op" id="3139216">,</span>&nbsp;<span class="ident" id="3139218">err</span>&nbsp;<span class="op" id="3139222">:=</span>&nbsp;<span class="ident" id="3139225">state</span><span class="op" id="3139230">.</span><span class="ident" id="3139231">b</span><span class="op" id="3139232">.</span><span class="ident" id="3139233">Read</span><span class="op" id="3139237">(</span><span class="ident" id="3139238">state</span><span class="op" id="3139243">.</span><span class="ident" id="3139244">buf</span><span class="op" id="3139247">[</span><span class="num" id="3139248">0</span><span class="op" id="3139249">:</span><span class="ident" id="3139250">n</span><span class="op" id="3139251">]</span><span class="op" id="3139252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139255">if</span>&nbsp;<span class="ident" id="3139258">err</span>&nbsp;<span class="op" id="3139262">!=</span>&nbsp;<span class="ident" id="3139265">nil</span>&nbsp;<span class="op" id="3139269">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139273">error_</span><span class="op" id="3139279">(</span><span class="ident" id="3139280">err</span><span class="op" id="3139283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139289">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139350">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139416">for</span>&nbsp;<span class="ident" id="3139420">_</span><span class="op" id="3139421">,</span>&nbsp;<span class="ident" id="3139423">b</span>&nbsp;<span class="op" id="3139425">:=</span>&nbsp;<span class="keyword" id="3139428">range</span>&nbsp;<span class="ident" id="3139434">state</span><span class="op" id="3139439">.</span><span class="ident" id="3139440">buf</span><span class="op" id="3139443">[</span><span class="num" id="3139444">0</span><span class="op" id="3139445">:</span><span class="ident" id="3139446">width</span><span class="op" id="3139451">]</span>&nbsp;<span class="op" id="3139453">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139457">x</span>&nbsp;<span class="op" id="3139459">=</span>&nbsp;<span class="ident" id="3139461">x</span><span class="op" id="3139462">&lt;&lt;</span><span class="num" id="3139464">8</span>&nbsp;<span class="op" id="3139466">|</span>&nbsp;<span class="ident" id="3139468">uint64</span><span class="op" id="3139474">(</span><span class="ident" id="3139475">b</span><span class="op" id="3139476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139482">return</span>&nbsp;<span class="ident" id="3139489">x</span><br>
<span class="lineno"></span><span class="op" id="3139491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3139494">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="3139553">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3139585">func</span>&nbsp;<span class="op" id="3139590">(</span><span class="ident" id="3139591">state</span>&nbsp;<span class="op" id="3139597">*</span><span class="ident" id="3139598">decoderState</span><span class="op" id="3139610">)</span>&nbsp;<span class="ident" id="3139612">decodeInt</span><span class="op" id="3139621">(</span><span class="op" id="3139622">)</span>&nbsp;<span class="ident" id="3139624">int64</span>&nbsp;<span class="op" id="3139630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139633">x</span>&nbsp;<span class="op" id="3139635">:=</span>&nbsp;<span class="ident" id="3139638">state</span><span class="op" id="3139643">.</span><span class="ident" id="3139644">decodeUint</span><span class="op" id="3139654">(</span><span class="op" id="3139655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139658">if</span>&nbsp;<span class="ident" id="3139661">x</span><span class="op" id="3139662">&amp;</span><span class="num" id="3139663">1</span>&nbsp;<span class="op" id="3139665">!=</span>&nbsp;<span class="num" id="3139668">0</span>&nbsp;<span class="op" id="3139670">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139674">return</span>&nbsp;<span class="op" id="3139681">^</span><span class="ident" id="3139682">int64</span><span class="op" id="3139687">(</span><span class="ident" id="3139688">x</span>&nbsp;<span class="op" id="3139690">&gt;&gt;</span>&nbsp;<span class="num" id="3139693">1</span><span class="op" id="3139694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139700">return</span>&nbsp;<span class="ident" id="3139707">int64</span><span class="op" id="3139712">(</span><span class="ident" id="3139713">x</span>&nbsp;<span class="op" id="3139715">&gt;&gt;</span>&nbsp;<span class="num" id="3139718">1</span><span class="op" id="3139719">)</span><br>
<span class="lineno"></span><span class="op" id="3139721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3139724">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3139791">type</span>&nbsp;<span class="ident" id="3139796">decOp</span>&nbsp;<span class="keyword" id="3139802">func</span><span class="op" id="3139806">(</span><span class="ident" id="3139807">i</span>&nbsp;<span class="op" id="3139809">*</span><span class="ident" id="3139810">decInstr</span><span class="op" id="3139818">,</span>&nbsp;<span class="ident" id="3139820">state</span>&nbsp;<span class="op" id="3139826">*</span><span class="ident" id="3139827">decoderState</span><span class="op" id="3139839">,</span>&nbsp;<span class="ident" id="3139841">v</span>&nbsp;<span class="ident" id="3139843">reflect</span><span class="op" id="3139850">.</span><span class="ident" id="3139851">Value</span><span class="op" id="3139856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3139859">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="3139905">type</span>&nbsp;<span class="ident" id="3139910">decInstr</span>&nbsp;<span class="keyword" id="3139919">struct</span>&nbsp;<span class="op" id="3139926">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139929">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3139935">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139942">field</span>&nbsp;<span class="builtintype" id="3139948">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3139954">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139988">index</span>&nbsp;<span class="op" id="3139994">[</span><span class="op" id="3139995">]</span><span class="builtintype" id="3139996">int</span>&nbsp;<span class="comment" id="3140000">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140046">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="3140052">error</span>&nbsp;<span class="comment" id="3140058">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="3140128">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3140131">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3140188">func</span>&nbsp;<span class="ident" id="3140193">ignoreUint</span><span class="op" id="3140203">(</span><span class="ident" id="3140204">i</span>&nbsp;<span class="op" id="3140206">*</span><span class="ident" id="3140207">decInstr</span><span class="op" id="3140215">,</span>&nbsp;<span class="ident" id="3140217">state</span>&nbsp;<span class="op" id="3140223">*</span><span class="ident" id="3140224">decoderState</span><span class="op" id="3140236">,</span>&nbsp;<span class="ident" id="3140238">v</span>&nbsp;<span class="ident" id="3140240">reflect</span><span class="op" id="3140247">.</span><span class="ident" id="3140248">Value</span><span class="op" id="3140253">)</span>&nbsp;<span class="op" id="3140255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140258">state</span><span class="op" id="3140263">.</span><span class="ident" id="3140264">decodeUint</span><span class="op" id="3140274">(</span><span class="op" id="3140275">)</span><br>
<span class="lineno"></span><span class="op" id="3140277">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3140280">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="3140359">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3140378">func</span>&nbsp;<span class="ident" id="3140383">ignoreTwoUints</span><span class="op" id="3140397">(</span><span class="ident" id="3140398">i</span>&nbsp;<span class="op" id="3140400">*</span><span class="ident" id="3140401">decInstr</span><span class="op" id="3140409">,</span>&nbsp;<span class="ident" id="3140411">state</span>&nbsp;<span class="op" id="3140417">*</span><span class="ident" id="3140418">decoderState</span><span class="op" id="3140430">,</span>&nbsp;<span class="ident" id="3140432">v</span>&nbsp;<span class="ident" id="3140434">reflect</span><span class="op" id="3140441">.</span><span class="ident" id="3140442">Value</span><span class="op" id="3140447">)</span>&nbsp;<span class="op" id="3140449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140452">state</span><span class="op" id="3140457">.</span><span class="ident" id="3140458">decodeUint</span><span class="op" id="3140468">(</span><span class="op" id="3140469">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140472">state</span><span class="op" id="3140477">.</span><span class="ident" id="3140478">decodeUint</span><span class="op" id="3140488">(</span><span class="op" id="3140489">)</span><br>
<span class="lineno"></span><span class="op" id="3140491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3140494">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3140566">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="3140639">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="3140683">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3140755">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3140834">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3140847">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3140911">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="3140999">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="3141077">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3141122">func</span>&nbsp;<span class="ident" id="3141127">decAlloc</span><span class="op" id="3141135">(</span><span class="ident" id="3141136">v</span>&nbsp;<span class="ident" id="3141138">reflect</span><span class="op" id="3141145">.</span><span class="ident" id="3141146">Value</span><span class="op" id="3141151">)</span>&nbsp;<span class="ident" id="3141153">reflect</span><span class="op" id="3141160">.</span><span class="ident" id="3141161">Value</span>&nbsp;<span class="op" id="3141167">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141170">for</span>&nbsp;<span class="ident" id="3141174">v</span><span class="op" id="3141175">.</span><span class="ident" id="3141176">Kind</span><span class="op" id="3141180">(</span><span class="op" id="3141181">)</span>&nbsp;<span class="op" id="3141183">==</span>&nbsp;<span class="ident" id="3141186">reflect</span><span class="op" id="3141193">.</span><span class="ident" id="3141194">Ptr</span>&nbsp;<span class="op" id="3141198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141202">if</span>&nbsp;<span class="ident" id="3141205">v</span><span class="op" id="3141206">.</span><span class="ident" id="3141207">IsNil</span><span class="op" id="3141212">(</span><span class="op" id="3141213">)</span>&nbsp;<span class="op" id="3141215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141220">v</span><span class="op" id="3141221">.</span><span class="ident" id="3141222">Set</span><span class="op" id="3141225">(</span><span class="ident" id="3141226">reflect</span><span class="op" id="3141233">.</span><span class="ident" id="3141234">New</span><span class="op" id="3141237">(</span><span class="ident" id="3141238">v</span><span class="op" id="3141239">.</span><span class="ident" id="3141240">Type</span><span class="op" id="3141244">(</span><span class="op" id="3141245">)</span><span class="op" id="3141246">.</span><span class="ident" id="3141247">Elem</span><span class="op" id="3141251">(</span><span class="op" id="3141252">)</span><span class="op" id="3141253">)</span><span class="op" id="3141254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141262">v</span>&nbsp;<span class="op" id="3141264">=</span>&nbsp;<span class="ident" id="3141266">v</span><span class="op" id="3141267">.</span><span class="ident" id="3141268">Elem</span><span class="op" id="3141272">(</span><span class="op" id="3141273">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141279">return</span>&nbsp;<span class="ident" id="3141286">v</span><br>
<span class="lineno"></span><span class="op" id="3141288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141291">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="3141354">func</span>&nbsp;<span class="ident" id="3141359">decBool</span><span class="op" id="3141366">(</span><span class="ident" id="3141367">i</span>&nbsp;<span class="op" id="3141369">*</span><span class="ident" id="3141370">decInstr</span><span class="op" id="3141378">,</span>&nbsp;<span class="ident" id="3141380">state</span>&nbsp;<span class="op" id="3141386">*</span><span class="ident" id="3141387">decoderState</span><span class="op" id="3141399">,</span>&nbsp;<span class="ident" id="3141401">value</span>&nbsp;<span class="ident" id="3141407">reflect</span><span class="op" id="3141414">.</span><span class="ident" id="3141415">Value</span><span class="op" id="3141420">)</span>&nbsp;<span class="op" id="3141422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141425">value</span><span class="op" id="3141430">.</span><span class="ident" id="3141431">SetBool</span><span class="op" id="3141438">(</span><span class="ident" id="3141439">state</span><span class="op" id="3141444">.</span><span class="ident" id="3141445">decodeUint</span><span class="op" id="3141455">(</span><span class="op" id="3141456">)</span>&nbsp;<span class="op" id="3141458">!=</span>&nbsp;<span class="num" id="3141461">0</span><span class="op" id="3141462">)</span><br>
<span class="lineno"></span><span class="op" id="3141464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141467">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="3141532">func</span>&nbsp;<span class="ident" id="3141537">decInt8</span><span class="op" id="3141544">(</span><span class="ident" id="3141545">i</span>&nbsp;<span class="op" id="3141547">*</span><span class="ident" id="3141548">decInstr</span><span class="op" id="3141556">,</span>&nbsp;<span class="ident" id="3141558">state</span>&nbsp;<span class="op" id="3141564">*</span><span class="ident" id="3141565">decoderState</span><span class="op" id="3141577">,</span>&nbsp;<span class="ident" id="3141579">value</span>&nbsp;<span class="ident" id="3141585">reflect</span><span class="op" id="3141592">.</span><span class="ident" id="3141593">Value</span><span class="op" id="3141598">)</span>&nbsp;<span class="op" id="3141600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141603">v</span>&nbsp;<span class="op" id="3141605">:=</span>&nbsp;<span class="ident" id="3141608">state</span><span class="op" id="3141613">.</span><span class="ident" id="3141614">decodeInt</span><span class="op" id="3141623">(</span><span class="op" id="3141624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141627">if</span>&nbsp;<span class="ident" id="3141630">v</span>&nbsp;<span class="op" id="3141632">&lt;</span>&nbsp;<span class="ident" id="3141634">math</span><span class="op" id="3141638">.</span><span class="ident" id="3141639">MinInt8</span>&nbsp;<span class="op" id="3141647">||</span>&nbsp;<span class="ident" id="3141650">math</span><span class="op" id="3141654">.</span><span class="ident" id="3141655">MaxInt8</span>&nbsp;<span class="op" id="3141663">&lt;</span>&nbsp;<span class="ident" id="3141665">v</span>&nbsp;<span class="op" id="3141667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141671">error_</span><span class="op" id="3141677">(</span><span class="ident" id="3141678">i</span><span class="op" id="3141679">.</span><span class="ident" id="3141680">ovfl</span><span class="op" id="3141684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141687">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141690">value</span><span class="op" id="3141695">.</span><span class="ident" id="3141696">SetInt</span><span class="op" id="3141702">(</span><span class="ident" id="3141703">v</span><span class="op" id="3141704">)</span><br>
<span class="lineno"></span><span class="op" id="3141706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141709">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3141784">func</span>&nbsp;<span class="ident" id="3141789">decUint8</span><span class="op" id="3141797">(</span><span class="ident" id="3141798">i</span>&nbsp;<span class="op" id="3141800">*</span><span class="ident" id="3141801">decInstr</span><span class="op" id="3141809">,</span>&nbsp;<span class="ident" id="3141811">state</span>&nbsp;<span class="op" id="3141817">*</span><span class="ident" id="3141818">decoderState</span><span class="op" id="3141830">,</span>&nbsp;<span class="ident" id="3141832">value</span>&nbsp;<span class="ident" id="3141838">reflect</span><span class="op" id="3141845">.</span><span class="ident" id="3141846">Value</span><span class="op" id="3141851">)</span>&nbsp;<span class="op" id="3141853">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141856">v</span>&nbsp;<span class="op" id="3141858">:=</span>&nbsp;<span class="ident" id="3141861">state</span><span class="op" id="3141866">.</span><span class="ident" id="3141867">decodeUint</span><span class="op" id="3141877">(</span><span class="op" id="3141878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141881">if</span>&nbsp;<span class="ident" id="3141884">math</span><span class="op" id="3141888">.</span><span class="ident" id="3141889">MaxUint8</span>&nbsp;<span class="op" id="3141898">&lt;</span>&nbsp;<span class="ident" id="3141900">v</span>&nbsp;<span class="op" id="3141902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141906">error_</span><span class="op" id="3141912">(</span><span class="ident" id="3141913">i</span><span class="op" id="3141914">.</span><span class="ident" id="3141915">ovfl</span><span class="op" id="3141919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141925">value</span><span class="op" id="3141930">.</span><span class="ident" id="3141931">SetUint</span><span class="op" id="3141938">(</span><span class="ident" id="3141939">v</span><span class="op" id="3141940">)</span><br>
<span class="lineno">250</span><span class="op" id="3141942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3141945">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3142012">func</span>&nbsp;<span class="ident" id="3142017">decInt16</span><span class="op" id="3142025">(</span><span class="ident" id="3142026">i</span>&nbsp;<span class="op" id="3142028">*</span><span class="ident" id="3142029">decInstr</span><span class="op" id="3142037">,</span>&nbsp;<span class="ident" id="3142039">state</span>&nbsp;<span class="op" id="3142045">*</span><span class="ident" id="3142046">decoderState</span><span class="op" id="3142058">,</span>&nbsp;<span class="ident" id="3142060">value</span>&nbsp;<span class="ident" id="3142066">reflect</span><span class="op" id="3142073">.</span><span class="ident" id="3142074">Value</span><span class="op" id="3142079">)</span>&nbsp;<span class="op" id="3142081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142084">v</span>&nbsp;<span class="op" id="3142086">:=</span>&nbsp;<span class="ident" id="3142089">state</span><span class="op" id="3142094">.</span><span class="ident" id="3142095">decodeInt</span><span class="op" id="3142104">(</span><span class="op" id="3142105">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142108">if</span>&nbsp;<span class="ident" id="3142111">v</span>&nbsp;<span class="op" id="3142113">&lt;</span>&nbsp;<span class="ident" id="3142115">math</span><span class="op" id="3142119">.</span><span class="ident" id="3142120">MinInt16</span>&nbsp;<span class="op" id="3142129">||</span>&nbsp;<span class="ident" id="3142132">math</span><span class="op" id="3142136">.</span><span class="ident" id="3142137">MaxInt16</span>&nbsp;<span class="op" id="3142146">&lt;</span>&nbsp;<span class="ident" id="3142148">v</span>&nbsp;<span class="op" id="3142150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142154">error_</span><span class="op" id="3142160">(</span><span class="ident" id="3142161">i</span><span class="op" id="3142162">.</span><span class="ident" id="3142163">ovfl</span><span class="op" id="3142167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142173">value</span><span class="op" id="3142178">.</span><span class="ident" id="3142179">SetInt</span><span class="op" id="3142185">(</span><span class="ident" id="3142186">v</span><span class="op" id="3142187">)</span><br>
<span class="lineno"></span><span class="op" id="3142189">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="3142192">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3142269">func</span>&nbsp;<span class="ident" id="3142274">decUint16</span><span class="op" id="3142283">(</span><span class="ident" id="3142284">i</span>&nbsp;<span class="op" id="3142286">*</span><span class="ident" id="3142287">decInstr</span><span class="op" id="3142295">,</span>&nbsp;<span class="ident" id="3142297">state</span>&nbsp;<span class="op" id="3142303">*</span><span class="ident" id="3142304">decoderState</span><span class="op" id="3142316">,</span>&nbsp;<span class="ident" id="3142318">value</span>&nbsp;<span class="ident" id="3142324">reflect</span><span class="op" id="3142331">.</span><span class="ident" id="3142332">Value</span><span class="op" id="3142337">)</span>&nbsp;<span class="op" id="3142339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142342">v</span>&nbsp;<span class="op" id="3142344">:=</span>&nbsp;<span class="ident" id="3142347">state</span><span class="op" id="3142352">.</span><span class="ident" id="3142353">decodeUint</span><span class="op" id="3142363">(</span><span class="op" id="3142364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142367">if</span>&nbsp;<span class="ident" id="3142370">math</span><span class="op" id="3142374">.</span><span class="ident" id="3142375">MaxUint16</span>&nbsp;<span class="op" id="3142385">&lt;</span>&nbsp;<span class="ident" id="3142387">v</span>&nbsp;<span class="op" id="3142389">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142393">error_</span><span class="op" id="3142399">(</span><span class="ident" id="3142400">i</span><span class="op" id="3142401">.</span><span class="ident" id="3142402">ovfl</span><span class="op" id="3142406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142412">value</span><span class="op" id="3142417">.</span><span class="ident" id="3142418">SetUint</span><span class="op" id="3142425">(</span><span class="ident" id="3142426">v</span><span class="op" id="3142427">)</span><br>
<span class="lineno"></span><span class="op" id="3142429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3142432">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3142499">func</span>&nbsp;<span class="ident" id="3142504">decInt32</span><span class="op" id="3142512">(</span><span class="ident" id="3142513">i</span>&nbsp;<span class="op" id="3142515">*</span><span class="ident" id="3142516">decInstr</span><span class="op" id="3142524">,</span>&nbsp;<span class="ident" id="3142526">state</span>&nbsp;<span class="op" id="3142532">*</span><span class="ident" id="3142533">decoderState</span><span class="op" id="3142545">,</span>&nbsp;<span class="ident" id="3142547">value</span>&nbsp;<span class="ident" id="3142553">reflect</span><span class="op" id="3142560">.</span><span class="ident" id="3142561">Value</span><span class="op" id="3142566">)</span>&nbsp;<span class="op" id="3142568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142571">v</span>&nbsp;<span class="op" id="3142573">:=</span>&nbsp;<span class="ident" id="3142576">state</span><span class="op" id="3142581">.</span><span class="ident" id="3142582">decodeInt</span><span class="op" id="3142591">(</span><span class="op" id="3142592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142595">if</span>&nbsp;<span class="ident" id="3142598">v</span>&nbsp;<span class="op" id="3142600">&lt;</span>&nbsp;<span class="ident" id="3142602">math</span><span class="op" id="3142606">.</span><span class="ident" id="3142607">MinInt32</span>&nbsp;<span class="op" id="3142616">||</span>&nbsp;<span class="ident" id="3142619">math</span><span class="op" id="3142623">.</span><span class="ident" id="3142624">MaxInt32</span>&nbsp;<span class="op" id="3142633">&lt;</span>&nbsp;<span class="ident" id="3142635">v</span>&nbsp;<span class="op" id="3142637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142641">error_</span><span class="op" id="3142647">(</span><span class="ident" id="3142648">i</span><span class="op" id="3142649">.</span><span class="ident" id="3142650">ovfl</span><span class="op" id="3142654">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142660">value</span><span class="op" id="3142665">.</span><span class="ident" id="3142666">SetInt</span><span class="op" id="3142672">(</span><span class="ident" id="3142673">v</span><span class="op" id="3142674">)</span><br>
<span class="lineno"></span><span class="op" id="3142676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3142679">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="3142756">func</span>&nbsp;<span class="ident" id="3142761">decUint32</span><span class="op" id="3142770">(</span><span class="ident" id="3142771">i</span>&nbsp;<span class="op" id="3142773">*</span><span class="ident" id="3142774">decInstr</span><span class="op" id="3142782">,</span>&nbsp;<span class="ident" id="3142784">state</span>&nbsp;<span class="op" id="3142790">*</span><span class="ident" id="3142791">decoderState</span><span class="op" id="3142803">,</span>&nbsp;<span class="ident" id="3142805">value</span>&nbsp;<span class="ident" id="3142811">reflect</span><span class="op" id="3142818">.</span><span class="ident" id="3142819">Value</span><span class="op" id="3142824">)</span>&nbsp;<span class="op" id="3142826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142829">v</span>&nbsp;<span class="op" id="3142831">:=</span>&nbsp;<span class="ident" id="3142834">state</span><span class="op" id="3142839">.</span><span class="ident" id="3142840">decodeUint</span><span class="op" id="3142850">(</span><span class="op" id="3142851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142854">if</span>&nbsp;<span class="ident" id="3142857">math</span><span class="op" id="3142861">.</span><span class="ident" id="3142862">MaxUint32</span>&nbsp;<span class="op" id="3142872">&lt;</span>&nbsp;<span class="ident" id="3142874">v</span>&nbsp;<span class="op" id="3142876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142880">error_</span><span class="op" id="3142886">(</span><span class="ident" id="3142887">i</span><span class="op" id="3142888">.</span><span class="ident" id="3142889">ovfl</span><span class="op" id="3142893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142896">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142899">value</span><span class="op" id="3142904">.</span><span class="ident" id="3142905">SetUint</span><span class="op" id="3142912">(</span><span class="ident" id="3142913">v</span><span class="op" id="3142914">)</span><br>
<span class="lineno"></span><span class="op" id="3142916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3142919">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3142986">func</span>&nbsp;<span class="ident" id="3142991">decInt64</span><span class="op" id="3142999">(</span><span class="ident" id="3143000">i</span>&nbsp;<span class="op" id="3143002">*</span><span class="ident" id="3143003">decInstr</span><span class="op" id="3143011">,</span>&nbsp;<span class="ident" id="3143013">state</span>&nbsp;<span class="op" id="3143019">*</span><span class="ident" id="3143020">decoderState</span><span class="op" id="3143032">,</span>&nbsp;<span class="ident" id="3143034">value</span>&nbsp;<span class="ident" id="3143040">reflect</span><span class="op" id="3143047">.</span><span class="ident" id="3143048">Value</span><span class="op" id="3143053">)</span>&nbsp;<span class="op" id="3143055">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143058">v</span>&nbsp;<span class="op" id="3143060">:=</span>&nbsp;<span class="ident" id="3143063">state</span><span class="op" id="3143068">.</span><span class="ident" id="3143069">decodeInt</span><span class="op" id="3143078">(</span><span class="op" id="3143079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143082">value</span><span class="op" id="3143087">.</span><span class="ident" id="3143088">SetInt</span><span class="op" id="3143094">(</span><span class="ident" id="3143095">v</span><span class="op" id="3143096">)</span><br>
<span class="lineno"></span><span class="op" id="3143098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3143101">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="3143178">func</span>&nbsp;<span class="ident" id="3143183">decUint64</span><span class="op" id="3143192">(</span><span class="ident" id="3143193">i</span>&nbsp;<span class="op" id="3143195">*</span><span class="ident" id="3143196">decInstr</span><span class="op" id="3143204">,</span>&nbsp;<span class="ident" id="3143206">state</span>&nbsp;<span class="op" id="3143212">*</span><span class="ident" id="3143213">decoderState</span><span class="op" id="3143225">,</span>&nbsp;<span class="ident" id="3143227">value</span>&nbsp;<span class="ident" id="3143233">reflect</span><span class="op" id="3143240">.</span><span class="ident" id="3143241">Value</span><span class="op" id="3143246">)</span>&nbsp;<span class="op" id="3143248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143251">v</span>&nbsp;<span class="op" id="3143253">:=</span>&nbsp;<span class="ident" id="3143256">state</span><span class="op" id="3143261">.</span><span class="ident" id="3143262">decodeUint</span><span class="op" id="3143272">(</span><span class="op" id="3143273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143276">value</span><span class="op" id="3143281">.</span><span class="ident" id="3143282">SetUint</span><span class="op" id="3143289">(</span><span class="ident" id="3143290">v</span><span class="op" id="3143291">)</span><br>
<span class="lineno"></span><span class="op" id="3143293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3143296">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3143366">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3143438">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="3143510">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3143575">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="3143591">func</span>&nbsp;<span class="ident" id="3143596">float64FromBits</span><span class="op" id="3143611">(</span><span class="ident" id="3143612">u</span>&nbsp;<span class="ident" id="3143614">uint64</span><span class="op" id="3143620">)</span>&nbsp;<span class="builtintype" id="3143622">float64</span>&nbsp;<span class="op" id="3143630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143633">var</span>&nbsp;<span class="ident" id="3143637">v</span>&nbsp;<span class="ident" id="3143639">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143647">for</span>&nbsp;<span class="ident" id="3143651">i</span>&nbsp;<span class="op" id="3143653">:=</span>&nbsp;<span class="num" id="3143656">0</span><span class="op" id="3143657">;</span>&nbsp;<span class="ident" id="3143659">i</span>&nbsp;<span class="op" id="3143661">&lt;</span>&nbsp;<span class="num" id="3143663">8</span><span class="op" id="3143664">;</span>&nbsp;<span class="ident" id="3143666">i</span><span class="op" id="3143667">++</span>&nbsp;<span class="op" id="3143670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143674">v</span>&nbsp;<span class="op" id="3143676">&lt;&lt;=</span>&nbsp;<span class="num" id="3143680">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143684">v</span>&nbsp;<span class="op" id="3143686">|=</span>&nbsp;<span class="ident" id="3143689">u</span>&nbsp;<span class="op" id="3143691">&amp;</span>&nbsp;<span class="num" id="3143693">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143700">u</span>&nbsp;<span class="op" id="3143702">&gt;&gt;=</span>&nbsp;<span class="num" id="3143706">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143712">return</span>&nbsp;<span class="ident" id="3143719">math</span><span class="op" id="3143723">.</span><span class="ident" id="3143724">Float64frombits</span><span class="op" id="3143739">(</span><span class="ident" id="3143740">v</span><span class="op" id="3143741">)</span><br>
<span class="lineno"></span><span class="op" id="3143743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3143746">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3143831">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="3143908">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3143985">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="3144048">func</span>&nbsp;<span class="ident" id="3144053">float32FromBits</span><span class="op" id="3144068">(</span><span class="ident" id="3144069">u</span>&nbsp;<span class="ident" id="3144071">uint64</span><span class="op" id="3144077">,</span>&nbsp;<span class="ident" id="3144079">ovfl</span>&nbsp;<span class="builtintype" id="3144084">error</span><span class="op" id="3144089">)</span>&nbsp;<span class="builtintype" id="3144091">float64</span>&nbsp;<span class="op" id="3144099">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144102">v</span>&nbsp;<span class="op" id="3144104">:=</span>&nbsp;<span class="ident" id="3144107">float64FromBits</span><span class="op" id="3144122">(</span><span class="ident" id="3144123">u</span><span class="op" id="3144124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144127">av</span>&nbsp;<span class="op" id="3144130">:=</span>&nbsp;<span class="ident" id="3144133">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144136">if</span>&nbsp;<span class="ident" id="3144139">av</span>&nbsp;<span class="op" id="3144142">&lt;</span>&nbsp;<span class="num" id="3144144">0</span>&nbsp;<span class="op" id="3144146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144150">av</span>&nbsp;<span class="op" id="3144153">=</span>&nbsp;<span class="op" id="3144155">-</span><span class="ident" id="3144156">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144160">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144163">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144234">if</span>&nbsp;<span class="ident" id="3144237">math</span><span class="op" id="3144241">.</span><span class="ident" id="3144242">MaxFloat32</span>&nbsp;<span class="op" id="3144253">&lt;</span>&nbsp;<span class="ident" id="3144255">av</span>&nbsp;<span class="op" id="3144258">&amp;&amp;</span>&nbsp;<span class="ident" id="3144261">av</span>&nbsp;<span class="op" id="3144264">&lt;=</span>&nbsp;<span class="ident" id="3144267">math</span><span class="op" id="3144271">.</span><span class="ident" id="3144272">MaxFloat64</span>&nbsp;<span class="op" id="3144283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144287">error_</span><span class="op" id="3144293">(</span><span class="ident" id="3144294">ovfl</span><span class="op" id="3144298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144304">return</span>&nbsp;<span class="ident" id="3144311">v</span><br>
<span class="lineno">330</span><span class="op" id="3144313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3144316">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3144396">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3144431">func</span>&nbsp;<span class="ident" id="3144436">decFloat32</span><span class="op" id="3144446">(</span><span class="ident" id="3144447">i</span>&nbsp;<span class="op" id="3144449">*</span><span class="ident" id="3144450">decInstr</span><span class="op" id="3144458">,</span>&nbsp;<span class="ident" id="3144460">state</span>&nbsp;<span class="op" id="3144466">*</span><span class="ident" id="3144467">decoderState</span><span class="op" id="3144479">,</span>&nbsp;<span class="ident" id="3144481">value</span>&nbsp;<span class="ident" id="3144487">reflect</span><span class="op" id="3144494">.</span><span class="ident" id="3144495">Value</span><span class="op" id="3144500">)</span>&nbsp;<span class="op" id="3144502">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144505">value</span><span class="op" id="3144510">.</span><span class="ident" id="3144511">SetFloat</span><span class="op" id="3144519">(</span><span class="ident" id="3144520">float32FromBits</span><span class="op" id="3144535">(</span><span class="ident" id="3144536">state</span><span class="op" id="3144541">.</span><span class="ident" id="3144542">decodeUint</span><span class="op" id="3144552">(</span><span class="op" id="3144553">)</span><span class="op" id="3144554">,</span>&nbsp;<span class="ident" id="3144556">i</span><span class="op" id="3144557">.</span><span class="ident" id="3144558">ovfl</span><span class="op" id="3144562">)</span><span class="op" id="3144563">)</span><br>
<span class="lineno"></span><span class="op" id="3144565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3144568">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3144648">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="3144683">func</span>&nbsp;<span class="ident" id="3144688">decFloat64</span><span class="op" id="3144698">(</span><span class="ident" id="3144699">i</span>&nbsp;<span class="op" id="3144701">*</span><span class="ident" id="3144702">decInstr</span><span class="op" id="3144710">,</span>&nbsp;<span class="ident" id="3144712">state</span>&nbsp;<span class="op" id="3144718">*</span><span class="ident" id="3144719">decoderState</span><span class="op" id="3144731">,</span>&nbsp;<span class="ident" id="3144733">value</span>&nbsp;<span class="ident" id="3144739">reflect</span><span class="op" id="3144746">.</span><span class="ident" id="3144747">Value</span><span class="op" id="3144752">)</span>&nbsp;<span class="op" id="3144754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144757">value</span><span class="op" id="3144762">.</span><span class="ident" id="3144763">SetFloat</span><span class="op" id="3144771">(</span><span class="ident" id="3144772">float64FromBits</span><span class="op" id="3144787">(</span><span class="ident" id="3144788">state</span><span class="op" id="3144793">.</span><span class="ident" id="3144794">decodeUint</span><span class="op" id="3144804">(</span><span class="op" id="3144805">)</span><span class="op" id="3144806">)</span><span class="op" id="3144807">)</span><br>
<span class="lineno"></span><span class="op" id="3144809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3144812">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="3144882">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3144958">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3144988">func</span>&nbsp;<span class="ident" id="3144993">decComplex64</span><span class="op" id="3145005">(</span><span class="ident" id="3145006">i</span>&nbsp;<span class="op" id="3145008">*</span><span class="ident" id="3145009">decInstr</span><span class="op" id="3145017">,</span>&nbsp;<span class="ident" id="3145019">state</span>&nbsp;<span class="op" id="3145025">*</span><span class="ident" id="3145026">decoderState</span><span class="op" id="3145038">,</span>&nbsp;<span class="ident" id="3145040">value</span>&nbsp;<span class="ident" id="3145046">reflect</span><span class="op" id="3145053">.</span><span class="ident" id="3145054">Value</span><span class="op" id="3145059">)</span>&nbsp;<span class="op" id="3145061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3145064">real</span>&nbsp;<span class="op" id="3145069">:=</span>&nbsp;<span class="ident" id="3145072">float32FromBits</span><span class="op" id="3145087">(</span><span class="ident" id="3145088">state</span><span class="op" id="3145093">.</span><span class="ident" id="3145094">decodeUint</span><span class="op" id="3145104">(</span><span class="op" id="3145105">)</span><span class="op" id="3145106">,</span>&nbsp;<span class="ident" id="3145108">i</span><span class="op" id="3145109">.</span><span class="ident" id="3145110">ovfl</span><span class="op" id="3145114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3145117">imag</span>&nbsp;<span class="op" id="3145122">:=</span>&nbsp;<span class="ident" id="3145125">float32FromBits</span><span class="op" id="3145140">(</span><span class="ident" id="3145141">state</span><span class="op" id="3145146">.</span><span class="ident" id="3145147">decodeUint</span><span class="op" id="3145157">(</span><span class="op" id="3145158">)</span><span class="op" id="3145159">,</span>&nbsp;<span class="ident" id="3145161">i</span><span class="op" id="3145162">.</span><span class="ident" id="3145163">ovfl</span><span class="op" id="3145167">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145170">value</span><span class="op" id="3145175">.</span><span class="ident" id="3145176">SetComplex</span><span class="op" id="3145186">(</span><span class="builtinfunc" id="3145187">complex</span><span class="op" id="3145194">(</span><span class="builtinfunc" id="3145195">real</span><span class="op" id="3145199">,</span>&nbsp;<span class="builtinfunc" id="3145201">imag</span><span class="op" id="3145205">)</span><span class="op" id="3145206">)</span><br>
<span class="lineno"></span><span class="op" id="3145208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3145211">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3145282">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="3145359">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3145389">func</span>&nbsp;<span class="ident" id="3145394">decComplex128</span><span class="op" id="3145407">(</span><span class="ident" id="3145408">i</span>&nbsp;<span class="op" id="3145410">*</span><span class="ident" id="3145411">decInstr</span><span class="op" id="3145419">,</span>&nbsp;<span class="ident" id="3145421">state</span>&nbsp;<span class="op" id="3145427">*</span><span class="ident" id="3145428">decoderState</span><span class="op" id="3145440">,</span>&nbsp;<span class="ident" id="3145442">value</span>&nbsp;<span class="ident" id="3145448">reflect</span><span class="op" id="3145455">.</span><span class="ident" id="3145456">Value</span><span class="op" id="3145461">)</span>&nbsp;<span class="op" id="3145463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3145466">real</span>&nbsp;<span class="op" id="3145471">:=</span>&nbsp;<span class="ident" id="3145474">float64FromBits</span><span class="op" id="3145489">(</span><span class="ident" id="3145490">state</span><span class="op" id="3145495">.</span><span class="ident" id="3145496">decodeUint</span><span class="op" id="3145506">(</span><span class="op" id="3145507">)</span><span class="op" id="3145508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3145511">imag</span>&nbsp;<span class="op" id="3145516">:=</span>&nbsp;<span class="ident" id="3145519">float64FromBits</span><span class="op" id="3145534">(</span><span class="ident" id="3145535">state</span><span class="op" id="3145540">.</span><span class="ident" id="3145541">decodeUint</span><span class="op" id="3145551">(</span><span class="op" id="3145552">)</span><span class="op" id="3145553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145556">value</span><span class="op" id="3145561">.</span><span class="ident" id="3145562">SetComplex</span><span class="op" id="3145572">(</span><span class="builtinfunc" id="3145573">complex</span><span class="op" id="3145580">(</span><span class="builtinfunc" id="3145581">real</span><span class="op" id="3145585">,</span>&nbsp;<span class="builtinfunc" id="3145587">imag</span><span class="op" id="3145591">)</span><span class="op" id="3145592">)</span><br>
<span class="lineno">360</span><span class="op" id="3145594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3145597">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3145670">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3145694">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="3145770">func</span>&nbsp;<span class="ident" id="3145775">decUint8Slice</span><span class="op" id="3145788">(</span><span class="ident" id="3145789">i</span>&nbsp;<span class="op" id="3145791">*</span><span class="ident" id="3145792">decInstr</span><span class="op" id="3145800">,</span>&nbsp;<span class="ident" id="3145802">state</span>&nbsp;<span class="op" id="3145808">*</span><span class="ident" id="3145809">decoderState</span><span class="op" id="3145821">,</span>&nbsp;<span class="ident" id="3145823">value</span>&nbsp;<span class="ident" id="3145829">reflect</span><span class="op" id="3145836">.</span><span class="ident" id="3145837">Value</span><span class="op" id="3145842">)</span>&nbsp;<span class="op" id="3145844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145847">u</span>&nbsp;<span class="op" id="3145849">:=</span>&nbsp;<span class="ident" id="3145852">state</span><span class="op" id="3145857">.</span><span class="ident" id="3145858">decodeUint</span><span class="op" id="3145868">(</span><span class="op" id="3145869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145872">n</span>&nbsp;<span class="op" id="3145874">:=</span>&nbsp;<span class="builtintype" id="3145877">int</span><span class="op" id="3145880">(</span><span class="ident" id="3145881">u</span><span class="op" id="3145882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145885">if</span>&nbsp;<span class="ident" id="3145888">n</span>&nbsp;<span class="op" id="3145890">&lt;</span>&nbsp;<span class="num" id="3145892">0</span>&nbsp;<span class="op" id="3145894">||</span>&nbsp;<span class="ident" id="3145897">uint64</span><span class="op" id="3145903">(</span><span class="ident" id="3145904">n</span><span class="op" id="3145905">)</span>&nbsp;<span class="op" id="3145907">!=</span>&nbsp;<span class="ident" id="3145910">u</span>&nbsp;<span class="op" id="3145912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145916">errorf</span><span class="op" id="3145922">(</span><span class="string" id="3145923">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3145967">,</span>&nbsp;<span class="ident" id="3145969">value</span><span class="op" id="3145974">.</span><span class="ident" id="3145975">Type</span><span class="op" id="3145979">(</span><span class="op" id="3145980">)</span><span class="op" id="3145981">,</span>&nbsp;<span class="ident" id="3145983">u</span><span class="op" id="3145984">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145990">if</span>&nbsp;<span class="ident" id="3145993">n</span>&nbsp;<span class="op" id="3145995">&gt;</span>&nbsp;<span class="ident" id="3145997">state</span><span class="op" id="3146002">.</span><span class="ident" id="3146003">b</span><span class="op" id="3146004">.</span><span class="ident" id="3146005">Len</span><span class="op" id="3146008">(</span><span class="op" id="3146009">)</span>&nbsp;<span class="op" id="3146011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146015">errorf</span><span class="op" id="3146021">(</span><span class="string" id="3146022">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3146055">,</span>&nbsp;<span class="ident" id="3146057">value</span><span class="op" id="3146062">.</span><span class="ident" id="3146063">Type</span><span class="op" id="3146067">(</span><span class="op" id="3146068">)</span><span class="op" id="3146069">,</span>&nbsp;<span class="ident" id="3146071">n</span><span class="op" id="3146072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146078">if</span>&nbsp;<span class="ident" id="3146081">n</span>&nbsp;<span class="op" id="3146083">&gt;</span>&nbsp;<span class="ident" id="3146085">tooBig</span>&nbsp;<span class="op" id="3146092">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146096">errorf</span><span class="op" id="3146102">(</span><span class="string" id="3146103">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="3146127">,</span>&nbsp;<span class="ident" id="3146129">n</span><span class="op" id="3146130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146136">if</span>&nbsp;<span class="ident" id="3146139">value</span><span class="op" id="3146144">.</span><span class="ident" id="3146145">Cap</span><span class="op" id="3146148">(</span><span class="op" id="3146149">)</span>&nbsp;<span class="op" id="3146151">&lt;</span>&nbsp;<span class="ident" id="3146153">n</span>&nbsp;<span class="op" id="3146155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146159">value</span><span class="op" id="3146164">.</span><span class="ident" id="3146165">Set</span><span class="op" id="3146168">(</span><span class="ident" id="3146169">reflect</span><span class="op" id="3146176">.</span><span class="ident" id="3146177">MakeSlice</span><span class="op" id="3146186">(</span><span class="ident" id="3146187">value</span><span class="op" id="3146192">.</span><span class="ident" id="3146193">Type</span><span class="op" id="3146197">(</span><span class="op" id="3146198">)</span><span class="op" id="3146199">,</span>&nbsp;<span class="ident" id="3146201">n</span><span class="op" id="3146202">,</span>&nbsp;<span class="ident" id="3146204">n</span><span class="op" id="3146205">)</span><span class="op" id="3146206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146209">}</span>&nbsp;<span class="keyword" id="3146211">else</span>&nbsp;<span class="op" id="3146216">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146220">value</span><span class="op" id="3146225">.</span><span class="ident" id="3146226">Set</span><span class="op" id="3146229">(</span><span class="ident" id="3146230">value</span><span class="op" id="3146235">.</span><span class="ident" id="3146236">Slice</span><span class="op" id="3146241">(</span><span class="num" id="3146242">0</span><span class="op" id="3146243">,</span>&nbsp;<span class="ident" id="3146245">n</span><span class="op" id="3146246">)</span><span class="op" id="3146247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146253">if</span>&nbsp;<span class="ident" id="3146256">_</span><span class="op" id="3146257">,</span>&nbsp;<span class="ident" id="3146259">err</span>&nbsp;<span class="op" id="3146263">:=</span>&nbsp;<span class="ident" id="3146266">state</span><span class="op" id="3146271">.</span><span class="ident" id="3146272">b</span><span class="op" id="3146273">.</span><span class="ident" id="3146274">Read</span><span class="op" id="3146278">(</span><span class="ident" id="3146279">value</span><span class="op" id="3146284">.</span><span class="ident" id="3146285">Bytes</span><span class="op" id="3146290">(</span><span class="op" id="3146291">)</span><span class="op" id="3146292">)</span><span class="op" id="3146293">;</span>&nbsp;<span class="ident" id="3146295">err</span>&nbsp;<span class="op" id="3146299">!=</span>&nbsp;<span class="ident" id="3146302">nil</span>&nbsp;<span class="op" id="3146306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146310">errorf</span><span class="op" id="3146316">(</span><span class="string" id="3146317">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="3146344">,</span>&nbsp;<span class="ident" id="3146346">err</span><span class="op" id="3146349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146352">}</span><br>
<span class="lineno">385</span><span class="op" id="3146354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3146357">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3146425">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3146449">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="3146520">func</span>&nbsp;<span class="ident" id="3146525">decString</span><span class="op" id="3146534">(</span><span class="ident" id="3146535">i</span>&nbsp;<span class="op" id="3146537">*</span><span class="ident" id="3146538">decInstr</span><span class="op" id="3146546">,</span>&nbsp;<span class="ident" id="3146548">state</span>&nbsp;<span class="op" id="3146554">*</span><span class="ident" id="3146555">decoderState</span><span class="op" id="3146567">,</span>&nbsp;<span class="ident" id="3146569">value</span>&nbsp;<span class="ident" id="3146575">reflect</span><span class="op" id="3146582">.</span><span class="ident" id="3146583">Value</span><span class="op" id="3146588">)</span>&nbsp;<span class="op" id="3146590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146593">u</span>&nbsp;<span class="op" id="3146595">:=</span>&nbsp;<span class="ident" id="3146598">state</span><span class="op" id="3146603">.</span><span class="ident" id="3146604">decodeUint</span><span class="op" id="3146614">(</span><span class="op" id="3146615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146618">n</span>&nbsp;<span class="op" id="3146620">:=</span>&nbsp;<span class="builtintype" id="3146623">int</span><span class="op" id="3146626">(</span><span class="ident" id="3146627">u</span><span class="op" id="3146628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146631">if</span>&nbsp;<span class="ident" id="3146634">n</span>&nbsp;<span class="op" id="3146636">&lt;</span>&nbsp;<span class="num" id="3146638">0</span>&nbsp;<span class="op" id="3146640">||</span>&nbsp;<span class="ident" id="3146643">uint64</span><span class="op" id="3146649">(</span><span class="ident" id="3146650">n</span><span class="op" id="3146651">)</span>&nbsp;<span class="op" id="3146653">!=</span>&nbsp;<span class="ident" id="3146656">u</span>&nbsp;<span class="op" id="3146658">||</span>&nbsp;<span class="ident" id="3146661">n</span>&nbsp;<span class="op" id="3146663">&gt;</span>&nbsp;<span class="ident" id="3146665">state</span><span class="op" id="3146670">.</span><span class="ident" id="3146671">b</span><span class="op" id="3146672">.</span><span class="ident" id="3146673">Len</span><span class="op" id="3146676">(</span><span class="op" id="3146677">)</span>&nbsp;<span class="op" id="3146679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146683">errorf</span><span class="op" id="3146689">(</span><span class="string" id="3146690">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3146734">,</span>&nbsp;<span class="ident" id="3146736">value</span><span class="op" id="3146741">.</span><span class="ident" id="3146742">Type</span><span class="op" id="3146746">(</span><span class="op" id="3146747">)</span><span class="op" id="3146748">,</span>&nbsp;<span class="ident" id="3146750">u</span><span class="op" id="3146751">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146757">if</span>&nbsp;<span class="ident" id="3146760">n</span>&nbsp;<span class="op" id="3146762">&gt;</span>&nbsp;<span class="ident" id="3146764">state</span><span class="op" id="3146769">.</span><span class="ident" id="3146770">b</span><span class="op" id="3146771">.</span><span class="ident" id="3146772">Len</span><span class="op" id="3146775">(</span><span class="op" id="3146776">)</span>&nbsp;<span class="op" id="3146778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146782">errorf</span><span class="op" id="3146788">(</span><span class="string" id="3146789">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3146822">,</span>&nbsp;<span class="ident" id="3146824">value</span><span class="op" id="3146829">.</span><span class="ident" id="3146830">Type</span><span class="op" id="3146834">(</span><span class="op" id="3146835">)</span><span class="op" id="3146836">,</span>&nbsp;<span class="ident" id="3146838">n</span><span class="op" id="3146839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146845">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146864">data</span>&nbsp;<span class="op" id="3146869">:=</span>&nbsp;<span class="builtinfunc" id="3146872">make</span><span class="op" id="3146876">(</span><span class="op" id="3146877">[</span><span class="op" id="3146878">]</span><span class="builtintype" id="3146879">byte</span><span class="op" id="3146883">,</span>&nbsp;<span class="ident" id="3146885">n</span><span class="op" id="3146886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146889">if</span>&nbsp;<span class="ident" id="3146892">_</span><span class="op" id="3146893">,</span>&nbsp;<span class="ident" id="3146895">err</span>&nbsp;<span class="op" id="3146899">:=</span>&nbsp;<span class="ident" id="3146902">state</span><span class="op" id="3146907">.</span><span class="ident" id="3146908">b</span><span class="op" id="3146909">.</span><span class="ident" id="3146910">Read</span><span class="op" id="3146914">(</span><span class="ident" id="3146915">data</span><span class="op" id="3146919">)</span><span class="op" id="3146920">;</span>&nbsp;<span class="ident" id="3146922">err</span>&nbsp;<span class="op" id="3146926">!=</span>&nbsp;<span class="ident" id="3146929">nil</span>&nbsp;<span class="op" id="3146933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146937">errorf</span><span class="op" id="3146943">(</span><span class="string" id="3146944">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="3146971">,</span>&nbsp;<span class="ident" id="3146973">err</span><span class="op" id="3146976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146982">value</span><span class="op" id="3146987">.</span><span class="ident" id="3146988">SetString</span><span class="op" id="3146997">(</span><span class="builtintype" id="3146998">string</span><span class="op" id="3147004">(</span><span class="ident" id="3147005">data</span><span class="op" id="3147009">)</span><span class="op" id="3147010">)</span><br>
<span class="lineno">405</span><span class="op" id="3147012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3147015">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3147099">func</span>&nbsp;<span class="ident" id="3147104">ignoreUint8Array</span><span class="op" id="3147120">(</span><span class="ident" id="3147121">i</span>&nbsp;<span class="op" id="3147123">*</span><span class="ident" id="3147124">decInstr</span><span class="op" id="3147132">,</span>&nbsp;<span class="ident" id="3147134">state</span>&nbsp;<span class="op" id="3147140">*</span><span class="ident" id="3147141">decoderState</span><span class="op" id="3147153">,</span>&nbsp;<span class="ident" id="3147155">value</span>&nbsp;<span class="ident" id="3147161">reflect</span><span class="op" id="3147168">.</span><span class="ident" id="3147169">Value</span><span class="op" id="3147174">)</span>&nbsp;<span class="op" id="3147176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147179">b</span>&nbsp;<span class="op" id="3147181">:=</span>&nbsp;<span class="builtinfunc" id="3147184">make</span><span class="op" id="3147188">(</span><span class="op" id="3147189">[</span><span class="op" id="3147190">]</span><span class="builtintype" id="3147191">byte</span><span class="op" id="3147195">,</span>&nbsp;<span class="ident" id="3147197">state</span><span class="op" id="3147202">.</span><span class="ident" id="3147203">decodeUint</span><span class="op" id="3147213">(</span><span class="op" id="3147214">)</span><span class="op" id="3147215">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147218">state</span><span class="op" id="3147223">.</span><span class="ident" id="3147224">b</span><span class="op" id="3147225">.</span><span class="ident" id="3147226">Read</span><span class="op" id="3147230">(</span><span class="ident" id="3147231">b</span><span class="op" id="3147232">)</span><br>
<span class="lineno"></span><span class="op" id="3147234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3147237">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3147258">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3147348">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="3147422">type</span>&nbsp;<span class="ident" id="3147427">decEngine</span>&nbsp;<span class="keyword" id="3147437">struct</span>&nbsp;<span class="op" id="3147444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147447">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3147456">[</span><span class="op" id="3147457">]</span><span class="ident" id="3147458">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147468">numInstr</span>&nbsp;<span class="builtintype" id="3147477">int</span>&nbsp;<span class="comment" id="3147481">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="3147518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3147521">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3147608">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3147687">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="3147744">func</span>&nbsp;<span class="op" id="3147749">(</span><span class="ident" id="3147750">dec</span>&nbsp;<span class="op" id="3147754">*</span><span class="ident" id="3147755">Decoder</span><span class="op" id="3147762">)</span>&nbsp;<span class="ident" id="3147764">decodeSingle</span><span class="op" id="3147776">(</span><span class="ident" id="3147777">engine</span>&nbsp;<span class="op" id="3147784">*</span><span class="ident" id="3147785">decEngine</span><span class="op" id="3147794">,</span>&nbsp;<span class="ident" id="3147796">ut</span>&nbsp;<span class="op" id="3147799">*</span><span class="ident" id="3147800">userTypeInfo</span><span class="op" id="3147812">,</span>&nbsp;<span class="ident" id="3147814">value</span>&nbsp;<span class="ident" id="3147820">reflect</span><span class="op" id="3147827">.</span><span class="ident" id="3147828">Value</span><span class="op" id="3147833">)</span>&nbsp;<span class="op" id="3147835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147838">state</span>&nbsp;<span class="op" id="3147844">:=</span>&nbsp;<span class="ident" id="3147847">dec</span><span class="op" id="3147850">.</span><span class="ident" id="3147851">newDecoderState</span><span class="op" id="3147866">(</span><span class="op" id="3147867">&amp;</span><span class="ident" id="3147868">dec</span><span class="op" id="3147871">.</span><span class="ident" id="3147872">buf</span><span class="op" id="3147875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147878">defer</span>&nbsp;<span class="ident" id="3147884">dec</span><span class="op" id="3147887">.</span><span class="ident" id="3147888">freeDecoderState</span><span class="op" id="3147904">(</span><span class="ident" id="3147905">state</span><span class="op" id="3147910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147913">state</span><span class="op" id="3147918">.</span><span class="ident" id="3147919">fieldnum</span>&nbsp;<span class="op" id="3147928">=</span>&nbsp;<span class="ident" id="3147930">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147946">if</span>&nbsp;<span class="ident" id="3147949">state</span><span class="op" id="3147954">.</span><span class="ident" id="3147955">decodeUint</span><span class="op" id="3147965">(</span><span class="op" id="3147966">)</span>&nbsp;<span class="op" id="3147968">!=</span>&nbsp;<span class="num" id="3147971">0</span>&nbsp;<span class="op" id="3147973">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147977">errorf</span><span class="op" id="3147983">(</span><span class="string" id="3147984">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3148038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148044">instr</span>&nbsp;<span class="op" id="3148050">:=</span>&nbsp;<span class="op" id="3148053">&amp;</span><span class="ident" id="3148054">engine</span><span class="op" id="3148060">.</span><span class="ident" id="3148061">instr</span><span class="op" id="3148066">[</span><span class="ident" id="3148067">singletonField</span><span class="op" id="3148081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148084">instr</span><span class="op" id="3148089">.</span><span class="ident" id="3148090">op</span><span class="op" id="3148092">(</span><span class="ident" id="3148093">instr</span><span class="op" id="3148098">,</span>&nbsp;<span class="ident" id="3148100">state</span><span class="op" id="3148105">,</span>&nbsp;<span class="ident" id="3148107">value</span><span class="op" id="3148112">)</span><br>
<span class="lineno"></span><span class="op" id="3148114">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="3148117">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3148184">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="3148257">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="3148328">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="3148398">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="3148459">func</span>&nbsp;<span class="op" id="3148464">(</span><span class="ident" id="3148465">dec</span>&nbsp;<span class="op" id="3148469">*</span><span class="ident" id="3148470">Decoder</span><span class="op" id="3148477">)</span>&nbsp;<span class="ident" id="3148479">decodeStruct</span><span class="op" id="3148491">(</span><span class="ident" id="3148492">engine</span>&nbsp;<span class="op" id="3148499">*</span><span class="ident" id="3148500">decEngine</span><span class="op" id="3148509">,</span>&nbsp;<span class="ident" id="3148511">ut</span>&nbsp;<span class="op" id="3148514">*</span><span class="ident" id="3148515">userTypeInfo</span><span class="op" id="3148527">,</span>&nbsp;<span class="ident" id="3148529">value</span>&nbsp;<span class="ident" id="3148535">reflect</span><span class="op" id="3148542">.</span><span class="ident" id="3148543">Value</span><span class="op" id="3148548">)</span>&nbsp;<span class="op" id="3148550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148553">state</span>&nbsp;<span class="op" id="3148559">:=</span>&nbsp;<span class="ident" id="3148562">dec</span><span class="op" id="3148565">.</span><span class="ident" id="3148566">newDecoderState</span><span class="op" id="3148581">(</span><span class="op" id="3148582">&amp;</span><span class="ident" id="3148583">dec</span><span class="op" id="3148586">.</span><span class="ident" id="3148587">buf</span><span class="op" id="3148590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148593">defer</span>&nbsp;<span class="ident" id="3148599">dec</span><span class="op" id="3148602">.</span><span class="ident" id="3148603">freeDecoderState</span><span class="op" id="3148619">(</span><span class="ident" id="3148620">state</span><span class="op" id="3148625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148628">state</span><span class="op" id="3148633">.</span><span class="ident" id="3148634">fieldnum</span>&nbsp;<span class="op" id="3148643">=</span>&nbsp;<span class="op" id="3148645">-</span><span class="num" id="3148646">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148649">for</span>&nbsp;<span class="ident" id="3148653">state</span><span class="op" id="3148658">.</span><span class="ident" id="3148659">b</span><span class="op" id="3148660">.</span><span class="ident" id="3148661">Len</span><span class="op" id="3148664">(</span><span class="op" id="3148665">)</span>&nbsp;<span class="op" id="3148667">&gt;</span>&nbsp;<span class="num" id="3148669">0</span>&nbsp;<span class="op" id="3148671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148675">delta</span>&nbsp;<span class="op" id="3148681">:=</span>&nbsp;<span class="builtintype" id="3148684">int</span><span class="op" id="3148687">(</span><span class="ident" id="3148688">state</span><span class="op" id="3148693">.</span><span class="ident" id="3148694">decodeUint</span><span class="op" id="3148704">(</span><span class="op" id="3148705">)</span><span class="op" id="3148706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148710">if</span>&nbsp;<span class="ident" id="3148713">delta</span>&nbsp;<span class="op" id="3148719">&lt;</span>&nbsp;<span class="num" id="3148721">0</span>&nbsp;<span class="op" id="3148723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148728">errorf</span><span class="op" id="3148734">(</span><span class="string" id="3148735">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3148775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148779">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148783">if</span>&nbsp;<span class="ident" id="3148786">delta</span>&nbsp;<span class="op" id="3148792">==</span>&nbsp;<span class="num" id="3148795">0</span>&nbsp;<span class="op" id="3148797">{</span>&nbsp;<span class="comment" id="3148799">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148846">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148858">fieldnum</span>&nbsp;<span class="op" id="3148867">:=</span>&nbsp;<span class="ident" id="3148870">state</span><span class="op" id="3148875">.</span><span class="ident" id="3148876">fieldnum</span>&nbsp;<span class="op" id="3148885">+</span>&nbsp;<span class="ident" id="3148887">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148895">if</span>&nbsp;<span class="ident" id="3148898">fieldnum</span>&nbsp;<span class="op" id="3148907">&gt;=</span>&nbsp;<span class="builtinfunc" id="3148910">len</span><span class="op" id="3148913">(</span><span class="ident" id="3148914">engine</span><span class="op" id="3148920">.</span><span class="ident" id="3148921">instr</span><span class="op" id="3148926">)</span>&nbsp;<span class="op" id="3148928">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148933">error_</span><span class="op" id="3148939">(</span><span class="ident" id="3148940">errRange</span><span class="op" id="3148948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148953">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148965">instr</span>&nbsp;<span class="op" id="3148971">:=</span>&nbsp;<span class="op" id="3148974">&amp;</span><span class="ident" id="3148975">engine</span><span class="op" id="3148981">.</span><span class="ident" id="3148982">instr</span><span class="op" id="3148987">[</span><span class="ident" id="3148988">fieldnum</span><span class="op" id="3148996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149000">var</span>&nbsp;<span class="ident" id="3149004">field</span>&nbsp;<span class="ident" id="3149010">reflect</span><span class="op" id="3149017">.</span><span class="ident" id="3149018">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149026">if</span>&nbsp;<span class="ident" id="3149029">instr</span><span class="op" id="3149034">.</span><span class="ident" id="3149035">index</span>&nbsp;<span class="op" id="3149041">!=</span>&nbsp;<span class="ident" id="3149044">nil</span>&nbsp;<span class="op" id="3149048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149053">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149126">field</span>&nbsp;<span class="op" id="3149132">=</span>&nbsp;<span class="ident" id="3149134">value</span><span class="op" id="3149139">.</span><span class="ident" id="3149140">FieldByIndex</span><span class="op" id="3149152">(</span><span class="ident" id="3149153">instr</span><span class="op" id="3149158">.</span><span class="ident" id="3149159">index</span><span class="op" id="3149164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149169">if</span>&nbsp;<span class="ident" id="3149172">field</span><span class="op" id="3149177">.</span><span class="ident" id="3149178">Kind</span><span class="op" id="3149182">(</span><span class="op" id="3149183">)</span>&nbsp;<span class="op" id="3149185">==</span>&nbsp;<span class="ident" id="3149188">reflect</span><span class="op" id="3149195">.</span><span class="ident" id="3149196">Ptr</span>&nbsp;<span class="op" id="3149200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149206">field</span>&nbsp;<span class="op" id="3149212">=</span>&nbsp;<span class="ident" id="3149214">decAlloc</span><span class="op" id="3149222">(</span><span class="ident" id="3149223">field</span><span class="op" id="3149228">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149241">instr</span><span class="op" id="3149246">.</span><span class="ident" id="3149247">op</span><span class="op" id="3149249">(</span><span class="ident" id="3149250">instr</span><span class="op" id="3149255">,</span>&nbsp;<span class="ident" id="3149257">state</span><span class="op" id="3149262">,</span>&nbsp;<span class="ident" id="3149264">field</span><span class="op" id="3149269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149273">state</span><span class="op" id="3149278">.</span><span class="ident" id="3149279">fieldnum</span>&nbsp;<span class="op" id="3149288">=</span>&nbsp;<span class="ident" id="3149290">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149300">}</span><br>
<span class="lineno">470</span><span class="op" id="3149302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3149305">var</span>&nbsp;<span class="ident" id="3149309">noValue</span>&nbsp;<span class="ident" id="3149317">reflect</span><span class="op" id="3149324">.</span><span class="ident" id="3149325">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3149332">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="3149400">func</span>&nbsp;<span class="op" id="3149405">(</span><span class="ident" id="3149406">dec</span>&nbsp;<span class="op" id="3149410">*</span><span class="ident" id="3149411">Decoder</span><span class="op" id="3149418">)</span>&nbsp;<span class="ident" id="3149420">ignoreStruct</span><span class="op" id="3149432">(</span><span class="ident" id="3149433">engine</span>&nbsp;<span class="op" id="3149440">*</span><span class="ident" id="3149441">decEngine</span><span class="op" id="3149450">)</span>&nbsp;<span class="op" id="3149452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149455">state</span>&nbsp;<span class="op" id="3149461">:=</span>&nbsp;<span class="ident" id="3149464">dec</span><span class="op" id="3149467">.</span><span class="ident" id="3149468">newDecoderState</span><span class="op" id="3149483">(</span><span class="op" id="3149484">&amp;</span><span class="ident" id="3149485">dec</span><span class="op" id="3149488">.</span><span class="ident" id="3149489">buf</span><span class="op" id="3149492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149495">defer</span>&nbsp;<span class="ident" id="3149501">dec</span><span class="op" id="3149504">.</span><span class="ident" id="3149505">freeDecoderState</span><span class="op" id="3149521">(</span><span class="ident" id="3149522">state</span><span class="op" id="3149527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149530">state</span><span class="op" id="3149535">.</span><span class="ident" id="3149536">fieldnum</span>&nbsp;<span class="op" id="3149545">=</span>&nbsp;<span class="op" id="3149547">-</span><span class="num" id="3149548">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149551">for</span>&nbsp;<span class="ident" id="3149555">state</span><span class="op" id="3149560">.</span><span class="ident" id="3149561">b</span><span class="op" id="3149562">.</span><span class="ident" id="3149563">Len</span><span class="op" id="3149566">(</span><span class="op" id="3149567">)</span>&nbsp;<span class="op" id="3149569">&gt;</span>&nbsp;<span class="num" id="3149571">0</span>&nbsp;<span class="op" id="3149573">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149577">delta</span>&nbsp;<span class="op" id="3149583">:=</span>&nbsp;<span class="builtintype" id="3149586">int</span><span class="op" id="3149589">(</span><span class="ident" id="3149590">state</span><span class="op" id="3149595">.</span><span class="ident" id="3149596">decodeUint</span><span class="op" id="3149606">(</span><span class="op" id="3149607">)</span><span class="op" id="3149608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149612">if</span>&nbsp;<span class="ident" id="3149615">delta</span>&nbsp;<span class="op" id="3149621">&lt;</span>&nbsp;<span class="num" id="3149623">0</span>&nbsp;<span class="op" id="3149625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149630">errorf</span><span class="op" id="3149636">(</span><span class="string" id="3149637">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3149684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149692">if</span>&nbsp;<span class="ident" id="3149695">delta</span>&nbsp;<span class="op" id="3149701">==</span>&nbsp;<span class="num" id="3149704">0</span>&nbsp;<span class="op" id="3149706">{</span>&nbsp;<span class="comment" id="3149708">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149755">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149767">fieldnum</span>&nbsp;<span class="op" id="3149776">:=</span>&nbsp;<span class="ident" id="3149779">state</span><span class="op" id="3149784">.</span><span class="ident" id="3149785">fieldnum</span>&nbsp;<span class="op" id="3149794">+</span>&nbsp;<span class="ident" id="3149796">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149804">if</span>&nbsp;<span class="ident" id="3149807">fieldnum</span>&nbsp;<span class="op" id="3149816">&gt;=</span>&nbsp;<span class="builtinfunc" id="3149819">len</span><span class="op" id="3149822">(</span><span class="ident" id="3149823">engine</span><span class="op" id="3149829">.</span><span class="ident" id="3149830">instr</span><span class="op" id="3149835">)</span>&nbsp;<span class="op" id="3149837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149842">error_</span><span class="op" id="3149848">(</span><span class="ident" id="3149849">errRange</span><span class="op" id="3149857">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149865">instr</span>&nbsp;<span class="op" id="3149871">:=</span>&nbsp;<span class="op" id="3149874">&amp;</span><span class="ident" id="3149875">engine</span><span class="op" id="3149881">.</span><span class="ident" id="3149882">instr</span><span class="op" id="3149887">[</span><span class="ident" id="3149888">fieldnum</span><span class="op" id="3149896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149900">instr</span><span class="op" id="3149905">.</span><span class="ident" id="3149906">op</span><span class="op" id="3149908">(</span><span class="ident" id="3149909">instr</span><span class="op" id="3149914">,</span>&nbsp;<span class="ident" id="3149916">state</span><span class="op" id="3149921">,</span>&nbsp;<span class="ident" id="3149923">noValue</span><span class="op" id="3149930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149934">state</span><span class="op" id="3149939">.</span><span class="ident" id="3149940">fieldnum</span>&nbsp;<span class="op" id="3149949">=</span>&nbsp;<span class="ident" id="3149951">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149961">}</span><br>
<span class="lineno">495</span><span class="op" id="3149963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3149966">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3150041">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3150105">func</span>&nbsp;<span class="op" id="3150110">(</span><span class="ident" id="3150111">dec</span>&nbsp;<span class="op" id="3150115">*</span><span class="ident" id="3150116">Decoder</span><span class="op" id="3150123">)</span>&nbsp;<span class="ident" id="3150125">ignoreSingle</span><span class="op" id="3150137">(</span><span class="ident" id="3150138">engine</span>&nbsp;<span class="op" id="3150145">*</span><span class="ident" id="3150146">decEngine</span><span class="op" id="3150155">)</span>&nbsp;<span class="op" id="3150157">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150160">state</span>&nbsp;<span class="op" id="3150166">:=</span>&nbsp;<span class="ident" id="3150169">dec</span><span class="op" id="3150172">.</span><span class="ident" id="3150173">newDecoderState</span><span class="op" id="3150188">(</span><span class="op" id="3150189">&amp;</span><span class="ident" id="3150190">dec</span><span class="op" id="3150193">.</span><span class="ident" id="3150194">buf</span><span class="op" id="3150197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150200">defer</span>&nbsp;<span class="ident" id="3150206">dec</span><span class="op" id="3150209">.</span><span class="ident" id="3150210">freeDecoderState</span><span class="op" id="3150226">(</span><span class="ident" id="3150227">state</span><span class="op" id="3150232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150235">state</span><span class="op" id="3150240">.</span><span class="ident" id="3150241">fieldnum</span>&nbsp;<span class="op" id="3150250">=</span>&nbsp;<span class="ident" id="3150252">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150268">delta</span>&nbsp;<span class="op" id="3150274">:=</span>&nbsp;<span class="builtintype" id="3150277">int</span><span class="op" id="3150280">(</span><span class="ident" id="3150281">state</span><span class="op" id="3150286">.</span><span class="ident" id="3150287">decodeUint</span><span class="op" id="3150297">(</span><span class="op" id="3150298">)</span><span class="op" id="3150299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150302">if</span>&nbsp;<span class="ident" id="3150305">delta</span>&nbsp;<span class="op" id="3150311">!=</span>&nbsp;<span class="num" id="3150314">0</span>&nbsp;<span class="op" id="3150316">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150320">errorf</span><span class="op" id="3150326">(</span><span class="string" id="3150327">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3150381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150387">instr</span>&nbsp;<span class="op" id="3150393">:=</span>&nbsp;<span class="op" id="3150396">&amp;</span><span class="ident" id="3150397">engine</span><span class="op" id="3150403">.</span><span class="ident" id="3150404">instr</span><span class="op" id="3150409">[</span><span class="ident" id="3150410">singletonField</span><span class="op" id="3150424">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150427">instr</span><span class="op" id="3150432">.</span><span class="ident" id="3150433">op</span><span class="op" id="3150435">(</span><span class="ident" id="3150436">instr</span><span class="op" id="3150441">,</span>&nbsp;<span class="ident" id="3150443">state</span><span class="op" id="3150448">,</span>&nbsp;<span class="ident" id="3150450">noValue</span><span class="op" id="3150457">)</span><br>
<span class="lineno"></span><span class="op" id="3150459">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="3150462">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3150529">func</span>&nbsp;<span class="op" id="3150534">(</span><span class="ident" id="3150535">dec</span>&nbsp;<span class="op" id="3150539">*</span><span class="ident" id="3150540">Decoder</span><span class="op" id="3150547">)</span>&nbsp;<span class="ident" id="3150549">decodeArrayHelper</span><span class="op" id="3150566">(</span><span class="ident" id="3150567">state</span>&nbsp;<span class="op" id="3150573">*</span><span class="ident" id="3150574">decoderState</span><span class="op" id="3150586">,</span>&nbsp;<span class="ident" id="3150588">value</span>&nbsp;<span class="ident" id="3150594">reflect</span><span class="op" id="3150601">.</span><span class="ident" id="3150602">Value</span><span class="op" id="3150607">,</span>&nbsp;<span class="ident" id="3150609">elemOp</span>&nbsp;<span class="ident" id="3150616">decOp</span><span class="op" id="3150621">,</span>&nbsp;<span class="ident" id="3150623">length</span>&nbsp;<span class="builtintype" id="3150630">int</span><span class="op" id="3150633">,</span>&nbsp;<span class="ident" id="3150635">ovfl</span>&nbsp;<span class="builtintype" id="3150640">error</span><span class="op" id="3150645">,</span>&nbsp;<span class="ident" id="3150647">helper</span>&nbsp;<span class="ident" id="3150654">decHelper</span><span class="op" id="3150663">)</span>&nbsp;<span class="op" id="3150665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150668">if</span>&nbsp;<span class="ident" id="3150671">helper</span>&nbsp;<span class="op" id="3150678">!=</span>&nbsp;<span class="ident" id="3150681">nil</span>&nbsp;<span class="op" id="3150685">&amp;&amp;</span>&nbsp;<span class="ident" id="3150688">helper</span><span class="op" id="3150694">(</span><span class="ident" id="3150695">state</span><span class="op" id="3150700">,</span>&nbsp;<span class="ident" id="3150702">value</span><span class="op" id="3150707">,</span>&nbsp;<span class="ident" id="3150709">length</span><span class="op" id="3150715">,</span>&nbsp;<span class="ident" id="3150717">ovfl</span><span class="op" id="3150721">)</span>&nbsp;<span class="op" id="3150723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150727">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150738">instr</span>&nbsp;<span class="op" id="3150744">:=</span>&nbsp;<span class="op" id="3150747">&amp;</span><span class="ident" id="3150748">decInstr</span><span class="op" id="3150756">{</span><span class="ident" id="3150757">elemOp</span><span class="op" id="3150763">,</span>&nbsp;<span class="num" id="3150765">0</span><span class="op" id="3150766">,</span>&nbsp;<span class="ident" id="3150768">nil</span><span class="op" id="3150771">,</span>&nbsp;<span class="ident" id="3150773">ovfl</span><span class="op" id="3150777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150780">isPtr</span>&nbsp;<span class="op" id="3150786">:=</span>&nbsp;<span class="ident" id="3150789">value</span><span class="op" id="3150794">.</span><span class="ident" id="3150795">Type</span><span class="op" id="3150799">(</span><span class="op" id="3150800">)</span><span class="op" id="3150801">.</span><span class="ident" id="3150802">Elem</span><span class="op" id="3150806">(</span><span class="op" id="3150807">)</span><span class="op" id="3150808">.</span><span class="ident" id="3150809">Kind</span><span class="op" id="3150813">(</span><span class="op" id="3150814">)</span>&nbsp;<span class="op" id="3150816">==</span>&nbsp;<span class="ident" id="3150819">reflect</span><span class="op" id="3150826">.</span><span class="ident" id="3150827">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150832">for</span>&nbsp;<span class="ident" id="3150836">i</span>&nbsp;<span class="op" id="3150838">:=</span>&nbsp;<span class="num" id="3150841">0</span><span class="op" id="3150842">;</span>&nbsp;<span class="ident" id="3150844">i</span>&nbsp;<span class="op" id="3150846">&lt;</span>&nbsp;<span class="ident" id="3150848">length</span><span class="op" id="3150854">;</span>&nbsp;<span class="ident" id="3150856">i</span><span class="op" id="3150857">++</span>&nbsp;<span class="op" id="3150860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150864">if</span>&nbsp;<span class="ident" id="3150867">state</span><span class="op" id="3150872">.</span><span class="ident" id="3150873">b</span><span class="op" id="3150874">.</span><span class="ident" id="3150875">Len</span><span class="op" id="3150878">(</span><span class="op" id="3150879">)</span>&nbsp;<span class="op" id="3150881">==</span>&nbsp;<span class="num" id="3150884">0</span>&nbsp;<span class="op" id="3150886">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150891">errorf</span><span class="op" id="3150897">(</span><span class="string" id="3150898">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="3150964">,</span>&nbsp;<span class="ident" id="3150966">length</span><span class="op" id="3150972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150980">v</span>&nbsp;<span class="op" id="3150982">:=</span>&nbsp;<span class="ident" id="3150985">value</span><span class="op" id="3150990">.</span><span class="ident" id="3150991">Index</span><span class="op" id="3150996">(</span><span class="ident" id="3150997">i</span><span class="op" id="3150998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151002">if</span>&nbsp;<span class="ident" id="3151005">isPtr</span>&nbsp;<span class="op" id="3151011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151016">v</span>&nbsp;<span class="op" id="3151018">=</span>&nbsp;<span class="ident" id="3151020">decAlloc</span><span class="op" id="3151028">(</span><span class="ident" id="3151029">v</span><span class="op" id="3151030">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151038">elemOp</span><span class="op" id="3151044">(</span><span class="ident" id="3151045">instr</span><span class="op" id="3151050">,</span>&nbsp;<span class="ident" id="3151052">state</span><span class="op" id="3151057">,</span>&nbsp;<span class="ident" id="3151059">v</span><span class="op" id="3151060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151063">}</span><br>
<span class="lineno"></span><span class="op" id="3151065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3151068">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3151124">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="3151222">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3151303">func</span>&nbsp;<span class="op" id="3151308">(</span><span class="ident" id="3151309">dec</span>&nbsp;<span class="op" id="3151313">*</span><span class="ident" id="3151314">Decoder</span><span class="op" id="3151321">)</span>&nbsp;<span class="ident" id="3151323">decodeArray</span><span class="op" id="3151334">(</span><span class="ident" id="3151335">atyp</span>&nbsp;<span class="ident" id="3151340">reflect</span><span class="op" id="3151347">.</span><span class="ident" id="3151348">Type</span><span class="op" id="3151352">,</span>&nbsp;<span class="ident" id="3151354">state</span>&nbsp;<span class="op" id="3151360">*</span><span class="ident" id="3151361">decoderState</span><span class="op" id="3151373">,</span>&nbsp;<span class="ident" id="3151375">value</span>&nbsp;<span class="ident" id="3151381">reflect</span><span class="op" id="3151388">.</span><span class="ident" id="3151389">Value</span><span class="op" id="3151394">,</span>&nbsp;<span class="ident" id="3151396">elemOp</span>&nbsp;<span class="ident" id="3151403">decOp</span><span class="op" id="3151408">,</span>&nbsp;<span class="ident" id="3151410">length</span>&nbsp;<span class="builtintype" id="3151417">int</span><span class="op" id="3151420">,</span>&nbsp;<span class="ident" id="3151422">ovfl</span>&nbsp;<span class="builtintype" id="3151427">error</span><span class="op" id="3151432">,</span>&nbsp;<span class="ident" id="3151434">helper</span>&nbsp;<span class="ident" id="3151441">decHelper</span><span class="op" id="3151450">)</span>&nbsp;<span class="op" id="3151452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151455">if</span>&nbsp;<span class="ident" id="3151458">n</span>&nbsp;<span class="op" id="3151460">:=</span>&nbsp;<span class="ident" id="3151463">state</span><span class="op" id="3151468">.</span><span class="ident" id="3151469">decodeUint</span><span class="op" id="3151479">(</span><span class="op" id="3151480">)</span><span class="op" id="3151481">;</span>&nbsp;<span class="ident" id="3151483">n</span>&nbsp;<span class="op" id="3151485">!=</span>&nbsp;<span class="ident" id="3151488">uint64</span><span class="op" id="3151494">(</span><span class="ident" id="3151495">length</span><span class="op" id="3151501">)</span>&nbsp;<span class="op" id="3151503">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151507">errorf</span><span class="op" id="3151513">(</span><span class="string" id="3151514">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="3151546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151552">dec</span><span class="op" id="3151555">.</span><span class="ident" id="3151556">decodeArrayHelper</span><span class="op" id="3151573">(</span><span class="ident" id="3151574">state</span><span class="op" id="3151579">,</span>&nbsp;<span class="ident" id="3151581">value</span><span class="op" id="3151586">,</span>&nbsp;<span class="ident" id="3151588">elemOp</span><span class="op" id="3151594">,</span>&nbsp;<span class="ident" id="3151596">length</span><span class="op" id="3151602">,</span>&nbsp;<span class="ident" id="3151604">ovfl</span><span class="op" id="3151608">,</span>&nbsp;<span class="ident" id="3151610">helper</span><span class="op" id="3151616">)</span><br>
<span class="lineno"></span><span class="op" id="3151618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="3151621">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3151670">func</span>&nbsp;<span class="ident" id="3151675">decodeIntoValue</span><span class="op" id="3151690">(</span><span class="ident" id="3151691">state</span>&nbsp;<span class="op" id="3151697">*</span><span class="ident" id="3151698">decoderState</span><span class="op" id="3151710">,</span>&nbsp;<span class="ident" id="3151712">op</span>&nbsp;<span class="ident" id="3151715">decOp</span><span class="op" id="3151720">,</span>&nbsp;<span class="ident" id="3151722">isPtr</span>&nbsp;<span class="builtintype" id="3151728">bool</span><span class="op" id="3151732">,</span>&nbsp;<span class="ident" id="3151734">value</span>&nbsp;<span class="ident" id="3151740">reflect</span><span class="op" id="3151747">.</span><span class="ident" id="3151748">Value</span><span class="op" id="3151753">,</span>&nbsp;<span class="ident" id="3151755">ovfl</span>&nbsp;<span class="builtintype" id="3151760">error</span><span class="op" id="3151765">)</span>&nbsp;<span class="ident" id="3151767">reflect</span><span class="op" id="3151774">.</span><span class="ident" id="3151775">Value</span>&nbsp;<span class="op" id="3151781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151784">instr</span>&nbsp;<span class="op" id="3151790">:=</span>&nbsp;<span class="op" id="3151793">&amp;</span><span class="ident" id="3151794">decInstr</span><span class="op" id="3151802">{</span><span class="ident" id="3151803">op</span><span class="op" id="3151805">,</span>&nbsp;<span class="num" id="3151807">0</span><span class="op" id="3151808">,</span>&nbsp;<span class="ident" id="3151810">nil</span><span class="op" id="3151813">,</span>&nbsp;<span class="ident" id="3151815">ovfl</span><span class="op" id="3151819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151822">v</span>&nbsp;<span class="op" id="3151824">:=</span>&nbsp;<span class="ident" id="3151827">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151834">if</span>&nbsp;<span class="ident" id="3151837">isPtr</span>&nbsp;<span class="op" id="3151843">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151847">v</span>&nbsp;<span class="op" id="3151849">=</span>&nbsp;<span class="ident" id="3151851">decAlloc</span><span class="op" id="3151859">(</span><span class="ident" id="3151860">value</span><span class="op" id="3151865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151871">op</span><span class="op" id="3151873">(</span><span class="ident" id="3151874">instr</span><span class="op" id="3151879">,</span>&nbsp;<span class="ident" id="3151881">state</span><span class="op" id="3151886">,</span>&nbsp;<span class="ident" id="3151888">v</span><span class="op" id="3151889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151892">return</span>&nbsp;<span class="ident" id="3151899">value</span><br>
<span class="lineno"></span><span class="op" id="3151905">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="3151908">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3151959">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="3152020">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3152084">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="3152129">func</span>&nbsp;<span class="op" id="3152134">(</span><span class="ident" id="3152135">dec</span>&nbsp;<span class="op" id="3152139">*</span><span class="ident" id="3152140">Decoder</span><span class="op" id="3152147">)</span>&nbsp;<span class="ident" id="3152149">decodeMap</span><span class="op" id="3152158">(</span><span class="ident" id="3152159">mtyp</span>&nbsp;<span class="ident" id="3152164">reflect</span><span class="op" id="3152171">.</span><span class="ident" id="3152172">Type</span><span class="op" id="3152176">,</span>&nbsp;<span class="ident" id="3152178">state</span>&nbsp;<span class="op" id="3152184">*</span><span class="ident" id="3152185">decoderState</span><span class="op" id="3152197">,</span>&nbsp;<span class="ident" id="3152199">value</span>&nbsp;<span class="ident" id="3152205">reflect</span><span class="op" id="3152212">.</span><span class="ident" id="3152213">Value</span><span class="op" id="3152218">,</span>&nbsp;<span class="ident" id="3152220">keyOp</span><span class="op" id="3152225">,</span>&nbsp;<span class="ident" id="3152227">elemOp</span>&nbsp;<span class="ident" id="3152234">decOp</span><span class="op" id="3152239">,</span>&nbsp;<span class="ident" id="3152241">ovfl</span>&nbsp;<span class="builtintype" id="3152246">error</span><span class="op" id="3152251">)</span>&nbsp;<span class="op" id="3152253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152256">if</span>&nbsp;<span class="ident" id="3152259">value</span><span class="op" id="3152264">.</span><span class="ident" id="3152265">IsNil</span><span class="op" id="3152270">(</span><span class="op" id="3152271">)</span>&nbsp;<span class="op" id="3152273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3152277">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152296">value</span><span class="op" id="3152301">.</span><span class="ident" id="3152302">Set</span><span class="op" id="3152305">(</span><span class="ident" id="3152306">reflect</span><span class="op" id="3152313">.</span><span class="ident" id="3152314">MakeMap</span><span class="op" id="3152321">(</span><span class="ident" id="3152322">mtyp</span><span class="op" id="3152326">)</span><span class="op" id="3152327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152330">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152333">n</span>&nbsp;<span class="op" id="3152335">:=</span>&nbsp;<span class="builtintype" id="3152338">int</span><span class="op" id="3152341">(</span><span class="ident" id="3152342">state</span><span class="op" id="3152347">.</span><span class="ident" id="3152348">decodeUint</span><span class="op" id="3152358">(</span><span class="op" id="3152359">)</span><span class="op" id="3152360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152363">keyIsPtr</span>&nbsp;<span class="op" id="3152372">:=</span>&nbsp;<span class="ident" id="3152375">mtyp</span><span class="op" id="3152379">.</span><span class="ident" id="3152380">Key</span><span class="op" id="3152383">(</span><span class="op" id="3152384">)</span><span class="op" id="3152385">.</span><span class="ident" id="3152386">Kind</span><span class="op" id="3152390">(</span><span class="op" id="3152391">)</span>&nbsp;<span class="op" id="3152393">==</span>&nbsp;<span class="ident" id="3152396">reflect</span><span class="op" id="3152403">.</span><span class="ident" id="3152404">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152409">elemIsPtr</span>&nbsp;<span class="op" id="3152419">:=</span>&nbsp;<span class="ident" id="3152422">mtyp</span><span class="op" id="3152426">.</span><span class="ident" id="3152427">Elem</span><span class="op" id="3152431">(</span><span class="op" id="3152432">)</span><span class="op" id="3152433">.</span><span class="ident" id="3152434">Kind</span><span class="op" id="3152438">(</span><span class="op" id="3152439">)</span>&nbsp;<span class="op" id="3152441">==</span>&nbsp;<span class="ident" id="3152444">reflect</span><span class="op" id="3152451">.</span><span class="ident" id="3152452">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152457">for</span>&nbsp;<span class="ident" id="3152461">i</span>&nbsp;<span class="op" id="3152463">:=</span>&nbsp;<span class="num" id="3152466">0</span><span class="op" id="3152467">;</span>&nbsp;<span class="ident" id="3152469">i</span>&nbsp;<span class="op" id="3152471">&lt;</span>&nbsp;<span class="ident" id="3152473">n</span><span class="op" id="3152474">;</span>&nbsp;<span class="ident" id="3152476">i</span><span class="op" id="3152477">++</span>&nbsp;<span class="op" id="3152480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152484">key</span>&nbsp;<span class="op" id="3152488">:=</span>&nbsp;<span class="ident" id="3152491">decodeIntoValue</span><span class="op" id="3152506">(</span><span class="ident" id="3152507">state</span><span class="op" id="3152512">,</span>&nbsp;<span class="ident" id="3152514">keyOp</span><span class="op" id="3152519">,</span>&nbsp;<span class="ident" id="3152521">keyIsPtr</span><span class="op" id="3152529">,</span>&nbsp;<span class="ident" id="3152531">allocValue</span><span class="op" id="3152541">(</span><span class="ident" id="3152542">mtyp</span><span class="op" id="3152546">.</span><span class="ident" id="3152547">Key</span><span class="op" id="3152550">(</span><span class="op" id="3152551">)</span><span class="op" id="3152552">)</span><span class="op" id="3152553">,</span>&nbsp;<span class="ident" id="3152555">ovfl</span><span class="op" id="3152559">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152563">elem</span>&nbsp;<span class="op" id="3152568">:=</span>&nbsp;<span class="ident" id="3152571">decodeIntoValue</span><span class="op" id="3152586">(</span><span class="ident" id="3152587">state</span><span class="op" id="3152592">,</span>&nbsp;<span class="ident" id="3152594">elemOp</span><span class="op" id="3152600">,</span>&nbsp;<span class="ident" id="3152602">elemIsPtr</span><span class="op" id="3152611">,</span>&nbsp;<span class="ident" id="3152613">allocValue</span><span class="op" id="3152623">(</span><span class="ident" id="3152624">mtyp</span><span class="op" id="3152628">.</span><span class="ident" id="3152629">Elem</span><span class="op" id="3152633">(</span><span class="op" id="3152634">)</span><span class="op" id="3152635">)</span><span class="op" id="3152636">,</span>&nbsp;<span class="ident" id="3152638">ovfl</span><span class="op" id="3152642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152646">value</span><span class="op" id="3152651">.</span><span class="ident" id="3152652">SetMapIndex</span><span class="op" id="3152663">(</span><span class="ident" id="3152664">key</span><span class="op" id="3152667">,</span>&nbsp;<span class="ident" id="3152669">elem</span><span class="op" id="3152673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152676">}</span><br>
<span class="lineno"></span><span class="op" id="3152678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="3152681">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3152750">func</span>&nbsp;<span class="op" id="3152755">(</span><span class="ident" id="3152756">dec</span>&nbsp;<span class="op" id="3152760">*</span><span class="ident" id="3152761">Decoder</span><span class="op" id="3152768">)</span>&nbsp;<span class="ident" id="3152770">ignoreArrayHelper</span><span class="op" id="3152787">(</span><span class="ident" id="3152788">state</span>&nbsp;<span class="op" id="3152794">*</span><span class="ident" id="3152795">decoderState</span><span class="op" id="3152807">,</span>&nbsp;<span class="ident" id="3152809">elemOp</span>&nbsp;<span class="ident" id="3152816">decOp</span><span class="op" id="3152821">,</span>&nbsp;<span class="ident" id="3152823">length</span>&nbsp;<span class="builtintype" id="3152830">int</span><span class="op" id="3152833">)</span>&nbsp;<span class="op" id="3152835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152838">instr</span>&nbsp;<span class="op" id="3152844">:=</span>&nbsp;<span class="op" id="3152847">&amp;</span><span class="ident" id="3152848">decInstr</span><span class="op" id="3152856">{</span><span class="ident" id="3152857">elemOp</span><span class="op" id="3152863">,</span>&nbsp;<span class="num" id="3152865">0</span><span class="op" id="3152866">,</span>&nbsp;<span class="ident" id="3152868">nil</span><span class="op" id="3152871">,</span>&nbsp;<span class="ident" id="3152873">errors</span><span class="op" id="3152879">.</span><span class="ident" id="3152880">New</span><span class="op" id="3152883">(</span><span class="string" id="3152884">&#34;no&nbsp;error&#34;</span><span class="op" id="3152894">)</span><span class="op" id="3152895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152898">for</span>&nbsp;<span class="ident" id="3152902">i</span>&nbsp;<span class="op" id="3152904">:=</span>&nbsp;<span class="num" id="3152907">0</span><span class="op" id="3152908">;</span>&nbsp;<span class="ident" id="3152910">i</span>&nbsp;<span class="op" id="3152912">&lt;</span>&nbsp;<span class="ident" id="3152914">length</span><span class="op" id="3152920">;</span>&nbsp;<span class="ident" id="3152922">i</span><span class="op" id="3152923">++</span>&nbsp;<span class="op" id="3152926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152930">elemOp</span><span class="op" id="3152936">(</span><span class="ident" id="3152937">instr</span><span class="op" id="3152942">,</span>&nbsp;<span class="ident" id="3152944">state</span><span class="op" id="3152949">,</span>&nbsp;<span class="ident" id="3152951">noValue</span><span class="op" id="3152958">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152961">}</span><br>
<span class="lineno"></span><span class="op" id="3152963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3152966">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3153039">func</span>&nbsp;<span class="op" id="3153044">(</span><span class="ident" id="3153045">dec</span>&nbsp;<span class="op" id="3153049">*</span><span class="ident" id="3153050">Decoder</span><span class="op" id="3153057">)</span>&nbsp;<span class="ident" id="3153059">ignoreArray</span><span class="op" id="3153070">(</span><span class="ident" id="3153071">state</span>&nbsp;<span class="op" id="3153077">*</span><span class="ident" id="3153078">decoderState</span><span class="op" id="3153090">,</span>&nbsp;<span class="ident" id="3153092">elemOp</span>&nbsp;<span class="ident" id="3153099">decOp</span><span class="op" id="3153104">,</span>&nbsp;<span class="ident" id="3153106">length</span>&nbsp;<span class="builtintype" id="3153113">int</span><span class="op" id="3153116">)</span>&nbsp;<span class="op" id="3153118">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153121">if</span>&nbsp;<span class="ident" id="3153124">n</span>&nbsp;<span class="op" id="3153126">:=</span>&nbsp;<span class="ident" id="3153129">state</span><span class="op" id="3153134">.</span><span class="ident" id="3153135">decodeUint</span><span class="op" id="3153145">(</span><span class="op" id="3153146">)</span><span class="op" id="3153147">;</span>&nbsp;<span class="ident" id="3153149">n</span>&nbsp;<span class="op" id="3153151">!=</span>&nbsp;<span class="ident" id="3153154">uint64</span><span class="op" id="3153160">(</span><span class="ident" id="3153161">length</span><span class="op" id="3153167">)</span>&nbsp;<span class="op" id="3153169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153173">errorf</span><span class="op" id="3153179">(</span><span class="string" id="3153180">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="3153212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153218">dec</span><span class="op" id="3153221">.</span><span class="ident" id="3153222">ignoreArrayHelper</span><span class="op" id="3153239">(</span><span class="ident" id="3153240">state</span><span class="op" id="3153245">,</span>&nbsp;<span class="ident" id="3153247">elemOp</span><span class="op" id="3153253">,</span>&nbsp;<span class="ident" id="3153255">length</span><span class="op" id="3153261">)</span><br>
<span class="lineno"></span><span class="op" id="3153263">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="3153266">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3153334">func</span>&nbsp;<span class="op" id="3153339">(</span><span class="ident" id="3153340">dec</span>&nbsp;<span class="op" id="3153344">*</span><span class="ident" id="3153345">Decoder</span><span class="op" id="3153352">)</span>&nbsp;<span class="ident" id="3153354">ignoreMap</span><span class="op" id="3153363">(</span><span class="ident" id="3153364">state</span>&nbsp;<span class="op" id="3153370">*</span><span class="ident" id="3153371">decoderState</span><span class="op" id="3153383">,</span>&nbsp;<span class="ident" id="3153385">keyOp</span><span class="op" id="3153390">,</span>&nbsp;<span class="ident" id="3153392">elemOp</span>&nbsp;<span class="ident" id="3153399">decOp</span><span class="op" id="3153404">)</span>&nbsp;<span class="op" id="3153406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153409">n</span>&nbsp;<span class="op" id="3153411">:=</span>&nbsp;<span class="builtintype" id="3153414">int</span><span class="op" id="3153417">(</span><span class="ident" id="3153418">state</span><span class="op" id="3153423">.</span><span class="ident" id="3153424">decodeUint</span><span class="op" id="3153434">(</span><span class="op" id="3153435">)</span><span class="op" id="3153436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153439">keyInstr</span>&nbsp;<span class="op" id="3153448">:=</span>&nbsp;<span class="op" id="3153451">&amp;</span><span class="ident" id="3153452">decInstr</span><span class="op" id="3153460">{</span><span class="ident" id="3153461">keyOp</span><span class="op" id="3153466">,</span>&nbsp;<span class="num" id="3153468">0</span><span class="op" id="3153469">,</span>&nbsp;<span class="ident" id="3153471">nil</span><span class="op" id="3153474">,</span>&nbsp;<span class="ident" id="3153476">errors</span><span class="op" id="3153482">.</span><span class="ident" id="3153483">New</span><span class="op" id="3153486">(</span><span class="string" id="3153487">&#34;no&nbsp;error&#34;</span><span class="op" id="3153497">)</span><span class="op" id="3153498">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153501">elemInstr</span>&nbsp;<span class="op" id="3153511">:=</span>&nbsp;<span class="op" id="3153514">&amp;</span><span class="ident" id="3153515">decInstr</span><span class="op" id="3153523">{</span><span class="ident" id="3153524">elemOp</span><span class="op" id="3153530">,</span>&nbsp;<span class="num" id="3153532">0</span><span class="op" id="3153533">,</span>&nbsp;<span class="ident" id="3153535">nil</span><span class="op" id="3153538">,</span>&nbsp;<span class="ident" id="3153540">errors</span><span class="op" id="3153546">.</span><span class="ident" id="3153547">New</span><span class="op" id="3153550">(</span><span class="string" id="3153551">&#34;no&nbsp;error&#34;</span><span class="op" id="3153561">)</span><span class="op" id="3153562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153565">for</span>&nbsp;<span class="ident" id="3153569">i</span>&nbsp;<span class="op" id="3153571">:=</span>&nbsp;<span class="num" id="3153574">0</span><span class="op" id="3153575">;</span>&nbsp;<span class="ident" id="3153577">i</span>&nbsp;<span class="op" id="3153579">&lt;</span>&nbsp;<span class="ident" id="3153581">n</span><span class="op" id="3153582">;</span>&nbsp;<span class="ident" id="3153584">i</span><span class="op" id="3153585">++</span>&nbsp;<span class="op" id="3153588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153592">keyOp</span><span class="op" id="3153597">(</span><span class="ident" id="3153598">keyInstr</span><span class="op" id="3153606">,</span>&nbsp;<span class="ident" id="3153608">state</span><span class="op" id="3153613">,</span>&nbsp;<span class="ident" id="3153615">noValue</span><span class="op" id="3153622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153626">elemOp</span><span class="op" id="3153632">(</span><span class="ident" id="3153633">elemInstr</span><span class="op" id="3153642">,</span>&nbsp;<span class="ident" id="3153644">state</span><span class="op" id="3153649">,</span>&nbsp;<span class="ident" id="3153651">noValue</span><span class="op" id="3153658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153661">}</span><br>
<span class="lineno">595</span><span class="op" id="3153663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3153666">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3153721">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="3153791">func</span>&nbsp;<span class="op" id="3153796">(</span><span class="ident" id="3153797">dec</span>&nbsp;<span class="op" id="3153801">*</span><span class="ident" id="3153802">Decoder</span><span class="op" id="3153809">)</span>&nbsp;<span class="ident" id="3153811">decodeSlice</span><span class="op" id="3153822">(</span><span class="ident" id="3153823">state</span>&nbsp;<span class="op" id="3153829">*</span><span class="ident" id="3153830">decoderState</span><span class="op" id="3153842">,</span>&nbsp;<span class="ident" id="3153844">value</span>&nbsp;<span class="ident" id="3153850">reflect</span><span class="op" id="3153857">.</span><span class="ident" id="3153858">Value</span><span class="op" id="3153863">,</span>&nbsp;<span class="ident" id="3153865">elemOp</span>&nbsp;<span class="ident" id="3153872">decOp</span><span class="op" id="3153877">,</span>&nbsp;<span class="ident" id="3153879">ovfl</span>&nbsp;<span class="builtintype" id="3153884">error</span><span class="op" id="3153889">,</span>&nbsp;<span class="ident" id="3153891">helper</span>&nbsp;<span class="ident" id="3153898">decHelper</span><span class="op" id="3153907">)</span>&nbsp;<span class="op" id="3153909">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153912">u</span>&nbsp;<span class="op" id="3153914">:=</span>&nbsp;<span class="ident" id="3153917">state</span><span class="op" id="3153922">.</span><span class="ident" id="3153923">decodeUint</span><span class="op" id="3153933">(</span><span class="op" id="3153934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153937">typ</span>&nbsp;<span class="op" id="3153941">:=</span>&nbsp;<span class="ident" id="3153944">value</span><span class="op" id="3153949">.</span><span class="ident" id="3153950">Type</span><span class="op" id="3153954">(</span><span class="op" id="3153955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153958">size</span>&nbsp;<span class="op" id="3153963">:=</span>&nbsp;<span class="ident" id="3153966">uint64</span><span class="op" id="3153972">(</span><span class="ident" id="3153973">typ</span><span class="op" id="3153976">.</span><span class="ident" id="3153977">Elem</span><span class="op" id="3153981">(</span><span class="op" id="3153982">)</span><span class="op" id="3153983">.</span><span class="ident" id="3153984">Size</span><span class="op" id="3153988">(</span><span class="op" id="3153989">)</span><span class="op" id="3153990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153993">nBytes</span>&nbsp;<span class="op" id="3154000">:=</span>&nbsp;<span class="ident" id="3154003">u</span>&nbsp;<span class="op" id="3154005">*</span>&nbsp;<span class="ident" id="3154007">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154013">n</span>&nbsp;<span class="op" id="3154015">:=</span>&nbsp;<span class="builtintype" id="3154018">int</span><span class="op" id="3154021">(</span><span class="ident" id="3154022">u</span><span class="op" id="3154023">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154026">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154075">if</span>&nbsp;<span class="ident" id="3154078">n</span>&nbsp;<span class="op" id="3154080">&lt;</span>&nbsp;<span class="num" id="3154082">0</span>&nbsp;<span class="op" id="3154084">||</span>&nbsp;<span class="ident" id="3154087">uint64</span><span class="op" id="3154093">(</span><span class="ident" id="3154094">n</span><span class="op" id="3154095">)</span>&nbsp;<span class="op" id="3154097">!=</span>&nbsp;<span class="ident" id="3154100">u</span>&nbsp;<span class="op" id="3154102">||</span>&nbsp;<span class="ident" id="3154105">nBytes</span>&nbsp;<span class="op" id="3154112">&gt;</span>&nbsp;<span class="ident" id="3154114">tooBig</span>&nbsp;<span class="op" id="3154121">||</span>&nbsp;<span class="op" id="3154124">(</span><span class="ident" id="3154125">size</span>&nbsp;<span class="op" id="3154130">&gt;</span>&nbsp;<span class="num" id="3154132">0</span>&nbsp;<span class="op" id="3154134">&amp;&amp;</span>&nbsp;<span class="ident" id="3154137">nBytes</span><span class="op" id="3154143">/</span><span class="ident" id="3154144">size</span>&nbsp;<span class="op" id="3154149">!=</span>&nbsp;<span class="ident" id="3154152">u</span><span class="op" id="3154153">)</span>&nbsp;<span class="op" id="3154155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154159">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154232">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154282">errorf</span><span class="op" id="3154288">(</span><span class="string" id="3154289">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="3154332">,</span>&nbsp;<span class="ident" id="3154334">typ</span><span class="op" id="3154337">.</span><span class="ident" id="3154338">Elem</span><span class="op" id="3154342">(</span><span class="op" id="3154343">)</span><span class="op" id="3154344">,</span>&nbsp;<span class="ident" id="3154346">u</span><span class="op" id="3154347">,</span>&nbsp;<span class="ident" id="3154349">size</span><span class="op" id="3154353">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154359">if</span>&nbsp;<span class="ident" id="3154362">value</span><span class="op" id="3154367">.</span><span class="ident" id="3154368">Cap</span><span class="op" id="3154371">(</span><span class="op" id="3154372">)</span>&nbsp;<span class="op" id="3154374">&lt;</span>&nbsp;<span class="ident" id="3154376">n</span>&nbsp;<span class="op" id="3154378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154382">value</span><span class="op" id="3154387">.</span><span class="ident" id="3154388">Set</span><span class="op" id="3154391">(</span><span class="ident" id="3154392">reflect</span><span class="op" id="3154399">.</span><span class="ident" id="3154400">MakeSlice</span><span class="op" id="3154409">(</span><span class="ident" id="3154410">typ</span><span class="op" id="3154413">,</span>&nbsp;<span class="ident" id="3154415">n</span><span class="op" id="3154416">,</span>&nbsp;<span class="ident" id="3154418">n</span><span class="op" id="3154419">)</span><span class="op" id="3154420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154423">}</span>&nbsp;<span class="keyword" id="3154425">else</span>&nbsp;<span class="op" id="3154430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154434">value</span><span class="op" id="3154439">.</span><span class="ident" id="3154440">Set</span><span class="op" id="3154443">(</span><span class="ident" id="3154444">value</span><span class="op" id="3154449">.</span><span class="ident" id="3154450">Slice</span><span class="op" id="3154455">(</span><span class="num" id="3154456">0</span><span class="op" id="3154457">,</span>&nbsp;<span class="ident" id="3154459">n</span><span class="op" id="3154460">)</span><span class="op" id="3154461">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154467">dec</span><span class="op" id="3154470">.</span><span class="ident" id="3154471">decodeArrayHelper</span><span class="op" id="3154488">(</span><span class="ident" id="3154489">state</span><span class="op" id="3154494">,</span>&nbsp;<span class="ident" id="3154496">value</span><span class="op" id="3154501">,</span>&nbsp;<span class="ident" id="3154503">elemOp</span><span class="op" id="3154509">,</span>&nbsp;<span class="ident" id="3154511">n</span><span class="op" id="3154512">,</span>&nbsp;<span class="ident" id="3154514">ovfl</span><span class="op" id="3154518">,</span>&nbsp;<span class="ident" id="3154520">helper</span><span class="op" id="3154526">)</span><br>
<span class="lineno"></span><span class="op" id="3154528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3154531">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="3154605">func</span>&nbsp;<span class="op" id="3154610">(</span><span class="ident" id="3154611">dec</span>&nbsp;<span class="op" id="3154615">*</span><span class="ident" id="3154616">Decoder</span><span class="op" id="3154623">)</span>&nbsp;<span class="ident" id="3154625">ignoreSlice</span><span class="op" id="3154636">(</span><span class="ident" id="3154637">state</span>&nbsp;<span class="op" id="3154643">*</span><span class="ident" id="3154644">decoderState</span><span class="op" id="3154656">,</span>&nbsp;<span class="ident" id="3154658">elemOp</span>&nbsp;<span class="ident" id="3154665">decOp</span><span class="op" id="3154670">)</span>&nbsp;<span class="op" id="3154672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154675">dec</span><span class="op" id="3154678">.</span><span class="ident" id="3154679">ignoreArrayHelper</span><span class="op" id="3154696">(</span><span class="ident" id="3154697">state</span><span class="op" id="3154702">,</span>&nbsp;<span class="ident" id="3154704">elemOp</span><span class="op" id="3154710">,</span>&nbsp;<span class="builtintype" id="3154712">int</span><span class="op" id="3154715">(</span><span class="ident" id="3154716">state</span><span class="op" id="3154721">.</span><span class="ident" id="3154722">decodeUint</span><span class="op" id="3154732">(</span><span class="op" id="3154733">)</span><span class="op" id="3154734">)</span><span class="op" id="3154735">)</span><br>
<span class="lineno"></span><span class="op" id="3154737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3154740">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="3154810">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3154888">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3154952">func</span>&nbsp;<span class="op" id="3154957">(</span><span class="ident" id="3154958">dec</span>&nbsp;<span class="op" id="3154962">*</span><span class="ident" id="3154963">Decoder</span><span class="op" id="3154970">)</span>&nbsp;<span class="ident" id="3154972">decodeInterface</span><span class="op" id="3154987">(</span><span class="ident" id="3154988">ityp</span>&nbsp;<span class="ident" id="3154993">reflect</span><span class="op" id="3155000">.</span><span class="ident" id="3155001">Type</span><span class="op" id="3155005">,</span>&nbsp;<span class="ident" id="3155007">state</span>&nbsp;<span class="op" id="3155013">*</span><span class="ident" id="3155014">decoderState</span><span class="op" id="3155026">,</span>&nbsp;<span class="ident" id="3155028">value</span>&nbsp;<span class="ident" id="3155034">reflect</span><span class="op" id="3155041">.</span><span class="ident" id="3155042">Value</span><span class="op" id="3155047">)</span>&nbsp;<span class="op" id="3155049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155052">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155092">nr</span>&nbsp;<span class="op" id="3155095">:=</span>&nbsp;<span class="ident" id="3155098">state</span><span class="op" id="3155103">.</span><span class="ident" id="3155104">decodeUint</span><span class="op" id="3155114">(</span><span class="op" id="3155115">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155118">if</span>&nbsp;<span class="ident" id="3155121">nr</span>&nbsp;<span class="op" id="3155124">&lt;</span>&nbsp;<span class="num" id="3155126">0</span>&nbsp;<span class="op" id="3155128">||</span>&nbsp;<span class="ident" id="3155131">nr</span>&nbsp;<span class="op" id="3155134">&gt;</span>&nbsp;<span class="num" id="3155136">1</span><span class="op" id="3155137">&lt;&lt;</span><span class="num" id="3155139">31</span>&nbsp;<span class="op" id="3155142">{</span>&nbsp;<span class="comment" id="3155144">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155189">errorf</span><span class="op" id="3155195">(</span><span class="string" id="3155196">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="3155225">,</span>&nbsp;<span class="ident" id="3155227">nr</span><span class="op" id="3155229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155235">if</span>&nbsp;<span class="ident" id="3155238">nr</span>&nbsp;<span class="op" id="3155241">&gt;</span>&nbsp;<span class="ident" id="3155243">uint64</span><span class="op" id="3155249">(</span><span class="ident" id="3155250">state</span><span class="op" id="3155255">.</span><span class="ident" id="3155256">b</span><span class="op" id="3155257">.</span><span class="ident" id="3155258">Len</span><span class="op" id="3155261">(</span><span class="op" id="3155262">)</span><span class="op" id="3155263">)</span>&nbsp;<span class="op" id="3155265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155269">errorf</span><span class="op" id="3155275">(</span><span class="string" id="3155276">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="3155325">,</span>&nbsp;<span class="ident" id="3155327">nr</span><span class="op" id="3155329">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155335">b</span>&nbsp;<span class="op" id="3155337">:=</span>&nbsp;<span class="builtinfunc" id="3155340">make</span><span class="op" id="3155344">(</span><span class="op" id="3155345">[</span><span class="op" id="3155346">]</span><span class="builtintype" id="3155347">byte</span><span class="op" id="3155351">,</span>&nbsp;<span class="ident" id="3155353">nr</span><span class="op" id="3155355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155358">state</span><span class="op" id="3155363">.</span><span class="ident" id="3155364">b</span><span class="op" id="3155365">.</span><span class="ident" id="3155366">Read</span><span class="op" id="3155370">(</span><span class="ident" id="3155371">b</span><span class="op" id="3155372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155375">name</span>&nbsp;<span class="op" id="3155380">:=</span>&nbsp;<span class="builtintype" id="3155383">string</span><span class="op" id="3155389">(</span><span class="ident" id="3155390">b</span><span class="op" id="3155391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155394">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155440">if</span>&nbsp;<span class="ident" id="3155443">name</span>&nbsp;<span class="op" id="3155448">==</span>&nbsp;<span class="string" id="3155451">&#34;&#34;</span>&nbsp;<span class="op" id="3155454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155458">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155507">value</span><span class="op" id="3155512">.</span><span class="ident" id="3155513">Set</span><span class="op" id="3155516">(</span><span class="ident" id="3155517">reflect</span><span class="op" id="3155524">.</span><span class="ident" id="3155525">Zero</span><span class="op" id="3155529">(</span><span class="ident" id="3155530">value</span><span class="op" id="3155535">.</span><span class="ident" id="3155536">Type</span><span class="op" id="3155540">(</span><span class="op" id="3155541">)</span><span class="op" id="3155542">)</span><span class="op" id="3155543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155547">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155555">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155558">if</span>&nbsp;<span class="builtinfunc" id="3155561">len</span><span class="op" id="3155564">(</span><span class="ident" id="3155565">name</span><span class="op" id="3155569">)</span>&nbsp;<span class="op" id="3155571">&gt;</span>&nbsp;<span class="num" id="3155573">1024</span>&nbsp;<span class="op" id="3155578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155582">errorf</span><span class="op" id="3155588">(</span><span class="string" id="3155589">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="3155625">,</span>&nbsp;<span class="builtinfunc" id="3155627">len</span><span class="op" id="3155630">(</span><span class="ident" id="3155631">name</span><span class="op" id="3155635">)</span><span class="op" id="3155636">,</span>&nbsp;<span class="ident" id="3155638">name</span><span class="op" id="3155642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155648">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155690">registerLock</span><span class="op" id="3155702">.</span><span class="ident" id="3155703">RLock</span><span class="op" id="3155708">(</span><span class="op" id="3155709">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155712">typ</span><span class="op" id="3155715">,</span>&nbsp;<span class="ident" id="3155717">ok</span>&nbsp;<span class="op" id="3155720">:=</span>&nbsp;<span class="ident" id="3155723">nameToConcreteType</span><span class="op" id="3155741">[</span><span class="ident" id="3155742">name</span><span class="op" id="3155746">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155749">registerLock</span><span class="op" id="3155761">.</span><span class="ident" id="3155762">RUnlock</span><span class="op" id="3155769">(</span><span class="op" id="3155770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155773">if</span>&nbsp;<span class="op" id="3155776">!</span><span class="ident" id="3155777">ok</span>&nbsp;<span class="op" id="3155780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155784">errorf</span><span class="op" id="3155790">(</span><span class="string" id="3155791">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="3155830">,</span>&nbsp;<span class="ident" id="3155832">name</span><span class="op" id="3155836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155839">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155842">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155886">concreteId</span>&nbsp;<span class="op" id="3155897">:=</span>&nbsp;<span class="ident" id="3155900">dec</span><span class="op" id="3155903">.</span><span class="ident" id="3155904">decodeTypeSequence</span><span class="op" id="3155922">(</span><span class="ident" id="3155923">true</span><span class="op" id="3155927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155930">if</span>&nbsp;<span class="ident" id="3155933">concreteId</span>&nbsp;<span class="op" id="3155944">&lt;</span>&nbsp;<span class="num" id="3155946">0</span>&nbsp;<span class="op" id="3155948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155952">error_</span><span class="op" id="3155958">(</span><span class="ident" id="3155959">dec</span><span class="op" id="3155962">.</span><span class="ident" id="3155963">err</span><span class="op" id="3155966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155969">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155972">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156042">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156110">state</span><span class="op" id="3156115">.</span><span class="ident" id="3156116">decodeUint</span><span class="op" id="3156126">(</span><span class="op" id="3156127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156130">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156159">v</span>&nbsp;<span class="op" id="3156161">:=</span>&nbsp;<span class="ident" id="3156164">allocValue</span><span class="op" id="3156174">(</span><span class="ident" id="3156175">typ</span><span class="op" id="3156178">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156181">dec</span><span class="op" id="3156184">.</span><span class="ident" id="3156185">decodeValue</span><span class="op" id="3156196">(</span><span class="ident" id="3156197">concreteId</span><span class="op" id="3156207">,</span>&nbsp;<span class="ident" id="3156209">v</span><span class="op" id="3156210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156213">if</span>&nbsp;<span class="ident" id="3156216">dec</span><span class="op" id="3156219">.</span><span class="ident" id="3156220">err</span>&nbsp;<span class="op" id="3156224">!=</span>&nbsp;<span class="ident" id="3156227">nil</span>&nbsp;<span class="op" id="3156231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156235">error_</span><span class="op" id="3156241">(</span><span class="ident" id="3156242">dec</span><span class="op" id="3156245">.</span><span class="ident" id="3156246">err</span><span class="op" id="3156249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156255">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156303">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156360">if</span>&nbsp;<span class="op" id="3156363">!</span><span class="ident" id="3156364">typ</span><span class="op" id="3156367">.</span><span class="ident" id="3156368">AssignableTo</span><span class="op" id="3156380">(</span><span class="ident" id="3156381">ityp</span><span class="op" id="3156385">)</span>&nbsp;<span class="op" id="3156387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156391">errorf</span><span class="op" id="3156397">(</span><span class="string" id="3156398">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3156431">,</span>&nbsp;<span class="ident" id="3156433">typ</span><span class="op" id="3156436">,</span>&nbsp;<span class="ident" id="3156438">ityp</span><span class="op" id="3156442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156448">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156492">value</span><span class="op" id="3156497">.</span><span class="ident" id="3156498">Set</span><span class="op" id="3156501">(</span><span class="ident" id="3156502">v</span><span class="op" id="3156503">)</span><br>
<span class="lineno"></span><span class="op" id="3156505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3156508">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3156589">func</span>&nbsp;<span class="op" id="3156594">(</span><span class="ident" id="3156595">dec</span>&nbsp;<span class="op" id="3156599">*</span><span class="ident" id="3156600">Decoder</span><span class="op" id="3156607">)</span>&nbsp;<span class="ident" id="3156609">ignoreInterface</span><span class="op" id="3156624">(</span><span class="ident" id="3156625">state</span>&nbsp;<span class="op" id="3156631">*</span><span class="ident" id="3156632">decoderState</span><span class="op" id="3156644">)</span>&nbsp;<span class="op" id="3156646">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156649">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156689">b</span>&nbsp;<span class="op" id="3156691">:=</span>&nbsp;<span class="builtinfunc" id="3156694">make</span><span class="op" id="3156698">(</span><span class="op" id="3156699">[</span><span class="op" id="3156700">]</span><span class="builtintype" id="3156701">byte</span><span class="op" id="3156705">,</span>&nbsp;<span class="ident" id="3156707">state</span><span class="op" id="3156712">.</span><span class="ident" id="3156713">decodeUint</span><span class="op" id="3156723">(</span><span class="op" id="3156724">)</span><span class="op" id="3156725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156728">_</span><span class="op" id="3156729">,</span>&nbsp;<span class="ident" id="3156731">err</span>&nbsp;<span class="op" id="3156735">:=</span>&nbsp;<span class="ident" id="3156738">state</span><span class="op" id="3156743">.</span><span class="ident" id="3156744">b</span><span class="op" id="3156745">.</span><span class="ident" id="3156746">Read</span><span class="op" id="3156750">(</span><span class="ident" id="3156751">b</span><span class="op" id="3156752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156755">if</span>&nbsp;<span class="ident" id="3156758">err</span>&nbsp;<span class="op" id="3156762">!=</span>&nbsp;<span class="ident" id="3156765">nil</span>&nbsp;<span class="op" id="3156769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156773">error_</span><span class="op" id="3156779">(</span><span class="ident" id="3156780">err</span><span class="op" id="3156783">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156789">id</span>&nbsp;<span class="op" id="3156792">:=</span>&nbsp;<span class="ident" id="3156795">dec</span><span class="op" id="3156798">.</span><span class="ident" id="3156799">decodeTypeSequence</span><span class="op" id="3156817">(</span><span class="ident" id="3156818">true</span><span class="op" id="3156822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156825">if</span>&nbsp;<span class="ident" id="3156828">id</span>&nbsp;<span class="op" id="3156831">&lt;</span>&nbsp;<span class="num" id="3156833">0</span>&nbsp;<span class="op" id="3156835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156839">error_</span><span class="op" id="3156845">(</span><span class="ident" id="3156846">dec</span><span class="op" id="3156849">.</span><span class="ident" id="3156850">err</span><span class="op" id="3156853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156856">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156859">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156939">state</span><span class="op" id="3156944">.</span><span class="ident" id="3156945">b</span><span class="op" id="3156946">.</span><span class="ident" id="3156947">Drop</span><span class="op" id="3156951">(</span><span class="builtintype" id="3156952">int</span><span class="op" id="3156955">(</span><span class="ident" id="3156956">state</span><span class="op" id="3156961">.</span><span class="ident" id="3156962">decodeUint</span><span class="op" id="3156972">(</span><span class="op" id="3156973">)</span><span class="op" id="3156974">)</span><span class="op" id="3156975">)</span><br>
<span class="lineno"></span><span class="op" id="3156977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3156980">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="3157057">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3157097">func</span>&nbsp;<span class="op" id="3157102">(</span><span class="ident" id="3157103">dec</span>&nbsp;<span class="op" id="3157107">*</span><span class="ident" id="3157108">Decoder</span><span class="op" id="3157115">)</span>&nbsp;<span class="ident" id="3157117">decodeGobDecoder</span><span class="op" id="3157133">(</span><span class="ident" id="3157134">ut</span>&nbsp;<span class="op" id="3157137">*</span><span class="ident" id="3157138">userTypeInfo</span><span class="op" id="3157150">,</span>&nbsp;<span class="ident" id="3157152">state</span>&nbsp;<span class="op" id="3157158">*</span><span class="ident" id="3157159">decoderState</span><span class="op" id="3157171">,</span>&nbsp;<span class="ident" id="3157173">value</span>&nbsp;<span class="ident" id="3157179">reflect</span><span class="op" id="3157186">.</span><span class="ident" id="3157187">Value</span><span class="op" id="3157192">)</span>&nbsp;<span class="op" id="3157194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157197">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157231">b</span>&nbsp;<span class="op" id="3157233">:=</span>&nbsp;<span class="builtinfunc" id="3157236">make</span><span class="op" id="3157240">(</span><span class="op" id="3157241">[</span><span class="op" id="3157242">]</span><span class="builtintype" id="3157243">byte</span><span class="op" id="3157247">,</span>&nbsp;<span class="ident" id="3157249">state</span><span class="op" id="3157254">.</span><span class="ident" id="3157255">decodeUint</span><span class="op" id="3157265">(</span><span class="op" id="3157266">)</span><span class="op" id="3157267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157270">_</span><span class="op" id="3157271">,</span>&nbsp;<span class="ident" id="3157273">err</span>&nbsp;<span class="op" id="3157277">:=</span>&nbsp;<span class="ident" id="3157280">state</span><span class="op" id="3157285">.</span><span class="ident" id="3157286">b</span><span class="op" id="3157287">.</span><span class="ident" id="3157288">Read</span><span class="op" id="3157292">(</span><span class="ident" id="3157293">b</span><span class="op" id="3157294">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157297">if</span>&nbsp;<span class="ident" id="3157300">err</span>&nbsp;<span class="op" id="3157304">!=</span>&nbsp;<span class="ident" id="3157307">nil</span>&nbsp;<span class="op" id="3157311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157315">error_</span><span class="op" id="3157321">(</span><span class="ident" id="3157322">err</span><span class="op" id="3157325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157331">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157362">switch</span>&nbsp;<span class="ident" id="3157369">ut</span><span class="op" id="3157371">.</span><span class="ident" id="3157372">externalDec</span>&nbsp;<span class="op" id="3157384">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157387">case</span>&nbsp;<span class="ident" id="3157392">xGob</span><span class="op" id="3157396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157400">err</span>&nbsp;<span class="op" id="3157404">=</span>&nbsp;<span class="ident" id="3157406">value</span><span class="op" id="3157411">.</span><span class="ident" id="3157412">Interface</span><span class="op" id="3157421">(</span><span class="op" id="3157422">)</span><span class="op" id="3157423">.</span><span class="op" id="3157424">(</span><span class="ident" id="3157425">GobDecoder</span><span class="op" id="3157435">)</span><span class="op" id="3157436">.</span><span class="ident" id="3157437">GobDecode</span><span class="op" id="3157446">(</span><span class="ident" id="3157447">b</span><span class="op" id="3157448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157451">case</span>&nbsp;<span class="ident" id="3157456">xBinary</span><span class="op" id="3157463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157467">err</span>&nbsp;<span class="op" id="3157471">=</span>&nbsp;<span class="ident" id="3157473">value</span><span class="op" id="3157478">.</span><span class="ident" id="3157479">Interface</span><span class="op" id="3157488">(</span><span class="op" id="3157489">)</span><span class="op" id="3157490">.</span><span class="op" id="3157491">(</span><span class="ident" id="3157492">encoding</span><span class="op" id="3157500">.</span><span class="ident" id="3157501">BinaryUnmarshaler</span><span class="op" id="3157518">)</span><span class="op" id="3157519">.</span><span class="ident" id="3157520">UnmarshalBinary</span><span class="op" id="3157535">(</span><span class="ident" id="3157536">b</span><span class="op" id="3157537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157540">case</span>&nbsp;<span class="ident" id="3157545">xText</span><span class="op" id="3157550">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157554">err</span>&nbsp;<span class="op" id="3157558">=</span>&nbsp;<span class="ident" id="3157560">value</span><span class="op" id="3157565">.</span><span class="ident" id="3157566">Interface</span><span class="op" id="3157575">(</span><span class="op" id="3157576">)</span><span class="op" id="3157577">.</span><span class="op" id="3157578">(</span><span class="ident" id="3157579">encoding</span><span class="op" id="3157587">.</span><span class="ident" id="3157588">TextUnmarshaler</span><span class="op" id="3157603">)</span><span class="op" id="3157604">.</span><span class="ident" id="3157605">UnmarshalText</span><span class="op" id="3157618">(</span><span class="ident" id="3157619">b</span><span class="op" id="3157620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157626">if</span>&nbsp;<span class="ident" id="3157629">err</span>&nbsp;<span class="op" id="3157633">!=</span>&nbsp;<span class="ident" id="3157636">nil</span>&nbsp;<span class="op" id="3157640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157644">error_</span><span class="op" id="3157650">(</span><span class="ident" id="3157651">err</span><span class="op" id="3157654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157657">}</span><br>
<span class="lineno">715</span><span class="op" id="3157659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3157662">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3157744">func</span>&nbsp;<span class="op" id="3157749">(</span><span class="ident" id="3157750">dec</span>&nbsp;<span class="op" id="3157754">*</span><span class="ident" id="3157755">Decoder</span><span class="op" id="3157762">)</span>&nbsp;<span class="ident" id="3157764">ignoreGobDecoder</span><span class="op" id="3157780">(</span><span class="ident" id="3157781">state</span>&nbsp;<span class="op" id="3157787">*</span><span class="ident" id="3157788">decoderState</span><span class="op" id="3157800">)</span>&nbsp;<span class="op" id="3157802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157805">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157839">b</span>&nbsp;<span class="op" id="3157841">:=</span>&nbsp;<span class="builtinfunc" id="3157844">make</span><span class="op" id="3157848">(</span><span class="op" id="3157849">[</span><span class="op" id="3157850">]</span><span class="builtintype" id="3157851">byte</span><span class="op" id="3157855">,</span>&nbsp;<span class="ident" id="3157857">state</span><span class="op" id="3157862">.</span><span class="ident" id="3157863">decodeUint</span><span class="op" id="3157873">(</span><span class="op" id="3157874">)</span><span class="op" id="3157875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157878">_</span><span class="op" id="3157879">,</span>&nbsp;<span class="ident" id="3157881">err</span>&nbsp;<span class="op" id="3157885">:=</span>&nbsp;<span class="ident" id="3157888">state</span><span class="op" id="3157893">.</span><span class="ident" id="3157894">b</span><span class="op" id="3157895">.</span><span class="ident" id="3157896">Read</span><span class="op" id="3157900">(</span><span class="ident" id="3157901">b</span><span class="op" id="3157902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157905">if</span>&nbsp;<span class="ident" id="3157908">err</span>&nbsp;<span class="op" id="3157912">!=</span>&nbsp;<span class="ident" id="3157915">nil</span>&nbsp;<span class="op" id="3157919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157923">error_</span><span class="op" id="3157929">(</span><span class="ident" id="3157930">err</span><span class="op" id="3157933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157936">}</span><br>
<span class="lineno">725</span><span class="op" id="3157938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3157941">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3157963">var</span>&nbsp;<span class="ident" id="3157967">decOpTable</span>&nbsp;<span class="op" id="3157978">=</span>&nbsp;<span class="op" id="3157980">[</span><span class="op" id="3157981">...</span><span class="op" id="3157984">]</span><span class="ident" id="3157985">decOp</span><span class="op" id="3157990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157993">reflect</span><span class="op" id="3158000">.</span><span class="ident" id="3158001">Bool</span><span class="op" id="3158005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158013">decBool</span><span class="op" id="3158020">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158023">reflect</span><span class="op" id="3158030">.</span><span class="ident" id="3158031">Int8</span><span class="op" id="3158035">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158043">decInt8</span><span class="op" id="3158050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158053">reflect</span><span class="op" id="3158060">.</span><span class="ident" id="3158061">Int16</span><span class="op" id="3158066">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158073">decInt16</span><span class="op" id="3158081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158084">reflect</span><span class="op" id="3158091">.</span><span class="ident" id="3158092">Int32</span><span class="op" id="3158097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158104">decInt32</span><span class="op" id="3158112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158115">reflect</span><span class="op" id="3158122">.</span><span class="ident" id="3158123">Int64</span><span class="op" id="3158128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158135">decInt64</span><span class="op" id="3158143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158146">reflect</span><span class="op" id="3158153">.</span><span class="ident" id="3158154">Uint8</span><span class="op" id="3158159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158166">decUint8</span><span class="op" id="3158174">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158177">reflect</span><span class="op" id="3158184">.</span><span class="ident" id="3158185">Uint16</span><span class="op" id="3158191">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158197">decUint16</span><span class="op" id="3158206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158209">reflect</span><span class="op" id="3158216">.</span><span class="ident" id="3158217">Uint32</span><span class="op" id="3158223">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158229">decUint32</span><span class="op" id="3158238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158241">reflect</span><span class="op" id="3158248">.</span><span class="ident" id="3158249">Uint64</span><span class="op" id="3158255">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158261">decUint64</span><span class="op" id="3158270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158273">reflect</span><span class="op" id="3158280">.</span><span class="ident" id="3158281">Float32</span><span class="op" id="3158288">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158293">decFloat32</span><span class="op" id="3158303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158306">reflect</span><span class="op" id="3158313">.</span><span class="ident" id="3158314">Float64</span><span class="op" id="3158321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158326">decFloat64</span><span class="op" id="3158336">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158339">reflect</span><span class="op" id="3158346">.</span><span class="ident" id="3158347">Complex64</span><span class="op" id="3158356">:</span>&nbsp;&nbsp;<span class="ident" id="3158359">decComplex64</span><span class="op" id="3158371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158374">reflect</span><span class="op" id="3158381">.</span><span class="ident" id="3158382">Complex128</span><span class="op" id="3158392">:</span>&nbsp;<span class="ident" id="3158394">decComplex128</span><span class="op" id="3158407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158410">reflect</span><span class="op" id="3158417">.</span><span class="ident" id="3158418">String</span><span class="op" id="3158424">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158430">decString</span><span class="op" id="3158439">,</span><br>
<span class="lineno"></span><span class="op" id="3158441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="3158444">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="3158513">var</span>&nbsp;<span class="ident" id="3158517">decIgnoreOpMap</span>&nbsp;<span class="op" id="3158532">=</span>&nbsp;<span class="keyword" id="3158534">map</span><span class="op" id="3158537">[</span><span class="ident" id="3158538">typeId</span><span class="op" id="3158544">]</span><span class="ident" id="3158545">decOp</span><span class="op" id="3158550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158553">tBool</span><span class="op" id="3158558">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158563">ignoreUint</span><span class="op" id="3158573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158576">tInt</span><span class="op" id="3158580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158586">ignoreUint</span><span class="op" id="3158596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158599">tUint</span><span class="op" id="3158604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158609">ignoreUint</span><span class="op" id="3158619">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158622">tFloat</span><span class="op" id="3158628">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3158632">ignoreUint</span><span class="op" id="3158642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158645">tBytes</span><span class="op" id="3158651">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3158655">ignoreUint8Array</span><span class="op" id="3158671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158674">tString</span><span class="op" id="3158681">:</span>&nbsp;&nbsp;<span class="ident" id="3158684">ignoreUint8Array</span><span class="op" id="3158700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158703">tComplex</span><span class="op" id="3158711">:</span>&nbsp;<span class="ident" id="3158713">ignoreTwoUints</span><span class="op" id="3158727">,</span><br>
<span class="lineno"></span><span class="op" id="3158729">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="3158732">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3158799">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3158837">func</span>&nbsp;<span class="op" id="3158842">(</span><span class="ident" id="3158843">dec</span>&nbsp;<span class="op" id="3158847">*</span><span class="ident" id="3158848">Decoder</span><span class="op" id="3158855">)</span>&nbsp;<span class="ident" id="3158857">decOpFor</span><span class="op" id="3158865">(</span><span class="ident" id="3158866">wireId</span>&nbsp;<span class="ident" id="3158873">typeId</span><span class="op" id="3158879">,</span>&nbsp;<span class="ident" id="3158881">rt</span>&nbsp;<span class="ident" id="3158884">reflect</span><span class="op" id="3158891">.</span><span class="ident" id="3158892">Type</span><span class="op" id="3158896">,</span>&nbsp;<span class="ident" id="3158898">name</span>&nbsp;<span class="builtintype" id="3158903">string</span><span class="op" id="3158909">,</span>&nbsp;<span class="ident" id="3158911">inProgress</span>&nbsp;<span class="keyword" id="3158922">map</span><span class="op" id="3158925">[</span><span class="ident" id="3158926">reflect</span><span class="op" id="3158933">.</span><span class="ident" id="3158934">Type</span><span class="op" id="3158938">]</span><span class="op" id="3158939">*</span><span class="ident" id="3158940">decOp</span><span class="op" id="3158945">)</span>&nbsp;<span class="op" id="3158947">*</span><span class="ident" id="3158948">decOp</span>&nbsp;<span class="op" id="3158954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158957">ut</span>&nbsp;<span class="op" id="3158960">:=</span>&nbsp;<span class="ident" id="3158963">userType</span><span class="op" id="3158971">(</span><span class="ident" id="3158972">rt</span><span class="op" id="3158974">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158977">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159057">if</span>&nbsp;<span class="ident" id="3159060">ut</span><span class="op" id="3159062">.</span><span class="ident" id="3159063">externalDec</span>&nbsp;<span class="op" id="3159075">!=</span>&nbsp;<span class="num" id="3159078">0</span>&nbsp;<span class="op" id="3159080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159084">return</span>&nbsp;<span class="ident" id="3159091">dec</span><span class="op" id="3159094">.</span><span class="ident" id="3159095">gobDecodeOpFor</span><span class="op" id="3159109">(</span><span class="ident" id="3159110">ut</span><span class="op" id="3159112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159119">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159204">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159261">if</span>&nbsp;<span class="ident" id="3159264">opPtr</span>&nbsp;<span class="op" id="3159270">:=</span>&nbsp;<span class="ident" id="3159273">inProgress</span><span class="op" id="3159283">[</span><span class="ident" id="3159284">rt</span><span class="op" id="3159286">]</span><span class="op" id="3159287">;</span>&nbsp;<span class="ident" id="3159289">opPtr</span>&nbsp;<span class="op" id="3159295">!=</span>&nbsp;<span class="ident" id="3159298">nil</span>&nbsp;<span class="op" id="3159302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159306">return</span>&nbsp;<span class="ident" id="3159313">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159320">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159323">typ</span>&nbsp;<span class="op" id="3159327">:=</span>&nbsp;<span class="ident" id="3159330">ut</span><span class="op" id="3159332">.</span><span class="ident" id="3159333">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159339">var</span>&nbsp;<span class="ident" id="3159343">op</span>&nbsp;<span class="ident" id="3159346">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159353">k</span>&nbsp;<span class="op" id="3159355">:=</span>&nbsp;<span class="ident" id="3159358">typ</span><span class="op" id="3159361">.</span><span class="ident" id="3159362">Kind</span><span class="op" id="3159366">(</span><span class="op" id="3159367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159370">if</span>&nbsp;<span class="builtintype" id="3159373">int</span><span class="op" id="3159376">(</span><span class="ident" id="3159377">k</span><span class="op" id="3159378">)</span>&nbsp;<span class="op" id="3159380">&lt;</span>&nbsp;<span class="builtinfunc" id="3159382">len</span><span class="op" id="3159385">(</span><span class="ident" id="3159386">decOpTable</span><span class="op" id="3159396">)</span>&nbsp;<span class="op" id="3159398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159402">op</span>&nbsp;<span class="op" id="3159405">=</span>&nbsp;<span class="ident" id="3159407">decOpTable</span><span class="op" id="3159417">[</span><span class="ident" id="3159418">k</span><span class="op" id="3159419">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159425">if</span>&nbsp;<span class="ident" id="3159428">op</span>&nbsp;<span class="op" id="3159431">==</span>&nbsp;<span class="ident" id="3159434">nil</span>&nbsp;<span class="op" id="3159438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159442">inProgress</span><span class="op" id="3159452">[</span><span class="ident" id="3159453">rt</span><span class="op" id="3159455">]</span>&nbsp;<span class="op" id="3159457">=</span>&nbsp;<span class="op" id="3159459">&amp;</span><span class="ident" id="3159460">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159465">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159484">switch</span>&nbsp;<span class="ident" id="3159491">t</span>&nbsp;<span class="op" id="3159493">:=</span>&nbsp;<span class="ident" id="3159496">typ</span><span class="op" id="3159499">;</span>&nbsp;<span class="ident" id="3159501">t</span><span class="op" id="3159502">.</span><span class="ident" id="3159503">Kind</span><span class="op" id="3159507">(</span><span class="op" id="3159508">)</span>&nbsp;<span class="op" id="3159510">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159514">case</span>&nbsp;<span class="ident" id="3159519">reflect</span><span class="op" id="3159526">.</span><span class="ident" id="3159527">Array</span><span class="op" id="3159532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159537">name</span>&nbsp;<span class="op" id="3159542">=</span>&nbsp;<span class="string" id="3159544">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3159558">+</span>&nbsp;<span class="ident" id="3159560">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159568">elemId</span>&nbsp;<span class="op" id="3159575">:=</span>&nbsp;<span class="ident" id="3159578">dec</span><span class="op" id="3159581">.</span><span class="ident" id="3159582">wireType</span><span class="op" id="3159590">[</span><span class="ident" id="3159591">wireId</span><span class="op" id="3159597">]</span><span class="op" id="3159598">.</span><span class="ident" id="3159599">ArrayT</span><span class="op" id="3159605">.</span><span class="ident" id="3159606">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159614">elemOp</span>&nbsp;<span class="op" id="3159621">:=</span>&nbsp;<span class="ident" id="3159624">dec</span><span class="op" id="3159627">.</span><span class="ident" id="3159628">decOpFor</span><span class="op" id="3159636">(</span><span class="ident" id="3159637">elemId</span><span class="op" id="3159643">,</span>&nbsp;<span class="ident" id="3159645">t</span><span class="op" id="3159646">.</span><span class="ident" id="3159647">Elem</span><span class="op" id="3159651">(</span><span class="op" id="3159652">)</span><span class="op" id="3159653">,</span>&nbsp;<span class="ident" id="3159655">name</span><span class="op" id="3159659">,</span>&nbsp;<span class="ident" id="3159661">inProgress</span><span class="op" id="3159671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159676">ovfl</span>&nbsp;<span class="op" id="3159681">:=</span>&nbsp;<span class="ident" id="3159684">overflow</span><span class="op" id="3159692">(</span><span class="ident" id="3159693">name</span><span class="op" id="3159697">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159702">helper</span>&nbsp;<span class="op" id="3159709">:=</span>&nbsp;<span class="ident" id="3159712">decArrayHelper</span><span class="op" id="3159726">[</span><span class="ident" id="3159727">t</span><span class="op" id="3159728">.</span><span class="ident" id="3159729">Elem</span><span class="op" id="3159733">(</span><span class="op" id="3159734">)</span><span class="op" id="3159735">.</span><span class="ident" id="3159736">Kind</span><span class="op" id="3159740">(</span><span class="op" id="3159741">)</span><span class="op" id="3159742">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159747">op</span>&nbsp;<span class="op" id="3159750">=</span>&nbsp;<span class="keyword" id="3159752">func</span><span class="op" id="3159756">(</span><span class="ident" id="3159757">i</span>&nbsp;<span class="op" id="3159759">*</span><span class="ident" id="3159760">decInstr</span><span class="op" id="3159768">,</span>&nbsp;<span class="ident" id="3159770">state</span>&nbsp;<span class="op" id="3159776">*</span><span class="ident" id="3159777">decoderState</span><span class="op" id="3159789">,</span>&nbsp;<span class="ident" id="3159791">value</span>&nbsp;<span class="ident" id="3159797">reflect</span><span class="op" id="3159804">.</span><span class="ident" id="3159805">Value</span><span class="op" id="3159810">)</span>&nbsp;<span class="op" id="3159812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159818">state</span><span class="op" id="3159823">.</span><span class="ident" id="3159824">dec</span><span class="op" id="3159827">.</span><span class="ident" id="3159828">decodeArray</span><span class="op" id="3159839">(</span><span class="ident" id="3159840">t</span><span class="op" id="3159841">,</span>&nbsp;<span class="ident" id="3159843">state</span><span class="op" id="3159848">,</span>&nbsp;<span class="ident" id="3159850">value</span><span class="op" id="3159855">,</span>&nbsp;<span class="op" id="3159857">*</span><span class="ident" id="3159858">elemOp</span><span class="op" id="3159864">,</span>&nbsp;<span class="ident" id="3159866">t</span><span class="op" id="3159867">.</span><span class="ident" id="3159868">Len</span><span class="op" id="3159871">(</span><span class="op" id="3159872">)</span><span class="op" id="3159873">,</span>&nbsp;<span class="ident" id="3159875">ovfl</span><span class="op" id="3159879">,</span>&nbsp;<span class="ident" id="3159881">helper</span><span class="op" id="3159887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159897">case</span>&nbsp;<span class="ident" id="3159902">reflect</span><span class="op" id="3159909">.</span><span class="ident" id="3159910">Map</span><span class="op" id="3159913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159918">keyId</span>&nbsp;<span class="op" id="3159924">:=</span>&nbsp;<span class="ident" id="3159927">dec</span><span class="op" id="3159930">.</span><span class="ident" id="3159931">wireType</span><span class="op" id="3159939">[</span><span class="ident" id="3159940">wireId</span><span class="op" id="3159946">]</span><span class="op" id="3159947">.</span><span class="ident" id="3159948">MapT</span><span class="op" id="3159952">.</span><span class="ident" id="3159953">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159960">elemId</span>&nbsp;<span class="op" id="3159967">:=</span>&nbsp;<span class="ident" id="3159970">dec</span><span class="op" id="3159973">.</span><span class="ident" id="3159974">wireType</span><span class="op" id="3159982">[</span><span class="ident" id="3159983">wireId</span><span class="op" id="3159989">]</span><span class="op" id="3159990">.</span><span class="ident" id="3159991">MapT</span><span class="op" id="3159995">.</span><span class="ident" id="3159996">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160004">keyOp</span>&nbsp;<span class="op" id="3160010">:=</span>&nbsp;<span class="ident" id="3160013">dec</span><span class="op" id="3160016">.</span><span class="ident" id="3160017">decOpFor</span><span class="op" id="3160025">(</span><span class="ident" id="3160026">keyId</span><span class="op" id="3160031">,</span>&nbsp;<span class="ident" id="3160033">t</span><span class="op" id="3160034">.</span><span class="ident" id="3160035">Key</span><span class="op" id="3160038">(</span><span class="op" id="3160039">)</span><span class="op" id="3160040">,</span>&nbsp;<span class="string" id="3160042">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="3160051">+</span><span class="ident" id="3160052">name</span><span class="op" id="3160056">,</span>&nbsp;<span class="ident" id="3160058">inProgress</span><span class="op" id="3160068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160073">elemOp</span>&nbsp;<span class="op" id="3160080">:=</span>&nbsp;<span class="ident" id="3160083">dec</span><span class="op" id="3160086">.</span><span class="ident" id="3160087">decOpFor</span><span class="op" id="3160095">(</span><span class="ident" id="3160096">elemId</span><span class="op" id="3160102">,</span>&nbsp;<span class="ident" id="3160104">t</span><span class="op" id="3160105">.</span><span class="ident" id="3160106">Elem</span><span class="op" id="3160110">(</span><span class="op" id="3160111">)</span><span class="op" id="3160112">,</span>&nbsp;<span class="string" id="3160114">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="3160127">+</span><span class="ident" id="3160128">name</span><span class="op" id="3160132">,</span>&nbsp;<span class="ident" id="3160134">inProgress</span><span class="op" id="3160144">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160149">ovfl</span>&nbsp;<span class="op" id="3160154">:=</span>&nbsp;<span class="ident" id="3160157">overflow</span><span class="op" id="3160165">(</span><span class="ident" id="3160166">name</span><span class="op" id="3160170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160175">op</span>&nbsp;<span class="op" id="3160178">=</span>&nbsp;<span class="keyword" id="3160180">func</span><span class="op" id="3160184">(</span><span class="ident" id="3160185">i</span>&nbsp;<span class="op" id="3160187">*</span><span class="ident" id="3160188">decInstr</span><span class="op" id="3160196">,</span>&nbsp;<span class="ident" id="3160198">state</span>&nbsp;<span class="op" id="3160204">*</span><span class="ident" id="3160205">decoderState</span><span class="op" id="3160217">,</span>&nbsp;<span class="ident" id="3160219">value</span>&nbsp;<span class="ident" id="3160225">reflect</span><span class="op" id="3160232">.</span><span class="ident" id="3160233">Value</span><span class="op" id="3160238">)</span>&nbsp;<span class="op" id="3160240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160246">state</span><span class="op" id="3160251">.</span><span class="ident" id="3160252">dec</span><span class="op" id="3160255">.</span><span class="ident" id="3160256">decodeMap</span><span class="op" id="3160265">(</span><span class="ident" id="3160266">t</span><span class="op" id="3160267">,</span>&nbsp;<span class="ident" id="3160269">state</span><span class="op" id="3160274">,</span>&nbsp;<span class="ident" id="3160276">value</span><span class="op" id="3160281">,</span>&nbsp;<span class="op" id="3160283">*</span><span class="ident" id="3160284">keyOp</span><span class="op" id="3160289">,</span>&nbsp;<span class="op" id="3160291">*</span><span class="ident" id="3160292">elemOp</span><span class="op" id="3160298">,</span>&nbsp;<span class="ident" id="3160300">ovfl</span><span class="op" id="3160304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160314">case</span>&nbsp;<span class="ident" id="3160319">reflect</span><span class="op" id="3160326">.</span><span class="ident" id="3160327">Slice</span><span class="op" id="3160332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160337">name</span>&nbsp;<span class="op" id="3160342">=</span>&nbsp;<span class="string" id="3160344">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3160358">+</span>&nbsp;<span class="ident" id="3160360">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160368">if</span>&nbsp;<span class="ident" id="3160371">t</span><span class="op" id="3160372">.</span><span class="ident" id="3160373">Elem</span><span class="op" id="3160377">(</span><span class="op" id="3160378">)</span><span class="op" id="3160379">.</span><span class="ident" id="3160380">Kind</span><span class="op" id="3160384">(</span><span class="op" id="3160385">)</span>&nbsp;<span class="op" id="3160387">==</span>&nbsp;<span class="ident" id="3160390">reflect</span><span class="op" id="3160397">.</span><span class="ident" id="3160398">Uint8</span>&nbsp;<span class="op" id="3160404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160410">op</span>&nbsp;<span class="op" id="3160413">=</span>&nbsp;<span class="ident" id="3160415">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160433">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160447">var</span>&nbsp;<span class="ident" id="3160451">elemId</span>&nbsp;<span class="ident" id="3160458">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160468">if</span>&nbsp;<span class="ident" id="3160471">tt</span><span class="op" id="3160473">,</span>&nbsp;<span class="ident" id="3160475">ok</span>&nbsp;<span class="op" id="3160478">:=</span>&nbsp;<span class="ident" id="3160481">builtinIdToType</span><span class="op" id="3160496">[</span><span class="ident" id="3160497">wireId</span><span class="op" id="3160503">]</span><span class="op" id="3160504">;</span>&nbsp;<span class="ident" id="3160506">ok</span>&nbsp;<span class="op" id="3160509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160515">elemId</span>&nbsp;<span class="op" id="3160522">=</span>&nbsp;<span class="ident" id="3160524">tt</span><span class="op" id="3160526">.</span><span class="op" id="3160527">(</span><span class="op" id="3160528">*</span><span class="ident" id="3160529">sliceType</span><span class="op" id="3160538">)</span><span class="op" id="3160539">.</span><span class="ident" id="3160540">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160548">}</span>&nbsp;<span class="keyword" id="3160550">else</span>&nbsp;<span class="op" id="3160555">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160561">elemId</span>&nbsp;<span class="op" id="3160568">=</span>&nbsp;<span class="ident" id="3160570">dec</span><span class="op" id="3160573">.</span><span class="ident" id="3160574">wireType</span><span class="op" id="3160582">[</span><span class="ident" id="3160583">wireId</span><span class="op" id="3160589">]</span><span class="op" id="3160590">.</span><span class="ident" id="3160591">SliceT</span><span class="op" id="3160597">.</span><span class="ident" id="3160598">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160611">elemOp</span>&nbsp;<span class="op" id="3160618">:=</span>&nbsp;<span class="ident" id="3160621">dec</span><span class="op" id="3160624">.</span><span class="ident" id="3160625">decOpFor</span><span class="op" id="3160633">(</span><span class="ident" id="3160634">elemId</span><span class="op" id="3160640">,</span>&nbsp;<span class="ident" id="3160642">t</span><span class="op" id="3160643">.</span><span class="ident" id="3160644">Elem</span><span class="op" id="3160648">(</span><span class="op" id="3160649">)</span><span class="op" id="3160650">,</span>&nbsp;<span class="ident" id="3160652">name</span><span class="op" id="3160656">,</span>&nbsp;<span class="ident" id="3160658">inProgress</span><span class="op" id="3160668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160673">ovfl</span>&nbsp;<span class="op" id="3160678">:=</span>&nbsp;<span class="ident" id="3160681">overflow</span><span class="op" id="3160689">(</span><span class="ident" id="3160690">name</span><span class="op" id="3160694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160699">helper</span>&nbsp;<span class="op" id="3160706">:=</span>&nbsp;<span class="ident" id="3160709">decSliceHelper</span><span class="op" id="3160723">[</span><span class="ident" id="3160724">t</span><span class="op" id="3160725">.</span><span class="ident" id="3160726">Elem</span><span class="op" id="3160730">(</span><span class="op" id="3160731">)</span><span class="op" id="3160732">.</span><span class="ident" id="3160733">Kind</span><span class="op" id="3160737">(</span><span class="op" id="3160738">)</span><span class="op" id="3160739">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160744">op</span>&nbsp;<span class="op" id="3160747">=</span>&nbsp;<span class="keyword" id="3160749">func</span><span class="op" id="3160753">(</span><span class="ident" id="3160754">i</span>&nbsp;<span class="op" id="3160756">*</span><span class="ident" id="3160757">decInstr</span><span class="op" id="3160765">,</span>&nbsp;<span class="ident" id="3160767">state</span>&nbsp;<span class="op" id="3160773">*</span><span class="ident" id="3160774">decoderState</span><span class="op" id="3160786">,</span>&nbsp;<span class="ident" id="3160788">value</span>&nbsp;<span class="ident" id="3160794">reflect</span><span class="op" id="3160801">.</span><span class="ident" id="3160802">Value</span><span class="op" id="3160807">)</span>&nbsp;<span class="op" id="3160809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160815">state</span><span class="op" id="3160820">.</span><span class="ident" id="3160821">dec</span><span class="op" id="3160824">.</span><span class="ident" id="3160825">decodeSlice</span><span class="op" id="3160836">(</span><span class="ident" id="3160837">state</span><span class="op" id="3160842">,</span>&nbsp;<span class="ident" id="3160844">value</span><span class="op" id="3160849">,</span>&nbsp;<span class="op" id="3160851">*</span><span class="ident" id="3160852">elemOp</span><span class="op" id="3160858">,</span>&nbsp;<span class="ident" id="3160860">ovfl</span><span class="op" id="3160864">,</span>&nbsp;<span class="ident" id="3160866">helper</span><span class="op" id="3160872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160882">case</span>&nbsp;<span class="ident" id="3160887">reflect</span><span class="op" id="3160894">.</span><span class="ident" id="3160895">Struct</span><span class="op" id="3160901">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3160906">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160981">ut</span>&nbsp;<span class="op" id="3160984">:=</span>&nbsp;<span class="ident" id="3160987">userType</span><span class="op" id="3160995">(</span><span class="ident" id="3160996">typ</span><span class="op" id="3160999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161004">enginePtr</span><span class="op" id="3161013">,</span>&nbsp;<span class="ident" id="3161015">err</span>&nbsp;<span class="op" id="3161019">:=</span>&nbsp;<span class="ident" id="3161022">dec</span><span class="op" id="3161025">.</span><span class="ident" id="3161026">getDecEnginePtr</span><span class="op" id="3161041">(</span><span class="ident" id="3161042">wireId</span><span class="op" id="3161048">,</span>&nbsp;<span class="ident" id="3161050">ut</span><span class="op" id="3161052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161057">if</span>&nbsp;<span class="ident" id="3161060">err</span>&nbsp;<span class="op" id="3161064">!=</span>&nbsp;<span class="ident" id="3161067">nil</span>&nbsp;<span class="op" id="3161071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161077">error_</span><span class="op" id="3161083">(</span><span class="ident" id="3161084">err</span><span class="op" id="3161087">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161097">op</span>&nbsp;<span class="op" id="3161100">=</span>&nbsp;<span class="keyword" id="3161102">func</span><span class="op" id="3161106">(</span><span class="ident" id="3161107">i</span>&nbsp;<span class="op" id="3161109">*</span><span class="ident" id="3161110">decInstr</span><span class="op" id="3161118">,</span>&nbsp;<span class="ident" id="3161120">state</span>&nbsp;<span class="op" id="3161126">*</span><span class="ident" id="3161127">decoderState</span><span class="op" id="3161139">,</span>&nbsp;<span class="ident" id="3161141">value</span>&nbsp;<span class="ident" id="3161147">reflect</span><span class="op" id="3161154">.</span><span class="ident" id="3161155">Value</span><span class="op" id="3161160">)</span>&nbsp;<span class="op" id="3161162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161168">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161245">dec</span><span class="op" id="3161248">.</span><span class="ident" id="3161249">decodeStruct</span><span class="op" id="3161261">(</span><span class="op" id="3161262">*</span><span class="ident" id="3161263">enginePtr</span><span class="op" id="3161272">,</span>&nbsp;<span class="ident" id="3161274">ut</span><span class="op" id="3161276">,</span>&nbsp;<span class="ident" id="3161278">value</span><span class="op" id="3161283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161288">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161292">case</span>&nbsp;<span class="ident" id="3161297">reflect</span><span class="op" id="3161304">.</span><span class="ident" id="3161305">Interface</span><span class="op" id="3161314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161319">op</span>&nbsp;<span class="op" id="3161322">=</span>&nbsp;<span class="keyword" id="3161324">func</span><span class="op" id="3161328">(</span><span class="ident" id="3161329">i</span>&nbsp;<span class="op" id="3161331">*</span><span class="ident" id="3161332">decInstr</span><span class="op" id="3161340">,</span>&nbsp;<span class="ident" id="3161342">state</span>&nbsp;<span class="op" id="3161348">*</span><span class="ident" id="3161349">decoderState</span><span class="op" id="3161361">,</span>&nbsp;<span class="ident" id="3161363">value</span>&nbsp;<span class="ident" id="3161369">reflect</span><span class="op" id="3161376">.</span><span class="ident" id="3161377">Value</span><span class="op" id="3161382">)</span>&nbsp;<span class="op" id="3161384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161390">state</span><span class="op" id="3161395">.</span><span class="ident" id="3161396">dec</span><span class="op" id="3161399">.</span><span class="ident" id="3161400">decodeInterface</span><span class="op" id="3161415">(</span><span class="ident" id="3161416">t</span><span class="op" id="3161417">,</span>&nbsp;<span class="ident" id="3161419">state</span><span class="op" id="3161424">,</span>&nbsp;<span class="ident" id="3161426">value</span><span class="op" id="3161431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161440">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161446">if</span>&nbsp;<span class="ident" id="3161449">op</span>&nbsp;<span class="op" id="3161452">==</span>&nbsp;<span class="ident" id="3161455">nil</span>&nbsp;<span class="op" id="3161459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161463">errorf</span><span class="op" id="3161469">(</span><span class="string" id="3161470">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3161499">,</span>&nbsp;<span class="ident" id="3161501">rt</span><span class="op" id="3161503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161509">return</span>&nbsp;<span class="op" id="3161516">&amp;</span><span class="ident" id="3161517">op</span><br>
<span class="lineno">840</span><span class="op" id="3161520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3161523">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3161602">func</span>&nbsp;<span class="op" id="3161607">(</span><span class="ident" id="3161608">dec</span>&nbsp;<span class="op" id="3161612">*</span><span class="ident" id="3161613">Decoder</span><span class="op" id="3161620">)</span>&nbsp;<span class="ident" id="3161622">decIgnoreOpFor</span><span class="op" id="3161636">(</span><span class="ident" id="3161637">wireId</span>&nbsp;<span class="ident" id="3161644">typeId</span><span class="op" id="3161650">)</span>&nbsp;<span class="ident" id="3161652">decOp</span>&nbsp;<span class="op" id="3161658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161661">op</span><span class="op" id="3161663">,</span>&nbsp;<span class="ident" id="3161665">ok</span>&nbsp;<span class="op" id="3161668">:=</span>&nbsp;<span class="ident" id="3161671">decIgnoreOpMap</span><span class="op" id="3161685">[</span><span class="ident" id="3161686">wireId</span><span class="op" id="3161692">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161695">if</span>&nbsp;<span class="op" id="3161698">!</span><span class="ident" id="3161699">ok</span>&nbsp;<span class="op" id="3161702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161706">if</span>&nbsp;<span class="ident" id="3161709">wireId</span>&nbsp;<span class="op" id="3161716">==</span>&nbsp;<span class="ident" id="3161719">tInterface</span>&nbsp;<span class="op" id="3161730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161735">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161800">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161869">op</span>&nbsp;<span class="op" id="3161872">=</span>&nbsp;<span class="keyword" id="3161874">func</span><span class="op" id="3161878">(</span><span class="ident" id="3161879">i</span>&nbsp;<span class="op" id="3161881">*</span><span class="ident" id="3161882">decInstr</span><span class="op" id="3161890">,</span>&nbsp;<span class="ident" id="3161892">state</span>&nbsp;<span class="op" id="3161898">*</span><span class="ident" id="3161899">decoderState</span><span class="op" id="3161911">,</span>&nbsp;<span class="ident" id="3161913">value</span>&nbsp;<span class="ident" id="3161919">reflect</span><span class="op" id="3161926">.</span><span class="ident" id="3161927">Value</span><span class="op" id="3161932">)</span>&nbsp;<span class="op" id="3161934">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161940">state</span><span class="op" id="3161945">.</span><span class="ident" id="3161946">dec</span><span class="op" id="3161949">.</span><span class="ident" id="3161950">ignoreInterface</span><span class="op" id="3161965">(</span><span class="ident" id="3161966">state</span><span class="op" id="3161971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161981">return</span>&nbsp;<span class="ident" id="3161988">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161997">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162016">wire</span>&nbsp;<span class="op" id="3162021">:=</span>&nbsp;<span class="ident" id="3162024">dec</span><span class="op" id="3162027">.</span><span class="ident" id="3162028">wireType</span><span class="op" id="3162036">[</span><span class="ident" id="3162037">wireId</span><span class="op" id="3162043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162047">switch</span>&nbsp;<span class="op" id="3162054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162058">case</span>&nbsp;<span class="ident" id="3162063">wire</span>&nbsp;<span class="op" id="3162068">==</span>&nbsp;<span class="ident" id="3162071">nil</span><span class="op" id="3162074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162079">errorf</span><span class="op" id="3162085">(</span><span class="string" id="3162086">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3162115">,</span>&nbsp;<span class="ident" id="3162117">wireId</span><span class="op" id="3162123">.</span><span class="builtintype" id="3162124">string</span><span class="op" id="3162130">(</span><span class="op" id="3162131">)</span><span class="op" id="3162132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162136">case</span>&nbsp;<span class="ident" id="3162141">wire</span><span class="op" id="3162145">.</span><span class="ident" id="3162146">ArrayT</span>&nbsp;<span class="op" id="3162153">!=</span>&nbsp;<span class="ident" id="3162156">nil</span><span class="op" id="3162159">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162164">elemId</span>&nbsp;<span class="op" id="3162171">:=</span>&nbsp;<span class="ident" id="3162174">wire</span><span class="op" id="3162178">.</span><span class="ident" id="3162179">ArrayT</span><span class="op" id="3162185">.</span><span class="ident" id="3162186">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162194">elemOp</span>&nbsp;<span class="op" id="3162201">:=</span>&nbsp;<span class="ident" id="3162204">dec</span><span class="op" id="3162207">.</span><span class="ident" id="3162208">decIgnoreOpFor</span><span class="op" id="3162222">(</span><span class="ident" id="3162223">elemId</span><span class="op" id="3162229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162234">op</span>&nbsp;<span class="op" id="3162237">=</span>&nbsp;<span class="keyword" id="3162239">func</span><span class="op" id="3162243">(</span><span class="ident" id="3162244">i</span>&nbsp;<span class="op" id="3162246">*</span><span class="ident" id="3162247">decInstr</span><span class="op" id="3162255">,</span>&nbsp;<span class="ident" id="3162257">state</span>&nbsp;<span class="op" id="3162263">*</span><span class="ident" id="3162264">decoderState</span><span class="op" id="3162276">,</span>&nbsp;<span class="ident" id="3162278">value</span>&nbsp;<span class="ident" id="3162284">reflect</span><span class="op" id="3162291">.</span><span class="ident" id="3162292">Value</span><span class="op" id="3162297">)</span>&nbsp;<span class="op" id="3162299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162305">state</span><span class="op" id="3162310">.</span><span class="ident" id="3162311">dec</span><span class="op" id="3162314">.</span><span class="ident" id="3162315">ignoreArray</span><span class="op" id="3162326">(</span><span class="ident" id="3162327">state</span><span class="op" id="3162332">,</span>&nbsp;<span class="ident" id="3162334">elemOp</span><span class="op" id="3162340">,</span>&nbsp;<span class="ident" id="3162342">wire</span><span class="op" id="3162346">.</span><span class="ident" id="3162347">ArrayT</span><span class="op" id="3162353">.</span><span class="ident" id="3162354">Len</span><span class="op" id="3162357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162362">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162367">case</span>&nbsp;<span class="ident" id="3162372">wire</span><span class="op" id="3162376">.</span><span class="ident" id="3162377">MapT</span>&nbsp;<span class="op" id="3162382">!=</span>&nbsp;<span class="ident" id="3162385">nil</span><span class="op" id="3162388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162393">keyId</span>&nbsp;<span class="op" id="3162399">:=</span>&nbsp;<span class="ident" id="3162402">dec</span><span class="op" id="3162405">.</span><span class="ident" id="3162406">wireType</span><span class="op" id="3162414">[</span><span class="ident" id="3162415">wireId</span><span class="op" id="3162421">]</span><span class="op" id="3162422">.</span><span class="ident" id="3162423">MapT</span><span class="op" id="3162427">.</span><span class="ident" id="3162428">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162435">elemId</span>&nbsp;<span class="op" id="3162442">:=</span>&nbsp;<span class="ident" id="3162445">dec</span><span class="op" id="3162448">.</span><span class="ident" id="3162449">wireType</span><span class="op" id="3162457">[</span><span class="ident" id="3162458">wireId</span><span class="op" id="3162464">]</span><span class="op" id="3162465">.</span><span class="ident" id="3162466">MapT</span><span class="op" id="3162470">.</span><span class="ident" id="3162471">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162479">keyOp</span>&nbsp;<span class="op" id="3162485">:=</span>&nbsp;<span class="ident" id="3162488">dec</span><span class="op" id="3162491">.</span><span class="ident" id="3162492">decIgnoreOpFor</span><span class="op" id="3162506">(</span><span class="ident" id="3162507">keyId</span><span class="op" id="3162512">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162517">elemOp</span>&nbsp;<span class="op" id="3162524">:=</span>&nbsp;<span class="ident" id="3162527">dec</span><span class="op" id="3162530">.</span><span class="ident" id="3162531">decIgnoreOpFor</span><span class="op" id="3162545">(</span><span class="ident" id="3162546">elemId</span><span class="op" id="3162552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162557">op</span>&nbsp;<span class="op" id="3162560">=</span>&nbsp;<span class="keyword" id="3162562">func</span><span class="op" id="3162566">(</span><span class="ident" id="3162567">i</span>&nbsp;<span class="op" id="3162569">*</span><span class="ident" id="3162570">decInstr</span><span class="op" id="3162578">,</span>&nbsp;<span class="ident" id="3162580">state</span>&nbsp;<span class="op" id="3162586">*</span><span class="ident" id="3162587">decoderState</span><span class="op" id="3162599">,</span>&nbsp;<span class="ident" id="3162601">value</span>&nbsp;<span class="ident" id="3162607">reflect</span><span class="op" id="3162614">.</span><span class="ident" id="3162615">Value</span><span class="op" id="3162620">)</span>&nbsp;<span class="op" id="3162622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162628">state</span><span class="op" id="3162633">.</span><span class="ident" id="3162634">dec</span><span class="op" id="3162637">.</span><span class="ident" id="3162638">ignoreMap</span><span class="op" id="3162647">(</span><span class="ident" id="3162648">state</span><span class="op" id="3162653">,</span>&nbsp;<span class="ident" id="3162655">keyOp</span><span class="op" id="3162660">,</span>&nbsp;<span class="ident" id="3162662">elemOp</span><span class="op" id="3162668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162678">case</span>&nbsp;<span class="ident" id="3162683">wire</span><span class="op" id="3162687">.</span><span class="ident" id="3162688">SliceT</span>&nbsp;<span class="op" id="3162695">!=</span>&nbsp;<span class="ident" id="3162698">nil</span><span class="op" id="3162701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162706">elemId</span>&nbsp;<span class="op" id="3162713">:=</span>&nbsp;<span class="ident" id="3162716">wire</span><span class="op" id="3162720">.</span><span class="ident" id="3162721">SliceT</span><span class="op" id="3162727">.</span><span class="ident" id="3162728">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162736">elemOp</span>&nbsp;<span class="op" id="3162743">:=</span>&nbsp;<span class="ident" id="3162746">dec</span><span class="op" id="3162749">.</span><span class="ident" id="3162750">decIgnoreOpFor</span><span class="op" id="3162764">(</span><span class="ident" id="3162765">elemId</span><span class="op" id="3162771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162776">op</span>&nbsp;<span class="op" id="3162779">=</span>&nbsp;<span class="keyword" id="3162781">func</span><span class="op" id="3162785">(</span><span class="ident" id="3162786">i</span>&nbsp;<span class="op" id="3162788">*</span><span class="ident" id="3162789">decInstr</span><span class="op" id="3162797">,</span>&nbsp;<span class="ident" id="3162799">state</span>&nbsp;<span class="op" id="3162805">*</span><span class="ident" id="3162806">decoderState</span><span class="op" id="3162818">,</span>&nbsp;<span class="ident" id="3162820">value</span>&nbsp;<span class="ident" id="3162826">reflect</span><span class="op" id="3162833">.</span><span class="ident" id="3162834">Value</span><span class="op" id="3162839">)</span>&nbsp;<span class="op" id="3162841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162847">state</span><span class="op" id="3162852">.</span><span class="ident" id="3162853">dec</span><span class="op" id="3162856">.</span><span class="ident" id="3162857">ignoreSlice</span><span class="op" id="3162868">(</span><span class="ident" id="3162869">state</span><span class="op" id="3162874">,</span>&nbsp;<span class="ident" id="3162876">elemOp</span><span class="op" id="3162882">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162892">case</span>&nbsp;<span class="ident" id="3162897">wire</span><span class="op" id="3162901">.</span><span class="ident" id="3162902">StructT</span>&nbsp;<span class="op" id="3162910">!=</span>&nbsp;<span class="ident" id="3162913">nil</span><span class="op" id="3162916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162921">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162996">enginePtr</span><span class="op" id="3163005">,</span>&nbsp;<span class="ident" id="3163007">err</span>&nbsp;<span class="op" id="3163011">:=</span>&nbsp;<span class="ident" id="3163014">dec</span><span class="op" id="3163017">.</span><span class="ident" id="3163018">getIgnoreEnginePtr</span><span class="op" id="3163036">(</span><span class="ident" id="3163037">wireId</span><span class="op" id="3163043">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163048">if</span>&nbsp;<span class="ident" id="3163051">err</span>&nbsp;<span class="op" id="3163055">!=</span>&nbsp;<span class="ident" id="3163058">nil</span>&nbsp;<span class="op" id="3163062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163068">error_</span><span class="op" id="3163074">(</span><span class="ident" id="3163075">err</span><span class="op" id="3163078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163088">op</span>&nbsp;<span class="op" id="3163091">=</span>&nbsp;<span class="keyword" id="3163093">func</span><span class="op" id="3163097">(</span><span class="ident" id="3163098">i</span>&nbsp;<span class="op" id="3163100">*</span><span class="ident" id="3163101">decInstr</span><span class="op" id="3163109">,</span>&nbsp;<span class="ident" id="3163111">state</span>&nbsp;<span class="op" id="3163117">*</span><span class="ident" id="3163118">decoderState</span><span class="op" id="3163130">,</span>&nbsp;<span class="ident" id="3163132">value</span>&nbsp;<span class="ident" id="3163138">reflect</span><span class="op" id="3163145">.</span><span class="ident" id="3163146">Value</span><span class="op" id="3163151">)</span>&nbsp;<span class="op" id="3163153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163159">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163235">state</span><span class="op" id="3163240">.</span><span class="ident" id="3163241">dec</span><span class="op" id="3163244">.</span><span class="ident" id="3163245">ignoreStruct</span><span class="op" id="3163257">(</span><span class="op" id="3163258">*</span><span class="ident" id="3163259">enginePtr</span><span class="op" id="3163268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163278">case</span>&nbsp;<span class="ident" id="3163283">wire</span><span class="op" id="3163287">.</span><span class="ident" id="3163288">GobEncoderT</span>&nbsp;<span class="op" id="3163300">!=</span>&nbsp;<span class="ident" id="3163303">nil</span><span class="op" id="3163306">,</span>&nbsp;<span class="ident" id="3163308">wire</span><span class="op" id="3163312">.</span><span class="ident" id="3163313">BinaryMarshalerT</span>&nbsp;<span class="op" id="3163330">!=</span>&nbsp;<span class="ident" id="3163333">nil</span><span class="op" id="3163336">,</span>&nbsp;<span class="ident" id="3163338">wire</span><span class="op" id="3163342">.</span><span class="ident" id="3163343">TextMarshalerT</span>&nbsp;<span class="op" id="3163358">!=</span>&nbsp;<span class="ident" id="3163361">nil</span><span class="op" id="3163364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163369">op</span>&nbsp;<span class="op" id="3163372">=</span>&nbsp;<span class="keyword" id="3163374">func</span><span class="op" id="3163378">(</span><span class="ident" id="3163379">i</span>&nbsp;<span class="op" id="3163381">*</span><span class="ident" id="3163382">decInstr</span><span class="op" id="3163390">,</span>&nbsp;<span class="ident" id="3163392">state</span>&nbsp;<span class="op" id="3163398">*</span><span class="ident" id="3163399">decoderState</span><span class="op" id="3163411">,</span>&nbsp;<span class="ident" id="3163413">value</span>&nbsp;<span class="ident" id="3163419">reflect</span><span class="op" id="3163426">.</span><span class="ident" id="3163427">Value</span><span class="op" id="3163432">)</span>&nbsp;<span class="op" id="3163434">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163440">state</span><span class="op" id="3163445">.</span><span class="ident" id="3163446">dec</span><span class="op" id="3163449">.</span><span class="ident" id="3163450">ignoreGobDecoder</span><span class="op" id="3163466">(</span><span class="ident" id="3163467">state</span><span class="op" id="3163472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163487">if</span>&nbsp;<span class="ident" id="3163490">op</span>&nbsp;<span class="op" id="3163493">==</span>&nbsp;<span class="ident" id="3163496">nil</span>&nbsp;<span class="op" id="3163500">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163504">errorf</span><span class="op" id="3163510">(</span><span class="string" id="3163511">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3163550">,</span>&nbsp;<span class="ident" id="3163552">wireId</span><span class="op" id="3163558">.</span><span class="builtintype" id="3163559">string</span><span class="op" id="3163565">(</span><span class="op" id="3163566">)</span><span class="op" id="3163567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163573">return</span>&nbsp;<span class="ident" id="3163580">op</span><br>
<span class="lineno"></span><span class="op" id="3163583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3163586">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="3163657">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3163672">func</span>&nbsp;<span class="op" id="3163677">(</span><span class="ident" id="3163678">dec</span>&nbsp;<span class="op" id="3163682">*</span><span class="ident" id="3163683">Decoder</span><span class="op" id="3163690">)</span>&nbsp;<span class="ident" id="3163692">gobDecodeOpFor</span><span class="op" id="3163706">(</span><span class="ident" id="3163707">ut</span>&nbsp;<span class="op" id="3163710">*</span><span class="ident" id="3163711">userTypeInfo</span><span class="op" id="3163723">)</span>&nbsp;<span class="op" id="3163725">*</span><span class="ident" id="3163726">decOp</span>&nbsp;<span class="op" id="3163732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163735">rcvrType</span>&nbsp;<span class="op" id="3163744">:=</span>&nbsp;<span class="ident" id="3163747">ut</span><span class="op" id="3163749">.</span><span class="ident" id="3163750">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163756">if</span>&nbsp;<span class="ident" id="3163759">ut</span><span class="op" id="3163761">.</span><span class="ident" id="3163762">decIndir</span>&nbsp;<span class="op" id="3163771">==</span>&nbsp;<span class="op" id="3163774">-</span><span class="num" id="3163775">1</span>&nbsp;<span class="op" id="3163777">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163781">rcvrType</span>&nbsp;<span class="op" id="3163790">=</span>&nbsp;<span class="ident" id="3163792">reflect</span><span class="op" id="3163799">.</span><span class="ident" id="3163800">PtrTo</span><span class="op" id="3163805">(</span><span class="ident" id="3163806">rcvrType</span><span class="op" id="3163814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163817">}</span>&nbsp;<span class="keyword" id="3163819">else</span>&nbsp;<span class="keyword" id="3163824">if</span>&nbsp;<span class="ident" id="3163827">ut</span><span class="op" id="3163829">.</span><span class="ident" id="3163830">decIndir</span>&nbsp;<span class="op" id="3163839">&gt;</span>&nbsp;<span class="num" id="3163841">0</span>&nbsp;<span class="op" id="3163843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163847">for</span>&nbsp;<span class="ident" id="3163851">i</span>&nbsp;<span class="op" id="3163853">:=</span>&nbsp;<span class="builtintype" id="3163856">int8</span><span class="op" id="3163860">(</span><span class="num" id="3163861">0</span><span class="op" id="3163862">)</span><span class="op" id="3163863">;</span>&nbsp;<span class="ident" id="3163865">i</span>&nbsp;<span class="op" id="3163867">&lt;</span>&nbsp;<span class="ident" id="3163869">ut</span><span class="op" id="3163871">.</span><span class="ident" id="3163872">decIndir</span><span class="op" id="3163880">;</span>&nbsp;<span class="ident" id="3163882">i</span><span class="op" id="3163883">++</span>&nbsp;<span class="op" id="3163886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163891">rcvrType</span>&nbsp;<span class="op" id="3163900">=</span>&nbsp;<span class="ident" id="3163902">rcvrType</span><span class="op" id="3163910">.</span><span class="ident" id="3163911">Elem</span><span class="op" id="3163915">(</span><span class="op" id="3163916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163920">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163926">var</span>&nbsp;<span class="ident" id="3163930">op</span>&nbsp;<span class="ident" id="3163933">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163940">op</span>&nbsp;<span class="op" id="3163943">=</span>&nbsp;<span class="keyword" id="3163945">func</span><span class="op" id="3163949">(</span><span class="ident" id="3163950">i</span>&nbsp;<span class="op" id="3163952">*</span><span class="ident" id="3163953">decInstr</span><span class="op" id="3163961">,</span>&nbsp;<span class="ident" id="3163963">state</span>&nbsp;<span class="op" id="3163969">*</span><span class="ident" id="3163970">decoderState</span><span class="op" id="3163982">,</span>&nbsp;<span class="ident" id="3163984">value</span>&nbsp;<span class="ident" id="3163990">reflect</span><span class="op" id="3163997">.</span><span class="ident" id="3163998">Value</span><span class="op" id="3164003">)</span>&nbsp;<span class="op" id="3164005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164009">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164091">if</span>&nbsp;<span class="ident" id="3164094">value</span><span class="op" id="3164099">.</span><span class="ident" id="3164100">Kind</span><span class="op" id="3164104">(</span><span class="op" id="3164105">)</span>&nbsp;<span class="op" id="3164107">!=</span>&nbsp;<span class="ident" id="3164110">reflect</span><span class="op" id="3164117">.</span><span class="ident" id="3164118">Ptr</span>&nbsp;<span class="op" id="3164122">&amp;&amp;</span>&nbsp;<span class="ident" id="3164125">rcvrType</span><span class="op" id="3164133">.</span><span class="ident" id="3164134">Kind</span><span class="op" id="3164138">(</span><span class="op" id="3164139">)</span>&nbsp;<span class="op" id="3164141">==</span>&nbsp;<span class="ident" id="3164144">reflect</span><span class="op" id="3164151">.</span><span class="ident" id="3164152">Ptr</span>&nbsp;<span class="op" id="3164156">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164161">value</span>&nbsp;<span class="op" id="3164167">=</span>&nbsp;<span class="ident" id="3164169">value</span><span class="op" id="3164174">.</span><span class="ident" id="3164175">Addr</span><span class="op" id="3164179">(</span><span class="op" id="3164180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164188">state</span><span class="op" id="3164193">.</span><span class="ident" id="3164194">dec</span><span class="op" id="3164197">.</span><span class="ident" id="3164198">decodeGobDecoder</span><span class="op" id="3164214">(</span><span class="ident" id="3164215">ut</span><span class="op" id="3164217">,</span>&nbsp;<span class="ident" id="3164219">state</span><span class="op" id="3164224">,</span>&nbsp;<span class="ident" id="3164226">value</span><span class="op" id="3164231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164237">return</span>&nbsp;<span class="op" id="3164244">&amp;</span><span class="ident" id="3164245">op</span><br>
<span class="lineno">925</span><span class="op" id="3164248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3164251">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="3164311">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="3164382">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="3164411">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="3164471">func</span>&nbsp;<span class="op" id="3164476">(</span><span class="ident" id="3164477">dec</span>&nbsp;<span class="op" id="3164481">*</span><span class="ident" id="3164482">Decoder</span><span class="op" id="3164489">)</span>&nbsp;<span class="ident" id="3164491">compatibleType</span><span class="op" id="3164505">(</span><span class="ident" id="3164506">fr</span>&nbsp;<span class="ident" id="3164509">reflect</span><span class="op" id="3164516">.</span><span class="ident" id="3164517">Type</span><span class="op" id="3164521">,</span>&nbsp;<span class="ident" id="3164523">fw</span>&nbsp;<span class="ident" id="3164526">typeId</span><span class="op" id="3164532">,</span>&nbsp;<span class="ident" id="3164534">inProgress</span>&nbsp;<span class="keyword" id="3164545">map</span><span class="op" id="3164548">[</span><span class="ident" id="3164549">reflect</span><span class="op" id="3164556">.</span><span class="ident" id="3164557">Type</span><span class="op" id="3164561">]</span><span class="ident" id="3164562">typeId</span><span class="op" id="3164568">)</span>&nbsp;<span class="builtintype" id="3164570">bool</span>&nbsp;<span class="op" id="3164575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164578">if</span>&nbsp;<span class="ident" id="3164581">rhs</span><span class="op" id="3164584">,</span>&nbsp;<span class="ident" id="3164586">ok</span>&nbsp;<span class="op" id="3164589">:=</span>&nbsp;<span class="ident" id="3164592">inProgress</span><span class="op" id="3164602">[</span><span class="ident" id="3164603">fr</span><span class="op" id="3164605">]</span><span class="op" id="3164606">;</span>&nbsp;<span class="ident" id="3164608">ok</span>&nbsp;<span class="op" id="3164611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164615">return</span>&nbsp;<span class="ident" id="3164622">rhs</span>&nbsp;<span class="op" id="3164626">==</span>&nbsp;<span class="ident" id="3164629">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164633">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164636">inProgress</span><span class="op" id="3164646">[</span><span class="ident" id="3164647">fr</span><span class="op" id="3164649">]</span>&nbsp;<span class="op" id="3164651">=</span>&nbsp;<span class="ident" id="3164653">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164657">ut</span>&nbsp;<span class="op" id="3164660">:=</span>&nbsp;<span class="ident" id="3164663">userType</span><span class="op" id="3164671">(</span><span class="ident" id="3164672">fr</span><span class="op" id="3164674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164677">wire</span><span class="op" id="3164681">,</span>&nbsp;<span class="ident" id="3164683">ok</span>&nbsp;<span class="op" id="3164686">:=</span>&nbsp;<span class="ident" id="3164689">dec</span><span class="op" id="3164692">.</span><span class="ident" id="3164693">wireType</span><span class="op" id="3164701">[</span><span class="ident" id="3164702">fw</span><span class="op" id="3164704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164707">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164782">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164811">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164857">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164927">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164990">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165036">if</span>&nbsp;<span class="op" id="3165039">(</span><span class="ident" id="3165040">ut</span><span class="op" id="3165042">.</span><span class="ident" id="3165043">externalDec</span>&nbsp;<span class="op" id="3165055">==</span>&nbsp;<span class="ident" id="3165058">xGob</span><span class="op" id="3165062">)</span>&nbsp;<span class="op" id="3165064">!=</span>&nbsp;<span class="op" id="3165067">(</span><span class="ident" id="3165068">ok</span>&nbsp;<span class="op" id="3165071">&amp;&amp;</span>&nbsp;<span class="ident" id="3165074">wire</span><span class="op" id="3165078">.</span><span class="ident" id="3165079">GobEncoderT</span>&nbsp;<span class="op" id="3165091">!=</span>&nbsp;<span class="ident" id="3165094">nil</span><span class="op" id="3165097">)</span>&nbsp;<span class="op" id="3165099">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165104">(</span><span class="ident" id="3165105">ut</span><span class="op" id="3165107">.</span><span class="ident" id="3165108">externalDec</span>&nbsp;<span class="op" id="3165120">==</span>&nbsp;<span class="ident" id="3165123">xBinary</span><span class="op" id="3165130">)</span>&nbsp;<span class="op" id="3165132">!=</span>&nbsp;<span class="op" id="3165135">(</span><span class="ident" id="3165136">ok</span>&nbsp;<span class="op" id="3165139">&amp;&amp;</span>&nbsp;<span class="ident" id="3165142">wire</span><span class="op" id="3165146">.</span><span class="ident" id="3165147">BinaryMarshalerT</span>&nbsp;<span class="op" id="3165164">!=</span>&nbsp;<span class="ident" id="3165167">nil</span><span class="op" id="3165170">)</span>&nbsp;<span class="op" id="3165172">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165177">(</span><span class="ident" id="3165178">ut</span><span class="op" id="3165180">.</span><span class="ident" id="3165181">externalDec</span>&nbsp;<span class="op" id="3165193">==</span>&nbsp;<span class="ident" id="3165196">xText</span><span class="op" id="3165201">)</span>&nbsp;<span class="op" id="3165203">!=</span>&nbsp;<span class="op" id="3165206">(</span><span class="ident" id="3165207">ok</span>&nbsp;<span class="op" id="3165210">&amp;&amp;</span>&nbsp;<span class="ident" id="3165213">wire</span><span class="op" id="3165217">.</span><span class="ident" id="3165218">TextMarshalerT</span>&nbsp;<span class="op" id="3165233">!=</span>&nbsp;<span class="ident" id="3165236">nil</span><span class="op" id="3165239">)</span>&nbsp;<span class="op" id="3165241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165245">return</span>&nbsp;<span class="ident" id="3165252">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165262">if</span>&nbsp;<span class="ident" id="3165265">ut</span><span class="op" id="3165267">.</span><span class="ident" id="3165268">externalDec</span>&nbsp;<span class="op" id="3165280">!=</span>&nbsp;<span class="num" id="3165283">0</span>&nbsp;<span class="op" id="3165285">{</span>&nbsp;<span class="comment" id="3165287">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165321">return</span>&nbsp;<span class="ident" id="3165328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165337">switch</span>&nbsp;<span class="ident" id="3165344">t</span>&nbsp;<span class="op" id="3165346">:=</span>&nbsp;<span class="ident" id="3165349">ut</span><span class="op" id="3165351">.</span><span class="ident" id="3165352">base</span><span class="op" id="3165356">;</span>&nbsp;<span class="ident" id="3165358">t</span><span class="op" id="3165359">.</span><span class="ident" id="3165360">Kind</span><span class="op" id="3165364">(</span><span class="op" id="3165365">)</span>&nbsp;<span class="op" id="3165367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165370">default</span><span class="op" id="3165377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165381">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165412">return</span>&nbsp;<span class="ident" id="3165419">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165426">case</span>&nbsp;<span class="ident" id="3165431">reflect</span><span class="op" id="3165438">.</span><span class="ident" id="3165439">Bool</span><span class="op" id="3165443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165447">return</span>&nbsp;<span class="ident" id="3165454">fw</span>&nbsp;<span class="op" id="3165457">==</span>&nbsp;<span class="ident" id="3165460">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165467">case</span>&nbsp;<span class="ident" id="3165472">reflect</span><span class="op" id="3165479">.</span><span class="ident" id="3165480">Int</span><span class="op" id="3165483">,</span>&nbsp;<span class="ident" id="3165485">reflect</span><span class="op" id="3165492">.</span><span class="ident" id="3165493">Int8</span><span class="op" id="3165497">,</span>&nbsp;<span class="ident" id="3165499">reflect</span><span class="op" id="3165506">.</span><span class="ident" id="3165507">Int16</span><span class="op" id="3165512">,</span>&nbsp;<span class="ident" id="3165514">reflect</span><span class="op" id="3165521">.</span><span class="ident" id="3165522">Int32</span><span class="op" id="3165527">,</span>&nbsp;<span class="ident" id="3165529">reflect</span><span class="op" id="3165536">.</span><span class="ident" id="3165537">Int64</span><span class="op" id="3165542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165546">return</span>&nbsp;<span class="ident" id="3165553">fw</span>&nbsp;<span class="op" id="3165556">==</span>&nbsp;<span class="ident" id="3165559">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165565">case</span>&nbsp;<span class="ident" id="3165570">reflect</span><span class="op" id="3165577">.</span><span class="ident" id="3165578">Uint</span><span class="op" id="3165582">,</span>&nbsp;<span class="ident" id="3165584">reflect</span><span class="op" id="3165591">.</span><span class="ident" id="3165592">Uint8</span><span class="op" id="3165597">,</span>&nbsp;<span class="ident" id="3165599">reflect</span><span class="op" id="3165606">.</span><span class="ident" id="3165607">Uint16</span><span class="op" id="3165613">,</span>&nbsp;<span class="ident" id="3165615">reflect</span><span class="op" id="3165622">.</span><span class="ident" id="3165623">Uint32</span><span class="op" id="3165629">,</span>&nbsp;<span class="ident" id="3165631">reflect</span><span class="op" id="3165638">.</span><span class="ident" id="3165639">Uint64</span><span class="op" id="3165645">,</span>&nbsp;<span class="ident" id="3165647">reflect</span><span class="op" id="3165654">.</span><span class="ident" id="3165655">Uintptr</span><span class="op" id="3165662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165666">return</span>&nbsp;<span class="ident" id="3165673">fw</span>&nbsp;<span class="op" id="3165676">==</span>&nbsp;<span class="ident" id="3165679">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165686">case</span>&nbsp;<span class="ident" id="3165691">reflect</span><span class="op" id="3165698">.</span><span class="ident" id="3165699">Float32</span><span class="op" id="3165706">,</span>&nbsp;<span class="ident" id="3165708">reflect</span><span class="op" id="3165715">.</span><span class="ident" id="3165716">Float64</span><span class="op" id="3165723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165727">return</span>&nbsp;<span class="ident" id="3165734">fw</span>&nbsp;<span class="op" id="3165737">==</span>&nbsp;<span class="ident" id="3165740">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165748">case</span>&nbsp;<span class="ident" id="3165753">reflect</span><span class="op" id="3165760">.</span><span class="ident" id="3165761">Complex64</span><span class="op" id="3165770">,</span>&nbsp;<span class="ident" id="3165772">reflect</span><span class="op" id="3165779">.</span><span class="ident" id="3165780">Complex128</span><span class="op" id="3165790">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165794">return</span>&nbsp;<span class="ident" id="3165801">fw</span>&nbsp;<span class="op" id="3165804">==</span>&nbsp;<span class="ident" id="3165807">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165817">case</span>&nbsp;<span class="ident" id="3165822">reflect</span><span class="op" id="3165829">.</span><span class="ident" id="3165830">String</span><span class="op" id="3165836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165840">return</span>&nbsp;<span class="ident" id="3165847">fw</span>&nbsp;<span class="op" id="3165850">==</span>&nbsp;<span class="ident" id="3165853">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165862">case</span>&nbsp;<span class="ident" id="3165867">reflect</span><span class="op" id="3165874">.</span><span class="ident" id="3165875">Interface</span><span class="op" id="3165884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165888">return</span>&nbsp;<span class="ident" id="3165895">fw</span>&nbsp;<span class="op" id="3165898">==</span>&nbsp;<span class="ident" id="3165901">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165913">case</span>&nbsp;<span class="ident" id="3165918">reflect</span><span class="op" id="3165925">.</span><span class="ident" id="3165926">Array</span><span class="op" id="3165931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165935">if</span>&nbsp;<span class="op" id="3165938">!</span><span class="ident" id="3165939">ok</span>&nbsp;<span class="op" id="3165942">||</span>&nbsp;<span class="ident" id="3165945">wire</span><span class="op" id="3165949">.</span><span class="ident" id="3165950">ArrayT</span>&nbsp;<span class="op" id="3165957">==</span>&nbsp;<span class="ident" id="3165960">nil</span>&nbsp;<span class="op" id="3165964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165969">return</span>&nbsp;<span class="ident" id="3165976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165988">array</span>&nbsp;<span class="op" id="3165994">:=</span>&nbsp;<span class="ident" id="3165997">wire</span><span class="op" id="3166001">.</span><span class="ident" id="3166002">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166011">return</span>&nbsp;<span class="ident" id="3166018">t</span><span class="op" id="3166019">.</span><span class="ident" id="3166020">Len</span><span class="op" id="3166023">(</span><span class="op" id="3166024">)</span>&nbsp;<span class="op" id="3166026">==</span>&nbsp;<span class="ident" id="3166029">array</span><span class="op" id="3166034">.</span><span class="ident" id="3166035">Len</span>&nbsp;<span class="op" id="3166039">&amp;&amp;</span>&nbsp;<span class="ident" id="3166042">dec</span><span class="op" id="3166045">.</span><span class="ident" id="3166046">compatibleType</span><span class="op" id="3166060">(</span><span class="ident" id="3166061">t</span><span class="op" id="3166062">.</span><span class="ident" id="3166063">Elem</span><span class="op" id="3166067">(</span><span class="op" id="3166068">)</span><span class="op" id="3166069">,</span>&nbsp;<span class="ident" id="3166071">array</span><span class="op" id="3166076">.</span><span class="ident" id="3166077">Elem</span><span class="op" id="3166081">,</span>&nbsp;<span class="ident" id="3166083">inProgress</span><span class="op" id="3166093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166096">case</span>&nbsp;<span class="ident" id="3166101">reflect</span><span class="op" id="3166108">.</span><span class="ident" id="3166109">Map</span><span class="op" id="3166112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166116">if</span>&nbsp;<span class="op" id="3166119">!</span><span class="ident" id="3166120">ok</span>&nbsp;<span class="op" id="3166123">||</span>&nbsp;<span class="ident" id="3166126">wire</span><span class="op" id="3166130">.</span><span class="ident" id="3166131">MapT</span>&nbsp;<span class="op" id="3166136">==</span>&nbsp;<span class="ident" id="3166139">nil</span>&nbsp;<span class="op" id="3166143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166148">return</span>&nbsp;<span class="ident" id="3166155">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166163">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166167">MapType</span>&nbsp;<span class="op" id="3166175">:=</span>&nbsp;<span class="ident" id="3166178">wire</span><span class="op" id="3166182">.</span><span class="ident" id="3166183">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166190">return</span>&nbsp;<span class="ident" id="3166197">dec</span><span class="op" id="3166200">.</span><span class="ident" id="3166201">compatibleType</span><span class="op" id="3166215">(</span><span class="ident" id="3166216">t</span><span class="op" id="3166217">.</span><span class="ident" id="3166218">Key</span><span class="op" id="3166221">(</span><span class="op" id="3166222">)</span><span class="op" id="3166223">,</span>&nbsp;<span class="ident" id="3166225">MapType</span><span class="op" id="3166232">.</span><span class="ident" id="3166233">Key</span><span class="op" id="3166236">,</span>&nbsp;<span class="ident" id="3166238">inProgress</span><span class="op" id="3166248">)</span>&nbsp;<span class="op" id="3166250">&amp;&amp;</span>&nbsp;<span class="ident" id="3166253">dec</span><span class="op" id="3166256">.</span><span class="ident" id="3166257">compatibleType</span><span class="op" id="3166271">(</span><span class="ident" id="3166272">t</span><span class="op" id="3166273">.</span><span class="ident" id="3166274">Elem</span><span class="op" id="3166278">(</span><span class="op" id="3166279">)</span><span class="op" id="3166280">,</span>&nbsp;<span class="ident" id="3166282">MapType</span><span class="op" id="3166289">.</span><span class="ident" id="3166290">Elem</span><span class="op" id="3166294">,</span>&nbsp;<span class="ident" id="3166296">inProgress</span><span class="op" id="3166306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166309">case</span>&nbsp;<span class="ident" id="3166314">reflect</span><span class="op" id="3166321">.</span><span class="ident" id="3166322">Slice</span><span class="op" id="3166327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166331">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166361">if</span>&nbsp;<span class="ident" id="3166364">t</span><span class="op" id="3166365">.</span><span class="ident" id="3166366">Elem</span><span class="op" id="3166370">(</span><span class="op" id="3166371">)</span><span class="op" id="3166372">.</span><span class="ident" id="3166373">Kind</span><span class="op" id="3166377">(</span><span class="op" id="3166378">)</span>&nbsp;<span class="op" id="3166380">==</span>&nbsp;<span class="ident" id="3166383">reflect</span><span class="op" id="3166390">.</span><span class="ident" id="3166391">Uint8</span>&nbsp;<span class="op" id="3166397">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166402">return</span>&nbsp;<span class="ident" id="3166409">fw</span>&nbsp;<span class="op" id="3166412">==</span>&nbsp;<span class="ident" id="3166415">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166428">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166468">var</span>&nbsp;<span class="ident" id="3166472">sw</span>&nbsp;<span class="op" id="3166475">*</span><span class="ident" id="3166476">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166488">if</span>&nbsp;<span class="ident" id="3166491">tt</span><span class="op" id="3166493">,</span>&nbsp;<span class="ident" id="3166495">ok</span>&nbsp;<span class="op" id="3166498">:=</span>&nbsp;<span class="ident" id="3166501">builtinIdToType</span><span class="op" id="3166516">[</span><span class="ident" id="3166517">fw</span><span class="op" id="3166519">]</span><span class="op" id="3166520">;</span>&nbsp;<span class="ident" id="3166522">ok</span>&nbsp;<span class="op" id="3166525">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166530">sw</span><span class="op" id="3166532">,</span>&nbsp;<span class="ident" id="3166534">_</span>&nbsp;<span class="op" id="3166536">=</span>&nbsp;<span class="ident" id="3166538">tt</span><span class="op" id="3166540">.</span><span class="op" id="3166541">(</span><span class="op" id="3166542">*</span><span class="ident" id="3166543">sliceType</span><span class="op" id="3166552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166556">}</span>&nbsp;<span class="keyword" id="3166558">else</span>&nbsp;<span class="keyword" id="3166563">if</span>&nbsp;<span class="ident" id="3166566">wire</span>&nbsp;<span class="op" id="3166571">!=</span>&nbsp;<span class="ident" id="3166574">nil</span>&nbsp;<span class="op" id="3166578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166583">sw</span>&nbsp;<span class="op" id="3166586">=</span>&nbsp;<span class="ident" id="3166588">wire</span><span class="op" id="3166592">.</span><span class="ident" id="3166593">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166606">elem</span>&nbsp;<span class="op" id="3166611">:=</span>&nbsp;<span class="ident" id="3166614">userType</span><span class="op" id="3166622">(</span><span class="ident" id="3166623">t</span><span class="op" id="3166624">.</span><span class="ident" id="3166625">Elem</span><span class="op" id="3166629">(</span><span class="op" id="3166630">)</span><span class="op" id="3166631">)</span><span class="op" id="3166632">.</span><span class="ident" id="3166633">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166640">return</span>&nbsp;<span class="ident" id="3166647">sw</span>&nbsp;<span class="op" id="3166650">!=</span>&nbsp;<span class="ident" id="3166653">nil</span>&nbsp;<span class="op" id="3166657">&amp;&amp;</span>&nbsp;<span class="ident" id="3166660">dec</span><span class="op" id="3166663">.</span><span class="ident" id="3166664">compatibleType</span><span class="op" id="3166678">(</span><span class="ident" id="3166679">elem</span><span class="op" id="3166683">,</span>&nbsp;<span class="ident" id="3166685">sw</span><span class="op" id="3166687">.</span><span class="ident" id="3166688">Elem</span><span class="op" id="3166692">,</span>&nbsp;<span class="ident" id="3166694">inProgress</span><span class="op" id="3166704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166707">case</span>&nbsp;<span class="ident" id="3166712">reflect</span><span class="op" id="3166719">.</span><span class="ident" id="3166720">Struct</span><span class="op" id="3166726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166730">return</span>&nbsp;<span class="ident" id="3166737">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166743">}</span><br>
<span class="lineno"></span><span class="op" id="3166745">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="3166748">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="3166835">func</span>&nbsp;<span class="op" id="3166840">(</span><span class="ident" id="3166841">dec</span>&nbsp;<span class="op" id="3166845">*</span><span class="ident" id="3166846">Decoder</span><span class="op" id="3166853">)</span>&nbsp;<span class="ident" id="3166855">typeString</span><span class="op" id="3166865">(</span><span class="ident" id="3166866">remoteId</span>&nbsp;<span class="ident" id="3166875">typeId</span><span class="op" id="3166881">)</span>&nbsp;<span class="builtintype" id="3166883">string</span>&nbsp;<span class="op" id="3166890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166893">if</span>&nbsp;<span class="ident" id="3166896">t</span>&nbsp;<span class="op" id="3166898">:=</span>&nbsp;<span class="ident" id="3166901">idToType</span><span class="op" id="3166909">[</span><span class="ident" id="3166910">remoteId</span><span class="op" id="3166918">]</span><span class="op" id="3166919">;</span>&nbsp;<span class="ident" id="3166921">t</span>&nbsp;<span class="op" id="3166923">!=</span>&nbsp;<span class="ident" id="3166926">nil</span>&nbsp;<span class="op" id="3166930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166934">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166960">return</span>&nbsp;<span class="ident" id="3166967">t</span><span class="op" id="3166968">.</span><span class="builtintype" id="3166969">string</span><span class="op" id="3166975">(</span><span class="op" id="3166976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166982">return</span>&nbsp;<span class="ident" id="3166989">dec</span><span class="op" id="3166992">.</span><span class="ident" id="3166993">wireType</span><span class="op" id="3167001">[</span><span class="ident" id="3167002">remoteId</span><span class="op" id="3167010">]</span><span class="op" id="3167011">.</span><span class="builtintype" id="3167012">string</span><span class="op" id="3167018">(</span><span class="op" id="3167019">)</span><br>
<span class="lineno"></span><span class="op" id="3167021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="3167024">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="3167113">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="3167129">func</span>&nbsp;<span class="op" id="3167134">(</span><span class="ident" id="3167135">dec</span>&nbsp;<span class="op" id="3167139">*</span><span class="ident" id="3167140">Decoder</span><span class="op" id="3167147">)</span>&nbsp;<span class="ident" id="3167149">compileSingle</span><span class="op" id="3167162">(</span><span class="ident" id="3167163">remoteId</span>&nbsp;<span class="ident" id="3167172">typeId</span><span class="op" id="3167178">,</span>&nbsp;<span class="ident" id="3167180">ut</span>&nbsp;<span class="op" id="3167183">*</span><span class="ident" id="3167184">userTypeInfo</span><span class="op" id="3167196">)</span>&nbsp;<span class="op" id="3167198">(</span><span class="ident" id="3167199">engine</span>&nbsp;<span class="op" id="3167206">*</span><span class="ident" id="3167207">decEngine</span><span class="op" id="3167216">,</span>&nbsp;<span class="ident" id="3167218">err</span>&nbsp;<span class="builtintype" id="3167222">error</span><span class="op" id="3167227">)</span>&nbsp;<span class="op" id="3167229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167232">rt</span>&nbsp;<span class="op" id="3167235">:=</span>&nbsp;<span class="ident" id="3167238">ut</span><span class="op" id="3167240">.</span><span class="ident" id="3167241">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167247">engine</span>&nbsp;<span class="op" id="3167254">=</span>&nbsp;<span class="builtinfunc" id="3167256">new</span><span class="op" id="3167259">(</span><span class="ident" id="3167260">decEngine</span><span class="op" id="3167269">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167272">engine</span><span class="op" id="3167278">.</span><span class="ident" id="3167279">instr</span>&nbsp;<span class="op" id="3167285">=</span>&nbsp;<span class="builtinfunc" id="3167287">make</span><span class="op" id="3167291">(</span><span class="op" id="3167292">[</span><span class="op" id="3167293">]</span><span class="ident" id="3167294">decInstr</span><span class="op" id="3167302">,</span>&nbsp;<span class="num" id="3167304">1</span><span class="op" id="3167305">)</span>&nbsp;<span class="comment" id="3167307">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167320">name</span>&nbsp;<span class="op" id="3167325">:=</span>&nbsp;<span class="ident" id="3167328">rt</span><span class="op" id="3167330">.</span><span class="ident" id="3167331">String</span><span class="op" id="3167337">(</span><span class="op" id="3167338">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167355">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167374">if</span>&nbsp;<span class="op" id="3167377">!</span><span class="ident" id="3167378">dec</span><span class="op" id="3167381">.</span><span class="ident" id="3167382">compatibleType</span><span class="op" id="3167396">(</span><span class="ident" id="3167397">rt</span><span class="op" id="3167399">,</span>&nbsp;<span class="ident" id="3167401">remoteId</span><span class="op" id="3167409">,</span>&nbsp;<span class="builtinfunc" id="3167411">make</span><span class="op" id="3167415">(</span><span class="keyword" id="3167416">map</span><span class="op" id="3167419">[</span><span class="ident" id="3167420">reflect</span><span class="op" id="3167427">.</span><span class="ident" id="3167428">Type</span><span class="op" id="3167432">]</span><span class="ident" id="3167433">typeId</span><span class="op" id="3167439">)</span><span class="op" id="3167440">)</span>&nbsp;<span class="op" id="3167442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167446">remoteType</span>&nbsp;<span class="op" id="3167457">:=</span>&nbsp;<span class="ident" id="3167460">dec</span><span class="op" id="3167463">.</span><span class="ident" id="3167464">typeString</span><span class="op" id="3167474">(</span><span class="ident" id="3167475">remoteId</span><span class="op" id="3167483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167487">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167559">if</span>&nbsp;<span class="ident" id="3167562">ut</span><span class="op" id="3167564">.</span><span class="ident" id="3167565">base</span><span class="op" id="3167569">.</span><span class="ident" id="3167570">Kind</span><span class="op" id="3167574">(</span><span class="op" id="3167575">)</span>&nbsp;<span class="op" id="3167577">==</span>&nbsp;<span class="ident" id="3167580">reflect</span><span class="op" id="3167587">.</span><span class="ident" id="3167588">Interface</span>&nbsp;<span class="op" id="3167598">&amp;&amp;</span>&nbsp;<span class="ident" id="3167601">remoteId</span>&nbsp;<span class="op" id="3167610">!=</span>&nbsp;<span class="ident" id="3167613">tInterface</span>&nbsp;<span class="op" id="3167624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167629">return</span>&nbsp;<span class="ident" id="3167636">nil</span><span class="op" id="3167639">,</span>&nbsp;<span class="ident" id="3167641">errors</span><span class="op" id="3167647">.</span><span class="ident" id="3167648">New</span><span class="op" id="3167651">(</span><span class="string" id="3167652">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3167681">+</span>&nbsp;<span class="ident" id="3167683">name</span>&nbsp;<span class="op" id="3167688">+</span>&nbsp;<span class="string" id="3167690">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3167765">+</span>&nbsp;<span class="ident" id="3167767">remoteType</span><span class="op" id="3167777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167785">return</span>&nbsp;<span class="ident" id="3167792">nil</span><span class="op" id="3167795">,</span>&nbsp;<span class="ident" id="3167797">errors</span><span class="op" id="3167803">.</span><span class="ident" id="3167804">New</span><span class="op" id="3167807">(</span><span class="string" id="3167808">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3167841">+</span>&nbsp;<span class="ident" id="3167843">name</span>&nbsp;<span class="op" id="3167848">+</span>&nbsp;<span class="string" id="3167850">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3167876">+</span>&nbsp;<span class="ident" id="3167878">remoteType</span><span class="op" id="3167888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167891">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167894">op</span>&nbsp;<span class="op" id="3167897">:=</span>&nbsp;<span class="ident" id="3167900">dec</span><span class="op" id="3167903">.</span><span class="ident" id="3167904">decOpFor</span><span class="op" id="3167912">(</span><span class="ident" id="3167913">remoteId</span><span class="op" id="3167921">,</span>&nbsp;<span class="ident" id="3167923">rt</span><span class="op" id="3167925">,</span>&nbsp;<span class="ident" id="3167927">name</span><span class="op" id="3167931">,</span>&nbsp;<span class="builtinfunc" id="3167933">make</span><span class="op" id="3167937">(</span><span class="keyword" id="3167938">map</span><span class="op" id="3167941">[</span><span class="ident" id="3167942">reflect</span><span class="op" id="3167949">.</span><span class="ident" id="3167950">Type</span><span class="op" id="3167954">]</span><span class="op" id="3167955">*</span><span class="ident" id="3167956">decOp</span><span class="op" id="3167961">)</span><span class="op" id="3167962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167965">ovfl</span>&nbsp;<span class="op" id="3167970">:=</span>&nbsp;<span class="ident" id="3167973">errors</span><span class="op" id="3167979">.</span><span class="ident" id="3167980">New</span><span class="op" id="3167983">(</span><span class="string" id="3167984">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3167998">+</span>&nbsp;<span class="ident" id="3168000">name</span>&nbsp;<span class="op" id="3168005">+</span>&nbsp;<span class="string" id="3168007">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3168023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168026">engine</span><span class="op" id="3168032">.</span><span class="ident" id="3168033">instr</span><span class="op" id="3168038">[</span><span class="ident" id="3168039">singletonField</span><span class="op" id="3168053">]</span>&nbsp;<span class="op" id="3168055">=</span>&nbsp;<span class="ident" id="3168057">decInstr</span><span class="op" id="3168065">{</span><span class="op" id="3168066">*</span><span class="ident" id="3168067">op</span><span class="op" id="3168069">,</span>&nbsp;<span class="ident" id="3168071">singletonField</span><span class="op" id="3168085">,</span>&nbsp;<span class="ident" id="3168087">nil</span><span class="op" id="3168090">,</span>&nbsp;<span class="ident" id="3168092">ovfl</span><span class="op" id="3168096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168099">engine</span><span class="op" id="3168105">.</span><span class="ident" id="3168106">numInstr</span>&nbsp;<span class="op" id="3168115">=</span>&nbsp;<span class="num" id="3168117">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168120">return</span><br>
<span class="lineno">1030</span><span class="op" id="3168127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3168130">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3168238">func</span>&nbsp;<span class="op" id="3168243">(</span><span class="ident" id="3168244">dec</span>&nbsp;<span class="op" id="3168248">*</span><span class="ident" id="3168249">Decoder</span><span class="op" id="3168256">)</span>&nbsp;<span class="ident" id="3168258">compileIgnoreSingle</span><span class="op" id="3168277">(</span><span class="ident" id="3168278">remoteId</span>&nbsp;<span class="ident" id="3168287">typeId</span><span class="op" id="3168293">)</span>&nbsp;<span class="op" id="3168295">(</span><span class="ident" id="3168296">engine</span>&nbsp;<span class="op" id="3168303">*</span><span class="ident" id="3168304">decEngine</span><span class="op" id="3168313">,</span>&nbsp;<span class="ident" id="3168315">err</span>&nbsp;<span class="builtintype" id="3168319">error</span><span class="op" id="3168324">)</span>&nbsp;<span class="op" id="3168326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168329">engine</span>&nbsp;<span class="op" id="3168336">=</span>&nbsp;<span class="builtinfunc" id="3168338">new</span><span class="op" id="3168341">(</span><span class="ident" id="3168342">decEngine</span><span class="op" id="3168351">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168354">engine</span><span class="op" id="3168360">.</span><span class="ident" id="3168361">instr</span>&nbsp;<span class="op" id="3168367">=</span>&nbsp;<span class="builtinfunc" id="3168369">make</span><span class="op" id="3168373">(</span><span class="op" id="3168374">[</span><span class="op" id="3168375">]</span><span class="ident" id="3168376">decInstr</span><span class="op" id="3168384">,</span>&nbsp;<span class="num" id="3168386">1</span><span class="op" id="3168387">)</span>&nbsp;<span class="comment" id="3168389">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168402">op</span>&nbsp;<span class="op" id="3168405">:=</span>&nbsp;<span class="ident" id="3168408">dec</span><span class="op" id="3168411">.</span><span class="ident" id="3168412">decIgnoreOpFor</span><span class="op" id="3168426">(</span><span class="ident" id="3168427">remoteId</span><span class="op" id="3168435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168438">ovfl</span>&nbsp;<span class="op" id="3168443">:=</span>&nbsp;<span class="ident" id="3168446">overflow</span><span class="op" id="3168454">(</span><span class="ident" id="3168455">dec</span><span class="op" id="3168458">.</span><span class="ident" id="3168459">typeString</span><span class="op" id="3168469">(</span><span class="ident" id="3168470">remoteId</span><span class="op" id="3168478">)</span><span class="op" id="3168479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168482">engine</span><span class="op" id="3168488">.</span><span class="ident" id="3168489">instr</span><span class="op" id="3168494">[</span><span class="num" id="3168495">0</span><span class="op" id="3168496">]</span>&nbsp;<span class="op" id="3168498">=</span>&nbsp;<span class="ident" id="3168500">decInstr</span><span class="op" id="3168508">{</span><span class="ident" id="3168509">op</span><span class="op" id="3168511">,</span>&nbsp;<span class="num" id="3168513">0</span><span class="op" id="3168514">,</span>&nbsp;<span class="ident" id="3168516">nil</span><span class="op" id="3168519">,</span>&nbsp;<span class="ident" id="3168521">ovfl</span><span class="op" id="3168525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168528">engine</span><span class="op" id="3168534">.</span><span class="ident" id="3168535">numInstr</span>&nbsp;<span class="op" id="3168544">=</span>&nbsp;<span class="num" id="3168546">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168549">return</span><br>
<span class="lineno"></span><span class="op" id="3168556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3168559">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="3168645">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="3168679">func</span>&nbsp;<span class="op" id="3168684">(</span><span class="ident" id="3168685">dec</span>&nbsp;<span class="op" id="3168689">*</span><span class="ident" id="3168690">Decoder</span><span class="op" id="3168697">)</span>&nbsp;<span class="ident" id="3168699">compileDec</span><span class="op" id="3168709">(</span><span class="ident" id="3168710">remoteId</span>&nbsp;<span class="ident" id="3168719">typeId</span><span class="op" id="3168725">,</span>&nbsp;<span class="ident" id="3168727">ut</span>&nbsp;<span class="op" id="3168730">*</span><span class="ident" id="3168731">userTypeInfo</span><span class="op" id="3168743">)</span>&nbsp;<span class="op" id="3168745">(</span><span class="ident" id="3168746">engine</span>&nbsp;<span class="op" id="3168753">*</span><span class="ident" id="3168754">decEngine</span><span class="op" id="3168763">,</span>&nbsp;<span class="ident" id="3168765">err</span>&nbsp;<span class="builtintype" id="3168769">error</span><span class="op" id="3168774">)</span>&nbsp;<span class="op" id="3168776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168779">rt</span>&nbsp;<span class="op" id="3168782">:=</span>&nbsp;<span class="ident" id="3168785">ut</span><span class="op" id="3168787">.</span><span class="ident" id="3168788">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168794">srt</span>&nbsp;<span class="op" id="3168798">:=</span>&nbsp;<span class="ident" id="3168801">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168805">if</span>&nbsp;<span class="ident" id="3168808">srt</span><span class="op" id="3168811">.</span><span class="ident" id="3168812">Kind</span><span class="op" id="3168816">(</span><span class="op" id="3168817">)</span>&nbsp;<span class="op" id="3168819">!=</span>&nbsp;<span class="ident" id="3168822">reflect</span><span class="op" id="3168829">.</span><span class="ident" id="3168830">Struct</span>&nbsp;<span class="op" id="3168837">||</span>&nbsp;<span class="ident" id="3168840">ut</span><span class="op" id="3168842">.</span><span class="ident" id="3168843">externalDec</span>&nbsp;<span class="op" id="3168855">!=</span>&nbsp;<span class="num" id="3168858">0</span>&nbsp;<span class="op" id="3168860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168864">return</span>&nbsp;<span class="ident" id="3168871">dec</span><span class="op" id="3168874">.</span><span class="ident" id="3168875">compileSingle</span><span class="op" id="3168888">(</span><span class="ident" id="3168889">remoteId</span><span class="op" id="3168897">,</span>&nbsp;<span class="ident" id="3168899">ut</span><span class="op" id="3168901">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168907">var</span>&nbsp;<span class="ident" id="3168911">wireStruct</span>&nbsp;<span class="op" id="3168922">*</span><span class="ident" id="3168923">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168935">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169021">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169101">if</span>&nbsp;<span class="ident" id="3169104">t</span><span class="op" id="3169105">,</span>&nbsp;<span class="ident" id="3169107">ok</span>&nbsp;<span class="op" id="3169110">:=</span>&nbsp;<span class="ident" id="3169113">builtinIdToType</span><span class="op" id="3169128">[</span><span class="ident" id="3169129">remoteId</span><span class="op" id="3169137">]</span><span class="op" id="3169138">;</span>&nbsp;<span class="ident" id="3169140">ok</span>&nbsp;<span class="op" id="3169143">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169147">wireStruct</span><span class="op" id="3169157">,</span>&nbsp;<span class="ident" id="3169159">_</span>&nbsp;<span class="op" id="3169161">=</span>&nbsp;<span class="ident" id="3169163">t</span><span class="op" id="3169164">.</span><span class="op" id="3169165">(</span><span class="op" id="3169166">*</span><span class="ident" id="3169167">structType</span><span class="op" id="3169177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169180">}</span>&nbsp;<span class="keyword" id="3169182">else</span>&nbsp;<span class="op" id="3169187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169191">wire</span>&nbsp;<span class="op" id="3169196">:=</span>&nbsp;<span class="ident" id="3169199">dec</span><span class="op" id="3169202">.</span><span class="ident" id="3169203">wireType</span><span class="op" id="3169211">[</span><span class="ident" id="3169212">remoteId</span><span class="op" id="3169220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169224">if</span>&nbsp;<span class="ident" id="3169227">wire</span>&nbsp;<span class="op" id="3169232">==</span>&nbsp;<span class="ident" id="3169235">nil</span>&nbsp;<span class="op" id="3169239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169244">error_</span><span class="op" id="3169250">(</span><span class="ident" id="3169251">errBadType</span><span class="op" id="3169261">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169269">wireStruct</span>&nbsp;<span class="op" id="3169280">=</span>&nbsp;<span class="ident" id="3169282">wire</span><span class="op" id="3169286">.</span><span class="ident" id="3169287">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169299">if</span>&nbsp;<span class="ident" id="3169302">wireStruct</span>&nbsp;<span class="op" id="3169313">==</span>&nbsp;<span class="ident" id="3169316">nil</span>&nbsp;<span class="op" id="3169320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169324">errorf</span><span class="op" id="3169330">(</span><span class="string" id="3169331">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="3169394">,</span>&nbsp;<span class="ident" id="3169396">rt</span><span class="op" id="3169398">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169404">engine</span>&nbsp;<span class="op" id="3169411">=</span>&nbsp;<span class="builtinfunc" id="3169413">new</span><span class="op" id="3169416">(</span><span class="ident" id="3169417">decEngine</span><span class="op" id="3169426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169429">engine</span><span class="op" id="3169435">.</span><span class="ident" id="3169436">instr</span>&nbsp;<span class="op" id="3169442">=</span>&nbsp;<span class="builtinfunc" id="3169444">make</span><span class="op" id="3169448">(</span><span class="op" id="3169449">[</span><span class="op" id="3169450">]</span><span class="ident" id="3169451">decInstr</span><span class="op" id="3169459">,</span>&nbsp;<span class="builtinfunc" id="3169461">len</span><span class="op" id="3169464">(</span><span class="ident" id="3169465">wireStruct</span><span class="op" id="3169475">.</span><span class="ident" id="3169476">Field</span><span class="op" id="3169481">)</span><span class="op" id="3169482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169485">seen</span>&nbsp;<span class="op" id="3169490">:=</span>&nbsp;<span class="builtinfunc" id="3169493">make</span><span class="op" id="3169497">(</span><span class="keyword" id="3169498">map</span><span class="op" id="3169501">[</span><span class="ident" id="3169502">reflect</span><span class="op" id="3169509">.</span><span class="ident" id="3169510">Type</span><span class="op" id="3169514">]</span><span class="op" id="3169515">*</span><span class="ident" id="3169516">decOp</span><span class="op" id="3169521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169524">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169567">for</span>&nbsp;<span class="ident" id="3169571">fieldnum</span>&nbsp;<span class="op" id="3169580">:=</span>&nbsp;<span class="num" id="3169583">0</span><span class="op" id="3169584">;</span>&nbsp;<span class="ident" id="3169586">fieldnum</span>&nbsp;<span class="op" id="3169595">&lt;</span>&nbsp;<span class="builtinfunc" id="3169597">len</span><span class="op" id="3169600">(</span><span class="ident" id="3169601">wireStruct</span><span class="op" id="3169611">.</span><span class="ident" id="3169612">Field</span><span class="op" id="3169617">)</span><span class="op" id="3169618">;</span>&nbsp;<span class="ident" id="3169620">fieldnum</span><span class="op" id="3169628">++</span>&nbsp;<span class="op" id="3169631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169635">wireField</span>&nbsp;<span class="op" id="3169645">:=</span>&nbsp;<span class="ident" id="3169648">wireStruct</span><span class="op" id="3169658">.</span><span class="ident" id="3169659">Field</span><span class="op" id="3169664">[</span><span class="ident" id="3169665">fieldnum</span><span class="op" id="3169673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169677">if</span>&nbsp;<span class="ident" id="3169680">wireField</span><span class="op" id="3169689">.</span><span class="ident" id="3169690">Name</span>&nbsp;<span class="op" id="3169695">==</span>&nbsp;<span class="string" id="3169698">&#34;&#34;</span>&nbsp;<span class="op" id="3169701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169706">errorf</span><span class="op" id="3169712">(</span><span class="string" id="3169713">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3169753">,</span>&nbsp;<span class="ident" id="3169755">wireStruct</span><span class="op" id="3169765">.</span><span class="ident" id="3169766">Name</span><span class="op" id="3169770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169774">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169778">ovfl</span>&nbsp;<span class="op" id="3169783">:=</span>&nbsp;<span class="ident" id="3169786">overflow</span><span class="op" id="3169794">(</span><span class="ident" id="3169795">wireField</span><span class="op" id="3169804">.</span><span class="ident" id="3169805">Name</span><span class="op" id="3169809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169813">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169871">localField</span><span class="op" id="3169881">,</span>&nbsp;<span class="ident" id="3169883">present</span>&nbsp;<span class="op" id="3169891">:=</span>&nbsp;<span class="ident" id="3169894">srt</span><span class="op" id="3169897">.</span><span class="ident" id="3169898">FieldByName</span><span class="op" id="3169909">(</span><span class="ident" id="3169910">wireField</span><span class="op" id="3169919">.</span><span class="ident" id="3169920">Name</span><span class="op" id="3169924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169928">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169958">if</span>&nbsp;<span class="op" id="3169961">!</span><span class="ident" id="3169962">present</span>&nbsp;<span class="op" id="3169970">||</span>&nbsp;<span class="op" id="3169973">!</span><span class="ident" id="3169974">isExported</span><span class="op" id="3169984">(</span><span class="ident" id="3169985">wireField</span><span class="op" id="3169994">.</span><span class="ident" id="3169995">Name</span><span class="op" id="3169999">)</span>&nbsp;<span class="op" id="3170001">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170006">op</span>&nbsp;<span class="op" id="3170009">:=</span>&nbsp;<span class="ident" id="3170012">dec</span><span class="op" id="3170015">.</span><span class="ident" id="3170016">decIgnoreOpFor</span><span class="op" id="3170030">(</span><span class="ident" id="3170031">wireField</span><span class="op" id="3170040">.</span><span class="ident" id="3170041">Id</span><span class="op" id="3170043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170048">engine</span><span class="op" id="3170054">.</span><span class="ident" id="3170055">instr</span><span class="op" id="3170060">[</span><span class="ident" id="3170061">fieldnum</span><span class="op" id="3170069">]</span>&nbsp;<span class="op" id="3170071">=</span>&nbsp;<span class="ident" id="3170073">decInstr</span><span class="op" id="3170081">{</span><span class="ident" id="3170082">op</span><span class="op" id="3170084">,</span>&nbsp;<span class="ident" id="3170086">fieldnum</span><span class="op" id="3170094">,</span>&nbsp;<span class="ident" id="3170096">nil</span><span class="op" id="3170099">,</span>&nbsp;<span class="ident" id="3170101">ovfl</span><span class="op" id="3170105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170110">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170125">if</span>&nbsp;<span class="op" id="3170128">!</span><span class="ident" id="3170129">dec</span><span class="op" id="3170132">.</span><span class="ident" id="3170133">compatibleType</span><span class="op" id="3170147">(</span><span class="ident" id="3170148">localField</span><span class="op" id="3170158">.</span><span class="ident" id="3170159">Type</span><span class="op" id="3170163">,</span>&nbsp;<span class="ident" id="3170165">wireField</span><span class="op" id="3170174">.</span><span class="ident" id="3170175">Id</span><span class="op" id="3170177">,</span>&nbsp;<span class="builtinfunc" id="3170179">make</span><span class="op" id="3170183">(</span><span class="keyword" id="3170184">map</span><span class="op" id="3170187">[</span><span class="ident" id="3170188">reflect</span><span class="op" id="3170195">.</span><span class="ident" id="3170196">Type</span><span class="op" id="3170200">]</span><span class="ident" id="3170201">typeId</span><span class="op" id="3170207">)</span><span class="op" id="3170208">)</span>&nbsp;<span class="op" id="3170210">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170215">errorf</span><span class="op" id="3170221">(</span><span class="string" id="3170222">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="3170264">,</span>&nbsp;<span class="ident" id="3170266">localField</span><span class="op" id="3170276">.</span><span class="ident" id="3170277">Type</span><span class="op" id="3170281">,</span>&nbsp;<span class="ident" id="3170283">wireStruct</span><span class="op" id="3170293">.</span><span class="ident" id="3170294">Name</span><span class="op" id="3170298">,</span>&nbsp;<span class="ident" id="3170300">wireField</span><span class="op" id="3170309">.</span><span class="ident" id="3170310">Name</span><span class="op" id="3170314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170322">op</span>&nbsp;<span class="op" id="3170325">:=</span>&nbsp;<span class="ident" id="3170328">dec</span><span class="op" id="3170331">.</span><span class="ident" id="3170332">decOpFor</span><span class="op" id="3170340">(</span><span class="ident" id="3170341">wireField</span><span class="op" id="3170350">.</span><span class="ident" id="3170351">Id</span><span class="op" id="3170353">,</span>&nbsp;<span class="ident" id="3170355">localField</span><span class="op" id="3170365">.</span><span class="ident" id="3170366">Type</span><span class="op" id="3170370">,</span>&nbsp;<span class="ident" id="3170372">localField</span><span class="op" id="3170382">.</span><span class="ident" id="3170383">Name</span><span class="op" id="3170387">,</span>&nbsp;<span class="ident" id="3170389">seen</span><span class="op" id="3170393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170397">engine</span><span class="op" id="3170403">.</span><span class="ident" id="3170404">instr</span><span class="op" id="3170409">[</span><span class="ident" id="3170410">fieldnum</span><span class="op" id="3170418">]</span>&nbsp;<span class="op" id="3170420">=</span>&nbsp;<span class="ident" id="3170422">decInstr</span><span class="op" id="3170430">{</span><span class="op" id="3170431">*</span><span class="ident" id="3170432">op</span><span class="op" id="3170434">,</span>&nbsp;<span class="ident" id="3170436">fieldnum</span><span class="op" id="3170444">,</span>&nbsp;<span class="ident" id="3170446">localField</span><span class="op" id="3170456">.</span><span class="ident" id="3170457">Index</span><span class="op" id="3170462">,</span>&nbsp;<span class="ident" id="3170464">ovfl</span><span class="op" id="3170468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170472">engine</span><span class="op" id="3170478">.</span><span class="ident" id="3170479">numInstr</span><span class="op" id="3170487">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170494">return</span><br>
<span class="lineno"></span><span class="op" id="3170501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170504">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="3170566">func</span>&nbsp;<span class="op" id="3170571">(</span><span class="ident" id="3170572">dec</span>&nbsp;<span class="op" id="3170576">*</span><span class="ident" id="3170577">Decoder</span><span class="op" id="3170584">)</span>&nbsp;<span class="ident" id="3170586">getDecEnginePtr</span><span class="op" id="3170601">(</span><span class="ident" id="3170602">remoteId</span>&nbsp;<span class="ident" id="3170611">typeId</span><span class="op" id="3170617">,</span>&nbsp;<span class="ident" id="3170619">ut</span>&nbsp;<span class="op" id="3170622">*</span><span class="ident" id="3170623">userTypeInfo</span><span class="op" id="3170635">)</span>&nbsp;<span class="op" id="3170637">(</span><span class="ident" id="3170638">enginePtr</span>&nbsp;<span class="op" id="3170648">*</span><span class="op" id="3170649">*</span><span class="ident" id="3170650">decEngine</span><span class="op" id="3170659">,</span>&nbsp;<span class="ident" id="3170661">err</span>&nbsp;<span class="builtintype" id="3170665">error</span><span class="op" id="3170670">)</span>&nbsp;<span class="op" id="3170672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170675">rt</span>&nbsp;<span class="op" id="3170678">:=</span>&nbsp;<span class="ident" id="3170681">ut</span><span class="op" id="3170683">.</span><span class="ident" id="3170684">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170690">decoderMap</span><span class="op" id="3170700">,</span>&nbsp;<span class="ident" id="3170702">ok</span>&nbsp;<span class="op" id="3170705">:=</span>&nbsp;<span class="ident" id="3170708">dec</span><span class="op" id="3170711">.</span><span class="ident" id="3170712">decoderCache</span><span class="op" id="3170724">[</span><span class="ident" id="3170725">rt</span><span class="op" id="3170727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170730">if</span>&nbsp;<span class="op" id="3170733">!</span><span class="ident" id="3170734">ok</span>&nbsp;<span class="op" id="3170737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170741">decoderMap</span>&nbsp;<span class="op" id="3170752">=</span>&nbsp;<span class="builtinfunc" id="3170754">make</span><span class="op" id="3170758">(</span><span class="keyword" id="3170759">map</span><span class="op" id="3170762">[</span><span class="ident" id="3170763">typeId</span><span class="op" id="3170769">]</span><span class="op" id="3170770">*</span><span class="op" id="3170771">*</span><span class="ident" id="3170772">decEngine</span><span class="op" id="3170781">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170785">dec</span><span class="op" id="3170788">.</span><span class="ident" id="3170789">decoderCache</span><span class="op" id="3170801">[</span><span class="ident" id="3170802">rt</span><span class="op" id="3170804">]</span>&nbsp;<span class="op" id="3170806">=</span>&nbsp;<span class="ident" id="3170808">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170823">if</span>&nbsp;<span class="ident" id="3170826">enginePtr</span><span class="op" id="3170835">,</span>&nbsp;<span class="ident" id="3170837">ok</span>&nbsp;<span class="op" id="3170840">=</span>&nbsp;<span class="ident" id="3170842">decoderMap</span><span class="op" id="3170852">[</span><span class="ident" id="3170853">remoteId</span><span class="op" id="3170861">]</span><span class="op" id="3170862">;</span>&nbsp;<span class="op" id="3170864">!</span><span class="ident" id="3170865">ok</span>&nbsp;<span class="op" id="3170868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170872">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170951">enginePtr</span>&nbsp;<span class="op" id="3170961">=</span>&nbsp;<span class="builtinfunc" id="3170963">new</span><span class="op" id="3170966">(</span><span class="op" id="3170967">*</span><span class="ident" id="3170968">decEngine</span><span class="op" id="3170977">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170981">decoderMap</span><span class="op" id="3170991">[</span><span class="ident" id="3170992">remoteId</span><span class="op" id="3171000">]</span>&nbsp;<span class="op" id="3171002">=</span>&nbsp;<span class="ident" id="3171004">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171016">*</span><span class="ident" id="3171017">enginePtr</span><span class="op" id="3171026">,</span>&nbsp;<span class="ident" id="3171028">err</span>&nbsp;<span class="op" id="3171032">=</span>&nbsp;<span class="ident" id="3171034">dec</span><span class="op" id="3171037">.</span><span class="ident" id="3171038">compileDec</span><span class="op" id="3171048">(</span><span class="ident" id="3171049">remoteId</span><span class="op" id="3171057">,</span>&nbsp;<span class="ident" id="3171059">ut</span><span class="op" id="3171061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171065">if</span>&nbsp;<span class="ident" id="3171068">err</span>&nbsp;<span class="op" id="3171072">!=</span>&nbsp;<span class="ident" id="3171075">nil</span>&nbsp;<span class="op" id="3171079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3171084">delete</span><span class="op" id="3171090">(</span><span class="ident" id="3171091">decoderMap</span><span class="op" id="3171101">,</span>&nbsp;<span class="ident" id="3171103">remoteId</span><span class="op" id="3171111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171115">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171121">return</span><br>
<span class="lineno"></span><span class="op" id="3171128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171131">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="3171204">type</span>&nbsp;<span class="ident" id="3171209">emptyStruct</span>&nbsp;<span class="keyword" id="3171221">struct</span><span class="op" id="3171227">{</span><span class="op" id="3171228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3171231">var</span>&nbsp;<span class="ident" id="3171235">emptyStructType</span>&nbsp;<span class="op" id="3171251">=</span>&nbsp;<span class="ident" id="3171253">reflect</span><span class="op" id="3171260">.</span><span class="ident" id="3171261">TypeOf</span><span class="op" id="3171267">(</span><span class="ident" id="3171268">emptyStruct</span><span class="op" id="3171279">{</span><span class="op" id="3171280">}</span><span class="op" id="3171281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171284">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="3171380">func</span>&nbsp;<span class="op" id="3171385">(</span><span class="ident" id="3171386">dec</span>&nbsp;<span class="op" id="3171390">*</span><span class="ident" id="3171391">Decoder</span><span class="op" id="3171398">)</span>&nbsp;<span class="ident" id="3171400">getIgnoreEnginePtr</span><span class="op" id="3171418">(</span><span class="ident" id="3171419">wireId</span>&nbsp;<span class="ident" id="3171426">typeId</span><span class="op" id="3171432">)</span>&nbsp;<span class="op" id="3171434">(</span><span class="ident" id="3171435">enginePtr</span>&nbsp;<span class="op" id="3171445">*</span><span class="op" id="3171446">*</span><span class="ident" id="3171447">decEngine</span><span class="op" id="3171456">,</span>&nbsp;<span class="ident" id="3171458">err</span>&nbsp;<span class="builtintype" id="3171462">error</span><span class="op" id="3171467">)</span>&nbsp;<span class="op" id="3171469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171472">var</span>&nbsp;<span class="ident" id="3171476">ok</span>&nbsp;<span class="builtintype" id="3171479">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171485">if</span>&nbsp;<span class="ident" id="3171488">enginePtr</span><span class="op" id="3171497">,</span>&nbsp;<span class="ident" id="3171499">ok</span>&nbsp;<span class="op" id="3171502">=</span>&nbsp;<span class="ident" id="3171504">dec</span><span class="op" id="3171507">.</span><span class="ident" id="3171508">ignorerCache</span><span class="op" id="3171520">[</span><span class="ident" id="3171521">wireId</span><span class="op" id="3171527">]</span><span class="op" id="3171528">;</span>&nbsp;<span class="op" id="3171530">!</span><span class="ident" id="3171531">ok</span>&nbsp;<span class="op" id="3171534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3171538">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171617">enginePtr</span>&nbsp;<span class="op" id="3171627">=</span>&nbsp;<span class="builtinfunc" id="3171629">new</span><span class="op" id="3171632">(</span><span class="op" id="3171633">*</span><span class="ident" id="3171634">decEngine</span><span class="op" id="3171643">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171647">dec</span><span class="op" id="3171650">.</span><span class="ident" id="3171651">ignorerCache</span><span class="op" id="3171663">[</span><span class="ident" id="3171664">wireId</span><span class="op" id="3171670">]</span>&nbsp;<span class="op" id="3171672">=</span>&nbsp;<span class="ident" id="3171674">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171686">wire</span>&nbsp;<span class="op" id="3171691">:=</span>&nbsp;<span class="ident" id="3171694">dec</span><span class="op" id="3171697">.</span><span class="ident" id="3171698">wireType</span><span class="op" id="3171706">[</span><span class="ident" id="3171707">wireId</span><span class="op" id="3171713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171717">if</span>&nbsp;<span class="ident" id="3171720">wire</span>&nbsp;<span class="op" id="3171725">!=</span>&nbsp;<span class="ident" id="3171728">nil</span>&nbsp;<span class="op" id="3171732">&amp;&amp;</span>&nbsp;<span class="ident" id="3171735">wire</span><span class="op" id="3171739">.</span><span class="ident" id="3171740">StructT</span>&nbsp;<span class="op" id="3171748">!=</span>&nbsp;<span class="ident" id="3171751">nil</span>&nbsp;<span class="op" id="3171755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171760">*</span><span class="ident" id="3171761">enginePtr</span><span class="op" id="3171770">,</span>&nbsp;<span class="ident" id="3171772">err</span>&nbsp;<span class="op" id="3171776">=</span>&nbsp;<span class="ident" id="3171778">dec</span><span class="op" id="3171781">.</span><span class="ident" id="3171782">compileDec</span><span class="op" id="3171792">(</span><span class="ident" id="3171793">wireId</span><span class="op" id="3171799">,</span>&nbsp;<span class="ident" id="3171801">userType</span><span class="op" id="3171809">(</span><span class="ident" id="3171810">emptyStructType</span><span class="op" id="3171825">)</span><span class="op" id="3171826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171830">}</span>&nbsp;<span class="keyword" id="3171832">else</span>&nbsp;<span class="op" id="3171837">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171842">*</span><span class="ident" id="3171843">enginePtr</span><span class="op" id="3171852">,</span>&nbsp;<span class="ident" id="3171854">err</span>&nbsp;<span class="op" id="3171858">=</span>&nbsp;<span class="ident" id="3171860">dec</span><span class="op" id="3171863">.</span><span class="ident" id="3171864">compileIgnoreSingle</span><span class="op" id="3171883">(</span><span class="ident" id="3171884">wireId</span><span class="op" id="3171890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171898">if</span>&nbsp;<span class="ident" id="3171901">err</span>&nbsp;<span class="op" id="3171905">!=</span>&nbsp;<span class="ident" id="3171908">nil</span>&nbsp;<span class="op" id="3171912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3171917">delete</span><span class="op" id="3171923">(</span><span class="ident" id="3171924">dec</span><span class="op" id="3171927">.</span><span class="ident" id="3171928">ignorerCache</span><span class="op" id="3171940">,</span>&nbsp;<span class="ident" id="3171942">wireId</span><span class="op" id="3171948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171952">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171958">return</span><br>
<span class="lineno"></span><span class="op" id="3171965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171968">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="3172052">func</span>&nbsp;<span class="op" id="3172057">(</span><span class="ident" id="3172058">dec</span>&nbsp;<span class="op" id="3172062">*</span><span class="ident" id="3172063">Decoder</span><span class="op" id="3172070">)</span>&nbsp;<span class="ident" id="3172072">decodeValue</span><span class="op" id="3172083">(</span><span class="ident" id="3172084">wireId</span>&nbsp;<span class="ident" id="3172091">typeId</span><span class="op" id="3172097">,</span>&nbsp;<span class="ident" id="3172099">value</span>&nbsp;<span class="ident" id="3172105">reflect</span><span class="op" id="3172112">.</span><span class="ident" id="3172113">Value</span><span class="op" id="3172118">)</span>&nbsp;<span class="op" id="3172120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172123">defer</span>&nbsp;<span class="ident" id="3172129">catchError</span><span class="op" id="3172139">(</span><span class="op" id="3172140">&amp;</span><span class="ident" id="3172141">dec</span><span class="op" id="3172144">.</span><span class="ident" id="3172145">err</span><span class="op" id="3172148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3172151">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172218">if</span>&nbsp;<span class="op" id="3172221">!</span><span class="ident" id="3172222">value</span><span class="op" id="3172227">.</span><span class="ident" id="3172228">IsValid</span><span class="op" id="3172235">(</span><span class="op" id="3172236">)</span>&nbsp;<span class="op" id="3172238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172242">dec</span><span class="op" id="3172245">.</span><span class="ident" id="3172246">decodeIgnoredValue</span><span class="op" id="3172264">(</span><span class="ident" id="3172265">wireId</span><span class="op" id="3172271">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3172286">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172331">ut</span>&nbsp;<span class="op" id="3172334">:=</span>&nbsp;<span class="ident" id="3172337">userType</span><span class="op" id="3172345">(</span><span class="ident" id="3172346">value</span><span class="op" id="3172351">.</span><span class="ident" id="3172352">Type</span><span class="op" id="3172356">(</span><span class="op" id="3172357">)</span><span class="op" id="3172358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172361">base</span>&nbsp;<span class="op" id="3172366">:=</span>&nbsp;<span class="ident" id="3172369">ut</span><span class="op" id="3172371">.</span><span class="ident" id="3172372">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172378">var</span>&nbsp;<span class="ident" id="3172382">enginePtr</span>&nbsp;<span class="op" id="3172392">*</span><span class="op" id="3172393">*</span><span class="ident" id="3172394">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172405">enginePtr</span><span class="op" id="3172414">,</span>&nbsp;<span class="ident" id="3172416">dec</span><span class="op" id="3172419">.</span><span class="ident" id="3172420">err</span>&nbsp;<span class="op" id="3172424">=</span>&nbsp;<span class="ident" id="3172426">dec</span><span class="op" id="3172429">.</span><span class="ident" id="3172430">getDecEnginePtr</span><span class="op" id="3172445">(</span><span class="ident" id="3172446">wireId</span><span class="op" id="3172452">,</span>&nbsp;<span class="ident" id="3172454">ut</span><span class="op" id="3172456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172459">if</span>&nbsp;<span class="ident" id="3172462">dec</span><span class="op" id="3172465">.</span><span class="ident" id="3172466">err</span>&nbsp;<span class="op" id="3172470">!=</span>&nbsp;<span class="ident" id="3172473">nil</span>&nbsp;<span class="op" id="3172477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172489">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172492">value</span>&nbsp;<span class="op" id="3172498">=</span>&nbsp;<span class="ident" id="3172500">decAlloc</span><span class="op" id="3172508">(</span><span class="ident" id="3172509">value</span><span class="op" id="3172514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172517">engine</span>&nbsp;<span class="op" id="3172524">:=</span>&nbsp;<span class="op" id="3172527">*</span><span class="ident" id="3172528">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172539">if</span>&nbsp;<span class="ident" id="3172542">st</span>&nbsp;<span class="op" id="3172545">:=</span>&nbsp;<span class="ident" id="3172548">base</span><span class="op" id="3172552">;</span>&nbsp;<span class="ident" id="3172554">st</span><span class="op" id="3172556">.</span><span class="ident" id="3172557">Kind</span><span class="op" id="3172561">(</span><span class="op" id="3172562">)</span>&nbsp;<span class="op" id="3172564">==</span>&nbsp;<span class="ident" id="3172567">reflect</span><span class="op" id="3172574">.</span><span class="ident" id="3172575">Struct</span>&nbsp;<span class="op" id="3172582">&amp;&amp;</span>&nbsp;<span class="ident" id="3172585">ut</span><span class="op" id="3172587">.</span><span class="ident" id="3172588">externalDec</span>&nbsp;<span class="op" id="3172600">==</span>&nbsp;<span class="num" id="3172603">0</span>&nbsp;<span class="op" id="3172605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172609">if</span>&nbsp;<span class="ident" id="3172612">engine</span><span class="op" id="3172618">.</span><span class="ident" id="3172619">numInstr</span>&nbsp;<span class="op" id="3172628">==</span>&nbsp;<span class="num" id="3172631">0</span>&nbsp;<span class="op" id="3172633">&amp;&amp;</span>&nbsp;<span class="ident" id="3172636">st</span><span class="op" id="3172638">.</span><span class="ident" id="3172639">NumField</span><span class="op" id="3172647">(</span><span class="op" id="3172648">)</span>&nbsp;<span class="op" id="3172650">&gt;</span>&nbsp;<span class="num" id="3172652">0</span>&nbsp;<span class="op" id="3172654">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172660">dec</span><span class="op" id="3172663">.</span><span class="ident" id="3172664">wireType</span><span class="op" id="3172672">[</span><span class="ident" id="3172673">wireId</span><span class="op" id="3172679">]</span>&nbsp;<span class="op" id="3172681">!=</span>&nbsp;<span class="ident" id="3172684">nil</span>&nbsp;<span class="op" id="3172688">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3172691">len</span><span class="op" id="3172694">(</span><span class="ident" id="3172695">dec</span><span class="op" id="3172698">.</span><span class="ident" id="3172699">wireType</span><span class="op" id="3172707">[</span><span class="ident" id="3172708">wireId</span><span class="op" id="3172714">]</span><span class="op" id="3172715">.</span><span class="ident" id="3172716">StructT</span><span class="op" id="3172723">.</span><span class="ident" id="3172724">Field</span><span class="op" id="3172729">)</span>&nbsp;<span class="op" id="3172731">&gt;</span>&nbsp;<span class="num" id="3172733">0</span>&nbsp;<span class="op" id="3172735">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172740">name</span>&nbsp;<span class="op" id="3172745">:=</span>&nbsp;<span class="ident" id="3172748">base</span><span class="op" id="3172752">.</span><span class="ident" id="3172753">Name</span><span class="op" id="3172757">(</span><span class="op" id="3172758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172763">errorf</span><span class="op" id="3172769">(</span><span class="string" id="3172770">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="3172829">,</span>&nbsp;<span class="ident" id="3172831">name</span><span class="op" id="3172835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172843">dec</span><span class="op" id="3172846">.</span><span class="ident" id="3172847">decodeStruct</span><span class="op" id="3172859">(</span><span class="ident" id="3172860">engine</span><span class="op" id="3172866">,</span>&nbsp;<span class="ident" id="3172868">ut</span><span class="op" id="3172870">,</span>&nbsp;<span class="ident" id="3172872">value</span><span class="op" id="3172877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172880">}</span>&nbsp;<span class="keyword" id="3172882">else</span>&nbsp;<span class="op" id="3172887">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172891">dec</span><span class="op" id="3172894">.</span><span class="ident" id="3172895">decodeSingle</span><span class="op" id="3172907">(</span><span class="ident" id="3172908">engine</span><span class="op" id="3172914">,</span>&nbsp;<span class="ident" id="3172916">ut</span><span class="op" id="3172918">,</span>&nbsp;<span class="ident" id="3172920">value</span><span class="op" id="3172925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172928">}</span><br>
<span class="lineno"></span><span class="op" id="3172930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172933">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="3173039">func</span>&nbsp;<span class="op" id="3173044">(</span><span class="ident" id="3173045">dec</span>&nbsp;<span class="op" id="3173049">*</span><span class="ident" id="3173050">Decoder</span><span class="op" id="3173057">)</span>&nbsp;<span class="ident" id="3173059">decodeIgnoredValue</span><span class="op" id="3173077">(</span><span class="ident" id="3173078">wireId</span>&nbsp;<span class="ident" id="3173085">typeId</span><span class="op" id="3173091">)</span>&nbsp;<span class="op" id="3173093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173096">var</span>&nbsp;<span class="ident" id="3173100">enginePtr</span>&nbsp;<span class="op" id="3173110">*</span><span class="op" id="3173111">*</span><span class="ident" id="3173112">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173123">enginePtr</span><span class="op" id="3173132">,</span>&nbsp;<span class="ident" id="3173134">dec</span><span class="op" id="3173137">.</span><span class="ident" id="3173138">err</span>&nbsp;<span class="op" id="3173142">=</span>&nbsp;<span class="ident" id="3173144">dec</span><span class="op" id="3173147">.</span><span class="ident" id="3173148">getIgnoreEnginePtr</span><span class="op" id="3173166">(</span><span class="ident" id="3173167">wireId</span><span class="op" id="3173173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173176">if</span>&nbsp;<span class="ident" id="3173179">dec</span><span class="op" id="3173182">.</span><span class="ident" id="3173183">err</span>&nbsp;<span class="op" id="3173187">!=</span>&nbsp;<span class="ident" id="3173190">nil</span>&nbsp;<span class="op" id="3173194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173198">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173209">wire</span>&nbsp;<span class="op" id="3173214">:=</span>&nbsp;<span class="ident" id="3173217">dec</span><span class="op" id="3173220">.</span><span class="ident" id="3173221">wireType</span><span class="op" id="3173229">[</span><span class="ident" id="3173230">wireId</span><span class="op" id="3173236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173239">if</span>&nbsp;<span class="ident" id="3173242">wire</span>&nbsp;<span class="op" id="3173247">!=</span>&nbsp;<span class="ident" id="3173250">nil</span>&nbsp;<span class="op" id="3173254">&amp;&amp;</span>&nbsp;<span class="ident" id="3173257">wire</span><span class="op" id="3173261">.</span><span class="ident" id="3173262">StructT</span>&nbsp;<span class="op" id="3173270">!=</span>&nbsp;<span class="ident" id="3173273">nil</span>&nbsp;<span class="op" id="3173277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173281">dec</span><span class="op" id="3173284">.</span><span class="ident" id="3173285">ignoreStruct</span><span class="op" id="3173297">(</span><span class="op" id="3173298">*</span><span class="ident" id="3173299">enginePtr</span><span class="op" id="3173308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173311">}</span>&nbsp;<span class="keyword" id="3173313">else</span>&nbsp;<span class="op" id="3173318">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173322">dec</span><span class="op" id="3173325">.</span><span class="ident" id="3173326">ignoreSingle</span><span class="op" id="3173338">(</span><span class="op" id="3173339">*</span><span class="ident" id="3173340">enginePtr</span><span class="op" id="3173349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173352">}</span><br>
<span class="lineno"></span><span class="op" id="3173354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3173357">func</span>&nbsp;<span class="ident" id="3173362">init</span><span class="op" id="3173366">(</span><span class="op" id="3173367">)</span>&nbsp;<span class="op" id="3173369">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173372">var</span>&nbsp;<span class="ident" id="3173376">iop</span><span class="op" id="3173379">,</span>&nbsp;<span class="ident" id="3173381">uop</span>&nbsp;<span class="ident" id="3173385">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173392">switch</span>&nbsp;<span class="ident" id="3173399">reflect</span><span class="op" id="3173406">.</span><span class="ident" id="3173407">TypeOf</span><span class="op" id="3173413">(</span><span class="builtintype" id="3173414">int</span><span class="op" id="3173417">(</span><span class="num" id="3173418">0</span><span class="op" id="3173419">)</span><span class="op" id="3173420">)</span><span class="op" id="3173421">.</span><span class="ident" id="3173422">Bits</span><span class="op" id="3173426">(</span><span class="op" id="3173427">)</span>&nbsp;<span class="op" id="3173429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173432">case</span>&nbsp;<span class="num" id="3173437">32</span><span class="op" id="3173439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173443">iop</span>&nbsp;<span class="op" id="3173447">=</span>&nbsp;<span class="ident" id="3173449">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173460">uop</span>&nbsp;<span class="op" id="3173464">=</span>&nbsp;<span class="ident" id="3173466">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173477">case</span>&nbsp;<span class="num" id="3173482">64</span><span class="op" id="3173484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173488">iop</span>&nbsp;<span class="op" id="3173492">=</span>&nbsp;<span class="ident" id="3173494">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173505">uop</span>&nbsp;<span class="op" id="3173509">=</span>&nbsp;<span class="ident" id="3173511">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173522">default</span><span class="op" id="3173529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3173533">panic</span><span class="op" id="3173538">(</span><span class="string" id="3173539">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="3173570">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173576">decOpTable</span><span class="op" id="3173586">[</span><span class="ident" id="3173587">reflect</span><span class="op" id="3173594">.</span><span class="ident" id="3173595">Int</span><span class="op" id="3173598">]</span>&nbsp;<span class="op" id="3173600">=</span>&nbsp;<span class="ident" id="3173602">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173607">decOpTable</span><span class="op" id="3173617">[</span><span class="ident" id="3173618">reflect</span><span class="op" id="3173625">.</span><span class="ident" id="3173626">Uint</span><span class="op" id="3173630">]</span>&nbsp;<span class="op" id="3173632">=</span>&nbsp;<span class="ident" id="3173634">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3173640">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173660">switch</span>&nbsp;<span class="ident" id="3173667">reflect</span><span class="op" id="3173674">.</span><span class="ident" id="3173675">TypeOf</span><span class="op" id="3173681">(</span><span class="builtintype" id="3173682">uintptr</span><span class="op" id="3173689">(</span><span class="num" id="3173690">0</span><span class="op" id="3173691">)</span><span class="op" id="3173692">)</span><span class="op" id="3173693">.</span><span class="ident" id="3173694">Bits</span><span class="op" id="3173698">(</span><span class="op" id="3173699">)</span>&nbsp;<span class="op" id="3173701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173704">case</span>&nbsp;<span class="num" id="3173709">32</span><span class="op" id="3173711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173715">uop</span>&nbsp;<span class="op" id="3173719">=</span>&nbsp;<span class="ident" id="3173721">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173732">case</span>&nbsp;<span class="num" id="3173737">64</span><span class="op" id="3173739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173743">uop</span>&nbsp;<span class="op" id="3173747">=</span>&nbsp;<span class="ident" id="3173749">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173760">default</span><span class="op" id="3173767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3173771">panic</span><span class="op" id="3173776">(</span><span class="string" id="3173777">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="3173807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173813">decOpTable</span><span class="op" id="3173823">[</span><span class="ident" id="3173824">reflect</span><span class="op" id="3173831">.</span><span class="ident" id="3173832">Uintptr</span><span class="op" id="3173839">]</span>&nbsp;<span class="op" id="3173841">=</span>&nbsp;<span class="ident" id="3173843">uop</span><br>
<span class="lineno"></span><span class="op" id="3173847">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="3173850">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3173899">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="3173959">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="3173992">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="3174021">func</span>&nbsp;<span class="ident" id="3174026">allocValue</span><span class="op" id="3174036">(</span><span class="ident" id="3174037">t</span>&nbsp;<span class="ident" id="3174039">reflect</span><span class="op" id="3174046">.</span><span class="ident" id="3174047">Type</span><span class="op" id="3174051">)</span>&nbsp;<span class="ident" id="3174053">reflect</span><span class="op" id="3174060">.</span><span class="ident" id="3174061">Value</span>&nbsp;<span class="op" id="3174067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174070">return</span>&nbsp;<span class="ident" id="3174077">reflect</span><span class="op" id="3174084">.</span><span class="ident" id="3174085">New</span><span class="op" id="3174088">(</span><span class="ident" id="3174089">t</span><span class="op" id="3174090">)</span><span class="op" id="3174091">.</span><span class="ident" id="3174092">Elem</span><span class="op" id="3174096">(</span><span class="op" id="3174097">)</span><br>
<span class="lineno"></span><span class="op" id="3174099">}</span>
</div>
</body>
</html>
