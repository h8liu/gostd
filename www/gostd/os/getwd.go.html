<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2483182">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2483237">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2483291">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2483342">package</span>&nbsp;<span class="ident" id="2483350">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2483354">import</span>&nbsp;<span class="op" id="2483361">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483364">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483375">&#34;sync&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483383">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2483393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2483396">var</span>&nbsp;<span class="ident" id="2483400">getwdCache</span>&nbsp;<span class="keyword" id="2483411">struct</span>&nbsp;<span class="op" id="2483418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483421">sync</span><span class="op" id="2483425">.</span><span class="ident" id="2483426">Mutex</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483433">dir</span>&nbsp;<span class="builtintype" id="2483437">string</span><br>
<span class="lineno"></span><span class="op" id="2483444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2483447">//&nbsp;useSyscallwd&nbsp;determines&nbsp;whether&nbsp;to&nbsp;use&nbsp;the&nbsp;return&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2483509">//&nbsp;syscall.Getwd&nbsp;based&nbsp;on&nbsp;its&nbsp;error.</span><br>
<span class="lineno">20</span><span class="keyword" id="2483546">var</span>&nbsp;<span class="ident" id="2483550">useSyscallwd</span>&nbsp;<span class="op" id="2483563">=</span>&nbsp;<span class="keyword" id="2483565">func</span><span class="op" id="2483569">(</span><span class="builtintype" id="2483570">error</span><span class="op" id="2483575">)</span>&nbsp;<span class="builtintype" id="2483577">bool</span>&nbsp;<span class="op" id="2483582">{</span>&nbsp;<span class="keyword" id="2483584">return</span>&nbsp;<span class="builtintype" id="2483591">true</span>&nbsp;<span class="op" id="2483596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2483599">//&nbsp;Getwd&nbsp;returns&nbsp;a&nbsp;rooted&nbsp;path&nbsp;name&nbsp;corresponding&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2483656">//&nbsp;current&nbsp;directory.&nbsp;&nbsp;If&nbsp;the&nbsp;current&nbsp;directory&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2483711">//&nbsp;reached&nbsp;via&nbsp;multiple&nbsp;paths&nbsp;(due&nbsp;to&nbsp;symbolic&nbsp;links),</span><br>
<span class="lineno">25</span><span class="comment" id="2483766">//&nbsp;Getwd&nbsp;may&nbsp;return&nbsp;any&nbsp;one&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="2483803">func</span>&nbsp;<span class="ident" id="2483808">Getwd</span><span class="op" id="2483813">(</span><span class="op" id="2483814">)</span>&nbsp;<span class="op" id="2483816">(</span><span class="ident" id="2483817">dir</span>&nbsp;<span class="builtintype" id="2483821">string</span><span class="op" id="2483827">,</span>&nbsp;<span class="ident" id="2483829">err</span>&nbsp;<span class="builtintype" id="2483833">error</span><span class="op" id="2483838">)</span>&nbsp;<span class="op" id="2483840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2483843">if</span>&nbsp;<span class="ident" id="2483846">runtime</span><span class="op" id="2483853">.</span><span class="ident" id="2483854">GOOS</span>&nbsp;<span class="op" id="2483859">==</span>&nbsp;<span class="string" id="2483862">&#34;windows&#34;</span>&nbsp;<span class="op" id="2483872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2483876">return</span>&nbsp;<span class="ident" id="2483883">syscall</span><span class="op" id="2483890">.</span><span class="ident" id="2483891">Getwd</span><span class="op" id="2483896">(</span><span class="op" id="2483897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2483900">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2483904">//&nbsp;Clumsy&nbsp;but&nbsp;widespread&nbsp;kludge:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2483938">//&nbsp;if&nbsp;$PWD&nbsp;is&nbsp;set&nbsp;and&nbsp;matches&nbsp;&#34;.&#34;,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483982">dot</span><span class="op" id="2483985">,</span>&nbsp;<span class="ident" id="2483987">err</span>&nbsp;<span class="op" id="2483991">:=</span>&nbsp;<span class="ident" id="2483994">Stat</span><span class="op" id="2483998">(</span><span class="string" id="2483999">&#34;.&#34;</span><span class="op" id="2484002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484005">if</span>&nbsp;<span class="ident" id="2484008">err</span>&nbsp;<span class="op" id="2484012">!=</span>&nbsp;<span class="ident" id="2484015">nil</span>&nbsp;<span class="op" id="2484019">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484023">return</span>&nbsp;<span class="string" id="2484030">&#34;&#34;</span><span class="op" id="2484032">,</span>&nbsp;<span class="ident" id="2484034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484042">dir</span>&nbsp;<span class="op" id="2484046">=</span>&nbsp;<span class="ident" id="2484048">Getenv</span><span class="op" id="2484054">(</span><span class="string" id="2484055">&#34;PWD&#34;</span><span class="op" id="2484060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484063">if</span>&nbsp;<span class="builtinfunc" id="2484066">len</span><span class="op" id="2484069">(</span><span class="ident" id="2484070">dir</span><span class="op" id="2484073">)</span>&nbsp;<span class="op" id="2484075">&gt;</span>&nbsp;<span class="num" id="2484077">0</span>&nbsp;<span class="op" id="2484079">&amp;&amp;</span>&nbsp;<span class="ident" id="2484082">dir</span><span class="op" id="2484085">[</span><span class="num" id="2484086">0</span><span class="op" id="2484087">]</span>&nbsp;<span class="op" id="2484089">==</span>&nbsp;<span class="string" id="2484092">&#39;/&#39;</span>&nbsp;<span class="op" id="2484096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484100">d</span><span class="op" id="2484101">,</span>&nbsp;<span class="ident" id="2484103">err</span>&nbsp;<span class="op" id="2484107">:=</span>&nbsp;<span class="ident" id="2484110">Stat</span><span class="op" id="2484114">(</span><span class="ident" id="2484115">dir</span><span class="op" id="2484118">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484122">if</span>&nbsp;<span class="ident" id="2484125">err</span>&nbsp;<span class="op" id="2484129">==</span>&nbsp;<span class="ident" id="2484132">nil</span>&nbsp;<span class="op" id="2484136">&amp;&amp;</span>&nbsp;<span class="ident" id="2484139">SameFile</span><span class="op" id="2484147">(</span><span class="ident" id="2484148">dot</span><span class="op" id="2484151">,</span>&nbsp;<span class="ident" id="2484153">d</span><span class="op" id="2484154">)</span>&nbsp;<span class="op" id="2484156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484161">return</span>&nbsp;<span class="ident" id="2484168">dir</span><span class="op" id="2484171">,</span>&nbsp;<span class="ident" id="2484173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484186">//&nbsp;If&nbsp;the&nbsp;operating&nbsp;system&nbsp;provides&nbsp;a&nbsp;Getwd&nbsp;call,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484245">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;our&nbsp;way&nbsp;back&nbsp;to&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484302">if</span>&nbsp;<span class="ident" id="2484305">syscall</span><span class="op" id="2484312">.</span><span class="ident" id="2484313">ImplementsGetwd</span>&nbsp;<span class="op" id="2484329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484333">s</span><span class="op" id="2484334">,</span>&nbsp;<span class="ident" id="2484336">e</span>&nbsp;<span class="op" id="2484338">:=</span>&nbsp;<span class="ident" id="2484341">syscall</span><span class="op" id="2484348">.</span><span class="ident" id="2484349">Getwd</span><span class="op" id="2484354">(</span><span class="op" id="2484355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484359">if</span>&nbsp;<span class="ident" id="2484362">useSyscallwd</span><span class="op" id="2484374">(</span><span class="ident" id="2484375">e</span><span class="op" id="2484376">)</span>&nbsp;<span class="op" id="2484378">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484383">return</span>&nbsp;<span class="ident" id="2484390">s</span><span class="op" id="2484391">,</span>&nbsp;<span class="ident" id="2484393">NewSyscallError</span><span class="op" id="2484408">(</span><span class="string" id="2484409">&#34;getwd&#34;</span><span class="op" id="2484416">,</span>&nbsp;<span class="ident" id="2484418">e</span><span class="op" id="2484419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484430">//&nbsp;Apply&nbsp;same&nbsp;kludge&nbsp;but&nbsp;to&nbsp;cached&nbsp;dir&nbsp;instead&nbsp;of&nbsp;$PWD.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484487">getwdCache</span><span class="op" id="2484497">.</span><span class="ident" id="2484498">Lock</span><span class="op" id="2484502">(</span><span class="op" id="2484503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484506">dir</span>&nbsp;<span class="op" id="2484510">=</span>&nbsp;<span class="ident" id="2484512">getwdCache</span><span class="op" id="2484522">.</span><span class="ident" id="2484523">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484528">getwdCache</span><span class="op" id="2484538">.</span><span class="ident" id="2484539">Unlock</span><span class="op" id="2484545">(</span><span class="op" id="2484546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484549">if</span>&nbsp;<span class="builtinfunc" id="2484552">len</span><span class="op" id="2484555">(</span><span class="ident" id="2484556">dir</span><span class="op" id="2484559">)</span>&nbsp;<span class="op" id="2484561">&gt;</span>&nbsp;<span class="num" id="2484563">0</span>&nbsp;<span class="op" id="2484565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484569">d</span><span class="op" id="2484570">,</span>&nbsp;<span class="ident" id="2484572">err</span>&nbsp;<span class="op" id="2484576">:=</span>&nbsp;<span class="ident" id="2484579">Stat</span><span class="op" id="2484583">(</span><span class="ident" id="2484584">dir</span><span class="op" id="2484587">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484591">if</span>&nbsp;<span class="ident" id="2484594">err</span>&nbsp;<span class="op" id="2484598">==</span>&nbsp;<span class="ident" id="2484601">nil</span>&nbsp;<span class="op" id="2484605">&amp;&amp;</span>&nbsp;<span class="ident" id="2484608">SameFile</span><span class="op" id="2484616">(</span><span class="ident" id="2484617">dot</span><span class="op" id="2484620">,</span>&nbsp;<span class="ident" id="2484622">d</span><span class="op" id="2484623">)</span>&nbsp;<span class="op" id="2484625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484630">return</span>&nbsp;<span class="ident" id="2484637">dir</span><span class="op" id="2484640">,</span>&nbsp;<span class="ident" id="2484642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484655">//&nbsp;Root&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;because&nbsp;it&nbsp;has&nbsp;no&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484707">//&nbsp;and&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484732">root</span><span class="op" id="2484736">,</span>&nbsp;<span class="ident" id="2484738">err</span>&nbsp;<span class="op" id="2484742">:=</span>&nbsp;<span class="ident" id="2484745">Stat</span><span class="op" id="2484749">(</span><span class="string" id="2484750">&#34;/&#34;</span><span class="op" id="2484753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484756">if</span>&nbsp;<span class="ident" id="2484759">err</span>&nbsp;<span class="op" id="2484763">!=</span>&nbsp;<span class="ident" id="2484766">nil</span>&nbsp;<span class="op" id="2484770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484774">//&nbsp;Can&#39;t&nbsp;stat&nbsp;root&nbsp;-&nbsp;no&nbsp;hope.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484806">return</span>&nbsp;<span class="string" id="2484813">&#34;&#34;</span><span class="op" id="2484815">,</span>&nbsp;<span class="ident" id="2484817">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484825">if</span>&nbsp;<span class="ident" id="2484828">SameFile</span><span class="op" id="2484836">(</span><span class="ident" id="2484837">root</span><span class="op" id="2484841">,</span>&nbsp;<span class="ident" id="2484843">dot</span><span class="op" id="2484846">)</span>&nbsp;<span class="op" id="2484848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484852">return</span>&nbsp;<span class="string" id="2484859">&#34;/&#34;</span><span class="op" id="2484862">,</span>&nbsp;<span class="ident" id="2484864">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484869">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484873">//&nbsp;General&nbsp;algorithm:&nbsp;find&nbsp;name&nbsp;in&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484916">//&nbsp;and&nbsp;then&nbsp;find&nbsp;name&nbsp;of&nbsp;parent.&nbsp;&nbsp;Each&nbsp;iteration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2484966">//&nbsp;adds&nbsp;/name&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485006">dir</span>&nbsp;<span class="op" id="2485010">=</span>&nbsp;<span class="string" id="2485012">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485016">for</span>&nbsp;<span class="ident" id="2485020">parent</span>&nbsp;<span class="op" id="2485027">:=</span>&nbsp;<span class="string" id="2485030">&#34;..&#34;</span><span class="op" id="2485034">;</span>&nbsp;<span class="op" id="2485036">;</span>&nbsp;<span class="ident" id="2485038">parent</span>&nbsp;<span class="op" id="2485045">=</span>&nbsp;<span class="string" id="2485047">&#34;../&#34;</span>&nbsp;<span class="op" id="2485053">+</span>&nbsp;<span class="ident" id="2485055">parent</span>&nbsp;<span class="op" id="2485062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485066">if</span>&nbsp;<span class="builtinfunc" id="2485069">len</span><span class="op" id="2485072">(</span><span class="ident" id="2485073">parent</span><span class="op" id="2485079">)</span>&nbsp;<span class="op" id="2485081">&gt;=</span>&nbsp;<span class="num" id="2485084">1024</span>&nbsp;<span class="op" id="2485089">{</span>&nbsp;<span class="comment" id="2485091">//&nbsp;Sanity&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485110">return</span>&nbsp;<span class="string" id="2485117">&#34;&#34;</span><span class="op" id="2485119">,</span>&nbsp;<span class="ident" id="2485121">syscall</span><span class="op" id="2485128">.</span><span class="ident" id="2485129">ENAMETOOLONG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485148">fd</span><span class="op" id="2485150">,</span>&nbsp;<span class="ident" id="2485152">err</span>&nbsp;<span class="op" id="2485156">:=</span>&nbsp;<span class="ident" id="2485159">Open</span><span class="op" id="2485163">(</span><span class="ident" id="2485164">parent</span><span class="op" id="2485170">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485174">if</span>&nbsp;<span class="ident" id="2485177">err</span>&nbsp;<span class="op" id="2485181">!=</span>&nbsp;<span class="ident" id="2485184">nil</span>&nbsp;<span class="op" id="2485188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485193">return</span>&nbsp;<span class="string" id="2485200">&#34;&#34;</span><span class="op" id="2485202">,</span>&nbsp;<span class="ident" id="2485204">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485215">for</span>&nbsp;<span class="op" id="2485219">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485224">names</span><span class="op" id="2485229">,</span>&nbsp;<span class="ident" id="2485231">err</span>&nbsp;<span class="op" id="2485235">:=</span>&nbsp;<span class="ident" id="2485238">fd</span><span class="op" id="2485240">.</span><span class="ident" id="2485241">Readdirnames</span><span class="op" id="2485253">(</span><span class="num" id="2485254">100</span><span class="op" id="2485257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485262">if</span>&nbsp;<span class="ident" id="2485265">err</span>&nbsp;<span class="op" id="2485269">!=</span>&nbsp;<span class="ident" id="2485272">nil</span>&nbsp;<span class="op" id="2485276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485282">fd</span><span class="op" id="2485284">.</span><span class="ident" id="2485285">Close</span><span class="op" id="2485290">(</span><span class="op" id="2485291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485297">return</span>&nbsp;<span class="string" id="2485304">&#34;&#34;</span><span class="op" id="2485306">,</span>&nbsp;<span class="ident" id="2485308">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485315">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485320">for</span>&nbsp;<span class="ident" id="2485324">_</span><span class="op" id="2485325">,</span>&nbsp;<span class="ident" id="2485327">name</span>&nbsp;<span class="op" id="2485332">:=</span>&nbsp;<span class="keyword" id="2485335">range</span>&nbsp;<span class="ident" id="2485341">names</span>&nbsp;<span class="op" id="2485347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485353">d</span><span class="op" id="2485354">,</span>&nbsp;<span class="ident" id="2485356">_</span>&nbsp;<span class="op" id="2485358">:=</span>&nbsp;<span class="ident" id="2485361">Lstat</span><span class="op" id="2485366">(</span><span class="ident" id="2485367">parent</span>&nbsp;<span class="op" id="2485374">+</span>&nbsp;<span class="string" id="2485376">&#34;/&#34;</span>&nbsp;<span class="op" id="2485380">+</span>&nbsp;<span class="ident" id="2485382">name</span><span class="op" id="2485386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485392">if</span>&nbsp;<span class="ident" id="2485395">SameFile</span><span class="op" id="2485403">(</span><span class="ident" id="2485404">d</span><span class="op" id="2485405">,</span>&nbsp;<span class="ident" id="2485407">dot</span><span class="op" id="2485410">)</span>&nbsp;<span class="op" id="2485412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485419">dir</span>&nbsp;<span class="op" id="2485423">=</span>&nbsp;<span class="string" id="2485425">&#34;/&#34;</span>&nbsp;<span class="op" id="2485429">+</span>&nbsp;<span class="ident" id="2485431">name</span>&nbsp;<span class="op" id="2485436">+</span>&nbsp;<span class="ident" id="2485438">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485447">goto</span>&nbsp;<span class="ident" id="2485452">Found</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485475">Found</span><span class="op" id="2485480">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485484">pd</span><span class="op" id="2485486">,</span>&nbsp;<span class="ident" id="2485488">err</span>&nbsp;<span class="op" id="2485492">:=</span>&nbsp;<span class="ident" id="2485495">fd</span><span class="op" id="2485497">.</span><span class="ident" id="2485498">Stat</span><span class="op" id="2485502">(</span><span class="op" id="2485503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485507">if</span>&nbsp;<span class="ident" id="2485510">err</span>&nbsp;<span class="op" id="2485514">!=</span>&nbsp;<span class="ident" id="2485517">nil</span>&nbsp;<span class="op" id="2485521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485526">return</span>&nbsp;<span class="string" id="2485533">&#34;&#34;</span><span class="op" id="2485535">,</span>&nbsp;<span class="ident" id="2485537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485547">fd</span><span class="op" id="2485549">.</span><span class="ident" id="2485550">Close</span><span class="op" id="2485555">(</span><span class="op" id="2485556">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485560">if</span>&nbsp;<span class="ident" id="2485563">SameFile</span><span class="op" id="2485571">(</span><span class="ident" id="2485572">pd</span><span class="op" id="2485574">,</span>&nbsp;<span class="ident" id="2485576">root</span><span class="op" id="2485580">)</span>&nbsp;<span class="op" id="2485582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485587">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2485599">//&nbsp;Set&nbsp;up&nbsp;for&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485627">dot</span>&nbsp;<span class="op" id="2485631">=</span>&nbsp;<span class="ident" id="2485633">pd</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2485641">//&nbsp;Save&nbsp;answer&nbsp;as&nbsp;hint&nbsp;to&nbsp;avoid&nbsp;the&nbsp;expensive&nbsp;path&nbsp;next&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485704">getwdCache</span><span class="op" id="2485714">.</span><span class="ident" id="2485715">Lock</span><span class="op" id="2485719">(</span><span class="op" id="2485720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485723">getwdCache</span><span class="op" id="2485733">.</span><span class="ident" id="2485734">dir</span>&nbsp;<span class="op" id="2485738">=</span>&nbsp;<span class="ident" id="2485740">dir</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485745">getwdCache</span><span class="op" id="2485755">.</span><span class="ident" id="2485756">Unlock</span><span class="op" id="2485762">(</span><span class="op" id="2485763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485767">return</span>&nbsp;<span class="ident" id="2485774">dir</span><span class="op" id="2485777">,</span>&nbsp;<span class="ident" id="2485779">nil</span><br>
<span class="lineno"></span><span class="op" id="2485783">}</span>
</div>
</body>
</html>
