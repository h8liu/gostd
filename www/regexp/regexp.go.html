<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5187216">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5187271">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5187325">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5187376">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="5187432">//</span><br>
<span class="lineno"></span><span class="comment" id="5187435">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5187497">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="5187558">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="5187627">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="5187687">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5187725">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="5187750">//</span><br>
<span class="lineno"></span><span class="comment" id="5187753">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="5187810">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5187872">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="5187930">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5187995">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5188023">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="5188068">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="5188106">//</span><br>
<span class="lineno"></span><span class="comment" id="5188109">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="5188158">//</span><br>
<span class="lineno"></span><span class="comment" id="5188161">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="5188240">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="5188314">//</span><br>
<span class="lineno"></span><span class="comment" id="5188317">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="5188359">//</span><br>
<span class="lineno"></span><span class="comment" id="5188362">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="5188433">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5188506">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5188583">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="5188661">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5188736">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="5188759">//</span><br>
<span class="lineno"></span><span class="comment" id="5188762">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5188839">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="5188895">//</span><br>
<span class="lineno"></span><span class="comment" id="5188898">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="5188971">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5189041">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5189117">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="5189188">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5189265">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="5189331">//</span><br>
<span class="lineno"></span><span class="comment" id="5189334">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="5189412">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5189490">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5189565">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="5189639">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5189710">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="5189766">//</span><br>
<span class="lineno"></span><span class="comment" id="5189769">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="5189843">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="5189865">//</span><br>
<span class="lineno"></span><span class="comment" id="5189868">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="5189925">//</span><br>
<span class="lineno"></span><span class="comment" id="5189928">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5190000">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="5190073">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="5190145">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="5190166">//</span><br>
<span class="lineno"></span><span class="comment" id="5190169">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="5190236">//</span><br>
<span class="lineno">65</span><span class="keyword" id="5190239">package</span>&nbsp;<span class="ident" id="5190247">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5190255">import</span>&nbsp;<span class="op" id="5190262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190265">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190274">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190280">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190297">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190308">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190319">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190327">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5190338">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5190353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5190356">var</span>&nbsp;<span class="ident" id="5190360">debug</span>&nbsp;<span class="op" id="5190366">=</span>&nbsp;<span class="ident" id="5190368">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5190375">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5190441">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5190504">type</span>&nbsp;<span class="ident" id="5190509">Regexp</span>&nbsp;<span class="keyword" id="5190516">struct</span>&nbsp;<span class="op" id="5190523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5190526">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190554">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190569">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190584">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190609">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5190624">*</span><span class="ident" id="5190625">syntax</span><span class="op" id="5190631">.</span><span class="ident" id="5190632">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5190639">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190660">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5190675">*</span><span class="ident" id="5190676">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5190690">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190716">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190731">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190746">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190788">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5190803">[</span><span class="op" id="5190804">]</span><span class="builtintype" id="5190805">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190818">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190842">prefixComplete</span>&nbsp;<span class="builtintype" id="5190857">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190872">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190904">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190919">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190934">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190959">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5190974">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5190989">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191020">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5191035">syntax</span><span class="op" id="5191041">.</span><span class="ident" id="5191042">EmptyOp</span>&nbsp;<span class="comment" id="5191050">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191104">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5191119">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191124">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5191139">[</span><span class="op" id="5191140">]</span><span class="builtintype" id="5191141">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191149">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5191164">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191171">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191212">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5191220">sync</span><span class="op" id="5191224">.</span><span class="ident" id="5191225">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191232">machine</span>&nbsp;<span class="op" id="5191240">[</span><span class="op" id="5191241">]</span><span class="op" id="5191242">*</span><span class="ident" id="5191243">machine</span><br>
<span class="lineno">100</span><span class="op" id="5191251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5191254">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5191328">func</span>&nbsp;<span class="op" id="5191333">(</span><span class="ident" id="5191334">re</span>&nbsp;<span class="op" id="5191337">*</span><span class="ident" id="5191338">Regexp</span><span class="op" id="5191344">)</span>&nbsp;<span class="ident" id="5191346">String</span><span class="op" id="5191352">(</span><span class="op" id="5191353">)</span>&nbsp;<span class="builtintype" id="5191355">string</span>&nbsp;<span class="op" id="5191362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191365">return</span>&nbsp;<span class="ident" id="5191372">re</span><span class="op" id="5191374">.</span><span class="ident" id="5191375">expr</span><br>
<span class="lineno">105</span><span class="op" id="5191380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5191383">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="5191450">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5191509">//</span><br>
<span class="lineno">110</span><span class="comment" id="5191512">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5191575">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5191647">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="5191720">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5191784">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="5191851">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="5191913">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="5191971">func</span>&nbsp;<span class="ident" id="5191976">Compile</span><span class="op" id="5191983">(</span><span class="ident" id="5191984">expr</span>&nbsp;<span class="builtintype" id="5191989">string</span><span class="op" id="5191995">)</span>&nbsp;<span class="op" id="5191997">(</span><span class="op" id="5191998">*</span><span class="ident" id="5191999">Regexp</span><span class="op" id="5192005">,</span>&nbsp;<span class="builtintype" id="5192007">error</span><span class="op" id="5192012">)</span>&nbsp;<span class="op" id="5192014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192017">return</span>&nbsp;<span class="ident" id="5192024">compile</span><span class="op" id="5192031">(</span><span class="ident" id="5192032">expr</span><span class="op" id="5192036">,</span>&nbsp;<span class="ident" id="5192038">syntax</span><span class="op" id="5192044">.</span><span class="ident" id="5192045">Perl</span><span class="op" id="5192049">,</span>&nbsp;<span class="ident" id="5192051">false</span><span class="op" id="5192056">)</span><br>
<span class="lineno"></span><span class="op" id="5192058">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="5192061">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5192130">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5192196">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="5192217">//</span><br>
<span class="lineno">125</span><span class="comment" id="5192220">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5192292">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5192364">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="5192415">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="5192481">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="5192550">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="5192564">//</span><br>
<span class="lineno"></span><span class="comment" id="5192567">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="5192642">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="5192706">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="5192775">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="5192849">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5192923">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="5192988">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="5193064">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="5193132">func</span>&nbsp;<span class="ident" id="5193137">CompilePOSIX</span><span class="op" id="5193149">(</span><span class="ident" id="5193150">expr</span>&nbsp;<span class="builtintype" id="5193155">string</span><span class="op" id="5193161">)</span>&nbsp;<span class="op" id="5193163">(</span><span class="op" id="5193164">*</span><span class="ident" id="5193165">Regexp</span><span class="op" id="5193171">,</span>&nbsp;<span class="builtintype" id="5193173">error</span><span class="op" id="5193178">)</span>&nbsp;<span class="op" id="5193180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193183">return</span>&nbsp;<span class="ident" id="5193190">compile</span><span class="op" id="5193197">(</span><span class="ident" id="5193198">expr</span><span class="op" id="5193202">,</span>&nbsp;<span class="ident" id="5193204">syntax</span><span class="op" id="5193210">.</span><span class="ident" id="5193211">POSIX</span><span class="op" id="5193216">,</span>&nbsp;<span class="ident" id="5193218">true</span><span class="op" id="5193222">)</span><br>
<span class="lineno"></span><span class="op" id="5193224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5193227">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="5193295">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5193367">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="5193439">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5193490">func</span>&nbsp;<span class="op" id="5193495">(</span><span class="ident" id="5193496">re</span>&nbsp;<span class="op" id="5193499">*</span><span class="ident" id="5193500">Regexp</span><span class="op" id="5193506">)</span>&nbsp;<span class="ident" id="5193508">Longest</span><span class="op" id="5193515">(</span><span class="op" id="5193516">)</span>&nbsp;<span class="op" id="5193518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193521">re</span><span class="op" id="5193523">.</span><span class="ident" id="5193524">longest</span>&nbsp;<span class="op" id="5193532">=</span>&nbsp;<span class="ident" id="5193534">true</span><br>
<span class="lineno">150</span><span class="op" id="5193539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5193542">func</span>&nbsp;<span class="ident" id="5193547">compile</span><span class="op" id="5193554">(</span><span class="ident" id="5193555">expr</span>&nbsp;<span class="builtintype" id="5193560">string</span><span class="op" id="5193566">,</span>&nbsp;<span class="ident" id="5193568">mode</span>&nbsp;<span class="ident" id="5193573">syntax</span><span class="op" id="5193579">.</span><span class="ident" id="5193580">Flags</span><span class="op" id="5193585">,</span>&nbsp;<span class="ident" id="5193587">longest</span>&nbsp;<span class="builtintype" id="5193595">bool</span><span class="op" id="5193599">)</span>&nbsp;<span class="op" id="5193601">(</span><span class="op" id="5193602">*</span><span class="ident" id="5193603">Regexp</span><span class="op" id="5193609">,</span>&nbsp;<span class="builtintype" id="5193611">error</span><span class="op" id="5193616">)</span>&nbsp;<span class="op" id="5193618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193621">re</span><span class="op" id="5193623">,</span>&nbsp;<span class="ident" id="5193625">err</span>&nbsp;<span class="op" id="5193629">:=</span>&nbsp;<span class="ident" id="5193632">syntax</span><span class="op" id="5193638">.</span><span class="ident" id="5193639">Parse</span><span class="op" id="5193644">(</span><span class="ident" id="5193645">expr</span><span class="op" id="5193649">,</span>&nbsp;<span class="ident" id="5193651">mode</span><span class="op" id="5193655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193658">if</span>&nbsp;<span class="ident" id="5193661">err</span>&nbsp;<span class="op" id="5193665">!=</span>&nbsp;<span class="ident" id="5193668">nil</span>&nbsp;<span class="op" id="5193672">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193676">return</span>&nbsp;<span class="ident" id="5193683">nil</span><span class="op" id="5193686">,</span>&nbsp;<span class="ident" id="5193688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193696">maxCap</span>&nbsp;<span class="op" id="5193703">:=</span>&nbsp;<span class="ident" id="5193706">re</span><span class="op" id="5193708">.</span><span class="ident" id="5193709">MaxCap</span><span class="op" id="5193715">(</span><span class="op" id="5193716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193719">capNames</span>&nbsp;<span class="op" id="5193728">:=</span>&nbsp;<span class="ident" id="5193731">re</span><span class="op" id="5193733">.</span><span class="ident" id="5193734">CapNames</span><span class="op" id="5193742">(</span><span class="op" id="5193743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193747">re</span>&nbsp;<span class="op" id="5193750">=</span>&nbsp;<span class="ident" id="5193752">re</span><span class="op" id="5193754">.</span><span class="ident" id="5193755">Simplify</span><span class="op" id="5193763">(</span><span class="op" id="5193764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193767">prog</span><span class="op" id="5193771">,</span>&nbsp;<span class="ident" id="5193773">err</span>&nbsp;<span class="op" id="5193777">:=</span>&nbsp;<span class="ident" id="5193780">syntax</span><span class="op" id="5193786">.</span><span class="ident" id="5193787">Compile</span><span class="op" id="5193794">(</span><span class="ident" id="5193795">re</span><span class="op" id="5193797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193800">if</span>&nbsp;<span class="ident" id="5193803">err</span>&nbsp;<span class="op" id="5193807">!=</span>&nbsp;<span class="ident" id="5193810">nil</span>&nbsp;<span class="op" id="5193814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193818">return</span>&nbsp;<span class="ident" id="5193825">nil</span><span class="op" id="5193828">,</span>&nbsp;<span class="ident" id="5193830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193835">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193838">regexp</span>&nbsp;<span class="op" id="5193845">:=</span>&nbsp;<span class="op" id="5193848">&amp;</span><span class="ident" id="5193849">Regexp</span><span class="op" id="5193855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193859">expr</span><span class="op" id="5193863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193872">expr</span><span class="op" id="5193876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193880">prog</span><span class="op" id="5193884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193893">prog</span><span class="op" id="5193897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193901">onepass</span><span class="op" id="5193908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193914">compileOnePass</span><span class="op" id="5193928">(</span><span class="ident" id="5193929">prog</span><span class="op" id="5193933">)</span><span class="op" id="5193934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193938">numSubexp</span><span class="op" id="5193947">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5193951">maxCap</span><span class="op" id="5193957">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193961">subexpNames</span><span class="op" id="5193972">:</span>&nbsp;<span class="ident" id="5193974">capNames</span><span class="op" id="5193982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193986">cond</span><span class="op" id="5193990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5193999">prog</span><span class="op" id="5194003">.</span><span class="ident" id="5194004">StartCond</span><span class="op" id="5194013">(</span><span class="op" id="5194014">)</span><span class="op" id="5194015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194019">longest</span><span class="op" id="5194026">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5194032">longest</span><span class="op" id="5194039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194045">if</span>&nbsp;<span class="ident" id="5194048">regexp</span><span class="op" id="5194054">.</span><span class="ident" id="5194055">onepass</span>&nbsp;<span class="op" id="5194063">==</span>&nbsp;<span class="ident" id="5194066">notOnePass</span>&nbsp;<span class="op" id="5194077">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194081">regexp</span><span class="op" id="5194087">.</span><span class="ident" id="5194088">prefix</span><span class="op" id="5194094">,</span>&nbsp;<span class="ident" id="5194096">regexp</span><span class="op" id="5194102">.</span><span class="ident" id="5194103">prefixComplete</span>&nbsp;<span class="op" id="5194118">=</span>&nbsp;<span class="ident" id="5194120">prog</span><span class="op" id="5194124">.</span><span class="ident" id="5194125">Prefix</span><span class="op" id="5194131">(</span><span class="op" id="5194132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194135">}</span>&nbsp;<span class="keyword" id="5194137">else</span>&nbsp;<span class="op" id="5194142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194146">regexp</span><span class="op" id="5194152">.</span><span class="ident" id="5194153">prefix</span><span class="op" id="5194159">,</span>&nbsp;<span class="ident" id="5194161">regexp</span><span class="op" id="5194167">.</span><span class="ident" id="5194168">prefixComplete</span><span class="op" id="5194182">,</span>&nbsp;<span class="ident" id="5194184">regexp</span><span class="op" id="5194190">.</span><span class="ident" id="5194191">prefixEnd</span>&nbsp;<span class="op" id="5194201">=</span>&nbsp;<span class="ident" id="5194203">onePassPrefix</span><span class="op" id="5194216">(</span><span class="ident" id="5194217">prog</span><span class="op" id="5194221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194227">if</span>&nbsp;<span class="ident" id="5194230">regexp</span><span class="op" id="5194236">.</span><span class="ident" id="5194237">prefix</span>&nbsp;<span class="op" id="5194244">!=</span>&nbsp;<span class="string" id="5194247">&#34;&#34;</span>&nbsp;<span class="op" id="5194250">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194254">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5194303">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194338">regexp</span><span class="op" id="5194344">.</span><span class="ident" id="5194345">prefixBytes</span>&nbsp;<span class="op" id="5194357">=</span>&nbsp;<span class="op" id="5194359">[</span><span class="op" id="5194360">]</span><span class="builtintype" id="5194361">byte</span><span class="op" id="5194365">(</span><span class="ident" id="5194366">regexp</span><span class="op" id="5194372">.</span><span class="ident" id="5194373">prefix</span><span class="op" id="5194379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194383">regexp</span><span class="op" id="5194389">.</span><span class="ident" id="5194390">prefixRune</span><span class="op" id="5194400">,</span>&nbsp;<span class="ident" id="5194402">_</span>&nbsp;<span class="op" id="5194404">=</span>&nbsp;<span class="ident" id="5194406">utf8</span><span class="op" id="5194410">.</span><span class="ident" id="5194411">DecodeRuneInString</span><span class="op" id="5194429">(</span><span class="ident" id="5194430">regexp</span><span class="op" id="5194436">.</span><span class="ident" id="5194437">prefix</span><span class="op" id="5194443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194446">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194449">return</span>&nbsp;<span class="ident" id="5194456">regexp</span><span class="op" id="5194462">,</span>&nbsp;<span class="ident" id="5194464">nil</span><br>
<span class="lineno"></span><span class="op" id="5194468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5194471">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5194520">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="5194576">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5194603">func</span>&nbsp;<span class="op" id="5194608">(</span><span class="ident" id="5194609">re</span>&nbsp;<span class="op" id="5194612">*</span><span class="ident" id="5194613">Regexp</span><span class="op" id="5194619">)</span>&nbsp;<span class="ident" id="5194621">get</span><span class="op" id="5194624">(</span><span class="op" id="5194625">)</span>&nbsp;<span class="op" id="5194627">*</span><span class="ident" id="5194628">machine</span>&nbsp;<span class="op" id="5194636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194639">re</span><span class="op" id="5194641">.</span><span class="ident" id="5194642">mu</span><span class="op" id="5194644">.</span><span class="ident" id="5194645">Lock</span><span class="op" id="5194649">(</span><span class="op" id="5194650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194653">if</span>&nbsp;<span class="ident" id="5194656">n</span>&nbsp;<span class="op" id="5194658">:=</span>&nbsp;<span class="builtinfunc" id="5194661">len</span><span class="op" id="5194664">(</span><span class="ident" id="5194665">re</span><span class="op" id="5194667">.</span><span class="ident" id="5194668">machine</span><span class="op" id="5194675">)</span><span class="op" id="5194676">;</span>&nbsp;<span class="ident" id="5194678">n</span>&nbsp;<span class="op" id="5194680">&gt;</span>&nbsp;<span class="num" id="5194682">0</span>&nbsp;<span class="op" id="5194684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194688">z</span>&nbsp;<span class="op" id="5194690">:=</span>&nbsp;<span class="ident" id="5194693">re</span><span class="op" id="5194695">.</span><span class="ident" id="5194696">machine</span><span class="op" id="5194703">[</span><span class="ident" id="5194704">n</span><span class="op" id="5194705">-</span><span class="num" id="5194706">1</span><span class="op" id="5194707">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194711">re</span><span class="op" id="5194713">.</span><span class="ident" id="5194714">machine</span>&nbsp;<span class="op" id="5194722">=</span>&nbsp;<span class="ident" id="5194724">re</span><span class="op" id="5194726">.</span><span class="ident" id="5194727">machine</span><span class="op" id="5194734">[</span><span class="op" id="5194735">:</span><span class="ident" id="5194736">n</span><span class="op" id="5194737">-</span><span class="num" id="5194738">1</span><span class="op" id="5194739">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194743">re</span><span class="op" id="5194745">.</span><span class="ident" id="5194746">mu</span><span class="op" id="5194748">.</span><span class="ident" id="5194749">Unlock</span><span class="op" id="5194755">(</span><span class="op" id="5194756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194760">return</span>&nbsp;<span class="ident" id="5194767">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194773">re</span><span class="op" id="5194775">.</span><span class="ident" id="5194776">mu</span><span class="op" id="5194778">.</span><span class="ident" id="5194779">Unlock</span><span class="op" id="5194785">(</span><span class="op" id="5194786">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194789">z</span>&nbsp;<span class="op" id="5194791">:=</span>&nbsp;<span class="ident" id="5194794">progMachine</span><span class="op" id="5194805">(</span><span class="ident" id="5194806">re</span><span class="op" id="5194808">.</span><span class="ident" id="5194809">prog</span><span class="op" id="5194813">,</span>&nbsp;<span class="ident" id="5194815">re</span><span class="op" id="5194817">.</span><span class="ident" id="5194818">onepass</span><span class="op" id="5194825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194828">z</span><span class="op" id="5194829">.</span><span class="ident" id="5194830">re</span>&nbsp;<span class="op" id="5194833">=</span>&nbsp;<span class="ident" id="5194835">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194839">return</span>&nbsp;<span class="ident" id="5194846">z</span><br>
<span class="lineno"></span><span class="op" id="5194848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5194851">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="5194903">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5194969">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5195023">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="5195093">func</span>&nbsp;<span class="op" id="5195098">(</span><span class="ident" id="5195099">re</span>&nbsp;<span class="op" id="5195102">*</span><span class="ident" id="5195103">Regexp</span><span class="op" id="5195109">)</span>&nbsp;<span class="ident" id="5195111">put</span><span class="op" id="5195114">(</span><span class="ident" id="5195115">z</span>&nbsp;<span class="op" id="5195117">*</span><span class="ident" id="5195118">machine</span><span class="op" id="5195125">)</span>&nbsp;<span class="op" id="5195127">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5195130">re</span><span class="op" id="5195132">.</span><span class="ident" id="5195133">mu</span><span class="op" id="5195135">.</span><span class="ident" id="5195136">Lock</span><span class="op" id="5195140">(</span><span class="op" id="5195141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5195144">re</span><span class="op" id="5195146">.</span><span class="ident" id="5195147">machine</span>&nbsp;<span class="op" id="5195155">=</span>&nbsp;<span class="builtinfunc" id="5195157">append</span><span class="op" id="5195163">(</span><span class="ident" id="5195164">re</span><span class="op" id="5195166">.</span><span class="ident" id="5195167">machine</span><span class="op" id="5195174">,</span>&nbsp;<span class="ident" id="5195176">z</span><span class="op" id="5195177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5195180">re</span><span class="op" id="5195182">.</span><span class="ident" id="5195183">mu</span><span class="op" id="5195185">.</span><span class="ident" id="5195186">Unlock</span><span class="op" id="5195192">(</span><span class="op" id="5195193">)</span><br>
<span class="lineno"></span><span class="op" id="5195195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5195198">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5195276">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5195358">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5195374">func</span>&nbsp;<span class="ident" id="5195379">MustCompile</span><span class="op" id="5195390">(</span><span class="ident" id="5195391">str</span>&nbsp;<span class="builtintype" id="5195395">string</span><span class="op" id="5195401">)</span>&nbsp;<span class="op" id="5195403">*</span><span class="ident" id="5195404">Regexp</span>&nbsp;<span class="op" id="5195411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5195414">regexp</span><span class="op" id="5195420">,</span>&nbsp;<span class="builtintype" id="5195422">error</span>&nbsp;<span class="op" id="5195428">:=</span>&nbsp;<span class="ident" id="5195431">Compile</span><span class="op" id="5195438">(</span><span class="ident" id="5195439">str</span><span class="op" id="5195442">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195445">if</span>&nbsp;<span class="builtintype" id="5195448">error</span>&nbsp;<span class="op" id="5195454">!=</span>&nbsp;<span class="ident" id="5195457">nil</span>&nbsp;<span class="op" id="5195461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5195465">panic</span><span class="op" id="5195470">(</span><span class="string" id="5195471">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="5195490">+</span>&nbsp;<span class="ident" id="5195492">quote</span><span class="op" id="5195497">(</span><span class="ident" id="5195498">str</span><span class="op" id="5195501">)</span>&nbsp;<span class="op" id="5195503">+</span>&nbsp;<span class="string" id="5195505">`):&nbsp;`</span>&nbsp;<span class="op" id="5195511">+</span>&nbsp;<span class="builtintype" id="5195513">error</span><span class="op" id="5195518">.</span><span class="ident" id="5195519">Error</span><span class="op" id="5195524">(</span><span class="op" id="5195525">)</span><span class="op" id="5195526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5195529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195532">return</span>&nbsp;<span class="ident" id="5195539">regexp</span><br>
<span class="lineno"></span><span class="op" id="5195546">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5195549">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="5195637">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5195719">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5195735">func</span>&nbsp;<span class="ident" id="5195740">MustCompilePOSIX</span><span class="op" id="5195756">(</span><span class="ident" id="5195757">str</span>&nbsp;<span class="builtintype" id="5195761">string</span><span class="op" id="5195767">)</span>&nbsp;<span class="op" id="5195769">*</span><span class="ident" id="5195770">Regexp</span>&nbsp;<span class="op" id="5195777">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5195780">regexp</span><span class="op" id="5195786">,</span>&nbsp;<span class="builtintype" id="5195788">error</span>&nbsp;<span class="op" id="5195794">:=</span>&nbsp;<span class="ident" id="5195797">CompilePOSIX</span><span class="op" id="5195809">(</span><span class="ident" id="5195810">str</span><span class="op" id="5195813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195816">if</span>&nbsp;<span class="builtintype" id="5195819">error</span>&nbsp;<span class="op" id="5195825">!=</span>&nbsp;<span class="ident" id="5195828">nil</span>&nbsp;<span class="op" id="5195832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5195836">panic</span><span class="op" id="5195841">(</span><span class="string" id="5195842">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="5195866">+</span>&nbsp;<span class="ident" id="5195868">quote</span><span class="op" id="5195873">(</span><span class="ident" id="5195874">str</span><span class="op" id="5195877">)</span>&nbsp;<span class="op" id="5195879">+</span>&nbsp;<span class="string" id="5195881">`):&nbsp;`</span>&nbsp;<span class="op" id="5195887">+</span>&nbsp;<span class="builtintype" id="5195889">error</span><span class="op" id="5195894">.</span><span class="ident" id="5195895">Error</span><span class="op" id="5195900">(</span><span class="op" id="5195901">)</span><span class="op" id="5195902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5195905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195908">return</span>&nbsp;<span class="ident" id="5195915">regexp</span><br>
<span class="lineno">235</span><span class="op" id="5195922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5195925">func</span>&nbsp;<span class="ident" id="5195930">quote</span><span class="op" id="5195935">(</span><span class="ident" id="5195936">s</span>&nbsp;<span class="builtintype" id="5195938">string</span><span class="op" id="5195944">)</span>&nbsp;<span class="builtintype" id="5195946">string</span>&nbsp;<span class="op" id="5195953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195956">if</span>&nbsp;<span class="ident" id="5195959">strconv</span><span class="op" id="5195966">.</span><span class="ident" id="5195967">CanBackquote</span><span class="op" id="5195979">(</span><span class="ident" id="5195980">s</span><span class="op" id="5195981">)</span>&nbsp;<span class="op" id="5195983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195987">return</span>&nbsp;<span class="string" id="5195994">&#34;`&#34;</span>&nbsp;<span class="op" id="5195998">+</span>&nbsp;<span class="ident" id="5196000">s</span>&nbsp;<span class="op" id="5196002">+</span>&nbsp;<span class="string" id="5196004">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196012">return</span>&nbsp;<span class="ident" id="5196019">strconv</span><span class="op" id="5196026">.</span><span class="ident" id="5196027">Quote</span><span class="op" id="5196032">(</span><span class="ident" id="5196033">s</span><span class="op" id="5196034">)</span><br>
<span class="lineno"></span><span class="op" id="5196036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5196039">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="5196119">func</span>&nbsp;<span class="op" id="5196124">(</span><span class="ident" id="5196125">re</span>&nbsp;<span class="op" id="5196128">*</span><span class="ident" id="5196129">Regexp</span><span class="op" id="5196135">)</span>&nbsp;<span class="ident" id="5196137">NumSubexp</span><span class="op" id="5196146">(</span><span class="op" id="5196147">)</span>&nbsp;<span class="builtintype" id="5196149">int</span>&nbsp;<span class="op" id="5196153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196156">return</span>&nbsp;<span class="ident" id="5196163">re</span><span class="op" id="5196165">.</span><span class="ident" id="5196166">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="5196176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5196179">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="5196248">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="5196319">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="5196392">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="5196459">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="5196515">func</span>&nbsp;<span class="op" id="5196520">(</span><span class="ident" id="5196521">re</span>&nbsp;<span class="op" id="5196524">*</span><span class="ident" id="5196525">Regexp</span><span class="op" id="5196531">)</span>&nbsp;<span class="ident" id="5196533">SubexpNames</span><span class="op" id="5196544">(</span><span class="op" id="5196545">)</span>&nbsp;<span class="op" id="5196547">[</span><span class="op" id="5196548">]</span><span class="builtintype" id="5196549">string</span>&nbsp;<span class="op" id="5196556">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196559">return</span>&nbsp;<span class="ident" id="5196566">re</span><span class="op" id="5196568">.</span><span class="ident" id="5196569">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="5196581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5196584">const</span>&nbsp;<span class="ident" id="5196590">endOfText</span>&nbsp;<span class="builtintype" id="5196600">rune</span>&nbsp;<span class="op" id="5196605">=</span>&nbsp;<span class="op" id="5196607">-</span><span class="num" id="5196608">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5196611">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="5196687">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="5196715">type</span>&nbsp;<span class="ident" id="5196720">input</span>&nbsp;<span class="keyword" id="5196726">interface</span>&nbsp;<span class="op" id="5196736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196739">step</span><span class="op" id="5196743">(</span><span class="ident" id="5196744">pos</span>&nbsp;<span class="builtintype" id="5196748">int</span><span class="op" id="5196751">)</span>&nbsp;<span class="op" id="5196753">(</span><span class="ident" id="5196754">r</span>&nbsp;<span class="builtintype" id="5196756">rune</span><span class="op" id="5196760">,</span>&nbsp;<span class="ident" id="5196762">width</span>&nbsp;<span class="builtintype" id="5196768">int</span><span class="op" id="5196771">)</span>&nbsp;<span class="comment" id="5196773">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196794">canCheckPrefix</span><span class="op" id="5196808">(</span><span class="op" id="5196809">)</span>&nbsp;<span class="builtintype" id="5196811">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5196828">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196871">hasPrefix</span><span class="op" id="5196880">(</span><span class="ident" id="5196881">re</span>&nbsp;<span class="op" id="5196884">*</span><span class="ident" id="5196885">Regexp</span><span class="op" id="5196891">)</span>&nbsp;<span class="builtintype" id="5196893">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196899">index</span><span class="op" id="5196904">(</span><span class="ident" id="5196905">re</span>&nbsp;<span class="op" id="5196908">*</span><span class="ident" id="5196909">Regexp</span><span class="op" id="5196915">,</span>&nbsp;<span class="ident" id="5196917">pos</span>&nbsp;<span class="builtintype" id="5196921">int</span><span class="op" id="5196924">)</span>&nbsp;<span class="builtintype" id="5196926">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196931">context</span><span class="op" id="5196938">(</span><span class="ident" id="5196939">pos</span>&nbsp;<span class="builtintype" id="5196943">int</span><span class="op" id="5196946">)</span>&nbsp;<span class="ident" id="5196948">syntax</span><span class="op" id="5196954">.</span><span class="ident" id="5196955">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="5196963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5196966">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5196997">type</span>&nbsp;<span class="ident" id="5197002">inputString</span>&nbsp;<span class="keyword" id="5197014">struct</span>&nbsp;<span class="op" id="5197021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197024">str</span>&nbsp;<span class="builtintype" id="5197028">string</span><br>
<span class="lineno"></span><span class="op" id="5197035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5197038">func</span>&nbsp;<span class="op" id="5197043">(</span><span class="ident" id="5197044">i</span>&nbsp;<span class="op" id="5197046">*</span><span class="ident" id="5197047">inputString</span><span class="op" id="5197058">)</span>&nbsp;<span class="ident" id="5197060">step</span><span class="op" id="5197064">(</span><span class="ident" id="5197065">pos</span>&nbsp;<span class="builtintype" id="5197069">int</span><span class="op" id="5197072">)</span>&nbsp;<span class="op" id="5197074">(</span><span class="builtintype" id="5197075">rune</span><span class="op" id="5197079">,</span>&nbsp;<span class="builtintype" id="5197081">int</span><span class="op" id="5197084">)</span>&nbsp;<span class="op" id="5197086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197089">if</span>&nbsp;<span class="ident" id="5197092">pos</span>&nbsp;<span class="op" id="5197096">&lt;</span>&nbsp;<span class="builtinfunc" id="5197098">len</span><span class="op" id="5197101">(</span><span class="ident" id="5197102">i</span><span class="op" id="5197103">.</span><span class="ident" id="5197104">str</span><span class="op" id="5197107">)</span>&nbsp;<span class="op" id="5197109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197113">c</span>&nbsp;<span class="op" id="5197115">:=</span>&nbsp;<span class="ident" id="5197118">i</span><span class="op" id="5197119">.</span><span class="ident" id="5197120">str</span><span class="op" id="5197123">[</span><span class="ident" id="5197124">pos</span><span class="op" id="5197127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197131">if</span>&nbsp;<span class="ident" id="5197134">c</span>&nbsp;<span class="op" id="5197136">&lt;</span>&nbsp;<span class="ident" id="5197138">utf8</span><span class="op" id="5197142">.</span><span class="ident" id="5197143">RuneSelf</span>&nbsp;<span class="op" id="5197152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197157">return</span>&nbsp;<span class="builtintype" id="5197164">rune</span><span class="op" id="5197168">(</span><span class="ident" id="5197169">c</span><span class="op" id="5197170">)</span><span class="op" id="5197171">,</span>&nbsp;<span class="num" id="5197173">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197181">return</span>&nbsp;<span class="ident" id="5197188">utf8</span><span class="op" id="5197192">.</span><span class="ident" id="5197193">DecodeRuneInString</span><span class="op" id="5197211">(</span><span class="ident" id="5197212">i</span><span class="op" id="5197213">.</span><span class="ident" id="5197214">str</span><span class="op" id="5197217">[</span><span class="ident" id="5197218">pos</span><span class="op" id="5197221">:</span><span class="op" id="5197222">]</span><span class="op" id="5197223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197229">return</span>&nbsp;<span class="ident" id="5197236">endOfText</span><span class="op" id="5197245">,</span>&nbsp;<span class="num" id="5197247">0</span><br>
<span class="lineno"></span><span class="op" id="5197249">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5197252">func</span>&nbsp;<span class="op" id="5197257">(</span><span class="ident" id="5197258">i</span>&nbsp;<span class="op" id="5197260">*</span><span class="ident" id="5197261">inputString</span><span class="op" id="5197272">)</span>&nbsp;<span class="ident" id="5197274">canCheckPrefix</span><span class="op" id="5197288">(</span><span class="op" id="5197289">)</span>&nbsp;<span class="builtintype" id="5197291">bool</span>&nbsp;<span class="op" id="5197296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197299">return</span>&nbsp;<span class="ident" id="5197306">true</span><br>
<span class="lineno"></span><span class="op" id="5197311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="5197314">func</span>&nbsp;<span class="op" id="5197319">(</span><span class="ident" id="5197320">i</span>&nbsp;<span class="op" id="5197322">*</span><span class="ident" id="5197323">inputString</span><span class="op" id="5197334">)</span>&nbsp;<span class="ident" id="5197336">hasPrefix</span><span class="op" id="5197345">(</span><span class="ident" id="5197346">re</span>&nbsp;<span class="op" id="5197349">*</span><span class="ident" id="5197350">Regexp</span><span class="op" id="5197356">)</span>&nbsp;<span class="builtintype" id="5197358">bool</span>&nbsp;<span class="op" id="5197363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197366">return</span>&nbsp;<span class="ident" id="5197373">strings</span><span class="op" id="5197380">.</span><span class="ident" id="5197381">HasPrefix</span><span class="op" id="5197390">(</span><span class="ident" id="5197391">i</span><span class="op" id="5197392">.</span><span class="ident" id="5197393">str</span><span class="op" id="5197396">,</span>&nbsp;<span class="ident" id="5197398">re</span><span class="op" id="5197400">.</span><span class="ident" id="5197401">prefix</span><span class="op" id="5197407">)</span><br>
<span class="lineno"></span><span class="op" id="5197409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5197412">func</span>&nbsp;<span class="op" id="5197417">(</span><span class="ident" id="5197418">i</span>&nbsp;<span class="op" id="5197420">*</span><span class="ident" id="5197421">inputString</span><span class="op" id="5197432">)</span>&nbsp;<span class="ident" id="5197434">index</span><span class="op" id="5197439">(</span><span class="ident" id="5197440">re</span>&nbsp;<span class="op" id="5197443">*</span><span class="ident" id="5197444">Regexp</span><span class="op" id="5197450">,</span>&nbsp;<span class="ident" id="5197452">pos</span>&nbsp;<span class="builtintype" id="5197456">int</span><span class="op" id="5197459">)</span>&nbsp;<span class="builtintype" id="5197461">int</span>&nbsp;<span class="op" id="5197465">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197468">return</span>&nbsp;<span class="ident" id="5197475">strings</span><span class="op" id="5197482">.</span><span class="ident" id="5197483">Index</span><span class="op" id="5197488">(</span><span class="ident" id="5197489">i</span><span class="op" id="5197490">.</span><span class="ident" id="5197491">str</span><span class="op" id="5197494">[</span><span class="ident" id="5197495">pos</span><span class="op" id="5197498">:</span><span class="op" id="5197499">]</span><span class="op" id="5197500">,</span>&nbsp;<span class="ident" id="5197502">re</span><span class="op" id="5197504">.</span><span class="ident" id="5197505">prefix</span><span class="op" id="5197511">)</span><br>
<span class="lineno"></span><span class="op" id="5197513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5197516">func</span>&nbsp;<span class="op" id="5197521">(</span><span class="ident" id="5197522">i</span>&nbsp;<span class="op" id="5197524">*</span><span class="ident" id="5197525">inputString</span><span class="op" id="5197536">)</span>&nbsp;<span class="ident" id="5197538">context</span><span class="op" id="5197545">(</span><span class="ident" id="5197546">pos</span>&nbsp;<span class="builtintype" id="5197550">int</span><span class="op" id="5197553">)</span>&nbsp;<span class="ident" id="5197555">syntax</span><span class="op" id="5197561">.</span><span class="ident" id="5197562">EmptyOp</span>&nbsp;<span class="op" id="5197570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197573">r1</span><span class="op" id="5197575">,</span>&nbsp;<span class="ident" id="5197577">r2</span>&nbsp;<span class="op" id="5197580">:=</span>&nbsp;<span class="ident" id="5197583">endOfText</span><span class="op" id="5197592">,</span>&nbsp;<span class="ident" id="5197594">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197605">if</span>&nbsp;<span class="ident" id="5197608">pos</span>&nbsp;<span class="op" id="5197612">&gt;</span>&nbsp;<span class="num" id="5197614">0</span>&nbsp;<span class="op" id="5197616">&amp;&amp;</span>&nbsp;<span class="ident" id="5197619">pos</span>&nbsp;<span class="op" id="5197623">&lt;=</span>&nbsp;<span class="builtinfunc" id="5197626">len</span><span class="op" id="5197629">(</span><span class="ident" id="5197630">i</span><span class="op" id="5197631">.</span><span class="ident" id="5197632">str</span><span class="op" id="5197635">)</span>&nbsp;<span class="op" id="5197637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197641">r1</span><span class="op" id="5197643">,</span>&nbsp;<span class="ident" id="5197645">_</span>&nbsp;<span class="op" id="5197647">=</span>&nbsp;<span class="ident" id="5197649">utf8</span><span class="op" id="5197653">.</span><span class="ident" id="5197654">DecodeLastRuneInString</span><span class="op" id="5197676">(</span><span class="ident" id="5197677">i</span><span class="op" id="5197678">.</span><span class="ident" id="5197679">str</span><span class="op" id="5197682">[</span><span class="op" id="5197683">:</span><span class="ident" id="5197684">pos</span><span class="op" id="5197687">]</span><span class="op" id="5197688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197694">if</span>&nbsp;<span class="ident" id="5197697">pos</span>&nbsp;<span class="op" id="5197701">&lt;</span>&nbsp;<span class="builtinfunc" id="5197703">len</span><span class="op" id="5197706">(</span><span class="ident" id="5197707">i</span><span class="op" id="5197708">.</span><span class="ident" id="5197709">str</span><span class="op" id="5197712">)</span>&nbsp;<span class="op" id="5197714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197718">r2</span><span class="op" id="5197720">,</span>&nbsp;<span class="ident" id="5197722">_</span>&nbsp;<span class="op" id="5197724">=</span>&nbsp;<span class="ident" id="5197726">utf8</span><span class="op" id="5197730">.</span><span class="ident" id="5197731">DecodeRuneInString</span><span class="op" id="5197749">(</span><span class="ident" id="5197750">i</span><span class="op" id="5197751">.</span><span class="ident" id="5197752">str</span><span class="op" id="5197755">[</span><span class="ident" id="5197756">pos</span><span class="op" id="5197759">:</span><span class="op" id="5197760">]</span><span class="op" id="5197761">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197767">return</span>&nbsp;<span class="ident" id="5197774">syntax</span><span class="op" id="5197780">.</span><span class="ident" id="5197781">EmptyOpContext</span><span class="op" id="5197795">(</span><span class="ident" id="5197796">r1</span><span class="op" id="5197798">,</span>&nbsp;<span class="ident" id="5197800">r2</span><span class="op" id="5197802">)</span><br>
<span class="lineno"></span><span class="op" id="5197804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5197807">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="5197841">type</span>&nbsp;<span class="ident" id="5197846">inputBytes</span>&nbsp;<span class="keyword" id="5197857">struct</span>&nbsp;<span class="op" id="5197864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197867">str</span>&nbsp;<span class="op" id="5197871">[</span><span class="op" id="5197872">]</span><span class="builtintype" id="5197873">byte</span><br>
<span class="lineno"></span><span class="op" id="5197878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5197881">func</span>&nbsp;<span class="op" id="5197886">(</span><span class="ident" id="5197887">i</span>&nbsp;<span class="op" id="5197889">*</span><span class="ident" id="5197890">inputBytes</span><span class="op" id="5197900">)</span>&nbsp;<span class="ident" id="5197902">step</span><span class="op" id="5197906">(</span><span class="ident" id="5197907">pos</span>&nbsp;<span class="builtintype" id="5197911">int</span><span class="op" id="5197914">)</span>&nbsp;<span class="op" id="5197916">(</span><span class="builtintype" id="5197917">rune</span><span class="op" id="5197921">,</span>&nbsp;<span class="builtintype" id="5197923">int</span><span class="op" id="5197926">)</span>&nbsp;<span class="op" id="5197928">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197931">if</span>&nbsp;<span class="ident" id="5197934">pos</span>&nbsp;<span class="op" id="5197938">&lt;</span>&nbsp;<span class="builtinfunc" id="5197940">len</span><span class="op" id="5197943">(</span><span class="ident" id="5197944">i</span><span class="op" id="5197945">.</span><span class="ident" id="5197946">str</span><span class="op" id="5197949">)</span>&nbsp;<span class="op" id="5197951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197955">c</span>&nbsp;<span class="op" id="5197957">:=</span>&nbsp;<span class="ident" id="5197960">i</span><span class="op" id="5197961">.</span><span class="ident" id="5197962">str</span><span class="op" id="5197965">[</span><span class="ident" id="5197966">pos</span><span class="op" id="5197969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197973">if</span>&nbsp;<span class="ident" id="5197976">c</span>&nbsp;<span class="op" id="5197978">&lt;</span>&nbsp;<span class="ident" id="5197980">utf8</span><span class="op" id="5197984">.</span><span class="ident" id="5197985">RuneSelf</span>&nbsp;<span class="op" id="5197994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197999">return</span>&nbsp;<span class="builtintype" id="5198006">rune</span><span class="op" id="5198010">(</span><span class="ident" id="5198011">c</span><span class="op" id="5198012">)</span><span class="op" id="5198013">,</span>&nbsp;<span class="num" id="5198015">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198019">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198023">return</span>&nbsp;<span class="ident" id="5198030">utf8</span><span class="op" id="5198034">.</span><span class="ident" id="5198035">DecodeRune</span><span class="op" id="5198045">(</span><span class="ident" id="5198046">i</span><span class="op" id="5198047">.</span><span class="ident" id="5198048">str</span><span class="op" id="5198051">[</span><span class="ident" id="5198052">pos</span><span class="op" id="5198055">:</span><span class="op" id="5198056">]</span><span class="op" id="5198057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198063">return</span>&nbsp;<span class="ident" id="5198070">endOfText</span><span class="op" id="5198079">,</span>&nbsp;<span class="num" id="5198081">0</span><br>
<span class="lineno"></span><span class="op" id="5198083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="5198086">func</span>&nbsp;<span class="op" id="5198091">(</span><span class="ident" id="5198092">i</span>&nbsp;<span class="op" id="5198094">*</span><span class="ident" id="5198095">inputBytes</span><span class="op" id="5198105">)</span>&nbsp;<span class="ident" id="5198107">canCheckPrefix</span><span class="op" id="5198121">(</span><span class="op" id="5198122">)</span>&nbsp;<span class="builtintype" id="5198124">bool</span>&nbsp;<span class="op" id="5198129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198132">return</span>&nbsp;<span class="ident" id="5198139">true</span><br>
<span class="lineno"></span><span class="op" id="5198144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198147">func</span>&nbsp;<span class="op" id="5198152">(</span><span class="ident" id="5198153">i</span>&nbsp;<span class="op" id="5198155">*</span><span class="ident" id="5198156">inputBytes</span><span class="op" id="5198166">)</span>&nbsp;<span class="ident" id="5198168">hasPrefix</span><span class="op" id="5198177">(</span><span class="ident" id="5198178">re</span>&nbsp;<span class="op" id="5198181">*</span><span class="ident" id="5198182">Regexp</span><span class="op" id="5198188">)</span>&nbsp;<span class="builtintype" id="5198190">bool</span>&nbsp;<span class="op" id="5198195">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198198">return</span>&nbsp;<span class="ident" id="5198205">bytes</span><span class="op" id="5198210">.</span><span class="ident" id="5198211">HasPrefix</span><span class="op" id="5198220">(</span><span class="ident" id="5198221">i</span><span class="op" id="5198222">.</span><span class="ident" id="5198223">str</span><span class="op" id="5198226">,</span>&nbsp;<span class="ident" id="5198228">re</span><span class="op" id="5198230">.</span><span class="ident" id="5198231">prefixBytes</span><span class="op" id="5198242">)</span><br>
<span class="lineno"></span><span class="op" id="5198244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198247">func</span>&nbsp;<span class="op" id="5198252">(</span><span class="ident" id="5198253">i</span>&nbsp;<span class="op" id="5198255">*</span><span class="ident" id="5198256">inputBytes</span><span class="op" id="5198266">)</span>&nbsp;<span class="ident" id="5198268">index</span><span class="op" id="5198273">(</span><span class="ident" id="5198274">re</span>&nbsp;<span class="op" id="5198277">*</span><span class="ident" id="5198278">Regexp</span><span class="op" id="5198284">,</span>&nbsp;<span class="ident" id="5198286">pos</span>&nbsp;<span class="builtintype" id="5198290">int</span><span class="op" id="5198293">)</span>&nbsp;<span class="builtintype" id="5198295">int</span>&nbsp;<span class="op" id="5198299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198302">return</span>&nbsp;<span class="ident" id="5198309">bytes</span><span class="op" id="5198314">.</span><span class="ident" id="5198315">Index</span><span class="op" id="5198320">(</span><span class="ident" id="5198321">i</span><span class="op" id="5198322">.</span><span class="ident" id="5198323">str</span><span class="op" id="5198326">[</span><span class="ident" id="5198327">pos</span><span class="op" id="5198330">:</span><span class="op" id="5198331">]</span><span class="op" id="5198332">,</span>&nbsp;<span class="ident" id="5198334">re</span><span class="op" id="5198336">.</span><span class="ident" id="5198337">prefixBytes</span><span class="op" id="5198348">)</span><br>
<span class="lineno">335</span><span class="op" id="5198350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198353">func</span>&nbsp;<span class="op" id="5198358">(</span><span class="ident" id="5198359">i</span>&nbsp;<span class="op" id="5198361">*</span><span class="ident" id="5198362">inputBytes</span><span class="op" id="5198372">)</span>&nbsp;<span class="ident" id="5198374">context</span><span class="op" id="5198381">(</span><span class="ident" id="5198382">pos</span>&nbsp;<span class="builtintype" id="5198386">int</span><span class="op" id="5198389">)</span>&nbsp;<span class="ident" id="5198391">syntax</span><span class="op" id="5198397">.</span><span class="ident" id="5198398">EmptyOp</span>&nbsp;<span class="op" id="5198406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198409">r1</span><span class="op" id="5198411">,</span>&nbsp;<span class="ident" id="5198413">r2</span>&nbsp;<span class="op" id="5198416">:=</span>&nbsp;<span class="ident" id="5198419">endOfText</span><span class="op" id="5198428">,</span>&nbsp;<span class="ident" id="5198430">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198441">if</span>&nbsp;<span class="ident" id="5198444">pos</span>&nbsp;<span class="op" id="5198448">&gt;</span>&nbsp;<span class="num" id="5198450">0</span>&nbsp;<span class="op" id="5198452">&amp;&amp;</span>&nbsp;<span class="ident" id="5198455">pos</span>&nbsp;<span class="op" id="5198459">&lt;=</span>&nbsp;<span class="builtinfunc" id="5198462">len</span><span class="op" id="5198465">(</span><span class="ident" id="5198466">i</span><span class="op" id="5198467">.</span><span class="ident" id="5198468">str</span><span class="op" id="5198471">)</span>&nbsp;<span class="op" id="5198473">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198477">r1</span><span class="op" id="5198479">,</span>&nbsp;<span class="ident" id="5198481">_</span>&nbsp;<span class="op" id="5198483">=</span>&nbsp;<span class="ident" id="5198485">utf8</span><span class="op" id="5198489">.</span><span class="ident" id="5198490">DecodeLastRune</span><span class="op" id="5198504">(</span><span class="ident" id="5198505">i</span><span class="op" id="5198506">.</span><span class="ident" id="5198507">str</span><span class="op" id="5198510">[</span><span class="op" id="5198511">:</span><span class="ident" id="5198512">pos</span><span class="op" id="5198515">]</span><span class="op" id="5198516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198522">if</span>&nbsp;<span class="ident" id="5198525">pos</span>&nbsp;<span class="op" id="5198529">&lt;</span>&nbsp;<span class="builtinfunc" id="5198531">len</span><span class="op" id="5198534">(</span><span class="ident" id="5198535">i</span><span class="op" id="5198536">.</span><span class="ident" id="5198537">str</span><span class="op" id="5198540">)</span>&nbsp;<span class="op" id="5198542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198546">r2</span><span class="op" id="5198548">,</span>&nbsp;<span class="ident" id="5198550">_</span>&nbsp;<span class="op" id="5198552">=</span>&nbsp;<span class="ident" id="5198554">utf8</span><span class="op" id="5198558">.</span><span class="ident" id="5198559">DecodeRune</span><span class="op" id="5198569">(</span><span class="ident" id="5198570">i</span><span class="op" id="5198571">.</span><span class="ident" id="5198572">str</span><span class="op" id="5198575">[</span><span class="ident" id="5198576">pos</span><span class="op" id="5198579">:</span><span class="op" id="5198580">]</span><span class="op" id="5198581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198584">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198587">return</span>&nbsp;<span class="ident" id="5198594">syntax</span><span class="op" id="5198600">.</span><span class="ident" id="5198601">EmptyOpContext</span><span class="op" id="5198615">(</span><span class="ident" id="5198616">r1</span><span class="op" id="5198618">,</span>&nbsp;<span class="ident" id="5198620">r2</span><span class="op" id="5198622">)</span><br>
<span class="lineno"></span><span class="op" id="5198624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5198627">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5198662">type</span>&nbsp;<span class="ident" id="5198667">inputReader</span>&nbsp;<span class="keyword" id="5198679">struct</span>&nbsp;<span class="op" id="5198686">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198689">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198695">io</span><span class="op" id="5198697">.</span><span class="ident" id="5198698">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198710">atEOT</span>&nbsp;<span class="builtintype" id="5198716">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198722">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5198728">int</span><br>
<span class="lineno"></span><span class="op" id="5198732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5198735">func</span>&nbsp;<span class="op" id="5198740">(</span><span class="ident" id="5198741">i</span>&nbsp;<span class="op" id="5198743">*</span><span class="ident" id="5198744">inputReader</span><span class="op" id="5198755">)</span>&nbsp;<span class="ident" id="5198757">step</span><span class="op" id="5198761">(</span><span class="ident" id="5198762">pos</span>&nbsp;<span class="builtintype" id="5198766">int</span><span class="op" id="5198769">)</span>&nbsp;<span class="op" id="5198771">(</span><span class="builtintype" id="5198772">rune</span><span class="op" id="5198776">,</span>&nbsp;<span class="builtintype" id="5198778">int</span><span class="op" id="5198781">)</span>&nbsp;<span class="op" id="5198783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198786">if</span>&nbsp;<span class="op" id="5198789">!</span><span class="ident" id="5198790">i</span><span class="op" id="5198791">.</span><span class="ident" id="5198792">atEOT</span>&nbsp;<span class="op" id="5198798">&amp;&amp;</span>&nbsp;<span class="ident" id="5198801">pos</span>&nbsp;<span class="op" id="5198805">!=</span>&nbsp;<span class="ident" id="5198808">i</span><span class="op" id="5198809">.</span><span class="ident" id="5198810">pos</span>&nbsp;<span class="op" id="5198814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198818">return</span>&nbsp;<span class="ident" id="5198825">endOfText</span><span class="op" id="5198834">,</span>&nbsp;<span class="num" id="5198836">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198840">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198843">r</span><span class="op" id="5198844">,</span>&nbsp;<span class="ident" id="5198846">w</span><span class="op" id="5198847">,</span>&nbsp;<span class="ident" id="5198849">err</span>&nbsp;<span class="op" id="5198853">:=</span>&nbsp;<span class="ident" id="5198856">i</span><span class="op" id="5198857">.</span><span class="ident" id="5198858">r</span><span class="op" id="5198859">.</span><span class="ident" id="5198860">ReadRune</span><span class="op" id="5198868">(</span><span class="op" id="5198869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198872">if</span>&nbsp;<span class="ident" id="5198875">err</span>&nbsp;<span class="op" id="5198879">!=</span>&nbsp;<span class="ident" id="5198882">nil</span>&nbsp;<span class="op" id="5198886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198890">i</span><span class="op" id="5198891">.</span><span class="ident" id="5198892">atEOT</span>&nbsp;<span class="op" id="5198898">=</span>&nbsp;<span class="ident" id="5198900">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198907">return</span>&nbsp;<span class="ident" id="5198914">endOfText</span><span class="op" id="5198923">,</span>&nbsp;<span class="num" id="5198925">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198928">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198931">i</span><span class="op" id="5198932">.</span><span class="ident" id="5198933">pos</span>&nbsp;<span class="op" id="5198937">+=</span>&nbsp;<span class="ident" id="5198940">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198943">return</span>&nbsp;<span class="ident" id="5198950">r</span><span class="op" id="5198951">,</span>&nbsp;<span class="ident" id="5198953">w</span><br>
<span class="lineno"></span><span class="op" id="5198955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198958">func</span>&nbsp;<span class="op" id="5198963">(</span><span class="ident" id="5198964">i</span>&nbsp;<span class="op" id="5198966">*</span><span class="ident" id="5198967">inputReader</span><span class="op" id="5198978">)</span>&nbsp;<span class="ident" id="5198980">canCheckPrefix</span><span class="op" id="5198994">(</span><span class="op" id="5198995">)</span>&nbsp;<span class="builtintype" id="5198997">bool</span>&nbsp;<span class="op" id="5199002">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199005">return</span>&nbsp;<span class="ident" id="5199012">false</span><br>
<span class="lineno"></span><span class="op" id="5199018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5199021">func</span>&nbsp;<span class="op" id="5199026">(</span><span class="ident" id="5199027">i</span>&nbsp;<span class="op" id="5199029">*</span><span class="ident" id="5199030">inputReader</span><span class="op" id="5199041">)</span>&nbsp;<span class="ident" id="5199043">hasPrefix</span><span class="op" id="5199052">(</span><span class="ident" id="5199053">re</span>&nbsp;<span class="op" id="5199056">*</span><span class="ident" id="5199057">Regexp</span><span class="op" id="5199063">)</span>&nbsp;<span class="builtintype" id="5199065">bool</span>&nbsp;<span class="op" id="5199070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199073">return</span>&nbsp;<span class="ident" id="5199080">false</span><br>
<span class="lineno">375</span><span class="op" id="5199086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5199089">func</span>&nbsp;<span class="op" id="5199094">(</span><span class="ident" id="5199095">i</span>&nbsp;<span class="op" id="5199097">*</span><span class="ident" id="5199098">inputReader</span><span class="op" id="5199109">)</span>&nbsp;<span class="ident" id="5199111">index</span><span class="op" id="5199116">(</span><span class="ident" id="5199117">re</span>&nbsp;<span class="op" id="5199120">*</span><span class="ident" id="5199121">Regexp</span><span class="op" id="5199127">,</span>&nbsp;<span class="ident" id="5199129">pos</span>&nbsp;<span class="builtintype" id="5199133">int</span><span class="op" id="5199136">)</span>&nbsp;<span class="builtintype" id="5199138">int</span>&nbsp;<span class="op" id="5199142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199145">return</span>&nbsp;<span class="op" id="5199152">-</span><span class="num" id="5199153">1</span><br>
<span class="lineno"></span><span class="op" id="5199155">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5199158">func</span>&nbsp;<span class="op" id="5199163">(</span><span class="ident" id="5199164">i</span>&nbsp;<span class="op" id="5199166">*</span><span class="ident" id="5199167">inputReader</span><span class="op" id="5199178">)</span>&nbsp;<span class="ident" id="5199180">context</span><span class="op" id="5199187">(</span><span class="ident" id="5199188">pos</span>&nbsp;<span class="builtintype" id="5199192">int</span><span class="op" id="5199195">)</span>&nbsp;<span class="ident" id="5199197">syntax</span><span class="op" id="5199203">.</span><span class="ident" id="5199204">EmptyOp</span>&nbsp;<span class="op" id="5199212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199215">return</span>&nbsp;<span class="num" id="5199222">0</span><br>
<span class="lineno"></span><span class="op" id="5199224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5199227">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5199295">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5199364">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5199423">func</span>&nbsp;<span class="op" id="5199428">(</span><span class="ident" id="5199429">re</span>&nbsp;<span class="op" id="5199432">*</span><span class="ident" id="5199433">Regexp</span><span class="op" id="5199439">)</span>&nbsp;<span class="ident" id="5199441">LiteralPrefix</span><span class="op" id="5199454">(</span><span class="op" id="5199455">)</span>&nbsp;<span class="op" id="5199457">(</span><span class="ident" id="5199458">prefix</span>&nbsp;<span class="builtintype" id="5199465">string</span><span class="op" id="5199471">,</span>&nbsp;<span class="ident" id="5199473">complete</span>&nbsp;<span class="builtintype" id="5199482">bool</span><span class="op" id="5199486">)</span>&nbsp;<span class="op" id="5199488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199491">return</span>&nbsp;<span class="ident" id="5199498">re</span><span class="op" id="5199500">.</span><span class="ident" id="5199501">prefix</span><span class="op" id="5199507">,</span>&nbsp;<span class="ident" id="5199509">re</span><span class="op" id="5199511">.</span><span class="ident" id="5199512">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="5199527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5199530">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5199601">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="5199616">func</span>&nbsp;<span class="op" id="5199621">(</span><span class="ident" id="5199622">re</span>&nbsp;<span class="op" id="5199625">*</span><span class="ident" id="5199626">Regexp</span><span class="op" id="5199632">)</span>&nbsp;<span class="ident" id="5199634">MatchReader</span><span class="op" id="5199645">(</span><span class="ident" id="5199646">r</span>&nbsp;<span class="ident" id="5199648">io</span><span class="op" id="5199650">.</span><span class="ident" id="5199651">RuneReader</span><span class="op" id="5199661">)</span>&nbsp;<span class="builtintype" id="5199663">bool</span>&nbsp;<span class="op" id="5199668">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199671">return</span>&nbsp;<span class="ident" id="5199678">re</span><span class="op" id="5199680">.</span><span class="ident" id="5199681">doExecute</span><span class="op" id="5199690">(</span><span class="ident" id="5199691">r</span><span class="op" id="5199692">,</span>&nbsp;<span class="ident" id="5199694">nil</span><span class="op" id="5199697">,</span>&nbsp;<span class="string" id="5199699">&#34;&#34;</span><span class="op" id="5199701">,</span>&nbsp;<span class="num" id="5199703">0</span><span class="op" id="5199704">,</span>&nbsp;<span class="num" id="5199706">0</span><span class="op" id="5199707">)</span>&nbsp;<span class="op" id="5199709">!=</span>&nbsp;<span class="ident" id="5199712">nil</span><br>
<span class="lineno"></span><span class="op" id="5199716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5199719">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5199783">func</span>&nbsp;<span class="op" id="5199788">(</span><span class="ident" id="5199789">re</span>&nbsp;<span class="op" id="5199792">*</span><span class="ident" id="5199793">Regexp</span><span class="op" id="5199799">)</span>&nbsp;<span class="ident" id="5199801">MatchString</span><span class="op" id="5199812">(</span><span class="ident" id="5199813">s</span>&nbsp;<span class="builtintype" id="5199815">string</span><span class="op" id="5199821">)</span>&nbsp;<span class="builtintype" id="5199823">bool</span>&nbsp;<span class="op" id="5199828">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199831">return</span>&nbsp;<span class="ident" id="5199838">re</span><span class="op" id="5199840">.</span><span class="ident" id="5199841">doExecute</span><span class="op" id="5199850">(</span><span class="ident" id="5199851">nil</span><span class="op" id="5199854">,</span>&nbsp;<span class="ident" id="5199856">nil</span><span class="op" id="5199859">,</span>&nbsp;<span class="ident" id="5199861">s</span><span class="op" id="5199862">,</span>&nbsp;<span class="num" id="5199864">0</span><span class="op" id="5199865">,</span>&nbsp;<span class="num" id="5199867">0</span><span class="op" id="5199868">)</span>&nbsp;<span class="op" id="5199870">!=</span>&nbsp;<span class="ident" id="5199873">nil</span><br>
<span class="lineno"></span><span class="op" id="5199877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5199880">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5199942">func</span>&nbsp;<span class="op" id="5199947">(</span><span class="ident" id="5199948">re</span>&nbsp;<span class="op" id="5199951">*</span><span class="ident" id="5199952">Regexp</span><span class="op" id="5199958">)</span>&nbsp;<span class="ident" id="5199960">Match</span><span class="op" id="5199965">(</span><span class="ident" id="5199966">b</span>&nbsp;<span class="op" id="5199968">[</span><span class="op" id="5199969">]</span><span class="builtintype" id="5199970">byte</span><span class="op" id="5199974">)</span>&nbsp;<span class="builtintype" id="5199976">bool</span>&nbsp;<span class="op" id="5199981">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199984">return</span>&nbsp;<span class="ident" id="5199991">re</span><span class="op" id="5199993">.</span><span class="ident" id="5199994">doExecute</span><span class="op" id="5200003">(</span><span class="ident" id="5200004">nil</span><span class="op" id="5200007">,</span>&nbsp;<span class="ident" id="5200009">b</span><span class="op" id="5200010">,</span>&nbsp;<span class="string" id="5200012">&#34;&#34;</span><span class="op" id="5200014">,</span>&nbsp;<span class="num" id="5200016">0</span><span class="op" id="5200017">,</span>&nbsp;<span class="num" id="5200019">0</span><span class="op" id="5200020">)</span>&nbsp;<span class="op" id="5200022">!=</span>&nbsp;<span class="ident" id="5200025">nil</span><br>
<span class="lineno"></span><span class="op" id="5200029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5200032">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="5200108">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="5200185">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5200215">func</span>&nbsp;<span class="ident" id="5200220">MatchReader</span><span class="op" id="5200231">(</span><span class="ident" id="5200232">pattern</span>&nbsp;<span class="builtintype" id="5200240">string</span><span class="op" id="5200246">,</span>&nbsp;<span class="ident" id="5200248">r</span>&nbsp;<span class="ident" id="5200250">io</span><span class="op" id="5200252">.</span><span class="ident" id="5200253">RuneReader</span><span class="op" id="5200263">)</span>&nbsp;<span class="op" id="5200265">(</span><span class="ident" id="5200266">matched</span>&nbsp;<span class="builtintype" id="5200274">bool</span><span class="op" id="5200278">,</span>&nbsp;<span class="ident" id="5200280">err</span>&nbsp;<span class="builtintype" id="5200284">error</span><span class="op" id="5200289">)</span>&nbsp;<span class="op" id="5200291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200294">re</span><span class="op" id="5200296">,</span>&nbsp;<span class="ident" id="5200298">err</span>&nbsp;<span class="op" id="5200302">:=</span>&nbsp;<span class="ident" id="5200305">Compile</span><span class="op" id="5200312">(</span><span class="ident" id="5200313">pattern</span><span class="op" id="5200320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200323">if</span>&nbsp;<span class="ident" id="5200326">err</span>&nbsp;<span class="op" id="5200330">!=</span>&nbsp;<span class="ident" id="5200333">nil</span>&nbsp;<span class="op" id="5200337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200341">return</span>&nbsp;<span class="ident" id="5200348">false</span><span class="op" id="5200353">,</span>&nbsp;<span class="ident" id="5200355">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200363">return</span>&nbsp;<span class="ident" id="5200370">re</span><span class="op" id="5200372">.</span><span class="ident" id="5200373">MatchReader</span><span class="op" id="5200384">(</span><span class="ident" id="5200385">r</span><span class="op" id="5200386">)</span><span class="op" id="5200387">,</span>&nbsp;<span class="ident" id="5200389">nil</span><br>
<span class="lineno"></span><span class="op" id="5200393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5200396">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="5200455">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5200507">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5200556">func</span>&nbsp;<span class="ident" id="5200561">MatchString</span><span class="op" id="5200572">(</span><span class="ident" id="5200573">pattern</span>&nbsp;<span class="builtintype" id="5200581">string</span><span class="op" id="5200587">,</span>&nbsp;<span class="ident" id="5200589">s</span>&nbsp;<span class="builtintype" id="5200591">string</span><span class="op" id="5200597">)</span>&nbsp;<span class="op" id="5200599">(</span><span class="ident" id="5200600">matched</span>&nbsp;<span class="builtintype" id="5200608">bool</span><span class="op" id="5200612">,</span>&nbsp;<span class="ident" id="5200614">err</span>&nbsp;<span class="builtintype" id="5200618">error</span><span class="op" id="5200623">)</span>&nbsp;<span class="op" id="5200625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200628">re</span><span class="op" id="5200630">,</span>&nbsp;<span class="ident" id="5200632">err</span>&nbsp;<span class="op" id="5200636">:=</span>&nbsp;<span class="ident" id="5200639">Compile</span><span class="op" id="5200646">(</span><span class="ident" id="5200647">pattern</span><span class="op" id="5200654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200657">if</span>&nbsp;<span class="ident" id="5200660">err</span>&nbsp;<span class="op" id="5200664">!=</span>&nbsp;<span class="ident" id="5200667">nil</span>&nbsp;<span class="op" id="5200671">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200675">return</span>&nbsp;<span class="ident" id="5200682">false</span><span class="op" id="5200687">,</span>&nbsp;<span class="ident" id="5200689">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200697">return</span>&nbsp;<span class="ident" id="5200704">re</span><span class="op" id="5200706">.</span><span class="ident" id="5200707">MatchString</span><span class="op" id="5200718">(</span><span class="ident" id="5200719">s</span><span class="op" id="5200720">)</span><span class="op" id="5200721">,</span>&nbsp;<span class="ident" id="5200723">nil</span><br>
<span class="lineno"></span><span class="op" id="5200727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="5200730">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5200783">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="5200839">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5200888">func</span>&nbsp;<span class="ident" id="5200893">Match</span><span class="op" id="5200898">(</span><span class="ident" id="5200899">pattern</span>&nbsp;<span class="builtintype" id="5200907">string</span><span class="op" id="5200913">,</span>&nbsp;<span class="ident" id="5200915">b</span>&nbsp;<span class="op" id="5200917">[</span><span class="op" id="5200918">]</span><span class="builtintype" id="5200919">byte</span><span class="op" id="5200923">)</span>&nbsp;<span class="op" id="5200925">(</span><span class="ident" id="5200926">matched</span>&nbsp;<span class="builtintype" id="5200934">bool</span><span class="op" id="5200938">,</span>&nbsp;<span class="ident" id="5200940">err</span>&nbsp;<span class="builtintype" id="5200944">error</span><span class="op" id="5200949">)</span>&nbsp;<span class="op" id="5200951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200954">re</span><span class="op" id="5200956">,</span>&nbsp;<span class="ident" id="5200958">err</span>&nbsp;<span class="op" id="5200962">:=</span>&nbsp;<span class="ident" id="5200965">Compile</span><span class="op" id="5200972">(</span><span class="ident" id="5200973">pattern</span><span class="op" id="5200980">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200983">if</span>&nbsp;<span class="ident" id="5200986">err</span>&nbsp;<span class="op" id="5200990">!=</span>&nbsp;<span class="ident" id="5200993">nil</span>&nbsp;<span class="op" id="5200997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201001">return</span>&nbsp;<span class="ident" id="5201008">false</span><span class="op" id="5201013">,</span>&nbsp;<span class="ident" id="5201015">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201023">return</span>&nbsp;<span class="ident" id="5201030">re</span><span class="op" id="5201032">.</span><span class="ident" id="5201033">Match</span><span class="op" id="5201038">(</span><span class="ident" id="5201039">b</span><span class="op" id="5201040">)</span><span class="op" id="5201041">,</span>&nbsp;<span class="ident" id="5201043">nil</span><br>
<span class="lineno"></span><span class="op" id="5201047">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="5201050">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5201125">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5201203">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5201279">func</span>&nbsp;<span class="op" id="5201284">(</span><span class="ident" id="5201285">re</span>&nbsp;<span class="op" id="5201288">*</span><span class="ident" id="5201289">Regexp</span><span class="op" id="5201295">)</span>&nbsp;<span class="ident" id="5201297">ReplaceAllString</span><span class="op" id="5201313">(</span><span class="ident" id="5201314">src</span><span class="op" id="5201317">,</span>&nbsp;<span class="ident" id="5201319">repl</span>&nbsp;<span class="builtintype" id="5201324">string</span><span class="op" id="5201330">)</span>&nbsp;<span class="builtintype" id="5201332">string</span>&nbsp;<span class="op" id="5201339">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201342">n</span>&nbsp;<span class="op" id="5201344">:=</span>&nbsp;<span class="num" id="5201347">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201350">if</span>&nbsp;<span class="ident" id="5201353">strings</span><span class="op" id="5201360">.</span><span class="ident" id="5201361">Index</span><span class="op" id="5201366">(</span><span class="ident" id="5201367">repl</span><span class="op" id="5201371">,</span>&nbsp;<span class="string" id="5201373">&#34;$&#34;</span><span class="op" id="5201376">)</span>&nbsp;<span class="op" id="5201378">&gt;=</span>&nbsp;<span class="num" id="5201381">0</span>&nbsp;<span class="op" id="5201383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201387">n</span>&nbsp;<span class="op" id="5201389">=</span>&nbsp;<span class="num" id="5201391">2</span>&nbsp;<span class="op" id="5201393">*</span>&nbsp;<span class="op" id="5201395">(</span><span class="ident" id="5201396">re</span><span class="op" id="5201398">.</span><span class="ident" id="5201399">numSubexp</span>&nbsp;<span class="op" id="5201409">+</span>&nbsp;<span class="num" id="5201411">1</span><span class="op" id="5201412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201418">b</span>&nbsp;<span class="op" id="5201420">:=</span>&nbsp;<span class="ident" id="5201423">re</span><span class="op" id="5201425">.</span><span class="ident" id="5201426">replaceAll</span><span class="op" id="5201436">(</span><span class="ident" id="5201437">nil</span><span class="op" id="5201440">,</span>&nbsp;<span class="ident" id="5201442">src</span><span class="op" id="5201445">,</span>&nbsp;<span class="ident" id="5201447">n</span><span class="op" id="5201448">,</span>&nbsp;<span class="keyword" id="5201450">func</span><span class="op" id="5201454">(</span><span class="ident" id="5201455">dst</span>&nbsp;<span class="op" id="5201459">[</span><span class="op" id="5201460">]</span><span class="builtintype" id="5201461">byte</span><span class="op" id="5201465">,</span>&nbsp;<span class="ident" id="5201467">match</span>&nbsp;<span class="op" id="5201473">[</span><span class="op" id="5201474">]</span><span class="builtintype" id="5201475">int</span><span class="op" id="5201478">)</span>&nbsp;<span class="op" id="5201480">[</span><span class="op" id="5201481">]</span><span class="builtintype" id="5201482">byte</span>&nbsp;<span class="op" id="5201487">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201491">return</span>&nbsp;<span class="ident" id="5201498">re</span><span class="op" id="5201500">.</span><span class="ident" id="5201501">expand</span><span class="op" id="5201507">(</span><span class="ident" id="5201508">dst</span><span class="op" id="5201511">,</span>&nbsp;<span class="ident" id="5201513">repl</span><span class="op" id="5201517">,</span>&nbsp;<span class="ident" id="5201519">nil</span><span class="op" id="5201522">,</span>&nbsp;<span class="ident" id="5201524">src</span><span class="op" id="5201527">,</span>&nbsp;<span class="ident" id="5201529">match</span><span class="op" id="5201534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201537">}</span><span class="op" id="5201538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201541">return</span>&nbsp;<span class="builtintype" id="5201548">string</span><span class="op" id="5201554">(</span><span class="ident" id="5201555">b</span><span class="op" id="5201556">)</span><br>
<span class="lineno"></span><span class="op" id="5201558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="5201561">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5201643">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="5201727">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5201752">func</span>&nbsp;<span class="op" id="5201757">(</span><span class="ident" id="5201758">re</span>&nbsp;<span class="op" id="5201761">*</span><span class="ident" id="5201762">Regexp</span><span class="op" id="5201768">)</span>&nbsp;<span class="ident" id="5201770">ReplaceAllLiteralString</span><span class="op" id="5201793">(</span><span class="ident" id="5201794">src</span><span class="op" id="5201797">,</span>&nbsp;<span class="ident" id="5201799">repl</span>&nbsp;<span class="builtintype" id="5201804">string</span><span class="op" id="5201810">)</span>&nbsp;<span class="builtintype" id="5201812">string</span>&nbsp;<span class="op" id="5201819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201822">return</span>&nbsp;<span class="builtintype" id="5201829">string</span><span class="op" id="5201835">(</span><span class="ident" id="5201836">re</span><span class="op" id="5201838">.</span><span class="ident" id="5201839">replaceAll</span><span class="op" id="5201849">(</span><span class="ident" id="5201850">nil</span><span class="op" id="5201853">,</span>&nbsp;<span class="ident" id="5201855">src</span><span class="op" id="5201858">,</span>&nbsp;<span class="num" id="5201860">2</span><span class="op" id="5201861">,</span>&nbsp;<span class="keyword" id="5201863">func</span><span class="op" id="5201867">(</span><span class="ident" id="5201868">dst</span>&nbsp;<span class="op" id="5201872">[</span><span class="op" id="5201873">]</span><span class="builtintype" id="5201874">byte</span><span class="op" id="5201878">,</span>&nbsp;<span class="ident" id="5201880">match</span>&nbsp;<span class="op" id="5201886">[</span><span class="op" id="5201887">]</span><span class="builtintype" id="5201888">int</span><span class="op" id="5201891">)</span>&nbsp;<span class="op" id="5201893">[</span><span class="op" id="5201894">]</span><span class="builtintype" id="5201895">byte</span>&nbsp;<span class="op" id="5201900">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201904">return</span>&nbsp;<span class="builtinfunc" id="5201911">append</span><span class="op" id="5201917">(</span><span class="ident" id="5201918">dst</span><span class="op" id="5201921">,</span>&nbsp;<span class="ident" id="5201923">repl</span><span class="op" id="5201927">...</span><span class="op" id="5201930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201933">}</span><span class="op" id="5201934">)</span><span class="op" id="5201935">)</span><br>
<span class="lineno"></span><span class="op" id="5201937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5201940">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="5202014">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5202088">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="5202166">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5202201">func</span>&nbsp;<span class="op" id="5202206">(</span><span class="ident" id="5202207">re</span>&nbsp;<span class="op" id="5202210">*</span><span class="ident" id="5202211">Regexp</span><span class="op" id="5202217">)</span>&nbsp;<span class="ident" id="5202219">ReplaceAllStringFunc</span><span class="op" id="5202239">(</span><span class="ident" id="5202240">src</span>&nbsp;<span class="builtintype" id="5202244">string</span><span class="op" id="5202250">,</span>&nbsp;<span class="ident" id="5202252">repl</span>&nbsp;<span class="keyword" id="5202257">func</span><span class="op" id="5202261">(</span><span class="builtintype" id="5202262">string</span><span class="op" id="5202268">)</span>&nbsp;<span class="builtintype" id="5202270">string</span><span class="op" id="5202276">)</span>&nbsp;<span class="builtintype" id="5202278">string</span>&nbsp;<span class="op" id="5202285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202288">b</span>&nbsp;<span class="op" id="5202290">:=</span>&nbsp;<span class="ident" id="5202293">re</span><span class="op" id="5202295">.</span><span class="ident" id="5202296">replaceAll</span><span class="op" id="5202306">(</span><span class="ident" id="5202307">nil</span><span class="op" id="5202310">,</span>&nbsp;<span class="ident" id="5202312">src</span><span class="op" id="5202315">,</span>&nbsp;<span class="num" id="5202317">2</span><span class="op" id="5202318">,</span>&nbsp;<span class="keyword" id="5202320">func</span><span class="op" id="5202324">(</span><span class="ident" id="5202325">dst</span>&nbsp;<span class="op" id="5202329">[</span><span class="op" id="5202330">]</span><span class="builtintype" id="5202331">byte</span><span class="op" id="5202335">,</span>&nbsp;<span class="ident" id="5202337">match</span>&nbsp;<span class="op" id="5202343">[</span><span class="op" id="5202344">]</span><span class="builtintype" id="5202345">int</span><span class="op" id="5202348">)</span>&nbsp;<span class="op" id="5202350">[</span><span class="op" id="5202351">]</span><span class="builtintype" id="5202352">byte</span>&nbsp;<span class="op" id="5202357">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202361">return</span>&nbsp;<span class="builtinfunc" id="5202368">append</span><span class="op" id="5202374">(</span><span class="ident" id="5202375">dst</span><span class="op" id="5202378">,</span>&nbsp;<span class="ident" id="5202380">repl</span><span class="op" id="5202384">(</span><span class="ident" id="5202385">src</span><span class="op" id="5202388">[</span><span class="ident" id="5202389">match</span><span class="op" id="5202394">[</span><span class="num" id="5202395">0</span><span class="op" id="5202396">]</span><span class="op" id="5202397">:</span><span class="ident" id="5202398">match</span><span class="op" id="5202403">[</span><span class="num" id="5202404">1</span><span class="op" id="5202405">]</span><span class="op" id="5202406">]</span><span class="op" id="5202407">)</span><span class="op" id="5202408">...</span><span class="op" id="5202411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202414">}</span><span class="op" id="5202415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202418">return</span>&nbsp;<span class="builtintype" id="5202425">string</span><span class="op" id="5202431">(</span><span class="ident" id="5202432">b</span><span class="op" id="5202433">)</span><br>
<span class="lineno"></span><span class="op" id="5202435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="5202438">func</span>&nbsp;<span class="op" id="5202443">(</span><span class="ident" id="5202444">re</span>&nbsp;<span class="op" id="5202447">*</span><span class="ident" id="5202448">Regexp</span><span class="op" id="5202454">)</span>&nbsp;<span class="ident" id="5202456">replaceAll</span><span class="op" id="5202466">(</span><span class="ident" id="5202467">bsrc</span>&nbsp;<span class="op" id="5202472">[</span><span class="op" id="5202473">]</span><span class="builtintype" id="5202474">byte</span><span class="op" id="5202478">,</span>&nbsp;<span class="ident" id="5202480">src</span>&nbsp;<span class="builtintype" id="5202484">string</span><span class="op" id="5202490">,</span>&nbsp;<span class="ident" id="5202492">nmatch</span>&nbsp;<span class="builtintype" id="5202499">int</span><span class="op" id="5202502">,</span>&nbsp;<span class="ident" id="5202504">repl</span>&nbsp;<span class="keyword" id="5202509">func</span><span class="op" id="5202513">(</span><span class="ident" id="5202514">dst</span>&nbsp;<span class="op" id="5202518">[</span><span class="op" id="5202519">]</span><span class="builtintype" id="5202520">byte</span><span class="op" id="5202524">,</span>&nbsp;<span class="ident" id="5202526">m</span>&nbsp;<span class="op" id="5202528">[</span><span class="op" id="5202529">]</span><span class="builtintype" id="5202530">int</span><span class="op" id="5202533">)</span>&nbsp;<span class="op" id="5202535">[</span><span class="op" id="5202536">]</span><span class="builtintype" id="5202537">byte</span><span class="op" id="5202541">)</span>&nbsp;<span class="op" id="5202543">[</span><span class="op" id="5202544">]</span><span class="builtintype" id="5202545">byte</span>&nbsp;<span class="op" id="5202550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202553">lastMatchEnd</span>&nbsp;<span class="op" id="5202566">:=</span>&nbsp;<span class="num" id="5202569">0</span>&nbsp;<span class="comment" id="5202571">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202613">searchPos</span>&nbsp;<span class="op" id="5202623">:=</span>&nbsp;<span class="num" id="5202626">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5202631">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202675">var</span>&nbsp;<span class="ident" id="5202679">buf</span>&nbsp;<span class="op" id="5202683">[</span><span class="op" id="5202684">]</span><span class="builtintype" id="5202685">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202691">var</span>&nbsp;<span class="ident" id="5202695">endPos</span>&nbsp;<span class="builtintype" id="5202702">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202707">if</span>&nbsp;<span class="ident" id="5202710">bsrc</span>&nbsp;<span class="op" id="5202715">!=</span>&nbsp;<span class="ident" id="5202718">nil</span>&nbsp;<span class="op" id="5202722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202726">endPos</span>&nbsp;<span class="op" id="5202733">=</span>&nbsp;<span class="builtinfunc" id="5202735">len</span><span class="op" id="5202738">(</span><span class="ident" id="5202739">bsrc</span><span class="op" id="5202743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202746">}</span>&nbsp;<span class="keyword" id="5202748">else</span>&nbsp;<span class="op" id="5202753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202757">endPos</span>&nbsp;<span class="op" id="5202764">=</span>&nbsp;<span class="builtinfunc" id="5202766">len</span><span class="op" id="5202769">(</span><span class="ident" id="5202770">src</span><span class="op" id="5202773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202776">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202779">for</span>&nbsp;<span class="ident" id="5202783">searchPos</span>&nbsp;<span class="op" id="5202793">&lt;=</span>&nbsp;<span class="ident" id="5202796">endPos</span>&nbsp;<span class="op" id="5202803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202807">a</span>&nbsp;<span class="op" id="5202809">:=</span>&nbsp;<span class="ident" id="5202812">re</span><span class="op" id="5202814">.</span><span class="ident" id="5202815">doExecute</span><span class="op" id="5202824">(</span><span class="ident" id="5202825">nil</span><span class="op" id="5202828">,</span>&nbsp;<span class="ident" id="5202830">bsrc</span><span class="op" id="5202834">,</span>&nbsp;<span class="ident" id="5202836">src</span><span class="op" id="5202839">,</span>&nbsp;<span class="ident" id="5202841">searchPos</span><span class="op" id="5202850">,</span>&nbsp;<span class="ident" id="5202852">nmatch</span><span class="op" id="5202858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202862">if</span>&nbsp;<span class="builtinfunc" id="5202865">len</span><span class="op" id="5202868">(</span><span class="ident" id="5202869">a</span><span class="op" id="5202870">)</span>&nbsp;<span class="op" id="5202872">==</span>&nbsp;<span class="num" id="5202875">0</span>&nbsp;<span class="op" id="5202877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202882">break</span>&nbsp;<span class="comment" id="5202888">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202909">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202914">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202968">if</span>&nbsp;<span class="ident" id="5202971">bsrc</span>&nbsp;<span class="op" id="5202976">!=</span>&nbsp;<span class="ident" id="5202979">nil</span>&nbsp;<span class="op" id="5202983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202988">buf</span>&nbsp;<span class="op" id="5202992">=</span>&nbsp;<span class="builtinfunc" id="5202994">append</span><span class="op" id="5203000">(</span><span class="ident" id="5203001">buf</span><span class="op" id="5203004">,</span>&nbsp;<span class="ident" id="5203006">bsrc</span><span class="op" id="5203010">[</span><span class="ident" id="5203011">lastMatchEnd</span><span class="op" id="5203023">:</span><span class="ident" id="5203024">a</span><span class="op" id="5203025">[</span><span class="num" id="5203026">0</span><span class="op" id="5203027">]</span><span class="op" id="5203028">]</span><span class="op" id="5203029">...</span><span class="op" id="5203032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203036">}</span>&nbsp;<span class="keyword" id="5203038">else</span>&nbsp;<span class="op" id="5203043">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203048">buf</span>&nbsp;<span class="op" id="5203052">=</span>&nbsp;<span class="builtinfunc" id="5203054">append</span><span class="op" id="5203060">(</span><span class="ident" id="5203061">buf</span><span class="op" id="5203064">,</span>&nbsp;<span class="ident" id="5203066">src</span><span class="op" id="5203069">[</span><span class="ident" id="5203070">lastMatchEnd</span><span class="op" id="5203082">:</span><span class="ident" id="5203083">a</span><span class="op" id="5203084">[</span><span class="num" id="5203085">0</span><span class="op" id="5203086">]</span><span class="op" id="5203087">]</span><span class="op" id="5203088">...</span><span class="op" id="5203091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203100">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203164">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203228">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203289">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203334">if</span>&nbsp;<span class="ident" id="5203337">a</span><span class="op" id="5203338">[</span><span class="num" id="5203339">1</span><span class="op" id="5203340">]</span>&nbsp;<span class="op" id="5203342">&gt;</span>&nbsp;<span class="ident" id="5203344">lastMatchEnd</span>&nbsp;<span class="op" id="5203357">||</span>&nbsp;<span class="ident" id="5203360">a</span><span class="op" id="5203361">[</span><span class="num" id="5203362">0</span><span class="op" id="5203363">]</span>&nbsp;<span class="op" id="5203365">==</span>&nbsp;<span class="num" id="5203368">0</span>&nbsp;<span class="op" id="5203370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203375">buf</span>&nbsp;<span class="op" id="5203379">=</span>&nbsp;<span class="ident" id="5203381">repl</span><span class="op" id="5203385">(</span><span class="ident" id="5203386">buf</span><span class="op" id="5203389">,</span>&nbsp;<span class="ident" id="5203391">a</span><span class="op" id="5203392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203396">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203400">lastMatchEnd</span>&nbsp;<span class="op" id="5203413">=</span>&nbsp;<span class="ident" id="5203415">a</span><span class="op" id="5203416">[</span><span class="num" id="5203417">1</span><span class="op" id="5203418">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203423">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203492">var</span>&nbsp;<span class="ident" id="5203496">width</span>&nbsp;<span class="builtintype" id="5203502">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203508">if</span>&nbsp;<span class="ident" id="5203511">bsrc</span>&nbsp;<span class="op" id="5203516">!=</span>&nbsp;<span class="ident" id="5203519">nil</span>&nbsp;<span class="op" id="5203523">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203528">_</span><span class="op" id="5203529">,</span>&nbsp;<span class="ident" id="5203531">width</span>&nbsp;<span class="op" id="5203537">=</span>&nbsp;<span class="ident" id="5203539">utf8</span><span class="op" id="5203543">.</span><span class="ident" id="5203544">DecodeRune</span><span class="op" id="5203554">(</span><span class="ident" id="5203555">bsrc</span><span class="op" id="5203559">[</span><span class="ident" id="5203560">searchPos</span><span class="op" id="5203569">:</span><span class="op" id="5203570">]</span><span class="op" id="5203571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203575">}</span>&nbsp;<span class="keyword" id="5203577">else</span>&nbsp;<span class="op" id="5203582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203587">_</span><span class="op" id="5203588">,</span>&nbsp;<span class="ident" id="5203590">width</span>&nbsp;<span class="op" id="5203596">=</span>&nbsp;<span class="ident" id="5203598">utf8</span><span class="op" id="5203602">.</span><span class="ident" id="5203603">DecodeRuneInString</span><span class="op" id="5203621">(</span><span class="ident" id="5203622">src</span><span class="op" id="5203625">[</span><span class="ident" id="5203626">searchPos</span><span class="op" id="5203635">:</span><span class="op" id="5203636">]</span><span class="op" id="5203637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203645">if</span>&nbsp;<span class="ident" id="5203648">searchPos</span><span class="op" id="5203657">+</span><span class="ident" id="5203658">width</span>&nbsp;<span class="op" id="5203664">&gt;</span>&nbsp;<span class="ident" id="5203666">a</span><span class="op" id="5203667">[</span><span class="num" id="5203668">1</span><span class="op" id="5203669">]</span>&nbsp;<span class="op" id="5203671">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203676">searchPos</span>&nbsp;<span class="op" id="5203686">+=</span>&nbsp;<span class="ident" id="5203689">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203697">}</span>&nbsp;<span class="keyword" id="5203699">else</span>&nbsp;<span class="keyword" id="5203704">if</span>&nbsp;<span class="ident" id="5203707">searchPos</span><span class="op" id="5203716">+</span><span class="num" id="5203717">1</span>&nbsp;<span class="op" id="5203719">&gt;</span>&nbsp;<span class="ident" id="5203721">a</span><span class="op" id="5203722">[</span><span class="num" id="5203723">1</span><span class="op" id="5203724">]</span>&nbsp;<span class="op" id="5203726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203731">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203788">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203853">searchPos</span><span class="op" id="5203862">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203867">}</span>&nbsp;<span class="keyword" id="5203869">else</span>&nbsp;<span class="op" id="5203874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203879">searchPos</span>&nbsp;<span class="op" id="5203889">=</span>&nbsp;<span class="ident" id="5203891">a</span><span class="op" id="5203892">[</span><span class="num" id="5203893">1</span><span class="op" id="5203894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203905">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203961">if</span>&nbsp;<span class="ident" id="5203964">bsrc</span>&nbsp;<span class="op" id="5203969">!=</span>&nbsp;<span class="ident" id="5203972">nil</span>&nbsp;<span class="op" id="5203976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203980">buf</span>&nbsp;<span class="op" id="5203984">=</span>&nbsp;<span class="builtinfunc" id="5203986">append</span><span class="op" id="5203992">(</span><span class="ident" id="5203993">buf</span><span class="op" id="5203996">,</span>&nbsp;<span class="ident" id="5203998">bsrc</span><span class="op" id="5204002">[</span><span class="ident" id="5204003">lastMatchEnd</span><span class="op" id="5204015">:</span><span class="op" id="5204016">]</span><span class="op" id="5204017">...</span><span class="op" id="5204020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204023">}</span>&nbsp;<span class="keyword" id="5204025">else</span>&nbsp;<span class="op" id="5204030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204034">buf</span>&nbsp;<span class="op" id="5204038">=</span>&nbsp;<span class="builtinfunc" id="5204040">append</span><span class="op" id="5204046">(</span><span class="ident" id="5204047">buf</span><span class="op" id="5204050">,</span>&nbsp;<span class="ident" id="5204052">src</span><span class="op" id="5204055">[</span><span class="ident" id="5204056">lastMatchEnd</span><span class="op" id="5204068">:</span><span class="op" id="5204069">]</span><span class="op" id="5204070">...</span><span class="op" id="5204073">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204080">return</span>&nbsp;<span class="ident" id="5204087">buf</span><br>
<span class="lineno"></span><span class="op" id="5204091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="5204094">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5204163">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5204239">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="5204315">func</span>&nbsp;<span class="op" id="5204320">(</span><span class="ident" id="5204321">re</span>&nbsp;<span class="op" id="5204324">*</span><span class="ident" id="5204325">Regexp</span><span class="op" id="5204331">)</span>&nbsp;<span class="ident" id="5204333">ReplaceAll</span><span class="op" id="5204343">(</span><span class="ident" id="5204344">src</span><span class="op" id="5204347">,</span>&nbsp;<span class="ident" id="5204349">repl</span>&nbsp;<span class="op" id="5204354">[</span><span class="op" id="5204355">]</span><span class="builtintype" id="5204356">byte</span><span class="op" id="5204360">)</span>&nbsp;<span class="op" id="5204362">[</span><span class="op" id="5204363">]</span><span class="builtintype" id="5204364">byte</span>&nbsp;<span class="op" id="5204369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204372">n</span>&nbsp;<span class="op" id="5204374">:=</span>&nbsp;<span class="num" id="5204377">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204380">if</span>&nbsp;<span class="ident" id="5204383">bytes</span><span class="op" id="5204388">.</span><span class="ident" id="5204389">IndexByte</span><span class="op" id="5204398">(</span><span class="ident" id="5204399">repl</span><span class="op" id="5204403">,</span>&nbsp;<span class="string" id="5204405">&#39;$&#39;</span><span class="op" id="5204408">)</span>&nbsp;<span class="op" id="5204410">&gt;=</span>&nbsp;<span class="num" id="5204413">0</span>&nbsp;<span class="op" id="5204415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204419">n</span>&nbsp;<span class="op" id="5204421">=</span>&nbsp;<span class="num" id="5204423">2</span>&nbsp;<span class="op" id="5204425">*</span>&nbsp;<span class="op" id="5204427">(</span><span class="ident" id="5204428">re</span><span class="op" id="5204430">.</span><span class="ident" id="5204431">numSubexp</span>&nbsp;<span class="op" id="5204441">+</span>&nbsp;<span class="num" id="5204443">1</span><span class="op" id="5204444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204450">srepl</span>&nbsp;<span class="op" id="5204456">:=</span>&nbsp;<span class="string" id="5204459">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204463">b</span>&nbsp;<span class="op" id="5204465">:=</span>&nbsp;<span class="ident" id="5204468">re</span><span class="op" id="5204470">.</span><span class="ident" id="5204471">replaceAll</span><span class="op" id="5204481">(</span><span class="ident" id="5204482">src</span><span class="op" id="5204485">,</span>&nbsp;<span class="string" id="5204487">&#34;&#34;</span><span class="op" id="5204489">,</span>&nbsp;<span class="ident" id="5204491">n</span><span class="op" id="5204492">,</span>&nbsp;<span class="keyword" id="5204494">func</span><span class="op" id="5204498">(</span><span class="ident" id="5204499">dst</span>&nbsp;<span class="op" id="5204503">[</span><span class="op" id="5204504">]</span><span class="builtintype" id="5204505">byte</span><span class="op" id="5204509">,</span>&nbsp;<span class="ident" id="5204511">match</span>&nbsp;<span class="op" id="5204517">[</span><span class="op" id="5204518">]</span><span class="builtintype" id="5204519">int</span><span class="op" id="5204522">)</span>&nbsp;<span class="op" id="5204524">[</span><span class="op" id="5204525">]</span><span class="builtintype" id="5204526">byte</span>&nbsp;<span class="op" id="5204531">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204535">if</span>&nbsp;<span class="builtinfunc" id="5204538">len</span><span class="op" id="5204541">(</span><span class="ident" id="5204542">srepl</span><span class="op" id="5204547">)</span>&nbsp;<span class="op" id="5204549">!=</span>&nbsp;<span class="builtinfunc" id="5204552">len</span><span class="op" id="5204555">(</span><span class="ident" id="5204556">repl</span><span class="op" id="5204560">)</span>&nbsp;<span class="op" id="5204562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204567">srepl</span>&nbsp;<span class="op" id="5204573">=</span>&nbsp;<span class="builtintype" id="5204575">string</span><span class="op" id="5204581">(</span><span class="ident" id="5204582">repl</span><span class="op" id="5204586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204594">return</span>&nbsp;<span class="ident" id="5204601">re</span><span class="op" id="5204603">.</span><span class="ident" id="5204604">expand</span><span class="op" id="5204610">(</span><span class="ident" id="5204611">dst</span><span class="op" id="5204614">,</span>&nbsp;<span class="ident" id="5204616">srepl</span><span class="op" id="5204621">,</span>&nbsp;<span class="ident" id="5204623">src</span><span class="op" id="5204626">,</span>&nbsp;<span class="string" id="5204628">&#34;&#34;</span><span class="op" id="5204630">,</span>&nbsp;<span class="ident" id="5204632">match</span><span class="op" id="5204637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204640">}</span><span class="op" id="5204641">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204644">return</span>&nbsp;<span class="ident" id="5204651">b</span><br>
<span class="lineno"></span><span class="op" id="5204653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204656">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="5204732">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="5204815">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5204840">func</span>&nbsp;<span class="op" id="5204845">(</span><span class="ident" id="5204846">re</span>&nbsp;<span class="op" id="5204849">*</span><span class="ident" id="5204850">Regexp</span><span class="op" id="5204856">)</span>&nbsp;<span class="ident" id="5204858">ReplaceAllLiteral</span><span class="op" id="5204875">(</span><span class="ident" id="5204876">src</span><span class="op" id="5204879">,</span>&nbsp;<span class="ident" id="5204881">repl</span>&nbsp;<span class="op" id="5204886">[</span><span class="op" id="5204887">]</span><span class="builtintype" id="5204888">byte</span><span class="op" id="5204892">)</span>&nbsp;<span class="op" id="5204894">[</span><span class="op" id="5204895">]</span><span class="builtintype" id="5204896">byte</span>&nbsp;<span class="op" id="5204901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204904">return</span>&nbsp;<span class="ident" id="5204911">re</span><span class="op" id="5204913">.</span><span class="ident" id="5204914">replaceAll</span><span class="op" id="5204924">(</span><span class="ident" id="5204925">src</span><span class="op" id="5204928">,</span>&nbsp;<span class="string" id="5204930">&#34;&#34;</span><span class="op" id="5204932">,</span>&nbsp;<span class="num" id="5204934">2</span><span class="op" id="5204935">,</span>&nbsp;<span class="keyword" id="5204937">func</span><span class="op" id="5204941">(</span><span class="ident" id="5204942">dst</span>&nbsp;<span class="op" id="5204946">[</span><span class="op" id="5204947">]</span><span class="builtintype" id="5204948">byte</span><span class="op" id="5204952">,</span>&nbsp;<span class="ident" id="5204954">match</span>&nbsp;<span class="op" id="5204960">[</span><span class="op" id="5204961">]</span><span class="builtintype" id="5204962">int</span><span class="op" id="5204965">)</span>&nbsp;<span class="op" id="5204967">[</span><span class="op" id="5204968">]</span><span class="builtintype" id="5204969">byte</span>&nbsp;<span class="op" id="5204974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204978">return</span>&nbsp;<span class="builtinfunc" id="5204985">append</span><span class="op" id="5204991">(</span><span class="ident" id="5204992">dst</span><span class="op" id="5204995">,</span>&nbsp;<span class="ident" id="5204997">repl</span><span class="op" id="5205001">...</span><span class="op" id="5205004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205007">}</span><span class="op" id="5205008">)</span><br>
<span class="lineno">560</span><span class="op" id="5205010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205013">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5205081">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="5205155">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="5205234">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="5205269">func</span>&nbsp;<span class="op" id="5205274">(</span><span class="ident" id="5205275">re</span>&nbsp;<span class="op" id="5205278">*</span><span class="ident" id="5205279">Regexp</span><span class="op" id="5205285">)</span>&nbsp;<span class="ident" id="5205287">ReplaceAllFunc</span><span class="op" id="5205301">(</span><span class="ident" id="5205302">src</span>&nbsp;<span class="op" id="5205306">[</span><span class="op" id="5205307">]</span><span class="builtintype" id="5205308">byte</span><span class="op" id="5205312">,</span>&nbsp;<span class="ident" id="5205314">repl</span>&nbsp;<span class="keyword" id="5205319">func</span><span class="op" id="5205323">(</span><span class="op" id="5205324">[</span><span class="op" id="5205325">]</span><span class="builtintype" id="5205326">byte</span><span class="op" id="5205330">)</span>&nbsp;<span class="op" id="5205332">[</span><span class="op" id="5205333">]</span><span class="builtintype" id="5205334">byte</span><span class="op" id="5205338">)</span>&nbsp;<span class="op" id="5205340">[</span><span class="op" id="5205341">]</span><span class="builtintype" id="5205342">byte</span>&nbsp;<span class="op" id="5205347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205350">return</span>&nbsp;<span class="ident" id="5205357">re</span><span class="op" id="5205359">.</span><span class="ident" id="5205360">replaceAll</span><span class="op" id="5205370">(</span><span class="ident" id="5205371">src</span><span class="op" id="5205374">,</span>&nbsp;<span class="string" id="5205376">&#34;&#34;</span><span class="op" id="5205378">,</span>&nbsp;<span class="num" id="5205380">2</span><span class="op" id="5205381">,</span>&nbsp;<span class="keyword" id="5205383">func</span><span class="op" id="5205387">(</span><span class="ident" id="5205388">dst</span>&nbsp;<span class="op" id="5205392">[</span><span class="op" id="5205393">]</span><span class="builtintype" id="5205394">byte</span><span class="op" id="5205398">,</span>&nbsp;<span class="ident" id="5205400">match</span>&nbsp;<span class="op" id="5205406">[</span><span class="op" id="5205407">]</span><span class="builtintype" id="5205408">int</span><span class="op" id="5205411">)</span>&nbsp;<span class="op" id="5205413">[</span><span class="op" id="5205414">]</span><span class="builtintype" id="5205415">byte</span>&nbsp;<span class="op" id="5205420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205424">return</span>&nbsp;<span class="builtinfunc" id="5205431">append</span><span class="op" id="5205437">(</span><span class="ident" id="5205438">dst</span><span class="op" id="5205441">,</span>&nbsp;<span class="ident" id="5205443">repl</span><span class="op" id="5205447">(</span><span class="ident" id="5205448">src</span><span class="op" id="5205451">[</span><span class="ident" id="5205452">match</span><span class="op" id="5205457">[</span><span class="num" id="5205458">0</span><span class="op" id="5205459">]</span><span class="op" id="5205460">:</span><span class="ident" id="5205461">match</span><span class="op" id="5205466">[</span><span class="num" id="5205467">1</span><span class="op" id="5205468">]</span><span class="op" id="5205469">]</span><span class="op" id="5205470">)</span><span class="op" id="5205471">...</span><span class="op" id="5205474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205477">}</span><span class="op" id="5205478">)</span><br>
<span class="lineno">570</span><span class="op" id="5205480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5205483">var</span>&nbsp;<span class="ident" id="5205487">specialBytes</span>&nbsp;<span class="op" id="5205500">=</span>&nbsp;<span class="op" id="5205502">[</span><span class="op" id="5205503">]</span><span class="builtintype" id="5205504">byte</span><span class="op" id="5205508">(</span><span class="string" id="5205509">`\.+*?()|[]{}^$`</span><span class="op" id="5205525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5205528">func</span>&nbsp;<span class="ident" id="5205533">special</span><span class="op" id="5205540">(</span><span class="ident" id="5205541">b</span>&nbsp;<span class="builtintype" id="5205543">byte</span><span class="op" id="5205547">)</span>&nbsp;<span class="builtintype" id="5205549">bool</span>&nbsp;<span class="op" id="5205554">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205557">return</span>&nbsp;<span class="ident" id="5205564">bytes</span><span class="op" id="5205569">.</span><span class="ident" id="5205570">IndexByte</span><span class="op" id="5205579">(</span><span class="ident" id="5205580">specialBytes</span><span class="op" id="5205592">,</span>&nbsp;<span class="ident" id="5205594">b</span><span class="op" id="5205595">)</span>&nbsp;<span class="op" id="5205597">&gt;=</span>&nbsp;<span class="num" id="5205600">0</span><br>
<span class="lineno"></span><span class="op" id="5205602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205605">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="5205685">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="5205767">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="5205840">func</span>&nbsp;<span class="ident" id="5205845">QuoteMeta</span><span class="op" id="5205854">(</span><span class="ident" id="5205855">s</span>&nbsp;<span class="builtintype" id="5205857">string</span><span class="op" id="5205863">)</span>&nbsp;<span class="builtintype" id="5205865">string</span>&nbsp;<span class="op" id="5205872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205875">b</span>&nbsp;<span class="op" id="5205877">:=</span>&nbsp;<span class="builtinfunc" id="5205880">make</span><span class="op" id="5205884">(</span><span class="op" id="5205885">[</span><span class="op" id="5205886">]</span><span class="builtintype" id="5205887">byte</span><span class="op" id="5205891">,</span>&nbsp;<span class="num" id="5205893">2</span><span class="op" id="5205894">*</span><span class="builtinfunc" id="5205895">len</span><span class="op" id="5205898">(</span><span class="ident" id="5205899">s</span><span class="op" id="5205900">)</span><span class="op" id="5205901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205905">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205970">j</span>&nbsp;<span class="op" id="5205972">:=</span>&nbsp;<span class="num" id="5205975">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205978">for</span>&nbsp;<span class="ident" id="5205982">i</span>&nbsp;<span class="op" id="5205984">:=</span>&nbsp;<span class="num" id="5205987">0</span><span class="op" id="5205988">;</span>&nbsp;<span class="ident" id="5205990">i</span>&nbsp;<span class="op" id="5205992">&lt;</span>&nbsp;<span class="builtinfunc" id="5205994">len</span><span class="op" id="5205997">(</span><span class="ident" id="5205998">s</span><span class="op" id="5205999">)</span><span class="op" id="5206000">;</span>&nbsp;<span class="ident" id="5206002">i</span><span class="op" id="5206003">++</span>&nbsp;<span class="op" id="5206006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206010">if</span>&nbsp;<span class="ident" id="5206013">special</span><span class="op" id="5206020">(</span><span class="ident" id="5206021">s</span><span class="op" id="5206022">[</span><span class="ident" id="5206023">i</span><span class="op" id="5206024">]</span><span class="op" id="5206025">)</span>&nbsp;<span class="op" id="5206027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206032">b</span><span class="op" id="5206033">[</span><span class="ident" id="5206034">j</span><span class="op" id="5206035">]</span>&nbsp;<span class="op" id="5206037">=</span>&nbsp;<span class="string" id="5206039">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206047">j</span><span class="op" id="5206048">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206057">b</span><span class="op" id="5206058">[</span><span class="ident" id="5206059">j</span><span class="op" id="5206060">]</span>&nbsp;<span class="op" id="5206062">=</span>&nbsp;<span class="ident" id="5206064">s</span><span class="op" id="5206065">[</span><span class="ident" id="5206066">i</span><span class="op" id="5206067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206071">j</span><span class="op" id="5206072">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206079">return</span>&nbsp;<span class="builtintype" id="5206086">string</span><span class="op" id="5206092">(</span><span class="ident" id="5206093">b</span><span class="op" id="5206094">[</span><span class="num" id="5206095">0</span><span class="op" id="5206096">:</span><span class="ident" id="5206097">j</span><span class="op" id="5206098">]</span><span class="op" id="5206099">)</span><br>
<span class="lineno">595</span><span class="op" id="5206101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206104">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5206166">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="5206224">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="5206285">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5206346">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5206414">func</span>&nbsp;<span class="op" id="5206419">(</span><span class="ident" id="5206420">re</span>&nbsp;<span class="op" id="5206423">*</span><span class="ident" id="5206424">Regexp</span><span class="op" id="5206430">)</span>&nbsp;<span class="ident" id="5206432">pad</span><span class="op" id="5206435">(</span><span class="ident" id="5206436">a</span>&nbsp;<span class="op" id="5206438">[</span><span class="op" id="5206439">]</span><span class="builtintype" id="5206440">int</span><span class="op" id="5206443">)</span>&nbsp;<span class="op" id="5206445">[</span><span class="op" id="5206446">]</span><span class="builtintype" id="5206447">int</span>&nbsp;<span class="op" id="5206451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206454">if</span>&nbsp;<span class="ident" id="5206457">a</span>&nbsp;<span class="op" id="5206459">==</span>&nbsp;<span class="ident" id="5206462">nil</span>&nbsp;<span class="op" id="5206466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206470">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206485">return</span>&nbsp;<span class="ident" id="5206492">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206500">n</span>&nbsp;<span class="op" id="5206502">:=</span>&nbsp;<span class="op" id="5206505">(</span><span class="num" id="5206506">1</span>&nbsp;<span class="op" id="5206508">+</span>&nbsp;<span class="ident" id="5206510">re</span><span class="op" id="5206512">.</span><span class="ident" id="5206513">numSubexp</span><span class="op" id="5206522">)</span>&nbsp;<span class="op" id="5206524">*</span>&nbsp;<span class="num" id="5206526">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206529">for</span>&nbsp;<span class="builtinfunc" id="5206533">len</span><span class="op" id="5206536">(</span><span class="ident" id="5206537">a</span><span class="op" id="5206538">)</span>&nbsp;<span class="op" id="5206540">&lt;</span>&nbsp;<span class="ident" id="5206542">n</span>&nbsp;<span class="op" id="5206544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206548">a</span>&nbsp;<span class="op" id="5206550">=</span>&nbsp;<span class="builtinfunc" id="5206552">append</span><span class="op" id="5206558">(</span><span class="ident" id="5206559">a</span><span class="op" id="5206560">,</span>&nbsp;<span class="op" id="5206562">-</span><span class="num" id="5206563">1</span><span class="op" id="5206564">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206570">return</span>&nbsp;<span class="ident" id="5206577">a</span><br>
<span class="lineno"></span><span class="op" id="5206579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206582">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="5206662">func</span>&nbsp;<span class="op" id="5206667">(</span><span class="ident" id="5206668">re</span>&nbsp;<span class="op" id="5206671">*</span><span class="ident" id="5206672">Regexp</span><span class="op" id="5206678">)</span>&nbsp;<span class="ident" id="5206680">allMatches</span><span class="op" id="5206690">(</span><span class="ident" id="5206691">s</span>&nbsp;<span class="builtintype" id="5206693">string</span><span class="op" id="5206699">,</span>&nbsp;<span class="ident" id="5206701">b</span>&nbsp;<span class="op" id="5206703">[</span><span class="op" id="5206704">]</span><span class="builtintype" id="5206705">byte</span><span class="op" id="5206709">,</span>&nbsp;<span class="ident" id="5206711">n</span>&nbsp;<span class="builtintype" id="5206713">int</span><span class="op" id="5206716">,</span>&nbsp;<span class="ident" id="5206718">deliver</span>&nbsp;<span class="keyword" id="5206726">func</span><span class="op" id="5206730">(</span><span class="op" id="5206731">[</span><span class="op" id="5206732">]</span><span class="builtintype" id="5206733">int</span><span class="op" id="5206736">)</span><span class="op" id="5206737">)</span>&nbsp;<span class="op" id="5206739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206742">var</span>&nbsp;<span class="ident" id="5206746">end</span>&nbsp;<span class="builtintype" id="5206750">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206755">if</span>&nbsp;<span class="ident" id="5206758">b</span>&nbsp;<span class="op" id="5206760">==</span>&nbsp;<span class="ident" id="5206763">nil</span>&nbsp;<span class="op" id="5206767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206771">end</span>&nbsp;<span class="op" id="5206775">=</span>&nbsp;<span class="builtinfunc" id="5206777">len</span><span class="op" id="5206780">(</span><span class="ident" id="5206781">s</span><span class="op" id="5206782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206785">}</span>&nbsp;<span class="keyword" id="5206787">else</span>&nbsp;<span class="op" id="5206792">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206796">end</span>&nbsp;<span class="op" id="5206800">=</span>&nbsp;<span class="builtinfunc" id="5206802">len</span><span class="op" id="5206805">(</span><span class="ident" id="5206806">b</span><span class="op" id="5206807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206814">for</span>&nbsp;<span class="ident" id="5206818">pos</span><span class="op" id="5206821">,</span>&nbsp;<span class="ident" id="5206823">i</span><span class="op" id="5206824">,</span>&nbsp;<span class="ident" id="5206826">prevMatchEnd</span>&nbsp;<span class="op" id="5206839">:=</span>&nbsp;<span class="num" id="5206842">0</span><span class="op" id="5206843">,</span>&nbsp;<span class="num" id="5206845">0</span><span class="op" id="5206846">,</span>&nbsp;<span class="op" id="5206848">-</span><span class="num" id="5206849">1</span><span class="op" id="5206850">;</span>&nbsp;<span class="ident" id="5206852">i</span>&nbsp;<span class="op" id="5206854">&lt;</span>&nbsp;<span class="ident" id="5206856">n</span>&nbsp;<span class="op" id="5206858">&amp;&amp;</span>&nbsp;<span class="ident" id="5206861">pos</span>&nbsp;<span class="op" id="5206865">&lt;=</span>&nbsp;<span class="ident" id="5206868">end</span><span class="op" id="5206871">;</span>&nbsp;<span class="op" id="5206873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206877">matches</span>&nbsp;<span class="op" id="5206885">:=</span>&nbsp;<span class="ident" id="5206888">re</span><span class="op" id="5206890">.</span><span class="ident" id="5206891">doExecute</span><span class="op" id="5206900">(</span><span class="ident" id="5206901">nil</span><span class="op" id="5206904">,</span>&nbsp;<span class="ident" id="5206906">b</span><span class="op" id="5206907">,</span>&nbsp;<span class="ident" id="5206909">s</span><span class="op" id="5206910">,</span>&nbsp;<span class="ident" id="5206912">pos</span><span class="op" id="5206915">,</span>&nbsp;<span class="ident" id="5206917">re</span><span class="op" id="5206919">.</span><span class="ident" id="5206920">prog</span><span class="op" id="5206924">.</span><span class="ident" id="5206925">NumCap</span><span class="op" id="5206931">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206935">if</span>&nbsp;<span class="builtinfunc" id="5206938">len</span><span class="op" id="5206941">(</span><span class="ident" id="5206942">matches</span><span class="op" id="5206949">)</span>&nbsp;<span class="op" id="5206951">==</span>&nbsp;<span class="num" id="5206954">0</span>&nbsp;<span class="op" id="5206956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206961">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206974">accept</span>&nbsp;<span class="op" id="5206981">:=</span>&nbsp;<span class="ident" id="5206984">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206991">if</span>&nbsp;<span class="ident" id="5206994">matches</span><span class="op" id="5207001">[</span><span class="num" id="5207002">1</span><span class="op" id="5207003">]</span>&nbsp;<span class="op" id="5207005">==</span>&nbsp;<span class="ident" id="5207008">pos</span>&nbsp;<span class="op" id="5207012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207017">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207051">if</span>&nbsp;<span class="ident" id="5207054">matches</span><span class="op" id="5207061">[</span><span class="num" id="5207062">0</span><span class="op" id="5207063">]</span>&nbsp;<span class="op" id="5207065">==</span>&nbsp;<span class="ident" id="5207068">prevMatchEnd</span>&nbsp;<span class="op" id="5207081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207087">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207130">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207175">accept</span>&nbsp;<span class="op" id="5207182">=</span>&nbsp;<span class="ident" id="5207184">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207198">var</span>&nbsp;<span class="ident" id="5207202">width</span>&nbsp;<span class="builtintype" id="5207208">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207215">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207238">if</span>&nbsp;<span class="ident" id="5207241">b</span>&nbsp;<span class="op" id="5207243">==</span>&nbsp;<span class="ident" id="5207246">nil</span>&nbsp;<span class="op" id="5207250">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207256">_</span><span class="op" id="5207257">,</span>&nbsp;<span class="ident" id="5207259">width</span>&nbsp;<span class="op" id="5207265">=</span>&nbsp;<span class="ident" id="5207267">utf8</span><span class="op" id="5207271">.</span><span class="ident" id="5207272">DecodeRuneInString</span><span class="op" id="5207290">(</span><span class="ident" id="5207291">s</span><span class="op" id="5207292">[</span><span class="ident" id="5207293">pos</span><span class="op" id="5207296">:</span><span class="ident" id="5207297">end</span><span class="op" id="5207300">]</span><span class="op" id="5207301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207306">}</span>&nbsp;<span class="keyword" id="5207308">else</span>&nbsp;<span class="op" id="5207313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207319">_</span><span class="op" id="5207320">,</span>&nbsp;<span class="ident" id="5207322">width</span>&nbsp;<span class="op" id="5207328">=</span>&nbsp;<span class="ident" id="5207330">utf8</span><span class="op" id="5207334">.</span><span class="ident" id="5207335">DecodeRune</span><span class="op" id="5207345">(</span><span class="ident" id="5207346">b</span><span class="op" id="5207347">[</span><span class="ident" id="5207348">pos</span><span class="op" id="5207351">:</span><span class="ident" id="5207352">end</span><span class="op" id="5207355">]</span><span class="op" id="5207356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207366">if</span>&nbsp;<span class="ident" id="5207369">width</span>&nbsp;<span class="op" id="5207375">&gt;</span>&nbsp;<span class="num" id="5207377">0</span>&nbsp;<span class="op" id="5207379">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207385">pos</span>&nbsp;<span class="op" id="5207389">+=</span>&nbsp;<span class="ident" id="5207392">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207401">}</span>&nbsp;<span class="keyword" id="5207403">else</span>&nbsp;<span class="op" id="5207408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207414">pos</span>&nbsp;<span class="op" id="5207418">=</span>&nbsp;<span class="ident" id="5207420">end</span>&nbsp;<span class="op" id="5207424">+</span>&nbsp;<span class="num" id="5207426">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207435">}</span>&nbsp;<span class="keyword" id="5207437">else</span>&nbsp;<span class="op" id="5207442">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207447">pos</span>&nbsp;<span class="op" id="5207451">=</span>&nbsp;<span class="ident" id="5207453">matches</span><span class="op" id="5207460">[</span><span class="num" id="5207461">1</span><span class="op" id="5207462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207470">prevMatchEnd</span>&nbsp;<span class="op" id="5207483">=</span>&nbsp;<span class="ident" id="5207485">matches</span><span class="op" id="5207492">[</span><span class="num" id="5207493">1</span><span class="op" id="5207494">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207499">if</span>&nbsp;<span class="ident" id="5207502">accept</span>&nbsp;<span class="op" id="5207509">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207514">deliver</span><span class="op" id="5207521">(</span><span class="ident" id="5207522">re</span><span class="op" id="5207524">.</span><span class="ident" id="5207525">pad</span><span class="op" id="5207528">(</span><span class="ident" id="5207529">matches</span><span class="op" id="5207536">)</span><span class="op" id="5207537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207542">i</span><span class="op" id="5207543">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207551">}</span><br>
<span class="lineno"></span><span class="op" id="5207553">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5207556">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="5207651">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5207696">func</span>&nbsp;<span class="op" id="5207701">(</span><span class="ident" id="5207702">re</span>&nbsp;<span class="op" id="5207705">*</span><span class="ident" id="5207706">Regexp</span><span class="op" id="5207712">)</span>&nbsp;<span class="ident" id="5207714">Find</span><span class="op" id="5207718">(</span><span class="ident" id="5207719">b</span>&nbsp;<span class="op" id="5207721">[</span><span class="op" id="5207722">]</span><span class="builtintype" id="5207723">byte</span><span class="op" id="5207727">)</span>&nbsp;<span class="op" id="5207729">[</span><span class="op" id="5207730">]</span><span class="builtintype" id="5207731">byte</span>&nbsp;<span class="op" id="5207736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207739">a</span>&nbsp;<span class="op" id="5207741">:=</span>&nbsp;<span class="ident" id="5207744">re</span><span class="op" id="5207746">.</span><span class="ident" id="5207747">doExecute</span><span class="op" id="5207756">(</span><span class="ident" id="5207757">nil</span><span class="op" id="5207760">,</span>&nbsp;<span class="ident" id="5207762">b</span><span class="op" id="5207763">,</span>&nbsp;<span class="string" id="5207765">&#34;&#34;</span><span class="op" id="5207767">,</span>&nbsp;<span class="num" id="5207769">0</span><span class="op" id="5207770">,</span>&nbsp;<span class="num" id="5207772">2</span><span class="op" id="5207773">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207776">if</span>&nbsp;<span class="ident" id="5207779">a</span>&nbsp;<span class="op" id="5207781">==</span>&nbsp;<span class="ident" id="5207784">nil</span>&nbsp;<span class="op" id="5207788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207792">return</span>&nbsp;<span class="ident" id="5207799">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207807">return</span>&nbsp;<span class="ident" id="5207814">b</span><span class="op" id="5207815">[</span><span class="ident" id="5207816">a</span><span class="op" id="5207817">[</span><span class="num" id="5207818">0</span><span class="op" id="5207819">]</span><span class="op" id="5207820">:</span><span class="ident" id="5207821">a</span><span class="op" id="5207822">[</span><span class="num" id="5207823">1</span><span class="op" id="5207824">]</span><span class="op" id="5207825">]</span><br>
<span class="lineno"></span><span class="op" id="5207827">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5207830">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5207908">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5207986">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5208007">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="5208052">func</span>&nbsp;<span class="op" id="5208057">(</span><span class="ident" id="5208058">re</span>&nbsp;<span class="op" id="5208061">*</span><span class="ident" id="5208062">Regexp</span><span class="op" id="5208068">)</span>&nbsp;<span class="ident" id="5208070">FindIndex</span><span class="op" id="5208079">(</span><span class="ident" id="5208080">b</span>&nbsp;<span class="op" id="5208082">[</span><span class="op" id="5208083">]</span><span class="builtintype" id="5208084">byte</span><span class="op" id="5208088">)</span>&nbsp;<span class="op" id="5208090">(</span><span class="ident" id="5208091">loc</span>&nbsp;<span class="op" id="5208095">[</span><span class="op" id="5208096">]</span><span class="builtintype" id="5208097">int</span><span class="op" id="5208100">)</span>&nbsp;<span class="op" id="5208102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208105">a</span>&nbsp;<span class="op" id="5208107">:=</span>&nbsp;<span class="ident" id="5208110">re</span><span class="op" id="5208112">.</span><span class="ident" id="5208113">doExecute</span><span class="op" id="5208122">(</span><span class="ident" id="5208123">nil</span><span class="op" id="5208126">,</span>&nbsp;<span class="ident" id="5208128">b</span><span class="op" id="5208129">,</span>&nbsp;<span class="string" id="5208131">&#34;&#34;</span><span class="op" id="5208133">,</span>&nbsp;<span class="num" id="5208135">0</span><span class="op" id="5208136">,</span>&nbsp;<span class="num" id="5208138">2</span><span class="op" id="5208139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208142">if</span>&nbsp;<span class="ident" id="5208145">a</span>&nbsp;<span class="op" id="5208147">==</span>&nbsp;<span class="ident" id="5208150">nil</span>&nbsp;<span class="op" id="5208154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208158">return</span>&nbsp;<span class="ident" id="5208165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208170">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208173">return</span>&nbsp;<span class="ident" id="5208180">a</span><span class="op" id="5208181">[</span><span class="num" id="5208182">0</span><span class="op" id="5208183">:</span><span class="num" id="5208184">2</span><span class="op" id="5208185">]</span><br>
<span class="lineno"></span><span class="op" id="5208187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5208190">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5208280">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="5208355">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5208431">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5208503">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="5208544">func</span>&nbsp;<span class="op" id="5208549">(</span><span class="ident" id="5208550">re</span>&nbsp;<span class="op" id="5208553">*</span><span class="ident" id="5208554">Regexp</span><span class="op" id="5208560">)</span>&nbsp;<span class="ident" id="5208562">FindString</span><span class="op" id="5208572">(</span><span class="ident" id="5208573">s</span>&nbsp;<span class="builtintype" id="5208575">string</span><span class="op" id="5208581">)</span>&nbsp;<span class="builtintype" id="5208583">string</span>&nbsp;<span class="op" id="5208590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208593">a</span>&nbsp;<span class="op" id="5208595">:=</span>&nbsp;<span class="ident" id="5208598">re</span><span class="op" id="5208600">.</span><span class="ident" id="5208601">doExecute</span><span class="op" id="5208610">(</span><span class="ident" id="5208611">nil</span><span class="op" id="5208614">,</span>&nbsp;<span class="ident" id="5208616">nil</span><span class="op" id="5208619">,</span>&nbsp;<span class="ident" id="5208621">s</span><span class="op" id="5208622">,</span>&nbsp;<span class="num" id="5208624">0</span><span class="op" id="5208625">,</span>&nbsp;<span class="num" id="5208627">2</span><span class="op" id="5208628">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208631">if</span>&nbsp;<span class="ident" id="5208634">a</span>&nbsp;<span class="op" id="5208636">==</span>&nbsp;<span class="ident" id="5208639">nil</span>&nbsp;<span class="op" id="5208643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208647">return</span>&nbsp;<span class="string" id="5208654">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208661">return</span>&nbsp;<span class="ident" id="5208668">s</span><span class="op" id="5208669">[</span><span class="ident" id="5208670">a</span><span class="op" id="5208671">[</span><span class="num" id="5208672">0</span><span class="op" id="5208673">]</span><span class="op" id="5208674">:</span><span class="ident" id="5208675">a</span><span class="op" id="5208676">[</span><span class="num" id="5208677">1</span><span class="op" id="5208678">]</span><span class="op" id="5208679">]</span><br>
<span class="lineno"></span><span class="op" id="5208681">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5208684">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5208756">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="5208833">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="5208867">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="5208912">func</span>&nbsp;<span class="op" id="5208917">(</span><span class="ident" id="5208918">re</span>&nbsp;<span class="op" id="5208921">*</span><span class="ident" id="5208922">Regexp</span><span class="op" id="5208928">)</span>&nbsp;<span class="ident" id="5208930">FindStringIndex</span><span class="op" id="5208945">(</span><span class="ident" id="5208946">s</span>&nbsp;<span class="builtintype" id="5208948">string</span><span class="op" id="5208954">)</span>&nbsp;<span class="op" id="5208956">(</span><span class="ident" id="5208957">loc</span>&nbsp;<span class="op" id="5208961">[</span><span class="op" id="5208962">]</span><span class="builtintype" id="5208963">int</span><span class="op" id="5208966">)</span>&nbsp;<span class="op" id="5208968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208971">a</span>&nbsp;<span class="op" id="5208973">:=</span>&nbsp;<span class="ident" id="5208976">re</span><span class="op" id="5208978">.</span><span class="ident" id="5208979">doExecute</span><span class="op" id="5208988">(</span><span class="ident" id="5208989">nil</span><span class="op" id="5208992">,</span>&nbsp;<span class="ident" id="5208994">nil</span><span class="op" id="5208997">,</span>&nbsp;<span class="ident" id="5208999">s</span><span class="op" id="5209000">,</span>&nbsp;<span class="num" id="5209002">0</span><span class="op" id="5209003">,</span>&nbsp;<span class="num" id="5209005">2</span><span class="op" id="5209006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209009">if</span>&nbsp;<span class="ident" id="5209012">a</span>&nbsp;<span class="op" id="5209014">==</span>&nbsp;<span class="ident" id="5209017">nil</span>&nbsp;<span class="op" id="5209021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209025">return</span>&nbsp;<span class="ident" id="5209032">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209037">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209040">return</span>&nbsp;<span class="ident" id="5209047">a</span><span class="op" id="5209048">[</span><span class="num" id="5209049">0</span><span class="op" id="5209050">:</span><span class="num" id="5209051">2</span><span class="op" id="5209052">]</span><br>
<span class="lineno"></span><span class="op" id="5209054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5209057">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5209129">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="5209207">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5209275">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="5209315">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5209360">func</span>&nbsp;<span class="op" id="5209365">(</span><span class="ident" id="5209366">re</span>&nbsp;<span class="op" id="5209369">*</span><span class="ident" id="5209370">Regexp</span><span class="op" id="5209376">)</span>&nbsp;<span class="ident" id="5209378">FindReaderIndex</span><span class="op" id="5209393">(</span><span class="ident" id="5209394">r</span>&nbsp;<span class="ident" id="5209396">io</span><span class="op" id="5209398">.</span><span class="ident" id="5209399">RuneReader</span><span class="op" id="5209409">)</span>&nbsp;<span class="op" id="5209411">(</span><span class="ident" id="5209412">loc</span>&nbsp;<span class="op" id="5209416">[</span><span class="op" id="5209417">]</span><span class="builtintype" id="5209418">int</span><span class="op" id="5209421">)</span>&nbsp;<span class="op" id="5209423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209426">a</span>&nbsp;<span class="op" id="5209428">:=</span>&nbsp;<span class="ident" id="5209431">re</span><span class="op" id="5209433">.</span><span class="ident" id="5209434">doExecute</span><span class="op" id="5209443">(</span><span class="ident" id="5209444">r</span><span class="op" id="5209445">,</span>&nbsp;<span class="ident" id="5209447">nil</span><span class="op" id="5209450">,</span>&nbsp;<span class="string" id="5209452">&#34;&#34;</span><span class="op" id="5209454">,</span>&nbsp;<span class="num" id="5209456">0</span><span class="op" id="5209457">,</span>&nbsp;<span class="num" id="5209459">2</span><span class="op" id="5209460">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209463">if</span>&nbsp;<span class="ident" id="5209466">a</span>&nbsp;<span class="op" id="5209468">==</span>&nbsp;<span class="ident" id="5209471">nil</span>&nbsp;<span class="op" id="5209475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209479">return</span>&nbsp;<span class="ident" id="5209486">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209494">return</span>&nbsp;<span class="ident" id="5209501">a</span><span class="op" id="5209502">[</span><span class="num" id="5209503">0</span><span class="op" id="5209504">:</span><span class="num" id="5209505">2</span><span class="op" id="5209506">]</span><br>
<span class="lineno"></span><span class="op" id="5209508">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="5209511">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="5209586">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5209658">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5209734">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="5209746">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5209791">func</span>&nbsp;<span class="op" id="5209796">(</span><span class="ident" id="5209797">re</span>&nbsp;<span class="op" id="5209800">*</span><span class="ident" id="5209801">Regexp</span><span class="op" id="5209807">)</span>&nbsp;<span class="ident" id="5209809">FindSubmatch</span><span class="op" id="5209821">(</span><span class="ident" id="5209822">b</span>&nbsp;<span class="op" id="5209824">[</span><span class="op" id="5209825">]</span><span class="builtintype" id="5209826">byte</span><span class="op" id="5209830">)</span>&nbsp;<span class="op" id="5209832">[</span><span class="op" id="5209833">]</span><span class="op" id="5209834">[</span><span class="op" id="5209835">]</span><span class="builtintype" id="5209836">byte</span>&nbsp;<span class="op" id="5209841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209844">a</span>&nbsp;<span class="op" id="5209846">:=</span>&nbsp;<span class="ident" id="5209849">re</span><span class="op" id="5209851">.</span><span class="ident" id="5209852">doExecute</span><span class="op" id="5209861">(</span><span class="ident" id="5209862">nil</span><span class="op" id="5209865">,</span>&nbsp;<span class="ident" id="5209867">b</span><span class="op" id="5209868">,</span>&nbsp;<span class="string" id="5209870">&#34;&#34;</span><span class="op" id="5209872">,</span>&nbsp;<span class="num" id="5209874">0</span><span class="op" id="5209875">,</span>&nbsp;<span class="ident" id="5209877">re</span><span class="op" id="5209879">.</span><span class="ident" id="5209880">prog</span><span class="op" id="5209884">.</span><span class="ident" id="5209885">NumCap</span><span class="op" id="5209891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209894">if</span>&nbsp;<span class="ident" id="5209897">a</span>&nbsp;<span class="op" id="5209899">==</span>&nbsp;<span class="ident" id="5209902">nil</span>&nbsp;<span class="op" id="5209906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209910">return</span>&nbsp;<span class="ident" id="5209917">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209925">ret</span>&nbsp;<span class="op" id="5209929">:=</span>&nbsp;<span class="builtinfunc" id="5209932">make</span><span class="op" id="5209936">(</span><span class="op" id="5209937">[</span><span class="op" id="5209938">]</span><span class="op" id="5209939">[</span><span class="op" id="5209940">]</span><span class="builtintype" id="5209941">byte</span><span class="op" id="5209945">,</span>&nbsp;<span class="num" id="5209947">1</span><span class="op" id="5209948">+</span><span class="ident" id="5209949">re</span><span class="op" id="5209951">.</span><span class="ident" id="5209952">numSubexp</span><span class="op" id="5209961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209964">for</span>&nbsp;<span class="ident" id="5209968">i</span>&nbsp;<span class="op" id="5209970">:=</span>&nbsp;<span class="keyword" id="5209973">range</span>&nbsp;<span class="ident" id="5209979">ret</span>&nbsp;<span class="op" id="5209983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209987">if</span>&nbsp;<span class="num" id="5209990">2</span><span class="op" id="5209991">*</span><span class="ident" id="5209992">i</span>&nbsp;<span class="op" id="5209994">&lt;</span>&nbsp;<span class="builtinfunc" id="5209996">len</span><span class="op" id="5209999">(</span><span class="ident" id="5210000">a</span><span class="op" id="5210001">)</span>&nbsp;<span class="op" id="5210003">&amp;&amp;</span>&nbsp;<span class="ident" id="5210006">a</span><span class="op" id="5210007">[</span><span class="num" id="5210008">2</span><span class="op" id="5210009">*</span><span class="ident" id="5210010">i</span><span class="op" id="5210011">]</span>&nbsp;<span class="op" id="5210013">&gt;=</span>&nbsp;<span class="num" id="5210016">0</span>&nbsp;<span class="op" id="5210018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210023">ret</span><span class="op" id="5210026">[</span><span class="ident" id="5210027">i</span><span class="op" id="5210028">]</span>&nbsp;<span class="op" id="5210030">=</span>&nbsp;<span class="ident" id="5210032">b</span><span class="op" id="5210033">[</span><span class="ident" id="5210034">a</span><span class="op" id="5210035">[</span><span class="num" id="5210036">2</span><span class="op" id="5210037">*</span><span class="ident" id="5210038">i</span><span class="op" id="5210039">]</span><span class="op" id="5210040">:</span><span class="ident" id="5210041">a</span><span class="op" id="5210042">[</span><span class="num" id="5210043">2</span><span class="op" id="5210044">*</span><span class="ident" id="5210045">i</span><span class="op" id="5210046">+</span><span class="num" id="5210047">1</span><span class="op" id="5210048">]</span><span class="op" id="5210049">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210059">return</span>&nbsp;<span class="ident" id="5210066">ret</span><br>
<span class="lineno"></span><span class="op" id="5210070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5210073">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5210142">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5210214">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5210287">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="5210309">//</span><br>
<span class="lineno">745</span><span class="comment" id="5210312">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5210381">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="5210449">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5210518">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5210585">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="5210650">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5210723">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="5210793">//</span><br>
<span class="lineno"></span><span class="comment" id="5210796">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5210866">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="5210945">//</span><br>
<span class="lineno"></span><span class="comment" id="5210948">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5211012">func</span>&nbsp;<span class="op" id="5211017">(</span><span class="ident" id="5211018">re</span>&nbsp;<span class="op" id="5211021">*</span><span class="ident" id="5211022">Regexp</span><span class="op" id="5211028">)</span>&nbsp;<span class="ident" id="5211030">Expand</span><span class="op" id="5211036">(</span><span class="ident" id="5211037">dst</span>&nbsp;<span class="op" id="5211041">[</span><span class="op" id="5211042">]</span><span class="builtintype" id="5211043">byte</span><span class="op" id="5211047">,</span>&nbsp;<span class="ident" id="5211049">template</span>&nbsp;<span class="op" id="5211058">[</span><span class="op" id="5211059">]</span><span class="builtintype" id="5211060">byte</span><span class="op" id="5211064">,</span>&nbsp;<span class="ident" id="5211066">src</span>&nbsp;<span class="op" id="5211070">[</span><span class="op" id="5211071">]</span><span class="builtintype" id="5211072">byte</span><span class="op" id="5211076">,</span>&nbsp;<span class="ident" id="5211078">match</span>&nbsp;<span class="op" id="5211084">[</span><span class="op" id="5211085">]</span><span class="builtintype" id="5211086">int</span><span class="op" id="5211089">)</span>&nbsp;<span class="op" id="5211091">[</span><span class="op" id="5211092">]</span><span class="builtintype" id="5211093">byte</span>&nbsp;<span class="op" id="5211098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211101">return</span>&nbsp;<span class="ident" id="5211108">re</span><span class="op" id="5211110">.</span><span class="ident" id="5211111">expand</span><span class="op" id="5211117">(</span><span class="ident" id="5211118">dst</span><span class="op" id="5211121">,</span>&nbsp;<span class="builtintype" id="5211123">string</span><span class="op" id="5211129">(</span><span class="ident" id="5211130">template</span><span class="op" id="5211138">)</span><span class="op" id="5211139">,</span>&nbsp;<span class="ident" id="5211141">src</span><span class="op" id="5211144">,</span>&nbsp;<span class="string" id="5211146">&#34;&#34;</span><span class="op" id="5211148">,</span>&nbsp;<span class="ident" id="5211150">match</span><span class="op" id="5211155">)</span><br>
<span class="lineno"></span><span class="op" id="5211157">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="5211160">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="5211232">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5211303">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5211336">func</span>&nbsp;<span class="op" id="5211341">(</span><span class="ident" id="5211342">re</span>&nbsp;<span class="op" id="5211345">*</span><span class="ident" id="5211346">Regexp</span><span class="op" id="5211352">)</span>&nbsp;<span class="ident" id="5211354">ExpandString</span><span class="op" id="5211366">(</span><span class="ident" id="5211367">dst</span>&nbsp;<span class="op" id="5211371">[</span><span class="op" id="5211372">]</span><span class="builtintype" id="5211373">byte</span><span class="op" id="5211377">,</span>&nbsp;<span class="ident" id="5211379">template</span>&nbsp;<span class="builtintype" id="5211388">string</span><span class="op" id="5211394">,</span>&nbsp;<span class="ident" id="5211396">src</span>&nbsp;<span class="builtintype" id="5211400">string</span><span class="op" id="5211406">,</span>&nbsp;<span class="ident" id="5211408">match</span>&nbsp;<span class="op" id="5211414">[</span><span class="op" id="5211415">]</span><span class="builtintype" id="5211416">int</span><span class="op" id="5211419">)</span>&nbsp;<span class="op" id="5211421">[</span><span class="op" id="5211422">]</span><span class="builtintype" id="5211423">byte</span>&nbsp;<span class="op" id="5211428">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211431">return</span>&nbsp;<span class="ident" id="5211438">re</span><span class="op" id="5211440">.</span><span class="ident" id="5211441">expand</span><span class="op" id="5211447">(</span><span class="ident" id="5211448">dst</span><span class="op" id="5211451">,</span>&nbsp;<span class="ident" id="5211453">template</span><span class="op" id="5211461">,</span>&nbsp;<span class="ident" id="5211463">nil</span><span class="op" id="5211466">,</span>&nbsp;<span class="ident" id="5211468">src</span><span class="op" id="5211471">,</span>&nbsp;<span class="ident" id="5211473">match</span><span class="op" id="5211478">)</span><br>
<span class="lineno"></span><span class="op" id="5211480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5211483">func</span>&nbsp;<span class="op" id="5211488">(</span><span class="ident" id="5211489">re</span>&nbsp;<span class="op" id="5211492">*</span><span class="ident" id="5211493">Regexp</span><span class="op" id="5211499">)</span>&nbsp;<span class="ident" id="5211501">expand</span><span class="op" id="5211507">(</span><span class="ident" id="5211508">dst</span>&nbsp;<span class="op" id="5211512">[</span><span class="op" id="5211513">]</span><span class="builtintype" id="5211514">byte</span><span class="op" id="5211518">,</span>&nbsp;<span class="ident" id="5211520">template</span>&nbsp;<span class="builtintype" id="5211529">string</span><span class="op" id="5211535">,</span>&nbsp;<span class="ident" id="5211537">bsrc</span>&nbsp;<span class="op" id="5211542">[</span><span class="op" id="5211543">]</span><span class="builtintype" id="5211544">byte</span><span class="op" id="5211548">,</span>&nbsp;<span class="ident" id="5211550">src</span>&nbsp;<span class="builtintype" id="5211554">string</span><span class="op" id="5211560">,</span>&nbsp;<span class="ident" id="5211562">match</span>&nbsp;<span class="op" id="5211568">[</span><span class="op" id="5211569">]</span><span class="builtintype" id="5211570">int</span><span class="op" id="5211573">)</span>&nbsp;<span class="op" id="5211575">[</span><span class="op" id="5211576">]</span><span class="builtintype" id="5211577">byte</span>&nbsp;<span class="op" id="5211582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211585">for</span>&nbsp;<span class="builtinfunc" id="5211589">len</span><span class="op" id="5211592">(</span><span class="ident" id="5211593">template</span><span class="op" id="5211601">)</span>&nbsp;<span class="op" id="5211603">&gt;</span>&nbsp;<span class="num" id="5211605">0</span>&nbsp;<span class="op" id="5211607">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211611">i</span>&nbsp;<span class="op" id="5211613">:=</span>&nbsp;<span class="ident" id="5211616">strings</span><span class="op" id="5211623">.</span><span class="ident" id="5211624">Index</span><span class="op" id="5211629">(</span><span class="ident" id="5211630">template</span><span class="op" id="5211638">,</span>&nbsp;<span class="string" id="5211640">&#34;$&#34;</span><span class="op" id="5211643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211647">if</span>&nbsp;<span class="ident" id="5211650">i</span>&nbsp;<span class="op" id="5211652">&lt;</span>&nbsp;<span class="num" id="5211654">0</span>&nbsp;<span class="op" id="5211656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211661">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211673">dst</span>&nbsp;<span class="op" id="5211677">=</span>&nbsp;<span class="builtinfunc" id="5211679">append</span><span class="op" id="5211685">(</span><span class="ident" id="5211686">dst</span><span class="op" id="5211689">,</span>&nbsp;<span class="ident" id="5211691">template</span><span class="op" id="5211699">[</span><span class="op" id="5211700">:</span><span class="ident" id="5211701">i</span><span class="op" id="5211702">]</span><span class="op" id="5211703">...</span><span class="op" id="5211706">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211710">template</span>&nbsp;<span class="op" id="5211719">=</span>&nbsp;<span class="ident" id="5211721">template</span><span class="op" id="5211729">[</span><span class="ident" id="5211730">i</span><span class="op" id="5211731">:</span><span class="op" id="5211732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211736">if</span>&nbsp;<span class="builtinfunc" id="5211739">len</span><span class="op" id="5211742">(</span><span class="ident" id="5211743">template</span><span class="op" id="5211751">)</span>&nbsp;<span class="op" id="5211753">&gt;</span>&nbsp;<span class="num" id="5211755">1</span>&nbsp;<span class="op" id="5211757">&amp;&amp;</span>&nbsp;<span class="ident" id="5211760">template</span><span class="op" id="5211768">[</span><span class="num" id="5211769">1</span><span class="op" id="5211770">]</span>&nbsp;<span class="op" id="5211772">==</span>&nbsp;<span class="string" id="5211775">&#39;$&#39;</span>&nbsp;<span class="op" id="5211779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211784">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211805">dst</span>&nbsp;<span class="op" id="5211809">=</span>&nbsp;<span class="builtinfunc" id="5211811">append</span><span class="op" id="5211817">(</span><span class="ident" id="5211818">dst</span><span class="op" id="5211821">,</span>&nbsp;<span class="string" id="5211823">&#39;$&#39;</span><span class="op" id="5211826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211831">template</span>&nbsp;<span class="op" id="5211840">=</span>&nbsp;<span class="ident" id="5211842">template</span><span class="op" id="5211850">[</span><span class="num" id="5211851">2</span><span class="op" id="5211852">:</span><span class="op" id="5211853">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211858">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211873">name</span><span class="op" id="5211877">,</span>&nbsp;<span class="ident" id="5211879">num</span><span class="op" id="5211882">,</span>&nbsp;<span class="ident" id="5211884">rest</span><span class="op" id="5211888">,</span>&nbsp;<span class="ident" id="5211890">ok</span>&nbsp;<span class="op" id="5211893">:=</span>&nbsp;<span class="ident" id="5211896">extract</span><span class="op" id="5211903">(</span><span class="ident" id="5211904">template</span><span class="op" id="5211912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211916">if</span>&nbsp;<span class="op" id="5211919">!</span><span class="ident" id="5211920">ok</span>&nbsp;<span class="op" id="5211923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211928">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211966">dst</span>&nbsp;<span class="op" id="5211970">=</span>&nbsp;<span class="builtinfunc" id="5211972">append</span><span class="op" id="5211978">(</span><span class="ident" id="5211979">dst</span><span class="op" id="5211982">,</span>&nbsp;<span class="string" id="5211984">&#39;$&#39;</span><span class="op" id="5211987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211992">template</span>&nbsp;<span class="op" id="5212001">=</span>&nbsp;<span class="ident" id="5212003">template</span><span class="op" id="5212011">[</span><span class="num" id="5212012">1</span><span class="op" id="5212013">:</span><span class="op" id="5212014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212019">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212034">template</span>&nbsp;<span class="op" id="5212043">=</span>&nbsp;<span class="ident" id="5212045">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212052">if</span>&nbsp;<span class="ident" id="5212055">num</span>&nbsp;<span class="op" id="5212059">&gt;=</span>&nbsp;<span class="num" id="5212062">0</span>&nbsp;<span class="op" id="5212064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212069">if</span>&nbsp;<span class="num" id="5212072">2</span><span class="op" id="5212073">*</span><span class="ident" id="5212074">num</span><span class="op" id="5212077">+</span><span class="num" id="5212078">1</span>&nbsp;<span class="op" id="5212080">&lt;</span>&nbsp;<span class="builtinfunc" id="5212082">len</span><span class="op" id="5212085">(</span><span class="ident" id="5212086">match</span><span class="op" id="5212091">)</span>&nbsp;<span class="op" id="5212093">&amp;&amp;</span>&nbsp;<span class="ident" id="5212096">match</span><span class="op" id="5212101">[</span><span class="num" id="5212102">2</span><span class="op" id="5212103">*</span><span class="ident" id="5212104">num</span><span class="op" id="5212107">]</span>&nbsp;<span class="op" id="5212109">&gt;=</span>&nbsp;<span class="num" id="5212112">0</span>&nbsp;<span class="op" id="5212114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212120">if</span>&nbsp;<span class="ident" id="5212123">bsrc</span>&nbsp;<span class="op" id="5212128">!=</span>&nbsp;<span class="ident" id="5212131">nil</span>&nbsp;<span class="op" id="5212135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212142">dst</span>&nbsp;<span class="op" id="5212146">=</span>&nbsp;<span class="builtinfunc" id="5212148">append</span><span class="op" id="5212154">(</span><span class="ident" id="5212155">dst</span><span class="op" id="5212158">,</span>&nbsp;<span class="ident" id="5212160">bsrc</span><span class="op" id="5212164">[</span><span class="ident" id="5212165">match</span><span class="op" id="5212170">[</span><span class="num" id="5212171">2</span><span class="op" id="5212172">*</span><span class="ident" id="5212173">num</span><span class="op" id="5212176">]</span><span class="op" id="5212177">:</span><span class="ident" id="5212178">match</span><span class="op" id="5212183">[</span><span class="num" id="5212184">2</span><span class="op" id="5212185">*</span><span class="ident" id="5212186">num</span><span class="op" id="5212189">+</span><span class="num" id="5212190">1</span><span class="op" id="5212191">]</span><span class="op" id="5212192">]</span><span class="op" id="5212193">...</span><span class="op" id="5212196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212202">}</span>&nbsp;<span class="keyword" id="5212204">else</span>&nbsp;<span class="op" id="5212209">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212216">dst</span>&nbsp;<span class="op" id="5212220">=</span>&nbsp;<span class="builtinfunc" id="5212222">append</span><span class="op" id="5212228">(</span><span class="ident" id="5212229">dst</span><span class="op" id="5212232">,</span>&nbsp;<span class="ident" id="5212234">src</span><span class="op" id="5212237">[</span><span class="ident" id="5212238">match</span><span class="op" id="5212243">[</span><span class="num" id="5212244">2</span><span class="op" id="5212245">*</span><span class="ident" id="5212246">num</span><span class="op" id="5212249">]</span><span class="op" id="5212250">:</span><span class="ident" id="5212251">match</span><span class="op" id="5212256">[</span><span class="num" id="5212257">2</span><span class="op" id="5212258">*</span><span class="ident" id="5212259">num</span><span class="op" id="5212262">+</span><span class="num" id="5212263">1</span><span class="op" id="5212264">]</span><span class="op" id="5212265">]</span><span class="op" id="5212266">...</span><span class="op" id="5212269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212284">}</span>&nbsp;<span class="keyword" id="5212286">else</span>&nbsp;<span class="op" id="5212291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212296">for</span>&nbsp;<span class="ident" id="5212300">i</span><span class="op" id="5212301">,</span>&nbsp;<span class="ident" id="5212303">namei</span>&nbsp;<span class="op" id="5212309">:=</span>&nbsp;<span class="keyword" id="5212312">range</span>&nbsp;<span class="ident" id="5212318">re</span><span class="op" id="5212320">.</span><span class="ident" id="5212321">subexpNames</span>&nbsp;<span class="op" id="5212333">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212339">if</span>&nbsp;<span class="ident" id="5212342">name</span>&nbsp;<span class="op" id="5212347">==</span>&nbsp;<span class="ident" id="5212350">namei</span>&nbsp;<span class="op" id="5212356">&amp;&amp;</span>&nbsp;<span class="num" id="5212359">2</span><span class="op" id="5212360">*</span><span class="ident" id="5212361">i</span><span class="op" id="5212362">+</span><span class="num" id="5212363">1</span>&nbsp;<span class="op" id="5212365">&lt;</span>&nbsp;<span class="builtinfunc" id="5212367">len</span><span class="op" id="5212370">(</span><span class="ident" id="5212371">match</span><span class="op" id="5212376">)</span>&nbsp;<span class="op" id="5212378">&amp;&amp;</span>&nbsp;<span class="ident" id="5212381">match</span><span class="op" id="5212386">[</span><span class="num" id="5212387">2</span><span class="op" id="5212388">*</span><span class="ident" id="5212389">i</span><span class="op" id="5212390">]</span>&nbsp;<span class="op" id="5212392">&gt;=</span>&nbsp;<span class="num" id="5212395">0</span>&nbsp;<span class="op" id="5212397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212404">if</span>&nbsp;<span class="ident" id="5212407">bsrc</span>&nbsp;<span class="op" id="5212412">!=</span>&nbsp;<span class="ident" id="5212415">nil</span>&nbsp;<span class="op" id="5212419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212427">dst</span>&nbsp;<span class="op" id="5212431">=</span>&nbsp;<span class="builtinfunc" id="5212433">append</span><span class="op" id="5212439">(</span><span class="ident" id="5212440">dst</span><span class="op" id="5212443">,</span>&nbsp;<span class="ident" id="5212445">bsrc</span><span class="op" id="5212449">[</span><span class="ident" id="5212450">match</span><span class="op" id="5212455">[</span><span class="num" id="5212456">2</span><span class="op" id="5212457">*</span><span class="ident" id="5212458">i</span><span class="op" id="5212459">]</span><span class="op" id="5212460">:</span><span class="ident" id="5212461">match</span><span class="op" id="5212466">[</span><span class="num" id="5212467">2</span><span class="op" id="5212468">*</span><span class="ident" id="5212469">i</span><span class="op" id="5212470">+</span><span class="num" id="5212471">1</span><span class="op" id="5212472">]</span><span class="op" id="5212473">]</span><span class="op" id="5212474">...</span><span class="op" id="5212477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212484">}</span>&nbsp;<span class="keyword" id="5212486">else</span>&nbsp;<span class="op" id="5212491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212499">dst</span>&nbsp;<span class="op" id="5212503">=</span>&nbsp;<span class="builtinfunc" id="5212505">append</span><span class="op" id="5212511">(</span><span class="ident" id="5212512">dst</span><span class="op" id="5212515">,</span>&nbsp;<span class="ident" id="5212517">src</span><span class="op" id="5212520">[</span><span class="ident" id="5212521">match</span><span class="op" id="5212526">[</span><span class="num" id="5212527">2</span><span class="op" id="5212528">*</span><span class="ident" id="5212529">i</span><span class="op" id="5212530">]</span><span class="op" id="5212531">:</span><span class="ident" id="5212532">match</span><span class="op" id="5212537">[</span><span class="num" id="5212538">2</span><span class="op" id="5212539">*</span><span class="ident" id="5212540">i</span><span class="op" id="5212541">+</span><span class="num" id="5212542">1</span><span class="op" id="5212543">]</span><span class="op" id="5212544">]</span><span class="op" id="5212545">...</span><span class="op" id="5212548">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212562">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212581">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212587">dst</span>&nbsp;<span class="op" id="5212591">=</span>&nbsp;<span class="builtinfunc" id="5212593">append</span><span class="op" id="5212599">(</span><span class="ident" id="5212600">dst</span><span class="op" id="5212603">,</span>&nbsp;<span class="ident" id="5212605">template</span><span class="op" id="5212613">...</span><span class="op" id="5212616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212619">return</span>&nbsp;<span class="ident" id="5212626">dst</span><br>
<span class="lineno"></span><span class="op" id="5212630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="5212633">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="5212705">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5212787">func</span>&nbsp;<span class="ident" id="5212792">extract</span><span class="op" id="5212799">(</span><span class="ident" id="5212800">str</span>&nbsp;<span class="builtintype" id="5212804">string</span><span class="op" id="5212810">)</span>&nbsp;<span class="op" id="5212812">(</span><span class="ident" id="5212813">name</span>&nbsp;<span class="builtintype" id="5212818">string</span><span class="op" id="5212824">,</span>&nbsp;<span class="ident" id="5212826">num</span>&nbsp;<span class="builtintype" id="5212830">int</span><span class="op" id="5212833">,</span>&nbsp;<span class="ident" id="5212835">rest</span>&nbsp;<span class="builtintype" id="5212840">string</span><span class="op" id="5212846">,</span>&nbsp;<span class="ident" id="5212848">ok</span>&nbsp;<span class="builtintype" id="5212851">bool</span><span class="op" id="5212855">)</span>&nbsp;<span class="op" id="5212857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212860">if</span>&nbsp;<span class="builtinfunc" id="5212863">len</span><span class="op" id="5212866">(</span><span class="ident" id="5212867">str</span><span class="op" id="5212870">)</span>&nbsp;<span class="op" id="5212872">&lt;</span>&nbsp;<span class="num" id="5212874">2</span>&nbsp;<span class="op" id="5212876">||</span>&nbsp;<span class="ident" id="5212879">str</span><span class="op" id="5212882">[</span><span class="num" id="5212883">0</span><span class="op" id="5212884">]</span>&nbsp;<span class="op" id="5212886">!=</span>&nbsp;<span class="string" id="5212889">&#39;$&#39;</span>&nbsp;<span class="op" id="5212893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212897">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212908">brace</span>&nbsp;<span class="op" id="5212914">:=</span>&nbsp;<span class="ident" id="5212917">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212924">if</span>&nbsp;<span class="ident" id="5212927">str</span><span class="op" id="5212930">[</span><span class="num" id="5212931">1</span><span class="op" id="5212932">]</span>&nbsp;<span class="op" id="5212934">==</span>&nbsp;<span class="string" id="5212937">&#39;{&#39;</span>&nbsp;<span class="op" id="5212941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212945">brace</span>&nbsp;<span class="op" id="5212951">=</span>&nbsp;<span class="ident" id="5212953">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212960">str</span>&nbsp;<span class="op" id="5212964">=</span>&nbsp;<span class="ident" id="5212966">str</span><span class="op" id="5212969">[</span><span class="num" id="5212970">2</span><span class="op" id="5212971">:</span><span class="op" id="5212972">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212975">}</span>&nbsp;<span class="keyword" id="5212977">else</span>&nbsp;<span class="op" id="5212982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212986">str</span>&nbsp;<span class="op" id="5212990">=</span>&nbsp;<span class="ident" id="5212992">str</span><span class="op" id="5212995">[</span><span class="num" id="5212996">1</span><span class="op" id="5212997">:</span><span class="op" id="5212998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213004">i</span>&nbsp;<span class="op" id="5213006">:=</span>&nbsp;<span class="num" id="5213009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213012">for</span>&nbsp;<span class="ident" id="5213016">i</span>&nbsp;<span class="op" id="5213018">&lt;</span>&nbsp;<span class="builtinfunc" id="5213020">len</span><span class="op" id="5213023">(</span><span class="ident" id="5213024">str</span><span class="op" id="5213027">)</span>&nbsp;<span class="op" id="5213029">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5213033">rune</span><span class="op" id="5213037">,</span>&nbsp;<span class="ident" id="5213039">size</span>&nbsp;<span class="op" id="5213044">:=</span>&nbsp;<span class="ident" id="5213047">utf8</span><span class="op" id="5213051">.</span><span class="ident" id="5213052">DecodeRuneInString</span><span class="op" id="5213070">(</span><span class="ident" id="5213071">str</span><span class="op" id="5213074">[</span><span class="ident" id="5213075">i</span><span class="op" id="5213076">:</span><span class="op" id="5213077">]</span><span class="op" id="5213078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213082">if</span>&nbsp;<span class="op" id="5213085">!</span><span class="ident" id="5213086">unicode</span><span class="op" id="5213093">.</span><span class="ident" id="5213094">IsLetter</span><span class="op" id="5213102">(</span><span class="builtintype" id="5213103">rune</span><span class="op" id="5213107">)</span>&nbsp;<span class="op" id="5213109">&amp;&amp;</span>&nbsp;<span class="op" id="5213112">!</span><span class="ident" id="5213113">unicode</span><span class="op" id="5213120">.</span><span class="ident" id="5213121">IsDigit</span><span class="op" id="5213128">(</span><span class="builtintype" id="5213129">rune</span><span class="op" id="5213133">)</span>&nbsp;<span class="op" id="5213135">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5213138">rune</span>&nbsp;<span class="op" id="5213143">!=</span>&nbsp;<span class="string" id="5213146">&#39;_&#39;</span>&nbsp;<span class="op" id="5213150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213155">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213167">i</span>&nbsp;<span class="op" id="5213169">+=</span>&nbsp;<span class="ident" id="5213172">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213181">if</span>&nbsp;<span class="ident" id="5213184">i</span>&nbsp;<span class="op" id="5213186">==</span>&nbsp;<span class="num" id="5213189">0</span>&nbsp;<span class="op" id="5213191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213195">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213223">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213231">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213234">name</span>&nbsp;<span class="op" id="5213239">=</span>&nbsp;<span class="ident" id="5213241">str</span><span class="op" id="5213244">[</span><span class="op" id="5213245">:</span><span class="ident" id="5213246">i</span><span class="op" id="5213247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213250">if</span>&nbsp;<span class="ident" id="5213253">brace</span>&nbsp;<span class="op" id="5213259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213263">if</span>&nbsp;<span class="ident" id="5213266">i</span>&nbsp;<span class="op" id="5213268">&gt;=</span>&nbsp;<span class="builtinfunc" id="5213271">len</span><span class="op" id="5213274">(</span><span class="ident" id="5213275">str</span><span class="op" id="5213278">)</span>&nbsp;<span class="op" id="5213280">||</span>&nbsp;<span class="ident" id="5213283">str</span><span class="op" id="5213286">[</span><span class="ident" id="5213287">i</span><span class="op" id="5213288">]</span>&nbsp;<span class="op" id="5213290">!=</span>&nbsp;<span class="string" id="5213293">&#39;}&#39;</span>&nbsp;<span class="op" id="5213297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213302">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213330">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213343">i</span><span class="op" id="5213344">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213352">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213370">num</span>&nbsp;<span class="op" id="5213374">=</span>&nbsp;<span class="num" id="5213376">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213379">for</span>&nbsp;<span class="ident" id="5213383">i</span>&nbsp;<span class="op" id="5213385">:=</span>&nbsp;<span class="num" id="5213388">0</span><span class="op" id="5213389">;</span>&nbsp;<span class="ident" id="5213391">i</span>&nbsp;<span class="op" id="5213393">&lt;</span>&nbsp;<span class="builtinfunc" id="5213395">len</span><span class="op" id="5213398">(</span><span class="ident" id="5213399">name</span><span class="op" id="5213403">)</span><span class="op" id="5213404">;</span>&nbsp;<span class="ident" id="5213406">i</span><span class="op" id="5213407">++</span>&nbsp;<span class="op" id="5213410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213414">if</span>&nbsp;<span class="ident" id="5213417">name</span><span class="op" id="5213421">[</span><span class="ident" id="5213422">i</span><span class="op" id="5213423">]</span>&nbsp;<span class="op" id="5213425">&lt;</span>&nbsp;<span class="string" id="5213427">&#39;0&#39;</span>&nbsp;<span class="op" id="5213431">||</span>&nbsp;<span class="string" id="5213434">&#39;9&#39;</span>&nbsp;<span class="op" id="5213438">&lt;</span>&nbsp;<span class="ident" id="5213440">name</span><span class="op" id="5213444">[</span><span class="ident" id="5213445">i</span><span class="op" id="5213446">]</span>&nbsp;<span class="op" id="5213448">||</span>&nbsp;<span class="ident" id="5213451">num</span>&nbsp;<span class="op" id="5213455">&gt;=</span>&nbsp;<span class="num" id="5213458">1e8</span>&nbsp;<span class="op" id="5213462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213467">num</span>&nbsp;<span class="op" id="5213471">=</span>&nbsp;<span class="op" id="5213473">-</span><span class="num" id="5213474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213479">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213491">num</span>&nbsp;<span class="op" id="5213495">=</span>&nbsp;<span class="ident" id="5213497">num</span><span class="op" id="5213500">*</span><span class="num" id="5213501">10</span>&nbsp;<span class="op" id="5213504">+</span>&nbsp;<span class="builtintype" id="5213506">int</span><span class="op" id="5213509">(</span><span class="ident" id="5213510">name</span><span class="op" id="5213514">[</span><span class="ident" id="5213515">i</span><span class="op" id="5213516">]</span><span class="op" id="5213517">)</span>&nbsp;<span class="op" id="5213519">-</span>&nbsp;<span class="string" id="5213521">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213529">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213557">if</span>&nbsp;<span class="ident" id="5213560">name</span><span class="op" id="5213564">[</span><span class="num" id="5213565">0</span><span class="op" id="5213566">]</span>&nbsp;<span class="op" id="5213568">==</span>&nbsp;<span class="string" id="5213571">&#39;0&#39;</span>&nbsp;<span class="op" id="5213575">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5213578">len</span><span class="op" id="5213581">(</span><span class="ident" id="5213582">name</span><span class="op" id="5213586">)</span>&nbsp;<span class="op" id="5213588">&gt;</span>&nbsp;<span class="num" id="5213590">1</span>&nbsp;<span class="op" id="5213592">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213596">num</span>&nbsp;<span class="op" id="5213600">=</span>&nbsp;<span class="op" id="5213602">-</span><span class="num" id="5213603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5213606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213610">rest</span>&nbsp;<span class="op" id="5213615">=</span>&nbsp;<span class="ident" id="5213617">str</span><span class="op" id="5213620">[</span><span class="ident" id="5213621">i</span><span class="op" id="5213622">:</span><span class="op" id="5213623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213626">ok</span>&nbsp;<span class="op" id="5213629">=</span>&nbsp;<span class="ident" id="5213631">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5213637">return</span><br>
<span class="lineno"></span><span class="op" id="5213644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5213647">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5213724">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="5213801">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="5213878">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5213905">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5213950">func</span>&nbsp;<span class="op" id="5213955">(</span><span class="ident" id="5213956">re</span>&nbsp;<span class="op" id="5213959">*</span><span class="ident" id="5213960">Regexp</span><span class="op" id="5213966">)</span>&nbsp;<span class="ident" id="5213968">FindSubmatchIndex</span><span class="op" id="5213985">(</span><span class="ident" id="5213986">b</span>&nbsp;<span class="op" id="5213988">[</span><span class="op" id="5213989">]</span><span class="builtintype" id="5213990">byte</span><span class="op" id="5213994">)</span>&nbsp;<span class="op" id="5213996">[</span><span class="op" id="5213997">]</span><span class="builtintype" id="5213998">int</span>&nbsp;<span class="op" id="5214002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214005">return</span>&nbsp;<span class="ident" id="5214012">re</span><span class="op" id="5214014">.</span><span class="ident" id="5214015">pad</span><span class="op" id="5214018">(</span><span class="ident" id="5214019">re</span><span class="op" id="5214021">.</span><span class="ident" id="5214022">doExecute</span><span class="op" id="5214031">(</span><span class="ident" id="5214032">nil</span><span class="op" id="5214035">,</span>&nbsp;<span class="ident" id="5214037">b</span><span class="op" id="5214038">,</span>&nbsp;<span class="string" id="5214040">&#34;&#34;</span><span class="op" id="5214042">,</span>&nbsp;<span class="num" id="5214044">0</span><span class="op" id="5214045">,</span>&nbsp;<span class="ident" id="5214047">re</span><span class="op" id="5214049">.</span><span class="ident" id="5214050">prog</span><span class="op" id="5214054">.</span><span class="ident" id="5214055">NumCap</span><span class="op" id="5214061">)</span><span class="op" id="5214062">)</span><br>
<span class="lineno">875</span><span class="op" id="5214064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214067">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5214140">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5214217">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="5214288">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5214308">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5214353">func</span>&nbsp;<span class="op" id="5214358">(</span><span class="ident" id="5214359">re</span>&nbsp;<span class="op" id="5214362">*</span><span class="ident" id="5214363">Regexp</span><span class="op" id="5214369">)</span>&nbsp;<span class="ident" id="5214371">FindStringSubmatch</span><span class="op" id="5214389">(</span><span class="ident" id="5214390">s</span>&nbsp;<span class="builtintype" id="5214392">string</span><span class="op" id="5214398">)</span>&nbsp;<span class="op" id="5214400">[</span><span class="op" id="5214401">]</span><span class="builtintype" id="5214402">string</span>&nbsp;<span class="op" id="5214409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214412">a</span>&nbsp;<span class="op" id="5214414">:=</span>&nbsp;<span class="ident" id="5214417">re</span><span class="op" id="5214419">.</span><span class="ident" id="5214420">doExecute</span><span class="op" id="5214429">(</span><span class="ident" id="5214430">nil</span><span class="op" id="5214433">,</span>&nbsp;<span class="ident" id="5214435">nil</span><span class="op" id="5214438">,</span>&nbsp;<span class="ident" id="5214440">s</span><span class="op" id="5214441">,</span>&nbsp;<span class="num" id="5214443">0</span><span class="op" id="5214444">,</span>&nbsp;<span class="ident" id="5214446">re</span><span class="op" id="5214448">.</span><span class="ident" id="5214449">prog</span><span class="op" id="5214453">.</span><span class="ident" id="5214454">NumCap</span><span class="op" id="5214460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214463">if</span>&nbsp;<span class="ident" id="5214466">a</span>&nbsp;<span class="op" id="5214468">==</span>&nbsp;<span class="ident" id="5214471">nil</span>&nbsp;<span class="op" id="5214475">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214479">return</span>&nbsp;<span class="ident" id="5214486">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214494">ret</span>&nbsp;<span class="op" id="5214498">:=</span>&nbsp;<span class="builtinfunc" id="5214501">make</span><span class="op" id="5214505">(</span><span class="op" id="5214506">[</span><span class="op" id="5214507">]</span><span class="builtintype" id="5214508">string</span><span class="op" id="5214514">,</span>&nbsp;<span class="num" id="5214516">1</span><span class="op" id="5214517">+</span><span class="ident" id="5214518">re</span><span class="op" id="5214520">.</span><span class="ident" id="5214521">numSubexp</span><span class="op" id="5214530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214533">for</span>&nbsp;<span class="ident" id="5214537">i</span>&nbsp;<span class="op" id="5214539">:=</span>&nbsp;<span class="keyword" id="5214542">range</span>&nbsp;<span class="ident" id="5214548">ret</span>&nbsp;<span class="op" id="5214552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214556">if</span>&nbsp;<span class="num" id="5214559">2</span><span class="op" id="5214560">*</span><span class="ident" id="5214561">i</span>&nbsp;<span class="op" id="5214563">&lt;</span>&nbsp;<span class="builtinfunc" id="5214565">len</span><span class="op" id="5214568">(</span><span class="ident" id="5214569">a</span><span class="op" id="5214570">)</span>&nbsp;<span class="op" id="5214572">&amp;&amp;</span>&nbsp;<span class="ident" id="5214575">a</span><span class="op" id="5214576">[</span><span class="num" id="5214577">2</span><span class="op" id="5214578">*</span><span class="ident" id="5214579">i</span><span class="op" id="5214580">]</span>&nbsp;<span class="op" id="5214582">&gt;=</span>&nbsp;<span class="num" id="5214585">0</span>&nbsp;<span class="op" id="5214587">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214592">ret</span><span class="op" id="5214595">[</span><span class="ident" id="5214596">i</span><span class="op" id="5214597">]</span>&nbsp;<span class="op" id="5214599">=</span>&nbsp;<span class="ident" id="5214601">s</span><span class="op" id="5214602">[</span><span class="ident" id="5214603">a</span><span class="op" id="5214604">[</span><span class="num" id="5214605">2</span><span class="op" id="5214606">*</span><span class="ident" id="5214607">i</span><span class="op" id="5214608">]</span><span class="op" id="5214609">:</span><span class="ident" id="5214610">a</span><span class="op" id="5214611">[</span><span class="num" id="5214612">2</span><span class="op" id="5214613">*</span><span class="ident" id="5214614">i</span><span class="op" id="5214615">+</span><span class="num" id="5214616">1</span><span class="op" id="5214617">]</span><span class="op" id="5214618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214628">return</span>&nbsp;<span class="ident" id="5214635">ret</span><br>
<span class="lineno"></span><span class="op" id="5214639">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="5214642">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5214709">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5214782">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5214858">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="5214906">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5214951">func</span>&nbsp;<span class="op" id="5214956">(</span><span class="ident" id="5214957">re</span>&nbsp;<span class="op" id="5214960">*</span><span class="ident" id="5214961">Regexp</span><span class="op" id="5214967">)</span>&nbsp;<span class="ident" id="5214969">FindStringSubmatchIndex</span><span class="op" id="5214992">(</span><span class="ident" id="5214993">s</span>&nbsp;<span class="builtintype" id="5214995">string</span><span class="op" id="5215001">)</span>&nbsp;<span class="op" id="5215003">[</span><span class="op" id="5215004">]</span><span class="builtintype" id="5215005">int</span>&nbsp;<span class="op" id="5215009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215012">return</span>&nbsp;<span class="ident" id="5215019">re</span><span class="op" id="5215021">.</span><span class="ident" id="5215022">pad</span><span class="op" id="5215025">(</span><span class="ident" id="5215026">re</span><span class="op" id="5215028">.</span><span class="ident" id="5215029">doExecute</span><span class="op" id="5215038">(</span><span class="ident" id="5215039">nil</span><span class="op" id="5215042">,</span>&nbsp;<span class="ident" id="5215044">nil</span><span class="op" id="5215047">,</span>&nbsp;<span class="ident" id="5215049">s</span><span class="op" id="5215050">,</span>&nbsp;<span class="num" id="5215052">0</span><span class="op" id="5215053">,</span>&nbsp;<span class="ident" id="5215055">re</span><span class="op" id="5215057">.</span><span class="ident" id="5215058">prog</span><span class="op" id="5215062">.</span><span class="ident" id="5215063">NumCap</span><span class="op" id="5215069">)</span><span class="op" id="5215070">)</span><br>
<span class="lineno"></span><span class="op" id="5215072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5215075">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5215142">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5215218">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="5215296">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="5215369">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="5215412">func</span>&nbsp;<span class="op" id="5215417">(</span><span class="ident" id="5215418">re</span>&nbsp;<span class="op" id="5215421">*</span><span class="ident" id="5215422">Regexp</span><span class="op" id="5215428">)</span>&nbsp;<span class="ident" id="5215430">FindReaderSubmatchIndex</span><span class="op" id="5215453">(</span><span class="ident" id="5215454">r</span>&nbsp;<span class="ident" id="5215456">io</span><span class="op" id="5215458">.</span><span class="ident" id="5215459">RuneReader</span><span class="op" id="5215469">)</span>&nbsp;<span class="op" id="5215471">[</span><span class="op" id="5215472">]</span><span class="builtintype" id="5215473">int</span>&nbsp;<span class="op" id="5215477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215480">return</span>&nbsp;<span class="ident" id="5215487">re</span><span class="op" id="5215489">.</span><span class="ident" id="5215490">pad</span><span class="op" id="5215493">(</span><span class="ident" id="5215494">re</span><span class="op" id="5215496">.</span><span class="ident" id="5215497">doExecute</span><span class="op" id="5215506">(</span><span class="ident" id="5215507">r</span><span class="op" id="5215508">,</span>&nbsp;<span class="ident" id="5215510">nil</span><span class="op" id="5215513">,</span>&nbsp;<span class="string" id="5215515">&#34;&#34;</span><span class="op" id="5215517">,</span>&nbsp;<span class="num" id="5215519">0</span><span class="op" id="5215520">,</span>&nbsp;<span class="ident" id="5215522">re</span><span class="op" id="5215524">.</span><span class="ident" id="5215525">prog</span><span class="op" id="5215529">.</span><span class="ident" id="5215530">NumCap</span><span class="op" id="5215536">)</span><span class="op" id="5215537">)</span><br>
<span class="lineno"></span><span class="op" id="5215539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5215542">const</span>&nbsp;<span class="ident" id="5215548">startSize</span>&nbsp;<span class="op" id="5215558">=</span>&nbsp;<span class="num" id="5215560">10</span>&nbsp;<span class="comment" id="5215563">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="5215625">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="5215703">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5215776">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5215796">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="5215841">func</span>&nbsp;<span class="op" id="5215846">(</span><span class="ident" id="5215847">re</span>&nbsp;<span class="op" id="5215850">*</span><span class="ident" id="5215851">Regexp</span><span class="op" id="5215857">)</span>&nbsp;<span class="ident" id="5215859">FindAll</span><span class="op" id="5215866">(</span><span class="ident" id="5215867">b</span>&nbsp;<span class="op" id="5215869">[</span><span class="op" id="5215870">]</span><span class="builtintype" id="5215871">byte</span><span class="op" id="5215875">,</span>&nbsp;<span class="ident" id="5215877">n</span>&nbsp;<span class="builtintype" id="5215879">int</span><span class="op" id="5215882">)</span>&nbsp;<span class="op" id="5215884">[</span><span class="op" id="5215885">]</span><span class="op" id="5215886">[</span><span class="op" id="5215887">]</span><span class="builtintype" id="5215888">byte</span>&nbsp;<span class="op" id="5215893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215896">if</span>&nbsp;<span class="ident" id="5215899">n</span>&nbsp;<span class="op" id="5215901">&lt;</span>&nbsp;<span class="num" id="5215903">0</span>&nbsp;<span class="op" id="5215905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215909">n</span>&nbsp;<span class="op" id="5215911">=</span>&nbsp;<span class="builtinfunc" id="5215913">len</span><span class="op" id="5215916">(</span><span class="ident" id="5215917">b</span><span class="op" id="5215918">)</span>&nbsp;<span class="op" id="5215920">+</span>&nbsp;<span class="num" id="5215922">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215928">result</span>&nbsp;<span class="op" id="5215935">:=</span>&nbsp;<span class="builtinfunc" id="5215938">make</span><span class="op" id="5215942">(</span><span class="op" id="5215943">[</span><span class="op" id="5215944">]</span><span class="op" id="5215945">[</span><span class="op" id="5215946">]</span><span class="builtintype" id="5215947">byte</span><span class="op" id="5215951">,</span>&nbsp;<span class="num" id="5215953">0</span><span class="op" id="5215954">,</span>&nbsp;<span class="ident" id="5215956">startSize</span><span class="op" id="5215965">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215968">re</span><span class="op" id="5215970">.</span><span class="ident" id="5215971">allMatches</span><span class="op" id="5215981">(</span><span class="string" id="5215982">&#34;&#34;</span><span class="op" id="5215984">,</span>&nbsp;<span class="ident" id="5215986">b</span><span class="op" id="5215987">,</span>&nbsp;<span class="ident" id="5215989">n</span><span class="op" id="5215990">,</span>&nbsp;<span class="keyword" id="5215992">func</span><span class="op" id="5215996">(</span><span class="ident" id="5215997">match</span>&nbsp;<span class="op" id="5216003">[</span><span class="op" id="5216004">]</span><span class="builtintype" id="5216005">int</span><span class="op" id="5216008">)</span>&nbsp;<span class="op" id="5216010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216014">result</span>&nbsp;<span class="op" id="5216021">=</span>&nbsp;<span class="builtinfunc" id="5216023">append</span><span class="op" id="5216029">(</span><span class="ident" id="5216030">result</span><span class="op" id="5216036">,</span>&nbsp;<span class="ident" id="5216038">b</span><span class="op" id="5216039">[</span><span class="ident" id="5216040">match</span><span class="op" id="5216045">[</span><span class="num" id="5216046">0</span><span class="op" id="5216047">]</span><span class="op" id="5216048">:</span><span class="ident" id="5216049">match</span><span class="op" id="5216054">[</span><span class="num" id="5216055">1</span><span class="op" id="5216056">]</span><span class="op" id="5216057">]</span><span class="op" id="5216058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216061">}</span><span class="op" id="5216062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216065">if</span>&nbsp;<span class="builtinfunc" id="5216068">len</span><span class="op" id="5216071">(</span><span class="ident" id="5216072">result</span><span class="op" id="5216078">)</span>&nbsp;<span class="op" id="5216080">==</span>&nbsp;<span class="num" id="5216083">0</span>&nbsp;<span class="op" id="5216085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216089">return</span>&nbsp;<span class="ident" id="5216096">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216104">return</span>&nbsp;<span class="ident" id="5216111">result</span><br>
<span class="lineno"></span><span class="op" id="5216118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5216121">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="5216198">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5216275">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5216302">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5216347">func</span>&nbsp;<span class="op" id="5216352">(</span><span class="ident" id="5216353">re</span>&nbsp;<span class="op" id="5216356">*</span><span class="ident" id="5216357">Regexp</span><span class="op" id="5216363">)</span>&nbsp;<span class="ident" id="5216365">FindAllIndex</span><span class="op" id="5216377">(</span><span class="ident" id="5216378">b</span>&nbsp;<span class="op" id="5216380">[</span><span class="op" id="5216381">]</span><span class="builtintype" id="5216382">byte</span><span class="op" id="5216386">,</span>&nbsp;<span class="ident" id="5216388">n</span>&nbsp;<span class="builtintype" id="5216390">int</span><span class="op" id="5216393">)</span>&nbsp;<span class="op" id="5216395">[</span><span class="op" id="5216396">]</span><span class="op" id="5216397">[</span><span class="op" id="5216398">]</span><span class="builtintype" id="5216399">int</span>&nbsp;<span class="op" id="5216403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216406">if</span>&nbsp;<span class="ident" id="5216409">n</span>&nbsp;<span class="op" id="5216411">&lt;</span>&nbsp;<span class="num" id="5216413">0</span>&nbsp;<span class="op" id="5216415">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216419">n</span>&nbsp;<span class="op" id="5216421">=</span>&nbsp;<span class="builtinfunc" id="5216423">len</span><span class="op" id="5216426">(</span><span class="ident" id="5216427">b</span><span class="op" id="5216428">)</span>&nbsp;<span class="op" id="5216430">+</span>&nbsp;<span class="num" id="5216432">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216438">result</span>&nbsp;<span class="op" id="5216445">:=</span>&nbsp;<span class="builtinfunc" id="5216448">make</span><span class="op" id="5216452">(</span><span class="op" id="5216453">[</span><span class="op" id="5216454">]</span><span class="op" id="5216455">[</span><span class="op" id="5216456">]</span><span class="builtintype" id="5216457">int</span><span class="op" id="5216460">,</span>&nbsp;<span class="num" id="5216462">0</span><span class="op" id="5216463">,</span>&nbsp;<span class="ident" id="5216465">startSize</span><span class="op" id="5216474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216477">re</span><span class="op" id="5216479">.</span><span class="ident" id="5216480">allMatches</span><span class="op" id="5216490">(</span><span class="string" id="5216491">&#34;&#34;</span><span class="op" id="5216493">,</span>&nbsp;<span class="ident" id="5216495">b</span><span class="op" id="5216496">,</span>&nbsp;<span class="ident" id="5216498">n</span><span class="op" id="5216499">,</span>&nbsp;<span class="keyword" id="5216501">func</span><span class="op" id="5216505">(</span><span class="ident" id="5216506">match</span>&nbsp;<span class="op" id="5216512">[</span><span class="op" id="5216513">]</span><span class="builtintype" id="5216514">int</span><span class="op" id="5216517">)</span>&nbsp;<span class="op" id="5216519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216523">result</span>&nbsp;<span class="op" id="5216530">=</span>&nbsp;<span class="builtinfunc" id="5216532">append</span><span class="op" id="5216538">(</span><span class="ident" id="5216539">result</span><span class="op" id="5216545">,</span>&nbsp;<span class="ident" id="5216547">match</span><span class="op" id="5216552">[</span><span class="num" id="5216553">0</span><span class="op" id="5216554">:</span><span class="num" id="5216555">2</span><span class="op" id="5216556">]</span><span class="op" id="5216557">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216560">}</span><span class="op" id="5216561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216564">if</span>&nbsp;<span class="builtinfunc" id="5216567">len</span><span class="op" id="5216570">(</span><span class="ident" id="5216571">result</span><span class="op" id="5216577">)</span>&nbsp;<span class="op" id="5216579">==</span>&nbsp;<span class="num" id="5216582">0</span>&nbsp;<span class="op" id="5216584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216588">return</span>&nbsp;<span class="ident" id="5216595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216603">return</span>&nbsp;<span class="ident" id="5216610">result</span><br>
<span class="lineno">950</span><span class="op" id="5216617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5216620">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5216699">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="5216776">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="5216803">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5216848">func</span>&nbsp;<span class="op" id="5216853">(</span><span class="ident" id="5216854">re</span>&nbsp;<span class="op" id="5216857">*</span><span class="ident" id="5216858">Regexp</span><span class="op" id="5216864">)</span>&nbsp;<span class="ident" id="5216866">FindAllString</span><span class="op" id="5216879">(</span><span class="ident" id="5216880">s</span>&nbsp;<span class="builtintype" id="5216882">string</span><span class="op" id="5216888">,</span>&nbsp;<span class="ident" id="5216890">n</span>&nbsp;<span class="builtintype" id="5216892">int</span><span class="op" id="5216895">)</span>&nbsp;<span class="op" id="5216897">[</span><span class="op" id="5216898">]</span><span class="builtintype" id="5216899">string</span>&nbsp;<span class="op" id="5216906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216909">if</span>&nbsp;<span class="ident" id="5216912">n</span>&nbsp;<span class="op" id="5216914">&lt;</span>&nbsp;<span class="num" id="5216916">0</span>&nbsp;<span class="op" id="5216918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216922">n</span>&nbsp;<span class="op" id="5216924">=</span>&nbsp;<span class="builtinfunc" id="5216926">len</span><span class="op" id="5216929">(</span><span class="ident" id="5216930">s</span><span class="op" id="5216931">)</span>&nbsp;<span class="op" id="5216933">+</span>&nbsp;<span class="num" id="5216935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216938">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216941">result</span>&nbsp;<span class="op" id="5216948">:=</span>&nbsp;<span class="builtinfunc" id="5216951">make</span><span class="op" id="5216955">(</span><span class="op" id="5216956">[</span><span class="op" id="5216957">]</span><span class="builtintype" id="5216958">string</span><span class="op" id="5216964">,</span>&nbsp;<span class="num" id="5216966">0</span><span class="op" id="5216967">,</span>&nbsp;<span class="ident" id="5216969">startSize</span><span class="op" id="5216978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216981">re</span><span class="op" id="5216983">.</span><span class="ident" id="5216984">allMatches</span><span class="op" id="5216994">(</span><span class="ident" id="5216995">s</span><span class="op" id="5216996">,</span>&nbsp;<span class="ident" id="5216998">nil</span><span class="op" id="5217001">,</span>&nbsp;<span class="ident" id="5217003">n</span><span class="op" id="5217004">,</span>&nbsp;<span class="keyword" id="5217006">func</span><span class="op" id="5217010">(</span><span class="ident" id="5217011">match</span>&nbsp;<span class="op" id="5217017">[</span><span class="op" id="5217018">]</span><span class="builtintype" id="5217019">int</span><span class="op" id="5217022">)</span>&nbsp;<span class="op" id="5217024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217028">result</span>&nbsp;<span class="op" id="5217035">=</span>&nbsp;<span class="builtinfunc" id="5217037">append</span><span class="op" id="5217043">(</span><span class="ident" id="5217044">result</span><span class="op" id="5217050">,</span>&nbsp;<span class="ident" id="5217052">s</span><span class="op" id="5217053">[</span><span class="ident" id="5217054">match</span><span class="op" id="5217059">[</span><span class="num" id="5217060">0</span><span class="op" id="5217061">]</span><span class="op" id="5217062">:</span><span class="ident" id="5217063">match</span><span class="op" id="5217068">[</span><span class="num" id="5217069">1</span><span class="op" id="5217070">]</span><span class="op" id="5217071">]</span><span class="op" id="5217072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217075">}</span><span class="op" id="5217076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217079">if</span>&nbsp;<span class="builtinfunc" id="5217082">len</span><span class="op" id="5217085">(</span><span class="ident" id="5217086">result</span><span class="op" id="5217092">)</span>&nbsp;<span class="op" id="5217094">==</span>&nbsp;<span class="num" id="5217097">0</span>&nbsp;<span class="op" id="5217099">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217103">return</span>&nbsp;<span class="ident" id="5217110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217118">return</span>&nbsp;<span class="ident" id="5217125">result</span><br>
<span class="lineno"></span><span class="op" id="5217132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="5217135">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5217211">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="5217289">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5217328">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5217373">func</span>&nbsp;<span class="op" id="5217378">(</span><span class="ident" id="5217379">re</span>&nbsp;<span class="op" id="5217382">*</span><span class="ident" id="5217383">Regexp</span><span class="op" id="5217389">)</span>&nbsp;<span class="ident" id="5217391">FindAllStringIndex</span><span class="op" id="5217409">(</span><span class="ident" id="5217410">s</span>&nbsp;<span class="builtintype" id="5217412">string</span><span class="op" id="5217418">,</span>&nbsp;<span class="ident" id="5217420">n</span>&nbsp;<span class="builtintype" id="5217422">int</span><span class="op" id="5217425">)</span>&nbsp;<span class="op" id="5217427">[</span><span class="op" id="5217428">]</span><span class="op" id="5217429">[</span><span class="op" id="5217430">]</span><span class="builtintype" id="5217431">int</span>&nbsp;<span class="op" id="5217435">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217438">if</span>&nbsp;<span class="ident" id="5217441">n</span>&nbsp;<span class="op" id="5217443">&lt;</span>&nbsp;<span class="num" id="5217445">0</span>&nbsp;<span class="op" id="5217447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217451">n</span>&nbsp;<span class="op" id="5217453">=</span>&nbsp;<span class="builtinfunc" id="5217455">len</span><span class="op" id="5217458">(</span><span class="ident" id="5217459">s</span><span class="op" id="5217460">)</span>&nbsp;<span class="op" id="5217462">+</span>&nbsp;<span class="num" id="5217464">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217470">result</span>&nbsp;<span class="op" id="5217477">:=</span>&nbsp;<span class="builtinfunc" id="5217480">make</span><span class="op" id="5217484">(</span><span class="op" id="5217485">[</span><span class="op" id="5217486">]</span><span class="op" id="5217487">[</span><span class="op" id="5217488">]</span><span class="builtintype" id="5217489">int</span><span class="op" id="5217492">,</span>&nbsp;<span class="num" id="5217494">0</span><span class="op" id="5217495">,</span>&nbsp;<span class="ident" id="5217497">startSize</span><span class="op" id="5217506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217509">re</span><span class="op" id="5217511">.</span><span class="ident" id="5217512">allMatches</span><span class="op" id="5217522">(</span><span class="ident" id="5217523">s</span><span class="op" id="5217524">,</span>&nbsp;<span class="ident" id="5217526">nil</span><span class="op" id="5217529">,</span>&nbsp;<span class="ident" id="5217531">n</span><span class="op" id="5217532">,</span>&nbsp;<span class="keyword" id="5217534">func</span><span class="op" id="5217538">(</span><span class="ident" id="5217539">match</span>&nbsp;<span class="op" id="5217545">[</span><span class="op" id="5217546">]</span><span class="builtintype" id="5217547">int</span><span class="op" id="5217550">)</span>&nbsp;<span class="op" id="5217552">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217556">result</span>&nbsp;<span class="op" id="5217563">=</span>&nbsp;<span class="builtinfunc" id="5217565">append</span><span class="op" id="5217571">(</span><span class="ident" id="5217572">result</span><span class="op" id="5217578">,</span>&nbsp;<span class="ident" id="5217580">match</span><span class="op" id="5217585">[</span><span class="num" id="5217586">0</span><span class="op" id="5217587">:</span><span class="num" id="5217588">2</span><span class="op" id="5217589">]</span><span class="op" id="5217590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217593">}</span><span class="op" id="5217594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217597">if</span>&nbsp;<span class="builtinfunc" id="5217600">len</span><span class="op" id="5217603">(</span><span class="ident" id="5217604">result</span><span class="op" id="5217610">)</span>&nbsp;<span class="op" id="5217612">==</span>&nbsp;<span class="num" id="5217615">0</span>&nbsp;<span class="op" id="5217617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217621">return</span>&nbsp;<span class="ident" id="5217628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217633">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217636">return</span>&nbsp;<span class="ident" id="5217643">result</span><br>
<span class="lineno"></span><span class="op" id="5217650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217653">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="5217729">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="5217801">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5217840">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5217885">func</span>&nbsp;<span class="op" id="5217890">(</span><span class="ident" id="5217891">re</span>&nbsp;<span class="op" id="5217894">*</span><span class="ident" id="5217895">Regexp</span><span class="op" id="5217901">)</span>&nbsp;<span class="ident" id="5217903">FindAllSubmatch</span><span class="op" id="5217918">(</span><span class="ident" id="5217919">b</span>&nbsp;<span class="op" id="5217921">[</span><span class="op" id="5217922">]</span><span class="builtintype" id="5217923">byte</span><span class="op" id="5217927">,</span>&nbsp;<span class="ident" id="5217929">n</span>&nbsp;<span class="builtintype" id="5217931">int</span><span class="op" id="5217934">)</span>&nbsp;<span class="op" id="5217936">[</span><span class="op" id="5217937">]</span><span class="op" id="5217938">[</span><span class="op" id="5217939">]</span><span class="op" id="5217940">[</span><span class="op" id="5217941">]</span><span class="builtintype" id="5217942">byte</span>&nbsp;<span class="op" id="5217947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217950">if</span>&nbsp;<span class="ident" id="5217953">n</span>&nbsp;<span class="op" id="5217955">&lt;</span>&nbsp;<span class="num" id="5217957">0</span>&nbsp;<span class="op" id="5217959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217963">n</span>&nbsp;<span class="op" id="5217965">=</span>&nbsp;<span class="builtinfunc" id="5217967">len</span><span class="op" id="5217970">(</span><span class="ident" id="5217971">b</span><span class="op" id="5217972">)</span>&nbsp;<span class="op" id="5217974">+</span>&nbsp;<span class="num" id="5217976">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217982">result</span>&nbsp;<span class="op" id="5217989">:=</span>&nbsp;<span class="builtinfunc" id="5217992">make</span><span class="op" id="5217996">(</span><span class="op" id="5217997">[</span><span class="op" id="5217998">]</span><span class="op" id="5217999">[</span><span class="op" id="5218000">]</span><span class="op" id="5218001">[</span><span class="op" id="5218002">]</span><span class="builtintype" id="5218003">byte</span><span class="op" id="5218007">,</span>&nbsp;<span class="num" id="5218009">0</span><span class="op" id="5218010">,</span>&nbsp;<span class="ident" id="5218012">startSize</span><span class="op" id="5218021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218024">re</span><span class="op" id="5218026">.</span><span class="ident" id="5218027">allMatches</span><span class="op" id="5218037">(</span><span class="string" id="5218038">&#34;&#34;</span><span class="op" id="5218040">,</span>&nbsp;<span class="ident" id="5218042">b</span><span class="op" id="5218043">,</span>&nbsp;<span class="ident" id="5218045">n</span><span class="op" id="5218046">,</span>&nbsp;<span class="keyword" id="5218048">func</span><span class="op" id="5218052">(</span><span class="ident" id="5218053">match</span>&nbsp;<span class="op" id="5218059">[</span><span class="op" id="5218060">]</span><span class="builtintype" id="5218061">int</span><span class="op" id="5218064">)</span>&nbsp;<span class="op" id="5218066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218070">slice</span>&nbsp;<span class="op" id="5218076">:=</span>&nbsp;<span class="builtinfunc" id="5218079">make</span><span class="op" id="5218083">(</span><span class="op" id="5218084">[</span><span class="op" id="5218085">]</span><span class="op" id="5218086">[</span><span class="op" id="5218087">]</span><span class="builtintype" id="5218088">byte</span><span class="op" id="5218092">,</span>&nbsp;<span class="builtinfunc" id="5218094">len</span><span class="op" id="5218097">(</span><span class="ident" id="5218098">match</span><span class="op" id="5218103">)</span><span class="op" id="5218104">/</span><span class="num" id="5218105">2</span><span class="op" id="5218106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218110">for</span>&nbsp;<span class="ident" id="5218114">j</span>&nbsp;<span class="op" id="5218116">:=</span>&nbsp;<span class="keyword" id="5218119">range</span>&nbsp;<span class="ident" id="5218125">slice</span>&nbsp;<span class="op" id="5218131">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218136">if</span>&nbsp;<span class="ident" id="5218139">match</span><span class="op" id="5218144">[</span><span class="num" id="5218145">2</span><span class="op" id="5218146">*</span><span class="ident" id="5218147">j</span><span class="op" id="5218148">]</span>&nbsp;<span class="op" id="5218150">&gt;=</span>&nbsp;<span class="num" id="5218153">0</span>&nbsp;<span class="op" id="5218155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218161">slice</span><span class="op" id="5218166">[</span><span class="ident" id="5218167">j</span><span class="op" id="5218168">]</span>&nbsp;<span class="op" id="5218170">=</span>&nbsp;<span class="ident" id="5218172">b</span><span class="op" id="5218173">[</span><span class="ident" id="5218174">match</span><span class="op" id="5218179">[</span><span class="num" id="5218180">2</span><span class="op" id="5218181">*</span><span class="ident" id="5218182">j</span><span class="op" id="5218183">]</span><span class="op" id="5218184">:</span><span class="ident" id="5218185">match</span><span class="op" id="5218190">[</span><span class="num" id="5218191">2</span><span class="op" id="5218192">*</span><span class="ident" id="5218193">j</span><span class="op" id="5218194">+</span><span class="num" id="5218195">1</span><span class="op" id="5218196">]</span><span class="op" id="5218197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218210">result</span>&nbsp;<span class="op" id="5218217">=</span>&nbsp;<span class="builtinfunc" id="5218219">append</span><span class="op" id="5218225">(</span><span class="ident" id="5218226">result</span><span class="op" id="5218232">,</span>&nbsp;<span class="ident" id="5218234">slice</span><span class="op" id="5218239">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218242">}</span><span class="op" id="5218243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218246">if</span>&nbsp;<span class="builtinfunc" id="5218249">len</span><span class="op" id="5218252">(</span><span class="ident" id="5218253">result</span><span class="op" id="5218259">)</span>&nbsp;<span class="op" id="5218261">==</span>&nbsp;<span class="num" id="5218264">0</span>&nbsp;<span class="op" id="5218266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218270">return</span>&nbsp;<span class="ident" id="5218277">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218285">return</span>&nbsp;<span class="ident" id="5218292">result</span><br>
<span class="lineno">1010</span><span class="op" id="5218299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218302">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5218380">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5218454">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="5218499">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5218544">func</span>&nbsp;<span class="op" id="5218549">(</span><span class="ident" id="5218550">re</span>&nbsp;<span class="op" id="5218553">*</span><span class="ident" id="5218554">Regexp</span><span class="op" id="5218560">)</span>&nbsp;<span class="ident" id="5218562">FindAllSubmatchIndex</span><span class="op" id="5218582">(</span><span class="ident" id="5218583">b</span>&nbsp;<span class="op" id="5218585">[</span><span class="op" id="5218586">]</span><span class="builtintype" id="5218587">byte</span><span class="op" id="5218591">,</span>&nbsp;<span class="ident" id="5218593">n</span>&nbsp;<span class="builtintype" id="5218595">int</span><span class="op" id="5218598">)</span>&nbsp;<span class="op" id="5218600">[</span><span class="op" id="5218601">]</span><span class="op" id="5218602">[</span><span class="op" id="5218603">]</span><span class="builtintype" id="5218604">int</span>&nbsp;<span class="op" id="5218608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218611">if</span>&nbsp;<span class="ident" id="5218614">n</span>&nbsp;<span class="op" id="5218616">&lt;</span>&nbsp;<span class="num" id="5218618">0</span>&nbsp;<span class="op" id="5218620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218624">n</span>&nbsp;<span class="op" id="5218626">=</span>&nbsp;<span class="builtinfunc" id="5218628">len</span><span class="op" id="5218631">(</span><span class="ident" id="5218632">b</span><span class="op" id="5218633">)</span>&nbsp;<span class="op" id="5218635">+</span>&nbsp;<span class="num" id="5218637">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218640">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218643">result</span>&nbsp;<span class="op" id="5218650">:=</span>&nbsp;<span class="builtinfunc" id="5218653">make</span><span class="op" id="5218657">(</span><span class="op" id="5218658">[</span><span class="op" id="5218659">]</span><span class="op" id="5218660">[</span><span class="op" id="5218661">]</span><span class="builtintype" id="5218662">int</span><span class="op" id="5218665">,</span>&nbsp;<span class="num" id="5218667">0</span><span class="op" id="5218668">,</span>&nbsp;<span class="ident" id="5218670">startSize</span><span class="op" id="5218679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218682">re</span><span class="op" id="5218684">.</span><span class="ident" id="5218685">allMatches</span><span class="op" id="5218695">(</span><span class="string" id="5218696">&#34;&#34;</span><span class="op" id="5218698">,</span>&nbsp;<span class="ident" id="5218700">b</span><span class="op" id="5218701">,</span>&nbsp;<span class="ident" id="5218703">n</span><span class="op" id="5218704">,</span>&nbsp;<span class="keyword" id="5218706">func</span><span class="op" id="5218710">(</span><span class="ident" id="5218711">match</span>&nbsp;<span class="op" id="5218717">[</span><span class="op" id="5218718">]</span><span class="builtintype" id="5218719">int</span><span class="op" id="5218722">)</span>&nbsp;<span class="op" id="5218724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5218728">result</span>&nbsp;<span class="op" id="5218735">=</span>&nbsp;<span class="builtinfunc" id="5218737">append</span><span class="op" id="5218743">(</span><span class="ident" id="5218744">result</span><span class="op" id="5218750">,</span>&nbsp;<span class="ident" id="5218752">match</span><span class="op" id="5218757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218760">}</span><span class="op" id="5218761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218764">if</span>&nbsp;<span class="builtinfunc" id="5218767">len</span><span class="op" id="5218770">(</span><span class="ident" id="5218771">result</span><span class="op" id="5218777">)</span>&nbsp;<span class="op" id="5218779">==</span>&nbsp;<span class="num" id="5218782">0</span>&nbsp;<span class="op" id="5218784">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218788">return</span>&nbsp;<span class="ident" id="5218795">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5218800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218803">return</span>&nbsp;<span class="ident" id="5218810">result</span><br>
<span class="lineno"></span><span class="op" id="5218817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="5218820">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5218892">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5218970">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5219019">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5219064">func</span>&nbsp;<span class="op" id="5219069">(</span><span class="ident" id="5219070">re</span>&nbsp;<span class="op" id="5219073">*</span><span class="ident" id="5219074">Regexp</span><span class="op" id="5219080">)</span>&nbsp;<span class="ident" id="5219082">FindAllStringSubmatch</span><span class="op" id="5219103">(</span><span class="ident" id="5219104">s</span>&nbsp;<span class="builtintype" id="5219106">string</span><span class="op" id="5219112">,</span>&nbsp;<span class="ident" id="5219114">n</span>&nbsp;<span class="builtintype" id="5219116">int</span><span class="op" id="5219119">)</span>&nbsp;<span class="op" id="5219121">[</span><span class="op" id="5219122">]</span><span class="op" id="5219123">[</span><span class="op" id="5219124">]</span><span class="builtintype" id="5219125">string</span>&nbsp;<span class="op" id="5219132">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219135">if</span>&nbsp;<span class="ident" id="5219138">n</span>&nbsp;<span class="op" id="5219140">&lt;</span>&nbsp;<span class="num" id="5219142">0</span>&nbsp;<span class="op" id="5219144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219148">n</span>&nbsp;<span class="op" id="5219150">=</span>&nbsp;<span class="builtinfunc" id="5219152">len</span><span class="op" id="5219155">(</span><span class="ident" id="5219156">s</span><span class="op" id="5219157">)</span>&nbsp;<span class="op" id="5219159">+</span>&nbsp;<span class="num" id="5219161">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219167">result</span>&nbsp;<span class="op" id="5219174">:=</span>&nbsp;<span class="builtinfunc" id="5219177">make</span><span class="op" id="5219181">(</span><span class="op" id="5219182">[</span><span class="op" id="5219183">]</span><span class="op" id="5219184">[</span><span class="op" id="5219185">]</span><span class="builtintype" id="5219186">string</span><span class="op" id="5219192">,</span>&nbsp;<span class="num" id="5219194">0</span><span class="op" id="5219195">,</span>&nbsp;<span class="ident" id="5219197">startSize</span><span class="op" id="5219206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219209">re</span><span class="op" id="5219211">.</span><span class="ident" id="5219212">allMatches</span><span class="op" id="5219222">(</span><span class="ident" id="5219223">s</span><span class="op" id="5219224">,</span>&nbsp;<span class="ident" id="5219226">nil</span><span class="op" id="5219229">,</span>&nbsp;<span class="ident" id="5219231">n</span><span class="op" id="5219232">,</span>&nbsp;<span class="keyword" id="5219234">func</span><span class="op" id="5219238">(</span><span class="ident" id="5219239">match</span>&nbsp;<span class="op" id="5219245">[</span><span class="op" id="5219246">]</span><span class="builtintype" id="5219247">int</span><span class="op" id="5219250">)</span>&nbsp;<span class="op" id="5219252">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219256">slice</span>&nbsp;<span class="op" id="5219262">:=</span>&nbsp;<span class="builtinfunc" id="5219265">make</span><span class="op" id="5219269">(</span><span class="op" id="5219270">[</span><span class="op" id="5219271">]</span><span class="builtintype" id="5219272">string</span><span class="op" id="5219278">,</span>&nbsp;<span class="builtinfunc" id="5219280">len</span><span class="op" id="5219283">(</span><span class="ident" id="5219284">match</span><span class="op" id="5219289">)</span><span class="op" id="5219290">/</span><span class="num" id="5219291">2</span><span class="op" id="5219292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219296">for</span>&nbsp;<span class="ident" id="5219300">j</span>&nbsp;<span class="op" id="5219302">:=</span>&nbsp;<span class="keyword" id="5219305">range</span>&nbsp;<span class="ident" id="5219311">slice</span>&nbsp;<span class="op" id="5219317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219322">if</span>&nbsp;<span class="ident" id="5219325">match</span><span class="op" id="5219330">[</span><span class="num" id="5219331">2</span><span class="op" id="5219332">*</span><span class="ident" id="5219333">j</span><span class="op" id="5219334">]</span>&nbsp;<span class="op" id="5219336">&gt;=</span>&nbsp;<span class="num" id="5219339">0</span>&nbsp;<span class="op" id="5219341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219347">slice</span><span class="op" id="5219352">[</span><span class="ident" id="5219353">j</span><span class="op" id="5219354">]</span>&nbsp;<span class="op" id="5219356">=</span>&nbsp;<span class="ident" id="5219358">s</span><span class="op" id="5219359">[</span><span class="ident" id="5219360">match</span><span class="op" id="5219365">[</span><span class="num" id="5219366">2</span><span class="op" id="5219367">*</span><span class="ident" id="5219368">j</span><span class="op" id="5219369">]</span><span class="op" id="5219370">:</span><span class="ident" id="5219371">match</span><span class="op" id="5219376">[</span><span class="num" id="5219377">2</span><span class="op" id="5219378">*</span><span class="ident" id="5219379">j</span><span class="op" id="5219380">+</span><span class="num" id="5219381">1</span><span class="op" id="5219382">]</span><span class="op" id="5219383">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219388">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219396">result</span>&nbsp;<span class="op" id="5219403">=</span>&nbsp;<span class="builtinfunc" id="5219405">append</span><span class="op" id="5219411">(</span><span class="ident" id="5219412">result</span><span class="op" id="5219418">,</span>&nbsp;<span class="ident" id="5219420">slice</span><span class="op" id="5219425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219428">}</span><span class="op" id="5219429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219432">if</span>&nbsp;<span class="builtinfunc" id="5219435">len</span><span class="op" id="5219438">(</span><span class="ident" id="5219439">result</span><span class="op" id="5219445">)</span>&nbsp;<span class="op" id="5219447">==</span>&nbsp;<span class="num" id="5219450">0</span>&nbsp;<span class="op" id="5219452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219456">return</span>&nbsp;<span class="ident" id="5219463">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219471">return</span>&nbsp;<span class="ident" id="5219478">result</span><br>
<span class="lineno"></span><span class="op" id="5219485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5219488">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="5219542">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5219618">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5219688">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5219700">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5219745">func</span>&nbsp;<span class="op" id="5219750">(</span><span class="ident" id="5219751">re</span>&nbsp;<span class="op" id="5219754">*</span><span class="ident" id="5219755">Regexp</span><span class="op" id="5219761">)</span>&nbsp;<span class="ident" id="5219763">FindAllStringSubmatchIndex</span><span class="op" id="5219789">(</span><span class="ident" id="5219790">s</span>&nbsp;<span class="builtintype" id="5219792">string</span><span class="op" id="5219798">,</span>&nbsp;<span class="ident" id="5219800">n</span>&nbsp;<span class="builtintype" id="5219802">int</span><span class="op" id="5219805">)</span>&nbsp;<span class="op" id="5219807">[</span><span class="op" id="5219808">]</span><span class="op" id="5219809">[</span><span class="op" id="5219810">]</span><span class="builtintype" id="5219811">int</span>&nbsp;<span class="op" id="5219815">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219818">if</span>&nbsp;<span class="ident" id="5219821">n</span>&nbsp;<span class="op" id="5219823">&lt;</span>&nbsp;<span class="num" id="5219825">0</span>&nbsp;<span class="op" id="5219827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219831">n</span>&nbsp;<span class="op" id="5219833">=</span>&nbsp;<span class="builtinfunc" id="5219835">len</span><span class="op" id="5219838">(</span><span class="ident" id="5219839">s</span><span class="op" id="5219840">)</span>&nbsp;<span class="op" id="5219842">+</span>&nbsp;<span class="num" id="5219844">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219850">result</span>&nbsp;<span class="op" id="5219857">:=</span>&nbsp;<span class="builtinfunc" id="5219860">make</span><span class="op" id="5219864">(</span><span class="op" id="5219865">[</span><span class="op" id="5219866">]</span><span class="op" id="5219867">[</span><span class="op" id="5219868">]</span><span class="builtintype" id="5219869">int</span><span class="op" id="5219872">,</span>&nbsp;<span class="num" id="5219874">0</span><span class="op" id="5219875">,</span>&nbsp;<span class="ident" id="5219877">startSize</span><span class="op" id="5219886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219889">re</span><span class="op" id="5219891">.</span><span class="ident" id="5219892">allMatches</span><span class="op" id="5219902">(</span><span class="ident" id="5219903">s</span><span class="op" id="5219904">,</span>&nbsp;<span class="ident" id="5219906">nil</span><span class="op" id="5219909">,</span>&nbsp;<span class="ident" id="5219911">n</span><span class="op" id="5219912">,</span>&nbsp;<span class="keyword" id="5219914">func</span><span class="op" id="5219918">(</span><span class="ident" id="5219919">match</span>&nbsp;<span class="op" id="5219925">[</span><span class="op" id="5219926">]</span><span class="builtintype" id="5219927">int</span><span class="op" id="5219930">)</span>&nbsp;<span class="op" id="5219932">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5219936">result</span>&nbsp;<span class="op" id="5219943">=</span>&nbsp;<span class="builtinfunc" id="5219945">append</span><span class="op" id="5219951">(</span><span class="ident" id="5219952">result</span><span class="op" id="5219958">,</span>&nbsp;<span class="ident" id="5219960">match</span><span class="op" id="5219965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5219968">}</span><span class="op" id="5219969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219972">if</span>&nbsp;<span class="builtinfunc" id="5219975">len</span><span class="op" id="5219978">(</span><span class="ident" id="5219979">result</span><span class="op" id="5219985">)</span>&nbsp;<span class="op" id="5219987">==</span>&nbsp;<span class="num" id="5219990">0</span>&nbsp;<span class="op" id="5219992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5219996">return</span>&nbsp;<span class="ident" id="5220003">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5220008">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220011">return</span>&nbsp;<span class="ident" id="5220018">result</span><br>
<span class="lineno"></span><span class="op" id="5220025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5220028">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5220113">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="5220165">//</span><br>
<span class="lineno"></span><span class="comment" id="5220168">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5220241">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5220327">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="5220399">//</span><br>
<span class="lineno">1080</span><span class="comment" id="5220402">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="5220414">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="5220476">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="5220518">//</span><br>
<span class="lineno"></span><span class="comment" id="5220521">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="5220581">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="5220665">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="5220714">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="5220741">func</span>&nbsp;<span class="op" id="5220746">(</span><span class="ident" id="5220747">re</span>&nbsp;<span class="op" id="5220750">*</span><span class="ident" id="5220751">Regexp</span><span class="op" id="5220757">)</span>&nbsp;<span class="ident" id="5220759">Split</span><span class="op" id="5220764">(</span><span class="ident" id="5220765">s</span>&nbsp;<span class="builtintype" id="5220767">string</span><span class="op" id="5220773">,</span>&nbsp;<span class="ident" id="5220775">n</span>&nbsp;<span class="builtintype" id="5220777">int</span><span class="op" id="5220780">)</span>&nbsp;<span class="op" id="5220782">[</span><span class="op" id="5220783">]</span><span class="builtintype" id="5220784">string</span>&nbsp;<span class="op" id="5220791">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220795">if</span>&nbsp;<span class="ident" id="5220798">n</span>&nbsp;<span class="op" id="5220800">==</span>&nbsp;<span class="num" id="5220803">0</span>&nbsp;<span class="op" id="5220805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220809">return</span>&nbsp;<span class="ident" id="5220816">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5220821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220825">if</span>&nbsp;<span class="builtinfunc" id="5220828">len</span><span class="op" id="5220831">(</span><span class="ident" id="5220832">re</span><span class="op" id="5220834">.</span><span class="ident" id="5220835">expr</span><span class="op" id="5220839">)</span>&nbsp;<span class="op" id="5220841">&gt;</span>&nbsp;<span class="num" id="5220843">0</span>&nbsp;<span class="op" id="5220845">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5220848">len</span><span class="op" id="5220851">(</span><span class="ident" id="5220852">s</span><span class="op" id="5220853">)</span>&nbsp;<span class="op" id="5220855">==</span>&nbsp;<span class="num" id="5220858">0</span>&nbsp;<span class="op" id="5220860">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220864">return</span>&nbsp;<span class="op" id="5220871">[</span><span class="op" id="5220872">]</span><span class="builtintype" id="5220873">string</span><span class="op" id="5220879">{</span><span class="string" id="5220880">&#34;&#34;</span><span class="op" id="5220882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5220885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5220889">matches</span>&nbsp;<span class="op" id="5220897">:=</span>&nbsp;<span class="ident" id="5220900">re</span><span class="op" id="5220902">.</span><span class="ident" id="5220903">FindAllStringIndex</span><span class="op" id="5220921">(</span><span class="ident" id="5220922">s</span><span class="op" id="5220923">,</span>&nbsp;<span class="ident" id="5220925">n</span><span class="op" id="5220926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5220929">strings</span>&nbsp;<span class="op" id="5220937">:=</span>&nbsp;<span class="builtinfunc" id="5220940">make</span><span class="op" id="5220944">(</span><span class="op" id="5220945">[</span><span class="op" id="5220946">]</span><span class="builtintype" id="5220947">string</span><span class="op" id="5220953">,</span>&nbsp;<span class="num" id="5220955">0</span><span class="op" id="5220956">,</span>&nbsp;<span class="builtinfunc" id="5220958">len</span><span class="op" id="5220961">(</span><span class="ident" id="5220962">matches</span><span class="op" id="5220969">)</span><span class="op" id="5220970">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5220974">beg</span>&nbsp;<span class="op" id="5220978">:=</span>&nbsp;<span class="num" id="5220981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5220984">end</span>&nbsp;<span class="op" id="5220988">:=</span>&nbsp;<span class="num" id="5220991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5220994">for</span>&nbsp;<span class="ident" id="5220998">_</span><span class="op" id="5220999">,</span>&nbsp;<span class="ident" id="5221001">match</span>&nbsp;<span class="op" id="5221007">:=</span>&nbsp;<span class="keyword" id="5221010">range</span>&nbsp;<span class="ident" id="5221016">matches</span>&nbsp;<span class="op" id="5221024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221028">if</span>&nbsp;<span class="ident" id="5221031">n</span>&nbsp;<span class="op" id="5221033">&gt;</span>&nbsp;<span class="num" id="5221035">0</span>&nbsp;<span class="op" id="5221037">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5221040">len</span><span class="op" id="5221043">(</span><span class="ident" id="5221044">strings</span><span class="op" id="5221051">)</span>&nbsp;<span class="op" id="5221053">&gt;=</span>&nbsp;<span class="ident" id="5221056">n</span><span class="op" id="5221057">-</span><span class="num" id="5221058">1</span>&nbsp;<span class="op" id="5221060">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221065">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221078">end</span>&nbsp;<span class="op" id="5221082">=</span>&nbsp;<span class="ident" id="5221084">match</span><span class="op" id="5221089">[</span><span class="num" id="5221090">0</span><span class="op" id="5221091">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221095">if</span>&nbsp;<span class="ident" id="5221098">match</span><span class="op" id="5221103">[</span><span class="num" id="5221104">1</span><span class="op" id="5221105">]</span>&nbsp;<span class="op" id="5221107">!=</span>&nbsp;<span class="num" id="5221110">0</span>&nbsp;<span class="op" id="5221112">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221117">strings</span>&nbsp;<span class="op" id="5221125">=</span>&nbsp;<span class="builtinfunc" id="5221127">append</span><span class="op" id="5221133">(</span><span class="ident" id="5221134">strings</span><span class="op" id="5221141">,</span>&nbsp;<span class="ident" id="5221143">s</span><span class="op" id="5221144">[</span><span class="ident" id="5221145">beg</span><span class="op" id="5221148">:</span><span class="ident" id="5221149">end</span><span class="op" id="5221152">]</span><span class="op" id="5221153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221161">beg</span>&nbsp;<span class="op" id="5221165">=</span>&nbsp;<span class="ident" id="5221167">match</span><span class="op" id="5221172">[</span><span class="num" id="5221173">1</span><span class="op" id="5221174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221181">if</span>&nbsp;<span class="ident" id="5221184">end</span>&nbsp;<span class="op" id="5221188">!=</span>&nbsp;<span class="builtinfunc" id="5221191">len</span><span class="op" id="5221194">(</span><span class="ident" id="5221195">s</span><span class="op" id="5221196">)</span>&nbsp;<span class="op" id="5221198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221202">strings</span>&nbsp;<span class="op" id="5221210">=</span>&nbsp;<span class="builtinfunc" id="5221212">append</span><span class="op" id="5221218">(</span><span class="ident" id="5221219">strings</span><span class="op" id="5221226">,</span>&nbsp;<span class="ident" id="5221228">s</span><span class="op" id="5221229">[</span><span class="ident" id="5221230">beg</span><span class="op" id="5221233">:</span><span class="op" id="5221234">]</span><span class="op" id="5221235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221242">return</span>&nbsp;<span class="ident" id="5221249">strings</span><br>
<span class="lineno">1120</span><span class="op" id="5221257">}</span>
</div>
</body>
</html>
