<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html" class="current">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3599041">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3599096">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3599150">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3599201">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3599279">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3599333">package</span>&nbsp;<span class="ident" id="3599341">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3599349">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3599404">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3599481">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3599531">func</span>&nbsp;<span class="ident" id="3599536">ConstantTimeCompare</span><span class="op" id="3599555">(</span><span class="ident" id="3599556">x</span><span class="op" id="3599557">,</span>&nbsp;<span class="ident" id="3599559">y</span>&nbsp;<span class="op" id="3599561">[</span><span class="op" id="3599562">]</span><span class="builtintype" id="3599563">byte</span><span class="op" id="3599567">)</span>&nbsp;<span class="builtintype" id="3599569">int</span>&nbsp;<span class="op" id="3599573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599576">if</span>&nbsp;<span class="builtinfunc" id="3599579">len</span><span class="op" id="3599582">(</span><span class="ident" id="3599583">x</span><span class="op" id="3599584">)</span>&nbsp;<span class="op" id="3599586">!=</span>&nbsp;<span class="builtinfunc" id="3599589">len</span><span class="op" id="3599592">(</span><span class="ident" id="3599593">y</span><span class="op" id="3599594">)</span>&nbsp;<span class="op" id="3599596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599600">return</span>&nbsp;<span class="num" id="3599607">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599614">var</span>&nbsp;<span class="ident" id="3599618">v</span>&nbsp;<span class="builtintype" id="3599620">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599627">for</span>&nbsp;<span class="ident" id="3599631">i</span>&nbsp;<span class="op" id="3599633">:=</span>&nbsp;<span class="num" id="3599636">0</span><span class="op" id="3599637">;</span>&nbsp;<span class="ident" id="3599639">i</span>&nbsp;<span class="op" id="3599641">&lt;</span>&nbsp;<span class="builtinfunc" id="3599643">len</span><span class="op" id="3599646">(</span><span class="ident" id="3599647">x</span><span class="op" id="3599648">)</span><span class="op" id="3599649">;</span>&nbsp;<span class="ident" id="3599651">i</span><span class="op" id="3599652">++</span>&nbsp;<span class="op" id="3599655">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3599659">v</span>&nbsp;<span class="op" id="3599661">|=</span>&nbsp;<span class="ident" id="3599664">x</span><span class="op" id="3599665">[</span><span class="ident" id="3599666">i</span><span class="op" id="3599667">]</span>&nbsp;<span class="op" id="3599669">^</span>&nbsp;<span class="ident" id="3599671">y</span><span class="op" id="3599672">[</span><span class="ident" id="3599673">i</span><span class="op" id="3599674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3599677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3599681">return</span>&nbsp;<span class="ident" id="3599688">ConstantTimeByteEq</span><span class="op" id="3599706">(</span><span class="ident" id="3599707">v</span><span class="op" id="3599708">,</span>&nbsp;<span class="num" id="3599710">0</span><span class="op" id="3599711">)</span><br>
<span class="lineno"></span><span class="op" id="3599713">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3599716">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3599775">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3599832">func</span>&nbsp;<span class="ident" id="3599837">ConstantTimeSelect</span><span class="op" id="3599855">(</span><span class="ident" id="3599856">v</span><span class="op" id="3599857">,</span>&nbsp;<span class="ident" id="3599859">x</span><span class="op" id="3599860">,</span>&nbsp;<span class="ident" id="3599862">y</span>&nbsp;<span class="builtintype" id="3599864">int</span><span class="op" id="3599867">)</span>&nbsp;<span class="builtintype" id="3599869">int</span>&nbsp;<span class="op" id="3599873">{</span>&nbsp;<span class="keyword" id="3599875">return</span>&nbsp;<span class="op" id="3599882">^</span><span class="op" id="3599883">(</span><span class="ident" id="3599884">v</span><span class="op" id="3599885">-</span><span class="num" id="3599886">1</span><span class="op" id="3599887">)</span><span class="op" id="3599888">&amp;</span><span class="ident" id="3599889">x</span>&nbsp;<span class="op" id="3599891">|</span>&nbsp;<span class="op" id="3599893">(</span><span class="ident" id="3599894">v</span><span class="op" id="3599895">-</span><span class="num" id="3599896">1</span><span class="op" id="3599897">)</span><span class="op" id="3599898">&amp;</span><span class="ident" id="3599899">y</span>&nbsp;<span class="op" id="3599901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3599904">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3599963">func</span>&nbsp;<span class="ident" id="3599968">ConstantTimeByteEq</span><span class="op" id="3599986">(</span><span class="ident" id="3599987">x</span><span class="op" id="3599988">,</span>&nbsp;<span class="ident" id="3599990">y</span>&nbsp;<span class="builtintype" id="3599992">uint8</span><span class="op" id="3599997">)</span>&nbsp;<span class="builtintype" id="3599999">int</span>&nbsp;<span class="op" id="3600003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600006">z</span>&nbsp;<span class="op" id="3600008">:=</span>&nbsp;<span class="op" id="3600011">^</span><span class="op" id="3600012">(</span><span class="ident" id="3600013">x</span>&nbsp;<span class="op" id="3600015">^</span>&nbsp;<span class="ident" id="3600017">y</span><span class="op" id="3600018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600021">z</span>&nbsp;<span class="op" id="3600023">&amp;=</span>&nbsp;<span class="ident" id="3600026">z</span>&nbsp;<span class="op" id="3600028">&gt;&gt;</span>&nbsp;<span class="num" id="3600031">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600034">z</span>&nbsp;<span class="op" id="3600036">&amp;=</span>&nbsp;<span class="ident" id="3600039">z</span>&nbsp;<span class="op" id="3600041">&gt;&gt;</span>&nbsp;<span class="num" id="3600044">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600047">z</span>&nbsp;<span class="op" id="3600049">&amp;=</span>&nbsp;<span class="ident" id="3600052">z</span>&nbsp;<span class="op" id="3600054">&gt;&gt;</span>&nbsp;<span class="num" id="3600057">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600061">return</span>&nbsp;<span class="builtintype" id="3600068">int</span><span class="op" id="3600071">(</span><span class="ident" id="3600072">z</span><span class="op" id="3600073">)</span><br>
<span class="lineno"></span><span class="op" id="3600075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3600078">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3600133">func</span>&nbsp;<span class="ident" id="3600138">ConstantTimeEq</span><span class="op" id="3600152">(</span><span class="ident" id="3600153">x</span><span class="op" id="3600154">,</span>&nbsp;<span class="ident" id="3600156">y</span>&nbsp;<span class="builtintype" id="3600158">int32</span><span class="op" id="3600163">)</span>&nbsp;<span class="builtintype" id="3600165">int</span>&nbsp;<span class="op" id="3600169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600172">z</span>&nbsp;<span class="op" id="3600174">:=</span>&nbsp;<span class="op" id="3600177">^</span><span class="op" id="3600178">(</span><span class="ident" id="3600179">x</span>&nbsp;<span class="op" id="3600181">^</span>&nbsp;<span class="ident" id="3600183">y</span><span class="op" id="3600184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600187">z</span>&nbsp;<span class="op" id="3600189">&amp;=</span>&nbsp;<span class="ident" id="3600192">z</span>&nbsp;<span class="op" id="3600194">&gt;&gt;</span>&nbsp;<span class="num" id="3600197">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600201">z</span>&nbsp;<span class="op" id="3600203">&amp;=</span>&nbsp;<span class="ident" id="3600206">z</span>&nbsp;<span class="op" id="3600208">&gt;&gt;</span>&nbsp;<span class="num" id="3600211">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600214">z</span>&nbsp;<span class="op" id="3600216">&amp;=</span>&nbsp;<span class="ident" id="3600219">z</span>&nbsp;<span class="op" id="3600221">&gt;&gt;</span>&nbsp;<span class="num" id="3600224">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600227">z</span>&nbsp;<span class="op" id="3600229">&amp;=</span>&nbsp;<span class="ident" id="3600232">z</span>&nbsp;<span class="op" id="3600234">&gt;&gt;</span>&nbsp;<span class="num" id="3600237">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600240">z</span>&nbsp;<span class="op" id="3600242">&amp;=</span>&nbsp;<span class="ident" id="3600245">z</span>&nbsp;<span class="op" id="3600247">&gt;&gt;</span>&nbsp;<span class="num" id="3600250">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600254">return</span>&nbsp;<span class="builtintype" id="3600261">int</span><span class="op" id="3600264">(</span><span class="ident" id="3600265">z</span>&nbsp;<span class="op" id="3600267">&amp;</span>&nbsp;<span class="num" id="3600269">1</span><span class="op" id="3600270">)</span><br>
<span class="lineno">50</span><span class="op" id="3600272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3600275">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3600353">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3600430">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3600456">func</span>&nbsp;<span class="ident" id="3600461">ConstantTimeCopy</span><span class="op" id="3600477">(</span><span class="ident" id="3600478">v</span>&nbsp;<span class="builtintype" id="3600480">int</span><span class="op" id="3600483">,</span>&nbsp;<span class="ident" id="3600485">x</span><span class="op" id="3600486">,</span>&nbsp;<span class="ident" id="3600488">y</span>&nbsp;<span class="op" id="3600490">[</span><span class="op" id="3600491">]</span><span class="builtintype" id="3600492">byte</span><span class="op" id="3600496">)</span>&nbsp;<span class="op" id="3600498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600501">if</span>&nbsp;<span class="builtinfunc" id="3600504">len</span><span class="op" id="3600507">(</span><span class="ident" id="3600508">x</span><span class="op" id="3600509">)</span>&nbsp;<span class="op" id="3600511">!=</span>&nbsp;<span class="builtinfunc" id="3600514">len</span><span class="op" id="3600517">(</span><span class="ident" id="3600518">y</span><span class="op" id="3600519">)</span>&nbsp;<span class="op" id="3600521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3600525">panic</span><span class="op" id="3600530">(</span><span class="string" id="3600531">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3600570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600577">xmask</span>&nbsp;<span class="op" id="3600583">:=</span>&nbsp;<span class="builtintype" id="3600586">byte</span><span class="op" id="3600590">(</span><span class="ident" id="3600591">v</span>&nbsp;<span class="op" id="3600593">-</span>&nbsp;<span class="num" id="3600595">1</span><span class="op" id="3600596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600599">ymask</span>&nbsp;<span class="op" id="3600605">:=</span>&nbsp;<span class="builtintype" id="3600608">byte</span><span class="op" id="3600612">(</span><span class="op" id="3600613">^</span><span class="op" id="3600614">(</span><span class="ident" id="3600615">v</span>&nbsp;<span class="op" id="3600617">-</span>&nbsp;<span class="num" id="3600619">1</span><span class="op" id="3600620">)</span><span class="op" id="3600621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600624">for</span>&nbsp;<span class="ident" id="3600628">i</span>&nbsp;<span class="op" id="3600630">:=</span>&nbsp;<span class="num" id="3600633">0</span><span class="op" id="3600634">;</span>&nbsp;<span class="ident" id="3600636">i</span>&nbsp;<span class="op" id="3600638">&lt;</span>&nbsp;<span class="builtinfunc" id="3600640">len</span><span class="op" id="3600643">(</span><span class="ident" id="3600644">x</span><span class="op" id="3600645">)</span><span class="op" id="3600646">;</span>&nbsp;<span class="ident" id="3600648">i</span><span class="op" id="3600649">++</span>&nbsp;<span class="op" id="3600652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600656">x</span><span class="op" id="3600657">[</span><span class="ident" id="3600658">i</span><span class="op" id="3600659">]</span>&nbsp;<span class="op" id="3600661">=</span>&nbsp;<span class="ident" id="3600663">x</span><span class="op" id="3600664">[</span><span class="ident" id="3600665">i</span><span class="op" id="3600666">]</span><span class="op" id="3600667">&amp;</span><span class="ident" id="3600668">xmask</span>&nbsp;<span class="op" id="3600674">|</span>&nbsp;<span class="ident" id="3600676">y</span><span class="op" id="3600677">[</span><span class="ident" id="3600678">i</span><span class="op" id="3600679">]</span><span class="op" id="3600680">&amp;</span><span class="ident" id="3600681">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3600688">}</span><br>
<span class="lineno">65</span><span class="op" id="3600690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3600693">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3600754">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3600822">func</span>&nbsp;<span class="ident" id="3600827">ConstantTimeLessOrEq</span><span class="op" id="3600847">(</span><span class="ident" id="3600848">x</span><span class="op" id="3600849">,</span>&nbsp;<span class="ident" id="3600851">y</span>&nbsp;<span class="builtintype" id="3600853">int</span><span class="op" id="3600856">)</span>&nbsp;<span class="builtintype" id="3600858">int</span>&nbsp;<span class="op" id="3600862">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600865">x32</span>&nbsp;<span class="op" id="3600869">:=</span>&nbsp;<span class="builtintype" id="3600872">int32</span><span class="op" id="3600877">(</span><span class="ident" id="3600878">x</span><span class="op" id="3600879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3600882">y32</span>&nbsp;<span class="op" id="3600886">:=</span>&nbsp;<span class="builtintype" id="3600889">int32</span><span class="op" id="3600894">(</span><span class="ident" id="3600895">y</span><span class="op" id="3600896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3600899">return</span>&nbsp;<span class="builtintype" id="3600906">int</span><span class="op" id="3600909">(</span><span class="op" id="3600910">(</span><span class="op" id="3600911">(</span><span class="ident" id="3600912">x32</span>&nbsp;<span class="op" id="3600916">-</span>&nbsp;<span class="ident" id="3600918">y32</span>&nbsp;<span class="op" id="3600922">-</span>&nbsp;<span class="num" id="3600924">1</span><span class="op" id="3600925">)</span>&nbsp;<span class="op" id="3600927">&gt;&gt;</span>&nbsp;<span class="num" id="3600930">31</span><span class="op" id="3600932">)</span>&nbsp;<span class="op" id="3600934">&amp;</span>&nbsp;<span class="num" id="3600936">1</span><span class="op" id="3600937">)</span><br>
<span class="lineno"></span><span class="op" id="3600939">}</span>
</div>
</body>
</html>
