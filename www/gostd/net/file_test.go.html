<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html" class="current">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6673061">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6673116">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6673170">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6673221">package</span>&nbsp;<span class="ident" id="6673229">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673234">import</span>&nbsp;<span class="op" id="6673241">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673244">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673250">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673261">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6673272">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6673282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673285">type</span>&nbsp;<span class="ident" id="6673290">listenerFile</span>&nbsp;<span class="keyword" id="6673303">interface</span>&nbsp;<span class="op" id="6673313">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673316">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673326">File</span><span class="op" id="6673330">(</span><span class="op" id="6673331">)</span>&nbsp;<span class="op" id="6673333">(</span><span class="ident" id="6673334">f</span>&nbsp;<span class="op" id="6673336">*</span><span class="ident" id="6673337">os</span><span class="op" id="6673339">.</span><span class="ident" id="6673340">File</span><span class="op" id="6673344">,</span>&nbsp;<span class="ident" id="6673346">err</span>&nbsp;<span class="builtintype" id="6673350">error</span><span class="op" id="6673355">)</span><br>
<span class="lineno"></span><span class="op" id="6673357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673360">type</span>&nbsp;<span class="ident" id="6673365">packetConnFile</span>&nbsp;<span class="keyword" id="6673380">interface</span>&nbsp;<span class="op" id="6673390">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673393">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673405">File</span><span class="op" id="6673409">(</span><span class="op" id="6673410">)</span>&nbsp;<span class="op" id="6673412">(</span><span class="ident" id="6673413">f</span>&nbsp;<span class="op" id="6673415">*</span><span class="ident" id="6673416">os</span><span class="op" id="6673418">.</span><span class="ident" id="6673419">File</span><span class="op" id="6673423">,</span>&nbsp;<span class="ident" id="6673425">err</span>&nbsp;<span class="builtintype" id="6673429">error</span><span class="op" id="6673434">)</span><br>
<span class="lineno"></span><span class="op" id="6673436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673439">type</span>&nbsp;<span class="ident" id="6673444">connFile</span>&nbsp;<span class="keyword" id="6673453">interface</span>&nbsp;<span class="op" id="6673463">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673466">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673472">File</span><span class="op" id="6673476">(</span><span class="op" id="6673477">)</span>&nbsp;<span class="op" id="6673479">(</span><span class="ident" id="6673480">f</span>&nbsp;<span class="op" id="6673482">*</span><span class="ident" id="6673483">os</span><span class="op" id="6673485">.</span><span class="ident" id="6673486">File</span><span class="op" id="6673490">,</span>&nbsp;<span class="ident" id="6673492">err</span>&nbsp;<span class="builtintype" id="6673496">error</span><span class="op" id="6673501">)</span><br>
<span class="lineno"></span><span class="op" id="6673503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673506">func</span>&nbsp;<span class="ident" id="6673511">testFileListener</span><span class="op" id="6673527">(</span><span class="ident" id="6673528">t</span>&nbsp;<span class="op" id="6673530">*</span><span class="ident" id="6673531">testing</span><span class="op" id="6673538">.</span><span class="ident" id="6673539">T</span><span class="op" id="6673540">,</span>&nbsp;<span class="ident" id="6673542">net</span><span class="op" id="6673545">,</span>&nbsp;<span class="ident" id="6673547">laddr</span>&nbsp;<span class="builtintype" id="6673553">string</span><span class="op" id="6673559">)</span>&nbsp;<span class="op" id="6673561">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673564">switch</span>&nbsp;<span class="ident" id="6673571">net</span>&nbsp;<span class="op" id="6673575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673578">case</span>&nbsp;<span class="string" id="6673583">&#34;tcp&#34;</span><span class="op" id="6673588">,</span>&nbsp;<span class="string" id="6673590">&#34;tcp4&#34;</span><span class="op" id="6673596">,</span>&nbsp;<span class="string" id="6673598">&#34;tcp6&#34;</span><span class="op" id="6673604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673608">laddr</span>&nbsp;<span class="op" id="6673614">+=</span>&nbsp;<span class="string" id="6673617">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6673622">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673648">l</span><span class="op" id="6673649">,</span>&nbsp;<span class="ident" id="6673651">err</span>&nbsp;<span class="op" id="6673655">:=</span>&nbsp;<span class="ident" id="6673658">Listen</span><span class="op" id="6673664">(</span><span class="ident" id="6673665">net</span><span class="op" id="6673668">,</span>&nbsp;<span class="ident" id="6673670">laddr</span><span class="op" id="6673675">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673678">if</span>&nbsp;<span class="ident" id="6673681">err</span>&nbsp;<span class="op" id="6673685">!=</span>&nbsp;<span class="builtintype" id="6673688">nil</span>&nbsp;<span class="op" id="6673692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673696">t</span><span class="op" id="6673697">.</span><span class="ident" id="6673698">Fatalf</span><span class="op" id="6673704">(</span><span class="string" id="6673705">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6673724">,</span>&nbsp;<span class="ident" id="6673726">err</span><span class="op" id="6673729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673735">defer</span>&nbsp;<span class="ident" id="6673741">l</span><span class="op" id="6673742">.</span><span class="ident" id="6673743">Close</span><span class="op" id="6673748">(</span><span class="op" id="6673749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673752">lf</span>&nbsp;<span class="op" id="6673755">:=</span>&nbsp;<span class="ident" id="6673758">l</span><span class="op" id="6673759">.</span><span class="op" id="6673760">(</span><span class="ident" id="6673761">listenerFile</span><span class="op" id="6673773">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673776">f</span><span class="op" id="6673777">,</span>&nbsp;<span class="ident" id="6673779">err</span>&nbsp;<span class="op" id="6673783">:=</span>&nbsp;<span class="ident" id="6673786">lf</span><span class="op" id="6673788">.</span><span class="ident" id="6673789">File</span><span class="op" id="6673793">(</span><span class="op" id="6673794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673797">if</span>&nbsp;<span class="ident" id="6673800">err</span>&nbsp;<span class="op" id="6673804">!=</span>&nbsp;<span class="builtintype" id="6673807">nil</span>&nbsp;<span class="op" id="6673811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673815">t</span><span class="op" id="6673816">.</span><span class="ident" id="6673817">Fatalf</span><span class="op" id="6673823">(</span><span class="string" id="6673824">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6673841">,</span>&nbsp;<span class="ident" id="6673843">err</span><span class="op" id="6673846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673852">c</span><span class="op" id="6673853">,</span>&nbsp;<span class="ident" id="6673855">err</span>&nbsp;<span class="op" id="6673859">:=</span>&nbsp;<span class="ident" id="6673862">FileListener</span><span class="op" id="6673874">(</span><span class="ident" id="6673875">f</span><span class="op" id="6673876">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673879">if</span>&nbsp;<span class="ident" id="6673882">err</span>&nbsp;<span class="op" id="6673886">!=</span>&nbsp;<span class="builtintype" id="6673889">nil</span>&nbsp;<span class="op" id="6673893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673897">t</span><span class="op" id="6673898">.</span><span class="ident" id="6673899">Fatalf</span><span class="op" id="6673905">(</span><span class="string" id="6673906">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6673931">,</span>&nbsp;<span class="ident" id="6673933">err</span><span class="op" id="6673936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6673939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6673942">if</span>&nbsp;<span class="op" id="6673945">!</span><span class="ident" id="6673946">reflect</span><span class="op" id="6673953">.</span><span class="ident" id="6673954">DeepEqual</span><span class="op" id="6673963">(</span><span class="ident" id="6673964">l</span><span class="op" id="6673965">.</span><span class="ident" id="6673966">Addr</span><span class="op" id="6673970">(</span><span class="op" id="6673971">)</span><span class="op" id="6673972">,</span>&nbsp;<span class="ident" id="6673974">c</span><span class="op" id="6673975">.</span><span class="ident" id="6673976">Addr</span><span class="op" id="6673980">(</span><span class="op" id="6673981">)</span><span class="op" id="6673982">)</span>&nbsp;<span class="op" id="6673984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6673988">t</span><span class="op" id="6673989">.</span><span class="ident" id="6673990">Fatalf</span><span class="op" id="6673996">(</span><span class="string" id="6673997">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6674026">,</span>&nbsp;<span class="ident" id="6674028">l</span><span class="op" id="6674029">.</span><span class="ident" id="6674030">Addr</span><span class="op" id="6674034">(</span><span class="op" id="6674035">)</span><span class="op" id="6674036">,</span>&nbsp;<span class="ident" id="6674038">c</span><span class="op" id="6674039">.</span><span class="ident" id="6674040">Addr</span><span class="op" id="6674044">(</span><span class="op" id="6674045">)</span><span class="op" id="6674046">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6674052">if</span>&nbsp;<span class="ident" id="6674055">err</span>&nbsp;<span class="op" id="6674059">:=</span>&nbsp;<span class="ident" id="6674062">c</span><span class="op" id="6674063">.</span><span class="ident" id="6674064">Close</span><span class="op" id="6674069">(</span><span class="op" id="6674070">)</span><span class="op" id="6674071">;</span>&nbsp;<span class="ident" id="6674073">err</span>&nbsp;<span class="op" id="6674077">!=</span>&nbsp;<span class="builtintype" id="6674080">nil</span>&nbsp;<span class="op" id="6674084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674088">t</span><span class="op" id="6674089">.</span><span class="ident" id="6674090">Fatalf</span><span class="op" id="6674096">(</span><span class="string" id="6674097">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6674115">,</span>&nbsp;<span class="ident" id="6674117">err</span><span class="op" id="6674120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6674126">if</span>&nbsp;<span class="ident" id="6674129">err</span>&nbsp;<span class="op" id="6674133">:=</span>&nbsp;<span class="ident" id="6674136">f</span><span class="op" id="6674137">.</span><span class="ident" id="6674138">Close</span><span class="op" id="6674143">(</span><span class="op" id="6674144">)</span><span class="op" id="6674145">;</span>&nbsp;<span class="ident" id="6674147">err</span>&nbsp;<span class="op" id="6674151">!=</span>&nbsp;<span class="builtintype" id="6674154">nil</span>&nbsp;<span class="op" id="6674158">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674162">t</span><span class="op" id="6674163">.</span><span class="ident" id="6674164">Fatalf</span><span class="op" id="6674170">(</span><span class="string" id="6674171">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6674189">,</span>&nbsp;<span class="ident" id="6674191">err</span><span class="op" id="6674194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674197">}</span><br>
<span class="lineno"></span><span class="op" id="6674199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6674202">var</span>&nbsp;<span class="ident" id="6674206">fileListenerTests</span>&nbsp;<span class="op" id="6674224">=</span>&nbsp;<span class="op" id="6674226">[</span><span class="op" id="6674227">]</span><span class="keyword" id="6674228">struct</span>&nbsp;<span class="op" id="6674235">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674238">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6674244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674252">laddr</span>&nbsp;<span class="builtintype" id="6674258">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674266">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6674272">bool</span>&nbsp;<span class="comment" id="6674277">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6674318">linux</span>&nbsp;<span class="builtintype" id="6674324">bool</span>&nbsp;<span class="comment" id="6674329">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6674383">}</span><span class="op" id="6674384">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674387">{</span><span class="ident" id="6674388">net</span><span class="op" id="6674391">:</span>&nbsp;<span class="string" id="6674393">&#34;tcp&#34;</span><span class="op" id="6674398">,</span>&nbsp;<span class="ident" id="6674400">laddr</span><span class="op" id="6674405">:</span>&nbsp;<span class="string" id="6674407">&#34;&#34;</span><span class="op" id="6674409">}</span><span class="op" id="6674410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674413">{</span><span class="ident" id="6674414">net</span><span class="op" id="6674417">:</span>&nbsp;<span class="string" id="6674419">&#34;tcp&#34;</span><span class="op" id="6674424">,</span>&nbsp;<span class="ident" id="6674426">laddr</span><span class="op" id="6674431">:</span>&nbsp;<span class="string" id="6674433">&#34;0.0.0.0&#34;</span><span class="op" id="6674442">}</span><span class="op" id="6674443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674446">{</span><span class="ident" id="6674447">net</span><span class="op" id="6674450">:</span>&nbsp;<span class="string" id="6674452">&#34;tcp&#34;</span><span class="op" id="6674457">,</span>&nbsp;<span class="ident" id="6674459">laddr</span><span class="op" id="6674464">:</span>&nbsp;<span class="string" id="6674466">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6674484">}</span><span class="op" id="6674485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674488">{</span><span class="ident" id="6674489">net</span><span class="op" id="6674492">:</span>&nbsp;<span class="string" id="6674494">&#34;tcp&#34;</span><span class="op" id="6674499">,</span>&nbsp;<span class="ident" id="6674501">laddr</span><span class="op" id="6674506">:</span>&nbsp;<span class="string" id="6674508">&#34;[::]&#34;</span><span class="op" id="6674514">,</span>&nbsp;<span class="ident" id="6674516">ipv6</span><span class="op" id="6674520">:</span>&nbsp;<span class="builtintype" id="6674522">true</span><span class="op" id="6674526">}</span><span class="op" id="6674527">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674531">{</span><span class="ident" id="6674532">net</span><span class="op" id="6674535">:</span>&nbsp;<span class="string" id="6674537">&#34;tcp&#34;</span><span class="op" id="6674542">,</span>&nbsp;<span class="ident" id="6674544">laddr</span><span class="op" id="6674549">:</span>&nbsp;<span class="string" id="6674551">&#34;127.0.0.1&#34;</span><span class="op" id="6674562">}</span><span class="op" id="6674563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674566">{</span><span class="ident" id="6674567">net</span><span class="op" id="6674570">:</span>&nbsp;<span class="string" id="6674572">&#34;tcp&#34;</span><span class="op" id="6674577">,</span>&nbsp;<span class="ident" id="6674579">laddr</span><span class="op" id="6674584">:</span>&nbsp;<span class="string" id="6674586">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6674606">}</span><span class="op" id="6674607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674610">{</span><span class="ident" id="6674611">net</span><span class="op" id="6674614">:</span>&nbsp;<span class="string" id="6674616">&#34;tcp&#34;</span><span class="op" id="6674621">,</span>&nbsp;<span class="ident" id="6674623">laddr</span><span class="op" id="6674628">:</span>&nbsp;<span class="string" id="6674630">&#34;[::1]&#34;</span><span class="op" id="6674637">,</span>&nbsp;<span class="ident" id="6674639">ipv6</span><span class="op" id="6674643">:</span>&nbsp;<span class="builtintype" id="6674645">true</span><span class="op" id="6674649">}</span><span class="op" id="6674650">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674654">{</span><span class="ident" id="6674655">net</span><span class="op" id="6674658">:</span>&nbsp;<span class="string" id="6674660">&#34;tcp4&#34;</span><span class="op" id="6674666">,</span>&nbsp;<span class="ident" id="6674668">laddr</span><span class="op" id="6674673">:</span>&nbsp;<span class="string" id="6674675">&#34;&#34;</span><span class="op" id="6674677">}</span><span class="op" id="6674678">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674681">{</span><span class="ident" id="6674682">net</span><span class="op" id="6674685">:</span>&nbsp;<span class="string" id="6674687">&#34;tcp4&#34;</span><span class="op" id="6674693">,</span>&nbsp;<span class="ident" id="6674695">laddr</span><span class="op" id="6674700">:</span>&nbsp;<span class="string" id="6674702">&#34;0.0.0.0&#34;</span><span class="op" id="6674711">}</span><span class="op" id="6674712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674715">{</span><span class="ident" id="6674716">net</span><span class="op" id="6674719">:</span>&nbsp;<span class="string" id="6674721">&#34;tcp4&#34;</span><span class="op" id="6674727">,</span>&nbsp;<span class="ident" id="6674729">laddr</span><span class="op" id="6674734">:</span>&nbsp;<span class="string" id="6674736">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6674754">}</span><span class="op" id="6674755">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674759">{</span><span class="ident" id="6674760">net</span><span class="op" id="6674763">:</span>&nbsp;<span class="string" id="6674765">&#34;tcp4&#34;</span><span class="op" id="6674771">,</span>&nbsp;<span class="ident" id="6674773">laddr</span><span class="op" id="6674778">:</span>&nbsp;<span class="string" id="6674780">&#34;127.0.0.1&#34;</span><span class="op" id="6674791">}</span><span class="op" id="6674792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674795">{</span><span class="ident" id="6674796">net</span><span class="op" id="6674799">:</span>&nbsp;<span class="string" id="6674801">&#34;tcp4&#34;</span><span class="op" id="6674807">,</span>&nbsp;<span class="ident" id="6674809">laddr</span><span class="op" id="6674814">:</span>&nbsp;<span class="string" id="6674816">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6674836">}</span><span class="op" id="6674837">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674841">{</span><span class="ident" id="6674842">net</span><span class="op" id="6674845">:</span>&nbsp;<span class="string" id="6674847">&#34;tcp6&#34;</span><span class="op" id="6674853">,</span>&nbsp;<span class="ident" id="6674855">laddr</span><span class="op" id="6674860">:</span>&nbsp;<span class="string" id="6674862">&#34;&#34;</span><span class="op" id="6674864">,</span>&nbsp;<span class="ident" id="6674866">ipv6</span><span class="op" id="6674870">:</span>&nbsp;<span class="builtintype" id="6674872">true</span><span class="op" id="6674876">}</span><span class="op" id="6674877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674880">{</span><span class="ident" id="6674881">net</span><span class="op" id="6674884">:</span>&nbsp;<span class="string" id="6674886">&#34;tcp6&#34;</span><span class="op" id="6674892">,</span>&nbsp;<span class="ident" id="6674894">laddr</span><span class="op" id="6674899">:</span>&nbsp;<span class="string" id="6674901">&#34;[::]&#34;</span><span class="op" id="6674907">,</span>&nbsp;<span class="ident" id="6674909">ipv6</span><span class="op" id="6674913">:</span>&nbsp;<span class="builtintype" id="6674915">true</span><span class="op" id="6674919">}</span><span class="op" id="6674920">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674924">{</span><span class="ident" id="6674925">net</span><span class="op" id="6674928">:</span>&nbsp;<span class="string" id="6674930">&#34;tcp6&#34;</span><span class="op" id="6674936">,</span>&nbsp;<span class="ident" id="6674938">laddr</span><span class="op" id="6674943">:</span>&nbsp;<span class="string" id="6674945">&#34;[::1]&#34;</span><span class="op" id="6674952">,</span>&nbsp;<span class="ident" id="6674954">ipv6</span><span class="op" id="6674958">:</span>&nbsp;<span class="builtintype" id="6674960">true</span><span class="op" id="6674964">}</span><span class="op" id="6674965">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6674969">{</span><span class="ident" id="6674970">net</span><span class="op" id="6674973">:</span>&nbsp;<span class="string" id="6674975">&#34;unix&#34;</span><span class="op" id="6674981">,</span>&nbsp;<span class="ident" id="6674983">laddr</span><span class="op" id="6674988">:</span>&nbsp;<span class="string" id="6674990">&#34;@gotest/net&#34;</span><span class="op" id="6675003">,</span>&nbsp;<span class="ident" id="6675005">linux</span><span class="op" id="6675010">:</span>&nbsp;<span class="builtintype" id="6675012">true</span><span class="op" id="6675016">}</span><span class="op" id="6675017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675020">{</span><span class="ident" id="6675021">net</span><span class="op" id="6675024">:</span>&nbsp;<span class="string" id="6675026">&#34;unixpacket&#34;</span><span class="op" id="6675038">,</span>&nbsp;<span class="ident" id="6675040">laddr</span><span class="op" id="6675045">:</span>&nbsp;<span class="string" id="6675047">&#34;@gotest/net&#34;</span><span class="op" id="6675060">,</span>&nbsp;<span class="ident" id="6675062">linux</span><span class="op" id="6675067">:</span>&nbsp;<span class="builtintype" id="6675069">true</span><span class="op" id="6675073">}</span><span class="op" id="6675074">,</span><br>
<span class="lineno"></span><span class="op" id="6675076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6675079">func</span>&nbsp;<span class="ident" id="6675084">TestFileListener</span><span class="op" id="6675100">(</span><span class="ident" id="6675101">t</span>&nbsp;<span class="op" id="6675103">*</span><span class="ident" id="6675104">testing</span><span class="op" id="6675111">.</span><span class="ident" id="6675112">T</span><span class="op" id="6675113">)</span>&nbsp;<span class="op" id="6675115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675118">switch</span>&nbsp;<span class="ident" id="6675125">runtime</span><span class="op" id="6675132">.</span><span class="ident" id="6675133">GOOS</span>&nbsp;<span class="op" id="6675138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675141">case</span>&nbsp;<span class="string" id="6675146">&#34;nacl&#34;</span><span class="op" id="6675152">,</span>&nbsp;<span class="string" id="6675154">&#34;windows&#34;</span><span class="op" id="6675163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675167">t</span><span class="op" id="6675168">.</span><span class="ident" id="6675169">Skipf</span><span class="op" id="6675174">(</span><span class="string" id="6675175">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6675196">,</span>&nbsp;<span class="ident" id="6675198">runtime</span><span class="op" id="6675205">.</span><span class="ident" id="6675206">GOOS</span><span class="op" id="6675210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675213">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675217">for</span>&nbsp;<span class="ident" id="6675221">_</span><span class="op" id="6675222">,</span>&nbsp;<span class="ident" id="6675224">tt</span>&nbsp;<span class="op" id="6675227">:=</span>&nbsp;<span class="keyword" id="6675230">range</span>&nbsp;<span class="ident" id="6675236">fileListenerTests</span>&nbsp;<span class="op" id="6675254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675258">if</span>&nbsp;<span class="ident" id="6675261">skipServerTest</span><span class="op" id="6675275">(</span><span class="ident" id="6675276">tt</span><span class="op" id="6675278">.</span><span class="ident" id="6675279">net</span><span class="op" id="6675282">,</span>&nbsp;<span class="string" id="6675284">&#34;unix&#34;</span><span class="op" id="6675290">,</span>&nbsp;<span class="ident" id="6675292">tt</span><span class="op" id="6675294">.</span><span class="ident" id="6675295">laddr</span><span class="op" id="6675300">,</span>&nbsp;<span class="ident" id="6675302">tt</span><span class="op" id="6675304">.</span><span class="ident" id="6675305">ipv6</span><span class="op" id="6675309">,</span>&nbsp;<span class="builtintype" id="6675311">false</span><span class="op" id="6675316">,</span>&nbsp;<span class="ident" id="6675318">tt</span><span class="op" id="6675320">.</span><span class="ident" id="6675321">linux</span><span class="op" id="6675326">)</span>&nbsp;<span class="op" id="6675328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675333">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675344">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675348">if</span>&nbsp;<span class="ident" id="6675351">skipServerTest</span><span class="op" id="6675365">(</span><span class="ident" id="6675366">tt</span><span class="op" id="6675368">.</span><span class="ident" id="6675369">net</span><span class="op" id="6675372">,</span>&nbsp;<span class="string" id="6675374">&#34;unixpacket&#34;</span><span class="op" id="6675386">,</span>&nbsp;<span class="ident" id="6675388">tt</span><span class="op" id="6675390">.</span><span class="ident" id="6675391">laddr</span><span class="op" id="6675396">,</span>&nbsp;<span class="ident" id="6675398">tt</span><span class="op" id="6675400">.</span><span class="ident" id="6675401">ipv6</span><span class="op" id="6675405">,</span>&nbsp;<span class="builtintype" id="6675407">false</span><span class="op" id="6675412">,</span>&nbsp;<span class="ident" id="6675414">tt</span><span class="op" id="6675416">.</span><span class="ident" id="6675417">linux</span><span class="op" id="6675422">)</span>&nbsp;<span class="op" id="6675424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675429">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675444">testFileListener</span><span class="op" id="6675460">(</span><span class="ident" id="6675461">t</span><span class="op" id="6675462">,</span>&nbsp;<span class="ident" id="6675464">tt</span><span class="op" id="6675466">.</span><span class="ident" id="6675467">net</span><span class="op" id="6675470">,</span>&nbsp;<span class="ident" id="6675472">tt</span><span class="op" id="6675474">.</span><span class="ident" id="6675475">laddr</span><span class="op" id="6675480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675483">}</span><br>
<span class="lineno">105</span><span class="op" id="6675485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6675488">func</span>&nbsp;<span class="ident" id="6675493">testFilePacketConn</span><span class="op" id="6675511">(</span><span class="ident" id="6675512">t</span>&nbsp;<span class="op" id="6675514">*</span><span class="ident" id="6675515">testing</span><span class="op" id="6675522">.</span><span class="ident" id="6675523">T</span><span class="op" id="6675524">,</span>&nbsp;<span class="ident" id="6675526">pcf</span>&nbsp;<span class="ident" id="6675530">packetConnFile</span><span class="op" id="6675544">,</span>&nbsp;<span class="ident" id="6675546">listen</span>&nbsp;<span class="builtintype" id="6675553">bool</span><span class="op" id="6675557">)</span>&nbsp;<span class="op" id="6675559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675562">f</span><span class="op" id="6675563">,</span>&nbsp;<span class="ident" id="6675565">err</span>&nbsp;<span class="op" id="6675569">:=</span>&nbsp;<span class="ident" id="6675572">pcf</span><span class="op" id="6675575">.</span><span class="ident" id="6675576">File</span><span class="op" id="6675580">(</span><span class="op" id="6675581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675584">if</span>&nbsp;<span class="ident" id="6675587">err</span>&nbsp;<span class="op" id="6675591">!=</span>&nbsp;<span class="builtintype" id="6675594">nil</span>&nbsp;<span class="op" id="6675598">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675602">t</span><span class="op" id="6675603">.</span><span class="ident" id="6675604">Fatalf</span><span class="op" id="6675610">(</span><span class="string" id="6675611">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675628">,</span>&nbsp;<span class="ident" id="6675630">err</span><span class="op" id="6675633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675639">c</span><span class="op" id="6675640">,</span>&nbsp;<span class="ident" id="6675642">err</span>&nbsp;<span class="op" id="6675646">:=</span>&nbsp;<span class="ident" id="6675649">FilePacketConn</span><span class="op" id="6675663">(</span><span class="ident" id="6675664">f</span><span class="op" id="6675665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675668">if</span>&nbsp;<span class="ident" id="6675671">err</span>&nbsp;<span class="op" id="6675675">!=</span>&nbsp;<span class="builtintype" id="6675678">nil</span>&nbsp;<span class="op" id="6675682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675686">t</span><span class="op" id="6675687">.</span><span class="ident" id="6675688">Fatalf</span><span class="op" id="6675694">(</span><span class="string" id="6675695">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675722">,</span>&nbsp;<span class="ident" id="6675724">err</span><span class="op" id="6675727">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675733">if</span>&nbsp;<span class="op" id="6675736">!</span><span class="ident" id="6675737">reflect</span><span class="op" id="6675744">.</span><span class="ident" id="6675745">DeepEqual</span><span class="op" id="6675754">(</span><span class="ident" id="6675755">pcf</span><span class="op" id="6675758">.</span><span class="ident" id="6675759">LocalAddr</span><span class="op" id="6675768">(</span><span class="op" id="6675769">)</span><span class="op" id="6675770">,</span>&nbsp;<span class="ident" id="6675772">c</span><span class="op" id="6675773">.</span><span class="ident" id="6675774">LocalAddr</span><span class="op" id="6675783">(</span><span class="op" id="6675784">)</span><span class="op" id="6675785">)</span>&nbsp;<span class="op" id="6675787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675791">t</span><span class="op" id="6675792">.</span><span class="ident" id="6675793">Fatalf</span><span class="op" id="6675799">(</span><span class="string" id="6675800">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6675834">,</span>&nbsp;<span class="ident" id="6675836">pcf</span><span class="op" id="6675839">.</span><span class="ident" id="6675840">LocalAddr</span><span class="op" id="6675849">(</span><span class="op" id="6675850">)</span><span class="op" id="6675851">,</span>&nbsp;<span class="ident" id="6675853">c</span><span class="op" id="6675854">.</span><span class="ident" id="6675855">LocalAddr</span><span class="op" id="6675864">(</span><span class="op" id="6675865">)</span><span class="op" id="6675866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675872">if</span>&nbsp;<span class="ident" id="6675875">listen</span>&nbsp;<span class="op" id="6675882">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675886">if</span>&nbsp;<span class="ident" id="6675889">_</span><span class="op" id="6675890">,</span>&nbsp;<span class="ident" id="6675892">err</span>&nbsp;<span class="op" id="6675896">:=</span>&nbsp;<span class="ident" id="6675899">c</span><span class="op" id="6675900">.</span><span class="ident" id="6675901">WriteTo</span><span class="op" id="6675908">(</span><span class="op" id="6675909">[</span><span class="op" id="6675910">]</span><span class="builtintype" id="6675911">byte</span><span class="op" id="6675915">{</span><span class="op" id="6675916">}</span><span class="op" id="6675917">,</span>&nbsp;<span class="ident" id="6675919">c</span><span class="op" id="6675920">.</span><span class="ident" id="6675921">LocalAddr</span><span class="op" id="6675930">(</span><span class="op" id="6675931">)</span><span class="op" id="6675932">)</span><span class="op" id="6675933">;</span>&nbsp;<span class="ident" id="6675935">err</span>&nbsp;<span class="op" id="6675939">!=</span>&nbsp;<span class="builtintype" id="6675942">nil</span>&nbsp;<span class="op" id="6675946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6675951">t</span><span class="op" id="6675952">.</span><span class="ident" id="6675953">Fatalf</span><span class="op" id="6675959">(</span><span class="string" id="6675960">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675980">,</span>&nbsp;<span class="ident" id="6675982">err</span><span class="op" id="6675985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6675995">if</span>&nbsp;<span class="ident" id="6675998">err</span>&nbsp;<span class="op" id="6676002">:=</span>&nbsp;<span class="ident" id="6676005">c</span><span class="op" id="6676006">.</span><span class="ident" id="6676007">Close</span><span class="op" id="6676012">(</span><span class="op" id="6676013">)</span><span class="op" id="6676014">;</span>&nbsp;<span class="ident" id="6676016">err</span>&nbsp;<span class="op" id="6676020">!=</span>&nbsp;<span class="builtintype" id="6676023">nil</span>&nbsp;<span class="op" id="6676027">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676031">t</span><span class="op" id="6676032">.</span><span class="ident" id="6676033">Fatalf</span><span class="op" id="6676039">(</span><span class="string" id="6676040">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676058">,</span>&nbsp;<span class="ident" id="6676060">err</span><span class="op" id="6676063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676069">if</span>&nbsp;<span class="ident" id="6676072">err</span>&nbsp;<span class="op" id="6676076">:=</span>&nbsp;<span class="ident" id="6676079">f</span><span class="op" id="6676080">.</span><span class="ident" id="6676081">Close</span><span class="op" id="6676086">(</span><span class="op" id="6676087">)</span><span class="op" id="6676088">;</span>&nbsp;<span class="ident" id="6676090">err</span>&nbsp;<span class="op" id="6676094">!=</span>&nbsp;<span class="builtintype" id="6676097">nil</span>&nbsp;<span class="op" id="6676101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676105">t</span><span class="op" id="6676106">.</span><span class="ident" id="6676107">Fatalf</span><span class="op" id="6676113">(</span><span class="string" id="6676114">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676132">,</span>&nbsp;<span class="ident" id="6676134">err</span><span class="op" id="6676137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676140">}</span><br>
<span class="lineno">130</span><span class="op" id="6676142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676145">func</span>&nbsp;<span class="ident" id="6676150">testFilePacketConnListen</span><span class="op" id="6676174">(</span><span class="ident" id="6676175">t</span>&nbsp;<span class="op" id="6676177">*</span><span class="ident" id="6676178">testing</span><span class="op" id="6676185">.</span><span class="ident" id="6676186">T</span><span class="op" id="6676187">,</span>&nbsp;<span class="ident" id="6676189">net</span><span class="op" id="6676192">,</span>&nbsp;<span class="ident" id="6676194">laddr</span>&nbsp;<span class="builtintype" id="6676200">string</span><span class="op" id="6676206">)</span>&nbsp;<span class="op" id="6676208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676211">switch</span>&nbsp;<span class="ident" id="6676218">net</span>&nbsp;<span class="op" id="6676222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676225">case</span>&nbsp;<span class="string" id="6676230">&#34;udp&#34;</span><span class="op" id="6676235">,</span>&nbsp;<span class="string" id="6676237">&#34;udp4&#34;</span><span class="op" id="6676243">,</span>&nbsp;<span class="string" id="6676245">&#34;udp6&#34;</span><span class="op" id="6676251">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676255">laddr</span>&nbsp;<span class="op" id="6676261">+=</span>&nbsp;<span class="string" id="6676264">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6676269">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676295">l</span><span class="op" id="6676296">,</span>&nbsp;<span class="ident" id="6676298">err</span>&nbsp;<span class="op" id="6676302">:=</span>&nbsp;<span class="ident" id="6676305">ListenPacket</span><span class="op" id="6676317">(</span><span class="ident" id="6676318">net</span><span class="op" id="6676321">,</span>&nbsp;<span class="ident" id="6676323">laddr</span><span class="op" id="6676328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676331">if</span>&nbsp;<span class="ident" id="6676334">err</span>&nbsp;<span class="op" id="6676338">!=</span>&nbsp;<span class="builtintype" id="6676341">nil</span>&nbsp;<span class="op" id="6676345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676349">t</span><span class="op" id="6676350">.</span><span class="ident" id="6676351">Fatalf</span><span class="op" id="6676357">(</span><span class="string" id="6676358">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676383">,</span>&nbsp;<span class="ident" id="6676385">err</span><span class="op" id="6676388">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676394">testFilePacketConn</span><span class="op" id="6676412">(</span><span class="ident" id="6676413">t</span><span class="op" id="6676414">,</span>&nbsp;<span class="ident" id="6676416">l</span><span class="op" id="6676417">.</span><span class="op" id="6676418">(</span><span class="ident" id="6676419">packetConnFile</span><span class="op" id="6676433">)</span><span class="op" id="6676434">,</span>&nbsp;<span class="builtintype" id="6676436">true</span><span class="op" id="6676440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676443">if</span>&nbsp;<span class="ident" id="6676446">err</span>&nbsp;<span class="op" id="6676450">:=</span>&nbsp;<span class="ident" id="6676453">l</span><span class="op" id="6676454">.</span><span class="ident" id="6676455">Close</span><span class="op" id="6676460">(</span><span class="op" id="6676461">)</span><span class="op" id="6676462">;</span>&nbsp;<span class="ident" id="6676464">err</span>&nbsp;<span class="op" id="6676468">!=</span>&nbsp;<span class="builtintype" id="6676471">nil</span>&nbsp;<span class="op" id="6676475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676479">t</span><span class="op" id="6676480">.</span><span class="ident" id="6676481">Fatalf</span><span class="op" id="6676487">(</span><span class="string" id="6676488">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676506">,</span>&nbsp;<span class="ident" id="6676508">err</span><span class="op" id="6676511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676514">}</span><br>
<span class="lineno">145</span><span class="op" id="6676516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676519">func</span>&nbsp;<span class="ident" id="6676524">testFilePacketConnDial</span><span class="op" id="6676546">(</span><span class="ident" id="6676547">t</span>&nbsp;<span class="op" id="6676549">*</span><span class="ident" id="6676550">testing</span><span class="op" id="6676557">.</span><span class="ident" id="6676558">T</span><span class="op" id="6676559">,</span>&nbsp;<span class="ident" id="6676561">net</span><span class="op" id="6676564">,</span>&nbsp;<span class="ident" id="6676566">raddr</span>&nbsp;<span class="builtintype" id="6676572">string</span><span class="op" id="6676578">)</span>&nbsp;<span class="op" id="6676580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676583">switch</span>&nbsp;<span class="ident" id="6676590">net</span>&nbsp;<span class="op" id="6676594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676597">case</span>&nbsp;<span class="string" id="6676602">&#34;udp&#34;</span><span class="op" id="6676607">,</span>&nbsp;<span class="string" id="6676609">&#34;udp4&#34;</span><span class="op" id="6676615">,</span>&nbsp;<span class="string" id="6676617">&#34;udp6&#34;</span><span class="op" id="6676623">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676627">raddr</span>&nbsp;<span class="op" id="6676633">+=</span>&nbsp;<span class="string" id="6676636">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676649">c</span><span class="op" id="6676650">,</span>&nbsp;<span class="ident" id="6676652">err</span>&nbsp;<span class="op" id="6676656">:=</span>&nbsp;<span class="ident" id="6676659">Dial</span><span class="op" id="6676663">(</span><span class="ident" id="6676664">net</span><span class="op" id="6676667">,</span>&nbsp;<span class="ident" id="6676669">raddr</span><span class="op" id="6676674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676677">if</span>&nbsp;<span class="ident" id="6676680">err</span>&nbsp;<span class="op" id="6676684">!=</span>&nbsp;<span class="builtintype" id="6676687">nil</span>&nbsp;<span class="op" id="6676691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676695">t</span><span class="op" id="6676696">.</span><span class="ident" id="6676697">Fatalf</span><span class="op" id="6676703">(</span><span class="string" id="6676704">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676721">,</span>&nbsp;<span class="ident" id="6676723">err</span><span class="op" id="6676726">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676732">testFilePacketConn</span><span class="op" id="6676750">(</span><span class="ident" id="6676751">t</span><span class="op" id="6676752">,</span>&nbsp;<span class="ident" id="6676754">c</span><span class="op" id="6676755">.</span><span class="op" id="6676756">(</span><span class="ident" id="6676757">packetConnFile</span><span class="op" id="6676771">)</span><span class="op" id="6676772">,</span>&nbsp;<span class="builtintype" id="6676774">false</span><span class="op" id="6676779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6676782">if</span>&nbsp;<span class="ident" id="6676785">err</span>&nbsp;<span class="op" id="6676789">:=</span>&nbsp;<span class="ident" id="6676792">c</span><span class="op" id="6676793">.</span><span class="ident" id="6676794">Close</span><span class="op" id="6676799">(</span><span class="op" id="6676800">)</span><span class="op" id="6676801">;</span>&nbsp;<span class="ident" id="6676803">err</span>&nbsp;<span class="op" id="6676807">!=</span>&nbsp;<span class="builtintype" id="6676810">nil</span>&nbsp;<span class="op" id="6676814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676818">t</span><span class="op" id="6676819">.</span><span class="ident" id="6676820">Fatalf</span><span class="op" id="6676826">(</span><span class="string" id="6676827">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676845">,</span>&nbsp;<span class="ident" id="6676847">err</span><span class="op" id="6676850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6676853">}</span><br>
<span class="lineno">160</span><span class="op" id="6676855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676858">var</span>&nbsp;<span class="ident" id="6676862">filePacketConnTests</span>&nbsp;<span class="op" id="6676882">=</span>&nbsp;<span class="op" id="6676884">[</span><span class="op" id="6676885">]</span><span class="keyword" id="6676886">struct</span>&nbsp;<span class="op" id="6676893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676896">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6676902">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676910">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6676916">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676924">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6676930">bool</span>&nbsp;<span class="comment" id="6676935">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6676976">linux</span>&nbsp;<span class="builtintype" id="6676982">bool</span>&nbsp;<span class="comment" id="6676987">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6677041">}</span><span class="op" id="6677042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677045">{</span><span class="ident" id="6677046">net</span><span class="op" id="6677049">:</span>&nbsp;<span class="string" id="6677051">&#34;udp&#34;</span><span class="op" id="6677056">,</span>&nbsp;<span class="ident" id="6677058">addr</span><span class="op" id="6677062">:</span>&nbsp;<span class="string" id="6677064">&#34;127.0.0.1&#34;</span><span class="op" id="6677075">}</span><span class="op" id="6677076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677079">{</span><span class="ident" id="6677080">net</span><span class="op" id="6677083">:</span>&nbsp;<span class="string" id="6677085">&#34;udp&#34;</span><span class="op" id="6677090">,</span>&nbsp;<span class="ident" id="6677092">addr</span><span class="op" id="6677096">:</span>&nbsp;<span class="string" id="6677098">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6677118">}</span><span class="op" id="6677119">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677122">{</span><span class="ident" id="6677123">net</span><span class="op" id="6677126">:</span>&nbsp;<span class="string" id="6677128">&#34;udp&#34;</span><span class="op" id="6677133">,</span>&nbsp;<span class="ident" id="6677135">addr</span><span class="op" id="6677139">:</span>&nbsp;<span class="string" id="6677141">&#34;[::1]&#34;</span><span class="op" id="6677148">,</span>&nbsp;<span class="ident" id="6677150">ipv6</span><span class="op" id="6677154">:</span>&nbsp;<span class="builtintype" id="6677156">true</span><span class="op" id="6677160">}</span><span class="op" id="6677161">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677165">{</span><span class="ident" id="6677166">net</span><span class="op" id="6677169">:</span>&nbsp;<span class="string" id="6677171">&#34;udp4&#34;</span><span class="op" id="6677177">,</span>&nbsp;<span class="ident" id="6677179">addr</span><span class="op" id="6677183">:</span>&nbsp;<span class="string" id="6677185">&#34;127.0.0.1&#34;</span><span class="op" id="6677196">}</span><span class="op" id="6677197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677200">{</span><span class="ident" id="6677201">net</span><span class="op" id="6677204">:</span>&nbsp;<span class="string" id="6677206">&#34;udp4&#34;</span><span class="op" id="6677212">,</span>&nbsp;<span class="ident" id="6677214">addr</span><span class="op" id="6677218">:</span>&nbsp;<span class="string" id="6677220">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6677240">}</span><span class="op" id="6677241">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677245">{</span><span class="ident" id="6677246">net</span><span class="op" id="6677249">:</span>&nbsp;<span class="string" id="6677251">&#34;udp6&#34;</span><span class="op" id="6677257">,</span>&nbsp;<span class="ident" id="6677259">addr</span><span class="op" id="6677263">:</span>&nbsp;<span class="string" id="6677265">&#34;[::1]&#34;</span><span class="op" id="6677272">,</span>&nbsp;<span class="ident" id="6677274">ipv6</span><span class="op" id="6677278">:</span>&nbsp;<span class="builtintype" id="6677280">true</span><span class="op" id="6677284">}</span><span class="op" id="6677285">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677289">{</span><span class="ident" id="6677290">net</span><span class="op" id="6677293">:</span>&nbsp;<span class="string" id="6677295">&#34;ip4:icmp&#34;</span><span class="op" id="6677305">,</span>&nbsp;<span class="ident" id="6677307">addr</span><span class="op" id="6677311">:</span>&nbsp;<span class="string" id="6677313">&#34;127.0.0.1&#34;</span><span class="op" id="6677324">}</span><span class="op" id="6677325">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677329">{</span><span class="ident" id="6677330">net</span><span class="op" id="6677333">:</span>&nbsp;<span class="string" id="6677335">&#34;unixgram&#34;</span><span class="op" id="6677345">,</span>&nbsp;<span class="ident" id="6677347">addr</span><span class="op" id="6677351">:</span>&nbsp;<span class="string" id="6677353">&#34;@gotest3/net&#34;</span><span class="op" id="6677367">,</span>&nbsp;<span class="ident" id="6677369">linux</span><span class="op" id="6677374">:</span>&nbsp;<span class="builtintype" id="6677376">true</span><span class="op" id="6677380">}</span><span class="op" id="6677381">,</span><br>
<span class="lineno">180</span><span class="op" id="6677383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6677386">func</span>&nbsp;<span class="ident" id="6677391">TestFilePacketConn</span><span class="op" id="6677409">(</span><span class="ident" id="6677410">t</span>&nbsp;<span class="op" id="6677412">*</span><span class="ident" id="6677413">testing</span><span class="op" id="6677420">.</span><span class="ident" id="6677421">T</span><span class="op" id="6677422">)</span>&nbsp;<span class="op" id="6677424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677427">switch</span>&nbsp;<span class="ident" id="6677434">runtime</span><span class="op" id="6677441">.</span><span class="ident" id="6677442">GOOS</span>&nbsp;<span class="op" id="6677447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677450">case</span>&nbsp;<span class="string" id="6677455">&#34;nacl&#34;</span><span class="op" id="6677461">,</span>&nbsp;<span class="string" id="6677463">&#34;plan9&#34;</span><span class="op" id="6677470">,</span>&nbsp;<span class="string" id="6677472">&#34;windows&#34;</span><span class="op" id="6677481">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6677485">t</span><span class="op" id="6677486">.</span><span class="ident" id="6677487">Skipf</span><span class="op" id="6677492">(</span><span class="string" id="6677493">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6677514">,</span>&nbsp;<span class="ident" id="6677516">runtime</span><span class="op" id="6677523">.</span><span class="ident" id="6677524">GOOS</span><span class="op" id="6677528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677535">for</span>&nbsp;<span class="ident" id="6677539">_</span><span class="op" id="6677540">,</span>&nbsp;<span class="ident" id="6677542">tt</span>&nbsp;<span class="op" id="6677545">:=</span>&nbsp;<span class="keyword" id="6677548">range</span>&nbsp;<span class="ident" id="6677554">filePacketConnTests</span>&nbsp;<span class="op" id="6677574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677578">if</span>&nbsp;<span class="ident" id="6677581">skipServerTest</span><span class="op" id="6677595">(</span><span class="ident" id="6677596">tt</span><span class="op" id="6677598">.</span><span class="ident" id="6677599">net</span><span class="op" id="6677602">,</span>&nbsp;<span class="string" id="6677604">&#34;unixgram&#34;</span><span class="op" id="6677614">,</span>&nbsp;<span class="ident" id="6677616">tt</span><span class="op" id="6677618">.</span><span class="ident" id="6677619">addr</span><span class="op" id="6677623">,</span>&nbsp;<span class="ident" id="6677625">tt</span><span class="op" id="6677627">.</span><span class="ident" id="6677628">ipv6</span><span class="op" id="6677632">,</span>&nbsp;<span class="builtintype" id="6677634">false</span><span class="op" id="6677639">,</span>&nbsp;<span class="ident" id="6677641">tt</span><span class="op" id="6677643">.</span><span class="ident" id="6677644">linux</span><span class="op" id="6677649">)</span>&nbsp;<span class="op" id="6677651">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677671">if</span>&nbsp;<span class="ident" id="6677674">os</span><span class="op" id="6677676">.</span><span class="ident" id="6677677">Getuid</span><span class="op" id="6677683">(</span><span class="op" id="6677684">)</span>&nbsp;<span class="op" id="6677686">!=</span>&nbsp;<span class="num" id="6677689">0</span>&nbsp;<span class="op" id="6677691">&amp;&amp;</span>&nbsp;<span class="ident" id="6677694">tt</span><span class="op" id="6677696">.</span><span class="ident" id="6677697">net</span>&nbsp;<span class="op" id="6677701">==</span>&nbsp;<span class="string" id="6677704">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="6677715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6677720">t</span><span class="op" id="6677721">.</span><span class="ident" id="6677722">Log</span><span class="op" id="6677725">(</span><span class="string" id="6677726">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6677755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677760">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6677775">testFilePacketConnListen</span><span class="op" id="6677799">(</span><span class="ident" id="6677800">t</span><span class="op" id="6677801">,</span>&nbsp;<span class="ident" id="6677803">tt</span><span class="op" id="6677805">.</span><span class="ident" id="6677806">net</span><span class="op" id="6677809">,</span>&nbsp;<span class="ident" id="6677811">tt</span><span class="op" id="6677813">.</span><span class="ident" id="6677814">addr</span><span class="op" id="6677818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677822">switch</span>&nbsp;<span class="ident" id="6677829">tt</span><span class="op" id="6677831">.</span><span class="ident" id="6677832">addr</span>&nbsp;<span class="op" id="6677837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677841">case</span>&nbsp;<span class="string" id="6677846">&#34;&#34;</span><span class="op" id="6677848">,</span>&nbsp;<span class="string" id="6677850">&#34;0.0.0.0&#34;</span><span class="op" id="6677859">,</span>&nbsp;<span class="string" id="6677861">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6677879">,</span>&nbsp;<span class="string" id="6677881">&#34;[::]&#34;</span><span class="op" id="6677887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677891">default</span><span class="op" id="6677898">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6677903">if</span>&nbsp;<span class="ident" id="6677906">tt</span><span class="op" id="6677908">.</span><span class="ident" id="6677909">net</span>&nbsp;<span class="op" id="6677913">!=</span>&nbsp;<span class="string" id="6677916">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="6677927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6677933">testFilePacketConnDial</span><span class="op" id="6677955">(</span><span class="ident" id="6677956">t</span><span class="op" id="6677957">,</span>&nbsp;<span class="ident" id="6677959">tt</span><span class="op" id="6677961">.</span><span class="ident" id="6677962">net</span><span class="op" id="6677965">,</span>&nbsp;<span class="ident" id="6677967">tt</span><span class="op" id="6677969">.</span><span class="ident" id="6677970">addr</span><span class="op" id="6677974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6677986">}</span><br>
<span class="lineno">205</span><span class="op" id="6677988">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
