<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8321101">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8321156">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8321210">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8321261">package</span>&nbsp;<span class="ident" id="8321269">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8321275">import</span>&nbsp;<span class="op" id="8321282">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321285">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321294">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321301">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321310">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321325">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321338">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321351">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321364">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8321370">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8321380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8321383">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="8321462">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="8321541">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="8321566">var</span>&nbsp;<span class="ident" id="8321570">zigzag</span>&nbsp;<span class="op" id="8321577">=</span>&nbsp;<span class="op" id="8321579">[</span><span class="ident" id="8321580">blockSize</span><span class="op" id="8321589">]</span><span class="builtintype" id="8321590">int</span><span class="op" id="8321593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321596">0</span><span class="op" id="8321597">,</span>&nbsp;<span class="num" id="8321599">1</span><span class="op" id="8321600">,</span>&nbsp;<span class="num" id="8321602">5</span><span class="op" id="8321603">,</span>&nbsp;<span class="num" id="8321605">6</span><span class="op" id="8321606">,</span>&nbsp;<span class="num" id="8321608">14</span><span class="op" id="8321610">,</span>&nbsp;<span class="num" id="8321612">15</span><span class="op" id="8321614">,</span>&nbsp;<span class="num" id="8321616">27</span><span class="op" id="8321618">,</span>&nbsp;<span class="num" id="8321620">28</span><span class="op" id="8321622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321625">2</span><span class="op" id="8321626">,</span>&nbsp;<span class="num" id="8321628">4</span><span class="op" id="8321629">,</span>&nbsp;<span class="num" id="8321631">7</span><span class="op" id="8321632">,</span>&nbsp;<span class="num" id="8321634">13</span><span class="op" id="8321636">,</span>&nbsp;<span class="num" id="8321638">16</span><span class="op" id="8321640">,</span>&nbsp;<span class="num" id="8321642">26</span><span class="op" id="8321644">,</span>&nbsp;<span class="num" id="8321646">29</span><span class="op" id="8321648">,</span>&nbsp;<span class="num" id="8321650">42</span><span class="op" id="8321652">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321655">3</span><span class="op" id="8321656">,</span>&nbsp;<span class="num" id="8321658">8</span><span class="op" id="8321659">,</span>&nbsp;<span class="num" id="8321661">12</span><span class="op" id="8321663">,</span>&nbsp;<span class="num" id="8321665">17</span><span class="op" id="8321667">,</span>&nbsp;<span class="num" id="8321669">25</span><span class="op" id="8321671">,</span>&nbsp;<span class="num" id="8321673">30</span><span class="op" id="8321675">,</span>&nbsp;<span class="num" id="8321677">41</span><span class="op" id="8321679">,</span>&nbsp;<span class="num" id="8321681">43</span><span class="op" id="8321683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321686">9</span><span class="op" id="8321687">,</span>&nbsp;<span class="num" id="8321689">11</span><span class="op" id="8321691">,</span>&nbsp;<span class="num" id="8321693">18</span><span class="op" id="8321695">,</span>&nbsp;<span class="num" id="8321697">24</span><span class="op" id="8321699">,</span>&nbsp;<span class="num" id="8321701">31</span><span class="op" id="8321703">,</span>&nbsp;<span class="num" id="8321705">40</span><span class="op" id="8321707">,</span>&nbsp;<span class="num" id="8321709">44</span><span class="op" id="8321711">,</span>&nbsp;<span class="num" id="8321713">53</span><span class="op" id="8321715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321718">10</span><span class="op" id="8321720">,</span>&nbsp;<span class="num" id="8321722">19</span><span class="op" id="8321724">,</span>&nbsp;<span class="num" id="8321726">23</span><span class="op" id="8321728">,</span>&nbsp;<span class="num" id="8321730">32</span><span class="op" id="8321732">,</span>&nbsp;<span class="num" id="8321734">39</span><span class="op" id="8321736">,</span>&nbsp;<span class="num" id="8321738">45</span><span class="op" id="8321740">,</span>&nbsp;<span class="num" id="8321742">52</span><span class="op" id="8321744">,</span>&nbsp;<span class="num" id="8321746">54</span><span class="op" id="8321748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321751">20</span><span class="op" id="8321753">,</span>&nbsp;<span class="num" id="8321755">22</span><span class="op" id="8321757">,</span>&nbsp;<span class="num" id="8321759">33</span><span class="op" id="8321761">,</span>&nbsp;<span class="num" id="8321763">38</span><span class="op" id="8321765">,</span>&nbsp;<span class="num" id="8321767">46</span><span class="op" id="8321769">,</span>&nbsp;<span class="num" id="8321771">51</span><span class="op" id="8321773">,</span>&nbsp;<span class="num" id="8321775">55</span><span class="op" id="8321777">,</span>&nbsp;<span class="num" id="8321779">60</span><span class="op" id="8321781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321784">21</span><span class="op" id="8321786">,</span>&nbsp;<span class="num" id="8321788">34</span><span class="op" id="8321790">,</span>&nbsp;<span class="num" id="8321792">37</span><span class="op" id="8321794">,</span>&nbsp;<span class="num" id="8321796">47</span><span class="op" id="8321798">,</span>&nbsp;<span class="num" id="8321800">50</span><span class="op" id="8321802">,</span>&nbsp;<span class="num" id="8321804">56</span><span class="op" id="8321806">,</span>&nbsp;<span class="num" id="8321808">59</span><span class="op" id="8321810">,</span>&nbsp;<span class="num" id="8321812">61</span><span class="op" id="8321814">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8321817">35</span><span class="op" id="8321819">,</span>&nbsp;<span class="num" id="8321821">36</span><span class="op" id="8321823">,</span>&nbsp;<span class="num" id="8321825">48</span><span class="op" id="8321827">,</span>&nbsp;<span class="num" id="8321829">49</span><span class="op" id="8321831">,</span>&nbsp;<span class="num" id="8321833">57</span><span class="op" id="8321835">,</span>&nbsp;<span class="num" id="8321837">58</span><span class="op" id="8321839">,</span>&nbsp;<span class="num" id="8321841">62</span><span class="op" id="8321843">,</span>&nbsp;<span class="num" id="8321845">63</span><span class="op" id="8321847">,</span><br>
<span class="lineno"></span><span class="op" id="8321849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8321852">func</span>&nbsp;<span class="ident" id="8321857">TestZigUnzig</span><span class="op" id="8321869">(</span><span class="ident" id="8321870">t</span>&nbsp;<span class="op" id="8321872">*</span><span class="ident" id="8321873">testing</span><span class="op" id="8321880">.</span><span class="ident" id="8321881">T</span><span class="op" id="8321882">)</span>&nbsp;<span class="op" id="8321884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321887">for</span>&nbsp;<span class="ident" id="8321891">i</span>&nbsp;<span class="op" id="8321893">:=</span>&nbsp;<span class="num" id="8321896">0</span><span class="op" id="8321897">;</span>&nbsp;<span class="ident" id="8321899">i</span>&nbsp;<span class="op" id="8321901">&lt;</span>&nbsp;<span class="ident" id="8321903">blockSize</span><span class="op" id="8321912">;</span>&nbsp;<span class="ident" id="8321914">i</span><span class="op" id="8321915">++</span>&nbsp;<span class="op" id="8321918">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321922">if</span>&nbsp;<span class="ident" id="8321925">unzig</span><span class="op" id="8321930">[</span><span class="ident" id="8321931">zigzag</span><span class="op" id="8321937">[</span><span class="ident" id="8321938">i</span><span class="op" id="8321939">]</span><span class="op" id="8321940">]</span>&nbsp;<span class="op" id="8321942">!=</span>&nbsp;<span class="ident" id="8321945">i</span>&nbsp;<span class="op" id="8321947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321952">t</span><span class="op" id="8321953">.</span><span class="ident" id="8321954">Errorf</span><span class="op" id="8321960">(</span><span class="string" id="8321961">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="8321986">,</span>&nbsp;<span class="ident" id="8321988">i</span><span class="op" id="8321989">,</span>&nbsp;<span class="ident" id="8321991">unzig</span><span class="op" id="8321996">[</span><span class="ident" id="8321997">zigzag</span><span class="op" id="8322003">[</span><span class="ident" id="8322004">i</span><span class="op" id="8322005">]</span><span class="op" id="8322006">]</span><span class="op" id="8322007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322015">if</span>&nbsp;<span class="ident" id="8322018">zigzag</span><span class="op" id="8322024">[</span><span class="ident" id="8322025">unzig</span><span class="op" id="8322030">[</span><span class="ident" id="8322031">i</span><span class="op" id="8322032">]</span><span class="op" id="8322033">]</span>&nbsp;<span class="op" id="8322035">!=</span>&nbsp;<span class="ident" id="8322038">i</span>&nbsp;<span class="op" id="8322040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322045">t</span><span class="op" id="8322046">.</span><span class="ident" id="8322047">Errorf</span><span class="op" id="8322053">(</span><span class="string" id="8322054">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="8322079">,</span>&nbsp;<span class="ident" id="8322081">i</span><span class="op" id="8322082">,</span>&nbsp;<span class="ident" id="8322084">zigzag</span><span class="op" id="8322090">[</span><span class="ident" id="8322091">unzig</span><span class="op" id="8322096">[</span><span class="ident" id="8322097">i</span><span class="op" id="8322098">]</span><span class="op" id="8322099">]</span><span class="op" id="8322100">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322107">}</span><br>
<span class="lineno"></span><span class="op" id="8322109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8322112">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="8322183">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="8322244">var</span>&nbsp;<span class="ident" id="8322248">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="8322276">=</span>&nbsp;<span class="op" id="8322278">[</span><span class="ident" id="8322279">nQuantIndex</span><span class="op" id="8322290">]</span><span class="op" id="8322291">[</span><span class="ident" id="8322292">blockSize</span><span class="op" id="8322301">]</span><span class="builtintype" id="8322302">byte</span><span class="op" id="8322306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322309">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322328">16</span><span class="op" id="8322330">,</span>&nbsp;<span class="num" id="8322332">11</span><span class="op" id="8322334">,</span>&nbsp;<span class="num" id="8322336">10</span><span class="op" id="8322338">,</span>&nbsp;<span class="num" id="8322340">16</span><span class="op" id="8322342">,</span>&nbsp;<span class="num" id="8322344">24</span><span class="op" id="8322346">,</span>&nbsp;<span class="num" id="8322348">40</span><span class="op" id="8322350">,</span>&nbsp;<span class="num" id="8322352">51</span><span class="op" id="8322354">,</span>&nbsp;<span class="num" id="8322356">61</span><span class="op" id="8322358">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322362">12</span><span class="op" id="8322364">,</span>&nbsp;<span class="num" id="8322366">12</span><span class="op" id="8322368">,</span>&nbsp;<span class="num" id="8322370">14</span><span class="op" id="8322372">,</span>&nbsp;<span class="num" id="8322374">19</span><span class="op" id="8322376">,</span>&nbsp;<span class="num" id="8322378">26</span><span class="op" id="8322380">,</span>&nbsp;<span class="num" id="8322382">58</span><span class="op" id="8322384">,</span>&nbsp;<span class="num" id="8322386">60</span><span class="op" id="8322388">,</span>&nbsp;<span class="num" id="8322390">55</span><span class="op" id="8322392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322396">14</span><span class="op" id="8322398">,</span>&nbsp;<span class="num" id="8322400">13</span><span class="op" id="8322402">,</span>&nbsp;<span class="num" id="8322404">16</span><span class="op" id="8322406">,</span>&nbsp;<span class="num" id="8322408">24</span><span class="op" id="8322410">,</span>&nbsp;<span class="num" id="8322412">40</span><span class="op" id="8322414">,</span>&nbsp;<span class="num" id="8322416">57</span><span class="op" id="8322418">,</span>&nbsp;<span class="num" id="8322420">69</span><span class="op" id="8322422">,</span>&nbsp;<span class="num" id="8322424">56</span><span class="op" id="8322426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322430">14</span><span class="op" id="8322432">,</span>&nbsp;<span class="num" id="8322434">17</span><span class="op" id="8322436">,</span>&nbsp;<span class="num" id="8322438">22</span><span class="op" id="8322440">,</span>&nbsp;<span class="num" id="8322442">29</span><span class="op" id="8322444">,</span>&nbsp;<span class="num" id="8322446">51</span><span class="op" id="8322448">,</span>&nbsp;<span class="num" id="8322450">87</span><span class="op" id="8322452">,</span>&nbsp;<span class="num" id="8322454">80</span><span class="op" id="8322456">,</span>&nbsp;<span class="num" id="8322458">62</span><span class="op" id="8322460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322464">18</span><span class="op" id="8322466">,</span>&nbsp;<span class="num" id="8322468">22</span><span class="op" id="8322470">,</span>&nbsp;<span class="num" id="8322472">37</span><span class="op" id="8322474">,</span>&nbsp;<span class="num" id="8322476">56</span><span class="op" id="8322478">,</span>&nbsp;<span class="num" id="8322480">68</span><span class="op" id="8322482">,</span>&nbsp;<span class="num" id="8322484">109</span><span class="op" id="8322487">,</span>&nbsp;<span class="num" id="8322489">103</span><span class="op" id="8322492">,</span>&nbsp;<span class="num" id="8322494">77</span><span class="op" id="8322496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322500">24</span><span class="op" id="8322502">,</span>&nbsp;<span class="num" id="8322504">35</span><span class="op" id="8322506">,</span>&nbsp;<span class="num" id="8322508">55</span><span class="op" id="8322510">,</span>&nbsp;<span class="num" id="8322512">64</span><span class="op" id="8322514">,</span>&nbsp;<span class="num" id="8322516">81</span><span class="op" id="8322518">,</span>&nbsp;<span class="num" id="8322520">104</span><span class="op" id="8322523">,</span>&nbsp;<span class="num" id="8322525">113</span><span class="op" id="8322528">,</span>&nbsp;<span class="num" id="8322530">92</span><span class="op" id="8322532">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322536">49</span><span class="op" id="8322538">,</span>&nbsp;<span class="num" id="8322540">64</span><span class="op" id="8322542">,</span>&nbsp;<span class="num" id="8322544">78</span><span class="op" id="8322546">,</span>&nbsp;<span class="num" id="8322548">87</span><span class="op" id="8322550">,</span>&nbsp;<span class="num" id="8322552">103</span><span class="op" id="8322555">,</span>&nbsp;<span class="num" id="8322557">121</span><span class="op" id="8322560">,</span>&nbsp;<span class="num" id="8322562">120</span><span class="op" id="8322565">,</span>&nbsp;<span class="num" id="8322567">101</span><span class="op" id="8322570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322574">72</span><span class="op" id="8322576">,</span>&nbsp;<span class="num" id="8322578">92</span><span class="op" id="8322580">,</span>&nbsp;<span class="num" id="8322582">95</span><span class="op" id="8322584">,</span>&nbsp;<span class="num" id="8322586">98</span><span class="op" id="8322588">,</span>&nbsp;<span class="num" id="8322590">112</span><span class="op" id="8322593">,</span>&nbsp;<span class="num" id="8322595">100</span><span class="op" id="8322598">,</span>&nbsp;<span class="num" id="8322600">103</span><span class="op" id="8322603">,</span>&nbsp;<span class="num" id="8322605">99</span><span class="op" id="8322607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322610">}</span><span class="op" id="8322611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322614">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322631">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322635">17</span><span class="op" id="8322637">,</span>&nbsp;<span class="num" id="8322639">18</span><span class="op" id="8322641">,</span>&nbsp;<span class="num" id="8322643">24</span><span class="op" id="8322645">,</span>&nbsp;<span class="num" id="8322647">47</span><span class="op" id="8322649">,</span>&nbsp;<span class="num" id="8322651">99</span><span class="op" id="8322653">,</span>&nbsp;<span class="num" id="8322655">99</span><span class="op" id="8322657">,</span>&nbsp;<span class="num" id="8322659">99</span><span class="op" id="8322661">,</span>&nbsp;<span class="num" id="8322663">99</span><span class="op" id="8322665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322669">18</span><span class="op" id="8322671">,</span>&nbsp;<span class="num" id="8322673">21</span><span class="op" id="8322675">,</span>&nbsp;<span class="num" id="8322677">26</span><span class="op" id="8322679">,</span>&nbsp;<span class="num" id="8322681">66</span><span class="op" id="8322683">,</span>&nbsp;<span class="num" id="8322685">99</span><span class="op" id="8322687">,</span>&nbsp;<span class="num" id="8322689">99</span><span class="op" id="8322691">,</span>&nbsp;<span class="num" id="8322693">99</span><span class="op" id="8322695">,</span>&nbsp;<span class="num" id="8322697">99</span><span class="op" id="8322699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322703">24</span><span class="op" id="8322705">,</span>&nbsp;<span class="num" id="8322707">26</span><span class="op" id="8322709">,</span>&nbsp;<span class="num" id="8322711">56</span><span class="op" id="8322713">,</span>&nbsp;<span class="num" id="8322715">99</span><span class="op" id="8322717">,</span>&nbsp;<span class="num" id="8322719">99</span><span class="op" id="8322721">,</span>&nbsp;<span class="num" id="8322723">99</span><span class="op" id="8322725">,</span>&nbsp;<span class="num" id="8322727">99</span><span class="op" id="8322729">,</span>&nbsp;<span class="num" id="8322731">99</span><span class="op" id="8322733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322737">47</span><span class="op" id="8322739">,</span>&nbsp;<span class="num" id="8322741">66</span><span class="op" id="8322743">,</span>&nbsp;<span class="num" id="8322745">99</span><span class="op" id="8322747">,</span>&nbsp;<span class="num" id="8322749">99</span><span class="op" id="8322751">,</span>&nbsp;<span class="num" id="8322753">99</span><span class="op" id="8322755">,</span>&nbsp;<span class="num" id="8322757">99</span><span class="op" id="8322759">,</span>&nbsp;<span class="num" id="8322761">99</span><span class="op" id="8322763">,</span>&nbsp;<span class="num" id="8322765">99</span><span class="op" id="8322767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322771">99</span><span class="op" id="8322773">,</span>&nbsp;<span class="num" id="8322775">99</span><span class="op" id="8322777">,</span>&nbsp;<span class="num" id="8322779">99</span><span class="op" id="8322781">,</span>&nbsp;<span class="num" id="8322783">99</span><span class="op" id="8322785">,</span>&nbsp;<span class="num" id="8322787">99</span><span class="op" id="8322789">,</span>&nbsp;<span class="num" id="8322791">99</span><span class="op" id="8322793">,</span>&nbsp;<span class="num" id="8322795">99</span><span class="op" id="8322797">,</span>&nbsp;<span class="num" id="8322799">99</span><span class="op" id="8322801">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322805">99</span><span class="op" id="8322807">,</span>&nbsp;<span class="num" id="8322809">99</span><span class="op" id="8322811">,</span>&nbsp;<span class="num" id="8322813">99</span><span class="op" id="8322815">,</span>&nbsp;<span class="num" id="8322817">99</span><span class="op" id="8322819">,</span>&nbsp;<span class="num" id="8322821">99</span><span class="op" id="8322823">,</span>&nbsp;<span class="num" id="8322825">99</span><span class="op" id="8322827">,</span>&nbsp;<span class="num" id="8322829">99</span><span class="op" id="8322831">,</span>&nbsp;<span class="num" id="8322833">99</span><span class="op" id="8322835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322839">99</span><span class="op" id="8322841">,</span>&nbsp;<span class="num" id="8322843">99</span><span class="op" id="8322845">,</span>&nbsp;<span class="num" id="8322847">99</span><span class="op" id="8322849">,</span>&nbsp;<span class="num" id="8322851">99</span><span class="op" id="8322853">,</span>&nbsp;<span class="num" id="8322855">99</span><span class="op" id="8322857">,</span>&nbsp;<span class="num" id="8322859">99</span><span class="op" id="8322861">,</span>&nbsp;<span class="num" id="8322863">99</span><span class="op" id="8322865">,</span>&nbsp;<span class="num" id="8322867">99</span><span class="op" id="8322869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8322873">99</span><span class="op" id="8322875">,</span>&nbsp;<span class="num" id="8322877">99</span><span class="op" id="8322879">,</span>&nbsp;<span class="num" id="8322881">99</span><span class="op" id="8322883">,</span>&nbsp;<span class="num" id="8322885">99</span><span class="op" id="8322887">,</span>&nbsp;<span class="num" id="8322889">99</span><span class="op" id="8322891">,</span>&nbsp;<span class="num" id="8322893">99</span><span class="op" id="8322895">,</span>&nbsp;<span class="num" id="8322897">99</span><span class="op" id="8322899">,</span>&nbsp;<span class="num" id="8322901">99</span><span class="op" id="8322903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322906">}</span><span class="op" id="8322907">,</span><br>
<span class="lineno"></span><span class="op" id="8322909">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8322912">func</span>&nbsp;<span class="ident" id="8322917">TestUnscaledQuant</span><span class="op" id="8322934">(</span><span class="ident" id="8322935">t</span>&nbsp;<span class="op" id="8322937">*</span><span class="ident" id="8322938">testing</span><span class="op" id="8322945">.</span><span class="ident" id="8322946">T</span><span class="op" id="8322947">)</span>&nbsp;<span class="op" id="8322949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322952">bad</span>&nbsp;<span class="op" id="8322956">:=</span>&nbsp;<span class="builtintype" id="8322959">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322966">for</span>&nbsp;<span class="ident" id="8322970">i</span>&nbsp;<span class="op" id="8322972">:=</span>&nbsp;<span class="ident" id="8322975">quantIndex</span><span class="op" id="8322985">(</span><span class="num" id="8322986">0</span><span class="op" id="8322987">)</span><span class="op" id="8322988">;</span>&nbsp;<span class="ident" id="8322990">i</span>&nbsp;<span class="op" id="8322992">&lt;</span>&nbsp;<span class="ident" id="8322994">nQuantIndex</span><span class="op" id="8323005">;</span>&nbsp;<span class="ident" id="8323007">i</span><span class="op" id="8323008">++</span>&nbsp;<span class="op" id="8323011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323015">for</span>&nbsp;<span class="ident" id="8323019">zig</span>&nbsp;<span class="op" id="8323023">:=</span>&nbsp;<span class="num" id="8323026">0</span><span class="op" id="8323027">;</span>&nbsp;<span class="ident" id="8323029">zig</span>&nbsp;<span class="op" id="8323033">&lt;</span>&nbsp;<span class="ident" id="8323035">blockSize</span><span class="op" id="8323044">;</span>&nbsp;<span class="ident" id="8323046">zig</span><span class="op" id="8323049">++</span>&nbsp;<span class="op" id="8323052">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323057">got</span>&nbsp;<span class="op" id="8323061">:=</span>&nbsp;<span class="ident" id="8323064">unscaledQuant</span><span class="op" id="8323077">[</span><span class="ident" id="8323078">i</span><span class="op" id="8323079">]</span><span class="op" id="8323080">[</span><span class="ident" id="8323081">zig</span><span class="op" id="8323084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323089">want</span>&nbsp;<span class="op" id="8323094">:=</span>&nbsp;<span class="ident" id="8323097">unscaledQuantInNaturalOrder</span><span class="op" id="8323124">[</span><span class="ident" id="8323125">i</span><span class="op" id="8323126">]</span><span class="op" id="8323127">[</span><span class="ident" id="8323128">unzig</span><span class="op" id="8323133">[</span><span class="ident" id="8323134">zig</span><span class="op" id="8323137">]</span><span class="op" id="8323138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323143">if</span>&nbsp;<span class="ident" id="8323146">got</span>&nbsp;<span class="op" id="8323150">!=</span>&nbsp;<span class="ident" id="8323153">want</span>&nbsp;<span class="op" id="8323158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323164">t</span><span class="op" id="8323165">.</span><span class="ident" id="8323166">Errorf</span><span class="op" id="8323172">(</span><span class="string" id="8323173">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8323204">,</span>&nbsp;<span class="ident" id="8323206">i</span><span class="op" id="8323207">,</span>&nbsp;<span class="ident" id="8323209">zig</span><span class="op" id="8323212">,</span>&nbsp;<span class="ident" id="8323214">got</span><span class="op" id="8323217">,</span>&nbsp;<span class="ident" id="8323219">want</span><span class="op" id="8323223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323229">bad</span>&nbsp;<span class="op" id="8323233">=</span>&nbsp;<span class="builtintype" id="8323235">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323253">if</span>&nbsp;<span class="ident" id="8323256">bad</span>&nbsp;<span class="op" id="8323260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323264">names</span>&nbsp;<span class="op" id="8323270">:=</span>&nbsp;<span class="op" id="8323273">[</span><span class="ident" id="8323274">nQuantIndex</span><span class="op" id="8323285">]</span><span class="builtintype" id="8323286">string</span><span class="op" id="8323292">{</span><span class="string" id="8323293">&#34;Luminance&#34;</span><span class="op" id="8323304">,</span>&nbsp;<span class="string" id="8323306">&#34;Chrominance&#34;</span><span class="op" id="8323319">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323323">buf</span>&nbsp;<span class="op" id="8323327">:=</span>&nbsp;<span class="op" id="8323330">&amp;</span><span class="ident" id="8323331">bytes</span><span class="op" id="8323336">.</span><span class="ident" id="8323337">Buffer</span><span class="op" id="8323343">{</span><span class="op" id="8323344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323348">for</span>&nbsp;<span class="ident" id="8323352">i</span><span class="op" id="8323353">,</span>&nbsp;<span class="ident" id="8323355">name</span>&nbsp;<span class="op" id="8323360">:=</span>&nbsp;<span class="keyword" id="8323363">range</span>&nbsp;<span class="ident" id="8323369">names</span>&nbsp;<span class="op" id="8323375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323380">fmt</span><span class="op" id="8323383">.</span><span class="ident" id="8323384">Fprintf</span><span class="op" id="8323391">(</span><span class="ident" id="8323392">buf</span><span class="op" id="8323395">,</span>&nbsp;<span class="string" id="8323397">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="8323410">,</span>&nbsp;<span class="ident" id="8323412">name</span><span class="op" id="8323416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323421">for</span>&nbsp;<span class="ident" id="8323425">zig</span>&nbsp;<span class="op" id="8323429">:=</span>&nbsp;<span class="num" id="8323432">0</span><span class="op" id="8323433">;</span>&nbsp;<span class="ident" id="8323435">zig</span>&nbsp;<span class="op" id="8323439">&lt;</span>&nbsp;<span class="ident" id="8323441">blockSize</span><span class="op" id="8323450">;</span>&nbsp;<span class="ident" id="8323452">zig</span><span class="op" id="8323455">++</span>&nbsp;<span class="op" id="8323458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323464">fmt</span><span class="op" id="8323467">.</span><span class="ident" id="8323468">Fprintf</span><span class="op" id="8323475">(</span><span class="ident" id="8323476">buf</span><span class="op" id="8323479">,</span>&nbsp;<span class="string" id="8323481">&#34;%d,&nbsp;&#34;</span><span class="op" id="8323487">,</span>&nbsp;<span class="ident" id="8323489">unscaledQuantInNaturalOrder</span><span class="op" id="8323516">[</span><span class="ident" id="8323517">i</span><span class="op" id="8323518">]</span><span class="op" id="8323519">[</span><span class="ident" id="8323520">unzig</span><span class="op" id="8323525">[</span><span class="ident" id="8323526">zig</span><span class="op" id="8323529">]</span><span class="op" id="8323530">]</span><span class="op" id="8323531">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323537">if</span>&nbsp;<span class="ident" id="8323540">zig</span><span class="op" id="8323543">%</span><span class="num" id="8323544">8</span>&nbsp;<span class="op" id="8323546">==</span>&nbsp;<span class="num" id="8323549">7</span>&nbsp;<span class="op" id="8323551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323558">buf</span><span class="op" id="8323561">.</span><span class="ident" id="8323562">WriteString</span><span class="op" id="8323573">(</span><span class="string" id="8323574">&#34;\n&#34;</span><span class="op" id="8323578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323594">buf</span><span class="op" id="8323597">.</span><span class="ident" id="8323598">WriteString</span><span class="op" id="8323609">(</span><span class="string" id="8323610">&#34;},\n&#34;</span><span class="op" id="8323616">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323624">t</span><span class="op" id="8323625">.</span><span class="ident" id="8323626">Logf</span><span class="op" id="8323630">(</span><span class="string" id="8323631">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="8323667">,</span>&nbsp;<span class="ident" id="8323669">buf</span><span class="op" id="8323672">.</span><span class="ident" id="8323673">String</span><span class="op" id="8323679">(</span><span class="op" id="8323680">)</span><span class="op" id="8323681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323684">}</span><br>
<span class="lineno"></span><span class="op" id="8323686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="8323689">var</span>&nbsp;<span class="ident" id="8323693">testCase</span>&nbsp;<span class="op" id="8323702">=</span>&nbsp;<span class="op" id="8323704">[</span><span class="op" id="8323705">]</span><span class="keyword" id="8323706">struct</span>&nbsp;<span class="op" id="8323713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323716">filename</span>&nbsp;&nbsp;<span class="builtintype" id="8323726">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323734">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8323744">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323749">tolerance</span>&nbsp;<span class="ident" id="8323759">int64</span><br>
<span class="lineno"></span><span class="op" id="8323765">}</span><span class="op" id="8323766">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323769">{</span><span class="string" id="8323770">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8323797">,</span>&nbsp;<span class="num" id="8323799">1</span><span class="op" id="8323800">,</span>&nbsp;<span class="num" id="8323802">24</span>&nbsp;<span class="op" id="8323805">&lt;&lt;</span>&nbsp;<span class="num" id="8323808">8</span><span class="op" id="8323809">}</span><span class="op" id="8323810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323813">{</span><span class="string" id="8323814">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8323841">,</span>&nbsp;<span class="num" id="8323843">20</span><span class="op" id="8323845">,</span>&nbsp;<span class="num" id="8323847">12</span>&nbsp;<span class="op" id="8323850">&lt;&lt;</span>&nbsp;<span class="num" id="8323853">8</span><span class="op" id="8323854">}</span><span class="op" id="8323855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323858">{</span><span class="string" id="8323859">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8323886">,</span>&nbsp;<span class="num" id="8323888">60</span><span class="op" id="8323890">,</span>&nbsp;<span class="num" id="8323892">8</span>&nbsp;<span class="op" id="8323894">&lt;&lt;</span>&nbsp;<span class="num" id="8323897">8</span><span class="op" id="8323898">}</span><span class="op" id="8323899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323902">{</span><span class="string" id="8323903">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8323930">,</span>&nbsp;<span class="num" id="8323932">80</span><span class="op" id="8323934">,</span>&nbsp;<span class="num" id="8323936">6</span>&nbsp;<span class="op" id="8323938">&lt;&lt;</span>&nbsp;<span class="num" id="8323941">8</span><span class="op" id="8323942">}</span><span class="op" id="8323943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323946">{</span><span class="string" id="8323947">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8323974">,</span>&nbsp;<span class="num" id="8323976">90</span><span class="op" id="8323978">,</span>&nbsp;<span class="num" id="8323980">4</span>&nbsp;<span class="op" id="8323982">&lt;&lt;</span>&nbsp;<span class="num" id="8323985">8</span><span class="op" id="8323986">}</span><span class="op" id="8323987">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323990">{</span><span class="string" id="8323991">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8324018">,</span>&nbsp;<span class="num" id="8324020">100</span><span class="op" id="8324023">,</span>&nbsp;<span class="num" id="8324025">2</span>&nbsp;<span class="op" id="8324027">&lt;&lt;</span>&nbsp;<span class="num" id="8324030">8</span><span class="op" id="8324031">}</span><span class="op" id="8324032">,</span><br>
<span class="lineno"></span><span class="op" id="8324034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8324037">func</span>&nbsp;<span class="ident" id="8324042">delta</span><span class="op" id="8324047">(</span><span class="ident" id="8324048">u0</span><span class="op" id="8324050">,</span>&nbsp;<span class="ident" id="8324052">u1</span>&nbsp;<span class="builtintype" id="8324055">uint32</span><span class="op" id="8324061">)</span>&nbsp;<span class="ident" id="8324063">int64</span>&nbsp;<span class="op" id="8324069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324072">d</span>&nbsp;<span class="op" id="8324074">:=</span>&nbsp;<span class="ident" id="8324077">int64</span><span class="op" id="8324082">(</span><span class="ident" id="8324083">u0</span><span class="op" id="8324085">)</span>&nbsp;<span class="op" id="8324087">-</span>&nbsp;<span class="ident" id="8324089">int64</span><span class="op" id="8324094">(</span><span class="ident" id="8324095">u1</span><span class="op" id="8324097">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324100">if</span>&nbsp;<span class="ident" id="8324103">d</span>&nbsp;<span class="op" id="8324105">&lt;</span>&nbsp;<span class="num" id="8324107">0</span>&nbsp;<span class="op" id="8324109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324113">return</span>&nbsp;<span class="op" id="8324120">-</span><span class="ident" id="8324121">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324127">return</span>&nbsp;<span class="ident" id="8324134">d</span><br>
<span class="lineno"></span><span class="op" id="8324136">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="8324139">func</span>&nbsp;<span class="ident" id="8324144">readPng</span><span class="op" id="8324151">(</span><span class="ident" id="8324152">filename</span>&nbsp;<span class="builtintype" id="8324161">string</span><span class="op" id="8324167">)</span>&nbsp;<span class="op" id="8324169">(</span><span class="ident" id="8324170">image</span><span class="op" id="8324175">.</span><span class="ident" id="8324176">Image</span><span class="op" id="8324181">,</span>&nbsp;<span class="builtintype" id="8324183">error</span><span class="op" id="8324188">)</span>&nbsp;<span class="op" id="8324190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324193">f</span><span class="op" id="8324194">,</span>&nbsp;<span class="ident" id="8324196">err</span>&nbsp;<span class="op" id="8324200">:=</span>&nbsp;<span class="ident" id="8324203">os</span><span class="op" id="8324205">.</span><span class="ident" id="8324206">Open</span><span class="op" id="8324210">(</span><span class="ident" id="8324211">filename</span><span class="op" id="8324219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324222">if</span>&nbsp;<span class="ident" id="8324225">err</span>&nbsp;<span class="op" id="8324229">!=</span>&nbsp;<span class="ident" id="8324232">nil</span>&nbsp;<span class="op" id="8324236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324240">return</span>&nbsp;<span class="ident" id="8324247">nil</span><span class="op" id="8324250">,</span>&nbsp;<span class="ident" id="8324252">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324260">defer</span>&nbsp;<span class="ident" id="8324266">f</span><span class="op" id="8324267">.</span><span class="ident" id="8324268">Close</span><span class="op" id="8324273">(</span><span class="op" id="8324274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324277">return</span>&nbsp;<span class="ident" id="8324284">png</span><span class="op" id="8324287">.</span><span class="ident" id="8324288">Decode</span><span class="op" id="8324294">(</span><span class="ident" id="8324295">f</span><span class="op" id="8324296">)</span><br>
<span class="lineno"></span><span class="op" id="8324298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8324301">func</span>&nbsp;<span class="ident" id="8324306">TestWriter</span><span class="op" id="8324316">(</span><span class="ident" id="8324317">t</span>&nbsp;<span class="op" id="8324319">*</span><span class="ident" id="8324320">testing</span><span class="op" id="8324327">.</span><span class="ident" id="8324328">T</span><span class="op" id="8324329">)</span>&nbsp;<span class="op" id="8324331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324334">for</span>&nbsp;<span class="ident" id="8324338">_</span><span class="op" id="8324339">,</span>&nbsp;<span class="ident" id="8324341">tc</span>&nbsp;<span class="op" id="8324344">:=</span>&nbsp;<span class="keyword" id="8324347">range</span>&nbsp;<span class="ident" id="8324353">testCase</span>&nbsp;<span class="op" id="8324362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324366">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324387">m0</span><span class="op" id="8324389">,</span>&nbsp;<span class="ident" id="8324391">err</span>&nbsp;<span class="op" id="8324395">:=</span>&nbsp;<span class="ident" id="8324398">readPng</span><span class="op" id="8324405">(</span><span class="ident" id="8324406">tc</span><span class="op" id="8324408">.</span><span class="ident" id="8324409">filename</span><span class="op" id="8324417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324421">if</span>&nbsp;<span class="ident" id="8324424">err</span>&nbsp;<span class="op" id="8324428">!=</span>&nbsp;<span class="ident" id="8324431">nil</span>&nbsp;<span class="op" id="8324435">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324440">t</span><span class="op" id="8324441">.</span><span class="ident" id="8324442">Error</span><span class="op" id="8324447">(</span><span class="ident" id="8324448">tc</span><span class="op" id="8324450">.</span><span class="ident" id="8324451">filename</span><span class="op" id="8324459">,</span>&nbsp;<span class="ident" id="8324461">err</span><span class="op" id="8324464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324469">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324484">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324516">var</span>&nbsp;<span class="ident" id="8324520">buf</span>&nbsp;<span class="ident" id="8324524">bytes</span><span class="op" id="8324529">.</span><span class="ident" id="8324530">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324539">err</span>&nbsp;<span class="op" id="8324543">=</span>&nbsp;<span class="ident" id="8324545">Encode</span><span class="op" id="8324551">(</span><span class="op" id="8324552">&amp;</span><span class="ident" id="8324553">buf</span><span class="op" id="8324556">,</span>&nbsp;<span class="ident" id="8324558">m0</span><span class="op" id="8324560">,</span>&nbsp;<span class="op" id="8324562">&amp;</span><span class="ident" id="8324563">Options</span><span class="op" id="8324570">{</span><span class="ident" id="8324571">Quality</span><span class="op" id="8324578">:</span>&nbsp;<span class="ident" id="8324580">tc</span><span class="op" id="8324582">.</span><span class="ident" id="8324583">quality</span><span class="op" id="8324590">}</span><span class="op" id="8324591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324595">if</span>&nbsp;<span class="ident" id="8324598">err</span>&nbsp;<span class="op" id="8324602">!=</span>&nbsp;<span class="ident" id="8324605">nil</span>&nbsp;<span class="op" id="8324609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324614">t</span><span class="op" id="8324615">.</span><span class="ident" id="8324616">Error</span><span class="op" id="8324621">(</span><span class="ident" id="8324622">tc</span><span class="op" id="8324624">.</span><span class="ident" id="8324625">filename</span><span class="op" id="8324633">,</span>&nbsp;<span class="ident" id="8324635">err</span><span class="op" id="8324638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324643">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324654">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324658">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324681">m1</span><span class="op" id="8324683">,</span>&nbsp;<span class="ident" id="8324685">err</span>&nbsp;<span class="op" id="8324689">:=</span>&nbsp;<span class="ident" id="8324692">Decode</span><span class="op" id="8324698">(</span><span class="op" id="8324699">&amp;</span><span class="ident" id="8324700">buf</span><span class="op" id="8324703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324707">if</span>&nbsp;<span class="ident" id="8324710">err</span>&nbsp;<span class="op" id="8324714">!=</span>&nbsp;<span class="ident" id="8324717">nil</span>&nbsp;<span class="op" id="8324721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324726">t</span><span class="op" id="8324727">.</span><span class="ident" id="8324728">Error</span><span class="op" id="8324733">(</span><span class="ident" id="8324734">tc</span><span class="op" id="8324736">.</span><span class="ident" id="8324737">filename</span><span class="op" id="8324745">,</span>&nbsp;<span class="ident" id="8324747">err</span><span class="op" id="8324750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324755">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324770">if</span>&nbsp;<span class="ident" id="8324773">m0</span><span class="op" id="8324775">.</span><span class="ident" id="8324776">Bounds</span><span class="op" id="8324782">(</span><span class="op" id="8324783">)</span>&nbsp;<span class="op" id="8324785">!=</span>&nbsp;<span class="ident" id="8324788">m1</span><span class="op" id="8324790">.</span><span class="ident" id="8324791">Bounds</span><span class="op" id="8324797">(</span><span class="op" id="8324798">)</span>&nbsp;<span class="op" id="8324800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324805">t</span><span class="op" id="8324806">.</span><span class="ident" id="8324807">Errorf</span><span class="op" id="8324813">(</span><span class="string" id="8324814">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8324844">,</span>&nbsp;<span class="ident" id="8324846">tc</span><span class="op" id="8324848">.</span><span class="ident" id="8324849">filename</span><span class="op" id="8324857">,</span>&nbsp;<span class="ident" id="8324859">m0</span><span class="op" id="8324861">.</span><span class="ident" id="8324862">Bounds</span><span class="op" id="8324868">(</span><span class="op" id="8324869">)</span><span class="op" id="8324870">,</span>&nbsp;<span class="ident" id="8324872">m1</span><span class="op" id="8324874">.</span><span class="ident" id="8324875">Bounds</span><span class="op" id="8324881">(</span><span class="op" id="8324882">)</span><span class="op" id="8324883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324888">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324899">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324903">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324958">if</span>&nbsp;<span class="ident" id="8324961">averageDelta</span><span class="op" id="8324973">(</span><span class="ident" id="8324974">m0</span><span class="op" id="8324976">,</span>&nbsp;<span class="ident" id="8324978">m1</span><span class="op" id="8324980">)</span>&nbsp;<span class="op" id="8324982">&gt;</span>&nbsp;<span class="ident" id="8324984">tc</span><span class="op" id="8324986">.</span><span class="ident" id="8324987">tolerance</span>&nbsp;<span class="op" id="8324997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325002">t</span><span class="op" id="8325003">.</span><span class="ident" id="8325004">Errorf</span><span class="op" id="8325010">(</span><span class="string" id="8325011">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="8325054">,</span>&nbsp;<span class="ident" id="8325056">tc</span><span class="op" id="8325058">.</span><span class="ident" id="8325059">filename</span><span class="op" id="8325067">,</span>&nbsp;<span class="ident" id="8325069">tc</span><span class="op" id="8325071">.</span><span class="ident" id="8325072">quality</span><span class="op" id="8325079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325084">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325095">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325098">}</span><br>
<span class="lineno"></span><span class="op" id="8325100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8325103">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="8325177">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="8325209">func</span>&nbsp;<span class="ident" id="8325214">TestWriteGrayscale</span><span class="op" id="8325232">(</span><span class="ident" id="8325233">t</span>&nbsp;<span class="op" id="8325235">*</span><span class="ident" id="8325236">testing</span><span class="op" id="8325243">.</span><span class="ident" id="8325244">T</span><span class="op" id="8325245">)</span>&nbsp;<span class="op" id="8325247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325250">m0</span>&nbsp;<span class="op" id="8325253">:=</span>&nbsp;<span class="ident" id="8325256">image</span><span class="op" id="8325261">.</span><span class="ident" id="8325262">NewGray</span><span class="op" id="8325269">(</span><span class="ident" id="8325270">image</span><span class="op" id="8325275">.</span><span class="ident" id="8325276">Rect</span><span class="op" id="8325280">(</span><span class="num" id="8325281">0</span><span class="op" id="8325282">,</span>&nbsp;<span class="num" id="8325284">0</span><span class="op" id="8325285">,</span>&nbsp;<span class="num" id="8325287">32</span><span class="op" id="8325289">,</span>&nbsp;<span class="num" id="8325291">32</span><span class="op" id="8325293">)</span><span class="op" id="8325294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325297">for</span>&nbsp;<span class="ident" id="8325301">i</span>&nbsp;<span class="op" id="8325303">:=</span>&nbsp;<span class="keyword" id="8325306">range</span>&nbsp;<span class="ident" id="8325312">m0</span><span class="op" id="8325314">.</span><span class="ident" id="8325315">Pix</span>&nbsp;<span class="op" id="8325319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325323">m0</span><span class="op" id="8325325">.</span><span class="ident" id="8325326">Pix</span><span class="op" id="8325329">[</span><span class="ident" id="8325330">i</span><span class="op" id="8325331">]</span>&nbsp;<span class="op" id="8325333">=</span>&nbsp;<span class="builtintype" id="8325335">uint8</span><span class="op" id="8325340">(</span><span class="ident" id="8325341">i</span><span class="op" id="8325342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325345">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325348">var</span>&nbsp;<span class="ident" id="8325352">buf</span>&nbsp;<span class="ident" id="8325356">bytes</span><span class="op" id="8325361">.</span><span class="ident" id="8325362">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325370">if</span>&nbsp;<span class="ident" id="8325373">err</span>&nbsp;<span class="op" id="8325377">:=</span>&nbsp;<span class="ident" id="8325380">Encode</span><span class="op" id="8325386">(</span><span class="op" id="8325387">&amp;</span><span class="ident" id="8325388">buf</span><span class="op" id="8325391">,</span>&nbsp;<span class="ident" id="8325393">m0</span><span class="op" id="8325395">,</span>&nbsp;<span class="ident" id="8325397">nil</span><span class="op" id="8325400">)</span><span class="op" id="8325401">;</span>&nbsp;<span class="ident" id="8325403">err</span>&nbsp;<span class="op" id="8325407">!=</span>&nbsp;<span class="ident" id="8325410">nil</span>&nbsp;<span class="op" id="8325414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325418">t</span><span class="op" id="8325419">.</span><span class="ident" id="8325420">Fatal</span><span class="op" id="8325425">(</span><span class="ident" id="8325426">err</span><span class="op" id="8325429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325435">m1</span><span class="op" id="8325437">,</span>&nbsp;<span class="ident" id="8325439">err</span>&nbsp;<span class="op" id="8325443">:=</span>&nbsp;<span class="ident" id="8325446">Decode</span><span class="op" id="8325452">(</span><span class="op" id="8325453">&amp;</span><span class="ident" id="8325454">buf</span><span class="op" id="8325457">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325460">if</span>&nbsp;<span class="ident" id="8325463">err</span>&nbsp;<span class="op" id="8325467">!=</span>&nbsp;<span class="ident" id="8325470">nil</span>&nbsp;<span class="op" id="8325474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325478">t</span><span class="op" id="8325479">.</span><span class="ident" id="8325480">Fatal</span><span class="op" id="8325485">(</span><span class="ident" id="8325486">err</span><span class="op" id="8325489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325495">if</span>&nbsp;<span class="ident" id="8325498">m0</span><span class="op" id="8325500">.</span><span class="ident" id="8325501">Bounds</span><span class="op" id="8325507">(</span><span class="op" id="8325508">)</span>&nbsp;<span class="op" id="8325510">!=</span>&nbsp;<span class="ident" id="8325513">m1</span><span class="op" id="8325515">.</span><span class="ident" id="8325516">Bounds</span><span class="op" id="8325522">(</span><span class="op" id="8325523">)</span>&nbsp;<span class="op" id="8325525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325529">t</span><span class="op" id="8325530">.</span><span class="ident" id="8325531">Fatalf</span><span class="op" id="8325537">(</span><span class="string" id="8325538">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8325564">,</span>&nbsp;<span class="ident" id="8325566">m0</span><span class="op" id="8325568">.</span><span class="ident" id="8325569">Bounds</span><span class="op" id="8325575">(</span><span class="op" id="8325576">)</span><span class="op" id="8325577">,</span>&nbsp;<span class="ident" id="8325579">m1</span><span class="op" id="8325581">.</span><span class="ident" id="8325582">Bounds</span><span class="op" id="8325588">(</span><span class="op" id="8325589">)</span><span class="op" id="8325590">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325596">if</span>&nbsp;<span class="ident" id="8325599">_</span><span class="op" id="8325600">,</span>&nbsp;<span class="ident" id="8325602">ok</span>&nbsp;<span class="op" id="8325605">:=</span>&nbsp;<span class="ident" id="8325608">m1</span><span class="op" id="8325610">.</span><span class="op" id="8325611">(</span><span class="op" id="8325612">*</span><span class="ident" id="8325613">image</span><span class="op" id="8325618">.</span><span class="ident" id="8325619">Gray</span><span class="op" id="8325623">)</span><span class="op" id="8325624">;</span>&nbsp;<span class="op" id="8325626">!</span><span class="ident" id="8325627">ok</span>&nbsp;<span class="op" id="8325630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325634">t</span><span class="op" id="8325635">.</span><span class="ident" id="8325636">Errorf</span><span class="op" id="8325642">(</span><span class="string" id="8325643">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="8325669">,</span>&nbsp;<span class="ident" id="8325671">m1</span><span class="op" id="8325673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325679">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325733">want</span>&nbsp;<span class="op" id="8325738">:=</span>&nbsp;<span class="ident" id="8325741">int64</span><span class="op" id="8325746">(</span><span class="num" id="8325747">2</span>&nbsp;<span class="op" id="8325749">&lt;&lt;</span>&nbsp;<span class="num" id="8325752">8</span><span class="op" id="8325753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325756">if</span>&nbsp;<span class="ident" id="8325759">got</span>&nbsp;<span class="op" id="8325763">:=</span>&nbsp;<span class="ident" id="8325766">averageDelta</span><span class="op" id="8325778">(</span><span class="ident" id="8325779">m0</span><span class="op" id="8325781">,</span>&nbsp;<span class="ident" id="8325783">m1</span><span class="op" id="8325785">)</span><span class="op" id="8325786">;</span>&nbsp;<span class="ident" id="8325788">got</span>&nbsp;<span class="op" id="8325792">&gt;</span>&nbsp;<span class="ident" id="8325794">want</span>&nbsp;<span class="op" id="8325799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325803">t</span><span class="op" id="8325804">.</span><span class="ident" id="8325805">Errorf</span><span class="op" id="8325811">(</span><span class="string" id="8325812">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="8325856">,</span>&nbsp;<span class="ident" id="8325858">got</span><span class="op" id="8325861">,</span>&nbsp;<span class="ident" id="8325863">want</span><span class="op" id="8325867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325870">}</span><br>
<span class="lineno"></span><span class="op" id="8325872">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="8325875">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="8325951">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8325976">func</span>&nbsp;<span class="ident" id="8325981">averageDelta</span><span class="op" id="8325993">(</span><span class="ident" id="8325994">m0</span><span class="op" id="8325996">,</span>&nbsp;<span class="ident" id="8325998">m1</span>&nbsp;<span class="ident" id="8326001">image</span><span class="op" id="8326006">.</span><span class="ident" id="8326007">Image</span><span class="op" id="8326012">)</span>&nbsp;<span class="ident" id="8326014">int64</span>&nbsp;<span class="op" id="8326020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326023">b</span>&nbsp;<span class="op" id="8326025">:=</span>&nbsp;<span class="ident" id="8326028">m0</span><span class="op" id="8326030">.</span><span class="ident" id="8326031">Bounds</span><span class="op" id="8326037">(</span><span class="op" id="8326038">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326041">var</span>&nbsp;<span class="ident" id="8326045">sum</span><span class="op" id="8326048">,</span>&nbsp;<span class="ident" id="8326050">n</span>&nbsp;<span class="ident" id="8326052">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326059">for</span>&nbsp;<span class="ident" id="8326063">y</span>&nbsp;<span class="op" id="8326065">:=</span>&nbsp;<span class="ident" id="8326068">b</span><span class="op" id="8326069">.</span><span class="ident" id="8326070">Min</span><span class="op" id="8326073">.</span><span class="ident" id="8326074">Y</span><span class="op" id="8326075">;</span>&nbsp;<span class="ident" id="8326077">y</span>&nbsp;<span class="op" id="8326079">&lt;</span>&nbsp;<span class="ident" id="8326081">b</span><span class="op" id="8326082">.</span><span class="ident" id="8326083">Max</span><span class="op" id="8326086">.</span><span class="ident" id="8326087">Y</span><span class="op" id="8326088">;</span>&nbsp;<span class="ident" id="8326090">y</span><span class="op" id="8326091">++</span>&nbsp;<span class="op" id="8326094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326098">for</span>&nbsp;<span class="ident" id="8326102">x</span>&nbsp;<span class="op" id="8326104">:=</span>&nbsp;<span class="ident" id="8326107">b</span><span class="op" id="8326108">.</span><span class="ident" id="8326109">Min</span><span class="op" id="8326112">.</span><span class="ident" id="8326113">X</span><span class="op" id="8326114">;</span>&nbsp;<span class="ident" id="8326116">x</span>&nbsp;<span class="op" id="8326118">&lt;</span>&nbsp;<span class="ident" id="8326120">b</span><span class="op" id="8326121">.</span><span class="ident" id="8326122">Max</span><span class="op" id="8326125">.</span><span class="ident" id="8326126">X</span><span class="op" id="8326127">;</span>&nbsp;<span class="ident" id="8326129">x</span><span class="op" id="8326130">++</span>&nbsp;<span class="op" id="8326133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326138">c0</span>&nbsp;<span class="op" id="8326141">:=</span>&nbsp;<span class="ident" id="8326144">m0</span><span class="op" id="8326146">.</span><span class="ident" id="8326147">At</span><span class="op" id="8326149">(</span><span class="ident" id="8326150">x</span><span class="op" id="8326151">,</span>&nbsp;<span class="ident" id="8326153">y</span><span class="op" id="8326154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326159">c1</span>&nbsp;<span class="op" id="8326162">:=</span>&nbsp;<span class="ident" id="8326165">m1</span><span class="op" id="8326167">.</span><span class="ident" id="8326168">At</span><span class="op" id="8326170">(</span><span class="ident" id="8326171">x</span><span class="op" id="8326172">,</span>&nbsp;<span class="ident" id="8326174">y</span><span class="op" id="8326175">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326180">r0</span><span class="op" id="8326182">,</span>&nbsp;<span class="ident" id="8326184">g0</span><span class="op" id="8326186">,</span>&nbsp;<span class="ident" id="8326188">b0</span><span class="op" id="8326190">,</span>&nbsp;<span class="ident" id="8326192">_</span>&nbsp;<span class="op" id="8326194">:=</span>&nbsp;<span class="ident" id="8326197">c0</span><span class="op" id="8326199">.</span><span class="ident" id="8326200">RGBA</span><span class="op" id="8326204">(</span><span class="op" id="8326205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326210">r1</span><span class="op" id="8326212">,</span>&nbsp;<span class="ident" id="8326214">g1</span><span class="op" id="8326216">,</span>&nbsp;<span class="ident" id="8326218">b1</span><span class="op" id="8326220">,</span>&nbsp;<span class="ident" id="8326222">_</span>&nbsp;<span class="op" id="8326224">:=</span>&nbsp;<span class="ident" id="8326227">c1</span><span class="op" id="8326229">.</span><span class="ident" id="8326230">RGBA</span><span class="op" id="8326234">(</span><span class="op" id="8326235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326240">sum</span>&nbsp;<span class="op" id="8326244">+=</span>&nbsp;<span class="ident" id="8326247">delta</span><span class="op" id="8326252">(</span><span class="ident" id="8326253">r0</span><span class="op" id="8326255">,</span>&nbsp;<span class="ident" id="8326257">r1</span><span class="op" id="8326259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326264">sum</span>&nbsp;<span class="op" id="8326268">+=</span>&nbsp;<span class="ident" id="8326271">delta</span><span class="op" id="8326276">(</span><span class="ident" id="8326277">g0</span><span class="op" id="8326279">,</span>&nbsp;<span class="ident" id="8326281">g1</span><span class="op" id="8326283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326288">sum</span>&nbsp;<span class="op" id="8326292">+=</span>&nbsp;<span class="ident" id="8326295">delta</span><span class="op" id="8326300">(</span><span class="ident" id="8326301">b0</span><span class="op" id="8326303">,</span>&nbsp;<span class="ident" id="8326305">b1</span><span class="op" id="8326307">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326312">n</span>&nbsp;<span class="op" id="8326314">+=</span>&nbsp;<span class="num" id="8326317">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326327">return</span>&nbsp;<span class="ident" id="8326334">sum</span>&nbsp;<span class="op" id="8326338">/</span>&nbsp;<span class="ident" id="8326340">n</span><br>
<span class="lineno"></span><span class="op" id="8326342">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="8326345">func</span>&nbsp;<span class="ident" id="8326350">BenchmarkEncode</span><span class="op" id="8326365">(</span><span class="ident" id="8326366">b</span>&nbsp;<span class="op" id="8326368">*</span><span class="ident" id="8326369">testing</span><span class="op" id="8326376">.</span><span class="ident" id="8326377">B</span><span class="op" id="8326378">)</span>&nbsp;<span class="op" id="8326380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326383">b</span><span class="op" id="8326384">.</span><span class="ident" id="8326385">StopTimer</span><span class="op" id="8326394">(</span><span class="op" id="8326395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326398">img</span>&nbsp;<span class="op" id="8326402">:=</span>&nbsp;<span class="ident" id="8326405">image</span><span class="op" id="8326410">.</span><span class="ident" id="8326411">NewRGBA</span><span class="op" id="8326418">(</span><span class="ident" id="8326419">image</span><span class="op" id="8326424">.</span><span class="ident" id="8326425">Rect</span><span class="op" id="8326429">(</span><span class="num" id="8326430">0</span><span class="op" id="8326431">,</span>&nbsp;<span class="num" id="8326433">0</span><span class="op" id="8326434">,</span>&nbsp;<span class="num" id="8326436">640</span><span class="op" id="8326439">,</span>&nbsp;<span class="num" id="8326441">480</span><span class="op" id="8326444">)</span><span class="op" id="8326445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326448">bo</span>&nbsp;<span class="op" id="8326451">:=</span>&nbsp;<span class="ident" id="8326454">img</span><span class="op" id="8326457">.</span><span class="ident" id="8326458">Bounds</span><span class="op" id="8326464">(</span><span class="op" id="8326465">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326468">rnd</span>&nbsp;<span class="op" id="8326472">:=</span>&nbsp;<span class="ident" id="8326475">rand</span><span class="op" id="8326479">.</span><span class="ident" id="8326480">New</span><span class="op" id="8326483">(</span><span class="ident" id="8326484">rand</span><span class="op" id="8326488">.</span><span class="ident" id="8326489">NewSource</span><span class="op" id="8326498">(</span><span class="num" id="8326499">123</span><span class="op" id="8326502">)</span><span class="op" id="8326503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326506">for</span>&nbsp;<span class="ident" id="8326510">y</span>&nbsp;<span class="op" id="8326512">:=</span>&nbsp;<span class="ident" id="8326515">bo</span><span class="op" id="8326517">.</span><span class="ident" id="8326518">Min</span><span class="op" id="8326521">.</span><span class="ident" id="8326522">Y</span><span class="op" id="8326523">;</span>&nbsp;<span class="ident" id="8326525">y</span>&nbsp;<span class="op" id="8326527">&lt;</span>&nbsp;<span class="ident" id="8326529">bo</span><span class="op" id="8326531">.</span><span class="ident" id="8326532">Max</span><span class="op" id="8326535">.</span><span class="ident" id="8326536">Y</span><span class="op" id="8326537">;</span>&nbsp;<span class="ident" id="8326539">y</span><span class="op" id="8326540">++</span>&nbsp;<span class="op" id="8326543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326547">for</span>&nbsp;<span class="ident" id="8326551">x</span>&nbsp;<span class="op" id="8326553">:=</span>&nbsp;<span class="ident" id="8326556">bo</span><span class="op" id="8326558">.</span><span class="ident" id="8326559">Min</span><span class="op" id="8326562">.</span><span class="ident" id="8326563">X</span><span class="op" id="8326564">;</span>&nbsp;<span class="ident" id="8326566">x</span>&nbsp;<span class="op" id="8326568">&lt;</span>&nbsp;<span class="ident" id="8326570">bo</span><span class="op" id="8326572">.</span><span class="ident" id="8326573">Max</span><span class="op" id="8326576">.</span><span class="ident" id="8326577">X</span><span class="op" id="8326578">;</span>&nbsp;<span class="ident" id="8326580">x</span><span class="op" id="8326581">++</span>&nbsp;<span class="op" id="8326584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326589">img</span><span class="op" id="8326592">.</span><span class="ident" id="8326593">SetRGBA</span><span class="op" id="8326600">(</span><span class="ident" id="8326601">x</span><span class="op" id="8326602">,</span>&nbsp;<span class="ident" id="8326604">y</span><span class="op" id="8326605">,</span>&nbsp;<span class="ident" id="8326607">color</span><span class="op" id="8326612">.</span><span class="ident" id="8326613">RGBA</span><span class="op" id="8326617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8326623">uint8</span><span class="op" id="8326628">(</span><span class="ident" id="8326629">rnd</span><span class="op" id="8326632">.</span><span class="ident" id="8326633">Intn</span><span class="op" id="8326637">(</span><span class="num" id="8326638">256</span><span class="op" id="8326641">)</span><span class="op" id="8326642">)</span><span class="op" id="8326643">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8326649">uint8</span><span class="op" id="8326654">(</span><span class="ident" id="8326655">rnd</span><span class="op" id="8326658">.</span><span class="ident" id="8326659">Intn</span><span class="op" id="8326663">(</span><span class="num" id="8326664">256</span><span class="op" id="8326667">)</span><span class="op" id="8326668">)</span><span class="op" id="8326669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8326675">uint8</span><span class="op" id="8326680">(</span><span class="ident" id="8326681">rnd</span><span class="op" id="8326684">.</span><span class="ident" id="8326685">Intn</span><span class="op" id="8326689">(</span><span class="num" id="8326690">256</span><span class="op" id="8326693">)</span><span class="op" id="8326694">)</span><span class="op" id="8326695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8326701">255</span><span class="op" id="8326704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326709">}</span><span class="op" id="8326710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326714">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326720">b</span><span class="op" id="8326721">.</span><span class="ident" id="8326722">SetBytes</span><span class="op" id="8326730">(</span><span class="num" id="8326731">640</span>&nbsp;<span class="op" id="8326735">*</span>&nbsp;<span class="num" id="8326737">480</span>&nbsp;<span class="op" id="8326741">*</span>&nbsp;<span class="num" id="8326743">4</span><span class="op" id="8326744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326747">b</span><span class="op" id="8326748">.</span><span class="ident" id="8326749">StartTimer</span><span class="op" id="8326759">(</span><span class="op" id="8326760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326763">options</span>&nbsp;<span class="op" id="8326771">:=</span>&nbsp;<span class="op" id="8326774">&amp;</span><span class="ident" id="8326775">Options</span><span class="op" id="8326782">{</span><span class="ident" id="8326783">Quality</span><span class="op" id="8326790">:</span>&nbsp;<span class="num" id="8326792">90</span><span class="op" id="8326794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326797">for</span>&nbsp;<span class="ident" id="8326801">i</span>&nbsp;<span class="op" id="8326803">:=</span>&nbsp;<span class="num" id="8326806">0</span><span class="op" id="8326807">;</span>&nbsp;<span class="ident" id="8326809">i</span>&nbsp;<span class="op" id="8326811">&lt;</span>&nbsp;<span class="ident" id="8326813">b</span><span class="op" id="8326814">.</span><span class="ident" id="8326815">N</span><span class="op" id="8326816">;</span>&nbsp;<span class="ident" id="8326818">i</span><span class="op" id="8326819">++</span>&nbsp;<span class="op" id="8326822">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326826">Encode</span><span class="op" id="8326832">(</span><span class="ident" id="8326833">ioutil</span><span class="op" id="8326839">.</span><span class="ident" id="8326840">Discard</span><span class="op" id="8326847">,</span>&nbsp;<span class="ident" id="8326849">img</span><span class="op" id="8326852">,</span>&nbsp;<span class="ident" id="8326854">options</span><span class="op" id="8326861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326864">}</span><br>
<span class="lineno"></span><span class="op" id="8326866">}</span>
</div>
</body>
</html>
