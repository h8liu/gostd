<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7995133">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7995188">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7995242">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7995293">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7995342">package</span>&nbsp;<span class="ident" id="7995350">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7995355">import</span>&nbsp;<span class="op" id="7995362">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995365">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995374">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995381">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995389">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995395">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995408">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995416">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995427">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7995438">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7995445">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7995448">func</span>&nbsp;<span class="ident" id="7995453">TestOver65kFiles</span><span class="op" id="7995469">(</span><span class="ident" id="7995470">t</span>&nbsp;<span class="op" id="7995472">*</span><span class="ident" id="7995473">testing</span><span class="op" id="7995480">.</span><span class="ident" id="7995481">T</span><span class="op" id="7995482">)</span>&nbsp;<span class="op" id="7995484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995487">buf</span>&nbsp;<span class="op" id="7995491">:=</span>&nbsp;<span class="builtinfunc" id="7995494">new</span><span class="op" id="7995497">(</span><span class="ident" id="7995498">bytes</span><span class="op" id="7995503">.</span><span class="ident" id="7995504">Buffer</span><span class="op" id="7995510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995513">w</span>&nbsp;<span class="op" id="7995515">:=</span>&nbsp;<span class="ident" id="7995518">NewWriter</span><span class="op" id="7995527">(</span><span class="ident" id="7995528">buf</span><span class="op" id="7995531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995534">const</span>&nbsp;<span class="ident" id="7995540">nFiles</span>&nbsp;<span class="op" id="7995547">=</span>&nbsp;<span class="op" id="7995549">(</span><span class="num" id="7995550">1</span>&nbsp;<span class="op" id="7995552">&lt;&lt;</span>&nbsp;<span class="num" id="7995555">16</span><span class="op" id="7995557">)</span>&nbsp;<span class="op" id="7995559">+</span>&nbsp;<span class="num" id="7995561">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995565">for</span>&nbsp;<span class="ident" id="7995569">i</span>&nbsp;<span class="op" id="7995571">:=</span>&nbsp;<span class="num" id="7995574">0</span><span class="op" id="7995575">;</span>&nbsp;<span class="ident" id="7995577">i</span>&nbsp;<span class="op" id="7995579">&lt;</span>&nbsp;<span class="ident" id="7995581">nFiles</span><span class="op" id="7995587">;</span>&nbsp;<span class="ident" id="7995589">i</span><span class="op" id="7995590">++</span>&nbsp;<span class="op" id="7995593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995597">_</span><span class="op" id="7995598">,</span>&nbsp;<span class="ident" id="7995600">err</span>&nbsp;<span class="op" id="7995604">:=</span>&nbsp;<span class="ident" id="7995607">w</span><span class="op" id="7995608">.</span><span class="ident" id="7995609">CreateHeader</span><span class="op" id="7995621">(</span><span class="op" id="7995622">&amp;</span><span class="ident" id="7995623">FileHeader</span><span class="op" id="7995633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995638">Name</span><span class="op" id="7995642">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7995646">fmt</span><span class="op" id="7995649">.</span><span class="ident" id="7995650">Sprintf</span><span class="op" id="7995657">(</span><span class="string" id="7995658">&#34;%d.dat&#34;</span><span class="op" id="7995666">,</span>&nbsp;<span class="ident" id="7995668">i</span><span class="op" id="7995669">)</span><span class="op" id="7995670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995675">Method</span><span class="op" id="7995681">:</span>&nbsp;<span class="ident" id="7995683">Store</span><span class="op" id="7995688">,</span>&nbsp;<span class="comment" id="7995690">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995727">}</span><span class="op" id="7995728">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995732">if</span>&nbsp;<span class="ident" id="7995735">err</span>&nbsp;<span class="op" id="7995739">!=</span>&nbsp;<span class="ident" id="7995742">nil</span>&nbsp;<span class="op" id="7995746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995751">t</span><span class="op" id="7995752">.</span><span class="ident" id="7995753">Fatalf</span><span class="op" id="7995759">(</span><span class="string" id="7995760">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7995782">,</span>&nbsp;<span class="ident" id="7995784">i</span><span class="op" id="7995785">,</span>&nbsp;<span class="ident" id="7995787">err</span><span class="op" id="7995790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995800">if</span>&nbsp;<span class="ident" id="7995803">err</span>&nbsp;<span class="op" id="7995807">:=</span>&nbsp;<span class="ident" id="7995810">w</span><span class="op" id="7995811">.</span><span class="ident" id="7995812">Close</span><span class="op" id="7995817">(</span><span class="op" id="7995818">)</span><span class="op" id="7995819">;</span>&nbsp;<span class="ident" id="7995821">err</span>&nbsp;<span class="op" id="7995825">!=</span>&nbsp;<span class="ident" id="7995828">nil</span>&nbsp;<span class="op" id="7995832">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995836">t</span><span class="op" id="7995837">.</span><span class="ident" id="7995838">Fatalf</span><span class="op" id="7995844">(</span><span class="string" id="7995845">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7995863">,</span>&nbsp;<span class="ident" id="7995865">err</span><span class="op" id="7995868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995874">s</span>&nbsp;<span class="op" id="7995876">:=</span>&nbsp;<span class="ident" id="7995879">buf</span><span class="op" id="7995882">.</span><span class="ident" id="7995883">String</span><span class="op" id="7995889">(</span><span class="op" id="7995890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995893">zr</span><span class="op" id="7995895">,</span>&nbsp;<span class="ident" id="7995897">err</span>&nbsp;<span class="op" id="7995901">:=</span>&nbsp;<span class="ident" id="7995904">NewReader</span><span class="op" id="7995913">(</span><span class="ident" id="7995914">strings</span><span class="op" id="7995921">.</span><span class="ident" id="7995922">NewReader</span><span class="op" id="7995931">(</span><span class="ident" id="7995932">s</span><span class="op" id="7995933">)</span><span class="op" id="7995934">,</span>&nbsp;<span class="ident" id="7995936">int64</span><span class="op" id="7995941">(</span><span class="builtinfunc" id="7995942">len</span><span class="op" id="7995945">(</span><span class="ident" id="7995946">s</span><span class="op" id="7995947">)</span><span class="op" id="7995948">)</span><span class="op" id="7995949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995952">if</span>&nbsp;<span class="ident" id="7995955">err</span>&nbsp;<span class="op" id="7995959">!=</span>&nbsp;<span class="ident" id="7995962">nil</span>&nbsp;<span class="op" id="7995966">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995970">t</span><span class="op" id="7995971">.</span><span class="ident" id="7995972">Fatalf</span><span class="op" id="7995978">(</span><span class="string" id="7995979">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7995994">,</span>&nbsp;<span class="ident" id="7995996">err</span><span class="op" id="7995999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996005">if</span>&nbsp;<span class="ident" id="7996008">got</span>&nbsp;<span class="op" id="7996012">:=</span>&nbsp;<span class="builtinfunc" id="7996015">len</span><span class="op" id="7996018">(</span><span class="ident" id="7996019">zr</span><span class="op" id="7996021">.</span><span class="ident" id="7996022">File</span><span class="op" id="7996026">)</span><span class="op" id="7996027">;</span>&nbsp;<span class="ident" id="7996029">got</span>&nbsp;<span class="op" id="7996033">!=</span>&nbsp;<span class="ident" id="7996036">nFiles</span>&nbsp;<span class="op" id="7996043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996047">t</span><span class="op" id="7996048">.</span><span class="ident" id="7996049">Fatalf</span><span class="op" id="7996055">(</span><span class="string" id="7996056">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7996089">,</span>&nbsp;<span class="ident" id="7996091">got</span><span class="op" id="7996094">,</span>&nbsp;<span class="ident" id="7996096">nFiles</span><span class="op" id="7996102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996105">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996108">for</span>&nbsp;<span class="ident" id="7996112">i</span>&nbsp;<span class="op" id="7996114">:=</span>&nbsp;<span class="num" id="7996117">0</span><span class="op" id="7996118">;</span>&nbsp;<span class="ident" id="7996120">i</span>&nbsp;<span class="op" id="7996122">&lt;</span>&nbsp;<span class="ident" id="7996124">nFiles</span><span class="op" id="7996130">;</span>&nbsp;<span class="ident" id="7996132">i</span><span class="op" id="7996133">++</span>&nbsp;<span class="op" id="7996136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996140">want</span>&nbsp;<span class="op" id="7996145">:=</span>&nbsp;<span class="ident" id="7996148">fmt</span><span class="op" id="7996151">.</span><span class="ident" id="7996152">Sprintf</span><span class="op" id="7996159">(</span><span class="string" id="7996160">&#34;%d.dat&#34;</span><span class="op" id="7996168">,</span>&nbsp;<span class="ident" id="7996170">i</span><span class="op" id="7996171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996175">if</span>&nbsp;<span class="ident" id="7996178">zr</span><span class="op" id="7996180">.</span><span class="ident" id="7996181">File</span><span class="op" id="7996185">[</span><span class="ident" id="7996186">i</span><span class="op" id="7996187">]</span><span class="op" id="7996188">.</span><span class="ident" id="7996189">Name</span>&nbsp;<span class="op" id="7996194">!=</span>&nbsp;<span class="ident" id="7996197">want</span>&nbsp;<span class="op" id="7996202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996207">t</span><span class="op" id="7996208">.</span><span class="ident" id="7996209">Fatalf</span><span class="op" id="7996215">(</span><span class="string" id="7996216">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7996240">,</span>&nbsp;<span class="ident" id="7996242">i</span><span class="op" id="7996243">,</span>&nbsp;<span class="ident" id="7996245">zr</span><span class="op" id="7996247">.</span><span class="ident" id="7996248">File</span><span class="op" id="7996252">[</span><span class="ident" id="7996253">i</span><span class="op" id="7996254">]</span><span class="op" id="7996255">.</span><span class="ident" id="7996256">Name</span><span class="op" id="7996260">,</span>&nbsp;<span class="ident" id="7996262">want</span><span class="op" id="7996266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996270">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996273">}</span><br>
<span class="lineno"></span><span class="op" id="7996275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7996278">func</span>&nbsp;<span class="ident" id="7996283">TestModTime</span><span class="op" id="7996294">(</span><span class="ident" id="7996295">t</span>&nbsp;<span class="op" id="7996297">*</span><span class="ident" id="7996298">testing</span><span class="op" id="7996305">.</span><span class="ident" id="7996306">T</span><span class="op" id="7996307">)</span>&nbsp;<span class="op" id="7996309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996312">var</span>&nbsp;<span class="ident" id="7996316">testTime</span>&nbsp;<span class="op" id="7996325">=</span>&nbsp;<span class="ident" id="7996327">time</span><span class="op" id="7996331">.</span><span class="ident" id="7996332">Date</span><span class="op" id="7996336">(</span><span class="num" id="7996337">2009</span><span class="op" id="7996341">,</span>&nbsp;<span class="ident" id="7996343">time</span><span class="op" id="7996347">.</span><span class="ident" id="7996348">November</span><span class="op" id="7996356">,</span>&nbsp;<span class="num" id="7996358">10</span><span class="op" id="7996360">,</span>&nbsp;<span class="num" id="7996362">23</span><span class="op" id="7996364">,</span>&nbsp;<span class="num" id="7996366">45</span><span class="op" id="7996368">,</span>&nbsp;<span class="num" id="7996370">58</span><span class="op" id="7996372">,</span>&nbsp;<span class="num" id="7996374">0</span><span class="op" id="7996375">,</span>&nbsp;<span class="ident" id="7996377">time</span><span class="op" id="7996381">.</span><span class="ident" id="7996382">UTC</span><span class="op" id="7996385">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996388">fh</span>&nbsp;<span class="op" id="7996391">:=</span>&nbsp;<span class="builtinfunc" id="7996394">new</span><span class="op" id="7996397">(</span><span class="ident" id="7996398">FileHeader</span><span class="op" id="7996408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996411">fh</span><span class="op" id="7996413">.</span><span class="ident" id="7996414">SetModTime</span><span class="op" id="7996424">(</span><span class="ident" id="7996425">testTime</span><span class="op" id="7996433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996436">outTime</span>&nbsp;<span class="op" id="7996444">:=</span>&nbsp;<span class="ident" id="7996447">fh</span><span class="op" id="7996449">.</span><span class="ident" id="7996450">ModTime</span><span class="op" id="7996457">(</span><span class="op" id="7996458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996461">if</span>&nbsp;<span class="op" id="7996464">!</span><span class="ident" id="7996465">outTime</span><span class="op" id="7996472">.</span><span class="ident" id="7996473">Equal</span><span class="op" id="7996478">(</span><span class="ident" id="7996479">testTime</span><span class="op" id="7996487">)</span>&nbsp;<span class="op" id="7996489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996493">t</span><span class="op" id="7996494">.</span><span class="ident" id="7996495">Errorf</span><span class="op" id="7996501">(</span><span class="string" id="7996502">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7996538">,</span>&nbsp;<span class="ident" id="7996540">outTime</span><span class="op" id="7996547">,</span>&nbsp;<span class="ident" id="7996549">testTime</span><span class="op" id="7996557">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996560">}</span><br>
<span class="lineno"></span><span class="op" id="7996562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7996565">func</span>&nbsp;<span class="ident" id="7996570">testHeaderRoundTrip</span><span class="op" id="7996589">(</span><span class="ident" id="7996590">fh</span>&nbsp;<span class="op" id="7996593">*</span><span class="ident" id="7996594">FileHeader</span><span class="op" id="7996604">,</span>&nbsp;<span class="ident" id="7996606">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7996627">uint32</span><span class="op" id="7996633">,</span>&nbsp;<span class="ident" id="7996635">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7996658">uint64</span><span class="op" id="7996664">,</span>&nbsp;<span class="ident" id="7996666">t</span>&nbsp;<span class="op" id="7996668">*</span><span class="ident" id="7996669">testing</span><span class="op" id="7996676">.</span><span class="ident" id="7996677">T</span><span class="op" id="7996678">)</span>&nbsp;<span class="op" id="7996680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996683">fi</span>&nbsp;<span class="op" id="7996686">:=</span>&nbsp;<span class="ident" id="7996689">fh</span><span class="op" id="7996691">.</span><span class="ident" id="7996692">FileInfo</span><span class="op" id="7996700">(</span><span class="op" id="7996701">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996704">fh2</span><span class="op" id="7996707">,</span>&nbsp;<span class="ident" id="7996709">err</span>&nbsp;<span class="op" id="7996713">:=</span>&nbsp;<span class="ident" id="7996716">FileInfoHeader</span><span class="op" id="7996730">(</span><span class="ident" id="7996731">fi</span><span class="op" id="7996733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996736">if</span>&nbsp;<span class="ident" id="7996739">err</span>&nbsp;<span class="op" id="7996743">!=</span>&nbsp;<span class="ident" id="7996746">nil</span>&nbsp;<span class="op" id="7996750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996754">t</span><span class="op" id="7996755">.</span><span class="ident" id="7996756">Fatal</span><span class="op" id="7996761">(</span><span class="ident" id="7996762">err</span><span class="op" id="7996765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996771">if</span>&nbsp;<span class="ident" id="7996774">got</span><span class="op" id="7996777">,</span>&nbsp;<span class="ident" id="7996779">want</span>&nbsp;<span class="op" id="7996784">:=</span>&nbsp;<span class="ident" id="7996787">fh2</span><span class="op" id="7996790">.</span><span class="ident" id="7996791">Name</span><span class="op" id="7996795">,</span>&nbsp;<span class="ident" id="7996797">fh</span><span class="op" id="7996799">.</span><span class="ident" id="7996800">Name</span><span class="op" id="7996804">;</span>&nbsp;<span class="ident" id="7996806">got</span>&nbsp;<span class="op" id="7996810">!=</span>&nbsp;<span class="ident" id="7996813">want</span>&nbsp;<span class="op" id="7996818">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996822">t</span><span class="op" id="7996823">.</span><span class="ident" id="7996824">Errorf</span><span class="op" id="7996830">(</span><span class="string" id="7996831">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7996856">,</span>&nbsp;<span class="ident" id="7996858">got</span><span class="op" id="7996861">,</span>&nbsp;<span class="ident" id="7996863">want</span><span class="op" id="7996867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996873">if</span>&nbsp;<span class="ident" id="7996876">got</span><span class="op" id="7996879">,</span>&nbsp;<span class="ident" id="7996881">want</span>&nbsp;<span class="op" id="7996886">:=</span>&nbsp;<span class="ident" id="7996889">fh2</span><span class="op" id="7996892">.</span><span class="ident" id="7996893">UncompressedSize</span><span class="op" id="7996909">,</span>&nbsp;<span class="ident" id="7996911">wantUncompressedSize</span><span class="op" id="7996931">;</span>&nbsp;<span class="ident" id="7996933">got</span>&nbsp;<span class="op" id="7996937">!=</span>&nbsp;<span class="ident" id="7996940">want</span>&nbsp;<span class="op" id="7996945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996949">t</span><span class="op" id="7996950">.</span><span class="ident" id="7996951">Errorf</span><span class="op" id="7996957">(</span><span class="string" id="7996958">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7996995">,</span>&nbsp;<span class="ident" id="7996997">got</span><span class="op" id="7997000">,</span>&nbsp;<span class="ident" id="7997002">want</span><span class="op" id="7997006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997009">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997012">if</span>&nbsp;<span class="ident" id="7997015">got</span><span class="op" id="7997018">,</span>&nbsp;<span class="ident" id="7997020">want</span>&nbsp;<span class="op" id="7997025">:=</span>&nbsp;<span class="ident" id="7997028">fh2</span><span class="op" id="7997031">.</span><span class="ident" id="7997032">UncompressedSize64</span><span class="op" id="7997050">,</span>&nbsp;<span class="ident" id="7997052">wantUncompressedSize64</span><span class="op" id="7997074">;</span>&nbsp;<span class="ident" id="7997076">got</span>&nbsp;<span class="op" id="7997080">!=</span>&nbsp;<span class="ident" id="7997083">want</span>&nbsp;<span class="op" id="7997088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997092">t</span><span class="op" id="7997093">.</span><span class="ident" id="7997094">Errorf</span><span class="op" id="7997100">(</span><span class="string" id="7997101">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7997140">,</span>&nbsp;<span class="ident" id="7997142">got</span><span class="op" id="7997145">,</span>&nbsp;<span class="ident" id="7997147">want</span><span class="op" id="7997151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997157">if</span>&nbsp;<span class="ident" id="7997160">got</span><span class="op" id="7997163">,</span>&nbsp;<span class="ident" id="7997165">want</span>&nbsp;<span class="op" id="7997170">:=</span>&nbsp;<span class="ident" id="7997173">fh2</span><span class="op" id="7997176">.</span><span class="ident" id="7997177">ModifiedTime</span><span class="op" id="7997189">,</span>&nbsp;<span class="ident" id="7997191">fh</span><span class="op" id="7997193">.</span><span class="ident" id="7997194">ModifiedTime</span><span class="op" id="7997206">;</span>&nbsp;<span class="ident" id="7997208">got</span>&nbsp;<span class="op" id="7997212">!=</span>&nbsp;<span class="ident" id="7997215">want</span>&nbsp;<span class="op" id="7997220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997224">t</span><span class="op" id="7997225">.</span><span class="ident" id="7997226">Errorf</span><span class="op" id="7997232">(</span><span class="string" id="7997233">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7997266">,</span>&nbsp;<span class="ident" id="7997268">got</span><span class="op" id="7997271">,</span>&nbsp;<span class="ident" id="7997273">want</span><span class="op" id="7997277">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997283">if</span>&nbsp;<span class="ident" id="7997286">got</span><span class="op" id="7997289">,</span>&nbsp;<span class="ident" id="7997291">want</span>&nbsp;<span class="op" id="7997296">:=</span>&nbsp;<span class="ident" id="7997299">fh2</span><span class="op" id="7997302">.</span><span class="ident" id="7997303">ModifiedDate</span><span class="op" id="7997315">,</span>&nbsp;<span class="ident" id="7997317">fh</span><span class="op" id="7997319">.</span><span class="ident" id="7997320">ModifiedDate</span><span class="op" id="7997332">;</span>&nbsp;<span class="ident" id="7997334">got</span>&nbsp;<span class="op" id="7997338">!=</span>&nbsp;<span class="ident" id="7997341">want</span>&nbsp;<span class="op" id="7997346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997350">t</span><span class="op" id="7997351">.</span><span class="ident" id="7997352">Errorf</span><span class="op" id="7997358">(</span><span class="string" id="7997359">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7997392">,</span>&nbsp;<span class="ident" id="7997394">got</span><span class="op" id="7997397">,</span>&nbsp;<span class="ident" id="7997399">want</span><span class="op" id="7997403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997410">if</span>&nbsp;<span class="ident" id="7997413">sysfh</span><span class="op" id="7997418">,</span>&nbsp;<span class="ident" id="7997420">ok</span>&nbsp;<span class="op" id="7997423">:=</span>&nbsp;<span class="ident" id="7997426">fi</span><span class="op" id="7997428">.</span><span class="ident" id="7997429">Sys</span><span class="op" id="7997432">(</span><span class="op" id="7997433">)</span><span class="op" id="7997434">.</span><span class="op" id="7997435">(</span><span class="op" id="7997436">*</span><span class="ident" id="7997437">FileHeader</span><span class="op" id="7997447">)</span><span class="op" id="7997448">;</span>&nbsp;<span class="op" id="7997450">!</span><span class="ident" id="7997451">ok</span>&nbsp;<span class="op" id="7997454">&amp;&amp;</span>&nbsp;<span class="ident" id="7997457">sysfh</span>&nbsp;<span class="op" id="7997463">!=</span>&nbsp;<span class="ident" id="7997466">fh</span>&nbsp;<span class="op" id="7997469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997473">t</span><span class="op" id="7997474">.</span><span class="ident" id="7997475">Errorf</span><span class="op" id="7997481">(</span><span class="string" id="7997482">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7997522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997525">}</span><br>
<span class="lineno"></span><span class="op" id="7997527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7997530">func</span>&nbsp;<span class="ident" id="7997535">TestFileHeaderRoundTrip</span><span class="op" id="7997558">(</span><span class="ident" id="7997559">t</span>&nbsp;<span class="op" id="7997561">*</span><span class="ident" id="7997562">testing</span><span class="op" id="7997569">.</span><span class="ident" id="7997570">T</span><span class="op" id="7997571">)</span>&nbsp;<span class="op" id="7997573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997576">fh</span>&nbsp;<span class="op" id="7997579">:=</span>&nbsp;<span class="op" id="7997582">&amp;</span><span class="ident" id="7997583">FileHeader</span><span class="op" id="7997593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997597">Name</span><span class="op" id="7997601">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7997615">&#34;foo.txt&#34;</span><span class="op" id="7997624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997628">UncompressedSize</span><span class="op" id="7997644">:</span>&nbsp;<span class="num" id="7997646">987654321</span><span class="op" id="7997655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997659">ModifiedTime</span><span class="op" id="7997671">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7997677">1234</span><span class="op" id="7997681">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997685">ModifiedDate</span><span class="op" id="7997697">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7997703">5678</span><span class="op" id="7997707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997713">testHeaderRoundTrip</span><span class="op" id="7997732">(</span><span class="ident" id="7997733">fh</span><span class="op" id="7997735">,</span>&nbsp;<span class="ident" id="7997737">fh</span><span class="op" id="7997739">.</span><span class="ident" id="7997740">UncompressedSize</span><span class="op" id="7997756">,</span>&nbsp;<span class="ident" id="7997758">uint64</span><span class="op" id="7997764">(</span><span class="ident" id="7997765">fh</span><span class="op" id="7997767">.</span><span class="ident" id="7997768">UncompressedSize</span><span class="op" id="7997784">)</span><span class="op" id="7997785">,</span>&nbsp;<span class="ident" id="7997787">t</span><span class="op" id="7997788">)</span><br>
<span class="lineno"></span><span class="op" id="7997790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7997793">func</span>&nbsp;<span class="ident" id="7997798">TestFileHeaderRoundTrip64</span><span class="op" id="7997823">(</span><span class="ident" id="7997824">t</span>&nbsp;<span class="op" id="7997826">*</span><span class="ident" id="7997827">testing</span><span class="op" id="7997834">.</span><span class="ident" id="7997835">T</span><span class="op" id="7997836">)</span>&nbsp;<span class="op" id="7997838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997841">fh</span>&nbsp;<span class="op" id="7997844">:=</span>&nbsp;<span class="op" id="7997847">&amp;</span><span class="ident" id="7997848">FileHeader</span><span class="op" id="7997858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997862">Name</span><span class="op" id="7997866">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7997882">&#34;foo.txt&#34;</span><span class="op" id="7997891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997895">UncompressedSize64</span><span class="op" id="7997913">:</span>&nbsp;<span class="num" id="7997915">9876543210</span><span class="op" id="7997925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997929">ModifiedTime</span><span class="op" id="7997941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7997949">1234</span><span class="op" id="7997953">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997957">ModifiedDate</span><span class="op" id="7997969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7997977">5678</span><span class="op" id="7997981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997987">testHeaderRoundTrip</span><span class="op" id="7998006">(</span><span class="ident" id="7998007">fh</span><span class="op" id="7998009">,</span>&nbsp;<span class="ident" id="7998011">uint32max</span><span class="op" id="7998020">,</span>&nbsp;<span class="ident" id="7998022">fh</span><span class="op" id="7998024">.</span><span class="ident" id="7998025">UncompressedSize64</span><span class="op" id="7998043">,</span>&nbsp;<span class="ident" id="7998045">t</span><span class="op" id="7998046">)</span><br>
<span class="lineno"></span><span class="op" id="7998048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7998051">type</span>&nbsp;<span class="ident" id="7998056">repeatedByte</span>&nbsp;<span class="keyword" id="7998069">struct</span>&nbsp;<span class="op" id="7998076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998079">off</span>&nbsp;<span class="ident" id="7998083">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998090">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7998094">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998100">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7998104">int64</span><br>
<span class="lineno"></span><span class="op" id="7998110">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7998113">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7998163">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7998231">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7998264">type</span>&nbsp;<span class="ident" id="7998269">rleBuffer</span>&nbsp;<span class="keyword" id="7998279">struct</span>&nbsp;<span class="op" id="7998286">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998289">buf</span>&nbsp;<span class="op" id="7998293">[</span><span class="op" id="7998294">]</span><span class="ident" id="7998295">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7998308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998311">func</span>&nbsp;<span class="op" id="7998316">(</span><span class="ident" id="7998317">r</span>&nbsp;<span class="op" id="7998319">*</span><span class="ident" id="7998320">rleBuffer</span><span class="op" id="7998329">)</span>&nbsp;<span class="ident" id="7998331">Size</span><span class="op" id="7998335">(</span><span class="op" id="7998336">)</span>&nbsp;<span class="ident" id="7998338">int64</span>&nbsp;<span class="op" id="7998344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998347">if</span>&nbsp;<span class="builtinfunc" id="7998350">len</span><span class="op" id="7998353">(</span><span class="ident" id="7998354">r</span><span class="op" id="7998355">.</span><span class="ident" id="7998356">buf</span><span class="op" id="7998359">)</span>&nbsp;<span class="op" id="7998361">==</span>&nbsp;<span class="num" id="7998364">0</span>&nbsp;<span class="op" id="7998366">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998370">return</span>&nbsp;<span class="num" id="7998377">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998383">last</span>&nbsp;<span class="op" id="7998388">:=</span>&nbsp;<span class="op" id="7998391">&amp;</span><span class="ident" id="7998392">r</span><span class="op" id="7998393">.</span><span class="ident" id="7998394">buf</span><span class="op" id="7998397">[</span><span class="builtinfunc" id="7998398">len</span><span class="op" id="7998401">(</span><span class="ident" id="7998402">r</span><span class="op" id="7998403">.</span><span class="ident" id="7998404">buf</span><span class="op" id="7998407">)</span><span class="op" id="7998408">-</span><span class="num" id="7998409">1</span><span class="op" id="7998410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998413">return</span>&nbsp;<span class="ident" id="7998420">last</span><span class="op" id="7998424">.</span><span class="ident" id="7998425">off</span>&nbsp;<span class="op" id="7998429">+</span>&nbsp;<span class="ident" id="7998431">last</span><span class="op" id="7998435">.</span><span class="ident" id="7998436">n</span><br>
<span class="lineno"></span><span class="op" id="7998438">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7998441">func</span>&nbsp;<span class="op" id="7998446">(</span><span class="ident" id="7998447">r</span>&nbsp;<span class="op" id="7998449">*</span><span class="ident" id="7998450">rleBuffer</span><span class="op" id="7998459">)</span>&nbsp;<span class="ident" id="7998461">Write</span><span class="op" id="7998466">(</span><span class="ident" id="7998467">p</span>&nbsp;<span class="op" id="7998469">[</span><span class="op" id="7998470">]</span><span class="builtintype" id="7998471">byte</span><span class="op" id="7998475">)</span>&nbsp;<span class="op" id="7998477">(</span><span class="ident" id="7998478">n</span>&nbsp;<span class="builtintype" id="7998480">int</span><span class="op" id="7998483">,</span>&nbsp;<span class="ident" id="7998485">err</span>&nbsp;<span class="builtintype" id="7998489">error</span><span class="op" id="7998494">)</span>&nbsp;<span class="op" id="7998496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998499">var</span>&nbsp;<span class="ident" id="7998503">rp</span>&nbsp;<span class="op" id="7998506">*</span><span class="ident" id="7998507">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998521">if</span>&nbsp;<span class="builtinfunc" id="7998524">len</span><span class="op" id="7998527">(</span><span class="ident" id="7998528">r</span><span class="op" id="7998529">.</span><span class="ident" id="7998530">buf</span><span class="op" id="7998533">)</span>&nbsp;<span class="op" id="7998535">&gt;</span>&nbsp;<span class="num" id="7998537">0</span>&nbsp;<span class="op" id="7998539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998543">rp</span>&nbsp;<span class="op" id="7998546">=</span>&nbsp;<span class="op" id="7998548">&amp;</span><span class="ident" id="7998549">r</span><span class="op" id="7998550">.</span><span class="ident" id="7998551">buf</span><span class="op" id="7998554">[</span><span class="builtinfunc" id="7998555">len</span><span class="op" id="7998558">(</span><span class="ident" id="7998559">r</span><span class="op" id="7998560">.</span><span class="ident" id="7998561">buf</span><span class="op" id="7998564">)</span><span class="op" id="7998565">-</span><span class="num" id="7998566">1</span><span class="op" id="7998567">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7998571">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998628">if</span>&nbsp;<span class="ident" id="7998631">lastByte</span>&nbsp;<span class="op" id="7998640">:=</span>&nbsp;<span class="ident" id="7998643">rp</span><span class="op" id="7998645">.</span><span class="ident" id="7998646">b</span><span class="op" id="7998647">;</span>&nbsp;<span class="builtinfunc" id="7998649">len</span><span class="op" id="7998652">(</span><span class="ident" id="7998653">p</span><span class="op" id="7998654">)</span>&nbsp;<span class="op" id="7998656">&gt;</span>&nbsp;<span class="num" id="7998658">0</span>&nbsp;<span class="op" id="7998660">&amp;&amp;</span>&nbsp;<span class="ident" id="7998663">p</span><span class="op" id="7998664">[</span><span class="num" id="7998665">0</span><span class="op" id="7998666">]</span>&nbsp;<span class="op" id="7998668">==</span>&nbsp;<span class="ident" id="7998671">lastByte</span>&nbsp;<span class="op" id="7998680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998685">all</span>&nbsp;<span class="op" id="7998689">:=</span>&nbsp;<span class="builtintype" id="7998692">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998700">for</span>&nbsp;<span class="ident" id="7998704">_</span><span class="op" id="7998705">,</span>&nbsp;<span class="ident" id="7998707">b</span>&nbsp;<span class="op" id="7998709">:=</span>&nbsp;<span class="keyword" id="7998712">range</span>&nbsp;<span class="ident" id="7998718">p</span>&nbsp;<span class="op" id="7998720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998726">if</span>&nbsp;<span class="ident" id="7998729">b</span>&nbsp;<span class="op" id="7998731">!=</span>&nbsp;<span class="ident" id="7998734">lastByte</span>&nbsp;<span class="op" id="7998743">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998750">all</span>&nbsp;<span class="op" id="7998754">=</span>&nbsp;<span class="builtintype" id="7998756">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998767">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998787">if</span>&nbsp;<span class="ident" id="7998790">all</span>&nbsp;<span class="op" id="7998794">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998800">rp</span><span class="op" id="7998802">.</span><span class="ident" id="7998803">n</span>&nbsp;<span class="op" id="7998805">+=</span>&nbsp;<span class="ident" id="7998808">int64</span><span class="op" id="7998813">(</span><span class="builtinfunc" id="7998814">len</span><span class="op" id="7998817">(</span><span class="ident" id="7998818">p</span><span class="op" id="7998819">)</span><span class="op" id="7998820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998826">return</span>&nbsp;<span class="builtinfunc" id="7998833">len</span><span class="op" id="7998836">(</span><span class="ident" id="7998837">p</span><span class="op" id="7998838">)</span><span class="op" id="7998839">,</span>&nbsp;<span class="ident" id="7998841">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998855">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998859">for</span>&nbsp;<span class="ident" id="7998863">_</span><span class="op" id="7998864">,</span>&nbsp;<span class="ident" id="7998866">b</span>&nbsp;<span class="op" id="7998868">:=</span>&nbsp;<span class="keyword" id="7998871">range</span>&nbsp;<span class="ident" id="7998877">p</span>&nbsp;<span class="op" id="7998879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998883">if</span>&nbsp;<span class="ident" id="7998886">rp</span>&nbsp;<span class="op" id="7998889">==</span>&nbsp;<span class="ident" id="7998892">nil</span>&nbsp;<span class="op" id="7998896">||</span>&nbsp;<span class="ident" id="7998899">rp</span><span class="op" id="7998901">.</span><span class="ident" id="7998902">b</span>&nbsp;<span class="op" id="7998904">!=</span>&nbsp;<span class="ident" id="7998907">b</span>&nbsp;<span class="op" id="7998909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998914">r</span><span class="op" id="7998915">.</span><span class="ident" id="7998916">buf</span>&nbsp;<span class="op" id="7998920">=</span>&nbsp;<span class="builtinfunc" id="7998922">append</span><span class="op" id="7998928">(</span><span class="ident" id="7998929">r</span><span class="op" id="7998930">.</span><span class="ident" id="7998931">buf</span><span class="op" id="7998934">,</span>&nbsp;<span class="ident" id="7998936">repeatedByte</span><span class="op" id="7998948">{</span><span class="ident" id="7998949">r</span><span class="op" id="7998950">.</span><span class="ident" id="7998951">Size</span><span class="op" id="7998955">(</span><span class="op" id="7998956">)</span><span class="op" id="7998957">,</span>&nbsp;<span class="ident" id="7998959">b</span><span class="op" id="7998960">,</span>&nbsp;<span class="num" id="7998962">1</span><span class="op" id="7998963">}</span><span class="op" id="7998964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998969">rp</span>&nbsp;<span class="op" id="7998972">=</span>&nbsp;<span class="op" id="7998974">&amp;</span><span class="ident" id="7998975">r</span><span class="op" id="7998976">.</span><span class="ident" id="7998977">buf</span><span class="op" id="7998980">[</span><span class="builtinfunc" id="7998981">len</span><span class="op" id="7998984">(</span><span class="ident" id="7998985">r</span><span class="op" id="7998986">.</span><span class="ident" id="7998987">buf</span><span class="op" id="7998990">)</span><span class="op" id="7998991">-</span><span class="num" id="7998992">1</span><span class="op" id="7998993">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998997">}</span>&nbsp;<span class="keyword" id="7998999">else</span>&nbsp;<span class="op" id="7999004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999009">rp</span><span class="op" id="7999011">.</span><span class="ident" id="7999012">n</span><span class="op" id="7999013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999024">return</span>&nbsp;<span class="builtinfunc" id="7999031">len</span><span class="op" id="7999034">(</span><span class="ident" id="7999035">p</span><span class="op" id="7999036">)</span><span class="op" id="7999037">,</span>&nbsp;<span class="ident" id="7999039">nil</span><br>
<span class="lineno">160</span><span class="op" id="7999043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7999046">func</span>&nbsp;<span class="op" id="7999051">(</span><span class="ident" id="7999052">r</span>&nbsp;<span class="op" id="7999054">*</span><span class="ident" id="7999055">rleBuffer</span><span class="op" id="7999064">)</span>&nbsp;<span class="ident" id="7999066">ReadAt</span><span class="op" id="7999072">(</span><span class="ident" id="7999073">p</span>&nbsp;<span class="op" id="7999075">[</span><span class="op" id="7999076">]</span><span class="builtintype" id="7999077">byte</span><span class="op" id="7999081">,</span>&nbsp;<span class="ident" id="7999083">off</span>&nbsp;<span class="ident" id="7999087">int64</span><span class="op" id="7999092">)</span>&nbsp;<span class="op" id="7999094">(</span><span class="ident" id="7999095">n</span>&nbsp;<span class="builtintype" id="7999097">int</span><span class="op" id="7999100">,</span>&nbsp;<span class="ident" id="7999102">err</span>&nbsp;<span class="builtintype" id="7999106">error</span><span class="op" id="7999111">)</span>&nbsp;<span class="op" id="7999113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999116">if</span>&nbsp;<span class="builtinfunc" id="7999119">len</span><span class="op" id="7999122">(</span><span class="ident" id="7999123">p</span><span class="op" id="7999124">)</span>&nbsp;<span class="op" id="7999126">==</span>&nbsp;<span class="num" id="7999129">0</span>&nbsp;<span class="op" id="7999131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999135">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999146">skipParts</span>&nbsp;<span class="op" id="7999156">:=</span>&nbsp;<span class="ident" id="7999159">sort</span><span class="op" id="7999163">.</span><span class="ident" id="7999164">Search</span><span class="op" id="7999170">(</span><span class="builtinfunc" id="7999171">len</span><span class="op" id="7999174">(</span><span class="ident" id="7999175">r</span><span class="op" id="7999176">.</span><span class="ident" id="7999177">buf</span><span class="op" id="7999180">)</span><span class="op" id="7999181">,</span>&nbsp;<span class="keyword" id="7999183">func</span><span class="op" id="7999187">(</span><span class="ident" id="7999188">i</span>&nbsp;<span class="builtintype" id="7999190">int</span><span class="op" id="7999193">)</span>&nbsp;<span class="builtintype" id="7999195">bool</span>&nbsp;<span class="op" id="7999200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999204">part</span>&nbsp;<span class="op" id="7999209">:=</span>&nbsp;<span class="op" id="7999212">&amp;</span><span class="ident" id="7999213">r</span><span class="op" id="7999214">.</span><span class="ident" id="7999215">buf</span><span class="op" id="7999218">[</span><span class="ident" id="7999219">i</span><span class="op" id="7999220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999224">return</span>&nbsp;<span class="ident" id="7999231">part</span><span class="op" id="7999235">.</span><span class="ident" id="7999236">off</span><span class="op" id="7999239">+</span><span class="ident" id="7999240">part</span><span class="op" id="7999244">.</span><span class="ident" id="7999245">n</span>&nbsp;<span class="op" id="7999247">&gt;</span>&nbsp;<span class="ident" id="7999249">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999254">}</span><span class="op" id="7999255">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999258">parts</span>&nbsp;<span class="op" id="7999264">:=</span>&nbsp;<span class="ident" id="7999267">r</span><span class="op" id="7999268">.</span><span class="ident" id="7999269">buf</span><span class="op" id="7999272">[</span><span class="ident" id="7999273">skipParts</span><span class="op" id="7999282">:</span><span class="op" id="7999283">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999286">if</span>&nbsp;<span class="builtinfunc" id="7999289">len</span><span class="op" id="7999292">(</span><span class="ident" id="7999293">parts</span><span class="op" id="7999298">)</span>&nbsp;<span class="op" id="7999300">&gt;</span>&nbsp;<span class="num" id="7999302">0</span>&nbsp;<span class="op" id="7999304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999308">skipBytes</span>&nbsp;<span class="op" id="7999318">:=</span>&nbsp;<span class="ident" id="7999321">off</span>&nbsp;<span class="op" id="7999325">-</span>&nbsp;<span class="ident" id="7999327">parts</span><span class="op" id="7999332">[</span><span class="num" id="7999333">0</span><span class="op" id="7999334">]</span><span class="op" id="7999335">.</span><span class="ident" id="7999336">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999342">for</span>&nbsp;<span class="builtinfunc" id="7999346">len</span><span class="op" id="7999349">(</span><span class="ident" id="7999350">parts</span><span class="op" id="7999355">)</span>&nbsp;<span class="op" id="7999357">&gt;</span>&nbsp;<span class="num" id="7999359">0</span>&nbsp;<span class="op" id="7999361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999366">part</span>&nbsp;<span class="op" id="7999371">:=</span>&nbsp;<span class="ident" id="7999374">parts</span><span class="op" id="7999379">[</span><span class="num" id="7999380">0</span><span class="op" id="7999381">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999386">for</span>&nbsp;<span class="ident" id="7999390">i</span>&nbsp;<span class="op" id="7999392">:=</span>&nbsp;<span class="ident" id="7999395">skipBytes</span><span class="op" id="7999404">;</span>&nbsp;<span class="ident" id="7999406">i</span>&nbsp;<span class="op" id="7999408">&lt;</span>&nbsp;<span class="ident" id="7999410">part</span><span class="op" id="7999414">.</span><span class="ident" id="7999415">n</span><span class="op" id="7999416">;</span>&nbsp;<span class="ident" id="7999418">i</span><span class="op" id="7999419">++</span>&nbsp;<span class="op" id="7999422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999428">if</span>&nbsp;<span class="ident" id="7999431">n</span>&nbsp;<span class="op" id="7999433">==</span>&nbsp;<span class="builtinfunc" id="7999436">len</span><span class="op" id="7999439">(</span><span class="ident" id="7999440">p</span><span class="op" id="7999441">)</span>&nbsp;<span class="op" id="7999443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999467">p</span><span class="op" id="7999468">[</span><span class="ident" id="7999469">n</span><span class="op" id="7999470">]</span>&nbsp;<span class="op" id="7999472">=</span>&nbsp;<span class="ident" id="7999474">part</span><span class="op" id="7999478">.</span><span class="ident" id="7999479">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999485">n</span><span class="op" id="7999486">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999497">parts</span>&nbsp;<span class="op" id="7999503">=</span>&nbsp;<span class="ident" id="7999505">parts</span><span class="op" id="7999510">[</span><span class="num" id="7999511">1</span><span class="op" id="7999512">:</span><span class="op" id="7999513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999518">skipBytes</span>&nbsp;<span class="op" id="7999528">=</span>&nbsp;<span class="num" id="7999530">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999534">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999540">if</span>&nbsp;<span class="ident" id="7999543">n</span>&nbsp;<span class="op" id="7999545">!=</span>&nbsp;<span class="builtinfunc" id="7999548">len</span><span class="op" id="7999551">(</span><span class="ident" id="7999552">p</span><span class="op" id="7999553">)</span>&nbsp;<span class="op" id="7999555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999559">err</span>&nbsp;<span class="op" id="7999563">=</span>&nbsp;<span class="ident" id="7999565">io</span><span class="op" id="7999567">.</span><span class="ident" id="7999568">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999589">return</span><br>
<span class="lineno">190</span><span class="op" id="7999596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7999599">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7999685">func</span>&nbsp;<span class="ident" id="7999690">TestRLEBuffer</span><span class="op" id="7999703">(</span><span class="ident" id="7999704">t</span>&nbsp;<span class="op" id="7999706">*</span><span class="ident" id="7999707">testing</span><span class="op" id="7999714">.</span><span class="ident" id="7999715">T</span><span class="op" id="7999716">)</span>&nbsp;<span class="op" id="7999718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999721">b</span>&nbsp;<span class="op" id="7999723">:=</span>&nbsp;<span class="builtinfunc" id="7999726">new</span><span class="op" id="7999729">(</span><span class="ident" id="7999730">rleBuffer</span><span class="op" id="7999739">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999742">var</span>&nbsp;<span class="ident" id="7999746">all</span>&nbsp;<span class="op" id="7999750">[</span><span class="op" id="7999751">]</span><span class="builtintype" id="7999752">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999758">writes</span>&nbsp;<span class="op" id="7999765">:=</span>&nbsp;<span class="op" id="7999768">[</span><span class="op" id="7999769">]</span><span class="builtintype" id="7999770">string</span><span class="op" id="7999776">{</span><span class="string" id="7999777">&#34;abcdeee&#34;</span><span class="op" id="7999786">,</span>&nbsp;<span class="string" id="7999788">&#34;eeeeeee&#34;</span><span class="op" id="7999797">,</span>&nbsp;<span class="string" id="7999799">&#34;eeeefghaaiii&#34;</span><span class="op" id="7999813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999816">for</span>&nbsp;<span class="ident" id="7999820">_</span><span class="op" id="7999821">,</span>&nbsp;<span class="ident" id="7999823">w</span>&nbsp;<span class="op" id="7999825">:=</span>&nbsp;<span class="keyword" id="7999828">range</span>&nbsp;<span class="ident" id="7999834">writes</span>&nbsp;<span class="op" id="7999841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999845">b</span><span class="op" id="7999846">.</span><span class="ident" id="7999847">Write</span><span class="op" id="7999852">(</span><span class="op" id="7999853">[</span><span class="op" id="7999854">]</span><span class="builtintype" id="7999855">byte</span><span class="op" id="7999859">(</span><span class="ident" id="7999860">w</span><span class="op" id="7999861">)</span><span class="op" id="7999862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999866">all</span>&nbsp;<span class="op" id="7999870">=</span>&nbsp;<span class="builtinfunc" id="7999872">append</span><span class="op" id="7999878">(</span><span class="ident" id="7999879">all</span><span class="op" id="7999882">,</span>&nbsp;<span class="ident" id="7999884">w</span><span class="op" id="7999885">...</span><span class="op" id="7999888">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999894">if</span>&nbsp;<span class="builtinfunc" id="7999897">len</span><span class="op" id="7999900">(</span><span class="ident" id="7999901">b</span><span class="op" id="7999902">.</span><span class="ident" id="7999903">buf</span><span class="op" id="7999906">)</span>&nbsp;<span class="op" id="7999908">!=</span>&nbsp;<span class="num" id="7999911">10</span>&nbsp;<span class="op" id="7999914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999918">t</span><span class="op" id="7999919">.</span><span class="ident" id="7999920">Fatalf</span><span class="op" id="7999926">(</span><span class="string" id="7999927">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7999953">,</span>&nbsp;<span class="builtinfunc" id="7999955">len</span><span class="op" id="7999958">(</span><span class="ident" id="7999959">b</span><span class="op" id="7999960">.</span><span class="ident" id="7999961">buf</span><span class="op" id="7999964">)</span><span class="op" id="7999965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999972">for</span>&nbsp;<span class="ident" id="7999976">i</span>&nbsp;<span class="op" id="7999978">:=</span>&nbsp;<span class="num" id="7999981">0</span><span class="op" id="7999982">;</span>&nbsp;<span class="ident" id="7999984">i</span>&nbsp;<span class="op" id="7999986">&lt;</span>&nbsp;<span class="builtinfunc" id="7999988">len</span><span class="op" id="7999991">(</span><span class="ident" id="7999992">all</span><span class="op" id="7999995">)</span><span class="op" id="7999996">;</span>&nbsp;<span class="ident" id="7999998">i</span><span class="op" id="7999999">++</span>&nbsp;<span class="op" id="8000002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000006">for</span>&nbsp;<span class="ident" id="8000010">j</span>&nbsp;<span class="op" id="8000012">:=</span>&nbsp;<span class="num" id="8000015">0</span><span class="op" id="8000016">;</span>&nbsp;<span class="ident" id="8000018">j</span>&nbsp;<span class="op" id="8000020">&lt;</span>&nbsp;<span class="builtinfunc" id="8000022">len</span><span class="op" id="8000025">(</span><span class="ident" id="8000026">all</span><span class="op" id="8000029">)</span><span class="op" id="8000030">-</span><span class="ident" id="8000031">i</span><span class="op" id="8000032">;</span>&nbsp;<span class="ident" id="8000034">j</span><span class="op" id="8000035">++</span>&nbsp;<span class="op" id="8000038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000043">buf</span>&nbsp;<span class="op" id="8000047">:=</span>&nbsp;<span class="builtinfunc" id="8000050">make</span><span class="op" id="8000054">(</span><span class="op" id="8000055">[</span><span class="op" id="8000056">]</span><span class="builtintype" id="8000057">byte</span><span class="op" id="8000061">,</span>&nbsp;<span class="ident" id="8000063">j</span><span class="op" id="8000064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000069">n</span><span class="op" id="8000070">,</span>&nbsp;<span class="ident" id="8000072">err</span>&nbsp;<span class="op" id="8000076">:=</span>&nbsp;<span class="ident" id="8000079">b</span><span class="op" id="8000080">.</span><span class="ident" id="8000081">ReadAt</span><span class="op" id="8000087">(</span><span class="ident" id="8000088">buf</span><span class="op" id="8000091">,</span>&nbsp;<span class="ident" id="8000093">int64</span><span class="op" id="8000098">(</span><span class="ident" id="8000099">i</span><span class="op" id="8000100">)</span><span class="op" id="8000101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000106">if</span>&nbsp;<span class="ident" id="8000109">err</span>&nbsp;<span class="op" id="8000113">!=</span>&nbsp;<span class="ident" id="8000116">nil</span>&nbsp;<span class="op" id="8000120">||</span>&nbsp;<span class="ident" id="8000123">n</span>&nbsp;<span class="op" id="8000125">!=</span>&nbsp;<span class="builtinfunc" id="8000128">len</span><span class="op" id="8000131">(</span><span class="ident" id="8000132">buf</span><span class="op" id="8000135">)</span>&nbsp;<span class="op" id="8000137">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000143">t</span><span class="op" id="8000144">.</span><span class="ident" id="8000145">Errorf</span><span class="op" id="8000151">(</span><span class="string" id="8000152">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8000191">,</span>&nbsp;<span class="ident" id="8000193">i</span><span class="op" id="8000194">,</span>&nbsp;<span class="ident" id="8000196">j</span><span class="op" id="8000197">,</span>&nbsp;<span class="ident" id="8000199">n</span><span class="op" id="8000200">,</span>&nbsp;<span class="ident" id="8000202">err</span><span class="op" id="8000205">,</span>&nbsp;<span class="builtinfunc" id="8000207">len</span><span class="op" id="8000210">(</span><span class="ident" id="8000211">buf</span><span class="op" id="8000214">)</span><span class="op" id="8000215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000225">if</span>&nbsp;<span class="op" id="8000228">!</span><span class="ident" id="8000229">bytes</span><span class="op" id="8000234">.</span><span class="ident" id="8000235">Equal</span><span class="op" id="8000240">(</span><span class="ident" id="8000241">buf</span><span class="op" id="8000244">,</span>&nbsp;<span class="ident" id="8000246">all</span><span class="op" id="8000249">[</span><span class="ident" id="8000250">i</span><span class="op" id="8000251">:</span><span class="ident" id="8000252">i</span><span class="op" id="8000253">+</span><span class="ident" id="8000254">j</span><span class="op" id="8000255">]</span><span class="op" id="8000256">)</span>&nbsp;<span class="op" id="8000258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000264">t</span><span class="op" id="8000265">.</span><span class="ident" id="8000266">Errorf</span><span class="op" id="8000272">(</span><span class="string" id="8000273">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8000303">,</span>&nbsp;<span class="ident" id="8000305">i</span><span class="op" id="8000306">,</span>&nbsp;<span class="ident" id="8000308">j</span><span class="op" id="8000309">,</span>&nbsp;<span class="ident" id="8000311">buf</span><span class="op" id="8000314">,</span>&nbsp;<span class="ident" id="8000316">all</span><span class="op" id="8000319">[</span><span class="ident" id="8000320">i</span><span class="op" id="8000321">:</span><span class="ident" id="8000322">i</span><span class="op" id="8000323">+</span><span class="ident" id="8000324">j</span><span class="op" id="8000325">]</span><span class="op" id="8000326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000331">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000338">}</span><br>
<span class="lineno"></span><span class="op" id="8000340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8000343">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="8000398">type</span>&nbsp;<span class="ident" id="8000403">fakeHash32</span>&nbsp;<span class="keyword" id="8000414">struct</span>&nbsp;<span class="op" id="8000421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000424">hash</span><span class="op" id="8000428">.</span><span class="ident" id="8000429">Hash32</span><br>
<span class="lineno"></span><span class="op" id="8000436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8000439">func</span>&nbsp;<span class="op" id="8000444">(</span><span class="ident" id="8000445">fakeHash32</span><span class="op" id="8000455">)</span>&nbsp;<span class="ident" id="8000457">Write</span><span class="op" id="8000462">(</span><span class="ident" id="8000463">p</span>&nbsp;<span class="op" id="8000465">[</span><span class="op" id="8000466">]</span><span class="builtintype" id="8000467">byte</span><span class="op" id="8000471">)</span>&nbsp;<span class="op" id="8000473">(</span><span class="builtintype" id="8000474">int</span><span class="op" id="8000477">,</span>&nbsp;<span class="builtintype" id="8000479">error</span><span class="op" id="8000484">)</span>&nbsp;<span class="op" id="8000486">{</span>&nbsp;<span class="keyword" id="8000488">return</span>&nbsp;<span class="builtinfunc" id="8000495">len</span><span class="op" id="8000498">(</span><span class="ident" id="8000499">p</span><span class="op" id="8000500">)</span><span class="op" id="8000501">,</span>&nbsp;<span class="ident" id="8000503">nil</span>&nbsp;<span class="op" id="8000507">}</span><br>
<span class="lineno">225</span><span class="keyword" id="8000509">func</span>&nbsp;<span class="op" id="8000514">(</span><span class="ident" id="8000515">fakeHash32</span><span class="op" id="8000525">)</span>&nbsp;<span class="ident" id="8000527">Sum32</span><span class="op" id="8000532">(</span><span class="op" id="8000533">)</span>&nbsp;<span class="builtintype" id="8000535">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8000556">{</span>&nbsp;<span class="keyword" id="8000558">return</span>&nbsp;<span class="num" id="8000565">0</span>&nbsp;<span class="op" id="8000567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8000570">func</span>&nbsp;<span class="ident" id="8000575">TestZip64</span><span class="op" id="8000584">(</span><span class="ident" id="8000585">t</span>&nbsp;<span class="op" id="8000587">*</span><span class="ident" id="8000588">testing</span><span class="op" id="8000595">.</span><span class="ident" id="8000596">T</span><span class="op" id="8000597">)</span>&nbsp;<span class="op" id="8000599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000602">if</span>&nbsp;<span class="ident" id="8000605">testing</span><span class="op" id="8000612">.</span><span class="ident" id="8000613">Short</span><span class="op" id="8000618">(</span><span class="op" id="8000619">)</span>&nbsp;<span class="op" id="8000621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000625">t</span><span class="op" id="8000626">.</span><span class="ident" id="8000627">Skip</span><span class="op" id="8000631">(</span><span class="string" id="8000632">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="8000653">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000659">const</span>&nbsp;<span class="ident" id="8000665">size</span>&nbsp;<span class="op" id="8000670">=</span>&nbsp;<span class="num" id="8000672">1</span>&nbsp;<span class="op" id="8000674">&lt;&lt;</span>&nbsp;<span class="num" id="8000677">32</span>&nbsp;<span class="comment" id="8000680">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000708">testZip64</span><span class="op" id="8000717">(</span><span class="ident" id="8000718">t</span><span class="op" id="8000719">,</span>&nbsp;<span class="ident" id="8000721">size</span><span class="op" id="8000725">)</span><br>
<span class="lineno"></span><span class="op" id="8000727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="8000730">func</span>&nbsp;<span class="ident" id="8000735">testZip64</span><span class="op" id="8000744">(</span><span class="ident" id="8000745">t</span>&nbsp;<span class="ident" id="8000747">testing</span><span class="op" id="8000754">.</span><span class="ident" id="8000755">TB</span><span class="op" id="8000757">,</span>&nbsp;<span class="ident" id="8000759">size</span>&nbsp;<span class="ident" id="8000764">int64</span><span class="op" id="8000769">)</span>&nbsp;<span class="op" id="8000771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000774">const</span>&nbsp;<span class="ident" id="8000780">chunkSize</span>&nbsp;<span class="op" id="8000790">=</span>&nbsp;<span class="num" id="8000792">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000798">chunks</span>&nbsp;<span class="op" id="8000805">:=</span>&nbsp;<span class="builtintype" id="8000808">int</span><span class="op" id="8000811">(</span><span class="ident" id="8000812">size</span>&nbsp;<span class="op" id="8000817">/</span>&nbsp;<span class="ident" id="8000819">chunkSize</span><span class="op" id="8000828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8000831">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000879">buf</span>&nbsp;<span class="op" id="8000883">:=</span>&nbsp;<span class="builtinfunc" id="8000886">new</span><span class="op" id="8000889">(</span><span class="ident" id="8000890">rleBuffer</span><span class="op" id="8000899">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000902">w</span>&nbsp;<span class="op" id="8000904">:=</span>&nbsp;<span class="ident" id="8000907">NewWriter</span><span class="op" id="8000916">(</span><span class="ident" id="8000917">buf</span><span class="op" id="8000920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000923">f</span><span class="op" id="8000924">,</span>&nbsp;<span class="ident" id="8000926">err</span>&nbsp;<span class="op" id="8000930">:=</span>&nbsp;<span class="ident" id="8000933">w</span><span class="op" id="8000934">.</span><span class="ident" id="8000935">CreateHeader</span><span class="op" id="8000947">(</span><span class="op" id="8000948">&amp;</span><span class="ident" id="8000949">FileHeader</span><span class="op" id="8000959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000963">Name</span><span class="op" id="8000967">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8000971">&#34;huge.txt&#34;</span><span class="op" id="8000981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000985">Method</span><span class="op" id="8000991">:</span>&nbsp;<span class="ident" id="8000993">Store</span><span class="op" id="8000998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001001">}</span><span class="op" id="8001002">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001005">if</span>&nbsp;<span class="ident" id="8001008">err</span>&nbsp;<span class="op" id="8001012">!=</span>&nbsp;<span class="ident" id="8001015">nil</span>&nbsp;<span class="op" id="8001019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001023">t</span><span class="op" id="8001024">.</span><span class="ident" id="8001025">Fatal</span><span class="op" id="8001030">(</span><span class="ident" id="8001031">err</span><span class="op" id="8001034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001040">f</span><span class="op" id="8001041">.</span><span class="op" id="8001042">(</span><span class="op" id="8001043">*</span><span class="ident" id="8001044">fileWriter</span><span class="op" id="8001054">)</span><span class="op" id="8001055">.</span><span class="ident" id="8001056">crc32</span>&nbsp;<span class="op" id="8001062">=</span>&nbsp;<span class="ident" id="8001064">fakeHash32</span><span class="op" id="8001074">{</span><span class="op" id="8001075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001078">chunk</span>&nbsp;<span class="op" id="8001084">:=</span>&nbsp;<span class="builtinfunc" id="8001087">make</span><span class="op" id="8001091">(</span><span class="op" id="8001092">[</span><span class="op" id="8001093">]</span><span class="builtintype" id="8001094">byte</span><span class="op" id="8001098">,</span>&nbsp;<span class="ident" id="8001100">chunkSize</span><span class="op" id="8001109">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001112">for</span>&nbsp;<span class="ident" id="8001116">i</span>&nbsp;<span class="op" id="8001118">:=</span>&nbsp;<span class="keyword" id="8001121">range</span>&nbsp;<span class="ident" id="8001127">chunk</span>&nbsp;<span class="op" id="8001133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001137">chunk</span><span class="op" id="8001142">[</span><span class="ident" id="8001143">i</span><span class="op" id="8001144">]</span>&nbsp;<span class="op" id="8001146">=</span>&nbsp;<span class="string" id="8001148">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001156">for</span>&nbsp;<span class="ident" id="8001160">i</span>&nbsp;<span class="op" id="8001162">:=</span>&nbsp;<span class="num" id="8001165">0</span><span class="op" id="8001166">;</span>&nbsp;<span class="ident" id="8001168">i</span>&nbsp;<span class="op" id="8001170">&lt;</span>&nbsp;<span class="ident" id="8001172">chunks</span><span class="op" id="8001178">;</span>&nbsp;<span class="ident" id="8001180">i</span><span class="op" id="8001181">++</span>&nbsp;<span class="op" id="8001184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001188">_</span><span class="op" id="8001189">,</span>&nbsp;<span class="ident" id="8001191">err</span>&nbsp;<span class="op" id="8001195">:=</span>&nbsp;<span class="ident" id="8001198">f</span><span class="op" id="8001199">.</span><span class="ident" id="8001200">Write</span><span class="op" id="8001205">(</span><span class="ident" id="8001206">chunk</span><span class="op" id="8001211">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001215">if</span>&nbsp;<span class="ident" id="8001218">err</span>&nbsp;<span class="op" id="8001222">!=</span>&nbsp;<span class="ident" id="8001225">nil</span>&nbsp;<span class="op" id="8001229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001234">t</span><span class="op" id="8001235">.</span><span class="ident" id="8001236">Fatal</span><span class="op" id="8001241">(</span><span class="string" id="8001242">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="8001256">,</span>&nbsp;<span class="ident" id="8001258">err</span><span class="op" id="8001261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001271">end</span>&nbsp;<span class="op" id="8001275">:=</span>&nbsp;<span class="op" id="8001278">[</span><span class="op" id="8001279">]</span><span class="builtintype" id="8001280">byte</span><span class="op" id="8001284">(</span><span class="string" id="8001285">&#34;END\n&#34;</span><span class="op" id="8001292">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001295">_</span><span class="op" id="8001296">,</span>&nbsp;<span class="ident" id="8001298">err</span>&nbsp;<span class="op" id="8001302">=</span>&nbsp;<span class="ident" id="8001304">f</span><span class="op" id="8001305">.</span><span class="ident" id="8001306">Write</span><span class="op" id="8001311">(</span><span class="ident" id="8001312">end</span><span class="op" id="8001315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001318">if</span>&nbsp;<span class="ident" id="8001321">err</span>&nbsp;<span class="op" id="8001325">!=</span>&nbsp;<span class="ident" id="8001328">nil</span>&nbsp;<span class="op" id="8001332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001336">t</span><span class="op" id="8001337">.</span><span class="ident" id="8001338">Fatal</span><span class="op" id="8001343">(</span><span class="string" id="8001344">&#34;write&nbsp;end:&#34;</span><span class="op" id="8001356">,</span>&nbsp;<span class="ident" id="8001358">err</span><span class="op" id="8001361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001367">if</span>&nbsp;<span class="ident" id="8001370">err</span>&nbsp;<span class="op" id="8001374">:=</span>&nbsp;<span class="ident" id="8001377">w</span><span class="op" id="8001378">.</span><span class="ident" id="8001379">Close</span><span class="op" id="8001384">(</span><span class="op" id="8001385">)</span><span class="op" id="8001386">;</span>&nbsp;<span class="ident" id="8001388">err</span>&nbsp;<span class="op" id="8001392">!=</span>&nbsp;<span class="ident" id="8001395">nil</span>&nbsp;<span class="op" id="8001399">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001403">t</span><span class="op" id="8001404">.</span><span class="ident" id="8001405">Fatal</span><span class="op" id="8001410">(</span><span class="ident" id="8001411">err</span><span class="op" id="8001414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8001421">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001483">r</span><span class="op" id="8001484">,</span>&nbsp;<span class="ident" id="8001486">err</span>&nbsp;<span class="op" id="8001490">:=</span>&nbsp;<span class="ident" id="8001493">NewReader</span><span class="op" id="8001502">(</span><span class="ident" id="8001503">buf</span><span class="op" id="8001506">,</span>&nbsp;<span class="ident" id="8001508">int64</span><span class="op" id="8001513">(</span><span class="ident" id="8001514">buf</span><span class="op" id="8001517">.</span><span class="ident" id="8001518">Size</span><span class="op" id="8001522">(</span><span class="op" id="8001523">)</span><span class="op" id="8001524">)</span><span class="op" id="8001525">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001528">if</span>&nbsp;<span class="ident" id="8001531">err</span>&nbsp;<span class="op" id="8001535">!=</span>&nbsp;<span class="ident" id="8001538">nil</span>&nbsp;<span class="op" id="8001542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001546">t</span><span class="op" id="8001547">.</span><span class="ident" id="8001548">Fatal</span><span class="op" id="8001553">(</span><span class="string" id="8001554">&#34;reader:&#34;</span><span class="op" id="8001563">,</span>&nbsp;<span class="ident" id="8001565">err</span><span class="op" id="8001568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001574">f0</span>&nbsp;<span class="op" id="8001577">:=</span>&nbsp;<span class="ident" id="8001580">r</span><span class="op" id="8001581">.</span><span class="ident" id="8001582">File</span><span class="op" id="8001586">[</span><span class="num" id="8001587">0</span><span class="op" id="8001588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001591">rc</span><span class="op" id="8001593">,</span>&nbsp;<span class="ident" id="8001595">err</span>&nbsp;<span class="op" id="8001599">:=</span>&nbsp;<span class="ident" id="8001602">f0</span><span class="op" id="8001604">.</span><span class="ident" id="8001605">Open</span><span class="op" id="8001609">(</span><span class="op" id="8001610">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001613">if</span>&nbsp;<span class="ident" id="8001616">err</span>&nbsp;<span class="op" id="8001620">!=</span>&nbsp;<span class="ident" id="8001623">nil</span>&nbsp;<span class="op" id="8001627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001631">t</span><span class="op" id="8001632">.</span><span class="ident" id="8001633">Fatal</span><span class="op" id="8001638">(</span><span class="string" id="8001639">&#34;opening:&#34;</span><span class="op" id="8001649">,</span>&nbsp;<span class="ident" id="8001651">err</span><span class="op" id="8001654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001660">rc</span><span class="op" id="8001662">.</span><span class="op" id="8001663">(</span><span class="op" id="8001664">*</span><span class="ident" id="8001665">checksumReader</span><span class="op" id="8001679">)</span><span class="op" id="8001680">.</span><span class="ident" id="8001681">hash</span>&nbsp;<span class="op" id="8001686">=</span>&nbsp;<span class="ident" id="8001688">fakeHash32</span><span class="op" id="8001698">{</span><span class="op" id="8001699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001702">for</span>&nbsp;<span class="ident" id="8001706">i</span>&nbsp;<span class="op" id="8001708">:=</span>&nbsp;<span class="num" id="8001711">0</span><span class="op" id="8001712">;</span>&nbsp;<span class="ident" id="8001714">i</span>&nbsp;<span class="op" id="8001716">&lt;</span>&nbsp;<span class="ident" id="8001718">chunks</span><span class="op" id="8001724">;</span>&nbsp;<span class="ident" id="8001726">i</span><span class="op" id="8001727">++</span>&nbsp;<span class="op" id="8001730">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001734">_</span><span class="op" id="8001735">,</span>&nbsp;<span class="ident" id="8001737">err</span>&nbsp;<span class="op" id="8001741">:=</span>&nbsp;<span class="ident" id="8001744">io</span><span class="op" id="8001746">.</span><span class="ident" id="8001747">ReadFull</span><span class="op" id="8001755">(</span><span class="ident" id="8001756">rc</span><span class="op" id="8001758">,</span>&nbsp;<span class="ident" id="8001760">chunk</span><span class="op" id="8001765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001769">if</span>&nbsp;<span class="ident" id="8001772">err</span>&nbsp;<span class="op" id="8001776">!=</span>&nbsp;<span class="ident" id="8001779">nil</span>&nbsp;<span class="op" id="8001783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001788">t</span><span class="op" id="8001789">.</span><span class="ident" id="8001790">Fatal</span><span class="op" id="8001795">(</span><span class="string" id="8001796">&#34;read:&#34;</span><span class="op" id="8001803">,</span>&nbsp;<span class="ident" id="8001805">err</span><span class="op" id="8001808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001815">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001818">gotEnd</span><span class="op" id="8001824">,</span>&nbsp;<span class="ident" id="8001826">err</span>&nbsp;<span class="op" id="8001830">:=</span>&nbsp;<span class="ident" id="8001833">ioutil</span><span class="op" id="8001839">.</span><span class="ident" id="8001840">ReadAll</span><span class="op" id="8001847">(</span><span class="ident" id="8001848">rc</span><span class="op" id="8001850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001853">if</span>&nbsp;<span class="ident" id="8001856">err</span>&nbsp;<span class="op" id="8001860">!=</span>&nbsp;<span class="ident" id="8001863">nil</span>&nbsp;<span class="op" id="8001867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001871">t</span><span class="op" id="8001872">.</span><span class="ident" id="8001873">Fatal</span><span class="op" id="8001878">(</span><span class="string" id="8001879">&#34;read&nbsp;end:&#34;</span><span class="op" id="8001890">,</span>&nbsp;<span class="ident" id="8001892">err</span><span class="op" id="8001895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001901">if</span>&nbsp;<span class="op" id="8001904">!</span><span class="ident" id="8001905">bytes</span><span class="op" id="8001910">.</span><span class="ident" id="8001911">Equal</span><span class="op" id="8001916">(</span><span class="ident" id="8001917">gotEnd</span><span class="op" id="8001923">,</span>&nbsp;<span class="ident" id="8001925">end</span><span class="op" id="8001928">)</span>&nbsp;<span class="op" id="8001930">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001934">t</span><span class="op" id="8001935">.</span><span class="ident" id="8001936">Errorf</span><span class="op" id="8001942">(</span><span class="string" id="8001943">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8001977">,</span>&nbsp;<span class="ident" id="8001979">gotEnd</span><span class="op" id="8001985">,</span>&nbsp;<span class="ident" id="8001987">end</span><span class="op" id="8001990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001996">err</span>&nbsp;<span class="op" id="8002000">=</span>&nbsp;<span class="ident" id="8002002">rc</span><span class="op" id="8002004">.</span><span class="ident" id="8002005">Close</span><span class="op" id="8002010">(</span><span class="op" id="8002011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002014">if</span>&nbsp;<span class="ident" id="8002017">err</span>&nbsp;<span class="op" id="8002021">!=</span>&nbsp;<span class="ident" id="8002024">nil</span>&nbsp;<span class="op" id="8002028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002032">t</span><span class="op" id="8002033">.</span><span class="ident" id="8002034">Fatal</span><span class="op" id="8002039">(</span><span class="string" id="8002040">&#34;closing:&#34;</span><span class="op" id="8002050">,</span>&nbsp;<span class="ident" id="8002052">err</span><span class="op" id="8002055">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002061">if</span>&nbsp;<span class="ident" id="8002064">size</span>&nbsp;<span class="op" id="8002069">==</span>&nbsp;<span class="num" id="8002072">1</span><span class="op" id="8002073">&lt;&lt;</span><span class="num" id="8002075">32</span>&nbsp;<span class="op" id="8002078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002082">if</span>&nbsp;<span class="ident" id="8002085">got</span><span class="op" id="8002088">,</span>&nbsp;<span class="ident" id="8002090">want</span>&nbsp;<span class="op" id="8002095">:=</span>&nbsp;<span class="ident" id="8002098">f0</span><span class="op" id="8002100">.</span><span class="ident" id="8002101">UncompressedSize</span><span class="op" id="8002117">,</span>&nbsp;<span class="builtintype" id="8002119">uint32</span><span class="op" id="8002125">(</span><span class="ident" id="8002126">uint32max</span><span class="op" id="8002135">)</span><span class="op" id="8002136">;</span>&nbsp;<span class="ident" id="8002138">got</span>&nbsp;<span class="op" id="8002142">!=</span>&nbsp;<span class="ident" id="8002145">want</span>&nbsp;<span class="op" id="8002150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002155">t</span><span class="op" id="8002156">.</span><span class="ident" id="8002157">Errorf</span><span class="op" id="8002163">(</span><span class="string" id="8002164">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8002194">,</span>&nbsp;<span class="ident" id="8002196">got</span><span class="op" id="8002199">,</span>&nbsp;<span class="ident" id="8002201">want</span><span class="op" id="8002205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002209">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002216">if</span>&nbsp;<span class="ident" id="8002219">got</span><span class="op" id="8002222">,</span>&nbsp;<span class="ident" id="8002224">want</span>&nbsp;<span class="op" id="8002229">:=</span>&nbsp;<span class="ident" id="8002232">f0</span><span class="op" id="8002234">.</span><span class="ident" id="8002235">UncompressedSize64</span><span class="op" id="8002253">,</span>&nbsp;<span class="ident" id="8002255">uint64</span><span class="op" id="8002261">(</span><span class="ident" id="8002262">size</span><span class="op" id="8002266">)</span><span class="op" id="8002267">+</span><span class="ident" id="8002268">uint64</span><span class="op" id="8002274">(</span><span class="builtinfunc" id="8002275">len</span><span class="op" id="8002278">(</span><span class="ident" id="8002279">end</span><span class="op" id="8002282">)</span><span class="op" id="8002283">)</span><span class="op" id="8002284">;</span>&nbsp;<span class="ident" id="8002286">got</span>&nbsp;<span class="op" id="8002290">!=</span>&nbsp;<span class="ident" id="8002293">want</span>&nbsp;<span class="op" id="8002298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002302">t</span><span class="op" id="8002303">.</span><span class="ident" id="8002304">Errorf</span><span class="op" id="8002310">(</span><span class="string" id="8002311">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8002343">,</span>&nbsp;<span class="ident" id="8002345">got</span><span class="op" id="8002348">,</span>&nbsp;<span class="ident" id="8002350">want</span><span class="op" id="8002354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002357">}</span><br>
<span class="lineno">305</span><span class="op" id="8002359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8002362">func</span>&nbsp;<span class="ident" id="8002367">testInvalidHeader</span><span class="op" id="8002384">(</span><span class="ident" id="8002385">h</span>&nbsp;<span class="op" id="8002387">*</span><span class="ident" id="8002388">FileHeader</span><span class="op" id="8002398">,</span>&nbsp;<span class="ident" id="8002400">t</span>&nbsp;<span class="op" id="8002402">*</span><span class="ident" id="8002403">testing</span><span class="op" id="8002410">.</span><span class="ident" id="8002411">T</span><span class="op" id="8002412">)</span>&nbsp;<span class="op" id="8002414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002417">var</span>&nbsp;<span class="ident" id="8002421">buf</span>&nbsp;<span class="ident" id="8002425">bytes</span><span class="op" id="8002430">.</span><span class="ident" id="8002431">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002439">z</span>&nbsp;<span class="op" id="8002441">:=</span>&nbsp;<span class="ident" id="8002444">NewWriter</span><span class="op" id="8002453">(</span><span class="op" id="8002454">&amp;</span><span class="ident" id="8002455">buf</span><span class="op" id="8002458">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002462">f</span><span class="op" id="8002463">,</span>&nbsp;<span class="ident" id="8002465">err</span>&nbsp;<span class="op" id="8002469">:=</span>&nbsp;<span class="ident" id="8002472">z</span><span class="op" id="8002473">.</span><span class="ident" id="8002474">CreateHeader</span><span class="op" id="8002486">(</span><span class="ident" id="8002487">h</span><span class="op" id="8002488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002491">if</span>&nbsp;<span class="ident" id="8002494">err</span>&nbsp;<span class="op" id="8002498">!=</span>&nbsp;<span class="ident" id="8002501">nil</span>&nbsp;<span class="op" id="8002505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002509">t</span><span class="op" id="8002510">.</span><span class="ident" id="8002511">Fatalf</span><span class="op" id="8002517">(</span><span class="string" id="8002518">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8002545">,</span>&nbsp;<span class="ident" id="8002547">err</span><span class="op" id="8002550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002553">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002556">if</span>&nbsp;<span class="ident" id="8002559">_</span><span class="op" id="8002560">,</span>&nbsp;<span class="ident" id="8002562">err</span>&nbsp;<span class="op" id="8002566">:=</span>&nbsp;<span class="ident" id="8002569">f</span><span class="op" id="8002570">.</span><span class="ident" id="8002571">Write</span><span class="op" id="8002576">(</span><span class="op" id="8002577">[</span><span class="op" id="8002578">]</span><span class="builtintype" id="8002579">byte</span><span class="op" id="8002583">(</span><span class="string" id="8002584">&#34;hi&#34;</span><span class="op" id="8002588">)</span><span class="op" id="8002589">)</span><span class="op" id="8002590">;</span>&nbsp;<span class="ident" id="8002592">err</span>&nbsp;<span class="op" id="8002596">!=</span>&nbsp;<span class="ident" id="8002599">nil</span>&nbsp;<span class="op" id="8002603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002607">t</span><span class="op" id="8002608">.</span><span class="ident" id="8002609">Fatalf</span><span class="op" id="8002615">(</span><span class="string" id="8002616">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8002643">,</span>&nbsp;<span class="ident" id="8002645">err</span><span class="op" id="8002648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002654">if</span>&nbsp;<span class="ident" id="8002657">err</span>&nbsp;<span class="op" id="8002661">:=</span>&nbsp;<span class="ident" id="8002664">z</span><span class="op" id="8002665">.</span><span class="ident" id="8002666">Close</span><span class="op" id="8002671">(</span><span class="op" id="8002672">)</span><span class="op" id="8002673">;</span>&nbsp;<span class="ident" id="8002675">err</span>&nbsp;<span class="op" id="8002679">!=</span>&nbsp;<span class="ident" id="8002682">nil</span>&nbsp;<span class="op" id="8002686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002690">t</span><span class="op" id="8002691">.</span><span class="ident" id="8002692">Fatalf</span><span class="op" id="8002698">(</span><span class="string" id="8002699">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8002729">,</span>&nbsp;<span class="ident" id="8002731">err</span><span class="op" id="8002734">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002741">b</span>&nbsp;<span class="op" id="8002743">:=</span>&nbsp;<span class="ident" id="8002746">buf</span><span class="op" id="8002749">.</span><span class="ident" id="8002750">Bytes</span><span class="op" id="8002755">(</span><span class="op" id="8002756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002759">if</span>&nbsp;<span class="ident" id="8002762">_</span><span class="op" id="8002763">,</span>&nbsp;<span class="ident" id="8002765">err</span>&nbsp;<span class="op" id="8002769">=</span>&nbsp;<span class="ident" id="8002771">NewReader</span><span class="op" id="8002780">(</span><span class="ident" id="8002781">bytes</span><span class="op" id="8002786">.</span><span class="ident" id="8002787">NewReader</span><span class="op" id="8002796">(</span><span class="ident" id="8002797">b</span><span class="op" id="8002798">)</span><span class="op" id="8002799">,</span>&nbsp;<span class="ident" id="8002801">int64</span><span class="op" id="8002806">(</span><span class="builtinfunc" id="8002807">len</span><span class="op" id="8002810">(</span><span class="ident" id="8002811">b</span><span class="op" id="8002812">)</span><span class="op" id="8002813">)</span><span class="op" id="8002814">)</span><span class="op" id="8002815">;</span>&nbsp;<span class="ident" id="8002817">err</span>&nbsp;<span class="op" id="8002821">!=</span>&nbsp;<span class="ident" id="8002824">ErrFormat</span>&nbsp;<span class="op" id="8002834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002838">t</span><span class="op" id="8002839">.</span><span class="ident" id="8002840">Fatalf</span><span class="op" id="8002846">(</span><span class="string" id="8002847">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="8002875">,</span>&nbsp;<span class="ident" id="8002877">err</span><span class="op" id="8002880">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002883">}</span><br>
<span class="lineno"></span><span class="op" id="8002885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8002888">func</span>&nbsp;<span class="ident" id="8002893">testValidHeader</span><span class="op" id="8002908">(</span><span class="ident" id="8002909">h</span>&nbsp;<span class="op" id="8002911">*</span><span class="ident" id="8002912">FileHeader</span><span class="op" id="8002922">,</span>&nbsp;<span class="ident" id="8002924">t</span>&nbsp;<span class="op" id="8002926">*</span><span class="ident" id="8002927">testing</span><span class="op" id="8002934">.</span><span class="ident" id="8002935">T</span><span class="op" id="8002936">)</span>&nbsp;<span class="op" id="8002938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002941">var</span>&nbsp;<span class="ident" id="8002945">buf</span>&nbsp;<span class="ident" id="8002949">bytes</span><span class="op" id="8002954">.</span><span class="ident" id="8002955">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002963">z</span>&nbsp;<span class="op" id="8002965">:=</span>&nbsp;<span class="ident" id="8002968">NewWriter</span><span class="op" id="8002977">(</span><span class="op" id="8002978">&amp;</span><span class="ident" id="8002979">buf</span><span class="op" id="8002982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002986">f</span><span class="op" id="8002987">,</span>&nbsp;<span class="ident" id="8002989">err</span>&nbsp;<span class="op" id="8002993">:=</span>&nbsp;<span class="ident" id="8002996">z</span><span class="op" id="8002997">.</span><span class="ident" id="8002998">CreateHeader</span><span class="op" id="8003010">(</span><span class="ident" id="8003011">h</span><span class="op" id="8003012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003015">if</span>&nbsp;<span class="ident" id="8003018">err</span>&nbsp;<span class="op" id="8003022">!=</span>&nbsp;<span class="ident" id="8003025">nil</span>&nbsp;<span class="op" id="8003029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003033">t</span><span class="op" id="8003034">.</span><span class="ident" id="8003035">Fatalf</span><span class="op" id="8003041">(</span><span class="string" id="8003042">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8003069">,</span>&nbsp;<span class="ident" id="8003071">err</span><span class="op" id="8003074">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003080">if</span>&nbsp;<span class="ident" id="8003083">_</span><span class="op" id="8003084">,</span>&nbsp;<span class="ident" id="8003086">err</span>&nbsp;<span class="op" id="8003090">:=</span>&nbsp;<span class="ident" id="8003093">f</span><span class="op" id="8003094">.</span><span class="ident" id="8003095">Write</span><span class="op" id="8003100">(</span><span class="op" id="8003101">[</span><span class="op" id="8003102">]</span><span class="builtintype" id="8003103">byte</span><span class="op" id="8003107">(</span><span class="string" id="8003108">&#34;hi&#34;</span><span class="op" id="8003112">)</span><span class="op" id="8003113">)</span><span class="op" id="8003114">;</span>&nbsp;<span class="ident" id="8003116">err</span>&nbsp;<span class="op" id="8003120">!=</span>&nbsp;<span class="ident" id="8003123">nil</span>&nbsp;<span class="op" id="8003127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003131">t</span><span class="op" id="8003132">.</span><span class="ident" id="8003133">Fatalf</span><span class="op" id="8003139">(</span><span class="string" id="8003140">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8003167">,</span>&nbsp;<span class="ident" id="8003169">err</span><span class="op" id="8003172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003178">if</span>&nbsp;<span class="ident" id="8003181">err</span>&nbsp;<span class="op" id="8003185">:=</span>&nbsp;<span class="ident" id="8003188">z</span><span class="op" id="8003189">.</span><span class="ident" id="8003190">Close</span><span class="op" id="8003195">(</span><span class="op" id="8003196">)</span><span class="op" id="8003197">;</span>&nbsp;<span class="ident" id="8003199">err</span>&nbsp;<span class="op" id="8003203">!=</span>&nbsp;<span class="ident" id="8003206">nil</span>&nbsp;<span class="op" id="8003210">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003214">t</span><span class="op" id="8003215">.</span><span class="ident" id="8003216">Fatalf</span><span class="op" id="8003222">(</span><span class="string" id="8003223">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8003253">,</span>&nbsp;<span class="ident" id="8003255">err</span><span class="op" id="8003258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003265">b</span>&nbsp;<span class="op" id="8003267">:=</span>&nbsp;<span class="ident" id="8003270">buf</span><span class="op" id="8003273">.</span><span class="ident" id="8003274">Bytes</span><span class="op" id="8003279">(</span><span class="op" id="8003280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003283">if</span>&nbsp;<span class="ident" id="8003286">_</span><span class="op" id="8003287">,</span>&nbsp;<span class="ident" id="8003289">err</span>&nbsp;<span class="op" id="8003293">=</span>&nbsp;<span class="ident" id="8003295">NewReader</span><span class="op" id="8003304">(</span><span class="ident" id="8003305">bytes</span><span class="op" id="8003310">.</span><span class="ident" id="8003311">NewReader</span><span class="op" id="8003320">(</span><span class="ident" id="8003321">b</span><span class="op" id="8003322">)</span><span class="op" id="8003323">,</span>&nbsp;<span class="ident" id="8003325">int64</span><span class="op" id="8003330">(</span><span class="builtinfunc" id="8003331">len</span><span class="op" id="8003334">(</span><span class="ident" id="8003335">b</span><span class="op" id="8003336">)</span><span class="op" id="8003337">)</span><span class="op" id="8003338">)</span><span class="op" id="8003339">;</span>&nbsp;<span class="ident" id="8003341">err</span>&nbsp;<span class="op" id="8003345">!=</span>&nbsp;<span class="ident" id="8003348">nil</span>&nbsp;<span class="op" id="8003352">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003356">t</span><span class="op" id="8003357">.</span><span class="ident" id="8003358">Fatalf</span><span class="op" id="8003364">(</span><span class="string" id="8003365">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="8003387">,</span>&nbsp;<span class="ident" id="8003389">err</span><span class="op" id="8003392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003395">}</span><br>
<span class="lineno"></span><span class="op" id="8003397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8003400">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="8003415">func</span>&nbsp;<span class="ident" id="8003420">TestHeaderInvalidTagAndSize</span><span class="op" id="8003447">(</span><span class="ident" id="8003448">t</span>&nbsp;<span class="op" id="8003450">*</span><span class="ident" id="8003451">testing</span><span class="op" id="8003458">.</span><span class="ident" id="8003459">T</span><span class="op" id="8003460">)</span>&nbsp;<span class="op" id="8003462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003465">const</span>&nbsp;<span class="ident" id="8003471">timeFormat</span>&nbsp;<span class="op" id="8003482">=</span>&nbsp;<span class="string" id="8003484">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003512">ts</span>&nbsp;<span class="op" id="8003515">:=</span>&nbsp;<span class="ident" id="8003518">time</span><span class="op" id="8003522">.</span><span class="ident" id="8003523">Now</span><span class="op" id="8003526">(</span><span class="op" id="8003527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003530">filename</span>&nbsp;<span class="op" id="8003539">:=</span>&nbsp;<span class="ident" id="8003542">ts</span><span class="op" id="8003544">.</span><span class="ident" id="8003545">Format</span><span class="op" id="8003551">(</span><span class="ident" id="8003552">timeFormat</span><span class="op" id="8003562">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003566">h</span>&nbsp;<span class="op" id="8003568">:=</span>&nbsp;<span class="ident" id="8003571">FileHeader</span><span class="op" id="8003581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003585">Name</span><span class="op" id="8003589">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8003593">filename</span><span class="op" id="8003601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003605">Method</span><span class="op" id="8003611">:</span>&nbsp;<span class="ident" id="8003613">Deflate</span><span class="op" id="8003620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003624">Extra</span><span class="op" id="8003629">:</span>&nbsp;&nbsp;<span class="op" id="8003632">[</span><span class="op" id="8003633">]</span><span class="builtintype" id="8003634">byte</span><span class="op" id="8003638">(</span><span class="ident" id="8003639">ts</span><span class="op" id="8003641">.</span><span class="ident" id="8003642">Format</span><span class="op" id="8003648">(</span><span class="ident" id="8003649">time</span><span class="op" id="8003653">.</span><span class="ident" id="8003654">RFC3339Nano</span><span class="op" id="8003665">)</span><span class="op" id="8003666">)</span><span class="op" id="8003667">,</span>&nbsp;<span class="comment" id="8003669">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003696">h</span><span class="op" id="8003697">.</span><span class="ident" id="8003698">SetModTime</span><span class="op" id="8003708">(</span><span class="ident" id="8003709">ts</span><span class="op" id="8003711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003715">testInvalidHeader</span><span class="op" id="8003732">(</span><span class="op" id="8003733">&amp;</span><span class="ident" id="8003734">h</span><span class="op" id="8003735">,</span>&nbsp;<span class="ident" id="8003737">t</span><span class="op" id="8003738">)</span><br>
<span class="lineno"></span><span class="op" id="8003740">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8003743">func</span>&nbsp;<span class="ident" id="8003748">TestHeaderTooShort</span><span class="op" id="8003766">(</span><span class="ident" id="8003767">t</span>&nbsp;<span class="op" id="8003769">*</span><span class="ident" id="8003770">testing</span><span class="op" id="8003777">.</span><span class="ident" id="8003778">T</span><span class="op" id="8003779">)</span>&nbsp;<span class="op" id="8003781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003784">h</span>&nbsp;<span class="op" id="8003786">:=</span>&nbsp;<span class="ident" id="8003789">FileHeader</span><span class="op" id="8003799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003803">Name</span><span class="op" id="8003807">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8003811">&#34;foo.txt&#34;</span><span class="op" id="8003820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003824">Method</span><span class="op" id="8003830">:</span>&nbsp;<span class="ident" id="8003832">Deflate</span><span class="op" id="8003839">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003843">Extra</span><span class="op" id="8003848">:</span>&nbsp;&nbsp;<span class="op" id="8003851">[</span><span class="op" id="8003852">]</span><span class="builtintype" id="8003853">byte</span><span class="op" id="8003857">{</span><span class="ident" id="8003858">zip64ExtraId</span><span class="op" id="8003870">}</span><span class="op" id="8003871">,</span>&nbsp;<span class="comment" id="8003873">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003893">testInvalidHeader</span><span class="op" id="8003910">(</span><span class="op" id="8003911">&amp;</span><span class="ident" id="8003912">h</span><span class="op" id="8003913">,</span>&nbsp;<span class="ident" id="8003915">t</span><span class="op" id="8003916">)</span><br>
<span class="lineno"></span><span class="op" id="8003918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="8003921">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="8003977">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="8004004">func</span>&nbsp;<span class="ident" id="8004009">TestZeroLengthHeader</span><span class="op" id="8004029">(</span><span class="ident" id="8004030">t</span>&nbsp;<span class="op" id="8004032">*</span><span class="ident" id="8004033">testing</span><span class="op" id="8004040">.</span><span class="ident" id="8004041">T</span><span class="op" id="8004042">)</span>&nbsp;<span class="op" id="8004044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004047">h</span>&nbsp;<span class="op" id="8004049">:=</span>&nbsp;<span class="ident" id="8004052">FileHeader</span><span class="op" id="8004062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004066">Name</span><span class="op" id="8004070">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8004074">&#34;extadata.txt&#34;</span><span class="op" id="8004088">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004092">Method</span><span class="op" id="8004098">:</span>&nbsp;<span class="ident" id="8004100">Deflate</span><span class="op" id="8004107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004111">Extra</span><span class="op" id="8004116">:</span>&nbsp;<span class="op" id="8004118">[</span><span class="op" id="8004119">]</span><span class="builtintype" id="8004120">byte</span><span class="op" id="8004124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8004129">85</span><span class="op" id="8004131">,</span>&nbsp;<span class="num" id="8004133">84</span><span class="op" id="8004135">,</span>&nbsp;<span class="num" id="8004137">5</span><span class="op" id="8004138">,</span>&nbsp;<span class="num" id="8004140">0</span><span class="op" id="8004141">,</span>&nbsp;<span class="num" id="8004143">3</span><span class="op" id="8004144">,</span>&nbsp;<span class="num" id="8004146">154</span><span class="op" id="8004149">,</span>&nbsp;<span class="num" id="8004151">144</span><span class="op" id="8004154">,</span>&nbsp;<span class="num" id="8004156">195</span><span class="op" id="8004159">,</span>&nbsp;<span class="num" id="8004161">77</span><span class="op" id="8004163">,</span>&nbsp;<span class="comment" id="8004165">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8004188">85</span><span class="op" id="8004190">,</span>&nbsp;<span class="num" id="8004192">120</span><span class="op" id="8004195">,</span>&nbsp;<span class="num" id="8004197">0</span><span class="op" id="8004198">,</span>&nbsp;<span class="num" id="8004200">0</span><span class="op" id="8004201">,</span>&nbsp;<span class="comment" id="8004203">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004225">}</span><span class="op" id="8004226">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004232">testValidHeader</span><span class="op" id="8004247">(</span><span class="op" id="8004248">&amp;</span><span class="ident" id="8004249">h</span><span class="op" id="8004250">,</span>&nbsp;<span class="ident" id="8004252">t</span><span class="op" id="8004253">)</span><br>
<span class="lineno"></span><span class="op" id="8004255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8004258">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="8004328">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="8004399">func</span>&nbsp;<span class="ident" id="8004404">BenchmarkZip64Test</span><span class="op" id="8004422">(</span><span class="ident" id="8004423">b</span>&nbsp;<span class="op" id="8004425">*</span><span class="ident" id="8004426">testing</span><span class="op" id="8004433">.</span><span class="ident" id="8004434">B</span><span class="op" id="8004435">)</span>&nbsp;<span class="op" id="8004437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004440">for</span>&nbsp;<span class="ident" id="8004444">i</span>&nbsp;<span class="op" id="8004446">:=</span>&nbsp;<span class="num" id="8004449">0</span><span class="op" id="8004450">;</span>&nbsp;<span class="ident" id="8004452">i</span>&nbsp;<span class="op" id="8004454">&lt;</span>&nbsp;<span class="ident" id="8004456">b</span><span class="op" id="8004457">.</span><span class="ident" id="8004458">N</span><span class="op" id="8004459">;</span>&nbsp;<span class="ident" id="8004461">i</span><span class="op" id="8004462">++</span>&nbsp;<span class="op" id="8004465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004469">testZip64</span><span class="op" id="8004478">(</span><span class="ident" id="8004479">b</span><span class="op" id="8004480">,</span>&nbsp;<span class="num" id="8004482">1</span><span class="op" id="8004483">&lt;&lt;</span><span class="num" id="8004485">26</span><span class="op" id="8004487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004490">}</span><br>
<span class="lineno">395</span><span class="op" id="8004492">}</span>
</div>
</body>
</html>
