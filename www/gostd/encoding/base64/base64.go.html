<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1543452">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1543507">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1543561">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1543612">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="1543683">package</span>&nbsp;<span class="ident" id="1543691">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1543699">import</span>&nbsp;<span class="op" id="1543706">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1543709">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1543718">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1543724">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1543735">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="1543745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1543748">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1543769">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="1543837">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1543905">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="1543973">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1544043">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="1544106">type</span>&nbsp;<span class="ident" id="1544111">Encoding</span>&nbsp;<span class="keyword" id="1544120">struct</span>&nbsp;<span class="op" id="1544127">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544130">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1544140">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544148">decodeMap</span>&nbsp;<span class="op" id="1544158">[</span><span class="num" id="1544159">256</span><span class="op" id="1544162">]</span><span class="builtintype" id="1544163">byte</span><br>
<span class="lineno"></span><span class="op" id="1544168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1544171">const</span>&nbsp;<span class="ident" id="1544177">encodeStd</span>&nbsp;<span class="op" id="1544187">=</span>&nbsp;<span class="string" id="1544189">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="1544256">const</span>&nbsp;<span class="ident" id="1544262">encodeURL</span>&nbsp;<span class="op" id="1544272">=</span>&nbsp;<span class="string" id="1544274">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1544342">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="1544411">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1544446">func</span>&nbsp;<span class="ident" id="1544451">NewEncoding</span><span class="op" id="1544462">(</span><span class="ident" id="1544463">encoder</span>&nbsp;<span class="builtintype" id="1544471">string</span><span class="op" id="1544477">)</span>&nbsp;<span class="op" id="1544479">*</span><span class="ident" id="1544480">Encoding</span>&nbsp;<span class="op" id="1544489">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544492">e</span>&nbsp;<span class="op" id="1544494">:=</span>&nbsp;<span class="builtinfunc" id="1544497">new</span><span class="op" id="1544500">(</span><span class="ident" id="1544501">Encoding</span><span class="op" id="1544509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544512">e</span><span class="op" id="1544513">.</span><span class="ident" id="1544514">encode</span>&nbsp;<span class="op" id="1544521">=</span>&nbsp;<span class="ident" id="1544523">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1544532">for</span>&nbsp;<span class="ident" id="1544536">i</span>&nbsp;<span class="op" id="1544538">:=</span>&nbsp;<span class="num" id="1544541">0</span><span class="op" id="1544542">;</span>&nbsp;<span class="ident" id="1544544">i</span>&nbsp;<span class="op" id="1544546">&lt;</span>&nbsp;<span class="builtinfunc" id="1544548">len</span><span class="op" id="1544551">(</span><span class="ident" id="1544552">e</span><span class="op" id="1544553">.</span><span class="ident" id="1544554">decodeMap</span><span class="op" id="1544563">)</span><span class="op" id="1544564">;</span>&nbsp;<span class="ident" id="1544566">i</span><span class="op" id="1544567">++</span>&nbsp;<span class="op" id="1544570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544574">e</span><span class="op" id="1544575">.</span><span class="ident" id="1544576">decodeMap</span><span class="op" id="1544585">[</span><span class="ident" id="1544586">i</span><span class="op" id="1544587">]</span>&nbsp;<span class="op" id="1544589">=</span>&nbsp;<span class="num" id="1544591">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1544597">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1544600">for</span>&nbsp;<span class="ident" id="1544604">i</span>&nbsp;<span class="op" id="1544606">:=</span>&nbsp;<span class="num" id="1544609">0</span><span class="op" id="1544610">;</span>&nbsp;<span class="ident" id="1544612">i</span>&nbsp;<span class="op" id="1544614">&lt;</span>&nbsp;<span class="builtinfunc" id="1544616">len</span><span class="op" id="1544619">(</span><span class="ident" id="1544620">encoder</span><span class="op" id="1544627">)</span><span class="op" id="1544628">;</span>&nbsp;<span class="ident" id="1544630">i</span><span class="op" id="1544631">++</span>&nbsp;<span class="op" id="1544634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1544638">e</span><span class="op" id="1544639">.</span><span class="ident" id="1544640">decodeMap</span><span class="op" id="1544649">[</span><span class="ident" id="1544650">encoder</span><span class="op" id="1544657">[</span><span class="ident" id="1544658">i</span><span class="op" id="1544659">]</span><span class="op" id="1544660">]</span>&nbsp;<span class="op" id="1544662">=</span>&nbsp;<span class="builtintype" id="1544664">byte</span><span class="op" id="1544668">(</span><span class="ident" id="1544669">i</span><span class="op" id="1544670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1544673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1544676">return</span>&nbsp;<span class="ident" id="1544683">e</span><br>
<span class="lineno"></span><span class="op" id="1544685">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1544688">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1544750">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="1544763">var</span>&nbsp;<span class="ident" id="1544767">StdEncoding</span>&nbsp;<span class="op" id="1544779">=</span>&nbsp;<span class="ident" id="1544781">NewEncoding</span><span class="op" id="1544792">(</span><span class="ident" id="1544793">encodeStd</span><span class="op" id="1544802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="1544805">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="1544874">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="1544922">var</span>&nbsp;<span class="ident" id="1544926">URLEncoding</span>&nbsp;<span class="op" id="1544938">=</span>&nbsp;<span class="ident" id="1544940">NewEncoding</span><span class="op" id="1544951">(</span><span class="ident" id="1544952">encodeURL</span><span class="op" id="1544961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1544964">var</span>&nbsp;<span class="ident" id="1544968">removeNewlinesMapper</span>&nbsp;<span class="op" id="1544989">=</span>&nbsp;<span class="keyword" id="1544991">func</span><span class="op" id="1544995">(</span><span class="ident" id="1544996">r</span>&nbsp;<span class="builtintype" id="1544998">rune</span><span class="op" id="1545002">)</span>&nbsp;<span class="builtintype" id="1545004">rune</span>&nbsp;<span class="op" id="1545009">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545012">if</span>&nbsp;<span class="ident" id="1545015">r</span>&nbsp;<span class="op" id="1545017">==</span>&nbsp;<span class="string" id="1545020">&#39;\r&#39;</span>&nbsp;<span class="op" id="1545025">||</span>&nbsp;<span class="ident" id="1545028">r</span>&nbsp;<span class="op" id="1545030">==</span>&nbsp;<span class="string" id="1545033">&#39;\n&#39;</span>&nbsp;<span class="op" id="1545038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545042">return</span>&nbsp;<span class="op" id="1545049">-</span><span class="num" id="1545050">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1545053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545056">return</span>&nbsp;<span class="ident" id="1545063">r</span><br>
<span class="lineno"></span><span class="op" id="1545065">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1545068">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1545087">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="1545141">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="1545179">//</span><br>
<span class="lineno"></span><span class="comment" id="1545182">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="1545240">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="1545301">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="1545355">func</span>&nbsp;<span class="op" id="1545360">(</span><span class="ident" id="1545361">enc</span>&nbsp;<span class="op" id="1545365">*</span><span class="ident" id="1545366">Encoding</span><span class="op" id="1545374">)</span>&nbsp;<span class="ident" id="1545376">Encode</span><span class="op" id="1545382">(</span><span class="ident" id="1545383">dst</span><span class="op" id="1545386">,</span>&nbsp;<span class="ident" id="1545388">src</span>&nbsp;<span class="op" id="1545392">[</span><span class="op" id="1545393">]</span><span class="builtintype" id="1545394">byte</span><span class="op" id="1545398">)</span>&nbsp;<span class="op" id="1545400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545403">if</span>&nbsp;<span class="builtinfunc" id="1545406">len</span><span class="op" id="1545409">(</span><span class="ident" id="1545410">src</span><span class="op" id="1545413">)</span>&nbsp;<span class="op" id="1545415">==</span>&nbsp;<span class="num" id="1545418">0</span>&nbsp;<span class="op" id="1545420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545424">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1545432">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545436">for</span>&nbsp;<span class="builtinfunc" id="1545440">len</span><span class="op" id="1545443">(</span><span class="ident" id="1545444">src</span><span class="op" id="1545447">)</span>&nbsp;<span class="op" id="1545449">&gt;</span>&nbsp;<span class="num" id="1545451">0</span>&nbsp;<span class="op" id="1545453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545457">var</span>&nbsp;<span class="ident" id="1545461">b0</span><span class="op" id="1545463">,</span>&nbsp;<span class="ident" id="1545465">b1</span><span class="op" id="1545467">,</span>&nbsp;<span class="ident" id="1545469">b2</span><span class="op" id="1545471">,</span>&nbsp;<span class="ident" id="1545473">b3</span>&nbsp;<span class="builtintype" id="1545476">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1545484">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1545533">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545558">switch</span>&nbsp;<span class="builtinfunc" id="1545565">len</span><span class="op" id="1545568">(</span><span class="ident" id="1545569">src</span><span class="op" id="1545572">)</span>&nbsp;<span class="op" id="1545574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545578">default</span><span class="op" id="1545585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545590">b3</span>&nbsp;<span class="op" id="1545593">=</span>&nbsp;<span class="ident" id="1545595">src</span><span class="op" id="1545598">[</span><span class="num" id="1545599">2</span><span class="op" id="1545600">]</span>&nbsp;<span class="op" id="1545602">&amp;</span>&nbsp;<span class="num" id="1545604">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545612">b2</span>&nbsp;<span class="op" id="1545615">=</span>&nbsp;<span class="ident" id="1545617">src</span><span class="op" id="1545620">[</span><span class="num" id="1545621">2</span><span class="op" id="1545622">]</span>&nbsp;<span class="op" id="1545624">&gt;&gt;</span>&nbsp;<span class="num" id="1545627">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545632">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545646">case</span>&nbsp;<span class="num" id="1545651">2</span><span class="op" id="1545652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545657">b2</span>&nbsp;<span class="op" id="1545660">|=</span>&nbsp;<span class="op" id="1545663">(</span><span class="ident" id="1545664">src</span><span class="op" id="1545667">[</span><span class="num" id="1545668">1</span><span class="op" id="1545669">]</span>&nbsp;<span class="op" id="1545671">&lt;&lt;</span>&nbsp;<span class="num" id="1545674">2</span><span class="op" id="1545675">)</span>&nbsp;<span class="op" id="1545677">&amp;</span>&nbsp;<span class="num" id="1545679">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545687">b1</span>&nbsp;<span class="op" id="1545690">=</span>&nbsp;<span class="ident" id="1545692">src</span><span class="op" id="1545695">[</span><span class="num" id="1545696">1</span><span class="op" id="1545697">]</span>&nbsp;<span class="op" id="1545699">&gt;&gt;</span>&nbsp;<span class="num" id="1545702">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545707">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545721">case</span>&nbsp;<span class="num" id="1545726">1</span><span class="op" id="1545727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545732">b1</span>&nbsp;<span class="op" id="1545735">|=</span>&nbsp;<span class="op" id="1545738">(</span><span class="ident" id="1545739">src</span><span class="op" id="1545742">[</span><span class="num" id="1545743">0</span><span class="op" id="1545744">]</span>&nbsp;<span class="op" id="1545746">&lt;&lt;</span>&nbsp;<span class="num" id="1545749">4</span><span class="op" id="1545750">)</span>&nbsp;<span class="op" id="1545752">&amp;</span>&nbsp;<span class="num" id="1545754">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545762">b0</span>&nbsp;<span class="op" id="1545765">=</span>&nbsp;<span class="ident" id="1545767">src</span><span class="op" id="1545770">[</span><span class="num" id="1545771">0</span><span class="op" id="1545772">]</span>&nbsp;<span class="op" id="1545774">&gt;&gt;</span>&nbsp;<span class="num" id="1545777">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1545781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1545786">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545837">dst</span><span class="op" id="1545840">[</span><span class="num" id="1545841">0</span><span class="op" id="1545842">]</span>&nbsp;<span class="op" id="1545844">=</span>&nbsp;<span class="ident" id="1545846">enc</span><span class="op" id="1545849">.</span><span class="ident" id="1545850">encode</span><span class="op" id="1545856">[</span><span class="ident" id="1545857">b0</span><span class="op" id="1545859">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545863">dst</span><span class="op" id="1545866">[</span><span class="num" id="1545867">1</span><span class="op" id="1545868">]</span>&nbsp;<span class="op" id="1545870">=</span>&nbsp;<span class="ident" id="1545872">enc</span><span class="op" id="1545875">.</span><span class="ident" id="1545876">encode</span><span class="op" id="1545882">[</span><span class="ident" id="1545883">b1</span><span class="op" id="1545885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545889">dst</span><span class="op" id="1545892">[</span><span class="num" id="1545893">2</span><span class="op" id="1545894">]</span>&nbsp;<span class="op" id="1545896">=</span>&nbsp;<span class="ident" id="1545898">enc</span><span class="op" id="1545901">.</span><span class="ident" id="1545902">encode</span><span class="op" id="1545908">[</span><span class="ident" id="1545909">b2</span><span class="op" id="1545911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545915">dst</span><span class="op" id="1545918">[</span><span class="num" id="1545919">3</span><span class="op" id="1545920">]</span>&nbsp;<span class="op" id="1545922">=</span>&nbsp;<span class="ident" id="1545924">enc</span><span class="op" id="1545927">.</span><span class="ident" id="1545928">encode</span><span class="op" id="1545934">[</span><span class="ident" id="1545935">b3</span><span class="op" id="1545937">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1545942">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1545969">if</span>&nbsp;<span class="builtinfunc" id="1545972">len</span><span class="op" id="1545975">(</span><span class="ident" id="1545976">src</span><span class="op" id="1545979">)</span>&nbsp;<span class="op" id="1545981">&lt;</span>&nbsp;<span class="num" id="1545983">3</span>&nbsp;<span class="op" id="1545985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1545990">dst</span><span class="op" id="1545993">[</span><span class="num" id="1545994">3</span><span class="op" id="1545995">]</span>&nbsp;<span class="op" id="1545997">=</span>&nbsp;<span class="string" id="1545999">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546006">if</span>&nbsp;<span class="builtinfunc" id="1546009">len</span><span class="op" id="1546012">(</span><span class="ident" id="1546013">src</span><span class="op" id="1546016">)</span>&nbsp;<span class="op" id="1546018">&lt;</span>&nbsp;<span class="num" id="1546020">2</span>&nbsp;<span class="op" id="1546022">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546028">dst</span><span class="op" id="1546031">[</span><span class="num" id="1546032">2</span><span class="op" id="1546033">]</span>&nbsp;<span class="op" id="1546035">=</span>&nbsp;<span class="string" id="1546037">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546049">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546062">src</span>&nbsp;<span class="op" id="1546066">=</span>&nbsp;<span class="ident" id="1546068">src</span><span class="op" id="1546071">[</span><span class="num" id="1546072">3</span><span class="op" id="1546073">:</span><span class="op" id="1546074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546078">dst</span>&nbsp;<span class="op" id="1546082">=</span>&nbsp;<span class="ident" id="1546084">dst</span><span class="op" id="1546087">[</span><span class="num" id="1546088">4</span><span class="op" id="1546089">:</span><span class="op" id="1546090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546093">}</span><br>
<span class="lineno"></span><span class="op" id="1546095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="1546098">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="1546152">func</span>&nbsp;<span class="op" id="1546157">(</span><span class="ident" id="1546158">enc</span>&nbsp;<span class="op" id="1546162">*</span><span class="ident" id="1546163">Encoding</span><span class="op" id="1546171">)</span>&nbsp;<span class="ident" id="1546173">EncodeToString</span><span class="op" id="1546187">(</span><span class="ident" id="1546188">src</span>&nbsp;<span class="op" id="1546192">[</span><span class="op" id="1546193">]</span><span class="builtintype" id="1546194">byte</span><span class="op" id="1546198">)</span>&nbsp;<span class="builtintype" id="1546200">string</span>&nbsp;<span class="op" id="1546207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546210">buf</span>&nbsp;<span class="op" id="1546214">:=</span>&nbsp;<span class="builtinfunc" id="1546217">make</span><span class="op" id="1546221">(</span><span class="op" id="1546222">[</span><span class="op" id="1546223">]</span><span class="builtintype" id="1546224">byte</span><span class="op" id="1546228">,</span>&nbsp;<span class="ident" id="1546230">enc</span><span class="op" id="1546233">.</span><span class="ident" id="1546234">EncodedLen</span><span class="op" id="1546244">(</span><span class="builtinfunc" id="1546245">len</span><span class="op" id="1546248">(</span><span class="ident" id="1546249">src</span><span class="op" id="1546252">)</span><span class="op" id="1546253">)</span><span class="op" id="1546254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546257">enc</span><span class="op" id="1546260">.</span><span class="ident" id="1546261">Encode</span><span class="op" id="1546267">(</span><span class="ident" id="1546268">buf</span><span class="op" id="1546271">,</span>&nbsp;<span class="ident" id="1546273">src</span><span class="op" id="1546276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546279">return</span>&nbsp;<span class="builtintype" id="1546286">string</span><span class="op" id="1546292">(</span><span class="ident" id="1546293">buf</span><span class="op" id="1546296">)</span><br>
<span class="lineno">120</span><span class="op" id="1546298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1546301">type</span>&nbsp;<span class="ident" id="1546306">encoder</span>&nbsp;<span class="keyword" id="1546314">struct</span>&nbsp;<span class="op" id="1546321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546324">err</span>&nbsp;&nbsp;<span class="builtintype" id="1546329">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546336">enc</span>&nbsp;&nbsp;<span class="op" id="1546341">*</span><span class="ident" id="1546342">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546352">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1546357">io</span><span class="op" id="1546359">.</span><span class="ident" id="1546360">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546368">buf</span>&nbsp;&nbsp;<span class="op" id="1546373">[</span><span class="num" id="1546374">3</span><span class="op" id="1546375">]</span><span class="builtintype" id="1546376">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1546384">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546424">nbuf</span>&nbsp;<span class="builtintype" id="1546429">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1546440">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546467">out</span>&nbsp;&nbsp;<span class="op" id="1546472">[</span><span class="num" id="1546473">1024</span><span class="op" id="1546477">]</span><span class="builtintype" id="1546478">byte</span>&nbsp;<span class="comment" id="1546483">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="1546500">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="1546503">func</span>&nbsp;<span class="op" id="1546508">(</span><span class="ident" id="1546509">e</span>&nbsp;<span class="op" id="1546511">*</span><span class="ident" id="1546512">encoder</span><span class="op" id="1546519">)</span>&nbsp;<span class="ident" id="1546521">Write</span><span class="op" id="1546526">(</span><span class="ident" id="1546527">p</span>&nbsp;<span class="op" id="1546529">[</span><span class="op" id="1546530">]</span><span class="builtintype" id="1546531">byte</span><span class="op" id="1546535">)</span>&nbsp;<span class="op" id="1546537">(</span><span class="ident" id="1546538">n</span>&nbsp;<span class="builtintype" id="1546540">int</span><span class="op" id="1546543">,</span>&nbsp;<span class="ident" id="1546545">err</span>&nbsp;<span class="builtintype" id="1546549">error</span><span class="op" id="1546554">)</span>&nbsp;<span class="op" id="1546556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546559">if</span>&nbsp;<span class="ident" id="1546562">e</span><span class="op" id="1546563">.</span><span class="ident" id="1546564">err</span>&nbsp;<span class="op" id="1546568">!=</span>&nbsp;<span class="ident" id="1546571">nil</span>&nbsp;<span class="op" id="1546575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546579">return</span>&nbsp;<span class="num" id="1546586">0</span><span class="op" id="1546587">,</span>&nbsp;<span class="ident" id="1546589">e</span><span class="op" id="1546590">.</span><span class="ident" id="1546591">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546596">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1546600">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546620">if</span>&nbsp;<span class="ident" id="1546623">e</span><span class="op" id="1546624">.</span><span class="ident" id="1546625">nbuf</span>&nbsp;<span class="op" id="1546630">&gt;</span>&nbsp;<span class="num" id="1546632">0</span>&nbsp;<span class="op" id="1546634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546638">var</span>&nbsp;<span class="ident" id="1546642">i</span>&nbsp;<span class="builtintype" id="1546644">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546650">for</span>&nbsp;<span class="ident" id="1546654">i</span>&nbsp;<span class="op" id="1546656">=</span>&nbsp;<span class="num" id="1546658">0</span><span class="op" id="1546659">;</span>&nbsp;<span class="ident" id="1546661">i</span>&nbsp;<span class="op" id="1546663">&lt;</span>&nbsp;<span class="builtinfunc" id="1546665">len</span><span class="op" id="1546668">(</span><span class="ident" id="1546669">p</span><span class="op" id="1546670">)</span>&nbsp;<span class="op" id="1546672">&amp;&amp;</span>&nbsp;<span class="ident" id="1546675">e</span><span class="op" id="1546676">.</span><span class="ident" id="1546677">nbuf</span>&nbsp;<span class="op" id="1546682">&lt;</span>&nbsp;<span class="num" id="1546684">3</span><span class="op" id="1546685">;</span>&nbsp;<span class="ident" id="1546687">i</span><span class="op" id="1546688">++</span>&nbsp;<span class="op" id="1546691">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546696">e</span><span class="op" id="1546697">.</span><span class="ident" id="1546698">buf</span><span class="op" id="1546701">[</span><span class="ident" id="1546702">e</span><span class="op" id="1546703">.</span><span class="ident" id="1546704">nbuf</span><span class="op" id="1546708">]</span>&nbsp;<span class="op" id="1546710">=</span>&nbsp;<span class="ident" id="1546712">p</span><span class="op" id="1546713">[</span><span class="ident" id="1546714">i</span><span class="op" id="1546715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546720">e</span><span class="op" id="1546721">.</span><span class="ident" id="1546722">nbuf</span><span class="op" id="1546726">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546735">n</span>&nbsp;<span class="op" id="1546737">+=</span>&nbsp;<span class="ident" id="1546740">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546744">p</span>&nbsp;<span class="op" id="1546746">=</span>&nbsp;<span class="ident" id="1546748">p</span><span class="op" id="1546749">[</span><span class="ident" id="1546750">i</span><span class="op" id="1546751">:</span><span class="op" id="1546752">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546756">if</span>&nbsp;<span class="ident" id="1546759">e</span><span class="op" id="1546760">.</span><span class="ident" id="1546761">nbuf</span>&nbsp;<span class="op" id="1546766">&lt;</span>&nbsp;<span class="num" id="1546768">3</span>&nbsp;<span class="op" id="1546770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546775">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546788">e</span><span class="op" id="1546789">.</span><span class="ident" id="1546790">enc</span><span class="op" id="1546793">.</span><span class="ident" id="1546794">Encode</span><span class="op" id="1546800">(</span><span class="ident" id="1546801">e</span><span class="op" id="1546802">.</span><span class="ident" id="1546803">out</span><span class="op" id="1546806">[</span><span class="num" id="1546807">0</span><span class="op" id="1546808">:</span><span class="op" id="1546809">]</span><span class="op" id="1546810">,</span>&nbsp;<span class="ident" id="1546812">e</span><span class="op" id="1546813">.</span><span class="ident" id="1546814">buf</span><span class="op" id="1546817">[</span><span class="num" id="1546818">0</span><span class="op" id="1546819">:</span><span class="op" id="1546820">]</span><span class="op" id="1546821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546825">if</span>&nbsp;<span class="ident" id="1546828">_</span><span class="op" id="1546829">,</span>&nbsp;<span class="ident" id="1546831">e</span><span class="op" id="1546832">.</span><span class="ident" id="1546833">err</span>&nbsp;<span class="op" id="1546837">=</span>&nbsp;<span class="ident" id="1546839">e</span><span class="op" id="1546840">.</span><span class="ident" id="1546841">w</span><span class="op" id="1546842">.</span><span class="ident" id="1546843">Write</span><span class="op" id="1546848">(</span><span class="ident" id="1546849">e</span><span class="op" id="1546850">.</span><span class="ident" id="1546851">out</span><span class="op" id="1546854">[</span><span class="num" id="1546855">0</span><span class="op" id="1546856">:</span><span class="num" id="1546857">4</span><span class="op" id="1546858">]</span><span class="op" id="1546859">)</span><span class="op" id="1546860">;</span>&nbsp;<span class="ident" id="1546862">e</span><span class="op" id="1546863">.</span><span class="ident" id="1546864">err</span>&nbsp;<span class="op" id="1546868">!=</span>&nbsp;<span class="ident" id="1546871">nil</span>&nbsp;<span class="op" id="1546875">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546880">return</span>&nbsp;<span class="ident" id="1546887">n</span><span class="op" id="1546888">,</span>&nbsp;<span class="ident" id="1546890">e</span><span class="op" id="1546891">.</span><span class="ident" id="1546892">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546902">e</span><span class="op" id="1546903">.</span><span class="ident" id="1546904">nbuf</span>&nbsp;<span class="op" id="1546909">=</span>&nbsp;<span class="num" id="1546911">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1546914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1546918">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546945">for</span>&nbsp;<span class="builtinfunc" id="1546949">len</span><span class="op" id="1546952">(</span><span class="ident" id="1546953">p</span><span class="op" id="1546954">)</span>&nbsp;<span class="op" id="1546956">&gt;=</span>&nbsp;<span class="num" id="1546959">3</span>&nbsp;<span class="op" id="1546961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1546965">nn</span>&nbsp;<span class="op" id="1546968">:=</span>&nbsp;<span class="builtinfunc" id="1546971">len</span><span class="op" id="1546974">(</span><span class="ident" id="1546975">e</span><span class="op" id="1546976">.</span><span class="ident" id="1546977">out</span><span class="op" id="1546980">)</span>&nbsp;<span class="op" id="1546982">/</span>&nbsp;<span class="num" id="1546984">4</span>&nbsp;<span class="op" id="1546986">*</span>&nbsp;<span class="num" id="1546988">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1546992">if</span>&nbsp;<span class="ident" id="1546995">nn</span>&nbsp;<span class="op" id="1546998">&gt;</span>&nbsp;<span class="builtinfunc" id="1547000">len</span><span class="op" id="1547003">(</span><span class="ident" id="1547004">p</span><span class="op" id="1547005">)</span>&nbsp;<span class="op" id="1547007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547012">nn</span>&nbsp;<span class="op" id="1547015">=</span>&nbsp;<span class="builtinfunc" id="1547017">len</span><span class="op" id="1547020">(</span><span class="ident" id="1547021">p</span><span class="op" id="1547022">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547027">nn</span>&nbsp;<span class="op" id="1547030">-=</span>&nbsp;<span class="ident" id="1547033">nn</span>&nbsp;<span class="op" id="1547036">%</span>&nbsp;<span class="num" id="1547038">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1547042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547046">e</span><span class="op" id="1547047">.</span><span class="ident" id="1547048">enc</span><span class="op" id="1547051">.</span><span class="ident" id="1547052">Encode</span><span class="op" id="1547058">(</span><span class="ident" id="1547059">e</span><span class="op" id="1547060">.</span><span class="ident" id="1547061">out</span><span class="op" id="1547064">[</span><span class="num" id="1547065">0</span><span class="op" id="1547066">:</span><span class="op" id="1547067">]</span><span class="op" id="1547068">,</span>&nbsp;<span class="ident" id="1547070">p</span><span class="op" id="1547071">[</span><span class="num" id="1547072">0</span><span class="op" id="1547073">:</span><span class="ident" id="1547074">nn</span><span class="op" id="1547076">]</span><span class="op" id="1547077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547081">if</span>&nbsp;<span class="ident" id="1547084">_</span><span class="op" id="1547085">,</span>&nbsp;<span class="ident" id="1547087">e</span><span class="op" id="1547088">.</span><span class="ident" id="1547089">err</span>&nbsp;<span class="op" id="1547093">=</span>&nbsp;<span class="ident" id="1547095">e</span><span class="op" id="1547096">.</span><span class="ident" id="1547097">w</span><span class="op" id="1547098">.</span><span class="ident" id="1547099">Write</span><span class="op" id="1547104">(</span><span class="ident" id="1547105">e</span><span class="op" id="1547106">.</span><span class="ident" id="1547107">out</span><span class="op" id="1547110">[</span><span class="num" id="1547111">0</span>&nbsp;<span class="op" id="1547113">:</span>&nbsp;<span class="ident" id="1547115">nn</span><span class="op" id="1547117">/</span><span class="num" id="1547118">3</span><span class="op" id="1547119">*</span><span class="num" id="1547120">4</span><span class="op" id="1547121">]</span><span class="op" id="1547122">)</span><span class="op" id="1547123">;</span>&nbsp;<span class="ident" id="1547125">e</span><span class="op" id="1547126">.</span><span class="ident" id="1547127">err</span>&nbsp;<span class="op" id="1547131">!=</span>&nbsp;<span class="ident" id="1547134">nil</span>&nbsp;<span class="op" id="1547138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547143">return</span>&nbsp;<span class="ident" id="1547150">n</span><span class="op" id="1547151">,</span>&nbsp;<span class="ident" id="1547153">e</span><span class="op" id="1547154">.</span><span class="ident" id="1547155">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1547161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547165">n</span>&nbsp;<span class="op" id="1547167">+=</span>&nbsp;<span class="ident" id="1547170">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547175">p</span>&nbsp;<span class="op" id="1547177">=</span>&nbsp;<span class="ident" id="1547179">p</span><span class="op" id="1547180">[</span><span class="ident" id="1547181">nn</span><span class="op" id="1547183">:</span><span class="op" id="1547184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1547187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1547191">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547212">for</span>&nbsp;<span class="ident" id="1547216">i</span>&nbsp;<span class="op" id="1547218">:=</span>&nbsp;<span class="num" id="1547221">0</span><span class="op" id="1547222">;</span>&nbsp;<span class="ident" id="1547224">i</span>&nbsp;<span class="op" id="1547226">&lt;</span>&nbsp;<span class="builtinfunc" id="1547228">len</span><span class="op" id="1547231">(</span><span class="ident" id="1547232">p</span><span class="op" id="1547233">)</span><span class="op" id="1547234">;</span>&nbsp;<span class="ident" id="1547236">i</span><span class="op" id="1547237">++</span>&nbsp;<span class="op" id="1547240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547244">e</span><span class="op" id="1547245">.</span><span class="ident" id="1547246">buf</span><span class="op" id="1547249">[</span><span class="ident" id="1547250">i</span><span class="op" id="1547251">]</span>&nbsp;<span class="op" id="1547253">=</span>&nbsp;<span class="ident" id="1547255">p</span><span class="op" id="1547256">[</span><span class="ident" id="1547257">i</span><span class="op" id="1547258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1547261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547264">e</span><span class="op" id="1547265">.</span><span class="ident" id="1547266">nbuf</span>&nbsp;<span class="op" id="1547271">=</span>&nbsp;<span class="builtinfunc" id="1547273">len</span><span class="op" id="1547276">(</span><span class="ident" id="1547277">p</span><span class="op" id="1547278">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547281">n</span>&nbsp;<span class="op" id="1547283">+=</span>&nbsp;<span class="builtinfunc" id="1547286">len</span><span class="op" id="1547289">(</span><span class="ident" id="1547290">p</span><span class="op" id="1547291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547294">return</span><br>
<span class="lineno"></span><span class="op" id="1547301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1547304">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="1547358">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="1547411">func</span>&nbsp;<span class="op" id="1547416">(</span><span class="ident" id="1547417">e</span>&nbsp;<span class="op" id="1547419">*</span><span class="ident" id="1547420">encoder</span><span class="op" id="1547427">)</span>&nbsp;<span class="ident" id="1547429">Close</span><span class="op" id="1547434">(</span><span class="op" id="1547435">)</span>&nbsp;<span class="builtintype" id="1547437">error</span>&nbsp;<span class="op" id="1547443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1547446">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547503">if</span>&nbsp;<span class="ident" id="1547506">e</span><span class="op" id="1547507">.</span><span class="ident" id="1547508">err</span>&nbsp;<span class="op" id="1547512">==</span>&nbsp;<span class="ident" id="1547515">nil</span>&nbsp;<span class="op" id="1547519">&amp;&amp;</span>&nbsp;<span class="ident" id="1547522">e</span><span class="op" id="1547523">.</span><span class="ident" id="1547524">nbuf</span>&nbsp;<span class="op" id="1547529">&gt;</span>&nbsp;<span class="num" id="1547531">0</span>&nbsp;<span class="op" id="1547533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547537">e</span><span class="op" id="1547538">.</span><span class="ident" id="1547539">enc</span><span class="op" id="1547542">.</span><span class="ident" id="1547543">Encode</span><span class="op" id="1547549">(</span><span class="ident" id="1547550">e</span><span class="op" id="1547551">.</span><span class="ident" id="1547552">out</span><span class="op" id="1547555">[</span><span class="num" id="1547556">0</span><span class="op" id="1547557">:</span><span class="op" id="1547558">]</span><span class="op" id="1547559">,</span>&nbsp;<span class="ident" id="1547561">e</span><span class="op" id="1547562">.</span><span class="ident" id="1547563">buf</span><span class="op" id="1547566">[</span><span class="num" id="1547567">0</span><span class="op" id="1547568">:</span><span class="ident" id="1547569">e</span><span class="op" id="1547570">.</span><span class="ident" id="1547571">nbuf</span><span class="op" id="1547575">]</span><span class="op" id="1547576">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547580">e</span><span class="op" id="1547581">.</span><span class="ident" id="1547582">nbuf</span>&nbsp;<span class="op" id="1547587">=</span>&nbsp;<span class="num" id="1547589">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1547593">_</span><span class="op" id="1547594">,</span>&nbsp;<span class="ident" id="1547596">e</span><span class="op" id="1547597">.</span><span class="ident" id="1547598">err</span>&nbsp;<span class="op" id="1547602">=</span>&nbsp;<span class="ident" id="1547604">e</span><span class="op" id="1547605">.</span><span class="ident" id="1547606">w</span><span class="op" id="1547607">.</span><span class="ident" id="1547608">Write</span><span class="op" id="1547613">(</span><span class="ident" id="1547614">e</span><span class="op" id="1547615">.</span><span class="ident" id="1547616">out</span><span class="op" id="1547619">[</span><span class="num" id="1547620">0</span><span class="op" id="1547621">:</span><span class="num" id="1547622">4</span><span class="op" id="1547623">]</span><span class="op" id="1547624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1547627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1547630">return</span>&nbsp;<span class="ident" id="1547637">e</span><span class="op" id="1547638">.</span><span class="ident" id="1547639">err</span><br>
<span class="lineno"></span><span class="op" id="1547643">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1547646">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1547714">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="1547786">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="1547846">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="1547914">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="1547943">func</span>&nbsp;<span class="ident" id="1547948">NewEncoder</span><span class="op" id="1547958">(</span><span class="ident" id="1547959">enc</span>&nbsp;<span class="op" id="1547963">*</span><span class="ident" id="1547964">Encoding</span><span class="op" id="1547972">,</span>&nbsp;<span class="ident" id="1547974">w</span>&nbsp;<span class="ident" id="1547976">io</span><span class="op" id="1547978">.</span><span class="ident" id="1547979">Writer</span><span class="op" id="1547985">)</span>&nbsp;<span class="ident" id="1547987">io</span><span class="op" id="1547989">.</span><span class="ident" id="1547990">WriteCloser</span>&nbsp;<span class="op" id="1548002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548005">return</span>&nbsp;<span class="op" id="1548012">&amp;</span><span class="ident" id="1548013">encoder</span><span class="op" id="1548020">{</span><span class="ident" id="1548021">enc</span><span class="op" id="1548024">:</span>&nbsp;<span class="ident" id="1548026">enc</span><span class="op" id="1548029">,</span>&nbsp;<span class="ident" id="1548031">w</span><span class="op" id="1548032">:</span>&nbsp;<span class="ident" id="1548034">w</span><span class="op" id="1548035">}</span><br>
<span class="lineno"></span><span class="op" id="1548037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="1548040">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="1548105">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="1548140">func</span>&nbsp;<span class="op" id="1548145">(</span><span class="ident" id="1548146">enc</span>&nbsp;<span class="op" id="1548150">*</span><span class="ident" id="1548151">Encoding</span><span class="op" id="1548159">)</span>&nbsp;<span class="ident" id="1548161">EncodedLen</span><span class="op" id="1548171">(</span><span class="ident" id="1548172">n</span>&nbsp;<span class="builtintype" id="1548174">int</span><span class="op" id="1548177">)</span>&nbsp;<span class="builtintype" id="1548179">int</span>&nbsp;<span class="op" id="1548183">{</span>&nbsp;<span class="keyword" id="1548185">return</span>&nbsp;<span class="op" id="1548192">(</span><span class="ident" id="1548193">n</span>&nbsp;<span class="op" id="1548195">+</span>&nbsp;<span class="num" id="1548197">2</span><span class="op" id="1548198">)</span>&nbsp;<span class="op" id="1548200">/</span>&nbsp;<span class="num" id="1548202">3</span>&nbsp;<span class="op" id="1548204">*</span>&nbsp;<span class="num" id="1548206">4</span>&nbsp;<span class="op" id="1548208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1548211">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1548230">type</span>&nbsp;<span class="ident" id="1548235">CorruptInputError</span>&nbsp;<span class="ident" id="1548253">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="1548260">func</span>&nbsp;<span class="op" id="1548265">(</span><span class="ident" id="1548266">e</span>&nbsp;<span class="ident" id="1548268">CorruptInputError</span><span class="op" id="1548285">)</span>&nbsp;<span class="ident" id="1548287">Error</span><span class="op" id="1548292">(</span><span class="op" id="1548293">)</span>&nbsp;<span class="builtintype" id="1548295">string</span>&nbsp;<span class="op" id="1548302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548305">return</span>&nbsp;<span class="string" id="1548312">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="1548349">+</span>&nbsp;<span class="ident" id="1548351">strconv</span><span class="op" id="1548358">.</span><span class="ident" id="1548359">FormatInt</span><span class="op" id="1548368">(</span><span class="ident" id="1548369">int64</span><span class="op" id="1548374">(</span><span class="ident" id="1548375">e</span><span class="op" id="1548376">)</span><span class="op" id="1548377">,</span>&nbsp;<span class="num" id="1548379">10</span><span class="op" id="1548381">)</span><br>
<span class="lineno"></span><span class="op" id="1548383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1548386">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="1548456">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1548524">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="1548594">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="1548651">func</span>&nbsp;<span class="op" id="1548656">(</span><span class="ident" id="1548657">enc</span>&nbsp;<span class="op" id="1548661">*</span><span class="ident" id="1548662">Encoding</span><span class="op" id="1548670">)</span>&nbsp;<span class="ident" id="1548672">decode</span><span class="op" id="1548678">(</span><span class="ident" id="1548679">dst</span><span class="op" id="1548682">,</span>&nbsp;<span class="ident" id="1548684">src</span>&nbsp;<span class="op" id="1548688">[</span><span class="op" id="1548689">]</span><span class="builtintype" id="1548690">byte</span><span class="op" id="1548694">)</span>&nbsp;<span class="op" id="1548696">(</span><span class="ident" id="1548697">n</span>&nbsp;<span class="builtintype" id="1548699">int</span><span class="op" id="1548702">,</span>&nbsp;<span class="ident" id="1548704">end</span>&nbsp;<span class="builtintype" id="1548708">bool</span><span class="op" id="1548712">,</span>&nbsp;<span class="ident" id="1548714">err</span>&nbsp;<span class="builtintype" id="1548718">error</span><span class="op" id="1548723">)</span>&nbsp;<span class="op" id="1548725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1548728">olen</span>&nbsp;<span class="op" id="1548733">:=</span>&nbsp;<span class="builtinfunc" id="1548736">len</span><span class="op" id="1548739">(</span><span class="ident" id="1548740">src</span><span class="op" id="1548743">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548746">for</span>&nbsp;<span class="builtinfunc" id="1548750">len</span><span class="op" id="1548753">(</span><span class="ident" id="1548754">src</span><span class="op" id="1548757">)</span>&nbsp;<span class="op" id="1548759">&gt;</span>&nbsp;<span class="num" id="1548761">0</span>&nbsp;<span class="op" id="1548763">&amp;&amp;</span>&nbsp;<span class="op" id="1548766">!</span><span class="ident" id="1548767">end</span>&nbsp;<span class="op" id="1548771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1548775">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548821">var</span>&nbsp;<span class="ident" id="1548825">dbuf</span>&nbsp;<span class="op" id="1548830">[</span><span class="num" id="1548831">4</span><span class="op" id="1548832">]</span><span class="builtintype" id="1548833">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1548840">dlen</span>&nbsp;<span class="op" id="1548845">:=</span>&nbsp;<span class="num" id="1548848">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548853">for</span>&nbsp;<span class="ident" id="1548857">j</span>&nbsp;<span class="op" id="1548859">:=</span>&nbsp;<span class="keyword" id="1548862">range</span>&nbsp;<span class="ident" id="1548868">dbuf</span>&nbsp;<span class="op" id="1548873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548878">if</span>&nbsp;<span class="builtinfunc" id="1548881">len</span><span class="op" id="1548884">(</span><span class="ident" id="1548885">src</span><span class="op" id="1548888">)</span>&nbsp;<span class="op" id="1548890">==</span>&nbsp;<span class="num" id="1548893">0</span>&nbsp;<span class="op" id="1548895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548901">return</span>&nbsp;<span class="ident" id="1548908">n</span><span class="op" id="1548909">,</span>&nbsp;<span class="builtintype" id="1548911">false</span><span class="op" id="1548916">,</span>&nbsp;<span class="ident" id="1548918">CorruptInputError</span><span class="op" id="1548935">(</span><span class="ident" id="1548936">olen</span>&nbsp;<span class="op" id="1548941">-</span>&nbsp;<span class="builtinfunc" id="1548943">len</span><span class="op" id="1548946">(</span><span class="ident" id="1548947">src</span><span class="op" id="1548950">)</span>&nbsp;<span class="op" id="1548952">-</span>&nbsp;<span class="ident" id="1548954">j</span><span class="op" id="1548955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1548960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1548965">in</span>&nbsp;<span class="op" id="1548968">:=</span>&nbsp;<span class="ident" id="1548971">src</span><span class="op" id="1548974">[</span><span class="num" id="1548975">0</span><span class="op" id="1548976">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1548981">src</span>&nbsp;<span class="op" id="1548985">=</span>&nbsp;<span class="ident" id="1548987">src</span><span class="op" id="1548990">[</span><span class="num" id="1548991">1</span><span class="op" id="1548992">:</span><span class="op" id="1548993">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1548998">if</span>&nbsp;<span class="ident" id="1549001">in</span>&nbsp;<span class="op" id="1549004">==</span>&nbsp;<span class="string" id="1549007">&#39;=&#39;</span>&nbsp;<span class="op" id="1549011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549017">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549066">switch</span>&nbsp;<span class="ident" id="1549073">j</span>&nbsp;<span class="op" id="1549075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549081">case</span>&nbsp;<span class="num" id="1549086">0</span><span class="op" id="1549087">,</span>&nbsp;<span class="num" id="1549089">1</span><span class="op" id="1549090">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549097">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549123">return</span>&nbsp;<span class="ident" id="1549130">n</span><span class="op" id="1549131">,</span>&nbsp;<span class="builtintype" id="1549133">false</span><span class="op" id="1549138">,</span>&nbsp;<span class="ident" id="1549140">CorruptInputError</span><span class="op" id="1549157">(</span><span class="ident" id="1549158">olen</span>&nbsp;<span class="op" id="1549163">-</span>&nbsp;<span class="builtinfunc" id="1549165">len</span><span class="op" id="1549168">(</span><span class="ident" id="1549169">src</span><span class="op" id="1549172">)</span>&nbsp;<span class="op" id="1549174">-</span>&nbsp;<span class="num" id="1549176">1</span><span class="op" id="1549177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549183">case</span>&nbsp;<span class="num" id="1549188">2</span><span class="op" id="1549189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549196">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549257">if</span>&nbsp;<span class="builtinfunc" id="1549260">len</span><span class="op" id="1549263">(</span><span class="ident" id="1549264">src</span><span class="op" id="1549267">)</span>&nbsp;<span class="op" id="1549269">==</span>&nbsp;<span class="num" id="1549272">0</span>&nbsp;<span class="op" id="1549274">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549282">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549310">return</span>&nbsp;<span class="ident" id="1549317">n</span><span class="op" id="1549318">,</span>&nbsp;<span class="builtintype" id="1549320">false</span><span class="op" id="1549325">,</span>&nbsp;<span class="ident" id="1549327">CorruptInputError</span><span class="op" id="1549344">(</span><span class="ident" id="1549345">olen</span><span class="op" id="1549349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549363">if</span>&nbsp;<span class="ident" id="1549366">src</span><span class="op" id="1549369">[</span><span class="num" id="1549370">0</span><span class="op" id="1549371">]</span>&nbsp;<span class="op" id="1549373">!=</span>&nbsp;<span class="string" id="1549376">&#39;=&#39;</span>&nbsp;<span class="op" id="1549380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549388">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549415">return</span>&nbsp;<span class="ident" id="1549422">n</span><span class="op" id="1549423">,</span>&nbsp;<span class="builtintype" id="1549425">false</span><span class="op" id="1549430">,</span>&nbsp;<span class="ident" id="1549432">CorruptInputError</span><span class="op" id="1549449">(</span><span class="ident" id="1549450">olen</span>&nbsp;<span class="op" id="1549455">-</span>&nbsp;<span class="builtinfunc" id="1549457">len</span><span class="op" id="1549460">(</span><span class="ident" id="1549461">src</span><span class="op" id="1549464">)</span>&nbsp;<span class="op" id="1549466">-</span>&nbsp;<span class="num" id="1549468">1</span><span class="op" id="1549469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549483">src</span>&nbsp;<span class="op" id="1549487">=</span>&nbsp;<span class="ident" id="1549489">src</span><span class="op" id="1549492">[</span><span class="num" id="1549493">1</span><span class="op" id="1549494">:</span><span class="op" id="1549495">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549507">if</span>&nbsp;<span class="builtinfunc" id="1549510">len</span><span class="op" id="1549513">(</span><span class="ident" id="1549514">src</span><span class="op" id="1549517">)</span>&nbsp;<span class="op" id="1549519">&gt;</span>&nbsp;<span class="num" id="1549521">0</span>&nbsp;<span class="op" id="1549523">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549530">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549555">err</span>&nbsp;<span class="op" id="1549559">=</span>&nbsp;<span class="ident" id="1549561">CorruptInputError</span><span class="op" id="1549578">(</span><span class="ident" id="1549579">olen</span>&nbsp;<span class="op" id="1549584">-</span>&nbsp;<span class="builtinfunc" id="1549586">len</span><span class="op" id="1549589">(</span><span class="ident" id="1549590">src</span><span class="op" id="1549593">)</span><span class="op" id="1549594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549606">dlen</span><span class="op" id="1549610">,</span>&nbsp;<span class="ident" id="1549612">end</span>&nbsp;<span class="op" id="1549616">=</span>&nbsp;<span class="ident" id="1549618">j</span><span class="op" id="1549619">,</span>&nbsp;<span class="builtintype" id="1549621">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549630">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549644">dbuf</span><span class="op" id="1549648">[</span><span class="ident" id="1549649">j</span><span class="op" id="1549650">]</span>&nbsp;<span class="op" id="1549652">=</span>&nbsp;<span class="ident" id="1549654">enc</span><span class="op" id="1549657">.</span><span class="ident" id="1549658">decodeMap</span><span class="op" id="1549667">[</span><span class="ident" id="1549668">in</span><span class="op" id="1549670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549675">if</span>&nbsp;<span class="ident" id="1549678">dbuf</span><span class="op" id="1549682">[</span><span class="ident" id="1549683">j</span><span class="op" id="1549684">]</span>&nbsp;<span class="op" id="1549686">==</span>&nbsp;<span class="num" id="1549689">0xFF</span>&nbsp;<span class="op" id="1549694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549700">return</span>&nbsp;<span class="ident" id="1549707">n</span><span class="op" id="1549708">,</span>&nbsp;<span class="builtintype" id="1549710">false</span><span class="op" id="1549715">,</span>&nbsp;<span class="ident" id="1549717">CorruptInputError</span><span class="op" id="1549734">(</span><span class="ident" id="1549735">olen</span>&nbsp;<span class="op" id="1549740">-</span>&nbsp;<span class="builtinfunc" id="1549742">len</span><span class="op" id="1549745">(</span><span class="ident" id="1549746">src</span><span class="op" id="1549749">)</span>&nbsp;<span class="op" id="1549751">-</span>&nbsp;<span class="num" id="1549753">1</span><span class="op" id="1549754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549759">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1549763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549768">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1549825">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549838">switch</span>&nbsp;<span class="ident" id="1549845">dlen</span>&nbsp;<span class="op" id="1549850">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549854">case</span>&nbsp;<span class="num" id="1549859">4</span><span class="op" id="1549860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549865">dst</span><span class="op" id="1549868">[</span><span class="num" id="1549869">2</span><span class="op" id="1549870">]</span>&nbsp;<span class="op" id="1549872">=</span>&nbsp;<span class="ident" id="1549874">dbuf</span><span class="op" id="1549878">[</span><span class="num" id="1549879">2</span><span class="op" id="1549880">]</span><span class="op" id="1549881">&lt;&lt;</span><span class="num" id="1549883">6</span>&nbsp;<span class="op" id="1549885">|</span>&nbsp;<span class="ident" id="1549887">dbuf</span><span class="op" id="1549891">[</span><span class="num" id="1549892">3</span><span class="op" id="1549893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549898">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549912">case</span>&nbsp;<span class="num" id="1549917">3</span><span class="op" id="1549918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549923">dst</span><span class="op" id="1549926">[</span><span class="num" id="1549927">1</span><span class="op" id="1549928">]</span>&nbsp;<span class="op" id="1549930">=</span>&nbsp;<span class="ident" id="1549932">dbuf</span><span class="op" id="1549936">[</span><span class="num" id="1549937">1</span><span class="op" id="1549938">]</span><span class="op" id="1549939">&lt;&lt;</span><span class="num" id="1549941">4</span>&nbsp;<span class="op" id="1549943">|</span>&nbsp;<span class="ident" id="1549945">dbuf</span><span class="op" id="1549949">[</span><span class="num" id="1549950">2</span><span class="op" id="1549951">]</span><span class="op" id="1549952">&gt;&gt;</span><span class="num" id="1549954">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549959">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549973">case</span>&nbsp;<span class="num" id="1549978">2</span><span class="op" id="1549979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1549984">dst</span><span class="op" id="1549987">[</span><span class="num" id="1549988">0</span><span class="op" id="1549989">]</span>&nbsp;<span class="op" id="1549991">=</span>&nbsp;<span class="ident" id="1549993">dbuf</span><span class="op" id="1549997">[</span><span class="num" id="1549998">0</span><span class="op" id="1549999">]</span><span class="op" id="1550000">&lt;&lt;</span><span class="num" id="1550002">2</span>&nbsp;<span class="op" id="1550004">|</span>&nbsp;<span class="ident" id="1550006">dbuf</span><span class="op" id="1550010">[</span><span class="num" id="1550011">1</span><span class="op" id="1550012">]</span><span class="op" id="1550013">&gt;&gt;</span><span class="num" id="1550015">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550023">dst</span>&nbsp;<span class="op" id="1550027">=</span>&nbsp;<span class="ident" id="1550029">dst</span><span class="op" id="1550032">[</span><span class="num" id="1550033">3</span><span class="op" id="1550034">:</span><span class="op" id="1550035">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550039">n</span>&nbsp;<span class="op" id="1550041">+=</span>&nbsp;<span class="ident" id="1550044">dlen</span>&nbsp;<span class="op" id="1550049">-</span>&nbsp;<span class="num" id="1550051">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550058">return</span>&nbsp;<span class="ident" id="1550065">n</span><span class="op" id="1550066">,</span>&nbsp;<span class="ident" id="1550068">end</span><span class="op" id="1550071">,</span>&nbsp;<span class="ident" id="1550073">err</span><br>
<span class="lineno"></span><span class="op" id="1550077">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="1550080">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="1550145">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="1550214">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1550283">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="1550346">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="1550394">func</span>&nbsp;<span class="op" id="1550399">(</span><span class="ident" id="1550400">enc</span>&nbsp;<span class="op" id="1550404">*</span><span class="ident" id="1550405">Encoding</span><span class="op" id="1550413">)</span>&nbsp;<span class="ident" id="1550415">Decode</span><span class="op" id="1550421">(</span><span class="ident" id="1550422">dst</span><span class="op" id="1550425">,</span>&nbsp;<span class="ident" id="1550427">src</span>&nbsp;<span class="op" id="1550431">[</span><span class="op" id="1550432">]</span><span class="builtintype" id="1550433">byte</span><span class="op" id="1550437">)</span>&nbsp;<span class="op" id="1550439">(</span><span class="ident" id="1550440">n</span>&nbsp;<span class="builtintype" id="1550442">int</span><span class="op" id="1550445">,</span>&nbsp;<span class="ident" id="1550447">err</span>&nbsp;<span class="builtintype" id="1550451">error</span><span class="op" id="1550456">)</span>&nbsp;<span class="op" id="1550458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550461">src</span>&nbsp;<span class="op" id="1550465">=</span>&nbsp;<span class="ident" id="1550467">bytes</span><span class="op" id="1550472">.</span><span class="ident" id="1550473">Map</span><span class="op" id="1550476">(</span><span class="ident" id="1550477">removeNewlinesMapper</span><span class="op" id="1550497">,</span>&nbsp;<span class="ident" id="1550499">src</span><span class="op" id="1550502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550505">n</span><span class="op" id="1550506">,</span>&nbsp;<span class="ident" id="1550508">_</span><span class="op" id="1550509">,</span>&nbsp;<span class="ident" id="1550511">err</span>&nbsp;<span class="op" id="1550515">=</span>&nbsp;<span class="ident" id="1550517">enc</span><span class="op" id="1550520">.</span><span class="ident" id="1550521">decode</span><span class="op" id="1550527">(</span><span class="ident" id="1550528">dst</span><span class="op" id="1550531">,</span>&nbsp;<span class="ident" id="1550533">src</span><span class="op" id="1550536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550539">return</span><br>
<span class="lineno">290</span><span class="op" id="1550546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1550549">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1550619">func</span>&nbsp;<span class="op" id="1550624">(</span><span class="ident" id="1550625">enc</span>&nbsp;<span class="op" id="1550629">*</span><span class="ident" id="1550630">Encoding</span><span class="op" id="1550638">)</span>&nbsp;<span class="ident" id="1550640">DecodeString</span><span class="op" id="1550652">(</span><span class="ident" id="1550653">s</span>&nbsp;<span class="builtintype" id="1550655">string</span><span class="op" id="1550661">)</span>&nbsp;<span class="op" id="1550663">(</span><span class="op" id="1550664">[</span><span class="op" id="1550665">]</span><span class="builtintype" id="1550666">byte</span><span class="op" id="1550670">,</span>&nbsp;<span class="builtintype" id="1550672">error</span><span class="op" id="1550677">)</span>&nbsp;<span class="op" id="1550679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550682">s</span>&nbsp;<span class="op" id="1550684">=</span>&nbsp;<span class="ident" id="1550686">strings</span><span class="op" id="1550693">.</span><span class="ident" id="1550694">Map</span><span class="op" id="1550697">(</span><span class="ident" id="1550698">removeNewlinesMapper</span><span class="op" id="1550718">,</span>&nbsp;<span class="ident" id="1550720">s</span><span class="op" id="1550721">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550724">dbuf</span>&nbsp;<span class="op" id="1550729">:=</span>&nbsp;<span class="builtinfunc" id="1550732">make</span><span class="op" id="1550736">(</span><span class="op" id="1550737">[</span><span class="op" id="1550738">]</span><span class="builtintype" id="1550739">byte</span><span class="op" id="1550743">,</span>&nbsp;<span class="ident" id="1550745">enc</span><span class="op" id="1550748">.</span><span class="ident" id="1550749">DecodedLen</span><span class="op" id="1550759">(</span><span class="builtinfunc" id="1550760">len</span><span class="op" id="1550763">(</span><span class="ident" id="1550764">s</span><span class="op" id="1550765">)</span><span class="op" id="1550766">)</span><span class="op" id="1550767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550770">n</span><span class="op" id="1550771">,</span>&nbsp;<span class="ident" id="1550773">_</span><span class="op" id="1550774">,</span>&nbsp;<span class="ident" id="1550776">err</span>&nbsp;<span class="op" id="1550780">:=</span>&nbsp;<span class="ident" id="1550783">enc</span><span class="op" id="1550786">.</span><span class="ident" id="1550787">decode</span><span class="op" id="1550793">(</span><span class="ident" id="1550794">dbuf</span><span class="op" id="1550798">,</span>&nbsp;<span class="op" id="1550800">[</span><span class="op" id="1550801">]</span><span class="builtintype" id="1550802">byte</span><span class="op" id="1550806">(</span><span class="ident" id="1550807">s</span><span class="op" id="1550808">)</span><span class="op" id="1550809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550812">return</span>&nbsp;<span class="ident" id="1550819">dbuf</span><span class="op" id="1550823">[</span><span class="op" id="1550824">:</span><span class="ident" id="1550825">n</span><span class="op" id="1550826">]</span><span class="op" id="1550827">,</span>&nbsp;<span class="ident" id="1550829">err</span><br>
<span class="lineno"></span><span class="op" id="1550833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="1550836">type</span>&nbsp;<span class="ident" id="1550841">decoder</span>&nbsp;<span class="keyword" id="1550849">struct</span>&nbsp;<span class="op" id="1550856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550859">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1550866">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550873">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1550880">*</span><span class="ident" id="1550881">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550891">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1550898">io</span><span class="op" id="1550900">.</span><span class="ident" id="1550901">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550909">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1550916">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1550927">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550950">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1550957">[</span><span class="num" id="1550958">1024</span><span class="op" id="1550962">]</span><span class="builtintype" id="1550963">byte</span>&nbsp;<span class="comment" id="1550968">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550987">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1550994">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550999">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1551006">[</span><span class="op" id="1551007">]</span><span class="builtintype" id="1551008">byte</span>&nbsp;<span class="comment" id="1551013">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551041">outbuf</span>&nbsp;<span class="op" id="1551048">[</span><span class="num" id="1551049">1024</span>&nbsp;<span class="op" id="1551054">/</span>&nbsp;<span class="num" id="1551056">4</span>&nbsp;<span class="op" id="1551058">*</span>&nbsp;<span class="num" id="1551060">3</span><span class="op" id="1551061">]</span><span class="builtintype" id="1551062">byte</span><br>
<span class="lineno"></span><span class="op" id="1551067">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="1551070">func</span>&nbsp;<span class="op" id="1551075">(</span><span class="ident" id="1551076">d</span>&nbsp;<span class="op" id="1551078">*</span><span class="ident" id="1551079">decoder</span><span class="op" id="1551086">)</span>&nbsp;<span class="ident" id="1551088">Read</span><span class="op" id="1551092">(</span><span class="ident" id="1551093">p</span>&nbsp;<span class="op" id="1551095">[</span><span class="op" id="1551096">]</span><span class="builtintype" id="1551097">byte</span><span class="op" id="1551101">)</span>&nbsp;<span class="op" id="1551103">(</span><span class="ident" id="1551104">n</span>&nbsp;<span class="builtintype" id="1551106">int</span><span class="op" id="1551109">,</span>&nbsp;<span class="ident" id="1551111">err</span>&nbsp;<span class="builtintype" id="1551115">error</span><span class="op" id="1551120">)</span>&nbsp;<span class="op" id="1551122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551125">if</span>&nbsp;<span class="ident" id="1551128">d</span><span class="op" id="1551129">.</span><span class="ident" id="1551130">err</span>&nbsp;<span class="op" id="1551134">!=</span>&nbsp;<span class="ident" id="1551137">nil</span>&nbsp;<span class="op" id="1551141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551145">return</span>&nbsp;<span class="num" id="1551152">0</span><span class="op" id="1551153">,</span>&nbsp;<span class="ident" id="1551155">d</span><span class="op" id="1551156">.</span><span class="ident" id="1551157">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551162">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1551166">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551214">if</span>&nbsp;<span class="builtinfunc" id="1551217">len</span><span class="op" id="1551220">(</span><span class="ident" id="1551221">d</span><span class="op" id="1551222">.</span><span class="ident" id="1551223">out</span><span class="op" id="1551226">)</span>&nbsp;<span class="op" id="1551228">&gt;</span>&nbsp;<span class="num" id="1551230">0</span>&nbsp;<span class="op" id="1551232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551236">n</span>&nbsp;<span class="op" id="1551238">=</span>&nbsp;<span class="builtinfunc" id="1551240">copy</span><span class="op" id="1551244">(</span><span class="ident" id="1551245">p</span><span class="op" id="1551246">,</span>&nbsp;<span class="ident" id="1551248">d</span><span class="op" id="1551249">.</span><span class="ident" id="1551250">out</span><span class="op" id="1551253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551257">d</span><span class="op" id="1551258">.</span><span class="ident" id="1551259">out</span>&nbsp;<span class="op" id="1551263">=</span>&nbsp;<span class="ident" id="1551265">d</span><span class="op" id="1551266">.</span><span class="ident" id="1551267">out</span><span class="op" id="1551270">[</span><span class="ident" id="1551271">n</span><span class="op" id="1551272">:</span><span class="op" id="1551273">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551277">return</span>&nbsp;<span class="ident" id="1551284">n</span><span class="op" id="1551285">,</span>&nbsp;<span class="ident" id="1551287">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1551296">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551314">nn</span>&nbsp;<span class="op" id="1551317">:=</span>&nbsp;<span class="builtinfunc" id="1551320">len</span><span class="op" id="1551323">(</span><span class="ident" id="1551324">p</span><span class="op" id="1551325">)</span>&nbsp;<span class="op" id="1551327">/</span>&nbsp;<span class="num" id="1551329">3</span>&nbsp;<span class="op" id="1551331">*</span>&nbsp;<span class="num" id="1551333">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551336">if</span>&nbsp;<span class="ident" id="1551339">nn</span>&nbsp;<span class="op" id="1551342">&lt;</span>&nbsp;<span class="num" id="1551344">4</span>&nbsp;<span class="op" id="1551346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551350">nn</span>&nbsp;<span class="op" id="1551353">=</span>&nbsp;<span class="num" id="1551355">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551361">if</span>&nbsp;<span class="ident" id="1551364">nn</span>&nbsp;<span class="op" id="1551367">&gt;</span>&nbsp;<span class="builtinfunc" id="1551369">len</span><span class="op" id="1551372">(</span><span class="ident" id="1551373">d</span><span class="op" id="1551374">.</span><span class="ident" id="1551375">buf</span><span class="op" id="1551378">)</span>&nbsp;<span class="op" id="1551380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551384">nn</span>&nbsp;<span class="op" id="1551387">=</span>&nbsp;<span class="builtinfunc" id="1551389">len</span><span class="op" id="1551392">(</span><span class="ident" id="1551393">d</span><span class="op" id="1551394">.</span><span class="ident" id="1551395">buf</span><span class="op" id="1551398">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551404">nn</span><span class="op" id="1551406">,</span>&nbsp;<span class="ident" id="1551408">d</span><span class="op" id="1551409">.</span><span class="ident" id="1551410">err</span>&nbsp;<span class="op" id="1551414">=</span>&nbsp;<span class="ident" id="1551416">io</span><span class="op" id="1551418">.</span><span class="ident" id="1551419">ReadAtLeast</span><span class="op" id="1551430">(</span><span class="ident" id="1551431">d</span><span class="op" id="1551432">.</span><span class="ident" id="1551433">r</span><span class="op" id="1551434">,</span>&nbsp;<span class="ident" id="1551436">d</span><span class="op" id="1551437">.</span><span class="ident" id="1551438">buf</span><span class="op" id="1551441">[</span><span class="ident" id="1551442">d</span><span class="op" id="1551443">.</span><span class="ident" id="1551444">nbuf</span><span class="op" id="1551448">:</span><span class="ident" id="1551449">nn</span><span class="op" id="1551451">]</span><span class="op" id="1551452">,</span>&nbsp;<span class="num" id="1551454">4</span><span class="op" id="1551455">-</span><span class="ident" id="1551456">d</span><span class="op" id="1551457">.</span><span class="ident" id="1551458">nbuf</span><span class="op" id="1551462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551465">d</span><span class="op" id="1551466">.</span><span class="ident" id="1551467">nbuf</span>&nbsp;<span class="op" id="1551472">+=</span>&nbsp;<span class="ident" id="1551475">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551479">if</span>&nbsp;<span class="ident" id="1551482">d</span><span class="op" id="1551483">.</span><span class="ident" id="1551484">err</span>&nbsp;<span class="op" id="1551488">!=</span>&nbsp;<span class="ident" id="1551491">nil</span>&nbsp;<span class="op" id="1551495">||</span>&nbsp;<span class="ident" id="1551498">d</span><span class="op" id="1551499">.</span><span class="ident" id="1551500">nbuf</span>&nbsp;<span class="op" id="1551505">&lt;</span>&nbsp;<span class="num" id="1551507">4</span>&nbsp;<span class="op" id="1551509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551513">return</span>&nbsp;<span class="num" id="1551520">0</span><span class="op" id="1551521">,</span>&nbsp;<span class="ident" id="1551523">d</span><span class="op" id="1551524">.</span><span class="ident" id="1551525">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1551534">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551598">nr</span>&nbsp;<span class="op" id="1551601">:=</span>&nbsp;<span class="ident" id="1551604">d</span><span class="op" id="1551605">.</span><span class="ident" id="1551606">nbuf</span>&nbsp;<span class="op" id="1551611">/</span>&nbsp;<span class="num" id="1551613">4</span>&nbsp;<span class="op" id="1551615">*</span>&nbsp;<span class="num" id="1551617">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551620">nw</span>&nbsp;<span class="op" id="1551623">:=</span>&nbsp;<span class="ident" id="1551626">d</span><span class="op" id="1551627">.</span><span class="ident" id="1551628">nbuf</span>&nbsp;<span class="op" id="1551633">/</span>&nbsp;<span class="num" id="1551635">4</span>&nbsp;<span class="op" id="1551637">*</span>&nbsp;<span class="num" id="1551639">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551642">if</span>&nbsp;<span class="ident" id="1551645">nw</span>&nbsp;<span class="op" id="1551648">&gt;</span>&nbsp;<span class="builtinfunc" id="1551650">len</span><span class="op" id="1551653">(</span><span class="ident" id="1551654">p</span><span class="op" id="1551655">)</span>&nbsp;<span class="op" id="1551657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551661">nw</span><span class="op" id="1551663">,</span>&nbsp;<span class="ident" id="1551665">d</span><span class="op" id="1551666">.</span><span class="ident" id="1551667">end</span><span class="op" id="1551670">,</span>&nbsp;<span class="ident" id="1551672">d</span><span class="op" id="1551673">.</span><span class="ident" id="1551674">err</span>&nbsp;<span class="op" id="1551678">=</span>&nbsp;<span class="ident" id="1551680">d</span><span class="op" id="1551681">.</span><span class="ident" id="1551682">enc</span><span class="op" id="1551685">.</span><span class="ident" id="1551686">decode</span><span class="op" id="1551692">(</span><span class="ident" id="1551693">d</span><span class="op" id="1551694">.</span><span class="ident" id="1551695">outbuf</span><span class="op" id="1551701">[</span><span class="num" id="1551702">0</span><span class="op" id="1551703">:</span><span class="op" id="1551704">]</span><span class="op" id="1551705">,</span>&nbsp;<span class="ident" id="1551707">d</span><span class="op" id="1551708">.</span><span class="ident" id="1551709">buf</span><span class="op" id="1551712">[</span><span class="num" id="1551713">0</span><span class="op" id="1551714">:</span><span class="ident" id="1551715">nr</span><span class="op" id="1551717">]</span><span class="op" id="1551718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551722">d</span><span class="op" id="1551723">.</span><span class="ident" id="1551724">out</span>&nbsp;<span class="op" id="1551728">=</span>&nbsp;<span class="ident" id="1551730">d</span><span class="op" id="1551731">.</span><span class="ident" id="1551732">outbuf</span><span class="op" id="1551738">[</span><span class="num" id="1551739">0</span><span class="op" id="1551740">:</span><span class="ident" id="1551741">nw</span><span class="op" id="1551743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551747">n</span>&nbsp;<span class="op" id="1551749">=</span>&nbsp;<span class="builtinfunc" id="1551751">copy</span><span class="op" id="1551755">(</span><span class="ident" id="1551756">p</span><span class="op" id="1551757">,</span>&nbsp;<span class="ident" id="1551759">d</span><span class="op" id="1551760">.</span><span class="ident" id="1551761">out</span><span class="op" id="1551764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551768">d</span><span class="op" id="1551769">.</span><span class="ident" id="1551770">out</span>&nbsp;<span class="op" id="1551774">=</span>&nbsp;<span class="ident" id="1551776">d</span><span class="op" id="1551777">.</span><span class="ident" id="1551778">out</span><span class="op" id="1551781">[</span><span class="ident" id="1551782">n</span><span class="op" id="1551783">:</span><span class="op" id="1551784">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551787">}</span>&nbsp;<span class="keyword" id="1551789">else</span>&nbsp;<span class="op" id="1551794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551798">n</span><span class="op" id="1551799">,</span>&nbsp;<span class="ident" id="1551801">d</span><span class="op" id="1551802">.</span><span class="ident" id="1551803">end</span><span class="op" id="1551806">,</span>&nbsp;<span class="ident" id="1551808">d</span><span class="op" id="1551809">.</span><span class="ident" id="1551810">err</span>&nbsp;<span class="op" id="1551814">=</span>&nbsp;<span class="ident" id="1551816">d</span><span class="op" id="1551817">.</span><span class="ident" id="1551818">enc</span><span class="op" id="1551821">.</span><span class="ident" id="1551822">decode</span><span class="op" id="1551828">(</span><span class="ident" id="1551829">p</span><span class="op" id="1551830">,</span>&nbsp;<span class="ident" id="1551832">d</span><span class="op" id="1551833">.</span><span class="ident" id="1551834">buf</span><span class="op" id="1551837">[</span><span class="num" id="1551838">0</span><span class="op" id="1551839">:</span><span class="ident" id="1551840">nr</span><span class="op" id="1551842">]</span><span class="op" id="1551843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551849">d</span><span class="op" id="1551850">.</span><span class="ident" id="1551851">nbuf</span>&nbsp;<span class="op" id="1551856">-=</span>&nbsp;<span class="ident" id="1551859">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551863">for</span>&nbsp;<span class="ident" id="1551867">i</span>&nbsp;<span class="op" id="1551869">:=</span>&nbsp;<span class="num" id="1551872">0</span><span class="op" id="1551873">;</span>&nbsp;<span class="ident" id="1551875">i</span>&nbsp;<span class="op" id="1551877">&lt;</span>&nbsp;<span class="ident" id="1551879">d</span><span class="op" id="1551880">.</span><span class="ident" id="1551881">nbuf</span><span class="op" id="1551885">;</span>&nbsp;<span class="ident" id="1551887">i</span><span class="op" id="1551888">++</span>&nbsp;<span class="op" id="1551891">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551895">d</span><span class="op" id="1551896">.</span><span class="ident" id="1551897">buf</span><span class="op" id="1551900">[</span><span class="ident" id="1551901">i</span><span class="op" id="1551902">]</span>&nbsp;<span class="op" id="1551904">=</span>&nbsp;<span class="ident" id="1551906">d</span><span class="op" id="1551907">.</span><span class="ident" id="1551908">buf</span><span class="op" id="1551911">[</span><span class="ident" id="1551912">i</span><span class="op" id="1551913">+</span><span class="ident" id="1551914">nr</span><span class="op" id="1551916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551923">if</span>&nbsp;<span class="ident" id="1551926">d</span><span class="op" id="1551927">.</span><span class="ident" id="1551928">err</span>&nbsp;<span class="op" id="1551932">==</span>&nbsp;<span class="ident" id="1551935">nil</span>&nbsp;<span class="op" id="1551939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551943">d</span><span class="op" id="1551944">.</span><span class="ident" id="1551945">err</span>&nbsp;<span class="op" id="1551949">=</span>&nbsp;<span class="ident" id="1551951">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551959">return</span>&nbsp;<span class="ident" id="1551966">n</span><span class="op" id="1551967">,</span>&nbsp;<span class="ident" id="1551969">d</span><span class="op" id="1551970">.</span><span class="ident" id="1551971">err</span><br>
<span class="lineno"></span><span class="op" id="1551975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1551978">type</span>&nbsp;<span class="ident" id="1551983">newlineFilteringReader</span>&nbsp;<span class="keyword" id="1552006">struct</span>&nbsp;<span class="op" id="1552013">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552016">wrapped</span>&nbsp;<span class="ident" id="1552024">io</span><span class="op" id="1552026">.</span><span class="ident" id="1552027">Reader</span><br>
<span class="lineno"></span><span class="op" id="1552034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1552037">func</span>&nbsp;<span class="op" id="1552042">(</span><span class="ident" id="1552043">r</span>&nbsp;<span class="op" id="1552045">*</span><span class="ident" id="1552046">newlineFilteringReader</span><span class="op" id="1552068">)</span>&nbsp;<span class="ident" id="1552070">Read</span><span class="op" id="1552074">(</span><span class="ident" id="1552075">p</span>&nbsp;<span class="op" id="1552077">[</span><span class="op" id="1552078">]</span><span class="builtintype" id="1552079">byte</span><span class="op" id="1552083">)</span>&nbsp;<span class="op" id="1552085">(</span><span class="builtintype" id="1552086">int</span><span class="op" id="1552089">,</span>&nbsp;<span class="builtintype" id="1552091">error</span><span class="op" id="1552096">)</span>&nbsp;<span class="op" id="1552098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552101">n</span><span class="op" id="1552102">,</span>&nbsp;<span class="ident" id="1552104">err</span>&nbsp;<span class="op" id="1552108">:=</span>&nbsp;<span class="ident" id="1552111">r</span><span class="op" id="1552112">.</span><span class="ident" id="1552113">wrapped</span><span class="op" id="1552120">.</span><span class="ident" id="1552121">Read</span><span class="op" id="1552125">(</span><span class="ident" id="1552126">p</span><span class="op" id="1552127">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552130">for</span>&nbsp;<span class="ident" id="1552134">n</span>&nbsp;<span class="op" id="1552136">&gt;</span>&nbsp;<span class="num" id="1552138">0</span>&nbsp;<span class="op" id="1552140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552144">offset</span>&nbsp;<span class="op" id="1552151">:=</span>&nbsp;<span class="num" id="1552154">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552158">for</span>&nbsp;<span class="ident" id="1552162">i</span><span class="op" id="1552163">,</span>&nbsp;<span class="ident" id="1552165">b</span>&nbsp;<span class="op" id="1552167">:=</span>&nbsp;<span class="keyword" id="1552170">range</span>&nbsp;<span class="ident" id="1552176">p</span><span class="op" id="1552177">[</span><span class="num" id="1552178">0</span><span class="op" id="1552179">:</span><span class="ident" id="1552180">n</span><span class="op" id="1552181">]</span>&nbsp;<span class="op" id="1552183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552188">if</span>&nbsp;<span class="ident" id="1552191">b</span>&nbsp;<span class="op" id="1552193">!=</span>&nbsp;<span class="string" id="1552196">&#39;\r&#39;</span>&nbsp;<span class="op" id="1552201">&amp;&amp;</span>&nbsp;<span class="ident" id="1552204">b</span>&nbsp;<span class="op" id="1552206">!=</span>&nbsp;<span class="string" id="1552209">&#39;\n&#39;</span>&nbsp;<span class="op" id="1552214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552220">if</span>&nbsp;<span class="ident" id="1552223">i</span>&nbsp;<span class="op" id="1552225">!=</span>&nbsp;<span class="ident" id="1552228">offset</span>&nbsp;<span class="op" id="1552235">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552242">p</span><span class="op" id="1552243">[</span><span class="ident" id="1552244">offset</span><span class="op" id="1552250">]</span>&nbsp;<span class="op" id="1552252">=</span>&nbsp;<span class="ident" id="1552254">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552266">offset</span><span class="op" id="1552272">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552282">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552286">if</span>&nbsp;<span class="ident" id="1552289">offset</span>&nbsp;<span class="op" id="1552296">&gt;</span>&nbsp;<span class="num" id="1552298">0</span>&nbsp;<span class="op" id="1552300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552305">return</span>&nbsp;<span class="ident" id="1552312">offset</span><span class="op" id="1552318">,</span>&nbsp;<span class="ident" id="1552320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1552330">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552383">n</span><span class="op" id="1552384">,</span>&nbsp;<span class="ident" id="1552386">err</span>&nbsp;<span class="op" id="1552390">=</span>&nbsp;<span class="ident" id="1552392">r</span><span class="op" id="1552393">.</span><span class="ident" id="1552394">wrapped</span><span class="op" id="1552401">.</span><span class="ident" id="1552402">Read</span><span class="op" id="1552406">(</span><span class="ident" id="1552407">p</span><span class="op" id="1552408">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552414">return</span>&nbsp;<span class="ident" id="1552421">n</span><span class="op" id="1552422">,</span>&nbsp;<span class="ident" id="1552424">err</span><br>
<span class="lineno"></span><span class="op" id="1552428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1552431">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="1552485">func</span>&nbsp;<span class="ident" id="1552490">NewDecoder</span><span class="op" id="1552500">(</span><span class="ident" id="1552501">enc</span>&nbsp;<span class="op" id="1552505">*</span><span class="ident" id="1552506">Encoding</span><span class="op" id="1552514">,</span>&nbsp;<span class="ident" id="1552516">r</span>&nbsp;<span class="ident" id="1552518">io</span><span class="op" id="1552520">.</span><span class="ident" id="1552521">Reader</span><span class="op" id="1552527">)</span>&nbsp;<span class="ident" id="1552529">io</span><span class="op" id="1552531">.</span><span class="ident" id="1552532">Reader</span>&nbsp;<span class="op" id="1552539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552542">return</span>&nbsp;<span class="op" id="1552549">&amp;</span><span class="ident" id="1552550">decoder</span><span class="op" id="1552557">{</span><span class="ident" id="1552558">enc</span><span class="op" id="1552561">:</span>&nbsp;<span class="ident" id="1552563">enc</span><span class="op" id="1552566">,</span>&nbsp;<span class="ident" id="1552568">r</span><span class="op" id="1552569">:</span>&nbsp;<span class="op" id="1552571">&amp;</span><span class="ident" id="1552572">newlineFilteringReader</span><span class="op" id="1552594">{</span><span class="ident" id="1552595">r</span><span class="op" id="1552596">}</span><span class="op" id="1552597">}</span><br>
<span class="lineno"></span><span class="op" id="1552599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1552602">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="1552672">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1552724">func</span>&nbsp;<span class="op" id="1552729">(</span><span class="ident" id="1552730">enc</span>&nbsp;<span class="op" id="1552734">*</span><span class="ident" id="1552735">Encoding</span><span class="op" id="1552743">)</span>&nbsp;<span class="ident" id="1552745">DecodedLen</span><span class="op" id="1552755">(</span><span class="ident" id="1552756">n</span>&nbsp;<span class="builtintype" id="1552758">int</span><span class="op" id="1552761">)</span>&nbsp;<span class="builtintype" id="1552763">int</span>&nbsp;<span class="op" id="1552767">{</span>&nbsp;<span class="keyword" id="1552769">return</span>&nbsp;<span class="ident" id="1552776">n</span>&nbsp;<span class="op" id="1552778">/</span>&nbsp;<span class="num" id="1552780">4</span>&nbsp;<span class="op" id="1552782">*</span>&nbsp;<span class="num" id="1552784">3</span>&nbsp;<span class="op" id="1552786">}</span>
</div>
</body>
</html>
