<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3632983">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3633038">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3633092">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3633143">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633192">package</span>&nbsp;<span class="ident" id="3633200">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633205">import</span>&nbsp;<span class="op" id="3633212">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3633215">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3633223">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3633230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633233">const</span>&nbsp;<span class="ident" id="3633239">cacheMaxAge</span>&nbsp;<span class="op" id="3633251">=</span>&nbsp;<span class="num" id="3633253">5</span>&nbsp;<span class="op" id="3633255">*</span>&nbsp;<span class="ident" id="3633257">time</span><span class="op" id="3633261">.</span><span class="ident" id="3633262">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3633270">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3633334">var</span>&nbsp;<span class="ident" id="3633338">hostsPath</span>&nbsp;<span class="op" id="3633348">=</span>&nbsp;<span class="string" id="3633350">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3633364">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3633381">var</span>&nbsp;<span class="ident" id="3633385">hosts</span>&nbsp;<span class="keyword" id="3633391">struct</span>&nbsp;<span class="op" id="3633398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633401">sync</span><span class="op" id="3633405">.</span><span class="ident" id="3633406">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633413">byName</span>&nbsp;<span class="keyword" id="3633420">map</span><span class="op" id="3633423">[</span><span class="builtintype" id="3633424">string</span><span class="op" id="3633430">]</span><span class="op" id="3633431">[</span><span class="op" id="3633432">]</span><span class="builtintype" id="3633433">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633441">byAddr</span>&nbsp;<span class="keyword" id="3633448">map</span><span class="op" id="3633451">[</span><span class="builtintype" id="3633452">string</span><span class="op" id="3633458">]</span><span class="op" id="3633459">[</span><span class="op" id="3633460">]</span><span class="builtintype" id="3633461">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633469">expire</span>&nbsp;<span class="ident" id="3633476">time</span><span class="op" id="3633480">.</span><span class="ident" id="3633481">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633487">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3633494">string</span><br>
<span class="lineno"></span><span class="op" id="3633501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633504">func</span>&nbsp;<span class="ident" id="3633509">readHosts</span><span class="op" id="3633518">(</span><span class="op" id="3633519">)</span>&nbsp;<span class="op" id="3633521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633524">now</span>&nbsp;<span class="op" id="3633528">:=</span>&nbsp;<span class="ident" id="3633531">time</span><span class="op" id="3633535">.</span><span class="ident" id="3633536">Now</span><span class="op" id="3633539">(</span><span class="op" id="3633540">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633543">hp</span>&nbsp;<span class="op" id="3633546">:=</span>&nbsp;<span class="ident" id="3633549">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633560">if</span>&nbsp;<span class="builtinfunc" id="3633563">len</span><span class="op" id="3633566">(</span><span class="ident" id="3633567">hosts</span><span class="op" id="3633572">.</span><span class="ident" id="3633573">byName</span><span class="op" id="3633579">)</span>&nbsp;<span class="op" id="3633581">==</span>&nbsp;<span class="num" id="3633584">0</span>&nbsp;<span class="op" id="3633586">||</span>&nbsp;<span class="ident" id="3633589">now</span><span class="op" id="3633592">.</span><span class="ident" id="3633593">After</span><span class="op" id="3633598">(</span><span class="ident" id="3633599">hosts</span><span class="op" id="3633604">.</span><span class="ident" id="3633605">expire</span><span class="op" id="3633611">)</span>&nbsp;<span class="op" id="3633613">||</span>&nbsp;<span class="ident" id="3633616">hosts</span><span class="op" id="3633621">.</span><span class="ident" id="3633622">path</span>&nbsp;<span class="op" id="3633627">!=</span>&nbsp;<span class="ident" id="3633630">hp</span>&nbsp;<span class="op" id="3633633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633637">hs</span>&nbsp;<span class="op" id="3633640">:=</span>&nbsp;<span class="builtinfunc" id="3633643">make</span><span class="op" id="3633647">(</span><span class="keyword" id="3633648">map</span><span class="op" id="3633651">[</span><span class="builtintype" id="3633652">string</span><span class="op" id="3633658">]</span><span class="op" id="3633659">[</span><span class="op" id="3633660">]</span><span class="builtintype" id="3633661">string</span><span class="op" id="3633667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633671">is</span>&nbsp;<span class="op" id="3633674">:=</span>&nbsp;<span class="builtinfunc" id="3633677">make</span><span class="op" id="3633681">(</span><span class="keyword" id="3633682">map</span><span class="op" id="3633685">[</span><span class="builtintype" id="3633686">string</span><span class="op" id="3633692">]</span><span class="op" id="3633693">[</span><span class="op" id="3633694">]</span><span class="builtintype" id="3633695">string</span><span class="op" id="3633701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633705">var</span>&nbsp;<span class="ident" id="3633709">file</span>&nbsp;<span class="op" id="3633714">*</span><span class="ident" id="3633715">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633722">if</span>&nbsp;<span class="ident" id="3633725">file</span><span class="op" id="3633729">,</span>&nbsp;<span class="ident" id="3633731">_</span>&nbsp;<span class="op" id="3633733">=</span>&nbsp;<span class="ident" id="3633735">open</span><span class="op" id="3633739">(</span><span class="ident" id="3633740">hp</span><span class="op" id="3633742">)</span><span class="op" id="3633743">;</span>&nbsp;<span class="ident" id="3633745">file</span>&nbsp;<span class="op" id="3633750">==</span>&nbsp;<span class="ident" id="3633753">nil</span>&nbsp;<span class="op" id="3633757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633775">for</span>&nbsp;<span class="ident" id="3633779">line</span><span class="op" id="3633783">,</span>&nbsp;<span class="ident" id="3633785">ok</span>&nbsp;<span class="op" id="3633788">:=</span>&nbsp;<span class="ident" id="3633791">file</span><span class="op" id="3633795">.</span><span class="ident" id="3633796">readLine</span><span class="op" id="3633804">(</span><span class="op" id="3633805">)</span><span class="op" id="3633806">;</span>&nbsp;<span class="ident" id="3633808">ok</span><span class="op" id="3633810">;</span>&nbsp;<span class="ident" id="3633812">line</span><span class="op" id="3633816">,</span>&nbsp;<span class="ident" id="3633818">ok</span>&nbsp;<span class="op" id="3633821">=</span>&nbsp;<span class="ident" id="3633823">file</span><span class="op" id="3633827">.</span><span class="ident" id="3633828">readLine</span><span class="op" id="3633836">(</span><span class="op" id="3633837">)</span>&nbsp;<span class="op" id="3633839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633844">if</span>&nbsp;<span class="ident" id="3633847">i</span>&nbsp;<span class="op" id="3633849">:=</span>&nbsp;<span class="ident" id="3633852">byteIndex</span><span class="op" id="3633861">(</span><span class="ident" id="3633862">line</span><span class="op" id="3633866">,</span>&nbsp;<span class="string" id="3633868">&#39;#&#39;</span><span class="op" id="3633871">)</span><span class="op" id="3633872">;</span>&nbsp;<span class="ident" id="3633874">i</span>&nbsp;<span class="op" id="3633876">&gt;=</span>&nbsp;<span class="num" id="3633879">0</span>&nbsp;<span class="op" id="3633881">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633887">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633912">line</span>&nbsp;<span class="op" id="3633917">=</span>&nbsp;<span class="ident" id="3633919">line</span><span class="op" id="3633923">[</span><span class="num" id="3633924">0</span><span class="op" id="3633925">:</span><span class="ident" id="3633926">i</span><span class="op" id="3633927">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633937">f</span>&nbsp;<span class="op" id="3633939">:=</span>&nbsp;<span class="ident" id="3633942">getFields</span><span class="op" id="3633951">(</span><span class="ident" id="3633952">line</span><span class="op" id="3633956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633961">if</span>&nbsp;<span class="builtinfunc" id="3633964">len</span><span class="op" id="3633967">(</span><span class="ident" id="3633968">f</span><span class="op" id="3633969">)</span>&nbsp;<span class="op" id="3633971">&lt;</span>&nbsp;<span class="num" id="3633973">2</span>&nbsp;<span class="op" id="3633975">||</span>&nbsp;<span class="ident" id="3633978">ParseIP</span><span class="op" id="3633985">(</span><span class="ident" id="3633986">f</span><span class="op" id="3633987">[</span><span class="num" id="3633988">0</span><span class="op" id="3633989">]</span><span class="op" id="3633990">)</span>&nbsp;<span class="op" id="3633992">==</span>&nbsp;<span class="ident" id="3633995">nil</span>&nbsp;<span class="op" id="3633999">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634005">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634022">for</span>&nbsp;<span class="ident" id="3634026">i</span>&nbsp;<span class="op" id="3634028">:=</span>&nbsp;<span class="num" id="3634031">1</span><span class="op" id="3634032">;</span>&nbsp;<span class="ident" id="3634034">i</span>&nbsp;<span class="op" id="3634036">&lt;</span>&nbsp;<span class="builtinfunc" id="3634038">len</span><span class="op" id="3634041">(</span><span class="ident" id="3634042">f</span><span class="op" id="3634043">)</span><span class="op" id="3634044">;</span>&nbsp;<span class="ident" id="3634046">i</span><span class="op" id="3634047">++</span>&nbsp;<span class="op" id="3634050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634056">h</span>&nbsp;<span class="op" id="3634058">:=</span>&nbsp;<span class="ident" id="3634061">f</span><span class="op" id="3634062">[</span><span class="ident" id="3634063">i</span><span class="op" id="3634064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634070">hs</span><span class="op" id="3634072">[</span><span class="ident" id="3634073">h</span><span class="op" id="3634074">]</span>&nbsp;<span class="op" id="3634076">=</span>&nbsp;<span class="builtinfunc" id="3634078">append</span><span class="op" id="3634084">(</span><span class="ident" id="3634085">hs</span><span class="op" id="3634087">[</span><span class="ident" id="3634088">h</span><span class="op" id="3634089">]</span><span class="op" id="3634090">,</span>&nbsp;<span class="ident" id="3634092">f</span><span class="op" id="3634093">[</span><span class="num" id="3634094">0</span><span class="op" id="3634095">]</span><span class="op" id="3634096">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634102">is</span><span class="op" id="3634104">[</span><span class="ident" id="3634105">f</span><span class="op" id="3634106">[</span><span class="num" id="3634107">0</span><span class="op" id="3634108">]</span><span class="op" id="3634109">]</span>&nbsp;<span class="op" id="3634111">=</span>&nbsp;<span class="builtinfunc" id="3634113">append</span><span class="op" id="3634119">(</span><span class="ident" id="3634120">is</span><span class="op" id="3634122">[</span><span class="ident" id="3634123">f</span><span class="op" id="3634124">[</span><span class="num" id="3634125">0</span><span class="op" id="3634126">]</span><span class="op" id="3634127">]</span><span class="op" id="3634128">,</span>&nbsp;<span class="ident" id="3634130">h</span><span class="op" id="3634131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3634144">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634172">hosts</span><span class="op" id="3634177">.</span><span class="ident" id="3634178">expire</span>&nbsp;<span class="op" id="3634185">=</span>&nbsp;<span class="ident" id="3634187">now</span><span class="op" id="3634190">.</span><span class="ident" id="3634191">Add</span><span class="op" id="3634194">(</span><span class="ident" id="3634195">cacheMaxAge</span><span class="op" id="3634206">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634210">hosts</span><span class="op" id="3634215">.</span><span class="ident" id="3634216">path</span>&nbsp;<span class="op" id="3634221">=</span>&nbsp;<span class="ident" id="3634223">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634228">hosts</span><span class="op" id="3634233">.</span><span class="ident" id="3634234">byName</span>&nbsp;<span class="op" id="3634241">=</span>&nbsp;<span class="ident" id="3634243">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634248">hosts</span><span class="op" id="3634253">.</span><span class="ident" id="3634254">byAddr</span>&nbsp;<span class="op" id="3634261">=</span>&nbsp;<span class="ident" id="3634263">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634268">file</span><span class="op" id="3634272">.</span><span class="builtinfunc" id="3634273">close</span><span class="op" id="3634278">(</span><span class="op" id="3634279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634282">}</span><br>
<span class="lineno">60</span><span class="op" id="3634284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3634287">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3634366">func</span>&nbsp;<span class="ident" id="3634371">lookupStaticHost</span><span class="op" id="3634387">(</span><span class="ident" id="3634388">host</span>&nbsp;<span class="builtintype" id="3634393">string</span><span class="op" id="3634399">)</span>&nbsp;<span class="op" id="3634401">[</span><span class="op" id="3634402">]</span><span class="builtintype" id="3634403">string</span>&nbsp;<span class="op" id="3634410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634413">hosts</span><span class="op" id="3634418">.</span><span class="ident" id="3634419">Lock</span><span class="op" id="3634423">(</span><span class="op" id="3634424">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634427">defer</span>&nbsp;<span class="ident" id="3634433">hosts</span><span class="op" id="3634438">.</span><span class="ident" id="3634439">Unlock</span><span class="op" id="3634445">(</span><span class="op" id="3634446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634449">readHosts</span><span class="op" id="3634458">(</span><span class="op" id="3634459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634462">if</span>&nbsp;<span class="builtinfunc" id="3634465">len</span><span class="op" id="3634468">(</span><span class="ident" id="3634469">hosts</span><span class="op" id="3634474">.</span><span class="ident" id="3634475">byName</span><span class="op" id="3634481">)</span>&nbsp;<span class="op" id="3634483">!=</span>&nbsp;<span class="num" id="3634486">0</span>&nbsp;<span class="op" id="3634488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634492">if</span>&nbsp;<span class="ident" id="3634495">ips</span><span class="op" id="3634498">,</span>&nbsp;<span class="ident" id="3634500">ok</span>&nbsp;<span class="op" id="3634503">:=</span>&nbsp;<span class="ident" id="3634506">hosts</span><span class="op" id="3634511">.</span><span class="ident" id="3634512">byName</span><span class="op" id="3634518">[</span><span class="ident" id="3634519">host</span><span class="op" id="3634523">]</span><span class="op" id="3634524">;</span>&nbsp;<span class="ident" id="3634526">ok</span>&nbsp;<span class="op" id="3634529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634534">return</span>&nbsp;<span class="ident" id="3634541">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634553">return</span>&nbsp;<span class="ident" id="3634560">nil</span><br>
<span class="lineno"></span><span class="op" id="3634564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3634567">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3634645">func</span>&nbsp;<span class="ident" id="3634650">lookupStaticAddr</span><span class="op" id="3634666">(</span><span class="ident" id="3634667">addr</span>&nbsp;<span class="builtintype" id="3634672">string</span><span class="op" id="3634678">)</span>&nbsp;<span class="op" id="3634680">[</span><span class="op" id="3634681">]</span><span class="builtintype" id="3634682">string</span>&nbsp;<span class="op" id="3634689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634692">hosts</span><span class="op" id="3634697">.</span><span class="ident" id="3634698">Lock</span><span class="op" id="3634702">(</span><span class="op" id="3634703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634706">defer</span>&nbsp;<span class="ident" id="3634712">hosts</span><span class="op" id="3634717">.</span><span class="ident" id="3634718">Unlock</span><span class="op" id="3634724">(</span><span class="op" id="3634725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634728">readHosts</span><span class="op" id="3634737">(</span><span class="op" id="3634738">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634741">if</span>&nbsp;<span class="builtinfunc" id="3634744">len</span><span class="op" id="3634747">(</span><span class="ident" id="3634748">hosts</span><span class="op" id="3634753">.</span><span class="ident" id="3634754">byAddr</span><span class="op" id="3634760">)</span>&nbsp;<span class="op" id="3634762">!=</span>&nbsp;<span class="num" id="3634765">0</span>&nbsp;<span class="op" id="3634767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634771">if</span>&nbsp;<span class="ident" id="3634774">hosts</span><span class="op" id="3634779">,</span>&nbsp;<span class="ident" id="3634781">ok</span>&nbsp;<span class="op" id="3634784">:=</span>&nbsp;<span class="ident" id="3634787">hosts</span><span class="op" id="3634792">.</span><span class="ident" id="3634793">byAddr</span><span class="op" id="3634799">[</span><span class="ident" id="3634800">addr</span><span class="op" id="3634804">]</span><span class="op" id="3634805">;</span>&nbsp;<span class="ident" id="3634807">ok</span>&nbsp;<span class="op" id="3634810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634815">return</span>&nbsp;<span class="ident" id="3634822">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634833">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634836">return</span>&nbsp;<span class="ident" id="3634843">nil</span><br>
<span class="lineno"></span><span class="op" id="3634847">}</span>
</div>
</body>
</html>
