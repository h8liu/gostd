<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3586405">package</span>&nbsp;<span class="ident" id="3586413">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3586420">//&nbsp;PhyMemory&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;contiguous&nbsp;pages.</span><br>
<span class="lineno"></span><span class="keyword" id="3586470">type</span>&nbsp;<span class="ident" id="3586475">phyMemory</span>&nbsp;<span class="keyword" id="3586485">struct</span>&nbsp;<span class="op" id="3586492">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586495">npage</span>&nbsp;<span class="builtintype" id="3586501">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586509">pages</span>&nbsp;<span class="keyword" id="3586515">map</span><span class="op" id="3586518">[</span><span class="builtintype" id="3586519">uint32</span><span class="op" id="3586525">]</span><span class="op" id="3586526">*</span><span class="ident" id="3586527">page</span><br>
<span class="lineno"></span><span class="op" id="3586532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3586535">const</span>&nbsp;<span class="op" id="3586541">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586544">pageVoid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3586558">=</span>&nbsp;<span class="num" id="3586560">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586563">pageInterrupt</span>&nbsp;<span class="op" id="3586577">=</span>&nbsp;<span class="num" id="3586579">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586582">pageBasicIO</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3586596">=</span>&nbsp;<span class="num" id="3586598">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586602">pageBootImage</span>&nbsp;<span class="op" id="3586616">=</span>&nbsp;<span class="num" id="3586618">8</span><br>
<span class="lineno">15</span><span class="op" id="3586620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3586623">//&nbsp;NewPhyMemory&nbsp;creates&nbsp;a&nbsp;physical&nbsp;memory&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3586680">func</span>&nbsp;<span class="ident" id="3586685">newPhyMemory</span><span class="op" id="3586697">(</span><span class="ident" id="3586698">size</span>&nbsp;<span class="builtintype" id="3586703">uint32</span><span class="op" id="3586709">)</span>&nbsp;<span class="op" id="3586711">*</span><span class="ident" id="3586712">phyMemory</span>&nbsp;<span class="op" id="3586722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586725">if</span>&nbsp;<span class="ident" id="3586728">size</span><span class="op" id="3586732">%</span><span class="ident" id="3586733">PageSize</span>&nbsp;<span class="op" id="3586742">!=</span>&nbsp;<span class="num" id="3586745">0</span>&nbsp;<span class="op" id="3586747">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3586751">panic</span><span class="op" id="3586756">(</span><span class="string" id="3586757">&#34;size&nbsp;misaligned&#34;</span><span class="op" id="3586774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586781">ret</span>&nbsp;<span class="op" id="3586785">:=</span>&nbsp;<span class="builtinfunc" id="3586788">new</span><span class="op" id="3586791">(</span><span class="ident" id="3586792">phyMemory</span><span class="op" id="3586801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586804">ret</span><span class="op" id="3586807">.</span><span class="ident" id="3586808">pages</span>&nbsp;<span class="op" id="3586814">=</span>&nbsp;<span class="builtinfunc" id="3586816">make</span><span class="op" id="3586820">(</span><span class="keyword" id="3586821">map</span><span class="op" id="3586824">[</span><span class="builtintype" id="3586825">uint32</span><span class="op" id="3586831">]</span><span class="op" id="3586832">*</span><span class="ident" id="3586833">page</span><span class="op" id="3586837">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586840">ret</span><span class="op" id="3586843">.</span><span class="ident" id="3586844">npage</span>&nbsp;<span class="op" id="3586850">=</span>&nbsp;<span class="ident" id="3586852">size</span>&nbsp;<span class="op" id="3586857">/</span>&nbsp;<span class="ident" id="3586859">PageSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586870">return</span>&nbsp;<span class="ident" id="3586877">ret</span><br>
<span class="lineno"></span><span class="op" id="3586881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3586884">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;physical&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="3586933">func</span>&nbsp;<span class="op" id="3586938">(</span><span class="ident" id="3586939">pm</span>&nbsp;<span class="op" id="3586942">*</span><span class="ident" id="3586943">phyMemory</span><span class="op" id="3586952">)</span>&nbsp;<span class="ident" id="3586954">Size</span><span class="op" id="3586958">(</span><span class="op" id="3586959">)</span>&nbsp;<span class="builtintype" id="3586961">uint32</span>&nbsp;<span class="op" id="3586968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586971">return</span>&nbsp;<span class="ident" id="3586978">pm</span><span class="op" id="3586980">.</span><span class="ident" id="3586981">npage</span>&nbsp;<span class="op" id="3586987">*</span>&nbsp;<span class="ident" id="3586989">PageSize</span><br>
<span class="lineno"></span><span class="op" id="3586998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3587001">//&nbsp;Page&nbsp;returns&nbsp;the&nbsp;page&nbsp;for&nbsp;the&nbsp;particular&nbsp;page&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3587057">//&nbsp;Returns&nbsp;nil&nbsp;when&nbsp;the&nbsp;page&nbsp;number&nbsp;is&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno"></span><span class="keyword" id="3587109">func</span>&nbsp;<span class="op" id="3587114">(</span><span class="ident" id="3587115">pm</span>&nbsp;<span class="op" id="3587118">*</span><span class="ident" id="3587119">phyMemory</span><span class="op" id="3587128">)</span>&nbsp;<span class="ident" id="3587130">Page</span><span class="op" id="3587134">(</span><span class="ident" id="3587135">pn</span>&nbsp;<span class="builtintype" id="3587138">uint32</span><span class="op" id="3587144">)</span>&nbsp;<span class="op" id="3587146">*</span><span class="ident" id="3587147">page</span>&nbsp;<span class="op" id="3587152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587155">if</span>&nbsp;<span class="ident" id="3587158">pn</span>&nbsp;<span class="op" id="3587161">&gt;=</span>&nbsp;<span class="ident" id="3587164">pm</span><span class="op" id="3587166">.</span><span class="ident" id="3587167">npage</span>&nbsp;<span class="op" id="3587173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587177">return</span>&nbsp;<span class="ident" id="3587184">nil</span>&nbsp;<span class="comment" id="3587188">//&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587209">ret</span><span class="op" id="3587212">,</span>&nbsp;<span class="ident" id="3587214">found</span>&nbsp;<span class="op" id="3587220">:=</span>&nbsp;<span class="ident" id="3587223">pm</span><span class="op" id="3587225">.</span><span class="ident" id="3587226">pages</span><span class="op" id="3587231">[</span><span class="ident" id="3587232">pn</span><span class="op" id="3587234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587237">if</span>&nbsp;<span class="op" id="3587240">!</span><span class="ident" id="3587241">found</span>&nbsp;<span class="op" id="3587247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3587251">//&nbsp;create&nbsp;an&nbsp;empty&nbsp;page&nbsp;on&nbsp;demand</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587287">ret</span>&nbsp;<span class="op" id="3587291">=</span>&nbsp;<span class="ident" id="3587293">newPage</span><span class="op" id="3587300">(</span><span class="op" id="3587301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587305">pm</span><span class="op" id="3587307">.</span><span class="ident" id="3587308">pages</span><span class="op" id="3587313">[</span><span class="ident" id="3587314">pn</span><span class="op" id="3587316">]</span>&nbsp;<span class="op" id="3587318">=</span>&nbsp;<span class="ident" id="3587320">ret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587329">return</span>&nbsp;<span class="ident" id="3587336">ret</span><br>
<span class="lineno">50</span><span class="op" id="3587340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3587343">func</span>&nbsp;<span class="op" id="3587348">(</span><span class="ident" id="3587349">pm</span>&nbsp;<span class="op" id="3587352">*</span><span class="ident" id="3587353">phyMemory</span><span class="op" id="3587362">)</span>&nbsp;<span class="ident" id="3587364">pageForByte</span><span class="op" id="3587375">(</span><span class="ident" id="3587376">addr</span>&nbsp;<span class="builtintype" id="3587381">uint32</span><span class="op" id="3587387">)</span>&nbsp;<span class="op" id="3587389">(</span><span class="op" id="3587390">*</span><span class="ident" id="3587391">page</span><span class="op" id="3587395">,</span>&nbsp;<span class="op" id="3587397">*</span><span class="ident" id="3587398">Excep</span><span class="op" id="3587403">)</span>&nbsp;<span class="op" id="3587405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587408">p</span>&nbsp;<span class="op" id="3587410">:=</span>&nbsp;<span class="ident" id="3587413">pm</span><span class="op" id="3587415">.</span><span class="ident" id="3587416">Page</span><span class="op" id="3587420">(</span><span class="ident" id="3587421">addr</span>&nbsp;<span class="op" id="3587426">/</span>&nbsp;<span class="ident" id="3587428">PageSize</span><span class="op" id="3587436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587439">if</span>&nbsp;<span class="ident" id="3587442">p</span>&nbsp;<span class="op" id="3587444">==</span>&nbsp;<span class="ident" id="3587447">nil</span>&nbsp;<span class="op" id="3587451">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587455">return</span>&nbsp;<span class="ident" id="3587462">nil</span><span class="op" id="3587465">,</span>&nbsp;<span class="ident" id="3587467">errOutOfRange</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587485">return</span>&nbsp;<span class="ident" id="3587492">p</span><span class="op" id="3587493">,</span>&nbsp;<span class="ident" id="3587495">nil</span><br>
<span class="lineno"></span><span class="op" id="3587499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3587502">func</span>&nbsp;<span class="op" id="3587507">(</span><span class="ident" id="3587508">pm</span>&nbsp;<span class="op" id="3587511">*</span><span class="ident" id="3587512">phyMemory</span><span class="op" id="3587521">)</span>&nbsp;<span class="ident" id="3587523">pageForWord</span><span class="op" id="3587534">(</span><span class="ident" id="3587535">addr</span>&nbsp;<span class="builtintype" id="3587540">uint32</span><span class="op" id="3587546">)</span>&nbsp;<span class="op" id="3587548">(</span><span class="op" id="3587549">*</span><span class="ident" id="3587550">page</span><span class="op" id="3587554">,</span>&nbsp;<span class="op" id="3587556">*</span><span class="ident" id="3587557">Excep</span><span class="op" id="3587562">)</span>&nbsp;<span class="op" id="3587564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587567">if</span>&nbsp;<span class="ident" id="3587570">addr</span><span class="op" id="3587574">%</span><span class="num" id="3587575">4</span>&nbsp;<span class="op" id="3587577">!=</span>&nbsp;<span class="num" id="3587580">0</span>&nbsp;<span class="op" id="3587582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587586">return</span>&nbsp;<span class="ident" id="3587593">nil</span><span class="op" id="3587596">,</span>&nbsp;<span class="ident" id="3587598">errMisalign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587614">return</span>&nbsp;<span class="ident" id="3587621">pm</span><span class="op" id="3587623">.</span><span class="ident" id="3587624">pageForByte</span><span class="op" id="3587635">(</span><span class="ident" id="3587636">addr</span><span class="op" id="3587640">)</span><br>
<span class="lineno">65</span><span class="op" id="3587642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3587645">//&nbsp;ReadByte&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3587694">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3587750">func</span>&nbsp;<span class="op" id="3587755">(</span><span class="ident" id="3587756">pm</span>&nbsp;<span class="op" id="3587759">*</span><span class="ident" id="3587760">phyMemory</span><span class="op" id="3587769">)</span>&nbsp;<span class="ident" id="3587771">ReadByte</span><span class="op" id="3587779">(</span><span class="ident" id="3587780">addr</span>&nbsp;<span class="builtintype" id="3587785">uint32</span><span class="op" id="3587791">)</span>&nbsp;<span class="op" id="3587793">(</span><span class="builtintype" id="3587794">byte</span><span class="op" id="3587798">,</span>&nbsp;<span class="op" id="3587800">*</span><span class="ident" id="3587801">Excep</span><span class="op" id="3587806">)</span>&nbsp;<span class="op" id="3587808">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587811">p</span><span class="op" id="3587812">,</span>&nbsp;<span class="ident" id="3587814">e</span>&nbsp;<span class="op" id="3587816">:=</span>&nbsp;<span class="ident" id="3587819">pm</span><span class="op" id="3587821">.</span><span class="ident" id="3587822">pageForByte</span><span class="op" id="3587833">(</span><span class="ident" id="3587834">addr</span><span class="op" id="3587838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587841">if</span>&nbsp;<span class="ident" id="3587844">e</span>&nbsp;<span class="op" id="3587846">!=</span>&nbsp;<span class="ident" id="3587849">nil</span>&nbsp;<span class="op" id="3587853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587857">return</span>&nbsp;<span class="num" id="3587864">0</span><span class="op" id="3587865">,</span>&nbsp;<span class="ident" id="3587867">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587873">return</span>&nbsp;<span class="ident" id="3587880">p</span><span class="op" id="3587881">.</span><span class="ident" id="3587882">ReadByte</span><span class="op" id="3587890">(</span><span class="ident" id="3587891">addr</span><span class="op" id="3587895">)</span><span class="op" id="3587896">,</span>&nbsp;<span class="ident" id="3587898">nil</span><br>
<span class="lineno">75</span><span class="op" id="3587902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3587905">//&nbsp;WriteByte&nbsp;writes&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3587956">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3588012">func</span>&nbsp;<span class="op" id="3588017">(</span><span class="ident" id="3588018">pm</span>&nbsp;<span class="op" id="3588021">*</span><span class="ident" id="3588022">phyMemory</span><span class="op" id="3588031">)</span>&nbsp;<span class="ident" id="3588033">WriteByte</span><span class="op" id="3588042">(</span><span class="ident" id="3588043">addr</span>&nbsp;<span class="builtintype" id="3588048">uint32</span><span class="op" id="3588054">,</span>&nbsp;<span class="ident" id="3588056">v</span>&nbsp;<span class="builtintype" id="3588058">byte</span><span class="op" id="3588062">)</span>&nbsp;<span class="op" id="3588064">*</span><span class="ident" id="3588065">Excep</span>&nbsp;<span class="op" id="3588071">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588074">p</span><span class="op" id="3588075">,</span>&nbsp;<span class="ident" id="3588077">e</span>&nbsp;<span class="op" id="3588079">:=</span>&nbsp;<span class="ident" id="3588082">pm</span><span class="op" id="3588084">.</span><span class="ident" id="3588085">pageForByte</span><span class="op" id="3588096">(</span><span class="ident" id="3588097">addr</span><span class="op" id="3588101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588104">if</span>&nbsp;<span class="ident" id="3588107">e</span>&nbsp;<span class="op" id="3588109">!=</span>&nbsp;<span class="ident" id="3588112">nil</span>&nbsp;<span class="op" id="3588116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588120">return</span>&nbsp;<span class="ident" id="3588127">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588133">p</span><span class="op" id="3588134">.</span><span class="ident" id="3588135">WriteByte</span><span class="op" id="3588144">(</span><span class="ident" id="3588145">addr</span><span class="op" id="3588149">,</span>&nbsp;<span class="ident" id="3588151">v</span><span class="op" id="3588152">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588155">return</span>&nbsp;<span class="ident" id="3588162">e</span><br>
<span class="lineno"></span><span class="op" id="3588164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3588167">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3588216">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">90</span><span class="keyword" id="3588294">func</span>&nbsp;<span class="op" id="3588299">(</span><span class="ident" id="3588300">pm</span>&nbsp;<span class="op" id="3588303">*</span><span class="ident" id="3588304">phyMemory</span><span class="op" id="3588313">)</span>&nbsp;<span class="ident" id="3588315">ReadWord</span><span class="op" id="3588323">(</span><span class="ident" id="3588324">addr</span>&nbsp;<span class="builtintype" id="3588329">uint32</span><span class="op" id="3588335">)</span>&nbsp;<span class="op" id="3588337">(</span><span class="builtintype" id="3588338">uint32</span><span class="op" id="3588344">,</span>&nbsp;<span class="op" id="3588346">*</span><span class="ident" id="3588347">Excep</span><span class="op" id="3588352">)</span>&nbsp;<span class="op" id="3588354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588357">p</span><span class="op" id="3588358">,</span>&nbsp;<span class="ident" id="3588360">e</span>&nbsp;<span class="op" id="3588362">:=</span>&nbsp;<span class="ident" id="3588365">pm</span><span class="op" id="3588367">.</span><span class="ident" id="3588368">pageForWord</span><span class="op" id="3588379">(</span><span class="ident" id="3588380">addr</span><span class="op" id="3588384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588387">if</span>&nbsp;<span class="ident" id="3588390">e</span>&nbsp;<span class="op" id="3588392">!=</span>&nbsp;<span class="ident" id="3588395">nil</span>&nbsp;<span class="op" id="3588399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588403">return</span>&nbsp;<span class="num" id="3588410">0</span><span class="op" id="3588411">,</span>&nbsp;<span class="ident" id="3588413">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588416">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588419">return</span>&nbsp;<span class="ident" id="3588426">p</span><span class="op" id="3588427">.</span><span class="ident" id="3588428">ReadWord</span><span class="op" id="3588436">(</span><span class="ident" id="3588437">addr</span><span class="op" id="3588441">)</span><span class="op" id="3588442">,</span>&nbsp;<span class="ident" id="3588444">nil</span><br>
<span class="lineno"></span><span class="op" id="3588448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3588451">//&nbsp;WriteWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3588501">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">100</span><span class="keyword" id="3588579">func</span>&nbsp;<span class="op" id="3588584">(</span><span class="ident" id="3588585">pm</span>&nbsp;<span class="op" id="3588588">*</span><span class="ident" id="3588589">phyMemory</span><span class="op" id="3588598">)</span>&nbsp;<span class="ident" id="3588600">WriteWord</span><span class="op" id="3588609">(</span><span class="ident" id="3588610">addr</span>&nbsp;<span class="builtintype" id="3588615">uint32</span><span class="op" id="3588621">,</span>&nbsp;<span class="ident" id="3588623">v</span>&nbsp;<span class="builtintype" id="3588625">uint32</span><span class="op" id="3588631">)</span>&nbsp;<span class="op" id="3588633">*</span><span class="ident" id="3588634">Excep</span>&nbsp;<span class="op" id="3588640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588643">p</span><span class="op" id="3588644">,</span>&nbsp;<span class="ident" id="3588646">e</span>&nbsp;<span class="op" id="3588648">:=</span>&nbsp;<span class="ident" id="3588651">pm</span><span class="op" id="3588653">.</span><span class="ident" id="3588654">pageForWord</span><span class="op" id="3588665">(</span><span class="ident" id="3588666">addr</span><span class="op" id="3588670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588673">if</span>&nbsp;<span class="ident" id="3588676">e</span>&nbsp;<span class="op" id="3588678">!=</span>&nbsp;<span class="ident" id="3588681">nil</span>&nbsp;<span class="op" id="3588685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588689">return</span>&nbsp;<span class="ident" id="3588696">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588699">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588702">p</span><span class="op" id="3588703">.</span><span class="ident" id="3588704">WriteWord</span><span class="op" id="3588713">(</span><span class="ident" id="3588714">addr</span><span class="op" id="3588718">,</span>&nbsp;<span class="ident" id="3588720">v</span><span class="op" id="3588721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588724">return</span>&nbsp;<span class="ident" id="3588731">nil</span><br>
<span class="lineno"></span><span class="op" id="3588735">}</span>
</div>
</body>
</html>
