<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1345093">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1345148">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1345202">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1345253">package</span>&nbsp;<span class="ident" id="1345261">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1345268">import</span>&nbsp;<span class="string" id="1345275">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345283">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="1345359">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="1345370">type</span>&nbsp;<span class="ident" id="1345375">huffmanTree</span>&nbsp;<span class="keyword" id="1345387">struct</span>&nbsp;<span class="op" id="1345394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345397">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345468">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1345541">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345597">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345606">[</span><span class="op" id="1345607">]</span><span class="ident" id="1345608"><a href="/gostd/compress/bzip2/huffman.go.html#1346070">huffmanNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345621">nextNode</span>&nbsp;<span class="builtintype" id="1345630">int</span><br>
<span class="lineno"></span><span class="op" id="1345634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345637">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="1345717">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="1345797">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="1345857">//</span><br>
<span class="lineno"></span><span class="comment" id="1345860">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1345937">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="1346015">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="1346065">type</span>&nbsp;<span class="ident" id="1346070">huffmanNode</span>&nbsp;<span class="keyword" id="1346082">struct</span>&nbsp;<span class="op" id="1346089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346092">left</span><span class="op" id="1346096">,</span>&nbsp;<span class="ident" id="1346098">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1346114">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346122">leftValue</span><span class="op" id="1346131">,</span>&nbsp;<span class="ident" id="1346133">rightValue</span>&nbsp;<span class="builtintype" id="1346144">uint16</span><br>
<span class="lineno"></span><span class="op" id="1346151">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="1346154">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="1346231">const</span>&nbsp;<span class="ident" id="1346237">invalidNodeValue</span>&nbsp;<span class="op" id="1346254">=</span>&nbsp;<span class="num" id="1346256">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346264">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="1346341">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="1346361">func</span>&nbsp;<span class="op" id="1346366">(</span><span class="ident" id="1346367">t</span>&nbsp;<span class="op" id="1346369">*</span><span class="ident" id="1346370"><a href="/gostd/compress/bzip2/huffman.go.html#1345375">huffmanTree</a></span><span class="op" id="1346381">)</span>&nbsp;<span class="ident" id="1346383">Decode</span><span class="op" id="1346389">(</span><span class="ident" id="1346390">br</span>&nbsp;<span class="op" id="1346393">*</span><span class="ident" id="1346394"><a href="/gostd/compress/bzip2/bit_reader.go.html#1329987">bitReader</a></span><span class="op" id="1346403">)</span>&nbsp;<span class="op" id="1346405">(</span><span class="ident" id="1346406">v</span>&nbsp;<span class="builtintype" id="1346408">uint16</span><span class="op" id="1346414">)</span>&nbsp;<span class="op" id="1346416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346419">nodeIndex</span>&nbsp;<span class="op" id="1346429">:=</span>&nbsp;<span class="builtintype" id="1346432">uint16</span><span class="op" id="1346438">(</span><span class="num" id="1346439">0</span><span class="op" id="1346440">)</span>&nbsp;<span class="comment" id="1346442">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346479">for</span>&nbsp;<span class="op" id="1346483">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346487">node</span>&nbsp;<span class="op" id="1346492">:=</span>&nbsp;<span class="op" id="1346495">&amp;</span><span class="ident" id="1346496"><a href="/gostd/compress/bzip2/huffman.go.html#1346367">t</a></span><span class="op" id="1346497">.</span><span class="ident" id="1346498"><a href="/gostd/compress/bzip2/huffman.go.html#1345597">nodes</a></span><span class="op" id="1346503">[</span><span class="ident" id="1346504"><a href="/gostd/compress/bzip2/huffman.go.html#1346419">nodeIndex</a></span><span class="op" id="1346513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346517">bit</span><span class="op" id="1346520">,</span>&nbsp;<span class="ident" id="1346522">ok</span>&nbsp;<span class="op" id="1346525">:=</span>&nbsp;<span class="ident" id="1346528"><a href="/gostd/compress/bzip2/huffman.go.html#1346390">br</a></span><span class="op" id="1346530">.</span><span class="ident" id="1346531"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331523">TryReadBit</a></span><span class="op" id="1346541">(</span><span class="op" id="1346542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346546">if</span>&nbsp;<span class="op" id="1346549">!</span><span class="ident" id="1346550"><a href="/gostd/compress/bzip2/huffman.go.html#1346522">ok</a></span>&nbsp;<span class="op" id="1346553">&amp;&amp;</span>&nbsp;<span class="ident" id="1346556"><a href="/gostd/compress/bzip2/huffman.go.html#1346390">br</a></span><span class="op" id="1346558">.</span><span class="ident" id="1346559"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331446">ReadBit</a></span><span class="op" id="1346566">(</span><span class="op" id="1346567">)</span>&nbsp;<span class="op" id="1346569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346574"><a href="/gostd/compress/bzip2/huffman.go.html#1346517">bit</a></span>&nbsp;<span class="op" id="1346578">=</span>&nbsp;<span class="num" id="1346580">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346584">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1346588">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346627">if</span>&nbsp;<span class="ident" id="1346630"><a href="/gostd/compress/bzip2/huffman.go.html#1346517">bit</a></span>&nbsp;<span class="op" id="1346634">!=</span>&nbsp;<span class="num" id="1346637">0</span>&nbsp;<span class="op" id="1346639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1346644">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346655">if</span>&nbsp;<span class="ident" id="1346658"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346662">.</span><span class="ident" id="1346663"><a href="/gostd/compress/bzip2/huffman.go.html#1346092">left</a></span>&nbsp;<span class="op" id="1346668">==</span>&nbsp;<span class="ident" id="1346671"><a href="/gostd/compress/bzip2/huffman.go.html#1346237">invalidNodeValue</a></span>&nbsp;<span class="op" id="1346688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346694">return</span>&nbsp;<span class="ident" id="1346701"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346705">.</span><span class="ident" id="1346706"><a href="/gostd/compress/bzip2/huffman.go.html#1346122">leftValue</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346724"><a href="/gostd/compress/bzip2/huffman.go.html#1346419">nodeIndex</a></span>&nbsp;<span class="op" id="1346734">=</span>&nbsp;<span class="ident" id="1346736"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346740">.</span><span class="ident" id="1346741"><a href="/gostd/compress/bzip2/huffman.go.html#1346092">left</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346748">}</span>&nbsp;<span class="keyword" id="1346750">else</span>&nbsp;<span class="op" id="1346755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1346760">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346772">if</span>&nbsp;<span class="ident" id="1346775"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346779">.</span><span class="ident" id="1346780"><a href="/gostd/compress/bzip2/huffman.go.html#1346098">right</a></span>&nbsp;<span class="op" id="1346786">==</span>&nbsp;<span class="ident" id="1346789"><a href="/gostd/compress/bzip2/huffman.go.html#1346237">invalidNodeValue</a></span>&nbsp;<span class="op" id="1346806">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1346812">return</span>&nbsp;<span class="ident" id="1346819"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346823">.</span><span class="ident" id="1346824"><a href="/gostd/compress/bzip2/huffman.go.html#1346133">rightValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1346843"><a href="/gostd/compress/bzip2/huffman.go.html#1346419">nodeIndex</a></span>&nbsp;<span class="op" id="1346853">=</span>&nbsp;<span class="ident" id="1346855"><a href="/gostd/compress/bzip2/huffman.go.html#1346487">node</a></span><span class="op" id="1346859">.</span><span class="ident" id="1346860"><a href="/gostd/compress/bzip2/huffman.go.html#1346098">right</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1346871">}</span><br>
<span class="lineno">60</span><span class="op" id="1346873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346876">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1346949">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="1347012">func</span>&nbsp;<span class="ident" id="1347017">newHuffmanTree</span><span class="op" id="1347031">(</span><span class="ident" id="1347032">lengths</span>&nbsp;<span class="op" id="1347040">[</span><span class="op" id="1347041">]</span><span class="builtintype" id="1347042">uint8</span><span class="op" id="1347047">)</span>&nbsp;<span class="op" id="1347049">(</span><span class="ident" id="1347050"><a href="/gostd/compress/bzip2/huffman.go.html#1345375">huffmanTree</a></span><span class="op" id="1347061">,</span>&nbsp;<span class="builtintype" id="1347063">error</span><span class="op" id="1347068">)</span>&nbsp;<span class="op" id="1347070">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347073">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347143">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347208">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347270">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347338">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347409">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347479">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347518">if</span>&nbsp;<span class="builtinfunc" id="1347521">len</span><span class="op" id="1347524">(</span><span class="ident" id="1347525"><a href="/gostd/compress/bzip2/huffman.go.html#1347032">lengths</a></span><span class="op" id="1347532">)</span>&nbsp;<span class="op" id="1347534">&lt;</span>&nbsp;<span class="num" id="1347536">2</span>&nbsp;<span class="op" id="1347538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1347542">panic</span><span class="op" id="1347547">(</span><span class="string" id="1347548">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="1347581">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347588">var</span>&nbsp;<span class="ident" id="1347592">t</span>&nbsp;<span class="ident" id="1347594"><a href="/gostd/compress/bzip2/huffman.go.html#1345375">huffmanTree</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347608">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347680">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347722">pairs</span>&nbsp;<span class="op" id="1347728">:=</span>&nbsp;<span class="ident" id="1347731"><a href="/gostd/compress/bzip2/huffman.go.html#1349191">huffmanSymbolLengthPairs</a></span><span class="op" id="1347755">(</span><span class="builtinfunc" id="1347756">make</span><span class="op" id="1347760">(</span><span class="op" id="1347761">[</span><span class="op" id="1347762">]</span><span class="ident" id="1347763"><a href="/gostd/compress/bzip2/huffman.go.html#1349049">huffmanSymbolLengthPair</a></span><span class="op" id="1347786">,</span>&nbsp;<span class="builtinfunc" id="1347788">len</span><span class="op" id="1347791">(</span><span class="ident" id="1347792"><a href="/gostd/compress/bzip2/huffman.go.html#1347032">lengths</a></span><span class="op" id="1347799">)</span><span class="op" id="1347800">)</span><span class="op" id="1347801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1347804">for</span>&nbsp;<span class="ident" id="1347808">i</span><span class="op" id="1347809">,</span>&nbsp;<span class="ident" id="1347811">length</span>&nbsp;<span class="op" id="1347818">:=</span>&nbsp;<span class="keyword" id="1347821">range</span>&nbsp;<span class="ident" id="1347827"><a href="/gostd/compress/bzip2/huffman.go.html#1347032">lengths</a></span>&nbsp;<span class="op" id="1347835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347839"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1347844">[</span><span class="ident" id="1347845"><a href="/gostd/compress/bzip2/huffman.go.html#1347808">i</a></span><span class="op" id="1347846">]</span><span class="op" id="1347847">.</span><span class="ident" id="1347848"><a href="/gostd/compress/bzip2/huffman.go.html#1349083">value</a></span>&nbsp;<span class="op" id="1347854">=</span>&nbsp;<span class="builtintype" id="1347856">uint16</span><span class="op" id="1347862">(</span><span class="ident" id="1347863"><a href="/gostd/compress/bzip2/huffman.go.html#1347808">i</a></span><span class="op" id="1347864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347868"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1347873">[</span><span class="ident" id="1347874"><a href="/gostd/compress/bzip2/huffman.go.html#1347808">i</a></span><span class="op" id="1347875">]</span><span class="op" id="1347876">.</span><span class="ident" id="1347877"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1347884">=</span>&nbsp;<span class="ident" id="1347886"><a href="/gostd/compress/bzip2/huffman.go.html#1347811">length</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1347894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1347898"><a href="/gostd/compress/bzip2/huffman.go.html#1345275">sort</a></span><span class="op" id="1347902">.</span><span class="ident" id="1347903"><a href="/gostd/sort/sort.go.html#2015380">Sort</a></span><span class="op" id="1347907">(</span><span class="ident" id="1347908"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1347913">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347917">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1347989">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348062">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348134">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348155">code</span>&nbsp;<span class="op" id="1348160">:=</span>&nbsp;<span class="builtintype" id="1348163">uint32</span><span class="op" id="1348169">(</span><span class="num" id="1348170">0</span><span class="op" id="1348171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348174">length</span>&nbsp;<span class="op" id="1348181">:=</span>&nbsp;<span class="builtintype" id="1348184">uint8</span><span class="op" id="1348189">(</span><span class="num" id="1348190">32</span><span class="op" id="1348192">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348196">codes</span>&nbsp;<span class="op" id="1348202">:=</span>&nbsp;<span class="ident" id="1348205"><a href="/gostd/compress/bzip2/huffman.go.html#1349807">huffmanCodes</a></span><span class="op" id="1348217">(</span><span class="builtinfunc" id="1348218">make</span><span class="op" id="1348222">(</span><span class="op" id="1348223">[</span><span class="op" id="1348224">]</span><span class="ident" id="1348225"><a href="/gostd/compress/bzip2/huffman.go.html#1349670">huffmanCode</a></span><span class="op" id="1348236">,</span>&nbsp;<span class="builtinfunc" id="1348238">len</span><span class="op" id="1348241">(</span><span class="ident" id="1348242"><a href="/gostd/compress/bzip2/huffman.go.html#1347032">lengths</a></span><span class="op" id="1348249">)</span><span class="op" id="1348250">)</span><span class="op" id="1348251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348254">for</span>&nbsp;<span class="ident" id="1348258">i</span>&nbsp;<span class="op" id="1348260">:=</span>&nbsp;<span class="builtinfunc" id="1348263">len</span><span class="op" id="1348266">(</span><span class="ident" id="1348267"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348272">)</span>&nbsp;<span class="op" id="1348274">-</span>&nbsp;<span class="num" id="1348276">1</span><span class="op" id="1348277">;</span>&nbsp;<span class="ident" id="1348279"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span>&nbsp;<span class="op" id="1348281">&gt;=</span>&nbsp;<span class="num" id="1348284">0</span><span class="op" id="1348285">;</span>&nbsp;<span class="ident" id="1348287"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348288">--</span>&nbsp;<span class="op" id="1348291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348295">if</span>&nbsp;<span class="ident" id="1348298"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span>&nbsp;<span class="op" id="1348305">&gt;</span>&nbsp;<span class="ident" id="1348307"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348312">[</span><span class="ident" id="1348313"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348314">]</span><span class="op" id="1348315">.</span><span class="ident" id="1348316"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1348323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348328">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348384">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348432"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span>&nbsp;<span class="op" id="1348439">&gt;&gt;=</span>&nbsp;<span class="num" id="1348443">32</span>&nbsp;<span class="op" id="1348446">-</span>&nbsp;<span class="ident" id="1348448"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348453">[</span><span class="ident" id="1348454"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348455">]</span><span class="op" id="1348456">.</span><span class="ident" id="1348457"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348467"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span>&nbsp;<span class="op" id="1348474">&lt;&lt;=</span>&nbsp;<span class="num" id="1348478">32</span>&nbsp;<span class="op" id="1348481">-</span>&nbsp;<span class="ident" id="1348483"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348488">[</span><span class="ident" id="1348489"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348490">]</span><span class="op" id="1348491">.</span><span class="ident" id="1348492"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348502"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span>&nbsp;<span class="op" id="1348509">=</span>&nbsp;<span class="ident" id="1348511"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348516">[</span><span class="ident" id="1348517"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348518">]</span><span class="op" id="1348519">.</span><span class="ident" id="1348520"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348529">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348533"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348538">[</span><span class="ident" id="1348539"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348540">]</span><span class="op" id="1348541">.</span><span class="ident" id="1348542"><a href="/gostd/compress/bzip2/huffman.go.html#1349692">code</a></span>&nbsp;<span class="op" id="1348547">=</span>&nbsp;<span class="ident" id="1348549"><a href="/gostd/compress/bzip2/huffman.go.html#1348155">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348556"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348561">[</span><span class="ident" id="1348562"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348563">]</span><span class="op" id="1348564">.</span><span class="ident" id="1348565"><a href="/gostd/compress/bzip2/huffman.go.html#1349708">codeLen</a></span>&nbsp;<span class="op" id="1348573">=</span>&nbsp;<span class="ident" id="1348575"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348584"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348589">[</span><span class="ident" id="1348590"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348591">]</span><span class="op" id="1348592">.</span><span class="ident" id="1348593"><a href="/gostd/compress/bzip2/huffman.go.html#1349723">value</a></span>&nbsp;<span class="op" id="1348599">=</span>&nbsp;<span class="ident" id="1348601"><a href="/gostd/compress/bzip2/huffman.go.html#1347722">pairs</a></span><span class="op" id="1348606">[</span><span class="ident" id="1348607"><a href="/gostd/compress/bzip2/huffman.go.html#1348258">i</a></span><span class="op" id="1348608">]</span><span class="op" id="1348609">.</span><span class="ident" id="1348610"><a href="/gostd/compress/bzip2/huffman.go.html#1349083">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348618">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348684">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348717"><a href="/gostd/compress/bzip2/huffman.go.html#1348155">code</a></span>&nbsp;<span class="op" id="1348722">+=</span>&nbsp;<span class="num" id="1348725">1</span>&nbsp;<span class="op" id="1348727">&lt;&lt;</span>&nbsp;<span class="op" id="1348730">(</span><span class="num" id="1348731">32</span>&nbsp;<span class="op" id="1348734">-</span>&nbsp;<span class="ident" id="1348736"><a href="/gostd/compress/bzip2/huffman.go.html#1348174">length</a></span><span class="op" id="1348742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1348745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348749">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1348822">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348857"><a href="/gostd/compress/bzip2/huffman.go.html#1345275">sort</a></span><span class="op" id="1348861">.</span><span class="ident" id="1348862"><a href="/gostd/sort/sort.go.html#2015380">Sort</a></span><span class="op" id="1348866">(</span><span class="ident" id="1348867"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348876"><a href="/gostd/compress/bzip2/huffman.go.html#1347592">t</a></span><span class="op" id="1348877">.</span><span class="ident" id="1348878"><a href="/gostd/compress/bzip2/huffman.go.html#1345597">nodes</a></span>&nbsp;<span class="op" id="1348884">=</span>&nbsp;<span class="builtinfunc" id="1348886">make</span><span class="op" id="1348890">(</span><span class="op" id="1348891">[</span><span class="op" id="1348892">]</span><span class="ident" id="1348893"><a href="/gostd/compress/bzip2/huffman.go.html#1346070">huffmanNode</a></span><span class="op" id="1348904">,</span>&nbsp;<span class="builtinfunc" id="1348906">len</span><span class="op" id="1348909">(</span><span class="ident" id="1348910"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348915">)</span><span class="op" id="1348916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1348919">_</span><span class="op" id="1348920">,</span>&nbsp;<span class="ident" id="1348922">err</span>&nbsp;<span class="op" id="1348926">:=</span>&nbsp;<span class="ident" id="1348929"><a href="/gostd/compress/bzip2/huffman.go.html#1350209">buildHuffmanNode</a></span><span class="op" id="1348945">(</span><span class="op" id="1348946">&amp;</span><span class="ident" id="1348947"><a href="/gostd/compress/bzip2/huffman.go.html#1347592">t</a></span><span class="op" id="1348948">,</span>&nbsp;<span class="ident" id="1348950"><a href="/gostd/compress/bzip2/huffman.go.html#1348196">codes</a></span><span class="op" id="1348955">,</span>&nbsp;<span class="num" id="1348957">0</span><span class="op" id="1348958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1348961">return</span>&nbsp;<span class="ident" id="1348968"><a href="/gostd/compress/bzip2/huffman.go.html#1347592">t</a></span><span class="op" id="1348969">,</span>&nbsp;<span class="ident" id="1348971"><a href="/gostd/compress/bzip2/huffman.go.html#1348922">err</a></span><br>
<span class="lineno">120</span><span class="op" id="1348975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348978">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="1349044">type</span>&nbsp;<span class="ident" id="1349049">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="1349073">struct</span>&nbsp;<span class="op" id="1349080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349083">value</span>&nbsp;&nbsp;<span class="builtintype" id="1349090">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349098">length</span>&nbsp;<span class="builtintype" id="1349105">uint8</span><br>
<span class="lineno"></span><span class="op" id="1349111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349114">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="1349186">type</span>&nbsp;<span class="ident" id="1349191">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="1349216">[</span><span class="op" id="1349217">]</span><span class="ident" id="1349218"><a href="/gostd/compress/bzip2/huffman.go.html#1349049">huffmanSymbolLengthPair</a></span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="1349243">func</span>&nbsp;<span class="op" id="1349248">(</span><span class="ident" id="1349249">h</span>&nbsp;<span class="ident" id="1349251"><a href="/gostd/compress/bzip2/huffman.go.html#1349191">huffmanSymbolLengthPairs</a></span><span class="op" id="1349275">)</span>&nbsp;<span class="ident" id="1349277">Len</span><span class="op" id="1349280">(</span><span class="op" id="1349281">)</span>&nbsp;<span class="builtintype" id="1349283">int</span>&nbsp;<span class="op" id="1349287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349290">return</span>&nbsp;<span class="builtinfunc" id="1349297">len</span><span class="op" id="1349300">(</span><span class="ident" id="1349301"><a href="/gostd/compress/bzip2/huffman.go.html#1349249">h</a></span><span class="op" id="1349302">)</span><br>
<span class="lineno"></span><span class="op" id="1349304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="1349307">func</span>&nbsp;<span class="op" id="1349312">(</span><span class="ident" id="1349313">h</span>&nbsp;<span class="ident" id="1349315"><a href="/gostd/compress/bzip2/huffman.go.html#1349191">huffmanSymbolLengthPairs</a></span><span class="op" id="1349339">)</span>&nbsp;<span class="ident" id="1349341">Less</span><span class="op" id="1349345">(</span><span class="ident" id="1349346">i</span><span class="op" id="1349347">,</span>&nbsp;<span class="ident" id="1349349">j</span>&nbsp;<span class="builtintype" id="1349351">int</span><span class="op" id="1349354">)</span>&nbsp;<span class="builtintype" id="1349356">bool</span>&nbsp;<span class="op" id="1349361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349364">if</span>&nbsp;<span class="ident" id="1349367"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349368">[</span><span class="ident" id="1349369"><a href="/gostd/compress/bzip2/huffman.go.html#1349346">i</a></span><span class="op" id="1349370">]</span><span class="op" id="1349371">.</span><span class="ident" id="1349372"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1349379">&lt;</span>&nbsp;<span class="ident" id="1349381"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349382">[</span><span class="ident" id="1349383"><a href="/gostd/compress/bzip2/huffman.go.html#1349349">j</a></span><span class="op" id="1349384">]</span><span class="op" id="1349385">.</span><span class="ident" id="1349386"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1349393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349397">return</span>&nbsp;<span class="builtintype" id="1349404">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349413">if</span>&nbsp;<span class="ident" id="1349416"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349417">[</span><span class="ident" id="1349418"><a href="/gostd/compress/bzip2/huffman.go.html#1349346">i</a></span><span class="op" id="1349419">]</span><span class="op" id="1349420">.</span><span class="ident" id="1349421"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1349428">&gt;</span>&nbsp;<span class="ident" id="1349430"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349431">[</span><span class="ident" id="1349432"><a href="/gostd/compress/bzip2/huffman.go.html#1349349">j</a></span><span class="op" id="1349433">]</span><span class="op" id="1349434">.</span><span class="ident" id="1349435"><a href="/gostd/compress/bzip2/huffman.go.html#1349098">length</a></span>&nbsp;<span class="op" id="1349442">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349446">return</span>&nbsp;<span class="builtintype" id="1349453">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349463">if</span>&nbsp;<span class="ident" id="1349466"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349467">[</span><span class="ident" id="1349468"><a href="/gostd/compress/bzip2/huffman.go.html#1349346">i</a></span><span class="op" id="1349469">]</span><span class="op" id="1349470">.</span><span class="ident" id="1349471"><a href="/gostd/compress/bzip2/huffman.go.html#1349083">value</a></span>&nbsp;<span class="op" id="1349477">&lt;</span>&nbsp;<span class="ident" id="1349479"><a href="/gostd/compress/bzip2/huffman.go.html#1349313">h</a></span><span class="op" id="1349480">[</span><span class="ident" id="1349481"><a href="/gostd/compress/bzip2/huffman.go.html#1349349">j</a></span><span class="op" id="1349482">]</span><span class="op" id="1349483">.</span><span class="ident" id="1349484"><a href="/gostd/compress/bzip2/huffman.go.html#1349083">value</a></span>&nbsp;<span class="op" id="1349490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349494">return</span>&nbsp;<span class="builtintype" id="1349501">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1349507">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349510">return</span>&nbsp;<span class="builtintype" id="1349517">false</span><br>
<span class="lineno"></span><span class="op" id="1349523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1349526">func</span>&nbsp;<span class="op" id="1349531">(</span><span class="ident" id="1349532">h</span>&nbsp;<span class="ident" id="1349534"><a href="/gostd/compress/bzip2/huffman.go.html#1349191">huffmanSymbolLengthPairs</a></span><span class="op" id="1349558">)</span>&nbsp;<span class="ident" id="1349560">Swap</span><span class="op" id="1349564">(</span><span class="ident" id="1349565">i</span><span class="op" id="1349566">,</span>&nbsp;<span class="ident" id="1349568">j</span>&nbsp;<span class="builtintype" id="1349570">int</span><span class="op" id="1349573">)</span>&nbsp;<span class="op" id="1349575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349578"><a href="/gostd/compress/bzip2/huffman.go.html#1349532">h</a></span><span class="op" id="1349579">[</span><span class="ident" id="1349580"><a href="/gostd/compress/bzip2/huffman.go.html#1349565">i</a></span><span class="op" id="1349581">]</span><span class="op" id="1349582">,</span>&nbsp;<span class="ident" id="1349584"><a href="/gostd/compress/bzip2/huffman.go.html#1349532">h</a></span><span class="op" id="1349585">[</span><span class="ident" id="1349586"><a href="/gostd/compress/bzip2/huffman.go.html#1349568">j</a></span><span class="op" id="1349587">]</span>&nbsp;<span class="op" id="1349589">=</span>&nbsp;<span class="ident" id="1349591"><a href="/gostd/compress/bzip2/huffman.go.html#1349532">h</a></span><span class="op" id="1349592">[</span><span class="ident" id="1349593"><a href="/gostd/compress/bzip2/huffman.go.html#1349568">j</a></span><span class="op" id="1349594">]</span><span class="op" id="1349595">,</span>&nbsp;<span class="ident" id="1349597"><a href="/gostd/compress/bzip2/huffman.go.html#1349532">h</a></span><span class="op" id="1349598">[</span><span class="ident" id="1349599"><a href="/gostd/compress/bzip2/huffman.go.html#1349565">i</a></span><span class="op" id="1349600">]</span><br>
<span class="lineno">150</span><span class="op" id="1349602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349605">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="1349665">type</span>&nbsp;<span class="ident" id="1349670">huffmanCode</span>&nbsp;<span class="keyword" id="1349682">struct</span>&nbsp;<span class="op" id="1349689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349692">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1349700">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349708">codeLen</span>&nbsp;<span class="builtintype" id="1349716">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1349723">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1349731">uint16</span><br>
<span class="lineno"></span><span class="op" id="1349738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1349741">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="1349802">type</span>&nbsp;<span class="ident" id="1349807">huffmanCodes</span>&nbsp;<span class="op" id="1349820">[</span><span class="op" id="1349821">]</span><span class="ident" id="1349822"><a href="/gostd/compress/bzip2/huffman.go.html#1349670">huffmanCode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1349835">func</span>&nbsp;<span class="op" id="1349840">(</span><span class="ident" id="1349841">n</span>&nbsp;<span class="ident" id="1349843"><a href="/gostd/compress/bzip2/huffman.go.html#1349807">huffmanCodes</a></span><span class="op" id="1349855">)</span>&nbsp;<span class="ident" id="1349857">Len</span><span class="op" id="1349860">(</span><span class="op" id="1349861">)</span>&nbsp;<span class="builtintype" id="1349863">int</span>&nbsp;<span class="op" id="1349867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349870">return</span>&nbsp;<span class="builtinfunc" id="1349877">len</span><span class="op" id="1349880">(</span><span class="ident" id="1349881"><a href="/gostd/compress/bzip2/huffman.go.html#1349841">n</a></span><span class="op" id="1349882">)</span><br>
<span class="lineno"></span><span class="op" id="1349884">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="1349887">func</span>&nbsp;<span class="op" id="1349892">(</span><span class="ident" id="1349893">n</span>&nbsp;<span class="ident" id="1349895"><a href="/gostd/compress/bzip2/huffman.go.html#1349807">huffmanCodes</a></span><span class="op" id="1349907">)</span>&nbsp;<span class="ident" id="1349909">Less</span><span class="op" id="1349913">(</span><span class="ident" id="1349914">i</span><span class="op" id="1349915">,</span>&nbsp;<span class="ident" id="1349917">j</span>&nbsp;<span class="builtintype" id="1349919">int</span><span class="op" id="1349922">)</span>&nbsp;<span class="builtintype" id="1349924">bool</span>&nbsp;<span class="op" id="1349929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1349932">return</span>&nbsp;<span class="ident" id="1349939"><a href="/gostd/compress/bzip2/huffman.go.html#1349893">n</a></span><span class="op" id="1349940">[</span><span class="ident" id="1349941"><a href="/gostd/compress/bzip2/huffman.go.html#1349914">i</a></span><span class="op" id="1349942">]</span><span class="op" id="1349943">.</span><span class="ident" id="1349944"><a href="/gostd/compress/bzip2/huffman.go.html#1349692">code</a></span>&nbsp;<span class="op" id="1349949">&lt;</span>&nbsp;<span class="ident" id="1349951"><a href="/gostd/compress/bzip2/huffman.go.html#1349893">n</a></span><span class="op" id="1349952">[</span><span class="ident" id="1349953"><a href="/gostd/compress/bzip2/huffman.go.html#1349917">j</a></span><span class="op" id="1349954">]</span><span class="op" id="1349955">.</span><span class="ident" id="1349956"><a href="/gostd/compress/bzip2/huffman.go.html#1349692">code</a></span><br>
<span class="lineno"></span><span class="op" id="1349961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="1349964">func</span>&nbsp;<span class="op" id="1349969">(</span><span class="ident" id="1349970">n</span>&nbsp;<span class="ident" id="1349972"><a href="/gostd/compress/bzip2/huffman.go.html#1349807">huffmanCodes</a></span><span class="op" id="1349984">)</span>&nbsp;<span class="ident" id="1349986">Swap</span><span class="op" id="1349990">(</span><span class="ident" id="1349991">i</span><span class="op" id="1349992">,</span>&nbsp;<span class="ident" id="1349994">j</span>&nbsp;<span class="builtintype" id="1349996">int</span><span class="op" id="1349999">)</span>&nbsp;<span class="op" id="1350001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350004"><a href="/gostd/compress/bzip2/huffman.go.html#1349970">n</a></span><span class="op" id="1350005">[</span><span class="ident" id="1350006"><a href="/gostd/compress/bzip2/huffman.go.html#1349991">i</a></span><span class="op" id="1350007">]</span><span class="op" id="1350008">,</span>&nbsp;<span class="ident" id="1350010"><a href="/gostd/compress/bzip2/huffman.go.html#1349970">n</a></span><span class="op" id="1350011">[</span><span class="ident" id="1350012"><a href="/gostd/compress/bzip2/huffman.go.html#1349994">j</a></span><span class="op" id="1350013">]</span>&nbsp;<span class="op" id="1350015">=</span>&nbsp;<span class="ident" id="1350017"><a href="/gostd/compress/bzip2/huffman.go.html#1349970">n</a></span><span class="op" id="1350018">[</span><span class="ident" id="1350019"><a href="/gostd/compress/bzip2/huffman.go.html#1349994">j</a></span><span class="op" id="1350020">]</span><span class="op" id="1350021">,</span>&nbsp;<span class="ident" id="1350023"><a href="/gostd/compress/bzip2/huffman.go.html#1349970">n</a></span><span class="op" id="1350024">[</span><span class="ident" id="1350025"><a href="/gostd/compress/bzip2/huffman.go.html#1349991">i</a></span><span class="op" id="1350026">]</span><br>
<span class="lineno"></span><span class="op" id="1350028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1350031">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="1350109">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="1350183">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="1350204">func</span>&nbsp;<span class="ident" id="1350209">buildHuffmanNode</span><span class="op" id="1350225">(</span><span class="ident" id="1350226">t</span>&nbsp;<span class="op" id="1350228">*</span><span class="ident" id="1350229"><a href="/gostd/compress/bzip2/huffman.go.html#1345375">huffmanTree</a></span><span class="op" id="1350240">,</span>&nbsp;<span class="ident" id="1350242">codes</span>&nbsp;<span class="op" id="1350248">[</span><span class="op" id="1350249">]</span><span class="ident" id="1350250"><a href="/gostd/compress/bzip2/huffman.go.html#1349670">huffmanCode</a></span><span class="op" id="1350261">,</span>&nbsp;<span class="ident" id="1350263">level</span>&nbsp;<span class="builtintype" id="1350269">uint32</span><span class="op" id="1350275">)</span>&nbsp;<span class="op" id="1350277">(</span><span class="ident" id="1350278">nodeIndex</span>&nbsp;<span class="builtintype" id="1350288">uint16</span><span class="op" id="1350294">,</span>&nbsp;<span class="ident" id="1350296">err</span>&nbsp;<span class="builtintype" id="1350300">error</span><span class="op" id="1350305">)</span>&nbsp;<span class="op" id="1350307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350310">test</span>&nbsp;<span class="op" id="1350315">:=</span>&nbsp;<span class="builtintype" id="1350318">uint32</span><span class="op" id="1350324">(</span><span class="num" id="1350325">1</span><span class="op" id="1350326">)</span>&nbsp;<span class="op" id="1350328">&lt;&lt;</span>&nbsp;<span class="op" id="1350331">(</span><span class="num" id="1350332">31</span>&nbsp;<span class="op" id="1350335">-</span>&nbsp;<span class="ident" id="1350337"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span><span class="op" id="1350342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350346">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350439">firstRightIndex</span>&nbsp;<span class="op" id="1350455">:=</span>&nbsp;<span class="builtinfunc" id="1350458">len</span><span class="op" id="1350461">(</span><span class="ident" id="1350462"><a href="/gostd/compress/bzip2/huffman.go.html#1350242">codes</a></span><span class="op" id="1350467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350470">for</span>&nbsp;<span class="ident" id="1350474">i</span><span class="op" id="1350475">,</span>&nbsp;<span class="ident" id="1350477">code</span>&nbsp;<span class="op" id="1350482">:=</span>&nbsp;<span class="keyword" id="1350485">range</span>&nbsp;<span class="ident" id="1350491"><a href="/gostd/compress/bzip2/huffman.go.html#1350242">codes</a></span>&nbsp;<span class="op" id="1350497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350501">if</span>&nbsp;<span class="ident" id="1350504"><a href="/gostd/compress/bzip2/huffman.go.html#1350477">code</a></span><span class="op" id="1350508">.</span><span class="ident" id="1350509"><a href="/gostd/compress/bzip2/huffman.go.html#1349692">code</a></span><span class="op" id="1350513">&amp;</span><span class="ident" id="1350514"><a href="/gostd/compress/bzip2/huffman.go.html#1350310">test</a></span>&nbsp;<span class="op" id="1350519">!=</span>&nbsp;<span class="num" id="1350522">0</span>&nbsp;<span class="op" id="1350524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350529"><a href="/gostd/compress/bzip2/huffman.go.html#1350439">firstRightIndex</a></span>&nbsp;<span class="op" id="1350545">=</span>&nbsp;<span class="ident" id="1350547"><a href="/gostd/compress/bzip2/huffman.go.html#1350474">i</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350552">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1350563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350567">left</span>&nbsp;<span class="op" id="1350572">:=</span>&nbsp;<span class="ident" id="1350575"><a href="/gostd/compress/bzip2/huffman.go.html#1350242">codes</a></span><span class="op" id="1350580">[</span><span class="op" id="1350581">:</span><span class="ident" id="1350582"><a href="/gostd/compress/bzip2/huffman.go.html#1350439">firstRightIndex</a></span><span class="op" id="1350597">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350600">right</span>&nbsp;<span class="op" id="1350606">:=</span>&nbsp;<span class="ident" id="1350609"><a href="/gostd/compress/bzip2/huffman.go.html#1350242">codes</a></span><span class="op" id="1350614">[</span><span class="ident" id="1350615"><a href="/gostd/compress/bzip2/huffman.go.html#1350439">firstRightIndex</a></span><span class="op" id="1350630">:</span><span class="op" id="1350631">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350635">if</span>&nbsp;<span class="builtinfunc" id="1350638">len</span><span class="op" id="1350641">(</span><span class="ident" id="1350642"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1350646">)</span>&nbsp;<span class="op" id="1350648">==</span>&nbsp;<span class="num" id="1350651">0</span>&nbsp;<span class="op" id="1350653">||</span>&nbsp;<span class="builtinfunc" id="1350656">len</span><span class="op" id="1350659">(</span><span class="ident" id="1350660"><a href="/gostd/compress/bzip2/huffman.go.html#1350600">right</a></span><span class="op" id="1350665">)</span>&nbsp;<span class="op" id="1350667">==</span>&nbsp;<span class="num" id="1350670">0</span>&nbsp;<span class="op" id="1350672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350676">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350741">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350807">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350839">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350902">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1350965">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351013">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351018">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351083">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351149">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351211">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351266">if</span>&nbsp;<span class="builtinfunc" id="1351269">len</span><span class="op" id="1351272">(</span><span class="ident" id="1351273"><a href="/gostd/compress/bzip2/huffman.go.html#1350242">codes</a></span><span class="op" id="1351278">)</span>&nbsp;<span class="op" id="1351280">&lt;</span>&nbsp;<span class="num" id="1351282">2</span>&nbsp;<span class="op" id="1351284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351289">return</span>&nbsp;<span class="num" id="1351296">0</span><span class="op" id="1351297">,</span>&nbsp;<span class="ident" id="1351299"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1351314">(</span><span class="string" id="1351315">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="1351335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351344">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351409">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351468">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351484">if</span>&nbsp;<span class="ident" id="1351487"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span>&nbsp;<span class="op" id="1351493">==</span>&nbsp;<span class="num" id="1351496">31</span>&nbsp;<span class="op" id="1351499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351504">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351561">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351620">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351671">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351697">return</span>&nbsp;<span class="num" id="1351704">0</span><span class="op" id="1351705">,</span>&nbsp;<span class="ident" id="1351707"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1351722">(</span><span class="string" id="1351723">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="1351754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351763">if</span>&nbsp;<span class="builtinfunc" id="1351766">len</span><span class="op" id="1351769">(</span><span class="ident" id="1351770"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1351774">)</span>&nbsp;<span class="op" id="1351776">==</span>&nbsp;<span class="num" id="1351779">0</span>&nbsp;<span class="op" id="1351781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351786">return</span>&nbsp;<span class="ident" id="1351793"><a href="/gostd/compress/bzip2/huffman.go.html#1350209">buildHuffmanNode</a></span><span class="op" id="1351809">(</span><span class="ident" id="1351810"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351811">,</span>&nbsp;<span class="ident" id="1351813"><a href="/gostd/compress/bzip2/huffman.go.html#1350600">right</a></span><span class="op" id="1351818">,</span>&nbsp;<span class="ident" id="1351820"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span><span class="op" id="1351825">+</span><span class="num" id="1351826">1</span><span class="op" id="1351827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351835">return</span>&nbsp;<span class="ident" id="1351842"><a href="/gostd/compress/bzip2/huffman.go.html#1350209">buildHuffmanNode</a></span><span class="op" id="1351858">(</span><span class="ident" id="1351859"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351860">,</span>&nbsp;<span class="ident" id="1351862"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1351866">,</span>&nbsp;<span class="ident" id="1351868"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span><span class="op" id="1351873">+</span><span class="num" id="1351874">1</span><span class="op" id="1351875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1351878">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351882"><a href="/gostd/compress/bzip2/huffman.go.html#1350278">nodeIndex</a></span>&nbsp;<span class="op" id="1351892">=</span>&nbsp;<span class="builtintype" id="1351894">uint16</span><span class="op" id="1351900">(</span><span class="ident" id="1351901"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351902">.</span><span class="ident" id="1351903"><a href="/gostd/compress/bzip2/huffman.go.html#1345621">nextNode</a></span><span class="op" id="1351911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351914">node</span>&nbsp;<span class="op" id="1351919">:=</span>&nbsp;<span class="op" id="1351922">&amp;</span><span class="ident" id="1351923"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351924">.</span><span class="ident" id="1351925"><a href="/gostd/compress/bzip2/huffman.go.html#1345597">nodes</a></span><span class="op" id="1351930">[</span><span class="ident" id="1351931"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351932">.</span><span class="ident" id="1351933"><a href="/gostd/compress/bzip2/huffman.go.html#1345621">nextNode</a></span><span class="op" id="1351941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351944"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1351945">.</span><span class="ident" id="1351946"><a href="/gostd/compress/bzip2/huffman.go.html#1345621">nextNode</a></span><span class="op" id="1351954">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1351959">if</span>&nbsp;<span class="builtinfunc" id="1351962">len</span><span class="op" id="1351965">(</span><span class="ident" id="1351966"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1351970">)</span>&nbsp;<span class="op" id="1351972">==</span>&nbsp;<span class="num" id="1351975">1</span>&nbsp;<span class="op" id="1351977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1351981">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1351996"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352000">.</span><span class="ident" id="1352001"><a href="/gostd/compress/bzip2/huffman.go.html#1346092">left</a></span>&nbsp;<span class="op" id="1352006">=</span>&nbsp;<span class="ident" id="1352008"><a href="/gostd/compress/bzip2/huffman.go.html#1346237">invalidNodeValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352027"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352031">.</span><span class="ident" id="1352032"><a href="/gostd/compress/bzip2/huffman.go.html#1346122">leftValue</a></span>&nbsp;<span class="op" id="1352042">=</span>&nbsp;<span class="ident" id="1352044"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1352048">[</span><span class="num" id="1352049">0</span><span class="op" id="1352050">]</span><span class="op" id="1352051">.</span><span class="ident" id="1352052"><a href="/gostd/compress/bzip2/huffman.go.html#1349723">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352059">}</span>&nbsp;<span class="keyword" id="1352061">else</span>&nbsp;<span class="op" id="1352066">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352070"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352074">.</span><span class="ident" id="1352075"><a href="/gostd/compress/bzip2/huffman.go.html#1346092">left</a></span><span class="op" id="1352079">,</span>&nbsp;<span class="ident" id="1352081"><a href="/gostd/compress/bzip2/huffman.go.html#1350296">err</a></span>&nbsp;<span class="op" id="1352085">=</span>&nbsp;<span class="ident" id="1352087"><a href="/gostd/compress/bzip2/huffman.go.html#1350209">buildHuffmanNode</a></span><span class="op" id="1352103">(</span><span class="ident" id="1352104"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1352105">,</span>&nbsp;<span class="ident" id="1352107"><a href="/gostd/compress/bzip2/huffman.go.html#1350567">left</a></span><span class="op" id="1352111">,</span>&nbsp;<span class="ident" id="1352113"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span><span class="op" id="1352118">+</span><span class="num" id="1352119">1</span><span class="op" id="1352120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352127">if</span>&nbsp;<span class="ident" id="1352130"><a href="/gostd/compress/bzip2/huffman.go.html#1350296">err</a></span>&nbsp;<span class="op" id="1352134">!=</span>&nbsp;<span class="builtintype" id="1352137">nil</span>&nbsp;<span class="op" id="1352141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352145">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352157">if</span>&nbsp;<span class="builtinfunc" id="1352160">len</span><span class="op" id="1352163">(</span><span class="ident" id="1352164"><a href="/gostd/compress/bzip2/huffman.go.html#1350600">right</a></span><span class="op" id="1352169">)</span>&nbsp;<span class="op" id="1352171">==</span>&nbsp;<span class="num" id="1352174">1</span>&nbsp;<span class="op" id="1352176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1352180">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352195"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352199">.</span><span class="ident" id="1352200"><a href="/gostd/compress/bzip2/huffman.go.html#1346098">right</a></span>&nbsp;<span class="op" id="1352206">=</span>&nbsp;<span class="ident" id="1352208"><a href="/gostd/compress/bzip2/huffman.go.html#1346237">invalidNodeValue</a></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352227"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352231">.</span><span class="ident" id="1352232"><a href="/gostd/compress/bzip2/huffman.go.html#1346133">rightValue</a></span>&nbsp;<span class="op" id="1352243">=</span>&nbsp;<span class="ident" id="1352245"><a href="/gostd/compress/bzip2/huffman.go.html#1350600">right</a></span><span class="op" id="1352250">[</span><span class="num" id="1352251">0</span><span class="op" id="1352252">]</span><span class="op" id="1352253">.</span><span class="ident" id="1352254"><a href="/gostd/compress/bzip2/huffman.go.html#1349723">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352261">}</span>&nbsp;<span class="keyword" id="1352263">else</span>&nbsp;<span class="op" id="1352268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1352272"><a href="/gostd/compress/bzip2/huffman.go.html#1351914">node</a></span><span class="op" id="1352276">.</span><span class="ident" id="1352277"><a href="/gostd/compress/bzip2/huffman.go.html#1346098">right</a></span><span class="op" id="1352282">,</span>&nbsp;<span class="ident" id="1352284"><a href="/gostd/compress/bzip2/huffman.go.html#1350296">err</a></span>&nbsp;<span class="op" id="1352288">=</span>&nbsp;<span class="ident" id="1352290"><a href="/gostd/compress/bzip2/huffman.go.html#1350209">buildHuffmanNode</a></span><span class="op" id="1352306">(</span><span class="ident" id="1352307"><a href="/gostd/compress/bzip2/huffman.go.html#1350226">t</a></span><span class="op" id="1352308">,</span>&nbsp;<span class="ident" id="1352310"><a href="/gostd/compress/bzip2/huffman.go.html#1350600">right</a></span><span class="op" id="1352315">,</span>&nbsp;<span class="ident" id="1352317"><a href="/gostd/compress/bzip2/huffman.go.html#1350263">level</a></span><span class="op" id="1352322">+</span><span class="num" id="1352323">1</span><span class="op" id="1352324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1352327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1352331">return</span><br>
<span class="lineno"></span><span class="op" id="1352338">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
