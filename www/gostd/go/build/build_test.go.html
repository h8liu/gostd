<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html" class="current">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8183271">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8183327">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8183381">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8183432">package</span>&nbsp;<span class="ident" id="8183440">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8183447">import</span>&nbsp;<span class="op" id="8183454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183457">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183463">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183469">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183486">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183497">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183508">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8183519">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8183529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8183532">func</span>&nbsp;<span class="ident" id="8183537">TestMatch</span><span class="op" id="8183546">(</span><span class="ident" id="8183547">t</span>&nbsp;<span class="op" id="8183549">*</span><span class="ident" id="8183550">testing</span><span class="op" id="8183557">.</span><span class="ident" id="8183558">T</span><span class="op" id="8183559">)</span>&nbsp;<span class="op" id="8183561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183564">ctxt</span>&nbsp;<span class="op" id="8183569">:=</span>&nbsp;<span class="ident" id="8183572">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183581">what</span>&nbsp;<span class="op" id="8183586">:=</span>&nbsp;<span class="string" id="8183589">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183600">match</span>&nbsp;<span class="op" id="8183606">:=</span>&nbsp;<span class="keyword" id="8183609">func</span><span class="op" id="8183613">(</span><span class="ident" id="8183614">tag</span>&nbsp;<span class="builtintype" id="8183618">string</span><span class="op" id="8183624">,</span>&nbsp;<span class="ident" id="8183626">want</span>&nbsp;<span class="keyword" id="8183631">map</span><span class="op" id="8183634">[</span><span class="builtintype" id="8183635">string</span><span class="op" id="8183641">]</span><span class="builtintype" id="8183642">bool</span><span class="op" id="8183646">)</span>&nbsp;<span class="op" id="8183648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183652">m</span>&nbsp;<span class="op" id="8183654">:=</span>&nbsp;<span class="builtinfunc" id="8183657">make</span><span class="op" id="8183661">(</span><span class="keyword" id="8183662">map</span><span class="op" id="8183665">[</span><span class="builtintype" id="8183666">string</span><span class="op" id="8183672">]</span><span class="builtintype" id="8183673">bool</span><span class="op" id="8183677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183681">if</span>&nbsp;<span class="op" id="8183684">!</span><span class="ident" id="8183685">ctxt</span><span class="op" id="8183689">.</span><span class="ident" id="8183690">match</span><span class="op" id="8183695">(</span><span class="ident" id="8183696">tag</span><span class="op" id="8183699">,</span>&nbsp;<span class="ident" id="8183701">m</span><span class="op" id="8183702">)</span>&nbsp;<span class="op" id="8183704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183709">t</span><span class="op" id="8183710">.</span><span class="ident" id="8183711">Errorf</span><span class="op" id="8183717">(</span><span class="string" id="8183718">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="8183756">,</span>&nbsp;<span class="ident" id="8183758">what</span><span class="op" id="8183762">,</span>&nbsp;<span class="ident" id="8183764">tag</span><span class="op" id="8183767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183771">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183775">if</span>&nbsp;<span class="op" id="8183778">!</span><span class="ident" id="8183779">reflect</span><span class="op" id="8183786">.</span><span class="ident" id="8183787">DeepEqual</span><span class="op" id="8183796">(</span><span class="ident" id="8183797">m</span><span class="op" id="8183798">,</span>&nbsp;<span class="ident" id="8183800">want</span><span class="op" id="8183804">)</span>&nbsp;<span class="op" id="8183806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183811">t</span><span class="op" id="8183812">.</span><span class="ident" id="8183813">Errorf</span><span class="op" id="8183819">(</span><span class="string" id="8183820">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8183843">,</span>&nbsp;<span class="ident" id="8183845">tag</span><span class="op" id="8183848">,</span>&nbsp;<span class="ident" id="8183850">m</span><span class="op" id="8183851">,</span>&nbsp;<span class="ident" id="8183853">want</span><span class="op" id="8183857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183867">nomatch</span>&nbsp;<span class="op" id="8183875">:=</span>&nbsp;<span class="keyword" id="8183878">func</span><span class="op" id="8183882">(</span><span class="ident" id="8183883">tag</span>&nbsp;<span class="builtintype" id="8183887">string</span><span class="op" id="8183893">,</span>&nbsp;<span class="ident" id="8183895">want</span>&nbsp;<span class="keyword" id="8183900">map</span><span class="op" id="8183903">[</span><span class="builtintype" id="8183904">string</span><span class="op" id="8183910">]</span><span class="builtintype" id="8183911">bool</span><span class="op" id="8183915">)</span>&nbsp;<span class="op" id="8183917">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183921">m</span>&nbsp;<span class="op" id="8183923">:=</span>&nbsp;<span class="builtinfunc" id="8183926">make</span><span class="op" id="8183930">(</span><span class="keyword" id="8183931">map</span><span class="op" id="8183934">[</span><span class="builtintype" id="8183935">string</span><span class="op" id="8183941">]</span><span class="builtintype" id="8183942">bool</span><span class="op" id="8183946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183950">if</span>&nbsp;<span class="ident" id="8183953">ctxt</span><span class="op" id="8183957">.</span><span class="ident" id="8183958">match</span><span class="op" id="8183963">(</span><span class="ident" id="8183964">tag</span><span class="op" id="8183967">,</span>&nbsp;<span class="ident" id="8183969">m</span><span class="op" id="8183970">)</span>&nbsp;<span class="op" id="8183972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183977">t</span><span class="op" id="8183978">.</span><span class="ident" id="8183979">Errorf</span><span class="op" id="8183985">(</span><span class="string" id="8183986">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="8184024">,</span>&nbsp;<span class="ident" id="8184026">what</span><span class="op" id="8184030">,</span>&nbsp;<span class="ident" id="8184032">tag</span><span class="op" id="8184035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8184043">if</span>&nbsp;<span class="op" id="8184046">!</span><span class="ident" id="8184047">reflect</span><span class="op" id="8184054">.</span><span class="ident" id="8184055">DeepEqual</span><span class="op" id="8184064">(</span><span class="ident" id="8184065">m</span><span class="op" id="8184066">,</span>&nbsp;<span class="ident" id="8184068">want</span><span class="op" id="8184072">)</span>&nbsp;<span class="op" id="8184074">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184079">t</span><span class="op" id="8184080">.</span><span class="ident" id="8184081">Errorf</span><span class="op" id="8184087">(</span><span class="string" id="8184088">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8184111">,</span>&nbsp;<span class="ident" id="8184113">tag</span><span class="op" id="8184116">,</span>&nbsp;<span class="ident" id="8184118">m</span><span class="op" id="8184119">,</span>&nbsp;<span class="ident" id="8184121">want</span><span class="op" id="8184125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184136">match</span><span class="op" id="8184141">(</span><span class="ident" id="8184142">runtime</span><span class="op" id="8184149">.</span><span class="ident" id="8184150">GOOS</span><span class="op" id="8184154">+</span><span class="string" id="8184155">&#34;,&#34;</span><span class="op" id="8184158">+</span><span class="ident" id="8184159">runtime</span><span class="op" id="8184166">.</span><span class="ident" id="8184167">GOARCH</span><span class="op" id="8184173">,</span>&nbsp;<span class="keyword" id="8184175">map</span><span class="op" id="8184178">[</span><span class="builtintype" id="8184179">string</span><span class="op" id="8184185">]</span><span class="builtintype" id="8184186">bool</span><span class="op" id="8184190">{</span><span class="ident" id="8184191">runtime</span><span class="op" id="8184198">.</span><span class="ident" id="8184199">GOOS</span><span class="op" id="8184203">:</span>&nbsp;<span class="builtintype" id="8184205">true</span><span class="op" id="8184209">,</span>&nbsp;<span class="ident" id="8184211">runtime</span><span class="op" id="8184218">.</span><span class="ident" id="8184219">GOARCH</span><span class="op" id="8184225">:</span>&nbsp;<span class="builtintype" id="8184227">true</span><span class="op" id="8184231">}</span><span class="op" id="8184232">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184235">match</span><span class="op" id="8184240">(</span><span class="ident" id="8184241">runtime</span><span class="op" id="8184248">.</span><span class="ident" id="8184249">GOOS</span><span class="op" id="8184253">+</span><span class="string" id="8184254">&#34;,&#34;</span><span class="op" id="8184257">+</span><span class="ident" id="8184258">runtime</span><span class="op" id="8184265">.</span><span class="ident" id="8184266">GOARCH</span><span class="op" id="8184272">+</span><span class="string" id="8184273">&#34;,!foo&#34;</span><span class="op" id="8184280">,</span>&nbsp;<span class="keyword" id="8184282">map</span><span class="op" id="8184285">[</span><span class="builtintype" id="8184286">string</span><span class="op" id="8184292">]</span><span class="builtintype" id="8184293">bool</span><span class="op" id="8184297">{</span><span class="ident" id="8184298">runtime</span><span class="op" id="8184305">.</span><span class="ident" id="8184306">GOOS</span><span class="op" id="8184310">:</span>&nbsp;<span class="builtintype" id="8184312">true</span><span class="op" id="8184316">,</span>&nbsp;<span class="ident" id="8184318">runtime</span><span class="op" id="8184325">.</span><span class="ident" id="8184326">GOARCH</span><span class="op" id="8184332">:</span>&nbsp;<span class="builtintype" id="8184334">true</span><span class="op" id="8184338">,</span>&nbsp;<span class="string" id="8184340">&#34;foo&#34;</span><span class="op" id="8184345">:</span>&nbsp;<span class="builtintype" id="8184347">true</span><span class="op" id="8184351">}</span><span class="op" id="8184352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184355">nomatch</span><span class="op" id="8184362">(</span><span class="ident" id="8184363">runtime</span><span class="op" id="8184370">.</span><span class="ident" id="8184371">GOOS</span><span class="op" id="8184375">+</span><span class="string" id="8184376">&#34;,&#34;</span><span class="op" id="8184379">+</span><span class="ident" id="8184380">runtime</span><span class="op" id="8184387">.</span><span class="ident" id="8184388">GOARCH</span><span class="op" id="8184394">+</span><span class="string" id="8184395">&#34;,foo&#34;</span><span class="op" id="8184401">,</span>&nbsp;<span class="keyword" id="8184403">map</span><span class="op" id="8184406">[</span><span class="builtintype" id="8184407">string</span><span class="op" id="8184413">]</span><span class="builtintype" id="8184414">bool</span><span class="op" id="8184418">{</span><span class="ident" id="8184419">runtime</span><span class="op" id="8184426">.</span><span class="ident" id="8184427">GOOS</span><span class="op" id="8184431">:</span>&nbsp;<span class="builtintype" id="8184433">true</span><span class="op" id="8184437">,</span>&nbsp;<span class="ident" id="8184439">runtime</span><span class="op" id="8184446">.</span><span class="ident" id="8184447">GOARCH</span><span class="op" id="8184453">:</span>&nbsp;<span class="builtintype" id="8184455">true</span><span class="op" id="8184459">,</span>&nbsp;<span class="string" id="8184461">&#34;foo&#34;</span><span class="op" id="8184466">:</span>&nbsp;<span class="builtintype" id="8184468">true</span><span class="op" id="8184472">}</span><span class="op" id="8184473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184477">what</span>&nbsp;<span class="op" id="8184482">=</span>&nbsp;<span class="string" id="8184484">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184496">ctxt</span><span class="op" id="8184500">.</span><span class="ident" id="8184501">BuildTags</span>&nbsp;<span class="op" id="8184511">=</span>&nbsp;<span class="op" id="8184513">[</span><span class="op" id="8184514">]</span><span class="builtintype" id="8184515">string</span><span class="op" id="8184521">{</span><span class="string" id="8184522">&#34;foo&#34;</span><span class="op" id="8184527">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184530">match</span><span class="op" id="8184535">(</span><span class="ident" id="8184536">runtime</span><span class="op" id="8184543">.</span><span class="ident" id="8184544">GOOS</span><span class="op" id="8184548">+</span><span class="string" id="8184549">&#34;,&#34;</span><span class="op" id="8184552">+</span><span class="ident" id="8184553">runtime</span><span class="op" id="8184560">.</span><span class="ident" id="8184561">GOARCH</span><span class="op" id="8184567">,</span>&nbsp;<span class="keyword" id="8184569">map</span><span class="op" id="8184572">[</span><span class="builtintype" id="8184573">string</span><span class="op" id="8184579">]</span><span class="builtintype" id="8184580">bool</span><span class="op" id="8184584">{</span><span class="ident" id="8184585">runtime</span><span class="op" id="8184592">.</span><span class="ident" id="8184593">GOOS</span><span class="op" id="8184597">:</span>&nbsp;<span class="builtintype" id="8184599">true</span><span class="op" id="8184603">,</span>&nbsp;<span class="ident" id="8184605">runtime</span><span class="op" id="8184612">.</span><span class="ident" id="8184613">GOARCH</span><span class="op" id="8184619">:</span>&nbsp;<span class="builtintype" id="8184621">true</span><span class="op" id="8184625">}</span><span class="op" id="8184626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184629">match</span><span class="op" id="8184634">(</span><span class="ident" id="8184635">runtime</span><span class="op" id="8184642">.</span><span class="ident" id="8184643">GOOS</span><span class="op" id="8184647">+</span><span class="string" id="8184648">&#34;,&#34;</span><span class="op" id="8184651">+</span><span class="ident" id="8184652">runtime</span><span class="op" id="8184659">.</span><span class="ident" id="8184660">GOARCH</span><span class="op" id="8184666">+</span><span class="string" id="8184667">&#34;,foo&#34;</span><span class="op" id="8184673">,</span>&nbsp;<span class="keyword" id="8184675">map</span><span class="op" id="8184678">[</span><span class="builtintype" id="8184679">string</span><span class="op" id="8184685">]</span><span class="builtintype" id="8184686">bool</span><span class="op" id="8184690">{</span><span class="ident" id="8184691">runtime</span><span class="op" id="8184698">.</span><span class="ident" id="8184699">GOOS</span><span class="op" id="8184703">:</span>&nbsp;<span class="builtintype" id="8184705">true</span><span class="op" id="8184709">,</span>&nbsp;<span class="ident" id="8184711">runtime</span><span class="op" id="8184718">.</span><span class="ident" id="8184719">GOARCH</span><span class="op" id="8184725">:</span>&nbsp;<span class="builtintype" id="8184727">true</span><span class="op" id="8184731">,</span>&nbsp;<span class="string" id="8184733">&#34;foo&#34;</span><span class="op" id="8184738">:</span>&nbsp;<span class="builtintype" id="8184740">true</span><span class="op" id="8184744">}</span><span class="op" id="8184745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184748">nomatch</span><span class="op" id="8184755">(</span><span class="ident" id="8184756">runtime</span><span class="op" id="8184763">.</span><span class="ident" id="8184764">GOOS</span><span class="op" id="8184768">+</span><span class="string" id="8184769">&#34;,&#34;</span><span class="op" id="8184772">+</span><span class="ident" id="8184773">runtime</span><span class="op" id="8184780">.</span><span class="ident" id="8184781">GOARCH</span><span class="op" id="8184787">+</span><span class="string" id="8184788">&#34;,!foo&#34;</span><span class="op" id="8184795">,</span>&nbsp;<span class="keyword" id="8184797">map</span><span class="op" id="8184800">[</span><span class="builtintype" id="8184801">string</span><span class="op" id="8184807">]</span><span class="builtintype" id="8184808">bool</span><span class="op" id="8184812">{</span><span class="ident" id="8184813">runtime</span><span class="op" id="8184820">.</span><span class="ident" id="8184821">GOOS</span><span class="op" id="8184825">:</span>&nbsp;<span class="builtintype" id="8184827">true</span><span class="op" id="8184831">,</span>&nbsp;<span class="ident" id="8184833">runtime</span><span class="op" id="8184840">.</span><span class="ident" id="8184841">GOARCH</span><span class="op" id="8184847">:</span>&nbsp;<span class="builtintype" id="8184849">true</span><span class="op" id="8184853">,</span>&nbsp;<span class="string" id="8184855">&#34;foo&#34;</span><span class="op" id="8184860">:</span>&nbsp;<span class="builtintype" id="8184862">true</span><span class="op" id="8184866">}</span><span class="op" id="8184867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184870">match</span><span class="op" id="8184875">(</span><span class="ident" id="8184876">runtime</span><span class="op" id="8184883">.</span><span class="ident" id="8184884">GOOS</span><span class="op" id="8184888">+</span><span class="string" id="8184889">&#34;,&#34;</span><span class="op" id="8184892">+</span><span class="ident" id="8184893">runtime</span><span class="op" id="8184900">.</span><span class="ident" id="8184901">GOARCH</span><span class="op" id="8184907">+</span><span class="string" id="8184908">&#34;,!bar&#34;</span><span class="op" id="8184915">,</span>&nbsp;<span class="keyword" id="8184917">map</span><span class="op" id="8184920">[</span><span class="builtintype" id="8184921">string</span><span class="op" id="8184927">]</span><span class="builtintype" id="8184928">bool</span><span class="op" id="8184932">{</span><span class="ident" id="8184933">runtime</span><span class="op" id="8184940">.</span><span class="ident" id="8184941">GOOS</span><span class="op" id="8184945">:</span>&nbsp;<span class="builtintype" id="8184947">true</span><span class="op" id="8184951">,</span>&nbsp;<span class="ident" id="8184953">runtime</span><span class="op" id="8184960">.</span><span class="ident" id="8184961">GOARCH</span><span class="op" id="8184967">:</span>&nbsp;<span class="builtintype" id="8184969">true</span><span class="op" id="8184973">,</span>&nbsp;<span class="string" id="8184975">&#34;bar&#34;</span><span class="op" id="8184980">:</span>&nbsp;<span class="builtintype" id="8184982">true</span><span class="op" id="8184986">}</span><span class="op" id="8184987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8184990">nomatch</span><span class="op" id="8184997">(</span><span class="ident" id="8184998">runtime</span><span class="op" id="8185005">.</span><span class="ident" id="8185006">GOOS</span><span class="op" id="8185010">+</span><span class="string" id="8185011">&#34;,&#34;</span><span class="op" id="8185014">+</span><span class="ident" id="8185015">runtime</span><span class="op" id="8185022">.</span><span class="ident" id="8185023">GOARCH</span><span class="op" id="8185029">+</span><span class="string" id="8185030">&#34;,bar&#34;</span><span class="op" id="8185036">,</span>&nbsp;<span class="keyword" id="8185038">map</span><span class="op" id="8185041">[</span><span class="builtintype" id="8185042">string</span><span class="op" id="8185048">]</span><span class="builtintype" id="8185049">bool</span><span class="op" id="8185053">{</span><span class="ident" id="8185054">runtime</span><span class="op" id="8185061">.</span><span class="ident" id="8185062">GOOS</span><span class="op" id="8185066">:</span>&nbsp;<span class="builtintype" id="8185068">true</span><span class="op" id="8185072">,</span>&nbsp;<span class="ident" id="8185074">runtime</span><span class="op" id="8185081">.</span><span class="ident" id="8185082">GOARCH</span><span class="op" id="8185088">:</span>&nbsp;<span class="builtintype" id="8185090">true</span><span class="op" id="8185094">,</span>&nbsp;<span class="string" id="8185096">&#34;bar&#34;</span><span class="op" id="8185101">:</span>&nbsp;<span class="builtintype" id="8185103">true</span><span class="op" id="8185107">}</span><span class="op" id="8185108">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185111">nomatch</span><span class="op" id="8185118">(</span><span class="string" id="8185119">&#34;!&#34;</span><span class="op" id="8185122">,</span>&nbsp;<span class="keyword" id="8185124">map</span><span class="op" id="8185127">[</span><span class="builtintype" id="8185128">string</span><span class="op" id="8185134">]</span><span class="builtintype" id="8185135">bool</span><span class="op" id="8185139">{</span><span class="op" id="8185140">}</span><span class="op" id="8185141">)</span><br>
<span class="lineno"></span><span class="op" id="8185143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8185146">func</span>&nbsp;<span class="ident" id="8185151">TestDotSlashImport</span><span class="op" id="8185169">(</span><span class="ident" id="8185170">t</span>&nbsp;<span class="op" id="8185172">*</span><span class="ident" id="8185173">testing</span><span class="op" id="8185180">.</span><span class="ident" id="8185181">T</span><span class="op" id="8185182">)</span>&nbsp;<span class="op" id="8185184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185187">p</span><span class="op" id="8185188">,</span>&nbsp;<span class="ident" id="8185190">err</span>&nbsp;<span class="op" id="8185194">:=</span>&nbsp;<span class="ident" id="8185197">ImportDir</span><span class="op" id="8185206">(</span><span class="string" id="8185207">&#34;testdata/other&#34;</span><span class="op" id="8185223">,</span>&nbsp;<span class="num" id="8185225">0</span><span class="op" id="8185226">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185229">if</span>&nbsp;<span class="ident" id="8185232">err</span>&nbsp;<span class="op" id="8185236">!=</span>&nbsp;<span class="ident" id="8185239">nil</span>&nbsp;<span class="op" id="8185243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185247">t</span><span class="op" id="8185248">.</span><span class="ident" id="8185249">Fatal</span><span class="op" id="8185254">(</span><span class="ident" id="8185255">err</span><span class="op" id="8185258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185264">if</span>&nbsp;<span class="builtinfunc" id="8185267">len</span><span class="op" id="8185270">(</span><span class="ident" id="8185271">p</span><span class="op" id="8185272">.</span><span class="ident" id="8185273">Imports</span><span class="op" id="8185280">)</span>&nbsp;<span class="op" id="8185282">!=</span>&nbsp;<span class="num" id="8185285">1</span>&nbsp;<span class="op" id="8185287">||</span>&nbsp;<span class="ident" id="8185290">p</span><span class="op" id="8185291">.</span><span class="ident" id="8185292">Imports</span><span class="op" id="8185299">[</span><span class="num" id="8185300">0</span><span class="op" id="8185301">]</span>&nbsp;<span class="op" id="8185303">!=</span>&nbsp;<span class="string" id="8185306">&#34;./file&#34;</span>&nbsp;<span class="op" id="8185315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185319">t</span><span class="op" id="8185320">.</span><span class="ident" id="8185321">Fatalf</span><span class="op" id="8185327">(</span><span class="string" id="8185328">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="8185371">,</span>&nbsp;<span class="ident" id="8185373">p</span><span class="op" id="8185374">.</span><span class="ident" id="8185375">Imports</span><span class="op" id="8185382">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185389">p1</span><span class="op" id="8185391">,</span>&nbsp;<span class="ident" id="8185393">err</span>&nbsp;<span class="op" id="8185397">:=</span>&nbsp;<span class="ident" id="8185400">Import</span><span class="op" id="8185406">(</span><span class="string" id="8185407">&#34;./file&#34;</span><span class="op" id="8185415">,</span>&nbsp;<span class="string" id="8185417">&#34;testdata/other&#34;</span><span class="op" id="8185433">,</span>&nbsp;<span class="num" id="8185435">0</span><span class="op" id="8185436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185439">if</span>&nbsp;<span class="ident" id="8185442">err</span>&nbsp;<span class="op" id="8185446">!=</span>&nbsp;<span class="ident" id="8185449">nil</span>&nbsp;<span class="op" id="8185453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185457">t</span><span class="op" id="8185458">.</span><span class="ident" id="8185459">Fatal</span><span class="op" id="8185464">(</span><span class="ident" id="8185465">err</span><span class="op" id="8185468">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185474">if</span>&nbsp;<span class="ident" id="8185477">p1</span><span class="op" id="8185479">.</span><span class="ident" id="8185480">Name</span>&nbsp;<span class="op" id="8185485">!=</span>&nbsp;<span class="string" id="8185488">&#34;file&#34;</span>&nbsp;<span class="op" id="8185495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185499">t</span><span class="op" id="8185500">.</span><span class="ident" id="8185501">Fatalf</span><span class="op" id="8185507">(</span><span class="string" id="8185508">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8185534">,</span>&nbsp;<span class="ident" id="8185536">p1</span><span class="op" id="8185538">.</span><span class="ident" id="8185539">Name</span><span class="op" id="8185543">,</span>&nbsp;<span class="string" id="8185545">&#34;file&#34;</span><span class="op" id="8185551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185557">dir</span>&nbsp;<span class="op" id="8185561">:=</span>&nbsp;<span class="ident" id="8185564">filepath</span><span class="op" id="8185572">.</span><span class="ident" id="8185573">Clean</span><span class="op" id="8185578">(</span><span class="string" id="8185579">&#34;testdata/other/file&#34;</span><span class="op" id="8185600">)</span>&nbsp;<span class="comment" id="8185602">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185632">if</span>&nbsp;<span class="ident" id="8185635">p1</span><span class="op" id="8185637">.</span><span class="ident" id="8185638">Dir</span>&nbsp;<span class="op" id="8185642">!=</span>&nbsp;<span class="ident" id="8185645">dir</span>&nbsp;<span class="op" id="8185649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185653">t</span><span class="op" id="8185654">.</span><span class="ident" id="8185655">Fatalf</span><span class="op" id="8185661">(</span><span class="string" id="8185662">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8185687">,</span>&nbsp;<span class="ident" id="8185689">p1</span><span class="op" id="8185691">.</span><span class="ident" id="8185692">Name</span><span class="op" id="8185696">,</span>&nbsp;<span class="ident" id="8185698">dir</span><span class="op" id="8185701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185704">}</span><br>
<span class="lineno"></span><span class="op" id="8185706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8185709">func</span>&nbsp;<span class="ident" id="8185714">TestEmptyImport</span><span class="op" id="8185729">(</span><span class="ident" id="8185730">t</span>&nbsp;<span class="op" id="8185732">*</span><span class="ident" id="8185733">testing</span><span class="op" id="8185740">.</span><span class="ident" id="8185741">T</span><span class="op" id="8185742">)</span>&nbsp;<span class="op" id="8185744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185747">p</span><span class="op" id="8185748">,</span>&nbsp;<span class="ident" id="8185750">err</span>&nbsp;<span class="op" id="8185754">:=</span>&nbsp;<span class="ident" id="8185757">Import</span><span class="op" id="8185763">(</span><span class="string" id="8185764">&#34;&#34;</span><span class="op" id="8185766">,</span>&nbsp;<span class="ident" id="8185768">Default</span><span class="op" id="8185775">.</span><span class="ident" id="8185776">GOROOT</span><span class="op" id="8185782">,</span>&nbsp;<span class="ident" id="8185784">FindOnly</span><span class="op" id="8185792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185795">if</span>&nbsp;<span class="ident" id="8185798">err</span>&nbsp;<span class="op" id="8185802">==</span>&nbsp;<span class="ident" id="8185805">nil</span>&nbsp;<span class="op" id="8185809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185813">t</span><span class="op" id="8185814">.</span><span class="ident" id="8185815">Fatal</span><span class="op" id="8185820">(</span><span class="string" id="8185821">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="8185853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185856">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185859">if</span>&nbsp;<span class="ident" id="8185862">p</span>&nbsp;<span class="op" id="8185864">==</span>&nbsp;<span class="ident" id="8185867">nil</span>&nbsp;<span class="op" id="8185871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185875">t</span><span class="op" id="8185876">.</span><span class="ident" id="8185877">Fatal</span><span class="op" id="8185882">(</span><span class="string" id="8185883">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="8185917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8185920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8185923">if</span>&nbsp;<span class="ident" id="8185926">p</span><span class="op" id="8185927">.</span><span class="ident" id="8185928">ImportPath</span>&nbsp;<span class="op" id="8185939">!=</span>&nbsp;<span class="string" id="8185942">&#34;&#34;</span>&nbsp;<span class="op" id="8185945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8185949">t</span><span class="op" id="8185950">.</span><span class="ident" id="8185951">Fatalf</span><span class="op" id="8185957">(</span><span class="string" id="8185958">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="8185983">,</span>&nbsp;<span class="ident" id="8185985">p</span><span class="op" id="8185986">.</span><span class="ident" id="8185987">ImportPath</span><span class="op" id="8185997">,</span>&nbsp;<span class="string" id="8185999">&#34;&#34;</span><span class="op" id="8186001">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186004">}</span><br>
<span class="lineno"></span><span class="op" id="8186006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186009">func</span>&nbsp;<span class="ident" id="8186014">TestEmptyFolderImport</span><span class="op" id="8186035">(</span><span class="ident" id="8186036">t</span>&nbsp;<span class="op" id="8186038">*</span><span class="ident" id="8186039">testing</span><span class="op" id="8186046">.</span><span class="ident" id="8186047">T</span><span class="op" id="8186048">)</span>&nbsp;<span class="op" id="8186050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186053">_</span><span class="op" id="8186054">,</span>&nbsp;<span class="ident" id="8186056">err</span>&nbsp;<span class="op" id="8186060">:=</span>&nbsp;<span class="ident" id="8186063">Import</span><span class="op" id="8186069">(</span><span class="string" id="8186070">&#34;.&#34;</span><span class="op" id="8186073">,</span>&nbsp;<span class="string" id="8186075">&#34;testdata/empty&#34;</span><span class="op" id="8186091">,</span>&nbsp;<span class="num" id="8186093">0</span><span class="op" id="8186094">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186097">if</span>&nbsp;<span class="ident" id="8186100">_</span><span class="op" id="8186101">,</span>&nbsp;<span class="ident" id="8186103">ok</span>&nbsp;<span class="op" id="8186106">:=</span>&nbsp;<span class="ident" id="8186109">err</span><span class="op" id="8186112">.</span><span class="op" id="8186113">(</span><span class="op" id="8186114">*</span><span class="ident" id="8186115">NoGoError</span><span class="op" id="8186124">)</span><span class="op" id="8186125">;</span>&nbsp;<span class="op" id="8186127">!</span><span class="ident" id="8186128">ok</span>&nbsp;<span class="op" id="8186131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186135">t</span><span class="op" id="8186136">.</span><span class="ident" id="8186137">Fatal</span><span class="op" id="8186142">(</span><span class="string" id="8186143">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="8186195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186198">}</span><br>
<span class="lineno"></span><span class="op" id="8186200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8186203">func</span>&nbsp;<span class="ident" id="8186208">TestMultiplePackageImport</span><span class="op" id="8186233">(</span><span class="ident" id="8186234">t</span>&nbsp;<span class="op" id="8186236">*</span><span class="ident" id="8186237">testing</span><span class="op" id="8186244">.</span><span class="ident" id="8186245">T</span><span class="op" id="8186246">)</span>&nbsp;<span class="op" id="8186248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186251">_</span><span class="op" id="8186252">,</span>&nbsp;<span class="ident" id="8186254">err</span>&nbsp;<span class="op" id="8186258">:=</span>&nbsp;<span class="ident" id="8186261">Import</span><span class="op" id="8186267">(</span><span class="string" id="8186268">&#34;.&#34;</span><span class="op" id="8186271">,</span>&nbsp;<span class="string" id="8186273">&#34;testdata/multi&#34;</span><span class="op" id="8186289">,</span>&nbsp;<span class="num" id="8186291">0</span><span class="op" id="8186292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186295">if</span>&nbsp;<span class="ident" id="8186298">_</span><span class="op" id="8186299">,</span>&nbsp;<span class="ident" id="8186301">ok</span>&nbsp;<span class="op" id="8186304">:=</span>&nbsp;<span class="ident" id="8186307">err</span><span class="op" id="8186310">.</span><span class="op" id="8186311">(</span><span class="op" id="8186312">*</span><span class="ident" id="8186313">MultiplePackageError</span><span class="op" id="8186333">)</span><span class="op" id="8186334">;</span>&nbsp;<span class="op" id="8186336">!</span><span class="ident" id="8186337">ok</span>&nbsp;<span class="op" id="8186340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186344">t</span><span class="op" id="8186345">.</span><span class="ident" id="8186346">Fatal</span><span class="op" id="8186351">(</span><span class="string" id="8186352">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="8186415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186418">}</span><br>
<span class="lineno">100</span><span class="op" id="8186420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186423">func</span>&nbsp;<span class="ident" id="8186428">TestLocalDirectory</span><span class="op" id="8186446">(</span><span class="ident" id="8186447">t</span>&nbsp;<span class="op" id="8186449">*</span><span class="ident" id="8186450">testing</span><span class="op" id="8186457">.</span><span class="ident" id="8186458">T</span><span class="op" id="8186459">)</span>&nbsp;<span class="op" id="8186461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186464">cwd</span><span class="op" id="8186467">,</span>&nbsp;<span class="ident" id="8186469">err</span>&nbsp;<span class="op" id="8186473">:=</span>&nbsp;<span class="ident" id="8186476">os</span><span class="op" id="8186478">.</span><span class="ident" id="8186479">Getwd</span><span class="op" id="8186484">(</span><span class="op" id="8186485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186488">if</span>&nbsp;<span class="ident" id="8186491">err</span>&nbsp;<span class="op" id="8186495">!=</span>&nbsp;<span class="ident" id="8186498">nil</span>&nbsp;<span class="op" id="8186502">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186506">t</span><span class="op" id="8186507">.</span><span class="ident" id="8186508">Fatal</span><span class="op" id="8186513">(</span><span class="ident" id="8186514">err</span><span class="op" id="8186517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186524">p</span><span class="op" id="8186525">,</span>&nbsp;<span class="ident" id="8186527">err</span>&nbsp;<span class="op" id="8186531">:=</span>&nbsp;<span class="ident" id="8186534">ImportDir</span><span class="op" id="8186543">(</span><span class="ident" id="8186544">cwd</span><span class="op" id="8186547">,</span>&nbsp;<span class="num" id="8186549">0</span><span class="op" id="8186550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186553">if</span>&nbsp;<span class="ident" id="8186556">err</span>&nbsp;<span class="op" id="8186560">!=</span>&nbsp;<span class="ident" id="8186563">nil</span>&nbsp;<span class="op" id="8186567">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186571">t</span><span class="op" id="8186572">.</span><span class="ident" id="8186573">Fatal</span><span class="op" id="8186578">(</span><span class="ident" id="8186579">err</span><span class="op" id="8186582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186588">if</span>&nbsp;<span class="ident" id="8186591">p</span><span class="op" id="8186592">.</span><span class="ident" id="8186593">ImportPath</span>&nbsp;<span class="op" id="8186604">!=</span>&nbsp;<span class="string" id="8186607">&#34;go/build&#34;</span>&nbsp;<span class="op" id="8186618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186622">t</span><span class="op" id="8186623">.</span><span class="ident" id="8186624">Fatalf</span><span class="op" id="8186630">(</span><span class="string" id="8186631">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8186655">,</span>&nbsp;<span class="ident" id="8186657">p</span><span class="op" id="8186658">.</span><span class="ident" id="8186659">ImportPath</span><span class="op" id="8186669">,</span>&nbsp;<span class="string" id="8186671">&#34;go/build&#34;</span><span class="op" id="8186681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8186684">}</span><br>
<span class="lineno">115</span><span class="op" id="8186686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186689">func</span>&nbsp;<span class="ident" id="8186694">TestShouldBuild</span><span class="op" id="8186709">(</span><span class="ident" id="8186710">t</span>&nbsp;<span class="op" id="8186712">*</span><span class="ident" id="8186713">testing</span><span class="op" id="8186720">.</span><span class="ident" id="8186721">T</span><span class="op" id="8186722">)</span>&nbsp;<span class="op" id="8186724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186727">const</span>&nbsp;<span class="ident" id="8186733">file1</span>&nbsp;<span class="op" id="8186739">=</span>&nbsp;<span class="string" id="8186741">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="8186762">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186766">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186784">want1</span>&nbsp;<span class="op" id="8186790">:=</span>&nbsp;<span class="keyword" id="8186793">map</span><span class="op" id="8186796">[</span><span class="builtintype" id="8186797">string</span><span class="op" id="8186803">]</span><span class="builtintype" id="8186804">bool</span><span class="op" id="8186808">{</span><span class="string" id="8186809">&#34;tag1&#34;</span><span class="op" id="8186815">:</span>&nbsp;<span class="builtintype" id="8186817">true</span><span class="op" id="8186821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186825">const</span>&nbsp;<span class="ident" id="8186831">file2</span>&nbsp;<span class="op" id="8186837">=</span>&nbsp;<span class="string" id="8186839">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="8186859">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186863">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="8186915">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186919">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="8186938">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186942">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8186959">want2</span>&nbsp;<span class="op" id="8186965">:=</span>&nbsp;<span class="keyword" id="8186968">map</span><span class="op" id="8186971">[</span><span class="builtintype" id="8186972">string</span><span class="op" id="8186978">]</span><span class="builtintype" id="8186979">bool</span><span class="op" id="8186983">{</span><span class="string" id="8186984">&#34;cgo&#34;</span><span class="op" id="8186989">:</span>&nbsp;<span class="builtintype" id="8186991">true</span><span class="op" id="8186995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186999">const</span>&nbsp;<span class="ident" id="8187005">file3</span>&nbsp;<span class="op" id="8187011">=</span>&nbsp;<span class="string" id="8187013">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="8187048">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8187052">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="8187072">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8187076">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="8187134">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8187138">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="8187156">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8187160">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187198">want3</span>&nbsp;<span class="op" id="8187204">:=</span>&nbsp;<span class="keyword" id="8187207">map</span><span class="op" id="8187210">[</span><span class="builtintype" id="8187211">string</span><span class="op" id="8187217">]</span><span class="builtintype" id="8187218">bool</span><span class="op" id="8187222">{</span><span class="op" id="8187223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187227">ctx</span>&nbsp;<span class="op" id="8187231">:=</span>&nbsp;<span class="op" id="8187234">&amp;</span><span class="ident" id="8187235">Context</span><span class="op" id="8187242">{</span><span class="ident" id="8187243">BuildTags</span><span class="op" id="8187252">:</span>&nbsp;<span class="op" id="8187254">[</span><span class="op" id="8187255">]</span><span class="builtintype" id="8187256">string</span><span class="op" id="8187262">{</span><span class="string" id="8187263">&#34;tag1&#34;</span><span class="op" id="8187269">}</span><span class="op" id="8187270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187273">m</span>&nbsp;<span class="op" id="8187275">:=</span>&nbsp;<span class="keyword" id="8187278">map</span><span class="op" id="8187281">[</span><span class="builtintype" id="8187282">string</span><span class="op" id="8187288">]</span><span class="builtintype" id="8187289">bool</span><span class="op" id="8187293">{</span><span class="op" id="8187294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187297">if</span>&nbsp;<span class="op" id="8187300">!</span><span class="ident" id="8187301">ctx</span><span class="op" id="8187304">.</span><span class="ident" id="8187305">shouldBuild</span><span class="op" id="8187316">(</span><span class="op" id="8187317">[</span><span class="op" id="8187318">]</span><span class="builtintype" id="8187319">byte</span><span class="op" id="8187323">(</span><span class="ident" id="8187324">file1</span><span class="op" id="8187329">)</span><span class="op" id="8187330">,</span>&nbsp;<span class="ident" id="8187332">m</span><span class="op" id="8187333">)</span>&nbsp;<span class="op" id="8187335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187339">t</span><span class="op" id="8187340">.</span><span class="ident" id="8187341">Errorf</span><span class="op" id="8187347">(</span><span class="string" id="8187348">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="8187387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187390">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187393">if</span>&nbsp;<span class="op" id="8187396">!</span><span class="ident" id="8187397">reflect</span><span class="op" id="8187404">.</span><span class="ident" id="8187405">DeepEqual</span><span class="op" id="8187414">(</span><span class="ident" id="8187415">m</span><span class="op" id="8187416">,</span>&nbsp;<span class="ident" id="8187418">want1</span><span class="op" id="8187423">)</span>&nbsp;<span class="op" id="8187425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187429">t</span><span class="op" id="8187430">.</span><span class="ident" id="8187431">Errorf</span><span class="op" id="8187437">(</span><span class="string" id="8187438">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8187476">,</span>&nbsp;<span class="ident" id="8187478">m</span><span class="op" id="8187479">,</span>&nbsp;<span class="ident" id="8187481">want1</span><span class="op" id="8187486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187493">m</span>&nbsp;<span class="op" id="8187495">=</span>&nbsp;<span class="keyword" id="8187497">map</span><span class="op" id="8187500">[</span><span class="builtintype" id="8187501">string</span><span class="op" id="8187507">]</span><span class="builtintype" id="8187508">bool</span><span class="op" id="8187512">{</span><span class="op" id="8187513">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187516">if</span>&nbsp;<span class="ident" id="8187519">ctx</span><span class="op" id="8187522">.</span><span class="ident" id="8187523">shouldBuild</span><span class="op" id="8187534">(</span><span class="op" id="8187535">[</span><span class="op" id="8187536">]</span><span class="builtintype" id="8187537">byte</span><span class="op" id="8187541">(</span><span class="ident" id="8187542">file2</span><span class="op" id="8187547">)</span><span class="op" id="8187548">,</span>&nbsp;<span class="ident" id="8187550">m</span><span class="op" id="8187551">)</span>&nbsp;<span class="op" id="8187553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187557">t</span><span class="op" id="8187558">.</span><span class="ident" id="8187559">Errorf</span><span class="op" id="8187565">(</span><span class="string" id="8187566">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="8187605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187611">if</span>&nbsp;<span class="op" id="8187614">!</span><span class="ident" id="8187615">reflect</span><span class="op" id="8187622">.</span><span class="ident" id="8187623">DeepEqual</span><span class="op" id="8187632">(</span><span class="ident" id="8187633">m</span><span class="op" id="8187634">,</span>&nbsp;<span class="ident" id="8187636">want2</span><span class="op" id="8187641">)</span>&nbsp;<span class="op" id="8187643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187647">t</span><span class="op" id="8187648">.</span><span class="ident" id="8187649">Errorf</span><span class="op" id="8187655">(</span><span class="string" id="8187656">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8187694">,</span>&nbsp;<span class="ident" id="8187696">m</span><span class="op" id="8187697">,</span>&nbsp;<span class="ident" id="8187699">want2</span><span class="op" id="8187704">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187711">m</span>&nbsp;<span class="op" id="8187713">=</span>&nbsp;<span class="keyword" id="8187715">map</span><span class="op" id="8187718">[</span><span class="builtintype" id="8187719">string</span><span class="op" id="8187725">]</span><span class="builtintype" id="8187726">bool</span><span class="op" id="8187730">{</span><span class="op" id="8187731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187734">ctx</span>&nbsp;<span class="op" id="8187738">=</span>&nbsp;<span class="op" id="8187740">&amp;</span><span class="ident" id="8187741">Context</span><span class="op" id="8187748">{</span><span class="ident" id="8187749">BuildTags</span><span class="op" id="8187758">:</span>&nbsp;<span class="ident" id="8187760">nil</span><span class="op" id="8187763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187766">if</span>&nbsp;<span class="op" id="8187769">!</span><span class="ident" id="8187770">ctx</span><span class="op" id="8187773">.</span><span class="ident" id="8187774">shouldBuild</span><span class="op" id="8187785">(</span><span class="op" id="8187786">[</span><span class="op" id="8187787">]</span><span class="builtintype" id="8187788">byte</span><span class="op" id="8187792">(</span><span class="ident" id="8187793">file3</span><span class="op" id="8187798">)</span><span class="op" id="8187799">,</span>&nbsp;<span class="ident" id="8187801">m</span><span class="op" id="8187802">)</span>&nbsp;<span class="op" id="8187804">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187808">t</span><span class="op" id="8187809">.</span><span class="ident" id="8187810">Errorf</span><span class="op" id="8187816">(</span><span class="string" id="8187817">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="8187856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187862">if</span>&nbsp;<span class="op" id="8187865">!</span><span class="ident" id="8187866">reflect</span><span class="op" id="8187873">.</span><span class="ident" id="8187874">DeepEqual</span><span class="op" id="8187883">(</span><span class="ident" id="8187884">m</span><span class="op" id="8187885">,</span>&nbsp;<span class="ident" id="8187887">want3</span><span class="op" id="8187892">)</span>&nbsp;<span class="op" id="8187894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187898">t</span><span class="op" id="8187899">.</span><span class="ident" id="8187900">Errorf</span><span class="op" id="8187906">(</span><span class="string" id="8187907">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8187945">,</span>&nbsp;<span class="ident" id="8187947">m</span><span class="op" id="8187948">,</span>&nbsp;<span class="ident" id="8187950">want3</span><span class="op" id="8187955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187958">}</span><br>
<span class="lineno">160</span><span class="op" id="8187960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187963">type</span>&nbsp;<span class="ident" id="8187968">readNopCloser</span>&nbsp;<span class="keyword" id="8187982">struct</span>&nbsp;<span class="op" id="8187989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187992">io</span><span class="op" id="8187994">.</span><span class="ident" id="8187995">Reader</span><br>
<span class="lineno"></span><span class="op" id="8188002">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="8188005">func</span>&nbsp;<span class="op" id="8188010">(</span><span class="ident" id="8188011">r</span>&nbsp;<span class="ident" id="8188013">readNopCloser</span><span class="op" id="8188026">)</span>&nbsp;<span class="ident" id="8188028">Close</span><span class="op" id="8188033">(</span><span class="op" id="8188034">)</span>&nbsp;<span class="builtintype" id="8188036">error</span>&nbsp;<span class="op" id="8188042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188045">return</span>&nbsp;<span class="ident" id="8188052">nil</span><br>
<span class="lineno"></span><span class="op" id="8188056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8188059">var</span>&nbsp;<span class="op" id="8188063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188066">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8188078">=</span>&nbsp;<span class="ident" id="8188080">Context</span><span class="op" id="8188087">{</span><span class="ident" id="8188088">GOARCH</span><span class="op" id="8188094">:</span>&nbsp;<span class="string" id="8188096">&#34;arm&#34;</span><span class="op" id="8188101">,</span>&nbsp;<span class="ident" id="8188103">GOOS</span><span class="op" id="8188107">:</span>&nbsp;<span class="string" id="8188109">&#34;plan9&#34;</span><span class="op" id="8188116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188119">ctxtAndroid</span>&nbsp;<span class="op" id="8188131">=</span>&nbsp;<span class="ident" id="8188133">Context</span><span class="op" id="8188140">{</span><span class="ident" id="8188141">GOARCH</span><span class="op" id="8188147">:</span>&nbsp;<span class="string" id="8188149">&#34;arm&#34;</span><span class="op" id="8188154">,</span>&nbsp;<span class="ident" id="8188156">GOOS</span><span class="op" id="8188160">:</span>&nbsp;<span class="string" id="8188162">&#34;android&#34;</span><span class="op" id="8188171">}</span><br>
<span class="lineno"></span><span class="op" id="8188173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8188176">var</span>&nbsp;<span class="ident" id="8188180">matchFileTests</span>&nbsp;<span class="op" id="8188195">=</span>&nbsp;<span class="op" id="8188197">[</span><span class="op" id="8188198">]</span><span class="keyword" id="8188199">struct</span>&nbsp;<span class="op" id="8188206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188209">ctxt</span>&nbsp;&nbsp;<span class="ident" id="8188215">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188224">name</span>&nbsp;&nbsp;<span class="builtintype" id="8188230">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188238">data</span>&nbsp;&nbsp;<span class="builtintype" id="8188244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188252">match</span>&nbsp;<span class="builtintype" id="8188258">bool</span><br>
<span class="lineno">180</span><span class="op" id="8188263">}</span><span class="op" id="8188264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188267">{</span><span class="ident" id="8188268">ctxtP9</span><span class="op" id="8188274">,</span>&nbsp;<span class="string" id="8188276">&#34;foo_arm.go&#34;</span><span class="op" id="8188288">,</span>&nbsp;<span class="string" id="8188290">&#34;&#34;</span><span class="op" id="8188292">,</span>&nbsp;<span class="builtintype" id="8188294">true</span><span class="op" id="8188298">}</span><span class="op" id="8188299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188302">{</span><span class="ident" id="8188303">ctxtP9</span><span class="op" id="8188309">,</span>&nbsp;<span class="string" id="8188311">&#34;foo1_arm.go&#34;</span><span class="op" id="8188324">,</span>&nbsp;<span class="string" id="8188326">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="8188361">,</span>&nbsp;<span class="builtintype" id="8188363">false</span><span class="op" id="8188368">}</span><span class="op" id="8188369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188372">{</span><span class="ident" id="8188373">ctxtP9</span><span class="op" id="8188379">,</span>&nbsp;<span class="string" id="8188381">&#34;foo_darwin.go&#34;</span><span class="op" id="8188396">,</span>&nbsp;<span class="string" id="8188398">&#34;&#34;</span><span class="op" id="8188400">,</span>&nbsp;<span class="builtintype" id="8188402">false</span><span class="op" id="8188407">}</span><span class="op" id="8188408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188411">{</span><span class="ident" id="8188412">ctxtP9</span><span class="op" id="8188418">,</span>&nbsp;<span class="string" id="8188420">&#34;foo.go&#34;</span><span class="op" id="8188428">,</span>&nbsp;<span class="string" id="8188430">&#34;&#34;</span><span class="op" id="8188432">,</span>&nbsp;<span class="builtintype" id="8188434">true</span><span class="op" id="8188438">}</span><span class="op" id="8188439">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188442">{</span><span class="ident" id="8188443">ctxtP9</span><span class="op" id="8188449">,</span>&nbsp;<span class="string" id="8188451">&#34;foo1.go&#34;</span><span class="op" id="8188460">,</span>&nbsp;<span class="string" id="8188462">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="8188497">,</span>&nbsp;<span class="builtintype" id="8188499">false</span><span class="op" id="8188504">}</span><span class="op" id="8188505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188508">{</span><span class="ident" id="8188509">ctxtP9</span><span class="op" id="8188515">,</span>&nbsp;<span class="string" id="8188517">&#34;foo.badsuffix&#34;</span><span class="op" id="8188532">,</span>&nbsp;<span class="string" id="8188534">&#34;&#34;</span><span class="op" id="8188536">,</span>&nbsp;<span class="builtintype" id="8188538">false</span><span class="op" id="8188543">}</span><span class="op" id="8188544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188547">{</span><span class="ident" id="8188548">ctxtAndroid</span><span class="op" id="8188559">,</span>&nbsp;<span class="string" id="8188561">&#34;foo_linux.go&#34;</span><span class="op" id="8188575">,</span>&nbsp;<span class="string" id="8188577">&#34;&#34;</span><span class="op" id="8188579">,</span>&nbsp;<span class="builtintype" id="8188581">true</span><span class="op" id="8188585">}</span><span class="op" id="8188586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188589">{</span><span class="ident" id="8188590">ctxtAndroid</span><span class="op" id="8188601">,</span>&nbsp;<span class="string" id="8188603">&#34;foo_android.go&#34;</span><span class="op" id="8188619">,</span>&nbsp;<span class="string" id="8188621">&#34;&#34;</span><span class="op" id="8188623">,</span>&nbsp;<span class="builtintype" id="8188625">true</span><span class="op" id="8188629">}</span><span class="op" id="8188630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188633">{</span><span class="ident" id="8188634">ctxtAndroid</span><span class="op" id="8188645">,</span>&nbsp;<span class="string" id="8188647">&#34;foo_plan9.go&#34;</span><span class="op" id="8188661">,</span>&nbsp;<span class="string" id="8188663">&#34;&#34;</span><span class="op" id="8188665">,</span>&nbsp;<span class="builtintype" id="8188667">false</span><span class="op" id="8188672">}</span><span class="op" id="8188673">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188676">{</span><span class="ident" id="8188677">ctxtAndroid</span><span class="op" id="8188688">,</span>&nbsp;<span class="string" id="8188690">&#34;android.go&#34;</span><span class="op" id="8188702">,</span>&nbsp;<span class="string" id="8188704">&#34;&#34;</span><span class="op" id="8188706">,</span>&nbsp;<span class="builtintype" id="8188708">true</span><span class="op" id="8188712">}</span><span class="op" id="8188713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188716">{</span><span class="ident" id="8188717">ctxtAndroid</span><span class="op" id="8188728">,</span>&nbsp;<span class="string" id="8188730">&#34;plan9.go&#34;</span><span class="op" id="8188740">,</span>&nbsp;<span class="string" id="8188742">&#34;&#34;</span><span class="op" id="8188744">,</span>&nbsp;<span class="builtintype" id="8188746">true</span><span class="op" id="8188750">}</span><span class="op" id="8188751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188754">{</span><span class="ident" id="8188755">ctxtAndroid</span><span class="op" id="8188766">,</span>&nbsp;<span class="string" id="8188768">&#34;plan9_test.go&#34;</span><span class="op" id="8188783">,</span>&nbsp;<span class="string" id="8188785">&#34;&#34;</span><span class="op" id="8188787">,</span>&nbsp;<span class="builtintype" id="8188789">true</span><span class="op" id="8188793">}</span><span class="op" id="8188794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188797">{</span><span class="ident" id="8188798">ctxtAndroid</span><span class="op" id="8188809">,</span>&nbsp;<span class="string" id="8188811">&#34;arm.s&#34;</span><span class="op" id="8188818">,</span>&nbsp;<span class="string" id="8188820">&#34;&#34;</span><span class="op" id="8188822">,</span>&nbsp;<span class="builtintype" id="8188824">true</span><span class="op" id="8188828">}</span><span class="op" id="8188829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188832">{</span><span class="ident" id="8188833">ctxtAndroid</span><span class="op" id="8188844">,</span>&nbsp;<span class="string" id="8188846">&#34;amd64.s&#34;</span><span class="op" id="8188855">,</span>&nbsp;<span class="string" id="8188857">&#34;&#34;</span><span class="op" id="8188859">,</span>&nbsp;<span class="builtintype" id="8188861">true</span><span class="op" id="8188865">}</span><span class="op" id="8188866">,</span><br>
<span class="lineno">195</span><span class="op" id="8188868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188871">func</span>&nbsp;<span class="ident" id="8188876">TestMatchFile</span><span class="op" id="8188889">(</span><span class="ident" id="8188890">t</span>&nbsp;<span class="op" id="8188892">*</span><span class="ident" id="8188893">testing</span><span class="op" id="8188900">.</span><span class="ident" id="8188901">T</span><span class="op" id="8188902">)</span>&nbsp;<span class="op" id="8188904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188907">for</span>&nbsp;<span class="ident" id="8188911">_</span><span class="op" id="8188912">,</span>&nbsp;<span class="ident" id="8188914">tt</span>&nbsp;<span class="op" id="8188917">:=</span>&nbsp;<span class="keyword" id="8188920">range</span>&nbsp;<span class="ident" id="8188926">matchFileTests</span>&nbsp;<span class="op" id="8188941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188945">ctxt</span>&nbsp;<span class="op" id="8188950">:=</span>&nbsp;<span class="ident" id="8188953">tt</span><span class="op" id="8188955">.</span><span class="ident" id="8188956">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188963">ctxt</span><span class="op" id="8188967">.</span><span class="ident" id="8188968">OpenFile</span>&nbsp;<span class="op" id="8188977">=</span>&nbsp;<span class="keyword" id="8188979">func</span><span class="op" id="8188983">(</span><span class="ident" id="8188984">path</span>&nbsp;<span class="builtintype" id="8188989">string</span><span class="op" id="8188995">)</span>&nbsp;<span class="op" id="8188997">(</span><span class="ident" id="8188998">r</span>&nbsp;<span class="ident" id="8189000">io</span><span class="op" id="8189002">.</span><span class="ident" id="8189003">ReadCloser</span><span class="op" id="8189013">,</span>&nbsp;<span class="ident" id="8189015">err</span>&nbsp;<span class="builtintype" id="8189019">error</span><span class="op" id="8189024">)</span>&nbsp;<span class="op" id="8189026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189031">if</span>&nbsp;<span class="ident" id="8189034">path</span>&nbsp;<span class="op" id="8189039">!=</span>&nbsp;<span class="string" id="8189042">&#34;x+&#34;</span><span class="op" id="8189046">+</span><span class="ident" id="8189047">tt</span><span class="op" id="8189049">.</span><span class="ident" id="8189050">name</span>&nbsp;<span class="op" id="8189055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189061">t</span><span class="op" id="8189062">.</span><span class="ident" id="8189063">Fatalf</span><span class="op" id="8189069">(</span><span class="string" id="8189070">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8189106">,</span>&nbsp;<span class="ident" id="8189108">path</span><span class="op" id="8189112">,</span>&nbsp;<span class="string" id="8189114">&#34;x+&#34;</span><span class="op" id="8189118">+</span><span class="ident" id="8189119">tt</span><span class="op" id="8189121">.</span><span class="ident" id="8189122">name</span><span class="op" id="8189126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189136">return</span>&nbsp;<span class="op" id="8189143">&amp;</span><span class="ident" id="8189144">readNopCloser</span><span class="op" id="8189157">{</span><span class="ident" id="8189158">strings</span><span class="op" id="8189165">.</span><span class="ident" id="8189166">NewReader</span><span class="op" id="8189175">(</span><span class="ident" id="8189176">tt</span><span class="op" id="8189178">.</span><span class="ident" id="8189179">data</span><span class="op" id="8189183">)</span><span class="op" id="8189184">}</span><span class="op" id="8189185">,</span>&nbsp;<span class="ident" id="8189187">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189197">ctxt</span><span class="op" id="8189201">.</span><span class="ident" id="8189202">JoinPath</span>&nbsp;<span class="op" id="8189211">=</span>&nbsp;<span class="keyword" id="8189213">func</span><span class="op" id="8189217">(</span><span class="ident" id="8189218">elem</span>&nbsp;<span class="op" id="8189223">...</span><span class="builtintype" id="8189226">string</span><span class="op" id="8189232">)</span>&nbsp;<span class="builtintype" id="8189234">string</span>&nbsp;<span class="op" id="8189241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189246">return</span>&nbsp;<span class="ident" id="8189253">strings</span><span class="op" id="8189260">.</span><span class="ident" id="8189261">Join</span><span class="op" id="8189265">(</span><span class="ident" id="8189266">elem</span><span class="op" id="8189270">,</span>&nbsp;<span class="string" id="8189272">&#34;+&#34;</span><span class="op" id="8189275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189283">match</span><span class="op" id="8189288">,</span>&nbsp;<span class="ident" id="8189290">err</span>&nbsp;<span class="op" id="8189294">:=</span>&nbsp;<span class="ident" id="8189297">ctxt</span><span class="op" id="8189301">.</span><span class="ident" id="8189302">MatchFile</span><span class="op" id="8189311">(</span><span class="string" id="8189312">&#34;x&#34;</span><span class="op" id="8189315">,</span>&nbsp;<span class="ident" id="8189317">tt</span><span class="op" id="8189319">.</span><span class="ident" id="8189320">name</span><span class="op" id="8189324">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189328">if</span>&nbsp;<span class="ident" id="8189331">match</span>&nbsp;<span class="op" id="8189337">!=</span>&nbsp;<span class="ident" id="8189340">tt</span><span class="op" id="8189342">.</span><span class="ident" id="8189343">match</span>&nbsp;<span class="op" id="8189349">||</span>&nbsp;<span class="ident" id="8189352">err</span>&nbsp;<span class="op" id="8189356">!=</span>&nbsp;<span class="ident" id="8189359">nil</span>&nbsp;<span class="op" id="8189363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189368">t</span><span class="op" id="8189369">.</span><span class="ident" id="8189370">Fatalf</span><span class="op" id="8189376">(</span><span class="string" id="8189377">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="8189415">,</span>&nbsp;<span class="ident" id="8189417">tt</span><span class="op" id="8189419">.</span><span class="ident" id="8189420">name</span><span class="op" id="8189424">,</span>&nbsp;<span class="ident" id="8189426">match</span><span class="op" id="8189431">,</span>&nbsp;<span class="ident" id="8189433">err</span><span class="op" id="8189436">,</span>&nbsp;<span class="ident" id="8189438">tt</span><span class="op" id="8189440">.</span><span class="ident" id="8189441">match</span><span class="op" id="8189446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189453">}</span><br>
<span class="lineno"></span><span class="op" id="8189455">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="8189458">func</span>&nbsp;<span class="ident" id="8189463">TestImportCmd</span><span class="op" id="8189476">(</span><span class="ident" id="8189477">t</span>&nbsp;<span class="op" id="8189479">*</span><span class="ident" id="8189480">testing</span><span class="op" id="8189487">.</span><span class="ident" id="8189488">T</span><span class="op" id="8189489">)</span>&nbsp;<span class="op" id="8189491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189494">p</span><span class="op" id="8189495">,</span>&nbsp;<span class="ident" id="8189497">err</span>&nbsp;<span class="op" id="8189501">:=</span>&nbsp;<span class="ident" id="8189504">Import</span><span class="op" id="8189510">(</span><span class="string" id="8189511">&#34;cmd/internal/objfile&#34;</span><span class="op" id="8189533">,</span>&nbsp;<span class="string" id="8189535">&#34;&#34;</span><span class="op" id="8189537">,</span>&nbsp;<span class="num" id="8189539">0</span><span class="op" id="8189540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189543">if</span>&nbsp;<span class="ident" id="8189546">err</span>&nbsp;<span class="op" id="8189550">!=</span>&nbsp;<span class="ident" id="8189553">nil</span>&nbsp;<span class="op" id="8189557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189561">t</span><span class="op" id="8189562">.</span><span class="ident" id="8189563">Fatal</span><span class="op" id="8189568">(</span><span class="ident" id="8189569">err</span><span class="op" id="8189572">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8189578">if</span>&nbsp;<span class="op" id="8189581">!</span><span class="ident" id="8189582">strings</span><span class="op" id="8189589">.</span><span class="ident" id="8189590">HasSuffix</span><span class="op" id="8189599">(</span><span class="ident" id="8189600">filepath</span><span class="op" id="8189608">.</span><span class="ident" id="8189609">ToSlash</span><span class="op" id="8189616">(</span><span class="ident" id="8189617">p</span><span class="op" id="8189618">.</span><span class="ident" id="8189619">Dir</span><span class="op" id="8189622">)</span><span class="op" id="8189623">,</span>&nbsp;<span class="string" id="8189625">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="8189651">)</span>&nbsp;<span class="op" id="8189653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8189657">t</span><span class="op" id="8189658">.</span><span class="ident" id="8189659">Fatalf</span><span class="op" id="8189665">(</span><span class="string" id="8189666">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8189720">,</span>&nbsp;<span class="ident" id="8189722">filepath</span><span class="op" id="8189730">.</span><span class="ident" id="8189731">ToSlash</span><span class="op" id="8189738">(</span><span class="ident" id="8189739">p</span><span class="op" id="8189740">.</span><span class="ident" id="8189741">Dir</span><span class="op" id="8189744">)</span><span class="op" id="8189745">,</span>&nbsp;<span class="string" id="8189747">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="8189777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8189780">}</span><br>
<span class="lineno"></span><span class="op" id="8189782">}</span>
</div>
</body>
</html>
