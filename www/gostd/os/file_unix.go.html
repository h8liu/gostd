<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2341854">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2341909">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2341963">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2342014">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2342084">package</span>&nbsp;<span class="ident" id="2342092">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2342096">import</span>&nbsp;<span class="op" id="2342103">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2342106">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2342117">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2342132">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2342142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2342145">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2342189">type</span>&nbsp;<span class="ident" id="2342194">File</span>&nbsp;<span class="keyword" id="2342199">struct</span>&nbsp;<span class="op" id="2342206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342209">*</span><span class="ident" id="2342210">file</span><br>
<span class="lineno"></span><span class="op" id="2342215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2342218">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2342263">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2342327">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2342387">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2342426">type</span>&nbsp;<span class="ident" id="2342431">file</span>&nbsp;<span class="keyword" id="2342436">struct</span>&nbsp;<span class="op" id="2342443">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342446">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2342454">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342459">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2342467">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342475">dirinfo</span>&nbsp;<span class="op" id="2342483">*</span><span class="ident" id="2342484">dirInfo</span>&nbsp;<span class="comment" id="2342492">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342528">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2342536">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2342545">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2342585">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2342588">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2342662">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2342750">func</span>&nbsp;<span class="op" id="2342755">(</span><span class="ident" id="2342756">f</span>&nbsp;<span class="op" id="2342758">*</span><span class="ident" id="2342759">File</span><span class="op" id="2342763">)</span>&nbsp;<span class="ident" id="2342765">Fd</span><span class="op" id="2342767">(</span><span class="op" id="2342768">)</span>&nbsp;<span class="builtintype" id="2342770">uintptr</span>&nbsp;<span class="op" id="2342778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342781">if</span>&nbsp;<span class="ident" id="2342784">f</span>&nbsp;<span class="op" id="2342786">==</span>&nbsp;<span class="ident" id="2342789">nil</span>&nbsp;<span class="op" id="2342793">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342797">return</span>&nbsp;<span class="op" id="2342804">^</span><span class="op" id="2342805">(</span><span class="builtintype" id="2342806">uintptr</span><span class="op" id="2342813">(</span><span class="num" id="2342814">0</span><span class="op" id="2342815">)</span><span class="op" id="2342816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342822">return</span>&nbsp;<span class="builtintype" id="2342829">uintptr</span><span class="op" id="2342836">(</span><span class="ident" id="2342837">f</span><span class="op" id="2342838">.</span><span class="ident" id="2342839">fd</span><span class="op" id="2342841">)</span><br>
<span class="lineno"></span><span class="op" id="2342843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2342846">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2342917">func</span>&nbsp;<span class="ident" id="2342922">NewFile</span><span class="op" id="2342929">(</span><span class="ident" id="2342930">fd</span>&nbsp;<span class="builtintype" id="2342933">uintptr</span><span class="op" id="2342940">,</span>&nbsp;<span class="ident" id="2342942">name</span>&nbsp;<span class="builtintype" id="2342947">string</span><span class="op" id="2342953">)</span>&nbsp;<span class="op" id="2342955">*</span><span class="ident" id="2342956">File</span>&nbsp;<span class="op" id="2342961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342964">fdi</span>&nbsp;<span class="op" id="2342968">:=</span>&nbsp;<span class="builtintype" id="2342971">int</span><span class="op" id="2342974">(</span><span class="ident" id="2342975">fd</span><span class="op" id="2342977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342980">if</span>&nbsp;<span class="ident" id="2342983">fdi</span>&nbsp;<span class="op" id="2342987">&lt;</span>&nbsp;<span class="num" id="2342989">0</span>&nbsp;<span class="op" id="2342991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342995">return</span>&nbsp;<span class="ident" id="2343002">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343010">f</span>&nbsp;<span class="op" id="2343012">:=</span>&nbsp;<span class="op" id="2343015">&amp;</span><span class="ident" id="2343016">File</span><span class="op" id="2343020">{</span><span class="op" id="2343021">&amp;</span><span class="ident" id="2343022">file</span><span class="op" id="2343026">{</span><span class="ident" id="2343027">fd</span><span class="op" id="2343029">:</span>&nbsp;<span class="ident" id="2343031">fdi</span><span class="op" id="2343034">,</span>&nbsp;<span class="ident" id="2343036">name</span><span class="op" id="2343040">:</span>&nbsp;<span class="ident" id="2343042">name</span><span class="op" id="2343046">}</span><span class="op" id="2343047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343050">runtime</span><span class="op" id="2343057">.</span><span class="ident" id="2343058">SetFinalizer</span><span class="op" id="2343070">(</span><span class="ident" id="2343071">f</span><span class="op" id="2343072">.</span><span class="ident" id="2343073">file</span><span class="op" id="2343077">,</span>&nbsp;<span class="op" id="2343079">(</span><span class="op" id="2343080">*</span><span class="ident" id="2343081">file</span><span class="op" id="2343085">)</span><span class="op" id="2343086">.</span><span class="builtinfunc" id="2343087">close</span><span class="op" id="2343092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343095">return</span>&nbsp;<span class="ident" id="2343102">f</span><br>
<span class="lineno"></span><span class="op" id="2343104">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2343107">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2343166">type</span>&nbsp;<span class="ident" id="2343171">dirInfo</span>&nbsp;<span class="keyword" id="2343179">struct</span>&nbsp;<span class="op" id="2343186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343189">buf</span>&nbsp;&nbsp;<span class="op" id="2343194">[</span><span class="op" id="2343195">]</span><span class="builtintype" id="2343196">byte</span>&nbsp;<span class="comment" id="2343201">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343230">nbuf</span>&nbsp;<span class="builtintype" id="2343235">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2343242">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343293">bufp</span>&nbsp;<span class="builtintype" id="2343298">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2343305">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2343340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2343343">func</span>&nbsp;<span class="ident" id="2343348">epipecheck</span><span class="op" id="2343358">(</span><span class="ident" id="2343359">file</span>&nbsp;<span class="op" id="2343364">*</span><span class="ident" id="2343365">File</span><span class="op" id="2343369">,</span>&nbsp;<span class="ident" id="2343371">e</span>&nbsp;<span class="builtintype" id="2343373">error</span><span class="op" id="2343378">)</span>&nbsp;<span class="op" id="2343380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343383">if</span>&nbsp;<span class="ident" id="2343386">e</span>&nbsp;<span class="op" id="2343388">==</span>&nbsp;<span class="ident" id="2343391">syscall</span><span class="op" id="2343398">.</span><span class="ident" id="2343399">EPIPE</span>&nbsp;<span class="op" id="2343405">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343409">if</span>&nbsp;<span class="ident" id="2343412">atomic</span><span class="op" id="2343418">.</span><span class="ident" id="2343419">AddInt32</span><span class="op" id="2343427">(</span><span class="op" id="2343428">&amp;</span><span class="ident" id="2343429">file</span><span class="op" id="2343433">.</span><span class="ident" id="2343434">nepipe</span><span class="op" id="2343440">,</span>&nbsp;<span class="num" id="2343442">1</span><span class="op" id="2343443">)</span>&nbsp;<span class="op" id="2343445">&gt;=</span>&nbsp;<span class="num" id="2343448">10</span>&nbsp;<span class="op" id="2343451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343456">sigpipe</span><span class="op" id="2343463">(</span><span class="op" id="2343464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343471">}</span>&nbsp;<span class="keyword" id="2343473">else</span>&nbsp;<span class="op" id="2343478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343482">atomic</span><span class="op" id="2343488">.</span><span class="ident" id="2343489">StoreInt32</span><span class="op" id="2343499">(</span><span class="op" id="2343500">&amp;</span><span class="ident" id="2343501">file</span><span class="op" id="2343505">.</span><span class="ident" id="2343506">nepipe</span><span class="op" id="2343512">,</span>&nbsp;<span class="num" id="2343514">0</span><span class="op" id="2343515">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343518">}</span><br>
<span class="lineno"></span><span class="op" id="2343520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2343523">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2343589">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2343652">const</span>&nbsp;<span class="ident" id="2343658">DevNull</span>&nbsp;<span class="op" id="2343666">=</span>&nbsp;<span class="string" id="2343668">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2343681">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2343748">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2343815">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2343887">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2343940">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2343996">func</span>&nbsp;<span class="ident" id="2344001">OpenFile</span><span class="op" id="2344009">(</span><span class="ident" id="2344010">name</span>&nbsp;<span class="builtintype" id="2344015">string</span><span class="op" id="2344021">,</span>&nbsp;<span class="ident" id="2344023">flag</span>&nbsp;<span class="builtintype" id="2344028">int</span><span class="op" id="2344031">,</span>&nbsp;<span class="ident" id="2344033">perm</span>&nbsp;<span class="ident" id="2344038">FileMode</span><span class="op" id="2344046">)</span>&nbsp;<span class="op" id="2344048">(</span><span class="ident" id="2344049">file</span>&nbsp;<span class="op" id="2344054">*</span><span class="ident" id="2344055">File</span><span class="op" id="2344059">,</span>&nbsp;<span class="ident" id="2344061">err</span>&nbsp;<span class="builtintype" id="2344065">error</span><span class="op" id="2344070">)</span>&nbsp;<span class="op" id="2344072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344075">r</span><span class="op" id="2344076">,</span>&nbsp;<span class="ident" id="2344078">e</span>&nbsp;<span class="op" id="2344080">:=</span>&nbsp;<span class="ident" id="2344083">syscall</span><span class="op" id="2344090">.</span><span class="ident" id="2344091">Open</span><span class="op" id="2344095">(</span><span class="ident" id="2344096">name</span><span class="op" id="2344100">,</span>&nbsp;<span class="ident" id="2344102">flag</span><span class="op" id="2344106">|</span><span class="ident" id="2344107">syscall</span><span class="op" id="2344114">.</span><span class="ident" id="2344115">O_CLOEXEC</span><span class="op" id="2344124">,</span>&nbsp;<span class="ident" id="2344126">syscallMode</span><span class="op" id="2344137">(</span><span class="ident" id="2344138">perm</span><span class="op" id="2344142">)</span><span class="op" id="2344143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344146">if</span>&nbsp;<span class="ident" id="2344149">e</span>&nbsp;<span class="op" id="2344151">!=</span>&nbsp;<span class="ident" id="2344154">nil</span>&nbsp;<span class="op" id="2344158">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344162">return</span>&nbsp;<span class="ident" id="2344169">nil</span><span class="op" id="2344172">,</span>&nbsp;<span class="op" id="2344174">&amp;</span><span class="ident" id="2344175">PathError</span><span class="op" id="2344184">{</span><span class="string" id="2344185">&#34;open&#34;</span><span class="op" id="2344191">,</span>&nbsp;<span class="ident" id="2344193">name</span><span class="op" id="2344197">,</span>&nbsp;<span class="ident" id="2344199">e</span><span class="op" id="2344200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344207">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344260">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344316">if</span>&nbsp;<span class="op" id="2344319">!</span><span class="ident" id="2344320">supportsCloseOnExec</span>&nbsp;<span class="op" id="2344340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344344">syscall</span><span class="op" id="2344351">.</span><span class="ident" id="2344352">CloseOnExec</span><span class="op" id="2344363">(</span><span class="ident" id="2344364">r</span><span class="op" id="2344365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344372">return</span>&nbsp;<span class="ident" id="2344379">NewFile</span><span class="op" id="2344386">(</span><span class="builtintype" id="2344387">uintptr</span><span class="op" id="2344394">(</span><span class="ident" id="2344395">r</span><span class="op" id="2344396">)</span><span class="op" id="2344397">,</span>&nbsp;<span class="ident" id="2344399">name</span><span class="op" id="2344403">)</span><span class="op" id="2344404">,</span>&nbsp;<span class="ident" id="2344406">nil</span><br>
<span class="lineno">90</span><span class="op" id="2344410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2344413">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2344470">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2344502">func</span>&nbsp;<span class="op" id="2344507">(</span><span class="ident" id="2344508">f</span>&nbsp;<span class="op" id="2344510">*</span><span class="ident" id="2344511">File</span><span class="op" id="2344515">)</span>&nbsp;<span class="ident" id="2344517">Close</span><span class="op" id="2344522">(</span><span class="op" id="2344523">)</span>&nbsp;<span class="builtintype" id="2344525">error</span>&nbsp;<span class="op" id="2344531">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344534">if</span>&nbsp;<span class="ident" id="2344537">f</span>&nbsp;<span class="op" id="2344539">==</span>&nbsp;<span class="ident" id="2344542">nil</span>&nbsp;<span class="op" id="2344546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344550">return</span>&nbsp;<span class="ident" id="2344557">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344572">return</span>&nbsp;<span class="ident" id="2344579">f</span><span class="op" id="2344580">.</span><span class="ident" id="2344581">file</span><span class="op" id="2344585">.</span><span class="builtinfunc" id="2344586">close</span><span class="op" id="2344591">(</span><span class="op" id="2344592">)</span><br>
<span class="lineno"></span><span class="op" id="2344594">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2344597">func</span>&nbsp;<span class="op" id="2344602">(</span><span class="ident" id="2344603">file</span>&nbsp;<span class="op" id="2344608">*</span><span class="ident" id="2344609">file</span><span class="op" id="2344613">)</span>&nbsp;<span class="builtinfunc" id="2344615">close</span><span class="op" id="2344620">(</span><span class="op" id="2344621">)</span>&nbsp;<span class="builtintype" id="2344623">error</span>&nbsp;<span class="op" id="2344629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344632">if</span>&nbsp;<span class="ident" id="2344635">file</span>&nbsp;<span class="op" id="2344640">==</span>&nbsp;<span class="ident" id="2344643">nil</span>&nbsp;<span class="op" id="2344647">||</span>&nbsp;<span class="ident" id="2344650">file</span><span class="op" id="2344654">.</span><span class="ident" id="2344655">fd</span>&nbsp;<span class="op" id="2344658">&lt;</span>&nbsp;<span class="num" id="2344660">0</span>&nbsp;<span class="op" id="2344662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344666">return</span>&nbsp;<span class="ident" id="2344673">syscall</span><span class="op" id="2344680">.</span><span class="ident" id="2344681">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344689">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344692">var</span>&nbsp;<span class="ident" id="2344696">err</span>&nbsp;<span class="builtintype" id="2344700">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344707">if</span>&nbsp;<span class="ident" id="2344710">e</span>&nbsp;<span class="op" id="2344712">:=</span>&nbsp;<span class="ident" id="2344715">syscall</span><span class="op" id="2344722">.</span><span class="ident" id="2344723">Close</span><span class="op" id="2344728">(</span><span class="ident" id="2344729">file</span><span class="op" id="2344733">.</span><span class="ident" id="2344734">fd</span><span class="op" id="2344736">)</span><span class="op" id="2344737">;</span>&nbsp;<span class="ident" id="2344739">e</span>&nbsp;<span class="op" id="2344741">!=</span>&nbsp;<span class="ident" id="2344744">nil</span>&nbsp;<span class="op" id="2344748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344752">err</span>&nbsp;<span class="op" id="2344756">=</span>&nbsp;<span class="op" id="2344758">&amp;</span><span class="ident" id="2344759">PathError</span><span class="op" id="2344768">{</span><span class="string" id="2344769">&#34;close&#34;</span><span class="op" id="2344776">,</span>&nbsp;<span class="ident" id="2344778">file</span><span class="op" id="2344782">.</span><span class="ident" id="2344783">name</span><span class="op" id="2344787">,</span>&nbsp;<span class="ident" id="2344789">e</span><span class="op" id="2344790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344796">file</span><span class="op" id="2344800">.</span><span class="ident" id="2344801">fd</span>&nbsp;<span class="op" id="2344804">=</span>&nbsp;<span class="op" id="2344806">-</span><span class="num" id="2344807">1</span>&nbsp;<span class="comment" id="2344809">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2344842">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344878">runtime</span><span class="op" id="2344885">.</span><span class="ident" id="2344886">SetFinalizer</span><span class="op" id="2344898">(</span><span class="ident" id="2344899">file</span><span class="op" id="2344903">,</span>&nbsp;<span class="ident" id="2344905">nil</span><span class="op" id="2344908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344911">return</span>&nbsp;<span class="ident" id="2344918">err</span><br>
<span class="lineno"></span><span class="op" id="2344922">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2344925">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2344981">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2345037">func</span>&nbsp;<span class="op" id="2345042">(</span><span class="ident" id="2345043">f</span>&nbsp;<span class="op" id="2345045">*</span><span class="ident" id="2345046">File</span><span class="op" id="2345050">)</span>&nbsp;<span class="ident" id="2345052">Stat</span><span class="op" id="2345056">(</span><span class="op" id="2345057">)</span>&nbsp;<span class="op" id="2345059">(</span><span class="ident" id="2345060">fi</span>&nbsp;<span class="ident" id="2345063">FileInfo</span><span class="op" id="2345071">,</span>&nbsp;<span class="ident" id="2345073">err</span>&nbsp;<span class="builtintype" id="2345077">error</span><span class="op" id="2345082">)</span>&nbsp;<span class="op" id="2345084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345087">if</span>&nbsp;<span class="ident" id="2345090">f</span>&nbsp;<span class="op" id="2345092">==</span>&nbsp;<span class="ident" id="2345095">nil</span>&nbsp;<span class="op" id="2345099">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345103">return</span>&nbsp;<span class="ident" id="2345110">nil</span><span class="op" id="2345113">,</span>&nbsp;<span class="ident" id="2345115">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345130">var</span>&nbsp;<span class="ident" id="2345134">stat</span>&nbsp;<span class="ident" id="2345139">syscall</span><span class="op" id="2345146">.</span><span class="ident" id="2345147">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345155">err</span>&nbsp;<span class="op" id="2345159">=</span>&nbsp;<span class="ident" id="2345161">syscall</span><span class="op" id="2345168">.</span><span class="ident" id="2345169">Fstat</span><span class="op" id="2345174">(</span><span class="ident" id="2345175">f</span><span class="op" id="2345176">.</span><span class="ident" id="2345177">fd</span><span class="op" id="2345179">,</span>&nbsp;<span class="op" id="2345181">&amp;</span><span class="ident" id="2345182">stat</span><span class="op" id="2345186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345189">if</span>&nbsp;<span class="ident" id="2345192">err</span>&nbsp;<span class="op" id="2345196">!=</span>&nbsp;<span class="ident" id="2345199">nil</span>&nbsp;<span class="op" id="2345203">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345207">return</span>&nbsp;<span class="ident" id="2345214">nil</span><span class="op" id="2345217">,</span>&nbsp;<span class="op" id="2345219">&amp;</span><span class="ident" id="2345220">PathError</span><span class="op" id="2345229">{</span><span class="string" id="2345230">&#34;stat&#34;</span><span class="op" id="2345236">,</span>&nbsp;<span class="ident" id="2345238">f</span><span class="op" id="2345239">.</span><span class="ident" id="2345240">name</span><span class="op" id="2345244">,</span>&nbsp;<span class="ident" id="2345246">err</span><span class="op" id="2345249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345255">return</span>&nbsp;<span class="ident" id="2345262">fileInfoFromStat</span><span class="op" id="2345278">(</span><span class="op" id="2345279">&amp;</span><span class="ident" id="2345280">stat</span><span class="op" id="2345284">,</span>&nbsp;<span class="ident" id="2345286">f</span><span class="op" id="2345287">.</span><span class="ident" id="2345288">name</span><span class="op" id="2345292">)</span><span class="op" id="2345293">,</span>&nbsp;<span class="ident" id="2345295">nil</span><br>
<span class="lineno"></span><span class="op" id="2345299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2345302">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2345356">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2345412">func</span>&nbsp;<span class="ident" id="2345417">Stat</span><span class="op" id="2345421">(</span><span class="ident" id="2345422">name</span>&nbsp;<span class="builtintype" id="2345427">string</span><span class="op" id="2345433">)</span>&nbsp;<span class="op" id="2345435">(</span><span class="ident" id="2345436">fi</span>&nbsp;<span class="ident" id="2345439">FileInfo</span><span class="op" id="2345447">,</span>&nbsp;<span class="ident" id="2345449">err</span>&nbsp;<span class="builtintype" id="2345453">error</span><span class="op" id="2345458">)</span>&nbsp;<span class="op" id="2345460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345463">var</span>&nbsp;<span class="ident" id="2345467">stat</span>&nbsp;<span class="ident" id="2345472">syscall</span><span class="op" id="2345479">.</span><span class="ident" id="2345480">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345488">err</span>&nbsp;<span class="op" id="2345492">=</span>&nbsp;<span class="ident" id="2345494">syscall</span><span class="op" id="2345501">.</span><span class="ident" id="2345502">Stat</span><span class="op" id="2345506">(</span><span class="ident" id="2345507">name</span><span class="op" id="2345511">,</span>&nbsp;<span class="op" id="2345513">&amp;</span><span class="ident" id="2345514">stat</span><span class="op" id="2345518">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345521">if</span>&nbsp;<span class="ident" id="2345524">err</span>&nbsp;<span class="op" id="2345528">!=</span>&nbsp;<span class="ident" id="2345531">nil</span>&nbsp;<span class="op" id="2345535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345539">return</span>&nbsp;<span class="ident" id="2345546">nil</span><span class="op" id="2345549">,</span>&nbsp;<span class="op" id="2345551">&amp;</span><span class="ident" id="2345552">PathError</span><span class="op" id="2345561">{</span><span class="string" id="2345562">&#34;stat&#34;</span><span class="op" id="2345568">,</span>&nbsp;<span class="ident" id="2345570">name</span><span class="op" id="2345574">,</span>&nbsp;<span class="ident" id="2345576">err</span><span class="op" id="2345579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2345582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345585">return</span>&nbsp;<span class="ident" id="2345592">fileInfoFromStat</span><span class="op" id="2345608">(</span><span class="op" id="2345609">&amp;</span><span class="ident" id="2345610">stat</span><span class="op" id="2345614">,</span>&nbsp;<span class="ident" id="2345616">name</span><span class="op" id="2345620">)</span><span class="op" id="2345621">,</span>&nbsp;<span class="ident" id="2345623">nil</span><br>
<span class="lineno"></span><span class="op" id="2345627">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2345630">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2345685">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2345742">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2345818">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2345874">func</span>&nbsp;<span class="ident" id="2345879">Lstat</span><span class="op" id="2345884">(</span><span class="ident" id="2345885">name</span>&nbsp;<span class="builtintype" id="2345890">string</span><span class="op" id="2345896">)</span>&nbsp;<span class="op" id="2345898">(</span><span class="ident" id="2345899">fi</span>&nbsp;<span class="ident" id="2345902">FileInfo</span><span class="op" id="2345910">,</span>&nbsp;<span class="ident" id="2345912">err</span>&nbsp;<span class="builtintype" id="2345916">error</span><span class="op" id="2345921">)</span>&nbsp;<span class="op" id="2345923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345926">var</span>&nbsp;<span class="ident" id="2345930">stat</span>&nbsp;<span class="ident" id="2345935">syscall</span><span class="op" id="2345942">.</span><span class="ident" id="2345943">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2345951">err</span>&nbsp;<span class="op" id="2345955">=</span>&nbsp;<span class="ident" id="2345957">syscall</span><span class="op" id="2345964">.</span><span class="ident" id="2345965">Lstat</span><span class="op" id="2345970">(</span><span class="ident" id="2345971">name</span><span class="op" id="2345975">,</span>&nbsp;<span class="op" id="2345977">&amp;</span><span class="ident" id="2345978">stat</span><span class="op" id="2345982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2345985">if</span>&nbsp;<span class="ident" id="2345988">err</span>&nbsp;<span class="op" id="2345992">!=</span>&nbsp;<span class="ident" id="2345995">nil</span>&nbsp;<span class="op" id="2345999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346003">return</span>&nbsp;<span class="ident" id="2346010">nil</span><span class="op" id="2346013">,</span>&nbsp;<span class="op" id="2346015">&amp;</span><span class="ident" id="2346016">PathError</span><span class="op" id="2346025">{</span><span class="string" id="2346026">&#34;lstat&#34;</span><span class="op" id="2346033">,</span>&nbsp;<span class="ident" id="2346035">name</span><span class="op" id="2346039">,</span>&nbsp;<span class="ident" id="2346041">err</span><span class="op" id="2346044">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346050">return</span>&nbsp;<span class="ident" id="2346057">fileInfoFromStat</span><span class="op" id="2346073">(</span><span class="op" id="2346074">&amp;</span><span class="ident" id="2346075">stat</span><span class="op" id="2346079">,</span>&nbsp;<span class="ident" id="2346081">name</span><span class="op" id="2346085">)</span><span class="op" id="2346086">,</span>&nbsp;<span class="ident" id="2346088">nil</span><br>
<span class="lineno"></span><span class="op" id="2346092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2346095">func</span>&nbsp;<span class="op" id="2346100">(</span><span class="ident" id="2346101">f</span>&nbsp;<span class="op" id="2346103">*</span><span class="ident" id="2346104">File</span><span class="op" id="2346108">)</span>&nbsp;<span class="ident" id="2346110">readdir</span><span class="op" id="2346117">(</span><span class="ident" id="2346118">n</span>&nbsp;<span class="builtintype" id="2346120">int</span><span class="op" id="2346123">)</span>&nbsp;<span class="op" id="2346125">(</span><span class="ident" id="2346126">fi</span>&nbsp;<span class="op" id="2346129">[</span><span class="op" id="2346130">]</span><span class="ident" id="2346131">FileInfo</span><span class="op" id="2346139">,</span>&nbsp;<span class="ident" id="2346141">err</span>&nbsp;<span class="builtintype" id="2346145">error</span><span class="op" id="2346150">)</span>&nbsp;<span class="op" id="2346152">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346155">dirname</span>&nbsp;<span class="op" id="2346163">:=</span>&nbsp;<span class="ident" id="2346166">f</span><span class="op" id="2346167">.</span><span class="ident" id="2346168">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346174">if</span>&nbsp;<span class="ident" id="2346177">dirname</span>&nbsp;<span class="op" id="2346185">==</span>&nbsp;<span class="string" id="2346188">&#34;&#34;</span>&nbsp;<span class="op" id="2346191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346195">dirname</span>&nbsp;<span class="op" id="2346203">=</span>&nbsp;<span class="string" id="2346205">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346213">names</span><span class="op" id="2346218">,</span>&nbsp;<span class="ident" id="2346220">err</span>&nbsp;<span class="op" id="2346224">:=</span>&nbsp;<span class="ident" id="2346227">f</span><span class="op" id="2346228">.</span><span class="ident" id="2346229">Readdirnames</span><span class="op" id="2346241">(</span><span class="ident" id="2346242">n</span><span class="op" id="2346243">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346246">fi</span>&nbsp;<span class="op" id="2346249">=</span>&nbsp;<span class="builtinfunc" id="2346251">make</span><span class="op" id="2346255">(</span><span class="op" id="2346256">[</span><span class="op" id="2346257">]</span><span class="ident" id="2346258">FileInfo</span><span class="op" id="2346266">,</span>&nbsp;<span class="num" id="2346268">0</span><span class="op" id="2346269">,</span>&nbsp;<span class="builtinfunc" id="2346271">len</span><span class="op" id="2346274">(</span><span class="ident" id="2346275">names</span><span class="op" id="2346280">)</span><span class="op" id="2346281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346284">for</span>&nbsp;<span class="ident" id="2346288">_</span><span class="op" id="2346289">,</span>&nbsp;<span class="ident" id="2346291">filename</span>&nbsp;<span class="op" id="2346300">:=</span>&nbsp;<span class="keyword" id="2346303">range</span>&nbsp;<span class="ident" id="2346309">names</span>&nbsp;<span class="op" id="2346315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346319">fip</span><span class="op" id="2346322">,</span>&nbsp;<span class="ident" id="2346324">lerr</span>&nbsp;<span class="op" id="2346329">:=</span>&nbsp;<span class="ident" id="2346332">lstat</span><span class="op" id="2346337">(</span><span class="ident" id="2346338">dirname</span>&nbsp;<span class="op" id="2346346">+</span>&nbsp;<span class="string" id="2346348">&#34;/&#34;</span>&nbsp;<span class="op" id="2346352">+</span>&nbsp;<span class="ident" id="2346354">filename</span><span class="op" id="2346362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346366">if</span>&nbsp;<span class="ident" id="2346369">IsNotExist</span><span class="op" id="2346379">(</span><span class="ident" id="2346380">lerr</span><span class="op" id="2346384">)</span>&nbsp;<span class="op" id="2346386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2346391">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2346438">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346481">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346496">if</span>&nbsp;<span class="ident" id="2346499">lerr</span>&nbsp;<span class="op" id="2346504">!=</span>&nbsp;<span class="ident" id="2346507">nil</span>&nbsp;<span class="op" id="2346511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346516">return</span>&nbsp;<span class="ident" id="2346523">fi</span><span class="op" id="2346525">,</span>&nbsp;<span class="ident" id="2346527">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346538">fi</span>&nbsp;<span class="op" id="2346541">=</span>&nbsp;<span class="builtinfunc" id="2346543">append</span><span class="op" id="2346549">(</span><span class="ident" id="2346550">fi</span><span class="op" id="2346552">,</span>&nbsp;<span class="ident" id="2346554">fip</span><span class="op" id="2346557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2346560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2346563">return</span>&nbsp;<span class="ident" id="2346570">fi</span><span class="op" id="2346572">,</span>&nbsp;<span class="ident" id="2346574">err</span><br>
<span class="lineno"></span><span class="op" id="2346578">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2346581">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2346639">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2346693">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2346747">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2346765">const</span>&nbsp;<span class="op" id="2346771">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346774">needsMaxRW</span>&nbsp;<span class="op" id="2346785">=</span>&nbsp;<span class="ident" id="2346787">runtime</span><span class="op" id="2346794">.</span><span class="ident" id="2346795">GOOS</span>&nbsp;<span class="op" id="2346800">==</span>&nbsp;<span class="string" id="2346803">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2346812">||</span>&nbsp;<span class="ident" id="2346815">runtime</span><span class="op" id="2346822">.</span><span class="ident" id="2346823">GOOS</span>&nbsp;<span class="op" id="2346828">==</span>&nbsp;<span class="string" id="2346831">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2346842">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2346853">=</span>&nbsp;<span class="num" id="2346855">1</span>&nbsp;<span class="op" id="2346857">&lt;&lt;</span>&nbsp;<span class="num" id="2346860">30</span><br>
<span class="lineno"></span><span class="op" id="2346863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2346866">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2346914">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2346975">func</span>&nbsp;<span class="op" id="2346980">(</span><span class="ident" id="2346981">f</span>&nbsp;<span class="op" id="2346983">*</span><span class="ident" id="2346984">File</span><span class="op" id="2346988">)</span>&nbsp;<span class="ident" id="2346990">read</span><span class="op" id="2346994">(</span><span class="ident" id="2346995">b</span>&nbsp;<span class="op" id="2346997">[</span><span class="op" id="2346998">]</span><span class="builtintype" id="2346999">byte</span><span class="op" id="2347003">)</span>&nbsp;<span class="op" id="2347005">(</span><span class="ident" id="2347006">n</span>&nbsp;<span class="builtintype" id="2347008">int</span><span class="op" id="2347011">,</span>&nbsp;<span class="ident" id="2347013">err</span>&nbsp;<span class="builtintype" id="2347017">error</span><span class="op" id="2347022">)</span>&nbsp;<span class="op" id="2347024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347027">if</span>&nbsp;<span class="ident" id="2347030">needsMaxRW</span>&nbsp;<span class="op" id="2347041">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2347044">len</span><span class="op" id="2347047">(</span><span class="ident" id="2347048">b</span><span class="op" id="2347049">)</span>&nbsp;<span class="op" id="2347051">&gt;</span>&nbsp;<span class="ident" id="2347053">maxRW</span>&nbsp;<span class="op" id="2347059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347063">b</span>&nbsp;<span class="op" id="2347065">=</span>&nbsp;<span class="ident" id="2347067">b</span><span class="op" id="2347068">[</span><span class="op" id="2347069">:</span><span class="ident" id="2347070">maxRW</span><span class="op" id="2347075">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347081">return</span>&nbsp;<span class="ident" id="2347088">fixCount</span><span class="op" id="2347096">(</span><span class="ident" id="2347097">syscall</span><span class="op" id="2347104">.</span><span class="ident" id="2347105">Read</span><span class="op" id="2347109">(</span><span class="ident" id="2347110">f</span><span class="op" id="2347111">.</span><span class="ident" id="2347112">fd</span><span class="op" id="2347114">,</span>&nbsp;<span class="ident" id="2347116">b</span><span class="op" id="2347117">)</span><span class="op" id="2347118">)</span><br>
<span class="lineno"></span><span class="op" id="2347120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2347123">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2347194">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2347256">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2347312">func</span>&nbsp;<span class="op" id="2347317">(</span><span class="ident" id="2347318">f</span>&nbsp;<span class="op" id="2347320">*</span><span class="ident" id="2347321">File</span><span class="op" id="2347325">)</span>&nbsp;<span class="ident" id="2347327">pread</span><span class="op" id="2347332">(</span><span class="ident" id="2347333">b</span>&nbsp;<span class="op" id="2347335">[</span><span class="op" id="2347336">]</span><span class="builtintype" id="2347337">byte</span><span class="op" id="2347341">,</span>&nbsp;<span class="ident" id="2347343">off</span>&nbsp;<span class="ident" id="2347347">int64</span><span class="op" id="2347352">)</span>&nbsp;<span class="op" id="2347354">(</span><span class="ident" id="2347355">n</span>&nbsp;<span class="builtintype" id="2347357">int</span><span class="op" id="2347360">,</span>&nbsp;<span class="ident" id="2347362">err</span>&nbsp;<span class="builtintype" id="2347366">error</span><span class="op" id="2347371">)</span>&nbsp;<span class="op" id="2347373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347376">if</span>&nbsp;<span class="ident" id="2347379">needsMaxRW</span>&nbsp;<span class="op" id="2347390">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2347393">len</span><span class="op" id="2347396">(</span><span class="ident" id="2347397">b</span><span class="op" id="2347398">)</span>&nbsp;<span class="op" id="2347400">&gt;</span>&nbsp;<span class="ident" id="2347402">maxRW</span>&nbsp;<span class="op" id="2347408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347412">b</span>&nbsp;<span class="op" id="2347414">=</span>&nbsp;<span class="ident" id="2347416">b</span><span class="op" id="2347417">[</span><span class="op" id="2347418">:</span><span class="ident" id="2347419">maxRW</span><span class="op" id="2347424">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347430">return</span>&nbsp;<span class="ident" id="2347437">fixCount</span><span class="op" id="2347445">(</span><span class="ident" id="2347446">syscall</span><span class="op" id="2347453">.</span><span class="ident" id="2347454">Pread</span><span class="op" id="2347459">(</span><span class="ident" id="2347460">f</span><span class="op" id="2347461">.</span><span class="ident" id="2347462">fd</span><span class="op" id="2347464">,</span>&nbsp;<span class="ident" id="2347466">b</span><span class="op" id="2347467">,</span>&nbsp;<span class="ident" id="2347469">off</span><span class="op" id="2347472">)</span><span class="op" id="2347473">)</span><br>
<span class="lineno"></span><span class="op" id="2347475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2347478">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2347520">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2347584">func</span>&nbsp;<span class="op" id="2347589">(</span><span class="ident" id="2347590">f</span>&nbsp;<span class="op" id="2347592">*</span><span class="ident" id="2347593">File</span><span class="op" id="2347597">)</span>&nbsp;<span class="ident" id="2347599">write</span><span class="op" id="2347604">(</span><span class="ident" id="2347605">b</span>&nbsp;<span class="op" id="2347607">[</span><span class="op" id="2347608">]</span><span class="builtintype" id="2347609">byte</span><span class="op" id="2347613">)</span>&nbsp;<span class="op" id="2347615">(</span><span class="ident" id="2347616">n</span>&nbsp;<span class="builtintype" id="2347618">int</span><span class="op" id="2347621">,</span>&nbsp;<span class="ident" id="2347623">err</span>&nbsp;<span class="builtintype" id="2347627">error</span><span class="op" id="2347632">)</span>&nbsp;<span class="op" id="2347634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347637">for</span>&nbsp;<span class="op" id="2347641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347645">bcap</span>&nbsp;<span class="op" id="2347650">:=</span>&nbsp;<span class="ident" id="2347653">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347657">if</span>&nbsp;<span class="ident" id="2347660">needsMaxRW</span>&nbsp;<span class="op" id="2347671">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2347674">len</span><span class="op" id="2347677">(</span><span class="ident" id="2347678">bcap</span><span class="op" id="2347682">)</span>&nbsp;<span class="op" id="2347684">&gt;</span>&nbsp;<span class="ident" id="2347686">maxRW</span>&nbsp;<span class="op" id="2347692">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347697">bcap</span>&nbsp;<span class="op" id="2347702">=</span>&nbsp;<span class="ident" id="2347704">bcap</span><span class="op" id="2347708">[</span><span class="op" id="2347709">:</span><span class="ident" id="2347710">maxRW</span><span class="op" id="2347715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2347719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347723">m</span><span class="op" id="2347724">,</span>&nbsp;<span class="ident" id="2347726">err</span>&nbsp;<span class="op" id="2347730">:=</span>&nbsp;<span class="ident" id="2347733">fixCount</span><span class="op" id="2347741">(</span><span class="ident" id="2347742">syscall</span><span class="op" id="2347749">.</span><span class="ident" id="2347750">Write</span><span class="op" id="2347755">(</span><span class="ident" id="2347756">f</span><span class="op" id="2347757">.</span><span class="ident" id="2347758">fd</span><span class="op" id="2347760">,</span>&nbsp;<span class="ident" id="2347762">bcap</span><span class="op" id="2347766">)</span><span class="op" id="2347767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2347771">n</span>&nbsp;<span class="op" id="2347773">+=</span>&nbsp;<span class="ident" id="2347776">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2347781">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2347843">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2347903">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2347969">if</span>&nbsp;<span class="num" id="2347972">0</span>&nbsp;<span class="op" id="2347974">&lt;</span>&nbsp;<span class="ident" id="2347976">m</span>&nbsp;<span class="op" id="2347978">&amp;&amp;</span>&nbsp;<span class="ident" id="2347981">m</span>&nbsp;<span class="op" id="2347983">&lt;</span>&nbsp;<span class="builtinfunc" id="2347985">len</span><span class="op" id="2347988">(</span><span class="ident" id="2347989">bcap</span><span class="op" id="2347993">)</span>&nbsp;<span class="op" id="2347995">||</span>&nbsp;<span class="ident" id="2347998">err</span>&nbsp;<span class="op" id="2348002">==</span>&nbsp;<span class="ident" id="2348005">syscall</span><span class="op" id="2348012">.</span><span class="ident" id="2348013">EINTR</span>&nbsp;<span class="op" id="2348019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348024">b</span>&nbsp;<span class="op" id="2348026">=</span>&nbsp;<span class="ident" id="2348028">b</span><span class="op" id="2348029">[</span><span class="ident" id="2348030">m</span><span class="op" id="2348031">:</span><span class="op" id="2348032">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348037">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348053">if</span>&nbsp;<span class="ident" id="2348056">needsMaxRW</span>&nbsp;<span class="op" id="2348067">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2348070">len</span><span class="op" id="2348073">(</span><span class="ident" id="2348074">bcap</span><span class="op" id="2348078">)</span>&nbsp;<span class="op" id="2348080">!=</span>&nbsp;<span class="builtinfunc" id="2348083">len</span><span class="op" id="2348086">(</span><span class="ident" id="2348087">b</span><span class="op" id="2348088">)</span>&nbsp;<span class="op" id="2348090">&amp;&amp;</span>&nbsp;<span class="ident" id="2348093">err</span>&nbsp;<span class="op" id="2348097">==</span>&nbsp;<span class="ident" id="2348100">nil</span>&nbsp;<span class="op" id="2348104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348109">b</span>&nbsp;<span class="op" id="2348111">=</span>&nbsp;<span class="ident" id="2348113">b</span><span class="op" id="2348114">[</span><span class="ident" id="2348115">m</span><span class="op" id="2348116">:</span><span class="op" id="2348117">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348122">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348138">return</span>&nbsp;<span class="ident" id="2348145">n</span><span class="op" id="2348146">,</span>&nbsp;<span class="ident" id="2348148">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348153">}</span><br>
<span class="lineno">230</span><span class="op" id="2348155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348158">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2348229">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2348293">func</span>&nbsp;<span class="op" id="2348298">(</span><span class="ident" id="2348299">f</span>&nbsp;<span class="op" id="2348301">*</span><span class="ident" id="2348302">File</span><span class="op" id="2348306">)</span>&nbsp;<span class="ident" id="2348308">pwrite</span><span class="op" id="2348314">(</span><span class="ident" id="2348315">b</span>&nbsp;<span class="op" id="2348317">[</span><span class="op" id="2348318">]</span><span class="builtintype" id="2348319">byte</span><span class="op" id="2348323">,</span>&nbsp;<span class="ident" id="2348325">off</span>&nbsp;<span class="ident" id="2348329">int64</span><span class="op" id="2348334">)</span>&nbsp;<span class="op" id="2348336">(</span><span class="ident" id="2348337">n</span>&nbsp;<span class="builtintype" id="2348339">int</span><span class="op" id="2348342">,</span>&nbsp;<span class="ident" id="2348344">err</span>&nbsp;<span class="builtintype" id="2348348">error</span><span class="op" id="2348353">)</span>&nbsp;<span class="op" id="2348355">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348358">if</span>&nbsp;<span class="ident" id="2348361">needsMaxRW</span>&nbsp;<span class="op" id="2348372">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2348375">len</span><span class="op" id="2348378">(</span><span class="ident" id="2348379">b</span><span class="op" id="2348380">)</span>&nbsp;<span class="op" id="2348382">&gt;</span>&nbsp;<span class="ident" id="2348384">maxRW</span>&nbsp;<span class="op" id="2348390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2348394">b</span>&nbsp;<span class="op" id="2348396">=</span>&nbsp;<span class="ident" id="2348398">b</span><span class="op" id="2348399">[</span><span class="op" id="2348400">:</span><span class="ident" id="2348401">maxRW</span><span class="op" id="2348406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2348409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348412">return</span>&nbsp;<span class="ident" id="2348419">fixCount</span><span class="op" id="2348427">(</span><span class="ident" id="2348428">syscall</span><span class="op" id="2348435">.</span><span class="ident" id="2348436">Pwrite</span><span class="op" id="2348442">(</span><span class="ident" id="2348443">f</span><span class="op" id="2348444">.</span><span class="ident" id="2348445">fd</span><span class="op" id="2348447">,</span>&nbsp;<span class="ident" id="2348449">b</span><span class="op" id="2348450">,</span>&nbsp;<span class="ident" id="2348452">off</span><span class="op" id="2348455">)</span><span class="op" id="2348456">)</span><br>
<span class="lineno"></span><span class="op" id="2348458">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2348461">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2348543">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2348619">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2348687">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2348738">func</span>&nbsp;<span class="op" id="2348743">(</span><span class="ident" id="2348744">f</span>&nbsp;<span class="op" id="2348746">*</span><span class="ident" id="2348747">File</span><span class="op" id="2348751">)</span>&nbsp;<span class="ident" id="2348753">seek</span><span class="op" id="2348757">(</span><span class="ident" id="2348758">offset</span>&nbsp;<span class="ident" id="2348765">int64</span><span class="op" id="2348770">,</span>&nbsp;<span class="ident" id="2348772">whence</span>&nbsp;<span class="builtintype" id="2348779">int</span><span class="op" id="2348782">)</span>&nbsp;<span class="op" id="2348784">(</span><span class="ident" id="2348785">ret</span>&nbsp;<span class="ident" id="2348789">int64</span><span class="op" id="2348794">,</span>&nbsp;<span class="ident" id="2348796">err</span>&nbsp;<span class="builtintype" id="2348800">error</span><span class="op" id="2348805">)</span>&nbsp;<span class="op" id="2348807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2348810">return</span>&nbsp;<span class="ident" id="2348817">syscall</span><span class="op" id="2348824">.</span><span class="ident" id="2348825">Seek</span><span class="op" id="2348829">(</span><span class="ident" id="2348830">f</span><span class="op" id="2348831">.</span><span class="ident" id="2348832">fd</span><span class="op" id="2348834">,</span>&nbsp;<span class="ident" id="2348836">offset</span><span class="op" id="2348842">,</span>&nbsp;<span class="ident" id="2348844">whence</span><span class="op" id="2348850">)</span><br>
<span class="lineno"></span><span class="op" id="2348852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2348855">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2348903">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2348980">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2349036">func</span>&nbsp;<span class="ident" id="2349041">Truncate</span><span class="op" id="2349049">(</span><span class="ident" id="2349050">name</span>&nbsp;<span class="builtintype" id="2349055">string</span><span class="op" id="2349061">,</span>&nbsp;<span class="ident" id="2349063">size</span>&nbsp;<span class="ident" id="2349068">int64</span><span class="op" id="2349073">)</span>&nbsp;<span class="builtintype" id="2349075">error</span>&nbsp;<span class="op" id="2349081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349084">if</span>&nbsp;<span class="ident" id="2349087">e</span>&nbsp;<span class="op" id="2349089">:=</span>&nbsp;<span class="ident" id="2349092">syscall</span><span class="op" id="2349099">.</span><span class="ident" id="2349100">Truncate</span><span class="op" id="2349108">(</span><span class="ident" id="2349109">name</span><span class="op" id="2349113">,</span>&nbsp;<span class="ident" id="2349115">size</span><span class="op" id="2349119">)</span><span class="op" id="2349120">;</span>&nbsp;<span class="ident" id="2349122">e</span>&nbsp;<span class="op" id="2349124">!=</span>&nbsp;<span class="ident" id="2349127">nil</span>&nbsp;<span class="op" id="2349131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349135">return</span>&nbsp;<span class="op" id="2349142">&amp;</span><span class="ident" id="2349143">PathError</span><span class="op" id="2349152">{</span><span class="string" id="2349153">&#34;truncate&#34;</span><span class="op" id="2349163">,</span>&nbsp;<span class="ident" id="2349165">name</span><span class="op" id="2349169">,</span>&nbsp;<span class="ident" id="2349171">e</span><span class="op" id="2349172">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349178">return</span>&nbsp;<span class="ident" id="2349185">nil</span><br>
<span class="lineno"></span><span class="op" id="2349189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2349192">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2349239">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2349295">func</span>&nbsp;<span class="ident" id="2349300">Remove</span><span class="op" id="2349306">(</span><span class="ident" id="2349307">name</span>&nbsp;<span class="builtintype" id="2349312">string</span><span class="op" id="2349318">)</span>&nbsp;<span class="builtintype" id="2349320">error</span>&nbsp;<span class="op" id="2349326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349329">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349373">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349414">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349458">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349495">e</span>&nbsp;<span class="op" id="2349497">:=</span>&nbsp;<span class="ident" id="2349500">syscall</span><span class="op" id="2349507">.</span><span class="ident" id="2349508">Unlink</span><span class="op" id="2349514">(</span><span class="ident" id="2349515">name</span><span class="op" id="2349519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349522">if</span>&nbsp;<span class="ident" id="2349525">e</span>&nbsp;<span class="op" id="2349527">==</span>&nbsp;<span class="ident" id="2349530">nil</span>&nbsp;<span class="op" id="2349534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349538">return</span>&nbsp;<span class="ident" id="2349545">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349550">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2349553">e1</span>&nbsp;<span class="op" id="2349556">:=</span>&nbsp;<span class="ident" id="2349559">syscall</span><span class="op" id="2349566">.</span><span class="ident" id="2349567">Rmdir</span><span class="op" id="2349572">(</span><span class="ident" id="2349573">name</span><span class="op" id="2349577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349580">if</span>&nbsp;<span class="ident" id="2349583">e1</span>&nbsp;<span class="op" id="2349586">==</span>&nbsp;<span class="ident" id="2349589">nil</span>&nbsp;<span class="op" id="2349593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2349597">return</span>&nbsp;<span class="ident" id="2349604">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2349609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349613">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349664">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349713">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349762">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349811">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349865">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349916">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2349971">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350020">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350051">if</span>&nbsp;<span class="ident" id="2350054">e1</span>&nbsp;<span class="op" id="2350057">!=</span>&nbsp;<span class="ident" id="2350060">syscall</span><span class="op" id="2350067">.</span><span class="ident" id="2350068">ENOTDIR</span>&nbsp;<span class="op" id="2350076">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350080">e</span>&nbsp;<span class="op" id="2350082">=</span>&nbsp;<span class="ident" id="2350084">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350091">return</span>&nbsp;<span class="op" id="2350098">&amp;</span><span class="ident" id="2350099">PathError</span><span class="op" id="2350108">{</span><span class="string" id="2350109">&#34;remove&#34;</span><span class="op" id="2350117">,</span>&nbsp;<span class="ident" id="2350119">name</span><span class="op" id="2350123">,</span>&nbsp;<span class="ident" id="2350125">e</span><span class="op" id="2350126">}</span><br>
<span class="lineno"></span><span class="op" id="2350128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2350131">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2350214">func</span>&nbsp;<span class="ident" id="2350219">basename</span><span class="op" id="2350227">(</span><span class="ident" id="2350228">name</span>&nbsp;<span class="builtintype" id="2350233">string</span><span class="op" id="2350239">)</span>&nbsp;<span class="builtintype" id="2350241">string</span>&nbsp;<span class="op" id="2350248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350251">i</span>&nbsp;<span class="op" id="2350253">:=</span>&nbsp;<span class="builtinfunc" id="2350256">len</span><span class="op" id="2350259">(</span><span class="ident" id="2350260">name</span><span class="op" id="2350264">)</span>&nbsp;<span class="op" id="2350266">-</span>&nbsp;<span class="num" id="2350268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350271">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350299">for</span>&nbsp;<span class="op" id="2350303">;</span>&nbsp;<span class="ident" id="2350305">i</span>&nbsp;<span class="op" id="2350307">&gt;</span>&nbsp;<span class="num" id="2350309">0</span>&nbsp;<span class="op" id="2350311">&amp;&amp;</span>&nbsp;<span class="ident" id="2350314">name</span><span class="op" id="2350318">[</span><span class="ident" id="2350319">i</span><span class="op" id="2350320">]</span>&nbsp;<span class="op" id="2350322">==</span>&nbsp;<span class="string" id="2350325">&#39;/&#39;</span><span class="op" id="2350328">;</span>&nbsp;<span class="ident" id="2350330">i</span><span class="op" id="2350331">--</span>&nbsp;<span class="op" id="2350334">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350338">name</span>&nbsp;<span class="op" id="2350343">=</span>&nbsp;<span class="ident" id="2350345">name</span><span class="op" id="2350349">[</span><span class="op" id="2350350">:</span><span class="ident" id="2350351">i</span><span class="op" id="2350352">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350358">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350392">for</span>&nbsp;<span class="ident" id="2350396">i</span><span class="op" id="2350397">--</span><span class="op" id="2350399">;</span>&nbsp;<span class="ident" id="2350401">i</span>&nbsp;<span class="op" id="2350403">&gt;=</span>&nbsp;<span class="num" id="2350406">0</span><span class="op" id="2350407">;</span>&nbsp;<span class="ident" id="2350409">i</span><span class="op" id="2350410">--</span>&nbsp;<span class="op" id="2350413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350417">if</span>&nbsp;<span class="ident" id="2350420">name</span><span class="op" id="2350424">[</span><span class="ident" id="2350425">i</span><span class="op" id="2350426">]</span>&nbsp;<span class="op" id="2350428">==</span>&nbsp;<span class="string" id="2350431">&#39;/&#39;</span>&nbsp;<span class="op" id="2350435">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350440">name</span>&nbsp;<span class="op" id="2350445">=</span>&nbsp;<span class="ident" id="2350447">name</span><span class="op" id="2350451">[</span><span class="ident" id="2350452">i</span><span class="op" id="2350453">+</span><span class="num" id="2350454">1</span><span class="op" id="2350455">:</span><span class="op" id="2350456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350461">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350476">return</span>&nbsp;<span class="ident" id="2350483">name</span><br>
<span class="lineno"></span><span class="op" id="2350488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2350491">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2350560">func</span>&nbsp;<span class="ident" id="2350565">TempDir</span><span class="op" id="2350572">(</span><span class="op" id="2350573">)</span>&nbsp;<span class="builtintype" id="2350575">string</span>&nbsp;<span class="op" id="2350582">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350585">dir</span>&nbsp;<span class="op" id="2350589">:=</span>&nbsp;<span class="ident" id="2350592">Getenv</span><span class="op" id="2350598">(</span><span class="string" id="2350599">&#34;TMPDIR&#34;</span><span class="op" id="2350607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350610">if</span>&nbsp;<span class="ident" id="2350613">dir</span>&nbsp;<span class="op" id="2350617">==</span>&nbsp;<span class="string" id="2350620">&#34;&#34;</span>&nbsp;<span class="op" id="2350623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350627">if</span>&nbsp;<span class="ident" id="2350630">runtime</span><span class="op" id="2350637">.</span><span class="ident" id="2350638">GOOS</span>&nbsp;<span class="op" id="2350643">==</span>&nbsp;<span class="string" id="2350646">&#34;android&#34;</span>&nbsp;<span class="op" id="2350656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350661">dir</span>&nbsp;<span class="op" id="2350665">=</span>&nbsp;<span class="string" id="2350667">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350687">}</span>&nbsp;<span class="keyword" id="2350689">else</span>&nbsp;<span class="op" id="2350694">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350699">dir</span>&nbsp;<span class="op" id="2350703">=</span>&nbsp;<span class="string" id="2350705">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350720">return</span>&nbsp;<span class="ident" id="2350727">dir</span><br>
<span class="lineno"></span><span class="op" id="2350731">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2350734">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2350794">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2350850">func</span>&nbsp;<span class="ident" id="2350855">Link</span><span class="op" id="2350859">(</span><span class="ident" id="2350860">oldname</span><span class="op" id="2350867">,</span>&nbsp;<span class="ident" id="2350869">newname</span>&nbsp;<span class="builtintype" id="2350877">string</span><span class="op" id="2350883">)</span>&nbsp;<span class="builtintype" id="2350885">error</span>&nbsp;<span class="op" id="2350891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350894">e</span>&nbsp;<span class="op" id="2350896">:=</span>&nbsp;<span class="ident" id="2350899">syscall</span><span class="op" id="2350906">.</span><span class="ident" id="2350907">Link</span><span class="op" id="2350911">(</span><span class="ident" id="2350912">oldname</span><span class="op" id="2350919">,</span>&nbsp;<span class="ident" id="2350921">newname</span><span class="op" id="2350928">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350931">if</span>&nbsp;<span class="ident" id="2350934">e</span>&nbsp;<span class="op" id="2350936">!=</span>&nbsp;<span class="ident" id="2350939">nil</span>&nbsp;<span class="op" id="2350943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350947">return</span>&nbsp;<span class="op" id="2350954">&amp;</span><span class="ident" id="2350955">LinkError</span><span class="op" id="2350964">{</span><span class="string" id="2350965">&#34;link&#34;</span><span class="op" id="2350971">,</span>&nbsp;<span class="ident" id="2350973">oldname</span><span class="op" id="2350980">,</span>&nbsp;<span class="ident" id="2350982">newname</span><span class="op" id="2350989">,</span>&nbsp;<span class="ident" id="2350991">e</span><span class="op" id="2350992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2350995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350998">return</span>&nbsp;<span class="ident" id="2351005">nil</span><br>
<span class="lineno"></span><span class="op" id="2351009">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2351012">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2351070">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2351126">func</span>&nbsp;<span class="ident" id="2351131">Symlink</span><span class="op" id="2351138">(</span><span class="ident" id="2351139">oldname</span><span class="op" id="2351146">,</span>&nbsp;<span class="ident" id="2351148">newname</span>&nbsp;<span class="builtintype" id="2351156">string</span><span class="op" id="2351162">)</span>&nbsp;<span class="builtintype" id="2351164">error</span>&nbsp;<span class="op" id="2351170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351173">e</span>&nbsp;<span class="op" id="2351175">:=</span>&nbsp;<span class="ident" id="2351178">syscall</span><span class="op" id="2351185">.</span><span class="ident" id="2351186">Symlink</span><span class="op" id="2351193">(</span><span class="ident" id="2351194">oldname</span><span class="op" id="2351201">,</span>&nbsp;<span class="ident" id="2351203">newname</span><span class="op" id="2351210">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351213">if</span>&nbsp;<span class="ident" id="2351216">e</span>&nbsp;<span class="op" id="2351218">!=</span>&nbsp;<span class="ident" id="2351221">nil</span>&nbsp;<span class="op" id="2351225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351229">return</span>&nbsp;<span class="op" id="2351236">&amp;</span><span class="ident" id="2351237">LinkError</span><span class="op" id="2351246">{</span><span class="string" id="2351247">&#34;symlink&#34;</span><span class="op" id="2351256">,</span>&nbsp;<span class="ident" id="2351258">oldname</span><span class="op" id="2351265">,</span>&nbsp;<span class="ident" id="2351267">newname</span><span class="op" id="2351274">,</span>&nbsp;<span class="ident" id="2351276">e</span><span class="op" id="2351277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351283">return</span>&nbsp;<span class="ident" id="2351290">nil</span><br>
<span class="lineno"></span><span class="op" id="2351294">}</span>
</div>
</body>
</html>
