<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5447846">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5447902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5447956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5448007">package</span>&nbsp;<span class="ident" id="5448015">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448023">import</span>&nbsp;<span class="op" id="5448030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5448033">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5448041">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5448052">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5448063">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5448078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5448081">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5448143">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5448182">type</span>&nbsp;<span class="ident" id="5448187">Error</span>&nbsp;<span class="keyword" id="5448193">struct</span>&nbsp;<span class="op" id="5448200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448203">Code</span>&nbsp;<span class="ident" id="5448208"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448219">Expr</span>&nbsp;<span class="builtintype" id="5448224">string</span><br>
<span class="lineno"></span><span class="op" id="5448231">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5448234">func</span>&nbsp;<span class="op" id="5448239">(</span><span class="ident" id="5448240">e</span>&nbsp;<span class="op" id="5448242">*</span><span class="ident" id="5448243"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5448248">)</span>&nbsp;<span class="ident" id="5448250">Error</span><span class="op" id="5448255">(</span><span class="op" id="5448256">)</span>&nbsp;<span class="builtintype" id="5448258">string</span>&nbsp;<span class="op" id="5448265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448268">return</span>&nbsp;<span class="string" id="5448275">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5448300">+</span>&nbsp;<span class="ident" id="5448302"><a href="/regexp/syntax/parse.go.html#5448240">e</a></span><span class="op" id="5448303">.</span><span class="ident" id="5448304">Code</span><span class="op" id="5448308">.</span><span class="ident" id="5448309">String</span><span class="op" id="5448315">(</span><span class="op" id="5448316">)</span>&nbsp;<span class="op" id="5448318">+</span>&nbsp;<span class="string" id="5448320">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5448326">+</span>&nbsp;<span class="ident" id="5448328"><a href="/regexp/syntax/parse.go.html#5448240">e</a></span><span class="op" id="5448329">.</span><span class="ident" id="5448330">Expr</span>&nbsp;<span class="op" id="5448335">+</span>&nbsp;<span class="string" id="5448337">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5448341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5448344">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5448411">type</span>&nbsp;<span class="ident" id="5448416">ErrorCode</span>&nbsp;<span class="builtintype" id="5448426">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448434">const</span>&nbsp;<span class="op" id="5448440">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448443">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448464">ErrInternalError</span>&nbsp;<span class="ident" id="5448481"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448491">=</span>&nbsp;<span class="string" id="5448493">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448527">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448544">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448569"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448579">=</span>&nbsp;<span class="string" id="5448581">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448608">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448633"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448643">=</span>&nbsp;<span class="string" id="5448645">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448678">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448703"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448713">=</span>&nbsp;<span class="string" id="5448715">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448742">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5448767"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448777">=</span>&nbsp;<span class="string" id="5448779">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448804">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448829"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448839">=</span>&nbsp;<span class="string" id="5448841">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448879">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448904"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448914">=</span>&nbsp;<span class="string" id="5448916">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448954">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448979"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5448989">=</span>&nbsp;<span class="string" id="5448991">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449015">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449040"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449050">=</span>&nbsp;<span class="string" id="5449052">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449069">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449094"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449104">=</span>&nbsp;<span class="string" id="5449106">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449127">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449152"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449162">=</span>&nbsp;<span class="string" id="5449164">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449185">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5449210"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449220">=</span>&nbsp;<span class="string" id="5449222">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449265">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449290"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449300">=</span>&nbsp;<span class="string" id="5449302">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449345">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449370"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span>&nbsp;<span class="op" id="5449380">=</span>&nbsp;<span class="string" id="5449382">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5449397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449400">func</span>&nbsp;<span class="op" id="5449405">(</span><span class="ident" id="5449406">e</span>&nbsp;<span class="ident" id="5449408"><a href="/regexp/syntax/parse.go.html#5448416">ErrorCode</a></span><span class="op" id="5449417">)</span>&nbsp;<span class="ident" id="5449419">String</span><span class="op" id="5449425">(</span><span class="op" id="5449426">)</span>&nbsp;<span class="builtintype" id="5449428">string</span>&nbsp;<span class="op" id="5449435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449438">return</span>&nbsp;<span class="builtintype" id="5449445">string</span><span class="op" id="5449451">(</span><span class="ident" id="5449452"><a href="/regexp/syntax/parse.go.html#5449406">e</a></span><span class="op" id="5449453">)</span><br>
<span class="lineno">50</span><span class="op" id="5449455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5449458">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5449547">type</span>&nbsp;<span class="ident" id="5449552">Flags</span>&nbsp;<span class="builtintype" id="5449558">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5449566">const</span>&nbsp;<span class="op" id="5449572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449575">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449589"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span>&nbsp;<span class="op" id="5449595">=</span>&nbsp;<span class="num" id="5449597">1</span>&nbsp;<span class="op" id="5449599">&lt;&lt;</span>&nbsp;<span class="ident" id="5449602">iota</span>&nbsp;<span class="comment" id="5449607">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449634">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449666">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449702">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449734">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449807">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449839">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449868">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449900">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449964">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449996">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450048">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450080">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450106">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450138">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450196">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450228">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450263">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450295">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450338">MatchNL</span>&nbsp;<span class="op" id="5450346">=</span>&nbsp;<span class="ident" id="5450348"><a href="/regexp/syntax/parse.go.html#5449702">ClassNL</a></span>&nbsp;<span class="op" id="5450356">|</span>&nbsp;<span class="ident" id="5450358"><a href="/regexp/syntax/parse.go.html#5449807">DotNL</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450366">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450378">=</span>&nbsp;<span class="ident" id="5450380"><a href="/regexp/syntax/parse.go.html#5449702">ClassNL</a></span>&nbsp;<span class="op" id="5450388">|</span>&nbsp;<span class="ident" id="5450390"><a href="/regexp/syntax/parse.go.html#5449868">OneLine</a></span>&nbsp;<span class="op" id="5450398">|</span>&nbsp;<span class="ident" id="5450400"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5450406">|</span>&nbsp;<span class="ident" id="5450408"><a href="/regexp/syntax/parse.go.html#5450106">UnicodeGroups</a></span>&nbsp;<span class="comment" id="5450422">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450455">POSIX</span>&nbsp;<span class="ident" id="5450461"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span>&nbsp;<span class="op" id="5450467">=</span>&nbsp;<span class="num" id="5450469">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450511">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5450527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450530">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5450563">const</span>&nbsp;<span class="op" id="5450569">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450572">opLeftParen</span>&nbsp;<span class="op" id="5450584">=</span>&nbsp;<span class="ident" id="5450586"><a href="/regexp/syntax/regexp.go.html#5507307">opPseudo</a></span>&nbsp;<span class="op" id="5450595">+</span>&nbsp;<span class="ident" id="5450597">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450603">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5450617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450620">type</span>&nbsp;<span class="ident" id="5450625">parser</span>&nbsp;<span class="keyword" id="5450632">struct</span>&nbsp;<span class="op" id="5450639">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450642">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450654"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450664">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450685">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450697">[</span><span class="op" id="5450698">]</span><span class="op" id="5450699">*</span><span class="ident" id="5450700"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="comment" id="5450707">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450739">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450751">*</span><span class="ident" id="5450752"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450760">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5450772">int</span>&nbsp;<span class="comment" id="5450776">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450812">wholeRegexp</span>&nbsp;<span class="builtintype" id="5450824">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450832">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450844">[</span><span class="op" id="5450845">]</span><span class="builtintype" id="5450846">rune</span>&nbsp;<span class="comment" id="5450851">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5450886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450889">func</span>&nbsp;<span class="op" id="5450894">(</span><span class="ident" id="5450895">p</span>&nbsp;<span class="op" id="5450897">*</span><span class="ident" id="5450898"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5450904">)</span>&nbsp;<span class="ident" id="5450906">newRegexp</span><span class="op" id="5450915">(</span><span class="ident" id="5450916">op</span>&nbsp;<span class="ident" id="5450919"><a href="/regexp/syntax/regexp.go.html#5505750">Op</a></span><span class="op" id="5450921">)</span>&nbsp;<span class="op" id="5450923">*</span><span class="ident" id="5450924"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5450931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450934">re</span>&nbsp;<span class="op" id="5450937">:=</span>&nbsp;<span class="ident" id="5450940"><a href="/regexp/syntax/parse.go.html#5450895">p</a></span><span class="op" id="5450941">.</span><span class="ident" id="5450942">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450948">if</span>&nbsp;<span class="ident" id="5450951"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span>&nbsp;<span class="op" id="5450954">!=</span>&nbsp;<span class="ident" id="5450957">nil</span>&nbsp;<span class="op" id="5450961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450965"><a href="/regexp/syntax/parse.go.html#5450895">p</a></span><span class="op" id="5450966">.</span><span class="ident" id="5450967">free</span>&nbsp;<span class="op" id="5450972">=</span>&nbsp;<span class="ident" id="5450974"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span><span class="op" id="5450976">.</span><span class="ident" id="5450977">Sub0</span><span class="op" id="5450981">[</span><span class="num" id="5450982">0</span><span class="op" id="5450983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450987">*</span><span class="ident" id="5450988"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span>&nbsp;<span class="op" id="5450991">=</span>&nbsp;<span class="ident" id="5450993"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5450999">{</span><span class="op" id="5451000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451003">}</span>&nbsp;<span class="keyword" id="5451005">else</span>&nbsp;<span class="op" id="5451010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451014"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span>&nbsp;<span class="op" id="5451017">=</span>&nbsp;<span class="builtinfunc" id="5451019">new</span><span class="op" id="5451022">(</span><span class="ident" id="5451023"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5451029">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451035"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span><span class="op" id="5451037">.</span><span class="ident" id="5451038">Op</span>&nbsp;<span class="op" id="5451041">=</span>&nbsp;<span class="ident" id="5451043"><a href="/regexp/syntax/parse.go.html#5450916">op</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451047">return</span>&nbsp;<span class="ident" id="5451054"><a href="/regexp/syntax/parse.go.html#5450934">re</a></span><br>
<span class="lineno"></span><span class="op" id="5451057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5451060">func</span>&nbsp;<span class="op" id="5451065">(</span><span class="ident" id="5451066">p</span>&nbsp;<span class="op" id="5451068">*</span><span class="ident" id="5451069"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5451075">)</span>&nbsp;<span class="ident" id="5451077">reuse</span><span class="op" id="5451082">(</span><span class="ident" id="5451083">re</span>&nbsp;<span class="op" id="5451086">*</span><span class="ident" id="5451087"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5451093">)</span>&nbsp;<span class="op" id="5451095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451098"><a href="/regexp/syntax/parse.go.html#5451083">re</a></span><span class="op" id="5451100">.</span><span class="ident" id="5451101">Sub0</span><span class="op" id="5451105">[</span><span class="num" id="5451106">0</span><span class="op" id="5451107">]</span>&nbsp;<span class="op" id="5451109">=</span>&nbsp;<span class="ident" id="5451111"><a href="/regexp/syntax/parse.go.html#5451066">p</a></span><span class="op" id="5451112">.</span><span class="ident" id="5451113">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451119"><a href="/regexp/syntax/parse.go.html#5451066">p</a></span><span class="op" id="5451120">.</span><span class="ident" id="5451121">free</span>&nbsp;<span class="op" id="5451126">=</span>&nbsp;<span class="ident" id="5451128"><a href="/regexp/syntax/parse.go.html#5451083">re</a></span><br>
<span class="lineno"></span><span class="op" id="5451131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5451134">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5451164">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5451238">func</span>&nbsp;<span class="op" id="5451243">(</span><span class="ident" id="5451244">p</span>&nbsp;<span class="op" id="5451246">*</span><span class="ident" id="5451247"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5451253">)</span>&nbsp;<span class="ident" id="5451255">push</span><span class="op" id="5451259">(</span><span class="ident" id="5451260">re</span>&nbsp;<span class="op" id="5451263">*</span><span class="ident" id="5451264"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5451270">)</span>&nbsp;<span class="op" id="5451272">*</span><span class="ident" id="5451273"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5451280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451283">if</span>&nbsp;<span class="ident" id="5451286"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451288">.</span><span class="ident" id="5451289">Op</span>&nbsp;<span class="op" id="5451292">==</span>&nbsp;<span class="ident" id="5451295"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span>&nbsp;<span class="op" id="5451307">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5451310">len</span><span class="op" id="5451313">(</span><span class="ident" id="5451314"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451316">.</span><span class="ident" id="5451317">Rune</span><span class="op" id="5451321">)</span>&nbsp;<span class="op" id="5451323">==</span>&nbsp;<span class="num" id="5451326">2</span>&nbsp;<span class="op" id="5451328">&amp;&amp;</span>&nbsp;<span class="ident" id="5451331"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451333">.</span><span class="ident" id="5451334">Rune</span><span class="op" id="5451338">[</span><span class="num" id="5451339">0</span><span class="op" id="5451340">]</span>&nbsp;<span class="op" id="5451342">==</span>&nbsp;<span class="ident" id="5451345"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451347">.</span><span class="ident" id="5451348">Rune</span><span class="op" id="5451352">[</span><span class="num" id="5451353">1</span><span class="op" id="5451354">]</span>&nbsp;<span class="op" id="5451356">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451360">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451378">if</span>&nbsp;<span class="ident" id="5451381"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5451382">.</span><span class="ident" id="5451383">maybeConcat</span><span class="op" id="5451394">(</span><span class="ident" id="5451395"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451397">.</span><span class="ident" id="5451398">Rune</span><span class="op" id="5451402">[</span><span class="num" id="5451403">0</span><span class="op" id="5451404">]</span><span class="op" id="5451405">,</span>&nbsp;<span class="ident" id="5451407"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5451408">.</span><span class="ident" id="5451409">flags</span><span class="op" id="5451414">&amp;^</span><span class="ident" id="5451416"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><span class="op" id="5451424">)</span>&nbsp;<span class="op" id="5451426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451431">return</span>&nbsp;<span class="ident" id="5451438">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451448"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451450">.</span><span class="ident" id="5451451">Op</span>&nbsp;<span class="op" id="5451454">=</span>&nbsp;<span class="ident" id="5451456"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451468"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451470">.</span><span class="ident" id="5451471">Rune</span>&nbsp;<span class="op" id="5451476">=</span>&nbsp;<span class="ident" id="5451478"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451480">.</span><span class="ident" id="5451481">Rune</span><span class="op" id="5451485">[</span><span class="op" id="5451486">:</span><span class="num" id="5451487">1</span><span class="op" id="5451488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451492"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451494">.</span><span class="ident" id="5451495">Flags</span>&nbsp;<span class="op" id="5451501">=</span>&nbsp;<span class="ident" id="5451503"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5451504">.</span><span class="ident" id="5451505">flags</span>&nbsp;<span class="op" id="5451511">&amp;^</span>&nbsp;<span class="ident" id="5451514"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451524">}</span>&nbsp;<span class="keyword" id="5451526">else</span>&nbsp;<span class="keyword" id="5451531">if</span>&nbsp;<span class="ident" id="5451534"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451536">.</span><span class="ident" id="5451537">Op</span>&nbsp;<span class="op" id="5451540">==</span>&nbsp;<span class="ident" id="5451543"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span>&nbsp;<span class="op" id="5451555">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5451558">len</span><span class="op" id="5451561">(</span><span class="ident" id="5451562"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451564">.</span><span class="ident" id="5451565">Rune</span><span class="op" id="5451569">)</span>&nbsp;<span class="op" id="5451571">==</span>&nbsp;<span class="num" id="5451574">4</span>&nbsp;<span class="op" id="5451576">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451581"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451583">.</span><span class="ident" id="5451584">Rune</span><span class="op" id="5451588">[</span><span class="num" id="5451589">0</span><span class="op" id="5451590">]</span>&nbsp;<span class="op" id="5451592">==</span>&nbsp;<span class="ident" id="5451595"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451597">.</span><span class="ident" id="5451598">Rune</span><span class="op" id="5451602">[</span><span class="num" id="5451603">1</span><span class="op" id="5451604">]</span>&nbsp;<span class="op" id="5451606">&amp;&amp;</span>&nbsp;<span class="ident" id="5451609"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451611">.</span><span class="ident" id="5451612">Rune</span><span class="op" id="5451616">[</span><span class="num" id="5451617">2</span><span class="op" id="5451618">]</span>&nbsp;<span class="op" id="5451620">==</span>&nbsp;<span class="ident" id="5451623"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451625">.</span><span class="ident" id="5451626">Rune</span><span class="op" id="5451630">[</span><span class="num" id="5451631">3</span><span class="op" id="5451632">]</span>&nbsp;<span class="op" id="5451634">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451639"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5451646">.</span><span class="ident" id="5451647">SimpleFold</span><span class="op" id="5451657">(</span><span class="ident" id="5451658"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451660">.</span><span class="ident" id="5451661">Rune</span><span class="op" id="5451665">[</span><span class="num" id="5451666">0</span><span class="op" id="5451667">]</span><span class="op" id="5451668">)</span>&nbsp;<span class="op" id="5451670">==</span>&nbsp;<span class="ident" id="5451673"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451675">.</span><span class="ident" id="5451676">Rune</span><span class="op" id="5451680">[</span><span class="num" id="5451681">2</span><span class="op" id="5451682">]</span>&nbsp;<span class="op" id="5451684">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451689"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5451696">.</span><span class="ident" id="5451697">SimpleFold</span><span class="op" id="5451707">(</span><span class="ident" id="5451708"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451710">.</span><span class="ident" id="5451711">Rune</span><span class="op" id="5451715">[</span><span class="num" id="5451716">2</span><span class="op" id="5451717">]</span><span class="op" id="5451718">)</span>&nbsp;<span class="op" id="5451720">==</span>&nbsp;<span class="ident" id="5451723"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451725">.</span><span class="ident" id="5451726">Rune</span><span class="op" id="5451730">[</span><span class="num" id="5451731">0</span><span class="op" id="5451732">]</span>&nbsp;<span class="op" id="5451734">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451739"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451741">.</span><span class="ident" id="5451742">Op</span>&nbsp;<span class="op" id="5451745">==</span>&nbsp;<span class="ident" id="5451748"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span>&nbsp;<span class="op" id="5451760">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5451763">len</span><span class="op" id="5451766">(</span><span class="ident" id="5451767"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451769">.</span><span class="ident" id="5451770">Rune</span><span class="op" id="5451774">)</span>&nbsp;<span class="op" id="5451776">==</span>&nbsp;<span class="num" id="5451779">2</span>&nbsp;<span class="op" id="5451781">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451787"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451789">.</span><span class="ident" id="5451790">Rune</span><span class="op" id="5451794">[</span><span class="num" id="5451795">0</span><span class="op" id="5451796">]</span><span class="op" id="5451797">+</span><span class="num" id="5451798">1</span>&nbsp;<span class="op" id="5451800">==</span>&nbsp;<span class="ident" id="5451803"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451805">.</span><span class="ident" id="5451806">Rune</span><span class="op" id="5451810">[</span><span class="num" id="5451811">1</span><span class="op" id="5451812">]</span>&nbsp;<span class="op" id="5451814">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451820"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5451827">.</span><span class="ident" id="5451828">SimpleFold</span><span class="op" id="5451838">(</span><span class="ident" id="5451839"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451841">.</span><span class="ident" id="5451842">Rune</span><span class="op" id="5451846">[</span><span class="num" id="5451847">0</span><span class="op" id="5451848">]</span><span class="op" id="5451849">)</span>&nbsp;<span class="op" id="5451851">==</span>&nbsp;<span class="ident" id="5451854"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451856">.</span><span class="ident" id="5451857">Rune</span><span class="op" id="5451861">[</span><span class="num" id="5451862">1</span><span class="op" id="5451863">]</span>&nbsp;<span class="op" id="5451865">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451871"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5451878">.</span><span class="ident" id="5451879">SimpleFold</span><span class="op" id="5451889">(</span><span class="ident" id="5451890"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451892">.</span><span class="ident" id="5451893">Rune</span><span class="op" id="5451897">[</span><span class="num" id="5451898">1</span><span class="op" id="5451899">]</span><span class="op" id="5451900">)</span>&nbsp;<span class="op" id="5451902">==</span>&nbsp;<span class="ident" id="5451905"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451907">.</span><span class="ident" id="5451908">Rune</span><span class="op" id="5451912">[</span><span class="num" id="5451913">0</span><span class="op" id="5451914">]</span>&nbsp;<span class="op" id="5451916">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451920">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451968">if</span>&nbsp;<span class="ident" id="5451971"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5451972">.</span><span class="ident" id="5451973">maybeConcat</span><span class="op" id="5451984">(</span><span class="ident" id="5451985"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5451987">.</span><span class="ident" id="5451988">Rune</span><span class="op" id="5451992">[</span><span class="num" id="5451993">0</span><span class="op" id="5451994">]</span><span class="op" id="5451995">,</span>&nbsp;<span class="ident" id="5451997"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5451998">.</span><span class="ident" id="5451999">flags</span><span class="op" id="5452004">|</span><span class="ident" id="5452005"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><span class="op" id="5452013">)</span>&nbsp;<span class="op" id="5452015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452020">return</span>&nbsp;<span class="ident" id="5452027">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5452038">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452082"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5452084">.</span><span class="ident" id="5452085">Op</span>&nbsp;<span class="op" id="5452088">=</span>&nbsp;<span class="ident" id="5452090"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452102"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5452104">.</span><span class="ident" id="5452105">Rune</span>&nbsp;<span class="op" id="5452110">=</span>&nbsp;<span class="ident" id="5452112"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5452114">.</span><span class="ident" id="5452115">Rune</span><span class="op" id="5452119">[</span><span class="op" id="5452120">:</span><span class="num" id="5452121">1</span><span class="op" id="5452122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452126"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5452128">.</span><span class="ident" id="5452129">Flags</span>&nbsp;<span class="op" id="5452135">=</span>&nbsp;<span class="ident" id="5452137"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5452138">.</span><span class="ident" id="5452139">flags</span>&nbsp;<span class="op" id="5452145">|</span>&nbsp;<span class="ident" id="5452147"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452157">}</span>&nbsp;<span class="keyword" id="5452159">else</span>&nbsp;<span class="op" id="5452164">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5452168">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452200"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5452201">.</span><span class="ident" id="5452202">maybeConcat</span><span class="op" id="5452213">(</span><span class="op" id="5452214">-</span><span class="num" id="5452215">1</span><span class="op" id="5452216">,</span>&nbsp;<span class="num" id="5452218">0</span><span class="op" id="5452219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452226"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5452227">.</span><span class="ident" id="5452228">stack</span>&nbsp;<span class="op" id="5452234">=</span>&nbsp;<span class="builtinfunc" id="5452236">append</span><span class="op" id="5452242">(</span><span class="ident" id="5452243"><a href="/regexp/syntax/parse.go.html#5451244">p</a></span><span class="op" id="5452244">.</span><span class="ident" id="5452245">stack</span><span class="op" id="5452250">,</span>&nbsp;<span class="ident" id="5452252"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><span class="op" id="5452254">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452257">return</span>&nbsp;<span class="ident" id="5452264"><a href="/regexp/syntax/parse.go.html#5451260">re</a></span><br>
<span class="lineno"></span><span class="op" id="5452267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5452270">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5452322">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5452384">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5452443">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5452506">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5452570">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5452612">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5452675">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5452710">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5452755">func</span>&nbsp;<span class="op" id="5452760">(</span><span class="ident" id="5452761">p</span>&nbsp;<span class="op" id="5452763">*</span><span class="ident" id="5452764"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5452770">)</span>&nbsp;<span class="ident" id="5452772">maybeConcat</span><span class="op" id="5452783">(</span><span class="ident" id="5452784">r</span>&nbsp;<span class="builtintype" id="5452786">rune</span><span class="op" id="5452790">,</span>&nbsp;<span class="ident" id="5452792">flags</span>&nbsp;<span class="ident" id="5452798"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5452803">)</span>&nbsp;<span class="builtintype" id="5452805">bool</span>&nbsp;<span class="op" id="5452810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452813">n</span>&nbsp;<span class="op" id="5452815">:=</span>&nbsp;<span class="builtinfunc" id="5452818">len</span><span class="op" id="5452821">(</span><span class="ident" id="5452822"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5452823">.</span><span class="ident" id="5452824">stack</span><span class="op" id="5452829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452832">if</span>&nbsp;<span class="ident" id="5452835"><a href="/regexp/syntax/parse.go.html#5452813">n</a></span>&nbsp;<span class="op" id="5452837">&lt;</span>&nbsp;<span class="num" id="5452839">2</span>&nbsp;<span class="op" id="5452841">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452845">return</span>&nbsp;<span class="builtintype" id="5452852">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452863">re1</span>&nbsp;<span class="op" id="5452867">:=</span>&nbsp;<span class="ident" id="5452870"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5452871">.</span><span class="ident" id="5452872">stack</span><span class="op" id="5452877">[</span><span class="ident" id="5452878"><a href="/regexp/syntax/parse.go.html#5452813">n</a></span><span class="op" id="5452879">-</span><span class="num" id="5452880">1</span><span class="op" id="5452881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452884">re2</span>&nbsp;<span class="op" id="5452888">:=</span>&nbsp;<span class="ident" id="5452891"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5452892">.</span><span class="ident" id="5452893">stack</span><span class="op" id="5452898">[</span><span class="ident" id="5452899"><a href="/regexp/syntax/parse.go.html#5452813">n</a></span><span class="op" id="5452900">-</span><span class="num" id="5452901">2</span><span class="op" id="5452902">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452905">if</span>&nbsp;<span class="ident" id="5452908"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5452911">.</span><span class="ident" id="5452912">Op</span>&nbsp;<span class="op" id="5452915">!=</span>&nbsp;<span class="ident" id="5452918"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5452928">||</span>&nbsp;<span class="ident" id="5452931"><a href="/regexp/syntax/parse.go.html#5452884">re2</a></span><span class="op" id="5452934">.</span><span class="ident" id="5452935">Op</span>&nbsp;<span class="op" id="5452938">!=</span>&nbsp;<span class="ident" id="5452941"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5452951">||</span>&nbsp;<span class="ident" id="5452954"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5452957">.</span><span class="ident" id="5452958">Flags</span><span class="op" id="5452963">&amp;</span><span class="ident" id="5452964"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5452973">!=</span>&nbsp;<span class="ident" id="5452976"><a href="/regexp/syntax/parse.go.html#5452884">re2</a></span><span class="op" id="5452979">.</span><span class="ident" id="5452980">Flags</span><span class="op" id="5452985">&amp;</span><span class="ident" id="5452986"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5452995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452999">return</span>&nbsp;<span class="builtintype" id="5453006">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453017">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453040"><a href="/regexp/syntax/parse.go.html#5452884">re2</a></span><span class="op" id="5453043">.</span><span class="ident" id="5453044">Rune</span>&nbsp;<span class="op" id="5453049">=</span>&nbsp;<span class="builtinfunc" id="5453051">append</span><span class="op" id="5453057">(</span><span class="ident" id="5453058"><a href="/regexp/syntax/parse.go.html#5452884">re2</a></span><span class="op" id="5453061">.</span><span class="ident" id="5453062">Rune</span><span class="op" id="5453066">,</span>&nbsp;<span class="ident" id="5453068"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453071">.</span><span class="ident" id="5453072">Rune</span><span class="op" id="5453076">...</span><span class="op" id="5453079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453083">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453110">if</span>&nbsp;<span class="ident" id="5453113"><a href="/regexp/syntax/parse.go.html#5452784">r</a></span>&nbsp;<span class="op" id="5453115">&gt;=</span>&nbsp;<span class="num" id="5453118">0</span>&nbsp;<span class="op" id="5453120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453124"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453127">.</span><span class="ident" id="5453128">Rune</span>&nbsp;<span class="op" id="5453133">=</span>&nbsp;<span class="ident" id="5453135"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453138">.</span><span class="ident" id="5453139">Rune0</span><span class="op" id="5453144">[</span><span class="op" id="5453145">:</span><span class="num" id="5453146">1</span><span class="op" id="5453147">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453151"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453154">.</span><span class="ident" id="5453155">Rune</span><span class="op" id="5453159">[</span><span class="num" id="5453160">0</span><span class="op" id="5453161">]</span>&nbsp;<span class="op" id="5453163">=</span>&nbsp;<span class="ident" id="5453165"><a href="/regexp/syntax/parse.go.html#5452784">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453169"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453172">.</span><span class="ident" id="5453173">Flags</span>&nbsp;<span class="op" id="5453179">=</span>&nbsp;<span class="ident" id="5453181"><a href="/regexp/syntax/parse.go.html#5452792">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453189">return</span>&nbsp;<span class="builtintype" id="5453196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453206"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5453207">.</span><span class="ident" id="5453208">stack</span>&nbsp;<span class="op" id="5453214">=</span>&nbsp;<span class="ident" id="5453216"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5453217">.</span><span class="ident" id="5453218">stack</span><span class="op" id="5453223">[</span><span class="op" id="5453224">:</span><span class="ident" id="5453225"><a href="/regexp/syntax/parse.go.html#5452813">n</a></span><span class="op" id="5453226">-</span><span class="num" id="5453227">1</span><span class="op" id="5453228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453231"><a href="/regexp/syntax/parse.go.html#5452761">p</a></span><span class="op" id="5453232">.</span><span class="ident" id="5453233">reuse</span><span class="op" id="5453238">(</span><span class="ident" id="5453239"><a href="/regexp/syntax/parse.go.html#5452863">re1</a></span><span class="op" id="5453242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453245">return</span>&nbsp;<span class="builtintype" id="5453252">false</span>&nbsp;<span class="comment" id="5453258">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5453276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5453279">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5453345">func</span>&nbsp;<span class="op" id="5453350">(</span><span class="ident" id="5453351">p</span>&nbsp;<span class="op" id="5453353">*</span><span class="ident" id="5453354"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5453360">)</span>&nbsp;<span class="ident" id="5453362">newLiteral</span><span class="op" id="5453372">(</span><span class="ident" id="5453373">r</span>&nbsp;<span class="builtintype" id="5453375">rune</span><span class="op" id="5453379">,</span>&nbsp;<span class="ident" id="5453381">flags</span>&nbsp;<span class="ident" id="5453387"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5453392">)</span>&nbsp;<span class="op" id="5453394">*</span><span class="ident" id="5453395"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5453402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453405">re</span>&nbsp;<span class="op" id="5453408">:=</span>&nbsp;<span class="ident" id="5453411"><a href="/regexp/syntax/parse.go.html#5453351">p</a></span><span class="op" id="5453412">.</span><span class="ident" id="5453413">newRegexp</span><span class="op" id="5453422">(</span><span class="ident" id="5453423"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><span class="op" id="5453432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453435"><a href="/regexp/syntax/parse.go.html#5453405">re</a></span><span class="op" id="5453437">.</span><span class="ident" id="5453438">Flags</span>&nbsp;<span class="op" id="5453444">=</span>&nbsp;<span class="ident" id="5453446"><a href="/regexp/syntax/parse.go.html#5453381">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453453">if</span>&nbsp;<span class="ident" id="5453456"><a href="/regexp/syntax/parse.go.html#5453381">flags</a></span><span class="op" id="5453461">&amp;</span><span class="ident" id="5453462"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5453471">!=</span>&nbsp;<span class="num" id="5453474">0</span>&nbsp;<span class="op" id="5453476">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453480"><a href="/regexp/syntax/parse.go.html#5453373">r</a></span>&nbsp;<span class="op" id="5453482">=</span>&nbsp;<span class="ident" id="5453484"><a href="/regexp/syntax/parse.go.html#5453624">minFoldRune</a></span><span class="op" id="5453495">(</span><span class="ident" id="5453496"><a href="/regexp/syntax/parse.go.html#5453373">r</a></span><span class="op" id="5453497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453503"><a href="/regexp/syntax/parse.go.html#5453405">re</a></span><span class="op" id="5453505">.</span><span class="ident" id="5453506">Rune0</span><span class="op" id="5453511">[</span><span class="num" id="5453512">0</span><span class="op" id="5453513">]</span>&nbsp;<span class="op" id="5453515">=</span>&nbsp;<span class="ident" id="5453517"><a href="/regexp/syntax/parse.go.html#5453373">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453520"><a href="/regexp/syntax/parse.go.html#5453405">re</a></span><span class="op" id="5453522">.</span><span class="ident" id="5453523">Rune</span>&nbsp;<span class="op" id="5453528">=</span>&nbsp;<span class="ident" id="5453530"><a href="/regexp/syntax/parse.go.html#5453405">re</a></span><span class="op" id="5453532">.</span><span class="ident" id="5453533">Rune0</span><span class="op" id="5453538">[</span><span class="op" id="5453539">:</span><span class="num" id="5453540">1</span><span class="op" id="5453541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453544">return</span>&nbsp;<span class="ident" id="5453551"><a href="/regexp/syntax/parse.go.html#5453405">re</a></span><br>
<span class="lineno">190</span><span class="op" id="5453554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453557">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5453619">func</span>&nbsp;<span class="ident" id="5453624">minFoldRune</span><span class="op" id="5453635">(</span><span class="ident" id="5453636">r</span>&nbsp;<span class="builtintype" id="5453638">rune</span><span class="op" id="5453642">)</span>&nbsp;<span class="builtintype" id="5453644">rune</span>&nbsp;<span class="op" id="5453649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453652">if</span>&nbsp;<span class="ident" id="5453655"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453657">&lt;</span>&nbsp;<span class="ident" id="5453659"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span>&nbsp;<span class="op" id="5453667">||</span>&nbsp;<span class="ident" id="5453670"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453672">&gt;</span>&nbsp;<span class="ident" id="5453674"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span>&nbsp;<span class="op" id="5453682">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453686">return</span>&nbsp;<span class="ident" id="5453693"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453699">min</span>&nbsp;<span class="op" id="5453703">:=</span>&nbsp;<span class="ident" id="5453706"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453709">r0</span>&nbsp;<span class="op" id="5453712">:=</span>&nbsp;<span class="ident" id="5453715"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453718">for</span>&nbsp;<span class="ident" id="5453722"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453724">=</span>&nbsp;<span class="ident" id="5453726"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5453733">.</span><span class="ident" id="5453734">SimpleFold</span><span class="op" id="5453744">(</span><span class="ident" id="5453745"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><span class="op" id="5453746">)</span><span class="op" id="5453747">;</span>&nbsp;<span class="ident" id="5453749"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453751">!=</span>&nbsp;<span class="ident" id="5453754"><a href="/regexp/syntax/parse.go.html#5453709">r0</a></span><span class="op" id="5453756">;</span>&nbsp;<span class="ident" id="5453758"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453760">=</span>&nbsp;<span class="ident" id="5453762"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5453769">.</span><span class="ident" id="5453770">SimpleFold</span><span class="op" id="5453780">(</span><span class="ident" id="5453781"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><span class="op" id="5453782">)</span>&nbsp;<span class="op" id="5453784">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453788">if</span>&nbsp;<span class="ident" id="5453791"><a href="/regexp/syntax/parse.go.html#5453699">min</a></span>&nbsp;<span class="op" id="5453795">&gt;</span>&nbsp;<span class="ident" id="5453797"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span>&nbsp;<span class="op" id="5453799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453804"><a href="/regexp/syntax/parse.go.html#5453699">min</a></span>&nbsp;<span class="op" id="5453808">=</span>&nbsp;<span class="ident" id="5453810"><a href="/regexp/syntax/parse.go.html#5453636">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453820">return</span>&nbsp;<span class="ident" id="5453827"><a href="/regexp/syntax/parse.go.html#5453699">min</a></span><br>
<span class="lineno">205</span><span class="op" id="5453831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453834">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5453897">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5453925">func</span>&nbsp;<span class="op" id="5453930">(</span><span class="ident" id="5453931">p</span>&nbsp;<span class="op" id="5453933">*</span><span class="ident" id="5453934"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5453940">)</span>&nbsp;<span class="ident" id="5453942">literal</span><span class="op" id="5453949">(</span><span class="ident" id="5453950">r</span>&nbsp;<span class="builtintype" id="5453952">rune</span><span class="op" id="5453956">)</span>&nbsp;<span class="op" id="5453958">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453961"><a href="/regexp/syntax/parse.go.html#5453931">p</a></span><span class="op" id="5453962">.</span><span class="ident" id="5453963">push</span><span class="op" id="5453967">(</span><span class="ident" id="5453968"><a href="/regexp/syntax/parse.go.html#5453931">p</a></span><span class="op" id="5453969">.</span><span class="ident" id="5453970">newLiteral</span><span class="op" id="5453980">(</span><span class="ident" id="5453981"><a href="/regexp/syntax/parse.go.html#5453950">r</a></span><span class="op" id="5453982">,</span>&nbsp;<span class="ident" id="5453984"><a href="/regexp/syntax/parse.go.html#5453931">p</a></span><span class="op" id="5453985">.</span><span class="ident" id="5453986">flags</span><span class="op" id="5453991">)</span><span class="op" id="5453992">)</span><br>
<span class="lineno"></span><span class="op" id="5453994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453997">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5454052">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5454080">func</span>&nbsp;<span class="op" id="5454085">(</span><span class="ident" id="5454086">p</span>&nbsp;<span class="op" id="5454088">*</span><span class="ident" id="5454089"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5454095">)</span>&nbsp;<span class="ident" id="5454097">op</span><span class="op" id="5454099">(</span><span class="ident" id="5454100">op</span>&nbsp;<span class="ident" id="5454103"><a href="/regexp/syntax/regexp.go.html#5505750">Op</a></span><span class="op" id="5454105">)</span>&nbsp;<span class="op" id="5454107">*</span><span class="ident" id="5454108"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5454115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454118">re</span>&nbsp;<span class="op" id="5454121">:=</span>&nbsp;<span class="ident" id="5454124"><a href="/regexp/syntax/parse.go.html#5454086">p</a></span><span class="op" id="5454125">.</span><span class="ident" id="5454126">newRegexp</span><span class="op" id="5454135">(</span><span class="ident" id="5454136"><a href="/regexp/syntax/parse.go.html#5454100">op</a></span><span class="op" id="5454138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454141"><a href="/regexp/syntax/parse.go.html#5454118">re</a></span><span class="op" id="5454143">.</span><span class="ident" id="5454144">Flags</span>&nbsp;<span class="op" id="5454150">=</span>&nbsp;<span class="ident" id="5454152"><a href="/regexp/syntax/parse.go.html#5454086">p</a></span><span class="op" id="5454153">.</span><span class="ident" id="5454154">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454161">return</span>&nbsp;<span class="ident" id="5454168"><a href="/regexp/syntax/parse.go.html#5454086">p</a></span><span class="op" id="5454169">.</span><span class="ident" id="5454170">push</span><span class="op" id="5454174">(</span><span class="ident" id="5454175"><a href="/regexp/syntax/parse.go.html#5454118">re</a></span><span class="op" id="5454177">)</span><br>
<span class="lineno"></span><span class="op" id="5454179">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5454182">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5454271">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5454339">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5454410">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5454469">func</span>&nbsp;<span class="op" id="5454474">(</span><span class="ident" id="5454475">p</span>&nbsp;<span class="op" id="5454477">*</span><span class="ident" id="5454478"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5454484">)</span>&nbsp;<span class="ident" id="5454486">repeat</span><span class="op" id="5454492">(</span><span class="ident" id="5454493">op</span>&nbsp;<span class="ident" id="5454496"><a href="/regexp/syntax/regexp.go.html#5505750">Op</a></span><span class="op" id="5454498">,</span>&nbsp;<span class="ident" id="5454500">min</span><span class="op" id="5454503">,</span>&nbsp;<span class="ident" id="5454505">max</span>&nbsp;<span class="builtintype" id="5454509">int</span><span class="op" id="5454512">,</span>&nbsp;<span class="ident" id="5454514">before</span><span class="op" id="5454520">,</span>&nbsp;<span class="ident" id="5454522">after</span><span class="op" id="5454527">,</span>&nbsp;<span class="ident" id="5454529">lastRepeat</span>&nbsp;<span class="builtintype" id="5454540">string</span><span class="op" id="5454546">)</span>&nbsp;<span class="op" id="5454548">(</span><span class="builtintype" id="5454549">string</span><span class="op" id="5454555">,</span>&nbsp;<span class="builtintype" id="5454557">error</span><span class="op" id="5454562">)</span>&nbsp;<span class="op" id="5454564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454567">flags</span>&nbsp;<span class="op" id="5454573">:=</span>&nbsp;<span class="ident" id="5454576"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5454577">.</span><span class="ident" id="5454578">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454585">if</span>&nbsp;<span class="ident" id="5454588"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5454589">.</span><span class="ident" id="5454590">flags</span><span class="op" id="5454595">&amp;</span><span class="ident" id="5454596"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5454602">!=</span>&nbsp;<span class="num" id="5454605">0</span>&nbsp;<span class="op" id="5454607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454611">if</span>&nbsp;<span class="builtinfunc" id="5454614">len</span><span class="op" id="5454617">(</span><span class="ident" id="5454618"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5454623">)</span>&nbsp;<span class="op" id="5454625">&gt;</span>&nbsp;<span class="num" id="5454627">0</span>&nbsp;<span class="op" id="5454629">&amp;&amp;</span>&nbsp;<span class="ident" id="5454632"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5454637">[</span><span class="num" id="5454638">0</span><span class="op" id="5454639">]</span>&nbsp;<span class="op" id="5454641">==</span>&nbsp;<span class="string" id="5454644">&#39;?&#39;</span>&nbsp;<span class="op" id="5454648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454653"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span>&nbsp;<span class="op" id="5454659">=</span>&nbsp;<span class="ident" id="5454661"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5454666">[</span><span class="num" id="5454667">1</span><span class="op" id="5454668">:</span><span class="op" id="5454669">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454674"><a href="/regexp/syntax/parse.go.html#5454567">flags</a></span>&nbsp;<span class="op" id="5454680">^=</span>&nbsp;<span class="ident" id="5454683"><a href="/regexp/syntax/parse.go.html#5449964">NonGreedy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454699">if</span>&nbsp;<span class="ident" id="5454702"><a href="/regexp/syntax/parse.go.html#5454529">lastRepeat</a></span>&nbsp;<span class="op" id="5454713">!=</span>&nbsp;<span class="string" id="5454716">&#34;&#34;</span>&nbsp;<span class="op" id="5454719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454724">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454787">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454850">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454905">return</span>&nbsp;<span class="string" id="5454912">&#34;&#34;</span><span class="op" id="5454914">,</span>&nbsp;<span class="op" id="5454916">&amp;</span><span class="ident" id="5454917"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5454922">{</span><span class="ident" id="5454923"><a href="/regexp/syntax/parse.go.html#5448879">ErrInvalidRepeatOp</a></span><span class="op" id="5454941">,</span>&nbsp;<span class="ident" id="5454943"><a href="/regexp/syntax/parse.go.html#5454529">lastRepeat</a></span><span class="op" id="5454953">[</span><span class="op" id="5454954">:</span><span class="builtinfunc" id="5454955">len</span><span class="op" id="5454958">(</span><span class="ident" id="5454959"><a href="/regexp/syntax/parse.go.html#5454529">lastRepeat</a></span><span class="op" id="5454969">)</span><span class="op" id="5454970">-</span><span class="builtinfunc" id="5454971">len</span><span class="op" id="5454974">(</span><span class="ident" id="5454975"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5454980">)</span><span class="op" id="5454981">]</span><span class="op" id="5454982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454992">n</span>&nbsp;<span class="op" id="5454994">:=</span>&nbsp;<span class="builtinfunc" id="5454997">len</span><span class="op" id="5455000">(</span><span class="ident" id="5455001"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5455002">.</span><span class="ident" id="5455003">stack</span><span class="op" id="5455008">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455011">if</span>&nbsp;<span class="ident" id="5455014"><a href="/regexp/syntax/parse.go.html#5454992">n</a></span>&nbsp;<span class="op" id="5455016">==</span>&nbsp;<span class="num" id="5455019">0</span>&nbsp;<span class="op" id="5455021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455025">return</span>&nbsp;<span class="string" id="5455032">&#34;&#34;</span><span class="op" id="5455034">,</span>&nbsp;<span class="op" id="5455036">&amp;</span><span class="ident" id="5455037"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5455042">{</span><span class="ident" id="5455043"><a href="/regexp/syntax/parse.go.html#5449185">ErrMissingRepeatArgument</a></span><span class="op" id="5455067">,</span>&nbsp;<span class="ident" id="5455069"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455075">[</span><span class="op" id="5455076">:</span><span class="builtinfunc" id="5455077">len</span><span class="op" id="5455080">(</span><span class="ident" id="5455081"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455087">)</span><span class="op" id="5455088">-</span><span class="builtinfunc" id="5455089">len</span><span class="op" id="5455092">(</span><span class="ident" id="5455093"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5455098">)</span><span class="op" id="5455099">]</span><span class="op" id="5455100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455106">sub</span>&nbsp;<span class="op" id="5455110">:=</span>&nbsp;<span class="ident" id="5455113"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5455114">.</span><span class="ident" id="5455115">stack</span><span class="op" id="5455120">[</span><span class="ident" id="5455121"><a href="/regexp/syntax/parse.go.html#5454992">n</a></span><span class="op" id="5455122">-</span><span class="num" id="5455123">1</span><span class="op" id="5455124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455127">if</span>&nbsp;<span class="ident" id="5455130"><a href="/regexp/syntax/parse.go.html#5455106">sub</a></span><span class="op" id="5455133">.</span><span class="ident" id="5455134">Op</span>&nbsp;<span class="op" id="5455137">&gt;=</span>&nbsp;<span class="ident" id="5455140"><a href="/regexp/syntax/regexp.go.html#5507307">opPseudo</a></span>&nbsp;<span class="op" id="5455149">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455153">return</span>&nbsp;<span class="string" id="5455160">&#34;&#34;</span><span class="op" id="5455162">,</span>&nbsp;<span class="op" id="5455164">&amp;</span><span class="ident" id="5455165"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5455170">{</span><span class="ident" id="5455171"><a href="/regexp/syntax/parse.go.html#5449185">ErrMissingRepeatArgument</a></span><span class="op" id="5455195">,</span>&nbsp;<span class="ident" id="5455197"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455203">[</span><span class="op" id="5455204">:</span><span class="builtinfunc" id="5455205">len</span><span class="op" id="5455208">(</span><span class="ident" id="5455209"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455215">)</span><span class="op" id="5455216">-</span><span class="builtinfunc" id="5455217">len</span><span class="op" id="5455220">(</span><span class="ident" id="5455221"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5455226">)</span><span class="op" id="5455227">]</span><span class="op" id="5455228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455235">re</span>&nbsp;<span class="op" id="5455238">:=</span>&nbsp;<span class="ident" id="5455241"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5455242">.</span><span class="ident" id="5455243">newRegexp</span><span class="op" id="5455252">(</span><span class="ident" id="5455253"><a href="/regexp/syntax/parse.go.html#5454493">op</a></span><span class="op" id="5455255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455258"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455260">.</span><span class="ident" id="5455261">Min</span>&nbsp;<span class="op" id="5455265">=</span>&nbsp;<span class="ident" id="5455267"><a href="/regexp/syntax/parse.go.html#5454500">min</a></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455272"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455274">.</span><span class="ident" id="5455275">Max</span>&nbsp;<span class="op" id="5455279">=</span>&nbsp;<span class="ident" id="5455281"><a href="/regexp/syntax/parse.go.html#5454505">max</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455286"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455288">.</span><span class="ident" id="5455289">Flags</span>&nbsp;<span class="op" id="5455295">=</span>&nbsp;<span class="ident" id="5455297"><a href="/regexp/syntax/parse.go.html#5454567">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455304"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455306">.</span><span class="ident" id="5455307">Sub</span>&nbsp;<span class="op" id="5455311">=</span>&nbsp;<span class="ident" id="5455313"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455315">.</span><span class="ident" id="5455316">Sub0</span><span class="op" id="5455320">[</span><span class="op" id="5455321">:</span><span class="num" id="5455322">1</span><span class="op" id="5455323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455326"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455328">.</span><span class="ident" id="5455329">Sub</span><span class="op" id="5455332">[</span><span class="num" id="5455333">0</span><span class="op" id="5455334">]</span>&nbsp;<span class="op" id="5455336">=</span>&nbsp;<span class="ident" id="5455338"><a href="/regexp/syntax/parse.go.html#5455106">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455343"><a href="/regexp/syntax/parse.go.html#5454475">p</a></span><span class="op" id="5455344">.</span><span class="ident" id="5455345">stack</span><span class="op" id="5455350">[</span><span class="ident" id="5455351"><a href="/regexp/syntax/parse.go.html#5454992">n</a></span><span class="op" id="5455352">-</span><span class="num" id="5455353">1</span><span class="op" id="5455354">]</span>&nbsp;<span class="op" id="5455356">=</span>&nbsp;<span class="ident" id="5455358"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455363">if</span>&nbsp;<span class="ident" id="5455366"><a href="/regexp/syntax/parse.go.html#5454493">op</a></span>&nbsp;<span class="op" id="5455369">==</span>&nbsp;<span class="ident" id="5455372"><a href="/regexp/syntax/regexp.go.html#5507065">OpRepeat</a></span>&nbsp;<span class="op" id="5455381">&amp;&amp;</span>&nbsp;<span class="op" id="5455384">(</span><span class="ident" id="5455385"><a href="/regexp/syntax/parse.go.html#5454500">min</a></span>&nbsp;<span class="op" id="5455389">&gt;=</span>&nbsp;<span class="num" id="5455392">2</span>&nbsp;<span class="op" id="5455394">||</span>&nbsp;<span class="ident" id="5455397"><a href="/regexp/syntax/parse.go.html#5454505">max</a></span>&nbsp;<span class="op" id="5455401">&gt;=</span>&nbsp;<span class="num" id="5455404">2</span><span class="op" id="5455405">)</span>&nbsp;<span class="op" id="5455407">&amp;&amp;</span>&nbsp;<span class="op" id="5455410">!</span><span class="ident" id="5455411"><a href="/regexp/syntax/parse.go.html#5456114">repeatIsValid</a></span><span class="op" id="5455424">(</span><span class="ident" id="5455425"><a href="/regexp/syntax/parse.go.html#5455235">re</a></span><span class="op" id="5455427">,</span>&nbsp;<span class="num" id="5455429">1000</span><span class="op" id="5455433">)</span>&nbsp;<span class="op" id="5455435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455439">return</span>&nbsp;<span class="string" id="5455446">&#34;&#34;</span><span class="op" id="5455448">,</span>&nbsp;<span class="op" id="5455450">&amp;</span><span class="ident" id="5455451"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5455456">{</span><span class="ident" id="5455457"><a href="/regexp/syntax/parse.go.html#5448954">ErrInvalidRepeatSize</a></span><span class="op" id="5455477">,</span>&nbsp;<span class="ident" id="5455479"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455485">[</span><span class="op" id="5455486">:</span><span class="builtinfunc" id="5455487">len</span><span class="op" id="5455490">(</span><span class="ident" id="5455491"><a href="/regexp/syntax/parse.go.html#5454514">before</a></span><span class="op" id="5455497">)</span><span class="op" id="5455498">-</span><span class="builtinfunc" id="5455499">len</span><span class="op" id="5455502">(</span><span class="ident" id="5455503"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5455508">)</span><span class="op" id="5455509">]</span><span class="op" id="5455510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455517">return</span>&nbsp;<span class="ident" id="5455524"><a href="/regexp/syntax/parse.go.html#5454522">after</a></span><span class="op" id="5455529">,</span>&nbsp;<span class="ident" id="5455531">nil</span><br>
<span class="lineno"></span><span class="op" id="5455535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455538">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5455599">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5455663">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5455724">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5455744">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5455821">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5455893">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5455962">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5456034">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5456109">func</span>&nbsp;<span class="ident" id="5456114">repeatIsValid</span><span class="op" id="5456127">(</span><span class="ident" id="5456128">re</span>&nbsp;<span class="op" id="5456131">*</span><span class="ident" id="5456132"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5456138">,</span>&nbsp;<span class="ident" id="5456140">n</span>&nbsp;<span class="builtintype" id="5456142">int</span><span class="op" id="5456145">)</span>&nbsp;<span class="builtintype" id="5456147">bool</span>&nbsp;<span class="op" id="5456152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456155">if</span>&nbsp;<span class="ident" id="5456158"><a href="/regexp/syntax/parse.go.html#5456128">re</a></span><span class="op" id="5456160">.</span><span class="ident" id="5456161">Op</span>&nbsp;<span class="op" id="5456164">==</span>&nbsp;<span class="ident" id="5456167"><a href="/regexp/syntax/regexp.go.html#5507065">OpRepeat</a></span>&nbsp;<span class="op" id="5456176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456180">m</span>&nbsp;<span class="op" id="5456182">:=</span>&nbsp;<span class="ident" id="5456185"><a href="/regexp/syntax/parse.go.html#5456128">re</a></span><span class="op" id="5456187">.</span><span class="ident" id="5456188">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456194">if</span>&nbsp;<span class="ident" id="5456197"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span>&nbsp;<span class="op" id="5456199">==</span>&nbsp;<span class="num" id="5456202">0</span>&nbsp;<span class="op" id="5456204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456209">return</span>&nbsp;<span class="builtintype" id="5456216">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456227">if</span>&nbsp;<span class="ident" id="5456230"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span>&nbsp;<span class="op" id="5456232">&lt;</span>&nbsp;<span class="num" id="5456234">0</span>&nbsp;<span class="op" id="5456236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456241"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span>&nbsp;<span class="op" id="5456243">=</span>&nbsp;<span class="ident" id="5456245"><a href="/regexp/syntax/parse.go.html#5456128">re</a></span><span class="op" id="5456247">.</span><span class="ident" id="5456248">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456258">if</span>&nbsp;<span class="ident" id="5456261"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span>&nbsp;<span class="op" id="5456263">&gt;</span>&nbsp;<span class="ident" id="5456265"><a href="/regexp/syntax/parse.go.html#5456140">n</a></span>&nbsp;<span class="op" id="5456267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456272">return</span>&nbsp;<span class="builtintype" id="5456279">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456291">if</span>&nbsp;<span class="ident" id="5456294"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span>&nbsp;<span class="op" id="5456296">&gt;</span>&nbsp;<span class="num" id="5456298">0</span>&nbsp;<span class="op" id="5456300">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456305"><a href="/regexp/syntax/parse.go.html#5456140">n</a></span>&nbsp;<span class="op" id="5456307">/=</span>&nbsp;<span class="ident" id="5456310"><a href="/regexp/syntax/parse.go.html#5456180">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456320">for</span>&nbsp;<span class="ident" id="5456324">_</span><span class="op" id="5456325">,</span>&nbsp;<span class="ident" id="5456327">sub</span>&nbsp;<span class="op" id="5456331">:=</span>&nbsp;<span class="keyword" id="5456334">range</span>&nbsp;<span class="ident" id="5456340"><a href="/regexp/syntax/parse.go.html#5456128">re</a></span><span class="op" id="5456342">.</span><span class="ident" id="5456343">Sub</span>&nbsp;<span class="op" id="5456347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456351">if</span>&nbsp;<span class="op" id="5456354">!</span><span class="ident" id="5456355"><a href="/regexp/syntax/parse.go.html#5456114">repeatIsValid</a></span><span class="op" id="5456368">(</span><span class="ident" id="5456369"><a href="/regexp/syntax/parse.go.html#5456327">sub</a></span><span class="op" id="5456372">,</span>&nbsp;<span class="ident" id="5456374"><a href="/regexp/syntax/parse.go.html#5456140">n</a></span><span class="op" id="5456375">)</span>&nbsp;<span class="op" id="5456377">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456382">return</span>&nbsp;<span class="builtintype" id="5456389">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456403">return</span>&nbsp;<span class="builtintype" id="5456410">true</span><br>
<span class="lineno"></span><span class="op" id="5456415">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5456418">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5456513">func</span>&nbsp;<span class="op" id="5456518">(</span><span class="ident" id="5456519">p</span>&nbsp;<span class="op" id="5456521">*</span><span class="ident" id="5456522"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5456528">)</span>&nbsp;<span class="ident" id="5456530">concat</span><span class="op" id="5456536">(</span><span class="op" id="5456537">)</span>&nbsp;<span class="op" id="5456539">*</span><span class="ident" id="5456540"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5456547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456550"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456551">.</span><span class="ident" id="5456552">maybeConcat</span><span class="op" id="5456563">(</span><span class="op" id="5456564">-</span><span class="num" id="5456565">1</span><span class="op" id="5456566">,</span>&nbsp;<span class="num" id="5456568">0</span><span class="op" id="5456569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456573">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456619">i</span>&nbsp;<span class="op" id="5456621">:=</span>&nbsp;<span class="builtinfunc" id="5456624">len</span><span class="op" id="5456627">(</span><span class="ident" id="5456628"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456629">.</span><span class="ident" id="5456630">stack</span><span class="op" id="5456635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456638">for</span>&nbsp;<span class="ident" id="5456642"><a href="/regexp/syntax/parse.go.html#5456619">i</a></span>&nbsp;<span class="op" id="5456644">&gt;</span>&nbsp;<span class="num" id="5456646">0</span>&nbsp;<span class="op" id="5456648">&amp;&amp;</span>&nbsp;<span class="ident" id="5456651"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456652">.</span><span class="ident" id="5456653">stack</span><span class="op" id="5456658">[</span><span class="ident" id="5456659"><a href="/regexp/syntax/parse.go.html#5456619">i</a></span><span class="op" id="5456660">-</span><span class="num" id="5456661">1</span><span class="op" id="5456662">]</span><span class="op" id="5456663">.</span><span class="ident" id="5456664">Op</span>&nbsp;<span class="op" id="5456667">&lt;</span>&nbsp;<span class="ident" id="5456669"><a href="/regexp/syntax/regexp.go.html#5507307">opPseudo</a></span>&nbsp;<span class="op" id="5456678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456682"><a href="/regexp/syntax/parse.go.html#5456619">i</a></span><span class="op" id="5456683">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456687">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456690">subs</span>&nbsp;<span class="op" id="5456695">:=</span>&nbsp;<span class="ident" id="5456698"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456699">.</span><span class="ident" id="5456700">stack</span><span class="op" id="5456705">[</span><span class="ident" id="5456706"><a href="/regexp/syntax/parse.go.html#5456619">i</a></span><span class="op" id="5456707">:</span><span class="op" id="5456708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456711"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456712">.</span><span class="ident" id="5456713">stack</span>&nbsp;<span class="op" id="5456719">=</span>&nbsp;<span class="ident" id="5456721"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456722">.</span><span class="ident" id="5456723">stack</span><span class="op" id="5456728">[</span><span class="op" id="5456729">:</span><span class="ident" id="5456730"><a href="/regexp/syntax/parse.go.html#5456619">i</a></span><span class="op" id="5456731">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456735">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456776">if</span>&nbsp;<span class="builtinfunc" id="5456779">len</span><span class="op" id="5456782">(</span><span class="ident" id="5456783"><a href="/regexp/syntax/parse.go.html#5456690">subs</a></span><span class="op" id="5456787">)</span>&nbsp;<span class="op" id="5456789">==</span>&nbsp;<span class="num" id="5456792">0</span>&nbsp;<span class="op" id="5456794">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456798">return</span>&nbsp;<span class="ident" id="5456805"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456806">.</span><span class="ident" id="5456807">push</span><span class="op" id="5456811">(</span><span class="ident" id="5456812"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456813">.</span><span class="ident" id="5456814">newRegexp</span><span class="op" id="5456823">(</span><span class="ident" id="5456824"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span><span class="op" id="5456836">)</span><span class="op" id="5456837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456844">return</span>&nbsp;<span class="ident" id="5456851"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456852">.</span><span class="ident" id="5456853">push</span><span class="op" id="5456857">(</span><span class="ident" id="5456858"><a href="/regexp/syntax/parse.go.html#5456519">p</a></span><span class="op" id="5456859">.</span><span class="ident" id="5456860">collapse</span><span class="op" id="5456868">(</span><span class="ident" id="5456869"><a href="/regexp/syntax/parse.go.html#5456690">subs</a></span><span class="op" id="5456873">,</span>&nbsp;<span class="ident" id="5456875"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span><span class="op" id="5456883">)</span><span class="op" id="5456884">)</span><br>
<span class="lineno"></span><span class="op" id="5456886">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5456889">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5456978">func</span>&nbsp;<span class="op" id="5456983">(</span><span class="ident" id="5456984">p</span>&nbsp;<span class="op" id="5456986">*</span><span class="ident" id="5456987"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5456993">)</span>&nbsp;<span class="ident" id="5456995">alternate</span><span class="op" id="5457004">(</span><span class="op" id="5457005">)</span>&nbsp;<span class="op" id="5457007">*</span><span class="ident" id="5457008"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5457015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457018">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457059">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457087">i</span>&nbsp;<span class="op" id="5457089">:=</span>&nbsp;<span class="builtinfunc" id="5457092">len</span><span class="op" id="5457095">(</span><span class="ident" id="5457096"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457097">.</span><span class="ident" id="5457098">stack</span><span class="op" id="5457103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457106">for</span>&nbsp;<span class="ident" id="5457110"><a href="/regexp/syntax/parse.go.html#5457087">i</a></span>&nbsp;<span class="op" id="5457112">&gt;</span>&nbsp;<span class="num" id="5457114">0</span>&nbsp;<span class="op" id="5457116">&amp;&amp;</span>&nbsp;<span class="ident" id="5457119"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457120">.</span><span class="ident" id="5457121">stack</span><span class="op" id="5457126">[</span><span class="ident" id="5457127"><a href="/regexp/syntax/parse.go.html#5457087">i</a></span><span class="op" id="5457128">-</span><span class="num" id="5457129">1</span><span class="op" id="5457130">]</span><span class="op" id="5457131">.</span><span class="ident" id="5457132">Op</span>&nbsp;<span class="op" id="5457135">&lt;</span>&nbsp;<span class="ident" id="5457137"><a href="/regexp/syntax/regexp.go.html#5507307">opPseudo</a></span>&nbsp;<span class="op" id="5457146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457150"><a href="/regexp/syntax/parse.go.html#5457087">i</a></span><span class="op" id="5457151">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457158">subs</span>&nbsp;<span class="op" id="5457163">:=</span>&nbsp;<span class="ident" id="5457166"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457167">.</span><span class="ident" id="5457168">stack</span><span class="op" id="5457173">[</span><span class="ident" id="5457174"><a href="/regexp/syntax/parse.go.html#5457087">i</a></span><span class="op" id="5457175">:</span><span class="op" id="5457176">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457179"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457180">.</span><span class="ident" id="5457181">stack</span>&nbsp;<span class="op" id="5457187">=</span>&nbsp;<span class="ident" id="5457189"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457190">.</span><span class="ident" id="5457191">stack</span><span class="op" id="5457196">[</span><span class="op" id="5457197">:</span><span class="ident" id="5457198"><a href="/regexp/syntax/parse.go.html#5457087">i</a></span><span class="op" id="5457199">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457203">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457237">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457291">if</span>&nbsp;<span class="builtinfunc" id="5457294">len</span><span class="op" id="5457297">(</span><span class="ident" id="5457298"><a href="/regexp/syntax/parse.go.html#5457158">subs</a></span><span class="op" id="5457302">)</span>&nbsp;<span class="op" id="5457304">&gt;</span>&nbsp;<span class="num" id="5457306">0</span>&nbsp;<span class="op" id="5457308">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457312"><a href="/regexp/syntax/parse.go.html#5457606">cleanAlt</a></span><span class="op" id="5457320">(</span><span class="ident" id="5457321"><a href="/regexp/syntax/parse.go.html#5457158">subs</a></span><span class="op" id="5457325">[</span><span class="builtinfunc" id="5457326">len</span><span class="op" id="5457329">(</span><span class="ident" id="5457330"><a href="/regexp/syntax/parse.go.html#5457158">subs</a></span><span class="op" id="5457334">)</span><span class="op" id="5457335">-</span><span class="num" id="5457336">1</span><span class="op" id="5457337">]</span><span class="op" id="5457338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457345">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457381">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457424">if</span>&nbsp;<span class="builtinfunc" id="5457427">len</span><span class="op" id="5457430">(</span><span class="ident" id="5457431"><a href="/regexp/syntax/parse.go.html#5457158">subs</a></span><span class="op" id="5457435">)</span>&nbsp;<span class="op" id="5457437">==</span>&nbsp;<span class="num" id="5457440">0</span>&nbsp;<span class="op" id="5457442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457446">return</span>&nbsp;<span class="ident" id="5457453"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457454">.</span><span class="ident" id="5457455">push</span><span class="op" id="5457459">(</span><span class="ident" id="5457460"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457461">.</span><span class="ident" id="5457462">newRegexp</span><span class="op" id="5457471">(</span><span class="ident" id="5457472"><a href="/regexp/syntax/regexp.go.html#5505965">OpNoMatch</a></span><span class="op" id="5457481">)</span><span class="op" id="5457482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457489">return</span>&nbsp;<span class="ident" id="5457496"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457497">.</span><span class="ident" id="5457498">push</span><span class="op" id="5457502">(</span><span class="ident" id="5457503"><a href="/regexp/syntax/parse.go.html#5456984">p</a></span><span class="op" id="5457504">.</span><span class="ident" id="5457505">collapse</span><span class="op" id="5457513">(</span><span class="ident" id="5457514"><a href="/regexp/syntax/parse.go.html#5457158">subs</a></span><span class="op" id="5457518">,</span>&nbsp;<span class="ident" id="5457520"><a href="/regexp/syntax/regexp.go.html#5507236">OpAlternate</a></span><span class="op" id="5457531">)</span><span class="op" id="5457532">)</span><br>
<span class="lineno">340</span><span class="op" id="5457534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5457537">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5457601">func</span>&nbsp;<span class="ident" id="5457606">cleanAlt</span><span class="op" id="5457614">(</span><span class="ident" id="5457615">re</span>&nbsp;<span class="op" id="5457618">*</span><span class="ident" id="5457619"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5457625">)</span>&nbsp;<span class="op" id="5457627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457630">switch</span>&nbsp;<span class="ident" id="5457637"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457639">.</span><span class="ident" id="5457640">Op</span>&nbsp;<span class="op" id="5457643">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457646">case</span>&nbsp;<span class="ident" id="5457651"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><span class="op" id="5457662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457666"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457668">.</span><span class="ident" id="5457669">Rune</span>&nbsp;<span class="op" id="5457674">=</span>&nbsp;<span class="ident" id="5457676"><a href="/regexp/syntax/parse.go.html#5488005">cleanClass</a></span><span class="op" id="5457686">(</span><span class="op" id="5457687">&amp;</span><span class="ident" id="5457688"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457690">.</span><span class="ident" id="5457691">Rune</span><span class="op" id="5457695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457699">if</span>&nbsp;<span class="builtinfunc" id="5457702">len</span><span class="op" id="5457705">(</span><span class="ident" id="5457706"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457708">.</span><span class="ident" id="5457709">Rune</span><span class="op" id="5457713">)</span>&nbsp;<span class="op" id="5457715">==</span>&nbsp;<span class="num" id="5457718">2</span>&nbsp;<span class="op" id="5457720">&amp;&amp;</span>&nbsp;<span class="ident" id="5457723"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457725">.</span><span class="ident" id="5457726">Rune</span><span class="op" id="5457730">[</span><span class="num" id="5457731">0</span><span class="op" id="5457732">]</span>&nbsp;<span class="op" id="5457734">==</span>&nbsp;<span class="num" id="5457737">0</span>&nbsp;<span class="op" id="5457739">&amp;&amp;</span>&nbsp;<span class="ident" id="5457742"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457744">.</span><span class="ident" id="5457745">Rune</span><span class="op" id="5457749">[</span><span class="num" id="5457750">1</span><span class="op" id="5457751">]</span>&nbsp;<span class="op" id="5457753">==</span>&nbsp;<span class="ident" id="5457756"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5457763">.</span><span class="ident" id="5457764">MaxRune</span>&nbsp;<span class="op" id="5457772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457777"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457779">.</span><span class="ident" id="5457780">Rune</span>&nbsp;<span class="op" id="5457785">=</span>&nbsp;<span class="ident" id="5457787">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457794"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457796">.</span><span class="ident" id="5457797">Op</span>&nbsp;<span class="op" id="5457800">=</span>&nbsp;<span class="ident" id="5457802"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457815">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457828">if</span>&nbsp;<span class="builtinfunc" id="5457831">len</span><span class="op" id="5457834">(</span><span class="ident" id="5457835"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457837">.</span><span class="ident" id="5457838">Rune</span><span class="op" id="5457842">)</span>&nbsp;<span class="op" id="5457844">==</span>&nbsp;<span class="num" id="5457847">4</span>&nbsp;<span class="op" id="5457849">&amp;&amp;</span>&nbsp;<span class="ident" id="5457852"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457854">.</span><span class="ident" id="5457855">Rune</span><span class="op" id="5457859">[</span><span class="num" id="5457860">0</span><span class="op" id="5457861">]</span>&nbsp;<span class="op" id="5457863">==</span>&nbsp;<span class="num" id="5457866">0</span>&nbsp;<span class="op" id="5457868">&amp;&amp;</span>&nbsp;<span class="ident" id="5457871"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457873">.</span><span class="ident" id="5457874">Rune</span><span class="op" id="5457878">[</span><span class="num" id="5457879">1</span><span class="op" id="5457880">]</span>&nbsp;<span class="op" id="5457882">==</span>&nbsp;<span class="string" id="5457885">&#39;\n&#39;</span><span class="op" id="5457889">-</span><span class="num" id="5457890">1</span>&nbsp;<span class="op" id="5457892">&amp;&amp;</span>&nbsp;<span class="ident" id="5457895"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457897">.</span><span class="ident" id="5457898">Rune</span><span class="op" id="5457902">[</span><span class="num" id="5457903">2</span><span class="op" id="5457904">]</span>&nbsp;<span class="op" id="5457906">==</span>&nbsp;<span class="string" id="5457909">&#39;\n&#39;</span><span class="op" id="5457913">+</span><span class="num" id="5457914">1</span>&nbsp;<span class="op" id="5457916">&amp;&amp;</span>&nbsp;<span class="ident" id="5457919"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457921">.</span><span class="ident" id="5457922">Rune</span><span class="op" id="5457926">[</span><span class="num" id="5457927">3</span><span class="op" id="5457928">]</span>&nbsp;<span class="op" id="5457930">==</span>&nbsp;<span class="ident" id="5457933"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5457940">.</span><span class="ident" id="5457941">MaxRune</span>&nbsp;<span class="op" id="5457949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457954"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457956">.</span><span class="ident" id="5457957">Rune</span>&nbsp;<span class="op" id="5457962">=</span>&nbsp;<span class="ident" id="5457964">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457971"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5457973">.</span><span class="ident" id="5457974">Op</span>&nbsp;<span class="op" id="5457977">=</span>&nbsp;<span class="ident" id="5457979"><a href="/regexp/syntax/regexp.go.html#5506213">OpAnyCharNotNL</a></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457997">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458010">if</span>&nbsp;<span class="builtinfunc" id="5458013">cap</span><span class="op" id="5458016">(</span><span class="ident" id="5458017"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5458019">.</span><span class="ident" id="5458020">Rune</span><span class="op" id="5458024">)</span><span class="op" id="5458025">-</span><span class="builtinfunc" id="5458026">len</span><span class="op" id="5458029">(</span><span class="ident" id="5458030"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5458032">.</span><span class="ident" id="5458033">Rune</span><span class="op" id="5458037">)</span>&nbsp;<span class="op" id="5458039">&gt;</span>&nbsp;<span class="num" id="5458041">100</span>&nbsp;<span class="op" id="5458045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5458050">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5458088">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458136"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5458138">.</span><span class="ident" id="5458139">Rune</span>&nbsp;<span class="op" id="5458144">=</span>&nbsp;<span class="builtinfunc" id="5458146">append</span><span class="op" id="5458152">(</span><span class="ident" id="5458153"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5458155">.</span><span class="ident" id="5458156">Rune0</span><span class="op" id="5458161">[</span><span class="op" id="5458162">:</span><span class="num" id="5458163">0</span><span class="op" id="5458164">]</span><span class="op" id="5458165">,</span>&nbsp;<span class="ident" id="5458167"><a href="/regexp/syntax/parse.go.html#5457615">re</a></span><span class="op" id="5458169">.</span><span class="ident" id="5458170">Rune</span><span class="op" id="5458174">...</span><span class="op" id="5458177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458184">}</span><br>
<span class="lineno"></span><span class="op" id="5458186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5458189">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5458243">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5458296">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5458349">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5458379">func</span>&nbsp;<span class="op" id="5458384">(</span><span class="ident" id="5458385">p</span>&nbsp;<span class="op" id="5458387">*</span><span class="ident" id="5458388"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5458394">)</span>&nbsp;<span class="ident" id="5458396">collapse</span><span class="op" id="5458404">(</span><span class="ident" id="5458405">subs</span>&nbsp;<span class="op" id="5458410">[</span><span class="op" id="5458411">]</span><span class="op" id="5458412">*</span><span class="ident" id="5458413"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5458419">,</span>&nbsp;<span class="ident" id="5458421">op</span>&nbsp;<span class="ident" id="5458424"><a href="/regexp/syntax/regexp.go.html#5505750">Op</a></span><span class="op" id="5458426">)</span>&nbsp;<span class="op" id="5458428">*</span><span class="ident" id="5458429"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5458436">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458439">if</span>&nbsp;<span class="builtinfunc" id="5458442">len</span><span class="op" id="5458445">(</span><span class="ident" id="5458446"><a href="/regexp/syntax/parse.go.html#5458405">subs</a></span><span class="op" id="5458450">)</span>&nbsp;<span class="op" id="5458452">==</span>&nbsp;<span class="num" id="5458455">1</span>&nbsp;<span class="op" id="5458457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458461">return</span>&nbsp;<span class="ident" id="5458468"><a href="/regexp/syntax/parse.go.html#5458405">subs</a></span><span class="op" id="5458472">[</span><span class="num" id="5458473">0</span><span class="op" id="5458474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458480">re</span>&nbsp;<span class="op" id="5458483">:=</span>&nbsp;<span class="ident" id="5458486"><a href="/regexp/syntax/parse.go.html#5458385">p</a></span><span class="op" id="5458487">.</span><span class="ident" id="5458488">newRegexp</span><span class="op" id="5458497">(</span><span class="ident" id="5458498"><a href="/regexp/syntax/parse.go.html#5458421">op</a></span><span class="op" id="5458500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458503"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458505">.</span><span class="ident" id="5458506">Sub</span>&nbsp;<span class="op" id="5458510">=</span>&nbsp;<span class="ident" id="5458512"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458514">.</span><span class="ident" id="5458515">Sub0</span><span class="op" id="5458519">[</span><span class="op" id="5458520">:</span><span class="num" id="5458521">0</span><span class="op" id="5458522">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458525">for</span>&nbsp;<span class="ident" id="5458529">_</span><span class="op" id="5458530">,</span>&nbsp;<span class="ident" id="5458532">sub</span>&nbsp;<span class="op" id="5458536">:=</span>&nbsp;<span class="keyword" id="5458539">range</span>&nbsp;<span class="ident" id="5458545"><a href="/regexp/syntax/parse.go.html#5458405">subs</a></span>&nbsp;<span class="op" id="5458550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458554">if</span>&nbsp;<span class="ident" id="5458557"><a href="/regexp/syntax/parse.go.html#5458532">sub</a></span><span class="op" id="5458560">.</span><span class="ident" id="5458561">Op</span>&nbsp;<span class="op" id="5458564">==</span>&nbsp;<span class="ident" id="5458567"><a href="/regexp/syntax/parse.go.html#5458421">op</a></span>&nbsp;<span class="op" id="5458570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458575"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458577">.</span><span class="ident" id="5458578">Sub</span>&nbsp;<span class="op" id="5458582">=</span>&nbsp;<span class="builtinfunc" id="5458584">append</span><span class="op" id="5458590">(</span><span class="ident" id="5458591"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458593">.</span><span class="ident" id="5458594">Sub</span><span class="op" id="5458597">,</span>&nbsp;<span class="ident" id="5458599"><a href="/regexp/syntax/parse.go.html#5458532">sub</a></span><span class="op" id="5458602">.</span><span class="ident" id="5458603">Sub</span><span class="op" id="5458606">...</span><span class="op" id="5458609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458614"><a href="/regexp/syntax/parse.go.html#5458385">p</a></span><span class="op" id="5458615">.</span><span class="ident" id="5458616">reuse</span><span class="op" id="5458621">(</span><span class="ident" id="5458622"><a href="/regexp/syntax/parse.go.html#5458532">sub</a></span><span class="op" id="5458625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458629">}</span>&nbsp;<span class="keyword" id="5458631">else</span>&nbsp;<span class="op" id="5458636">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458641"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458643">.</span><span class="ident" id="5458644">Sub</span>&nbsp;<span class="op" id="5458648">=</span>&nbsp;<span class="builtinfunc" id="5458650">append</span><span class="op" id="5458656">(</span><span class="ident" id="5458657"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458659">.</span><span class="ident" id="5458660">Sub</span><span class="op" id="5458663">,</span>&nbsp;<span class="ident" id="5458665"><a href="/regexp/syntax/parse.go.html#5458532">sub</a></span><span class="op" id="5458668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458678">if</span>&nbsp;<span class="ident" id="5458681"><a href="/regexp/syntax/parse.go.html#5458421">op</a></span>&nbsp;<span class="op" id="5458684">==</span>&nbsp;<span class="ident" id="5458687"><a href="/regexp/syntax/regexp.go.html#5507236">OpAlternate</a></span>&nbsp;<span class="op" id="5458699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458703"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458705">.</span><span class="ident" id="5458706">Sub</span>&nbsp;<span class="op" id="5458710">=</span>&nbsp;<span class="ident" id="5458712"><a href="/regexp/syntax/parse.go.html#5458385">p</a></span><span class="op" id="5458713">.</span><span class="ident" id="5458714">factor</span><span class="op" id="5458720">(</span><span class="ident" id="5458721"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458723">.</span><span class="ident" id="5458724">Sub</span><span class="op" id="5458727">,</span>&nbsp;<span class="ident" id="5458729"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458731">.</span><span class="ident" id="5458732">Flags</span><span class="op" id="5458737">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458741">if</span>&nbsp;<span class="builtinfunc" id="5458744">len</span><span class="op" id="5458747">(</span><span class="ident" id="5458748"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458750">.</span><span class="ident" id="5458751">Sub</span><span class="op" id="5458754">)</span>&nbsp;<span class="op" id="5458756">==</span>&nbsp;<span class="num" id="5458759">1</span>&nbsp;<span class="op" id="5458761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458766">old</span>&nbsp;<span class="op" id="5458770">:=</span>&nbsp;<span class="ident" id="5458773"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458779"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span>&nbsp;<span class="op" id="5458782">=</span>&nbsp;<span class="ident" id="5458784"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><span class="op" id="5458786">.</span><span class="ident" id="5458787">Sub</span><span class="op" id="5458790">[</span><span class="num" id="5458791">0</span><span class="op" id="5458792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5458797"><a href="/regexp/syntax/parse.go.html#5458385">p</a></span><span class="op" id="5458798">.</span><span class="ident" id="5458799">reuse</span><span class="op" id="5458804">(</span><span class="ident" id="5458805"><a href="/regexp/syntax/parse.go.html#5458766">old</a></span><span class="op" id="5458808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458812">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5458815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5458818">return</span>&nbsp;<span class="ident" id="5458825"><a href="/regexp/syntax/parse.go.html#5458480">re</a></span><br>
<span class="lineno"></span><span class="op" id="5458828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5458831">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5458896">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5458962">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5459013">//</span><br>
<span class="lineno"></span><span class="comment" id="5459016">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5459032">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5459059">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5459105">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5459133">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5459188">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5459214">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5459217">func</span>&nbsp;<span class="op" id="5459222">(</span><span class="ident" id="5459223">p</span>&nbsp;<span class="op" id="5459225">*</span><span class="ident" id="5459226"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5459232">)</span>&nbsp;<span class="ident" id="5459234">factor</span><span class="op" id="5459240">(</span><span class="ident" id="5459241">sub</span>&nbsp;<span class="op" id="5459245">[</span><span class="op" id="5459246">]</span><span class="op" id="5459247">*</span><span class="ident" id="5459248"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5459254">,</span>&nbsp;<span class="ident" id="5459256">flags</span>&nbsp;<span class="ident" id="5459262"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5459267">)</span>&nbsp;<span class="op" id="5459269">[</span><span class="op" id="5459270">]</span><span class="op" id="5459271">*</span><span class="ident" id="5459272"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5459279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459282">if</span>&nbsp;<span class="builtinfunc" id="5459285">len</span><span class="op" id="5459288">(</span><span class="ident" id="5459289"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5459292">)</span>&nbsp;<span class="op" id="5459294">&lt;</span>&nbsp;<span class="num" id="5459296">2</span>&nbsp;<span class="op" id="5459298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459302">return</span>&nbsp;<span class="ident" id="5459309"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459318">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459367">var</span>&nbsp;<span class="ident" id="5459371">str</span>&nbsp;<span class="op" id="5459375">[</span><span class="op" id="5459376">]</span><span class="builtintype" id="5459377">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459383">var</span>&nbsp;<span class="ident" id="5459387">strflags</span>&nbsp;<span class="ident" id="5459396"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459403">start</span>&nbsp;<span class="op" id="5459409">:=</span>&nbsp;<span class="num" id="5459412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459415">out</span>&nbsp;<span class="op" id="5459419">:=</span>&nbsp;<span class="ident" id="5459422"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5459425">[</span><span class="op" id="5459426">:</span><span class="num" id="5459427">0</span><span class="op" id="5459428">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459431">for</span>&nbsp;<span class="ident" id="5459435">i</span>&nbsp;<span class="op" id="5459437">:=</span>&nbsp;<span class="num" id="5459440">0</span><span class="op" id="5459441">;</span>&nbsp;<span class="ident" id="5459443"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span>&nbsp;<span class="op" id="5459445">&lt;=</span>&nbsp;<span class="builtinfunc" id="5459448">len</span><span class="op" id="5459451">(</span><span class="ident" id="5459452"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5459455">)</span><span class="op" id="5459456">;</span>&nbsp;<span class="ident" id="5459458"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span><span class="op" id="5459459">++</span>&nbsp;<span class="op" id="5459462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459466">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459530">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459597">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459631">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459636">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459700">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459739">var</span>&nbsp;<span class="ident" id="5459743">istr</span>&nbsp;<span class="op" id="5459748">[</span><span class="op" id="5459749">]</span><span class="builtintype" id="5459750">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459757">var</span>&nbsp;<span class="ident" id="5459761">iflags</span>&nbsp;<span class="ident" id="5459768"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459776">if</span>&nbsp;<span class="ident" id="5459779"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span>&nbsp;<span class="op" id="5459781">&lt;</span>&nbsp;<span class="builtinfunc" id="5459783">len</span><span class="op" id="5459786">(</span><span class="ident" id="5459787"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5459790">)</span>&nbsp;<span class="op" id="5459792">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459797"><a href="/regexp/syntax/parse.go.html#5459743">istr</a></span><span class="op" id="5459801">,</span>&nbsp;<span class="ident" id="5459803"><a href="/regexp/syntax/parse.go.html#5459761">iflags</a></span>&nbsp;<span class="op" id="5459810">=</span>&nbsp;<span class="ident" id="5459812"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5459813">.</span><span class="ident" id="5459814">leadingString</span><span class="op" id="5459827">(</span><span class="ident" id="5459828"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5459831">[</span><span class="ident" id="5459832"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span><span class="op" id="5459833">]</span><span class="op" id="5459834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459839">if</span>&nbsp;<span class="ident" id="5459842"><a href="/regexp/syntax/parse.go.html#5459761">iflags</a></span>&nbsp;<span class="op" id="5459849">==</span>&nbsp;<span class="ident" id="5459852"><a href="/regexp/syntax/parse.go.html#5459387">strflags</a></span>&nbsp;<span class="op" id="5459861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459867">same</span>&nbsp;<span class="op" id="5459872">:=</span>&nbsp;<span class="num" id="5459875">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459881">for</span>&nbsp;<span class="ident" id="5459885"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span>&nbsp;<span class="op" id="5459890">&lt;</span>&nbsp;<span class="builtinfunc" id="5459892">len</span><span class="op" id="5459895">(</span><span class="ident" id="5459896"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span><span class="op" id="5459899">)</span>&nbsp;<span class="op" id="5459901">&amp;&amp;</span>&nbsp;<span class="ident" id="5459904"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span>&nbsp;<span class="op" id="5459909">&lt;</span>&nbsp;<span class="builtinfunc" id="5459911">len</span><span class="op" id="5459914">(</span><span class="ident" id="5459915"><a href="/regexp/syntax/parse.go.html#5459743">istr</a></span><span class="op" id="5459919">)</span>&nbsp;<span class="op" id="5459921">&amp;&amp;</span>&nbsp;<span class="ident" id="5459924"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span><span class="op" id="5459927">[</span><span class="ident" id="5459928"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span><span class="op" id="5459932">]</span>&nbsp;<span class="op" id="5459934">==</span>&nbsp;<span class="ident" id="5459937"><a href="/regexp/syntax/parse.go.html#5459743">istr</a></span><span class="op" id="5459941">[</span><span class="ident" id="5459942"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span><span class="op" id="5459946">]</span>&nbsp;<span class="op" id="5459948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5459955"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span><span class="op" id="5459959">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5459966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5459972">if</span>&nbsp;<span class="ident" id="5459975"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span>&nbsp;<span class="op" id="5459980">&gt;</span>&nbsp;<span class="num" id="5459982">0</span>&nbsp;<span class="op" id="5459984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5459991">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460043">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460070"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span>&nbsp;<span class="op" id="5460074">=</span>&nbsp;<span class="ident" id="5460076"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span><span class="op" id="5460079">[</span><span class="op" id="5460080">:</span><span class="ident" id="5460081"><a href="/regexp/syntax/parse.go.html#5459867">same</a></span><span class="op" id="5460085">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460119">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460179">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460240">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460278">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460283">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460352">if</span>&nbsp;<span class="ident" id="5460355"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span>&nbsp;<span class="op" id="5460357">==</span>&nbsp;<span class="ident" id="5460360"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5460366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460371">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460409">}</span>&nbsp;<span class="keyword" id="5460411">else</span>&nbsp;<span class="keyword" id="5460416">if</span>&nbsp;<span class="ident" id="5460419"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span>&nbsp;<span class="op" id="5460421">==</span>&nbsp;<span class="ident" id="5460424"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5460429">+</span><span class="num" id="5460430">1</span>&nbsp;<span class="op" id="5460432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460437">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460477"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5460481">=</span>&nbsp;<span class="builtinfunc" id="5460483">append</span><span class="op" id="5460489">(</span><span class="ident" id="5460490"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5460493">,</span>&nbsp;<span class="ident" id="5460495"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5460498">[</span><span class="ident" id="5460499"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5460504">]</span><span class="op" id="5460505">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460509">}</span>&nbsp;<span class="keyword" id="5460511">else</span>&nbsp;<span class="op" id="5460516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460521">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460580">prefix</span>&nbsp;<span class="op" id="5460587">:=</span>&nbsp;<span class="ident" id="5460590"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5460591">.</span><span class="ident" id="5460592">newRegexp</span><span class="op" id="5460601">(</span><span class="ident" id="5460602"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><span class="op" id="5460611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460616"><a href="/regexp/syntax/parse.go.html#5460580">prefix</a></span><span class="op" id="5460622">.</span><span class="ident" id="5460623">Flags</span>&nbsp;<span class="op" id="5460629">=</span>&nbsp;<span class="ident" id="5460631"><a href="/regexp/syntax/parse.go.html#5459387">strflags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460643"><a href="/regexp/syntax/parse.go.html#5460580">prefix</a></span><span class="op" id="5460649">.</span><span class="ident" id="5460650">Rune</span>&nbsp;<span class="op" id="5460655">=</span>&nbsp;<span class="builtinfunc" id="5460657">append</span><span class="op" id="5460663">(</span><span class="ident" id="5460664"><a href="/regexp/syntax/parse.go.html#5460580">prefix</a></span><span class="op" id="5460670">.</span><span class="ident" id="5460671">Rune</span><span class="op" id="5460675">[</span><span class="op" id="5460676">:</span><span class="num" id="5460677">0</span><span class="op" id="5460678">]</span><span class="op" id="5460679">,</span>&nbsp;<span class="ident" id="5460681"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span><span class="op" id="5460684">...</span><span class="op" id="5460687">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5460693">for</span>&nbsp;<span class="ident" id="5460697">j</span>&nbsp;<span class="op" id="5460699">:=</span>&nbsp;<span class="ident" id="5460702"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5460707">;</span>&nbsp;<span class="ident" id="5460709"><a href="/regexp/syntax/parse.go.html#5460697">j</a></span>&nbsp;<span class="op" id="5460711">&lt;</span>&nbsp;<span class="ident" id="5460713"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span><span class="op" id="5460714">;</span>&nbsp;<span class="ident" id="5460716"><a href="/regexp/syntax/parse.go.html#5460697">j</a></span><span class="op" id="5460717">++</span>&nbsp;<span class="op" id="5460720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460726"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5460729">[</span><span class="ident" id="5460730"><a href="/regexp/syntax/parse.go.html#5460697">j</a></span><span class="op" id="5460731">]</span>&nbsp;<span class="op" id="5460733">=</span>&nbsp;<span class="ident" id="5460735"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5460736">.</span><span class="ident" id="5460737">removeLeadingString</span><span class="op" id="5460756">(</span><span class="ident" id="5460757"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5460760">[</span><span class="ident" id="5460761"><a href="/regexp/syntax/parse.go.html#5460697">j</a></span><span class="op" id="5460762">]</span><span class="op" id="5460763">,</span>&nbsp;<span class="builtinfunc" id="5460765">len</span><span class="op" id="5460768">(</span><span class="ident" id="5460769"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span><span class="op" id="5460772">)</span><span class="op" id="5460773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460783">suffix</span>&nbsp;<span class="op" id="5460790">:=</span>&nbsp;<span class="ident" id="5460793"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5460794">.</span><span class="ident" id="5460795">collapse</span><span class="op" id="5460803">(</span><span class="ident" id="5460804"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5460807">[</span><span class="ident" id="5460808"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5460813">:</span><span class="ident" id="5460814"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span><span class="op" id="5460815">]</span><span class="op" id="5460816">,</span>&nbsp;<span class="ident" id="5460818"><a href="/regexp/syntax/regexp.go.html#5507236">OpAlternate</a></span><span class="op" id="5460829">)</span>&nbsp;<span class="comment" id="5460831">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460846">re</span>&nbsp;<span class="op" id="5460849">:=</span>&nbsp;<span class="ident" id="5460852"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5460853">.</span><span class="ident" id="5460854">newRegexp</span><span class="op" id="5460863">(</span><span class="ident" id="5460864"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span><span class="op" id="5460872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460877"><a href="/regexp/syntax/parse.go.html#5460846">re</a></span><span class="op" id="5460879">.</span><span class="ident" id="5460880">Sub</span>&nbsp;<span class="op" id="5460884">=</span>&nbsp;<span class="builtinfunc" id="5460886">append</span><span class="op" id="5460892">(</span><span class="ident" id="5460893"><a href="/regexp/syntax/parse.go.html#5460846">re</a></span><span class="op" id="5460895">.</span><span class="ident" id="5460896">Sub</span><span class="op" id="5460899">[</span><span class="op" id="5460900">:</span><span class="num" id="5460901">0</span><span class="op" id="5460902">]</span><span class="op" id="5460903">,</span>&nbsp;<span class="ident" id="5460905"><a href="/regexp/syntax/parse.go.html#5460580">prefix</a></span><span class="op" id="5460911">,</span>&nbsp;<span class="ident" id="5460913"><a href="/regexp/syntax/parse.go.html#5460783">suffix</a></span><span class="op" id="5460919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460924"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5460928">=</span>&nbsp;<span class="builtinfunc" id="5460930">append</span><span class="op" id="5460936">(</span><span class="ident" id="5460937"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5460940">,</span>&nbsp;<span class="ident" id="5460942"><a href="/regexp/syntax/parse.go.html#5460846">re</a></span><span class="op" id="5460944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5460948">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5460953">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460986"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5460992">=</span>&nbsp;<span class="ident" id="5460994"><a href="/regexp/syntax/parse.go.html#5459435">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460998"><a href="/regexp/syntax/parse.go.html#5459371">str</a></span>&nbsp;<span class="op" id="5461002">=</span>&nbsp;<span class="ident" id="5461004"><a href="/regexp/syntax/parse.go.html#5459743">istr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461011"><a href="/regexp/syntax/parse.go.html#5459387">strflags</a></span>&nbsp;<span class="op" id="5461020">=</span>&nbsp;<span class="ident" id="5461022"><a href="/regexp/syntax/parse.go.html#5459761">iflags</a></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461033"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span>&nbsp;<span class="op" id="5461037">=</span>&nbsp;<span class="ident" id="5461039"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461045">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461094">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461142">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461202"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5461208">=</span>&nbsp;<span class="num" id="5461210">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461213"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5461217">=</span>&nbsp;<span class="ident" id="5461219"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5461222">[</span><span class="op" id="5461223">:</span><span class="num" id="5461224">0</span><span class="op" id="5461225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461228">var</span>&nbsp;<span class="ident" id="5461232">first</span>&nbsp;<span class="op" id="5461238">*</span><span class="ident" id="5461239"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461247">for</span>&nbsp;<span class="ident" id="5461251">i</span>&nbsp;<span class="op" id="5461253">:=</span>&nbsp;<span class="num" id="5461256">0</span><span class="op" id="5461257">;</span>&nbsp;<span class="ident" id="5461259"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span>&nbsp;<span class="op" id="5461261">&lt;=</span>&nbsp;<span class="builtinfunc" id="5461264">len</span><span class="op" id="5461267">(</span><span class="ident" id="5461268"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5461271">)</span><span class="op" id="5461272">;</span>&nbsp;<span class="ident" id="5461274"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span><span class="op" id="5461275">++</span>&nbsp;<span class="op" id="5461278">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461282">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461346">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461413">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461447">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461452">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461529">var</span>&nbsp;<span class="ident" id="5461533">ifirst</span>&nbsp;<span class="op" id="5461540">*</span><span class="ident" id="5461541"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461550">if</span>&nbsp;<span class="ident" id="5461553"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span>&nbsp;<span class="op" id="5461555">&lt;</span>&nbsp;<span class="builtinfunc" id="5461557">len</span><span class="op" id="5461560">(</span><span class="ident" id="5461561"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5461564">)</span>&nbsp;<span class="op" id="5461566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461571"><a href="/regexp/syntax/parse.go.html#5461533">ifirst</a></span>&nbsp;<span class="op" id="5461578">=</span>&nbsp;<span class="ident" id="5461580"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5461581">.</span><span class="ident" id="5461582">leadingRegexp</span><span class="op" id="5461595">(</span><span class="ident" id="5461596"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5461599">[</span><span class="ident" id="5461600"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span><span class="op" id="5461601">]</span><span class="op" id="5461602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461607">if</span>&nbsp;<span class="ident" id="5461610"><a href="/regexp/syntax/parse.go.html#5461232">first</a></span>&nbsp;<span class="op" id="5461616">!=</span>&nbsp;<span class="ident" id="5461619">nil</span>&nbsp;<span class="op" id="5461623">&amp;&amp;</span>&nbsp;<span class="ident" id="5461626"><a href="/regexp/syntax/parse.go.html#5461232">first</a></span><span class="op" id="5461631">.</span><span class="ident" id="5461632">Equal</span><span class="op" id="5461637">(</span><span class="ident" id="5461638"><a href="/regexp/syntax/parse.go.html#5461533">ifirst</a></span><span class="op" id="5461644">)</span>&nbsp;<span class="op" id="5461646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461652">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461673">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461725">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461785">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461790">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461859">if</span>&nbsp;<span class="ident" id="5461862"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span>&nbsp;<span class="op" id="5461864">==</span>&nbsp;<span class="ident" id="5461867"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5461873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461878">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461916">}</span>&nbsp;<span class="keyword" id="5461918">else</span>&nbsp;<span class="keyword" id="5461923">if</span>&nbsp;<span class="ident" id="5461926"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span>&nbsp;<span class="op" id="5461928">==</span>&nbsp;<span class="ident" id="5461931"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5461936">+</span><span class="num" id="5461937">1</span>&nbsp;<span class="op" id="5461939">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5461944">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461984"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5461988">=</span>&nbsp;<span class="builtinfunc" id="5461990">append</span><span class="op" id="5461996">(</span><span class="ident" id="5461997"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5462000">,</span>&nbsp;<span class="ident" id="5462002"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462005">[</span><span class="ident" id="5462006"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5462011">]</span><span class="op" id="5462012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462016">}</span>&nbsp;<span class="keyword" id="5462018">else</span>&nbsp;<span class="op" id="5462023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462028">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462087">prefix</span>&nbsp;<span class="op" id="5462094">:=</span>&nbsp;<span class="ident" id="5462097"><a href="/regexp/syntax/parse.go.html#5461232">first</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462106">for</span>&nbsp;<span class="ident" id="5462110">j</span>&nbsp;<span class="op" id="5462112">:=</span>&nbsp;<span class="ident" id="5462115"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5462120">;</span>&nbsp;<span class="ident" id="5462122"><a href="/regexp/syntax/parse.go.html#5462110">j</a></span>&nbsp;<span class="op" id="5462124">&lt;</span>&nbsp;<span class="ident" id="5462126"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span><span class="op" id="5462127">;</span>&nbsp;<span class="ident" id="5462129"><a href="/regexp/syntax/parse.go.html#5462110">j</a></span><span class="op" id="5462130">++</span>&nbsp;<span class="op" id="5462133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462139">reuse</span>&nbsp;<span class="op" id="5462145">:=</span>&nbsp;<span class="ident" id="5462148"><a href="/regexp/syntax/parse.go.html#5462110">j</a></span>&nbsp;<span class="op" id="5462150">!=</span>&nbsp;<span class="ident" id="5462153"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="comment" id="5462159">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462194"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462197">[</span><span class="ident" id="5462198"><a href="/regexp/syntax/parse.go.html#5462110">j</a></span><span class="op" id="5462199">]</span>&nbsp;<span class="op" id="5462201">=</span>&nbsp;<span class="ident" id="5462203"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5462204">.</span><span class="ident" id="5462205">removeLeadingRegexp</span><span class="op" id="5462224">(</span><span class="ident" id="5462225"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462228">[</span><span class="ident" id="5462229"><a href="/regexp/syntax/parse.go.html#5462110">j</a></span><span class="op" id="5462230">]</span><span class="op" id="5462231">,</span>&nbsp;<span class="ident" id="5462233"><a href="/regexp/syntax/parse.go.html#5462139">reuse</a></span><span class="op" id="5462238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462248">suffix</span>&nbsp;<span class="op" id="5462255">:=</span>&nbsp;<span class="ident" id="5462258"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5462259">.</span><span class="ident" id="5462260">collapse</span><span class="op" id="5462268">(</span><span class="ident" id="5462269"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462272">[</span><span class="ident" id="5462273"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5462278">:</span><span class="ident" id="5462279"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span><span class="op" id="5462280">]</span><span class="op" id="5462281">,</span>&nbsp;<span class="ident" id="5462283"><a href="/regexp/syntax/regexp.go.html#5507236">OpAlternate</a></span><span class="op" id="5462294">)</span>&nbsp;<span class="comment" id="5462296">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462311">re</span>&nbsp;<span class="op" id="5462314">:=</span>&nbsp;<span class="ident" id="5462317"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5462318">.</span><span class="ident" id="5462319">newRegexp</span><span class="op" id="5462328">(</span><span class="ident" id="5462329"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span><span class="op" id="5462337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462342"><a href="/regexp/syntax/parse.go.html#5462311">re</a></span><span class="op" id="5462344">.</span><span class="ident" id="5462345">Sub</span>&nbsp;<span class="op" id="5462349">=</span>&nbsp;<span class="builtinfunc" id="5462351">append</span><span class="op" id="5462357">(</span><span class="ident" id="5462358"><a href="/regexp/syntax/parse.go.html#5462311">re</a></span><span class="op" id="5462360">.</span><span class="ident" id="5462361">Sub</span><span class="op" id="5462364">[</span><span class="op" id="5462365">:</span><span class="num" id="5462366">0</span><span class="op" id="5462367">]</span><span class="op" id="5462368">,</span>&nbsp;<span class="ident" id="5462370"><a href="/regexp/syntax/parse.go.html#5462087">prefix</a></span><span class="op" id="5462376">,</span>&nbsp;<span class="ident" id="5462378"><a href="/regexp/syntax/parse.go.html#5462248">suffix</a></span><span class="op" id="5462384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462389"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5462393">=</span>&nbsp;<span class="builtinfunc" id="5462395">append</span><span class="op" id="5462401">(</span><span class="ident" id="5462402"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5462405">,</span>&nbsp;<span class="ident" id="5462407"><a href="/regexp/syntax/parse.go.html#5462311">re</a></span><span class="op" id="5462409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462413">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462418">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462451"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5462457">=</span>&nbsp;<span class="ident" id="5462459"><a href="/regexp/syntax/parse.go.html#5461251">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462463"><a href="/regexp/syntax/parse.go.html#5461232">first</a></span>&nbsp;<span class="op" id="5462469">=</span>&nbsp;<span class="ident" id="5462471"><a href="/regexp/syntax/parse.go.html#5461533">ifirst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462479">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462482"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span>&nbsp;<span class="op" id="5462486">=</span>&nbsp;<span class="ident" id="5462488"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462494">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462564"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5462570">=</span>&nbsp;<span class="num" id="5462572">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462575"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5462579">=</span>&nbsp;<span class="ident" id="5462581"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462584">[</span><span class="op" id="5462585">:</span><span class="num" id="5462586">0</span><span class="op" id="5462587">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462590">for</span>&nbsp;<span class="ident" id="5462594">i</span>&nbsp;<span class="op" id="5462596">:=</span>&nbsp;<span class="num" id="5462599">0</span><span class="op" id="5462600">;</span>&nbsp;<span class="ident" id="5462602"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5462604">&lt;=</span>&nbsp;<span class="builtinfunc" id="5462607">len</span><span class="op" id="5462610">(</span><span class="ident" id="5462611"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462614">)</span><span class="op" id="5462615">;</span>&nbsp;<span class="ident" id="5462617"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span><span class="op" id="5462618">++</span>&nbsp;<span class="op" id="5462621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462625">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462689">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462756">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462790">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462795">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462860">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462901">if</span>&nbsp;<span class="ident" id="5462904"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5462906">&lt;</span>&nbsp;<span class="builtinfunc" id="5462908">len</span><span class="op" id="5462911">(</span><span class="ident" id="5462912"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462915">)</span>&nbsp;<span class="op" id="5462917">&amp;&amp;</span>&nbsp;<span class="ident" id="5462920"><a href="/regexp/syntax/parse.go.html#5475229">isCharClass</a></span><span class="op" id="5462931">(</span><span class="ident" id="5462932"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5462935">[</span><span class="ident" id="5462936"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span><span class="op" id="5462937">]</span><span class="op" id="5462938">)</span>&nbsp;<span class="op" id="5462940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462945">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462956">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5462961">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463002">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463043">if</span>&nbsp;<span class="ident" id="5463046"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5463048">==</span>&nbsp;<span class="ident" id="5463051"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5463057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463062">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463100">}</span>&nbsp;<span class="keyword" id="5463102">else</span>&nbsp;<span class="keyword" id="5463107">if</span>&nbsp;<span class="ident" id="5463110"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5463112">==</span>&nbsp;<span class="ident" id="5463115"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463120">+</span><span class="num" id="5463121">1</span>&nbsp;<span class="op" id="5463123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463128"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5463132">=</span>&nbsp;<span class="builtinfunc" id="5463134">append</span><span class="op" id="5463140">(</span><span class="ident" id="5463141"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5463144">,</span>&nbsp;<span class="ident" id="5463146"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463149">[</span><span class="ident" id="5463150"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463155">]</span><span class="op" id="5463156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463160">}</span>&nbsp;<span class="keyword" id="5463162">else</span>&nbsp;<span class="op" id="5463167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463172">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463199">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463251">max</span>&nbsp;<span class="op" id="5463255">:=</span>&nbsp;<span class="ident" id="5463258"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463267">for</span>&nbsp;<span class="ident" id="5463271">j</span>&nbsp;<span class="op" id="5463273">:=</span>&nbsp;<span class="ident" id="5463276"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5463282">+</span>&nbsp;<span class="num" id="5463284">1</span><span class="op" id="5463285">;</span>&nbsp;<span class="ident" id="5463287"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span>&nbsp;<span class="op" id="5463289">&lt;</span>&nbsp;<span class="ident" id="5463291"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span><span class="op" id="5463292">;</span>&nbsp;<span class="ident" id="5463294"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span><span class="op" id="5463295">++</span>&nbsp;<span class="op" id="5463298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463304">if</span>&nbsp;<span class="ident" id="5463307"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463310">[</span><span class="ident" id="5463311"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span><span class="op" id="5463314">]</span><span class="op" id="5463315">.</span><span class="ident" id="5463316">Op</span>&nbsp;<span class="op" id="5463319">&lt;</span>&nbsp;<span class="ident" id="5463321"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463324">[</span><span class="ident" id="5463325"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span><span class="op" id="5463326">]</span><span class="op" id="5463327">.</span><span class="ident" id="5463328">Op</span>&nbsp;<span class="op" id="5463331">||</span>&nbsp;<span class="ident" id="5463334"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463337">[</span><span class="ident" id="5463338"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span><span class="op" id="5463341">]</span><span class="op" id="5463342">.</span><span class="ident" id="5463343">Op</span>&nbsp;<span class="op" id="5463346">==</span>&nbsp;<span class="ident" id="5463349"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463352">[</span><span class="ident" id="5463353"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span><span class="op" id="5463354">]</span><span class="op" id="5463355">.</span><span class="ident" id="5463356">Op</span>&nbsp;<span class="op" id="5463359">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5463362">len</span><span class="op" id="5463365">(</span><span class="ident" id="5463366"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463369">[</span><span class="ident" id="5463370"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span><span class="op" id="5463373">]</span><span class="op" id="5463374">.</span><span class="ident" id="5463375">Rune</span><span class="op" id="5463379">)</span>&nbsp;<span class="op" id="5463381">&lt;</span>&nbsp;<span class="builtinfunc" id="5463383">len</span><span class="op" id="5463386">(</span><span class="ident" id="5463387"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463390">[</span><span class="ident" id="5463391"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span><span class="op" id="5463392">]</span><span class="op" id="5463393">.</span><span class="ident" id="5463394">Rune</span><span class="op" id="5463398">)</span>&nbsp;<span class="op" id="5463400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463407"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span>&nbsp;<span class="op" id="5463411">=</span>&nbsp;<span class="ident" id="5463413"><a href="/regexp/syntax/parse.go.html#5463271">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463419">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463429"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463432">[</span><span class="ident" id="5463433"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463438">]</span><span class="op" id="5463439">,</span>&nbsp;<span class="ident" id="5463441"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463444">[</span><span class="ident" id="5463445"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span><span class="op" id="5463448">]</span>&nbsp;<span class="op" id="5463450">=</span>&nbsp;<span class="ident" id="5463452"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463455">[</span><span class="ident" id="5463456"><a href="/regexp/syntax/parse.go.html#5463251">max</a></span><span class="op" id="5463459">]</span><span class="op" id="5463460">,</span>&nbsp;<span class="ident" id="5463462"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463465">[</span><span class="ident" id="5463466"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463471">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463477">for</span>&nbsp;<span class="ident" id="5463481">j</span>&nbsp;<span class="op" id="5463483">:=</span>&nbsp;<span class="ident" id="5463486"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5463492">+</span>&nbsp;<span class="num" id="5463494">1</span><span class="op" id="5463495">;</span>&nbsp;<span class="ident" id="5463497"><a href="/regexp/syntax/parse.go.html#5463481">j</a></span>&nbsp;<span class="op" id="5463499">&lt;</span>&nbsp;<span class="ident" id="5463501"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span><span class="op" id="5463502">;</span>&nbsp;<span class="ident" id="5463504"><a href="/regexp/syntax/parse.go.html#5463481">j</a></span><span class="op" id="5463505">++</span>&nbsp;<span class="op" id="5463508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463514"><a href="/regexp/syntax/parse.go.html#5476281">mergeCharClass</a></span><span class="op" id="5463528">(</span><span class="ident" id="5463529"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463532">[</span><span class="ident" id="5463533"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463538">]</span><span class="op" id="5463539">,</span>&nbsp;<span class="ident" id="5463541"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463544">[</span><span class="ident" id="5463545"><a href="/regexp/syntax/parse.go.html#5463481">j</a></span><span class="op" id="5463546">]</span><span class="op" id="5463547">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463553"><a href="/regexp/syntax/parse.go.html#5459223">p</a></span><span class="op" id="5463554">.</span><span class="ident" id="5463555">reuse</span><span class="op" id="5463560">(</span><span class="ident" id="5463561"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463564">[</span><span class="ident" id="5463565"><a href="/regexp/syntax/parse.go.html#5463481">j</a></span><span class="op" id="5463566">]</span><span class="op" id="5463567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463577"><a href="/regexp/syntax/parse.go.html#5457606">cleanAlt</a></span><span class="op" id="5463585">(</span><span class="ident" id="5463586"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463589">[</span><span class="ident" id="5463590"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463595">]</span><span class="op" id="5463596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463601"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5463605">=</span>&nbsp;<span class="builtinfunc" id="5463607">append</span><span class="op" id="5463613">(</span><span class="ident" id="5463614"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5463617">,</span>&nbsp;<span class="ident" id="5463619"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463622">[</span><span class="ident" id="5463623"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span><span class="op" id="5463628">]</span><span class="op" id="5463629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463633">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463638">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463669">if</span>&nbsp;<span class="ident" id="5463672"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5463674">&lt;</span>&nbsp;<span class="builtinfunc" id="5463676">len</span><span class="op" id="5463679">(</span><span class="ident" id="5463680"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463683">)</span>&nbsp;<span class="op" id="5463685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463690"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5463694">=</span>&nbsp;<span class="builtinfunc" id="5463696">append</span><span class="op" id="5463702">(</span><span class="ident" id="5463703"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5463706">,</span>&nbsp;<span class="ident" id="5463708"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463711">[</span><span class="ident" id="5463712"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span><span class="op" id="5463713">]</span><span class="op" id="5463714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463718">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463722"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5463728">=</span>&nbsp;<span class="ident" id="5463730"><a href="/regexp/syntax/parse.go.html#5462594">i</a></span>&nbsp;<span class="op" id="5463732">+</span>&nbsp;<span class="num" id="5463734">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463740"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span>&nbsp;<span class="op" id="5463744">=</span>&nbsp;<span class="ident" id="5463746"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5463752">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463823"><a href="/regexp/syntax/parse.go.html#5459403">start</a></span>&nbsp;<span class="op" id="5463829">=</span>&nbsp;<span class="num" id="5463831">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463834"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5463838">=</span>&nbsp;<span class="ident" id="5463840"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463843">[</span><span class="op" id="5463844">:</span><span class="num" id="5463845">0</span><span class="op" id="5463846">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463849">for</span>&nbsp;<span class="ident" id="5463853">i</span>&nbsp;<span class="op" id="5463855">:=</span>&nbsp;<span class="keyword" id="5463858">range</span>&nbsp;<span class="ident" id="5463864"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span>&nbsp;<span class="op" id="5463868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463872">if</span>&nbsp;<span class="ident" id="5463875"><a href="/regexp/syntax/parse.go.html#5463853">i</a></span><span class="op" id="5463876">+</span><span class="num" id="5463877">1</span>&nbsp;<span class="op" id="5463879">&lt;</span>&nbsp;<span class="builtinfunc" id="5463881">len</span><span class="op" id="5463884">(</span><span class="ident" id="5463885"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463888">)</span>&nbsp;<span class="op" id="5463890">&amp;&amp;</span>&nbsp;<span class="ident" id="5463893"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463896">[</span><span class="ident" id="5463897"><a href="/regexp/syntax/parse.go.html#5463853">i</a></span><span class="op" id="5463898">]</span><span class="op" id="5463899">.</span><span class="ident" id="5463900">Op</span>&nbsp;<span class="op" id="5463903">==</span>&nbsp;<span class="ident" id="5463906"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span>&nbsp;<span class="op" id="5463919">&amp;&amp;</span>&nbsp;<span class="ident" id="5463922"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463925">[</span><span class="ident" id="5463926"><a href="/regexp/syntax/parse.go.html#5463853">i</a></span><span class="op" id="5463927">+</span><span class="num" id="5463928">1</span><span class="op" id="5463929">]</span><span class="op" id="5463930">.</span><span class="ident" id="5463931">Op</span>&nbsp;<span class="op" id="5463934">==</span>&nbsp;<span class="ident" id="5463937"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span>&nbsp;<span class="op" id="5463950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5463955">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5463970"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span>&nbsp;<span class="op" id="5463974">=</span>&nbsp;<span class="builtinfunc" id="5463976">append</span><span class="op" id="5463982">(</span><span class="ident" id="5463983"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><span class="op" id="5463986">,</span>&nbsp;<span class="ident" id="5463988"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><span class="op" id="5463991">[</span><span class="ident" id="5463992"><a href="/regexp/syntax/parse.go.html#5463853">i</a></span><span class="op" id="5463993">]</span><span class="op" id="5463994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5463997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464000"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span>&nbsp;<span class="op" id="5464004">=</span>&nbsp;<span class="ident" id="5464006"><a href="/regexp/syntax/parse.go.html#5459415">out</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464012">return</span>&nbsp;<span class="ident" id="5464019"><a href="/regexp/syntax/parse.go.html#5459241">sub</a></span><br>
<span class="lineno"></span><span class="op" id="5464023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5464026">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5464099">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5464154">func</span>&nbsp;<span class="op" id="5464159">(</span><span class="ident" id="5464160">p</span>&nbsp;<span class="op" id="5464162">*</span><span class="ident" id="5464163"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5464169">)</span>&nbsp;<span class="ident" id="5464171">leadingString</span><span class="op" id="5464184">(</span><span class="ident" id="5464185">re</span>&nbsp;<span class="op" id="5464188">*</span><span class="ident" id="5464189"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5464195">)</span>&nbsp;<span class="op" id="5464197">(</span><span class="op" id="5464198">[</span><span class="op" id="5464199">]</span><span class="builtintype" id="5464200">rune</span><span class="op" id="5464204">,</span>&nbsp;<span class="ident" id="5464206"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5464211">)</span>&nbsp;<span class="op" id="5464213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464216">if</span>&nbsp;<span class="ident" id="5464219"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464221">.</span><span class="ident" id="5464222">Op</span>&nbsp;<span class="op" id="5464225">==</span>&nbsp;<span class="ident" id="5464228"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span>&nbsp;<span class="op" id="5464237">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5464240">len</span><span class="op" id="5464243">(</span><span class="ident" id="5464244"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464246">.</span><span class="ident" id="5464247">Sub</span><span class="op" id="5464250">)</span>&nbsp;<span class="op" id="5464252">&gt;</span>&nbsp;<span class="num" id="5464254">0</span>&nbsp;<span class="op" id="5464256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464260"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span>&nbsp;<span class="op" id="5464263">=</span>&nbsp;<span class="ident" id="5464265"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464267">.</span><span class="ident" id="5464268">Sub</span><span class="op" id="5464271">[</span><span class="num" id="5464272">0</span><span class="op" id="5464273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5464276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464279">if</span>&nbsp;<span class="ident" id="5464282"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464284">.</span><span class="ident" id="5464285">Op</span>&nbsp;<span class="op" id="5464288">!=</span>&nbsp;<span class="ident" id="5464291"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5464301">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464305">return</span>&nbsp;<span class="ident" id="5464312">nil</span><span class="op" id="5464315">,</span>&nbsp;<span class="num" id="5464317">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5464320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464323">return</span>&nbsp;<span class="ident" id="5464330"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464332">.</span><span class="ident" id="5464333">Rune</span><span class="op" id="5464337">,</span>&nbsp;<span class="ident" id="5464339"><a href="/regexp/syntax/parse.go.html#5464185">re</a></span><span class="op" id="5464341">.</span><span class="ident" id="5464342">Flags</span>&nbsp;<span class="op" id="5464348">&amp;</span>&nbsp;<span class="ident" id="5464350"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><br>
<span class="lineno"></span><span class="op" id="5464359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5464362">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5464419">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5464484">func</span>&nbsp;<span class="op" id="5464489">(</span><span class="ident" id="5464490">p</span>&nbsp;<span class="op" id="5464492">*</span><span class="ident" id="5464493"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5464499">)</span>&nbsp;<span class="ident" id="5464501">removeLeadingString</span><span class="op" id="5464520">(</span><span class="ident" id="5464521">re</span>&nbsp;<span class="op" id="5464524">*</span><span class="ident" id="5464525"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5464531">,</span>&nbsp;<span class="ident" id="5464533">n</span>&nbsp;<span class="builtintype" id="5464535">int</span><span class="op" id="5464538">)</span>&nbsp;<span class="op" id="5464540">*</span><span class="ident" id="5464541"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5464548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464551">if</span>&nbsp;<span class="ident" id="5464554"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464556">.</span><span class="ident" id="5464557">Op</span>&nbsp;<span class="op" id="5464560">==</span>&nbsp;<span class="ident" id="5464563"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span>&nbsp;<span class="op" id="5464572">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5464575">len</span><span class="op" id="5464578">(</span><span class="ident" id="5464579"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464581">.</span><span class="ident" id="5464582">Sub</span><span class="op" id="5464585">)</span>&nbsp;<span class="op" id="5464587">&gt;</span>&nbsp;<span class="num" id="5464589">0</span>&nbsp;<span class="op" id="5464591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464595">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464645">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464684">sub</span>&nbsp;<span class="op" id="5464688">:=</span>&nbsp;<span class="ident" id="5464691"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464693">.</span><span class="ident" id="5464694">Sub</span><span class="op" id="5464697">[</span><span class="num" id="5464698">0</span><span class="op" id="5464699">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464703"><a href="/regexp/syntax/parse.go.html#5464684">sub</a></span>&nbsp;<span class="op" id="5464707">=</span>&nbsp;<span class="ident" id="5464709"><a href="/regexp/syntax/parse.go.html#5464490">p</a></span><span class="op" id="5464710">.</span><span class="ident" id="5464711">removeLeadingString</span><span class="op" id="5464730">(</span><span class="ident" id="5464731"><a href="/regexp/syntax/parse.go.html#5464684">sub</a></span><span class="op" id="5464734">,</span>&nbsp;<span class="ident" id="5464736"><a href="/regexp/syntax/parse.go.html#5464533">n</a></span><span class="op" id="5464737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464741"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464743">.</span><span class="ident" id="5464744">Sub</span><span class="op" id="5464747">[</span><span class="num" id="5464748">0</span><span class="op" id="5464749">]</span>&nbsp;<span class="op" id="5464751">=</span>&nbsp;<span class="ident" id="5464753"><a href="/regexp/syntax/parse.go.html#5464684">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464759">if</span>&nbsp;<span class="ident" id="5464762"><a href="/regexp/syntax/parse.go.html#5464684">sub</a></span><span class="op" id="5464765">.</span><span class="ident" id="5464766">Op</span>&nbsp;<span class="op" id="5464769">==</span>&nbsp;<span class="ident" id="5464772"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span>&nbsp;<span class="op" id="5464785">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464790"><a href="/regexp/syntax/parse.go.html#5464490">p</a></span><span class="op" id="5464791">.</span><span class="ident" id="5464792">reuse</span><span class="op" id="5464797">(</span><span class="ident" id="5464798"><a href="/regexp/syntax/parse.go.html#5464684">sub</a></span><span class="op" id="5464801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464806">switch</span>&nbsp;<span class="builtinfunc" id="5464813">len</span><span class="op" id="5464816">(</span><span class="ident" id="5464817"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464819">.</span><span class="ident" id="5464820">Sub</span><span class="op" id="5464823">)</span>&nbsp;<span class="op" id="5464825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464830">case</span>&nbsp;<span class="num" id="5464835">0</span><span class="op" id="5464836">,</span>&nbsp;<span class="num" id="5464838">1</span><span class="op" id="5464839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5464845">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464875"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464877">.</span><span class="ident" id="5464878">Op</span>&nbsp;<span class="op" id="5464881">=</span>&nbsp;<span class="ident" id="5464883"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464900"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464902">.</span><span class="ident" id="5464903">Sub</span>&nbsp;<span class="op" id="5464907">=</span>&nbsp;<span class="ident" id="5464909">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464916">case</span>&nbsp;<span class="num" id="5464921">2</span><span class="op" id="5464922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464928">old</span>&nbsp;<span class="op" id="5464932">:=</span>&nbsp;<span class="ident" id="5464935"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464942"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span>&nbsp;<span class="op" id="5464945">=</span>&nbsp;<span class="ident" id="5464947"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464949">.</span><span class="ident" id="5464950">Sub</span><span class="op" id="5464953">[</span><span class="num" id="5464954">1</span><span class="op" id="5464955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5464961"><a href="/regexp/syntax/parse.go.html#5464490">p</a></span><span class="op" id="5464962">.</span><span class="ident" id="5464963">reuse</span><span class="op" id="5464968">(</span><span class="ident" id="5464969"><a href="/regexp/syntax/parse.go.html#5464928">old</a></span><span class="op" id="5464972">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5464977">default</span><span class="op" id="5464984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5464990">copy</span><span class="op" id="5464994">(</span><span class="ident" id="5464995"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5464997">.</span><span class="ident" id="5464998">Sub</span><span class="op" id="5465001">,</span>&nbsp;<span class="ident" id="5465003"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465005">.</span><span class="ident" id="5465006">Sub</span><span class="op" id="5465009">[</span><span class="num" id="5465010">1</span><span class="op" id="5465011">:</span><span class="op" id="5465012">]</span><span class="op" id="5465013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465019"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465021">.</span><span class="ident" id="5465022">Sub</span>&nbsp;<span class="op" id="5465026">=</span>&nbsp;<span class="ident" id="5465028"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465030">.</span><span class="ident" id="5465031">Sub</span><span class="op" id="5465034">[</span><span class="op" id="5465035">:</span><span class="builtinfunc" id="5465036">len</span><span class="op" id="5465039">(</span><span class="ident" id="5465040"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465042">.</span><span class="ident" id="5465043">Sub</span><span class="op" id="5465046">)</span><span class="op" id="5465047">-</span><span class="num" id="5465048">1</span><span class="op" id="5465049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465058">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465062">return</span>&nbsp;<span class="ident" id="5465069"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465077">if</span>&nbsp;<span class="ident" id="5465080"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465082">.</span><span class="ident" id="5465083">Op</span>&nbsp;<span class="op" id="5465086">==</span>&nbsp;<span class="ident" id="5465089"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5465099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465103"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465105">.</span><span class="ident" id="5465106">Rune</span>&nbsp;<span class="op" id="5465111">=</span>&nbsp;<span class="ident" id="5465113"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465115">.</span><span class="ident" id="5465116">Rune</span><span class="op" id="5465120">[</span><span class="op" id="5465121">:</span><span class="builtinfunc" id="5465122">copy</span><span class="op" id="5465126">(</span><span class="ident" id="5465127"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465129">.</span><span class="ident" id="5465130">Rune</span><span class="op" id="5465134">,</span>&nbsp;<span class="ident" id="5465136"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465138">.</span><span class="ident" id="5465139">Rune</span><span class="op" id="5465143">[</span><span class="ident" id="5465144"><a href="/regexp/syntax/parse.go.html#5464533">n</a></span><span class="op" id="5465145">:</span><span class="op" id="5465146">]</span><span class="op" id="5465147">)</span><span class="op" id="5465148">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465152">if</span>&nbsp;<span class="builtinfunc" id="5465155">len</span><span class="op" id="5465158">(</span><span class="ident" id="5465159"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465161">.</span><span class="ident" id="5465162">Rune</span><span class="op" id="5465166">)</span>&nbsp;<span class="op" id="5465168">==</span>&nbsp;<span class="num" id="5465171">0</span>&nbsp;<span class="op" id="5465173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465178"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><span class="op" id="5465180">.</span><span class="ident" id="5465181">Op</span>&nbsp;<span class="op" id="5465184">=</span>&nbsp;<span class="ident" id="5465186"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465207">return</span>&nbsp;<span class="ident" id="5465214"><a href="/regexp/syntax/parse.go.html#5464521">re</a></span><br>
<span class="lineno">630</span><span class="op" id="5465217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5465220">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5465285">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5465340">func</span>&nbsp;<span class="op" id="5465345">(</span><span class="ident" id="5465346">p</span>&nbsp;<span class="op" id="5465348">*</span><span class="ident" id="5465349"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5465355">)</span>&nbsp;<span class="ident" id="5465357">leadingRegexp</span><span class="op" id="5465370">(</span><span class="ident" id="5465371">re</span>&nbsp;<span class="op" id="5465374">*</span><span class="ident" id="5465375"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5465381">)</span>&nbsp;<span class="op" id="5465383">*</span><span class="ident" id="5465384"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5465391">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465394">if</span>&nbsp;<span class="ident" id="5465397"><a href="/regexp/syntax/parse.go.html#5465371">re</a></span><span class="op" id="5465399">.</span><span class="ident" id="5465400">Op</span>&nbsp;<span class="op" id="5465403">==</span>&nbsp;<span class="ident" id="5465406"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span>&nbsp;<span class="op" id="5465419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465423">return</span>&nbsp;<span class="ident" id="5465430">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465438">if</span>&nbsp;<span class="ident" id="5465441"><a href="/regexp/syntax/parse.go.html#5465371">re</a></span><span class="op" id="5465443">.</span><span class="ident" id="5465444">Op</span>&nbsp;<span class="op" id="5465447">==</span>&nbsp;<span class="ident" id="5465450"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span>&nbsp;<span class="op" id="5465459">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5465462">len</span><span class="op" id="5465465">(</span><span class="ident" id="5465466"><a href="/regexp/syntax/parse.go.html#5465371">re</a></span><span class="op" id="5465468">.</span><span class="ident" id="5465469">Sub</span><span class="op" id="5465472">)</span>&nbsp;<span class="op" id="5465474">&gt;</span>&nbsp;<span class="num" id="5465476">0</span>&nbsp;<span class="op" id="5465478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465482">sub</span>&nbsp;<span class="op" id="5465486">:=</span>&nbsp;<span class="ident" id="5465489"><a href="/regexp/syntax/parse.go.html#5465371">re</a></span><span class="op" id="5465491">.</span><span class="ident" id="5465492">Sub</span><span class="op" id="5465495">[</span><span class="num" id="5465496">0</span><span class="op" id="5465497">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465501">if</span>&nbsp;<span class="ident" id="5465504"><a href="/regexp/syntax/parse.go.html#5465482">sub</a></span><span class="op" id="5465507">.</span><span class="ident" id="5465508">Op</span>&nbsp;<span class="op" id="5465511">==</span>&nbsp;<span class="ident" id="5465514"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span>&nbsp;<span class="op" id="5465527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465532">return</span>&nbsp;<span class="ident" id="5465539">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465549">return</span>&nbsp;<span class="ident" id="5465556"><a href="/regexp/syntax/parse.go.html#5465482">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465561">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465564">return</span>&nbsp;<span class="ident" id="5465571"><a href="/regexp/syntax/parse.go.html#5465371">re</a></span><br>
<span class="lineno"></span><span class="op" id="5465574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5465577">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5465634">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5465672">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5465756">func</span>&nbsp;<span class="op" id="5465761">(</span><span class="ident" id="5465762">p</span>&nbsp;<span class="op" id="5465764">*</span><span class="ident" id="5465765"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5465771">)</span>&nbsp;<span class="ident" id="5465773">removeLeadingRegexp</span><span class="op" id="5465792">(</span><span class="ident" id="5465793">re</span>&nbsp;<span class="op" id="5465796">*</span><span class="ident" id="5465797"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5465803">,</span>&nbsp;<span class="ident" id="5465805">reuse</span>&nbsp;<span class="builtintype" id="5465811">bool</span><span class="op" id="5465815">)</span>&nbsp;<span class="op" id="5465817">*</span><span class="ident" id="5465818"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5465825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465828">if</span>&nbsp;<span class="ident" id="5465831"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465833">.</span><span class="ident" id="5465834">Op</span>&nbsp;<span class="op" id="5465837">==</span>&nbsp;<span class="ident" id="5465840"><a href="/regexp/syntax/regexp.go.html#5507171">OpConcat</a></span>&nbsp;<span class="op" id="5465849">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5465852">len</span><span class="op" id="5465855">(</span><span class="ident" id="5465856"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465858">.</span><span class="ident" id="5465859">Sub</span><span class="op" id="5465862">)</span>&nbsp;<span class="op" id="5465864">&gt;</span>&nbsp;<span class="num" id="5465866">0</span>&nbsp;<span class="op" id="5465868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465872">if</span>&nbsp;<span class="ident" id="5465875"><a href="/regexp/syntax/parse.go.html#5465805">reuse</a></span>&nbsp;<span class="op" id="5465881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465886"><a href="/regexp/syntax/parse.go.html#5465762">p</a></span><span class="op" id="5465887">.</span><span class="ident" id="5465888">reuse</span><span class="op" id="5465893">(</span><span class="ident" id="5465894"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465896">.</span><span class="ident" id="5465897">Sub</span><span class="op" id="5465900">[</span><span class="num" id="5465901">0</span><span class="op" id="5465902">]</span><span class="op" id="5465903">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5465907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465911"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465913">.</span><span class="ident" id="5465914">Sub</span>&nbsp;<span class="op" id="5465918">=</span>&nbsp;<span class="ident" id="5465920"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465922">.</span><span class="ident" id="5465923">Sub</span><span class="op" id="5465926">[</span><span class="op" id="5465927">:</span><span class="builtinfunc" id="5465928">copy</span><span class="op" id="5465932">(</span><span class="ident" id="5465933"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465935">.</span><span class="ident" id="5465936">Sub</span><span class="op" id="5465939">,</span>&nbsp;<span class="ident" id="5465941"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465943">.</span><span class="ident" id="5465944">Sub</span><span class="op" id="5465947">[</span><span class="num" id="5465948">1</span><span class="op" id="5465949">:</span><span class="op" id="5465950">]</span><span class="op" id="5465951">)</span><span class="op" id="5465952">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465956">switch</span>&nbsp;<span class="builtinfunc" id="5465963">len</span><span class="op" id="5465966">(</span><span class="ident" id="5465967"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465969">.</span><span class="ident" id="5465970">Sub</span><span class="op" id="5465973">)</span>&nbsp;<span class="op" id="5465975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5465979">case</span>&nbsp;<span class="num" id="5465984">0</span><span class="op" id="5465985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5465990"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5465992">.</span><span class="ident" id="5465993">Op</span>&nbsp;<span class="op" id="5465996">=</span>&nbsp;<span class="ident" id="5465998"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466014"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5466016">.</span><span class="ident" id="5466017">Sub</span>&nbsp;<span class="op" id="5466021">=</span>&nbsp;<span class="ident" id="5466023">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466029">case</span>&nbsp;<span class="num" id="5466034">1</span><span class="op" id="5466035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466040">old</span>&nbsp;<span class="op" id="5466044">:=</span>&nbsp;<span class="ident" id="5466047"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466053"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span>&nbsp;<span class="op" id="5466056">=</span>&nbsp;<span class="ident" id="5466058"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5466060">.</span><span class="ident" id="5466061">Sub</span><span class="op" id="5466064">[</span><span class="num" id="5466065">0</span><span class="op" id="5466066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466071"><a href="/regexp/syntax/parse.go.html#5465762">p</a></span><span class="op" id="5466072">.</span><span class="ident" id="5466073">reuse</span><span class="op" id="5466078">(</span><span class="ident" id="5466079"><a href="/regexp/syntax/parse.go.html#5466040">old</a></span><span class="op" id="5466082">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466090">return</span>&nbsp;<span class="ident" id="5466097"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466104">if</span>&nbsp;<span class="ident" id="5466107"><a href="/regexp/syntax/parse.go.html#5465805">reuse</a></span>&nbsp;<span class="op" id="5466113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466117"><a href="/regexp/syntax/parse.go.html#5465762">p</a></span><span class="op" id="5466118">.</span><span class="ident" id="5466119">reuse</span><span class="op" id="5466124">(</span><span class="ident" id="5466125"><a href="/regexp/syntax/parse.go.html#5465793">re</a></span><span class="op" id="5466127">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466133">return</span>&nbsp;<span class="ident" id="5466140"><a href="/regexp/syntax/parse.go.html#5465762">p</a></span><span class="op" id="5466141">.</span><span class="ident" id="5466142">newRegexp</span><span class="op" id="5466151">(</span><span class="ident" id="5466152"><a href="/regexp/syntax/regexp.go.html#5506019">OpEmptyMatch</a></span><span class="op" id="5466164">)</span><br>
<span class="lineno"></span><span class="op" id="5466166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5466169">func</span>&nbsp;<span class="ident" id="5466174">literalRegexp</span><span class="op" id="5466187">(</span><span class="ident" id="5466188">s</span>&nbsp;<span class="builtintype" id="5466190">string</span><span class="op" id="5466196">,</span>&nbsp;<span class="ident" id="5466198">flags</span>&nbsp;<span class="ident" id="5466204"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5466209">)</span>&nbsp;<span class="op" id="5466211">*</span><span class="ident" id="5466212"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span>&nbsp;<span class="op" id="5466219">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466222">re</span>&nbsp;<span class="op" id="5466225">:=</span>&nbsp;<span class="op" id="5466228">&amp;</span><span class="ident" id="5466229"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5466235">{</span><span class="ident" id="5466236">Op</span><span class="op" id="5466238">:</span>&nbsp;<span class="ident" id="5466240"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><span class="op" id="5466249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466252"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466254">.</span><span class="ident" id="5466255">Flags</span>&nbsp;<span class="op" id="5466261">=</span>&nbsp;<span class="ident" id="5466263"><a href="/regexp/syntax/parse.go.html#5466198">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466270"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466272">.</span><span class="ident" id="5466273">Rune</span>&nbsp;<span class="op" id="5466278">=</span>&nbsp;<span class="ident" id="5466280"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466282">.</span><span class="ident" id="5466283">Rune0</span><span class="op" id="5466288">[</span><span class="op" id="5466289">:</span><span class="num" id="5466290">0</span><span class="op" id="5466291">]</span>&nbsp;<span class="comment" id="5466293">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466333">for</span>&nbsp;<span class="ident" id="5466337">_</span><span class="op" id="5466338">,</span>&nbsp;<span class="ident" id="5466340">c</span>&nbsp;<span class="op" id="5466342">:=</span>&nbsp;<span class="keyword" id="5466345">range</span>&nbsp;<span class="ident" id="5466351"><a href="/regexp/syntax/parse.go.html#5466188">s</a></span>&nbsp;<span class="op" id="5466353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466357">if</span>&nbsp;<span class="builtinfunc" id="5466360">len</span><span class="op" id="5466363">(</span><span class="ident" id="5466364"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466366">.</span><span class="ident" id="5466367">Rune</span><span class="op" id="5466371">)</span>&nbsp;<span class="op" id="5466373">&gt;=</span>&nbsp;<span class="builtinfunc" id="5466376">cap</span><span class="op" id="5466379">(</span><span class="ident" id="5466380"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466382">.</span><span class="ident" id="5466383">Rune</span><span class="op" id="5466387">)</span>&nbsp;<span class="op" id="5466389">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466394">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466454"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466456">.</span><span class="ident" id="5466457">Rune</span>&nbsp;<span class="op" id="5466462">=</span>&nbsp;<span class="op" id="5466464">[</span><span class="op" id="5466465">]</span><span class="builtintype" id="5466466">rune</span><span class="op" id="5466470">(</span><span class="ident" id="5466471"><a href="/regexp/syntax/parse.go.html#5466188">s</a></span><span class="op" id="5466472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466477">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466489"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466491">.</span><span class="ident" id="5466492">Rune</span>&nbsp;<span class="op" id="5466497">=</span>&nbsp;<span class="builtinfunc" id="5466499">append</span><span class="op" id="5466505">(</span><span class="ident" id="5466506"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><span class="op" id="5466508">.</span><span class="ident" id="5466509">Rune</span><span class="op" id="5466513">,</span>&nbsp;<span class="ident" id="5466515"><a href="/regexp/syntax/parse.go.html#5466340">c</a></span><span class="op" id="5466516">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466522">return</span>&nbsp;<span class="ident" id="5466529"><a href="/regexp/syntax/parse.go.html#5466222">re</a></span><br>
<span class="lineno"></span><span class="op" id="5466532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466535">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5466548">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5466623">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5466692">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5466731">func</span>&nbsp;<span class="ident" id="5466736">Parse</span><span class="op" id="5466741">(</span><span class="ident" id="5466742">s</span>&nbsp;<span class="builtintype" id="5466744">string</span><span class="op" id="5466750">,</span>&nbsp;<span class="ident" id="5466752">flags</span>&nbsp;<span class="ident" id="5466758"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5466763">)</span>&nbsp;<span class="op" id="5466765">(</span><span class="op" id="5466766">*</span><span class="ident" id="5466767"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5466773">,</span>&nbsp;<span class="builtintype" id="5466775">error</span><span class="op" id="5466780">)</span>&nbsp;<span class="op" id="5466782">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466785">if</span>&nbsp;<span class="ident" id="5466788"><a href="/regexp/syntax/parse.go.html#5466752">flags</a></span><span class="op" id="5466793">&amp;</span><span class="ident" id="5466794"><a href="/regexp/syntax/parse.go.html#5449634">Literal</a></span>&nbsp;<span class="op" id="5466802">!=</span>&nbsp;<span class="num" id="5466805">0</span>&nbsp;<span class="op" id="5466807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466811">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466851">if</span>&nbsp;<span class="ident" id="5466854">err</span>&nbsp;<span class="op" id="5466858">:=</span>&nbsp;<span class="ident" id="5466861"><a href="/regexp/syntax/parse.go.html#5493920">checkUTF8</a></span><span class="op" id="5466870">(</span><span class="ident" id="5466871"><a href="/regexp/syntax/parse.go.html#5466742">s</a></span><span class="op" id="5466872">)</span><span class="op" id="5466873">;</span>&nbsp;<span class="ident" id="5466875"><a href="/regexp/syntax/parse.go.html#5466854">err</a></span>&nbsp;<span class="op" id="5466879">!=</span>&nbsp;<span class="ident" id="5466882">nil</span>&nbsp;<span class="op" id="5466886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466891">return</span>&nbsp;<span class="ident" id="5466898">nil</span><span class="op" id="5466901">,</span>&nbsp;<span class="ident" id="5466903"><a href="/regexp/syntax/parse.go.html#5466854">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466909">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466913">return</span>&nbsp;<span class="ident" id="5466920"><a href="/regexp/syntax/parse.go.html#5466174">literalRegexp</a></span><span class="op" id="5466933">(</span><span class="ident" id="5466934"><a href="/regexp/syntax/parse.go.html#5466742">s</a></span><span class="op" id="5466935">,</span>&nbsp;<span class="ident" id="5466937"><a href="/regexp/syntax/parse.go.html#5466752">flags</a></span><span class="op" id="5466942">)</span><span class="op" id="5466943">,</span>&nbsp;<span class="ident" id="5466945">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5466950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466954">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5466988">var</span>&nbsp;<span class="op" id="5466992">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466996">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467007"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467016">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5467027">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467035">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5467046">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467053">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467064"><a href="/regexp/syntax/regexp.go.html#5505750">Op</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467069">lastRepeat</span>&nbsp;<span class="builtintype" id="5467080">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467091"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467092">.</span><span class="ident" id="5467093">flags</span>&nbsp;<span class="op" id="5467099">=</span>&nbsp;<span class="ident" id="5467101"><a href="/regexp/syntax/parse.go.html#5466752">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467108"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467109">.</span><span class="ident" id="5467110">wholeRegexp</span>&nbsp;<span class="op" id="5467122">=</span>&nbsp;<span class="ident" id="5467124"><a href="/regexp/syntax/parse.go.html#5466742">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467127">t</span>&nbsp;<span class="op" id="5467129">:=</span>&nbsp;<span class="ident" id="5467132"><a href="/regexp/syntax/parse.go.html#5466742">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467135">for</span>&nbsp;<span class="ident" id="5467139"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467141">!=</span>&nbsp;<span class="string" id="5467144">&#34;&#34;</span>&nbsp;<span class="op" id="5467147">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467151">repeat</span>&nbsp;<span class="op" id="5467158">:=</span>&nbsp;<span class="string" id="5467161">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467165">BigSwitch</span><span class="op" id="5467174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467178">switch</span>&nbsp;<span class="ident" id="5467185"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467186">[</span><span class="num" id="5467187">0</span><span class="op" id="5467188">]</span>&nbsp;<span class="op" id="5467190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467194">default</span><span class="op" id="5467201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467206">if</span>&nbsp;<span class="ident" id="5467209"><a href="/regexp/syntax/parse.go.html#5467035">c</a></span><span class="op" id="5467210">,</span>&nbsp;<span class="ident" id="5467212"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467213">,</span>&nbsp;<span class="ident" id="5467215"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467219">=</span>&nbsp;<span class="ident" id="5467221"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5467229">(</span><span class="ident" id="5467230"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467231">)</span><span class="op" id="5467232">;</span>&nbsp;<span class="ident" id="5467234"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467238">!=</span>&nbsp;<span class="ident" id="5467241">nil</span>&nbsp;<span class="op" id="5467245">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467251">return</span>&nbsp;<span class="ident" id="5467258">nil</span><span class="op" id="5467261">,</span>&nbsp;<span class="ident" id="5467263"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467275"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467276">.</span><span class="ident" id="5467277">literal</span><span class="op" id="5467284">(</span><span class="ident" id="5467285"><a href="/regexp/syntax/parse.go.html#5467035">c</a></span><span class="op" id="5467286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467291">case</span>&nbsp;<span class="string" id="5467296">&#39;(&#39;</span><span class="op" id="5467299">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467304">if</span>&nbsp;<span class="ident" id="5467307"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467308">.</span><span class="ident" id="5467309">flags</span><span class="op" id="5467314">&amp;</span><span class="ident" id="5467315"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5467321">!=</span>&nbsp;<span class="num" id="5467324">0</span>&nbsp;<span class="op" id="5467326">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5467329">len</span><span class="op" id="5467332">(</span><span class="ident" id="5467333"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467334">)</span>&nbsp;<span class="op" id="5467336">&gt;=</span>&nbsp;<span class="num" id="5467339">2</span>&nbsp;<span class="op" id="5467341">&amp;&amp;</span>&nbsp;<span class="ident" id="5467344"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467345">[</span><span class="num" id="5467346">1</span><span class="op" id="5467347">]</span>&nbsp;<span class="op" id="5467349">==</span>&nbsp;<span class="string" id="5467352">&#39;?&#39;</span>&nbsp;<span class="op" id="5467356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467362">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467408">if</span>&nbsp;<span class="ident" id="5467411"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467412">,</span>&nbsp;<span class="ident" id="5467414"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467418">=</span>&nbsp;<span class="ident" id="5467420"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467421">.</span><span class="ident" id="5467422">parsePerlFlags</span><span class="op" id="5467436">(</span><span class="ident" id="5467437"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467438">)</span><span class="op" id="5467439">;</span>&nbsp;<span class="ident" id="5467441"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467445">!=</span>&nbsp;<span class="ident" id="5467448">nil</span>&nbsp;<span class="op" id="5467452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467459">return</span>&nbsp;<span class="ident" id="5467466">nil</span><span class="op" id="5467469">,</span>&nbsp;<span class="ident" id="5467471"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467479">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467485">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467499"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467500">.</span><span class="ident" id="5467501">numCap</span><span class="op" id="5467507">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467513"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467514">.</span><span class="ident" id="5467515">op</span><span class="op" id="5467517">(</span><span class="ident" id="5467518"><a href="/regexp/syntax/parse.go.html#5450572">opLeftParen</a></span><span class="op" id="5467529">)</span><span class="op" id="5467530">.</span><span class="ident" id="5467531">Cap</span>&nbsp;<span class="op" id="5467535">=</span>&nbsp;<span class="ident" id="5467537"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467538">.</span><span class="ident" id="5467539">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467549"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467551">=</span>&nbsp;<span class="ident" id="5467553"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467554">[</span><span class="num" id="5467555">1</span><span class="op" id="5467556">:</span><span class="op" id="5467557">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467561">case</span>&nbsp;<span class="string" id="5467566">&#39;|&#39;</span><span class="op" id="5467569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467574">if</span>&nbsp;<span class="ident" id="5467577"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467581">=</span>&nbsp;<span class="ident" id="5467583"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467584">.</span><span class="ident" id="5467585">parseVerticalBar</span><span class="op" id="5467601">(</span><span class="op" id="5467602">)</span><span class="op" id="5467603">;</span>&nbsp;<span class="ident" id="5467605"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467609">!=</span>&nbsp;<span class="ident" id="5467612">nil</span>&nbsp;<span class="op" id="5467616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467622">return</span>&nbsp;<span class="ident" id="5467629">nil</span><span class="op" id="5467632">,</span>&nbsp;<span class="ident" id="5467634"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467646"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467648">=</span>&nbsp;<span class="ident" id="5467650"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467651">[</span><span class="num" id="5467652">1</span><span class="op" id="5467653">:</span><span class="op" id="5467654">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467658">case</span>&nbsp;<span class="string" id="5467663">&#39;)&#39;</span><span class="op" id="5467666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467671">if</span>&nbsp;<span class="ident" id="5467674"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467678">=</span>&nbsp;<span class="ident" id="5467680"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467681">.</span><span class="ident" id="5467682">parseRightParen</span><span class="op" id="5467697">(</span><span class="op" id="5467698">)</span><span class="op" id="5467699">;</span>&nbsp;<span class="ident" id="5467701"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5467705">!=</span>&nbsp;<span class="ident" id="5467708">nil</span>&nbsp;<span class="op" id="5467712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467718">return</span>&nbsp;<span class="ident" id="5467725">nil</span><span class="op" id="5467728">,</span>&nbsp;<span class="ident" id="5467730"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467742"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467744">=</span>&nbsp;<span class="ident" id="5467746"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467747">[</span><span class="num" id="5467748">1</span><span class="op" id="5467749">:</span><span class="op" id="5467750">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467754">case</span>&nbsp;<span class="string" id="5467759">&#39;^&#39;</span><span class="op" id="5467762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467767">if</span>&nbsp;<span class="ident" id="5467770"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467771">.</span><span class="ident" id="5467772">flags</span><span class="op" id="5467777">&amp;</span><span class="ident" id="5467778"><a href="/regexp/syntax/parse.go.html#5449868">OneLine</a></span>&nbsp;<span class="op" id="5467786">!=</span>&nbsp;<span class="num" id="5467789">0</span>&nbsp;<span class="op" id="5467791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467797"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467798">.</span><span class="ident" id="5467799">op</span><span class="op" id="5467801">(</span><span class="ident" id="5467802"><a href="/regexp/syntax/regexp.go.html#5506490">OpBeginText</a></span><span class="op" id="5467813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467818">}</span>&nbsp;<span class="keyword" id="5467820">else</span>&nbsp;<span class="op" id="5467825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467831"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467832">.</span><span class="ident" id="5467833">op</span><span class="op" id="5467835">(</span><span class="ident" id="5467836"><a href="/regexp/syntax/regexp.go.html#5506342">OpBeginLine</a></span><span class="op" id="5467847">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467857"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467859">=</span>&nbsp;<span class="ident" id="5467861"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467862">[</span><span class="num" id="5467863">1</span><span class="op" id="5467864">:</span><span class="op" id="5467865">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467869">case</span>&nbsp;<span class="string" id="5467874">&#39;$&#39;</span><span class="op" id="5467877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467882">if</span>&nbsp;<span class="ident" id="5467885"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467886">.</span><span class="ident" id="5467887">flags</span><span class="op" id="5467892">&amp;</span><span class="ident" id="5467893"><a href="/regexp/syntax/parse.go.html#5449868">OneLine</a></span>&nbsp;<span class="op" id="5467901">!=</span>&nbsp;<span class="num" id="5467904">0</span>&nbsp;<span class="op" id="5467906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467912"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467913">.</span><span class="ident" id="5467914">op</span><span class="op" id="5467916">(</span><span class="ident" id="5467917"><a href="/regexp/syntax/regexp.go.html#5506567">OpEndText</a></span><span class="op" id="5467926">)</span><span class="op" id="5467927">.</span><span class="ident" id="5467928">Flags</span>&nbsp;<span class="op" id="5467934">|=</span>&nbsp;<span class="ident" id="5467937"><a href="/regexp/syntax/parse.go.html#5450196">WasDollar</a></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467950">}</span>&nbsp;<span class="keyword" id="5467952">else</span>&nbsp;<span class="op" id="5467957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467963"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5467964">.</span><span class="ident" id="5467965">op</span><span class="op" id="5467967">(</span><span class="ident" id="5467968"><a href="/regexp/syntax/regexp.go.html#5506419">OpEndLine</a></span><span class="op" id="5467977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467987"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5467989">=</span>&nbsp;<span class="ident" id="5467991"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5467992">[</span><span class="num" id="5467993">1</span><span class="op" id="5467994">:</span><span class="op" id="5467995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467999">case</span>&nbsp;<span class="string" id="5468004">&#39;.&#39;</span><span class="op" id="5468007">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468012">if</span>&nbsp;<span class="ident" id="5468015"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468016">.</span><span class="ident" id="5468017">flags</span><span class="op" id="5468022">&amp;</span><span class="ident" id="5468023"><a href="/regexp/syntax/parse.go.html#5449807">DotNL</a></span>&nbsp;<span class="op" id="5468029">!=</span>&nbsp;<span class="num" id="5468032">0</span>&nbsp;<span class="op" id="5468034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468040"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468041">.</span><span class="ident" id="5468042">op</span><span class="op" id="5468044">(</span><span class="ident" id="5468045"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><span class="op" id="5468054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468059">}</span>&nbsp;<span class="keyword" id="5468061">else</span>&nbsp;<span class="op" id="5468066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468072"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468073">.</span><span class="ident" id="5468074">op</span><span class="op" id="5468076">(</span><span class="ident" id="5468077"><a href="/regexp/syntax/regexp.go.html#5506213">OpAnyCharNotNL</a></span><span class="op" id="5468091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468096">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468101"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5468103">=</span>&nbsp;<span class="ident" id="5468105"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468106">[</span><span class="num" id="5468107">1</span><span class="op" id="5468108">:</span><span class="op" id="5468109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468113">case</span>&nbsp;<span class="string" id="5468118">&#39;[&#39;</span><span class="op" id="5468121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468126">if</span>&nbsp;<span class="ident" id="5468129"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468130">,</span>&nbsp;<span class="ident" id="5468132"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468136">=</span>&nbsp;<span class="ident" id="5468138"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468139">.</span><span class="ident" id="5468140">parseClass</span><span class="op" id="5468150">(</span><span class="ident" id="5468151"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468152">)</span><span class="op" id="5468153">;</span>&nbsp;<span class="ident" id="5468155"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468159">!=</span>&nbsp;<span class="ident" id="5468162">nil</span>&nbsp;<span class="op" id="5468166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468172">return</span>&nbsp;<span class="ident" id="5468179">nil</span><span class="op" id="5468182">,</span>&nbsp;<span class="ident" id="5468184"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468191">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468195">case</span>&nbsp;<span class="string" id="5468200">&#39;*&#39;</span><span class="op" id="5468203">,</span>&nbsp;<span class="string" id="5468205">&#39;+&#39;</span><span class="op" id="5468208">,</span>&nbsp;<span class="string" id="5468210">&#39;?&#39;</span><span class="op" id="5468213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468218">before</span>&nbsp;<span class="op" id="5468225">:=</span>&nbsp;<span class="ident" id="5468228"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468233">switch</span>&nbsp;<span class="ident" id="5468240"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468241">[</span><span class="num" id="5468242">0</span><span class="op" id="5468243">]</span>&nbsp;<span class="op" id="5468245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468250">case</span>&nbsp;<span class="string" id="5468255">&#39;*&#39;</span><span class="op" id="5468258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468264"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span>&nbsp;<span class="op" id="5468267">=</span>&nbsp;<span class="ident" id="5468269"><a href="/regexp/syntax/regexp.go.html#5506860">OpStar</a></span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468279">case</span>&nbsp;<span class="string" id="5468284">&#39;+&#39;</span><span class="op" id="5468287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468293"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span>&nbsp;<span class="op" id="5468296">=</span>&nbsp;<span class="ident" id="5468298"><a href="/regexp/syntax/regexp.go.html#5506929">OpPlus</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468308">case</span>&nbsp;<span class="string" id="5468313">&#39;?&#39;</span><span class="op" id="5468316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468322"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span>&nbsp;<span class="op" id="5468325">=</span>&nbsp;<span class="ident" id="5468327"><a href="/regexp/syntax/regexp.go.html#5506997">OpQuest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468338">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468343">after</span>&nbsp;<span class="op" id="5468349">:=</span>&nbsp;<span class="ident" id="5468352"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468353">[</span><span class="num" id="5468354">1</span><span class="op" id="5468355">:</span><span class="op" id="5468356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468361">if</span>&nbsp;<span class="ident" id="5468364"><a href="/regexp/syntax/parse.go.html#5468343">after</a></span><span class="op" id="5468369">,</span>&nbsp;<span class="ident" id="5468371"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468375">=</span>&nbsp;<span class="ident" id="5468377"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468378">.</span><span class="ident" id="5468379">repeat</span><span class="op" id="5468385">(</span><span class="ident" id="5468386"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span><span class="op" id="5468388">,</span>&nbsp;<span class="num" id="5468390">0</span><span class="op" id="5468391">,</span>&nbsp;<span class="num" id="5468393">0</span><span class="op" id="5468394">,</span>&nbsp;<span class="ident" id="5468396"><a href="/regexp/syntax/parse.go.html#5468218">before</a></span><span class="op" id="5468402">,</span>&nbsp;<span class="ident" id="5468404"><a href="/regexp/syntax/parse.go.html#5468343">after</a></span><span class="op" id="5468409">,</span>&nbsp;<span class="ident" id="5468411"><a href="/regexp/syntax/parse.go.html#5467069">lastRepeat</a></span><span class="op" id="5468421">)</span><span class="op" id="5468422">;</span>&nbsp;<span class="ident" id="5468424"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468428">!=</span>&nbsp;<span class="ident" id="5468431">nil</span>&nbsp;<span class="op" id="5468435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468441">return</span>&nbsp;<span class="ident" id="5468448">nil</span><span class="op" id="5468451">,</span>&nbsp;<span class="ident" id="5468453"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468465"><a href="/regexp/syntax/parse.go.html#5467151">repeat</a></span>&nbsp;<span class="op" id="5468472">=</span>&nbsp;<span class="ident" id="5468474"><a href="/regexp/syntax/parse.go.html#5468218">before</a></span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468484"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5468486">=</span>&nbsp;<span class="ident" id="5468488"><a href="/regexp/syntax/parse.go.html#5468343">after</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468496">case</span>&nbsp;<span class="string" id="5468501">&#39;{&#39;</span><span class="op" id="5468504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468509"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span>&nbsp;<span class="op" id="5468512">=</span>&nbsp;<span class="ident" id="5468514"><a href="/regexp/syntax/regexp.go.html#5507065">OpRepeat</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468526">before</span>&nbsp;<span class="op" id="5468533">:=</span>&nbsp;<span class="ident" id="5468536"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468541">min</span><span class="op" id="5468544">,</span>&nbsp;<span class="ident" id="5468546">max</span><span class="op" id="5468549">,</span>&nbsp;<span class="ident" id="5468551">after</span><span class="op" id="5468556">,</span>&nbsp;<span class="ident" id="5468558">ok</span>&nbsp;<span class="op" id="5468561">:=</span>&nbsp;<span class="ident" id="5468564"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468565">.</span><span class="ident" id="5468566">parseRepeat</span><span class="op" id="5468577">(</span><span class="ident" id="5468578"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468579">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468584">if</span>&nbsp;<span class="op" id="5468587">!</span><span class="ident" id="5468588"><a href="/regexp/syntax/parse.go.html#5468558">ok</a></span>&nbsp;<span class="op" id="5468591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468597">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468652"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468653">.</span><span class="ident" id="5468654">literal</span><span class="op" id="5468661">(</span><span class="string" id="5468662">&#39;{&#39;</span><span class="op" id="5468665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468671"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5468673">=</span>&nbsp;<span class="ident" id="5468675"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5468676">[</span><span class="num" id="5468677">1</span><span class="op" id="5468678">:</span><span class="op" id="5468679">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468685">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468699">if</span>&nbsp;<span class="ident" id="5468702"><a href="/regexp/syntax/parse.go.html#5468541">min</a></span>&nbsp;<span class="op" id="5468706">&lt;</span>&nbsp;<span class="num" id="5468708">0</span>&nbsp;<span class="op" id="5468710">||</span>&nbsp;<span class="ident" id="5468713"><a href="/regexp/syntax/parse.go.html#5468541">min</a></span>&nbsp;<span class="op" id="5468717">&gt;</span>&nbsp;<span class="num" id="5468719">1000</span>&nbsp;<span class="op" id="5468724">||</span>&nbsp;<span class="ident" id="5468727"><a href="/regexp/syntax/parse.go.html#5468546">max</a></span>&nbsp;<span class="op" id="5468731">&gt;</span>&nbsp;<span class="num" id="5468733">1000</span>&nbsp;<span class="op" id="5468738">||</span>&nbsp;<span class="ident" id="5468741"><a href="/regexp/syntax/parse.go.html#5468546">max</a></span>&nbsp;<span class="op" id="5468745">&gt;=</span>&nbsp;<span class="num" id="5468748">0</span>&nbsp;<span class="op" id="5468750">&amp;&amp;</span>&nbsp;<span class="ident" id="5468753"><a href="/regexp/syntax/parse.go.html#5468541">min</a></span>&nbsp;<span class="op" id="5468757">&gt;</span>&nbsp;<span class="ident" id="5468759"><a href="/regexp/syntax/parse.go.html#5468546">max</a></span>&nbsp;<span class="op" id="5468763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468769">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468831">return</span>&nbsp;<span class="ident" id="5468838">nil</span><span class="op" id="5468841">,</span>&nbsp;<span class="op" id="5468843">&amp;</span><span class="ident" id="5468844"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5468849">{</span><span class="ident" id="5468850"><a href="/regexp/syntax/parse.go.html#5448954">ErrInvalidRepeatSize</a></span><span class="op" id="5468870">,</span>&nbsp;<span class="ident" id="5468872"><a href="/regexp/syntax/parse.go.html#5468526">before</a></span><span class="op" id="5468878">[</span><span class="op" id="5468879">:</span><span class="builtinfunc" id="5468880">len</span><span class="op" id="5468883">(</span><span class="ident" id="5468884"><a href="/regexp/syntax/parse.go.html#5468526">before</a></span><span class="op" id="5468890">)</span><span class="op" id="5468891">-</span><span class="builtinfunc" id="5468892">len</span><span class="op" id="5468895">(</span><span class="ident" id="5468896"><a href="/regexp/syntax/parse.go.html#5468551">after</a></span><span class="op" id="5468901">)</span><span class="op" id="5468902">]</span><span class="op" id="5468903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468908">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468913">if</span>&nbsp;<span class="ident" id="5468916"><a href="/regexp/syntax/parse.go.html#5468551">after</a></span><span class="op" id="5468921">,</span>&nbsp;<span class="ident" id="5468923"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468927">=</span>&nbsp;<span class="ident" id="5468929"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5468930">.</span><span class="ident" id="5468931">repeat</span><span class="op" id="5468937">(</span><span class="ident" id="5468938"><a href="/regexp/syntax/parse.go.html#5467053">op</a></span><span class="op" id="5468940">,</span>&nbsp;<span class="ident" id="5468942"><a href="/regexp/syntax/parse.go.html#5468541">min</a></span><span class="op" id="5468945">,</span>&nbsp;<span class="ident" id="5468947"><a href="/regexp/syntax/parse.go.html#5468546">max</a></span><span class="op" id="5468950">,</span>&nbsp;<span class="ident" id="5468952"><a href="/regexp/syntax/parse.go.html#5468526">before</a></span><span class="op" id="5468958">,</span>&nbsp;<span class="ident" id="5468960"><a href="/regexp/syntax/parse.go.html#5468551">after</a></span><span class="op" id="5468965">,</span>&nbsp;<span class="ident" id="5468967"><a href="/regexp/syntax/parse.go.html#5467069">lastRepeat</a></span><span class="op" id="5468977">)</span><span class="op" id="5468978">;</span>&nbsp;<span class="ident" id="5468980"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5468984">!=</span>&nbsp;<span class="ident" id="5468987">nil</span>&nbsp;<span class="op" id="5468991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468997">return</span>&nbsp;<span class="ident" id="5469004">nil</span><span class="op" id="5469007">,</span>&nbsp;<span class="ident" id="5469009"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469021"><a href="/regexp/syntax/parse.go.html#5467151">repeat</a></span>&nbsp;<span class="op" id="5469028">=</span>&nbsp;<span class="ident" id="5469030"><a href="/regexp/syntax/parse.go.html#5468526">before</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469040"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469042">=</span>&nbsp;<span class="ident" id="5469044"><a href="/regexp/syntax/parse.go.html#5468551">after</a></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469052">case</span>&nbsp;<span class="string" id="5469057">&#39;\\&#39;</span><span class="op" id="5469061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469066">if</span>&nbsp;<span class="ident" id="5469069"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469070">.</span><span class="ident" id="5469071">flags</span><span class="op" id="5469076">&amp;</span><span class="ident" id="5469077"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5469083">!=</span>&nbsp;<span class="num" id="5469086">0</span>&nbsp;<span class="op" id="5469088">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5469091">len</span><span class="op" id="5469094">(</span><span class="ident" id="5469095"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469096">)</span>&nbsp;<span class="op" id="5469098">&gt;=</span>&nbsp;<span class="num" id="5469101">2</span>&nbsp;<span class="op" id="5469103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469109">switch</span>&nbsp;<span class="ident" id="5469116"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469117">[</span><span class="num" id="5469118">1</span><span class="op" id="5469119">]</span>&nbsp;<span class="op" id="5469121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469127">case</span>&nbsp;<span class="string" id="5469132">&#39;A&#39;</span><span class="op" id="5469135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469142"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469143">.</span><span class="ident" id="5469144">op</span><span class="op" id="5469146">(</span><span class="ident" id="5469147"><a href="/regexp/syntax/regexp.go.html#5506490">OpBeginText</a></span><span class="op" id="5469158">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469165"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469167">=</span>&nbsp;<span class="ident" id="5469169"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469170">[</span><span class="num" id="5469171">2</span><span class="op" id="5469172">:</span><span class="op" id="5469173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469180">break</span>&nbsp;<span class="ident" id="5469186">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469200">case</span>&nbsp;<span class="string" id="5469205">&#39;b&#39;</span><span class="op" id="5469208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469215"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469216">.</span><span class="ident" id="5469217">op</span><span class="op" id="5469219">(</span><span class="ident" id="5469220"><a href="/regexp/syntax/regexp.go.html#5506638">OpWordBoundary</a></span><span class="op" id="5469234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469241"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469243">=</span>&nbsp;<span class="ident" id="5469245"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469246">[</span><span class="num" id="5469247">2</span><span class="op" id="5469248">:</span><span class="op" id="5469249">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469256">break</span>&nbsp;<span class="ident" id="5469262">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469276">case</span>&nbsp;<span class="string" id="5469281">&#39;B&#39;</span><span class="op" id="5469284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469291"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469292">.</span><span class="ident" id="5469293">op</span><span class="op" id="5469295">(</span><span class="ident" id="5469296"><a href="/regexp/syntax/regexp.go.html#5506700">OpNoWordBoundary</a></span><span class="op" id="5469312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469319"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469321">=</span>&nbsp;<span class="ident" id="5469323"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469324">[</span><span class="num" id="5469325">2</span><span class="op" id="5469326">:</span><span class="op" id="5469327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469334">break</span>&nbsp;<span class="ident" id="5469340">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469354">case</span>&nbsp;<span class="string" id="5469359">&#39;C&#39;</span><span class="op" id="5469362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469369">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469401">return</span>&nbsp;<span class="ident" id="5469408">nil</span><span class="op" id="5469411">,</span>&nbsp;<span class="op" id="5469413">&amp;</span><span class="ident" id="5469414"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5469419">{</span><span class="ident" id="5469420"><a href="/regexp/syntax/parse.go.html#5448678">ErrInvalidEscape</a></span><span class="op" id="5469436">,</span>&nbsp;<span class="ident" id="5469438"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469439">[</span><span class="op" id="5469440">:</span><span class="num" id="5469441">2</span><span class="op" id="5469442">]</span><span class="op" id="5469443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469449">case</span>&nbsp;<span class="string" id="5469454">&#39;Q&#39;</span><span class="op" id="5469457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469464">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469510">var</span>&nbsp;<span class="ident" id="5469514">lit</span>&nbsp;<span class="builtintype" id="5469518">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469530">if</span>&nbsp;<span class="ident" id="5469533">i</span>&nbsp;<span class="op" id="5469535">:=</span>&nbsp;<span class="ident" id="5469538"><a href="/regexp/syntax/parse.go.html#5448041">strings</a></span><span class="op" id="5469545">.</span><span class="ident" id="5469546">Index</span><span class="op" id="5469551">(</span><span class="ident" id="5469552"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469553">,</span>&nbsp;<span class="string" id="5469555">`\E`</span><span class="op" id="5469559">)</span><span class="op" id="5469560">;</span>&nbsp;<span class="ident" id="5469562"><a href="/regexp/syntax/parse.go.html#5469533">i</a></span>&nbsp;<span class="op" id="5469564">&lt;</span>&nbsp;<span class="num" id="5469566">0</span>&nbsp;<span class="op" id="5469568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469576"><a href="/regexp/syntax/parse.go.html#5469514">lit</a></span>&nbsp;<span class="op" id="5469580">=</span>&nbsp;<span class="ident" id="5469582"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469583">[</span><span class="num" id="5469584">2</span><span class="op" id="5469585">:</span><span class="op" id="5469586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469594"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469596">=</span>&nbsp;<span class="string" id="5469598">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469606">}</span>&nbsp;<span class="keyword" id="5469608">else</span>&nbsp;<span class="op" id="5469613">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469621"><a href="/regexp/syntax/parse.go.html#5469514">lit</a></span>&nbsp;<span class="op" id="5469625">=</span>&nbsp;<span class="ident" id="5469627"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469628">[</span><span class="num" id="5469629">2</span><span class="op" id="5469630">:</span><span class="ident" id="5469631"><a href="/regexp/syntax/parse.go.html#5469533">i</a></span><span class="op" id="5469632">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469640"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469642">=</span>&nbsp;<span class="ident" id="5469644"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469645">[</span><span class="ident" id="5469646"><a href="/regexp/syntax/parse.go.html#5469533">i</a></span><span class="op" id="5469647">+</span><span class="num" id="5469648">2</span><span class="op" id="5469649">:</span><span class="op" id="5469650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469664"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469665">.</span><span class="ident" id="5469666">push</span><span class="op" id="5469670">(</span><span class="ident" id="5469671"><a href="/regexp/syntax/parse.go.html#5466174">literalRegexp</a></span><span class="op" id="5469684">(</span><span class="ident" id="5469685"><a href="/regexp/syntax/parse.go.html#5469514">lit</a></span><span class="op" id="5469688">,</span>&nbsp;<span class="ident" id="5469690"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469691">.</span><span class="ident" id="5469692">flags</span><span class="op" id="5469697">)</span><span class="op" id="5469698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469705">break</span>&nbsp;<span class="ident" id="5469711">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469725">case</span>&nbsp;<span class="string" id="5469730">&#39;z&#39;</span><span class="op" id="5469733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469740"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469741">.</span><span class="ident" id="5469742">op</span><span class="op" id="5469744">(</span><span class="ident" id="5469745"><a href="/regexp/syntax/regexp.go.html#5506567">OpEndText</a></span><span class="op" id="5469754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469761"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5469763">=</span>&nbsp;<span class="ident" id="5469765"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469766">[</span><span class="num" id="5469767">2</span><span class="op" id="5469768">:</span><span class="op" id="5469769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469776">break</span>&nbsp;<span class="ident" id="5469782">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469796">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469807">re</span>&nbsp;<span class="op" id="5469810">:=</span>&nbsp;<span class="ident" id="5469813"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469814">.</span><span class="ident" id="5469815">newRegexp</span><span class="op" id="5469824">(</span><span class="ident" id="5469825"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><span class="op" id="5469836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469841"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5469843">.</span><span class="ident" id="5469844">Flags</span>&nbsp;<span class="op" id="5469850">=</span>&nbsp;<span class="ident" id="5469852"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469853">.</span><span class="ident" id="5469854">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469864">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469916">if</span>&nbsp;<span class="builtinfunc" id="5469919">len</span><span class="op" id="5469922">(</span><span class="ident" id="5469923"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469924">)</span>&nbsp;<span class="op" id="5469926">&gt;=</span>&nbsp;<span class="num" id="5469929">2</span>&nbsp;<span class="op" id="5469931">&amp;&amp;</span>&nbsp;<span class="op" id="5469934">(</span><span class="ident" id="5469935"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469936">[</span><span class="num" id="5469937">1</span><span class="op" id="5469938">]</span>&nbsp;<span class="op" id="5469940">==</span>&nbsp;<span class="string" id="5469943">&#39;p&#39;</span>&nbsp;<span class="op" id="5469947">||</span>&nbsp;<span class="ident" id="5469950"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5469951">[</span><span class="num" id="5469952">1</span><span class="op" id="5469953">]</span>&nbsp;<span class="op" id="5469955">==</span>&nbsp;<span class="string" id="5469958">&#39;P&#39;</span><span class="op" id="5469961">)</span>&nbsp;<span class="op" id="5469963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469969">r</span><span class="op" id="5469970">,</span>&nbsp;<span class="ident" id="5469972">rest</span><span class="op" id="5469976">,</span>&nbsp;<span class="ident" id="5469978">err</span>&nbsp;<span class="op" id="5469982">:=</span>&nbsp;<span class="ident" id="5469985"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5469986">.</span><span class="ident" id="5469987">parseUnicodeClass</span><span class="op" id="5470004">(</span><span class="ident" id="5470005"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5470006">,</span>&nbsp;<span class="ident" id="5470008"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470010">.</span><span class="ident" id="5470011">Rune0</span><span class="op" id="5470016">[</span><span class="op" id="5470017">:</span><span class="num" id="5470018">0</span><span class="op" id="5470019">]</span><span class="op" id="5470020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470026">if</span>&nbsp;<span class="ident" id="5470029"><a href="/regexp/syntax/parse.go.html#5469978">err</a></span>&nbsp;<span class="op" id="5470033">!=</span>&nbsp;<span class="ident" id="5470036">nil</span>&nbsp;<span class="op" id="5470040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470047">return</span>&nbsp;<span class="ident" id="5470054">nil</span><span class="op" id="5470057">,</span>&nbsp;<span class="ident" id="5470059"><a href="/regexp/syntax/parse.go.html#5469978">err</a></span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470073">if</span>&nbsp;<span class="ident" id="5470076"><a href="/regexp/syntax/parse.go.html#5469969">r</a></span>&nbsp;<span class="op" id="5470078">!=</span>&nbsp;<span class="ident" id="5470081">nil</span>&nbsp;<span class="op" id="5470085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470092"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470094">.</span><span class="ident" id="5470095">Rune</span>&nbsp;<span class="op" id="5470100">=</span>&nbsp;<span class="ident" id="5470102"><a href="/regexp/syntax/parse.go.html#5469969">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470109"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5470111">=</span>&nbsp;<span class="ident" id="5470113"><a href="/regexp/syntax/parse.go.html#5469972">rest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470123"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470124">.</span><span class="ident" id="5470125">push</span><span class="op" id="5470129">(</span><span class="ident" id="5470130"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470132">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470139">break</span>&nbsp;<span class="ident" id="5470145">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470170">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470205">if</span>&nbsp;<span class="ident" id="5470208">r</span><span class="op" id="5470209">,</span>&nbsp;<span class="ident" id="5470211">rest</span>&nbsp;<span class="op" id="5470216">:=</span>&nbsp;<span class="ident" id="5470219"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470220">.</span><span class="ident" id="5470221">parsePerlClassEscape</span><span class="op" id="5470241">(</span><span class="ident" id="5470242"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5470243">,</span>&nbsp;<span class="ident" id="5470245"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470247">.</span><span class="ident" id="5470248">Rune0</span><span class="op" id="5470253">[</span><span class="op" id="5470254">:</span><span class="num" id="5470255">0</span><span class="op" id="5470256">]</span><span class="op" id="5470257">)</span><span class="op" id="5470258">;</span>&nbsp;<span class="ident" id="5470260"><a href="/regexp/syntax/parse.go.html#5470208">r</a></span>&nbsp;<span class="op" id="5470262">!=</span>&nbsp;<span class="ident" id="5470265">nil</span>&nbsp;<span class="op" id="5470269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470275"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470277">.</span><span class="ident" id="5470278">Rune</span>&nbsp;<span class="op" id="5470283">=</span>&nbsp;<span class="ident" id="5470285"><a href="/regexp/syntax/parse.go.html#5470208">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470291"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span>&nbsp;<span class="op" id="5470293">=</span>&nbsp;<span class="ident" id="5470295"><a href="/regexp/syntax/parse.go.html#5470211">rest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470304"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470305">.</span><span class="ident" id="5470306">push</span><span class="op" id="5470310">(</span><span class="ident" id="5470311"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470319">break</span>&nbsp;<span class="ident" id="5470325">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470343"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470344">.</span><span class="ident" id="5470345">reuse</span><span class="op" id="5470350">(</span><span class="ident" id="5470351"><a href="/regexp/syntax/parse.go.html#5469807">re</a></span><span class="op" id="5470353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470359">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470399">if</span>&nbsp;<span class="ident" id="5470402"><a href="/regexp/syntax/parse.go.html#5467035">c</a></span><span class="op" id="5470403">,</span>&nbsp;<span class="ident" id="5470405"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5470406">,</span>&nbsp;<span class="ident" id="5470408"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5470412">=</span>&nbsp;<span class="ident" id="5470414"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470415">.</span><span class="ident" id="5470416">parseEscape</span><span class="op" id="5470427">(</span><span class="ident" id="5470428"><a href="/regexp/syntax/parse.go.html#5467127">t</a></span><span class="op" id="5470429">)</span><span class="op" id="5470430">;</span>&nbsp;<span class="ident" id="5470432"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span>&nbsp;<span class="op" id="5470436">!=</span>&nbsp;<span class="ident" id="5470439">nil</span>&nbsp;<span class="op" id="5470443">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470449">return</span>&nbsp;<span class="ident" id="5470456">nil</span><span class="op" id="5470459">,</span>&nbsp;<span class="ident" id="5470461"><a href="/regexp/syntax/parse.go.html#5467016">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470473"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470474">.</span><span class="ident" id="5470475">literal</span><span class="op" id="5470482">(</span><span class="ident" id="5470483"><a href="/regexp/syntax/parse.go.html#5467035">c</a></span><span class="op" id="5470484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470492"><a href="/regexp/syntax/parse.go.html#5467069">lastRepeat</a></span>&nbsp;<span class="op" id="5470503">=</span>&nbsp;<span class="ident" id="5470505"><a href="/regexp/syntax/parse.go.html#5467151">repeat</a></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470517"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470518">.</span><span class="ident" id="5470519">concat</span><span class="op" id="5470525">(</span><span class="op" id="5470526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470529">if</span>&nbsp;<span class="ident" id="5470532"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470533">.</span><span class="ident" id="5470534">swapVerticalBar</span><span class="op" id="5470549">(</span><span class="op" id="5470550">)</span>&nbsp;<span class="op" id="5470552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5470556">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470578"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470579">.</span><span class="ident" id="5470580">stack</span>&nbsp;<span class="op" id="5470586">=</span>&nbsp;<span class="ident" id="5470588"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470589">.</span><span class="ident" id="5470590">stack</span><span class="op" id="5470595">[</span><span class="op" id="5470596">:</span><span class="builtinfunc" id="5470597">len</span><span class="op" id="5470600">(</span><span class="ident" id="5470601"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470602">.</span><span class="ident" id="5470603">stack</span><span class="op" id="5470608">)</span><span class="op" id="5470609">-</span><span class="num" id="5470610">1</span><span class="op" id="5470611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470617"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470618">.</span><span class="ident" id="5470619">alternate</span><span class="op" id="5470628">(</span><span class="op" id="5470629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470633">n</span>&nbsp;<span class="op" id="5470635">:=</span>&nbsp;<span class="builtinfunc" id="5470638">len</span><span class="op" id="5470641">(</span><span class="ident" id="5470642"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470643">.</span><span class="ident" id="5470644">stack</span><span class="op" id="5470649">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470652">if</span>&nbsp;<span class="ident" id="5470655"><a href="/regexp/syntax/parse.go.html#5470633">n</a></span>&nbsp;<span class="op" id="5470657">!=</span>&nbsp;<span class="num" id="5470660">1</span>&nbsp;<span class="op" id="5470662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470666">return</span>&nbsp;<span class="ident" id="5470673">nil</span><span class="op" id="5470676">,</span>&nbsp;<span class="op" id="5470678">&amp;</span><span class="ident" id="5470679"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5470684">{</span><span class="ident" id="5470685"><a href="/regexp/syntax/parse.go.html#5449127">ErrMissingParen</a></span><span class="op" id="5470700">,</span>&nbsp;<span class="ident" id="5470702"><a href="/regexp/syntax/parse.go.html#5466742">s</a></span><span class="op" id="5470703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470709">return</span>&nbsp;<span class="ident" id="5470716"><a href="/regexp/syntax/parse.go.html#5466996">p</a></span><span class="op" id="5470717">.</span><span class="ident" id="5470718">stack</span><span class="op" id="5470723">[</span><span class="num" id="5470724">0</span><span class="op" id="5470725">]</span><span class="op" id="5470726">,</span>&nbsp;<span class="ident" id="5470728">nil</span><br>
<span class="lineno"></span><span class="op" id="5470732">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5470735">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5470806">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5470859">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5470948">func</span>&nbsp;<span class="op" id="5470953">(</span><span class="ident" id="5470954">p</span>&nbsp;<span class="op" id="5470956">*</span><span class="ident" id="5470957"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5470963">)</span>&nbsp;<span class="ident" id="5470965">parseRepeat</span><span class="op" id="5470976">(</span><span class="ident" id="5470977">s</span>&nbsp;<span class="builtintype" id="5470979">string</span><span class="op" id="5470985">)</span>&nbsp;<span class="op" id="5470987">(</span><span class="ident" id="5470988">min</span><span class="op" id="5470991">,</span>&nbsp;<span class="ident" id="5470993">max</span>&nbsp;<span class="builtintype" id="5470997">int</span><span class="op" id="5471000">,</span>&nbsp;<span class="ident" id="5471002">rest</span>&nbsp;<span class="builtintype" id="5471007">string</span><span class="op" id="5471013">,</span>&nbsp;<span class="ident" id="5471015">ok</span>&nbsp;<span class="builtintype" id="5471018">bool</span><span class="op" id="5471022">)</span>&nbsp;<span class="op" id="5471024">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471027">if</span>&nbsp;<span class="ident" id="5471030"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471032">==</span>&nbsp;<span class="string" id="5471035">&#34;&#34;</span>&nbsp;<span class="op" id="5471038">||</span>&nbsp;<span class="ident" id="5471041"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471042">[</span><span class="num" id="5471043">0</span><span class="op" id="5471044">]</span>&nbsp;<span class="op" id="5471046">!=</span>&nbsp;<span class="string" id="5471049">&#39;{&#39;</span>&nbsp;<span class="op" id="5471053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471057">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471068"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471070">=</span>&nbsp;<span class="ident" id="5471072"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471073">[</span><span class="num" id="5471074">1</span><span class="op" id="5471075">:</span><span class="op" id="5471076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471079">var</span>&nbsp;<span class="ident" id="5471083">ok1</span>&nbsp;<span class="builtintype" id="5471087">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471093">if</span>&nbsp;<span class="ident" id="5471096"><a href="/regexp/syntax/parse.go.html#5470988">min</a></span><span class="op" id="5471099">,</span>&nbsp;<span class="ident" id="5471101"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471102">,</span>&nbsp;<span class="ident" id="5471104"><a href="/regexp/syntax/parse.go.html#5471083">ok1</a></span>&nbsp;<span class="op" id="5471108">=</span>&nbsp;<span class="ident" id="5471110"><a href="/regexp/syntax/parse.go.html#5470954">p</a></span><span class="op" id="5471111">.</span><span class="ident" id="5471112">parseInt</span><span class="op" id="5471120">(</span><span class="ident" id="5471121"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471122">)</span><span class="op" id="5471123">;</span>&nbsp;<span class="op" id="5471125">!</span><span class="ident" id="5471126"><a href="/regexp/syntax/parse.go.html#5471083">ok1</a></span>&nbsp;<span class="op" id="5471130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471134">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471145">if</span>&nbsp;<span class="ident" id="5471148"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471150">==</span>&nbsp;<span class="string" id="5471153">&#34;&#34;</span>&nbsp;<span class="op" id="5471156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471160">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471171">if</span>&nbsp;<span class="ident" id="5471174"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471175">[</span><span class="num" id="5471176">0</span><span class="op" id="5471177">]</span>&nbsp;<span class="op" id="5471179">!=</span>&nbsp;<span class="string" id="5471182">&#39;,&#39;</span>&nbsp;<span class="op" id="5471186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471190"><a href="/regexp/syntax/parse.go.html#5470993">max</a></span>&nbsp;<span class="op" id="5471194">=</span>&nbsp;<span class="ident" id="5471196"><a href="/regexp/syntax/parse.go.html#5470988">min</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471201">}</span>&nbsp;<span class="keyword" id="5471203">else</span>&nbsp;<span class="op" id="5471208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471212"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471214">=</span>&nbsp;<span class="ident" id="5471216"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471217">[</span><span class="num" id="5471218">1</span><span class="op" id="5471219">:</span><span class="op" id="5471220">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471224">if</span>&nbsp;<span class="ident" id="5471227"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471229">==</span>&nbsp;<span class="string" id="5471232">&#34;&#34;</span>&nbsp;<span class="op" id="5471235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471240">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471253">if</span>&nbsp;<span class="ident" id="5471256"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471257">[</span><span class="num" id="5471258">0</span><span class="op" id="5471259">]</span>&nbsp;<span class="op" id="5471261">==</span>&nbsp;<span class="string" id="5471264">&#39;}&#39;</span>&nbsp;<span class="op" id="5471268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471273"><a href="/regexp/syntax/parse.go.html#5470993">max</a></span>&nbsp;<span class="op" id="5471277">=</span>&nbsp;<span class="op" id="5471279">-</span><span class="num" id="5471280">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471284">}</span>&nbsp;<span class="keyword" id="5471286">else</span>&nbsp;<span class="keyword" id="5471291">if</span>&nbsp;<span class="ident" id="5471294"><a href="/regexp/syntax/parse.go.html#5470993">max</a></span><span class="op" id="5471297">,</span>&nbsp;<span class="ident" id="5471299"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471300">,</span>&nbsp;<span class="ident" id="5471302"><a href="/regexp/syntax/parse.go.html#5471083">ok1</a></span>&nbsp;<span class="op" id="5471306">=</span>&nbsp;<span class="ident" id="5471308"><a href="/regexp/syntax/parse.go.html#5470954">p</a></span><span class="op" id="5471309">.</span><span class="ident" id="5471310">parseInt</span><span class="op" id="5471318">(</span><span class="ident" id="5471319"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471320">)</span><span class="op" id="5471321">;</span>&nbsp;<span class="op" id="5471323">!</span><span class="ident" id="5471324"><a href="/regexp/syntax/parse.go.html#5471083">ok1</a></span>&nbsp;<span class="op" id="5471328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471333">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471342">}</span>&nbsp;<span class="keyword" id="5471344">else</span>&nbsp;<span class="keyword" id="5471349">if</span>&nbsp;<span class="ident" id="5471352"><a href="/regexp/syntax/parse.go.html#5470993">max</a></span>&nbsp;<span class="op" id="5471356">&lt;</span>&nbsp;<span class="num" id="5471358">0</span>&nbsp;<span class="op" id="5471360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471365">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471403"><a href="/regexp/syntax/parse.go.html#5470988">min</a></span>&nbsp;<span class="op" id="5471407">=</span>&nbsp;<span class="op" id="5471409">-</span><span class="num" id="5471410">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471420">if</span>&nbsp;<span class="ident" id="5471423"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span>&nbsp;<span class="op" id="5471425">==</span>&nbsp;<span class="string" id="5471428">&#34;&#34;</span>&nbsp;<span class="op" id="5471431">||</span>&nbsp;<span class="ident" id="5471434"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471435">[</span><span class="num" id="5471436">0</span><span class="op" id="5471437">]</span>&nbsp;<span class="op" id="5471439">!=</span>&nbsp;<span class="string" id="5471442">&#39;}&#39;</span>&nbsp;<span class="op" id="5471446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471458">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471461"><a href="/regexp/syntax/parse.go.html#5471002">rest</a></span>&nbsp;<span class="op" id="5471466">=</span>&nbsp;<span class="ident" id="5471468"><a href="/regexp/syntax/parse.go.html#5470977">s</a></span><span class="op" id="5471469">[</span><span class="num" id="5471470">1</span><span class="op" id="5471471">:</span><span class="op" id="5471472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471475"><a href="/regexp/syntax/parse.go.html#5471015">ok</a></span>&nbsp;<span class="op" id="5471478">=</span>&nbsp;<span class="builtintype" id="5471480">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471486">return</span><br>
<span class="lineno"></span><span class="op" id="5471493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5471496">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5471573">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5471661">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5471718">func</span>&nbsp;<span class="op" id="5471723">(</span><span class="ident" id="5471724">p</span>&nbsp;<span class="op" id="5471726">*</span><span class="ident" id="5471727"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5471733">)</span>&nbsp;<span class="ident" id="5471735">parsePerlFlags</span><span class="op" id="5471749">(</span><span class="ident" id="5471750">s</span>&nbsp;<span class="builtintype" id="5471752">string</span><span class="op" id="5471758">)</span>&nbsp;<span class="op" id="5471760">(</span><span class="ident" id="5471761">rest</span>&nbsp;<span class="builtintype" id="5471766">string</span><span class="op" id="5471772">,</span>&nbsp;<span class="ident" id="5471774">err</span>&nbsp;<span class="builtintype" id="5471778">error</span><span class="op" id="5471783">)</span>&nbsp;<span class="op" id="5471785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471788">t</span>&nbsp;<span class="op" id="5471790">:=</span>&nbsp;<span class="ident" id="5471793"><a href="/regexp/syntax/parse.go.html#5471750">s</a></span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471797">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471872">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471931">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471935">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471993">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472058">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472127">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472131">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472193">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472255">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472319">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472391">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472395">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472455">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472516">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472568">if</span>&nbsp;<span class="builtinfunc" id="5472571">len</span><span class="op" id="5472574">(</span><span class="ident" id="5472575"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472576">)</span>&nbsp;<span class="op" id="5472578">&gt;</span>&nbsp;<span class="num" id="5472580">4</span>&nbsp;<span class="op" id="5472582">&amp;&amp;</span>&nbsp;<span class="ident" id="5472585"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472586">[</span><span class="num" id="5472587">2</span><span class="op" id="5472588">]</span>&nbsp;<span class="op" id="5472590">==</span>&nbsp;<span class="string" id="5472593">&#39;P&#39;</span>&nbsp;<span class="op" id="5472597">&amp;&amp;</span>&nbsp;<span class="ident" id="5472600"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472601">[</span><span class="num" id="5472602">3</span><span class="op" id="5472603">]</span>&nbsp;<span class="op" id="5472605">==</span>&nbsp;<span class="string" id="5472608">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5472612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472616">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472636">end</span>&nbsp;<span class="op" id="5472640">:=</span>&nbsp;<span class="ident" id="5472643"><a href="/regexp/syntax/parse.go.html#5448041">strings</a></span><span class="op" id="5472650">.</span><span class="ident" id="5472651">IndexRune</span><span class="op" id="5472660">(</span><span class="ident" id="5472661"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472662">,</span>&nbsp;<span class="string" id="5472664">&#39;&gt;&#39;</span><span class="op" id="5472667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472671">if</span>&nbsp;<span class="ident" id="5472674"><a href="/regexp/syntax/parse.go.html#5472636">end</a></span>&nbsp;<span class="op" id="5472678">&lt;</span>&nbsp;<span class="num" id="5472680">0</span>&nbsp;<span class="op" id="5472682">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472687">if</span>&nbsp;<span class="ident" id="5472690"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5472694">=</span>&nbsp;<span class="ident" id="5472696"><a href="/regexp/syntax/parse.go.html#5493920">checkUTF8</a></span><span class="op" id="5472705">(</span><span class="ident" id="5472706"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472707">)</span><span class="op" id="5472708">;</span>&nbsp;<span class="ident" id="5472710"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5472714">!=</span>&nbsp;<span class="ident" id="5472717">nil</span>&nbsp;<span class="op" id="5472721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472727">return</span>&nbsp;<span class="string" id="5472734">&#34;&#34;</span><span class="op" id="5472736">,</span>&nbsp;<span class="ident" id="5472738"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472750">return</span>&nbsp;<span class="string" id="5472757">&#34;&#34;</span><span class="op" id="5472759">,</span>&nbsp;<span class="op" id="5472761">&amp;</span><span class="ident" id="5472762"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5472767">{</span><span class="ident" id="5472768"><a href="/regexp/syntax/parse.go.html#5448742">ErrInvalidNamedCapture</a></span><span class="op" id="5472790">,</span>&nbsp;<span class="ident" id="5472792"><a href="/regexp/syntax/parse.go.html#5471750">s</a></span><span class="op" id="5472793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472797">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472802">capture</span>&nbsp;<span class="op" id="5472810">:=</span>&nbsp;<span class="ident" id="5472813"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472814">[</span><span class="op" id="5472815">:</span><span class="ident" id="5472816"><a href="/regexp/syntax/parse.go.html#5472636">end</a></span><span class="op" id="5472819">+</span><span class="num" id="5472820">1</span><span class="op" id="5472821">]</span>&nbsp;<span class="comment" id="5472823">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5472840">name</span>&nbsp;<span class="op" id="5472845">:=</span>&nbsp;<span class="ident" id="5472848"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5472849">[</span><span class="num" id="5472850">4</span><span class="op" id="5472851">:</span><span class="ident" id="5472852"><a href="/regexp/syntax/parse.go.html#5472636">end</a></span><span class="op" id="5472855">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5472861">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472873">if</span>&nbsp;<span class="ident" id="5472876"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5472880">=</span>&nbsp;<span class="ident" id="5472882"><a href="/regexp/syntax/parse.go.html#5493920">checkUTF8</a></span><span class="op" id="5472891">(</span><span class="ident" id="5472892"><a href="/regexp/syntax/parse.go.html#5472840">name</a></span><span class="op" id="5472896">)</span><span class="op" id="5472897">;</span>&nbsp;<span class="ident" id="5472899"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5472903">!=</span>&nbsp;<span class="ident" id="5472906">nil</span>&nbsp;<span class="op" id="5472910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472915">return</span>&nbsp;<span class="string" id="5472922">&#34;&#34;</span><span class="op" id="5472924">,</span>&nbsp;<span class="ident" id="5472926"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472936">if</span>&nbsp;<span class="op" id="5472939">!</span><span class="ident" id="5472940"><a href="/regexp/syntax/parse.go.html#5474408">isValidCaptureName</a></span><span class="op" id="5472958">(</span><span class="ident" id="5472959"><a href="/regexp/syntax/parse.go.html#5472840">name</a></span><span class="op" id="5472963">)</span>&nbsp;<span class="op" id="5472965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472970">return</span>&nbsp;<span class="string" id="5472977">&#34;&#34;</span><span class="op" id="5472979">,</span>&nbsp;<span class="op" id="5472981">&amp;</span><span class="ident" id="5472982"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5472987">{</span><span class="ident" id="5472988"><a href="/regexp/syntax/parse.go.html#5448742">ErrInvalidNamedCapture</a></span><span class="op" id="5473010">,</span>&nbsp;<span class="ident" id="5473012"><a href="/regexp/syntax/parse.go.html#5472802">capture</a></span><span class="op" id="5473019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473028">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473067"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5473068">.</span><span class="ident" id="5473069">numCap</span><span class="op" id="5473075">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473080">re</span>&nbsp;<span class="op" id="5473083">:=</span>&nbsp;<span class="ident" id="5473086"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5473087">.</span><span class="ident" id="5473088">op</span><span class="op" id="5473090">(</span><span class="ident" id="5473091"><a href="/regexp/syntax/parse.go.html#5450572">opLeftParen</a></span><span class="op" id="5473102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473106"><a href="/regexp/syntax/parse.go.html#5473080">re</a></span><span class="op" id="5473108">.</span><span class="ident" id="5473109">Cap</span>&nbsp;<span class="op" id="5473113">=</span>&nbsp;<span class="ident" id="5473115"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5473116">.</span><span class="ident" id="5473117">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473126"><a href="/regexp/syntax/parse.go.html#5473080">re</a></span><span class="op" id="5473128">.</span><span class="ident" id="5473129">Name</span>&nbsp;<span class="op" id="5473134">=</span>&nbsp;<span class="ident" id="5473136"><a href="/regexp/syntax/parse.go.html#5472840">name</a></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473143">return</span>&nbsp;<span class="ident" id="5473150"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5473151">[</span><span class="ident" id="5473152"><a href="/regexp/syntax/parse.go.html#5472636">end</a></span><span class="op" id="5473155">+</span><span class="num" id="5473156">1</span><span class="op" id="5473157">:</span><span class="op" id="5473158">]</span><span class="op" id="5473159">,</span>&nbsp;<span class="ident" id="5473161">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473170">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473227">var</span>&nbsp;<span class="ident" id="5473231">c</span>&nbsp;<span class="builtintype" id="5473233">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473239"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span>&nbsp;<span class="op" id="5473241">=</span>&nbsp;<span class="ident" id="5473243"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5473244">[</span><span class="num" id="5473245">2</span><span class="op" id="5473246">:</span><span class="op" id="5473247">]</span>&nbsp;<span class="comment" id="5473249">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473261">flags</span>&nbsp;<span class="op" id="5473267">:=</span>&nbsp;<span class="ident" id="5473270"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5473271">.</span><span class="ident" id="5473272">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473279">sign</span>&nbsp;<span class="op" id="5473284">:=</span>&nbsp;<span class="op" id="5473287">+</span><span class="num" id="5473288">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473291">sawFlag</span>&nbsp;<span class="op" id="5473299">:=</span>&nbsp;<span class="builtintype" id="5473302">false</span><br>
<span class="lineno"></span><span class="ident" id="5473308">Loop</span><span class="op" id="5473312">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473315">for</span>&nbsp;<span class="ident" id="5473319"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span>&nbsp;<span class="op" id="5473321">!=</span>&nbsp;<span class="string" id="5473324">&#34;&#34;</span>&nbsp;<span class="op" id="5473327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473331">if</span>&nbsp;<span class="ident" id="5473334"><a href="/regexp/syntax/parse.go.html#5473231">c</a></span><span class="op" id="5473335">,</span>&nbsp;<span class="ident" id="5473337"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5473338">,</span>&nbsp;<span class="ident" id="5473340"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5473344">=</span>&nbsp;<span class="ident" id="5473346"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5473354">(</span><span class="ident" id="5473355"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5473356">)</span><span class="op" id="5473357">;</span>&nbsp;<span class="ident" id="5473359"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span>&nbsp;<span class="op" id="5473363">!=</span>&nbsp;<span class="ident" id="5473366">nil</span>&nbsp;<span class="op" id="5473370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473375">return</span>&nbsp;<span class="string" id="5473382">&#34;&#34;</span><span class="op" id="5473384">,</span>&nbsp;<span class="ident" id="5473386"><a href="/regexp/syntax/parse.go.html#5471774">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473396">switch</span>&nbsp;<span class="ident" id="5473403"><a href="/regexp/syntax/parse.go.html#5473231">c</a></span>&nbsp;<span class="op" id="5473405">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473409">default</span><span class="op" id="5473416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473421">break</span>&nbsp;<span class="ident" id="5473427">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473435">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473447">case</span>&nbsp;<span class="string" id="5473452">&#39;i&#39;</span><span class="op" id="5473455">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473460"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5473466">|=</span>&nbsp;<span class="ident" id="5473469"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473481"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473489">=</span>&nbsp;<span class="builtintype" id="5473491">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473498">case</span>&nbsp;<span class="string" id="5473503">&#39;m&#39;</span><span class="op" id="5473506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473511"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5473517">&amp;^=</span>&nbsp;<span class="ident" id="5473521"><a href="/regexp/syntax/parse.go.html#5449868">OneLine</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473532"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473540">=</span>&nbsp;<span class="builtintype" id="5473542">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473549">case</span>&nbsp;<span class="string" id="5473554">&#39;s&#39;</span><span class="op" id="5473557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473562"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5473568">|=</span>&nbsp;<span class="ident" id="5473571"><a href="/regexp/syntax/parse.go.html#5449807">DotNL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473580"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473588">=</span>&nbsp;<span class="builtintype" id="5473590">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473597">case</span>&nbsp;<span class="string" id="5473602">&#39;U&#39;</span><span class="op" id="5473605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473610"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5473616">|=</span>&nbsp;<span class="ident" id="5473619"><a href="/regexp/syntax/parse.go.html#5449964">NonGreedy</a></span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473632"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473640">=</span>&nbsp;<span class="builtintype" id="5473642">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473650">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473675">case</span>&nbsp;<span class="string" id="5473680">&#39;-&#39;</span><span class="op" id="5473683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473688">if</span>&nbsp;<span class="ident" id="5473691"><a href="/regexp/syntax/parse.go.html#5473279">sign</a></span>&nbsp;<span class="op" id="5473696">&lt;</span>&nbsp;<span class="num" id="5473698">0</span>&nbsp;<span class="op" id="5473700">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473706">break</span>&nbsp;<span class="ident" id="5473712">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473725"><a href="/regexp/syntax/parse.go.html#5473279">sign</a></span>&nbsp;<span class="op" id="5473730">=</span>&nbsp;<span class="op" id="5473732">-</span><span class="num" id="5473733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473738">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473802">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473856"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5473862">=</span>&nbsp;<span class="op" id="5473864">^</span><span class="ident" id="5473865"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473874"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473882">=</span>&nbsp;<span class="builtintype" id="5473884">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473893">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473935">case</span>&nbsp;<span class="string" id="5473940">&#39;:&#39;</span><span class="op" id="5473943">,</span>&nbsp;<span class="string" id="5473945">&#39;)&#39;</span><span class="op" id="5473948">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473953">if</span>&nbsp;<span class="ident" id="5473956"><a href="/regexp/syntax/parse.go.html#5473279">sign</a></span>&nbsp;<span class="op" id="5473961">&lt;</span>&nbsp;<span class="num" id="5473963">0</span>&nbsp;<span class="op" id="5473965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473971">if</span>&nbsp;<span class="op" id="5473974">!</span><span class="ident" id="5473975"><a href="/regexp/syntax/parse.go.html#5473291">sawFlag</a></span>&nbsp;<span class="op" id="5473983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473990">break</span>&nbsp;<span class="ident" id="5473996">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474011"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span>&nbsp;<span class="op" id="5474017">=</span>&nbsp;<span class="op" id="5474019">^</span><span class="ident" id="5474020"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474034">if</span>&nbsp;<span class="ident" id="5474037"><a href="/regexp/syntax/parse.go.html#5473231">c</a></span>&nbsp;<span class="op" id="5474039">==</span>&nbsp;<span class="string" id="5474042">&#39;:&#39;</span>&nbsp;<span class="op" id="5474046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474052">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474074"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5474075">.</span><span class="ident" id="5474076">op</span><span class="op" id="5474078">(</span><span class="ident" id="5474079"><a href="/regexp/syntax/parse.go.html#5450572">opLeftParen</a></span><span class="op" id="5474090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474095">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474100"><a href="/regexp/syntax/parse.go.html#5471724">p</a></span><span class="op" id="5474101">.</span><span class="ident" id="5474102">flags</span>&nbsp;<span class="op" id="5474108">=</span>&nbsp;<span class="ident" id="5474110"><a href="/regexp/syntax/parse.go.html#5473261">flags</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474119">return</span>&nbsp;<span class="ident" id="5474126"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5474127">,</span>&nbsp;<span class="ident" id="5474129">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474142">return</span>&nbsp;<span class="string" id="5474149">&#34;&#34;</span><span class="op" id="5474151">,</span>&nbsp;<span class="op" id="5474153">&amp;</span><span class="ident" id="5474154"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5474159">{</span><span class="ident" id="5474160"><a href="/regexp/syntax/parse.go.html#5448804">ErrInvalidPerlOp</a></span><span class="op" id="5474176">,</span>&nbsp;<span class="ident" id="5474178"><a href="/regexp/syntax/parse.go.html#5471750">s</a></span><span class="op" id="5474179">[</span><span class="op" id="5474180">:</span><span class="builtinfunc" id="5474181">len</span><span class="op" id="5474184">(</span><span class="ident" id="5474185"><a href="/regexp/syntax/parse.go.html#5471750">s</a></span><span class="op" id="5474186">)</span><span class="op" id="5474187">-</span><span class="builtinfunc" id="5474188">len</span><span class="op" id="5474191">(</span><span class="ident" id="5474192"><a href="/regexp/syntax/parse.go.html#5471788">t</a></span><span class="op" id="5474193">)</span><span class="op" id="5474194">]</span><span class="op" id="5474195">}</span><br>
<span class="lineno"></span><span class="op" id="5474197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5474200">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5474243">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5474286">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5474320">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5474366">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5474403">func</span>&nbsp;<span class="ident" id="5474408">isValidCaptureName</span><span class="op" id="5474426">(</span><span class="ident" id="5474427">name</span>&nbsp;<span class="builtintype" id="5474432">string</span><span class="op" id="5474438">)</span>&nbsp;<span class="builtintype" id="5474440">bool</span>&nbsp;<span class="op" id="5474445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474448">if</span>&nbsp;<span class="ident" id="5474451"><a href="/regexp/syntax/parse.go.html#5474427">name</a></span>&nbsp;<span class="op" id="5474456">==</span>&nbsp;<span class="string" id="5474459">&#34;&#34;</span>&nbsp;<span class="op" id="5474462">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474466">return</span>&nbsp;<span class="builtintype" id="5474473">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474483">for</span>&nbsp;<span class="ident" id="5474487">_</span><span class="op" id="5474488">,</span>&nbsp;<span class="ident" id="5474490">c</span>&nbsp;<span class="op" id="5474492">:=</span>&nbsp;<span class="keyword" id="5474495">range</span>&nbsp;<span class="ident" id="5474501"><a href="/regexp/syntax/parse.go.html#5474427">name</a></span>&nbsp;<span class="op" id="5474506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474510">if</span>&nbsp;<span class="ident" id="5474513"><a href="/regexp/syntax/parse.go.html#5474490">c</a></span>&nbsp;<span class="op" id="5474515">!=</span>&nbsp;<span class="string" id="5474518">&#39;_&#39;</span>&nbsp;<span class="op" id="5474522">&amp;&amp;</span>&nbsp;<span class="op" id="5474525">!</span><span class="ident" id="5474526"><a href="/regexp/syntax/parse.go.html#5494358">isalnum</a></span><span class="op" id="5474533">(</span><span class="ident" id="5474534"><a href="/regexp/syntax/parse.go.html#5474490">c</a></span><span class="op" id="5474535">)</span>&nbsp;<span class="op" id="5474537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474542">return</span>&nbsp;<span class="builtintype" id="5474549">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474563">return</span>&nbsp;<span class="builtintype" id="5474570">true</span><br>
<span class="lineno"></span><span class="op" id="5474575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5474578">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5474616">func</span>&nbsp;<span class="op" id="5474621">(</span><span class="ident" id="5474622">p</span>&nbsp;<span class="op" id="5474624">*</span><span class="ident" id="5474625"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5474631">)</span>&nbsp;<span class="ident" id="5474633">parseInt</span><span class="op" id="5474641">(</span><span class="ident" id="5474642">s</span>&nbsp;<span class="builtintype" id="5474644">string</span><span class="op" id="5474650">)</span>&nbsp;<span class="op" id="5474652">(</span><span class="ident" id="5474653">n</span>&nbsp;<span class="builtintype" id="5474655">int</span><span class="op" id="5474658">,</span>&nbsp;<span class="ident" id="5474660">rest</span>&nbsp;<span class="builtintype" id="5474665">string</span><span class="op" id="5474671">,</span>&nbsp;<span class="ident" id="5474673">ok</span>&nbsp;<span class="builtintype" id="5474676">bool</span><span class="op" id="5474680">)</span>&nbsp;<span class="op" id="5474682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474685">if</span>&nbsp;<span class="ident" id="5474688"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span>&nbsp;<span class="op" id="5474690">==</span>&nbsp;<span class="string" id="5474693">&#34;&#34;</span>&nbsp;<span class="op" id="5474696">||</span>&nbsp;<span class="ident" id="5474699"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474700">[</span><span class="num" id="5474701">0</span><span class="op" id="5474702">]</span>&nbsp;<span class="op" id="5474704">&lt;</span>&nbsp;<span class="string" id="5474706">&#39;0&#39;</span>&nbsp;<span class="op" id="5474710">||</span>&nbsp;<span class="string" id="5474713">&#39;9&#39;</span>&nbsp;<span class="op" id="5474717">&lt;</span>&nbsp;<span class="ident" id="5474719"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474720">[</span><span class="num" id="5474721">0</span><span class="op" id="5474722">]</span>&nbsp;<span class="op" id="5474724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474728">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474736">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474739">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474767">if</span>&nbsp;<span class="builtinfunc" id="5474770">len</span><span class="op" id="5474773">(</span><span class="ident" id="5474774"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474775">)</span>&nbsp;<span class="op" id="5474777">&gt;=</span>&nbsp;<span class="num" id="5474780">2</span>&nbsp;<span class="op" id="5474782">&amp;&amp;</span>&nbsp;<span class="ident" id="5474785"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474786">[</span><span class="num" id="5474787">0</span><span class="op" id="5474788">]</span>&nbsp;<span class="op" id="5474790">==</span>&nbsp;<span class="string" id="5474793">&#39;0&#39;</span>&nbsp;<span class="op" id="5474797">&amp;&amp;</span>&nbsp;<span class="string" id="5474800">&#39;0&#39;</span>&nbsp;<span class="op" id="5474804">&lt;=</span>&nbsp;<span class="ident" id="5474807"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474808">[</span><span class="num" id="5474809">1</span><span class="op" id="5474810">]</span>&nbsp;<span class="op" id="5474812">&amp;&amp;</span>&nbsp;<span class="ident" id="5474815"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474816">[</span><span class="num" id="5474817">1</span><span class="op" id="5474818">]</span>&nbsp;<span class="op" id="5474820">&lt;=</span>&nbsp;<span class="string" id="5474823">&#39;9&#39;</span>&nbsp;<span class="op" id="5474827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474842">t</span>&nbsp;<span class="op" id="5474844">:=</span>&nbsp;<span class="ident" id="5474847"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474850">for</span>&nbsp;<span class="ident" id="5474854"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span>&nbsp;<span class="op" id="5474856">!=</span>&nbsp;<span class="string" id="5474859">&#34;&#34;</span>&nbsp;<span class="op" id="5474862">&amp;&amp;</span>&nbsp;<span class="string" id="5474865">&#39;0&#39;</span>&nbsp;<span class="op" id="5474869">&lt;=</span>&nbsp;<span class="ident" id="5474872"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474873">[</span><span class="num" id="5474874">0</span><span class="op" id="5474875">]</span>&nbsp;<span class="op" id="5474877">&amp;&amp;</span>&nbsp;<span class="ident" id="5474880"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474881">[</span><span class="num" id="5474882">0</span><span class="op" id="5474883">]</span>&nbsp;<span class="op" id="5474885">&lt;=</span>&nbsp;<span class="string" id="5474888">&#39;9&#39;</span>&nbsp;<span class="op" id="5474892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474896"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span>&nbsp;<span class="op" id="5474898">=</span>&nbsp;<span class="ident" id="5474900"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474901">[</span><span class="num" id="5474902">1</span><span class="op" id="5474903">:</span><span class="op" id="5474904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474910"><a href="/regexp/syntax/parse.go.html#5474660">rest</a></span>&nbsp;<span class="op" id="5474915">=</span>&nbsp;<span class="ident" id="5474917"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474920"><a href="/regexp/syntax/parse.go.html#5474673">ok</a></span>&nbsp;<span class="op" id="5474923">=</span>&nbsp;<span class="builtintype" id="5474925">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474931">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474963"><a href="/regexp/syntax/parse.go.html#5474842">t</a></span>&nbsp;<span class="op" id="5474965">=</span>&nbsp;<span class="ident" id="5474967"><a href="/regexp/syntax/parse.go.html#5474842">t</a></span><span class="op" id="5474968">[</span><span class="op" id="5474969">:</span><span class="builtinfunc" id="5474970">len</span><span class="op" id="5474973">(</span><span class="ident" id="5474974"><a href="/regexp/syntax/parse.go.html#5474842">t</a></span><span class="op" id="5474975">)</span><span class="op" id="5474976">-</span><span class="builtinfunc" id="5474977">len</span><span class="op" id="5474980">(</span><span class="ident" id="5474981"><a href="/regexp/syntax/parse.go.html#5474642">s</a></span><span class="op" id="5474982">)</span><span class="op" id="5474983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474986">for</span>&nbsp;<span class="ident" id="5474990">i</span>&nbsp;<span class="op" id="5474992">:=</span>&nbsp;<span class="num" id="5474995">0</span><span class="op" id="5474996">;</span>&nbsp;<span class="ident" id="5474998"><a href="/regexp/syntax/parse.go.html#5474990">i</a></span>&nbsp;<span class="op" id="5475000">&lt;</span>&nbsp;<span class="builtinfunc" id="5475002">len</span><span class="op" id="5475005">(</span><span class="ident" id="5475006"><a href="/regexp/syntax/parse.go.html#5474842">t</a></span><span class="op" id="5475007">)</span><span class="op" id="5475008">;</span>&nbsp;<span class="ident" id="5475010"><a href="/regexp/syntax/parse.go.html#5474990">i</a></span><span class="op" id="5475011">++</span>&nbsp;<span class="op" id="5475014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475018">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475039">if</span>&nbsp;<span class="ident" id="5475042"><a href="/regexp/syntax/parse.go.html#5474653">n</a></span>&nbsp;<span class="op" id="5475044">&gt;=</span>&nbsp;<span class="num" id="5475047">1e8</span>&nbsp;<span class="op" id="5475051">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475056"><a href="/regexp/syntax/parse.go.html#5474653">n</a></span>&nbsp;<span class="op" id="5475058">=</span>&nbsp;<span class="op" id="5475060">-</span><span class="num" id="5475061">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475066">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475078"><a href="/regexp/syntax/parse.go.html#5474653">n</a></span>&nbsp;<span class="op" id="5475080">=</span>&nbsp;<span class="ident" id="5475082"><a href="/regexp/syntax/parse.go.html#5474653">n</a></span><span class="op" id="5475083">*</span><span class="num" id="5475084">10</span>&nbsp;<span class="op" id="5475087">+</span>&nbsp;<span class="builtintype" id="5475089">int</span><span class="op" id="5475092">(</span><span class="ident" id="5475093"><a href="/regexp/syntax/parse.go.html#5474842">t</a></span><span class="op" id="5475094">[</span><span class="ident" id="5475095"><a href="/regexp/syntax/parse.go.html#5474990">i</a></span><span class="op" id="5475096">]</span><span class="op" id="5475097">)</span>&nbsp;<span class="op" id="5475099">-</span>&nbsp;<span class="string" id="5475101">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475106">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475109">return</span><br>
<span class="lineno"></span><span class="op" id="5475116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475119">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5475168">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5475224">func</span>&nbsp;<span class="ident" id="5475229">isCharClass</span><span class="op" id="5475240">(</span><span class="ident" id="5475241">re</span>&nbsp;<span class="op" id="5475244">*</span><span class="ident" id="5475245"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5475251">)</span>&nbsp;<span class="builtintype" id="5475253">bool</span>&nbsp;<span class="op" id="5475258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475261">return</span>&nbsp;<span class="ident" id="5475268"><a href="/regexp/syntax/parse.go.html#5475241">re</a></span><span class="op" id="5475270">.</span><span class="ident" id="5475271">Op</span>&nbsp;<span class="op" id="5475274">==</span>&nbsp;<span class="ident" id="5475277"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5475287">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5475290">len</span><span class="op" id="5475293">(</span><span class="ident" id="5475294"><a href="/regexp/syntax/parse.go.html#5475241">re</a></span><span class="op" id="5475296">.</span><span class="ident" id="5475297">Rune</span><span class="op" id="5475301">)</span>&nbsp;<span class="op" id="5475303">==</span>&nbsp;<span class="num" id="5475306">1</span>&nbsp;<span class="op" id="5475308">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475313"><a href="/regexp/syntax/parse.go.html#5475241">re</a></span><span class="op" id="5475315">.</span><span class="ident" id="5475316">Op</span>&nbsp;<span class="op" id="5475319">==</span>&nbsp;<span class="ident" id="5475322"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span>&nbsp;<span class="op" id="5475334">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475339"><a href="/regexp/syntax/parse.go.html#5475241">re</a></span><span class="op" id="5475341">.</span><span class="ident" id="5475342">Op</span>&nbsp;<span class="op" id="5475345">==</span>&nbsp;<span class="ident" id="5475348"><a href="/regexp/syntax/regexp.go.html#5506213">OpAnyCharNotNL</a></span>&nbsp;<span class="op" id="5475363">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475368"><a href="/regexp/syntax/parse.go.html#5475241">re</a></span><span class="op" id="5475370">.</span><span class="ident" id="5475371">Op</span>&nbsp;<span class="op" id="5475374">==</span>&nbsp;<span class="ident" id="5475377"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><br>
<span class="lineno">1090</span><span class="op" id="5475387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475390">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5475410">func</span>&nbsp;<span class="ident" id="5475415">matchRune</span><span class="op" id="5475424">(</span><span class="ident" id="5475425">re</span>&nbsp;<span class="op" id="5475428">*</span><span class="ident" id="5475429"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5475435">,</span>&nbsp;<span class="ident" id="5475437">r</span>&nbsp;<span class="builtintype" id="5475439">rune</span><span class="op" id="5475443">)</span>&nbsp;<span class="builtintype" id="5475445">bool</span>&nbsp;<span class="op" id="5475450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475453">switch</span>&nbsp;<span class="ident" id="5475460"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475462">.</span><span class="ident" id="5475463">Op</span>&nbsp;<span class="op" id="5475466">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475469">case</span>&nbsp;<span class="ident" id="5475474"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><span class="op" id="5475483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475487">return</span>&nbsp;<span class="builtinfunc" id="5475494">len</span><span class="op" id="5475497">(</span><span class="ident" id="5475498"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475500">.</span><span class="ident" id="5475501">Rune</span><span class="op" id="5475505">)</span>&nbsp;<span class="op" id="5475507">==</span>&nbsp;<span class="num" id="5475510">1</span>&nbsp;<span class="op" id="5475512">&amp;&amp;</span>&nbsp;<span class="ident" id="5475515"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475517">.</span><span class="ident" id="5475518">Rune</span><span class="op" id="5475522">[</span><span class="num" id="5475523">0</span><span class="op" id="5475524">]</span>&nbsp;<span class="op" id="5475526">==</span>&nbsp;<span class="ident" id="5475529"><a href="/regexp/syntax/parse.go.html#5475437">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475532">case</span>&nbsp;<span class="ident" id="5475537"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><span class="op" id="5475548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475552">for</span>&nbsp;<span class="ident" id="5475556">i</span>&nbsp;<span class="op" id="5475558">:=</span>&nbsp;<span class="num" id="5475561">0</span><span class="op" id="5475562">;</span>&nbsp;<span class="ident" id="5475564"><a href="/regexp/syntax/parse.go.html#5475556">i</a></span>&nbsp;<span class="op" id="5475566">&lt;</span>&nbsp;<span class="builtinfunc" id="5475568">len</span><span class="op" id="5475571">(</span><span class="ident" id="5475572"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475574">.</span><span class="ident" id="5475575">Rune</span><span class="op" id="5475579">)</span><span class="op" id="5475580">;</span>&nbsp;<span class="ident" id="5475582"><a href="/regexp/syntax/parse.go.html#5475556">i</a></span>&nbsp;<span class="op" id="5475584">+=</span>&nbsp;<span class="num" id="5475587">2</span>&nbsp;<span class="op" id="5475589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475594">if</span>&nbsp;<span class="ident" id="5475597"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475599">.</span><span class="ident" id="5475600">Rune</span><span class="op" id="5475604">[</span><span class="ident" id="5475605"><a href="/regexp/syntax/parse.go.html#5475556">i</a></span><span class="op" id="5475606">]</span>&nbsp;<span class="op" id="5475608">&lt;=</span>&nbsp;<span class="ident" id="5475611"><a href="/regexp/syntax/parse.go.html#5475437">r</a></span>&nbsp;<span class="op" id="5475613">&amp;&amp;</span>&nbsp;<span class="ident" id="5475616"><a href="/regexp/syntax/parse.go.html#5475437">r</a></span>&nbsp;<span class="op" id="5475618">&lt;=</span>&nbsp;<span class="ident" id="5475621"><a href="/regexp/syntax/parse.go.html#5475425">re</a></span><span class="op" id="5475623">.</span><span class="ident" id="5475624">Rune</span><span class="op" id="5475628">[</span><span class="ident" id="5475629"><a href="/regexp/syntax/parse.go.html#5475556">i</a></span><span class="op" id="5475630">+</span><span class="num" id="5475631">1</span><span class="op" id="5475632">]</span>&nbsp;<span class="op" id="5475634">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475640">return</span>&nbsp;<span class="builtintype" id="5475647">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475663">return</span>&nbsp;<span class="builtintype" id="5475670">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475677">case</span>&nbsp;<span class="ident" id="5475682"><a href="/regexp/syntax/regexp.go.html#5506213">OpAnyCharNotNL</a></span><span class="op" id="5475696">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475700">return</span>&nbsp;<span class="ident" id="5475707"><a href="/regexp/syntax/parse.go.html#5475437">r</a></span>&nbsp;<span class="op" id="5475709">!=</span>&nbsp;<span class="string" id="5475712">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475718">case</span>&nbsp;<span class="ident" id="5475723"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><span class="op" id="5475732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475736">return</span>&nbsp;<span class="builtintype" id="5475743">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5475749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475752">return</span>&nbsp;<span class="builtintype" id="5475759">false</span><br>
<span class="lineno">1110</span><span class="op" id="5475765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475768">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5475814">func</span>&nbsp;<span class="op" id="5475819">(</span><span class="ident" id="5475820">p</span>&nbsp;<span class="op" id="5475822">*</span><span class="ident" id="5475823"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5475829">)</span>&nbsp;<span class="ident" id="5475831">parseVerticalBar</span><span class="op" id="5475847">(</span><span class="op" id="5475848">)</span>&nbsp;<span class="builtintype" id="5475850">error</span>&nbsp;<span class="op" id="5475856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475859"><a href="/regexp/syntax/parse.go.html#5475820">p</a></span><span class="op" id="5475860">.</span><span class="ident" id="5475861">concat</span><span class="op" id="5475867">(</span><span class="op" id="5475868">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475872">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475933">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475986">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476045">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476085">if</span>&nbsp;<span class="op" id="5476088">!</span><span class="ident" id="5476089"><a href="/regexp/syntax/parse.go.html#5475820">p</a></span><span class="op" id="5476090">.</span><span class="ident" id="5476091">swapVerticalBar</span><span class="op" id="5476106">(</span><span class="op" id="5476107">)</span>&nbsp;<span class="op" id="5476109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476113"><a href="/regexp/syntax/parse.go.html#5475820">p</a></span><span class="op" id="5476114">.</span><span class="ident" id="5476115">op</span><span class="op" id="5476117">(</span><span class="ident" id="5476118"><a href="/regexp/syntax/parse.go.html#5450603">opVerticalBar</a></span><span class="op" id="5476131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476138">return</span>&nbsp;<span class="ident" id="5476145">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5476149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476152">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5476191">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5476240">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5476276">func</span>&nbsp;<span class="ident" id="5476281">mergeCharClass</span><span class="op" id="5476295">(</span><span class="ident" id="5476296">dst</span><span class="op" id="5476299">,</span>&nbsp;<span class="ident" id="5476301">src</span>&nbsp;<span class="op" id="5476305">*</span><span class="ident" id="5476306"><a href="/regexp/syntax/regexp.go.html#5505274">Regexp</a></span><span class="op" id="5476312">)</span>&nbsp;<span class="op" id="5476314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476317">switch</span>&nbsp;<span class="ident" id="5476324"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476327">.</span><span class="ident" id="5476328">Op</span>&nbsp;<span class="op" id="5476331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476334">case</span>&nbsp;<span class="ident" id="5476339"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><span class="op" id="5476348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476352">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476382">case</span>&nbsp;<span class="ident" id="5476387"><a href="/regexp/syntax/regexp.go.html#5506213">OpAnyCharNotNL</a></span><span class="op" id="5476401">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476405">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476427">if</span>&nbsp;<span class="ident" id="5476430"><a href="/regexp/syntax/parse.go.html#5475415">matchRune</a></span><span class="op" id="5476439">(</span><span class="ident" id="5476440"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476443">,</span>&nbsp;<span class="string" id="5476445">&#39;\n&#39;</span><span class="op" id="5476449">)</span>&nbsp;<span class="op" id="5476451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476456"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476459">.</span><span class="ident" id="5476460">Op</span>&nbsp;<span class="op" id="5476463">=</span>&nbsp;<span class="ident" id="5476465"><a href="/regexp/syntax/regexp.go.html#5506285">OpAnyChar</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476480">case</span>&nbsp;<span class="ident" id="5476485"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><span class="op" id="5476496">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476500">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476553">if</span>&nbsp;<span class="ident" id="5476556"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476559">.</span><span class="ident" id="5476560">Op</span>&nbsp;<span class="op" id="5476563">==</span>&nbsp;<span class="ident" id="5476566"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span>&nbsp;<span class="op" id="5476576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476581"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476584">.</span><span class="ident" id="5476585">Rune</span>&nbsp;<span class="op" id="5476590">=</span>&nbsp;<span class="ident" id="5476592"><a href="/regexp/syntax/parse.go.html#5488550">appendLiteral</a></span><span class="op" id="5476605">(</span><span class="ident" id="5476606"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476609">.</span><span class="ident" id="5476610">Rune</span><span class="op" id="5476614">,</span>&nbsp;<span class="ident" id="5476616"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476619">.</span><span class="ident" id="5476620">Rune</span><span class="op" id="5476624">[</span><span class="num" id="5476625">0</span><span class="op" id="5476626">]</span><span class="op" id="5476627">,</span>&nbsp;<span class="ident" id="5476629"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476632">.</span><span class="ident" id="5476633">Flags</span><span class="op" id="5476638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476642">}</span>&nbsp;<span class="keyword" id="5476644">else</span>&nbsp;<span class="op" id="5476649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476654"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476657">.</span><span class="ident" id="5476658">Rune</span>&nbsp;<span class="op" id="5476663">=</span>&nbsp;<span class="ident" id="5476665"><a href="/regexp/syntax/parse.go.html#5490463">appendClass</a></span><span class="op" id="5476676">(</span><span class="ident" id="5476677"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476680">.</span><span class="ident" id="5476681">Rune</span><span class="op" id="5476685">,</span>&nbsp;<span class="ident" id="5476687"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476690">.</span><span class="ident" id="5476691">Rune</span><span class="op" id="5476695">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476702">case</span>&nbsp;<span class="ident" id="5476707"><a href="/regexp/syntax/regexp.go.html#5506075">OpLiteral</a></span><span class="op" id="5476716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476720">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476738">if</span>&nbsp;<span class="ident" id="5476741"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476744">.</span><span class="ident" id="5476745">Rune</span><span class="op" id="5476749">[</span><span class="num" id="5476750">0</span><span class="op" id="5476751">]</span>&nbsp;<span class="op" id="5476753">==</span>&nbsp;<span class="ident" id="5476756"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476759">.</span><span class="ident" id="5476760">Rune</span><span class="op" id="5476764">[</span><span class="num" id="5476765">0</span><span class="op" id="5476766">]</span>&nbsp;<span class="op" id="5476768">&amp;&amp;</span>&nbsp;<span class="ident" id="5476771"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476774">.</span><span class="ident" id="5476775">Flags</span>&nbsp;<span class="op" id="5476781">==</span>&nbsp;<span class="ident" id="5476784"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476787">.</span><span class="ident" id="5476788">Flags</span>&nbsp;<span class="op" id="5476794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476799">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476811"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476814">.</span><span class="ident" id="5476815">Op</span>&nbsp;<span class="op" id="5476818">=</span>&nbsp;<span class="ident" id="5476820"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476834"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476837">.</span><span class="ident" id="5476838">Rune</span>&nbsp;<span class="op" id="5476843">=</span>&nbsp;<span class="ident" id="5476845"><a href="/regexp/syntax/parse.go.html#5488550">appendLiteral</a></span><span class="op" id="5476858">(</span><span class="ident" id="5476859"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476862">.</span><span class="ident" id="5476863">Rune</span><span class="op" id="5476867">[</span><span class="op" id="5476868">:</span><span class="num" id="5476869">0</span><span class="op" id="5476870">]</span><span class="op" id="5476871">,</span>&nbsp;<span class="ident" id="5476873"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476876">.</span><span class="ident" id="5476877">Rune</span><span class="op" id="5476881">[</span><span class="num" id="5476882">0</span><span class="op" id="5476883">]</span><span class="op" id="5476884">,</span>&nbsp;<span class="ident" id="5476886"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476889">.</span><span class="ident" id="5476890">Flags</span><span class="op" id="5476895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476899"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476902">.</span><span class="ident" id="5476903">Rune</span>&nbsp;<span class="op" id="5476908">=</span>&nbsp;<span class="ident" id="5476910"><a href="/regexp/syntax/parse.go.html#5488550">appendLiteral</a></span><span class="op" id="5476923">(</span><span class="ident" id="5476924"><a href="/regexp/syntax/parse.go.html#5476296">dst</a></span><span class="op" id="5476927">.</span><span class="ident" id="5476928">Rune</span><span class="op" id="5476932">,</span>&nbsp;<span class="ident" id="5476934"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476937">.</span><span class="ident" id="5476938">Rune</span><span class="op" id="5476942">[</span><span class="num" id="5476943">0</span><span class="op" id="5476944">]</span><span class="op" id="5476945">,</span>&nbsp;<span class="ident" id="5476947"><a href="/regexp/syntax/parse.go.html#5476301">src</a></span><span class="op" id="5476950">.</span><span class="ident" id="5476951">Flags</span><span class="op" id="5476956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476959">}</span><br>
<span class="lineno">1155</span><span class="op" id="5476961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476964">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5477034">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5477085">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5477116">func</span>&nbsp;<span class="op" id="5477121">(</span><span class="ident" id="5477122">p</span>&nbsp;<span class="op" id="5477124">*</span><span class="ident" id="5477125"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5477131">)</span>&nbsp;<span class="ident" id="5477133">swapVerticalBar</span><span class="op" id="5477148">(</span><span class="op" id="5477149">)</span>&nbsp;<span class="builtintype" id="5477151">bool</span>&nbsp;<span class="op" id="5477156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477159">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477222">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477262">n</span>&nbsp;<span class="op" id="5477264">:=</span>&nbsp;<span class="builtinfunc" id="5477267">len</span><span class="op" id="5477270">(</span><span class="ident" id="5477271"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477272">.</span><span class="ident" id="5477273">stack</span><span class="op" id="5477278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477281">if</span>&nbsp;<span class="ident" id="5477284"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span>&nbsp;<span class="op" id="5477286">&gt;=</span>&nbsp;<span class="num" id="5477289">3</span>&nbsp;<span class="op" id="5477291">&amp;&amp;</span>&nbsp;<span class="ident" id="5477294"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477295">.</span><span class="ident" id="5477296">stack</span><span class="op" id="5477301">[</span><span class="ident" id="5477302"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477303">-</span><span class="num" id="5477304">2</span><span class="op" id="5477305">]</span><span class="op" id="5477306">.</span><span class="ident" id="5477307">Op</span>&nbsp;<span class="op" id="5477310">==</span>&nbsp;<span class="ident" id="5477313"><a href="/regexp/syntax/parse.go.html#5450603">opVerticalBar</a></span>&nbsp;<span class="op" id="5477327">&amp;&amp;</span>&nbsp;<span class="ident" id="5477330"><a href="/regexp/syntax/parse.go.html#5475229">isCharClass</a></span><span class="op" id="5477341">(</span><span class="ident" id="5477342"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477343">.</span><span class="ident" id="5477344">stack</span><span class="op" id="5477349">[</span><span class="ident" id="5477350"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477351">-</span><span class="num" id="5477352">1</span><span class="op" id="5477353">]</span><span class="op" id="5477354">)</span>&nbsp;<span class="op" id="5477356">&amp;&amp;</span>&nbsp;<span class="ident" id="5477359"><a href="/regexp/syntax/parse.go.html#5475229">isCharClass</a></span><span class="op" id="5477370">(</span><span class="ident" id="5477371"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477372">.</span><span class="ident" id="5477373">stack</span><span class="op" id="5477378">[</span><span class="ident" id="5477379"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477380">-</span><span class="num" id="5477381">3</span><span class="op" id="5477382">]</span><span class="op" id="5477383">)</span>&nbsp;<span class="op" id="5477385">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477389">re1</span>&nbsp;<span class="op" id="5477393">:=</span>&nbsp;<span class="ident" id="5477396"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477397">.</span><span class="ident" id="5477398">stack</span><span class="op" id="5477403">[</span><span class="ident" id="5477404"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477405">-</span><span class="num" id="5477406">1</span><span class="op" id="5477407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477411">re3</span>&nbsp;<span class="op" id="5477415">:=</span>&nbsp;<span class="ident" id="5477418"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477419">.</span><span class="ident" id="5477420">stack</span><span class="op" id="5477425">[</span><span class="ident" id="5477426"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477427">-</span><span class="num" id="5477428">3</span><span class="op" id="5477429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477433">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477476">if</span>&nbsp;<span class="ident" id="5477479"><a href="/regexp/syntax/parse.go.html#5477389">re1</a></span><span class="op" id="5477482">.</span><span class="ident" id="5477483">Op</span>&nbsp;<span class="op" id="5477486">&gt;</span>&nbsp;<span class="ident" id="5477488"><a href="/regexp/syntax/parse.go.html#5477411">re3</a></span><span class="op" id="5477491">.</span><span class="ident" id="5477492">Op</span>&nbsp;<span class="op" id="5477495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477500"><a href="/regexp/syntax/parse.go.html#5477389">re1</a></span><span class="op" id="5477503">,</span>&nbsp;<span class="ident" id="5477505"><a href="/regexp/syntax/parse.go.html#5477411">re3</a></span>&nbsp;<span class="op" id="5477509">=</span>&nbsp;<span class="ident" id="5477511"><a href="/regexp/syntax/parse.go.html#5477411">re3</a></span><span class="op" id="5477514">,</span>&nbsp;<span class="ident" id="5477516"><a href="/regexp/syntax/parse.go.html#5477389">re1</a></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477523"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477524">.</span><span class="ident" id="5477525">stack</span><span class="op" id="5477530">[</span><span class="ident" id="5477531"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477532">-</span><span class="num" id="5477533">3</span><span class="op" id="5477534">]</span>&nbsp;<span class="op" id="5477536">=</span>&nbsp;<span class="ident" id="5477538"><a href="/regexp/syntax/parse.go.html#5477411">re3</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477548"><a href="/regexp/syntax/parse.go.html#5476281">mergeCharClass</a></span><span class="op" id="5477562">(</span><span class="ident" id="5477563"><a href="/regexp/syntax/parse.go.html#5477411">re3</a></span><span class="op" id="5477566">,</span>&nbsp;<span class="ident" id="5477568"><a href="/regexp/syntax/parse.go.html#5477389">re1</a></span><span class="op" id="5477571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477575"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477576">.</span><span class="ident" id="5477577">reuse</span><span class="op" id="5477582">(</span><span class="ident" id="5477583"><a href="/regexp/syntax/parse.go.html#5477389">re1</a></span><span class="op" id="5477586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477590"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477591">.</span><span class="ident" id="5477592">stack</span>&nbsp;<span class="op" id="5477598">=</span>&nbsp;<span class="ident" id="5477600"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477601">.</span><span class="ident" id="5477602">stack</span><span class="op" id="5477607">[</span><span class="op" id="5477608">:</span><span class="ident" id="5477609"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477610">-</span><span class="num" id="5477611">1</span><span class="op" id="5477612">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477616">return</span>&nbsp;<span class="builtintype" id="5477623">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477633">if</span>&nbsp;<span class="ident" id="5477636"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span>&nbsp;<span class="op" id="5477638">&gt;=</span>&nbsp;<span class="num" id="5477641">2</span>&nbsp;<span class="op" id="5477643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477647">re1</span>&nbsp;<span class="op" id="5477651">:=</span>&nbsp;<span class="ident" id="5477654"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477655">.</span><span class="ident" id="5477656">stack</span><span class="op" id="5477661">[</span><span class="ident" id="5477662"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477663">-</span><span class="num" id="5477664">1</span><span class="op" id="5477665">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477669">re2</span>&nbsp;<span class="op" id="5477673">:=</span>&nbsp;<span class="ident" id="5477676"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477677">.</span><span class="ident" id="5477678">stack</span><span class="op" id="5477683">[</span><span class="ident" id="5477684"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477685">-</span><span class="num" id="5477686">2</span><span class="op" id="5477687">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477691">if</span>&nbsp;<span class="ident" id="5477694"><a href="/regexp/syntax/parse.go.html#5477669">re2</a></span><span class="op" id="5477697">.</span><span class="ident" id="5477698">Op</span>&nbsp;<span class="op" id="5477701">==</span>&nbsp;<span class="ident" id="5477704"><a href="/regexp/syntax/parse.go.html#5450603">opVerticalBar</a></span>&nbsp;<span class="op" id="5477718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477723">if</span>&nbsp;<span class="ident" id="5477726"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span>&nbsp;<span class="op" id="5477728">&gt;=</span>&nbsp;<span class="num" id="5477731">3</span>&nbsp;<span class="op" id="5477733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477739">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477764">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477796"><a href="/regexp/syntax/parse.go.html#5457606">cleanAlt</a></span><span class="op" id="5477804">(</span><span class="ident" id="5477805"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477806">.</span><span class="ident" id="5477807">stack</span><span class="op" id="5477812">[</span><span class="ident" id="5477813"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477814">-</span><span class="num" id="5477815">3</span><span class="op" id="5477816">]</span><span class="op" id="5477817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477827"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477828">.</span><span class="ident" id="5477829">stack</span><span class="op" id="5477834">[</span><span class="ident" id="5477835"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477836">-</span><span class="num" id="5477837">2</span><span class="op" id="5477838">]</span>&nbsp;<span class="op" id="5477840">=</span>&nbsp;<span class="ident" id="5477842"><a href="/regexp/syntax/parse.go.html#5477647">re1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477849"><a href="/regexp/syntax/parse.go.html#5477122">p</a></span><span class="op" id="5477850">.</span><span class="ident" id="5477851">stack</span><span class="op" id="5477856">[</span><span class="ident" id="5477857"><a href="/regexp/syntax/parse.go.html#5477262">n</a></span><span class="op" id="5477858">-</span><span class="num" id="5477859">1</span><span class="op" id="5477860">]</span>&nbsp;<span class="op" id="5477862">=</span>&nbsp;<span class="ident" id="5477864"><a href="/regexp/syntax/parse.go.html#5477669">re2</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477871">return</span>&nbsp;<span class="builtintype" id="5477878">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477891">return</span>&nbsp;<span class="builtintype" id="5477898">false</span><br>
<span class="lineno"></span><span class="op" id="5477904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5477907">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5477952">func</span>&nbsp;<span class="op" id="5477957">(</span><span class="ident" id="5477958">p</span>&nbsp;<span class="op" id="5477960">*</span><span class="ident" id="5477961"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5477967">)</span>&nbsp;<span class="ident" id="5477969">parseRightParen</span><span class="op" id="5477984">(</span><span class="op" id="5477985">)</span>&nbsp;<span class="builtintype" id="5477987">error</span>&nbsp;<span class="op" id="5477993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477996"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5477997">.</span><span class="ident" id="5477998">concat</span><span class="op" id="5478004">(</span><span class="op" id="5478005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478008">if</span>&nbsp;<span class="ident" id="5478011"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478012">.</span><span class="ident" id="5478013">swapVerticalBar</span><span class="op" id="5478028">(</span><span class="op" id="5478029">)</span>&nbsp;<span class="op" id="5478031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478035">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478057"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478058">.</span><span class="ident" id="5478059">stack</span>&nbsp;<span class="op" id="5478065">=</span>&nbsp;<span class="ident" id="5478067"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478068">.</span><span class="ident" id="5478069">stack</span><span class="op" id="5478074">[</span><span class="op" id="5478075">:</span><span class="builtinfunc" id="5478076">len</span><span class="op" id="5478079">(</span><span class="ident" id="5478080"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478081">.</span><span class="ident" id="5478082">stack</span><span class="op" id="5478087">)</span><span class="op" id="5478088">-</span><span class="num" id="5478089">1</span><span class="op" id="5478090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478096"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478097">.</span><span class="ident" id="5478098">alternate</span><span class="op" id="5478107">(</span><span class="op" id="5478108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478112">n</span>&nbsp;<span class="op" id="5478114">:=</span>&nbsp;<span class="builtinfunc" id="5478117">len</span><span class="op" id="5478120">(</span><span class="ident" id="5478121"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478122">.</span><span class="ident" id="5478123">stack</span><span class="op" id="5478128">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478131">if</span>&nbsp;<span class="ident" id="5478134"><a href="/regexp/syntax/parse.go.html#5478112">n</a></span>&nbsp;<span class="op" id="5478136">&lt;</span>&nbsp;<span class="num" id="5478138">2</span>&nbsp;<span class="op" id="5478140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478144">return</span>&nbsp;<span class="op" id="5478151">&amp;</span><span class="ident" id="5478152"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5478157">{</span><span class="ident" id="5478158"><a href="/regexp/syntax/parse.go.html#5449345">ErrUnexpectedParen</a></span><span class="op" id="5478176">,</span>&nbsp;<span class="ident" id="5478178"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478179">.</span><span class="ident" id="5478180">wholeRegexp</span><span class="op" id="5478191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478197">re1</span>&nbsp;<span class="op" id="5478201">:=</span>&nbsp;<span class="ident" id="5478204"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478205">.</span><span class="ident" id="5478206">stack</span><span class="op" id="5478211">[</span><span class="ident" id="5478212"><a href="/regexp/syntax/parse.go.html#5478112">n</a></span><span class="op" id="5478213">-</span><span class="num" id="5478214">1</span><span class="op" id="5478215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478218">re2</span>&nbsp;<span class="op" id="5478222">:=</span>&nbsp;<span class="ident" id="5478225"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478226">.</span><span class="ident" id="5478227">stack</span><span class="op" id="5478232">[</span><span class="ident" id="5478233"><a href="/regexp/syntax/parse.go.html#5478112">n</a></span><span class="op" id="5478234">-</span><span class="num" id="5478235">2</span><span class="op" id="5478236">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478239"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478240">.</span><span class="ident" id="5478241">stack</span>&nbsp;<span class="op" id="5478247">=</span>&nbsp;<span class="ident" id="5478249"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478250">.</span><span class="ident" id="5478251">stack</span><span class="op" id="5478256">[</span><span class="op" id="5478257">:</span><span class="ident" id="5478258"><a href="/regexp/syntax/parse.go.html#5478112">n</a></span><span class="op" id="5478259">-</span><span class="num" id="5478260">2</span><span class="op" id="5478261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478264">if</span>&nbsp;<span class="ident" id="5478267"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478270">.</span><span class="ident" id="5478271">Op</span>&nbsp;<span class="op" id="5478274">!=</span>&nbsp;<span class="ident" id="5478277"><a href="/regexp/syntax/parse.go.html#5450572">opLeftParen</a></span>&nbsp;<span class="op" id="5478289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478293">return</span>&nbsp;<span class="op" id="5478300">&amp;</span><span class="ident" id="5478301"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5478306">{</span><span class="ident" id="5478307"><a href="/regexp/syntax/parse.go.html#5449345">ErrUnexpectedParen</a></span><span class="op" id="5478325">,</span>&nbsp;<span class="ident" id="5478327"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478328">.</span><span class="ident" id="5478329">wholeRegexp</span><span class="op" id="5478340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478346">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478382"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478383">.</span><span class="ident" id="5478384">flags</span>&nbsp;<span class="op" id="5478390">=</span>&nbsp;<span class="ident" id="5478392"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478395">.</span><span class="ident" id="5478396">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478403">if</span>&nbsp;<span class="ident" id="5478406"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478409">.</span><span class="ident" id="5478410">Cap</span>&nbsp;<span class="op" id="5478414">==</span>&nbsp;<span class="num" id="5478417">0</span>&nbsp;<span class="op" id="5478419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478423">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478447"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478448">.</span><span class="ident" id="5478449">push</span><span class="op" id="5478453">(</span><span class="ident" id="5478454"><a href="/regexp/syntax/parse.go.html#5478197">re1</a></span><span class="op" id="5478457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478460">}</span>&nbsp;<span class="keyword" id="5478462">else</span>&nbsp;<span class="op" id="5478467">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478471"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478474">.</span><span class="ident" id="5478475">Op</span>&nbsp;<span class="op" id="5478478">=</span>&nbsp;<span class="ident" id="5478480"><a href="/regexp/syntax/regexp.go.html#5506766">OpCapture</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478492"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478495">.</span><span class="ident" id="5478496">Sub</span>&nbsp;<span class="op" id="5478500">=</span>&nbsp;<span class="ident" id="5478502"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478505">.</span><span class="ident" id="5478506">Sub0</span><span class="op" id="5478510">[</span><span class="op" id="5478511">:</span><span class="num" id="5478512">1</span><span class="op" id="5478513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478517"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478520">.</span><span class="ident" id="5478521">Sub</span><span class="op" id="5478524">[</span><span class="num" id="5478525">0</span><span class="op" id="5478526">]</span>&nbsp;<span class="op" id="5478528">=</span>&nbsp;<span class="ident" id="5478530"><a href="/regexp/syntax/parse.go.html#5478197">re1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478536"><a href="/regexp/syntax/parse.go.html#5477958">p</a></span><span class="op" id="5478537">.</span><span class="ident" id="5478538">push</span><span class="op" id="5478542">(</span><span class="ident" id="5478543"><a href="/regexp/syntax/parse.go.html#5478218">re2</a></span><span class="op" id="5478546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478549">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478552">return</span>&nbsp;<span class="ident" id="5478559">nil</span><br>
<span class="lineno"></span><span class="op" id="5478563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5478566">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5478629">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5478654">func</span>&nbsp;<span class="op" id="5478659">(</span><span class="ident" id="5478660">p</span>&nbsp;<span class="op" id="5478662">*</span><span class="ident" id="5478663"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5478669">)</span>&nbsp;<span class="ident" id="5478671">parseEscape</span><span class="op" id="5478682">(</span><span class="ident" id="5478683">s</span>&nbsp;<span class="builtintype" id="5478685">string</span><span class="op" id="5478691">)</span>&nbsp;<span class="op" id="5478693">(</span><span class="ident" id="5478694">r</span>&nbsp;<span class="builtintype" id="5478696">rune</span><span class="op" id="5478700">,</span>&nbsp;<span class="ident" id="5478702">rest</span>&nbsp;<span class="builtintype" id="5478707">string</span><span class="op" id="5478713">,</span>&nbsp;<span class="ident" id="5478715">err</span>&nbsp;<span class="builtintype" id="5478719">error</span><span class="op" id="5478724">)</span>&nbsp;<span class="op" id="5478726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478729">t</span>&nbsp;<span class="op" id="5478731">:=</span>&nbsp;<span class="ident" id="5478734"><a href="/regexp/syntax/parse.go.html#5478683">s</a></span><span class="op" id="5478735">[</span><span class="num" id="5478736">1</span><span class="op" id="5478737">:</span><span class="op" id="5478738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478741">if</span>&nbsp;<span class="ident" id="5478744"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5478746">==</span>&nbsp;<span class="string" id="5478749">&#34;&#34;</span>&nbsp;<span class="op" id="5478752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478756">return</span>&nbsp;<span class="num" id="5478763">0</span><span class="op" id="5478764">,</span>&nbsp;<span class="string" id="5478766">&#34;&#34;</span><span class="op" id="5478768">,</span>&nbsp;<span class="op" id="5478770">&amp;</span><span class="ident" id="5478771"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5478776">{</span><span class="ident" id="5478777"><a href="/regexp/syntax/parse.go.html#5449265">ErrTrailingBackslash</a></span><span class="op" id="5478797">,</span>&nbsp;<span class="string" id="5478799">&#34;&#34;</span><span class="op" id="5478801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478804">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478807">c</span><span class="op" id="5478808">,</span>&nbsp;<span class="ident" id="5478810"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5478811">,</span>&nbsp;<span class="ident" id="5478813"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5478817">:=</span>&nbsp;<span class="ident" id="5478820"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5478828">(</span><span class="ident" id="5478829"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5478830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478833">if</span>&nbsp;<span class="ident" id="5478836"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5478840">!=</span>&nbsp;<span class="ident" id="5478843">nil</span>&nbsp;<span class="op" id="5478847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478851">return</span>&nbsp;<span class="num" id="5478858">0</span><span class="op" id="5478859">,</span>&nbsp;<span class="string" id="5478861">&#34;&#34;</span><span class="op" id="5478863">,</span>&nbsp;<span class="ident" id="5478865"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5478873">Switch</span><span class="op" id="5478879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478882">switch</span>&nbsp;<span class="ident" id="5478889"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span>&nbsp;<span class="op" id="5478891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478894">default</span><span class="op" id="5478901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478905">if</span>&nbsp;<span class="ident" id="5478908"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span>&nbsp;<span class="op" id="5478910">&lt;</span>&nbsp;<span class="ident" id="5478912"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5478916">.</span><span class="ident" id="5478917">RuneSelf</span>&nbsp;<span class="op" id="5478926">&amp;&amp;</span>&nbsp;<span class="op" id="5478929">!</span><span class="ident" id="5478930"><a href="/regexp/syntax/parse.go.html#5494358">isalnum</a></span><span class="op" id="5478937">(</span><span class="ident" id="5478938"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5478939">)</span>&nbsp;<span class="op" id="5478941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478946">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479003">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479063">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479122">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479181">return</span>&nbsp;<span class="ident" id="5479188"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5479189">,</span>&nbsp;<span class="ident" id="5479191"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479192">,</span>&nbsp;<span class="ident" id="5479194">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479200">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479204">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479223">case</span>&nbsp;<span class="string" id="5479228">&#39;1&#39;</span><span class="op" id="5479231">,</span>&nbsp;<span class="string" id="5479233">&#39;2&#39;</span><span class="op" id="5479236">,</span>&nbsp;<span class="string" id="5479238">&#39;3&#39;</span><span class="op" id="5479241">,</span>&nbsp;<span class="string" id="5479243">&#39;4&#39;</span><span class="op" id="5479246">,</span>&nbsp;<span class="string" id="5479248">&#39;5&#39;</span><span class="op" id="5479251">,</span>&nbsp;<span class="string" id="5479253">&#39;6&#39;</span><span class="op" id="5479256">,</span>&nbsp;<span class="string" id="5479258">&#39;7&#39;</span><span class="op" id="5479261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479265">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479326">if</span>&nbsp;<span class="ident" id="5479329"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5479331">==</span>&nbsp;<span class="string" id="5479334">&#34;&#34;</span>&nbsp;<span class="op" id="5479337">||</span>&nbsp;<span class="ident" id="5479340"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479341">[</span><span class="num" id="5479342">0</span><span class="op" id="5479343">]</span>&nbsp;<span class="op" id="5479345">&lt;</span>&nbsp;<span class="string" id="5479347">&#39;0&#39;</span>&nbsp;<span class="op" id="5479351">||</span>&nbsp;<span class="ident" id="5479354"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479355">[</span><span class="num" id="5479356">0</span><span class="op" id="5479357">]</span>&nbsp;<span class="op" id="5479359">&gt;</span>&nbsp;<span class="string" id="5479361">&#39;7&#39;</span>&nbsp;<span class="op" id="5479365">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479370">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479382">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479395">case</span>&nbsp;<span class="string" id="5479400">&#39;0&#39;</span><span class="op" id="5479403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479407">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479464"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span>&nbsp;<span class="op" id="5479466">=</span>&nbsp;<span class="ident" id="5479468"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span>&nbsp;<span class="op" id="5479470">-</span>&nbsp;<span class="string" id="5479472">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479478">for</span>&nbsp;<span class="ident" id="5479482">i</span>&nbsp;<span class="op" id="5479484">:=</span>&nbsp;<span class="num" id="5479487">1</span><span class="op" id="5479488">;</span>&nbsp;<span class="ident" id="5479490"><a href="/regexp/syntax/parse.go.html#5479482">i</a></span>&nbsp;<span class="op" id="5479492">&lt;</span>&nbsp;<span class="num" id="5479494">3</span><span class="op" id="5479495">;</span>&nbsp;<span class="ident" id="5479497"><a href="/regexp/syntax/parse.go.html#5479482">i</a></span><span class="op" id="5479498">++</span>&nbsp;<span class="op" id="5479501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479506">if</span>&nbsp;<span class="ident" id="5479509"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5479511">==</span>&nbsp;<span class="string" id="5479514">&#34;&#34;</span>&nbsp;<span class="op" id="5479517">||</span>&nbsp;<span class="ident" id="5479520"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479521">[</span><span class="num" id="5479522">0</span><span class="op" id="5479523">]</span>&nbsp;<span class="op" id="5479525">&lt;</span>&nbsp;<span class="string" id="5479527">&#39;0&#39;</span>&nbsp;<span class="op" id="5479531">||</span>&nbsp;<span class="ident" id="5479534"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479535">[</span><span class="num" id="5479536">0</span><span class="op" id="5479537">]</span>&nbsp;<span class="op" id="5479539">&gt;</span>&nbsp;<span class="string" id="5479541">&#39;7&#39;</span>&nbsp;<span class="op" id="5479545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479551">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479560">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479565"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span>&nbsp;<span class="op" id="5479567">=</span>&nbsp;<span class="ident" id="5479569"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span><span class="op" id="5479570">*</span><span class="num" id="5479571">8</span>&nbsp;<span class="op" id="5479573">+</span>&nbsp;<span class="builtintype" id="5479575">rune</span><span class="op" id="5479579">(</span><span class="ident" id="5479580"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479581">[</span><span class="num" id="5479582">0</span><span class="op" id="5479583">]</span><span class="op" id="5479584">)</span>&nbsp;<span class="op" id="5479586">-</span>&nbsp;<span class="string" id="5479588">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479595"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5479597">=</span>&nbsp;<span class="ident" id="5479599"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479600">[</span><span class="num" id="5479601">1</span><span class="op" id="5479602">:</span><span class="op" id="5479603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479611">return</span>&nbsp;<span class="ident" id="5479618"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span><span class="op" id="5479619">,</span>&nbsp;<span class="ident" id="5479621"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479622">,</span>&nbsp;<span class="ident" id="5479624">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479630">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479655">case</span>&nbsp;<span class="string" id="5479660">&#39;x&#39;</span><span class="op" id="5479663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479667">if</span>&nbsp;<span class="ident" id="5479670"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5479672">==</span>&nbsp;<span class="string" id="5479675">&#34;&#34;</span>&nbsp;<span class="op" id="5479678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479683">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479691">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479695">if</span>&nbsp;<span class="ident" id="5479698"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5479699">,</span>&nbsp;<span class="ident" id="5479701"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479702">,</span>&nbsp;<span class="ident" id="5479704"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5479708">=</span>&nbsp;<span class="ident" id="5479710"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5479718">(</span><span class="ident" id="5479719"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5479720">)</span><span class="op" id="5479721">;</span>&nbsp;<span class="ident" id="5479723"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5479727">!=</span>&nbsp;<span class="ident" id="5479730">nil</span>&nbsp;<span class="op" id="5479734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479739">return</span>&nbsp;<span class="num" id="5479746">0</span><span class="op" id="5479747">,</span>&nbsp;<span class="string" id="5479749">&#34;&#34;</span><span class="op" id="5479751">,</span>&nbsp;<span class="ident" id="5479753"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479763">if</span>&nbsp;<span class="ident" id="5479766"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span>&nbsp;<span class="op" id="5479768">==</span>&nbsp;<span class="string" id="5479771">&#39;{&#39;</span>&nbsp;<span class="op" id="5479775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479780">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479818">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479874">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479940">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479964">nhex</span>&nbsp;<span class="op" id="5479969">:=</span>&nbsp;<span class="num" id="5479972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479977"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span>&nbsp;<span class="op" id="5479979">=</span>&nbsp;<span class="num" id="5479981">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479986">for</span>&nbsp;<span class="op" id="5479990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479996">if</span>&nbsp;<span class="ident" id="5479999"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span>&nbsp;<span class="op" id="5480001">==</span>&nbsp;<span class="string" id="5480004">&#34;&#34;</span>&nbsp;<span class="op" id="5480007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480014">break</span>&nbsp;<span class="ident" id="5480020">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480037">if</span>&nbsp;<span class="ident" id="5480040"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5480041">,</span>&nbsp;<span class="ident" id="5480043"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480044">,</span>&nbsp;<span class="ident" id="5480046"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5480050">=</span>&nbsp;<span class="ident" id="5480052"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5480060">(</span><span class="ident" id="5480061"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480062">)</span><span class="op" id="5480063">;</span>&nbsp;<span class="ident" id="5480065"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5480069">!=</span>&nbsp;<span class="ident" id="5480072">nil</span>&nbsp;<span class="op" id="5480076">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480083">return</span>&nbsp;<span class="num" id="5480090">0</span><span class="op" id="5480091">,</span>&nbsp;<span class="string" id="5480093">&#34;&#34;</span><span class="op" id="5480095">,</span>&nbsp;<span class="ident" id="5480097"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480111">if</span>&nbsp;<span class="ident" id="5480114"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span>&nbsp;<span class="op" id="5480116">==</span>&nbsp;<span class="string" id="5480119">&#39;}&#39;</span>&nbsp;<span class="op" id="5480123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480130">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480140">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480146">v</span>&nbsp;<span class="op" id="5480148">:=</span>&nbsp;<span class="ident" id="5480151"><a href="/regexp/syntax/parse.go.html#5494466">unhex</a></span><span class="op" id="5480156">(</span><span class="ident" id="5480157"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5480158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480164">if</span>&nbsp;<span class="ident" id="5480167"><a href="/regexp/syntax/parse.go.html#5480146">v</a></span>&nbsp;<span class="op" id="5480169">&lt;</span>&nbsp;<span class="num" id="5480171">0</span>&nbsp;<span class="op" id="5480173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480180">break</span>&nbsp;<span class="ident" id="5480186">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480203"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span>&nbsp;<span class="op" id="5480205">=</span>&nbsp;<span class="ident" id="5480207"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span><span class="op" id="5480208">*</span><span class="num" id="5480209">16</span>&nbsp;<span class="op" id="5480212">+</span>&nbsp;<span class="ident" id="5480214"><a href="/regexp/syntax/parse.go.html#5480146">v</a></span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480220">if</span>&nbsp;<span class="ident" id="5480223"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span>&nbsp;<span class="op" id="5480225">&gt;</span>&nbsp;<span class="ident" id="5480227"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5480234">.</span><span class="ident" id="5480235">MaxRune</span>&nbsp;<span class="op" id="5480243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480250">break</span>&nbsp;<span class="ident" id="5480256">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480273"><a href="/regexp/syntax/parse.go.html#5479964">nhex</a></span><span class="op" id="5480277">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480283">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480288">if</span>&nbsp;<span class="ident" id="5480291"><a href="/regexp/syntax/parse.go.html#5479964">nhex</a></span>&nbsp;<span class="op" id="5480296">==</span>&nbsp;<span class="num" id="5480299">0</span>&nbsp;<span class="op" id="5480301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480307">break</span>&nbsp;<span class="ident" id="5480313">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480328">return</span>&nbsp;<span class="ident" id="5480335"><a href="/regexp/syntax/parse.go.html#5478694">r</a></span><span class="op" id="5480336">,</span>&nbsp;<span class="ident" id="5480338"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480339">,</span>&nbsp;<span class="ident" id="5480341">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480347">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480352">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480384">x</span>&nbsp;<span class="op" id="5480386">:=</span>&nbsp;<span class="ident" id="5480389"><a href="/regexp/syntax/parse.go.html#5494466">unhex</a></span><span class="op" id="5480394">(</span><span class="ident" id="5480395"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5480396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480400">if</span>&nbsp;<span class="ident" id="5480403"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5480404">,</span>&nbsp;<span class="ident" id="5480406"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480407">,</span>&nbsp;<span class="ident" id="5480409"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5480413">=</span>&nbsp;<span class="ident" id="5480415"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5480423">(</span><span class="ident" id="5480424"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480425">)</span><span class="op" id="5480426">;</span>&nbsp;<span class="ident" id="5480428"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span>&nbsp;<span class="op" id="5480432">!=</span>&nbsp;<span class="ident" id="5480435">nil</span>&nbsp;<span class="op" id="5480439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480444">return</span>&nbsp;<span class="num" id="5480451">0</span><span class="op" id="5480452">,</span>&nbsp;<span class="string" id="5480454">&#34;&#34;</span><span class="op" id="5480456">,</span>&nbsp;<span class="ident" id="5480458"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480468">y</span>&nbsp;<span class="op" id="5480470">:=</span>&nbsp;<span class="ident" id="5480473"><a href="/regexp/syntax/parse.go.html#5494466">unhex</a></span><span class="op" id="5480478">(</span><span class="ident" id="5480479"><a href="/regexp/syntax/parse.go.html#5478807">c</a></span><span class="op" id="5480480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480484">if</span>&nbsp;<span class="ident" id="5480487"><a href="/regexp/syntax/parse.go.html#5480384">x</a></span>&nbsp;<span class="op" id="5480489">&lt;</span>&nbsp;<span class="num" id="5480491">0</span>&nbsp;<span class="op" id="5480493">||</span>&nbsp;<span class="ident" id="5480496"><a href="/regexp/syntax/parse.go.html#5480468">y</a></span>&nbsp;<span class="op" id="5480498">&lt;</span>&nbsp;<span class="num" id="5480500">0</span>&nbsp;<span class="op" id="5480502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480507">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480515">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480519">return</span>&nbsp;<span class="ident" id="5480526"><a href="/regexp/syntax/parse.go.html#5480384">x</a></span><span class="op" id="5480527">*</span><span class="num" id="5480528">16</span>&nbsp;<span class="op" id="5480531">+</span>&nbsp;<span class="ident" id="5480533"><a href="/regexp/syntax/parse.go.html#5480468">y</a></span><span class="op" id="5480534">,</span>&nbsp;<span class="ident" id="5480536"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480537">,</span>&nbsp;<span class="ident" id="5480539">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480545">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480603">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480655">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480714">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480770">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480825">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480852">case</span>&nbsp;<span class="string" id="5480857">&#39;a&#39;</span><span class="op" id="5480860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480864">return</span>&nbsp;<span class="string" id="5480871">&#39;\a&#39;</span><span class="op" id="5480875">,</span>&nbsp;<span class="ident" id="5480877"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480878">,</span>&nbsp;<span class="ident" id="5480880"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480885">case</span>&nbsp;<span class="string" id="5480890">&#39;f&#39;</span><span class="op" id="5480893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480897">return</span>&nbsp;<span class="string" id="5480904">&#39;\f&#39;</span><span class="op" id="5480908">,</span>&nbsp;<span class="ident" id="5480910"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480911">,</span>&nbsp;<span class="ident" id="5480913"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480918">case</span>&nbsp;<span class="string" id="5480923">&#39;n&#39;</span><span class="op" id="5480926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480930">return</span>&nbsp;<span class="string" id="5480937">&#39;\n&#39;</span><span class="op" id="5480941">,</span>&nbsp;<span class="ident" id="5480943"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480944">,</span>&nbsp;<span class="ident" id="5480946"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480951">case</span>&nbsp;<span class="string" id="5480956">&#39;r&#39;</span><span class="op" id="5480959">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480963">return</span>&nbsp;<span class="string" id="5480970">&#39;\r&#39;</span><span class="op" id="5480974">,</span>&nbsp;<span class="ident" id="5480976"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5480977">,</span>&nbsp;<span class="ident" id="5480979"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480984">case</span>&nbsp;<span class="string" id="5480989">&#39;t&#39;</span><span class="op" id="5480992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480996">return</span>&nbsp;<span class="string" id="5481003">&#39;\t&#39;</span><span class="op" id="5481007">,</span>&nbsp;<span class="ident" id="5481009"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5481010">,</span>&nbsp;<span class="ident" id="5481012"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481017">case</span>&nbsp;<span class="string" id="5481022">&#39;v&#39;</span><span class="op" id="5481025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481029">return</span>&nbsp;<span class="string" id="5481036">&#39;\v&#39;</span><span class="op" id="5481040">,</span>&nbsp;<span class="ident" id="5481042"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5481043">,</span>&nbsp;<span class="ident" id="5481045"><a href="/regexp/syntax/parse.go.html#5478715">err</a></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481053">return</span>&nbsp;<span class="num" id="5481060">0</span><span class="op" id="5481061">,</span>&nbsp;<span class="string" id="5481063">&#34;&#34;</span><span class="op" id="5481065">,</span>&nbsp;<span class="op" id="5481067">&amp;</span><span class="ident" id="5481068"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5481073">{</span><span class="ident" id="5481074"><a href="/regexp/syntax/parse.go.html#5448678">ErrInvalidEscape</a></span><span class="op" id="5481090">,</span>&nbsp;<span class="ident" id="5481092"><a href="/regexp/syntax/parse.go.html#5478683">s</a></span><span class="op" id="5481093">[</span><span class="op" id="5481094">:</span><span class="builtinfunc" id="5481095">len</span><span class="op" id="5481098">(</span><span class="ident" id="5481099"><a href="/regexp/syntax/parse.go.html#5478683">s</a></span><span class="op" id="5481100">)</span><span class="op" id="5481101">-</span><span class="builtinfunc" id="5481102">len</span><span class="op" id="5481105">(</span><span class="ident" id="5481106"><a href="/regexp/syntax/parse.go.html#5478729">t</a></span><span class="op" id="5481107">)</span><span class="op" id="5481108">]</span><span class="op" id="5481109">}</span><br>
<span class="lineno"></span><span class="op" id="5481111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5481114">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5481189">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5481208">func</span>&nbsp;<span class="op" id="5481213">(</span><span class="ident" id="5481214">p</span>&nbsp;<span class="op" id="5481216">*</span><span class="ident" id="5481217"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5481223">)</span>&nbsp;<span class="ident" id="5481225">parseClassChar</span><span class="op" id="5481239">(</span><span class="ident" id="5481240">s</span><span class="op" id="5481241">,</span>&nbsp;<span class="ident" id="5481243">wholeClass</span>&nbsp;<span class="builtintype" id="5481254">string</span><span class="op" id="5481260">)</span>&nbsp;<span class="op" id="5481262">(</span><span class="ident" id="5481263">r</span>&nbsp;<span class="builtintype" id="5481265">rune</span><span class="op" id="5481269">,</span>&nbsp;<span class="ident" id="5481271">rest</span>&nbsp;<span class="builtintype" id="5481276">string</span><span class="op" id="5481282">,</span>&nbsp;<span class="ident" id="5481284">err</span>&nbsp;<span class="builtintype" id="5481288">error</span><span class="op" id="5481293">)</span>&nbsp;<span class="op" id="5481295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481298">if</span>&nbsp;<span class="ident" id="5481301"><a href="/regexp/syntax/parse.go.html#5481240">s</a></span>&nbsp;<span class="op" id="5481303">==</span>&nbsp;<span class="string" id="5481306">&#34;&#34;</span>&nbsp;<span class="op" id="5481309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481313">return</span>&nbsp;<span class="num" id="5481320">0</span><span class="op" id="5481321">,</span>&nbsp;<span class="string" id="5481323">&#34;&#34;</span><span class="op" id="5481325">,</span>&nbsp;<span class="op" id="5481327">&amp;</span><span class="ident" id="5481328"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5481333">{</span><span class="ident" id="5481334">Code</span><span class="op" id="5481338">:</span>&nbsp;<span class="ident" id="5481340"><a href="/regexp/syntax/parse.go.html#5449069">ErrMissingBracket</a></span><span class="op" id="5481357">,</span>&nbsp;<span class="ident" id="5481359">Expr</span><span class="op" id="5481363">:</span>&nbsp;<span class="ident" id="5481365"><a href="/regexp/syntax/parse.go.html#5481243">wholeClass</a></span><span class="op" id="5481375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481378">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481382">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481429">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481475">if</span>&nbsp;<span class="ident" id="5481478"><a href="/regexp/syntax/parse.go.html#5481240">s</a></span><span class="op" id="5481479">[</span><span class="num" id="5481480">0</span><span class="op" id="5481481">]</span>&nbsp;<span class="op" id="5481483">==</span>&nbsp;<span class="string" id="5481486">&#39;\\&#39;</span>&nbsp;<span class="op" id="5481491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481495">return</span>&nbsp;<span class="ident" id="5481502"><a href="/regexp/syntax/parse.go.html#5481214">p</a></span><span class="op" id="5481503">.</span><span class="ident" id="5481504">parseEscape</span><span class="op" id="5481515">(</span><span class="ident" id="5481516"><a href="/regexp/syntax/parse.go.html#5481240">s</a></span><span class="op" id="5481517">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481524">return</span>&nbsp;<span class="ident" id="5481531"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5481539">(</span><span class="ident" id="5481540"><a href="/regexp/syntax/parse.go.html#5481240">s</a></span><span class="op" id="5481541">)</span><br>
<span class="lineno"></span><span class="op" id="5481543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5481546">type</span>&nbsp;<span class="ident" id="5481551">charGroup</span>&nbsp;<span class="keyword" id="5481561">struct</span>&nbsp;<span class="op" id="5481568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481571">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5481577">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481582">class</span>&nbsp;<span class="op" id="5481588">[</span><span class="op" id="5481589">]</span><span class="builtintype" id="5481590">rune</span><br>
<span class="lineno"></span><span class="op" id="5481595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5481598">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5481675">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5481754">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5481818">func</span>&nbsp;<span class="op" id="5481823">(</span><span class="ident" id="5481824">p</span>&nbsp;<span class="op" id="5481826">*</span><span class="ident" id="5481827"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5481833">)</span>&nbsp;<span class="ident" id="5481835">parsePerlClassEscape</span><span class="op" id="5481855">(</span><span class="ident" id="5481856">s</span>&nbsp;<span class="builtintype" id="5481858">string</span><span class="op" id="5481864">,</span>&nbsp;<span class="ident" id="5481866">r</span>&nbsp;<span class="op" id="5481868">[</span><span class="op" id="5481869">]</span><span class="builtintype" id="5481870">rune</span><span class="op" id="5481874">)</span>&nbsp;<span class="op" id="5481876">(</span><span class="ident" id="5481877">out</span>&nbsp;<span class="op" id="5481881">[</span><span class="op" id="5481882">]</span><span class="builtintype" id="5481883">rune</span><span class="op" id="5481887">,</span>&nbsp;<span class="ident" id="5481889">rest</span>&nbsp;<span class="builtintype" id="5481894">string</span><span class="op" id="5481900">)</span>&nbsp;<span class="op" id="5481902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481905">if</span>&nbsp;<span class="ident" id="5481908"><a href="/regexp/syntax/parse.go.html#5481824">p</a></span><span class="op" id="5481909">.</span><span class="ident" id="5481910">flags</span><span class="op" id="5481915">&amp;</span><span class="ident" id="5481916"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5481922">==</span>&nbsp;<span class="num" id="5481925">0</span>&nbsp;<span class="op" id="5481927">||</span>&nbsp;<span class="builtinfunc" id="5481930">len</span><span class="op" id="5481933">(</span><span class="ident" id="5481934"><a href="/regexp/syntax/parse.go.html#5481856">s</a></span><span class="op" id="5481935">)</span>&nbsp;<span class="op" id="5481937">&lt;</span>&nbsp;<span class="num" id="5481939">2</span>&nbsp;<span class="op" id="5481941">||</span>&nbsp;<span class="ident" id="5481944"><a href="/regexp/syntax/parse.go.html#5481856">s</a></span><span class="op" id="5481945">[</span><span class="num" id="5481946">0</span><span class="op" id="5481947">]</span>&nbsp;<span class="op" id="5481949">!=</span>&nbsp;<span class="string" id="5481952">&#39;\\&#39;</span>&nbsp;<span class="op" id="5481957">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481961">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481972">g</span>&nbsp;<span class="op" id="5481974">:=</span>&nbsp;<span class="ident" id="5481977"><a href="/regexp/syntax/perl_groups.go.html#5495118">perlGroup</a></span><span class="op" id="5481986">[</span><span class="ident" id="5481987"><a href="/regexp/syntax/parse.go.html#5481856">s</a></span><span class="op" id="5481988">[</span><span class="num" id="5481989">0</span><span class="op" id="5481990">:</span><span class="num" id="5481991">2</span><span class="op" id="5481992">]</span><span class="op" id="5481993">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481996">if</span>&nbsp;<span class="ident" id="5481999"><a href="/regexp/syntax/parse.go.html#5481972">g</a></span><span class="op" id="5482000">.</span><span class="ident" id="5482001">sign</span>&nbsp;<span class="op" id="5482006">==</span>&nbsp;<span class="num" id="5482009">0</span>&nbsp;<span class="op" id="5482011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482015">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482026">return</span>&nbsp;<span class="ident" id="5482033"><a href="/regexp/syntax/parse.go.html#5481824">p</a></span><span class="op" id="5482034">.</span><span class="ident" id="5482035">appendGroup</span><span class="op" id="5482046">(</span><span class="ident" id="5482047"><a href="/regexp/syntax/parse.go.html#5481866">r</a></span><span class="op" id="5482048">,</span>&nbsp;<span class="ident" id="5482050"><a href="/regexp/syntax/parse.go.html#5481972">g</a></span><span class="op" id="5482051">)</span><span class="op" id="5482052">,</span>&nbsp;<span class="ident" id="5482054"><a href="/regexp/syntax/parse.go.html#5481856">s</a></span><span class="op" id="5482055">[</span><span class="num" id="5482056">2</span><span class="op" id="5482057">:</span><span class="op" id="5482058">]</span><br>
<span class="lineno"></span><span class="op" id="5482060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482063">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5482142">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5482221">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5482285">func</span>&nbsp;<span class="op" id="5482290">(</span><span class="ident" id="5482291">p</span>&nbsp;<span class="op" id="5482293">*</span><span class="ident" id="5482294"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5482300">)</span>&nbsp;<span class="ident" id="5482302">parseNamedClass</span><span class="op" id="5482317">(</span><span class="ident" id="5482318">s</span>&nbsp;<span class="builtintype" id="5482320">string</span><span class="op" id="5482326">,</span>&nbsp;<span class="ident" id="5482328">r</span>&nbsp;<span class="op" id="5482330">[</span><span class="op" id="5482331">]</span><span class="builtintype" id="5482332">rune</span><span class="op" id="5482336">)</span>&nbsp;<span class="op" id="5482338">(</span><span class="ident" id="5482339">out</span>&nbsp;<span class="op" id="5482343">[</span><span class="op" id="5482344">]</span><span class="builtintype" id="5482345">rune</span><span class="op" id="5482349">,</span>&nbsp;<span class="ident" id="5482351">rest</span>&nbsp;<span class="builtintype" id="5482356">string</span><span class="op" id="5482362">,</span>&nbsp;<span class="ident" id="5482364">err</span>&nbsp;<span class="builtintype" id="5482368">error</span><span class="op" id="5482373">)</span>&nbsp;<span class="op" id="5482375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482378">if</span>&nbsp;<span class="builtinfunc" id="5482381">len</span><span class="op" id="5482384">(</span><span class="ident" id="5482385"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482386">)</span>&nbsp;<span class="op" id="5482388">&lt;</span>&nbsp;<span class="num" id="5482390">2</span>&nbsp;<span class="op" id="5482392">||</span>&nbsp;<span class="ident" id="5482395"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482396">[</span><span class="num" id="5482397">0</span><span class="op" id="5482398">]</span>&nbsp;<span class="op" id="5482400">!=</span>&nbsp;<span class="string" id="5482403">&#39;[&#39;</span>&nbsp;<span class="op" id="5482407">||</span>&nbsp;<span class="ident" id="5482410"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482411">[</span><span class="num" id="5482412">1</span><span class="op" id="5482413">]</span>&nbsp;<span class="op" id="5482415">!=</span>&nbsp;<span class="string" id="5482418">&#39;:&#39;</span>&nbsp;<span class="op" id="5482422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482426">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482438">i</span>&nbsp;<span class="op" id="5482440">:=</span>&nbsp;<span class="ident" id="5482443"><a href="/regexp/syntax/parse.go.html#5448041">strings</a></span><span class="op" id="5482450">.</span><span class="ident" id="5482451">Index</span><span class="op" id="5482456">(</span><span class="ident" id="5482457"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482458">[</span><span class="num" id="5482459">2</span><span class="op" id="5482460">:</span><span class="op" id="5482461">]</span><span class="op" id="5482462">,</span>&nbsp;<span class="string" id="5482464">&#34;:]&#34;</span><span class="op" id="5482468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482471">if</span>&nbsp;<span class="ident" id="5482474"><a href="/regexp/syntax/parse.go.html#5482438">i</a></span>&nbsp;<span class="op" id="5482476">&lt;</span>&nbsp;<span class="num" id="5482478">0</span>&nbsp;<span class="op" id="5482480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482484">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482495"><a href="/regexp/syntax/parse.go.html#5482438">i</a></span>&nbsp;<span class="op" id="5482497">+=</span>&nbsp;<span class="num" id="5482500">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482503">name</span><span class="op" id="5482507">,</span>&nbsp;<span class="ident" id="5482509"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span>&nbsp;<span class="op" id="5482511">:=</span>&nbsp;<span class="ident" id="5482514"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482515">[</span><span class="num" id="5482516">0</span><span class="op" id="5482517">:</span><span class="ident" id="5482518"><a href="/regexp/syntax/parse.go.html#5482438">i</a></span><span class="op" id="5482519">+</span><span class="num" id="5482520">2</span><span class="op" id="5482521">]</span><span class="op" id="5482522">,</span>&nbsp;<span class="ident" id="5482524"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482525">[</span><span class="ident" id="5482526"><a href="/regexp/syntax/parse.go.html#5482438">i</a></span><span class="op" id="5482527">+</span><span class="num" id="5482528">2</span><span class="op" id="5482529">:</span><span class="op" id="5482530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482533">g</span>&nbsp;<span class="op" id="5482535">:=</span>&nbsp;<span class="ident" id="5482538"><a href="/regexp/syntax/perl_groups.go.html#5496190">posixGroup</a></span><span class="op" id="5482548">[</span><span class="ident" id="5482549"><a href="/regexp/syntax/parse.go.html#5482503">name</a></span><span class="op" id="5482553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482556">if</span>&nbsp;<span class="ident" id="5482559"><a href="/regexp/syntax/parse.go.html#5482533">g</a></span><span class="op" id="5482560">.</span><span class="ident" id="5482561">sign</span>&nbsp;<span class="op" id="5482566">==</span>&nbsp;<span class="num" id="5482569">0</span>&nbsp;<span class="op" id="5482571">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482575">return</span>&nbsp;<span class="ident" id="5482582">nil</span><span class="op" id="5482585">,</span>&nbsp;<span class="string" id="5482587">&#34;&#34;</span><span class="op" id="5482589">,</span>&nbsp;<span class="op" id="5482591">&amp;</span><span class="ident" id="5482592"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5482597">{</span><span class="ident" id="5482598"><a href="/regexp/syntax/parse.go.html#5448608">ErrInvalidCharRange</a></span><span class="op" id="5482617">,</span>&nbsp;<span class="ident" id="5482619"><a href="/regexp/syntax/parse.go.html#5482503">name</a></span><span class="op" id="5482623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482629">return</span>&nbsp;<span class="ident" id="5482636"><a href="/regexp/syntax/parse.go.html#5482291">p</a></span><span class="op" id="5482637">.</span><span class="ident" id="5482638">appendGroup</span><span class="op" id="5482649">(</span><span class="ident" id="5482650"><a href="/regexp/syntax/parse.go.html#5482328">r</a></span><span class="op" id="5482651">,</span>&nbsp;<span class="ident" id="5482653"><a href="/regexp/syntax/parse.go.html#5482533">g</a></span><span class="op" id="5482654">)</span><span class="op" id="5482655">,</span>&nbsp;<span class="ident" id="5482657"><a href="/regexp/syntax/parse.go.html#5482318">s</a></span><span class="op" id="5482658">,</span>&nbsp;<span class="ident" id="5482660">nil</span><br>
<span class="lineno"></span><span class="op" id="5482664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5482667">func</span>&nbsp;<span class="op" id="5482672">(</span><span class="ident" id="5482673">p</span>&nbsp;<span class="op" id="5482675">*</span><span class="ident" id="5482676"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5482682">)</span>&nbsp;<span class="ident" id="5482684">appendGroup</span><span class="op" id="5482695">(</span><span class="ident" id="5482696">r</span>&nbsp;<span class="op" id="5482698">[</span><span class="op" id="5482699">]</span><span class="builtintype" id="5482700">rune</span><span class="op" id="5482704">,</span>&nbsp;<span class="ident" id="5482706">g</span>&nbsp;<span class="ident" id="5482708"><a href="/regexp/syntax/parse.go.html#5481551">charGroup</a></span><span class="op" id="5482717">)</span>&nbsp;<span class="op" id="5482719">[</span><span class="op" id="5482720">]</span><span class="builtintype" id="5482721">rune</span>&nbsp;<span class="op" id="5482726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482729">if</span>&nbsp;<span class="ident" id="5482732"><a href="/regexp/syntax/parse.go.html#5482673">p</a></span><span class="op" id="5482733">.</span><span class="ident" id="5482734">flags</span><span class="op" id="5482739">&amp;</span><span class="ident" id="5482740"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5482749">==</span>&nbsp;<span class="num" id="5482752">0</span>&nbsp;<span class="op" id="5482754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482758">if</span>&nbsp;<span class="ident" id="5482761"><a href="/regexp/syntax/parse.go.html#5482706">g</a></span><span class="op" id="5482762">.</span><span class="ident" id="5482763">sign</span>&nbsp;<span class="op" id="5482768">&lt;</span>&nbsp;<span class="num" id="5482770">0</span>&nbsp;<span class="op" id="5482772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482777"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span>&nbsp;<span class="op" id="5482779">=</span>&nbsp;<span class="ident" id="5482781"><a href="/regexp/syntax/parse.go.html#5490957">appendNegatedClass</a></span><span class="op" id="5482799">(</span><span class="ident" id="5482800"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span><span class="op" id="5482801">,</span>&nbsp;<span class="ident" id="5482803"><a href="/regexp/syntax/parse.go.html#5482706">g</a></span><span class="op" id="5482804">.</span><span class="ident" id="5482805">class</span><span class="op" id="5482810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482814">}</span>&nbsp;<span class="keyword" id="5482816">else</span>&nbsp;<span class="op" id="5482821">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482826"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span>&nbsp;<span class="op" id="5482828">=</span>&nbsp;<span class="ident" id="5482830"><a href="/regexp/syntax/parse.go.html#5490463">appendClass</a></span><span class="op" id="5482841">(</span><span class="ident" id="5482842"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span><span class="op" id="5482843">,</span>&nbsp;<span class="ident" id="5482845"><a href="/regexp/syntax/parse.go.html#5482706">g</a></span><span class="op" id="5482846">.</span><span class="ident" id="5482847">class</span><span class="op" id="5482852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5482859">}</span>&nbsp;<span class="keyword" id="5482861">else</span>&nbsp;<span class="op" id="5482866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482870">tmp</span>&nbsp;<span class="op" id="5482874">:=</span>&nbsp;<span class="ident" id="5482877"><a href="/regexp/syntax/parse.go.html#5482673">p</a></span><span class="op" id="5482878">.</span><span class="ident" id="5482879">tmpClass</span><span class="op" id="5482887">[</span><span class="op" id="5482888">:</span><span class="num" id="5482889">0</span><span class="op" id="5482890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482894"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span>&nbsp;<span class="op" id="5482898">=</span>&nbsp;<span class="ident" id="5482900"><a href="/regexp/syntax/parse.go.html#5490690">appendFoldedClass</a></span><span class="op" id="5482917">(</span><span class="ident" id="5482918"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span><span class="op" id="5482921">,</span>&nbsp;<span class="ident" id="5482923"><a href="/regexp/syntax/parse.go.html#5482706">g</a></span><span class="op" id="5482924">.</span><span class="ident" id="5482925">class</span><span class="op" id="5482930">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482934"><a href="/regexp/syntax/parse.go.html#5482673">p</a></span><span class="op" id="5482935">.</span><span class="ident" id="5482936">tmpClass</span>&nbsp;<span class="op" id="5482945">=</span>&nbsp;<span class="ident" id="5482947"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5482953"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span>&nbsp;<span class="op" id="5482957">=</span>&nbsp;<span class="ident" id="5482959"><a href="/regexp/syntax/parse.go.html#5488005">cleanClass</a></span><span class="op" id="5482969">(</span><span class="op" id="5482970">&amp;</span><span class="ident" id="5482971"><a href="/regexp/syntax/parse.go.html#5482673">p</a></span><span class="op" id="5482972">.</span><span class="ident" id="5482973">tmpClass</span><span class="op" id="5482981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5482985">if</span>&nbsp;<span class="ident" id="5482988"><a href="/regexp/syntax/parse.go.html#5482706">g</a></span><span class="op" id="5482989">.</span><span class="ident" id="5482990">sign</span>&nbsp;<span class="op" id="5482995">&lt;</span>&nbsp;<span class="num" id="5482997">0</span>&nbsp;<span class="op" id="5482999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483004"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span>&nbsp;<span class="op" id="5483006">=</span>&nbsp;<span class="ident" id="5483008"><a href="/regexp/syntax/parse.go.html#5490957">appendNegatedClass</a></span><span class="op" id="5483026">(</span><span class="ident" id="5483027"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span><span class="op" id="5483028">,</span>&nbsp;<span class="ident" id="5483030"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span><span class="op" id="5483033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483037">}</span>&nbsp;<span class="keyword" id="5483039">else</span>&nbsp;<span class="op" id="5483044">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483049"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span>&nbsp;<span class="op" id="5483051">=</span>&nbsp;<span class="ident" id="5483053"><a href="/regexp/syntax/parse.go.html#5490463">appendClass</a></span><span class="op" id="5483064">(</span><span class="ident" id="5483065"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span><span class="op" id="5483066">,</span>&nbsp;<span class="ident" id="5483068"><a href="/regexp/syntax/parse.go.html#5482870">tmp</a></span><span class="op" id="5483071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483081">return</span>&nbsp;<span class="ident" id="5483088"><a href="/regexp/syntax/parse.go.html#5482696">r</a></span><br>
<span class="lineno"></span><span class="op" id="5483090">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5483093">var</span>&nbsp;<span class="ident" id="5483097">anyTable</span>&nbsp;<span class="op" id="5483106">=</span>&nbsp;<span class="op" id="5483108">&amp;</span><span class="ident" id="5483109"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483116">.</span><span class="ident" id="5483117">RangeTable</span><span class="op" id="5483127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483130">R16</span><span class="op" id="5483133">:</span>&nbsp;<span class="op" id="5483135">[</span><span class="op" id="5483136">]</span><span class="ident" id="5483137"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483144">.</span><span class="ident" id="5483145">Range16</span><span class="op" id="5483152">{</span><span class="op" id="5483153">{</span><span class="ident" id="5483154">Lo</span><span class="op" id="5483156">:</span>&nbsp;<span class="num" id="5483158">0</span><span class="op" id="5483159">,</span>&nbsp;<span class="ident" id="5483161">Hi</span><span class="op" id="5483163">:</span>&nbsp;<span class="num" id="5483165">1</span><span class="op" id="5483166">&lt;&lt;</span><span class="num" id="5483168">16</span>&nbsp;<span class="op" id="5483171">-</span>&nbsp;<span class="num" id="5483173">1</span><span class="op" id="5483174">,</span>&nbsp;<span class="ident" id="5483176">Stride</span><span class="op" id="5483182">:</span>&nbsp;<span class="num" id="5483184">1</span><span class="op" id="5483185">}</span><span class="op" id="5483186">}</span><span class="op" id="5483187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5483190">R32</span><span class="op" id="5483193">:</span>&nbsp;<span class="op" id="5483195">[</span><span class="op" id="5483196">]</span><span class="ident" id="5483197"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483204">.</span><span class="ident" id="5483205">Range32</span><span class="op" id="5483212">{</span><span class="op" id="5483213">{</span><span class="ident" id="5483214">Lo</span><span class="op" id="5483216">:</span>&nbsp;<span class="num" id="5483218">1</span>&nbsp;<span class="op" id="5483220">&lt;&lt;</span>&nbsp;<span class="num" id="5483223">16</span><span class="op" id="5483225">,</span>&nbsp;<span class="ident" id="5483227">Hi</span><span class="op" id="5483229">:</span>&nbsp;<span class="ident" id="5483231"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483238">.</span><span class="ident" id="5483239">MaxRune</span><span class="op" id="5483246">,</span>&nbsp;<span class="ident" id="5483248">Stride</span><span class="op" id="5483254">:</span>&nbsp;<span class="num" id="5483256">1</span><span class="op" id="5483257">}</span><span class="op" id="5483258">}</span><span class="op" id="5483259">,</span><br>
<span class="lineno"></span><span class="op" id="5483261">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5483264">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5483330">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5483390">func</span>&nbsp;<span class="ident" id="5483395">unicodeTable</span><span class="op" id="5483407">(</span><span class="ident" id="5483408">name</span>&nbsp;<span class="builtintype" id="5483413">string</span><span class="op" id="5483419">)</span>&nbsp;<span class="op" id="5483421">(</span><span class="op" id="5483422">*</span><span class="ident" id="5483423"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483430">.</span><span class="ident" id="5483431">RangeTable</span><span class="op" id="5483441">,</span>&nbsp;<span class="op" id="5483443">*</span><span class="ident" id="5483444"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483451">.</span><span class="ident" id="5483452">RangeTable</span><span class="op" id="5483462">)</span>&nbsp;<span class="op" id="5483464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5483467">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483502">if</span>&nbsp;<span class="ident" id="5483505"><a href="/regexp/syntax/parse.go.html#5483408">name</a></span>&nbsp;<span class="op" id="5483510">==</span>&nbsp;<span class="string" id="5483513">&#34;Any&#34;</span>&nbsp;<span class="op" id="5483519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483523">return</span>&nbsp;<span class="ident" id="5483530"><a href="/regexp/syntax/parse.go.html#5483097">anyTable</a></span><span class="op" id="5483538">,</span>&nbsp;<span class="ident" id="5483540"><a href="/regexp/syntax/parse.go.html#5483097">anyTable</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483553">if</span>&nbsp;<span class="ident" id="5483556">t</span>&nbsp;<span class="op" id="5483558">:=</span>&nbsp;<span class="ident" id="5483561"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483568">.</span><span class="ident" id="5483569">Categories</span><span class="op" id="5483579">[</span><span class="ident" id="5483580"><a href="/regexp/syntax/parse.go.html#5483408">name</a></span><span class="op" id="5483584">]</span><span class="op" id="5483585">;</span>&nbsp;<span class="ident" id="5483587"><a href="/regexp/syntax/parse.go.html#5483556">t</a></span>&nbsp;<span class="op" id="5483589">!=</span>&nbsp;<span class="ident" id="5483592">nil</span>&nbsp;<span class="op" id="5483596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483600">return</span>&nbsp;<span class="ident" id="5483607"><a href="/regexp/syntax/parse.go.html#5483556">t</a></span><span class="op" id="5483608">,</span>&nbsp;<span class="ident" id="5483610"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483617">.</span><span class="ident" id="5483618">FoldCategory</span><span class="op" id="5483630">[</span><span class="ident" id="5483631"><a href="/regexp/syntax/parse.go.html#5483408">name</a></span><span class="op" id="5483635">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483641">if</span>&nbsp;<span class="ident" id="5483644">t</span>&nbsp;<span class="op" id="5483646">:=</span>&nbsp;<span class="ident" id="5483649"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483656">.</span><span class="ident" id="5483657">Scripts</span><span class="op" id="5483664">[</span><span class="ident" id="5483665"><a href="/regexp/syntax/parse.go.html#5483408">name</a></span><span class="op" id="5483669">]</span><span class="op" id="5483670">;</span>&nbsp;<span class="ident" id="5483672"><a href="/regexp/syntax/parse.go.html#5483644">t</a></span>&nbsp;<span class="op" id="5483674">!=</span>&nbsp;<span class="ident" id="5483677">nil</span>&nbsp;<span class="op" id="5483681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483685">return</span>&nbsp;<span class="ident" id="5483692"><a href="/regexp/syntax/parse.go.html#5483644">t</a></span><span class="op" id="5483693">,</span>&nbsp;<span class="ident" id="5483695"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5483702">.</span><span class="ident" id="5483703">FoldScript</span><span class="op" id="5483713">[</span><span class="ident" id="5483714"><a href="/regexp/syntax/parse.go.html#5483408">name</a></span><span class="op" id="5483718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483724">return</span>&nbsp;<span class="ident" id="5483731">nil</span><span class="op" id="5483734">,</span>&nbsp;<span class="ident" id="5483736">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5483740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483743">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5483818">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5483897">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5483961">func</span>&nbsp;<span class="op" id="5483966">(</span><span class="ident" id="5483967">p</span>&nbsp;<span class="op" id="5483969">*</span><span class="ident" id="5483970"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5483976">)</span>&nbsp;<span class="ident" id="5483978">parseUnicodeClass</span><span class="op" id="5483995">(</span><span class="ident" id="5483996">s</span>&nbsp;<span class="builtintype" id="5483998">string</span><span class="op" id="5484004">,</span>&nbsp;<span class="ident" id="5484006">r</span>&nbsp;<span class="op" id="5484008">[</span><span class="op" id="5484009">]</span><span class="builtintype" id="5484010">rune</span><span class="op" id="5484014">)</span>&nbsp;<span class="op" id="5484016">(</span><span class="ident" id="5484017">out</span>&nbsp;<span class="op" id="5484021">[</span><span class="op" id="5484022">]</span><span class="builtintype" id="5484023">rune</span><span class="op" id="5484027">,</span>&nbsp;<span class="ident" id="5484029">rest</span>&nbsp;<span class="builtintype" id="5484034">string</span><span class="op" id="5484040">,</span>&nbsp;<span class="ident" id="5484042">err</span>&nbsp;<span class="builtintype" id="5484046">error</span><span class="op" id="5484051">)</span>&nbsp;<span class="op" id="5484053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484056">if</span>&nbsp;<span class="ident" id="5484059"><a href="/regexp/syntax/parse.go.html#5483967">p</a></span><span class="op" id="5484060">.</span><span class="ident" id="5484061">flags</span><span class="op" id="5484066">&amp;</span><span class="ident" id="5484067"><a href="/regexp/syntax/parse.go.html#5450106">UnicodeGroups</a></span>&nbsp;<span class="op" id="5484081">==</span>&nbsp;<span class="num" id="5484084">0</span>&nbsp;<span class="op" id="5484086">||</span>&nbsp;<span class="builtinfunc" id="5484089">len</span><span class="op" id="5484092">(</span><span class="ident" id="5484093"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484094">)</span>&nbsp;<span class="op" id="5484096">&lt;</span>&nbsp;<span class="num" id="5484098">2</span>&nbsp;<span class="op" id="5484100">||</span>&nbsp;<span class="ident" id="5484103"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484104">[</span><span class="num" id="5484105">0</span><span class="op" id="5484106">]</span>&nbsp;<span class="op" id="5484108">!=</span>&nbsp;<span class="string" id="5484111">&#39;\\&#39;</span>&nbsp;<span class="op" id="5484116">||</span>&nbsp;<span class="ident" id="5484119"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484120">[</span><span class="num" id="5484121">1</span><span class="op" id="5484122">]</span>&nbsp;<span class="op" id="5484124">!=</span>&nbsp;<span class="string" id="5484127">&#39;p&#39;</span>&nbsp;<span class="op" id="5484131">&amp;&amp;</span>&nbsp;<span class="ident" id="5484134"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484135">[</span><span class="num" id="5484136">1</span><span class="op" id="5484137">]</span>&nbsp;<span class="op" id="5484139">!=</span>&nbsp;<span class="string" id="5484142">&#39;P&#39;</span>&nbsp;<span class="op" id="5484146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484150">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484162">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484202">sign</span>&nbsp;<span class="op" id="5484207">:=</span>&nbsp;<span class="op" id="5484210">+</span><span class="num" id="5484211">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484214">if</span>&nbsp;<span class="ident" id="5484217"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484218">[</span><span class="num" id="5484219">1</span><span class="op" id="5484220">]</span>&nbsp;<span class="op" id="5484222">==</span>&nbsp;<span class="string" id="5484225">&#39;P&#39;</span>&nbsp;<span class="op" id="5484229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484233"><a href="/regexp/syntax/parse.go.html#5484202">sign</a></span>&nbsp;<span class="op" id="5484238">=</span>&nbsp;<span class="op" id="5484240">-</span><span class="num" id="5484241">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484244">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484247">t</span>&nbsp;<span class="op" id="5484249">:=</span>&nbsp;<span class="ident" id="5484252"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484253">[</span><span class="num" id="5484254">2</span><span class="op" id="5484255">:</span><span class="op" id="5484256">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484259">c</span><span class="op" id="5484260">,</span>&nbsp;<span class="ident" id="5484262"><a href="/regexp/syntax/parse.go.html#5484247">t</a></span><span class="op" id="5484263">,</span>&nbsp;<span class="ident" id="5484265"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484269">:=</span>&nbsp;<span class="ident" id="5484272"><a href="/regexp/syntax/parse.go.html#5494139">nextRune</a></span><span class="op" id="5484280">(</span><span class="ident" id="5484281"><a href="/regexp/syntax/parse.go.html#5484247">t</a></span><span class="op" id="5484282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484285">if</span>&nbsp;<span class="ident" id="5484288"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484292">!=</span>&nbsp;<span class="ident" id="5484295">nil</span>&nbsp;<span class="op" id="5484299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484303">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484311">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484314">var</span>&nbsp;<span class="ident" id="5484318">seq</span><span class="op" id="5484321">,</span>&nbsp;<span class="ident" id="5484323">name</span>&nbsp;<span class="builtintype" id="5484328">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484336">if</span>&nbsp;<span class="ident" id="5484339"><a href="/regexp/syntax/parse.go.html#5484259">c</a></span>&nbsp;<span class="op" id="5484341">!=</span>&nbsp;<span class="string" id="5484344">&#39;{&#39;</span>&nbsp;<span class="op" id="5484348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484352">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484377"><a href="/regexp/syntax/parse.go.html#5484318">seq</a></span>&nbsp;<span class="op" id="5484381">=</span>&nbsp;<span class="ident" id="5484383"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484384">[</span><span class="op" id="5484385">:</span><span class="builtinfunc" id="5484386">len</span><span class="op" id="5484389">(</span><span class="ident" id="5484390"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484391">)</span><span class="op" id="5484392">-</span><span class="builtinfunc" id="5484393">len</span><span class="op" id="5484396">(</span><span class="ident" id="5484397"><a href="/regexp/syntax/parse.go.html#5484247">t</a></span><span class="op" id="5484398">)</span><span class="op" id="5484399">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484403"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span>&nbsp;<span class="op" id="5484408">=</span>&nbsp;<span class="ident" id="5484410"><a href="/regexp/syntax/parse.go.html#5484318">seq</a></span><span class="op" id="5484413">[</span><span class="num" id="5484414">2</span><span class="op" id="5484415">:</span><span class="op" id="5484416">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484419">}</span>&nbsp;<span class="keyword" id="5484421">else</span>&nbsp;<span class="op" id="5484426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484430">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484454">end</span>&nbsp;<span class="op" id="5484458">:=</span>&nbsp;<span class="ident" id="5484461"><a href="/regexp/syntax/parse.go.html#5448041">strings</a></span><span class="op" id="5484468">.</span><span class="ident" id="5484469">IndexRune</span><span class="op" id="5484478">(</span><span class="ident" id="5484479"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484480">,</span>&nbsp;<span class="string" id="5484482">&#39;}&#39;</span><span class="op" id="5484485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484489">if</span>&nbsp;<span class="ident" id="5484492"><a href="/regexp/syntax/parse.go.html#5484454">end</a></span>&nbsp;<span class="op" id="5484496">&lt;</span>&nbsp;<span class="num" id="5484498">0</span>&nbsp;<span class="op" id="5484500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484505">if</span>&nbsp;<span class="ident" id="5484508"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484512">=</span>&nbsp;<span class="ident" id="5484514"><a href="/regexp/syntax/parse.go.html#5493920">checkUTF8</a></span><span class="op" id="5484523">(</span><span class="ident" id="5484524"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484525">)</span><span class="op" id="5484526">;</span>&nbsp;<span class="ident" id="5484528"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484532">!=</span>&nbsp;<span class="ident" id="5484535">nil</span>&nbsp;<span class="op" id="5484539">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484545">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484560">return</span>&nbsp;<span class="ident" id="5484567">nil</span><span class="op" id="5484570">,</span>&nbsp;<span class="string" id="5484572">&#34;&#34;</span><span class="op" id="5484574">,</span>&nbsp;<span class="op" id="5484576">&amp;</span><span class="ident" id="5484577"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5484582">{</span><span class="ident" id="5484583"><a href="/regexp/syntax/parse.go.html#5448608">ErrInvalidCharRange</a></span><span class="op" id="5484602">,</span>&nbsp;<span class="ident" id="5484604"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484613"><a href="/regexp/syntax/parse.go.html#5484318">seq</a></span><span class="op" id="5484616">,</span>&nbsp;<span class="ident" id="5484618"><a href="/regexp/syntax/parse.go.html#5484247">t</a></span>&nbsp;<span class="op" id="5484620">=</span>&nbsp;<span class="ident" id="5484622"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484623">[</span><span class="op" id="5484624">:</span><span class="ident" id="5484625"><a href="/regexp/syntax/parse.go.html#5484454">end</a></span><span class="op" id="5484628">+</span><span class="num" id="5484629">1</span><span class="op" id="5484630">]</span><span class="op" id="5484631">,</span>&nbsp;<span class="ident" id="5484633"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484634">[</span><span class="ident" id="5484635"><a href="/regexp/syntax/parse.go.html#5484454">end</a></span><span class="op" id="5484638">+</span><span class="num" id="5484639">1</span><span class="op" id="5484640">:</span><span class="op" id="5484641">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484645"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span>&nbsp;<span class="op" id="5484650">=</span>&nbsp;<span class="ident" id="5484652"><a href="/regexp/syntax/parse.go.html#5483996">s</a></span><span class="op" id="5484653">[</span><span class="num" id="5484654">3</span><span class="op" id="5484655">:</span><span class="ident" id="5484656"><a href="/regexp/syntax/parse.go.html#5484454">end</a></span><span class="op" id="5484659">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484663">if</span>&nbsp;<span class="ident" id="5484666"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484670">=</span>&nbsp;<span class="ident" id="5484672"><a href="/regexp/syntax/parse.go.html#5493920">checkUTF8</a></span><span class="op" id="5484681">(</span><span class="ident" id="5484682"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span><span class="op" id="5484686">)</span><span class="op" id="5484687">;</span>&nbsp;<span class="ident" id="5484689"><a href="/regexp/syntax/parse.go.html#5484042">err</a></span>&nbsp;<span class="op" id="5484693">!=</span>&nbsp;<span class="ident" id="5484696">nil</span>&nbsp;<span class="op" id="5484700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484705">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484717">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5484721">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484805">if</span>&nbsp;<span class="ident" id="5484808"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span>&nbsp;<span class="op" id="5484813">!=</span>&nbsp;<span class="string" id="5484816">&#34;&#34;</span>&nbsp;<span class="op" id="5484819">&amp;&amp;</span>&nbsp;<span class="ident" id="5484822"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span><span class="op" id="5484826">[</span><span class="num" id="5484827">0</span><span class="op" id="5484828">]</span>&nbsp;<span class="op" id="5484830">==</span>&nbsp;<span class="string" id="5484833">&#39;^&#39;</span>&nbsp;<span class="op" id="5484837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484841"><a href="/regexp/syntax/parse.go.html#5484202">sign</a></span>&nbsp;<span class="op" id="5484846">=</span>&nbsp;<span class="op" id="5484848">-</span><span class="ident" id="5484849"><a href="/regexp/syntax/parse.go.html#5484202">sign</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484856"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span>&nbsp;<span class="op" id="5484861">=</span>&nbsp;<span class="ident" id="5484863"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span><span class="op" id="5484867">[</span><span class="num" id="5484868">1</span><span class="op" id="5484869">:</span><span class="op" id="5484870">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5484877">tab</span><span class="op" id="5484880">,</span>&nbsp;<span class="ident" id="5484882">fold</span>&nbsp;<span class="op" id="5484887">:=</span>&nbsp;<span class="ident" id="5484890"><a href="/regexp/syntax/parse.go.html#5483395">unicodeTable</a></span><span class="op" id="5484902">(</span><span class="ident" id="5484903"><a href="/regexp/syntax/parse.go.html#5484323">name</a></span><span class="op" id="5484907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484910">if</span>&nbsp;<span class="ident" id="5484913"><a href="/regexp/syntax/parse.go.html#5484877">tab</a></span>&nbsp;<span class="op" id="5484917">==</span>&nbsp;<span class="ident" id="5484920">nil</span>&nbsp;<span class="op" id="5484924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484928">return</span>&nbsp;<span class="ident" id="5484935">nil</span><span class="op" id="5484938">,</span>&nbsp;<span class="string" id="5484940">&#34;&#34;</span><span class="op" id="5484942">,</span>&nbsp;<span class="op" id="5484944">&amp;</span><span class="ident" id="5484945"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5484950">{</span><span class="ident" id="5484951"><a href="/regexp/syntax/parse.go.html#5448608">ErrInvalidCharRange</a></span><span class="op" id="5484970">,</span>&nbsp;<span class="ident" id="5484972"><a href="/regexp/syntax/parse.go.html#5484318">seq</a></span><span class="op" id="5484975">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5484978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5484982">if</span>&nbsp;<span class="ident" id="5484985"><a href="/regexp/syntax/parse.go.html#5483967">p</a></span><span class="op" id="5484986">.</span><span class="ident" id="5484987">flags</span><span class="op" id="5484992">&amp;</span><span class="ident" id="5484993"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5485002">==</span>&nbsp;<span class="num" id="5485005">0</span>&nbsp;<span class="op" id="5485007">||</span>&nbsp;<span class="ident" id="5485010"><a href="/regexp/syntax/parse.go.html#5484882">fold</a></span>&nbsp;<span class="op" id="5485015">==</span>&nbsp;<span class="ident" id="5485018">nil</span>&nbsp;<span class="op" id="5485022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485026">if</span>&nbsp;<span class="ident" id="5485029"><a href="/regexp/syntax/parse.go.html#5484202">sign</a></span>&nbsp;<span class="op" id="5485034">&gt;</span>&nbsp;<span class="num" id="5485036">0</span>&nbsp;<span class="op" id="5485038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485043"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span>&nbsp;<span class="op" id="5485045">=</span>&nbsp;<span class="ident" id="5485047"><a href="/regexp/syntax/parse.go.html#5491331">appendTable</a></span><span class="op" id="5485058">(</span><span class="ident" id="5485059"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span><span class="op" id="5485060">,</span>&nbsp;<span class="ident" id="5485062"><a href="/regexp/syntax/parse.go.html#5484877">tab</a></span><span class="op" id="5485065">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485069">}</span>&nbsp;<span class="keyword" id="5485071">else</span>&nbsp;<span class="op" id="5485076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485081"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span>&nbsp;<span class="op" id="5485083">=</span>&nbsp;<span class="ident" id="5485085"><a href="/regexp/syntax/parse.go.html#5491947">appendNegatedTable</a></span><span class="op" id="5485103">(</span><span class="ident" id="5485104"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span><span class="op" id="5485105">,</span>&nbsp;<span class="ident" id="5485107"><a href="/regexp/syntax/parse.go.html#5484877">tab</a></span><span class="op" id="5485110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485117">}</span>&nbsp;<span class="keyword" id="5485119">else</span>&nbsp;<span class="op" id="5485124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485128">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485185">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485244">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485272">tmp</span>&nbsp;<span class="op" id="5485276">:=</span>&nbsp;<span class="ident" id="5485279"><a href="/regexp/syntax/parse.go.html#5483967">p</a></span><span class="op" id="5485280">.</span><span class="ident" id="5485281">tmpClass</span><span class="op" id="5485289">[</span><span class="op" id="5485290">:</span><span class="num" id="5485291">0</span><span class="op" id="5485292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485296"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span>&nbsp;<span class="op" id="5485300">=</span>&nbsp;<span class="ident" id="5485302"><a href="/regexp/syntax/parse.go.html#5491331">appendTable</a></span><span class="op" id="5485313">(</span><span class="ident" id="5485314"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span><span class="op" id="5485317">,</span>&nbsp;<span class="ident" id="5485319"><a href="/regexp/syntax/parse.go.html#5484877">tab</a></span><span class="op" id="5485322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485326"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span>&nbsp;<span class="op" id="5485330">=</span>&nbsp;<span class="ident" id="5485332"><a href="/regexp/syntax/parse.go.html#5491331">appendTable</a></span><span class="op" id="5485343">(</span><span class="ident" id="5485344"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span><span class="op" id="5485347">,</span>&nbsp;<span class="ident" id="5485349"><a href="/regexp/syntax/parse.go.html#5484882">fold</a></span><span class="op" id="5485353">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485357"><a href="/regexp/syntax/parse.go.html#5483967">p</a></span><span class="op" id="5485358">.</span><span class="ident" id="5485359">tmpClass</span>&nbsp;<span class="op" id="5485368">=</span>&nbsp;<span class="ident" id="5485370"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485376"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span>&nbsp;<span class="op" id="5485380">=</span>&nbsp;<span class="ident" id="5485382"><a href="/regexp/syntax/parse.go.html#5488005">cleanClass</a></span><span class="op" id="5485392">(</span><span class="op" id="5485393">&amp;</span><span class="ident" id="5485394"><a href="/regexp/syntax/parse.go.html#5483967">p</a></span><span class="op" id="5485395">.</span><span class="ident" id="5485396">tmpClass</span><span class="op" id="5485404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485408">if</span>&nbsp;<span class="ident" id="5485411"><a href="/regexp/syntax/parse.go.html#5484202">sign</a></span>&nbsp;<span class="op" id="5485416">&gt;</span>&nbsp;<span class="num" id="5485418">0</span>&nbsp;<span class="op" id="5485420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485425"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span>&nbsp;<span class="op" id="5485427">=</span>&nbsp;<span class="ident" id="5485429"><a href="/regexp/syntax/parse.go.html#5490463">appendClass</a></span><span class="op" id="5485440">(</span><span class="ident" id="5485441"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span><span class="op" id="5485442">,</span>&nbsp;<span class="ident" id="5485444"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span><span class="op" id="5485447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485451">}</span>&nbsp;<span class="keyword" id="5485453">else</span>&nbsp;<span class="op" id="5485458">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485463"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span>&nbsp;<span class="op" id="5485465">=</span>&nbsp;<span class="ident" id="5485467"><a href="/regexp/syntax/parse.go.html#5490957">appendNegatedClass</a></span><span class="op" id="5485485">(</span><span class="ident" id="5485486"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span><span class="op" id="5485487">,</span>&nbsp;<span class="ident" id="5485489"><a href="/regexp/syntax/parse.go.html#5485272">tmp</a></span><span class="op" id="5485492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5485499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485502">return</span>&nbsp;<span class="ident" id="5485509"><a href="/regexp/syntax/parse.go.html#5484006">r</a></span><span class="op" id="5485510">,</span>&nbsp;<span class="ident" id="5485512"><a href="/regexp/syntax/parse.go.html#5484247">t</a></span><span class="op" id="5485513">,</span>&nbsp;<span class="ident" id="5485515">nil</span><br>
<span class="lineno"></span><span class="op" id="5485519">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5485522">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5485583">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5485622">func</span>&nbsp;<span class="op" id="5485627">(</span><span class="ident" id="5485628">p</span>&nbsp;<span class="op" id="5485630">*</span><span class="ident" id="5485631"><a href="/regexp/syntax/parse.go.html#5450625">parser</a></span><span class="op" id="5485637">)</span>&nbsp;<span class="ident" id="5485639">parseClass</span><span class="op" id="5485649">(</span><span class="ident" id="5485650">s</span>&nbsp;<span class="builtintype" id="5485652">string</span><span class="op" id="5485658">)</span>&nbsp;<span class="op" id="5485660">(</span><span class="ident" id="5485661">rest</span>&nbsp;<span class="builtintype" id="5485666">string</span><span class="op" id="5485672">,</span>&nbsp;<span class="ident" id="5485674">err</span>&nbsp;<span class="builtintype" id="5485678">error</span><span class="op" id="5485683">)</span>&nbsp;<span class="op" id="5485685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485688">t</span>&nbsp;<span class="op" id="5485690">:=</span>&nbsp;<span class="ident" id="5485693"><a href="/regexp/syntax/parse.go.html#5485650">s</a></span><span class="op" id="5485694">[</span><span class="num" id="5485695">1</span><span class="op" id="5485696">:</span><span class="op" id="5485697">]</span>&nbsp;<span class="comment" id="5485699">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485710">re</span>&nbsp;<span class="op" id="5485713">:=</span>&nbsp;<span class="ident" id="5485716"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5485717">.</span><span class="ident" id="5485718">newRegexp</span><span class="op" id="5485727">(</span><span class="ident" id="5485728"><a href="/regexp/syntax/regexp.go.html#5506133">OpCharClass</a></span><span class="op" id="5485739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485742"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5485744">.</span><span class="ident" id="5485745">Flags</span>&nbsp;<span class="op" id="5485751">=</span>&nbsp;<span class="ident" id="5485753"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5485754">.</span><span class="ident" id="5485755">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485762"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5485764">.</span><span class="ident" id="5485765">Rune</span>&nbsp;<span class="op" id="5485770">=</span>&nbsp;<span class="ident" id="5485772"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5485774">.</span><span class="ident" id="5485775">Rune0</span><span class="op" id="5485780">[</span><span class="op" id="5485781">:</span><span class="num" id="5485782">0</span><span class="op" id="5485783">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485787">sign</span>&nbsp;<span class="op" id="5485792">:=</span>&nbsp;<span class="op" id="5485795">+</span><span class="num" id="5485796">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485799">if</span>&nbsp;<span class="ident" id="5485802"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5485804">!=</span>&nbsp;<span class="string" id="5485807">&#34;&#34;</span>&nbsp;<span class="op" id="5485810">&amp;&amp;</span>&nbsp;<span class="ident" id="5485813"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5485814">[</span><span class="num" id="5485815">0</span><span class="op" id="5485816">]</span>&nbsp;<span class="op" id="5485818">==</span>&nbsp;<span class="string" id="5485821">&#39;^&#39;</span>&nbsp;<span class="op" id="5485825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485829"><a href="/regexp/syntax/parse.go.html#5485787">sign</a></span>&nbsp;<span class="op" id="5485834">=</span>&nbsp;<span class="op" id="5485836">-</span><span class="num" id="5485837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485841"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5485843">=</span>&nbsp;<span class="ident" id="5485845"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5485846">[</span><span class="num" id="5485847">1</span><span class="op" id="5485848">:</span><span class="op" id="5485849">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485854">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5485910">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5485963">if</span>&nbsp;<span class="ident" id="5485966"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5485967">.</span><span class="ident" id="5485968">flags</span><span class="op" id="5485973">&amp;</span><span class="ident" id="5485974"><a href="/regexp/syntax/parse.go.html#5449702">ClassNL</a></span>&nbsp;<span class="op" id="5485982">==</span>&nbsp;<span class="num" id="5485985">0</span>&nbsp;<span class="op" id="5485987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485992"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5485994">.</span><span class="ident" id="5485995">Rune</span>&nbsp;<span class="op" id="5486000">=</span>&nbsp;<span class="builtinfunc" id="5486002">append</span><span class="op" id="5486008">(</span><span class="ident" id="5486009"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5486011">.</span><span class="ident" id="5486012">Rune</span><span class="op" id="5486016">,</span>&nbsp;<span class="string" id="5486018">&#39;\n&#39;</span><span class="op" id="5486022">,</span>&nbsp;<span class="string" id="5486024">&#39;\n&#39;</span><span class="op" id="5486028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486035">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486039">class</span>&nbsp;<span class="op" id="5486045">:=</span>&nbsp;<span class="ident" id="5486048"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5486050">.</span><span class="ident" id="5486051">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486057">first</span>&nbsp;<span class="op" id="5486063">:=</span>&nbsp;<span class="builtintype" id="5486066">true</span>&nbsp;<span class="comment" id="5486071">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486115">for</span>&nbsp;<span class="ident" id="5486119"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5486121">==</span>&nbsp;<span class="string" id="5486124">&#34;&#34;</span>&nbsp;<span class="op" id="5486127">||</span>&nbsp;<span class="ident" id="5486130"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486131">[</span><span class="num" id="5486132">0</span><span class="op" id="5486133">]</span>&nbsp;<span class="op" id="5486135">!=</span>&nbsp;<span class="string" id="5486138">&#39;]&#39;</span>&nbsp;<span class="op" id="5486142">||</span>&nbsp;<span class="ident" id="5486145"><a href="/regexp/syntax/parse.go.html#5486057">first</a></span>&nbsp;<span class="op" id="5486151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486155">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486219">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486250">if</span>&nbsp;<span class="ident" id="5486253"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5486255">!=</span>&nbsp;<span class="string" id="5486258">&#34;&#34;</span>&nbsp;<span class="op" id="5486261">&amp;&amp;</span>&nbsp;<span class="ident" id="5486264"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486265">[</span><span class="num" id="5486266">0</span><span class="op" id="5486267">]</span>&nbsp;<span class="op" id="5486269">==</span>&nbsp;<span class="string" id="5486272">&#39;-&#39;</span>&nbsp;<span class="op" id="5486276">&amp;&amp;</span>&nbsp;<span class="ident" id="5486279"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5486280">.</span><span class="ident" id="5486281">flags</span><span class="op" id="5486286">&amp;</span><span class="ident" id="5486287"><a href="/regexp/syntax/parse.go.html#5450048">PerlX</a></span>&nbsp;<span class="op" id="5486293">==</span>&nbsp;<span class="num" id="5486296">0</span>&nbsp;<span class="op" id="5486298">&amp;&amp;</span>&nbsp;<span class="op" id="5486301">!</span><span class="ident" id="5486302"><a href="/regexp/syntax/parse.go.html#5486057">first</a></span>&nbsp;<span class="op" id="5486308">&amp;&amp;</span>&nbsp;<span class="op" id="5486311">(</span><span class="builtinfunc" id="5486312">len</span><span class="op" id="5486315">(</span><span class="ident" id="5486316"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486317">)</span>&nbsp;<span class="op" id="5486319">==</span>&nbsp;<span class="num" id="5486322">1</span>&nbsp;<span class="op" id="5486324">||</span>&nbsp;<span class="ident" id="5486327"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486328">[</span><span class="num" id="5486329">1</span><span class="op" id="5486330">]</span>&nbsp;<span class="op" id="5486332">!=</span>&nbsp;<span class="string" id="5486335">&#39;]&#39;</span><span class="op" id="5486338">)</span>&nbsp;<span class="op" id="5486340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486345">_</span><span class="op" id="5486346">,</span>&nbsp;<span class="ident" id="5486348">size</span>&nbsp;<span class="op" id="5486353">:=</span>&nbsp;<span class="ident" id="5486356"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5486360">.</span><span class="ident" id="5486361">DecodeRuneInString</span><span class="op" id="5486379">(</span><span class="ident" id="5486380"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486381">[</span><span class="num" id="5486382">1</span><span class="op" id="5486383">:</span><span class="op" id="5486384">]</span><span class="op" id="5486385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486390">return</span>&nbsp;<span class="string" id="5486397">&#34;&#34;</span><span class="op" id="5486399">,</span>&nbsp;<span class="op" id="5486401">&amp;</span><span class="ident" id="5486402"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5486407">{</span><span class="ident" id="5486408">Code</span><span class="op" id="5486412">:</span>&nbsp;<span class="ident" id="5486414"><a href="/regexp/syntax/parse.go.html#5448608">ErrInvalidCharRange</a></span><span class="op" id="5486433">,</span>&nbsp;<span class="ident" id="5486435">Expr</span><span class="op" id="5486439">:</span>&nbsp;<span class="ident" id="5486441"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486442">[</span><span class="op" id="5486443">:</span><span class="num" id="5486444">1</span><span class="op" id="5486445">+</span><span class="ident" id="5486446"><a href="/regexp/syntax/parse.go.html#5486348">size</a></span><span class="op" id="5486450">]</span><span class="op" id="5486451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486455">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486459"><a href="/regexp/syntax/parse.go.html#5486057">first</a></span>&nbsp;<span class="op" id="5486465">=</span>&nbsp;<span class="builtintype" id="5486467">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486476">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486511">if</span>&nbsp;<span class="builtinfunc" id="5486514">len</span><span class="op" id="5486517">(</span><span class="ident" id="5486518"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486519">)</span>&nbsp;<span class="op" id="5486521">&gt;</span>&nbsp;<span class="num" id="5486523">2</span>&nbsp;<span class="op" id="5486525">&amp;&amp;</span>&nbsp;<span class="ident" id="5486528"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486529">[</span><span class="num" id="5486530">0</span><span class="op" id="5486531">]</span>&nbsp;<span class="op" id="5486533">==</span>&nbsp;<span class="string" id="5486536">&#39;[&#39;</span>&nbsp;<span class="op" id="5486540">&amp;&amp;</span>&nbsp;<span class="ident" id="5486543"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486544">[</span><span class="num" id="5486545">1</span><span class="op" id="5486546">]</span>&nbsp;<span class="op" id="5486548">==</span>&nbsp;<span class="string" id="5486551">&#39;:&#39;</span>&nbsp;<span class="op" id="5486555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486560">nclass</span><span class="op" id="5486566">,</span>&nbsp;<span class="ident" id="5486568">nt</span><span class="op" id="5486570">,</span>&nbsp;<span class="ident" id="5486572">err</span>&nbsp;<span class="op" id="5486576">:=</span>&nbsp;<span class="ident" id="5486579"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5486580">.</span><span class="ident" id="5486581">parseNamedClass</span><span class="op" id="5486596">(</span><span class="ident" id="5486597"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486598">,</span>&nbsp;<span class="ident" id="5486600"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5486605">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486610">if</span>&nbsp;<span class="ident" id="5486613"><a href="/regexp/syntax/parse.go.html#5486572">err</a></span>&nbsp;<span class="op" id="5486617">!=</span>&nbsp;<span class="ident" id="5486620">nil</span>&nbsp;<span class="op" id="5486624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486630">return</span>&nbsp;<span class="string" id="5486637">&#34;&#34;</span><span class="op" id="5486639">,</span>&nbsp;<span class="ident" id="5486641"><a href="/regexp/syntax/parse.go.html#5486572">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486653">if</span>&nbsp;<span class="ident" id="5486656"><a href="/regexp/syntax/parse.go.html#5486560">nclass</a></span>&nbsp;<span class="op" id="5486663">!=</span>&nbsp;<span class="ident" id="5486666">nil</span>&nbsp;<span class="op" id="5486670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486676"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5486681">,</span>&nbsp;<span class="ident" id="5486683"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5486685">=</span>&nbsp;<span class="ident" id="5486687"><a href="/regexp/syntax/parse.go.html#5486560">nclass</a></span><span class="op" id="5486693">,</span>&nbsp;<span class="ident" id="5486695"><a href="/regexp/syntax/parse.go.html#5486568">nt</a></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486702">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486723">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486775">nclass</span><span class="op" id="5486781">,</span>&nbsp;<span class="ident" id="5486783">nt</span><span class="op" id="5486785">,</span>&nbsp;<span class="ident" id="5486787">err</span>&nbsp;<span class="op" id="5486791">:=</span>&nbsp;<span class="ident" id="5486794"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5486795">.</span><span class="ident" id="5486796">parseUnicodeClass</span><span class="op" id="5486813">(</span><span class="ident" id="5486814"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5486815">,</span>&nbsp;<span class="ident" id="5486817"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5486822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486826">if</span>&nbsp;<span class="ident" id="5486829"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span>&nbsp;<span class="op" id="5486833">!=</span>&nbsp;<span class="ident" id="5486836">nil</span>&nbsp;<span class="op" id="5486840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486845">return</span>&nbsp;<span class="string" id="5486852">&#34;&#34;</span><span class="op" id="5486854">,</span>&nbsp;<span class="ident" id="5486856"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486866">if</span>&nbsp;<span class="ident" id="5486869"><a href="/regexp/syntax/parse.go.html#5486775">nclass</a></span>&nbsp;<span class="op" id="5486876">!=</span>&nbsp;<span class="ident" id="5486879">nil</span>&nbsp;<span class="op" id="5486883">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486888"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5486893">,</span>&nbsp;<span class="ident" id="5486895"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5486897">=</span>&nbsp;<span class="ident" id="5486899"><a href="/regexp/syntax/parse.go.html#5486775">nclass</a></span><span class="op" id="5486905">,</span>&nbsp;<span class="ident" id="5486907"><a href="/regexp/syntax/parse.go.html#5486783">nt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486913">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5486924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486929">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486985">if</span>&nbsp;<span class="ident" id="5486988">nclass</span><span class="op" id="5486994">,</span>&nbsp;<span class="ident" id="5486996">nt</span>&nbsp;<span class="op" id="5486999">:=</span>&nbsp;<span class="ident" id="5487002"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5487003">.</span><span class="ident" id="5487004">parsePerlClassEscape</span><span class="op" id="5487024">(</span><span class="ident" id="5487025"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487026">,</span>&nbsp;<span class="ident" id="5487028"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5487033">)</span><span class="op" id="5487034">;</span>&nbsp;<span class="ident" id="5487036"><a href="/regexp/syntax/parse.go.html#5486988">nclass</a></span>&nbsp;<span class="op" id="5487043">!=</span>&nbsp;<span class="ident" id="5487046">nil</span>&nbsp;<span class="op" id="5487050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487055"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5487060">,</span>&nbsp;<span class="ident" id="5487062"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5487064">=</span>&nbsp;<span class="ident" id="5487066"><a href="/regexp/syntax/parse.go.html#5486988">nclass</a></span><span class="op" id="5487072">,</span>&nbsp;<span class="ident" id="5487074"><a href="/regexp/syntax/parse.go.html#5486996">nt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487080">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487096">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487135">rng</span>&nbsp;<span class="op" id="5487139">:=</span>&nbsp;<span class="ident" id="5487142"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487146">var</span>&nbsp;<span class="ident" id="5487150">lo</span><span class="op" id="5487152">,</span>&nbsp;<span class="ident" id="5487154">hi</span>&nbsp;<span class="builtintype" id="5487157">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487164">if</span>&nbsp;<span class="ident" id="5487167"><a href="/regexp/syntax/parse.go.html#5487150">lo</a></span><span class="op" id="5487169">,</span>&nbsp;<span class="ident" id="5487171"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487172">,</span>&nbsp;<span class="ident" id="5487174"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span>&nbsp;<span class="op" id="5487178">=</span>&nbsp;<span class="ident" id="5487180"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5487181">.</span><span class="ident" id="5487182">parseClassChar</span><span class="op" id="5487196">(</span><span class="ident" id="5487197"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487198">,</span>&nbsp;<span class="ident" id="5487200"><a href="/regexp/syntax/parse.go.html#5485650">s</a></span><span class="op" id="5487201">)</span><span class="op" id="5487202">;</span>&nbsp;<span class="ident" id="5487204"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span>&nbsp;<span class="op" id="5487208">!=</span>&nbsp;<span class="ident" id="5487211">nil</span>&nbsp;<span class="op" id="5487215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487220">return</span>&nbsp;<span class="string" id="5487227">&#34;&#34;</span><span class="op" id="5487229">,</span>&nbsp;<span class="ident" id="5487231"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487241"><a href="/regexp/syntax/parse.go.html#5487154">hi</a></span>&nbsp;<span class="op" id="5487244">=</span>&nbsp;<span class="ident" id="5487246"><a href="/regexp/syntax/parse.go.html#5487150">lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487251">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487295">if</span>&nbsp;<span class="builtinfunc" id="5487298">len</span><span class="op" id="5487301">(</span><span class="ident" id="5487302"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487303">)</span>&nbsp;<span class="op" id="5487305">&gt;=</span>&nbsp;<span class="num" id="5487308">2</span>&nbsp;<span class="op" id="5487310">&amp;&amp;</span>&nbsp;<span class="ident" id="5487313"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487314">[</span><span class="num" id="5487315">0</span><span class="op" id="5487316">]</span>&nbsp;<span class="op" id="5487318">==</span>&nbsp;<span class="string" id="5487321">&#39;-&#39;</span>&nbsp;<span class="op" id="5487325">&amp;&amp;</span>&nbsp;<span class="ident" id="5487328"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487329">[</span><span class="num" id="5487330">1</span><span class="op" id="5487331">]</span>&nbsp;<span class="op" id="5487333">!=</span>&nbsp;<span class="string" id="5487336">&#39;]&#39;</span>&nbsp;<span class="op" id="5487340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487345"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5487347">=</span>&nbsp;<span class="ident" id="5487349"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487350">[</span><span class="num" id="5487351">1</span><span class="op" id="5487352">:</span><span class="op" id="5487353">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487358">if</span>&nbsp;<span class="ident" id="5487361"><a href="/regexp/syntax/parse.go.html#5487154">hi</a></span><span class="op" id="5487363">,</span>&nbsp;<span class="ident" id="5487365"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487366">,</span>&nbsp;<span class="ident" id="5487368"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span>&nbsp;<span class="op" id="5487372">=</span>&nbsp;<span class="ident" id="5487374"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5487375">.</span><span class="ident" id="5487376">parseClassChar</span><span class="op" id="5487390">(</span><span class="ident" id="5487391"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487392">,</span>&nbsp;<span class="ident" id="5487394"><a href="/regexp/syntax/parse.go.html#5485650">s</a></span><span class="op" id="5487395">)</span><span class="op" id="5487396">;</span>&nbsp;<span class="ident" id="5487398"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span>&nbsp;<span class="op" id="5487402">!=</span>&nbsp;<span class="ident" id="5487405">nil</span>&nbsp;<span class="op" id="5487409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487415">return</span>&nbsp;<span class="string" id="5487422">&#34;&#34;</span><span class="op" id="5487424">,</span>&nbsp;<span class="ident" id="5487426"><a href="/regexp/syntax/parse.go.html#5486787">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487438">if</span>&nbsp;<span class="ident" id="5487441"><a href="/regexp/syntax/parse.go.html#5487154">hi</a></span>&nbsp;<span class="op" id="5487444">&lt;</span>&nbsp;<span class="ident" id="5487446"><a href="/regexp/syntax/parse.go.html#5487150">lo</a></span>&nbsp;<span class="op" id="5487449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487455"><a href="/regexp/syntax/parse.go.html#5487135">rng</a></span>&nbsp;<span class="op" id="5487459">=</span>&nbsp;<span class="ident" id="5487461"><a href="/regexp/syntax/parse.go.html#5487135">rng</a></span><span class="op" id="5487464">[</span><span class="op" id="5487465">:</span><span class="builtinfunc" id="5487466">len</span><span class="op" id="5487469">(</span><span class="ident" id="5487470"><a href="/regexp/syntax/parse.go.html#5487135">rng</a></span><span class="op" id="5487473">)</span><span class="op" id="5487474">-</span><span class="builtinfunc" id="5487475">len</span><span class="op" id="5487478">(</span><span class="ident" id="5487479"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487480">)</span><span class="op" id="5487481">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487487">return</span>&nbsp;<span class="string" id="5487494">&#34;&#34;</span><span class="op" id="5487496">,</span>&nbsp;<span class="op" id="5487498">&amp;</span><span class="ident" id="5487499"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5487504">{</span><span class="ident" id="5487505">Code</span><span class="op" id="5487509">:</span>&nbsp;<span class="ident" id="5487511"><a href="/regexp/syntax/parse.go.html#5448608">ErrInvalidCharRange</a></span><span class="op" id="5487530">,</span>&nbsp;<span class="ident" id="5487532">Expr</span><span class="op" id="5487536">:</span>&nbsp;<span class="ident" id="5487538"><a href="/regexp/syntax/parse.go.html#5487135">rng</a></span><span class="op" id="5487541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487554">if</span>&nbsp;<span class="ident" id="5487557"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5487558">.</span><span class="ident" id="5487559">flags</span><span class="op" id="5487564">&amp;</span><span class="ident" id="5487565"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5487574">==</span>&nbsp;<span class="num" id="5487577">0</span>&nbsp;<span class="op" id="5487579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487584"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span>&nbsp;<span class="op" id="5487590">=</span>&nbsp;<span class="ident" id="5487592"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5487603">(</span><span class="ident" id="5487604"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5487609">,</span>&nbsp;<span class="ident" id="5487611"><a href="/regexp/syntax/parse.go.html#5487150">lo</a></span><span class="op" id="5487613">,</span>&nbsp;<span class="ident" id="5487615"><a href="/regexp/syntax/parse.go.html#5487154">hi</a></span><span class="op" id="5487617">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487621">}</span>&nbsp;<span class="keyword" id="5487623">else</span>&nbsp;<span class="op" id="5487628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487633"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span>&nbsp;<span class="op" id="5487639">=</span>&nbsp;<span class="ident" id="5487641"><a href="/regexp/syntax/parse.go.html#5489585">appendFoldedRange</a></span><span class="op" id="5487658">(</span><span class="ident" id="5487659"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5487664">,</span>&nbsp;<span class="ident" id="5487666"><a href="/regexp/syntax/parse.go.html#5487150">lo</a></span><span class="op" id="5487668">,</span>&nbsp;<span class="ident" id="5487670"><a href="/regexp/syntax/parse.go.html#5487154">hi</a></span><span class="op" id="5487672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487682"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span>&nbsp;<span class="op" id="5487684">=</span>&nbsp;<span class="ident" id="5487686"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487687">[</span><span class="num" id="5487688">1</span><span class="op" id="5487689">:</span><span class="op" id="5487690">]</span>&nbsp;<span class="comment" id="5487692">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5487704">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487760"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5487762">.</span><span class="ident" id="5487763">Rune</span>&nbsp;<span class="op" id="5487768">=</span>&nbsp;<span class="ident" id="5487770"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487777"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span>&nbsp;<span class="op" id="5487783">=</span>&nbsp;<span class="ident" id="5487785"><a href="/regexp/syntax/parse.go.html#5488005">cleanClass</a></span><span class="op" id="5487795">(</span><span class="op" id="5487796">&amp;</span><span class="ident" id="5487797"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5487799">.</span><span class="ident" id="5487800">Rune</span><span class="op" id="5487804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487807">if</span>&nbsp;<span class="ident" id="5487810"><a href="/regexp/syntax/parse.go.html#5485787">sign</a></span>&nbsp;<span class="op" id="5487815">&lt;</span>&nbsp;<span class="num" id="5487817">0</span>&nbsp;<span class="op" id="5487819">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487823"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span>&nbsp;<span class="op" id="5487829">=</span>&nbsp;<span class="ident" id="5487831"><a href="/regexp/syntax/parse.go.html#5492926">negateClass</a></span><span class="op" id="5487842">(</span><span class="ident" id="5487843"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><span class="op" id="5487848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487854"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5487856">.</span><span class="ident" id="5487857">Rune</span>&nbsp;<span class="op" id="5487862">=</span>&nbsp;<span class="ident" id="5487864"><a href="/regexp/syntax/parse.go.html#5486039">class</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487871"><a href="/regexp/syntax/parse.go.html#5485628">p</a></span><span class="op" id="5487872">.</span><span class="ident" id="5487873">push</span><span class="op" id="5487877">(</span><span class="ident" id="5487878"><a href="/regexp/syntax/parse.go.html#5485710">re</a></span><span class="op" id="5487880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487883">return</span>&nbsp;<span class="ident" id="5487890"><a href="/regexp/syntax/parse.go.html#5485688">t</a></span><span class="op" id="5487891">,</span>&nbsp;<span class="ident" id="5487893">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5487897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5487900">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5487957">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5488000">func</span>&nbsp;<span class="ident" id="5488005">cleanClass</span><span class="op" id="5488015">(</span><span class="ident" id="5488016">rp</span>&nbsp;<span class="op" id="5488019">*</span><span class="op" id="5488020">[</span><span class="op" id="5488021">]</span><span class="builtintype" id="5488022">rune</span><span class="op" id="5488026">)</span>&nbsp;<span class="op" id="5488028">[</span><span class="op" id="5488029">]</span><span class="builtintype" id="5488030">rune</span>&nbsp;<span class="op" id="5488035">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488039">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488095"><a href="/regexp/syntax/parse.go.html#5448033">sort</a></span><span class="op" id="5488099">.</span><span class="ident" id="5488100">Sort</span><span class="op" id="5488104">(</span><span class="ident" id="5488105"><a href="/regexp/syntax/parse.go.html#5493583">ranges</a></span><span class="op" id="5488111">{</span><span class="ident" id="5488112"><a href="/regexp/syntax/parse.go.html#5488016">rp</a></span><span class="op" id="5488114">}</span><span class="op" id="5488115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488119">r</span>&nbsp;<span class="op" id="5488121">:=</span>&nbsp;<span class="op" id="5488124">*</span><span class="ident" id="5488125"><a href="/regexp/syntax/parse.go.html#5488016">rp</a></span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488129">if</span>&nbsp;<span class="builtinfunc" id="5488132">len</span><span class="op" id="5488135">(</span><span class="ident" id="5488136"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488137">)</span>&nbsp;<span class="op" id="5488139">&lt;</span>&nbsp;<span class="num" id="5488141">2</span>&nbsp;<span class="op" id="5488143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488147">return</span>&nbsp;<span class="ident" id="5488154"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488161">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488194">w</span>&nbsp;<span class="op" id="5488196">:=</span>&nbsp;<span class="num" id="5488199">2</span>&nbsp;<span class="comment" id="5488201">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488217">for</span>&nbsp;<span class="ident" id="5488221">i</span>&nbsp;<span class="op" id="5488223">:=</span>&nbsp;<span class="num" id="5488226">2</span><span class="op" id="5488227">;</span>&nbsp;<span class="ident" id="5488229"><a href="/regexp/syntax/parse.go.html#5488221">i</a></span>&nbsp;<span class="op" id="5488231">&lt;</span>&nbsp;<span class="builtinfunc" id="5488233">len</span><span class="op" id="5488236">(</span><span class="ident" id="5488237"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488238">)</span><span class="op" id="5488239">;</span>&nbsp;<span class="ident" id="5488241"><a href="/regexp/syntax/parse.go.html#5488221">i</a></span>&nbsp;<span class="op" id="5488243">+=</span>&nbsp;<span class="num" id="5488246">2</span>&nbsp;<span class="op" id="5488248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488252">lo</span><span class="op" id="5488254">,</span>&nbsp;<span class="ident" id="5488256">hi</span>&nbsp;<span class="op" id="5488259">:=</span>&nbsp;<span class="ident" id="5488262"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488263">[</span><span class="ident" id="5488264"><a href="/regexp/syntax/parse.go.html#5488221">i</a></span><span class="op" id="5488265">]</span><span class="op" id="5488266">,</span>&nbsp;<span class="ident" id="5488268"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488269">[</span><span class="ident" id="5488270"><a href="/regexp/syntax/parse.go.html#5488221">i</a></span><span class="op" id="5488271">+</span><span class="num" id="5488272">1</span><span class="op" id="5488273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488277">if</span>&nbsp;<span class="ident" id="5488280"><a href="/regexp/syntax/parse.go.html#5488252">lo</a></span>&nbsp;<span class="op" id="5488283">&lt;=</span>&nbsp;<span class="ident" id="5488286"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488287">[</span><span class="ident" id="5488288"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488289">-</span><span class="num" id="5488290">1</span><span class="op" id="5488291">]</span><span class="op" id="5488292">+</span><span class="num" id="5488293">1</span>&nbsp;<span class="op" id="5488295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488300">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488332">if</span>&nbsp;<span class="ident" id="5488335"><a href="/regexp/syntax/parse.go.html#5488256">hi</a></span>&nbsp;<span class="op" id="5488338">&gt;</span>&nbsp;<span class="ident" id="5488340"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488341">[</span><span class="ident" id="5488342"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488343">-</span><span class="num" id="5488344">1</span><span class="op" id="5488345">]</span>&nbsp;<span class="op" id="5488347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488353"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488354">[</span><span class="ident" id="5488355"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488356">-</span><span class="num" id="5488357">1</span><span class="op" id="5488358">]</span>&nbsp;<span class="op" id="5488360">=</span>&nbsp;<span class="ident" id="5488362"><a href="/regexp/syntax/parse.go.html#5488256">hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488373">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488384">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488388">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488412"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488413">[</span><span class="ident" id="5488414"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488415">]</span>&nbsp;<span class="op" id="5488417">=</span>&nbsp;<span class="ident" id="5488419"><a href="/regexp/syntax/parse.go.html#5488252">lo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488424"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488425">[</span><span class="ident" id="5488426"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488427">+</span><span class="num" id="5488428">1</span><span class="op" id="5488429">]</span>&nbsp;<span class="op" id="5488431">=</span>&nbsp;<span class="ident" id="5488433"><a href="/regexp/syntax/parse.go.html#5488256">hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488438"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span>&nbsp;<span class="op" id="5488440">+=</span>&nbsp;<span class="num" id="5488443">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488446">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488450">return</span>&nbsp;<span class="ident" id="5488457"><a href="/regexp/syntax/parse.go.html#5488119">r</a></span><span class="op" id="5488458">[</span><span class="op" id="5488459">:</span><span class="ident" id="5488460"><a href="/regexp/syntax/parse.go.html#5488194">w</a></span><span class="op" id="5488461">]</span><br>
<span class="lineno"></span><span class="op" id="5488463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5488466">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5488545">func</span>&nbsp;<span class="ident" id="5488550">appendLiteral</span><span class="op" id="5488563">(</span><span class="ident" id="5488564">r</span>&nbsp;<span class="op" id="5488566">[</span><span class="op" id="5488567">]</span><span class="builtintype" id="5488568">rune</span><span class="op" id="5488572">,</span>&nbsp;<span class="ident" id="5488574">x</span>&nbsp;<span class="builtintype" id="5488576">rune</span><span class="op" id="5488580">,</span>&nbsp;<span class="ident" id="5488582">flags</span>&nbsp;<span class="ident" id="5488588"><a href="/regexp/syntax/parse.go.html#5449552">Flags</a></span><span class="op" id="5488593">)</span>&nbsp;<span class="op" id="5488595">[</span><span class="op" id="5488596">]</span><span class="builtintype" id="5488597">rune</span>&nbsp;<span class="op" id="5488602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488605">if</span>&nbsp;<span class="ident" id="5488608"><a href="/regexp/syntax/parse.go.html#5488582">flags</a></span><span class="op" id="5488613">&amp;</span><span class="ident" id="5488614"><a href="/regexp/syntax/parse.go.html#5449575">FoldCase</a></span>&nbsp;<span class="op" id="5488623">!=</span>&nbsp;<span class="num" id="5488626">0</span>&nbsp;<span class="op" id="5488628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488632">return</span>&nbsp;<span class="ident" id="5488639"><a href="/regexp/syntax/parse.go.html#5489585">appendFoldedRange</a></span><span class="op" id="5488656">(</span><span class="ident" id="5488657"><a href="/regexp/syntax/parse.go.html#5488564">r</a></span><span class="op" id="5488658">,</span>&nbsp;<span class="ident" id="5488660"><a href="/regexp/syntax/parse.go.html#5488574">x</a></span><span class="op" id="5488661">,</span>&nbsp;<span class="ident" id="5488663"><a href="/regexp/syntax/parse.go.html#5488574">x</a></span><span class="op" id="5488664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488670">return</span>&nbsp;<span class="ident" id="5488677"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5488688">(</span><span class="ident" id="5488689"><a href="/regexp/syntax/parse.go.html#5488564">r</a></span><span class="op" id="5488690">,</span>&nbsp;<span class="ident" id="5488692"><a href="/regexp/syntax/parse.go.html#5488574">x</a></span><span class="op" id="5488693">,</span>&nbsp;<span class="ident" id="5488695"><a href="/regexp/syntax/parse.go.html#5488574">x</a></span><span class="op" id="5488696">)</span><br>
<span class="lineno">1650</span><span class="op" id="5488698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5488701">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5488780">func</span>&nbsp;<span class="ident" id="5488785">appendRange</span><span class="op" id="5488796">(</span><span class="ident" id="5488797">r</span>&nbsp;<span class="op" id="5488799">[</span><span class="op" id="5488800">]</span><span class="builtintype" id="5488801">rune</span><span class="op" id="5488805">,</span>&nbsp;<span class="ident" id="5488807">lo</span><span class="op" id="5488809">,</span>&nbsp;<span class="ident" id="5488811">hi</span>&nbsp;<span class="builtintype" id="5488814">rune</span><span class="op" id="5488818">)</span>&nbsp;<span class="op" id="5488820">[</span><span class="op" id="5488821">]</span><span class="builtintype" id="5488822">rune</span>&nbsp;<span class="op" id="5488827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488830">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488899">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488956">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489018">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489043">n</span>&nbsp;<span class="op" id="5489045">:=</span>&nbsp;<span class="builtinfunc" id="5489048">len</span><span class="op" id="5489051">(</span><span class="ident" id="5489052"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489056">for</span>&nbsp;<span class="ident" id="5489060">i</span>&nbsp;<span class="op" id="5489062">:=</span>&nbsp;<span class="num" id="5489065">2</span><span class="op" id="5489066">;</span>&nbsp;<span class="ident" id="5489068"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span>&nbsp;<span class="op" id="5489070">&lt;=</span>&nbsp;<span class="num" id="5489073">4</span><span class="op" id="5489074">;</span>&nbsp;<span class="ident" id="5489076"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span>&nbsp;<span class="op" id="5489078">+=</span>&nbsp;<span class="num" id="5489081">2</span>&nbsp;<span class="op" id="5489083">{</span>&nbsp;<span class="comment" id="5489085">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489112">if</span>&nbsp;<span class="ident" id="5489115"><a href="/regexp/syntax/parse.go.html#5489043">n</a></span>&nbsp;<span class="op" id="5489117">&gt;=</span>&nbsp;<span class="ident" id="5489120"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span>&nbsp;<span class="op" id="5489122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489127">rlo</span><span class="op" id="5489130">,</span>&nbsp;<span class="ident" id="5489132">rhi</span>&nbsp;<span class="op" id="5489136">:=</span>&nbsp;<span class="ident" id="5489139"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489140">[</span><span class="ident" id="5489141"><a href="/regexp/syntax/parse.go.html#5489043">n</a></span><span class="op" id="5489142">-</span><span class="ident" id="5489143"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span><span class="op" id="5489144">]</span><span class="op" id="5489145">,</span>&nbsp;<span class="ident" id="5489147"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489148">[</span><span class="ident" id="5489149"><a href="/regexp/syntax/parse.go.html#5489043">n</a></span><span class="op" id="5489150">-</span><span class="ident" id="5489151"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span><span class="op" id="5489152">+</span><span class="num" id="5489153">1</span><span class="op" id="5489154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489159">if</span>&nbsp;<span class="ident" id="5489162"><a href="/regexp/syntax/parse.go.html#5488807">lo</a></span>&nbsp;<span class="op" id="5489165">&lt;=</span>&nbsp;<span class="ident" id="5489168"><a href="/regexp/syntax/parse.go.html#5489132">rhi</a></span><span class="op" id="5489171">+</span><span class="num" id="5489172">1</span>&nbsp;<span class="op" id="5489174">&amp;&amp;</span>&nbsp;<span class="ident" id="5489177"><a href="/regexp/syntax/parse.go.html#5489127">rlo</a></span>&nbsp;<span class="op" id="5489181">&lt;=</span>&nbsp;<span class="ident" id="5489184"><a href="/regexp/syntax/parse.go.html#5488811">hi</a></span><span class="op" id="5489186">+</span><span class="num" id="5489187">1</span>&nbsp;<span class="op" id="5489189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489195">if</span>&nbsp;<span class="ident" id="5489198"><a href="/regexp/syntax/parse.go.html#5488807">lo</a></span>&nbsp;<span class="op" id="5489201">&lt;</span>&nbsp;<span class="ident" id="5489203"><a href="/regexp/syntax/parse.go.html#5489127">rlo</a></span>&nbsp;<span class="op" id="5489207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489214"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489215">[</span><span class="ident" id="5489216"><a href="/regexp/syntax/parse.go.html#5489043">n</a></span><span class="op" id="5489217">-</span><span class="ident" id="5489218"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span><span class="op" id="5489219">]</span>&nbsp;<span class="op" id="5489221">=</span>&nbsp;<span class="ident" id="5489223"><a href="/regexp/syntax/parse.go.html#5488807">lo</a></span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489236">if</span>&nbsp;<span class="ident" id="5489239"><a href="/regexp/syntax/parse.go.html#5488811">hi</a></span>&nbsp;<span class="op" id="5489242">&gt;</span>&nbsp;<span class="ident" id="5489244"><a href="/regexp/syntax/parse.go.html#5489132">rhi</a></span>&nbsp;<span class="op" id="5489248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489255"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489256">[</span><span class="ident" id="5489257"><a href="/regexp/syntax/parse.go.html#5489043">n</a></span><span class="op" id="5489258">-</span><span class="ident" id="5489259"><a href="/regexp/syntax/parse.go.html#5489060">i</a></span><span class="op" id="5489260">+</span><span class="num" id="5489261">1</span><span class="op" id="5489262">]</span>&nbsp;<span class="op" id="5489264">=</span>&nbsp;<span class="ident" id="5489266"><a href="/regexp/syntax/parse.go.html#5488811">hi</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489279">return</span>&nbsp;<span class="ident" id="5489286"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489302">return</span>&nbsp;<span class="builtinfunc" id="5489309">append</span><span class="op" id="5489315">(</span><span class="ident" id="5489316"><a href="/regexp/syntax/parse.go.html#5488797">r</a></span><span class="op" id="5489317">,</span>&nbsp;<span class="ident" id="5489319"><a href="/regexp/syntax/parse.go.html#5488807">lo</a></span><span class="op" id="5489321">,</span>&nbsp;<span class="ident" id="5489323"><a href="/regexp/syntax/parse.go.html#5488811">hi</a></span><span class="op" id="5489325">)</span><br>
<span class="lineno">1675</span><span class="op" id="5489327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5489330">const</span>&nbsp;<span class="op" id="5489336">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489339">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489390">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489415">minFold</span>&nbsp;<span class="op" id="5489423">=</span>&nbsp;<span class="num" id="5489425">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489433">maxFold</span>&nbsp;<span class="op" id="5489441">=</span>&nbsp;<span class="num" id="5489443">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5489451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5489454">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5489523">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5489580">func</span>&nbsp;<span class="ident" id="5489585">appendFoldedRange</span><span class="op" id="5489602">(</span><span class="ident" id="5489603">r</span>&nbsp;<span class="op" id="5489605">[</span><span class="op" id="5489606">]</span><span class="builtintype" id="5489607">rune</span><span class="op" id="5489611">,</span>&nbsp;<span class="ident" id="5489613">lo</span><span class="op" id="5489615">,</span>&nbsp;<span class="ident" id="5489617">hi</span>&nbsp;<span class="builtintype" id="5489620">rune</span><span class="op" id="5489624">)</span>&nbsp;<span class="op" id="5489626">[</span><span class="op" id="5489627">]</span><span class="builtintype" id="5489628">rune</span>&nbsp;<span class="op" id="5489633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489636">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489655">if</span>&nbsp;<span class="ident" id="5489658"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span>&nbsp;<span class="op" id="5489661">&lt;=</span>&nbsp;<span class="ident" id="5489664"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span>&nbsp;<span class="op" id="5489672">&amp;&amp;</span>&nbsp;<span class="ident" id="5489675"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span>&nbsp;<span class="op" id="5489678">&gt;=</span>&nbsp;<span class="ident" id="5489681"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span>&nbsp;<span class="op" id="5489689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489693">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489737">return</span>&nbsp;<span class="ident" id="5489744"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5489755">(</span><span class="ident" id="5489756"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5489757">,</span>&nbsp;<span class="ident" id="5489759"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span><span class="op" id="5489761">,</span>&nbsp;<span class="ident" id="5489763"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span><span class="op" id="5489765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489771">if</span>&nbsp;<span class="ident" id="5489774"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span>&nbsp;<span class="op" id="5489777">&lt;</span>&nbsp;<span class="ident" id="5489779"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span>&nbsp;<span class="op" id="5489787">||</span>&nbsp;<span class="ident" id="5489790"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span>&nbsp;<span class="op" id="5489793">&gt;</span>&nbsp;<span class="ident" id="5489795"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span>&nbsp;<span class="op" id="5489803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489807">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489852">return</span>&nbsp;<span class="ident" id="5489859"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5489870">(</span><span class="ident" id="5489871"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5489872">,</span>&nbsp;<span class="ident" id="5489874"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span><span class="op" id="5489876">,</span>&nbsp;<span class="ident" id="5489878"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span><span class="op" id="5489880">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489886">if</span>&nbsp;<span class="ident" id="5489889"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span>&nbsp;<span class="op" id="5489892">&lt;</span>&nbsp;<span class="ident" id="5489894"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span>&nbsp;<span class="op" id="5489902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489906">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489945"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span>&nbsp;<span class="op" id="5489947">=</span>&nbsp;<span class="ident" id="5489949"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5489960">(</span><span class="ident" id="5489961"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5489962">,</span>&nbsp;<span class="ident" id="5489964"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span><span class="op" id="5489966">,</span>&nbsp;<span class="ident" id="5489968"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span><span class="op" id="5489975">-</span><span class="num" id="5489976">1</span><span class="op" id="5489977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489981"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span>&nbsp;<span class="op" id="5489984">=</span>&nbsp;<span class="ident" id="5489986"><a href="/regexp/syntax/parse.go.html#5489415">minFold</a></span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489998">if</span>&nbsp;<span class="ident" id="5490001"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span>&nbsp;<span class="op" id="5490004">&gt;</span>&nbsp;<span class="ident" id="5490006"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span>&nbsp;<span class="op" id="5490014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490018">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490057"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span>&nbsp;<span class="op" id="5490059">=</span>&nbsp;<span class="ident" id="5490061"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5490072">(</span><span class="ident" id="5490073"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5490074">,</span>&nbsp;<span class="ident" id="5490076"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span><span class="op" id="5490083">+</span><span class="num" id="5490084">1</span><span class="op" id="5490085">,</span>&nbsp;<span class="ident" id="5490087"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span><span class="op" id="5490089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490093"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span>&nbsp;<span class="op" id="5490096">=</span>&nbsp;<span class="ident" id="5490098"><a href="/regexp/syntax/parse.go.html#5489433">maxFold</a></span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490111">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490182">for</span>&nbsp;<span class="ident" id="5490186">c</span>&nbsp;<span class="op" id="5490188">:=</span>&nbsp;<span class="ident" id="5490191"><a href="/regexp/syntax/parse.go.html#5489613">lo</a></span><span class="op" id="5490193">;</span>&nbsp;<span class="ident" id="5490195"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span>&nbsp;<span class="op" id="5490197">&lt;=</span>&nbsp;<span class="ident" id="5490200"><a href="/regexp/syntax/parse.go.html#5489617">hi</a></span><span class="op" id="5490202">;</span>&nbsp;<span class="ident" id="5490204"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span><span class="op" id="5490205">++</span>&nbsp;<span class="op" id="5490208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490212"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span>&nbsp;<span class="op" id="5490214">=</span>&nbsp;<span class="ident" id="5490216"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5490227">(</span><span class="ident" id="5490228"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5490229">,</span>&nbsp;<span class="ident" id="5490231"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span><span class="op" id="5490232">,</span>&nbsp;<span class="ident" id="5490234"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span><span class="op" id="5490235">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490239">f</span>&nbsp;<span class="op" id="5490241">:=</span>&nbsp;<span class="ident" id="5490244"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5490251">.</span><span class="ident" id="5490252">SimpleFold</span><span class="op" id="5490262">(</span><span class="ident" id="5490263"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span><span class="op" id="5490264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490268">for</span>&nbsp;<span class="ident" id="5490272"><a href="/regexp/syntax/parse.go.html#5490239">f</a></span>&nbsp;<span class="op" id="5490274">!=</span>&nbsp;<span class="ident" id="5490277"><a href="/regexp/syntax/parse.go.html#5490186">c</a></span>&nbsp;<span class="op" id="5490279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490284"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span>&nbsp;<span class="op" id="5490286">=</span>&nbsp;<span class="ident" id="5490288"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5490299">(</span><span class="ident" id="5490300"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><span class="op" id="5490301">,</span>&nbsp;<span class="ident" id="5490303"><a href="/regexp/syntax/parse.go.html#5490239">f</a></span><span class="op" id="5490304">,</span>&nbsp;<span class="ident" id="5490306"><a href="/regexp/syntax/parse.go.html#5490239">f</a></span><span class="op" id="5490307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490312"><a href="/regexp/syntax/parse.go.html#5490239">f</a></span>&nbsp;<span class="op" id="5490314">=</span>&nbsp;<span class="ident" id="5490316"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5490323">.</span><span class="ident" id="5490324">SimpleFold</span><span class="op" id="5490334">(</span><span class="ident" id="5490335"><a href="/regexp/syntax/parse.go.html#5490239">f</a></span><span class="op" id="5490336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490340">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490346">return</span>&nbsp;<span class="ident" id="5490353"><a href="/regexp/syntax/parse.go.html#5489603">r</a></span><br>
<span class="lineno"></span><span class="op" id="5490355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5490358">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5490433">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5490458">func</span>&nbsp;<span class="ident" id="5490463">appendClass</span><span class="op" id="5490474">(</span><span class="ident" id="5490475">r</span>&nbsp;<span class="op" id="5490477">[</span><span class="op" id="5490478">]</span><span class="builtintype" id="5490479">rune</span><span class="op" id="5490483">,</span>&nbsp;<span class="ident" id="5490485">x</span>&nbsp;<span class="op" id="5490487">[</span><span class="op" id="5490488">]</span><span class="builtintype" id="5490489">rune</span><span class="op" id="5490493">)</span>&nbsp;<span class="op" id="5490495">[</span><span class="op" id="5490496">]</span><span class="builtintype" id="5490497">rune</span>&nbsp;<span class="op" id="5490502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490505">for</span>&nbsp;<span class="ident" id="5490509">i</span>&nbsp;<span class="op" id="5490511">:=</span>&nbsp;<span class="num" id="5490514">0</span><span class="op" id="5490515">;</span>&nbsp;<span class="ident" id="5490517"><a href="/regexp/syntax/parse.go.html#5490509">i</a></span>&nbsp;<span class="op" id="5490519">&lt;</span>&nbsp;<span class="builtinfunc" id="5490521">len</span><span class="op" id="5490524">(</span><span class="ident" id="5490525"><a href="/regexp/syntax/parse.go.html#5490485">x</a></span><span class="op" id="5490526">)</span><span class="op" id="5490527">;</span>&nbsp;<span class="ident" id="5490529"><a href="/regexp/syntax/parse.go.html#5490509">i</a></span>&nbsp;<span class="op" id="5490531">+=</span>&nbsp;<span class="num" id="5490534">2</span>&nbsp;<span class="op" id="5490536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490540"><a href="/regexp/syntax/parse.go.html#5490475">r</a></span>&nbsp;<span class="op" id="5490542">=</span>&nbsp;<span class="ident" id="5490544"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5490555">(</span><span class="ident" id="5490556"><a href="/regexp/syntax/parse.go.html#5490475">r</a></span><span class="op" id="5490557">,</span>&nbsp;<span class="ident" id="5490559"><a href="/regexp/syntax/parse.go.html#5490485">x</a></span><span class="op" id="5490560">[</span><span class="ident" id="5490561"><a href="/regexp/syntax/parse.go.html#5490509">i</a></span><span class="op" id="5490562">]</span><span class="op" id="5490563">,</span>&nbsp;<span class="ident" id="5490565"><a href="/regexp/syntax/parse.go.html#5490485">x</a></span><span class="op" id="5490566">[</span><span class="ident" id="5490567"><a href="/regexp/syntax/parse.go.html#5490509">i</a></span><span class="op" id="5490568">+</span><span class="num" id="5490569">1</span><span class="op" id="5490570">]</span><span class="op" id="5490571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490574">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490577">return</span>&nbsp;<span class="ident" id="5490584"><a href="/regexp/syntax/parse.go.html#5490475">r</a></span><br>
<span class="lineno"></span><span class="op" id="5490586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5490589">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5490685">func</span>&nbsp;<span class="ident" id="5490690">appendFoldedClass</span><span class="op" id="5490707">(</span><span class="ident" id="5490708">r</span>&nbsp;<span class="op" id="5490710">[</span><span class="op" id="5490711">]</span><span class="builtintype" id="5490712">rune</span><span class="op" id="5490716">,</span>&nbsp;<span class="ident" id="5490718">x</span>&nbsp;<span class="op" id="5490720">[</span><span class="op" id="5490721">]</span><span class="builtintype" id="5490722">rune</span><span class="op" id="5490726">)</span>&nbsp;<span class="op" id="5490728">[</span><span class="op" id="5490729">]</span><span class="builtintype" id="5490730">rune</span>&nbsp;<span class="op" id="5490735">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490738">for</span>&nbsp;<span class="ident" id="5490742">i</span>&nbsp;<span class="op" id="5490744">:=</span>&nbsp;<span class="num" id="5490747">0</span><span class="op" id="5490748">;</span>&nbsp;<span class="ident" id="5490750"><a href="/regexp/syntax/parse.go.html#5490742">i</a></span>&nbsp;<span class="op" id="5490752">&lt;</span>&nbsp;<span class="builtinfunc" id="5490754">len</span><span class="op" id="5490757">(</span><span class="ident" id="5490758"><a href="/regexp/syntax/parse.go.html#5490718">x</a></span><span class="op" id="5490759">)</span><span class="op" id="5490760">;</span>&nbsp;<span class="ident" id="5490762"><a href="/regexp/syntax/parse.go.html#5490742">i</a></span>&nbsp;<span class="op" id="5490764">+=</span>&nbsp;<span class="num" id="5490767">2</span>&nbsp;<span class="op" id="5490769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490773"><a href="/regexp/syntax/parse.go.html#5490708">r</a></span>&nbsp;<span class="op" id="5490775">=</span>&nbsp;<span class="ident" id="5490777"><a href="/regexp/syntax/parse.go.html#5489585">appendFoldedRange</a></span><span class="op" id="5490794">(</span><span class="ident" id="5490795"><a href="/regexp/syntax/parse.go.html#5490708">r</a></span><span class="op" id="5490796">,</span>&nbsp;<span class="ident" id="5490798"><a href="/regexp/syntax/parse.go.html#5490718">x</a></span><span class="op" id="5490799">[</span><span class="ident" id="5490800"><a href="/regexp/syntax/parse.go.html#5490742">i</a></span><span class="op" id="5490801">]</span><span class="op" id="5490802">,</span>&nbsp;<span class="ident" id="5490804"><a href="/regexp/syntax/parse.go.html#5490718">x</a></span><span class="op" id="5490805">[</span><span class="ident" id="5490806"><a href="/regexp/syntax/parse.go.html#5490742">i</a></span><span class="op" id="5490807">+</span><span class="num" id="5490808">1</span><span class="op" id="5490809">]</span><span class="op" id="5490810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490816">return</span>&nbsp;<span class="ident" id="5490823"><a href="/regexp/syntax/parse.go.html#5490708">r</a></span><br>
<span class="lineno"></span><span class="op" id="5490825">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5490828">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5490926">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5490952">func</span>&nbsp;<span class="ident" id="5490957">appendNegatedClass</span><span class="op" id="5490975">(</span><span class="ident" id="5490976">r</span>&nbsp;<span class="op" id="5490978">[</span><span class="op" id="5490979">]</span><span class="builtintype" id="5490980">rune</span><span class="op" id="5490984">,</span>&nbsp;<span class="ident" id="5490986">x</span>&nbsp;<span class="op" id="5490988">[</span><span class="op" id="5490989">]</span><span class="builtintype" id="5490990">rune</span><span class="op" id="5490994">)</span>&nbsp;<span class="op" id="5490996">[</span><span class="op" id="5490997">]</span><span class="builtintype" id="5490998">rune</span>&nbsp;<span class="op" id="5491003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491006">nextLo</span>&nbsp;<span class="op" id="5491013">:=</span>&nbsp;<span class="string" id="5491016">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491026">for</span>&nbsp;<span class="ident" id="5491030">i</span>&nbsp;<span class="op" id="5491032">:=</span>&nbsp;<span class="num" id="5491035">0</span><span class="op" id="5491036">;</span>&nbsp;<span class="ident" id="5491038"><a href="/regexp/syntax/parse.go.html#5491030">i</a></span>&nbsp;<span class="op" id="5491040">&lt;</span>&nbsp;<span class="builtinfunc" id="5491042">len</span><span class="op" id="5491045">(</span><span class="ident" id="5491046"><a href="/regexp/syntax/parse.go.html#5490986">x</a></span><span class="op" id="5491047">)</span><span class="op" id="5491048">;</span>&nbsp;<span class="ident" id="5491050"><a href="/regexp/syntax/parse.go.html#5491030">i</a></span>&nbsp;<span class="op" id="5491052">+=</span>&nbsp;<span class="num" id="5491055">2</span>&nbsp;<span class="op" id="5491057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491061">lo</span><span class="op" id="5491063">,</span>&nbsp;<span class="ident" id="5491065">hi</span>&nbsp;<span class="op" id="5491068">:=</span>&nbsp;<span class="ident" id="5491071"><a href="/regexp/syntax/parse.go.html#5490986">x</a></span><span class="op" id="5491072">[</span><span class="ident" id="5491073"><a href="/regexp/syntax/parse.go.html#5491030">i</a></span><span class="op" id="5491074">]</span><span class="op" id="5491075">,</span>&nbsp;<span class="ident" id="5491077"><a href="/regexp/syntax/parse.go.html#5490986">x</a></span><span class="op" id="5491078">[</span><span class="ident" id="5491079"><a href="/regexp/syntax/parse.go.html#5491030">i</a></span><span class="op" id="5491080">+</span><span class="num" id="5491081">1</span><span class="op" id="5491082">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491086">if</span>&nbsp;<span class="ident" id="5491089"><a href="/regexp/syntax/parse.go.html#5491006">nextLo</a></span>&nbsp;<span class="op" id="5491096">&lt;=</span>&nbsp;<span class="ident" id="5491099"><a href="/regexp/syntax/parse.go.html#5491061">lo</a></span><span class="op" id="5491101">-</span><span class="num" id="5491102">1</span>&nbsp;<span class="op" id="5491104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491109"><a href="/regexp/syntax/parse.go.html#5490976">r</a></span>&nbsp;<span class="op" id="5491111">=</span>&nbsp;<span class="ident" id="5491113"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491124">(</span><span class="ident" id="5491125"><a href="/regexp/syntax/parse.go.html#5490976">r</a></span><span class="op" id="5491126">,</span>&nbsp;<span class="ident" id="5491128"><a href="/regexp/syntax/parse.go.html#5491006">nextLo</a></span><span class="op" id="5491134">,</span>&nbsp;<span class="ident" id="5491136"><a href="/regexp/syntax/parse.go.html#5491061">lo</a></span><span class="op" id="5491138">-</span><span class="num" id="5491139">1</span><span class="op" id="5491140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491144">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491148"><a href="/regexp/syntax/parse.go.html#5491006">nextLo</a></span>&nbsp;<span class="op" id="5491155">=</span>&nbsp;<span class="ident" id="5491157"><a href="/regexp/syntax/parse.go.html#5491065">hi</a></span>&nbsp;<span class="op" id="5491160">+</span>&nbsp;<span class="num" id="5491162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491168">if</span>&nbsp;<span class="ident" id="5491171"><a href="/regexp/syntax/parse.go.html#5491006">nextLo</a></span>&nbsp;<span class="op" id="5491178">&lt;=</span>&nbsp;<span class="ident" id="5491181"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5491188">.</span><span class="ident" id="5491189">MaxRune</span>&nbsp;<span class="op" id="5491197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491201"><a href="/regexp/syntax/parse.go.html#5490976">r</a></span>&nbsp;<span class="op" id="5491203">=</span>&nbsp;<span class="ident" id="5491205"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491216">(</span><span class="ident" id="5491217"><a href="/regexp/syntax/parse.go.html#5490976">r</a></span><span class="op" id="5491218">,</span>&nbsp;<span class="ident" id="5491220"><a href="/regexp/syntax/parse.go.html#5491006">nextLo</a></span><span class="op" id="5491226">,</span>&nbsp;<span class="ident" id="5491228"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5491235">.</span><span class="ident" id="5491236">MaxRune</span><span class="op" id="5491243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491246">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491249">return</span>&nbsp;<span class="ident" id="5491256"><a href="/regexp/syntax/parse.go.html#5490976">r</a></span><br>
<span class="lineno"></span><span class="op" id="5491258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491261">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5491326">func</span>&nbsp;<span class="ident" id="5491331">appendTable</span><span class="op" id="5491342">(</span><span class="ident" id="5491343">r</span>&nbsp;<span class="op" id="5491345">[</span><span class="op" id="5491346">]</span><span class="builtintype" id="5491347">rune</span><span class="op" id="5491351">,</span>&nbsp;<span class="ident" id="5491353">x</span>&nbsp;<span class="op" id="5491355">*</span><span class="ident" id="5491356"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5491363">.</span><span class="ident" id="5491364">RangeTable</span><span class="op" id="5491374">)</span>&nbsp;<span class="op" id="5491376">[</span><span class="op" id="5491377">]</span><span class="builtintype" id="5491378">rune</span>&nbsp;<span class="op" id="5491383">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491386">for</span>&nbsp;<span class="ident" id="5491390">_</span><span class="op" id="5491391">,</span>&nbsp;<span class="ident" id="5491393">xr</span>&nbsp;<span class="op" id="5491396">:=</span>&nbsp;<span class="keyword" id="5491399">range</span>&nbsp;<span class="ident" id="5491405"><a href="/regexp/syntax/parse.go.html#5491353">x</a></span><span class="op" id="5491406">.</span><span class="ident" id="5491407">R16</span>&nbsp;<span class="op" id="5491411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491415">lo</span><span class="op" id="5491417">,</span>&nbsp;<span class="ident" id="5491419">hi</span><span class="op" id="5491421">,</span>&nbsp;<span class="ident" id="5491423">stride</span>&nbsp;<span class="op" id="5491430">:=</span>&nbsp;<span class="builtintype" id="5491433">rune</span><span class="op" id="5491437">(</span><span class="ident" id="5491438"><a href="/regexp/syntax/parse.go.html#5491393">xr</a></span><span class="op" id="5491440">.</span><span class="ident" id="5491441">Lo</span><span class="op" id="5491443">)</span><span class="op" id="5491444">,</span>&nbsp;<span class="builtintype" id="5491446">rune</span><span class="op" id="5491450">(</span><span class="ident" id="5491451"><a href="/regexp/syntax/parse.go.html#5491393">xr</a></span><span class="op" id="5491453">.</span><span class="ident" id="5491454">Hi</span><span class="op" id="5491456">)</span><span class="op" id="5491457">,</span>&nbsp;<span class="builtintype" id="5491459">rune</span><span class="op" id="5491463">(</span><span class="ident" id="5491464"><a href="/regexp/syntax/parse.go.html#5491393">xr</a></span><span class="op" id="5491466">.</span><span class="ident" id="5491467">Stride</span><span class="op" id="5491473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491477">if</span>&nbsp;<span class="ident" id="5491480"><a href="/regexp/syntax/parse.go.html#5491423">stride</a></span>&nbsp;<span class="op" id="5491487">==</span>&nbsp;<span class="num" id="5491490">1</span>&nbsp;<span class="op" id="5491492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491497"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span>&nbsp;<span class="op" id="5491499">=</span>&nbsp;<span class="ident" id="5491501"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491512">(</span><span class="ident" id="5491513"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span><span class="op" id="5491514">,</span>&nbsp;<span class="ident" id="5491516"><a href="/regexp/syntax/parse.go.html#5491415">lo</a></span><span class="op" id="5491518">,</span>&nbsp;<span class="ident" id="5491520"><a href="/regexp/syntax/parse.go.html#5491419">hi</a></span><span class="op" id="5491522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491527">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491542">for</span>&nbsp;<span class="ident" id="5491546">c</span>&nbsp;<span class="op" id="5491548">:=</span>&nbsp;<span class="ident" id="5491551"><a href="/regexp/syntax/parse.go.html#5491415">lo</a></span><span class="op" id="5491553">;</span>&nbsp;<span class="ident" id="5491555"><a href="/regexp/syntax/parse.go.html#5491546">c</a></span>&nbsp;<span class="op" id="5491557">&lt;=</span>&nbsp;<span class="ident" id="5491560"><a href="/regexp/syntax/parse.go.html#5491419">hi</a></span><span class="op" id="5491562">;</span>&nbsp;<span class="ident" id="5491564"><a href="/regexp/syntax/parse.go.html#5491546">c</a></span>&nbsp;<span class="op" id="5491566">+=</span>&nbsp;<span class="ident" id="5491569"><a href="/regexp/syntax/parse.go.html#5491423">stride</a></span>&nbsp;<span class="op" id="5491576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491581"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span>&nbsp;<span class="op" id="5491583">=</span>&nbsp;<span class="ident" id="5491585"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491596">(</span><span class="ident" id="5491597"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span><span class="op" id="5491598">,</span>&nbsp;<span class="ident" id="5491600"><a href="/regexp/syntax/parse.go.html#5491546">c</a></span><span class="op" id="5491601">,</span>&nbsp;<span class="ident" id="5491603"><a href="/regexp/syntax/parse.go.html#5491546">c</a></span><span class="op" id="5491604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491611">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491614">for</span>&nbsp;<span class="ident" id="5491618">_</span><span class="op" id="5491619">,</span>&nbsp;<span class="ident" id="5491621">xr</span>&nbsp;<span class="op" id="5491624">:=</span>&nbsp;<span class="keyword" id="5491627">range</span>&nbsp;<span class="ident" id="5491633"><a href="/regexp/syntax/parse.go.html#5491353">x</a></span><span class="op" id="5491634">.</span><span class="ident" id="5491635">R32</span>&nbsp;<span class="op" id="5491639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491643">lo</span><span class="op" id="5491645">,</span>&nbsp;<span class="ident" id="5491647">hi</span><span class="op" id="5491649">,</span>&nbsp;<span class="ident" id="5491651">stride</span>&nbsp;<span class="op" id="5491658">:=</span>&nbsp;<span class="builtintype" id="5491661">rune</span><span class="op" id="5491665">(</span><span class="ident" id="5491666"><a href="/regexp/syntax/parse.go.html#5491621">xr</a></span><span class="op" id="5491668">.</span><span class="ident" id="5491669">Lo</span><span class="op" id="5491671">)</span><span class="op" id="5491672">,</span>&nbsp;<span class="builtintype" id="5491674">rune</span><span class="op" id="5491678">(</span><span class="ident" id="5491679"><a href="/regexp/syntax/parse.go.html#5491621">xr</a></span><span class="op" id="5491681">.</span><span class="ident" id="5491682">Hi</span><span class="op" id="5491684">)</span><span class="op" id="5491685">,</span>&nbsp;<span class="builtintype" id="5491687">rune</span><span class="op" id="5491691">(</span><span class="ident" id="5491692"><a href="/regexp/syntax/parse.go.html#5491621">xr</a></span><span class="op" id="5491694">.</span><span class="ident" id="5491695">Stride</span><span class="op" id="5491701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491705">if</span>&nbsp;<span class="ident" id="5491708"><a href="/regexp/syntax/parse.go.html#5491651">stride</a></span>&nbsp;<span class="op" id="5491715">==</span>&nbsp;<span class="num" id="5491718">1</span>&nbsp;<span class="op" id="5491720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491725"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span>&nbsp;<span class="op" id="5491727">=</span>&nbsp;<span class="ident" id="5491729"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491740">(</span><span class="ident" id="5491741"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span><span class="op" id="5491742">,</span>&nbsp;<span class="ident" id="5491744"><a href="/regexp/syntax/parse.go.html#5491643">lo</a></span><span class="op" id="5491746">,</span>&nbsp;<span class="ident" id="5491748"><a href="/regexp/syntax/parse.go.html#5491647">hi</a></span><span class="op" id="5491750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491755">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491770">for</span>&nbsp;<span class="ident" id="5491774">c</span>&nbsp;<span class="op" id="5491776">:=</span>&nbsp;<span class="ident" id="5491779"><a href="/regexp/syntax/parse.go.html#5491643">lo</a></span><span class="op" id="5491781">;</span>&nbsp;<span class="ident" id="5491783"><a href="/regexp/syntax/parse.go.html#5491774">c</a></span>&nbsp;<span class="op" id="5491785">&lt;=</span>&nbsp;<span class="ident" id="5491788"><a href="/regexp/syntax/parse.go.html#5491647">hi</a></span><span class="op" id="5491790">;</span>&nbsp;<span class="ident" id="5491792"><a href="/regexp/syntax/parse.go.html#5491774">c</a></span>&nbsp;<span class="op" id="5491794">+=</span>&nbsp;<span class="ident" id="5491797"><a href="/regexp/syntax/parse.go.html#5491651">stride</a></span>&nbsp;<span class="op" id="5491804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491809"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span>&nbsp;<span class="op" id="5491811">=</span>&nbsp;<span class="ident" id="5491813"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5491824">(</span><span class="ident" id="5491825"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span><span class="op" id="5491826">,</span>&nbsp;<span class="ident" id="5491828"><a href="/regexp/syntax/parse.go.html#5491774">c</a></span><span class="op" id="5491829">,</span>&nbsp;<span class="ident" id="5491831"><a href="/regexp/syntax/parse.go.html#5491774">c</a></span><span class="op" id="5491832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491839">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491842">return</span>&nbsp;<span class="ident" id="5491849"><a href="/regexp/syntax/parse.go.html#5491343">r</a></span><br>
<span class="lineno"></span><span class="op" id="5491851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491854">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5491942">func</span>&nbsp;<span class="ident" id="5491947">appendNegatedTable</span><span class="op" id="5491965">(</span><span class="ident" id="5491966">r</span>&nbsp;<span class="op" id="5491968">[</span><span class="op" id="5491969">]</span><span class="builtintype" id="5491970">rune</span><span class="op" id="5491974">,</span>&nbsp;<span class="ident" id="5491976">x</span>&nbsp;<span class="op" id="5491978">*</span><span class="ident" id="5491979"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5491986">.</span><span class="ident" id="5491987">RangeTable</span><span class="op" id="5491997">)</span>&nbsp;<span class="op" id="5491999">[</span><span class="op" id="5492000">]</span><span class="builtintype" id="5492001">rune</span>&nbsp;<span class="op" id="5492006">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492009">nextLo</span>&nbsp;<span class="op" id="5492016">:=</span>&nbsp;<span class="string" id="5492019">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5492028">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492060">for</span>&nbsp;<span class="ident" id="5492064">_</span><span class="op" id="5492065">,</span>&nbsp;<span class="ident" id="5492067">xr</span>&nbsp;<span class="op" id="5492070">:=</span>&nbsp;<span class="keyword" id="5492073">range</span>&nbsp;<span class="ident" id="5492079"><a href="/regexp/syntax/parse.go.html#5491976">x</a></span><span class="op" id="5492080">.</span><span class="ident" id="5492081">R16</span>&nbsp;<span class="op" id="5492085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492089">lo</span><span class="op" id="5492091">,</span>&nbsp;<span class="ident" id="5492093">hi</span><span class="op" id="5492095">,</span>&nbsp;<span class="ident" id="5492097">stride</span>&nbsp;<span class="op" id="5492104">:=</span>&nbsp;<span class="builtintype" id="5492107">rune</span><span class="op" id="5492111">(</span><span class="ident" id="5492112"><a href="/regexp/syntax/parse.go.html#5492067">xr</a></span><span class="op" id="5492114">.</span><span class="ident" id="5492115">Lo</span><span class="op" id="5492117">)</span><span class="op" id="5492118">,</span>&nbsp;<span class="builtintype" id="5492120">rune</span><span class="op" id="5492124">(</span><span class="ident" id="5492125"><a href="/regexp/syntax/parse.go.html#5492067">xr</a></span><span class="op" id="5492127">.</span><span class="ident" id="5492128">Hi</span><span class="op" id="5492130">)</span><span class="op" id="5492131">,</span>&nbsp;<span class="builtintype" id="5492133">rune</span><span class="op" id="5492137">(</span><span class="ident" id="5492138"><a href="/regexp/syntax/parse.go.html#5492067">xr</a></span><span class="op" id="5492140">.</span><span class="ident" id="5492141">Stride</span><span class="op" id="5492147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492151">if</span>&nbsp;<span class="ident" id="5492154"><a href="/regexp/syntax/parse.go.html#5492097">stride</a></span>&nbsp;<span class="op" id="5492161">==</span>&nbsp;<span class="num" id="5492164">1</span>&nbsp;<span class="op" id="5492166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492171">if</span>&nbsp;<span class="ident" id="5492174"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492181">&lt;=</span>&nbsp;<span class="ident" id="5492184"><a href="/regexp/syntax/parse.go.html#5492089">lo</a></span><span class="op" id="5492186">-</span><span class="num" id="5492187">1</span>&nbsp;<span class="op" id="5492189">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492195"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span>&nbsp;<span class="op" id="5492197">=</span>&nbsp;<span class="ident" id="5492199"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5492210">(</span><span class="ident" id="5492211"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><span class="op" id="5492212">,</span>&nbsp;<span class="ident" id="5492214"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span><span class="op" id="5492220">,</span>&nbsp;<span class="ident" id="5492222"><a href="/regexp/syntax/parse.go.html#5492089">lo</a></span><span class="op" id="5492224">-</span><span class="num" id="5492225">1</span><span class="op" id="5492226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492236"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492243">=</span>&nbsp;<span class="ident" id="5492245"><a href="/regexp/syntax/parse.go.html#5492093">hi</a></span>&nbsp;<span class="op" id="5492248">+</span>&nbsp;<span class="num" id="5492250">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492255">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492266">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492270">for</span>&nbsp;<span class="ident" id="5492274">c</span>&nbsp;<span class="op" id="5492276">:=</span>&nbsp;<span class="ident" id="5492279"><a href="/regexp/syntax/parse.go.html#5492089">lo</a></span><span class="op" id="5492281">;</span>&nbsp;<span class="ident" id="5492283"><a href="/regexp/syntax/parse.go.html#5492274">c</a></span>&nbsp;<span class="op" id="5492285">&lt;=</span>&nbsp;<span class="ident" id="5492288"><a href="/regexp/syntax/parse.go.html#5492093">hi</a></span><span class="op" id="5492290">;</span>&nbsp;<span class="ident" id="5492292"><a href="/regexp/syntax/parse.go.html#5492274">c</a></span>&nbsp;<span class="op" id="5492294">+=</span>&nbsp;<span class="ident" id="5492297"><a href="/regexp/syntax/parse.go.html#5492097">stride</a></span>&nbsp;<span class="op" id="5492304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492309">if</span>&nbsp;<span class="ident" id="5492312"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492319">&lt;=</span>&nbsp;<span class="ident" id="5492322"><a href="/regexp/syntax/parse.go.html#5492274">c</a></span><span class="op" id="5492323">-</span><span class="num" id="5492324">1</span>&nbsp;<span class="op" id="5492326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492332"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span>&nbsp;<span class="op" id="5492334">=</span>&nbsp;<span class="ident" id="5492336"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5492347">(</span><span class="ident" id="5492348"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><span class="op" id="5492349">,</span>&nbsp;<span class="ident" id="5492351"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span><span class="op" id="5492357">,</span>&nbsp;<span class="ident" id="5492359"><a href="/regexp/syntax/parse.go.html#5492274">c</a></span><span class="op" id="5492360">-</span><span class="num" id="5492361">1</span><span class="op" id="5492362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492372"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492379">=</span>&nbsp;<span class="ident" id="5492381"><a href="/regexp/syntax/parse.go.html#5492274">c</a></span>&nbsp;<span class="op" id="5492383">+</span>&nbsp;<span class="num" id="5492385">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492395">for</span>&nbsp;<span class="ident" id="5492399">_</span><span class="op" id="5492400">,</span>&nbsp;<span class="ident" id="5492402">xr</span>&nbsp;<span class="op" id="5492405">:=</span>&nbsp;<span class="keyword" id="5492408">range</span>&nbsp;<span class="ident" id="5492414"><a href="/regexp/syntax/parse.go.html#5491976">x</a></span><span class="op" id="5492415">.</span><span class="ident" id="5492416">R32</span>&nbsp;<span class="op" id="5492420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492424">lo</span><span class="op" id="5492426">,</span>&nbsp;<span class="ident" id="5492428">hi</span><span class="op" id="5492430">,</span>&nbsp;<span class="ident" id="5492432">stride</span>&nbsp;<span class="op" id="5492439">:=</span>&nbsp;<span class="builtintype" id="5492442">rune</span><span class="op" id="5492446">(</span><span class="ident" id="5492447"><a href="/regexp/syntax/parse.go.html#5492402">xr</a></span><span class="op" id="5492449">.</span><span class="ident" id="5492450">Lo</span><span class="op" id="5492452">)</span><span class="op" id="5492453">,</span>&nbsp;<span class="builtintype" id="5492455">rune</span><span class="op" id="5492459">(</span><span class="ident" id="5492460"><a href="/regexp/syntax/parse.go.html#5492402">xr</a></span><span class="op" id="5492462">.</span><span class="ident" id="5492463">Hi</span><span class="op" id="5492465">)</span><span class="op" id="5492466">,</span>&nbsp;<span class="builtintype" id="5492468">rune</span><span class="op" id="5492472">(</span><span class="ident" id="5492473"><a href="/regexp/syntax/parse.go.html#5492402">xr</a></span><span class="op" id="5492475">.</span><span class="ident" id="5492476">Stride</span><span class="op" id="5492482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492486">if</span>&nbsp;<span class="ident" id="5492489"><a href="/regexp/syntax/parse.go.html#5492432">stride</a></span>&nbsp;<span class="op" id="5492496">==</span>&nbsp;<span class="num" id="5492499">1</span>&nbsp;<span class="op" id="5492501">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492506">if</span>&nbsp;<span class="ident" id="5492509"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492516">&lt;=</span>&nbsp;<span class="ident" id="5492519"><a href="/regexp/syntax/parse.go.html#5492424">lo</a></span><span class="op" id="5492521">-</span><span class="num" id="5492522">1</span>&nbsp;<span class="op" id="5492524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492530"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span>&nbsp;<span class="op" id="5492532">=</span>&nbsp;<span class="ident" id="5492534"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5492545">(</span><span class="ident" id="5492546"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><span class="op" id="5492547">,</span>&nbsp;<span class="ident" id="5492549"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span><span class="op" id="5492555">,</span>&nbsp;<span class="ident" id="5492557"><a href="/regexp/syntax/parse.go.html#5492424">lo</a></span><span class="op" id="5492559">-</span><span class="num" id="5492560">1</span><span class="op" id="5492561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492571"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492578">=</span>&nbsp;<span class="ident" id="5492580"><a href="/regexp/syntax/parse.go.html#5492428">hi</a></span>&nbsp;<span class="op" id="5492583">+</span>&nbsp;<span class="num" id="5492585">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492590">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492605">for</span>&nbsp;<span class="ident" id="5492609">c</span>&nbsp;<span class="op" id="5492611">:=</span>&nbsp;<span class="ident" id="5492614"><a href="/regexp/syntax/parse.go.html#5492424">lo</a></span><span class="op" id="5492616">;</span>&nbsp;<span class="ident" id="5492618"><a href="/regexp/syntax/parse.go.html#5492609">c</a></span>&nbsp;<span class="op" id="5492620">&lt;=</span>&nbsp;<span class="ident" id="5492623"><a href="/regexp/syntax/parse.go.html#5492428">hi</a></span><span class="op" id="5492625">;</span>&nbsp;<span class="ident" id="5492627"><a href="/regexp/syntax/parse.go.html#5492609">c</a></span>&nbsp;<span class="op" id="5492629">+=</span>&nbsp;<span class="ident" id="5492632"><a href="/regexp/syntax/parse.go.html#5492432">stride</a></span>&nbsp;<span class="op" id="5492639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492644">if</span>&nbsp;<span class="ident" id="5492647"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492654">&lt;=</span>&nbsp;<span class="ident" id="5492657"><a href="/regexp/syntax/parse.go.html#5492609">c</a></span><span class="op" id="5492658">-</span><span class="num" id="5492659">1</span>&nbsp;<span class="op" id="5492661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492667"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span>&nbsp;<span class="op" id="5492669">=</span>&nbsp;<span class="ident" id="5492671"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5492682">(</span><span class="ident" id="5492683"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><span class="op" id="5492684">,</span>&nbsp;<span class="ident" id="5492686"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span><span class="op" id="5492692">,</span>&nbsp;<span class="ident" id="5492694"><a href="/regexp/syntax/parse.go.html#5492609">c</a></span><span class="op" id="5492695">-</span><span class="num" id="5492696">1</span><span class="op" id="5492697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492702">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492707"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492714">=</span>&nbsp;<span class="ident" id="5492716"><a href="/regexp/syntax/parse.go.html#5492609">c</a></span>&nbsp;<span class="op" id="5492718">+</span>&nbsp;<span class="num" id="5492720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492730">if</span>&nbsp;<span class="ident" id="5492733"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span>&nbsp;<span class="op" id="5492740">&lt;=</span>&nbsp;<span class="ident" id="5492743"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5492750">.</span><span class="ident" id="5492751">MaxRune</span>&nbsp;<span class="op" id="5492759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492763"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span>&nbsp;<span class="op" id="5492765">=</span>&nbsp;<span class="ident" id="5492767"><a href="/regexp/syntax/parse.go.html#5488785">appendRange</a></span><span class="op" id="5492778">(</span><span class="ident" id="5492779"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><span class="op" id="5492780">,</span>&nbsp;<span class="ident" id="5492782"><a href="/regexp/syntax/parse.go.html#5492009">nextLo</a></span><span class="op" id="5492788">,</span>&nbsp;<span class="ident" id="5492790"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5492797">.</span><span class="ident" id="5492798">MaxRune</span><span class="op" id="5492805">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492811">return</span>&nbsp;<span class="ident" id="5492818"><a href="/regexp/syntax/parse.go.html#5491966">r</a></span><br>
<span class="lineno"></span><span class="op" id="5492820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492823">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5492877">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5492921">func</span>&nbsp;<span class="ident" id="5492926">negateClass</span><span class="op" id="5492937">(</span><span class="ident" id="5492938">r</span>&nbsp;<span class="op" id="5492940">[</span><span class="op" id="5492941">]</span><span class="builtintype" id="5492942">rune</span><span class="op" id="5492946">)</span>&nbsp;<span class="op" id="5492948">[</span><span class="op" id="5492949">]</span><span class="builtintype" id="5492950">rune</span>&nbsp;<span class="op" id="5492955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492958">nextLo</span>&nbsp;<span class="op" id="5492965">:=</span>&nbsp;<span class="string" id="5492968">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5492977">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493009">w</span>&nbsp;<span class="op" id="5493011">:=</span>&nbsp;<span class="num" id="5493014">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493028">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493044">for</span>&nbsp;<span class="ident" id="5493048">i</span>&nbsp;<span class="op" id="5493050">:=</span>&nbsp;<span class="num" id="5493053">0</span><span class="op" id="5493054">;</span>&nbsp;<span class="ident" id="5493056"><a href="/regexp/syntax/parse.go.html#5493048">i</a></span>&nbsp;<span class="op" id="5493058">&lt;</span>&nbsp;<span class="builtinfunc" id="5493060">len</span><span class="op" id="5493063">(</span><span class="ident" id="5493064"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493065">)</span><span class="op" id="5493066">;</span>&nbsp;<span class="ident" id="5493068"><a href="/regexp/syntax/parse.go.html#5493048">i</a></span>&nbsp;<span class="op" id="5493070">+=</span>&nbsp;<span class="num" id="5493073">2</span>&nbsp;<span class="op" id="5493075">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493079">lo</span><span class="op" id="5493081">,</span>&nbsp;<span class="ident" id="5493083">hi</span>&nbsp;<span class="op" id="5493086">:=</span>&nbsp;<span class="ident" id="5493089"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493090">[</span><span class="ident" id="5493091"><a href="/regexp/syntax/parse.go.html#5493048">i</a></span><span class="op" id="5493092">]</span><span class="op" id="5493093">,</span>&nbsp;<span class="ident" id="5493095"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493096">[</span><span class="ident" id="5493097"><a href="/regexp/syntax/parse.go.html#5493048">i</a></span><span class="op" id="5493098">+</span><span class="num" id="5493099">1</span><span class="op" id="5493100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493104">if</span>&nbsp;<span class="ident" id="5493107"><a href="/regexp/syntax/parse.go.html#5492958">nextLo</a></span>&nbsp;<span class="op" id="5493114">&lt;=</span>&nbsp;<span class="ident" id="5493117"><a href="/regexp/syntax/parse.go.html#5493079">lo</a></span><span class="op" id="5493119">-</span><span class="num" id="5493120">1</span>&nbsp;<span class="op" id="5493122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493127"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493128">[</span><span class="ident" id="5493129"><a href="/regexp/syntax/parse.go.html#5493009">w</a></span><span class="op" id="5493130">]</span>&nbsp;<span class="op" id="5493132">=</span>&nbsp;<span class="ident" id="5493134"><a href="/regexp/syntax/parse.go.html#5492958">nextLo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493144"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493145">[</span><span class="ident" id="5493146"><a href="/regexp/syntax/parse.go.html#5493009">w</a></span><span class="op" id="5493147">+</span><span class="num" id="5493148">1</span><span class="op" id="5493149">]</span>&nbsp;<span class="op" id="5493151">=</span>&nbsp;<span class="ident" id="5493153"><a href="/regexp/syntax/parse.go.html#5493079">lo</a></span>&nbsp;<span class="op" id="5493156">-</span>&nbsp;<span class="num" id="5493158">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493163"><a href="/regexp/syntax/parse.go.html#5493009">w</a></span>&nbsp;<span class="op" id="5493165">+=</span>&nbsp;<span class="num" id="5493168">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493176"><a href="/regexp/syntax/parse.go.html#5492958">nextLo</a></span>&nbsp;<span class="op" id="5493183">=</span>&nbsp;<span class="ident" id="5493185"><a href="/regexp/syntax/parse.go.html#5493083">hi</a></span>&nbsp;<span class="op" id="5493188">+</span>&nbsp;<span class="num" id="5493190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493196"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span>&nbsp;<span class="op" id="5493198">=</span>&nbsp;<span class="ident" id="5493200"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493201">[</span><span class="op" id="5493202">:</span><span class="ident" id="5493203"><a href="/regexp/syntax/parse.go.html#5493009">w</a></span><span class="op" id="5493204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493207">if</span>&nbsp;<span class="ident" id="5493210"><a href="/regexp/syntax/parse.go.html#5492958">nextLo</a></span>&nbsp;<span class="op" id="5493217">&lt;=</span>&nbsp;<span class="ident" id="5493220"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5493227">.</span><span class="ident" id="5493228">MaxRune</span>&nbsp;<span class="op" id="5493236">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493240">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493293">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493357"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span>&nbsp;<span class="op" id="5493359">=</span>&nbsp;<span class="builtinfunc" id="5493361">append</span><span class="op" id="5493367">(</span><span class="ident" id="5493368"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><span class="op" id="5493369">,</span>&nbsp;<span class="ident" id="5493371"><a href="/regexp/syntax/parse.go.html#5492958">nextLo</a></span><span class="op" id="5493377">,</span>&nbsp;<span class="ident" id="5493379"><a href="/regexp/syntax/parse.go.html#5448052">unicode</a></span><span class="op" id="5493386">.</span><span class="ident" id="5493387">MaxRune</span><span class="op" id="5493394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493400">return</span>&nbsp;<span class="ident" id="5493407"><a href="/regexp/syntax/parse.go.html#5492938">r</a></span><br>
<span class="lineno">1840</span><span class="op" id="5493409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5493412">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5493461">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5493514">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5493564">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5493578">type</span>&nbsp;<span class="ident" id="5493583">ranges</span>&nbsp;<span class="keyword" id="5493590">struct</span>&nbsp;<span class="op" id="5493597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493600">p</span>&nbsp;<span class="op" id="5493602">*</span><span class="op" id="5493603">[</span><span class="op" id="5493604">]</span><span class="builtintype" id="5493605">rune</span><br>
<span class="lineno"></span><span class="op" id="5493610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5493613">func</span>&nbsp;<span class="op" id="5493618">(</span><span class="ident" id="5493619">ra</span>&nbsp;<span class="ident" id="5493622"><a href="/regexp/syntax/parse.go.html#5493583">ranges</a></span><span class="op" id="5493628">)</span>&nbsp;<span class="ident" id="5493630">Less</span><span class="op" id="5493634">(</span><span class="ident" id="5493635">i</span><span class="op" id="5493636">,</span>&nbsp;<span class="ident" id="5493638">j</span>&nbsp;<span class="builtintype" id="5493640">int</span><span class="op" id="5493643">)</span>&nbsp;<span class="builtintype" id="5493645">bool</span>&nbsp;<span class="op" id="5493650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493653">p</span>&nbsp;<span class="op" id="5493655">:=</span>&nbsp;<span class="op" id="5493658">*</span><span class="ident" id="5493659"><a href="/regexp/syntax/parse.go.html#5493619">ra</a></span><span class="op" id="5493661">.</span><span class="ident" id="5493662">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493665"><a href="/regexp/syntax/parse.go.html#5493635">i</a></span>&nbsp;<span class="op" id="5493667">*=</span>&nbsp;<span class="num" id="5493670">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493673"><a href="/regexp/syntax/parse.go.html#5493638">j</a></span>&nbsp;<span class="op" id="5493675">*=</span>&nbsp;<span class="num" id="5493678">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493681">return</span>&nbsp;<span class="ident" id="5493688"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493689">[</span><span class="ident" id="5493690"><a href="/regexp/syntax/parse.go.html#5493635">i</a></span><span class="op" id="5493691">]</span>&nbsp;<span class="op" id="5493693">&lt;</span>&nbsp;<span class="ident" id="5493695"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493696">[</span><span class="ident" id="5493697"><a href="/regexp/syntax/parse.go.html#5493638">j</a></span><span class="op" id="5493698">]</span>&nbsp;<span class="op" id="5493700">||</span>&nbsp;<span class="ident" id="5493703"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493704">[</span><span class="ident" id="5493705"><a href="/regexp/syntax/parse.go.html#5493635">i</a></span><span class="op" id="5493706">]</span>&nbsp;<span class="op" id="5493708">==</span>&nbsp;<span class="ident" id="5493711"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493712">[</span><span class="ident" id="5493713"><a href="/regexp/syntax/parse.go.html#5493638">j</a></span><span class="op" id="5493714">]</span>&nbsp;<span class="op" id="5493716">&amp;&amp;</span>&nbsp;<span class="ident" id="5493719"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493720">[</span><span class="ident" id="5493721"><a href="/regexp/syntax/parse.go.html#5493635">i</a></span><span class="op" id="5493722">+</span><span class="num" id="5493723">1</span><span class="op" id="5493724">]</span>&nbsp;<span class="op" id="5493726">&gt;</span>&nbsp;<span class="ident" id="5493728"><a href="/regexp/syntax/parse.go.html#5493653">p</a></span><span class="op" id="5493729">[</span><span class="ident" id="5493730"><a href="/regexp/syntax/parse.go.html#5493638">j</a></span><span class="op" id="5493731">+</span><span class="num" id="5493732">1</span><span class="op" id="5493733">]</span><br>
<span class="lineno">1855</span><span class="op" id="5493735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5493738">func</span>&nbsp;<span class="op" id="5493743">(</span><span class="ident" id="5493744">ra</span>&nbsp;<span class="ident" id="5493747"><a href="/regexp/syntax/parse.go.html#5493583">ranges</a></span><span class="op" id="5493753">)</span>&nbsp;<span class="ident" id="5493755">Len</span><span class="op" id="5493758">(</span><span class="op" id="5493759">)</span>&nbsp;<span class="builtintype" id="5493761">int</span>&nbsp;<span class="op" id="5493765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493768">return</span>&nbsp;<span class="builtinfunc" id="5493775">len</span><span class="op" id="5493778">(</span><span class="op" id="5493779">*</span><span class="ident" id="5493780"><a href="/regexp/syntax/parse.go.html#5493744">ra</a></span><span class="op" id="5493782">.</span><span class="ident" id="5493783">p</span><span class="op" id="5493784">)</span>&nbsp;<span class="op" id="5493786">/</span>&nbsp;<span class="num" id="5493788">2</span><br>
<span class="lineno"></span><span class="op" id="5493790">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5493793">func</span>&nbsp;<span class="op" id="5493798">(</span><span class="ident" id="5493799">ra</span>&nbsp;<span class="ident" id="5493802"><a href="/regexp/syntax/parse.go.html#5493583">ranges</a></span><span class="op" id="5493808">)</span>&nbsp;<span class="ident" id="5493810">Swap</span><span class="op" id="5493814">(</span><span class="ident" id="5493815">i</span><span class="op" id="5493816">,</span>&nbsp;<span class="ident" id="5493818">j</span>&nbsp;<span class="builtintype" id="5493820">int</span><span class="op" id="5493823">)</span>&nbsp;<span class="op" id="5493825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493828">p</span>&nbsp;<span class="op" id="5493830">:=</span>&nbsp;<span class="op" id="5493833">*</span><span class="ident" id="5493834"><a href="/regexp/syntax/parse.go.html#5493799">ra</a></span><span class="op" id="5493836">.</span><span class="ident" id="5493837">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493840"><a href="/regexp/syntax/parse.go.html#5493815">i</a></span>&nbsp;<span class="op" id="5493842">*=</span>&nbsp;<span class="num" id="5493845">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493848"><a href="/regexp/syntax/parse.go.html#5493818">j</a></span>&nbsp;<span class="op" id="5493850">*=</span>&nbsp;<span class="num" id="5493853">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493856"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493857">[</span><span class="ident" id="5493858"><a href="/regexp/syntax/parse.go.html#5493815">i</a></span><span class="op" id="5493859">]</span><span class="op" id="5493860">,</span>&nbsp;<span class="ident" id="5493862"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493863">[</span><span class="ident" id="5493864"><a href="/regexp/syntax/parse.go.html#5493815">i</a></span><span class="op" id="5493865">+</span><span class="num" id="5493866">1</span><span class="op" id="5493867">]</span><span class="op" id="5493868">,</span>&nbsp;<span class="ident" id="5493870"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493871">[</span><span class="ident" id="5493872"><a href="/regexp/syntax/parse.go.html#5493818">j</a></span><span class="op" id="5493873">]</span><span class="op" id="5493874">,</span>&nbsp;<span class="ident" id="5493876"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493877">[</span><span class="ident" id="5493878"><a href="/regexp/syntax/parse.go.html#5493818">j</a></span><span class="op" id="5493879">+</span><span class="num" id="5493880">1</span><span class="op" id="5493881">]</span>&nbsp;<span class="op" id="5493883">=</span>&nbsp;<span class="ident" id="5493885"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493886">[</span><span class="ident" id="5493887"><a href="/regexp/syntax/parse.go.html#5493818">j</a></span><span class="op" id="5493888">]</span><span class="op" id="5493889">,</span>&nbsp;<span class="ident" id="5493891"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493892">[</span><span class="ident" id="5493893"><a href="/regexp/syntax/parse.go.html#5493818">j</a></span><span class="op" id="5493894">+</span><span class="num" id="5493895">1</span><span class="op" id="5493896">]</span><span class="op" id="5493897">,</span>&nbsp;<span class="ident" id="5493899"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493900">[</span><span class="ident" id="5493901"><a href="/regexp/syntax/parse.go.html#5493815">i</a></span><span class="op" id="5493902">]</span><span class="op" id="5493903">,</span>&nbsp;<span class="ident" id="5493905"><a href="/regexp/syntax/parse.go.html#5493828">p</a></span><span class="op" id="5493906">[</span><span class="ident" id="5493907"><a href="/regexp/syntax/parse.go.html#5493815">i</a></span><span class="op" id="5493908">+</span><span class="num" id="5493909">1</span><span class="op" id="5493910">]</span><br>
<span class="lineno"></span><span class="op" id="5493912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5493915">func</span>&nbsp;<span class="ident" id="5493920">checkUTF8</span><span class="op" id="5493929">(</span><span class="ident" id="5493930">s</span>&nbsp;<span class="builtintype" id="5493932">string</span><span class="op" id="5493938">)</span>&nbsp;<span class="builtintype" id="5493940">error</span>&nbsp;<span class="op" id="5493946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493949">for</span>&nbsp;<span class="ident" id="5493953"><a href="/regexp/syntax/parse.go.html#5493930">s</a></span>&nbsp;<span class="op" id="5493955">!=</span>&nbsp;<span class="string" id="5493958">&#34;&#34;</span>&nbsp;<span class="op" id="5493961">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5493965">rune</span><span class="op" id="5493969">,</span>&nbsp;<span class="ident" id="5493971">size</span>&nbsp;<span class="op" id="5493976">:=</span>&nbsp;<span class="ident" id="5493979"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5493983">.</span><span class="ident" id="5493984">DecodeRuneInString</span><span class="op" id="5494002">(</span><span class="ident" id="5494003"><a href="/regexp/syntax/parse.go.html#5493930">s</a></span><span class="op" id="5494004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494008">if</span>&nbsp;<span class="builtintype" id="5494011"><a href="/regexp/syntax/parse.go.html#5493965">rune</a></span>&nbsp;<span class="op" id="5494016">==</span>&nbsp;<span class="ident" id="5494019"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5494023">.</span><span class="ident" id="5494024">RuneError</span>&nbsp;<span class="op" id="5494034">&amp;&amp;</span>&nbsp;<span class="ident" id="5494037"><a href="/regexp/syntax/parse.go.html#5493971">size</a></span>&nbsp;<span class="op" id="5494042">==</span>&nbsp;<span class="num" id="5494045">1</span>&nbsp;<span class="op" id="5494047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494052">return</span>&nbsp;<span class="op" id="5494059">&amp;</span><span class="ident" id="5494060"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5494065">{</span><span class="ident" id="5494066">Code</span><span class="op" id="5494070">:</span>&nbsp;<span class="ident" id="5494072"><a href="/regexp/syntax/parse.go.html#5449015">ErrInvalidUTF8</a></span><span class="op" id="5494086">,</span>&nbsp;<span class="ident" id="5494088">Expr</span><span class="op" id="5494092">:</span>&nbsp;<span class="ident" id="5494094"><a href="/regexp/syntax/parse.go.html#5493930">s</a></span><span class="op" id="5494095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494103"><a href="/regexp/syntax/parse.go.html#5493930">s</a></span>&nbsp;<span class="op" id="5494105">=</span>&nbsp;<span class="ident" id="5494107"><a href="/regexp/syntax/parse.go.html#5493930">s</a></span><span class="op" id="5494108">[</span><span class="ident" id="5494109"><a href="/regexp/syntax/parse.go.html#5493971">size</a></span><span class="op" id="5494113">:</span><span class="op" id="5494114">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494120">return</span>&nbsp;<span class="ident" id="5494127">nil</span><br>
<span class="lineno"></span><span class="op" id="5494131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5494134">func</span>&nbsp;<span class="ident" id="5494139">nextRune</span><span class="op" id="5494147">(</span><span class="ident" id="5494148">s</span>&nbsp;<span class="builtintype" id="5494150">string</span><span class="op" id="5494156">)</span>&nbsp;<span class="op" id="5494158">(</span><span class="ident" id="5494159">c</span>&nbsp;<span class="builtintype" id="5494161">rune</span><span class="op" id="5494165">,</span>&nbsp;<span class="ident" id="5494167">t</span>&nbsp;<span class="builtintype" id="5494169">string</span><span class="op" id="5494175">,</span>&nbsp;<span class="ident" id="5494177">err</span>&nbsp;<span class="builtintype" id="5494181">error</span><span class="op" id="5494186">)</span>&nbsp;<span class="op" id="5494188">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494191"><a href="/regexp/syntax/parse.go.html#5494159">c</a></span><span class="op" id="5494192">,</span>&nbsp;<span class="ident" id="5494194">size</span>&nbsp;<span class="op" id="5494199">:=</span>&nbsp;<span class="ident" id="5494202"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5494206">.</span><span class="ident" id="5494207">DecodeRuneInString</span><span class="op" id="5494225">(</span><span class="ident" id="5494226"><a href="/regexp/syntax/parse.go.html#5494148">s</a></span><span class="op" id="5494227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494230">if</span>&nbsp;<span class="ident" id="5494233"><a href="/regexp/syntax/parse.go.html#5494159">c</a></span>&nbsp;<span class="op" id="5494235">==</span>&nbsp;<span class="ident" id="5494238"><a href="/regexp/syntax/parse.go.html#5448063">utf8</a></span><span class="op" id="5494242">.</span><span class="ident" id="5494243">RuneError</span>&nbsp;<span class="op" id="5494253">&amp;&amp;</span>&nbsp;<span class="ident" id="5494256"><a href="/regexp/syntax/parse.go.html#5494194">size</a></span>&nbsp;<span class="op" id="5494261">==</span>&nbsp;<span class="num" id="5494264">1</span>&nbsp;<span class="op" id="5494266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494270">return</span>&nbsp;<span class="num" id="5494277">0</span><span class="op" id="5494278">,</span>&nbsp;<span class="string" id="5494280">&#34;&#34;</span><span class="op" id="5494282">,</span>&nbsp;<span class="op" id="5494284">&amp;</span><span class="ident" id="5494285"><a href="/regexp/syntax/parse.go.html#5448187">Error</a></span><span class="op" id="5494290">{</span><span class="ident" id="5494291">Code</span><span class="op" id="5494295">:</span>&nbsp;<span class="ident" id="5494297"><a href="/regexp/syntax/parse.go.html#5449015">ErrInvalidUTF8</a></span><span class="op" id="5494311">,</span>&nbsp;<span class="ident" id="5494313">Expr</span><span class="op" id="5494317">:</span>&nbsp;<span class="ident" id="5494319"><a href="/regexp/syntax/parse.go.html#5494148">s</a></span><span class="op" id="5494320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494326">return</span>&nbsp;<span class="ident" id="5494333"><a href="/regexp/syntax/parse.go.html#5494159">c</a></span><span class="op" id="5494334">,</span>&nbsp;<span class="ident" id="5494336"><a href="/regexp/syntax/parse.go.html#5494148">s</a></span><span class="op" id="5494337">[</span><span class="ident" id="5494338"><a href="/regexp/syntax/parse.go.html#5494194">size</a></span><span class="op" id="5494342">:</span><span class="op" id="5494343">]</span><span class="op" id="5494344">,</span>&nbsp;<span class="ident" id="5494346">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5494350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5494353">func</span>&nbsp;<span class="ident" id="5494358">isalnum</span><span class="op" id="5494365">(</span><span class="ident" id="5494366">c</span>&nbsp;<span class="builtintype" id="5494368">rune</span><span class="op" id="5494372">)</span>&nbsp;<span class="builtintype" id="5494374">bool</span>&nbsp;<span class="op" id="5494379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494382">return</span>&nbsp;<span class="string" id="5494389">&#39;0&#39;</span>&nbsp;<span class="op" id="5494393">&lt;=</span>&nbsp;<span class="ident" id="5494396"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494398">&amp;&amp;</span>&nbsp;<span class="ident" id="5494401"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494403">&lt;=</span>&nbsp;<span class="string" id="5494406">&#39;9&#39;</span>&nbsp;<span class="op" id="5494410">||</span>&nbsp;<span class="string" id="5494413">&#39;A&#39;</span>&nbsp;<span class="op" id="5494417">&lt;=</span>&nbsp;<span class="ident" id="5494420"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494422">&amp;&amp;</span>&nbsp;<span class="ident" id="5494425"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494427">&lt;=</span>&nbsp;<span class="string" id="5494430">&#39;Z&#39;</span>&nbsp;<span class="op" id="5494434">||</span>&nbsp;<span class="string" id="5494437">&#39;a&#39;</span>&nbsp;<span class="op" id="5494441">&lt;=</span>&nbsp;<span class="ident" id="5494444"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494446">&amp;&amp;</span>&nbsp;<span class="ident" id="5494449"><a href="/regexp/syntax/parse.go.html#5494366">c</a></span>&nbsp;<span class="op" id="5494451">&lt;=</span>&nbsp;<span class="string" id="5494454">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5494458">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5494461">func</span>&nbsp;<span class="ident" id="5494466">unhex</span><span class="op" id="5494471">(</span><span class="ident" id="5494472">c</span>&nbsp;<span class="builtintype" id="5494474">rune</span><span class="op" id="5494478">)</span>&nbsp;<span class="builtintype" id="5494480">rune</span>&nbsp;<span class="op" id="5494485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494488">if</span>&nbsp;<span class="string" id="5494491">&#39;0&#39;</span>&nbsp;<span class="op" id="5494495">&lt;=</span>&nbsp;<span class="ident" id="5494498"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494500">&amp;&amp;</span>&nbsp;<span class="ident" id="5494503"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494505">&lt;=</span>&nbsp;<span class="string" id="5494508">&#39;9&#39;</span>&nbsp;<span class="op" id="5494512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494516">return</span>&nbsp;<span class="ident" id="5494523"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494525">-</span>&nbsp;<span class="string" id="5494527">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494532">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494535">if</span>&nbsp;<span class="string" id="5494538">&#39;a&#39;</span>&nbsp;<span class="op" id="5494542">&lt;=</span>&nbsp;<span class="ident" id="5494545"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494547">&amp;&amp;</span>&nbsp;<span class="ident" id="5494550"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494552">&lt;=</span>&nbsp;<span class="string" id="5494555">&#39;f&#39;</span>&nbsp;<span class="op" id="5494559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494563">return</span>&nbsp;<span class="ident" id="5494570"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494572">-</span>&nbsp;<span class="string" id="5494574">&#39;a&#39;</span>&nbsp;<span class="op" id="5494578">+</span>&nbsp;<span class="num" id="5494580">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494587">if</span>&nbsp;<span class="string" id="5494590">&#39;A&#39;</span>&nbsp;<span class="op" id="5494594">&lt;=</span>&nbsp;<span class="ident" id="5494597"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494599">&amp;&amp;</span>&nbsp;<span class="ident" id="5494602"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494604">&lt;=</span>&nbsp;<span class="string" id="5494607">&#39;F&#39;</span>&nbsp;<span class="op" id="5494611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494615">return</span>&nbsp;<span class="ident" id="5494622"><a href="/regexp/syntax/parse.go.html#5494472">c</a></span>&nbsp;<span class="op" id="5494624">-</span>&nbsp;<span class="string" id="5494626">&#39;A&#39;</span>&nbsp;<span class="op" id="5494630">+</span>&nbsp;<span class="num" id="5494632">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494639">return</span>&nbsp;<span class="op" id="5494646">-</span><span class="num" id="5494647">1</span><br>
<span class="lineno"></span><span class="op" id="5494649">}</span>
</div>
</body>
</html>
