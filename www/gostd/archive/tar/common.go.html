<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5984186">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5984241">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5984295">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5984346">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="5984396">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="5984465">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="5984489">//</span><br>
<span class="lineno"></span><span class="comment" id="5984492">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="5984507">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="5984567">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="5984635">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5984707">package</span>&nbsp;<span class="ident" id="5984715">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5984720">import</span>&nbsp;<span class="op" id="5984727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984730">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984739">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984749">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984756">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984762">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984770">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5984777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984780">const</span>&nbsp;<span class="op" id="5984786">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984789">blockSize</span>&nbsp;<span class="op" id="5984799">=</span>&nbsp;<span class="num" id="5984801">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984807">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984817">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984835">=</span>&nbsp;<span class="string" id="5984837">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984844">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984861">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984879">=</span>&nbsp;<span class="string" id="5984881">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="5984888">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984905">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984923">=</span>&nbsp;<span class="string" id="5984925">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984932">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984946">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984964">=</span>&nbsp;<span class="string" id="5984966">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984973">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984991">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985009">=</span>&nbsp;<span class="string" id="5985011">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985018">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985044">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985062">=</span>&nbsp;<span class="string" id="5985064">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985071">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985093">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985111">=</span>&nbsp;<span class="string" id="5985113">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985120">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985134">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985152">=</span>&nbsp;<span class="string" id="5985154">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985161">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985175">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985193">=</span>&nbsp;<span class="string" id="5985195">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985202">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985215">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985233">=</span>&nbsp;<span class="string" id="5985235">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985242">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985262">TypeXGlobalHeader</span>&nbsp;<span class="op" id="5985280">=</span>&nbsp;<span class="string" id="5985282">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985289">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985316">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5985334">=</span>&nbsp;<span class="string" id="5985336">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985343">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985373">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5985391">=</span>&nbsp;<span class="string" id="5985393">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985400">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985448">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985466">=</span>&nbsp;<span class="string" id="5985468">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985475">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5985490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985493">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="5985550">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5985587">type</span>&nbsp;<span class="ident" id="5985592">Header</span>&nbsp;<span class="keyword" id="5985599">struct</span>&nbsp;<span class="op" id="5985606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985609">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985620">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985630">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985660">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985671">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985681">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985710">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985721">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985731">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985752">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985763">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985773">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985795">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985806">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985816">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985836">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985847">time</span><span class="op" id="5985851">.</span><span class="ident" id="5985852">Time</span>&nbsp;<span class="comment" id="5985857">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985875">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985886">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985896">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985921">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985932">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985942">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985966">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5985977">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985987">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986010">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5986021">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986031">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986055">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5986066">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986076">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986122">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5986133">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986143">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986189">AccessTime</span>&nbsp;<span class="ident" id="5986200">time</span><span class="op" id="5986204">.</span><span class="ident" id="5986205">Time</span>&nbsp;<span class="comment" id="5986210">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986226">ChangeTime</span>&nbsp;<span class="ident" id="5986237">time</span><span class="op" id="5986241">.</span><span class="ident" id="5986242">Time</span>&nbsp;<span class="comment" id="5986247">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986270">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986281">map</span><span class="op" id="5986284">[</span><span class="builtintype" id="5986285">string</span><span class="op" id="5986291">]</span><span class="builtintype" id="5986292">string</span><br>
<span class="lineno"></span><span class="op" id="5986299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5986302">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="5986344">const</span>&nbsp;<span class="op" id="5986350">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986353">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986372">=</span>&nbsp;<span class="num" id="5986374">100</span>&nbsp;<span class="comment" id="5986378">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986430">fileNamePrefixSize</span>&nbsp;<span class="op" id="5986449">=</span>&nbsp;<span class="num" id="5986451">155</span>&nbsp;<span class="comment" id="5986455">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="5986499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5986502">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="5986553">func</span>&nbsp;<span class="op" id="5986558">(</span><span class="ident" id="5986559">h</span>&nbsp;<span class="op" id="5986561">*</span><span class="ident" id="5986562">Header</span><span class="op" id="5986568">)</span>&nbsp;<span class="ident" id="5986570">FileInfo</span><span class="op" id="5986578">(</span><span class="op" id="5986579">)</span>&nbsp;<span class="ident" id="5986581">os</span><span class="op" id="5986583">.</span><span class="ident" id="5986584">FileInfo</span>&nbsp;<span class="op" id="5986593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986596">return</span>&nbsp;<span class="ident" id="5986603">headerFileInfo</span><span class="op" id="5986617">{</span><span class="ident" id="5986618">h</span><span class="op" id="5986619">}</span><br>
<span class="lineno"></span><span class="op" id="5986621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5986624">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5986666">type</span>&nbsp;<span class="ident" id="5986671">headerFileInfo</span>&nbsp;<span class="keyword" id="5986686">struct</span>&nbsp;<span class="op" id="5986693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986696">h</span>&nbsp;<span class="op" id="5986698">*</span><span class="ident" id="5986699">Header</span><br>
<span class="lineno"></span><span class="op" id="5986706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5986709">func</span>&nbsp;<span class="op" id="5986714">(</span><span class="ident" id="5986715">fi</span>&nbsp;<span class="ident" id="5986718">headerFileInfo</span><span class="op" id="5986732">)</span>&nbsp;<span class="ident" id="5986734">Size</span><span class="op" id="5986738">(</span><span class="op" id="5986739">)</span>&nbsp;<span class="ident" id="5986741">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986754">{</span>&nbsp;<span class="keyword" id="5986756">return</span>&nbsp;<span class="ident" id="5986763">fi</span><span class="op" id="5986765">.</span><span class="ident" id="5986766">h</span><span class="op" id="5986767">.</span><span class="ident" id="5986768">Size</span>&nbsp;<span class="op" id="5986773">}</span><br>
<span class="lineno"></span><span class="keyword" id="5986775">func</span>&nbsp;<span class="op" id="5986780">(</span><span class="ident" id="5986781">fi</span>&nbsp;<span class="ident" id="5986784">headerFileInfo</span><span class="op" id="5986798">)</span>&nbsp;<span class="ident" id="5986800">IsDir</span><span class="op" id="5986805">(</span><span class="op" id="5986806">)</span>&nbsp;<span class="builtintype" id="5986808">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986820">{</span>&nbsp;<span class="keyword" id="5986822">return</span>&nbsp;<span class="ident" id="5986829">fi</span><span class="op" id="5986831">.</span><span class="ident" id="5986832">Mode</span><span class="op" id="5986836">(</span><span class="op" id="5986837">)</span><span class="op" id="5986838">.</span><span class="ident" id="5986839">IsDir</span><span class="op" id="5986844">(</span><span class="op" id="5986845">)</span>&nbsp;<span class="op" id="5986847">}</span><br>
<span class="lineno"></span><span class="keyword" id="5986849">func</span>&nbsp;<span class="op" id="5986854">(</span><span class="ident" id="5986855">fi</span>&nbsp;<span class="ident" id="5986858">headerFileInfo</span><span class="op" id="5986872">)</span>&nbsp;<span class="ident" id="5986874">ModTime</span><span class="op" id="5986881">(</span><span class="op" id="5986882">)</span>&nbsp;<span class="ident" id="5986884">time</span><span class="op" id="5986888">.</span><span class="ident" id="5986889">Time</span>&nbsp;<span class="op" id="5986894">{</span>&nbsp;<span class="keyword" id="5986896">return</span>&nbsp;<span class="ident" id="5986903">fi</span><span class="op" id="5986905">.</span><span class="ident" id="5986906">h</span><span class="op" id="5986907">.</span><span class="ident" id="5986908">ModTime</span>&nbsp;<span class="op" id="5986916">}</span><br>
<span class="lineno"></span><span class="keyword" id="5986918">func</span>&nbsp;<span class="op" id="5986923">(</span><span class="ident" id="5986924">fi</span>&nbsp;<span class="ident" id="5986927">headerFileInfo</span><span class="op" id="5986941">)</span>&nbsp;<span class="ident" id="5986943">Sys</span><span class="op" id="5986946">(</span><span class="op" id="5986947">)</span>&nbsp;<span class="keyword" id="5986949">interface</span><span class="op" id="5986958">{</span><span class="op" id="5986959">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5986963">{</span>&nbsp;<span class="keyword" id="5986965">return</span>&nbsp;<span class="ident" id="5986972">fi</span><span class="op" id="5986974">.</span><span class="ident" id="5986975">h</span>&nbsp;<span class="op" id="5986977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5986980">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5987023">func</span>&nbsp;<span class="op" id="5987028">(</span><span class="ident" id="5987029">fi</span>&nbsp;<span class="ident" id="5987032">headerFileInfo</span><span class="op" id="5987046">)</span>&nbsp;<span class="ident" id="5987048">Name</span><span class="op" id="5987052">(</span><span class="op" id="5987053">)</span>&nbsp;<span class="builtintype" id="5987055">string</span>&nbsp;<span class="op" id="5987062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987065">if</span>&nbsp;<span class="ident" id="5987068">fi</span><span class="op" id="5987070">.</span><span class="ident" id="5987071">IsDir</span><span class="op" id="5987076">(</span><span class="op" id="5987077">)</span>&nbsp;<span class="op" id="5987079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987083">return</span>&nbsp;<span class="ident" id="5987090">path</span><span class="op" id="5987094">.</span><span class="ident" id="5987095">Base</span><span class="op" id="5987099">(</span><span class="ident" id="5987100">path</span><span class="op" id="5987104">.</span><span class="ident" id="5987105">Clean</span><span class="op" id="5987110">(</span><span class="ident" id="5987111">fi</span><span class="op" id="5987113">.</span><span class="ident" id="5987114">h</span><span class="op" id="5987115">.</span><span class="ident" id="5987116">Name</span><span class="op" id="5987120">)</span><span class="op" id="5987121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987124">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987127">return</span>&nbsp;<span class="ident" id="5987134">path</span><span class="op" id="5987138">.</span><span class="ident" id="5987139">Base</span><span class="op" id="5987143">(</span><span class="ident" id="5987144">fi</span><span class="op" id="5987146">.</span><span class="ident" id="5987147">h</span><span class="op" id="5987148">.</span><span class="ident" id="5987149">Name</span><span class="op" id="5987153">)</span><br>
<span class="lineno"></span><span class="op" id="5987155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987158">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5987227">func</span>&nbsp;<span class="op" id="5987232">(</span><span class="ident" id="5987233">fi</span>&nbsp;<span class="ident" id="5987236">headerFileInfo</span><span class="op" id="5987250">)</span>&nbsp;<span class="ident" id="5987252">Mode</span><span class="op" id="5987256">(</span><span class="op" id="5987257">)</span>&nbsp;<span class="op" id="5987259">(</span><span class="ident" id="5987260">mode</span>&nbsp;<span class="ident" id="5987265">os</span><span class="op" id="5987267">.</span><span class="ident" id="5987268">FileMode</span><span class="op" id="5987276">)</span>&nbsp;<span class="op" id="5987278">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987281">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987311">mode</span>&nbsp;<span class="op" id="5987316">=</span>&nbsp;<span class="ident" id="5987318">os</span><span class="op" id="5987320">.</span><span class="ident" id="5987321">FileMode</span><span class="op" id="5987329">(</span><span class="ident" id="5987330">fi</span><span class="op" id="5987332">.</span><span class="ident" id="5987333">h</span><span class="op" id="5987334">.</span><span class="ident" id="5987335">Mode</span><span class="op" id="5987339">)</span><span class="op" id="5987340">.</span><span class="ident" id="5987341">Perm</span><span class="op" id="5987345">(</span><span class="op" id="5987346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987350">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987390">if</span>&nbsp;<span class="ident" id="5987393">fi</span><span class="op" id="5987395">.</span><span class="ident" id="5987396">h</span><span class="op" id="5987397">.</span><span class="ident" id="5987398">Mode</span><span class="op" id="5987402">&amp;</span><span class="ident" id="5987403">c_ISUID</span>&nbsp;<span class="op" id="5987411">!=</span>&nbsp;<span class="num" id="5987414">0</span>&nbsp;<span class="op" id="5987416">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987420">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987432">mode</span>&nbsp;<span class="op" id="5987437">|=</span>&nbsp;<span class="ident" id="5987440">os</span><span class="op" id="5987442">.</span><span class="ident" id="5987443">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987458">if</span>&nbsp;<span class="ident" id="5987461">fi</span><span class="op" id="5987463">.</span><span class="ident" id="5987464">h</span><span class="op" id="5987465">.</span><span class="ident" id="5987466">Mode</span><span class="op" id="5987470">&amp;</span><span class="ident" id="5987471">c_ISGID</span>&nbsp;<span class="op" id="5987479">!=</span>&nbsp;<span class="num" id="5987482">0</span>&nbsp;<span class="op" id="5987484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987488">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987500">mode</span>&nbsp;<span class="op" id="5987505">|=</span>&nbsp;<span class="ident" id="5987508">os</span><span class="op" id="5987510">.</span><span class="ident" id="5987511">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987526">if</span>&nbsp;<span class="ident" id="5987529">fi</span><span class="op" id="5987531">.</span><span class="ident" id="5987532">h</span><span class="op" id="5987533">.</span><span class="ident" id="5987534">Mode</span><span class="op" id="5987538">&amp;</span><span class="ident" id="5987539">c_ISVTX</span>&nbsp;<span class="op" id="5987547">!=</span>&nbsp;<span class="num" id="5987550">0</span>&nbsp;<span class="op" id="5987552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987556">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987568">mode</span>&nbsp;<span class="op" id="5987573">|=</span>&nbsp;<span class="ident" id="5987576">os</span><span class="op" id="5987578">.</span><span class="ident" id="5987579">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987595">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987619">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987667">m</span>&nbsp;<span class="op" id="5987669">:=</span>&nbsp;<span class="ident" id="5987672">os</span><span class="op" id="5987674">.</span><span class="ident" id="5987675">FileMode</span><span class="op" id="5987683">(</span><span class="ident" id="5987684">fi</span><span class="op" id="5987686">.</span><span class="ident" id="5987687">h</span><span class="op" id="5987688">.</span><span class="ident" id="5987689">Mode</span><span class="op" id="5987693">)</span>&nbsp;<span class="op" id="5987695">&amp;^</span>&nbsp;<span class="num" id="5987698">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987705">if</span>&nbsp;<span class="ident" id="5987708">m</span>&nbsp;<span class="op" id="5987710">==</span>&nbsp;<span class="ident" id="5987713">c_ISDIR</span>&nbsp;<span class="op" id="5987721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987725">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987740">mode</span>&nbsp;<span class="op" id="5987745">|=</span>&nbsp;<span class="ident" id="5987748">os</span><span class="op" id="5987750">.</span><span class="ident" id="5987751">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987763">if</span>&nbsp;<span class="ident" id="5987766">m</span>&nbsp;<span class="op" id="5987768">==</span>&nbsp;<span class="ident" id="5987771">c_ISFIFO</span>&nbsp;<span class="op" id="5987780">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987784">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987807">mode</span>&nbsp;<span class="op" id="5987812">|=</span>&nbsp;<span class="ident" id="5987815">os</span><span class="op" id="5987817">.</span><span class="ident" id="5987818">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987836">if</span>&nbsp;<span class="ident" id="5987839">m</span>&nbsp;<span class="op" id="5987841">==</span>&nbsp;<span class="ident" id="5987844">c_ISLNK</span>&nbsp;<span class="op" id="5987852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987856">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987875">mode</span>&nbsp;<span class="op" id="5987880">|=</span>&nbsp;<span class="ident" id="5987883">os</span><span class="op" id="5987885">.</span><span class="ident" id="5987886">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987902">if</span>&nbsp;<span class="ident" id="5987905">m</span>&nbsp;<span class="op" id="5987907">==</span>&nbsp;<span class="ident" id="5987910">c_ISBLK</span>&nbsp;<span class="op" id="5987918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987922">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987939">mode</span>&nbsp;<span class="op" id="5987944">|=</span>&nbsp;<span class="ident" id="5987947">os</span><span class="op" id="5987949">.</span><span class="ident" id="5987950">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987965">if</span>&nbsp;<span class="ident" id="5987968">m</span>&nbsp;<span class="op" id="5987970">==</span>&nbsp;<span class="ident" id="5987973">c_ISCHR</span>&nbsp;<span class="op" id="5987981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5987985">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988012">mode</span>&nbsp;<span class="op" id="5988017">|=</span>&nbsp;<span class="ident" id="5988020">os</span><span class="op" id="5988022">.</span><span class="ident" id="5988023">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988036">mode</span>&nbsp;<span class="op" id="5988041">|=</span>&nbsp;<span class="ident" id="5988044">os</span><span class="op" id="5988046">.</span><span class="ident" id="5988047">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988066">if</span>&nbsp;<span class="ident" id="5988069">m</span>&nbsp;<span class="op" id="5988071">==</span>&nbsp;<span class="ident" id="5988074">c_ISSOCK</span>&nbsp;<span class="op" id="5988083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988087">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988111">mode</span>&nbsp;<span class="op" id="5988116">|=</span>&nbsp;<span class="ident" id="5988119">os</span><span class="op" id="5988121">.</span><span class="ident" id="5988122">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988134">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988138">switch</span>&nbsp;<span class="ident" id="5988145">fi</span><span class="op" id="5988147">.</span><span class="ident" id="5988148">h</span><span class="op" id="5988149">.</span><span class="ident" id="5988150">Typeflag</span>&nbsp;<span class="op" id="5988159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988162">case</span>&nbsp;<span class="ident" id="5988167">TypeLink</span><span class="op" id="5988175">,</span>&nbsp;<span class="ident" id="5988177">TypeSymlink</span><span class="op" id="5988188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988192">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988222">mode</span>&nbsp;<span class="op" id="5988227">|=</span>&nbsp;<span class="ident" id="5988230">os</span><span class="op" id="5988232">.</span><span class="ident" id="5988233">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988246">case</span>&nbsp;<span class="ident" id="5988251">TypeChar</span><span class="op" id="5988259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988263">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988290">mode</span>&nbsp;<span class="op" id="5988295">|=</span>&nbsp;<span class="ident" id="5988298">os</span><span class="op" id="5988300">.</span><span class="ident" id="5988301">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988314">mode</span>&nbsp;<span class="op" id="5988319">|=</span>&nbsp;<span class="ident" id="5988322">os</span><span class="op" id="5988324">.</span><span class="ident" id="5988325">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988341">case</span>&nbsp;<span class="ident" id="5988346">TypeBlock</span><span class="op" id="5988355">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988359">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988382">mode</span>&nbsp;<span class="op" id="5988387">|=</span>&nbsp;<span class="ident" id="5988390">os</span><span class="op" id="5988392">.</span><span class="ident" id="5988393">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988405">case</span>&nbsp;<span class="ident" id="5988410">TypeDir</span><span class="op" id="5988417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988421">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988436">mode</span>&nbsp;<span class="op" id="5988441">|=</span>&nbsp;<span class="ident" id="5988444">os</span><span class="op" id="5988446">.</span><span class="ident" id="5988447">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988456">case</span>&nbsp;<span class="ident" id="5988461">TypeFifo</span><span class="op" id="5988469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988473">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988488">mode</span>&nbsp;<span class="op" id="5988493">|=</span>&nbsp;<span class="ident" id="5988496">os</span><span class="op" id="5988498">.</span><span class="ident" id="5988499">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988518">return</span>&nbsp;<span class="ident" id="5988525">mode</span><br>
<span class="lineno"></span><span class="op" id="5988530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988533">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="5988605">var</span>&nbsp;<span class="ident" id="5988609">sysStat</span>&nbsp;<span class="keyword" id="5988617">func</span><span class="op" id="5988621">(</span><span class="ident" id="5988622">fi</span>&nbsp;<span class="ident" id="5988625">os</span><span class="op" id="5988627">.</span><span class="ident" id="5988628">FileInfo</span><span class="op" id="5988636">,</span>&nbsp;<span class="ident" id="5988638">h</span>&nbsp;<span class="op" id="5988640">*</span><span class="ident" id="5988641">Header</span><span class="op" id="5988647">)</span>&nbsp;<span class="builtintype" id="5988649">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5988656">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5988693">const</span>&nbsp;<span class="op" id="5988699">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988702">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="5988711">=</span>&nbsp;<span class="num" id="5988713">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5988721">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988733">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="5988742">=</span>&nbsp;<span class="num" id="5988744">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5988752">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988764">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5988773">=</span>&nbsp;<span class="num" id="5988775">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5988783">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988810">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="5988819">=</span>&nbsp;<span class="num" id="5988821">040000</span>&nbsp;&nbsp;<span class="comment" id="5988829">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988843">c_ISFIFO</span>&nbsp;<span class="op" id="5988852">=</span>&nbsp;<span class="num" id="5988854">010000</span>&nbsp;&nbsp;<span class="comment" id="5988862">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988871">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="5988880">=</span>&nbsp;<span class="num" id="5988882">0100000</span>&nbsp;<span class="comment" id="5988890">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988907">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="5988916">=</span>&nbsp;<span class="num" id="5988918">0120000</span>&nbsp;<span class="comment" id="5988926">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988944">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="5988953">=</span>&nbsp;<span class="num" id="5988955">060000</span>&nbsp;&nbsp;<span class="comment" id="5988963">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988986">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="5988995">=</span>&nbsp;<span class="num" id="5988997">020000</span>&nbsp;&nbsp;<span class="comment" id="5989005">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989032">c_ISSOCK</span>&nbsp;<span class="op" id="5989041">=</span>&nbsp;<span class="num" id="5989043">0140000</span>&nbsp;<span class="comment" id="5989051">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="5989061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5989064">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="5989104">const</span>&nbsp;<span class="op" id="5989110">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989113">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989125">=</span>&nbsp;<span class="string" id="5989127">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989136">paxCharset</span>&nbsp;&nbsp;<span class="op" id="5989148">=</span>&nbsp;<span class="string" id="5989150">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989161">paxComment</span>&nbsp;&nbsp;<span class="op" id="5989173">=</span>&nbsp;<span class="string" id="5989175">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989186">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989198">=</span>&nbsp;<span class="string" id="5989200">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="5989208">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989262">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989274">=</span>&nbsp;<span class="string" id="5989276">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989283">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989295">=</span>&nbsp;<span class="string" id="5989297">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989306">paxLinkpath</span>&nbsp;<span class="op" id="5989318">=</span>&nbsp;<span class="string" id="5989320">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989332">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989344">=</span>&nbsp;<span class="string" id="5989346">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989355">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989367">=</span>&nbsp;<span class="string" id="5989369">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989377">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989389">=</span>&nbsp;<span class="string" id="5989391">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989399">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989411">=</span>&nbsp;<span class="string" id="5989413">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989420">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989432">=</span>&nbsp;<span class="string" id="5989434">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989443">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989455">=</span>&nbsp;<span class="string" id="5989457">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989474">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989486">=</span>&nbsp;<span class="string" id="5989488">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5989491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989494">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="5989558">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="5989636">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5989701">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5989768">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5989839">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5989908">func</span>&nbsp;<span class="ident" id="5989913">FileInfoHeader</span><span class="op" id="5989927">(</span><span class="ident" id="5989928">fi</span>&nbsp;<span class="ident" id="5989931">os</span><span class="op" id="5989933">.</span><span class="ident" id="5989934">FileInfo</span><span class="op" id="5989942">,</span>&nbsp;<span class="ident" id="5989944">link</span>&nbsp;<span class="builtintype" id="5989949">string</span><span class="op" id="5989955">)</span>&nbsp;<span class="op" id="5989957">(</span><span class="op" id="5989958">*</span><span class="ident" id="5989959">Header</span><span class="op" id="5989965">,</span>&nbsp;<span class="builtintype" id="5989967">error</span><span class="op" id="5989972">)</span>&nbsp;<span class="op" id="5989974">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989977">if</span>&nbsp;<span class="ident" id="5989980">fi</span>&nbsp;<span class="op" id="5989983">==</span>&nbsp;<span class="ident" id="5989986">nil</span>&nbsp;<span class="op" id="5989990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989994">return</span>&nbsp;<span class="ident" id="5990001">nil</span><span class="op" id="5990004">,</span>&nbsp;<span class="ident" id="5990006">errors</span><span class="op" id="5990012">.</span><span class="ident" id="5990013">New</span><span class="op" id="5990016">(</span><span class="string" id="5990017">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5990039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990045">fm</span>&nbsp;<span class="op" id="5990048">:=</span>&nbsp;<span class="ident" id="5990051">fi</span><span class="op" id="5990053">.</span><span class="ident" id="5990054">Mode</span><span class="op" id="5990058">(</span><span class="op" id="5990059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990062">h</span>&nbsp;<span class="op" id="5990064">:=</span>&nbsp;<span class="op" id="5990067">&amp;</span><span class="ident" id="5990068">Header</span><span class="op" id="5990074">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990078">Name</span><span class="op" id="5990082">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5990087">fi</span><span class="op" id="5990089">.</span><span class="ident" id="5990090">Name</span><span class="op" id="5990094">(</span><span class="op" id="5990095">)</span><span class="op" id="5990096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990100">ModTime</span><span class="op" id="5990107">:</span>&nbsp;<span class="ident" id="5990109">fi</span><span class="op" id="5990111">.</span><span class="ident" id="5990112">ModTime</span><span class="op" id="5990119">(</span><span class="op" id="5990120">)</span><span class="op" id="5990121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990125">Mode</span><span class="op" id="5990129">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5990134">int64</span><span class="op" id="5990139">(</span><span class="ident" id="5990140">fm</span><span class="op" id="5990142">.</span><span class="ident" id="5990143">Perm</span><span class="op" id="5990147">(</span><span class="op" id="5990148">)</span><span class="op" id="5990149">)</span><span class="op" id="5990150">,</span>&nbsp;<span class="comment" id="5990152">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990191">switch</span>&nbsp;<span class="op" id="5990198">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990201">case</span>&nbsp;<span class="ident" id="5990206">fm</span><span class="op" id="5990208">.</span><span class="ident" id="5990209">IsRegular</span><span class="op" id="5990218">(</span><span class="op" id="5990219">)</span><span class="op" id="5990220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990224">h</span><span class="op" id="5990225">.</span><span class="ident" id="5990226">Mode</span>&nbsp;<span class="op" id="5990231">|=</span>&nbsp;<span class="ident" id="5990234">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990244">h</span><span class="op" id="5990245">.</span><span class="ident" id="5990246">Typeflag</span>&nbsp;<span class="op" id="5990255">=</span>&nbsp;<span class="ident" id="5990257">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990267">h</span><span class="op" id="5990268">.</span><span class="ident" id="5990269">Size</span>&nbsp;<span class="op" id="5990274">=</span>&nbsp;<span class="ident" id="5990276">fi</span><span class="op" id="5990278">.</span><span class="ident" id="5990279">Size</span><span class="op" id="5990283">(</span><span class="op" id="5990284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990287">case</span>&nbsp;<span class="ident" id="5990292">fi</span><span class="op" id="5990294">.</span><span class="ident" id="5990295">IsDir</span><span class="op" id="5990300">(</span><span class="op" id="5990301">)</span><span class="op" id="5990302">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990306">h</span><span class="op" id="5990307">.</span><span class="ident" id="5990308">Typeflag</span>&nbsp;<span class="op" id="5990317">=</span>&nbsp;<span class="ident" id="5990319">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990329">h</span><span class="op" id="5990330">.</span><span class="ident" id="5990331">Mode</span>&nbsp;<span class="op" id="5990336">|=</span>&nbsp;<span class="ident" id="5990339">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990349">h</span><span class="op" id="5990350">.</span><span class="ident" id="5990351">Name</span>&nbsp;<span class="op" id="5990356">+=</span>&nbsp;<span class="string" id="5990359">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990364">case</span>&nbsp;<span class="ident" id="5990369">fm</span><span class="op" id="5990371">&amp;</span><span class="ident" id="5990372">os</span><span class="op" id="5990374">.</span><span class="ident" id="5990375">ModeSymlink</span>&nbsp;<span class="op" id="5990387">!=</span>&nbsp;<span class="num" id="5990390">0</span><span class="op" id="5990391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990395">h</span><span class="op" id="5990396">.</span><span class="ident" id="5990397">Typeflag</span>&nbsp;<span class="op" id="5990406">=</span>&nbsp;<span class="ident" id="5990408">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990422">h</span><span class="op" id="5990423">.</span><span class="ident" id="5990424">Mode</span>&nbsp;<span class="op" id="5990429">|=</span>&nbsp;<span class="ident" id="5990432">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990442">h</span><span class="op" id="5990443">.</span><span class="ident" id="5990444">Linkname</span>&nbsp;<span class="op" id="5990453">=</span>&nbsp;<span class="ident" id="5990455">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990461">case</span>&nbsp;<span class="ident" id="5990466">fm</span><span class="op" id="5990468">&amp;</span><span class="ident" id="5990469">os</span><span class="op" id="5990471">.</span><span class="ident" id="5990472">ModeDevice</span>&nbsp;<span class="op" id="5990483">!=</span>&nbsp;<span class="num" id="5990486">0</span><span class="op" id="5990487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990491">if</span>&nbsp;<span class="ident" id="5990494">fm</span><span class="op" id="5990496">&amp;</span><span class="ident" id="5990497">os</span><span class="op" id="5990499">.</span><span class="ident" id="5990500">ModeCharDevice</span>&nbsp;<span class="op" id="5990515">!=</span>&nbsp;<span class="num" id="5990518">0</span>&nbsp;<span class="op" id="5990520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990525">h</span><span class="op" id="5990526">.</span><span class="ident" id="5990527">Mode</span>&nbsp;<span class="op" id="5990532">|=</span>&nbsp;<span class="ident" id="5990535">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990546">h</span><span class="op" id="5990547">.</span><span class="ident" id="5990548">Typeflag</span>&nbsp;<span class="op" id="5990557">=</span>&nbsp;<span class="ident" id="5990559">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990570">}</span>&nbsp;<span class="keyword" id="5990572">else</span>&nbsp;<span class="op" id="5990577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990582">h</span><span class="op" id="5990583">.</span><span class="ident" id="5990584">Mode</span>&nbsp;<span class="op" id="5990589">|=</span>&nbsp;<span class="ident" id="5990592">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990603">h</span><span class="op" id="5990604">.</span><span class="ident" id="5990605">Typeflag</span>&nbsp;<span class="op" id="5990614">=</span>&nbsp;<span class="ident" id="5990616">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990628">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990631">case</span>&nbsp;<span class="ident" id="5990636">fm</span><span class="op" id="5990638">&amp;</span><span class="ident" id="5990639">os</span><span class="op" id="5990641">.</span><span class="ident" id="5990642">ModeNamedPipe</span>&nbsp;<span class="op" id="5990656">!=</span>&nbsp;<span class="num" id="5990659">0</span><span class="op" id="5990660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990664">h</span><span class="op" id="5990665">.</span><span class="ident" id="5990666">Typeflag</span>&nbsp;<span class="op" id="5990675">=</span>&nbsp;<span class="ident" id="5990677">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990688">h</span><span class="op" id="5990689">.</span><span class="ident" id="5990690">Mode</span>&nbsp;<span class="op" id="5990695">|=</span>&nbsp;<span class="ident" id="5990698">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990708">case</span>&nbsp;<span class="ident" id="5990713">fm</span><span class="op" id="5990715">&amp;</span><span class="ident" id="5990716">os</span><span class="op" id="5990718">.</span><span class="ident" id="5990719">ModeSocket</span>&nbsp;<span class="op" id="5990730">!=</span>&nbsp;<span class="num" id="5990733">0</span><span class="op" id="5990734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990738">h</span><span class="op" id="5990739">.</span><span class="ident" id="5990740">Mode</span>&nbsp;<span class="op" id="5990745">|=</span>&nbsp;<span class="ident" id="5990748">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990758">default</span><span class="op" id="5990765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990769">return</span>&nbsp;<span class="ident" id="5990776">nil</span><span class="op" id="5990779">,</span>&nbsp;<span class="ident" id="5990781">fmt</span><span class="op" id="5990784">.</span><span class="ident" id="5990785">Errorf</span><span class="op" id="5990791">(</span><span class="string" id="5990792">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="5990827">,</span>&nbsp;<span class="ident" id="5990829">fm</span><span class="op" id="5990831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990837">if</span>&nbsp;<span class="ident" id="5990840">fm</span><span class="op" id="5990842">&amp;</span><span class="ident" id="5990843">os</span><span class="op" id="5990845">.</span><span class="ident" id="5990846">ModeSetuid</span>&nbsp;<span class="op" id="5990857">!=</span>&nbsp;<span class="num" id="5990860">0</span>&nbsp;<span class="op" id="5990862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990866">h</span><span class="op" id="5990867">.</span><span class="ident" id="5990868">Mode</span>&nbsp;<span class="op" id="5990873">|=</span>&nbsp;<span class="ident" id="5990876">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990888">if</span>&nbsp;<span class="ident" id="5990891">fm</span><span class="op" id="5990893">&amp;</span><span class="ident" id="5990894">os</span><span class="op" id="5990896">.</span><span class="ident" id="5990897">ModeSetgid</span>&nbsp;<span class="op" id="5990908">!=</span>&nbsp;<span class="num" id="5990911">0</span>&nbsp;<span class="op" id="5990913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990917">h</span><span class="op" id="5990918">.</span><span class="ident" id="5990919">Mode</span>&nbsp;<span class="op" id="5990924">|=</span>&nbsp;<span class="ident" id="5990927">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990939">if</span>&nbsp;<span class="ident" id="5990942">fm</span><span class="op" id="5990944">&amp;</span><span class="ident" id="5990945">os</span><span class="op" id="5990947">.</span><span class="ident" id="5990948">ModeSticky</span>&nbsp;<span class="op" id="5990959">!=</span>&nbsp;<span class="num" id="5990962">0</span>&nbsp;<span class="op" id="5990964">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990968">h</span><span class="op" id="5990969">.</span><span class="ident" id="5990970">Mode</span>&nbsp;<span class="op" id="5990975">|=</span>&nbsp;<span class="ident" id="5990978">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990990">if</span>&nbsp;<span class="ident" id="5990993">sysStat</span>&nbsp;<span class="op" id="5991001">!=</span>&nbsp;<span class="ident" id="5991004">nil</span>&nbsp;<span class="op" id="5991008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991012">return</span>&nbsp;<span class="ident" id="5991019">h</span><span class="op" id="5991020">,</span>&nbsp;<span class="ident" id="5991022">sysStat</span><span class="op" id="5991029">(</span><span class="ident" id="5991030">fi</span><span class="op" id="5991032">,</span>&nbsp;<span class="ident" id="5991034">h</span><span class="op" id="5991035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991038">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991041">return</span>&nbsp;<span class="ident" id="5991048">h</span><span class="op" id="5991049">,</span>&nbsp;<span class="ident" id="5991051">nil</span><br>
<span class="lineno"></span><span class="op" id="5991055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991058">var</span>&nbsp;<span class="ident" id="5991062">zeroBlock</span>&nbsp;<span class="op" id="5991072">=</span>&nbsp;<span class="builtinfunc" id="5991074">make</span><span class="op" id="5991078">(</span><span class="op" id="5991079">[</span><span class="op" id="5991080">]</span><span class="builtintype" id="5991081">byte</span><span class="op" id="5991085">,</span>&nbsp;<span class="ident" id="5991087">blockSize</span><span class="op" id="5991096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5991099">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5991194">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="5991225">func</span>&nbsp;<span class="ident" id="5991230">checksum</span><span class="op" id="5991238">(</span><span class="ident" id="5991239">header</span>&nbsp;<span class="op" id="5991246">[</span><span class="op" id="5991247">]</span><span class="builtintype" id="5991248">byte</span><span class="op" id="5991252">)</span>&nbsp;<span class="op" id="5991254">(</span><span class="ident" id="5991255">unsigned</span>&nbsp;<span class="ident" id="5991264">int64</span><span class="op" id="5991269">,</span>&nbsp;<span class="ident" id="5991271">signed</span>&nbsp;<span class="ident" id="5991278">int64</span><span class="op" id="5991283">)</span>&nbsp;<span class="op" id="5991285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991288">for</span>&nbsp;<span class="ident" id="5991292">i</span>&nbsp;<span class="op" id="5991294">:=</span>&nbsp;<span class="num" id="5991297">0</span><span class="op" id="5991298">;</span>&nbsp;<span class="ident" id="5991300">i</span>&nbsp;<span class="op" id="5991302">&lt;</span>&nbsp;<span class="builtinfunc" id="5991304">len</span><span class="op" id="5991307">(</span><span class="ident" id="5991308">header</span><span class="op" id="5991314">)</span><span class="op" id="5991315">;</span>&nbsp;<span class="ident" id="5991317">i</span><span class="op" id="5991318">++</span>&nbsp;<span class="op" id="5991321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991325">if</span>&nbsp;<span class="ident" id="5991328">i</span>&nbsp;<span class="op" id="5991330">==</span>&nbsp;<span class="num" id="5991333">148</span>&nbsp;<span class="op" id="5991337">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991342">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991432">unsigned</span>&nbsp;<span class="op" id="5991441">+=</span>&nbsp;<span class="string" id="5991444">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5991448">*</span>&nbsp;<span class="num" id="5991450">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991455">signed</span>&nbsp;<span class="op" id="5991462">+=</span>&nbsp;<span class="string" id="5991465">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5991469">*</span>&nbsp;<span class="num" id="5991471">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991476">i</span>&nbsp;<span class="op" id="5991478">+=</span>&nbsp;<span class="num" id="5991481">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991486">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991501">unsigned</span>&nbsp;<span class="op" id="5991510">+=</span>&nbsp;<span class="ident" id="5991513">int64</span><span class="op" id="5991518">(</span><span class="ident" id="5991519">header</span><span class="op" id="5991525">[</span><span class="ident" id="5991526">i</span><span class="op" id="5991527">]</span><span class="op" id="5991528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991532">signed</span>&nbsp;<span class="op" id="5991539">+=</span>&nbsp;<span class="ident" id="5991542">int64</span><span class="op" id="5991547">(</span><span class="builtintype" id="5991548">int8</span><span class="op" id="5991552">(</span><span class="ident" id="5991553">header</span><span class="op" id="5991559">[</span><span class="ident" id="5991560">i</span><span class="op" id="5991561">]</span><span class="op" id="5991562">)</span><span class="op" id="5991563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991569">return</span><br>
<span class="lineno">275</span><span class="op" id="5991576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991579">type</span>&nbsp;<span class="ident" id="5991584">slicer</span>&nbsp;<span class="op" id="5991591">[</span><span class="op" id="5991592">]</span><span class="builtintype" id="5991593">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991599">func</span>&nbsp;<span class="op" id="5991604">(</span><span class="ident" id="5991605">sp</span>&nbsp;<span class="op" id="5991608">*</span><span class="ident" id="5991609">slicer</span><span class="op" id="5991615">)</span>&nbsp;<span class="ident" id="5991617">next</span><span class="op" id="5991621">(</span><span class="ident" id="5991622">n</span>&nbsp;<span class="builtintype" id="5991624">int</span><span class="op" id="5991627">)</span>&nbsp;<span class="op" id="5991629">(</span><span class="ident" id="5991630">b</span>&nbsp;<span class="op" id="5991632">[</span><span class="op" id="5991633">]</span><span class="builtintype" id="5991634">byte</span><span class="op" id="5991638">)</span>&nbsp;<span class="op" id="5991640">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991643">s</span>&nbsp;<span class="op" id="5991645">:=</span>&nbsp;<span class="op" id="5991648">*</span><span class="ident" id="5991649">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991653">b</span><span class="op" id="5991654">,</span>&nbsp;<span class="op" id="5991656">*</span><span class="ident" id="5991657">sp</span>&nbsp;<span class="op" id="5991660">=</span>&nbsp;<span class="ident" id="5991662">s</span><span class="op" id="5991663">[</span><span class="num" id="5991664">0</span><span class="op" id="5991665">:</span><span class="ident" id="5991666">n</span><span class="op" id="5991667">]</span><span class="op" id="5991668">,</span>&nbsp;<span class="ident" id="5991670">s</span><span class="op" id="5991671">[</span><span class="ident" id="5991672">n</span><span class="op" id="5991673">:</span><span class="op" id="5991674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991677">return</span><br>
<span class="lineno"></span><span class="op" id="5991684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5991687">func</span>&nbsp;<span class="ident" id="5991692">isASCII</span><span class="op" id="5991699">(</span><span class="ident" id="5991700">s</span>&nbsp;<span class="builtintype" id="5991702">string</span><span class="op" id="5991708">)</span>&nbsp;<span class="builtintype" id="5991710">bool</span>&nbsp;<span class="op" id="5991715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991718">for</span>&nbsp;<span class="ident" id="5991722">_</span><span class="op" id="5991723">,</span>&nbsp;<span class="ident" id="5991725">c</span>&nbsp;<span class="op" id="5991727">:=</span>&nbsp;<span class="keyword" id="5991730">range</span>&nbsp;<span class="ident" id="5991736">s</span>&nbsp;<span class="op" id="5991738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991742">if</span>&nbsp;<span class="ident" id="5991745">c</span>&nbsp;<span class="op" id="5991747">&gt;=</span>&nbsp;<span class="num" id="5991750">0x80</span>&nbsp;<span class="op" id="5991755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991760">return</span>&nbsp;<span class="builtintype" id="5991767">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991775">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991781">return</span>&nbsp;<span class="builtintype" id="5991788">true</span><br>
<span class="lineno"></span><span class="op" id="5991793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991796">func</span>&nbsp;<span class="ident" id="5991801">toASCII</span><span class="op" id="5991808">(</span><span class="ident" id="5991809">s</span>&nbsp;<span class="builtintype" id="5991811">string</span><span class="op" id="5991817">)</span>&nbsp;<span class="builtintype" id="5991819">string</span>&nbsp;<span class="op" id="5991826">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991829">if</span>&nbsp;<span class="ident" id="5991832">isASCII</span><span class="op" id="5991839">(</span><span class="ident" id="5991840">s</span><span class="op" id="5991841">)</span>&nbsp;<span class="op" id="5991843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991847">return</span>&nbsp;<span class="ident" id="5991854">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991860">var</span>&nbsp;<span class="ident" id="5991864">buf</span>&nbsp;<span class="ident" id="5991868">bytes</span><span class="op" id="5991873">.</span><span class="ident" id="5991874">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991882">for</span>&nbsp;<span class="ident" id="5991886">_</span><span class="op" id="5991887">,</span>&nbsp;<span class="ident" id="5991889">c</span>&nbsp;<span class="op" id="5991891">:=</span>&nbsp;<span class="keyword" id="5991894">range</span>&nbsp;<span class="ident" id="5991900">s</span>&nbsp;<span class="op" id="5991902">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991906">if</span>&nbsp;<span class="ident" id="5991909">c</span>&nbsp;<span class="op" id="5991911">&lt;</span>&nbsp;<span class="num" id="5991913">0x80</span>&nbsp;<span class="op" id="5991918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991923">buf</span><span class="op" id="5991926">.</span><span class="ident" id="5991927">WriteByte</span><span class="op" id="5991936">(</span><span class="builtintype" id="5991937">byte</span><span class="op" id="5991941">(</span><span class="ident" id="5991942">c</span><span class="op" id="5991943">)</span><span class="op" id="5991944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991954">return</span>&nbsp;<span class="ident" id="5991961">buf</span><span class="op" id="5991964">.</span><span class="ident" id="5991965">String</span><span class="op" id="5991971">(</span><span class="op" id="5991972">)</span><br>
<span class="lineno">305</span><span class="op" id="5991974">}</span>
</div>
</body>
</html>
