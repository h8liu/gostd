<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2923387">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2923442">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2923496">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2923547">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2923617">package</span>&nbsp;<span class="ident" id="2923625">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2923634">import</span>&nbsp;<span class="op" id="2923641">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2923644">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2923655">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2923670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2923673">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2923814">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2923877">func</span>&nbsp;<span class="ident" id="2923882">explode</span><span class="op" id="2923889">(</span><span class="ident" id="2923890">s</span>&nbsp;<span class="builtintype" id="2923892">string</span><span class="op" id="2923898">,</span>&nbsp;<span class="ident" id="2923900">n</span>&nbsp;<span class="builtintype" id="2923902">int</span><span class="op" id="2923905">)</span>&nbsp;<span class="op" id="2923907">[</span><span class="op" id="2923908">]</span><span class="builtintype" id="2923909">string</span>&nbsp;<span class="op" id="2923916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923919">if</span>&nbsp;<span class="ident" id="2923922">n</span>&nbsp;<span class="op" id="2923924">==</span>&nbsp;<span class="num" id="2923927">0</span>&nbsp;<span class="op" id="2923929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923933">return</span>&nbsp;<span class="ident" id="2923940">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2923945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2923948">l</span>&nbsp;<span class="op" id="2923950">:=</span>&nbsp;<span class="ident" id="2923953">utf8</span><span class="op" id="2923957">.</span><span class="ident" id="2923958">RuneCountInString</span><span class="op" id="2923975">(</span><span class="ident" id="2923976">s</span><span class="op" id="2923977">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2923980">if</span>&nbsp;<span class="ident" id="2923983">n</span>&nbsp;<span class="op" id="2923985">&lt;=</span>&nbsp;<span class="num" id="2923988">0</span>&nbsp;<span class="op" id="2923990">||</span>&nbsp;<span class="ident" id="2923993">n</span>&nbsp;<span class="op" id="2923995">&gt;</span>&nbsp;<span class="ident" id="2923997">l</span>&nbsp;<span class="op" id="2923999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924003">n</span>&nbsp;<span class="op" id="2924005">=</span>&nbsp;<span class="ident" id="2924007">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924013">a</span>&nbsp;<span class="op" id="2924015">:=</span>&nbsp;<span class="builtinfunc" id="2924018">make</span><span class="op" id="2924022">(</span><span class="op" id="2924023">[</span><span class="op" id="2924024">]</span><span class="builtintype" id="2924025">string</span><span class="op" id="2924031">,</span>&nbsp;<span class="ident" id="2924033">n</span><span class="op" id="2924034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924037">var</span>&nbsp;<span class="ident" id="2924041">size</span>&nbsp;<span class="builtintype" id="2924046">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924051">var</span>&nbsp;<span class="ident" id="2924055">ch</span>&nbsp;<span class="builtintype" id="2924058">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924064">i</span><span class="op" id="2924065">,</span>&nbsp;<span class="ident" id="2924067">cur</span>&nbsp;<span class="op" id="2924071">:=</span>&nbsp;<span class="num" id="2924074">0</span><span class="op" id="2924075">,</span>&nbsp;<span class="num" id="2924077">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924080">for</span>&nbsp;<span class="op" id="2924084">;</span>&nbsp;<span class="ident" id="2924086">i</span><span class="op" id="2924087">+</span><span class="num" id="2924088">1</span>&nbsp;<span class="op" id="2924090">&lt;</span>&nbsp;<span class="ident" id="2924092">n</span><span class="op" id="2924093">;</span>&nbsp;<span class="ident" id="2924095">i</span><span class="op" id="2924096">++</span>&nbsp;<span class="op" id="2924099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924103">ch</span><span class="op" id="2924105">,</span>&nbsp;<span class="ident" id="2924107">size</span>&nbsp;<span class="op" id="2924112">=</span>&nbsp;<span class="ident" id="2924114">utf8</span><span class="op" id="2924118">.</span><span class="ident" id="2924119">DecodeRuneInString</span><span class="op" id="2924137">(</span><span class="ident" id="2924138">s</span><span class="op" id="2924139">[</span><span class="ident" id="2924140">cur</span><span class="op" id="2924143">:</span><span class="op" id="2924144">]</span><span class="op" id="2924145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924149">if</span>&nbsp;<span class="ident" id="2924152">ch</span>&nbsp;<span class="op" id="2924155">==</span>&nbsp;<span class="ident" id="2924158">utf8</span><span class="op" id="2924162">.</span><span class="ident" id="2924163">RuneError</span>&nbsp;<span class="op" id="2924173">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924178">a</span><span class="op" id="2924179">[</span><span class="ident" id="2924180">i</span><span class="op" id="2924181">]</span>&nbsp;<span class="op" id="2924183">=</span>&nbsp;<span class="builtintype" id="2924185">string</span><span class="op" id="2924191">(</span><span class="ident" id="2924192">utf8</span><span class="op" id="2924196">.</span><span class="ident" id="2924197">RuneError</span><span class="op" id="2924206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924210">}</span>&nbsp;<span class="keyword" id="2924212">else</span>&nbsp;<span class="op" id="2924217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924222">a</span><span class="op" id="2924223">[</span><span class="ident" id="2924224">i</span><span class="op" id="2924225">]</span>&nbsp;<span class="op" id="2924227">=</span>&nbsp;<span class="ident" id="2924229">s</span><span class="op" id="2924230">[</span><span class="ident" id="2924231">cur</span>&nbsp;<span class="op" id="2924235">:</span>&nbsp;<span class="ident" id="2924237">cur</span><span class="op" id="2924240">+</span><span class="ident" id="2924241">size</span><span class="op" id="2924245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924253">cur</span>&nbsp;<span class="op" id="2924257">+=</span>&nbsp;<span class="ident" id="2924260">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2924269">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924303">if</span>&nbsp;<span class="ident" id="2924306">cur</span>&nbsp;<span class="op" id="2924310">&lt;</span>&nbsp;<span class="builtinfunc" id="2924312">len</span><span class="op" id="2924315">(</span><span class="ident" id="2924316">s</span><span class="op" id="2924317">)</span>&nbsp;<span class="op" id="2924319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924323">a</span><span class="op" id="2924324">[</span><span class="ident" id="2924325">i</span><span class="op" id="2924326">]</span>&nbsp;<span class="op" id="2924328">=</span>&nbsp;<span class="ident" id="2924330">s</span><span class="op" id="2924331">[</span><span class="ident" id="2924332">cur</span><span class="op" id="2924335">:</span><span class="op" id="2924336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924339">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924342">return</span>&nbsp;<span class="ident" id="2924349">a</span><br>
<span class="lineno"></span><span class="op" id="2924351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2924354">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2924413">const</span>&nbsp;<span class="ident" id="2924419">primeRK</span>&nbsp;<span class="op" id="2924427">=</span>&nbsp;<span class="num" id="2924429">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2924439">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2924502">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2924545">func</span>&nbsp;<span class="ident" id="2924550">hashStr</span><span class="op" id="2924557">(</span><span class="ident" id="2924558">sep</span>&nbsp;<span class="builtintype" id="2924562">string</span><span class="op" id="2924568">)</span>&nbsp;<span class="op" id="2924570">(</span><span class="builtintype" id="2924571">uint32</span><span class="op" id="2924577">,</span>&nbsp;<span class="builtintype" id="2924579">uint32</span><span class="op" id="2924585">)</span>&nbsp;<span class="op" id="2924587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924590">hash</span>&nbsp;<span class="op" id="2924595">:=</span>&nbsp;<span class="builtintype" id="2924598">uint32</span><span class="op" id="2924604">(</span><span class="num" id="2924605">0</span><span class="op" id="2924606">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924609">for</span>&nbsp;<span class="ident" id="2924613">i</span>&nbsp;<span class="op" id="2924615">:=</span>&nbsp;<span class="num" id="2924618">0</span><span class="op" id="2924619">;</span>&nbsp;<span class="ident" id="2924621">i</span>&nbsp;<span class="op" id="2924623">&lt;</span>&nbsp;<span class="builtinfunc" id="2924625">len</span><span class="op" id="2924628">(</span><span class="ident" id="2924629">sep</span><span class="op" id="2924632">)</span><span class="op" id="2924633">;</span>&nbsp;<span class="ident" id="2924635">i</span><span class="op" id="2924636">++</span>&nbsp;<span class="op" id="2924639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924643">hash</span>&nbsp;<span class="op" id="2924648">=</span>&nbsp;<span class="ident" id="2924650">hash</span><span class="op" id="2924654">*</span><span class="ident" id="2924655">primeRK</span>&nbsp;<span class="op" id="2924663">+</span>&nbsp;<span class="builtintype" id="2924665">uint32</span><span class="op" id="2924671">(</span><span class="ident" id="2924672">sep</span><span class="op" id="2924675">[</span><span class="ident" id="2924676">i</span><span class="op" id="2924677">]</span><span class="op" id="2924678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924684">var</span>&nbsp;<span class="ident" id="2924688">pow</span><span class="op" id="2924691">,</span>&nbsp;<span class="ident" id="2924693">sq</span>&nbsp;<span class="builtintype" id="2924696">uint32</span>&nbsp;<span class="op" id="2924703">=</span>&nbsp;<span class="num" id="2924705">1</span><span class="op" id="2924706">,</span>&nbsp;<span class="ident" id="2924708">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924717">for</span>&nbsp;<span class="ident" id="2924721">i</span>&nbsp;<span class="op" id="2924723">:=</span>&nbsp;<span class="builtinfunc" id="2924726">len</span><span class="op" id="2924729">(</span><span class="ident" id="2924730">sep</span><span class="op" id="2924733">)</span><span class="op" id="2924734">;</span>&nbsp;<span class="ident" id="2924736">i</span>&nbsp;<span class="op" id="2924738">&gt;</span>&nbsp;<span class="num" id="2924740">0</span><span class="op" id="2924741">;</span>&nbsp;<span class="ident" id="2924743">i</span>&nbsp;<span class="op" id="2924745">&gt;&gt;=</span>&nbsp;<span class="num" id="2924749">1</span>&nbsp;<span class="op" id="2924751">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924755">if</span>&nbsp;<span class="ident" id="2924758">i</span><span class="op" id="2924759">&amp;</span><span class="num" id="2924760">1</span>&nbsp;<span class="op" id="2924762">!=</span>&nbsp;<span class="num" id="2924765">0</span>&nbsp;<span class="op" id="2924767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924772">pow</span>&nbsp;<span class="op" id="2924776">*=</span>&nbsp;<span class="ident" id="2924779">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2924788">sq</span>&nbsp;<span class="op" id="2924791">*=</span>&nbsp;<span class="ident" id="2924794">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2924798">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2924801">return</span>&nbsp;<span class="ident" id="2924808">hash</span><span class="op" id="2924812">,</span>&nbsp;<span class="ident" id="2924814">pow</span><br>
<span class="lineno"></span><span class="op" id="2924818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2924821">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2924882">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2924952">func</span>&nbsp;<span class="ident" id="2924957">hashStrRev</span><span class="op" id="2924967">(</span><span class="ident" id="2924968">sep</span>&nbsp;<span class="builtintype" id="2924972">string</span><span class="op" id="2924978">)</span>&nbsp;<span class="op" id="2924980">(</span><span class="builtintype" id="2924981">uint32</span><span class="op" id="2924987">,</span>&nbsp;<span class="builtintype" id="2924989">uint32</span><span class="op" id="2924995">)</span>&nbsp;<span class="op" id="2924997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925000">hash</span>&nbsp;<span class="op" id="2925005">:=</span>&nbsp;<span class="builtintype" id="2925008">uint32</span><span class="op" id="2925014">(</span><span class="num" id="2925015">0</span><span class="op" id="2925016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925019">for</span>&nbsp;<span class="ident" id="2925023">i</span>&nbsp;<span class="op" id="2925025">:=</span>&nbsp;<span class="builtinfunc" id="2925028">len</span><span class="op" id="2925031">(</span><span class="ident" id="2925032">sep</span><span class="op" id="2925035">)</span>&nbsp;<span class="op" id="2925037">-</span>&nbsp;<span class="num" id="2925039">1</span><span class="op" id="2925040">;</span>&nbsp;<span class="ident" id="2925042">i</span>&nbsp;<span class="op" id="2925044">&gt;=</span>&nbsp;<span class="num" id="2925047">0</span><span class="op" id="2925048">;</span>&nbsp;<span class="ident" id="2925050">i</span><span class="op" id="2925051">--</span>&nbsp;<span class="op" id="2925054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925058">hash</span>&nbsp;<span class="op" id="2925063">=</span>&nbsp;<span class="ident" id="2925065">hash</span><span class="op" id="2925069">*</span><span class="ident" id="2925070">primeRK</span>&nbsp;<span class="op" id="2925078">+</span>&nbsp;<span class="builtintype" id="2925080">uint32</span><span class="op" id="2925086">(</span><span class="ident" id="2925087">sep</span><span class="op" id="2925090">[</span><span class="ident" id="2925091">i</span><span class="op" id="2925092">]</span><span class="op" id="2925093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925096">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925099">var</span>&nbsp;<span class="ident" id="2925103">pow</span><span class="op" id="2925106">,</span>&nbsp;<span class="ident" id="2925108">sq</span>&nbsp;<span class="builtintype" id="2925111">uint32</span>&nbsp;<span class="op" id="2925118">=</span>&nbsp;<span class="num" id="2925120">1</span><span class="op" id="2925121">,</span>&nbsp;<span class="ident" id="2925123">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925132">for</span>&nbsp;<span class="ident" id="2925136">i</span>&nbsp;<span class="op" id="2925138">:=</span>&nbsp;<span class="builtinfunc" id="2925141">len</span><span class="op" id="2925144">(</span><span class="ident" id="2925145">sep</span><span class="op" id="2925148">)</span><span class="op" id="2925149">;</span>&nbsp;<span class="ident" id="2925151">i</span>&nbsp;<span class="op" id="2925153">&gt;</span>&nbsp;<span class="num" id="2925155">0</span><span class="op" id="2925156">;</span>&nbsp;<span class="ident" id="2925158">i</span>&nbsp;<span class="op" id="2925160">&gt;&gt;=</span>&nbsp;<span class="num" id="2925164">1</span>&nbsp;<span class="op" id="2925166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925170">if</span>&nbsp;<span class="ident" id="2925173">i</span><span class="op" id="2925174">&amp;</span><span class="num" id="2925175">1</span>&nbsp;<span class="op" id="2925177">!=</span>&nbsp;<span class="num" id="2925180">0</span>&nbsp;<span class="op" id="2925182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925187">pow</span>&nbsp;<span class="op" id="2925191">*=</span>&nbsp;<span class="ident" id="2925194">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925199">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925203">sq</span>&nbsp;<span class="op" id="2925206">*=</span>&nbsp;<span class="ident" id="2925209">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925216">return</span>&nbsp;<span class="ident" id="2925223">hash</span><span class="op" id="2925227">,</span>&nbsp;<span class="ident" id="2925229">pow</span><br>
<span class="lineno"></span><span class="op" id="2925233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2925236">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2925305">func</span>&nbsp;<span class="ident" id="2925310">Count</span><span class="op" id="2925315">(</span><span class="ident" id="2925316">s</span><span class="op" id="2925317">,</span>&nbsp;<span class="ident" id="2925319">sep</span>&nbsp;<span class="builtintype" id="2925323">string</span><span class="op" id="2925329">)</span>&nbsp;<span class="builtintype" id="2925331">int</span>&nbsp;<span class="op" id="2925335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925338">n</span>&nbsp;<span class="op" id="2925340">:=</span>&nbsp;<span class="num" id="2925343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2925346">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925364">switch</span>&nbsp;<span class="op" id="2925371">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925374">case</span>&nbsp;<span class="builtinfunc" id="2925379">len</span><span class="op" id="2925382">(</span><span class="ident" id="2925383">sep</span><span class="op" id="2925386">)</span>&nbsp;<span class="op" id="2925388">==</span>&nbsp;<span class="num" id="2925391">0</span><span class="op" id="2925392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925396">return</span>&nbsp;<span class="ident" id="2925403">utf8</span><span class="op" id="2925407">.</span><span class="ident" id="2925408">RuneCountInString</span><span class="op" id="2925425">(</span><span class="ident" id="2925426">s</span><span class="op" id="2925427">)</span>&nbsp;<span class="op" id="2925429">+</span>&nbsp;<span class="num" id="2925431">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925434">case</span>&nbsp;<span class="builtinfunc" id="2925439">len</span><span class="op" id="2925442">(</span><span class="ident" id="2925443">sep</span><span class="op" id="2925446">)</span>&nbsp;<span class="op" id="2925448">==</span>&nbsp;<span class="num" id="2925451">1</span><span class="op" id="2925452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2925456">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925492">c</span>&nbsp;<span class="op" id="2925494">:=</span>&nbsp;<span class="ident" id="2925497">sep</span><span class="op" id="2925500">[</span><span class="num" id="2925501">0</span><span class="op" id="2925502">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925506">for</span>&nbsp;<span class="ident" id="2925510">i</span>&nbsp;<span class="op" id="2925512">:=</span>&nbsp;<span class="num" id="2925515">0</span><span class="op" id="2925516">;</span>&nbsp;<span class="ident" id="2925518">i</span>&nbsp;<span class="op" id="2925520">&lt;</span>&nbsp;<span class="builtinfunc" id="2925522">len</span><span class="op" id="2925525">(</span><span class="ident" id="2925526">s</span><span class="op" id="2925527">)</span><span class="op" id="2925528">;</span>&nbsp;<span class="ident" id="2925530">i</span><span class="op" id="2925531">++</span>&nbsp;<span class="op" id="2925534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925539">if</span>&nbsp;<span class="ident" id="2925542">s</span><span class="op" id="2925543">[</span><span class="ident" id="2925544">i</span><span class="op" id="2925545">]</span>&nbsp;<span class="op" id="2925547">==</span>&nbsp;<span class="ident" id="2925550">c</span>&nbsp;<span class="op" id="2925552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925558">n</span><span class="op" id="2925559">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925569">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925573">return</span>&nbsp;<span class="ident" id="2925580">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925583">case</span>&nbsp;<span class="builtinfunc" id="2925588">len</span><span class="op" id="2925591">(</span><span class="ident" id="2925592">sep</span><span class="op" id="2925595">)</span>&nbsp;<span class="op" id="2925597">&gt;</span>&nbsp;<span class="builtinfunc" id="2925599">len</span><span class="op" id="2925602">(</span><span class="ident" id="2925603">s</span><span class="op" id="2925604">)</span><span class="op" id="2925605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925609">return</span>&nbsp;<span class="num" id="2925616">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925619">case</span>&nbsp;<span class="builtinfunc" id="2925624">len</span><span class="op" id="2925627">(</span><span class="ident" id="2925628">sep</span><span class="op" id="2925631">)</span>&nbsp;<span class="op" id="2925633">==</span>&nbsp;<span class="builtinfunc" id="2925636">len</span><span class="op" id="2925639">(</span><span class="ident" id="2925640">s</span><span class="op" id="2925641">)</span><span class="op" id="2925642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925646">if</span>&nbsp;<span class="ident" id="2925649">sep</span>&nbsp;<span class="op" id="2925653">==</span>&nbsp;<span class="ident" id="2925656">s</span>&nbsp;<span class="op" id="2925658">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925663">return</span>&nbsp;<span class="num" id="2925670">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925678">return</span>&nbsp;<span class="num" id="2925685">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2925691">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925713">hashsep</span><span class="op" id="2925720">,</span>&nbsp;<span class="ident" id="2925722">pow</span>&nbsp;<span class="op" id="2925726">:=</span>&nbsp;<span class="ident" id="2925729">hashStr</span><span class="op" id="2925736">(</span><span class="ident" id="2925737">sep</span><span class="op" id="2925740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925743">h</span>&nbsp;<span class="op" id="2925745">:=</span>&nbsp;<span class="builtintype" id="2925748">uint32</span><span class="op" id="2925754">(</span><span class="num" id="2925755">0</span><span class="op" id="2925756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925759">for</span>&nbsp;<span class="ident" id="2925763">i</span>&nbsp;<span class="op" id="2925765">:=</span>&nbsp;<span class="num" id="2925768">0</span><span class="op" id="2925769">;</span>&nbsp;<span class="ident" id="2925771">i</span>&nbsp;<span class="op" id="2925773">&lt;</span>&nbsp;<span class="builtinfunc" id="2925775">len</span><span class="op" id="2925778">(</span><span class="ident" id="2925779">sep</span><span class="op" id="2925782">)</span><span class="op" id="2925783">;</span>&nbsp;<span class="ident" id="2925785">i</span><span class="op" id="2925786">++</span>&nbsp;<span class="op" id="2925789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925793">h</span>&nbsp;<span class="op" id="2925795">=</span>&nbsp;<span class="ident" id="2925797">h</span><span class="op" id="2925798">*</span><span class="ident" id="2925799">primeRK</span>&nbsp;<span class="op" id="2925807">+</span>&nbsp;<span class="builtintype" id="2925809">uint32</span><span class="op" id="2925815">(</span><span class="ident" id="2925816">s</span><span class="op" id="2925817">[</span><span class="ident" id="2925818">i</span><span class="op" id="2925819">]</span><span class="op" id="2925820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925823">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925826">lastmatch</span>&nbsp;<span class="op" id="2925836">:=</span>&nbsp;<span class="num" id="2925839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925842">if</span>&nbsp;<span class="ident" id="2925845">h</span>&nbsp;<span class="op" id="2925847">==</span>&nbsp;<span class="ident" id="2925850">hashsep</span>&nbsp;<span class="op" id="2925858">&amp;&amp;</span>&nbsp;<span class="ident" id="2925861">s</span><span class="op" id="2925862">[</span><span class="op" id="2925863">:</span><span class="builtinfunc" id="2925864">len</span><span class="op" id="2925867">(</span><span class="ident" id="2925868">sep</span><span class="op" id="2925871">)</span><span class="op" id="2925872">]</span>&nbsp;<span class="op" id="2925874">==</span>&nbsp;<span class="ident" id="2925877">sep</span>&nbsp;<span class="op" id="2925881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925885">n</span><span class="op" id="2925886">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925891">lastmatch</span>&nbsp;<span class="op" id="2925901">=</span>&nbsp;<span class="builtinfunc" id="2925903">len</span><span class="op" id="2925906">(</span><span class="ident" id="2925907">sep</span><span class="op" id="2925910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2925913">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2925916">for</span>&nbsp;<span class="ident" id="2925920">i</span>&nbsp;<span class="op" id="2925922">:=</span>&nbsp;<span class="builtinfunc" id="2925925">len</span><span class="op" id="2925928">(</span><span class="ident" id="2925929">sep</span><span class="op" id="2925932">)</span><span class="op" id="2925933">;</span>&nbsp;<span class="ident" id="2925935">i</span>&nbsp;<span class="op" id="2925937">&lt;</span>&nbsp;<span class="builtinfunc" id="2925939">len</span><span class="op" id="2925942">(</span><span class="ident" id="2925943">s</span><span class="op" id="2925944">)</span><span class="op" id="2925945">;</span>&nbsp;<span class="op" id="2925947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925951">h</span>&nbsp;<span class="op" id="2925953">*=</span>&nbsp;<span class="ident" id="2925956">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925966">h</span>&nbsp;<span class="op" id="2925968">+=</span>&nbsp;<span class="builtintype" id="2925971">uint32</span><span class="op" id="2925977">(</span><span class="ident" id="2925978">s</span><span class="op" id="2925979">[</span><span class="ident" id="2925980">i</span><span class="op" id="2925981">]</span><span class="op" id="2925982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2925986">h</span>&nbsp;<span class="op" id="2925988">-=</span>&nbsp;<span class="ident" id="2925991">pow</span>&nbsp;<span class="op" id="2925995">*</span>&nbsp;<span class="builtintype" id="2925997">uint32</span><span class="op" id="2926003">(</span><span class="ident" id="2926004">s</span><span class="op" id="2926005">[</span><span class="ident" id="2926006">i</span><span class="op" id="2926007">-</span><span class="builtinfunc" id="2926008">len</span><span class="op" id="2926011">(</span><span class="ident" id="2926012">sep</span><span class="op" id="2926015">)</span><span class="op" id="2926016">]</span><span class="op" id="2926017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926021">i</span><span class="op" id="2926022">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926027">if</span>&nbsp;<span class="ident" id="2926030">h</span>&nbsp;<span class="op" id="2926032">==</span>&nbsp;<span class="ident" id="2926035">hashsep</span>&nbsp;<span class="op" id="2926043">&amp;&amp;</span>&nbsp;<span class="ident" id="2926046">lastmatch</span>&nbsp;<span class="op" id="2926056">&lt;=</span>&nbsp;<span class="ident" id="2926059">i</span><span class="op" id="2926060">-</span><span class="builtinfunc" id="2926061">len</span><span class="op" id="2926064">(</span><span class="ident" id="2926065">sep</span><span class="op" id="2926068">)</span>&nbsp;<span class="op" id="2926070">&amp;&amp;</span>&nbsp;<span class="ident" id="2926073">s</span><span class="op" id="2926074">[</span><span class="ident" id="2926075">i</span><span class="op" id="2926076">-</span><span class="builtinfunc" id="2926077">len</span><span class="op" id="2926080">(</span><span class="ident" id="2926081">sep</span><span class="op" id="2926084">)</span><span class="op" id="2926085">:</span><span class="ident" id="2926086">i</span><span class="op" id="2926087">]</span>&nbsp;<span class="op" id="2926089">==</span>&nbsp;<span class="ident" id="2926092">sep</span>&nbsp;<span class="op" id="2926096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926101">n</span><span class="op" id="2926102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926108">lastmatch</span>&nbsp;<span class="op" id="2926118">=</span>&nbsp;<span class="ident" id="2926120">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2926124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2926127">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926130">return</span>&nbsp;<span class="ident" id="2926137">n</span><br>
<span class="lineno"></span><span class="op" id="2926139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926142">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2926190">func</span>&nbsp;<span class="ident" id="2926195">Contains</span><span class="op" id="2926203">(</span><span class="ident" id="2926204">s</span><span class="op" id="2926205">,</span>&nbsp;<span class="ident" id="2926207">substr</span>&nbsp;<span class="builtintype" id="2926214">string</span><span class="op" id="2926220">)</span>&nbsp;<span class="builtintype" id="2926222">bool</span>&nbsp;<span class="op" id="2926227">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926230">return</span>&nbsp;<span class="ident" id="2926237">Index</span><span class="op" id="2926242">(</span><span class="ident" id="2926243">s</span><span class="op" id="2926244">,</span>&nbsp;<span class="ident" id="2926246">substr</span><span class="op" id="2926252">)</span>&nbsp;<span class="op" id="2926254">&gt;=</span>&nbsp;<span class="num" id="2926257">0</span><br>
<span class="lineno"></span><span class="op" id="2926259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926262">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2926340">func</span>&nbsp;<span class="ident" id="2926345">ContainsAny</span><span class="op" id="2926356">(</span><span class="ident" id="2926357">s</span><span class="op" id="2926358">,</span>&nbsp;<span class="ident" id="2926360">chars</span>&nbsp;<span class="builtintype" id="2926366">string</span><span class="op" id="2926372">)</span>&nbsp;<span class="builtintype" id="2926374">bool</span>&nbsp;<span class="op" id="2926379">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926382">return</span>&nbsp;<span class="ident" id="2926389">IndexAny</span><span class="op" id="2926397">(</span><span class="ident" id="2926398">s</span><span class="op" id="2926399">,</span>&nbsp;<span class="ident" id="2926401">chars</span><span class="op" id="2926406">)</span>&nbsp;<span class="op" id="2926408">&gt;=</span>&nbsp;<span class="num" id="2926411">0</span><br>
<span class="lineno"></span><span class="op" id="2926413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926416">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2926486">func</span>&nbsp;<span class="ident" id="2926491">ContainsRune</span><span class="op" id="2926503">(</span><span class="ident" id="2926504">s</span>&nbsp;<span class="builtintype" id="2926506">string</span><span class="op" id="2926512">,</span>&nbsp;<span class="ident" id="2926514">r</span>&nbsp;<span class="builtintype" id="2926516">rune</span><span class="op" id="2926520">)</span>&nbsp;<span class="builtintype" id="2926522">bool</span>&nbsp;<span class="op" id="2926527">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926530">return</span>&nbsp;<span class="ident" id="2926537">IndexRune</span><span class="op" id="2926546">(</span><span class="ident" id="2926547">s</span><span class="op" id="2926548">,</span>&nbsp;<span class="ident" id="2926550">r</span><span class="op" id="2926551">)</span>&nbsp;<span class="op" id="2926553">&gt;=</span>&nbsp;<span class="num" id="2926556">0</span><br>
<span class="lineno"></span><span class="op" id="2926558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926561">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2926657">func</span>&nbsp;<span class="ident" id="2926662">Index</span><span class="op" id="2926667">(</span><span class="ident" id="2926668">s</span><span class="op" id="2926669">,</span>&nbsp;<span class="ident" id="2926671">sep</span>&nbsp;<span class="builtintype" id="2926675">string</span><span class="op" id="2926681">)</span>&nbsp;<span class="builtintype" id="2926683">int</span>&nbsp;<span class="op" id="2926687">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926690">n</span>&nbsp;<span class="op" id="2926692">:=</span>&nbsp;<span class="builtinfunc" id="2926695">len</span><span class="op" id="2926698">(</span><span class="ident" id="2926699">sep</span><span class="op" id="2926702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926705">switch</span>&nbsp;<span class="op" id="2926712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926715">case</span>&nbsp;<span class="ident" id="2926720">n</span>&nbsp;<span class="op" id="2926722">==</span>&nbsp;<span class="num" id="2926725">0</span><span class="op" id="2926726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926730">return</span>&nbsp;<span class="num" id="2926737">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926740">case</span>&nbsp;<span class="ident" id="2926745">n</span>&nbsp;<span class="op" id="2926747">==</span>&nbsp;<span class="num" id="2926750">1</span><span class="op" id="2926751">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926755">return</span>&nbsp;<span class="ident" id="2926762">IndexByte</span><span class="op" id="2926771">(</span><span class="ident" id="2926772">s</span><span class="op" id="2926773">,</span>&nbsp;<span class="ident" id="2926775">sep</span><span class="op" id="2926778">[</span><span class="num" id="2926779">0</span><span class="op" id="2926780">]</span><span class="op" id="2926781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926784">case</span>&nbsp;<span class="ident" id="2926789">n</span>&nbsp;<span class="op" id="2926791">==</span>&nbsp;<span class="builtinfunc" id="2926794">len</span><span class="op" id="2926797">(</span><span class="ident" id="2926798">s</span><span class="op" id="2926799">)</span><span class="op" id="2926800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926804">if</span>&nbsp;<span class="ident" id="2926807">sep</span>&nbsp;<span class="op" id="2926811">==</span>&nbsp;<span class="ident" id="2926814">s</span>&nbsp;<span class="op" id="2926816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926821">return</span>&nbsp;<span class="num" id="2926828">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2926832">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926836">return</span>&nbsp;<span class="op" id="2926843">-</span><span class="num" id="2926844">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926847">case</span>&nbsp;<span class="ident" id="2926852">n</span>&nbsp;<span class="op" id="2926854">&gt;</span>&nbsp;<span class="builtinfunc" id="2926856">len</span><span class="op" id="2926859">(</span><span class="ident" id="2926860">s</span><span class="op" id="2926861">)</span><span class="op" id="2926862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926866">return</span>&nbsp;<span class="op" id="2926873">-</span><span class="num" id="2926874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2926877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926880">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926902">hashsep</span><span class="op" id="2926909">,</span>&nbsp;<span class="ident" id="2926911">pow</span>&nbsp;<span class="op" id="2926915">:=</span>&nbsp;<span class="ident" id="2926918">hashStr</span><span class="op" id="2926925">(</span><span class="ident" id="2926926">sep</span><span class="op" id="2926929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926932">var</span>&nbsp;<span class="ident" id="2926936">h</span>&nbsp;<span class="builtintype" id="2926938">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2926946">for</span>&nbsp;<span class="ident" id="2926950">i</span>&nbsp;<span class="op" id="2926952">:=</span>&nbsp;<span class="num" id="2926955">0</span><span class="op" id="2926956">;</span>&nbsp;<span class="ident" id="2926958">i</span>&nbsp;<span class="op" id="2926960">&lt;</span>&nbsp;<span class="ident" id="2926962">n</span><span class="op" id="2926963">;</span>&nbsp;<span class="ident" id="2926965">i</span><span class="op" id="2926966">++</span>&nbsp;<span class="op" id="2926969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926973">h</span>&nbsp;<span class="op" id="2926975">=</span>&nbsp;<span class="ident" id="2926977">h</span><span class="op" id="2926978">*</span><span class="ident" id="2926979">primeRK</span>&nbsp;<span class="op" id="2926987">+</span>&nbsp;<span class="builtintype" id="2926989">uint32</span><span class="op" id="2926995">(</span><span class="ident" id="2926996">s</span><span class="op" id="2926997">[</span><span class="ident" id="2926998">i</span><span class="op" id="2926999">]</span><span class="op" id="2927000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927003">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927006">if</span>&nbsp;<span class="ident" id="2927009">h</span>&nbsp;<span class="op" id="2927011">==</span>&nbsp;<span class="ident" id="2927014">hashsep</span>&nbsp;<span class="op" id="2927022">&amp;&amp;</span>&nbsp;<span class="ident" id="2927025">s</span><span class="op" id="2927026">[</span><span class="op" id="2927027">:</span><span class="ident" id="2927028">n</span><span class="op" id="2927029">]</span>&nbsp;<span class="op" id="2927031">==</span>&nbsp;<span class="ident" id="2927034">sep</span>&nbsp;<span class="op" id="2927038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927042">return</span>&nbsp;<span class="num" id="2927049">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927055">for</span>&nbsp;<span class="ident" id="2927059">i</span>&nbsp;<span class="op" id="2927061">:=</span>&nbsp;<span class="ident" id="2927064">n</span><span class="op" id="2927065">;</span>&nbsp;<span class="ident" id="2927067">i</span>&nbsp;<span class="op" id="2927069">&lt;</span>&nbsp;<span class="builtinfunc" id="2927071">len</span><span class="op" id="2927074">(</span><span class="ident" id="2927075">s</span><span class="op" id="2927076">)</span><span class="op" id="2927077">;</span>&nbsp;<span class="op" id="2927079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927083">h</span>&nbsp;<span class="op" id="2927085">*=</span>&nbsp;<span class="ident" id="2927088">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927098">h</span>&nbsp;<span class="op" id="2927100">+=</span>&nbsp;<span class="builtintype" id="2927103">uint32</span><span class="op" id="2927109">(</span><span class="ident" id="2927110">s</span><span class="op" id="2927111">[</span><span class="ident" id="2927112">i</span><span class="op" id="2927113">]</span><span class="op" id="2927114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927118">h</span>&nbsp;<span class="op" id="2927120">-=</span>&nbsp;<span class="ident" id="2927123">pow</span>&nbsp;<span class="op" id="2927127">*</span>&nbsp;<span class="builtintype" id="2927129">uint32</span><span class="op" id="2927135">(</span><span class="ident" id="2927136">s</span><span class="op" id="2927137">[</span><span class="ident" id="2927138">i</span><span class="op" id="2927139">-</span><span class="ident" id="2927140">n</span><span class="op" id="2927141">]</span><span class="op" id="2927142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927146">i</span><span class="op" id="2927147">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927152">if</span>&nbsp;<span class="ident" id="2927155">h</span>&nbsp;<span class="op" id="2927157">==</span>&nbsp;<span class="ident" id="2927160">hashsep</span>&nbsp;<span class="op" id="2927168">&amp;&amp;</span>&nbsp;<span class="ident" id="2927171">s</span><span class="op" id="2927172">[</span><span class="ident" id="2927173">i</span><span class="op" id="2927174">-</span><span class="ident" id="2927175">n</span><span class="op" id="2927176">:</span><span class="ident" id="2927177">i</span><span class="op" id="2927178">]</span>&nbsp;<span class="op" id="2927180">==</span>&nbsp;<span class="ident" id="2927183">sep</span>&nbsp;<span class="op" id="2927187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927192">return</span>&nbsp;<span class="ident" id="2927199">i</span>&nbsp;<span class="op" id="2927201">-</span>&nbsp;<span class="ident" id="2927203">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927213">return</span>&nbsp;<span class="op" id="2927220">-</span><span class="num" id="2927221">1</span><br>
<span class="lineno"></span><span class="op" id="2927223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2927226">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2927325">func</span>&nbsp;<span class="ident" id="2927330">LastIndex</span><span class="op" id="2927339">(</span><span class="ident" id="2927340">s</span><span class="op" id="2927341">,</span>&nbsp;<span class="ident" id="2927343">sep</span>&nbsp;<span class="builtintype" id="2927347">string</span><span class="op" id="2927353">)</span>&nbsp;<span class="builtintype" id="2927355">int</span>&nbsp;<span class="op" id="2927359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927362">n</span>&nbsp;<span class="op" id="2927364">:=</span>&nbsp;<span class="builtinfunc" id="2927367">len</span><span class="op" id="2927370">(</span><span class="ident" id="2927371">sep</span><span class="op" id="2927374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927377">switch</span>&nbsp;<span class="op" id="2927384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927387">case</span>&nbsp;<span class="ident" id="2927392">n</span>&nbsp;<span class="op" id="2927394">==</span>&nbsp;<span class="num" id="2927397">0</span><span class="op" id="2927398">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927402">return</span>&nbsp;<span class="builtinfunc" id="2927409">len</span><span class="op" id="2927412">(</span><span class="ident" id="2927413">s</span><span class="op" id="2927414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927417">case</span>&nbsp;<span class="ident" id="2927422">n</span>&nbsp;<span class="op" id="2927424">==</span>&nbsp;<span class="num" id="2927427">1</span><span class="op" id="2927428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2927432">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927468">c</span>&nbsp;<span class="op" id="2927470">:=</span>&nbsp;<span class="ident" id="2927473">sep</span><span class="op" id="2927476">[</span><span class="num" id="2927477">0</span><span class="op" id="2927478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927482">for</span>&nbsp;<span class="ident" id="2927486">i</span>&nbsp;<span class="op" id="2927488">:=</span>&nbsp;<span class="builtinfunc" id="2927491">len</span><span class="op" id="2927494">(</span><span class="ident" id="2927495">s</span><span class="op" id="2927496">)</span>&nbsp;<span class="op" id="2927498">-</span>&nbsp;<span class="num" id="2927500">1</span><span class="op" id="2927501">;</span>&nbsp;<span class="ident" id="2927503">i</span>&nbsp;<span class="op" id="2927505">&gt;=</span>&nbsp;<span class="num" id="2927508">0</span><span class="op" id="2927509">;</span>&nbsp;<span class="ident" id="2927511">i</span><span class="op" id="2927512">--</span>&nbsp;<span class="op" id="2927515">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927520">if</span>&nbsp;<span class="ident" id="2927523">s</span><span class="op" id="2927524">[</span><span class="ident" id="2927525">i</span><span class="op" id="2927526">]</span>&nbsp;<span class="op" id="2927528">==</span>&nbsp;<span class="ident" id="2927531">c</span>&nbsp;<span class="op" id="2927533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927539">return</span>&nbsp;<span class="ident" id="2927546">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927559">return</span>&nbsp;<span class="op" id="2927566">-</span><span class="num" id="2927567">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927570">case</span>&nbsp;<span class="ident" id="2927575">n</span>&nbsp;<span class="op" id="2927577">==</span>&nbsp;<span class="builtinfunc" id="2927580">len</span><span class="op" id="2927583">(</span><span class="ident" id="2927584">s</span><span class="op" id="2927585">)</span><span class="op" id="2927586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927590">if</span>&nbsp;<span class="ident" id="2927593">sep</span>&nbsp;<span class="op" id="2927597">==</span>&nbsp;<span class="ident" id="2927600">s</span>&nbsp;<span class="op" id="2927602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927607">return</span>&nbsp;<span class="num" id="2927614">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927622">return</span>&nbsp;<span class="op" id="2927629">-</span><span class="num" id="2927630">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927633">case</span>&nbsp;<span class="ident" id="2927638">n</span>&nbsp;<span class="op" id="2927640">&gt;</span>&nbsp;<span class="builtinfunc" id="2927642">len</span><span class="op" id="2927645">(</span><span class="ident" id="2927646">s</span><span class="op" id="2927647">)</span><span class="op" id="2927648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927652">return</span>&nbsp;<span class="op" id="2927659">-</span><span class="num" id="2927660">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2927666">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927715">hashsep</span><span class="op" id="2927722">,</span>&nbsp;<span class="ident" id="2927724">pow</span>&nbsp;<span class="op" id="2927728">:=</span>&nbsp;<span class="ident" id="2927731">hashStrRev</span><span class="op" id="2927741">(</span><span class="ident" id="2927742">sep</span><span class="op" id="2927745">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927748">last</span>&nbsp;<span class="op" id="2927753">:=</span>&nbsp;<span class="builtinfunc" id="2927756">len</span><span class="op" id="2927759">(</span><span class="ident" id="2927760">s</span><span class="op" id="2927761">)</span>&nbsp;<span class="op" id="2927763">-</span>&nbsp;<span class="ident" id="2927765">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927768">var</span>&nbsp;<span class="ident" id="2927772">h</span>&nbsp;<span class="builtintype" id="2927774">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927782">for</span>&nbsp;<span class="ident" id="2927786">i</span>&nbsp;<span class="op" id="2927788">:=</span>&nbsp;<span class="builtinfunc" id="2927791">len</span><span class="op" id="2927794">(</span><span class="ident" id="2927795">s</span><span class="op" id="2927796">)</span>&nbsp;<span class="op" id="2927798">-</span>&nbsp;<span class="num" id="2927800">1</span><span class="op" id="2927801">;</span>&nbsp;<span class="ident" id="2927803">i</span>&nbsp;<span class="op" id="2927805">&gt;=</span>&nbsp;<span class="ident" id="2927808">last</span><span class="op" id="2927812">;</span>&nbsp;<span class="ident" id="2927814">i</span><span class="op" id="2927815">--</span>&nbsp;<span class="op" id="2927818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927822">h</span>&nbsp;<span class="op" id="2927824">=</span>&nbsp;<span class="ident" id="2927826">h</span><span class="op" id="2927827">*</span><span class="ident" id="2927828">primeRK</span>&nbsp;<span class="op" id="2927836">+</span>&nbsp;<span class="builtintype" id="2927838">uint32</span><span class="op" id="2927844">(</span><span class="ident" id="2927845">s</span><span class="op" id="2927846">[</span><span class="ident" id="2927847">i</span><span class="op" id="2927848">]</span><span class="op" id="2927849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927852">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927855">if</span>&nbsp;<span class="ident" id="2927858">h</span>&nbsp;<span class="op" id="2927860">==</span>&nbsp;<span class="ident" id="2927863">hashsep</span>&nbsp;<span class="op" id="2927871">&amp;&amp;</span>&nbsp;<span class="ident" id="2927874">s</span><span class="op" id="2927875">[</span><span class="ident" id="2927876">last</span><span class="op" id="2927880">:</span><span class="op" id="2927881">]</span>&nbsp;<span class="op" id="2927883">==</span>&nbsp;<span class="ident" id="2927886">sep</span>&nbsp;<span class="op" id="2927890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927894">return</span>&nbsp;<span class="ident" id="2927901">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2927907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927910">for</span>&nbsp;<span class="ident" id="2927914">i</span>&nbsp;<span class="op" id="2927916">:=</span>&nbsp;<span class="ident" id="2927919">last</span>&nbsp;<span class="op" id="2927924">-</span>&nbsp;<span class="num" id="2927926">1</span><span class="op" id="2927927">;</span>&nbsp;<span class="ident" id="2927929">i</span>&nbsp;<span class="op" id="2927931">&gt;=</span>&nbsp;<span class="num" id="2927934">0</span><span class="op" id="2927935">;</span>&nbsp;<span class="ident" id="2927937">i</span><span class="op" id="2927938">--</span>&nbsp;<span class="op" id="2927941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927945">h</span>&nbsp;<span class="op" id="2927947">*=</span>&nbsp;<span class="ident" id="2927950">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927960">h</span>&nbsp;<span class="op" id="2927962">+=</span>&nbsp;<span class="builtintype" id="2927965">uint32</span><span class="op" id="2927971">(</span><span class="ident" id="2927972">s</span><span class="op" id="2927973">[</span><span class="ident" id="2927974">i</span><span class="op" id="2927975">]</span><span class="op" id="2927976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927980">h</span>&nbsp;<span class="op" id="2927982">-=</span>&nbsp;<span class="ident" id="2927985">pow</span>&nbsp;<span class="op" id="2927989">*</span>&nbsp;<span class="builtintype" id="2927991">uint32</span><span class="op" id="2927997">(</span><span class="ident" id="2927998">s</span><span class="op" id="2927999">[</span><span class="ident" id="2928000">i</span><span class="op" id="2928001">+</span><span class="ident" id="2928002">n</span><span class="op" id="2928003">]</span><span class="op" id="2928004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928008">if</span>&nbsp;<span class="ident" id="2928011">h</span>&nbsp;<span class="op" id="2928013">==</span>&nbsp;<span class="ident" id="2928016">hashsep</span>&nbsp;<span class="op" id="2928024">&amp;&amp;</span>&nbsp;<span class="ident" id="2928027">s</span><span class="op" id="2928028">[</span><span class="ident" id="2928029">i</span><span class="op" id="2928030">:</span><span class="ident" id="2928031">i</span><span class="op" id="2928032">+</span><span class="ident" id="2928033">n</span><span class="op" id="2928034">]</span>&nbsp;<span class="op" id="2928036">==</span>&nbsp;<span class="ident" id="2928039">sep</span>&nbsp;<span class="op" id="2928043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928048">return</span>&nbsp;<span class="ident" id="2928055">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928059">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928065">return</span>&nbsp;<span class="op" id="2928072">-</span><span class="num" id="2928073">1</span><br>
<span class="lineno"></span><span class="op" id="2928075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2928078">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2928157">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2928198">func</span>&nbsp;<span class="ident" id="2928203">IndexRune</span><span class="op" id="2928212">(</span><span class="ident" id="2928213">s</span>&nbsp;<span class="builtintype" id="2928215">string</span><span class="op" id="2928221">,</span>&nbsp;<span class="ident" id="2928223">r</span>&nbsp;<span class="builtintype" id="2928225">rune</span><span class="op" id="2928229">)</span>&nbsp;<span class="builtintype" id="2928231">int</span>&nbsp;<span class="op" id="2928235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928238">switch</span>&nbsp;<span class="op" id="2928245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928248">case</span>&nbsp;<span class="ident" id="2928253">r</span>&nbsp;<span class="op" id="2928255">&lt;</span>&nbsp;<span class="ident" id="2928257">utf8</span><span class="op" id="2928261">.</span><span class="ident" id="2928262">RuneSelf</span><span class="op" id="2928270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928274">return</span>&nbsp;<span class="ident" id="2928281">IndexByte</span><span class="op" id="2928290">(</span><span class="ident" id="2928291">s</span><span class="op" id="2928292">,</span>&nbsp;<span class="builtintype" id="2928294">byte</span><span class="op" id="2928298">(</span><span class="ident" id="2928299">r</span><span class="op" id="2928300">)</span><span class="op" id="2928301">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928304">default</span><span class="op" id="2928311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928315">for</span>&nbsp;<span class="ident" id="2928319">i</span><span class="op" id="2928320">,</span>&nbsp;<span class="ident" id="2928322">c</span>&nbsp;<span class="op" id="2928324">:=</span>&nbsp;<span class="keyword" id="2928327">range</span>&nbsp;<span class="ident" id="2928333">s</span>&nbsp;<span class="op" id="2928335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928340">if</span>&nbsp;<span class="ident" id="2928343">c</span>&nbsp;<span class="op" id="2928345">==</span>&nbsp;<span class="ident" id="2928348">r</span>&nbsp;<span class="op" id="2928350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928356">return</span>&nbsp;<span class="ident" id="2928363">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928368">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928378">return</span>&nbsp;<span class="op" id="2928385">-</span><span class="num" id="2928386">1</span><br>
<span class="lineno"></span><span class="op" id="2928388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2928391">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2928469">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2928548">func</span>&nbsp;<span class="ident" id="2928553">IndexAny</span><span class="op" id="2928561">(</span><span class="ident" id="2928562">s</span><span class="op" id="2928563">,</span>&nbsp;<span class="ident" id="2928565">chars</span>&nbsp;<span class="builtintype" id="2928571">string</span><span class="op" id="2928577">)</span>&nbsp;<span class="builtintype" id="2928579">int</span>&nbsp;<span class="op" id="2928583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928586">if</span>&nbsp;<span class="builtinfunc" id="2928589">len</span><span class="op" id="2928592">(</span><span class="ident" id="2928593">chars</span><span class="op" id="2928598">)</span>&nbsp;<span class="op" id="2928600">&gt;</span>&nbsp;<span class="num" id="2928602">0</span>&nbsp;<span class="op" id="2928604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928608">for</span>&nbsp;<span class="ident" id="2928612">i</span><span class="op" id="2928613">,</span>&nbsp;<span class="ident" id="2928615">c</span>&nbsp;<span class="op" id="2928617">:=</span>&nbsp;<span class="keyword" id="2928620">range</span>&nbsp;<span class="ident" id="2928626">s</span>&nbsp;<span class="op" id="2928628">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928633">for</span>&nbsp;<span class="ident" id="2928637">_</span><span class="op" id="2928638">,</span>&nbsp;<span class="ident" id="2928640">m</span>&nbsp;<span class="op" id="2928642">:=</span>&nbsp;<span class="keyword" id="2928645">range</span>&nbsp;<span class="ident" id="2928651">chars</span>&nbsp;<span class="op" id="2928657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928663">if</span>&nbsp;<span class="ident" id="2928666">c</span>&nbsp;<span class="op" id="2928668">==</span>&nbsp;<span class="ident" id="2928671">m</span>&nbsp;<span class="op" id="2928673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928680">return</span>&nbsp;<span class="ident" id="2928687">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928698">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928708">return</span>&nbsp;<span class="op" id="2928715">-</span><span class="num" id="2928716">1</span><br>
<span class="lineno"></span><span class="op" id="2928718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2928721">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2928796">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2928867">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2928884">func</span>&nbsp;<span class="ident" id="2928889">LastIndexAny</span><span class="op" id="2928901">(</span><span class="ident" id="2928902">s</span><span class="op" id="2928903">,</span>&nbsp;<span class="ident" id="2928905">chars</span>&nbsp;<span class="builtintype" id="2928911">string</span><span class="op" id="2928917">)</span>&nbsp;<span class="builtintype" id="2928919">int</span>&nbsp;<span class="op" id="2928923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928926">if</span>&nbsp;<span class="builtinfunc" id="2928929">len</span><span class="op" id="2928932">(</span><span class="ident" id="2928933">chars</span><span class="op" id="2928938">)</span>&nbsp;<span class="op" id="2928940">&gt;</span>&nbsp;<span class="num" id="2928942">0</span>&nbsp;<span class="op" id="2928944">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928948">for</span>&nbsp;<span class="ident" id="2928952">i</span>&nbsp;<span class="op" id="2928954">:=</span>&nbsp;<span class="builtinfunc" id="2928957">len</span><span class="op" id="2928960">(</span><span class="ident" id="2928961">s</span><span class="op" id="2928962">)</span><span class="op" id="2928963">;</span>&nbsp;<span class="ident" id="2928965">i</span>&nbsp;<span class="op" id="2928967">&gt;</span>&nbsp;<span class="num" id="2928969">0</span><span class="op" id="2928970">;</span>&nbsp;<span class="op" id="2928972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2928977">rune</span><span class="op" id="2928981">,</span>&nbsp;<span class="ident" id="2928983">size</span>&nbsp;<span class="op" id="2928988">:=</span>&nbsp;<span class="ident" id="2928991">utf8</span><span class="op" id="2928995">.</span><span class="ident" id="2928996">DecodeLastRuneInString</span><span class="op" id="2929018">(</span><span class="ident" id="2929019">s</span><span class="op" id="2929020">[</span><span class="num" id="2929021">0</span><span class="op" id="2929022">:</span><span class="ident" id="2929023">i</span><span class="op" id="2929024">]</span><span class="op" id="2929025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929030">i</span>&nbsp;<span class="op" id="2929032">-=</span>&nbsp;<span class="ident" id="2929035">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929043">for</span>&nbsp;<span class="ident" id="2929047">_</span><span class="op" id="2929048">,</span>&nbsp;<span class="ident" id="2929050">m</span>&nbsp;<span class="op" id="2929052">:=</span>&nbsp;<span class="keyword" id="2929055">range</span>&nbsp;<span class="ident" id="2929061">chars</span>&nbsp;<span class="op" id="2929067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929073">if</span>&nbsp;<span class="builtintype" id="2929076">rune</span>&nbsp;<span class="op" id="2929081">==</span>&nbsp;<span class="ident" id="2929084">m</span>&nbsp;<span class="op" id="2929086">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929093">return</span>&nbsp;<span class="ident" id="2929100">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929118">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929121">return</span>&nbsp;<span class="op" id="2929128">-</span><span class="num" id="2929129">1</span><br>
<span class="lineno"></span><span class="op" id="2929131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929134">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2929187">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2929239">func</span>&nbsp;<span class="ident" id="2929244">genSplit</span><span class="op" id="2929252">(</span><span class="ident" id="2929253">s</span><span class="op" id="2929254">,</span>&nbsp;<span class="ident" id="2929256">sep</span>&nbsp;<span class="builtintype" id="2929260">string</span><span class="op" id="2929266">,</span>&nbsp;<span class="ident" id="2929268">sepSave</span><span class="op" id="2929275">,</span>&nbsp;<span class="ident" id="2929277">n</span>&nbsp;<span class="builtintype" id="2929279">int</span><span class="op" id="2929282">)</span>&nbsp;<span class="op" id="2929284">[</span><span class="op" id="2929285">]</span><span class="builtintype" id="2929286">string</span>&nbsp;<span class="op" id="2929293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929296">if</span>&nbsp;<span class="ident" id="2929299">n</span>&nbsp;<span class="op" id="2929301">==</span>&nbsp;<span class="num" id="2929304">0</span>&nbsp;<span class="op" id="2929306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929310">return</span>&nbsp;<span class="ident" id="2929317">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929325">if</span>&nbsp;<span class="ident" id="2929328">sep</span>&nbsp;<span class="op" id="2929332">==</span>&nbsp;<span class="string" id="2929335">&#34;&#34;</span>&nbsp;<span class="op" id="2929338">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929342">return</span>&nbsp;<span class="ident" id="2929349">explode</span><span class="op" id="2929356">(</span><span class="ident" id="2929357">s</span><span class="op" id="2929358">,</span>&nbsp;<span class="ident" id="2929360">n</span><span class="op" id="2929361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929367">if</span>&nbsp;<span class="ident" id="2929370">n</span>&nbsp;<span class="op" id="2929372">&lt;</span>&nbsp;<span class="num" id="2929374">0</span>&nbsp;<span class="op" id="2929376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929380">n</span>&nbsp;<span class="op" id="2929382">=</span>&nbsp;<span class="ident" id="2929384">Count</span><span class="op" id="2929389">(</span><span class="ident" id="2929390">s</span><span class="op" id="2929391">,</span>&nbsp;<span class="ident" id="2929393">sep</span><span class="op" id="2929396">)</span>&nbsp;<span class="op" id="2929398">+</span>&nbsp;<span class="num" id="2929400">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929403">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929406">c</span>&nbsp;<span class="op" id="2929408">:=</span>&nbsp;<span class="ident" id="2929411">sep</span><span class="op" id="2929414">[</span><span class="num" id="2929415">0</span><span class="op" id="2929416">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929419">start</span>&nbsp;<span class="op" id="2929425">:=</span>&nbsp;<span class="num" id="2929428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929431">a</span>&nbsp;<span class="op" id="2929433">:=</span>&nbsp;<span class="builtinfunc" id="2929436">make</span><span class="op" id="2929440">(</span><span class="op" id="2929441">[</span><span class="op" id="2929442">]</span><span class="builtintype" id="2929443">string</span><span class="op" id="2929449">,</span>&nbsp;<span class="ident" id="2929451">n</span><span class="op" id="2929452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929455">na</span>&nbsp;<span class="op" id="2929458">:=</span>&nbsp;<span class="num" id="2929461">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929464">for</span>&nbsp;<span class="ident" id="2929468">i</span>&nbsp;<span class="op" id="2929470">:=</span>&nbsp;<span class="num" id="2929473">0</span><span class="op" id="2929474">;</span>&nbsp;<span class="ident" id="2929476">i</span><span class="op" id="2929477">+</span><span class="builtinfunc" id="2929478">len</span><span class="op" id="2929481">(</span><span class="ident" id="2929482">sep</span><span class="op" id="2929485">)</span>&nbsp;<span class="op" id="2929487">&lt;=</span>&nbsp;<span class="builtinfunc" id="2929490">len</span><span class="op" id="2929493">(</span><span class="ident" id="2929494">s</span><span class="op" id="2929495">)</span>&nbsp;<span class="op" id="2929497">&amp;&amp;</span>&nbsp;<span class="ident" id="2929500">na</span><span class="op" id="2929502">+</span><span class="num" id="2929503">1</span>&nbsp;<span class="op" id="2929505">&lt;</span>&nbsp;<span class="ident" id="2929507">n</span><span class="op" id="2929508">;</span>&nbsp;<span class="ident" id="2929510">i</span><span class="op" id="2929511">++</span>&nbsp;<span class="op" id="2929514">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929518">if</span>&nbsp;<span class="ident" id="2929521">s</span><span class="op" id="2929522">[</span><span class="ident" id="2929523">i</span><span class="op" id="2929524">]</span>&nbsp;<span class="op" id="2929526">==</span>&nbsp;<span class="ident" id="2929529">c</span>&nbsp;<span class="op" id="2929531">&amp;&amp;</span>&nbsp;<span class="op" id="2929534">(</span><span class="builtinfunc" id="2929535">len</span><span class="op" id="2929538">(</span><span class="ident" id="2929539">sep</span><span class="op" id="2929542">)</span>&nbsp;<span class="op" id="2929544">==</span>&nbsp;<span class="num" id="2929547">1</span>&nbsp;<span class="op" id="2929549">||</span>&nbsp;<span class="ident" id="2929552">s</span><span class="op" id="2929553">[</span><span class="ident" id="2929554">i</span><span class="op" id="2929555">:</span><span class="ident" id="2929556">i</span><span class="op" id="2929557">+</span><span class="builtinfunc" id="2929558">len</span><span class="op" id="2929561">(</span><span class="ident" id="2929562">sep</span><span class="op" id="2929565">)</span><span class="op" id="2929566">]</span>&nbsp;<span class="op" id="2929568">==</span>&nbsp;<span class="ident" id="2929571">sep</span><span class="op" id="2929574">)</span>&nbsp;<span class="op" id="2929576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929581">a</span><span class="op" id="2929582">[</span><span class="ident" id="2929583">na</span><span class="op" id="2929585">]</span>&nbsp;<span class="op" id="2929587">=</span>&nbsp;<span class="ident" id="2929589">s</span><span class="op" id="2929590">[</span><span class="ident" id="2929591">start</span>&nbsp;<span class="op" id="2929597">:</span>&nbsp;<span class="ident" id="2929599">i</span><span class="op" id="2929600">+</span><span class="ident" id="2929601">sepSave</span><span class="op" id="2929608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929613">na</span><span class="op" id="2929615">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929621">start</span>&nbsp;<span class="op" id="2929627">=</span>&nbsp;<span class="ident" id="2929629">i</span>&nbsp;<span class="op" id="2929631">+</span>&nbsp;<span class="builtinfunc" id="2929633">len</span><span class="op" id="2929636">(</span><span class="ident" id="2929637">sep</span><span class="op" id="2929640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929645">i</span>&nbsp;<span class="op" id="2929647">+=</span>&nbsp;<span class="builtinfunc" id="2929650">len</span><span class="op" id="2929653">(</span><span class="ident" id="2929654">sep</span><span class="op" id="2929657">)</span>&nbsp;<span class="op" id="2929659">-</span>&nbsp;<span class="num" id="2929661">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929671">a</span><span class="op" id="2929672">[</span><span class="ident" id="2929673">na</span><span class="op" id="2929675">]</span>&nbsp;<span class="op" id="2929677">=</span>&nbsp;<span class="ident" id="2929679">s</span><span class="op" id="2929680">[</span><span class="ident" id="2929681">start</span><span class="op" id="2929686">:</span><span class="op" id="2929687">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929690">return</span>&nbsp;<span class="ident" id="2929697">a</span><span class="op" id="2929698">[</span><span class="num" id="2929699">0</span>&nbsp;<span class="op" id="2929701">:</span>&nbsp;<span class="ident" id="2929703">na</span><span class="op" id="2929705">+</span><span class="num" id="2929706">1</span><span class="op" id="2929707">]</span><br>
<span class="lineno"></span><span class="op" id="2929709">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2929712">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2929787">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2929831">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2929892">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2929952">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2930036">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2930085">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2930112">func</span>&nbsp;<span class="ident" id="2930117">SplitN</span><span class="op" id="2930123">(</span><span class="ident" id="2930124">s</span><span class="op" id="2930125">,</span>&nbsp;<span class="ident" id="2930127">sep</span>&nbsp;<span class="builtintype" id="2930131">string</span><span class="op" id="2930137">,</span>&nbsp;<span class="ident" id="2930139">n</span>&nbsp;<span class="builtintype" id="2930141">int</span><span class="op" id="2930144">)</span>&nbsp;<span class="op" id="2930146">[</span><span class="op" id="2930147">]</span><span class="builtintype" id="2930148">string</span>&nbsp;<span class="op" id="2930155">{</span>&nbsp;<span class="keyword" id="2930157">return</span>&nbsp;<span class="ident" id="2930164">genSplit</span><span class="op" id="2930172">(</span><span class="ident" id="2930173">s</span><span class="op" id="2930174">,</span>&nbsp;<span class="ident" id="2930176">sep</span><span class="op" id="2930179">,</span>&nbsp;<span class="num" id="2930181">0</span><span class="op" id="2930182">,</span>&nbsp;<span class="ident" id="2930184">n</span><span class="op" id="2930185">)</span>&nbsp;<span class="op" id="2930187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2930190">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2930261">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2930301">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2930367">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2930427">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2930511">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2930560">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2930587">func</span>&nbsp;<span class="ident" id="2930592">SplitAfterN</span><span class="op" id="2930603">(</span><span class="ident" id="2930604">s</span><span class="op" id="2930605">,</span>&nbsp;<span class="ident" id="2930607">sep</span>&nbsp;<span class="builtintype" id="2930611">string</span><span class="op" id="2930617">,</span>&nbsp;<span class="ident" id="2930619">n</span>&nbsp;<span class="builtintype" id="2930621">int</span><span class="op" id="2930624">)</span>&nbsp;<span class="op" id="2930626">[</span><span class="op" id="2930627">]</span><span class="builtintype" id="2930628">string</span>&nbsp;<span class="op" id="2930635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930638">return</span>&nbsp;<span class="ident" id="2930645">genSplit</span><span class="op" id="2930653">(</span><span class="ident" id="2930654">s</span><span class="op" id="2930655">,</span>&nbsp;<span class="ident" id="2930657">sep</span><span class="op" id="2930660">,</span>&nbsp;<span class="builtinfunc" id="2930662">len</span><span class="op" id="2930665">(</span><span class="ident" id="2930666">sep</span><span class="op" id="2930669">)</span><span class="op" id="2930670">,</span>&nbsp;<span class="ident" id="2930672">n</span><span class="op" id="2930673">)</span><br>
<span class="lineno"></span><span class="op" id="2930675">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2930678">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2930756">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2930800">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2930860">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2930910">func</span>&nbsp;<span class="ident" id="2930915">Split</span><span class="op" id="2930920">(</span><span class="ident" id="2930921">s</span><span class="op" id="2930922">,</span>&nbsp;<span class="ident" id="2930924">sep</span>&nbsp;<span class="builtintype" id="2930928">string</span><span class="op" id="2930934">)</span>&nbsp;<span class="op" id="2930936">[</span><span class="op" id="2930937">]</span><span class="builtintype" id="2930938">string</span>&nbsp;<span class="op" id="2930945">{</span>&nbsp;<span class="keyword" id="2930947">return</span>&nbsp;<span class="ident" id="2930954">genSplit</span><span class="op" id="2930962">(</span><span class="ident" id="2930963">s</span><span class="op" id="2930964">,</span>&nbsp;<span class="ident" id="2930966">sep</span><span class="op" id="2930969">,</span>&nbsp;<span class="num" id="2930971">0</span><span class="op" id="2930972">,</span>&nbsp;<span class="op" id="2930974">-</span><span class="num" id="2930975">1</span><span class="op" id="2930976">)</span>&nbsp;<span class="op" id="2930978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930981">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2931055">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2931095">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2931160">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2931215">func</span>&nbsp;<span class="ident" id="2931220">SplitAfter</span><span class="op" id="2931230">(</span><span class="ident" id="2931231">s</span><span class="op" id="2931232">,</span>&nbsp;<span class="ident" id="2931234">sep</span>&nbsp;<span class="builtintype" id="2931238">string</span><span class="op" id="2931244">)</span>&nbsp;<span class="op" id="2931246">[</span><span class="op" id="2931247">]</span><span class="builtintype" id="2931248">string</span>&nbsp;<span class="op" id="2931255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931258">return</span>&nbsp;<span class="ident" id="2931265">genSplit</span><span class="op" id="2931273">(</span><span class="ident" id="2931274">s</span><span class="op" id="2931275">,</span>&nbsp;<span class="ident" id="2931277">sep</span><span class="op" id="2931280">,</span>&nbsp;<span class="builtinfunc" id="2931282">len</span><span class="op" id="2931285">(</span><span class="ident" id="2931286">sep</span><span class="op" id="2931289">)</span><span class="op" id="2931290">,</span>&nbsp;<span class="op" id="2931292">-</span><span class="num" id="2931293">1</span><span class="op" id="2931294">)</span><br>
<span class="lineno"></span><span class="op" id="2931296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2931299">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2931389">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2931479">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2931525">func</span>&nbsp;<span class="ident" id="2931530">Fields</span><span class="op" id="2931536">(</span><span class="ident" id="2931537">s</span>&nbsp;<span class="builtintype" id="2931539">string</span><span class="op" id="2931545">)</span>&nbsp;<span class="op" id="2931547">[</span><span class="op" id="2931548">]</span><span class="builtintype" id="2931549">string</span>&nbsp;<span class="op" id="2931556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931559">return</span>&nbsp;<span class="ident" id="2931566">FieldsFunc</span><span class="op" id="2931576">(</span><span class="ident" id="2931577">s</span><span class="op" id="2931578">,</span>&nbsp;<span class="ident" id="2931580">unicode</span><span class="op" id="2931587">.</span><span class="ident" id="2931588">IsSpace</span><span class="op" id="2931595">)</span><br>
<span class="lineno">340</span><span class="op" id="2931597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2931600">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2931687">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2931771">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2931819">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2931893">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2931973">func</span>&nbsp;<span class="ident" id="2931978">FieldsFunc</span><span class="op" id="2931988">(</span><span class="ident" id="2931989">s</span>&nbsp;<span class="builtintype" id="2931991">string</span><span class="op" id="2931997">,</span>&nbsp;<span class="ident" id="2931999">f</span>&nbsp;<span class="keyword" id="2932001">func</span><span class="op" id="2932005">(</span><span class="builtintype" id="2932006">rune</span><span class="op" id="2932010">)</span>&nbsp;<span class="builtintype" id="2932012">bool</span><span class="op" id="2932016">)</span>&nbsp;<span class="op" id="2932018">[</span><span class="op" id="2932019">]</span><span class="builtintype" id="2932020">string</span>&nbsp;<span class="op" id="2932027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932030">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932058">n</span>&nbsp;<span class="op" id="2932060">:=</span>&nbsp;<span class="num" id="2932063">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932066">inField</span>&nbsp;<span class="op" id="2932074">:=</span>&nbsp;<span class="builtintype" id="2932077">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932084">for</span>&nbsp;<span class="ident" id="2932088">_</span><span class="op" id="2932089">,</span>&nbsp;<span class="builtintype" id="2932091">rune</span>&nbsp;<span class="op" id="2932096">:=</span>&nbsp;<span class="keyword" id="2932099">range</span>&nbsp;<span class="ident" id="2932105">s</span>&nbsp;<span class="op" id="2932107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932111">wasInField</span>&nbsp;<span class="op" id="2932122">:=</span>&nbsp;<span class="ident" id="2932125">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932135">inField</span>&nbsp;<span class="op" id="2932143">=</span>&nbsp;<span class="op" id="2932145">!</span><span class="ident" id="2932146">f</span><span class="op" id="2932147">(</span><span class="builtintype" id="2932148">rune</span><span class="op" id="2932152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932156">if</span>&nbsp;<span class="ident" id="2932159">inField</span>&nbsp;<span class="op" id="2932167">&amp;&amp;</span>&nbsp;<span class="op" id="2932170">!</span><span class="ident" id="2932171">wasInField</span>&nbsp;<span class="op" id="2932182">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932187">n</span><span class="op" id="2932188">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932200">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932221">a</span>&nbsp;<span class="op" id="2932223">:=</span>&nbsp;<span class="builtinfunc" id="2932226">make</span><span class="op" id="2932230">(</span><span class="op" id="2932231">[</span><span class="op" id="2932232">]</span><span class="builtintype" id="2932233">string</span><span class="op" id="2932239">,</span>&nbsp;<span class="ident" id="2932241">n</span><span class="op" id="2932242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932245">na</span>&nbsp;<span class="op" id="2932248">:=</span>&nbsp;<span class="num" id="2932251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932254">fieldStart</span>&nbsp;<span class="op" id="2932265">:=</span>&nbsp;<span class="op" id="2932268">-</span><span class="num" id="2932269">1</span>&nbsp;<span class="comment" id="2932271">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932318">for</span>&nbsp;<span class="ident" id="2932322">i</span><span class="op" id="2932323">,</span>&nbsp;<span class="builtintype" id="2932325">rune</span>&nbsp;<span class="op" id="2932330">:=</span>&nbsp;<span class="keyword" id="2932333">range</span>&nbsp;<span class="ident" id="2932339">s</span>&nbsp;<span class="op" id="2932341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932345">if</span>&nbsp;<span class="ident" id="2932348">f</span><span class="op" id="2932349">(</span><span class="builtintype" id="2932350">rune</span><span class="op" id="2932354">)</span>&nbsp;<span class="op" id="2932356">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932361">if</span>&nbsp;<span class="ident" id="2932364">fieldStart</span>&nbsp;<span class="op" id="2932375">&gt;=</span>&nbsp;<span class="num" id="2932378">0</span>&nbsp;<span class="op" id="2932380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932386">a</span><span class="op" id="2932387">[</span><span class="ident" id="2932388">na</span><span class="op" id="2932390">]</span>&nbsp;<span class="op" id="2932392">=</span>&nbsp;<span class="ident" id="2932394">s</span><span class="op" id="2932395">[</span><span class="ident" id="2932396">fieldStart</span><span class="op" id="2932406">:</span><span class="ident" id="2932407">i</span><span class="op" id="2932408">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932414">na</span><span class="op" id="2932416">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932423">fieldStart</span>&nbsp;<span class="op" id="2932434">=</span>&nbsp;<span class="op" id="2932436">-</span><span class="num" id="2932437">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932442">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932446">}</span>&nbsp;<span class="keyword" id="2932448">else</span>&nbsp;<span class="keyword" id="2932453">if</span>&nbsp;<span class="ident" id="2932456">fieldStart</span>&nbsp;<span class="op" id="2932467">==</span>&nbsp;<span class="op" id="2932470">-</span><span class="num" id="2932471">1</span>&nbsp;<span class="op" id="2932473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932478">fieldStart</span>&nbsp;<span class="op" id="2932489">=</span>&nbsp;<span class="ident" id="2932491">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932501">if</span>&nbsp;<span class="ident" id="2932504">fieldStart</span>&nbsp;<span class="op" id="2932515">&gt;=</span>&nbsp;<span class="num" id="2932518">0</span>&nbsp;<span class="op" id="2932520">{</span>&nbsp;<span class="comment" id="2932522">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932556">a</span><span class="op" id="2932557">[</span><span class="ident" id="2932558">na</span><span class="op" id="2932560">]</span>&nbsp;<span class="op" id="2932562">=</span>&nbsp;<span class="ident" id="2932564">s</span><span class="op" id="2932565">[</span><span class="ident" id="2932566">fieldStart</span><span class="op" id="2932576">:</span><span class="op" id="2932577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932583">return</span>&nbsp;<span class="ident" id="2932590">a</span><br>
<span class="lineno"></span><span class="op" id="2932592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2932595">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2932684">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2932743">func</span>&nbsp;<span class="ident" id="2932748">Join</span><span class="op" id="2932752">(</span><span class="ident" id="2932753">a</span>&nbsp;<span class="op" id="2932755">[</span><span class="op" id="2932756">]</span><span class="builtintype" id="2932757">string</span><span class="op" id="2932763">,</span>&nbsp;<span class="ident" id="2932765">sep</span>&nbsp;<span class="builtintype" id="2932769">string</span><span class="op" id="2932775">)</span>&nbsp;<span class="builtintype" id="2932777">string</span>&nbsp;<span class="op" id="2932784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932787">if</span>&nbsp;<span class="builtinfunc" id="2932790">len</span><span class="op" id="2932793">(</span><span class="ident" id="2932794">a</span><span class="op" id="2932795">)</span>&nbsp;<span class="op" id="2932797">==</span>&nbsp;<span class="num" id="2932800">0</span>&nbsp;<span class="op" id="2932802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932806">return</span>&nbsp;<span class="string" id="2932813">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932820">if</span>&nbsp;<span class="builtinfunc" id="2932823">len</span><span class="op" id="2932826">(</span><span class="ident" id="2932827">a</span><span class="op" id="2932828">)</span>&nbsp;<span class="op" id="2932830">==</span>&nbsp;<span class="num" id="2932833">1</span>&nbsp;<span class="op" id="2932835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932839">return</span>&nbsp;<span class="ident" id="2932846">a</span><span class="op" id="2932847">[</span><span class="num" id="2932848">0</span><span class="op" id="2932849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932855">n</span>&nbsp;<span class="op" id="2932857">:=</span>&nbsp;<span class="builtinfunc" id="2932860">len</span><span class="op" id="2932863">(</span><span class="ident" id="2932864">sep</span><span class="op" id="2932867">)</span>&nbsp;<span class="op" id="2932869">*</span>&nbsp;<span class="op" id="2932871">(</span><span class="builtinfunc" id="2932872">len</span><span class="op" id="2932875">(</span><span class="ident" id="2932876">a</span><span class="op" id="2932877">)</span>&nbsp;<span class="op" id="2932879">-</span>&nbsp;<span class="num" id="2932881">1</span><span class="op" id="2932882">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932885">for</span>&nbsp;<span class="ident" id="2932889">i</span>&nbsp;<span class="op" id="2932891">:=</span>&nbsp;<span class="num" id="2932894">0</span><span class="op" id="2932895">;</span>&nbsp;<span class="ident" id="2932897">i</span>&nbsp;<span class="op" id="2932899">&lt;</span>&nbsp;<span class="builtinfunc" id="2932901">len</span><span class="op" id="2932904">(</span><span class="ident" id="2932905">a</span><span class="op" id="2932906">)</span><span class="op" id="2932907">;</span>&nbsp;<span class="ident" id="2932909">i</span><span class="op" id="2932910">++</span>&nbsp;<span class="op" id="2932913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932917">n</span>&nbsp;<span class="op" id="2932919">+=</span>&nbsp;<span class="builtinfunc" id="2932922">len</span><span class="op" id="2932925">(</span><span class="ident" id="2932926">a</span><span class="op" id="2932927">[</span><span class="ident" id="2932928">i</span><span class="op" id="2932929">]</span><span class="op" id="2932930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932937">b</span>&nbsp;<span class="op" id="2932939">:=</span>&nbsp;<span class="builtinfunc" id="2932942">make</span><span class="op" id="2932946">(</span><span class="op" id="2932947">[</span><span class="op" id="2932948">]</span><span class="builtintype" id="2932949">byte</span><span class="op" id="2932953">,</span>&nbsp;<span class="ident" id="2932955">n</span><span class="op" id="2932956">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932959">bp</span>&nbsp;<span class="op" id="2932962">:=</span>&nbsp;<span class="builtinfunc" id="2932965">copy</span><span class="op" id="2932969">(</span><span class="ident" id="2932970">b</span><span class="op" id="2932971">,</span>&nbsp;<span class="ident" id="2932973">a</span><span class="op" id="2932974">[</span><span class="num" id="2932975">0</span><span class="op" id="2932976">]</span><span class="op" id="2932977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932980">for</span>&nbsp;<span class="ident" id="2932984">_</span><span class="op" id="2932985">,</span>&nbsp;<span class="ident" id="2932987">s</span>&nbsp;<span class="op" id="2932989">:=</span>&nbsp;<span class="keyword" id="2932992">range</span>&nbsp;<span class="ident" id="2932998">a</span><span class="op" id="2932999">[</span><span class="num" id="2933000">1</span><span class="op" id="2933001">:</span><span class="op" id="2933002">]</span>&nbsp;<span class="op" id="2933004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933008">bp</span>&nbsp;<span class="op" id="2933011">+=</span>&nbsp;<span class="builtinfunc" id="2933014">copy</span><span class="op" id="2933018">(</span><span class="ident" id="2933019">b</span><span class="op" id="2933020">[</span><span class="ident" id="2933021">bp</span><span class="op" id="2933023">:</span><span class="op" id="2933024">]</span><span class="op" id="2933025">,</span>&nbsp;<span class="ident" id="2933027">sep</span><span class="op" id="2933030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933034">bp</span>&nbsp;<span class="op" id="2933037">+=</span>&nbsp;<span class="builtinfunc" id="2933040">copy</span><span class="op" id="2933044">(</span><span class="ident" id="2933045">b</span><span class="op" id="2933046">[</span><span class="ident" id="2933047">bp</span><span class="op" id="2933049">:</span><span class="op" id="2933050">]</span><span class="op" id="2933051">,</span>&nbsp;<span class="ident" id="2933053">s</span><span class="op" id="2933054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933057">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933060">return</span>&nbsp;<span class="builtintype" id="2933067">string</span><span class="op" id="2933073">(</span><span class="ident" id="2933074">b</span><span class="op" id="2933075">)</span><br>
<span class="lineno"></span><span class="op" id="2933077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933080">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2933140">func</span>&nbsp;<span class="ident" id="2933145">HasPrefix</span><span class="op" id="2933154">(</span><span class="ident" id="2933155">s</span><span class="op" id="2933156">,</span>&nbsp;<span class="ident" id="2933158">prefix</span>&nbsp;<span class="builtintype" id="2933165">string</span><span class="op" id="2933171">)</span>&nbsp;<span class="builtintype" id="2933173">bool</span>&nbsp;<span class="op" id="2933178">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933181">return</span>&nbsp;<span class="builtinfunc" id="2933188">len</span><span class="op" id="2933191">(</span><span class="ident" id="2933192">s</span><span class="op" id="2933193">)</span>&nbsp;<span class="op" id="2933195">&gt;=</span>&nbsp;<span class="builtinfunc" id="2933198">len</span><span class="op" id="2933201">(</span><span class="ident" id="2933202">prefix</span><span class="op" id="2933208">)</span>&nbsp;<span class="op" id="2933210">&amp;&amp;</span>&nbsp;<span class="ident" id="2933213">s</span><span class="op" id="2933214">[</span><span class="num" id="2933215">0</span><span class="op" id="2933216">:</span><span class="builtinfunc" id="2933217">len</span><span class="op" id="2933220">(</span><span class="ident" id="2933221">prefix</span><span class="op" id="2933227">)</span><span class="op" id="2933228">]</span>&nbsp;<span class="op" id="2933230">==</span>&nbsp;<span class="ident" id="2933233">prefix</span><br>
<span class="lineno"></span><span class="op" id="2933240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933243">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2933301">func</span>&nbsp;<span class="ident" id="2933306">HasSuffix</span><span class="op" id="2933315">(</span><span class="ident" id="2933316">s</span><span class="op" id="2933317">,</span>&nbsp;<span class="ident" id="2933319">suffix</span>&nbsp;<span class="builtintype" id="2933326">string</span><span class="op" id="2933332">)</span>&nbsp;<span class="builtintype" id="2933334">bool</span>&nbsp;<span class="op" id="2933339">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933342">return</span>&nbsp;<span class="builtinfunc" id="2933349">len</span><span class="op" id="2933352">(</span><span class="ident" id="2933353">s</span><span class="op" id="2933354">)</span>&nbsp;<span class="op" id="2933356">&gt;=</span>&nbsp;<span class="builtinfunc" id="2933359">len</span><span class="op" id="2933362">(</span><span class="ident" id="2933363">suffix</span><span class="op" id="2933369">)</span>&nbsp;<span class="op" id="2933371">&amp;&amp;</span>&nbsp;<span class="ident" id="2933374">s</span><span class="op" id="2933375">[</span><span class="builtinfunc" id="2933376">len</span><span class="op" id="2933379">(</span><span class="ident" id="2933380">s</span><span class="op" id="2933381">)</span><span class="op" id="2933382">-</span><span class="builtinfunc" id="2933383">len</span><span class="op" id="2933386">(</span><span class="ident" id="2933387">suffix</span><span class="op" id="2933393">)</span><span class="op" id="2933394">:</span><span class="op" id="2933395">]</span>&nbsp;<span class="op" id="2933397">==</span>&nbsp;<span class="ident" id="2933400">suffix</span><br>
<span class="lineno"></span><span class="op" id="2933407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933410">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2933481">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2933573">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2933621">func</span>&nbsp;<span class="ident" id="2933626">Map</span><span class="op" id="2933629">(</span><span class="ident" id="2933630">mapping</span>&nbsp;<span class="keyword" id="2933638">func</span><span class="op" id="2933642">(</span><span class="builtintype" id="2933643">rune</span><span class="op" id="2933647">)</span>&nbsp;<span class="builtintype" id="2933649">rune</span><span class="op" id="2933653">,</span>&nbsp;<span class="ident" id="2933655">s</span>&nbsp;<span class="builtintype" id="2933657">string</span><span class="op" id="2933663">)</span>&nbsp;<span class="builtintype" id="2933665">string</span>&nbsp;<span class="op" id="2933672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933675">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933738">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933805">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933867">maxbytes</span>&nbsp;<span class="op" id="2933876">:=</span>&nbsp;<span class="builtinfunc" id="2933879">len</span><span class="op" id="2933882">(</span><span class="ident" id="2933883">s</span><span class="op" id="2933884">)</span>&nbsp;<span class="comment" id="2933886">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933902">nbytes</span>&nbsp;<span class="op" id="2933909">:=</span>&nbsp;<span class="num" id="2933912">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933921">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933954">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934014">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934044">var</span>&nbsp;<span class="ident" id="2934048">b</span>&nbsp;<span class="op" id="2934050">[</span><span class="op" id="2934051">]</span><span class="builtintype" id="2934052">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934059">for</span>&nbsp;<span class="ident" id="2934063">i</span><span class="op" id="2934064">,</span>&nbsp;<span class="ident" id="2934066">c</span>&nbsp;<span class="op" id="2934068">:=</span>&nbsp;<span class="keyword" id="2934071">range</span>&nbsp;<span class="ident" id="2934077">s</span>&nbsp;<span class="op" id="2934079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934083">r</span>&nbsp;<span class="op" id="2934085">:=</span>&nbsp;<span class="ident" id="2934088">mapping</span><span class="op" id="2934095">(</span><span class="ident" id="2934096">c</span><span class="op" id="2934097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934101">if</span>&nbsp;<span class="ident" id="2934104">b</span>&nbsp;<span class="op" id="2934106">==</span>&nbsp;<span class="ident" id="2934109">nil</span>&nbsp;<span class="op" id="2934113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934118">if</span>&nbsp;<span class="ident" id="2934121">r</span>&nbsp;<span class="op" id="2934123">==</span>&nbsp;<span class="ident" id="2934126">c</span>&nbsp;<span class="op" id="2934128">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934151">b</span>&nbsp;<span class="op" id="2934153">=</span>&nbsp;<span class="builtinfunc" id="2934155">make</span><span class="op" id="2934159">(</span><span class="op" id="2934160">[</span><span class="op" id="2934161">]</span><span class="builtintype" id="2934162">byte</span><span class="op" id="2934166">,</span>&nbsp;<span class="ident" id="2934168">maxbytes</span><span class="op" id="2934176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934181">nbytes</span>&nbsp;<span class="op" id="2934188">=</span>&nbsp;<span class="builtinfunc" id="2934190">copy</span><span class="op" id="2934194">(</span><span class="ident" id="2934195">b</span><span class="op" id="2934196">,</span>&nbsp;<span class="ident" id="2934198">s</span><span class="op" id="2934199">[</span><span class="op" id="2934200">:</span><span class="ident" id="2934201">i</span><span class="op" id="2934202">]</span><span class="op" id="2934203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934207">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934211">if</span>&nbsp;<span class="ident" id="2934214">r</span>&nbsp;<span class="op" id="2934216">&gt;=</span>&nbsp;<span class="num" id="2934219">0</span>&nbsp;<span class="op" id="2934221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934226">wid</span>&nbsp;<span class="op" id="2934230">:=</span>&nbsp;<span class="num" id="2934233">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934238">if</span>&nbsp;<span class="ident" id="2934241">r</span>&nbsp;<span class="op" id="2934243">&gt;=</span>&nbsp;<span class="ident" id="2934246">utf8</span><span class="op" id="2934250">.</span><span class="ident" id="2934251">RuneSelf</span>&nbsp;<span class="op" id="2934260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934266">wid</span>&nbsp;<span class="op" id="2934270">=</span>&nbsp;<span class="ident" id="2934272">utf8</span><span class="op" id="2934276">.</span><span class="ident" id="2934277">RuneLen</span><span class="op" id="2934284">(</span><span class="ident" id="2934285">r</span><span class="op" id="2934286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934291">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934296">if</span>&nbsp;<span class="ident" id="2934299">nbytes</span><span class="op" id="2934305">+</span><span class="ident" id="2934306">wid</span>&nbsp;<span class="op" id="2934310">&gt;</span>&nbsp;<span class="ident" id="2934312">maxbytes</span>&nbsp;<span class="op" id="2934321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934327">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934351">maxbytes</span>&nbsp;<span class="op" id="2934360">=</span>&nbsp;<span class="ident" id="2934362">maxbytes</span><span class="op" id="2934370">*</span><span class="num" id="2934371">2</span>&nbsp;<span class="op" id="2934373">+</span>&nbsp;<span class="ident" id="2934375">utf8</span><span class="op" id="2934379">.</span><span class="ident" id="2934380">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934391">nb</span>&nbsp;<span class="op" id="2934394">:=</span>&nbsp;<span class="builtinfunc" id="2934397">make</span><span class="op" id="2934401">(</span><span class="op" id="2934402">[</span><span class="op" id="2934403">]</span><span class="builtintype" id="2934404">byte</span><span class="op" id="2934408">,</span>&nbsp;<span class="ident" id="2934410">maxbytes</span><span class="op" id="2934418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2934424">copy</span><span class="op" id="2934428">(</span><span class="ident" id="2934429">nb</span><span class="op" id="2934431">,</span>&nbsp;<span class="ident" id="2934433">b</span><span class="op" id="2934434">[</span><span class="num" id="2934435">0</span><span class="op" id="2934436">:</span><span class="ident" id="2934437">nbytes</span><span class="op" id="2934443">]</span><span class="op" id="2934444">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934450">b</span>&nbsp;<span class="op" id="2934452">=</span>&nbsp;<span class="ident" id="2934454">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934465">nbytes</span>&nbsp;<span class="op" id="2934472">+=</span>&nbsp;<span class="ident" id="2934475">utf8</span><span class="op" id="2934479">.</span><span class="ident" id="2934480">EncodeRune</span><span class="op" id="2934490">(</span><span class="ident" id="2934491">b</span><span class="op" id="2934492">[</span><span class="ident" id="2934493">nbytes</span><span class="op" id="2934499">:</span><span class="ident" id="2934500">maxbytes</span><span class="op" id="2934508">]</span><span class="op" id="2934509">,</span>&nbsp;<span class="ident" id="2934511">r</span><span class="op" id="2934512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934519">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934522">if</span>&nbsp;<span class="ident" id="2934525">b</span>&nbsp;<span class="op" id="2934527">==</span>&nbsp;<span class="ident" id="2934530">nil</span>&nbsp;<span class="op" id="2934534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934538">return</span>&nbsp;<span class="ident" id="2934545">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934551">return</span>&nbsp;<span class="builtintype" id="2934558">string</span><span class="op" id="2934564">(</span><span class="ident" id="2934565">b</span><span class="op" id="2934566">[</span><span class="num" id="2934567">0</span><span class="op" id="2934568">:</span><span class="ident" id="2934569">nbytes</span><span class="op" id="2934575">]</span><span class="op" id="2934576">)</span><br>
<span class="lineno"></span><span class="op" id="2934578">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2934581">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2934656">func</span>&nbsp;<span class="ident" id="2934661">Repeat</span><span class="op" id="2934667">(</span><span class="ident" id="2934668">s</span>&nbsp;<span class="builtintype" id="2934670">string</span><span class="op" id="2934676">,</span>&nbsp;<span class="ident" id="2934678">count</span>&nbsp;<span class="builtintype" id="2934684">int</span><span class="op" id="2934687">)</span>&nbsp;<span class="builtintype" id="2934689">string</span>&nbsp;<span class="op" id="2934696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934699">b</span>&nbsp;<span class="op" id="2934701">:=</span>&nbsp;<span class="builtinfunc" id="2934704">make</span><span class="op" id="2934708">(</span><span class="op" id="2934709">[</span><span class="op" id="2934710">]</span><span class="builtintype" id="2934711">byte</span><span class="op" id="2934715">,</span>&nbsp;<span class="builtinfunc" id="2934717">len</span><span class="op" id="2934720">(</span><span class="ident" id="2934721">s</span><span class="op" id="2934722">)</span><span class="op" id="2934723">*</span><span class="ident" id="2934724">count</span><span class="op" id="2934729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934732">bp</span>&nbsp;<span class="op" id="2934735">:=</span>&nbsp;<span class="builtinfunc" id="2934738">copy</span><span class="op" id="2934742">(</span><span class="ident" id="2934743">b</span><span class="op" id="2934744">,</span>&nbsp;<span class="ident" id="2934746">s</span><span class="op" id="2934747">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934750">for</span>&nbsp;<span class="ident" id="2934754">bp</span>&nbsp;<span class="op" id="2934757">&lt;</span>&nbsp;<span class="builtinfunc" id="2934759">len</span><span class="op" id="2934762">(</span><span class="ident" id="2934763">b</span><span class="op" id="2934764">)</span>&nbsp;<span class="op" id="2934766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2934770">copy</span><span class="op" id="2934774">(</span><span class="ident" id="2934775">b</span><span class="op" id="2934776">[</span><span class="ident" id="2934777">bp</span><span class="op" id="2934779">:</span><span class="op" id="2934780">]</span><span class="op" id="2934781">,</span>&nbsp;<span class="ident" id="2934783">b</span><span class="op" id="2934784">[</span><span class="op" id="2934785">:</span><span class="ident" id="2934786">bp</span><span class="op" id="2934788">]</span><span class="op" id="2934789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934793">bp</span>&nbsp;<span class="op" id="2934796">*=</span>&nbsp;<span class="num" id="2934799">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934805">return</span>&nbsp;<span class="builtintype" id="2934812">string</span><span class="op" id="2934818">(</span><span class="ident" id="2934819">b</span><span class="op" id="2934820">)</span><br>
<span class="lineno">465</span><span class="op" id="2934822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2934825">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2934920">func</span>&nbsp;<span class="ident" id="2934925">ToUpper</span><span class="op" id="2934932">(</span><span class="ident" id="2934933">s</span>&nbsp;<span class="builtintype" id="2934935">string</span><span class="op" id="2934941">)</span>&nbsp;<span class="builtintype" id="2934943">string</span>&nbsp;<span class="op" id="2934950">{</span>&nbsp;<span class="keyword" id="2934952">return</span>&nbsp;<span class="ident" id="2934959">Map</span><span class="op" id="2934962">(</span><span class="ident" id="2934963">unicode</span><span class="op" id="2934970">.</span><span class="ident" id="2934971">ToUpper</span><span class="op" id="2934978">,</span>&nbsp;<span class="ident" id="2934980">s</span><span class="op" id="2934981">)</span>&nbsp;<span class="op" id="2934983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2934986">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2935081">func</span>&nbsp;<span class="ident" id="2935086">ToLower</span><span class="op" id="2935093">(</span><span class="ident" id="2935094">s</span>&nbsp;<span class="builtintype" id="2935096">string</span><span class="op" id="2935102">)</span>&nbsp;<span class="builtintype" id="2935104">string</span>&nbsp;<span class="op" id="2935111">{</span>&nbsp;<span class="keyword" id="2935113">return</span>&nbsp;<span class="ident" id="2935120">Map</span><span class="op" id="2935123">(</span><span class="ident" id="2935124">unicode</span><span class="op" id="2935131">.</span><span class="ident" id="2935132">ToLower</span><span class="op" id="2935139">,</span>&nbsp;<span class="ident" id="2935141">s</span><span class="op" id="2935142">)</span>&nbsp;<span class="op" id="2935144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2935147">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2935242">func</span>&nbsp;<span class="ident" id="2935247">ToTitle</span><span class="op" id="2935254">(</span><span class="ident" id="2935255">s</span>&nbsp;<span class="builtintype" id="2935257">string</span><span class="op" id="2935263">)</span>&nbsp;<span class="builtintype" id="2935265">string</span>&nbsp;<span class="op" id="2935272">{</span>&nbsp;<span class="keyword" id="2935274">return</span>&nbsp;<span class="ident" id="2935281">Map</span><span class="op" id="2935284">(</span><span class="ident" id="2935285">unicode</span><span class="op" id="2935292">.</span><span class="ident" id="2935293">ToTitle</span><span class="op" id="2935300">,</span>&nbsp;<span class="ident" id="2935302">s</span><span class="op" id="2935303">)</span>&nbsp;<span class="op" id="2935305">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2935308">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2935398">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2935458">func</span>&nbsp;<span class="ident" id="2935463">ToUpperSpecial</span><span class="op" id="2935477">(</span><span class="ident" id="2935478">_case</span>&nbsp;<span class="ident" id="2935484">unicode</span><span class="op" id="2935491">.</span><span class="ident" id="2935492">SpecialCase</span><span class="op" id="2935503">,</span>&nbsp;<span class="ident" id="2935505">s</span>&nbsp;<span class="builtintype" id="2935507">string</span><span class="op" id="2935513">)</span>&nbsp;<span class="builtintype" id="2935515">string</span>&nbsp;<span class="op" id="2935522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935525">return</span>&nbsp;<span class="ident" id="2935532">Map</span><span class="op" id="2935535">(</span><span class="keyword" id="2935536">func</span><span class="op" id="2935540">(</span><span class="ident" id="2935541">r</span>&nbsp;<span class="builtintype" id="2935543">rune</span><span class="op" id="2935547">)</span>&nbsp;<span class="builtintype" id="2935549">rune</span>&nbsp;<span class="op" id="2935554">{</span>&nbsp;<span class="keyword" id="2935556">return</span>&nbsp;<span class="ident" id="2935563">_case</span><span class="op" id="2935568">.</span><span class="ident" id="2935569">ToUpper</span><span class="op" id="2935576">(</span><span class="ident" id="2935577">r</span><span class="op" id="2935578">)</span>&nbsp;<span class="op" id="2935580">}</span><span class="op" id="2935581">,</span>&nbsp;<span class="ident" id="2935583">s</span><span class="op" id="2935584">)</span><br>
<span class="lineno">480</span><span class="op" id="2935586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2935589">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2935679">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2935739">func</span>&nbsp;<span class="ident" id="2935744">ToLowerSpecial</span><span class="op" id="2935758">(</span><span class="ident" id="2935759">_case</span>&nbsp;<span class="ident" id="2935765">unicode</span><span class="op" id="2935772">.</span><span class="ident" id="2935773">SpecialCase</span><span class="op" id="2935784">,</span>&nbsp;<span class="ident" id="2935786">s</span>&nbsp;<span class="builtintype" id="2935788">string</span><span class="op" id="2935794">)</span>&nbsp;<span class="builtintype" id="2935796">string</span>&nbsp;<span class="op" id="2935803">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935806">return</span>&nbsp;<span class="ident" id="2935813">Map</span><span class="op" id="2935816">(</span><span class="keyword" id="2935817">func</span><span class="op" id="2935821">(</span><span class="ident" id="2935822">r</span>&nbsp;<span class="builtintype" id="2935824">rune</span><span class="op" id="2935828">)</span>&nbsp;<span class="builtintype" id="2935830">rune</span>&nbsp;<span class="op" id="2935835">{</span>&nbsp;<span class="keyword" id="2935837">return</span>&nbsp;<span class="ident" id="2935844">_case</span><span class="op" id="2935849">.</span><span class="ident" id="2935850">ToLower</span><span class="op" id="2935857">(</span><span class="ident" id="2935858">r</span><span class="op" id="2935859">)</span>&nbsp;<span class="op" id="2935861">}</span><span class="op" id="2935862">,</span>&nbsp;<span class="ident" id="2935864">s</span><span class="op" id="2935865">)</span><br>
<span class="lineno"></span><span class="op" id="2935867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2935870">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2935960">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2936020">func</span>&nbsp;<span class="ident" id="2936025">ToTitleSpecial</span><span class="op" id="2936039">(</span><span class="ident" id="2936040">_case</span>&nbsp;<span class="ident" id="2936046">unicode</span><span class="op" id="2936053">.</span><span class="ident" id="2936054">SpecialCase</span><span class="op" id="2936065">,</span>&nbsp;<span class="ident" id="2936067">s</span>&nbsp;<span class="builtintype" id="2936069">string</span><span class="op" id="2936075">)</span>&nbsp;<span class="builtintype" id="2936077">string</span>&nbsp;<span class="op" id="2936084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936087">return</span>&nbsp;<span class="ident" id="2936094">Map</span><span class="op" id="2936097">(</span><span class="keyword" id="2936098">func</span><span class="op" id="2936102">(</span><span class="ident" id="2936103">r</span>&nbsp;<span class="builtintype" id="2936105">rune</span><span class="op" id="2936109">)</span>&nbsp;<span class="builtintype" id="2936111">rune</span>&nbsp;<span class="op" id="2936116">{</span>&nbsp;<span class="keyword" id="2936118">return</span>&nbsp;<span class="ident" id="2936125">_case</span><span class="op" id="2936130">.</span><span class="ident" id="2936131">ToTitle</span><span class="op" id="2936138">(</span><span class="ident" id="2936139">r</span><span class="op" id="2936140">)</span>&nbsp;<span class="op" id="2936142">}</span><span class="op" id="2936143">,</span>&nbsp;<span class="ident" id="2936145">s</span><span class="op" id="2936146">)</span><br>
<span class="lineno"></span><span class="op" id="2936148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2936151">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2936219">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2936289">func</span>&nbsp;<span class="ident" id="2936294">isSeparator</span><span class="op" id="2936305">(</span><span class="ident" id="2936306">r</span>&nbsp;<span class="builtintype" id="2936308">rune</span><span class="op" id="2936312">)</span>&nbsp;<span class="builtintype" id="2936314">bool</span>&nbsp;<span class="op" id="2936319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2936322">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936380">if</span>&nbsp;<span class="ident" id="2936383">r</span>&nbsp;<span class="op" id="2936385">&lt;=</span>&nbsp;<span class="num" id="2936388">0x7F</span>&nbsp;<span class="op" id="2936393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936397">switch</span>&nbsp;<span class="op" id="2936404">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936408">case</span>&nbsp;<span class="string" id="2936413">&#39;0&#39;</span>&nbsp;<span class="op" id="2936417">&lt;=</span>&nbsp;<span class="ident" id="2936420">r</span>&nbsp;<span class="op" id="2936422">&amp;&amp;</span>&nbsp;<span class="ident" id="2936425">r</span>&nbsp;<span class="op" id="2936427">&lt;=</span>&nbsp;<span class="string" id="2936430">&#39;9&#39;</span><span class="op" id="2936433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936438">return</span>&nbsp;<span class="builtintype" id="2936445">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936453">case</span>&nbsp;<span class="string" id="2936458">&#39;a&#39;</span>&nbsp;<span class="op" id="2936462">&lt;=</span>&nbsp;<span class="ident" id="2936465">r</span>&nbsp;<span class="op" id="2936467">&amp;&amp;</span>&nbsp;<span class="ident" id="2936470">r</span>&nbsp;<span class="op" id="2936472">&lt;=</span>&nbsp;<span class="string" id="2936475">&#39;z&#39;</span><span class="op" id="2936478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936483">return</span>&nbsp;<span class="builtintype" id="2936490">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936498">case</span>&nbsp;<span class="string" id="2936503">&#39;A&#39;</span>&nbsp;<span class="op" id="2936507">&lt;=</span>&nbsp;<span class="ident" id="2936510">r</span>&nbsp;<span class="op" id="2936512">&amp;&amp;</span>&nbsp;<span class="ident" id="2936515">r</span>&nbsp;<span class="op" id="2936517">&lt;=</span>&nbsp;<span class="string" id="2936520">&#39;Z&#39;</span><span class="op" id="2936523">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936528">return</span>&nbsp;<span class="builtintype" id="2936535">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936543">case</span>&nbsp;<span class="ident" id="2936548">r</span>&nbsp;<span class="op" id="2936550">==</span>&nbsp;<span class="string" id="2936553">&#39;_&#39;</span><span class="op" id="2936556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936561">return</span>&nbsp;<span class="builtintype" id="2936568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936580">return</span>&nbsp;<span class="builtintype" id="2936587">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2936596">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936638">if</span>&nbsp;<span class="ident" id="2936641">unicode</span><span class="op" id="2936648">.</span><span class="ident" id="2936649">IsLetter</span><span class="op" id="2936657">(</span><span class="ident" id="2936658">r</span><span class="op" id="2936659">)</span>&nbsp;<span class="op" id="2936661">||</span>&nbsp;<span class="ident" id="2936664">unicode</span><span class="op" id="2936671">.</span><span class="ident" id="2936672">IsDigit</span><span class="op" id="2936679">(</span><span class="ident" id="2936680">r</span><span class="op" id="2936681">)</span>&nbsp;<span class="op" id="2936683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936687">return</span>&nbsp;<span class="builtintype" id="2936694">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936701">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2936704">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936772">return</span>&nbsp;<span class="ident" id="2936779">unicode</span><span class="op" id="2936786">.</span><span class="ident" id="2936787">IsSpace</span><span class="op" id="2936794">(</span><span class="ident" id="2936795">r</span><span class="op" id="2936796">)</span><br>
<span class="lineno"></span><span class="op" id="2936798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2936801">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2936883">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2936914">//</span><br>
<span class="lineno"></span><span class="comment" id="2936917">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2937011">func</span>&nbsp;<span class="ident" id="2937016">Title</span><span class="op" id="2937021">(</span><span class="ident" id="2937022">s</span>&nbsp;<span class="builtintype" id="2937024">string</span><span class="op" id="2937030">)</span>&nbsp;<span class="builtintype" id="2937032">string</span>&nbsp;<span class="op" id="2937039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937042">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937084">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937156">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937187">prev</span>&nbsp;<span class="op" id="2937192">:=</span>&nbsp;<span class="string" id="2937195">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937200">return</span>&nbsp;<span class="ident" id="2937207">Map</span><span class="op" id="2937210">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937214">func</span><span class="op" id="2937218">(</span><span class="ident" id="2937219">r</span>&nbsp;<span class="builtintype" id="2937221">rune</span><span class="op" id="2937225">)</span>&nbsp;<span class="builtintype" id="2937227">rune</span>&nbsp;<span class="op" id="2937232">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937237">if</span>&nbsp;<span class="ident" id="2937240">isSeparator</span><span class="op" id="2937251">(</span><span class="ident" id="2937252">prev</span><span class="op" id="2937256">)</span>&nbsp;<span class="op" id="2937258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937264">prev</span>&nbsp;<span class="op" id="2937269">=</span>&nbsp;<span class="ident" id="2937271">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937277">return</span>&nbsp;<span class="ident" id="2937284">unicode</span><span class="op" id="2937291">.</span><span class="ident" id="2937292">ToTitle</span><span class="op" id="2937299">(</span><span class="ident" id="2937300">r</span><span class="op" id="2937301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937311">prev</span>&nbsp;<span class="op" id="2937316">=</span>&nbsp;<span class="ident" id="2937318">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937323">return</span>&nbsp;<span class="ident" id="2937330">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937334">}</span><span class="op" id="2937335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937339">s</span><span class="op" id="2937340">)</span><br>
<span class="lineno"></span><span class="op" id="2937342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2937345">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2937410">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2937460">func</span>&nbsp;<span class="ident" id="2937465">TrimLeftFunc</span><span class="op" id="2937477">(</span><span class="ident" id="2937478">s</span>&nbsp;<span class="builtintype" id="2937480">string</span><span class="op" id="2937486">,</span>&nbsp;<span class="ident" id="2937488">f</span>&nbsp;<span class="keyword" id="2937490">func</span><span class="op" id="2937494">(</span><span class="builtintype" id="2937495">rune</span><span class="op" id="2937499">)</span>&nbsp;<span class="builtintype" id="2937501">bool</span><span class="op" id="2937505">)</span>&nbsp;<span class="builtintype" id="2937507">string</span>&nbsp;<span class="op" id="2937514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937517">i</span>&nbsp;<span class="op" id="2937519">:=</span>&nbsp;<span class="ident" id="2937522">indexFunc</span><span class="op" id="2937531">(</span><span class="ident" id="2937532">s</span><span class="op" id="2937533">,</span>&nbsp;<span class="ident" id="2937535">f</span><span class="op" id="2937536">,</span>&nbsp;<span class="builtintype" id="2937538">false</span><span class="op" id="2937543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937546">if</span>&nbsp;<span class="ident" id="2937549">i</span>&nbsp;<span class="op" id="2937551">==</span>&nbsp;<span class="op" id="2937554">-</span><span class="num" id="2937555">1</span>&nbsp;<span class="op" id="2937557">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937561">return</span>&nbsp;<span class="string" id="2937568">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937575">return</span>&nbsp;<span class="ident" id="2937582">s</span><span class="op" id="2937583">[</span><span class="ident" id="2937584">i</span><span class="op" id="2937585">:</span><span class="op" id="2937586">]</span><br>
<span class="lineno"></span><span class="op" id="2937588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2937591">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2937658">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2937708">func</span>&nbsp;<span class="ident" id="2937713">TrimRightFunc</span><span class="op" id="2937726">(</span><span class="ident" id="2937727">s</span>&nbsp;<span class="builtintype" id="2937729">string</span><span class="op" id="2937735">,</span>&nbsp;<span class="ident" id="2937737">f</span>&nbsp;<span class="keyword" id="2937739">func</span><span class="op" id="2937743">(</span><span class="builtintype" id="2937744">rune</span><span class="op" id="2937748">)</span>&nbsp;<span class="builtintype" id="2937750">bool</span><span class="op" id="2937754">)</span>&nbsp;<span class="builtintype" id="2937756">string</span>&nbsp;<span class="op" id="2937763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937766">i</span>&nbsp;<span class="op" id="2937768">:=</span>&nbsp;<span class="ident" id="2937771">lastIndexFunc</span><span class="op" id="2937784">(</span><span class="ident" id="2937785">s</span><span class="op" id="2937786">,</span>&nbsp;<span class="ident" id="2937788">f</span><span class="op" id="2937789">,</span>&nbsp;<span class="builtintype" id="2937791">false</span><span class="op" id="2937796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937799">if</span>&nbsp;<span class="ident" id="2937802">i</span>&nbsp;<span class="op" id="2937804">&gt;=</span>&nbsp;<span class="num" id="2937807">0</span>&nbsp;<span class="op" id="2937809">&amp;&amp;</span>&nbsp;<span class="ident" id="2937812">s</span><span class="op" id="2937813">[</span><span class="ident" id="2937814">i</span><span class="op" id="2937815">]</span>&nbsp;<span class="op" id="2937817">&gt;=</span>&nbsp;<span class="ident" id="2937820">utf8</span><span class="op" id="2937824">.</span><span class="ident" id="2937825">RuneSelf</span>&nbsp;<span class="op" id="2937834">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937838">_</span><span class="op" id="2937839">,</span>&nbsp;<span class="ident" id="2937841">wid</span>&nbsp;<span class="op" id="2937845">:=</span>&nbsp;<span class="ident" id="2937848">utf8</span><span class="op" id="2937852">.</span><span class="ident" id="2937853">DecodeRuneInString</span><span class="op" id="2937871">(</span><span class="ident" id="2937872">s</span><span class="op" id="2937873">[</span><span class="ident" id="2937874">i</span><span class="op" id="2937875">:</span><span class="op" id="2937876">]</span><span class="op" id="2937877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937881">i</span>&nbsp;<span class="op" id="2937883">+=</span>&nbsp;<span class="ident" id="2937886">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937891">}</span>&nbsp;<span class="keyword" id="2937893">else</span>&nbsp;<span class="op" id="2937898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937902">i</span><span class="op" id="2937903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937907">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937910">return</span>&nbsp;<span class="ident" id="2937917">s</span><span class="op" id="2937918">[</span><span class="num" id="2937919">0</span><span class="op" id="2937920">:</span><span class="ident" id="2937921">i</span><span class="op" id="2937922">]</span><br>
<span class="lineno"></span><span class="op" id="2937924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2937927">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2937988">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2938051">func</span>&nbsp;<span class="ident" id="2938056">TrimFunc</span><span class="op" id="2938064">(</span><span class="ident" id="2938065">s</span>&nbsp;<span class="builtintype" id="2938067">string</span><span class="op" id="2938073">,</span>&nbsp;<span class="ident" id="2938075">f</span>&nbsp;<span class="keyword" id="2938077">func</span><span class="op" id="2938081">(</span><span class="builtintype" id="2938082">rune</span><span class="op" id="2938086">)</span>&nbsp;<span class="builtintype" id="2938088">bool</span><span class="op" id="2938092">)</span>&nbsp;<span class="builtintype" id="2938094">string</span>&nbsp;<span class="op" id="2938101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938104">return</span>&nbsp;<span class="ident" id="2938111">TrimRightFunc</span><span class="op" id="2938124">(</span><span class="ident" id="2938125">TrimLeftFunc</span><span class="op" id="2938137">(</span><span class="ident" id="2938138">s</span><span class="op" id="2938139">,</span>&nbsp;<span class="ident" id="2938141">f</span><span class="op" id="2938142">)</span><span class="op" id="2938143">,</span>&nbsp;<span class="ident" id="2938145">f</span><span class="op" id="2938146">)</span><br>
<span class="lineno"></span><span class="op" id="2938148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2938151">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2938210">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2938259">func</span>&nbsp;<span class="ident" id="2938264">IndexFunc</span><span class="op" id="2938273">(</span><span class="ident" id="2938274">s</span>&nbsp;<span class="builtintype" id="2938276">string</span><span class="op" id="2938282">,</span>&nbsp;<span class="ident" id="2938284">f</span>&nbsp;<span class="keyword" id="2938286">func</span><span class="op" id="2938290">(</span><span class="builtintype" id="2938291">rune</span><span class="op" id="2938295">)</span>&nbsp;<span class="builtintype" id="2938297">bool</span><span class="op" id="2938301">)</span>&nbsp;<span class="builtintype" id="2938303">int</span>&nbsp;<span class="op" id="2938307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938310">return</span>&nbsp;<span class="ident" id="2938317">indexFunc</span><span class="op" id="2938326">(</span><span class="ident" id="2938327">s</span><span class="op" id="2938328">,</span>&nbsp;<span class="ident" id="2938330">f</span><span class="op" id="2938331">,</span>&nbsp;<span class="builtintype" id="2938333">true</span><span class="op" id="2938337">)</span><br>
<span class="lineno"></span><span class="op" id="2938339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2938342">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2938396">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2938453">func</span>&nbsp;<span class="ident" id="2938458">LastIndexFunc</span><span class="op" id="2938471">(</span><span class="ident" id="2938472">s</span>&nbsp;<span class="builtintype" id="2938474">string</span><span class="op" id="2938480">,</span>&nbsp;<span class="ident" id="2938482">f</span>&nbsp;<span class="keyword" id="2938484">func</span><span class="op" id="2938488">(</span><span class="builtintype" id="2938489">rune</span><span class="op" id="2938493">)</span>&nbsp;<span class="builtintype" id="2938495">bool</span><span class="op" id="2938499">)</span>&nbsp;<span class="builtintype" id="2938501">int</span>&nbsp;<span class="op" id="2938505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938508">return</span>&nbsp;<span class="ident" id="2938515">lastIndexFunc</span><span class="op" id="2938528">(</span><span class="ident" id="2938529">s</span><span class="op" id="2938530">,</span>&nbsp;<span class="ident" id="2938532">f</span><span class="op" id="2938533">,</span>&nbsp;<span class="builtintype" id="2938535">true</span><span class="op" id="2938539">)</span><br>
<span class="lineno"></span><span class="op" id="2938541">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2938544">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2938597">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2938653">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2938666">func</span>&nbsp;<span class="ident" id="2938671">indexFunc</span><span class="op" id="2938680">(</span><span class="ident" id="2938681">s</span>&nbsp;<span class="builtintype" id="2938683">string</span><span class="op" id="2938689">,</span>&nbsp;<span class="ident" id="2938691">f</span>&nbsp;<span class="keyword" id="2938693">func</span><span class="op" id="2938697">(</span><span class="builtintype" id="2938698">rune</span><span class="op" id="2938702">)</span>&nbsp;<span class="builtintype" id="2938704">bool</span><span class="op" id="2938708">,</span>&nbsp;<span class="ident" id="2938710">truth</span>&nbsp;<span class="builtintype" id="2938716">bool</span><span class="op" id="2938720">)</span>&nbsp;<span class="builtintype" id="2938722">int</span>&nbsp;<span class="op" id="2938726">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938729">start</span>&nbsp;<span class="op" id="2938735">:=</span>&nbsp;<span class="num" id="2938738">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938741">for</span>&nbsp;<span class="ident" id="2938745">start</span>&nbsp;<span class="op" id="2938751">&lt;</span>&nbsp;<span class="builtinfunc" id="2938753">len</span><span class="op" id="2938756">(</span><span class="ident" id="2938757">s</span><span class="op" id="2938758">)</span>&nbsp;<span class="op" id="2938760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938764">wid</span>&nbsp;<span class="op" id="2938768">:=</span>&nbsp;<span class="num" id="2938771">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938775">r</span>&nbsp;<span class="op" id="2938777">:=</span>&nbsp;<span class="builtintype" id="2938780">rune</span><span class="op" id="2938784">(</span><span class="ident" id="2938785">s</span><span class="op" id="2938786">[</span><span class="ident" id="2938787">start</span><span class="op" id="2938792">]</span><span class="op" id="2938793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938797">if</span>&nbsp;<span class="ident" id="2938800">r</span>&nbsp;<span class="op" id="2938802">&gt;=</span>&nbsp;<span class="ident" id="2938805">utf8</span><span class="op" id="2938809">.</span><span class="ident" id="2938810">RuneSelf</span>&nbsp;<span class="op" id="2938819">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938824">r</span><span class="op" id="2938825">,</span>&nbsp;<span class="ident" id="2938827">wid</span>&nbsp;<span class="op" id="2938831">=</span>&nbsp;<span class="ident" id="2938833">utf8</span><span class="op" id="2938837">.</span><span class="ident" id="2938838">DecodeRuneInString</span><span class="op" id="2938856">(</span><span class="ident" id="2938857">s</span><span class="op" id="2938858">[</span><span class="ident" id="2938859">start</span><span class="op" id="2938864">:</span><span class="op" id="2938865">]</span><span class="op" id="2938866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938874">if</span>&nbsp;<span class="ident" id="2938877">f</span><span class="op" id="2938878">(</span><span class="ident" id="2938879">r</span><span class="op" id="2938880">)</span>&nbsp;<span class="op" id="2938882">==</span>&nbsp;<span class="ident" id="2938885">truth</span>&nbsp;<span class="op" id="2938891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938896">return</span>&nbsp;<span class="ident" id="2938903">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938911">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938915">start</span>&nbsp;<span class="op" id="2938921">+=</span>&nbsp;<span class="ident" id="2938924">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938932">return</span>&nbsp;<span class="op" id="2938939">-</span><span class="num" id="2938940">1</span><br>
<span class="lineno"></span><span class="op" id="2938942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2938945">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2939006">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2939062">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2939075">func</span>&nbsp;<span class="ident" id="2939080">lastIndexFunc</span><span class="op" id="2939093">(</span><span class="ident" id="2939094">s</span>&nbsp;<span class="builtintype" id="2939096">string</span><span class="op" id="2939102">,</span>&nbsp;<span class="ident" id="2939104">f</span>&nbsp;<span class="keyword" id="2939106">func</span><span class="op" id="2939110">(</span><span class="builtintype" id="2939111">rune</span><span class="op" id="2939115">)</span>&nbsp;<span class="builtintype" id="2939117">bool</span><span class="op" id="2939121">,</span>&nbsp;<span class="ident" id="2939123">truth</span>&nbsp;<span class="builtintype" id="2939129">bool</span><span class="op" id="2939133">)</span>&nbsp;<span class="builtintype" id="2939135">int</span>&nbsp;<span class="op" id="2939139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939142">for</span>&nbsp;<span class="ident" id="2939146">i</span>&nbsp;<span class="op" id="2939148">:=</span>&nbsp;<span class="builtinfunc" id="2939151">len</span><span class="op" id="2939154">(</span><span class="ident" id="2939155">s</span><span class="op" id="2939156">)</span><span class="op" id="2939157">;</span>&nbsp;<span class="ident" id="2939159">i</span>&nbsp;<span class="op" id="2939161">&gt;</span>&nbsp;<span class="num" id="2939163">0</span><span class="op" id="2939164">;</span>&nbsp;<span class="op" id="2939166">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939170">r</span><span class="op" id="2939171">,</span>&nbsp;<span class="ident" id="2939173">size</span>&nbsp;<span class="op" id="2939178">:=</span>&nbsp;<span class="ident" id="2939181">utf8</span><span class="op" id="2939185">.</span><span class="ident" id="2939186">DecodeLastRuneInString</span><span class="op" id="2939208">(</span><span class="ident" id="2939209">s</span><span class="op" id="2939210">[</span><span class="num" id="2939211">0</span><span class="op" id="2939212">:</span><span class="ident" id="2939213">i</span><span class="op" id="2939214">]</span><span class="op" id="2939215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939219">i</span>&nbsp;<span class="op" id="2939221">-=</span>&nbsp;<span class="ident" id="2939224">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939231">if</span>&nbsp;<span class="ident" id="2939234">f</span><span class="op" id="2939235">(</span><span class="ident" id="2939236">r</span><span class="op" id="2939237">)</span>&nbsp;<span class="op" id="2939239">==</span>&nbsp;<span class="ident" id="2939242">truth</span>&nbsp;<span class="op" id="2939248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939253">return</span>&nbsp;<span class="ident" id="2939260">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939264">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939270">return</span>&nbsp;<span class="op" id="2939277">-</span><span class="num" id="2939278">1</span><br>
<span class="lineno"></span><span class="op" id="2939280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939283">func</span>&nbsp;<span class="ident" id="2939288">makeCutsetFunc</span><span class="op" id="2939302">(</span><span class="ident" id="2939303">cutset</span>&nbsp;<span class="builtintype" id="2939310">string</span><span class="op" id="2939316">)</span>&nbsp;<span class="keyword" id="2939318">func</span><span class="op" id="2939322">(</span><span class="builtintype" id="2939323">rune</span><span class="op" id="2939327">)</span>&nbsp;<span class="builtintype" id="2939329">bool</span>&nbsp;<span class="op" id="2939334">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939337">return</span>&nbsp;<span class="keyword" id="2939344">func</span><span class="op" id="2939348">(</span><span class="ident" id="2939349">r</span>&nbsp;<span class="builtintype" id="2939351">rune</span><span class="op" id="2939355">)</span>&nbsp;<span class="builtintype" id="2939357">bool</span>&nbsp;<span class="op" id="2939362">{</span>&nbsp;<span class="keyword" id="2939364">return</span>&nbsp;<span class="ident" id="2939371">IndexRune</span><span class="op" id="2939380">(</span><span class="ident" id="2939381">cutset</span><span class="op" id="2939387">,</span>&nbsp;<span class="ident" id="2939389">r</span><span class="op" id="2939390">)</span>&nbsp;<span class="op" id="2939392">&gt;=</span>&nbsp;<span class="num" id="2939395">0</span>&nbsp;<span class="op" id="2939397">}</span><br>
<span class="lineno"></span><span class="op" id="2939399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2939402">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2939463">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2939524">func</span>&nbsp;<span class="ident" id="2939529">Trim</span><span class="op" id="2939533">(</span><span class="ident" id="2939534">s</span>&nbsp;<span class="builtintype" id="2939536">string</span><span class="op" id="2939542">,</span>&nbsp;<span class="ident" id="2939544">cutset</span>&nbsp;<span class="builtintype" id="2939551">string</span><span class="op" id="2939557">)</span>&nbsp;<span class="builtintype" id="2939559">string</span>&nbsp;<span class="op" id="2939566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939569">if</span>&nbsp;<span class="ident" id="2939572">s</span>&nbsp;<span class="op" id="2939574">==</span>&nbsp;<span class="string" id="2939577">&#34;&#34;</span>&nbsp;<span class="op" id="2939580">||</span>&nbsp;<span class="ident" id="2939583">cutset</span>&nbsp;<span class="op" id="2939590">==</span>&nbsp;<span class="string" id="2939593">&#34;&#34;</span>&nbsp;<span class="op" id="2939596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939600">return</span>&nbsp;<span class="ident" id="2939607">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939613">return</span>&nbsp;<span class="ident" id="2939620">TrimFunc</span><span class="op" id="2939628">(</span><span class="ident" id="2939629">s</span><span class="op" id="2939630">,</span>&nbsp;<span class="ident" id="2939632">makeCutsetFunc</span><span class="op" id="2939646">(</span><span class="ident" id="2939647">cutset</span><span class="op" id="2939653">)</span><span class="op" id="2939654">)</span><br>
<span class="lineno">625</span><span class="op" id="2939656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2939659">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2939720">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2939772">func</span>&nbsp;<span class="ident" id="2939777">TrimLeft</span><span class="op" id="2939785">(</span><span class="ident" id="2939786">s</span>&nbsp;<span class="builtintype" id="2939788">string</span><span class="op" id="2939794">,</span>&nbsp;<span class="ident" id="2939796">cutset</span>&nbsp;<span class="builtintype" id="2939803">string</span><span class="op" id="2939809">)</span>&nbsp;<span class="builtintype" id="2939811">string</span>&nbsp;<span class="op" id="2939818">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939821">if</span>&nbsp;<span class="ident" id="2939824">s</span>&nbsp;<span class="op" id="2939826">==</span>&nbsp;<span class="string" id="2939829">&#34;&#34;</span>&nbsp;<span class="op" id="2939832">||</span>&nbsp;<span class="ident" id="2939835">cutset</span>&nbsp;<span class="op" id="2939842">==</span>&nbsp;<span class="string" id="2939845">&#34;&#34;</span>&nbsp;<span class="op" id="2939848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939852">return</span>&nbsp;<span class="ident" id="2939859">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939865">return</span>&nbsp;<span class="ident" id="2939872">TrimLeftFunc</span><span class="op" id="2939884">(</span><span class="ident" id="2939885">s</span><span class="op" id="2939886">,</span>&nbsp;<span class="ident" id="2939888">makeCutsetFunc</span><span class="op" id="2939902">(</span><span class="ident" id="2939903">cutset</span><span class="op" id="2939909">)</span><span class="op" id="2939910">)</span><br>
<span class="lineno"></span><span class="op" id="2939912">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2939915">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2939979">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2940031">func</span>&nbsp;<span class="ident" id="2940036">TrimRight</span><span class="op" id="2940045">(</span><span class="ident" id="2940046">s</span>&nbsp;<span class="builtintype" id="2940048">string</span><span class="op" id="2940054">,</span>&nbsp;<span class="ident" id="2940056">cutset</span>&nbsp;<span class="builtintype" id="2940063">string</span><span class="op" id="2940069">)</span>&nbsp;<span class="builtintype" id="2940071">string</span>&nbsp;<span class="op" id="2940078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940081">if</span>&nbsp;<span class="ident" id="2940084">s</span>&nbsp;<span class="op" id="2940086">==</span>&nbsp;<span class="string" id="2940089">&#34;&#34;</span>&nbsp;<span class="op" id="2940092">||</span>&nbsp;<span class="ident" id="2940095">cutset</span>&nbsp;<span class="op" id="2940102">==</span>&nbsp;<span class="string" id="2940105">&#34;&#34;</span>&nbsp;<span class="op" id="2940108">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940112">return</span>&nbsp;<span class="ident" id="2940119">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940125">return</span>&nbsp;<span class="ident" id="2940132">TrimRightFunc</span><span class="op" id="2940145">(</span><span class="ident" id="2940146">s</span><span class="op" id="2940147">,</span>&nbsp;<span class="ident" id="2940149">makeCutsetFunc</span><span class="op" id="2940163">(</span><span class="ident" id="2940164">cutset</span><span class="op" id="2940170">)</span><span class="op" id="2940171">)</span><br>
<span class="lineno"></span><span class="op" id="2940173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2940176">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2940239">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2940299">func</span>&nbsp;<span class="ident" id="2940304">TrimSpace</span><span class="op" id="2940313">(</span><span class="ident" id="2940314">s</span>&nbsp;<span class="builtintype" id="2940316">string</span><span class="op" id="2940322">)</span>&nbsp;<span class="builtintype" id="2940324">string</span>&nbsp;<span class="op" id="2940331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940334">return</span>&nbsp;<span class="ident" id="2940341">TrimFunc</span><span class="op" id="2940349">(</span><span class="ident" id="2940350">s</span><span class="op" id="2940351">,</span>&nbsp;<span class="ident" id="2940353">unicode</span><span class="op" id="2940360">.</span><span class="ident" id="2940361">IsSpace</span><span class="op" id="2940368">)</span><br>
<span class="lineno"></span><span class="op" id="2940370">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2940373">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2940441">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2940501">func</span>&nbsp;<span class="ident" id="2940506">TrimPrefix</span><span class="op" id="2940516">(</span><span class="ident" id="2940517">s</span><span class="op" id="2940518">,</span>&nbsp;<span class="ident" id="2940520">prefix</span>&nbsp;<span class="builtintype" id="2940527">string</span><span class="op" id="2940533">)</span>&nbsp;<span class="builtintype" id="2940535">string</span>&nbsp;<span class="op" id="2940542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940545">if</span>&nbsp;<span class="ident" id="2940548">HasPrefix</span><span class="op" id="2940557">(</span><span class="ident" id="2940558">s</span><span class="op" id="2940559">,</span>&nbsp;<span class="ident" id="2940561">prefix</span><span class="op" id="2940567">)</span>&nbsp;<span class="op" id="2940569">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940573">return</span>&nbsp;<span class="ident" id="2940580">s</span><span class="op" id="2940581">[</span><span class="builtinfunc" id="2940582">len</span><span class="op" id="2940585">(</span><span class="ident" id="2940586">prefix</span><span class="op" id="2940592">)</span><span class="op" id="2940593">:</span><span class="op" id="2940594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940600">return</span>&nbsp;<span class="ident" id="2940607">s</span><br>
<span class="lineno"></span><span class="op" id="2940609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2940612">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2940681">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2940739">func</span>&nbsp;<span class="ident" id="2940744">TrimSuffix</span><span class="op" id="2940754">(</span><span class="ident" id="2940755">s</span><span class="op" id="2940756">,</span>&nbsp;<span class="ident" id="2940758">suffix</span>&nbsp;<span class="builtintype" id="2940765">string</span><span class="op" id="2940771">)</span>&nbsp;<span class="builtintype" id="2940773">string</span>&nbsp;<span class="op" id="2940780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940783">if</span>&nbsp;<span class="ident" id="2940786">HasSuffix</span><span class="op" id="2940795">(</span><span class="ident" id="2940796">s</span><span class="op" id="2940797">,</span>&nbsp;<span class="ident" id="2940799">suffix</span><span class="op" id="2940805">)</span>&nbsp;<span class="op" id="2940807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940811">return</span>&nbsp;<span class="ident" id="2940818">s</span><span class="op" id="2940819">[</span><span class="op" id="2940820">:</span><span class="builtinfunc" id="2940821">len</span><span class="op" id="2940824">(</span><span class="ident" id="2940825">s</span><span class="op" id="2940826">)</span><span class="op" id="2940827">-</span><span class="builtinfunc" id="2940828">len</span><span class="op" id="2940831">(</span><span class="ident" id="2940832">suffix</span><span class="op" id="2940838">)</span><span class="op" id="2940839">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940845">return</span>&nbsp;<span class="ident" id="2940852">s</span><br>
<span class="lineno"></span><span class="op" id="2940854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2940857">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2940916">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2940969">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2941031">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2941097">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2941121">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2941183">func</span>&nbsp;<span class="ident" id="2941188">Replace</span><span class="op" id="2941195">(</span><span class="ident" id="2941196">s</span><span class="op" id="2941197">,</span>&nbsp;<span class="ident" id="2941199">old</span><span class="op" id="2941202">,</span>&nbsp;<span class="builtinfunc" id="2941204">new</span>&nbsp;<span class="builtintype" id="2941208">string</span><span class="op" id="2941214">,</span>&nbsp;<span class="ident" id="2941216">n</span>&nbsp;<span class="builtintype" id="2941218">int</span><span class="op" id="2941221">)</span>&nbsp;<span class="builtintype" id="2941223">string</span>&nbsp;<span class="op" id="2941230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941233">if</span>&nbsp;<span class="ident" id="2941236">old</span>&nbsp;<span class="op" id="2941240">==</span>&nbsp;<span class="builtinfunc" id="2941243">new</span>&nbsp;<span class="op" id="2941247">||</span>&nbsp;<span class="ident" id="2941250">n</span>&nbsp;<span class="op" id="2941252">==</span>&nbsp;<span class="num" id="2941255">0</span>&nbsp;<span class="op" id="2941257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941261">return</span>&nbsp;<span class="ident" id="2941268">s</span>&nbsp;<span class="comment" id="2941270">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2941295">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941331">if</span>&nbsp;<span class="ident" id="2941334">m</span>&nbsp;<span class="op" id="2941336">:=</span>&nbsp;<span class="ident" id="2941339">Count</span><span class="op" id="2941344">(</span><span class="ident" id="2941345">s</span><span class="op" id="2941346">,</span>&nbsp;<span class="ident" id="2941348">old</span><span class="op" id="2941351">)</span><span class="op" id="2941352">;</span>&nbsp;<span class="ident" id="2941354">m</span>&nbsp;<span class="op" id="2941356">==</span>&nbsp;<span class="num" id="2941359">0</span>&nbsp;<span class="op" id="2941361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941365">return</span>&nbsp;<span class="ident" id="2941372">s</span>&nbsp;<span class="comment" id="2941374">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941395">}</span>&nbsp;<span class="keyword" id="2941397">else</span>&nbsp;<span class="keyword" id="2941402">if</span>&nbsp;<span class="ident" id="2941405">n</span>&nbsp;<span class="op" id="2941407">&lt;</span>&nbsp;<span class="num" id="2941409">0</span>&nbsp;<span class="op" id="2941411">||</span>&nbsp;<span class="ident" id="2941414">m</span>&nbsp;<span class="op" id="2941416">&lt;</span>&nbsp;<span class="ident" id="2941418">n</span>&nbsp;<span class="op" id="2941420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941424">n</span>&nbsp;<span class="op" id="2941426">=</span>&nbsp;<span class="ident" id="2941428">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2941435">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941469">t</span>&nbsp;<span class="op" id="2941471">:=</span>&nbsp;<span class="builtinfunc" id="2941474">make</span><span class="op" id="2941478">(</span><span class="op" id="2941479">[</span><span class="op" id="2941480">]</span><span class="builtintype" id="2941481">byte</span><span class="op" id="2941485">,</span>&nbsp;<span class="builtinfunc" id="2941487">len</span><span class="op" id="2941490">(</span><span class="ident" id="2941491">s</span><span class="op" id="2941492">)</span><span class="op" id="2941493">+</span><span class="ident" id="2941494">n</span><span class="op" id="2941495">*</span><span class="op" id="2941496">(</span><span class="builtinfunc" id="2941497">len</span><span class="op" id="2941500">(</span><span class="builtinfunc" id="2941501">new</span><span class="op" id="2941504">)</span><span class="op" id="2941505">-</span><span class="builtinfunc" id="2941506">len</span><span class="op" id="2941509">(</span><span class="ident" id="2941510">old</span><span class="op" id="2941513">)</span><span class="op" id="2941514">)</span><span class="op" id="2941515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941518">w</span>&nbsp;<span class="op" id="2941520">:=</span>&nbsp;<span class="num" id="2941523">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941526">start</span>&nbsp;<span class="op" id="2941532">:=</span>&nbsp;<span class="num" id="2941535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941538">for</span>&nbsp;<span class="ident" id="2941542">i</span>&nbsp;<span class="op" id="2941544">:=</span>&nbsp;<span class="num" id="2941547">0</span><span class="op" id="2941548">;</span>&nbsp;<span class="ident" id="2941550">i</span>&nbsp;<span class="op" id="2941552">&lt;</span>&nbsp;<span class="ident" id="2941554">n</span><span class="op" id="2941555">;</span>&nbsp;<span class="ident" id="2941557">i</span><span class="op" id="2941558">++</span>&nbsp;<span class="op" id="2941561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941565">j</span>&nbsp;<span class="op" id="2941567">:=</span>&nbsp;<span class="ident" id="2941570">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941578">if</span>&nbsp;<span class="builtinfunc" id="2941581">len</span><span class="op" id="2941584">(</span><span class="ident" id="2941585">old</span><span class="op" id="2941588">)</span>&nbsp;<span class="op" id="2941590">==</span>&nbsp;<span class="num" id="2941593">0</span>&nbsp;<span class="op" id="2941595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941600">if</span>&nbsp;<span class="ident" id="2941603">i</span>&nbsp;<span class="op" id="2941605">&gt;</span>&nbsp;<span class="num" id="2941607">0</span>&nbsp;<span class="op" id="2941609">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941615">_</span><span class="op" id="2941616">,</span>&nbsp;<span class="ident" id="2941618">wid</span>&nbsp;<span class="op" id="2941622">:=</span>&nbsp;<span class="ident" id="2941625">utf8</span><span class="op" id="2941629">.</span><span class="ident" id="2941630">DecodeRuneInString</span><span class="op" id="2941648">(</span><span class="ident" id="2941649">s</span><span class="op" id="2941650">[</span><span class="ident" id="2941651">start</span><span class="op" id="2941656">:</span><span class="op" id="2941657">]</span><span class="op" id="2941658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941664">j</span>&nbsp;<span class="op" id="2941666">+=</span>&nbsp;<span class="ident" id="2941669">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941680">}</span>&nbsp;<span class="keyword" id="2941682">else</span>&nbsp;<span class="op" id="2941687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941692">j</span>&nbsp;<span class="op" id="2941694">+=</span>&nbsp;<span class="ident" id="2941697">Index</span><span class="op" id="2941702">(</span><span class="ident" id="2941703">s</span><span class="op" id="2941704">[</span><span class="ident" id="2941705">start</span><span class="op" id="2941710">:</span><span class="op" id="2941711">]</span><span class="op" id="2941712">,</span>&nbsp;<span class="ident" id="2941714">old</span><span class="op" id="2941717">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941725">w</span>&nbsp;<span class="op" id="2941727">+=</span>&nbsp;<span class="builtinfunc" id="2941730">copy</span><span class="op" id="2941734">(</span><span class="ident" id="2941735">t</span><span class="op" id="2941736">[</span><span class="ident" id="2941737">w</span><span class="op" id="2941738">:</span><span class="op" id="2941739">]</span><span class="op" id="2941740">,</span>&nbsp;<span class="ident" id="2941742">s</span><span class="op" id="2941743">[</span><span class="ident" id="2941744">start</span><span class="op" id="2941749">:</span><span class="ident" id="2941750">j</span><span class="op" id="2941751">]</span><span class="op" id="2941752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941756">w</span>&nbsp;<span class="op" id="2941758">+=</span>&nbsp;<span class="builtinfunc" id="2941761">copy</span><span class="op" id="2941765">(</span><span class="ident" id="2941766">t</span><span class="op" id="2941767">[</span><span class="ident" id="2941768">w</span><span class="op" id="2941769">:</span><span class="op" id="2941770">]</span><span class="op" id="2941771">,</span>&nbsp;<span class="builtinfunc" id="2941773">new</span><span class="op" id="2941776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941780">start</span>&nbsp;<span class="op" id="2941786">=</span>&nbsp;<span class="ident" id="2941788">j</span>&nbsp;<span class="op" id="2941790">+</span>&nbsp;<span class="builtinfunc" id="2941792">len</span><span class="op" id="2941795">(</span><span class="ident" id="2941796">old</span><span class="op" id="2941799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941802">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941805">w</span>&nbsp;<span class="op" id="2941807">+=</span>&nbsp;<span class="builtinfunc" id="2941810">copy</span><span class="op" id="2941814">(</span><span class="ident" id="2941815">t</span><span class="op" id="2941816">[</span><span class="ident" id="2941817">w</span><span class="op" id="2941818">:</span><span class="op" id="2941819">]</span><span class="op" id="2941820">,</span>&nbsp;<span class="ident" id="2941822">s</span><span class="op" id="2941823">[</span><span class="ident" id="2941824">start</span><span class="op" id="2941829">:</span><span class="op" id="2941830">]</span><span class="op" id="2941831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941834">return</span>&nbsp;<span class="builtintype" id="2941841">string</span><span class="op" id="2941847">(</span><span class="ident" id="2941848">t</span><span class="op" id="2941849">[</span><span class="num" id="2941850">0</span><span class="op" id="2941851">:</span><span class="ident" id="2941852">w</span><span class="op" id="2941853">]</span><span class="op" id="2941854">)</span><br>
<span class="lineno"></span><span class="op" id="2941856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2941859">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2941927">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2941968">func</span>&nbsp;<span class="ident" id="2941973">EqualFold</span><span class="op" id="2941982">(</span><span class="ident" id="2941983">s</span><span class="op" id="2941984">,</span>&nbsp;<span class="ident" id="2941986">t</span>&nbsp;<span class="builtintype" id="2941988">string</span><span class="op" id="2941994">)</span>&nbsp;<span class="builtintype" id="2941996">bool</span>&nbsp;<span class="op" id="2942001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942004">for</span>&nbsp;<span class="ident" id="2942008">s</span>&nbsp;<span class="op" id="2942010">!=</span>&nbsp;<span class="string" id="2942013">&#34;&#34;</span>&nbsp;<span class="op" id="2942016">&amp;&amp;</span>&nbsp;<span class="ident" id="2942019">t</span>&nbsp;<span class="op" id="2942021">!=</span>&nbsp;<span class="string" id="2942024">&#34;&#34;</span>&nbsp;<span class="op" id="2942027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942031">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942073">var</span>&nbsp;<span class="ident" id="2942077">sr</span><span class="op" id="2942079">,</span>&nbsp;<span class="ident" id="2942081">tr</span>&nbsp;<span class="builtintype" id="2942084">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942091">if</span>&nbsp;<span class="ident" id="2942094">s</span><span class="op" id="2942095">[</span><span class="num" id="2942096">0</span><span class="op" id="2942097">]</span>&nbsp;<span class="op" id="2942099">&lt;</span>&nbsp;<span class="ident" id="2942101">utf8</span><span class="op" id="2942105">.</span><span class="ident" id="2942106">RuneSelf</span>&nbsp;<span class="op" id="2942115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942120">sr</span><span class="op" id="2942122">,</span>&nbsp;<span class="ident" id="2942124">s</span>&nbsp;<span class="op" id="2942126">=</span>&nbsp;<span class="builtintype" id="2942128">rune</span><span class="op" id="2942132">(</span><span class="ident" id="2942133">s</span><span class="op" id="2942134">[</span><span class="num" id="2942135">0</span><span class="op" id="2942136">]</span><span class="op" id="2942137">)</span><span class="op" id="2942138">,</span>&nbsp;<span class="ident" id="2942140">s</span><span class="op" id="2942141">[</span><span class="num" id="2942142">1</span><span class="op" id="2942143">:</span><span class="op" id="2942144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942148">}</span>&nbsp;<span class="keyword" id="2942150">else</span>&nbsp;<span class="op" id="2942155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942160">r</span><span class="op" id="2942161">,</span>&nbsp;<span class="ident" id="2942163">size</span>&nbsp;<span class="op" id="2942168">:=</span>&nbsp;<span class="ident" id="2942171">utf8</span><span class="op" id="2942175">.</span><span class="ident" id="2942176">DecodeRuneInString</span><span class="op" id="2942194">(</span><span class="ident" id="2942195">s</span><span class="op" id="2942196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942201">sr</span><span class="op" id="2942203">,</span>&nbsp;<span class="ident" id="2942205">s</span>&nbsp;<span class="op" id="2942207">=</span>&nbsp;<span class="ident" id="2942209">r</span><span class="op" id="2942210">,</span>&nbsp;<span class="ident" id="2942212">s</span><span class="op" id="2942213">[</span><span class="ident" id="2942214">size</span><span class="op" id="2942218">:</span><span class="op" id="2942219">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942227">if</span>&nbsp;<span class="ident" id="2942230">t</span><span class="op" id="2942231">[</span><span class="num" id="2942232">0</span><span class="op" id="2942233">]</span>&nbsp;<span class="op" id="2942235">&lt;</span>&nbsp;<span class="ident" id="2942237">utf8</span><span class="op" id="2942241">.</span><span class="ident" id="2942242">RuneSelf</span>&nbsp;<span class="op" id="2942251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942256">tr</span><span class="op" id="2942258">,</span>&nbsp;<span class="ident" id="2942260">t</span>&nbsp;<span class="op" id="2942262">=</span>&nbsp;<span class="builtintype" id="2942264">rune</span><span class="op" id="2942268">(</span><span class="ident" id="2942269">t</span><span class="op" id="2942270">[</span><span class="num" id="2942271">0</span><span class="op" id="2942272">]</span><span class="op" id="2942273">)</span><span class="op" id="2942274">,</span>&nbsp;<span class="ident" id="2942276">t</span><span class="op" id="2942277">[</span><span class="num" id="2942278">1</span><span class="op" id="2942279">:</span><span class="op" id="2942280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942284">}</span>&nbsp;<span class="keyword" id="2942286">else</span>&nbsp;<span class="op" id="2942291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942296">r</span><span class="op" id="2942297">,</span>&nbsp;<span class="ident" id="2942299">size</span>&nbsp;<span class="op" id="2942304">:=</span>&nbsp;<span class="ident" id="2942307">utf8</span><span class="op" id="2942311">.</span><span class="ident" id="2942312">DecodeRuneInString</span><span class="op" id="2942330">(</span><span class="ident" id="2942331">t</span><span class="op" id="2942332">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942337">tr</span><span class="op" id="2942339">,</span>&nbsp;<span class="ident" id="2942341">t</span>&nbsp;<span class="op" id="2942343">=</span>&nbsp;<span class="ident" id="2942345">r</span><span class="op" id="2942346">,</span>&nbsp;<span class="ident" id="2942348">t</span><span class="op" id="2942349">[</span><span class="ident" id="2942350">size</span><span class="op" id="2942354">:</span><span class="op" id="2942355">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942364">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942419">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942435">if</span>&nbsp;<span class="ident" id="2942438">tr</span>&nbsp;<span class="op" id="2942441">==</span>&nbsp;<span class="ident" id="2942444">sr</span>&nbsp;<span class="op" id="2942447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942452">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942468">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942512">if</span>&nbsp;<span class="ident" id="2942515">tr</span>&nbsp;<span class="op" id="2942518">&lt;</span>&nbsp;<span class="ident" id="2942520">sr</span>&nbsp;<span class="op" id="2942523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942528">tr</span><span class="op" id="2942530">,</span>&nbsp;<span class="ident" id="2942532">sr</span>&nbsp;<span class="op" id="2942535">=</span>&nbsp;<span class="ident" id="2942537">sr</span><span class="op" id="2942539">,</span>&nbsp;<span class="ident" id="2942541">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942550">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942577">if</span>&nbsp;<span class="ident" id="2942580">tr</span>&nbsp;<span class="op" id="2942583">&lt;</span>&nbsp;<span class="ident" id="2942585">utf8</span><span class="op" id="2942589">.</span><span class="ident" id="2942590">RuneSelf</span>&nbsp;<span class="op" id="2942599">&amp;&amp;</span>&nbsp;<span class="string" id="2942602">&#39;A&#39;</span>&nbsp;<span class="op" id="2942606">&lt;=</span>&nbsp;<span class="ident" id="2942609">sr</span>&nbsp;<span class="op" id="2942612">&amp;&amp;</span>&nbsp;<span class="ident" id="2942615">sr</span>&nbsp;<span class="op" id="2942618">&lt;=</span>&nbsp;<span class="string" id="2942621">&#39;Z&#39;</span>&nbsp;<span class="op" id="2942625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942630">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942689">if</span>&nbsp;<span class="ident" id="2942692">tr</span>&nbsp;<span class="op" id="2942695">==</span>&nbsp;<span class="ident" id="2942698">sr</span><span class="op" id="2942700">+</span><span class="string" id="2942701">&#39;a&#39;</span><span class="op" id="2942704">-</span><span class="string" id="2942705">&#39;A&#39;</span>&nbsp;<span class="op" id="2942709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942715">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942727">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942732">return</span>&nbsp;<span class="builtintype" id="2942739">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942752">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2942823">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942863">r</span>&nbsp;<span class="op" id="2942865">:=</span>&nbsp;<span class="ident" id="2942868">unicode</span><span class="op" id="2942875">.</span><span class="ident" id="2942876">SimpleFold</span><span class="op" id="2942886">(</span><span class="ident" id="2942887">sr</span><span class="op" id="2942889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942893">for</span>&nbsp;<span class="ident" id="2942897">r</span>&nbsp;<span class="op" id="2942899">!=</span>&nbsp;<span class="ident" id="2942902">sr</span>&nbsp;<span class="op" id="2942905">&amp;&amp;</span>&nbsp;<span class="ident" id="2942908">r</span>&nbsp;<span class="op" id="2942910">&lt;</span>&nbsp;<span class="ident" id="2942912">tr</span>&nbsp;<span class="op" id="2942915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2942920">r</span>&nbsp;<span class="op" id="2942922">=</span>&nbsp;<span class="ident" id="2942924">unicode</span><span class="op" id="2942931">.</span><span class="ident" id="2942932">SimpleFold</span><span class="op" id="2942942">(</span><span class="ident" id="2942943">r</span><span class="op" id="2942944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942952">if</span>&nbsp;<span class="ident" id="2942955">r</span>&nbsp;<span class="op" id="2942957">==</span>&nbsp;<span class="ident" id="2942960">tr</span>&nbsp;<span class="op" id="2942963">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942968">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2942983">return</span>&nbsp;<span class="builtintype" id="2942990">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2942997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2943001">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2943037">return</span>&nbsp;<span class="ident" id="2943044">s</span>&nbsp;<span class="op" id="2943046">==</span>&nbsp;<span class="ident" id="2943049">t</span><br>
<span class="lineno"></span><span class="op" id="2943051">}</span>
</div>
</body>
</html>
