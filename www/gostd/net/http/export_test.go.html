<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8337299">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8337355">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8337409">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8337460">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="8337529">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337542">package</span>&nbsp;<span class="ident" id="8337550">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8337556">import</span>&nbsp;<span class="op" id="8337563">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8337566">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8337573">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8337584">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8337591">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8337594">func</span>&nbsp;<span class="ident" id="8337599">NewLoggingConn</span><span class="op" id="8337613">(</span><span class="ident" id="8337614">baseName</span>&nbsp;<span class="builtintype" id="8337623">string</span><span class="op" id="8337629">,</span>&nbsp;<span class="ident" id="8337631">c</span>&nbsp;<span class="ident" id="8337633">net</span><span class="op" id="8337636">.</span><span class="ident" id="8337637">Conn</span><span class="op" id="8337641">)</span>&nbsp;<span class="ident" id="8337643">net</span><span class="op" id="8337646">.</span><span class="ident" id="8337647">Conn</span>&nbsp;<span class="op" id="8337652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337655">return</span>&nbsp;<span class="ident" id="8337662">newLoggingConn</span><span class="op" id="8337676">(</span><span class="ident" id="8337677">baseName</span><span class="op" id="8337685">,</span>&nbsp;<span class="ident" id="8337687">c</span><span class="op" id="8337688">)</span><br>
<span class="lineno"></span><span class="op" id="8337690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8337693">var</span>&nbsp;<span class="ident" id="8337697">ExportAppendTime</span>&nbsp;<span class="op" id="8337714">=</span>&nbsp;<span class="ident" id="8337716">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337728">func</span>&nbsp;<span class="op" id="8337733">(</span><span class="ident" id="8337734">t</span>&nbsp;<span class="op" id="8337736">*</span><span class="ident" id="8337737">Transport</span><span class="op" id="8337746">)</span>&nbsp;<span class="ident" id="8337748">NumPendingRequestsForTesting</span><span class="op" id="8337776">(</span><span class="op" id="8337777">)</span>&nbsp;<span class="builtintype" id="8337779">int</span>&nbsp;<span class="op" id="8337783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337786">t</span><span class="op" id="8337787">.</span><span class="ident" id="8337788">reqMu</span><span class="op" id="8337793">.</span><span class="ident" id="8337794">Lock</span><span class="op" id="8337798">(</span><span class="op" id="8337799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337802">defer</span>&nbsp;<span class="ident" id="8337808">t</span><span class="op" id="8337809">.</span><span class="ident" id="8337810">reqMu</span><span class="op" id="8337815">.</span><span class="ident" id="8337816">Unlock</span><span class="op" id="8337822">(</span><span class="op" id="8337823">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337826">return</span>&nbsp;<span class="builtinfunc" id="8337833">len</span><span class="op" id="8337836">(</span><span class="ident" id="8337837">t</span><span class="op" id="8337838">.</span><span class="ident" id="8337839">reqCanceler</span><span class="op" id="8337850">)</span><br>
<span class="lineno"></span><span class="op" id="8337852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337855">func</span>&nbsp;<span class="op" id="8337860">(</span><span class="ident" id="8337861">t</span>&nbsp;<span class="op" id="8337863">*</span><span class="ident" id="8337864">Transport</span><span class="op" id="8337873">)</span>&nbsp;<span class="ident" id="8337875">IdleConnKeysForTesting</span><span class="op" id="8337897">(</span><span class="op" id="8337898">)</span>&nbsp;<span class="op" id="8337900">(</span><span class="ident" id="8337901">keys</span>&nbsp;<span class="op" id="8337906">[</span><span class="op" id="8337907">]</span><span class="builtintype" id="8337908">string</span><span class="op" id="8337914">)</span>&nbsp;<span class="op" id="8337916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337919">keys</span>&nbsp;<span class="op" id="8337924">=</span>&nbsp;<span class="builtinfunc" id="8337926">make</span><span class="op" id="8337930">(</span><span class="op" id="8337931">[</span><span class="op" id="8337932">]</span><span class="builtintype" id="8337933">string</span><span class="op" id="8337939">,</span>&nbsp;<span class="num" id="8337941">0</span><span class="op" id="8337942">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337945">t</span><span class="op" id="8337946">.</span><span class="ident" id="8337947">idleMu</span><span class="op" id="8337953">.</span><span class="ident" id="8337954">Lock</span><span class="op" id="8337958">(</span><span class="op" id="8337959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337962">defer</span>&nbsp;<span class="ident" id="8337968">t</span><span class="op" id="8337969">.</span><span class="ident" id="8337970">idleMu</span><span class="op" id="8337976">.</span><span class="ident" id="8337977">Unlock</span><span class="op" id="8337983">(</span><span class="op" id="8337984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337987">if</span>&nbsp;<span class="ident" id="8337990">t</span><span class="op" id="8337991">.</span><span class="ident" id="8337992">idleConn</span>&nbsp;<span class="op" id="8338001">==</span>&nbsp;<span class="ident" id="8338004">nil</span>&nbsp;<span class="op" id="8338008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338012">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338020">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338023">for</span>&nbsp;<span class="ident" id="8338027">key</span>&nbsp;<span class="op" id="8338031">:=</span>&nbsp;<span class="keyword" id="8338034">range</span>&nbsp;<span class="ident" id="8338040">t</span><span class="op" id="8338041">.</span><span class="ident" id="8338042">idleConn</span>&nbsp;<span class="op" id="8338051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338055">keys</span>&nbsp;<span class="op" id="8338060">=</span>&nbsp;<span class="builtinfunc" id="8338062">append</span><span class="op" id="8338068">(</span><span class="ident" id="8338069">keys</span><span class="op" id="8338073">,</span>&nbsp;<span class="ident" id="8338075">key</span><span class="op" id="8338078">.</span><span class="ident" id="8338079">String</span><span class="op" id="8338085">(</span><span class="op" id="8338086">)</span><span class="op" id="8338087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338093">return</span><br>
<span class="lineno"></span><span class="op" id="8338100">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8338103">func</span>&nbsp;<span class="op" id="8338108">(</span><span class="ident" id="8338109">t</span>&nbsp;<span class="op" id="8338111">*</span><span class="ident" id="8338112">Transport</span><span class="op" id="8338121">)</span>&nbsp;<span class="ident" id="8338123">IdleConnCountForTesting</span><span class="op" id="8338146">(</span><span class="ident" id="8338147">cacheKey</span>&nbsp;<span class="builtintype" id="8338156">string</span><span class="op" id="8338162">)</span>&nbsp;<span class="builtintype" id="8338164">int</span>&nbsp;<span class="op" id="8338168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338171">t</span><span class="op" id="8338172">.</span><span class="ident" id="8338173">idleMu</span><span class="op" id="8338179">.</span><span class="ident" id="8338180">Lock</span><span class="op" id="8338184">(</span><span class="op" id="8338185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338188">defer</span>&nbsp;<span class="ident" id="8338194">t</span><span class="op" id="8338195">.</span><span class="ident" id="8338196">idleMu</span><span class="op" id="8338202">.</span><span class="ident" id="8338203">Unlock</span><span class="op" id="8338209">(</span><span class="op" id="8338210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338213">if</span>&nbsp;<span class="ident" id="8338216">t</span><span class="op" id="8338217">.</span><span class="ident" id="8338218">idleConn</span>&nbsp;<span class="op" id="8338227">==</span>&nbsp;<span class="ident" id="8338230">nil</span>&nbsp;<span class="op" id="8338234">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338238">return</span>&nbsp;<span class="num" id="8338245">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338251">for</span>&nbsp;<span class="ident" id="8338255">k</span><span class="op" id="8338256">,</span>&nbsp;<span class="ident" id="8338258">conns</span>&nbsp;<span class="op" id="8338264">:=</span>&nbsp;<span class="keyword" id="8338267">range</span>&nbsp;<span class="ident" id="8338273">t</span><span class="op" id="8338274">.</span><span class="ident" id="8338275">idleConn</span>&nbsp;<span class="op" id="8338284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338288">if</span>&nbsp;<span class="ident" id="8338291">k</span><span class="op" id="8338292">.</span><span class="ident" id="8338293">String</span><span class="op" id="8338299">(</span><span class="op" id="8338300">)</span>&nbsp;<span class="op" id="8338302">==</span>&nbsp;<span class="ident" id="8338305">cacheKey</span>&nbsp;<span class="op" id="8338314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338319">return</span>&nbsp;<span class="builtinfunc" id="8338326">len</span><span class="op" id="8338329">(</span><span class="ident" id="8338330">conns</span><span class="op" id="8338335">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338345">return</span>&nbsp;<span class="num" id="8338352">0</span><br>
<span class="lineno"></span><span class="op" id="8338354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8338357">func</span>&nbsp;<span class="op" id="8338362">(</span><span class="ident" id="8338363">t</span>&nbsp;<span class="op" id="8338365">*</span><span class="ident" id="8338366">Transport</span><span class="op" id="8338375">)</span>&nbsp;<span class="ident" id="8338377">IdleConnChMapSizeForTesting</span><span class="op" id="8338404">(</span><span class="op" id="8338405">)</span>&nbsp;<span class="builtintype" id="8338407">int</span>&nbsp;<span class="op" id="8338411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338414">t</span><span class="op" id="8338415">.</span><span class="ident" id="8338416">idleMu</span><span class="op" id="8338422">.</span><span class="ident" id="8338423">Lock</span><span class="op" id="8338427">(</span><span class="op" id="8338428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338431">defer</span>&nbsp;<span class="ident" id="8338437">t</span><span class="op" id="8338438">.</span><span class="ident" id="8338439">idleMu</span><span class="op" id="8338445">.</span><span class="ident" id="8338446">Unlock</span><span class="op" id="8338452">(</span><span class="op" id="8338453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338456">return</span>&nbsp;<span class="builtinfunc" id="8338463">len</span><span class="op" id="8338466">(</span><span class="ident" id="8338467">t</span><span class="op" id="8338468">.</span><span class="ident" id="8338469">idleConnCh</span><span class="op" id="8338479">)</span><br>
<span class="lineno"></span><span class="op" id="8338481">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="8338484">func</span>&nbsp;<span class="op" id="8338489">(</span><span class="ident" id="8338490">t</span>&nbsp;<span class="op" id="8338492">*</span><span class="ident" id="8338493">Transport</span><span class="op" id="8338502">)</span>&nbsp;<span class="ident" id="8338504">IsIdleForTesting</span><span class="op" id="8338520">(</span><span class="op" id="8338521">)</span>&nbsp;<span class="builtintype" id="8338523">bool</span>&nbsp;<span class="op" id="8338528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338531">t</span><span class="op" id="8338532">.</span><span class="ident" id="8338533">idleMu</span><span class="op" id="8338539">.</span><span class="ident" id="8338540">Lock</span><span class="op" id="8338544">(</span><span class="op" id="8338545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338548">defer</span>&nbsp;<span class="ident" id="8338554">t</span><span class="op" id="8338555">.</span><span class="ident" id="8338556">idleMu</span><span class="op" id="8338562">.</span><span class="ident" id="8338563">Unlock</span><span class="op" id="8338569">(</span><span class="op" id="8338570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338573">return</span>&nbsp;<span class="ident" id="8338580">t</span><span class="op" id="8338581">.</span><span class="ident" id="8338582">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="8338591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8338594">func</span>&nbsp;<span class="op" id="8338599">(</span><span class="ident" id="8338600">t</span>&nbsp;<span class="op" id="8338602">*</span><span class="ident" id="8338603">Transport</span><span class="op" id="8338612">)</span>&nbsp;<span class="ident" id="8338614">RequestIdleConnChForTesting</span><span class="op" id="8338641">(</span><span class="op" id="8338642">)</span>&nbsp;<span class="op" id="8338644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338647">t</span><span class="op" id="8338648">.</span><span class="ident" id="8338649">getIdleConnCh</span><span class="op" id="8338662">(</span><span class="ident" id="8338663">connectMethod</span><span class="op" id="8338676">{</span><span class="ident" id="8338677">nil</span><span class="op" id="8338680">,</span>&nbsp;<span class="string" id="8338682">&#34;http&#34;</span><span class="op" id="8338688">,</span>&nbsp;<span class="string" id="8338690">&#34;example.com&#34;</span><span class="op" id="8338703">}</span><span class="op" id="8338704">)</span><br>
<span class="lineno"></span><span class="op" id="8338706">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8338709">func</span>&nbsp;<span class="op" id="8338714">(</span><span class="ident" id="8338715">t</span>&nbsp;<span class="op" id="8338717">*</span><span class="ident" id="8338718">Transport</span><span class="op" id="8338727">)</span>&nbsp;<span class="ident" id="8338729">PutIdleTestConn</span><span class="op" id="8338744">(</span><span class="op" id="8338745">)</span>&nbsp;<span class="builtintype" id="8338747">bool</span>&nbsp;<span class="op" id="8338752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338755">c</span><span class="op" id="8338756">,</span>&nbsp;<span class="ident" id="8338758">_</span>&nbsp;<span class="op" id="8338760">:=</span>&nbsp;<span class="ident" id="8338763">net</span><span class="op" id="8338766">.</span><span class="ident" id="8338767">Pipe</span><span class="op" id="8338771">(</span><span class="op" id="8338772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338775">return</span>&nbsp;<span class="ident" id="8338782">t</span><span class="op" id="8338783">.</span><span class="ident" id="8338784">putIdleConn</span><span class="op" id="8338795">(</span><span class="op" id="8338796">&amp;</span><span class="ident" id="8338797">persistConn</span><span class="op" id="8338808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338812">t</span><span class="op" id="8338813">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8338822">t</span><span class="op" id="8338823">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338827">conn</span><span class="op" id="8338831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8338837">c</span><span class="op" id="8338838">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8338858">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338869">closech</span><span class="op" id="8338876">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="8338879">make</span><span class="op" id="8338883">(</span><span class="keyword" id="8338884">chan</span>&nbsp;<span class="keyword" id="8338889">struct</span><span class="op" id="8338895">{</span><span class="op" id="8338896">}</span><span class="op" id="8338897">)</span><span class="op" id="8338898">,</span>&nbsp;<span class="comment" id="8338900">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338925">cacheKey</span><span class="op" id="8338933">:</span>&nbsp;<span class="ident" id="8338935">connectMethodKey</span><span class="op" id="8338951">{</span><span class="string" id="8338952">&#34;&#34;</span><span class="op" id="8338954">,</span>&nbsp;<span class="string" id="8338956">&#34;http&#34;</span><span class="op" id="8338962">,</span>&nbsp;<span class="string" id="8338964">&#34;example.com&#34;</span><span class="op" id="8338977">}</span><span class="op" id="8338978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338981">}</span><span class="op" id="8338982">)</span><br>
<span class="lineno"></span><span class="op" id="8338984">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8338987">func</span>&nbsp;<span class="ident" id="8338992">NewTestTimeoutHandler</span><span class="op" id="8339013">(</span><span class="ident" id="8339014">handler</span>&nbsp;<span class="ident" id="8339022">Handler</span><span class="op" id="8339029">,</span>&nbsp;<span class="ident" id="8339031">ch</span>&nbsp;<span class="op" id="8339034">&lt;-</span><span class="keyword" id="8339036">chan</span>&nbsp;<span class="ident" id="8339041">time</span><span class="op" id="8339045">.</span><span class="ident" id="8339046">Time</span><span class="op" id="8339050">)</span>&nbsp;<span class="ident" id="8339052">Handler</span>&nbsp;<span class="op" id="8339060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339063">f</span>&nbsp;<span class="op" id="8339065">:=</span>&nbsp;<span class="keyword" id="8339068">func</span><span class="op" id="8339072">(</span><span class="op" id="8339073">)</span>&nbsp;<span class="op" id="8339075">&lt;-</span><span class="keyword" id="8339077">chan</span>&nbsp;<span class="ident" id="8339082">time</span><span class="op" id="8339086">.</span><span class="ident" id="8339087">Time</span>&nbsp;<span class="op" id="8339092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339096">return</span>&nbsp;<span class="ident" id="8339103">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339107">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339110">return</span>&nbsp;<span class="op" id="8339117">&amp;</span><span class="ident" id="8339118">timeoutHandler</span><span class="op" id="8339132">{</span><span class="ident" id="8339133">handler</span><span class="op" id="8339140">,</span>&nbsp;<span class="ident" id="8339142">f</span><span class="op" id="8339143">,</span>&nbsp;<span class="string" id="8339145">&#34;&#34;</span><span class="op" id="8339147">}</span><br>
<span class="lineno"></span><span class="op" id="8339149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8339152">func</span>&nbsp;<span class="ident" id="8339157">ResetCachedEnvironment</span><span class="op" id="8339179">(</span><span class="op" id="8339180">)</span>&nbsp;<span class="op" id="8339182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339185">httpProxyEnv</span><span class="op" id="8339197">.</span><span class="ident" id="8339198">reset</span><span class="op" id="8339203">(</span><span class="op" id="8339204">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339207">httpsProxyEnv</span><span class="op" id="8339220">.</span><span class="ident" id="8339221">reset</span><span class="op" id="8339226">(</span><span class="op" id="8339227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339230">noProxyEnv</span><span class="op" id="8339240">.</span><span class="ident" id="8339241">reset</span><span class="op" id="8339246">(</span><span class="op" id="8339247">)</span><br>
<span class="lineno"></span><span class="op" id="8339249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8339252">var</span>&nbsp;<span class="ident" id="8339256">DefaultUserAgent</span>&nbsp;<span class="op" id="8339273">=</span>&nbsp;<span class="ident" id="8339275">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="8339293">func</span>&nbsp;<span class="ident" id="8339298">ExportRefererForURL</span><span class="op" id="8339317">(</span><span class="ident" id="8339318">lastReq</span><span class="op" id="8339325">,</span>&nbsp;<span class="ident" id="8339327">newReq</span>&nbsp;<span class="op" id="8339334">*</span><span class="ident" id="8339335">url</span><span class="op" id="8339338">.</span><span class="ident" id="8339339">URL</span><span class="op" id="8339342">)</span>&nbsp;<span class="builtintype" id="8339344">string</span>&nbsp;<span class="op" id="8339351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339354">return</span>&nbsp;<span class="ident" id="8339361">refererForURL</span><span class="op" id="8339374">(</span><span class="ident" id="8339375">lastReq</span><span class="op" id="8339382">,</span>&nbsp;<span class="ident" id="8339384">newReq</span><span class="op" id="8339390">)</span><br>
<span class="lineno"></span><span class="op" id="8339392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="8339395">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="8339468">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="8339486">func</span>&nbsp;<span class="ident" id="8339491">SetPendingDialHooks</span><span class="op" id="8339510">(</span><span class="ident" id="8339511">before</span><span class="op" id="8339517">,</span>&nbsp;<span class="ident" id="8339519">after</span>&nbsp;<span class="keyword" id="8339525">func</span><span class="op" id="8339529">(</span><span class="op" id="8339530">)</span><span class="op" id="8339531">)</span>&nbsp;<span class="op" id="8339533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339536">prePendingDial</span><span class="op" id="8339550">,</span>&nbsp;<span class="ident" id="8339552">postPendingDial</span>&nbsp;<span class="op" id="8339568">=</span>&nbsp;<span class="ident" id="8339570">before</span><span class="op" id="8339576">,</span>&nbsp;<span class="ident" id="8339578">after</span><br>
<span class="lineno"></span><span class="op" id="8339584">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8339587">var</span>&nbsp;<span class="ident" id="8339591">ExportServerNewConn</span>&nbsp;<span class="op" id="8339611">=</span>&nbsp;<span class="op" id="8339613">(</span><span class="op" id="8339614">*</span><span class="ident" id="8339615">Server</span><span class="op" id="8339621">)</span><span class="op" id="8339622">.</span><span class="ident" id="8339623">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8339632">var</span>&nbsp;<span class="ident" id="8339636">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="8339660">=</span>&nbsp;<span class="op" id="8339662">(</span><span class="op" id="8339663">*</span><span class="ident" id="8339664">conn</span><span class="op" id="8339668">)</span><span class="op" id="8339669">.</span><span class="ident" id="8339670">closeWriteAndWait</span>
</div>
</body>
</html>
