<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html" class="current">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7557128">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7557183">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7557237">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7557288">package</span>&nbsp;<span class="ident" id="7557296">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557301">import</span>&nbsp;<span class="op" id="7557308">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557311">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557320">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557326">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557339">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557352">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557358">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7557368">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7557371">//&nbsp;TODO(adg):&nbsp;a&nbsp;more&nbsp;sophisticated&nbsp;test&nbsp;suite</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557418">type</span>&nbsp;<span class="ident" id="7557423">WriteTest</span>&nbsp;<span class="keyword" id="7557433">struct</span>&nbsp;<span class="op" id="7557440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557443">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7557450">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557458">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7557465">[</span><span class="op" id="7557466">]</span><span class="builtintype" id="7557467">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557473">Method</span>&nbsp;<span class="builtintype" id="7557480">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557488">Mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7557495">os</span><span class="op" id="7557497">.</span><span class="ident" id="7557498">FileMode</span><br>
<span class="lineno"></span><span class="op" id="7557507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7557510">var</span>&nbsp;<span class="ident" id="7557514">writeTests</span>&nbsp;<span class="op" id="7557525">=</span>&nbsp;<span class="op" id="7557527">[</span><span class="op" id="7557528">]</span><span class="ident" id="7557529">WriteTest</span><span class="op" id="7557538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557545">Name</span><span class="op" id="7557549">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7557553">&#34;foo&#34;</span><span class="op" id="7557558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557562">Data</span><span class="op" id="7557566">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7557570">[</span><span class="op" id="7557571">]</span><span class="builtintype" id="7557572">byte</span><span class="op" id="7557576">(</span><span class="string" id="7557577">&#34;Rabbits,&nbsp;guinea&nbsp;pigs,&nbsp;gophers,&nbsp;marsupial&nbsp;rats,&nbsp;and&nbsp;quolls.&#34;</span><span class="op" id="7557637">)</span><span class="op" id="7557638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557642">Method</span><span class="op" id="7557648">:</span>&nbsp;<span class="ident" id="7557650">Store</span><span class="op" id="7557655">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557659">Mode</span><span class="op" id="7557663">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7557667">0666</span><span class="op" id="7557671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557674">}</span><span class="op" id="7557675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557682">Name</span><span class="op" id="7557686">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7557690">&#34;bar&#34;</span><span class="op" id="7557695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557699">Data</span><span class="op" id="7557703">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7557707">nil</span><span class="op" id="7557710">,</span>&nbsp;<span class="comment" id="7557712">//&nbsp;large&nbsp;data&nbsp;set&nbsp;in&nbsp;the&nbsp;test</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557744">Method</span><span class="op" id="7557750">:</span>&nbsp;<span class="ident" id="7557752">Deflate</span><span class="op" id="7557759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557763">Mode</span><span class="op" id="7557767">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7557771">0644</span><span class="op" id="7557775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557778">}</span><span class="op" id="7557779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557786">Name</span><span class="op" id="7557790">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7557794">&#34;setuid&#34;</span><span class="op" id="7557802">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557806">Data</span><span class="op" id="7557810">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7557814">[</span><span class="op" id="7557815">]</span><span class="builtintype" id="7557816">byte</span><span class="op" id="7557820">(</span><span class="string" id="7557821">&#34;setuid&nbsp;file&#34;</span><span class="op" id="7557834">)</span><span class="op" id="7557835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557839">Method</span><span class="op" id="7557845">:</span>&nbsp;<span class="ident" id="7557847">Deflate</span><span class="op" id="7557854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557858">Mode</span><span class="op" id="7557862">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7557866">0755</span>&nbsp;<span class="op" id="7557871">|</span>&nbsp;<span class="ident" id="7557873">os</span><span class="op" id="7557875">.</span><span class="ident" id="7557876">ModeSetuid</span><span class="op" id="7557886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557889">}</span><span class="op" id="7557890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557893">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557897">Name</span><span class="op" id="7557901">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7557905">&#34;setgid&#34;</span><span class="op" id="7557913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557917">Data</span><span class="op" id="7557921">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7557925">[</span><span class="op" id="7557926">]</span><span class="builtintype" id="7557927">byte</span><span class="op" id="7557931">(</span><span class="string" id="7557932">&#34;setgid&nbsp;file&#34;</span><span class="op" id="7557945">)</span><span class="op" id="7557946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557950">Method</span><span class="op" id="7557956">:</span>&nbsp;<span class="ident" id="7557958">Deflate</span><span class="op" id="7557965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557969">Mode</span><span class="op" id="7557973">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7557977">0755</span>&nbsp;<span class="op" id="7557982">|</span>&nbsp;<span class="ident" id="7557984">os</span><span class="op" id="7557986">.</span><span class="ident" id="7557987">ModeSetgid</span><span class="op" id="7557997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558000">}</span><span class="op" id="7558001">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558008">Name</span><span class="op" id="7558012">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7558016">&#34;symlink&#34;</span><span class="op" id="7558025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558029">Data</span><span class="op" id="7558033">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7558037">[</span><span class="op" id="7558038">]</span><span class="builtintype" id="7558039">byte</span><span class="op" id="7558043">(</span><span class="string" id="7558044">&#34;../link/target&#34;</span><span class="op" id="7558060">)</span><span class="op" id="7558061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558065">Method</span><span class="op" id="7558071">:</span>&nbsp;<span class="ident" id="7558073">Deflate</span><span class="op" id="7558080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558084">Mode</span><span class="op" id="7558088">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7558092">0755</span>&nbsp;<span class="op" id="7558097">|</span>&nbsp;<span class="ident" id="7558099">os</span><span class="op" id="7558101">.</span><span class="ident" id="7558102">ModeSymlink</span><span class="op" id="7558113">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558116">}</span><span class="op" id="7558117">,</span><br>
<span class="lineno"></span><span class="op" id="7558119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7558122">func</span>&nbsp;<span class="ident" id="7558127">TestWriter</span><span class="op" id="7558137">(</span><span class="ident" id="7558138">t</span>&nbsp;<span class="op" id="7558140">*</span><span class="ident" id="7558141">testing</span><span class="op" id="7558148">.</span><span class="ident" id="7558149">T</span><span class="op" id="7558150">)</span>&nbsp;<span class="op" id="7558152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558155">largeData</span>&nbsp;<span class="op" id="7558165">:=</span>&nbsp;<span class="builtinfunc" id="7558168">make</span><span class="op" id="7558172">(</span><span class="op" id="7558173">[</span><span class="op" id="7558174">]</span><span class="builtintype" id="7558175">byte</span><span class="op" id="7558179">,</span>&nbsp;<span class="num" id="7558181">1</span><span class="op" id="7558182">&lt;&lt;</span><span class="num" id="7558184">17</span><span class="op" id="7558186">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558189">for</span>&nbsp;<span class="ident" id="7558193">i</span>&nbsp;<span class="op" id="7558195">:=</span>&nbsp;<span class="keyword" id="7558198">range</span>&nbsp;<span class="ident" id="7558204">largeData</span>&nbsp;<span class="op" id="7558214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558218">largeData</span><span class="op" id="7558227">[</span><span class="ident" id="7558228">i</span><span class="op" id="7558229">]</span>&nbsp;<span class="op" id="7558231">=</span>&nbsp;<span class="builtintype" id="7558233">byte</span><span class="op" id="7558237">(</span><span class="ident" id="7558238">rand</span><span class="op" id="7558242">.</span><span class="ident" id="7558243">Int</span><span class="op" id="7558246">(</span><span class="op" id="7558247">)</span><span class="op" id="7558248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558254">writeTests</span><span class="op" id="7558264">[</span><span class="num" id="7558265">1</span><span class="op" id="7558266">]</span><span class="op" id="7558267">.</span><span class="ident" id="7558268">Data</span>&nbsp;<span class="op" id="7558273">=</span>&nbsp;<span class="ident" id="7558275">largeData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558286">defer</span>&nbsp;<span class="keyword" id="7558292">func</span><span class="op" id="7558296">(</span><span class="op" id="7558297">)</span>&nbsp;<span class="op" id="7558299">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558303">writeTests</span><span class="op" id="7558313">[</span><span class="num" id="7558314">1</span><span class="op" id="7558315">]</span><span class="op" id="7558316">.</span><span class="ident" id="7558317">Data</span>&nbsp;<span class="op" id="7558322">=</span>&nbsp;<span class="ident" id="7558324">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558329">}</span><span class="op" id="7558330">(</span><span class="op" id="7558331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7558335">//&nbsp;write&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558356">buf</span>&nbsp;<span class="op" id="7558360">:=</span>&nbsp;<span class="builtinfunc" id="7558363">new</span><span class="op" id="7558366">(</span><span class="ident" id="7558367">bytes</span><span class="op" id="7558372">.</span><span class="ident" id="7558373">Buffer</span><span class="op" id="7558379">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558382">w</span>&nbsp;<span class="op" id="7558384">:=</span>&nbsp;<span class="ident" id="7558387">NewWriter</span><span class="op" id="7558396">(</span><span class="ident" id="7558397">buf</span><span class="op" id="7558400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558404">for</span>&nbsp;<span class="ident" id="7558408">_</span><span class="op" id="7558409">,</span>&nbsp;<span class="ident" id="7558411">wt</span>&nbsp;<span class="op" id="7558414">:=</span>&nbsp;<span class="keyword" id="7558417">range</span>&nbsp;<span class="ident" id="7558423">writeTests</span>&nbsp;<span class="op" id="7558434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558438">testCreate</span><span class="op" id="7558448">(</span><span class="ident" id="7558449">t</span><span class="op" id="7558450">,</span>&nbsp;<span class="ident" id="7558452">w</span><span class="op" id="7558453">,</span>&nbsp;<span class="op" id="7558455">&amp;</span><span class="ident" id="7558456">wt</span><span class="op" id="7558458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558461">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558465">if</span>&nbsp;<span class="ident" id="7558468">err</span>&nbsp;<span class="op" id="7558472">:=</span>&nbsp;<span class="ident" id="7558475">w</span><span class="op" id="7558476">.</span><span class="ident" id="7558477">Close</span><span class="op" id="7558482">(</span><span class="op" id="7558483">)</span><span class="op" id="7558484">;</span>&nbsp;<span class="ident" id="7558486">err</span>&nbsp;<span class="op" id="7558490">!=</span>&nbsp;<span class="ident" id="7558493">nil</span>&nbsp;<span class="op" id="7558497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558501">t</span><span class="op" id="7558502">.</span><span class="ident" id="7558503">Fatal</span><span class="op" id="7558508">(</span><span class="ident" id="7558509">err</span><span class="op" id="7558512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7558519">//&nbsp;read&nbsp;it&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558536">r</span><span class="op" id="7558537">,</span>&nbsp;<span class="ident" id="7558539">err</span>&nbsp;<span class="op" id="7558543">:=</span>&nbsp;<span class="ident" id="7558546">NewReader</span><span class="op" id="7558555">(</span><span class="ident" id="7558556">bytes</span><span class="op" id="7558561">.</span><span class="ident" id="7558562">NewReader</span><span class="op" id="7558571">(</span><span class="ident" id="7558572">buf</span><span class="op" id="7558575">.</span><span class="ident" id="7558576">Bytes</span><span class="op" id="7558581">(</span><span class="op" id="7558582">)</span><span class="op" id="7558583">)</span><span class="op" id="7558584">,</span>&nbsp;<span class="ident" id="7558586">int64</span><span class="op" id="7558591">(</span><span class="ident" id="7558592">buf</span><span class="op" id="7558595">.</span><span class="ident" id="7558596">Len</span><span class="op" id="7558599">(</span><span class="op" id="7558600">)</span><span class="op" id="7558601">)</span><span class="op" id="7558602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558605">if</span>&nbsp;<span class="ident" id="7558608">err</span>&nbsp;<span class="op" id="7558612">!=</span>&nbsp;<span class="ident" id="7558615">nil</span>&nbsp;<span class="op" id="7558619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558623">t</span><span class="op" id="7558624">.</span><span class="ident" id="7558625">Fatal</span><span class="op" id="7558630">(</span><span class="ident" id="7558631">err</span><span class="op" id="7558634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558637">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558640">for</span>&nbsp;<span class="ident" id="7558644">i</span><span class="op" id="7558645">,</span>&nbsp;<span class="ident" id="7558647">wt</span>&nbsp;<span class="op" id="7558650">:=</span>&nbsp;<span class="keyword" id="7558653">range</span>&nbsp;<span class="ident" id="7558659">writeTests</span>&nbsp;<span class="op" id="7558670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558674">testReadFile</span><span class="op" id="7558686">(</span><span class="ident" id="7558687">t</span><span class="op" id="7558688">,</span>&nbsp;<span class="ident" id="7558690">r</span><span class="op" id="7558691">.</span><span class="ident" id="7558692">File</span><span class="op" id="7558696">[</span><span class="ident" id="7558697">i</span><span class="op" id="7558698">]</span><span class="op" id="7558699">,</span>&nbsp;<span class="op" id="7558701">&amp;</span><span class="ident" id="7558702">wt</span><span class="op" id="7558704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558707">}</span><br>
<span class="lineno"></span><span class="op" id="7558709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7558712">func</span>&nbsp;<span class="ident" id="7558717">TestWriterFlush</span><span class="op" id="7558732">(</span><span class="ident" id="7558733">t</span>&nbsp;<span class="op" id="7558735">*</span><span class="ident" id="7558736">testing</span><span class="op" id="7558743">.</span><span class="ident" id="7558744">T</span><span class="op" id="7558745">)</span>&nbsp;<span class="op" id="7558747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558750">var</span>&nbsp;<span class="ident" id="7558754">buf</span>&nbsp;<span class="ident" id="7558758">bytes</span><span class="op" id="7558763">.</span><span class="ident" id="7558764">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558772">w</span>&nbsp;<span class="op" id="7558774">:=</span>&nbsp;<span class="ident" id="7558777">NewWriter</span><span class="op" id="7558786">(</span><span class="keyword" id="7558787">struct</span><span class="op" id="7558793">{</span>&nbsp;<span class="ident" id="7558795">io</span><span class="op" id="7558797">.</span><span class="ident" id="7558798">Writer</span>&nbsp;<span class="op" id="7558805">}</span><span class="op" id="7558806">{</span><span class="op" id="7558807">&amp;</span><span class="ident" id="7558808">buf</span><span class="op" id="7558811">}</span><span class="op" id="7558812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558815">_</span><span class="op" id="7558816">,</span>&nbsp;<span class="ident" id="7558818">err</span>&nbsp;<span class="op" id="7558822">:=</span>&nbsp;<span class="ident" id="7558825">w</span><span class="op" id="7558826">.</span><span class="ident" id="7558827">Create</span><span class="op" id="7558833">(</span><span class="string" id="7558834">&#34;foo&#34;</span><span class="op" id="7558839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558842">if</span>&nbsp;<span class="ident" id="7558845">err</span>&nbsp;<span class="op" id="7558849">!=</span>&nbsp;<span class="ident" id="7558852">nil</span>&nbsp;<span class="op" id="7558856">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558860">t</span><span class="op" id="7558861">.</span><span class="ident" id="7558862">Fatal</span><span class="op" id="7558867">(</span><span class="ident" id="7558868">err</span><span class="op" id="7558871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558877">if</span>&nbsp;<span class="ident" id="7558880">buf</span><span class="op" id="7558883">.</span><span class="ident" id="7558884">Len</span><span class="op" id="7558887">(</span><span class="op" id="7558888">)</span>&nbsp;<span class="op" id="7558890">&gt;</span>&nbsp;<span class="num" id="7558892">0</span>&nbsp;<span class="op" id="7558894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558898">t</span><span class="op" id="7558899">.</span><span class="ident" id="7558900">Fatalf</span><span class="op" id="7558906">(</span><span class="string" id="7558907">&#34;Unexpected&nbsp;%d&nbsp;bytes&nbsp;already&nbsp;in&nbsp;buffer&#34;</span><span class="op" id="7558946">,</span>&nbsp;<span class="ident" id="7558948">buf</span><span class="op" id="7558951">.</span><span class="ident" id="7558952">Len</span><span class="op" id="7558955">(</span><span class="op" id="7558956">)</span><span class="op" id="7558957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558960">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558963">if</span>&nbsp;<span class="ident" id="7558966">err</span>&nbsp;<span class="op" id="7558970">:=</span>&nbsp;<span class="ident" id="7558973">w</span><span class="op" id="7558974">.</span><span class="ident" id="7558975">Flush</span><span class="op" id="7558980">(</span><span class="op" id="7558981">)</span><span class="op" id="7558982">;</span>&nbsp;<span class="ident" id="7558984">err</span>&nbsp;<span class="op" id="7558988">!=</span>&nbsp;<span class="ident" id="7558991">nil</span>&nbsp;<span class="op" id="7558995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558999">t</span><span class="op" id="7559000">.</span><span class="ident" id="7559001">Fatal</span><span class="op" id="7559006">(</span><span class="ident" id="7559007">err</span><span class="op" id="7559010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559016">if</span>&nbsp;<span class="ident" id="7559019">buf</span><span class="op" id="7559022">.</span><span class="ident" id="7559023">Len</span><span class="op" id="7559026">(</span><span class="op" id="7559027">)</span>&nbsp;<span class="op" id="7559029">==</span>&nbsp;<span class="num" id="7559032">0</span>&nbsp;<span class="op" id="7559034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559038">t</span><span class="op" id="7559039">.</span><span class="ident" id="7559040">Fatal</span><span class="op" id="7559045">(</span><span class="string" id="7559046">&#34;No&nbsp;bytes&nbsp;written&nbsp;after&nbsp;Flush&#34;</span><span class="op" id="7559076">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559079">}</span><br>
<span class="lineno"></span><span class="op" id="7559081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7559084">func</span>&nbsp;<span class="ident" id="7559089">testCreate</span><span class="op" id="7559099">(</span><span class="ident" id="7559100">t</span>&nbsp;<span class="op" id="7559102">*</span><span class="ident" id="7559103">testing</span><span class="op" id="7559110">.</span><span class="ident" id="7559111">T</span><span class="op" id="7559112">,</span>&nbsp;<span class="ident" id="7559114">w</span>&nbsp;<span class="op" id="7559116">*</span><span class="ident" id="7559117">Writer</span><span class="op" id="7559123">,</span>&nbsp;<span class="ident" id="7559125">wt</span>&nbsp;<span class="op" id="7559128">*</span><span class="ident" id="7559129">WriteTest</span><span class="op" id="7559138">)</span>&nbsp;<span class="op" id="7559140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559143">header</span>&nbsp;<span class="op" id="7559150">:=</span>&nbsp;<span class="op" id="7559153">&amp;</span><span class="ident" id="7559154">FileHeader</span><span class="op" id="7559164">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559168">Name</span><span class="op" id="7559172">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7559176">wt</span><span class="op" id="7559178">.</span><span class="ident" id="7559179">Name</span><span class="op" id="7559183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559187">Method</span><span class="op" id="7559193">:</span>&nbsp;<span class="ident" id="7559195">wt</span><span class="op" id="7559197">.</span><span class="ident" id="7559198">Method</span><span class="op" id="7559204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559210">if</span>&nbsp;<span class="ident" id="7559213">wt</span><span class="op" id="7559215">.</span><span class="ident" id="7559216">Mode</span>&nbsp;<span class="op" id="7559221">!=</span>&nbsp;<span class="num" id="7559224">0</span>&nbsp;<span class="op" id="7559226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559230">header</span><span class="op" id="7559236">.</span><span class="ident" id="7559237">SetMode</span><span class="op" id="7559244">(</span><span class="ident" id="7559245">wt</span><span class="op" id="7559247">.</span><span class="ident" id="7559248">Mode</span><span class="op" id="7559252">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559258">f</span><span class="op" id="7559259">,</span>&nbsp;<span class="ident" id="7559261">err</span>&nbsp;<span class="op" id="7559265">:=</span>&nbsp;<span class="ident" id="7559268">w</span><span class="op" id="7559269">.</span><span class="ident" id="7559270">CreateHeader</span><span class="op" id="7559282">(</span><span class="ident" id="7559283">header</span><span class="op" id="7559289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559292">if</span>&nbsp;<span class="ident" id="7559295">err</span>&nbsp;<span class="op" id="7559299">!=</span>&nbsp;<span class="ident" id="7559302">nil</span>&nbsp;<span class="op" id="7559306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559310">t</span><span class="op" id="7559311">.</span><span class="ident" id="7559312">Fatal</span><span class="op" id="7559317">(</span><span class="ident" id="7559318">err</span><span class="op" id="7559321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559324">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559327">_</span><span class="op" id="7559328">,</span>&nbsp;<span class="ident" id="7559330">err</span>&nbsp;<span class="op" id="7559334">=</span>&nbsp;<span class="ident" id="7559336">f</span><span class="op" id="7559337">.</span><span class="ident" id="7559338">Write</span><span class="op" id="7559343">(</span><span class="ident" id="7559344">wt</span><span class="op" id="7559346">.</span><span class="ident" id="7559347">Data</span><span class="op" id="7559351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559354">if</span>&nbsp;<span class="ident" id="7559357">err</span>&nbsp;<span class="op" id="7559361">!=</span>&nbsp;<span class="ident" id="7559364">nil</span>&nbsp;<span class="op" id="7559368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559372">t</span><span class="op" id="7559373">.</span><span class="ident" id="7559374">Fatal</span><span class="op" id="7559379">(</span><span class="ident" id="7559380">err</span><span class="op" id="7559383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559386">}</span><br>
<span class="lineno"></span><span class="op" id="7559388">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7559391">func</span>&nbsp;<span class="ident" id="7559396">testReadFile</span><span class="op" id="7559408">(</span><span class="ident" id="7559409">t</span>&nbsp;<span class="op" id="7559411">*</span><span class="ident" id="7559412">testing</span><span class="op" id="7559419">.</span><span class="ident" id="7559420">T</span><span class="op" id="7559421">,</span>&nbsp;<span class="ident" id="7559423">f</span>&nbsp;<span class="op" id="7559425">*</span><span class="ident" id="7559426">File</span><span class="op" id="7559430">,</span>&nbsp;<span class="ident" id="7559432">wt</span>&nbsp;<span class="op" id="7559435">*</span><span class="ident" id="7559436">WriteTest</span><span class="op" id="7559445">)</span>&nbsp;<span class="op" id="7559447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559450">if</span>&nbsp;<span class="ident" id="7559453">f</span><span class="op" id="7559454">.</span><span class="ident" id="7559455">Name</span>&nbsp;<span class="op" id="7559460">!=</span>&nbsp;<span class="ident" id="7559463">wt</span><span class="op" id="7559465">.</span><span class="ident" id="7559466">Name</span>&nbsp;<span class="op" id="7559471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559475">t</span><span class="op" id="7559476">.</span><span class="ident" id="7559477">Fatalf</span><span class="op" id="7559483">(</span><span class="string" id="7559484">&#34;File&nbsp;name:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7559512">,</span>&nbsp;<span class="ident" id="7559514">f</span><span class="op" id="7559515">.</span><span class="ident" id="7559516">Name</span><span class="op" id="7559520">,</span>&nbsp;<span class="ident" id="7559522">wt</span><span class="op" id="7559524">.</span><span class="ident" id="7559525">Name</span><span class="op" id="7559529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559532">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559535">testFileMode</span><span class="op" id="7559547">(</span><span class="ident" id="7559548">t</span><span class="op" id="7559549">,</span>&nbsp;<span class="ident" id="7559551">wt</span><span class="op" id="7559553">.</span><span class="ident" id="7559554">Name</span><span class="op" id="7559558">,</span>&nbsp;<span class="ident" id="7559560">f</span><span class="op" id="7559561">,</span>&nbsp;<span class="ident" id="7559563">wt</span><span class="op" id="7559565">.</span><span class="ident" id="7559566">Mode</span><span class="op" id="7559570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559573">rc</span><span class="op" id="7559575">,</span>&nbsp;<span class="ident" id="7559577">err</span>&nbsp;<span class="op" id="7559581">:=</span>&nbsp;<span class="ident" id="7559584">f</span><span class="op" id="7559585">.</span><span class="ident" id="7559586">Open</span><span class="op" id="7559590">(</span><span class="op" id="7559591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559594">if</span>&nbsp;<span class="ident" id="7559597">err</span>&nbsp;<span class="op" id="7559601">!=</span>&nbsp;<span class="ident" id="7559604">nil</span>&nbsp;<span class="op" id="7559608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559612">t</span><span class="op" id="7559613">.</span><span class="ident" id="7559614">Fatal</span><span class="op" id="7559619">(</span><span class="string" id="7559620">&#34;opening:&#34;</span><span class="op" id="7559630">,</span>&nbsp;<span class="ident" id="7559632">err</span><span class="op" id="7559635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559638">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559641">b</span><span class="op" id="7559642">,</span>&nbsp;<span class="ident" id="7559644">err</span>&nbsp;<span class="op" id="7559648">:=</span>&nbsp;<span class="ident" id="7559651">ioutil</span><span class="op" id="7559657">.</span><span class="ident" id="7559658">ReadAll</span><span class="op" id="7559665">(</span><span class="ident" id="7559666">rc</span><span class="op" id="7559668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559671">if</span>&nbsp;<span class="ident" id="7559674">err</span>&nbsp;<span class="op" id="7559678">!=</span>&nbsp;<span class="ident" id="7559681">nil</span>&nbsp;<span class="op" id="7559685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559689">t</span><span class="op" id="7559690">.</span><span class="ident" id="7559691">Fatal</span><span class="op" id="7559696">(</span><span class="string" id="7559697">&#34;reading:&#34;</span><span class="op" id="7559707">,</span>&nbsp;<span class="ident" id="7559709">err</span><span class="op" id="7559712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559718">err</span>&nbsp;<span class="op" id="7559722">=</span>&nbsp;<span class="ident" id="7559724">rc</span><span class="op" id="7559726">.</span><span class="ident" id="7559727">Close</span><span class="op" id="7559732">(</span><span class="op" id="7559733">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559736">if</span>&nbsp;<span class="ident" id="7559739">err</span>&nbsp;<span class="op" id="7559743">!=</span>&nbsp;<span class="ident" id="7559746">nil</span>&nbsp;<span class="op" id="7559750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559754">t</span><span class="op" id="7559755">.</span><span class="ident" id="7559756">Fatal</span><span class="op" id="7559761">(</span><span class="string" id="7559762">&#34;closing:&#34;</span><span class="op" id="7559772">,</span>&nbsp;<span class="ident" id="7559774">err</span><span class="op" id="7559777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559783">if</span>&nbsp;<span class="op" id="7559786">!</span><span class="ident" id="7559787">bytes</span><span class="op" id="7559792">.</span><span class="ident" id="7559793">Equal</span><span class="op" id="7559798">(</span><span class="ident" id="7559799">b</span><span class="op" id="7559800">,</span>&nbsp;<span class="ident" id="7559802">wt</span><span class="op" id="7559804">.</span><span class="ident" id="7559805">Data</span><span class="op" id="7559809">)</span>&nbsp;<span class="op" id="7559811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559815">t</span><span class="op" id="7559816">.</span><span class="ident" id="7559817">Errorf</span><span class="op" id="7559823">(</span><span class="string" id="7559824">&#34;File&nbsp;contents&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7559851">,</span>&nbsp;<span class="ident" id="7559853">b</span><span class="op" id="7559854">,</span>&nbsp;<span class="ident" id="7559856">wt</span><span class="op" id="7559858">.</span><span class="ident" id="7559859">Data</span><span class="op" id="7559863">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559866">}</span><br>
<span class="lineno"></span><span class="op" id="7559868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7559871">func</span>&nbsp;<span class="ident" id="7559876">BenchmarkCompressedZipGarbage</span><span class="op" id="7559905">(</span><span class="ident" id="7559906">b</span>&nbsp;<span class="op" id="7559908">*</span><span class="ident" id="7559909">testing</span><span class="op" id="7559916">.</span><span class="ident" id="7559917">B</span><span class="op" id="7559918">)</span>&nbsp;<span class="op" id="7559920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559923">b</span><span class="op" id="7559924">.</span><span class="ident" id="7559925">ReportAllocs</span><span class="op" id="7559937">(</span><span class="op" id="7559938">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559941">var</span>&nbsp;<span class="ident" id="7559945">buf</span>&nbsp;<span class="ident" id="7559949">bytes</span><span class="op" id="7559954">.</span><span class="ident" id="7559955">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559963">bigBuf</span>&nbsp;<span class="op" id="7559970">:=</span>&nbsp;<span class="ident" id="7559973">bytes</span><span class="op" id="7559978">.</span><span class="ident" id="7559979">Repeat</span><span class="op" id="7559985">(</span><span class="op" id="7559986">[</span><span class="op" id="7559987">]</span><span class="builtintype" id="7559988">byte</span><span class="op" id="7559992">(</span><span class="string" id="7559993">&#34;a&#34;</span><span class="op" id="7559996">)</span><span class="op" id="7559997">,</span>&nbsp;<span class="num" id="7559999">1</span><span class="op" id="7560000">&lt;&lt;</span><span class="num" id="7560002">20</span><span class="op" id="7560004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560007">for</span>&nbsp;<span class="ident" id="7560011">i</span>&nbsp;<span class="op" id="7560013">:=</span>&nbsp;<span class="num" id="7560016">0</span><span class="op" id="7560017">;</span>&nbsp;<span class="ident" id="7560019">i</span>&nbsp;<span class="op" id="7560021">&lt;</span>&nbsp;<span class="ident" id="7560023">b</span><span class="op" id="7560024">.</span><span class="ident" id="7560025">N</span><span class="op" id="7560026">;</span>&nbsp;<span class="ident" id="7560028">i</span><span class="op" id="7560029">++</span>&nbsp;<span class="op" id="7560032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560036">buf</span><span class="op" id="7560039">.</span><span class="ident" id="7560040">Reset</span><span class="op" id="7560045">(</span><span class="op" id="7560046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560050">zw</span>&nbsp;<span class="op" id="7560053">:=</span>&nbsp;<span class="ident" id="7560056">NewWriter</span><span class="op" id="7560065">(</span><span class="op" id="7560066">&amp;</span><span class="ident" id="7560067">buf</span><span class="op" id="7560070">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560074">for</span>&nbsp;<span class="ident" id="7560078">j</span>&nbsp;<span class="op" id="7560080">:=</span>&nbsp;<span class="num" id="7560083">0</span><span class="op" id="7560084">;</span>&nbsp;<span class="ident" id="7560086">j</span>&nbsp;<span class="op" id="7560088">&lt;</span>&nbsp;<span class="num" id="7560090">3</span><span class="op" id="7560091">;</span>&nbsp;<span class="ident" id="7560093">j</span><span class="op" id="7560094">++</span>&nbsp;<span class="op" id="7560097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560102">w</span><span class="op" id="7560103">,</span>&nbsp;<span class="ident" id="7560105">_</span>&nbsp;<span class="op" id="7560107">:=</span>&nbsp;<span class="ident" id="7560110">zw</span><span class="op" id="7560112">.</span><span class="ident" id="7560113">CreateHeader</span><span class="op" id="7560125">(</span><span class="op" id="7560126">&amp;</span><span class="ident" id="7560127">FileHeader</span><span class="op" id="7560137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560143">Name</span><span class="op" id="7560147">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7560151">&#34;foo&#34;</span><span class="op" id="7560156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560162">Method</span><span class="op" id="7560168">:</span>&nbsp;<span class="ident" id="7560170">Deflate</span><span class="op" id="7560177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560182">}</span><span class="op" id="7560183">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560188">w</span><span class="op" id="7560189">.</span><span class="ident" id="7560190">Write</span><span class="op" id="7560195">(</span><span class="ident" id="7560196">bigBuf</span><span class="op" id="7560202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560210">zw</span><span class="op" id="7560212">.</span><span class="ident" id="7560213">Close</span><span class="op" id="7560218">(</span><span class="op" id="7560219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560222">}</span><br>
<span class="lineno"></span><span class="op" id="7560224">}</span>
</div>
</body>
</html>
