<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8537493">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8537549">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8537603">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8537654">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8537687">package</span>&nbsp;<span class="ident" id="8537695">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8537700">import</span>&nbsp;<span class="op" id="8537707">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537710">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537719">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537725">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537736">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537747">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537758">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8537769">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8537776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8537779">func</span>&nbsp;<span class="ident" id="8537784">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="8537817">(</span><span class="ident" id="8537818">t</span>&nbsp;<span class="op" id="8537820">*</span><span class="ident" id="8537821">testing</span><span class="op" id="8537828">.</span><span class="ident" id="8537829">T</span><span class="op" id="8537830">)</span>&nbsp;<span class="op" id="8537832">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537835">addr</span>&nbsp;<span class="op" id="8537840">:=</span>&nbsp;<span class="ident" id="8537843">testUnixAddr</span><span class="op" id="8537855">(</span><span class="op" id="8537856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537859">la</span><span class="op" id="8537861">,</span>&nbsp;<span class="ident" id="8537863">err</span>&nbsp;<span class="op" id="8537867">:=</span>&nbsp;<span class="ident" id="8537870">ResolveUnixAddr</span><span class="op" id="8537885">(</span><span class="string" id="8537886">&#34;unixgram&#34;</span><span class="op" id="8537896">,</span>&nbsp;<span class="ident" id="8537898">addr</span><span class="op" id="8537902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8537905">if</span>&nbsp;<span class="ident" id="8537908">err</span>&nbsp;<span class="op" id="8537912">!=</span>&nbsp;<span class="ident" id="8537915">nil</span>&nbsp;<span class="op" id="8537919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537923">t</span><span class="op" id="8537924">.</span><span class="ident" id="8537925">Fatalf</span><span class="op" id="8537931">(</span><span class="string" id="8537932">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8537960">,</span>&nbsp;<span class="ident" id="8537962">err</span><span class="op" id="8537965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8537968">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8537971">c</span><span class="op" id="8537972">,</span>&nbsp;<span class="ident" id="8537974">err</span>&nbsp;<span class="op" id="8537978">:=</span>&nbsp;<span class="ident" id="8537981">ListenUnixgram</span><span class="op" id="8537995">(</span><span class="string" id="8537996">&#34;unixgram&#34;</span><span class="op" id="8538006">,</span>&nbsp;<span class="ident" id="8538008">la</span><span class="op" id="8538010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538013">if</span>&nbsp;<span class="ident" id="8538016">err</span>&nbsp;<span class="op" id="8538020">!=</span>&nbsp;<span class="ident" id="8538023">nil</span>&nbsp;<span class="op" id="8538027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538031">t</span><span class="op" id="8538032">.</span><span class="ident" id="8538033">Fatalf</span><span class="op" id="8538039">(</span><span class="string" id="8538040">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8538067">,</span>&nbsp;<span class="ident" id="8538069">err</span><span class="op" id="8538072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538078">defer</span>&nbsp;<span class="keyword" id="8538084">func</span><span class="op" id="8538088">(</span><span class="op" id="8538089">)</span>&nbsp;<span class="op" id="8538091">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538095">c</span><span class="op" id="8538096">.</span><span class="ident" id="8538097">Close</span><span class="op" id="8538102">(</span><span class="op" id="8538103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538107">os</span><span class="op" id="8538109">.</span><span class="ident" id="8538110">Remove</span><span class="op" id="8538116">(</span><span class="ident" id="8538117">addr</span><span class="op" id="8538121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538124">}</span><span class="op" id="8538125">(</span><span class="op" id="8538126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538130">off</span>&nbsp;<span class="op" id="8538134">:=</span>&nbsp;<span class="builtinfunc" id="8538137">make</span><span class="op" id="8538141">(</span><span class="keyword" id="8538142">chan</span>&nbsp;<span class="builtintype" id="8538147">bool</span><span class="op" id="8538151">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538154">data</span>&nbsp;<span class="op" id="8538159">:=</span>&nbsp;<span class="op" id="8538162">[</span><span class="num" id="8538163">5</span><span class="op" id="8538164">]</span><span class="builtintype" id="8538165">byte</span><span class="op" id="8538169">{</span><span class="num" id="8538170">1</span><span class="op" id="8538171">,</span>&nbsp;<span class="num" id="8538173">2</span><span class="op" id="8538174">,</span>&nbsp;<span class="num" id="8538176">3</span><span class="op" id="8538177">,</span>&nbsp;<span class="num" id="8538179">4</span><span class="op" id="8538180">,</span>&nbsp;<span class="num" id="8538182">5</span><span class="op" id="8538183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538186">go</span>&nbsp;<span class="keyword" id="8538189">func</span><span class="op" id="8538193">(</span><span class="op" id="8538194">)</span>&nbsp;<span class="op" id="8538196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538200">defer</span>&nbsp;<span class="keyword" id="8538206">func</span><span class="op" id="8538210">(</span><span class="op" id="8538211">)</span>&nbsp;<span class="op" id="8538213">{</span>&nbsp;<span class="ident" id="8538215">off</span>&nbsp;<span class="op" id="8538219">&lt;-</span>&nbsp;<span class="builtintype" id="8538222">true</span>&nbsp;<span class="op" id="8538227">}</span><span class="op" id="8538228">(</span><span class="op" id="8538229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538233">s</span><span class="op" id="8538234">,</span>&nbsp;<span class="ident" id="8538236">err</span>&nbsp;<span class="op" id="8538240">:=</span>&nbsp;<span class="ident" id="8538243">syscall</span><span class="op" id="8538250">.</span><span class="ident" id="8538251">Socket</span><span class="op" id="8538257">(</span><span class="ident" id="8538258">syscall</span><span class="op" id="8538265">.</span><span class="ident" id="8538266">AF_UNIX</span><span class="op" id="8538273">,</span>&nbsp;<span class="ident" id="8538275">syscall</span><span class="op" id="8538282">.</span><span class="ident" id="8538283">SOCK_DGRAM</span><span class="op" id="8538293">,</span>&nbsp;<span class="num" id="8538295">0</span><span class="op" id="8538296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538300">if</span>&nbsp;<span class="ident" id="8538303">err</span>&nbsp;<span class="op" id="8538307">!=</span>&nbsp;<span class="ident" id="8538310">nil</span>&nbsp;<span class="op" id="8538314">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538319">t</span><span class="op" id="8538320">.</span><span class="ident" id="8538321">Errorf</span><span class="op" id="8538327">(</span><span class="string" id="8538328">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8538355">,</span>&nbsp;<span class="ident" id="8538357">err</span><span class="op" id="8538360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538378">defer</span>&nbsp;<span class="ident" id="8538384">syscall</span><span class="op" id="8538391">.</span><span class="ident" id="8538392">Close</span><span class="op" id="8538397">(</span><span class="ident" id="8538398">s</span><span class="op" id="8538399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538403">rsa</span>&nbsp;<span class="op" id="8538407">:=</span>&nbsp;<span class="op" id="8538410">&amp;</span><span class="ident" id="8538411">syscall</span><span class="op" id="8538418">.</span><span class="ident" id="8538419">SockaddrUnix</span><span class="op" id="8538431">{</span><span class="ident" id="8538432">Name</span><span class="op" id="8538436">:</span>&nbsp;<span class="ident" id="8538438">addr</span><span class="op" id="8538442">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538446">if</span>&nbsp;<span class="ident" id="8538449">err</span>&nbsp;<span class="op" id="8538453">:=</span>&nbsp;<span class="ident" id="8538456">syscall</span><span class="op" id="8538463">.</span><span class="ident" id="8538464">Sendto</span><span class="op" id="8538470">(</span><span class="ident" id="8538471">s</span><span class="op" id="8538472">,</span>&nbsp;<span class="ident" id="8538474">data</span><span class="op" id="8538478">[</span><span class="op" id="8538479">:</span><span class="op" id="8538480">]</span><span class="op" id="8538481">,</span>&nbsp;<span class="num" id="8538483">0</span><span class="op" id="8538484">,</span>&nbsp;<span class="ident" id="8538486">rsa</span><span class="op" id="8538489">)</span><span class="op" id="8538490">;</span>&nbsp;<span class="ident" id="8538492">err</span>&nbsp;<span class="op" id="8538496">!=</span>&nbsp;<span class="ident" id="8538499">nil</span>&nbsp;<span class="op" id="8538503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538508">t</span><span class="op" id="8538509">.</span><span class="ident" id="8538510">Errorf</span><span class="op" id="8538516">(</span><span class="string" id="8538517">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8538544">,</span>&nbsp;<span class="ident" id="8538546">err</span><span class="op" id="8538549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538566">}</span><span class="op" id="8538567">(</span><span class="op" id="8538568">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538572">&lt;-</span><span class="ident" id="8538574">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538579">b</span>&nbsp;<span class="op" id="8538581">:=</span>&nbsp;<span class="builtinfunc" id="8538584">make</span><span class="op" id="8538588">(</span><span class="op" id="8538589">[</span><span class="op" id="8538590">]</span><span class="builtintype" id="8538591">byte</span><span class="op" id="8538595">,</span>&nbsp;<span class="num" id="8538597">64</span><span class="op" id="8538599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538602">c</span><span class="op" id="8538603">.</span><span class="ident" id="8538604">SetReadDeadline</span><span class="op" id="8538619">(</span><span class="ident" id="8538620">time</span><span class="op" id="8538624">.</span><span class="ident" id="8538625">Now</span><span class="op" id="8538628">(</span><span class="op" id="8538629">)</span><span class="op" id="8538630">.</span><span class="ident" id="8538631">Add</span><span class="op" id="8538634">(</span><span class="num" id="8538635">100</span>&nbsp;<span class="op" id="8538639">*</span>&nbsp;<span class="ident" id="8538641">time</span><span class="op" id="8538645">.</span><span class="ident" id="8538646">Millisecond</span><span class="op" id="8538657">)</span><span class="op" id="8538658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538661">n</span><span class="op" id="8538662">,</span>&nbsp;<span class="ident" id="8538664">from</span><span class="op" id="8538668">,</span>&nbsp;<span class="ident" id="8538670">err</span>&nbsp;<span class="op" id="8538674">:=</span>&nbsp;<span class="ident" id="8538677">c</span><span class="op" id="8538678">.</span><span class="ident" id="8538679">ReadFrom</span><span class="op" id="8538687">(</span><span class="ident" id="8538688">b</span><span class="op" id="8538689">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538692">if</span>&nbsp;<span class="ident" id="8538695">err</span>&nbsp;<span class="op" id="8538699">!=</span>&nbsp;<span class="ident" id="8538702">nil</span>&nbsp;<span class="op" id="8538706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538710">t</span><span class="op" id="8538711">.</span><span class="ident" id="8538712">Fatalf</span><span class="op" id="8538718">(</span><span class="string" id="8538719">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8538749">,</span>&nbsp;<span class="ident" id="8538751">err</span><span class="op" id="8538754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538760">if</span>&nbsp;<span class="ident" id="8538763">from</span>&nbsp;<span class="op" id="8538768">!=</span>&nbsp;<span class="ident" id="8538771">nil</span>&nbsp;<span class="op" id="8538775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538779">t</span><span class="op" id="8538780">.</span><span class="ident" id="8538781">Fatalf</span><span class="op" id="8538787">(</span><span class="string" id="8538788">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8538812">,</span>&nbsp;<span class="ident" id="8538814">from</span><span class="op" id="8538818">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538824">if</span>&nbsp;<span class="op" id="8538827">!</span><span class="ident" id="8538828">bytes</span><span class="op" id="8538833">.</span><span class="ident" id="8538834">Equal</span><span class="op" id="8538839">(</span><span class="ident" id="8538840">b</span><span class="op" id="8538841">[</span><span class="op" id="8538842">:</span><span class="ident" id="8538843">n</span><span class="op" id="8538844">]</span><span class="op" id="8538845">,</span>&nbsp;<span class="ident" id="8538847">data</span><span class="op" id="8538851">[</span><span class="op" id="8538852">:</span><span class="op" id="8538853">]</span><span class="op" id="8538854">)</span>&nbsp;<span class="op" id="8538856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538860">t</span><span class="op" id="8538861">.</span><span class="ident" id="8538862">Fatalf</span><span class="op" id="8538868">(</span><span class="string" id="8538869">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8538886">,</span>&nbsp;<span class="ident" id="8538888">b</span><span class="op" id="8538889">[</span><span class="op" id="8538890">:</span><span class="ident" id="8538891">n</span><span class="op" id="8538892">]</span><span class="op" id="8538893">,</span>&nbsp;<span class="ident" id="8538895">data</span><span class="op" id="8538899">[</span><span class="op" id="8538900">:</span><span class="op" id="8538901">]</span><span class="op" id="8538902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538905">}</span><br>
<span class="lineno"></span><span class="op" id="8538907">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8538910">func</span>&nbsp;<span class="ident" id="8538915">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="8538950">(</span><span class="ident" id="8538951">t</span>&nbsp;<span class="op" id="8538953">*</span><span class="ident" id="8538954">testing</span><span class="op" id="8538961">.</span><span class="ident" id="8538962">T</span><span class="op" id="8538963">)</span>&nbsp;<span class="op" id="8538965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8538968">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8539025">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539091">addr</span>&nbsp;<span class="op" id="8539096">:=</span>&nbsp;<span class="ident" id="8539099">testUnixAddr</span><span class="op" id="8539111">(</span><span class="op" id="8539112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539115">la</span><span class="op" id="8539117">,</span>&nbsp;<span class="ident" id="8539119">err</span>&nbsp;<span class="op" id="8539123">:=</span>&nbsp;<span class="ident" id="8539126">ResolveUnixAddr</span><span class="op" id="8539141">(</span><span class="string" id="8539142">&#34;unixgram&#34;</span><span class="op" id="8539152">,</span>&nbsp;<span class="ident" id="8539154">addr</span><span class="op" id="8539158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539161">if</span>&nbsp;<span class="ident" id="8539164">err</span>&nbsp;<span class="op" id="8539168">!=</span>&nbsp;<span class="ident" id="8539171">nil</span>&nbsp;<span class="op" id="8539175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539179">t</span><span class="op" id="8539180">.</span><span class="ident" id="8539181">Fatalf</span><span class="op" id="8539187">(</span><span class="string" id="8539188">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8539216">,</span>&nbsp;<span class="ident" id="8539218">err</span><span class="op" id="8539221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539224">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539227">c</span><span class="op" id="8539228">,</span>&nbsp;<span class="ident" id="8539230">err</span>&nbsp;<span class="op" id="8539234">:=</span>&nbsp;<span class="ident" id="8539237">ListenUnixgram</span><span class="op" id="8539251">(</span><span class="string" id="8539252">&#34;unixgram&#34;</span><span class="op" id="8539262">,</span>&nbsp;<span class="ident" id="8539264">la</span><span class="op" id="8539266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539269">if</span>&nbsp;<span class="ident" id="8539272">err</span>&nbsp;<span class="op" id="8539276">!=</span>&nbsp;<span class="ident" id="8539279">nil</span>&nbsp;<span class="op" id="8539283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539287">t</span><span class="op" id="8539288">.</span><span class="ident" id="8539289">Fatalf</span><span class="op" id="8539295">(</span><span class="string" id="8539296">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8539323">,</span>&nbsp;<span class="ident" id="8539325">err</span><span class="op" id="8539328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539334">defer</span>&nbsp;<span class="keyword" id="8539340">func</span><span class="op" id="8539344">(</span><span class="op" id="8539345">)</span>&nbsp;<span class="op" id="8539347">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539351">c</span><span class="op" id="8539352">.</span><span class="ident" id="8539353">Close</span><span class="op" id="8539358">(</span><span class="op" id="8539359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539363">os</span><span class="op" id="8539365">.</span><span class="ident" id="8539366">Remove</span><span class="op" id="8539372">(</span><span class="ident" id="8539373">addr</span><span class="op" id="8539377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539380">}</span><span class="op" id="8539381">(</span><span class="op" id="8539382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539386">off</span>&nbsp;<span class="op" id="8539390">:=</span>&nbsp;<span class="builtinfunc" id="8539393">make</span><span class="op" id="8539397">(</span><span class="keyword" id="8539398">chan</span>&nbsp;<span class="builtintype" id="8539403">bool</span><span class="op" id="8539407">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539410">go</span>&nbsp;<span class="keyword" id="8539413">func</span><span class="op" id="8539417">(</span><span class="op" id="8539418">)</span>&nbsp;<span class="op" id="8539420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539424">defer</span>&nbsp;<span class="keyword" id="8539430">func</span><span class="op" id="8539434">(</span><span class="op" id="8539435">)</span>&nbsp;<span class="op" id="8539437">{</span>&nbsp;<span class="ident" id="8539439">off</span>&nbsp;<span class="op" id="8539443">&lt;-</span>&nbsp;<span class="builtintype" id="8539446">true</span>&nbsp;<span class="op" id="8539451">}</span><span class="op" id="8539452">(</span><span class="op" id="8539453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539457">c</span><span class="op" id="8539458">,</span>&nbsp;<span class="ident" id="8539460">err</span>&nbsp;<span class="op" id="8539464">:=</span>&nbsp;<span class="ident" id="8539467">DialUnix</span><span class="op" id="8539475">(</span><span class="string" id="8539476">&#34;unixgram&#34;</span><span class="op" id="8539486">,</span>&nbsp;<span class="ident" id="8539488">nil</span><span class="op" id="8539491">,</span>&nbsp;<span class="ident" id="8539493">la</span><span class="op" id="8539495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539499">if</span>&nbsp;<span class="ident" id="8539502">err</span>&nbsp;<span class="op" id="8539506">!=</span>&nbsp;<span class="ident" id="8539509">nil</span>&nbsp;<span class="op" id="8539513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539518">t</span><span class="op" id="8539519">.</span><span class="ident" id="8539520">Errorf</span><span class="op" id="8539526">(</span><span class="string" id="8539527">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8539548">,</span>&nbsp;<span class="ident" id="8539550">err</span><span class="op" id="8539553">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539571">defer</span>&nbsp;<span class="ident" id="8539577">c</span><span class="op" id="8539578">.</span><span class="ident" id="8539579">Close</span><span class="op" id="8539584">(</span><span class="op" id="8539585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539589">if</span>&nbsp;<span class="ident" id="8539592">_</span><span class="op" id="8539593">,</span>&nbsp;<span class="ident" id="8539595">err</span>&nbsp;<span class="op" id="8539599">:=</span>&nbsp;<span class="ident" id="8539602">c</span><span class="op" id="8539603">.</span><span class="ident" id="8539604">Write</span><span class="op" id="8539609">(</span><span class="op" id="8539610">[</span><span class="op" id="8539611">]</span><span class="builtintype" id="8539612">byte</span><span class="op" id="8539616">{</span><span class="num" id="8539617">1</span><span class="op" id="8539618">,</span>&nbsp;<span class="num" id="8539620">2</span><span class="op" id="8539621">,</span>&nbsp;<span class="num" id="8539623">3</span><span class="op" id="8539624">,</span>&nbsp;<span class="num" id="8539626">4</span><span class="op" id="8539627">,</span>&nbsp;<span class="num" id="8539629">5</span><span class="op" id="8539630">}</span><span class="op" id="8539631">)</span><span class="op" id="8539632">;</span>&nbsp;<span class="ident" id="8539634">err</span>&nbsp;<span class="op" id="8539638">!=</span>&nbsp;<span class="ident" id="8539641">nil</span>&nbsp;<span class="op" id="8539645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539650">t</span><span class="op" id="8539651">.</span><span class="ident" id="8539652">Errorf</span><span class="op" id="8539658">(</span><span class="string" id="8539659">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8539686">,</span>&nbsp;<span class="ident" id="8539688">err</span><span class="op" id="8539691">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539708">}</span><span class="op" id="8539709">(</span><span class="op" id="8539710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539714">&lt;-</span><span class="ident" id="8539716">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539721">c</span><span class="op" id="8539722">.</span><span class="ident" id="8539723">SetReadDeadline</span><span class="op" id="8539738">(</span><span class="ident" id="8539739">time</span><span class="op" id="8539743">.</span><span class="ident" id="8539744">Now</span><span class="op" id="8539747">(</span><span class="op" id="8539748">)</span><span class="op" id="8539749">.</span><span class="ident" id="8539750">Add</span><span class="op" id="8539753">(</span><span class="num" id="8539754">100</span>&nbsp;<span class="op" id="8539758">*</span>&nbsp;<span class="ident" id="8539760">time</span><span class="op" id="8539764">.</span><span class="ident" id="8539765">Millisecond</span><span class="op" id="8539776">)</span><span class="op" id="8539777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539780">_</span><span class="op" id="8539781">,</span>&nbsp;<span class="ident" id="8539783">from</span><span class="op" id="8539787">,</span>&nbsp;<span class="ident" id="8539789">err</span>&nbsp;<span class="op" id="8539793">:=</span>&nbsp;<span class="ident" id="8539796">c</span><span class="op" id="8539797">.</span><span class="ident" id="8539798">ReadFrom</span><span class="op" id="8539806">(</span><span class="ident" id="8539807">nil</span><span class="op" id="8539810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539813">if</span>&nbsp;<span class="ident" id="8539816">err</span>&nbsp;<span class="op" id="8539820">!=</span>&nbsp;<span class="ident" id="8539823">nil</span>&nbsp;<span class="op" id="8539827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539831">t</span><span class="op" id="8539832">.</span><span class="ident" id="8539833">Fatalf</span><span class="op" id="8539839">(</span><span class="string" id="8539840">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8539870">,</span>&nbsp;<span class="ident" id="8539872">err</span><span class="op" id="8539875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539878">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539881">if</span>&nbsp;<span class="ident" id="8539884">from</span>&nbsp;<span class="op" id="8539889">!=</span>&nbsp;<span class="ident" id="8539892">nil</span>&nbsp;<span class="op" id="8539896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539900">t</span><span class="op" id="8539901">.</span><span class="ident" id="8539902">Fatalf</span><span class="op" id="8539908">(</span><span class="string" id="8539909">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8539933">,</span>&nbsp;<span class="ident" id="8539935">from</span><span class="op" id="8539939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539942">}</span><br>
<span class="lineno"></span><span class="op" id="8539944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8539947">func</span>&nbsp;<span class="ident" id="8539952">TestUnixgramAutobind</span><span class="op" id="8539972">(</span><span class="ident" id="8539973">t</span>&nbsp;<span class="op" id="8539975">*</span><span class="ident" id="8539976">testing</span><span class="op" id="8539983">.</span><span class="ident" id="8539984">T</span><span class="op" id="8539985">)</span>&nbsp;<span class="op" id="8539987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539990">if</span>&nbsp;<span class="ident" id="8539993">runtime</span><span class="op" id="8540000">.</span><span class="ident" id="8540001">GOOS</span>&nbsp;<span class="op" id="8540006">!=</span>&nbsp;<span class="string" id="8540009">&#34;linux&#34;</span>&nbsp;<span class="op" id="8540017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540021">t</span><span class="op" id="8540022">.</span><span class="ident" id="8540023">Skip</span><span class="op" id="8540027">(</span><span class="string" id="8540028">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8540062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540069">laddr</span>&nbsp;<span class="op" id="8540075">:=</span>&nbsp;<span class="op" id="8540078">&amp;</span><span class="ident" id="8540079">UnixAddr</span><span class="op" id="8540087">{</span><span class="ident" id="8540088">Name</span><span class="op" id="8540092">:</span>&nbsp;<span class="string" id="8540094">&#34;&#34;</span><span class="op" id="8540096">,</span>&nbsp;<span class="ident" id="8540098">Net</span><span class="op" id="8540101">:</span>&nbsp;<span class="string" id="8540103">&#34;unixgram&#34;</span><span class="op" id="8540113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540116">c1</span><span class="op" id="8540118">,</span>&nbsp;<span class="ident" id="8540120">err</span>&nbsp;<span class="op" id="8540124">:=</span>&nbsp;<span class="ident" id="8540127">ListenUnixgram</span><span class="op" id="8540141">(</span><span class="string" id="8540142">&#34;unixgram&#34;</span><span class="op" id="8540152">,</span>&nbsp;<span class="ident" id="8540154">laddr</span><span class="op" id="8540159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540162">if</span>&nbsp;<span class="ident" id="8540165">err</span>&nbsp;<span class="op" id="8540169">!=</span>&nbsp;<span class="ident" id="8540172">nil</span>&nbsp;<span class="op" id="8540176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540180">t</span><span class="op" id="8540181">.</span><span class="ident" id="8540182">Fatalf</span><span class="op" id="8540188">(</span><span class="string" id="8540189">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8540216">,</span>&nbsp;<span class="ident" id="8540218">err</span><span class="op" id="8540221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540224">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540227">defer</span>&nbsp;<span class="ident" id="8540233">c1</span><span class="op" id="8540235">.</span><span class="ident" id="8540236">Close</span><span class="op" id="8540241">(</span><span class="op" id="8540242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8540246">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540280">autoAddr</span>&nbsp;<span class="op" id="8540289">:=</span>&nbsp;<span class="ident" id="8540292">c1</span><span class="op" id="8540294">.</span><span class="ident" id="8540295">LocalAddr</span><span class="op" id="8540304">(</span><span class="op" id="8540305">)</span><span class="op" id="8540306">.</span><span class="op" id="8540307">(</span><span class="op" id="8540308">*</span><span class="ident" id="8540309">UnixAddr</span><span class="op" id="8540317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540320">if</span>&nbsp;<span class="builtinfunc" id="8540323">len</span><span class="op" id="8540326">(</span><span class="ident" id="8540327">autoAddr</span><span class="op" id="8540335">.</span><span class="ident" id="8540336">Name</span><span class="op" id="8540340">)</span>&nbsp;<span class="op" id="8540342">&lt;=</span>&nbsp;<span class="num" id="8540345">1</span>&nbsp;<span class="op" id="8540347">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540351">t</span><span class="op" id="8540352">.</span><span class="ident" id="8540353">Fatalf</span><span class="op" id="8540359">(</span><span class="string" id="8540360">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8540390">,</span>&nbsp;<span class="ident" id="8540392">autoAddr</span><span class="op" id="8540400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540406">if</span>&nbsp;<span class="ident" id="8540409">autoAddr</span><span class="op" id="8540417">.</span><span class="ident" id="8540418">Name</span><span class="op" id="8540422">[</span><span class="num" id="8540423">0</span><span class="op" id="8540424">]</span>&nbsp;<span class="op" id="8540426">!=</span>&nbsp;<span class="string" id="8540429">&#39;@&#39;</span>&nbsp;<span class="op" id="8540433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540437">t</span><span class="op" id="8540438">.</span><span class="ident" id="8540439">Fatalf</span><span class="op" id="8540445">(</span><span class="string" id="8540446">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8540476">,</span>&nbsp;<span class="ident" id="8540478">autoAddr</span><span class="op" id="8540486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540489">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540493">c2</span><span class="op" id="8540495">,</span>&nbsp;<span class="ident" id="8540497">err</span>&nbsp;<span class="op" id="8540501">:=</span>&nbsp;<span class="ident" id="8540504">DialUnix</span><span class="op" id="8540512">(</span><span class="string" id="8540513">&#34;unixgram&#34;</span><span class="op" id="8540523">,</span>&nbsp;<span class="ident" id="8540525">nil</span><span class="op" id="8540528">,</span>&nbsp;<span class="ident" id="8540530">autoAddr</span><span class="op" id="8540538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540541">if</span>&nbsp;<span class="ident" id="8540544">err</span>&nbsp;<span class="op" id="8540548">!=</span>&nbsp;<span class="ident" id="8540551">nil</span>&nbsp;<span class="op" id="8540555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540559">t</span><span class="op" id="8540560">.</span><span class="ident" id="8540561">Fatalf</span><span class="op" id="8540567">(</span><span class="string" id="8540568">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8540589">,</span>&nbsp;<span class="ident" id="8540591">err</span><span class="op" id="8540594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540597">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540600">defer</span>&nbsp;<span class="ident" id="8540606">c2</span><span class="op" id="8540608">.</span><span class="ident" id="8540609">Close</span><span class="op" id="8540614">(</span><span class="op" id="8540615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540619">if</span>&nbsp;<span class="op" id="8540622">!</span><span class="ident" id="8540623">reflect</span><span class="op" id="8540630">.</span><span class="ident" id="8540631">DeepEqual</span><span class="op" id="8540640">(</span><span class="ident" id="8540641">c1</span><span class="op" id="8540643">.</span><span class="ident" id="8540644">LocalAddr</span><span class="op" id="8540653">(</span><span class="op" id="8540654">)</span><span class="op" id="8540655">,</span>&nbsp;<span class="ident" id="8540657">c2</span><span class="op" id="8540659">.</span><span class="ident" id="8540660">RemoteAddr</span><span class="op" id="8540670">(</span><span class="op" id="8540671">)</span><span class="op" id="8540672">)</span>&nbsp;<span class="op" id="8540674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540678">t</span><span class="op" id="8540679">.</span><span class="ident" id="8540680">Fatalf</span><span class="op" id="8540686">(</span><span class="string" id="8540687">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8540725">,</span>&nbsp;<span class="ident" id="8540727">c1</span><span class="op" id="8540729">.</span><span class="ident" id="8540730">LocalAddr</span><span class="op" id="8540739">(</span><span class="op" id="8540740">)</span><span class="op" id="8540741">,</span>&nbsp;<span class="ident" id="8540743">c2</span><span class="op" id="8540745">.</span><span class="ident" id="8540746">RemoteAddr</span><span class="op" id="8540756">(</span><span class="op" id="8540757">)</span><span class="op" id="8540758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540761">}</span><br>
<span class="lineno">140</span><span class="op" id="8540763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8540766">func</span>&nbsp;<span class="ident" id="8540771">TestUnixAutobindClose</span><span class="op" id="8540792">(</span><span class="ident" id="8540793">t</span>&nbsp;<span class="op" id="8540795">*</span><span class="ident" id="8540796">testing</span><span class="op" id="8540803">.</span><span class="ident" id="8540804">T</span><span class="op" id="8540805">)</span>&nbsp;<span class="op" id="8540807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540810">if</span>&nbsp;<span class="ident" id="8540813">runtime</span><span class="op" id="8540820">.</span><span class="ident" id="8540821">GOOS</span>&nbsp;<span class="op" id="8540826">!=</span>&nbsp;<span class="string" id="8540829">&#34;linux&#34;</span>&nbsp;<span class="op" id="8540837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540841">t</span><span class="op" id="8540842">.</span><span class="ident" id="8540843">Skip</span><span class="op" id="8540847">(</span><span class="string" id="8540848">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8540882">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540888">laddr</span>&nbsp;<span class="op" id="8540894">:=</span>&nbsp;<span class="op" id="8540897">&amp;</span><span class="ident" id="8540898">UnixAddr</span><span class="op" id="8540906">{</span><span class="ident" id="8540907">Name</span><span class="op" id="8540911">:</span>&nbsp;<span class="string" id="8540913">&#34;&#34;</span><span class="op" id="8540915">,</span>&nbsp;<span class="ident" id="8540917">Net</span><span class="op" id="8540920">:</span>&nbsp;<span class="string" id="8540922">&#34;unix&#34;</span><span class="op" id="8540928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540931">ln</span><span class="op" id="8540933">,</span>&nbsp;<span class="ident" id="8540935">err</span>&nbsp;<span class="op" id="8540939">:=</span>&nbsp;<span class="ident" id="8540942">ListenUnix</span><span class="op" id="8540952">(</span><span class="string" id="8540953">&#34;unix&#34;</span><span class="op" id="8540959">,</span>&nbsp;<span class="ident" id="8540961">laddr</span><span class="op" id="8540966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540969">if</span>&nbsp;<span class="ident" id="8540972">err</span>&nbsp;<span class="op" id="8540976">!=</span>&nbsp;<span class="ident" id="8540979">nil</span>&nbsp;<span class="op" id="8540983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540987">t</span><span class="op" id="8540988">.</span><span class="ident" id="8540989">Fatalf</span><span class="op" id="8540995">(</span><span class="string" id="8540996">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8541019">,</span>&nbsp;<span class="ident" id="8541021">err</span><span class="op" id="8541024">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541030">ln</span><span class="op" id="8541032">.</span><span class="ident" id="8541033">Close</span><span class="op" id="8541038">(</span><span class="op" id="8541039">)</span><br>
<span class="lineno"></span><span class="op" id="8541041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541044">func</span>&nbsp;<span class="ident" id="8541049">TestUnixgramWrite</span><span class="op" id="8541066">(</span><span class="ident" id="8541067">t</span>&nbsp;<span class="op" id="8541069">*</span><span class="ident" id="8541070">testing</span><span class="op" id="8541077">.</span><span class="ident" id="8541078">T</span><span class="op" id="8541079">)</span>&nbsp;<span class="op" id="8541081">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541084">addr</span>&nbsp;<span class="op" id="8541089">:=</span>&nbsp;<span class="ident" id="8541092">testUnixAddr</span><span class="op" id="8541104">(</span><span class="op" id="8541105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541108">laddr</span><span class="op" id="8541113">,</span>&nbsp;<span class="ident" id="8541115">err</span>&nbsp;<span class="op" id="8541119">:=</span>&nbsp;<span class="ident" id="8541122">ResolveUnixAddr</span><span class="op" id="8541137">(</span><span class="string" id="8541138">&#34;unixgram&#34;</span><span class="op" id="8541148">,</span>&nbsp;<span class="ident" id="8541150">addr</span><span class="op" id="8541154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541157">if</span>&nbsp;<span class="ident" id="8541160">err</span>&nbsp;<span class="op" id="8541164">!=</span>&nbsp;<span class="ident" id="8541167">nil</span>&nbsp;<span class="op" id="8541171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541175">t</span><span class="op" id="8541176">.</span><span class="ident" id="8541177">Fatalf</span><span class="op" id="8541183">(</span><span class="string" id="8541184">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8541212">,</span>&nbsp;<span class="ident" id="8541214">err</span><span class="op" id="8541217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541220">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541223">c</span><span class="op" id="8541224">,</span>&nbsp;<span class="ident" id="8541226">err</span>&nbsp;<span class="op" id="8541230">:=</span>&nbsp;<span class="ident" id="8541233">ListenPacket</span><span class="op" id="8541245">(</span><span class="string" id="8541246">&#34;unixgram&#34;</span><span class="op" id="8541256">,</span>&nbsp;<span class="ident" id="8541258">addr</span><span class="op" id="8541262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541265">if</span>&nbsp;<span class="ident" id="8541268">err</span>&nbsp;<span class="op" id="8541272">!=</span>&nbsp;<span class="ident" id="8541275">nil</span>&nbsp;<span class="op" id="8541279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541283">t</span><span class="op" id="8541284">.</span><span class="ident" id="8541285">Fatalf</span><span class="op" id="8541291">(</span><span class="string" id="8541292">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8541317">,</span>&nbsp;<span class="ident" id="8541319">err</span><span class="op" id="8541322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541328">defer</span>&nbsp;<span class="ident" id="8541334">os</span><span class="op" id="8541336">.</span><span class="ident" id="8541337">Remove</span><span class="op" id="8541343">(</span><span class="ident" id="8541344">addr</span><span class="op" id="8541348">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541351">defer</span>&nbsp;<span class="ident" id="8541357">c</span><span class="op" id="8541358">.</span><span class="ident" id="8541359">Close</span><span class="op" id="8541364">(</span><span class="op" id="8541365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541369">testUnixgramWriteConn</span><span class="op" id="8541390">(</span><span class="ident" id="8541391">t</span><span class="op" id="8541392">,</span>&nbsp;<span class="ident" id="8541394">laddr</span><span class="op" id="8541399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541402">testUnixgramWritePacketConn</span><span class="op" id="8541429">(</span><span class="ident" id="8541430">t</span><span class="op" id="8541431">,</span>&nbsp;<span class="ident" id="8541433">laddr</span><span class="op" id="8541438">)</span><br>
<span class="lineno"></span><span class="op" id="8541440">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8541443">func</span>&nbsp;<span class="ident" id="8541448">testUnixgramWriteConn</span><span class="op" id="8541469">(</span><span class="ident" id="8541470">t</span>&nbsp;<span class="op" id="8541472">*</span><span class="ident" id="8541473">testing</span><span class="op" id="8541480">.</span><span class="ident" id="8541481">T</span><span class="op" id="8541482">,</span>&nbsp;<span class="ident" id="8541484">raddr</span>&nbsp;<span class="op" id="8541490">*</span><span class="ident" id="8541491">UnixAddr</span><span class="op" id="8541499">)</span>&nbsp;<span class="op" id="8541501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541504">c</span><span class="op" id="8541505">,</span>&nbsp;<span class="ident" id="8541507">err</span>&nbsp;<span class="op" id="8541511">:=</span>&nbsp;<span class="ident" id="8541514">Dial</span><span class="op" id="8541518">(</span><span class="string" id="8541519">&#34;unixgram&#34;</span><span class="op" id="8541529">,</span>&nbsp;<span class="ident" id="8541531">raddr</span><span class="op" id="8541536">.</span><span class="ident" id="8541537">String</span><span class="op" id="8541543">(</span><span class="op" id="8541544">)</span><span class="op" id="8541545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541548">if</span>&nbsp;<span class="ident" id="8541551">err</span>&nbsp;<span class="op" id="8541555">!=</span>&nbsp;<span class="ident" id="8541558">nil</span>&nbsp;<span class="op" id="8541562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541566">t</span><span class="op" id="8541567">.</span><span class="ident" id="8541568">Fatalf</span><span class="op" id="8541574">(</span><span class="string" id="8541575">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8541592">,</span>&nbsp;<span class="ident" id="8541594">err</span><span class="op" id="8541597">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541603">defer</span>&nbsp;<span class="ident" id="8541609">c</span><span class="op" id="8541610">.</span><span class="ident" id="8541611">Close</span><span class="op" id="8541616">(</span><span class="op" id="8541617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541621">if</span>&nbsp;<span class="ident" id="8541624">_</span><span class="op" id="8541625">,</span>&nbsp;<span class="ident" id="8541627">err</span>&nbsp;<span class="op" id="8541631">:=</span>&nbsp;<span class="ident" id="8541634">c</span><span class="op" id="8541635">.</span><span class="op" id="8541636">(</span><span class="op" id="8541637">*</span><span class="ident" id="8541638">UnixConn</span><span class="op" id="8541646">)</span><span class="op" id="8541647">.</span><span class="ident" id="8541648">WriteToUnix</span><span class="op" id="8541659">(</span><span class="op" id="8541660">[</span><span class="op" id="8541661">]</span><span class="builtintype" id="8541662">byte</span><span class="op" id="8541666">(</span><span class="string" id="8541667">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8541700">)</span><span class="op" id="8541701">,</span>&nbsp;<span class="ident" id="8541703">raddr</span><span class="op" id="8541708">)</span><span class="op" id="8541709">;</span>&nbsp;<span class="ident" id="8541711">err</span>&nbsp;<span class="op" id="8541715">==</span>&nbsp;<span class="ident" id="8541718">nil</span>&nbsp;<span class="op" id="8541722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541726">t</span><span class="op" id="8541727">.</span><span class="ident" id="8541728">Fatal</span><span class="op" id="8541733">(</span><span class="string" id="8541734">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8541759">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541762">}</span>&nbsp;<span class="keyword" id="8541764">else</span>&nbsp;<span class="keyword" id="8541769">if</span>&nbsp;<span class="ident" id="8541772">err</span><span class="op" id="8541775">.</span><span class="op" id="8541776">(</span><span class="op" id="8541777">*</span><span class="ident" id="8541778">OpError</span><span class="op" id="8541785">)</span><span class="op" id="8541786">.</span><span class="ident" id="8541787">Err</span>&nbsp;<span class="op" id="8541791">!=</span>&nbsp;<span class="ident" id="8541794">ErrWriteToConnected</span>&nbsp;<span class="op" id="8541814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541818">t</span><span class="op" id="8541819">.</span><span class="ident" id="8541820">Fatalf</span><span class="op" id="8541826">(</span><span class="string" id="8541827">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8541879">,</span>&nbsp;<span class="ident" id="8541881">err</span><span class="op" id="8541884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541890">if</span>&nbsp;<span class="ident" id="8541893">_</span><span class="op" id="8541894">,</span>&nbsp;<span class="ident" id="8541896">err</span>&nbsp;<span class="op" id="8541900">=</span>&nbsp;<span class="ident" id="8541902">c</span><span class="op" id="8541903">.</span><span class="op" id="8541904">(</span><span class="op" id="8541905">*</span><span class="ident" id="8541906">UnixConn</span><span class="op" id="8541914">)</span><span class="op" id="8541915">.</span><span class="ident" id="8541916">WriteTo</span><span class="op" id="8541923">(</span><span class="op" id="8541924">[</span><span class="op" id="8541925">]</span><span class="builtintype" id="8541926">byte</span><span class="op" id="8541930">(</span><span class="string" id="8541931">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8541964">)</span><span class="op" id="8541965">,</span>&nbsp;<span class="ident" id="8541967">raddr</span><span class="op" id="8541972">)</span><span class="op" id="8541973">;</span>&nbsp;<span class="ident" id="8541975">err</span>&nbsp;<span class="op" id="8541979">==</span>&nbsp;<span class="ident" id="8541982">nil</span>&nbsp;<span class="op" id="8541986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541990">t</span><span class="op" id="8541991">.</span><span class="ident" id="8541992">Fatal</span><span class="op" id="8541997">(</span><span class="string" id="8541998">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8542019">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542022">}</span>&nbsp;<span class="keyword" id="8542024">else</span>&nbsp;<span class="keyword" id="8542029">if</span>&nbsp;<span class="ident" id="8542032">err</span><span class="op" id="8542035">.</span><span class="op" id="8542036">(</span><span class="op" id="8542037">*</span><span class="ident" id="8542038">OpError</span><span class="op" id="8542045">)</span><span class="op" id="8542046">.</span><span class="ident" id="8542047">Err</span>&nbsp;<span class="op" id="8542051">!=</span>&nbsp;<span class="ident" id="8542054">ErrWriteToConnected</span>&nbsp;<span class="op" id="8542074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542078">t</span><span class="op" id="8542079">.</span><span class="ident" id="8542080">Fatalf</span><span class="op" id="8542086">(</span><span class="string" id="8542087">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8542135">,</span>&nbsp;<span class="ident" id="8542137">err</span><span class="op" id="8542140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542146">if</span>&nbsp;<span class="ident" id="8542149">_</span><span class="op" id="8542150">,</span>&nbsp;<span class="ident" id="8542152">_</span><span class="op" id="8542153">,</span>&nbsp;<span class="ident" id="8542155">err</span>&nbsp;<span class="op" id="8542159">=</span>&nbsp;<span class="ident" id="8542161">c</span><span class="op" id="8542162">.</span><span class="op" id="8542163">(</span><span class="op" id="8542164">*</span><span class="ident" id="8542165">UnixConn</span><span class="op" id="8542173">)</span><span class="op" id="8542174">.</span><span class="ident" id="8542175">WriteMsgUnix</span><span class="op" id="8542187">(</span><span class="op" id="8542188">[</span><span class="op" id="8542189">]</span><span class="builtintype" id="8542190">byte</span><span class="op" id="8542194">(</span><span class="string" id="8542195">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8542228">)</span><span class="op" id="8542229">,</span>&nbsp;<span class="ident" id="8542231">nil</span><span class="op" id="8542234">,</span>&nbsp;<span class="ident" id="8542236">raddr</span><span class="op" id="8542241">)</span><span class="op" id="8542242">;</span>&nbsp;<span class="ident" id="8542244">err</span>&nbsp;<span class="op" id="8542248">==</span>&nbsp;<span class="ident" id="8542251">nil</span>&nbsp;<span class="op" id="8542255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542259">t</span><span class="op" id="8542260">.</span><span class="ident" id="8542261">Fatal</span><span class="op" id="8542266">(</span><span class="string" id="8542267">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8542288">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542291">}</span>&nbsp;<span class="keyword" id="8542293">else</span>&nbsp;<span class="keyword" id="8542298">if</span>&nbsp;<span class="ident" id="8542301">err</span><span class="op" id="8542304">.</span><span class="op" id="8542305">(</span><span class="op" id="8542306">*</span><span class="ident" id="8542307">OpError</span><span class="op" id="8542314">)</span><span class="op" id="8542315">.</span><span class="ident" id="8542316">Err</span>&nbsp;<span class="op" id="8542320">!=</span>&nbsp;<span class="ident" id="8542323">ErrWriteToConnected</span>&nbsp;<span class="op" id="8542343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542347">t</span><span class="op" id="8542348">.</span><span class="ident" id="8542349">Fatalf</span><span class="op" id="8542355">(</span><span class="string" id="8542356">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8542409">,</span>&nbsp;<span class="ident" id="8542411">err</span><span class="op" id="8542414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542420">if</span>&nbsp;<span class="ident" id="8542423">_</span><span class="op" id="8542424">,</span>&nbsp;<span class="ident" id="8542426">err</span>&nbsp;<span class="op" id="8542430">:=</span>&nbsp;<span class="ident" id="8542433">c</span><span class="op" id="8542434">.</span><span class="ident" id="8542435">Write</span><span class="op" id="8542440">(</span><span class="op" id="8542441">[</span><span class="op" id="8542442">]</span><span class="builtintype" id="8542443">byte</span><span class="op" id="8542447">(</span><span class="string" id="8542448">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8542481">)</span><span class="op" id="8542482">)</span><span class="op" id="8542483">;</span>&nbsp;<span class="ident" id="8542485">err</span>&nbsp;<span class="op" id="8542489">!=</span>&nbsp;<span class="ident" id="8542492">nil</span>&nbsp;<span class="op" id="8542496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542500">t</span><span class="op" id="8542501">.</span><span class="ident" id="8542502">Fatalf</span><span class="op" id="8542508">(</span><span class="string" id="8542509">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8542527">,</span>&nbsp;<span class="ident" id="8542529">err</span><span class="op" id="8542532">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542535">}</span><br>
<span class="lineno"></span><span class="op" id="8542537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8542540">func</span>&nbsp;<span class="ident" id="8542545">testUnixgramWritePacketConn</span><span class="op" id="8542572">(</span><span class="ident" id="8542573">t</span>&nbsp;<span class="op" id="8542575">*</span><span class="ident" id="8542576">testing</span><span class="op" id="8542583">.</span><span class="ident" id="8542584">T</span><span class="op" id="8542585">,</span>&nbsp;<span class="ident" id="8542587">raddr</span>&nbsp;<span class="op" id="8542593">*</span><span class="ident" id="8542594">UnixAddr</span><span class="op" id="8542602">)</span>&nbsp;<span class="op" id="8542604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542607">addr</span>&nbsp;<span class="op" id="8542612">:=</span>&nbsp;<span class="ident" id="8542615">testUnixAddr</span><span class="op" id="8542627">(</span><span class="op" id="8542628">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542631">c</span><span class="op" id="8542632">,</span>&nbsp;<span class="ident" id="8542634">err</span>&nbsp;<span class="op" id="8542638">:=</span>&nbsp;<span class="ident" id="8542641">ListenPacket</span><span class="op" id="8542653">(</span><span class="string" id="8542654">&#34;unixgram&#34;</span><span class="op" id="8542664">,</span>&nbsp;<span class="ident" id="8542666">addr</span><span class="op" id="8542670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542673">if</span>&nbsp;<span class="ident" id="8542676">err</span>&nbsp;<span class="op" id="8542680">!=</span>&nbsp;<span class="ident" id="8542683">nil</span>&nbsp;<span class="op" id="8542687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542691">t</span><span class="op" id="8542692">.</span><span class="ident" id="8542693">Fatalf</span><span class="op" id="8542699">(</span><span class="string" id="8542700">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8542725">,</span>&nbsp;<span class="ident" id="8542727">err</span><span class="op" id="8542730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542736">defer</span>&nbsp;<span class="ident" id="8542742">os</span><span class="op" id="8542744">.</span><span class="ident" id="8542745">Remove</span><span class="op" id="8542751">(</span><span class="ident" id="8542752">addr</span><span class="op" id="8542756">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542759">defer</span>&nbsp;<span class="ident" id="8542765">c</span><span class="op" id="8542766">.</span><span class="ident" id="8542767">Close</span><span class="op" id="8542772">(</span><span class="op" id="8542773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542777">if</span>&nbsp;<span class="ident" id="8542780">_</span><span class="op" id="8542781">,</span>&nbsp;<span class="ident" id="8542783">err</span>&nbsp;<span class="op" id="8542787">:=</span>&nbsp;<span class="ident" id="8542790">c</span><span class="op" id="8542791">.</span><span class="op" id="8542792">(</span><span class="op" id="8542793">*</span><span class="ident" id="8542794">UnixConn</span><span class="op" id="8542802">)</span><span class="op" id="8542803">.</span><span class="ident" id="8542804">WriteToUnix</span><span class="op" id="8542815">(</span><span class="op" id="8542816">[</span><span class="op" id="8542817">]</span><span class="builtintype" id="8542818">byte</span><span class="op" id="8542822">(</span><span class="string" id="8542823">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8542851">)</span><span class="op" id="8542852">,</span>&nbsp;<span class="ident" id="8542854">raddr</span><span class="op" id="8542859">)</span><span class="op" id="8542860">;</span>&nbsp;<span class="ident" id="8542862">err</span>&nbsp;<span class="op" id="8542866">!=</span>&nbsp;<span class="ident" id="8542869">nil</span>&nbsp;<span class="op" id="8542873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542877">t</span><span class="op" id="8542878">.</span><span class="ident" id="8542879">Fatalf</span><span class="op" id="8542885">(</span><span class="string" id="8542886">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8542910">,</span>&nbsp;<span class="ident" id="8542912">err</span><span class="op" id="8542915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542918">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542921">if</span>&nbsp;<span class="ident" id="8542924">_</span><span class="op" id="8542925">,</span>&nbsp;<span class="ident" id="8542927">err</span>&nbsp;<span class="op" id="8542931">:=</span>&nbsp;<span class="ident" id="8542934">c</span><span class="op" id="8542935">.</span><span class="ident" id="8542936">WriteTo</span><span class="op" id="8542943">(</span><span class="op" id="8542944">[</span><span class="op" id="8542945">]</span><span class="builtintype" id="8542946">byte</span><span class="op" id="8542950">(</span><span class="string" id="8542951">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8542979">)</span><span class="op" id="8542980">,</span>&nbsp;<span class="ident" id="8542982">raddr</span><span class="op" id="8542987">)</span><span class="op" id="8542988">;</span>&nbsp;<span class="ident" id="8542990">err</span>&nbsp;<span class="op" id="8542994">!=</span>&nbsp;<span class="ident" id="8542997">nil</span>&nbsp;<span class="op" id="8543001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543005">t</span><span class="op" id="8543006">.</span><span class="ident" id="8543007">Fatalf</span><span class="op" id="8543013">(</span><span class="string" id="8543014">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543034">,</span>&nbsp;<span class="ident" id="8543036">err</span><span class="op" id="8543039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543045">if</span>&nbsp;<span class="ident" id="8543048">_</span><span class="op" id="8543049">,</span>&nbsp;<span class="ident" id="8543051">_</span><span class="op" id="8543052">,</span>&nbsp;<span class="ident" id="8543054">err</span>&nbsp;<span class="op" id="8543058">:=</span>&nbsp;<span class="ident" id="8543061">c</span><span class="op" id="8543062">.</span><span class="op" id="8543063">(</span><span class="op" id="8543064">*</span><span class="ident" id="8543065">UnixConn</span><span class="op" id="8543073">)</span><span class="op" id="8543074">.</span><span class="ident" id="8543075">WriteMsgUnix</span><span class="op" id="8543087">(</span><span class="op" id="8543088">[</span><span class="op" id="8543089">]</span><span class="builtintype" id="8543090">byte</span><span class="op" id="8543094">(</span><span class="string" id="8543095">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8543123">)</span><span class="op" id="8543124">,</span>&nbsp;<span class="ident" id="8543126">nil</span><span class="op" id="8543129">,</span>&nbsp;<span class="ident" id="8543131">raddr</span><span class="op" id="8543136">)</span><span class="op" id="8543137">;</span>&nbsp;<span class="ident" id="8543139">err</span>&nbsp;<span class="op" id="8543143">!=</span>&nbsp;<span class="ident" id="8543146">nil</span>&nbsp;<span class="op" id="8543150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543154">t</span><span class="op" id="8543155">.</span><span class="ident" id="8543156">Fatalf</span><span class="op" id="8543162">(</span><span class="string" id="8543163">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543188">,</span>&nbsp;<span class="ident" id="8543190">err</span><span class="op" id="8543193">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543199">if</span>&nbsp;<span class="ident" id="8543202">_</span><span class="op" id="8543203">,</span>&nbsp;<span class="ident" id="8543205">err</span>&nbsp;<span class="op" id="8543209">:=</span>&nbsp;<span class="ident" id="8543212">c</span><span class="op" id="8543213">.</span><span class="op" id="8543214">(</span><span class="op" id="8543215">*</span><span class="ident" id="8543216">UnixConn</span><span class="op" id="8543224">)</span><span class="op" id="8543225">.</span><span class="ident" id="8543226">Write</span><span class="op" id="8543231">(</span><span class="op" id="8543232">[</span><span class="op" id="8543233">]</span><span class="builtintype" id="8543234">byte</span><span class="op" id="8543238">(</span><span class="string" id="8543239">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8543267">)</span><span class="op" id="8543268">)</span><span class="op" id="8543269">;</span>&nbsp;<span class="ident" id="8543271">err</span>&nbsp;<span class="op" id="8543275">==</span>&nbsp;<span class="ident" id="8543278">nil</span>&nbsp;<span class="op" id="8543282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543286">t</span><span class="op" id="8543287">.</span><span class="ident" id="8543288">Fatal</span><span class="op" id="8543293">(</span><span class="string" id="8543294">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8543313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543316">}</span><br>
<span class="lineno"></span><span class="op" id="8543318">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8543321">func</span>&nbsp;<span class="ident" id="8543326">TestUnixConnLocalAndRemoteNames</span><span class="op" id="8543357">(</span><span class="ident" id="8543358">t</span>&nbsp;<span class="op" id="8543360">*</span><span class="ident" id="8543361">testing</span><span class="op" id="8543368">.</span><span class="ident" id="8543369">T</span><span class="op" id="8543370">)</span>&nbsp;<span class="op" id="8543372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543375">for</span>&nbsp;<span class="ident" id="8543379">_</span><span class="op" id="8543380">,</span>&nbsp;<span class="ident" id="8543382">laddr</span>&nbsp;<span class="op" id="8543388">:=</span>&nbsp;<span class="keyword" id="8543391">range</span>&nbsp;<span class="op" id="8543397">[</span><span class="op" id="8543398">]</span><span class="builtintype" id="8543399">string</span><span class="op" id="8543405">{</span><span class="string" id="8543406">&#34;&#34;</span><span class="op" id="8543408">,</span>&nbsp;<span class="ident" id="8543410">testUnixAddr</span><span class="op" id="8543422">(</span><span class="op" id="8543423">)</span><span class="op" id="8543424">}</span>&nbsp;<span class="op" id="8543426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543430">laddr</span>&nbsp;<span class="op" id="8543436">:=</span>&nbsp;<span class="ident" id="8543439">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543447">taddr</span>&nbsp;<span class="op" id="8543453">:=</span>&nbsp;<span class="ident" id="8543456">testUnixAddr</span><span class="op" id="8543468">(</span><span class="op" id="8543469">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543473">ta</span><span class="op" id="8543475">,</span>&nbsp;<span class="ident" id="8543477">err</span>&nbsp;<span class="op" id="8543481">:=</span>&nbsp;<span class="ident" id="8543484">ResolveUnixAddr</span><span class="op" id="8543499">(</span><span class="string" id="8543500">&#34;unix&#34;</span><span class="op" id="8543506">,</span>&nbsp;<span class="ident" id="8543508">taddr</span><span class="op" id="8543513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543517">if</span>&nbsp;<span class="ident" id="8543520">err</span>&nbsp;<span class="op" id="8543524">!=</span>&nbsp;<span class="ident" id="8543527">nil</span>&nbsp;<span class="op" id="8543531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543536">t</span><span class="op" id="8543537">.</span><span class="ident" id="8543538">Fatalf</span><span class="op" id="8543544">(</span><span class="string" id="8543545">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543573">,</span>&nbsp;<span class="ident" id="8543575">err</span><span class="op" id="8543578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543586">ln</span><span class="op" id="8543588">,</span>&nbsp;<span class="ident" id="8543590">err</span>&nbsp;<span class="op" id="8543594">:=</span>&nbsp;<span class="ident" id="8543597">ListenUnix</span><span class="op" id="8543607">(</span><span class="string" id="8543608">&#34;unix&#34;</span><span class="op" id="8543614">,</span>&nbsp;<span class="ident" id="8543616">ta</span><span class="op" id="8543618">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543622">if</span>&nbsp;<span class="ident" id="8543625">err</span>&nbsp;<span class="op" id="8543629">!=</span>&nbsp;<span class="ident" id="8543632">nil</span>&nbsp;<span class="op" id="8543636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543641">t</span><span class="op" id="8543642">.</span><span class="ident" id="8543643">Fatalf</span><span class="op" id="8543649">(</span><span class="string" id="8543650">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543673">,</span>&nbsp;<span class="ident" id="8543675">err</span><span class="op" id="8543678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543686">defer</span>&nbsp;<span class="keyword" id="8543692">func</span><span class="op" id="8543696">(</span><span class="op" id="8543697">)</span>&nbsp;<span class="op" id="8543699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543704">ln</span><span class="op" id="8543706">.</span><span class="ident" id="8543707">Close</span><span class="op" id="8543712">(</span><span class="op" id="8543713">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543718">os</span><span class="op" id="8543720">.</span><span class="ident" id="8543721">Remove</span><span class="op" id="8543727">(</span><span class="ident" id="8543728">taddr</span><span class="op" id="8543733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543737">}</span><span class="op" id="8543738">(</span><span class="op" id="8543739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543744">done</span>&nbsp;<span class="op" id="8543749">:=</span>&nbsp;<span class="builtinfunc" id="8543752">make</span><span class="op" id="8543756">(</span><span class="keyword" id="8543757">chan</span>&nbsp;<span class="builtintype" id="8543762">int</span><span class="op" id="8543765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543769">go</span>&nbsp;<span class="ident" id="8543772">transponder</span><span class="op" id="8543783">(</span><span class="ident" id="8543784">t</span><span class="op" id="8543785">,</span>&nbsp;<span class="ident" id="8543787">ln</span><span class="op" id="8543789">,</span>&nbsp;<span class="ident" id="8543791">done</span><span class="op" id="8543795">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543800">la</span><span class="op" id="8543802">,</span>&nbsp;<span class="ident" id="8543804">err</span>&nbsp;<span class="op" id="8543808">:=</span>&nbsp;<span class="ident" id="8543811">ResolveUnixAddr</span><span class="op" id="8543826">(</span><span class="string" id="8543827">&#34;unix&#34;</span><span class="op" id="8543833">,</span>&nbsp;<span class="ident" id="8543835">laddr</span><span class="op" id="8543840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543844">if</span>&nbsp;<span class="ident" id="8543847">err</span>&nbsp;<span class="op" id="8543851">!=</span>&nbsp;<span class="ident" id="8543854">nil</span>&nbsp;<span class="op" id="8543858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543863">t</span><span class="op" id="8543864">.</span><span class="ident" id="8543865">Fatalf</span><span class="op" id="8543871">(</span><span class="string" id="8543872">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543900">,</span>&nbsp;<span class="ident" id="8543902">err</span><span class="op" id="8543905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543909">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543913">c</span><span class="op" id="8543914">,</span>&nbsp;<span class="ident" id="8543916">err</span>&nbsp;<span class="op" id="8543920">:=</span>&nbsp;<span class="ident" id="8543923">DialUnix</span><span class="op" id="8543931">(</span><span class="string" id="8543932">&#34;unix&#34;</span><span class="op" id="8543938">,</span>&nbsp;<span class="ident" id="8543940">la</span><span class="op" id="8543942">,</span>&nbsp;<span class="ident" id="8543944">ta</span><span class="op" id="8543946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543950">if</span>&nbsp;<span class="ident" id="8543953">err</span>&nbsp;<span class="op" id="8543957">!=</span>&nbsp;<span class="ident" id="8543960">nil</span>&nbsp;<span class="op" id="8543964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543969">t</span><span class="op" id="8543970">.</span><span class="ident" id="8543971">Fatalf</span><span class="op" id="8543977">(</span><span class="string" id="8543978">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8543999">,</span>&nbsp;<span class="ident" id="8544001">err</span><span class="op" id="8544004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544012">defer</span>&nbsp;<span class="keyword" id="8544018">func</span><span class="op" id="8544022">(</span><span class="op" id="8544023">)</span>&nbsp;<span class="op" id="8544025">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544030">c</span><span class="op" id="8544031">.</span><span class="ident" id="8544032">Close</span><span class="op" id="8544037">(</span><span class="op" id="8544038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544043">if</span>&nbsp;<span class="ident" id="8544046">la</span>&nbsp;<span class="op" id="8544049">!=</span>&nbsp;<span class="ident" id="8544052">nil</span>&nbsp;<span class="op" id="8544056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544062">defer</span>&nbsp;<span class="ident" id="8544068">os</span><span class="op" id="8544070">.</span><span class="ident" id="8544071">Remove</span><span class="op" id="8544077">(</span><span class="ident" id="8544078">laddr</span><span class="op" id="8544083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544092">}</span><span class="op" id="8544093">(</span><span class="op" id="8544094">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544098">if</span>&nbsp;<span class="ident" id="8544101">_</span><span class="op" id="8544102">,</span>&nbsp;<span class="ident" id="8544104">err</span>&nbsp;<span class="op" id="8544108">:=</span>&nbsp;<span class="ident" id="8544111">c</span><span class="op" id="8544112">.</span><span class="ident" id="8544113">Write</span><span class="op" id="8544118">(</span><span class="op" id="8544119">[</span><span class="op" id="8544120">]</span><span class="builtintype" id="8544121">byte</span><span class="op" id="8544125">(</span><span class="string" id="8544126">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="8544163">)</span><span class="op" id="8544164">)</span><span class="op" id="8544165">;</span>&nbsp;<span class="ident" id="8544167">err</span>&nbsp;<span class="op" id="8544171">!=</span>&nbsp;<span class="ident" id="8544174">nil</span>&nbsp;<span class="op" id="8544178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544183">t</span><span class="op" id="8544184">.</span><span class="ident" id="8544185">Fatalf</span><span class="op" id="8544191">(</span><span class="string" id="8544192">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8544219">,</span>&nbsp;<span class="ident" id="8544221">err</span><span class="op" id="8544224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544233">switch</span>&nbsp;<span class="ident" id="8544240">runtime</span><span class="op" id="8544247">.</span><span class="ident" id="8544248">GOOS</span>&nbsp;<span class="op" id="8544253">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544257">case</span>&nbsp;<span class="string" id="8544262">&#34;android&#34;</span><span class="op" id="8544271">,</span>&nbsp;<span class="string" id="8544273">&#34;linux&#34;</span><span class="op" id="8544280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544285">if</span>&nbsp;<span class="ident" id="8544288">laddr</span>&nbsp;<span class="op" id="8544294">==</span>&nbsp;<span class="string" id="8544297">&#34;&#34;</span>&nbsp;<span class="op" id="8544300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544306">laddr</span>&nbsp;<span class="op" id="8544312">=</span>&nbsp;<span class="string" id="8544314">&#34;@&#34;</span>&nbsp;<span class="comment" id="8544318">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544345">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544349">var</span>&nbsp;<span class="ident" id="8544353">connAddrs</span>&nbsp;<span class="op" id="8544363">=</span>&nbsp;<span class="op" id="8544365">[</span><span class="num" id="8544366">3</span><span class="op" id="8544367">]</span><span class="keyword" id="8544368">struct</span><span class="op" id="8544374">{</span>&nbsp;<span class="ident" id="8544376">got</span><span class="op" id="8544379">,</span>&nbsp;<span class="ident" id="8544381">want</span>&nbsp;<span class="ident" id="8544386">Addr</span>&nbsp;<span class="op" id="8544391">}</span><span class="op" id="8544392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544397">{</span><span class="ident" id="8544398">ln</span><span class="op" id="8544400">.</span><span class="ident" id="8544401">Addr</span><span class="op" id="8544405">(</span><span class="op" id="8544406">)</span><span class="op" id="8544407">,</span>&nbsp;<span class="ident" id="8544409">ta</span><span class="op" id="8544411">}</span><span class="op" id="8544412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544417">{</span><span class="ident" id="8544418">c</span><span class="op" id="8544419">.</span><span class="ident" id="8544420">LocalAddr</span><span class="op" id="8544429">(</span><span class="op" id="8544430">)</span><span class="op" id="8544431">,</span>&nbsp;<span class="op" id="8544433">&amp;</span><span class="ident" id="8544434">UnixAddr</span><span class="op" id="8544442">{</span><span class="ident" id="8544443">Name</span><span class="op" id="8544447">:</span>&nbsp;<span class="ident" id="8544449">laddr</span><span class="op" id="8544454">,</span>&nbsp;<span class="ident" id="8544456">Net</span><span class="op" id="8544459">:</span>&nbsp;<span class="string" id="8544461">&#34;unix&#34;</span><span class="op" id="8544467">}</span><span class="op" id="8544468">}</span><span class="op" id="8544469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544474">{</span><span class="ident" id="8544475">c</span><span class="op" id="8544476">.</span><span class="ident" id="8544477">RemoteAddr</span><span class="op" id="8544487">(</span><span class="op" id="8544488">)</span><span class="op" id="8544489">,</span>&nbsp;<span class="ident" id="8544491">ta</span><span class="op" id="8544493">}</span><span class="op" id="8544494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544498">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544502">for</span>&nbsp;<span class="ident" id="8544506">_</span><span class="op" id="8544507">,</span>&nbsp;<span class="ident" id="8544509">ca</span>&nbsp;<span class="op" id="8544512">:=</span>&nbsp;<span class="keyword" id="8544515">range</span>&nbsp;<span class="ident" id="8544521">connAddrs</span>&nbsp;<span class="op" id="8544531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544536">if</span>&nbsp;<span class="op" id="8544539">!</span><span class="ident" id="8544540">reflect</span><span class="op" id="8544547">.</span><span class="ident" id="8544548">DeepEqual</span><span class="op" id="8544557">(</span><span class="ident" id="8544558">ca</span><span class="op" id="8544560">.</span><span class="ident" id="8544561">got</span><span class="op" id="8544564">,</span>&nbsp;<span class="ident" id="8544566">ca</span><span class="op" id="8544568">.</span><span class="ident" id="8544569">want</span><span class="op" id="8544573">)</span>&nbsp;<span class="op" id="8544575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544581">t</span><span class="op" id="8544582">.</span><span class="ident" id="8544583">Fatalf</span><span class="op" id="8544589">(</span><span class="string" id="8544590">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8544613">,</span>&nbsp;<span class="ident" id="8544615">ca</span><span class="op" id="8544617">.</span><span class="ident" id="8544618">got</span><span class="op" id="8544621">,</span>&nbsp;<span class="ident" id="8544623">ca</span><span class="op" id="8544625">.</span><span class="ident" id="8544626">want</span><span class="op" id="8544630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544639">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544644">&lt;-</span><span class="ident" id="8544646">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544652">}</span><br>
<span class="lineno"></span><span class="op" id="8544654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8544657">func</span>&nbsp;<span class="ident" id="8544662">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="8544697">(</span><span class="ident" id="8544698">t</span>&nbsp;<span class="op" id="8544700">*</span><span class="ident" id="8544701">testing</span><span class="op" id="8544708">.</span><span class="ident" id="8544709">T</span><span class="op" id="8544710">)</span>&nbsp;<span class="op" id="8544712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544715">for</span>&nbsp;<span class="ident" id="8544719">_</span><span class="op" id="8544720">,</span>&nbsp;<span class="ident" id="8544722">laddr</span>&nbsp;<span class="op" id="8544728">:=</span>&nbsp;<span class="keyword" id="8544731">range</span>&nbsp;<span class="op" id="8544737">[</span><span class="op" id="8544738">]</span><span class="builtintype" id="8544739">string</span><span class="op" id="8544745">{</span><span class="string" id="8544746">&#34;&#34;</span><span class="op" id="8544748">,</span>&nbsp;<span class="ident" id="8544750">testUnixAddr</span><span class="op" id="8544762">(</span><span class="op" id="8544763">)</span><span class="op" id="8544764">}</span>&nbsp;<span class="op" id="8544766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544770">laddr</span>&nbsp;<span class="op" id="8544776">:=</span>&nbsp;<span class="ident" id="8544779">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544787">taddr</span>&nbsp;<span class="op" id="8544793">:=</span>&nbsp;<span class="ident" id="8544796">testUnixAddr</span><span class="op" id="8544808">(</span><span class="op" id="8544809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544813">ta</span><span class="op" id="8544815">,</span>&nbsp;<span class="ident" id="8544817">err</span>&nbsp;<span class="op" id="8544821">:=</span>&nbsp;<span class="ident" id="8544824">ResolveUnixAddr</span><span class="op" id="8544839">(</span><span class="string" id="8544840">&#34;unixgram&#34;</span><span class="op" id="8544850">,</span>&nbsp;<span class="ident" id="8544852">taddr</span><span class="op" id="8544857">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544861">if</span>&nbsp;<span class="ident" id="8544864">err</span>&nbsp;<span class="op" id="8544868">!=</span>&nbsp;<span class="ident" id="8544871">nil</span>&nbsp;<span class="op" id="8544875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544880">t</span><span class="op" id="8544881">.</span><span class="ident" id="8544882">Fatalf</span><span class="op" id="8544888">(</span><span class="string" id="8544889">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8544917">,</span>&nbsp;<span class="ident" id="8544919">err</span><span class="op" id="8544922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544930">c1</span><span class="op" id="8544932">,</span>&nbsp;<span class="ident" id="8544934">err</span>&nbsp;<span class="op" id="8544938">:=</span>&nbsp;<span class="ident" id="8544941">ListenUnixgram</span><span class="op" id="8544955">(</span><span class="string" id="8544956">&#34;unixgram&#34;</span><span class="op" id="8544966">,</span>&nbsp;<span class="ident" id="8544968">ta</span><span class="op" id="8544970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544974">if</span>&nbsp;<span class="ident" id="8544977">err</span>&nbsp;<span class="op" id="8544981">!=</span>&nbsp;<span class="ident" id="8544984">nil</span>&nbsp;<span class="op" id="8544988">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544993">t</span><span class="op" id="8544994">.</span><span class="ident" id="8544995">Fatalf</span><span class="op" id="8545001">(</span><span class="string" id="8545002">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8545029">,</span>&nbsp;<span class="ident" id="8545031">err</span><span class="op" id="8545034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545042">defer</span>&nbsp;<span class="keyword" id="8545048">func</span><span class="op" id="8545052">(</span><span class="op" id="8545053">)</span>&nbsp;<span class="op" id="8545055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545060">c1</span><span class="op" id="8545062">.</span><span class="ident" id="8545063">Close</span><span class="op" id="8545068">(</span><span class="op" id="8545069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545074">os</span><span class="op" id="8545076">.</span><span class="ident" id="8545077">Remove</span><span class="op" id="8545083">(</span><span class="ident" id="8545084">taddr</span><span class="op" id="8545089">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545093">}</span><span class="op" id="8545094">(</span><span class="op" id="8545095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545100">var</span>&nbsp;<span class="ident" id="8545104">la</span>&nbsp;<span class="op" id="8545107">*</span><span class="ident" id="8545108">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545119">if</span>&nbsp;<span class="ident" id="8545122">laddr</span>&nbsp;<span class="op" id="8545128">!=</span>&nbsp;<span class="string" id="8545131">&#34;&#34;</span>&nbsp;<span class="op" id="8545134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545139">if</span>&nbsp;<span class="ident" id="8545142">la</span><span class="op" id="8545144">,</span>&nbsp;<span class="ident" id="8545146">err</span>&nbsp;<span class="op" id="8545150">=</span>&nbsp;<span class="ident" id="8545152">ResolveUnixAddr</span><span class="op" id="8545167">(</span><span class="string" id="8545168">&#34;unixgram&#34;</span><span class="op" id="8545178">,</span>&nbsp;<span class="ident" id="8545180">laddr</span><span class="op" id="8545185">)</span><span class="op" id="8545186">;</span>&nbsp;<span class="ident" id="8545188">err</span>&nbsp;<span class="op" id="8545192">!=</span>&nbsp;<span class="ident" id="8545195">nil</span>&nbsp;<span class="op" id="8545199">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545205">t</span><span class="op" id="8545206">.</span><span class="ident" id="8545207">Fatalf</span><span class="op" id="8545213">(</span><span class="string" id="8545214">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8545242">,</span>&nbsp;<span class="ident" id="8545244">err</span><span class="op" id="8545247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545260">c2</span><span class="op" id="8545262">,</span>&nbsp;<span class="ident" id="8545264">err</span>&nbsp;<span class="op" id="8545268">:=</span>&nbsp;<span class="ident" id="8545271">DialUnix</span><span class="op" id="8545279">(</span><span class="string" id="8545280">&#34;unixgram&#34;</span><span class="op" id="8545290">,</span>&nbsp;<span class="ident" id="8545292">la</span><span class="op" id="8545294">,</span>&nbsp;<span class="ident" id="8545296">ta</span><span class="op" id="8545298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545302">if</span>&nbsp;<span class="ident" id="8545305">err</span>&nbsp;<span class="op" id="8545309">!=</span>&nbsp;<span class="ident" id="8545312">nil</span>&nbsp;<span class="op" id="8545316">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545321">t</span><span class="op" id="8545322">.</span><span class="ident" id="8545323">Fatalf</span><span class="op" id="8545329">(</span><span class="string" id="8545330">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8545351">,</span>&nbsp;<span class="ident" id="8545353">err</span><span class="op" id="8545356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545364">defer</span>&nbsp;<span class="keyword" id="8545370">func</span><span class="op" id="8545374">(</span><span class="op" id="8545375">)</span>&nbsp;<span class="op" id="8545377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545382">c2</span><span class="op" id="8545384">.</span><span class="ident" id="8545385">Close</span><span class="op" id="8545390">(</span><span class="op" id="8545391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545396">if</span>&nbsp;<span class="ident" id="8545399">la</span>&nbsp;<span class="op" id="8545402">!=</span>&nbsp;<span class="ident" id="8545405">nil</span>&nbsp;<span class="op" id="8545409">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545415">defer</span>&nbsp;<span class="ident" id="8545421">os</span><span class="op" id="8545423">.</span><span class="ident" id="8545424">Remove</span><span class="op" id="8545430">(</span><span class="ident" id="8545431">laddr</span><span class="op" id="8545436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545445">}</span><span class="op" id="8545446">(</span><span class="op" id="8545447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545452">switch</span>&nbsp;<span class="ident" id="8545459">runtime</span><span class="op" id="8545466">.</span><span class="ident" id="8545467">GOOS</span>&nbsp;<span class="op" id="8545472">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545476">case</span>&nbsp;<span class="string" id="8545481">&#34;android&#34;</span><span class="op" id="8545490">,</span>&nbsp;<span class="string" id="8545492">&#34;linux&#34;</span><span class="op" id="8545499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545504">if</span>&nbsp;<span class="ident" id="8545507">laddr</span>&nbsp;<span class="op" id="8545513">==</span>&nbsp;<span class="string" id="8545516">&#34;&#34;</span>&nbsp;<span class="op" id="8545519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545525">laddr</span>&nbsp;<span class="op" id="8545531">=</span>&nbsp;<span class="string" id="8545533">&#34;@&#34;</span>&nbsp;<span class="comment" id="8545537">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545564">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545569">var</span>&nbsp;<span class="ident" id="8545573">connAddrs</span>&nbsp;<span class="op" id="8545583">=</span>&nbsp;<span class="op" id="8545585">[</span><span class="num" id="8545586">4</span><span class="op" id="8545587">]</span><span class="keyword" id="8545588">struct</span><span class="op" id="8545594">{</span>&nbsp;<span class="ident" id="8545596">got</span><span class="op" id="8545599">,</span>&nbsp;<span class="ident" id="8545601">want</span>&nbsp;<span class="ident" id="8545606">Addr</span>&nbsp;<span class="op" id="8545611">}</span><span class="op" id="8545612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545617">{</span><span class="ident" id="8545618">c1</span><span class="op" id="8545620">.</span><span class="ident" id="8545621">LocalAddr</span><span class="op" id="8545630">(</span><span class="op" id="8545631">)</span><span class="op" id="8545632">,</span>&nbsp;<span class="ident" id="8545634">ta</span><span class="op" id="8545636">}</span><span class="op" id="8545637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545642">{</span><span class="ident" id="8545643">c1</span><span class="op" id="8545645">.</span><span class="ident" id="8545646">RemoteAddr</span><span class="op" id="8545656">(</span><span class="op" id="8545657">)</span><span class="op" id="8545658">,</span>&nbsp;<span class="ident" id="8545660">nil</span><span class="op" id="8545663">}</span><span class="op" id="8545664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545669">{</span><span class="ident" id="8545670">c2</span><span class="op" id="8545672">.</span><span class="ident" id="8545673">LocalAddr</span><span class="op" id="8545682">(</span><span class="op" id="8545683">)</span><span class="op" id="8545684">,</span>&nbsp;<span class="op" id="8545686">&amp;</span><span class="ident" id="8545687">UnixAddr</span><span class="op" id="8545695">{</span><span class="ident" id="8545696">Name</span><span class="op" id="8545700">:</span>&nbsp;<span class="ident" id="8545702">laddr</span><span class="op" id="8545707">,</span>&nbsp;<span class="ident" id="8545709">Net</span><span class="op" id="8545712">:</span>&nbsp;<span class="string" id="8545714">&#34;unixgram&#34;</span><span class="op" id="8545724">}</span><span class="op" id="8545725">}</span><span class="op" id="8545726">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545731">{</span><span class="ident" id="8545732">c2</span><span class="op" id="8545734">.</span><span class="ident" id="8545735">RemoteAddr</span><span class="op" id="8545745">(</span><span class="op" id="8545746">)</span><span class="op" id="8545747">,</span>&nbsp;<span class="ident" id="8545749">ta</span><span class="op" id="8545751">}</span><span class="op" id="8545752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545760">for</span>&nbsp;<span class="ident" id="8545764">_</span><span class="op" id="8545765">,</span>&nbsp;<span class="ident" id="8545767">ca</span>&nbsp;<span class="op" id="8545770">:=</span>&nbsp;<span class="keyword" id="8545773">range</span>&nbsp;<span class="ident" id="8545779">connAddrs</span>&nbsp;<span class="op" id="8545789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8545794">if</span>&nbsp;<span class="op" id="8545797">!</span><span class="ident" id="8545798">reflect</span><span class="op" id="8545805">.</span><span class="ident" id="8545806">DeepEqual</span><span class="op" id="8545815">(</span><span class="ident" id="8545816">ca</span><span class="op" id="8545818">.</span><span class="ident" id="8545819">got</span><span class="op" id="8545822">,</span>&nbsp;<span class="ident" id="8545824">ca</span><span class="op" id="8545826">.</span><span class="ident" id="8545827">want</span><span class="op" id="8545831">)</span>&nbsp;<span class="op" id="8545833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545839">t</span><span class="op" id="8545840">.</span><span class="ident" id="8545841">Fatalf</span><span class="op" id="8545847">(</span><span class="string" id="8545848">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8545871">,</span>&nbsp;<span class="ident" id="8545873">ca</span><span class="op" id="8545875">.</span><span class="ident" id="8545876">got</span><span class="op" id="8545879">,</span>&nbsp;<span class="ident" id="8545881">ca</span><span class="op" id="8545883">.</span><span class="ident" id="8545884">want</span><span class="op" id="8545888">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545900">}</span><br>
<span class="lineno"></span><span class="op" id="8545902">}</span>
</div>
</body>
</html>
