<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6078630">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6078685">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6078739">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6078790">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="6078840">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="6078909">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="6078933">//</span><br>
<span class="lineno"></span><span class="comment" id="6078936">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="6078951">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="6079011">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="6079079">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="6079151">package</span>&nbsp;<span class="ident" id="6079159">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6079164">import</span>&nbsp;<span class="op" id="6079171">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079174">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079183">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079193">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079200">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079206">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6079214">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6079221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6079224">const</span>&nbsp;<span class="op" id="6079230">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079233">blockSize</span>&nbsp;<span class="op" id="6079243">=</span>&nbsp;<span class="num" id="6079245">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079251">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079261">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079279">=</span>&nbsp;<span class="string" id="6079281">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079288">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079305">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079323">=</span>&nbsp;<span class="string" id="6079325">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="6079332">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079349">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079367">=</span>&nbsp;<span class="string" id="6079369">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079376">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079390">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079408">=</span>&nbsp;<span class="string" id="6079410">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079417">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079435">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079453">=</span>&nbsp;<span class="string" id="6079455">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079462">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079488">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079506">=</span>&nbsp;<span class="string" id="6079508">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079515">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079537">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079555">=</span>&nbsp;<span class="string" id="6079557">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079564">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079578">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079596">=</span>&nbsp;<span class="string" id="6079598">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079605">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079619">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079637">=</span>&nbsp;<span class="string" id="6079639">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079646">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079659">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079677">=</span>&nbsp;<span class="string" id="6079679">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079686">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079706">TypeXGlobalHeader</span>&nbsp;<span class="op" id="6079724">=</span>&nbsp;<span class="string" id="6079726">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079733">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079760">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6079778">=</span>&nbsp;<span class="string" id="6079780">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079787">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079817">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6079835">=</span>&nbsp;<span class="string" id="6079837">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079844">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079892">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079910">=</span>&nbsp;<span class="string" id="6079912">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079919">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="6079934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6079937">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="6079994">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="6080031">type</span>&nbsp;<span class="ident" id="6080036">Header</span>&nbsp;<span class="keyword" id="6080043">struct</span>&nbsp;<span class="op" id="6080050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080053">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080064">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080074">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080104">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080115">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080125">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080154">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080165">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080175">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080196">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080207">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080217">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080239">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080250">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080260">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080280">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080291">time</span><span class="op" id="6080295">.</span><span class="ident" id="6080296">Time</span>&nbsp;<span class="comment" id="6080301">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080319">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080330">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080340">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080365">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080376">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080386">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080410">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080421">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080431">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080454">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080465">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080475">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080499">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6080510">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080520">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080566">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6080577">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080587">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080633">AccessTime</span>&nbsp;<span class="ident" id="6080644">time</span><span class="op" id="6080648">.</span><span class="ident" id="6080649">Time</span>&nbsp;<span class="comment" id="6080654">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080670">ChangeTime</span>&nbsp;<span class="ident" id="6080681">time</span><span class="op" id="6080685">.</span><span class="ident" id="6080686">Time</span>&nbsp;<span class="comment" id="6080691">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080714">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080725">map</span><span class="op" id="6080728">[</span><span class="builtintype" id="6080729">string</span><span class="op" id="6080735">]</span><span class="builtintype" id="6080736">string</span><br>
<span class="lineno"></span><span class="op" id="6080743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080746">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="6080788">const</span>&nbsp;<span class="op" id="6080794">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080797">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080816">=</span>&nbsp;<span class="num" id="6080818">100</span>&nbsp;<span class="comment" id="6080822">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080874">fileNamePrefixSize</span>&nbsp;<span class="op" id="6080893">=</span>&nbsp;<span class="num" id="6080895">155</span>&nbsp;<span class="comment" id="6080899">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="6080943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6080946">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="6080997">func</span>&nbsp;<span class="op" id="6081002">(</span><span class="ident" id="6081003">h</span>&nbsp;<span class="op" id="6081005">*</span><span class="ident" id="6081006">Header</span><span class="op" id="6081012">)</span>&nbsp;<span class="ident" id="6081014">FileInfo</span><span class="op" id="6081022">(</span><span class="op" id="6081023">)</span>&nbsp;<span class="ident" id="6081025">os</span><span class="op" id="6081027">.</span><span class="ident" id="6081028">FileInfo</span>&nbsp;<span class="op" id="6081037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081040">return</span>&nbsp;<span class="ident" id="6081047">headerFileInfo</span><span class="op" id="6081061">{</span><span class="ident" id="6081062">h</span><span class="op" id="6081063">}</span><br>
<span class="lineno"></span><span class="op" id="6081065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6081068">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6081110">type</span>&nbsp;<span class="ident" id="6081115">headerFileInfo</span>&nbsp;<span class="keyword" id="6081130">struct</span>&nbsp;<span class="op" id="6081137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081140">h</span>&nbsp;<span class="op" id="6081142">*</span><span class="ident" id="6081143">Header</span><br>
<span class="lineno"></span><span class="op" id="6081150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6081153">func</span>&nbsp;<span class="op" id="6081158">(</span><span class="ident" id="6081159">fi</span>&nbsp;<span class="ident" id="6081162">headerFileInfo</span><span class="op" id="6081176">)</span>&nbsp;<span class="ident" id="6081178">Size</span><span class="op" id="6081182">(</span><span class="op" id="6081183">)</span>&nbsp;<span class="ident" id="6081185">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081198">{</span>&nbsp;<span class="keyword" id="6081200">return</span>&nbsp;<span class="ident" id="6081207">fi</span><span class="op" id="6081209">.</span><span class="ident" id="6081210">h</span><span class="op" id="6081211">.</span><span class="ident" id="6081212">Size</span>&nbsp;<span class="op" id="6081217">}</span><br>
<span class="lineno"></span><span class="keyword" id="6081219">func</span>&nbsp;<span class="op" id="6081224">(</span><span class="ident" id="6081225">fi</span>&nbsp;<span class="ident" id="6081228">headerFileInfo</span><span class="op" id="6081242">)</span>&nbsp;<span class="ident" id="6081244">IsDir</span><span class="op" id="6081249">(</span><span class="op" id="6081250">)</span>&nbsp;<span class="builtintype" id="6081252">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6081264">{</span>&nbsp;<span class="keyword" id="6081266">return</span>&nbsp;<span class="ident" id="6081273">fi</span><span class="op" id="6081275">.</span><span class="ident" id="6081276">Mode</span><span class="op" id="6081280">(</span><span class="op" id="6081281">)</span><span class="op" id="6081282">.</span><span class="ident" id="6081283">IsDir</span><span class="op" id="6081288">(</span><span class="op" id="6081289">)</span>&nbsp;<span class="op" id="6081291">}</span><br>
<span class="lineno"></span><span class="keyword" id="6081293">func</span>&nbsp;<span class="op" id="6081298">(</span><span class="ident" id="6081299">fi</span>&nbsp;<span class="ident" id="6081302">headerFileInfo</span><span class="op" id="6081316">)</span>&nbsp;<span class="ident" id="6081318">ModTime</span><span class="op" id="6081325">(</span><span class="op" id="6081326">)</span>&nbsp;<span class="ident" id="6081328">time</span><span class="op" id="6081332">.</span><span class="ident" id="6081333">Time</span>&nbsp;<span class="op" id="6081338">{</span>&nbsp;<span class="keyword" id="6081340">return</span>&nbsp;<span class="ident" id="6081347">fi</span><span class="op" id="6081349">.</span><span class="ident" id="6081350">h</span><span class="op" id="6081351">.</span><span class="ident" id="6081352">ModTime</span>&nbsp;<span class="op" id="6081360">}</span><br>
<span class="lineno"></span><span class="keyword" id="6081362">func</span>&nbsp;<span class="op" id="6081367">(</span><span class="ident" id="6081368">fi</span>&nbsp;<span class="ident" id="6081371">headerFileInfo</span><span class="op" id="6081385">)</span>&nbsp;<span class="ident" id="6081387">Sys</span><span class="op" id="6081390">(</span><span class="op" id="6081391">)</span>&nbsp;<span class="keyword" id="6081393">interface</span><span class="op" id="6081402">{</span><span class="op" id="6081403">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6081407">{</span>&nbsp;<span class="keyword" id="6081409">return</span>&nbsp;<span class="ident" id="6081416">fi</span><span class="op" id="6081418">.</span><span class="ident" id="6081419">h</span>&nbsp;<span class="op" id="6081421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6081424">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6081467">func</span>&nbsp;<span class="op" id="6081472">(</span><span class="ident" id="6081473">fi</span>&nbsp;<span class="ident" id="6081476">headerFileInfo</span><span class="op" id="6081490">)</span>&nbsp;<span class="ident" id="6081492">Name</span><span class="op" id="6081496">(</span><span class="op" id="6081497">)</span>&nbsp;<span class="builtintype" id="6081499">string</span>&nbsp;<span class="op" id="6081506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081509">if</span>&nbsp;<span class="ident" id="6081512">fi</span><span class="op" id="6081514">.</span><span class="ident" id="6081515">IsDir</span><span class="op" id="6081520">(</span><span class="op" id="6081521">)</span>&nbsp;<span class="op" id="6081523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081527">return</span>&nbsp;<span class="ident" id="6081534">path</span><span class="op" id="6081538">.</span><span class="ident" id="6081539">Base</span><span class="op" id="6081543">(</span><span class="ident" id="6081544">path</span><span class="op" id="6081548">.</span><span class="ident" id="6081549">Clean</span><span class="op" id="6081554">(</span><span class="ident" id="6081555">fi</span><span class="op" id="6081557">.</span><span class="ident" id="6081558">h</span><span class="op" id="6081559">.</span><span class="ident" id="6081560">Name</span><span class="op" id="6081564">)</span><span class="op" id="6081565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081568">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081571">return</span>&nbsp;<span class="ident" id="6081578">path</span><span class="op" id="6081582">.</span><span class="ident" id="6081583">Base</span><span class="op" id="6081587">(</span><span class="ident" id="6081588">fi</span><span class="op" id="6081590">.</span><span class="ident" id="6081591">h</span><span class="op" id="6081592">.</span><span class="ident" id="6081593">Name</span><span class="op" id="6081597">)</span><br>
<span class="lineno"></span><span class="op" id="6081599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6081602">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6081671">func</span>&nbsp;<span class="op" id="6081676">(</span><span class="ident" id="6081677">fi</span>&nbsp;<span class="ident" id="6081680">headerFileInfo</span><span class="op" id="6081694">)</span>&nbsp;<span class="ident" id="6081696">Mode</span><span class="op" id="6081700">(</span><span class="op" id="6081701">)</span>&nbsp;<span class="op" id="6081703">(</span><span class="ident" id="6081704">mode</span>&nbsp;<span class="ident" id="6081709">os</span><span class="op" id="6081711">.</span><span class="ident" id="6081712">FileMode</span><span class="op" id="6081720">)</span>&nbsp;<span class="op" id="6081722">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081725">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081755">mode</span>&nbsp;<span class="op" id="6081760">=</span>&nbsp;<span class="ident" id="6081762">os</span><span class="op" id="6081764">.</span><span class="ident" id="6081765">FileMode</span><span class="op" id="6081773">(</span><span class="ident" id="6081774">fi</span><span class="op" id="6081776">.</span><span class="ident" id="6081777">h</span><span class="op" id="6081778">.</span><span class="ident" id="6081779">Mode</span><span class="op" id="6081783">)</span><span class="op" id="6081784">.</span><span class="ident" id="6081785">Perm</span><span class="op" id="6081789">(</span><span class="op" id="6081790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081794">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081834">if</span>&nbsp;<span class="ident" id="6081837">fi</span><span class="op" id="6081839">.</span><span class="ident" id="6081840">h</span><span class="op" id="6081841">.</span><span class="ident" id="6081842">Mode</span><span class="op" id="6081846">&amp;</span><span class="ident" id="6081847">c_ISUID</span>&nbsp;<span class="op" id="6081855">!=</span>&nbsp;<span class="num" id="6081858">0</span>&nbsp;<span class="op" id="6081860">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081864">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081876">mode</span>&nbsp;<span class="op" id="6081881">|=</span>&nbsp;<span class="ident" id="6081884">os</span><span class="op" id="6081886">.</span><span class="ident" id="6081887">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081902">if</span>&nbsp;<span class="ident" id="6081905">fi</span><span class="op" id="6081907">.</span><span class="ident" id="6081908">h</span><span class="op" id="6081909">.</span><span class="ident" id="6081910">Mode</span><span class="op" id="6081914">&amp;</span><span class="ident" id="6081915">c_ISGID</span>&nbsp;<span class="op" id="6081923">!=</span>&nbsp;<span class="num" id="6081926">0</span>&nbsp;<span class="op" id="6081928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081932">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081944">mode</span>&nbsp;<span class="op" id="6081949">|=</span>&nbsp;<span class="ident" id="6081952">os</span><span class="op" id="6081954">.</span><span class="ident" id="6081955">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081970">if</span>&nbsp;<span class="ident" id="6081973">fi</span><span class="op" id="6081975">.</span><span class="ident" id="6081976">h</span><span class="op" id="6081977">.</span><span class="ident" id="6081978">Mode</span><span class="op" id="6081982">&amp;</span><span class="ident" id="6081983">c_ISVTX</span>&nbsp;<span class="op" id="6081991">!=</span>&nbsp;<span class="num" id="6081994">0</span>&nbsp;<span class="op" id="6081996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082000">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082012">mode</span>&nbsp;<span class="op" id="6082017">|=</span>&nbsp;<span class="ident" id="6082020">os</span><span class="op" id="6082022">.</span><span class="ident" id="6082023">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082039">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082063">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082111">m</span>&nbsp;<span class="op" id="6082113">:=</span>&nbsp;<span class="ident" id="6082116">os</span><span class="op" id="6082118">.</span><span class="ident" id="6082119">FileMode</span><span class="op" id="6082127">(</span><span class="ident" id="6082128">fi</span><span class="op" id="6082130">.</span><span class="ident" id="6082131">h</span><span class="op" id="6082132">.</span><span class="ident" id="6082133">Mode</span><span class="op" id="6082137">)</span>&nbsp;<span class="op" id="6082139">&amp;^</span>&nbsp;<span class="num" id="6082142">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082149">if</span>&nbsp;<span class="ident" id="6082152">m</span>&nbsp;<span class="op" id="6082154">==</span>&nbsp;<span class="ident" id="6082157">c_ISDIR</span>&nbsp;<span class="op" id="6082165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082169">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082184">mode</span>&nbsp;<span class="op" id="6082189">|=</span>&nbsp;<span class="ident" id="6082192">os</span><span class="op" id="6082194">.</span><span class="ident" id="6082195">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082207">if</span>&nbsp;<span class="ident" id="6082210">m</span>&nbsp;<span class="op" id="6082212">==</span>&nbsp;<span class="ident" id="6082215">c_ISFIFO</span>&nbsp;<span class="op" id="6082224">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082228">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082251">mode</span>&nbsp;<span class="op" id="6082256">|=</span>&nbsp;<span class="ident" id="6082259">os</span><span class="op" id="6082261">.</span><span class="ident" id="6082262">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082280">if</span>&nbsp;<span class="ident" id="6082283">m</span>&nbsp;<span class="op" id="6082285">==</span>&nbsp;<span class="ident" id="6082288">c_ISLNK</span>&nbsp;<span class="op" id="6082296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082300">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082319">mode</span>&nbsp;<span class="op" id="6082324">|=</span>&nbsp;<span class="ident" id="6082327">os</span><span class="op" id="6082329">.</span><span class="ident" id="6082330">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082346">if</span>&nbsp;<span class="ident" id="6082349">m</span>&nbsp;<span class="op" id="6082351">==</span>&nbsp;<span class="ident" id="6082354">c_ISBLK</span>&nbsp;<span class="op" id="6082362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082366">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082383">mode</span>&nbsp;<span class="op" id="6082388">|=</span>&nbsp;<span class="ident" id="6082391">os</span><span class="op" id="6082393">.</span><span class="ident" id="6082394">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082409">if</span>&nbsp;<span class="ident" id="6082412">m</span>&nbsp;<span class="op" id="6082414">==</span>&nbsp;<span class="ident" id="6082417">c_ISCHR</span>&nbsp;<span class="op" id="6082425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082429">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082456">mode</span>&nbsp;<span class="op" id="6082461">|=</span>&nbsp;<span class="ident" id="6082464">os</span><span class="op" id="6082466">.</span><span class="ident" id="6082467">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082480">mode</span>&nbsp;<span class="op" id="6082485">|=</span>&nbsp;<span class="ident" id="6082488">os</span><span class="op" id="6082490">.</span><span class="ident" id="6082491">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082510">if</span>&nbsp;<span class="ident" id="6082513">m</span>&nbsp;<span class="op" id="6082515">==</span>&nbsp;<span class="ident" id="6082518">c_ISSOCK</span>&nbsp;<span class="op" id="6082527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082531">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082555">mode</span>&nbsp;<span class="op" id="6082560">|=</span>&nbsp;<span class="ident" id="6082563">os</span><span class="op" id="6082565">.</span><span class="ident" id="6082566">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082578">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082582">switch</span>&nbsp;<span class="ident" id="6082589">fi</span><span class="op" id="6082591">.</span><span class="ident" id="6082592">h</span><span class="op" id="6082593">.</span><span class="ident" id="6082594">Typeflag</span>&nbsp;<span class="op" id="6082603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082606">case</span>&nbsp;<span class="ident" id="6082611">TypeLink</span><span class="op" id="6082619">,</span>&nbsp;<span class="ident" id="6082621">TypeSymlink</span><span class="op" id="6082632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082636">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082666">mode</span>&nbsp;<span class="op" id="6082671">|=</span>&nbsp;<span class="ident" id="6082674">os</span><span class="op" id="6082676">.</span><span class="ident" id="6082677">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082690">case</span>&nbsp;<span class="ident" id="6082695">TypeChar</span><span class="op" id="6082703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082707">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082734">mode</span>&nbsp;<span class="op" id="6082739">|=</span>&nbsp;<span class="ident" id="6082742">os</span><span class="op" id="6082744">.</span><span class="ident" id="6082745">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082758">mode</span>&nbsp;<span class="op" id="6082763">|=</span>&nbsp;<span class="ident" id="6082766">os</span><span class="op" id="6082768">.</span><span class="ident" id="6082769">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082785">case</span>&nbsp;<span class="ident" id="6082790">TypeBlock</span><span class="op" id="6082799">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082803">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082826">mode</span>&nbsp;<span class="op" id="6082831">|=</span>&nbsp;<span class="ident" id="6082834">os</span><span class="op" id="6082836">.</span><span class="ident" id="6082837">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082849">case</span>&nbsp;<span class="ident" id="6082854">TypeDir</span><span class="op" id="6082861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082865">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082880">mode</span>&nbsp;<span class="op" id="6082885">|=</span>&nbsp;<span class="ident" id="6082888">os</span><span class="op" id="6082890">.</span><span class="ident" id="6082891">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082900">case</span>&nbsp;<span class="ident" id="6082905">TypeFifo</span><span class="op" id="6082913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082917">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082932">mode</span>&nbsp;<span class="op" id="6082937">|=</span>&nbsp;<span class="ident" id="6082940">os</span><span class="op" id="6082942">.</span><span class="ident" id="6082943">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082962">return</span>&nbsp;<span class="ident" id="6082969">mode</span><br>
<span class="lineno"></span><span class="op" id="6082974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082977">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="6083049">var</span>&nbsp;<span class="ident" id="6083053">sysStat</span>&nbsp;<span class="keyword" id="6083061">func</span><span class="op" id="6083065">(</span><span class="ident" id="6083066">fi</span>&nbsp;<span class="ident" id="6083069">os</span><span class="op" id="6083071">.</span><span class="ident" id="6083072">FileInfo</span><span class="op" id="6083080">,</span>&nbsp;<span class="ident" id="6083082">h</span>&nbsp;<span class="op" id="6083084">*</span><span class="ident" id="6083085">Header</span><span class="op" id="6083091">)</span>&nbsp;<span class="builtintype" id="6083093">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="6083100">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6083137">const</span>&nbsp;<span class="op" id="6083143">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083146">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="6083155">=</span>&nbsp;<span class="num" id="6083157">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6083165">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083177">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="6083186">=</span>&nbsp;<span class="num" id="6083188">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6083196">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083208">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6083217">=</span>&nbsp;<span class="num" id="6083219">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6083227">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083254">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="6083263">=</span>&nbsp;<span class="num" id="6083265">040000</span>&nbsp;&nbsp;<span class="comment" id="6083273">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083287">c_ISFIFO</span>&nbsp;<span class="op" id="6083296">=</span>&nbsp;<span class="num" id="6083298">010000</span>&nbsp;&nbsp;<span class="comment" id="6083306">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083315">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="6083324">=</span>&nbsp;<span class="num" id="6083326">0100000</span>&nbsp;<span class="comment" id="6083334">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083351">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="6083360">=</span>&nbsp;<span class="num" id="6083362">0120000</span>&nbsp;<span class="comment" id="6083370">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083388">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="6083397">=</span>&nbsp;<span class="num" id="6083399">060000</span>&nbsp;&nbsp;<span class="comment" id="6083407">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083430">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="6083439">=</span>&nbsp;<span class="num" id="6083441">020000</span>&nbsp;&nbsp;<span class="comment" id="6083449">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083476">c_ISSOCK</span>&nbsp;<span class="op" id="6083485">=</span>&nbsp;<span class="num" id="6083487">0140000</span>&nbsp;<span class="comment" id="6083495">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="6083505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="6083508">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="6083548">const</span>&nbsp;<span class="op" id="6083554">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083557">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083569">=</span>&nbsp;<span class="string" id="6083571">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083580">paxCharset</span>&nbsp;&nbsp;<span class="op" id="6083592">=</span>&nbsp;<span class="string" id="6083594">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083605">paxComment</span>&nbsp;&nbsp;<span class="op" id="6083617">=</span>&nbsp;<span class="string" id="6083619">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083630">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083642">=</span>&nbsp;<span class="string" id="6083644">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="6083652">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083706">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083718">=</span>&nbsp;<span class="string" id="6083720">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083727">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083739">=</span>&nbsp;<span class="string" id="6083741">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083750">paxLinkpath</span>&nbsp;<span class="op" id="6083762">=</span>&nbsp;<span class="string" id="6083764">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083776">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083788">=</span>&nbsp;<span class="string" id="6083790">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083799">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083811">=</span>&nbsp;<span class="string" id="6083813">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083821">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083833">=</span>&nbsp;<span class="string" id="6083835">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083843">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083855">=</span>&nbsp;<span class="string" id="6083857">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083864">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083876">=</span>&nbsp;<span class="string" id="6083878">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083887">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083899">=</span>&nbsp;<span class="string" id="6083901">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083918">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6083930">=</span>&nbsp;<span class="string" id="6083932">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="6083935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083938">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="6084002">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="6084080">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="6084145">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6084212">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6084283">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6084352">func</span>&nbsp;<span class="ident" id="6084357">FileInfoHeader</span><span class="op" id="6084371">(</span><span class="ident" id="6084372">fi</span>&nbsp;<span class="ident" id="6084375">os</span><span class="op" id="6084377">.</span><span class="ident" id="6084378">FileInfo</span><span class="op" id="6084386">,</span>&nbsp;<span class="ident" id="6084388">link</span>&nbsp;<span class="builtintype" id="6084393">string</span><span class="op" id="6084399">)</span>&nbsp;<span class="op" id="6084401">(</span><span class="op" id="6084402">*</span><span class="ident" id="6084403">Header</span><span class="op" id="6084409">,</span>&nbsp;<span class="builtintype" id="6084411">error</span><span class="op" id="6084416">)</span>&nbsp;<span class="op" id="6084418">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084421">if</span>&nbsp;<span class="ident" id="6084424">fi</span>&nbsp;<span class="op" id="6084427">==</span>&nbsp;<span class="ident" id="6084430">nil</span>&nbsp;<span class="op" id="6084434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084438">return</span>&nbsp;<span class="ident" id="6084445">nil</span><span class="op" id="6084448">,</span>&nbsp;<span class="ident" id="6084450">errors</span><span class="op" id="6084456">.</span><span class="ident" id="6084457">New</span><span class="op" id="6084460">(</span><span class="string" id="6084461">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="6084483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084489">fm</span>&nbsp;<span class="op" id="6084492">:=</span>&nbsp;<span class="ident" id="6084495">fi</span><span class="op" id="6084497">.</span><span class="ident" id="6084498">Mode</span><span class="op" id="6084502">(</span><span class="op" id="6084503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084506">h</span>&nbsp;<span class="op" id="6084508">:=</span>&nbsp;<span class="op" id="6084511">&amp;</span><span class="ident" id="6084512">Header</span><span class="op" id="6084518">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084522">Name</span><span class="op" id="6084526">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084531">fi</span><span class="op" id="6084533">.</span><span class="ident" id="6084534">Name</span><span class="op" id="6084538">(</span><span class="op" id="6084539">)</span><span class="op" id="6084540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084544">ModTime</span><span class="op" id="6084551">:</span>&nbsp;<span class="ident" id="6084553">fi</span><span class="op" id="6084555">.</span><span class="ident" id="6084556">ModTime</span><span class="op" id="6084563">(</span><span class="op" id="6084564">)</span><span class="op" id="6084565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084569">Mode</span><span class="op" id="6084573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084578">int64</span><span class="op" id="6084583">(</span><span class="ident" id="6084584">fm</span><span class="op" id="6084586">.</span><span class="ident" id="6084587">Perm</span><span class="op" id="6084591">(</span><span class="op" id="6084592">)</span><span class="op" id="6084593">)</span><span class="op" id="6084594">,</span>&nbsp;<span class="comment" id="6084596">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084635">switch</span>&nbsp;<span class="op" id="6084642">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084645">case</span>&nbsp;<span class="ident" id="6084650">fm</span><span class="op" id="6084652">.</span><span class="ident" id="6084653">IsRegular</span><span class="op" id="6084662">(</span><span class="op" id="6084663">)</span><span class="op" id="6084664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084668">h</span><span class="op" id="6084669">.</span><span class="ident" id="6084670">Mode</span>&nbsp;<span class="op" id="6084675">|=</span>&nbsp;<span class="ident" id="6084678">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084688">h</span><span class="op" id="6084689">.</span><span class="ident" id="6084690">Typeflag</span>&nbsp;<span class="op" id="6084699">=</span>&nbsp;<span class="ident" id="6084701">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084711">h</span><span class="op" id="6084712">.</span><span class="ident" id="6084713">Size</span>&nbsp;<span class="op" id="6084718">=</span>&nbsp;<span class="ident" id="6084720">fi</span><span class="op" id="6084722">.</span><span class="ident" id="6084723">Size</span><span class="op" id="6084727">(</span><span class="op" id="6084728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084731">case</span>&nbsp;<span class="ident" id="6084736">fi</span><span class="op" id="6084738">.</span><span class="ident" id="6084739">IsDir</span><span class="op" id="6084744">(</span><span class="op" id="6084745">)</span><span class="op" id="6084746">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084750">h</span><span class="op" id="6084751">.</span><span class="ident" id="6084752">Typeflag</span>&nbsp;<span class="op" id="6084761">=</span>&nbsp;<span class="ident" id="6084763">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084773">h</span><span class="op" id="6084774">.</span><span class="ident" id="6084775">Mode</span>&nbsp;<span class="op" id="6084780">|=</span>&nbsp;<span class="ident" id="6084783">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084793">h</span><span class="op" id="6084794">.</span><span class="ident" id="6084795">Name</span>&nbsp;<span class="op" id="6084800">+=</span>&nbsp;<span class="string" id="6084803">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084808">case</span>&nbsp;<span class="ident" id="6084813">fm</span><span class="op" id="6084815">&amp;</span><span class="ident" id="6084816">os</span><span class="op" id="6084818">.</span><span class="ident" id="6084819">ModeSymlink</span>&nbsp;<span class="op" id="6084831">!=</span>&nbsp;<span class="num" id="6084834">0</span><span class="op" id="6084835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084839">h</span><span class="op" id="6084840">.</span><span class="ident" id="6084841">Typeflag</span>&nbsp;<span class="op" id="6084850">=</span>&nbsp;<span class="ident" id="6084852">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084866">h</span><span class="op" id="6084867">.</span><span class="ident" id="6084868">Mode</span>&nbsp;<span class="op" id="6084873">|=</span>&nbsp;<span class="ident" id="6084876">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084886">h</span><span class="op" id="6084887">.</span><span class="ident" id="6084888">Linkname</span>&nbsp;<span class="op" id="6084897">=</span>&nbsp;<span class="ident" id="6084899">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084905">case</span>&nbsp;<span class="ident" id="6084910">fm</span><span class="op" id="6084912">&amp;</span><span class="ident" id="6084913">os</span><span class="op" id="6084915">.</span><span class="ident" id="6084916">ModeDevice</span>&nbsp;<span class="op" id="6084927">!=</span>&nbsp;<span class="num" id="6084930">0</span><span class="op" id="6084931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084935">if</span>&nbsp;<span class="ident" id="6084938">fm</span><span class="op" id="6084940">&amp;</span><span class="ident" id="6084941">os</span><span class="op" id="6084943">.</span><span class="ident" id="6084944">ModeCharDevice</span>&nbsp;<span class="op" id="6084959">!=</span>&nbsp;<span class="num" id="6084962">0</span>&nbsp;<span class="op" id="6084964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084969">h</span><span class="op" id="6084970">.</span><span class="ident" id="6084971">Mode</span>&nbsp;<span class="op" id="6084976">|=</span>&nbsp;<span class="ident" id="6084979">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084990">h</span><span class="op" id="6084991">.</span><span class="ident" id="6084992">Typeflag</span>&nbsp;<span class="op" id="6085001">=</span>&nbsp;<span class="ident" id="6085003">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085014">}</span>&nbsp;<span class="keyword" id="6085016">else</span>&nbsp;<span class="op" id="6085021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085026">h</span><span class="op" id="6085027">.</span><span class="ident" id="6085028">Mode</span>&nbsp;<span class="op" id="6085033">|=</span>&nbsp;<span class="ident" id="6085036">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085047">h</span><span class="op" id="6085048">.</span><span class="ident" id="6085049">Typeflag</span>&nbsp;<span class="op" id="6085058">=</span>&nbsp;<span class="ident" id="6085060">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085072">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085075">case</span>&nbsp;<span class="ident" id="6085080">fm</span><span class="op" id="6085082">&amp;</span><span class="ident" id="6085083">os</span><span class="op" id="6085085">.</span><span class="ident" id="6085086">ModeNamedPipe</span>&nbsp;<span class="op" id="6085100">!=</span>&nbsp;<span class="num" id="6085103">0</span><span class="op" id="6085104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085108">h</span><span class="op" id="6085109">.</span><span class="ident" id="6085110">Typeflag</span>&nbsp;<span class="op" id="6085119">=</span>&nbsp;<span class="ident" id="6085121">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085132">h</span><span class="op" id="6085133">.</span><span class="ident" id="6085134">Mode</span>&nbsp;<span class="op" id="6085139">|=</span>&nbsp;<span class="ident" id="6085142">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085152">case</span>&nbsp;<span class="ident" id="6085157">fm</span><span class="op" id="6085159">&amp;</span><span class="ident" id="6085160">os</span><span class="op" id="6085162">.</span><span class="ident" id="6085163">ModeSocket</span>&nbsp;<span class="op" id="6085174">!=</span>&nbsp;<span class="num" id="6085177">0</span><span class="op" id="6085178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085182">h</span><span class="op" id="6085183">.</span><span class="ident" id="6085184">Mode</span>&nbsp;<span class="op" id="6085189">|=</span>&nbsp;<span class="ident" id="6085192">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085202">default</span><span class="op" id="6085209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085213">return</span>&nbsp;<span class="ident" id="6085220">nil</span><span class="op" id="6085223">,</span>&nbsp;<span class="ident" id="6085225">fmt</span><span class="op" id="6085228">.</span><span class="ident" id="6085229">Errorf</span><span class="op" id="6085235">(</span><span class="string" id="6085236">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="6085271">,</span>&nbsp;<span class="ident" id="6085273">fm</span><span class="op" id="6085275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085281">if</span>&nbsp;<span class="ident" id="6085284">fm</span><span class="op" id="6085286">&amp;</span><span class="ident" id="6085287">os</span><span class="op" id="6085289">.</span><span class="ident" id="6085290">ModeSetuid</span>&nbsp;<span class="op" id="6085301">!=</span>&nbsp;<span class="num" id="6085304">0</span>&nbsp;<span class="op" id="6085306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085310">h</span><span class="op" id="6085311">.</span><span class="ident" id="6085312">Mode</span>&nbsp;<span class="op" id="6085317">|=</span>&nbsp;<span class="ident" id="6085320">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085332">if</span>&nbsp;<span class="ident" id="6085335">fm</span><span class="op" id="6085337">&amp;</span><span class="ident" id="6085338">os</span><span class="op" id="6085340">.</span><span class="ident" id="6085341">ModeSetgid</span>&nbsp;<span class="op" id="6085352">!=</span>&nbsp;<span class="num" id="6085355">0</span>&nbsp;<span class="op" id="6085357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085361">h</span><span class="op" id="6085362">.</span><span class="ident" id="6085363">Mode</span>&nbsp;<span class="op" id="6085368">|=</span>&nbsp;<span class="ident" id="6085371">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085383">if</span>&nbsp;<span class="ident" id="6085386">fm</span><span class="op" id="6085388">&amp;</span><span class="ident" id="6085389">os</span><span class="op" id="6085391">.</span><span class="ident" id="6085392">ModeSticky</span>&nbsp;<span class="op" id="6085403">!=</span>&nbsp;<span class="num" id="6085406">0</span>&nbsp;<span class="op" id="6085408">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085412">h</span><span class="op" id="6085413">.</span><span class="ident" id="6085414">Mode</span>&nbsp;<span class="op" id="6085419">|=</span>&nbsp;<span class="ident" id="6085422">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085434">if</span>&nbsp;<span class="ident" id="6085437">sysStat</span>&nbsp;<span class="op" id="6085445">!=</span>&nbsp;<span class="ident" id="6085448">nil</span>&nbsp;<span class="op" id="6085452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085456">return</span>&nbsp;<span class="ident" id="6085463">h</span><span class="op" id="6085464">,</span>&nbsp;<span class="ident" id="6085466">sysStat</span><span class="op" id="6085473">(</span><span class="ident" id="6085474">fi</span><span class="op" id="6085476">,</span>&nbsp;<span class="ident" id="6085478">h</span><span class="op" id="6085479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085482">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085485">return</span>&nbsp;<span class="ident" id="6085492">h</span><span class="op" id="6085493">,</span>&nbsp;<span class="ident" id="6085495">nil</span><br>
<span class="lineno"></span><span class="op" id="6085499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6085502">var</span>&nbsp;<span class="ident" id="6085506">zeroBlock</span>&nbsp;<span class="op" id="6085516">=</span>&nbsp;<span class="builtinfunc" id="6085518">make</span><span class="op" id="6085522">(</span><span class="op" id="6085523">[</span><span class="op" id="6085524">]</span><span class="builtintype" id="6085525">byte</span><span class="op" id="6085529">,</span>&nbsp;<span class="ident" id="6085531">blockSize</span><span class="op" id="6085540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6085543">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="6085638">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="6085669">func</span>&nbsp;<span class="ident" id="6085674">checksum</span><span class="op" id="6085682">(</span><span class="ident" id="6085683">header</span>&nbsp;<span class="op" id="6085690">[</span><span class="op" id="6085691">]</span><span class="builtintype" id="6085692">byte</span><span class="op" id="6085696">)</span>&nbsp;<span class="op" id="6085698">(</span><span class="ident" id="6085699">unsigned</span>&nbsp;<span class="ident" id="6085708">int64</span><span class="op" id="6085713">,</span>&nbsp;<span class="ident" id="6085715">signed</span>&nbsp;<span class="ident" id="6085722">int64</span><span class="op" id="6085727">)</span>&nbsp;<span class="op" id="6085729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085732">for</span>&nbsp;<span class="ident" id="6085736">i</span>&nbsp;<span class="op" id="6085738">:=</span>&nbsp;<span class="num" id="6085741">0</span><span class="op" id="6085742">;</span>&nbsp;<span class="ident" id="6085744">i</span>&nbsp;<span class="op" id="6085746">&lt;</span>&nbsp;<span class="builtinfunc" id="6085748">len</span><span class="op" id="6085751">(</span><span class="ident" id="6085752">header</span><span class="op" id="6085758">)</span><span class="op" id="6085759">;</span>&nbsp;<span class="ident" id="6085761">i</span><span class="op" id="6085762">++</span>&nbsp;<span class="op" id="6085765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085769">if</span>&nbsp;<span class="ident" id="6085772">i</span>&nbsp;<span class="op" id="6085774">==</span>&nbsp;<span class="num" id="6085777">148</span>&nbsp;<span class="op" id="6085781">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085786">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085876">unsigned</span>&nbsp;<span class="op" id="6085885">+=</span>&nbsp;<span class="string" id="6085888">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6085892">*</span>&nbsp;<span class="num" id="6085894">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085899">signed</span>&nbsp;<span class="op" id="6085906">+=</span>&nbsp;<span class="string" id="6085909">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6085913">*</span>&nbsp;<span class="num" id="6085915">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085920">i</span>&nbsp;<span class="op" id="6085922">+=</span>&nbsp;<span class="num" id="6085925">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085930">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085945">unsigned</span>&nbsp;<span class="op" id="6085954">+=</span>&nbsp;<span class="ident" id="6085957">int64</span><span class="op" id="6085962">(</span><span class="ident" id="6085963">header</span><span class="op" id="6085969">[</span><span class="ident" id="6085970">i</span><span class="op" id="6085971">]</span><span class="op" id="6085972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085976">signed</span>&nbsp;<span class="op" id="6085983">+=</span>&nbsp;<span class="ident" id="6085986">int64</span><span class="op" id="6085991">(</span><span class="builtintype" id="6085992">int8</span><span class="op" id="6085996">(</span><span class="ident" id="6085997">header</span><span class="op" id="6086003">[</span><span class="ident" id="6086004">i</span><span class="op" id="6086005">]</span><span class="op" id="6086006">)</span><span class="op" id="6086007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086013">return</span><br>
<span class="lineno">275</span><span class="op" id="6086020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086023">type</span>&nbsp;<span class="ident" id="6086028">slicer</span>&nbsp;<span class="op" id="6086035">[</span><span class="op" id="6086036">]</span><span class="builtintype" id="6086037">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086043">func</span>&nbsp;<span class="op" id="6086048">(</span><span class="ident" id="6086049">sp</span>&nbsp;<span class="op" id="6086052">*</span><span class="ident" id="6086053">slicer</span><span class="op" id="6086059">)</span>&nbsp;<span class="ident" id="6086061">next</span><span class="op" id="6086065">(</span><span class="ident" id="6086066">n</span>&nbsp;<span class="builtintype" id="6086068">int</span><span class="op" id="6086071">)</span>&nbsp;<span class="op" id="6086073">(</span><span class="ident" id="6086074">b</span>&nbsp;<span class="op" id="6086076">[</span><span class="op" id="6086077">]</span><span class="builtintype" id="6086078">byte</span><span class="op" id="6086082">)</span>&nbsp;<span class="op" id="6086084">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086087">s</span>&nbsp;<span class="op" id="6086089">:=</span>&nbsp;<span class="op" id="6086092">*</span><span class="ident" id="6086093">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086097">b</span><span class="op" id="6086098">,</span>&nbsp;<span class="op" id="6086100">*</span><span class="ident" id="6086101">sp</span>&nbsp;<span class="op" id="6086104">=</span>&nbsp;<span class="ident" id="6086106">s</span><span class="op" id="6086107">[</span><span class="num" id="6086108">0</span><span class="op" id="6086109">:</span><span class="ident" id="6086110">n</span><span class="op" id="6086111">]</span><span class="op" id="6086112">,</span>&nbsp;<span class="ident" id="6086114">s</span><span class="op" id="6086115">[</span><span class="ident" id="6086116">n</span><span class="op" id="6086117">:</span><span class="op" id="6086118">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086121">return</span><br>
<span class="lineno"></span><span class="op" id="6086128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6086131">func</span>&nbsp;<span class="ident" id="6086136">isASCII</span><span class="op" id="6086143">(</span><span class="ident" id="6086144">s</span>&nbsp;<span class="builtintype" id="6086146">string</span><span class="op" id="6086152">)</span>&nbsp;<span class="builtintype" id="6086154">bool</span>&nbsp;<span class="op" id="6086159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086162">for</span>&nbsp;<span class="ident" id="6086166">_</span><span class="op" id="6086167">,</span>&nbsp;<span class="ident" id="6086169">c</span>&nbsp;<span class="op" id="6086171">:=</span>&nbsp;<span class="keyword" id="6086174">range</span>&nbsp;<span class="ident" id="6086180">s</span>&nbsp;<span class="op" id="6086182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086186">if</span>&nbsp;<span class="ident" id="6086189">c</span>&nbsp;<span class="op" id="6086191">&gt;=</span>&nbsp;<span class="num" id="6086194">0x80</span>&nbsp;<span class="op" id="6086199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086204">return</span>&nbsp;<span class="builtintype" id="6086211">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086219">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086225">return</span>&nbsp;<span class="builtintype" id="6086232">true</span><br>
<span class="lineno"></span><span class="op" id="6086237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086240">func</span>&nbsp;<span class="ident" id="6086245">toASCII</span><span class="op" id="6086252">(</span><span class="ident" id="6086253">s</span>&nbsp;<span class="builtintype" id="6086255">string</span><span class="op" id="6086261">)</span>&nbsp;<span class="builtintype" id="6086263">string</span>&nbsp;<span class="op" id="6086270">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086273">if</span>&nbsp;<span class="ident" id="6086276">isASCII</span><span class="op" id="6086283">(</span><span class="ident" id="6086284">s</span><span class="op" id="6086285">)</span>&nbsp;<span class="op" id="6086287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086291">return</span>&nbsp;<span class="ident" id="6086298">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086304">var</span>&nbsp;<span class="ident" id="6086308">buf</span>&nbsp;<span class="ident" id="6086312">bytes</span><span class="op" id="6086317">.</span><span class="ident" id="6086318">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086326">for</span>&nbsp;<span class="ident" id="6086330">_</span><span class="op" id="6086331">,</span>&nbsp;<span class="ident" id="6086333">c</span>&nbsp;<span class="op" id="6086335">:=</span>&nbsp;<span class="keyword" id="6086338">range</span>&nbsp;<span class="ident" id="6086344">s</span>&nbsp;<span class="op" id="6086346">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086350">if</span>&nbsp;<span class="ident" id="6086353">c</span>&nbsp;<span class="op" id="6086355">&lt;</span>&nbsp;<span class="num" id="6086357">0x80</span>&nbsp;<span class="op" id="6086362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086367">buf</span><span class="op" id="6086370">.</span><span class="ident" id="6086371">WriteByte</span><span class="op" id="6086380">(</span><span class="builtintype" id="6086381">byte</span><span class="op" id="6086385">(</span><span class="ident" id="6086386">c</span><span class="op" id="6086387">)</span><span class="op" id="6086388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086398">return</span>&nbsp;<span class="ident" id="6086405">buf</span><span class="op" id="6086408">.</span><span class="ident" id="6086409">String</span><span class="op" id="6086415">(</span><span class="op" id="6086416">)</span><br>
<span class="lineno">305</span><span class="op" id="6086418">}</span>
</div>
</body>
</html>
