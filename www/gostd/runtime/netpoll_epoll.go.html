<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html" class="current">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1645320">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1645375">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1645429">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1645480">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1645497">package</span>&nbsp;<span class="ident" id="1645505">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1645514">import</span>&nbsp;<span class="string" id="1645521">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1645531">func</span>&nbsp;<span class="ident" id="1645536">epollcreate</span><span class="op" id="1645547">(</span><span class="ident" id="1645548">size</span>&nbsp;<span class="builtintype" id="1645553">int32</span><span class="op" id="1645558">)</span>&nbsp;<span class="builtintype" id="1645560">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1645566">func</span>&nbsp;<span class="ident" id="1645571">epollcreate1</span><span class="op" id="1645583">(</span><span class="ident" id="1645584">flags</span>&nbsp;<span class="builtintype" id="1645590">int32</span><span class="op" id="1645595">)</span>&nbsp;<span class="builtintype" id="1645597">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1645604">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1645618">func</span>&nbsp;<span class="ident" id="1645623">epollctl</span><span class="op" id="1645631">(</span><span class="ident" id="1645632">epfd</span><span class="op" id="1645636">,</span>&nbsp;<span class="ident" id="1645638">op</span><span class="op" id="1645640">,</span>&nbsp;<span class="ident" id="1645642">fd</span>&nbsp;<span class="builtintype" id="1645645">int32</span><span class="op" id="1645650">,</span>&nbsp;<span class="ident" id="1645652">ev</span>&nbsp;<span class="op" id="1645655">*</span><span class="ident" id="1645656">epollevent</span><span class="op" id="1645666">)</span>&nbsp;<span class="builtintype" id="1645668">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1645675">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1645689">func</span>&nbsp;<span class="ident" id="1645694">epollwait</span><span class="op" id="1645703">(</span><span class="ident" id="1645704">epfd</span>&nbsp;<span class="builtintype" id="1645709">int32</span><span class="op" id="1645714">,</span>&nbsp;<span class="ident" id="1645716">ev</span>&nbsp;<span class="op" id="1645719">*</span><span class="ident" id="1645720">epollevent</span><span class="op" id="1645730">,</span>&nbsp;<span class="ident" id="1645732">nev</span><span class="op" id="1645735">,</span>&nbsp;<span class="ident" id="1645737">timeout</span>&nbsp;<span class="builtintype" id="1645745">int32</span><span class="op" id="1645750">)</span>&nbsp;<span class="builtintype" id="1645752">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1645758">func</span>&nbsp;<span class="ident" id="1645763">closeonexec</span><span class="op" id="1645774">(</span><span class="ident" id="1645775">fd</span>&nbsp;<span class="builtintype" id="1645778">int32</span><span class="op" id="1645783">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1645786">var</span>&nbsp;<span class="op" id="1645790">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645793">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1645808">int32</span>&nbsp;<span class="op" id="1645814">=</span>&nbsp;<span class="op" id="1645816">-</span><span class="num" id="1645817">1</span>&nbsp;<span class="comment" id="1645819">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645840">netpolllasterr</span>&nbsp;<span class="builtintype" id="1645855">int32</span><br>
<span class="lineno"></span><span class="op" id="1645861">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1645864">func</span>&nbsp;<span class="ident" id="1645869">netpollinit</span><span class="op" id="1645880">(</span><span class="op" id="1645881">)</span>&nbsp;<span class="op" id="1645883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645886">epfd</span>&nbsp;<span class="op" id="1645891">=</span>&nbsp;<span class="ident" id="1645893">epollcreate1</span><span class="op" id="1645905">(</span><span class="ident" id="1645906">_EPOLL_CLOEXEC</span><span class="op" id="1645920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645923">if</span>&nbsp;<span class="ident" id="1645926">epfd</span>&nbsp;<span class="op" id="1645931">&gt;=</span>&nbsp;<span class="num" id="1645934">0</span>&nbsp;<span class="op" id="1645936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645940">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1645948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645951">epfd</span>&nbsp;<span class="op" id="1645956">=</span>&nbsp;<span class="ident" id="1645958">epollcreate</span><span class="op" id="1645969">(</span><span class="num" id="1645970">1024</span><span class="op" id="1645974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645977">if</span>&nbsp;<span class="ident" id="1645980">epfd</span>&nbsp;<span class="op" id="1645985">&gt;=</span>&nbsp;<span class="num" id="1645988">0</span>&nbsp;<span class="op" id="1645990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645994">closeonexec</span><span class="op" id="1646005">(</span><span class="ident" id="1646006">epfd</span><span class="op" id="1646010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646014">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1646025">println</span><span class="op" id="1646032">(</span><span class="string" id="1646033">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1646081">,</span>&nbsp;<span class="op" id="1646083">-</span><span class="ident" id="1646084">epfd</span><span class="op" id="1646088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646091">gothrow</span><span class="op" id="1646098">(</span><span class="string" id="1646099">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1646141">)</span><br>
<span class="lineno"></span><span class="op" id="1646143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1646146">func</span>&nbsp;<span class="ident" id="1646151">netpollopen</span><span class="op" id="1646162">(</span><span class="ident" id="1646163">fd</span>&nbsp;<span class="builtintype" id="1646166">uintptr</span><span class="op" id="1646173">,</span>&nbsp;<span class="ident" id="1646175">pd</span>&nbsp;<span class="op" id="1646178">*</span><span class="ident" id="1646179">pollDesc</span><span class="op" id="1646187">)</span>&nbsp;<span class="builtintype" id="1646189">int32</span>&nbsp;<span class="op" id="1646195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646198">var</span>&nbsp;<span class="ident" id="1646202">ev</span>&nbsp;<span class="ident" id="1646205">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646217">ev</span><span class="op" id="1646219">.</span><span class="ident" id="1646220">events</span>&nbsp;<span class="op" id="1646227">=</span>&nbsp;<span class="ident" id="1646229">_EPOLLIN</span>&nbsp;<span class="op" id="1646238">|</span>&nbsp;<span class="ident" id="1646240">_EPOLLOUT</span>&nbsp;<span class="op" id="1646250">|</span>&nbsp;<span class="ident" id="1646252">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1646264">|</span>&nbsp;<span class="ident" id="1646266">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646276">*</span><span class="op" id="1646277">(</span><span class="op" id="1646278">*</span><span class="op" id="1646279">*</span><span class="ident" id="1646280">pollDesc</span><span class="op" id="1646288">)</span><span class="op" id="1646289">(</span><span class="ident" id="1646290">unsafe</span><span class="op" id="1646296">.</span><span class="ident" id="1646297">Pointer</span><span class="op" id="1646304">(</span><span class="op" id="1646305">&amp;</span><span class="ident" id="1646306">ev</span><span class="op" id="1646308">.</span><span class="ident" id="1646309">data</span><span class="op" id="1646313">)</span><span class="op" id="1646314">)</span>&nbsp;<span class="op" id="1646316">=</span>&nbsp;<span class="ident" id="1646318">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646322">return</span>&nbsp;<span class="op" id="1646329">-</span><span class="ident" id="1646330">epollctl</span><span class="op" id="1646338">(</span><span class="ident" id="1646339">epfd</span><span class="op" id="1646343">,</span>&nbsp;<span class="ident" id="1646345">_EPOLL_CTL_ADD</span><span class="op" id="1646359">,</span>&nbsp;<span class="builtintype" id="1646361">int32</span><span class="op" id="1646366">(</span><span class="ident" id="1646367">fd</span><span class="op" id="1646369">)</span><span class="op" id="1646370">,</span>&nbsp;<span class="op" id="1646372">&amp;</span><span class="ident" id="1646373">ev</span><span class="op" id="1646375">)</span><br>
<span class="lineno">45</span><span class="op" id="1646377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1646380">func</span>&nbsp;<span class="ident" id="1646385">netpollclose</span><span class="op" id="1646397">(</span><span class="ident" id="1646398">fd</span>&nbsp;<span class="builtintype" id="1646401">uintptr</span><span class="op" id="1646408">)</span>&nbsp;<span class="builtintype" id="1646410">int32</span>&nbsp;<span class="op" id="1646416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646419">var</span>&nbsp;<span class="ident" id="1646423">ev</span>&nbsp;<span class="ident" id="1646426">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646438">return</span>&nbsp;<span class="op" id="1646445">-</span><span class="ident" id="1646446">epollctl</span><span class="op" id="1646454">(</span><span class="ident" id="1646455">epfd</span><span class="op" id="1646459">,</span>&nbsp;<span class="ident" id="1646461">_EPOLL_CTL_DEL</span><span class="op" id="1646475">,</span>&nbsp;<span class="builtintype" id="1646477">int32</span><span class="op" id="1646482">(</span><span class="ident" id="1646483">fd</span><span class="op" id="1646485">)</span><span class="op" id="1646486">,</span>&nbsp;<span class="op" id="1646488">&amp;</span><span class="ident" id="1646489">ev</span><span class="op" id="1646491">)</span><br>
<span class="lineno">50</span><span class="op" id="1646493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1646496">func</span>&nbsp;<span class="ident" id="1646501">netpollarm</span><span class="op" id="1646511">(</span><span class="ident" id="1646512">pd</span>&nbsp;<span class="op" id="1646515">*</span><span class="ident" id="1646516">pollDesc</span><span class="op" id="1646524">,</span>&nbsp;<span class="ident" id="1646526">mode</span>&nbsp;<span class="builtintype" id="1646531">int</span><span class="op" id="1646534">)</span>&nbsp;<span class="op" id="1646536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646539">gothrow</span><span class="op" id="1646546">(</span><span class="string" id="1646547">&#34;unused&#34;</span><span class="op" id="1646555">)</span><br>
<span class="lineno"></span><span class="op" id="1646557">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1646560">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1646599">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1646650">func</span>&nbsp;<span class="ident" id="1646655">netpoll</span><span class="op" id="1646662">(</span><span class="ident" id="1646663">block</span>&nbsp;<span class="builtintype" id="1646669">bool</span><span class="op" id="1646673">)</span>&nbsp;<span class="op" id="1646675">(</span><span class="ident" id="1646676">gp</span>&nbsp;<span class="op" id="1646679">*</span><span class="ident" id="1646680">g</span><span class="op" id="1646681">)</span>&nbsp;<span class="op" id="1646683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646686">if</span>&nbsp;<span class="ident" id="1646689">epfd</span>&nbsp;<span class="op" id="1646694">==</span>&nbsp;<span class="op" id="1646697">-</span><span class="num" id="1646698">1</span>&nbsp;<span class="op" id="1646700">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646704">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646715">waitms</span>&nbsp;<span class="op" id="1646722">:=</span>&nbsp;<span class="builtintype" id="1646725">int32</span><span class="op" id="1646730">(</span><span class="op" id="1646731">-</span><span class="num" id="1646732">1</span><span class="op" id="1646733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646736">if</span>&nbsp;<span class="op" id="1646739">!</span><span class="ident" id="1646740">block</span>&nbsp;<span class="op" id="1646746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646750">waitms</span>&nbsp;<span class="op" id="1646757">=</span>&nbsp;<span class="num" id="1646759">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646765">var</span>&nbsp;<span class="ident" id="1646769">events</span>&nbsp;<span class="op" id="1646776">[</span><span class="num" id="1646777">128</span><span class="op" id="1646780">]</span><span class="ident" id="1646781">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1646792">retry</span><span class="op" id="1646797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646800">n</span>&nbsp;<span class="op" id="1646802">:=</span>&nbsp;<span class="ident" id="1646805">epollwait</span><span class="op" id="1646814">(</span><span class="ident" id="1646815">epfd</span><span class="op" id="1646819">,</span>&nbsp;<span class="op" id="1646821">&amp;</span><span class="ident" id="1646822">events</span><span class="op" id="1646828">[</span><span class="num" id="1646829">0</span><span class="op" id="1646830">]</span><span class="op" id="1646831">,</span>&nbsp;<span class="builtintype" id="1646833">int32</span><span class="op" id="1646838">(</span><span class="builtinfunc" id="1646839">len</span><span class="op" id="1646842">(</span><span class="ident" id="1646843">events</span><span class="op" id="1646849">)</span><span class="op" id="1646850">)</span><span class="op" id="1646851">,</span>&nbsp;<span class="ident" id="1646853">waitms</span><span class="op" id="1646859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646862">if</span>&nbsp;<span class="ident" id="1646865">n</span>&nbsp;<span class="op" id="1646867">&lt;</span>&nbsp;<span class="num" id="1646869">0</span>&nbsp;<span class="op" id="1646871">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646875">if</span>&nbsp;<span class="ident" id="1646878">n</span>&nbsp;<span class="op" id="1646880">!=</span>&nbsp;<span class="op" id="1646883">-</span><span class="ident" id="1646884">_EINTR</span>&nbsp;<span class="op" id="1646891">&amp;&amp;</span>&nbsp;<span class="ident" id="1646894">n</span>&nbsp;<span class="op" id="1646896">!=</span>&nbsp;<span class="ident" id="1646899">netpolllasterr</span>&nbsp;<span class="op" id="1646914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646919">netpolllasterr</span>&nbsp;<span class="op" id="1646934">=</span>&nbsp;<span class="ident" id="1646936">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1646941">println</span><span class="op" id="1646948">(</span><span class="string" id="1646949">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1646975">,</span>&nbsp;<span class="ident" id="1646977">epfd</span><span class="op" id="1646981">,</span>&nbsp;<span class="string" id="1646983">&#34;failed&nbsp;with&#34;</span><span class="op" id="1646996">,</span>&nbsp;<span class="op" id="1646998">-</span><span class="ident" id="1646999">n</span><span class="op" id="1647000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647008">goto</span>&nbsp;<span class="ident" id="1647013">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647023">for</span>&nbsp;<span class="ident" id="1647027">i</span>&nbsp;<span class="op" id="1647029">:=</span>&nbsp;<span class="builtintype" id="1647032">int32</span><span class="op" id="1647037">(</span><span class="num" id="1647038">0</span><span class="op" id="1647039">)</span><span class="op" id="1647040">;</span>&nbsp;<span class="ident" id="1647042">i</span>&nbsp;<span class="op" id="1647044">&lt;</span>&nbsp;<span class="ident" id="1647046">n</span><span class="op" id="1647047">;</span>&nbsp;<span class="ident" id="1647049">i</span><span class="op" id="1647050">++</span>&nbsp;<span class="op" id="1647053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647057">ev</span>&nbsp;<span class="op" id="1647060">:=</span>&nbsp;<span class="op" id="1647063">&amp;</span><span class="ident" id="1647064">events</span><span class="op" id="1647070">[</span><span class="ident" id="1647071">i</span><span class="op" id="1647072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647076">if</span>&nbsp;<span class="ident" id="1647079">ev</span><span class="op" id="1647081">.</span><span class="ident" id="1647082">events</span>&nbsp;<span class="op" id="1647089">==</span>&nbsp;<span class="num" id="1647092">0</span>&nbsp;<span class="op" id="1647094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647099">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647114">var</span>&nbsp;<span class="ident" id="1647118">mode</span>&nbsp;<span class="builtintype" id="1647123">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647131">if</span>&nbsp;<span class="ident" id="1647134">ev</span><span class="op" id="1647136">.</span><span class="ident" id="1647137">events</span><span class="op" id="1647143">&amp;</span><span class="op" id="1647144">(</span><span class="ident" id="1647145">_EPOLLIN</span><span class="op" id="1647153">|</span><span class="ident" id="1647154">_EPOLLRDHUP</span><span class="op" id="1647165">|</span><span class="ident" id="1647166">_EPOLLHUP</span><span class="op" id="1647175">|</span><span class="ident" id="1647176">_EPOLLERR</span><span class="op" id="1647185">)</span>&nbsp;<span class="op" id="1647187">!=</span>&nbsp;<span class="num" id="1647190">0</span>&nbsp;<span class="op" id="1647192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647197">mode</span>&nbsp;<span class="op" id="1647202">+=</span>&nbsp;<span class="string" id="1647205">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647211">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647215">if</span>&nbsp;<span class="ident" id="1647218">ev</span><span class="op" id="1647220">.</span><span class="ident" id="1647221">events</span><span class="op" id="1647227">&amp;</span><span class="op" id="1647228">(</span><span class="ident" id="1647229">_EPOLLOUT</span><span class="op" id="1647238">|</span><span class="ident" id="1647239">_EPOLLHUP</span><span class="op" id="1647248">|</span><span class="ident" id="1647249">_EPOLLERR</span><span class="op" id="1647258">)</span>&nbsp;<span class="op" id="1647260">!=</span>&nbsp;<span class="num" id="1647263">0</span>&nbsp;<span class="op" id="1647265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647270">mode</span>&nbsp;<span class="op" id="1647275">+=</span>&nbsp;<span class="string" id="1647278">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647288">if</span>&nbsp;<span class="ident" id="1647291">mode</span>&nbsp;<span class="op" id="1647296">!=</span>&nbsp;<span class="num" id="1647299">0</span>&nbsp;<span class="op" id="1647301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647306">pd</span>&nbsp;<span class="op" id="1647309">:=</span>&nbsp;<span class="op" id="1647312">*</span><span class="op" id="1647313">(</span><span class="op" id="1647314">*</span><span class="op" id="1647315">*</span><span class="ident" id="1647316">pollDesc</span><span class="op" id="1647324">)</span><span class="op" id="1647325">(</span><span class="ident" id="1647326">unsafe</span><span class="op" id="1647332">.</span><span class="ident" id="1647333">Pointer</span><span class="op" id="1647340">(</span><span class="op" id="1647341">&amp;</span><span class="ident" id="1647342">ev</span><span class="op" id="1647344">.</span><span class="ident" id="1647345">data</span><span class="op" id="1647349">)</span><span class="op" id="1647350">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647355">netpollready</span><span class="op" id="1647367">(</span><span class="op" id="1647368">(</span><span class="op" id="1647369">*</span><span class="op" id="1647370">*</span><span class="ident" id="1647371">g</span><span class="op" id="1647372">)</span><span class="op" id="1647373">(</span><span class="ident" id="1647374">noescape</span><span class="op" id="1647382">(</span><span class="ident" id="1647383">unsafe</span><span class="op" id="1647389">.</span><span class="ident" id="1647390">Pointer</span><span class="op" id="1647397">(</span><span class="op" id="1647398">&amp;</span><span class="ident" id="1647399">gp</span><span class="op" id="1647401">)</span><span class="op" id="1647402">)</span><span class="op" id="1647403">)</span><span class="op" id="1647404">,</span>&nbsp;<span class="ident" id="1647406">pd</span><span class="op" id="1647408">,</span>&nbsp;<span class="ident" id="1647410">mode</span><span class="op" id="1647414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647424">if</span>&nbsp;<span class="ident" id="1647427">block</span>&nbsp;<span class="op" id="1647433">&amp;&amp;</span>&nbsp;<span class="ident" id="1647436">gp</span>&nbsp;<span class="op" id="1647439">==</span>&nbsp;<span class="ident" id="1647442">nil</span>&nbsp;<span class="op" id="1647446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647450">goto</span>&nbsp;<span class="ident" id="1647455">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647465">return</span>&nbsp;<span class="ident" id="1647472">gp</span><br>
<span class="lineno"></span><span class="op" id="1647475">}</span>
</div>
</body>
</html>
