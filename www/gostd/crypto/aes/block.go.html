<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3573714">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3573769">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3573823">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3573874">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3573938">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3574000">//</span><br>
<span class="lineno"></span><span class="comment" id="3574003">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3574025">//</span><br>
<span class="lineno">10</span><span class="comment" id="3574028">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3574060">//</span><br>
<span class="lineno"></span><span class="comment" id="3574063">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3574122">//</span><br>
<span class="lineno"></span><span class="comment" id="3574125">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3574188">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3574257">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3574311">//</span><br>
<span class="lineno"></span><span class="comment" id="3574314">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3574366">//</span><br>
<span class="lineno">20</span><span class="comment" id="3574369">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3574439">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3574508">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3574578">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3574647">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3574718">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3574790">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3574857">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3574930">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3575002">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3575071">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3575125">//</span><br>
<span class="lineno"></span><span class="comment" id="3575128">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3575211">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3575242">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3575309">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3575377">package</span>&nbsp;<span class="ident" id="3575385">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3575390">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3575457">func</span>&nbsp;<span class="ident" id="3575462">encryptBlockGo</span><span class="op" id="3575476">(</span><span class="ident" id="3575477">xk</span>&nbsp;<span class="op" id="3575480">[</span><span class="op" id="3575481">]</span><span class="builtintype" id="3575482">uint32</span><span class="op" id="3575488">,</span>&nbsp;<span class="ident" id="3575490">dst</span><span class="op" id="3575493">,</span>&nbsp;<span class="ident" id="3575495">src</span>&nbsp;<span class="op" id="3575499">[</span><span class="op" id="3575500">]</span><span class="builtintype" id="3575501">byte</span><span class="op" id="3575505">)</span>&nbsp;<span class="op" id="3575507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575510">var</span>&nbsp;<span class="ident" id="3575514">s0</span><span class="op" id="3575516">,</span>&nbsp;<span class="ident" id="3575518">s1</span><span class="op" id="3575520">,</span>&nbsp;<span class="ident" id="3575522">s2</span><span class="op" id="3575524">,</span>&nbsp;<span class="ident" id="3575526">s3</span><span class="op" id="3575528">,</span>&nbsp;<span class="ident" id="3575530">t0</span><span class="op" id="3575532">,</span>&nbsp;<span class="ident" id="3575534">t1</span><span class="op" id="3575536">,</span>&nbsp;<span class="ident" id="3575538">t2</span><span class="op" id="3575540">,</span>&nbsp;<span class="ident" id="3575542">t3</span>&nbsp;<span class="builtintype" id="3575545">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575554">s0</span>&nbsp;<span class="op" id="3575557">=</span>&nbsp;<span class="builtintype" id="3575559">uint32</span><span class="op" id="3575565">(</span><span class="ident" id="3575566">src</span><span class="op" id="3575569">[</span><span class="num" id="3575570">0</span><span class="op" id="3575571">]</span><span class="op" id="3575572">)</span><span class="op" id="3575573">&lt;&lt;</span><span class="num" id="3575575">24</span>&nbsp;<span class="op" id="3575578">|</span>&nbsp;<span class="builtintype" id="3575580">uint32</span><span class="op" id="3575586">(</span><span class="ident" id="3575587">src</span><span class="op" id="3575590">[</span><span class="num" id="3575591">1</span><span class="op" id="3575592">]</span><span class="op" id="3575593">)</span><span class="op" id="3575594">&lt;&lt;</span><span class="num" id="3575596">16</span>&nbsp;<span class="op" id="3575599">|</span>&nbsp;<span class="builtintype" id="3575601">uint32</span><span class="op" id="3575607">(</span><span class="ident" id="3575608">src</span><span class="op" id="3575611">[</span><span class="num" id="3575612">2</span><span class="op" id="3575613">]</span><span class="op" id="3575614">)</span><span class="op" id="3575615">&lt;&lt;</span><span class="num" id="3575617">8</span>&nbsp;<span class="op" id="3575619">|</span>&nbsp;<span class="builtintype" id="3575621">uint32</span><span class="op" id="3575627">(</span><span class="ident" id="3575628">src</span><span class="op" id="3575631">[</span><span class="num" id="3575632">3</span><span class="op" id="3575633">]</span><span class="op" id="3575634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575637">s1</span>&nbsp;<span class="op" id="3575640">=</span>&nbsp;<span class="builtintype" id="3575642">uint32</span><span class="op" id="3575648">(</span><span class="ident" id="3575649">src</span><span class="op" id="3575652">[</span><span class="num" id="3575653">4</span><span class="op" id="3575654">]</span><span class="op" id="3575655">)</span><span class="op" id="3575656">&lt;&lt;</span><span class="num" id="3575658">24</span>&nbsp;<span class="op" id="3575661">|</span>&nbsp;<span class="builtintype" id="3575663">uint32</span><span class="op" id="3575669">(</span><span class="ident" id="3575670">src</span><span class="op" id="3575673">[</span><span class="num" id="3575674">5</span><span class="op" id="3575675">]</span><span class="op" id="3575676">)</span><span class="op" id="3575677">&lt;&lt;</span><span class="num" id="3575679">16</span>&nbsp;<span class="op" id="3575682">|</span>&nbsp;<span class="builtintype" id="3575684">uint32</span><span class="op" id="3575690">(</span><span class="ident" id="3575691">src</span><span class="op" id="3575694">[</span><span class="num" id="3575695">6</span><span class="op" id="3575696">]</span><span class="op" id="3575697">)</span><span class="op" id="3575698">&lt;&lt;</span><span class="num" id="3575700">8</span>&nbsp;<span class="op" id="3575702">|</span>&nbsp;<span class="builtintype" id="3575704">uint32</span><span class="op" id="3575710">(</span><span class="ident" id="3575711">src</span><span class="op" id="3575714">[</span><span class="num" id="3575715">7</span><span class="op" id="3575716">]</span><span class="op" id="3575717">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575720">s2</span>&nbsp;<span class="op" id="3575723">=</span>&nbsp;<span class="builtintype" id="3575725">uint32</span><span class="op" id="3575731">(</span><span class="ident" id="3575732">src</span><span class="op" id="3575735">[</span><span class="num" id="3575736">8</span><span class="op" id="3575737">]</span><span class="op" id="3575738">)</span><span class="op" id="3575739">&lt;&lt;</span><span class="num" id="3575741">24</span>&nbsp;<span class="op" id="3575744">|</span>&nbsp;<span class="builtintype" id="3575746">uint32</span><span class="op" id="3575752">(</span><span class="ident" id="3575753">src</span><span class="op" id="3575756">[</span><span class="num" id="3575757">9</span><span class="op" id="3575758">]</span><span class="op" id="3575759">)</span><span class="op" id="3575760">&lt;&lt;</span><span class="num" id="3575762">16</span>&nbsp;<span class="op" id="3575765">|</span>&nbsp;<span class="builtintype" id="3575767">uint32</span><span class="op" id="3575773">(</span><span class="ident" id="3575774">src</span><span class="op" id="3575777">[</span><span class="num" id="3575778">10</span><span class="op" id="3575780">]</span><span class="op" id="3575781">)</span><span class="op" id="3575782">&lt;&lt;</span><span class="num" id="3575784">8</span>&nbsp;<span class="op" id="3575786">|</span>&nbsp;<span class="builtintype" id="3575788">uint32</span><span class="op" id="3575794">(</span><span class="ident" id="3575795">src</span><span class="op" id="3575798">[</span><span class="num" id="3575799">11</span><span class="op" id="3575801">]</span><span class="op" id="3575802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575805">s3</span>&nbsp;<span class="op" id="3575808">=</span>&nbsp;<span class="builtintype" id="3575810">uint32</span><span class="op" id="3575816">(</span><span class="ident" id="3575817">src</span><span class="op" id="3575820">[</span><span class="num" id="3575821">12</span><span class="op" id="3575823">]</span><span class="op" id="3575824">)</span><span class="op" id="3575825">&lt;&lt;</span><span class="num" id="3575827">24</span>&nbsp;<span class="op" id="3575830">|</span>&nbsp;<span class="builtintype" id="3575832">uint32</span><span class="op" id="3575838">(</span><span class="ident" id="3575839">src</span><span class="op" id="3575842">[</span><span class="num" id="3575843">13</span><span class="op" id="3575845">]</span><span class="op" id="3575846">)</span><span class="op" id="3575847">&lt;&lt;</span><span class="num" id="3575849">16</span>&nbsp;<span class="op" id="3575852">|</span>&nbsp;<span class="builtintype" id="3575854">uint32</span><span class="op" id="3575860">(</span><span class="ident" id="3575861">src</span><span class="op" id="3575864">[</span><span class="num" id="3575865">14</span><span class="op" id="3575867">]</span><span class="op" id="3575868">)</span><span class="op" id="3575869">&lt;&lt;</span><span class="num" id="3575871">8</span>&nbsp;<span class="op" id="3575873">|</span>&nbsp;<span class="builtintype" id="3575875">uint32</span><span class="op" id="3575881">(</span><span class="ident" id="3575882">src</span><span class="op" id="3575885">[</span><span class="num" id="3575886">15</span><span class="op" id="3575888">]</span><span class="op" id="3575889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575893">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575935">s0</span>&nbsp;<span class="op" id="3575938">^=</span>&nbsp;<span class="ident" id="3575941">xk</span><span class="op" id="3575943">[</span><span class="num" id="3575944">0</span><span class="op" id="3575945">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575948">s1</span>&nbsp;<span class="op" id="3575951">^=</span>&nbsp;<span class="ident" id="3575954">xk</span><span class="op" id="3575956">[</span><span class="num" id="3575957">1</span><span class="op" id="3575958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575961">s2</span>&nbsp;<span class="op" id="3575964">^=</span>&nbsp;<span class="ident" id="3575967">xk</span><span class="op" id="3575969">[</span><span class="num" id="3575970">2</span><span class="op" id="3575971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575974">s3</span>&nbsp;<span class="op" id="3575977">^=</span>&nbsp;<span class="ident" id="3575980">xk</span><span class="op" id="3575982">[</span><span class="num" id="3575983">3</span><span class="op" id="3575984">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575988">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576028">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576083">nr</span>&nbsp;<span class="op" id="3576086">:=</span>&nbsp;<span class="builtinfunc" id="3576089">len</span><span class="op" id="3576092">(</span><span class="ident" id="3576093">xk</span><span class="op" id="3576095">)</span><span class="op" id="3576096">/</span><span class="num" id="3576097">4</span>&nbsp;<span class="op" id="3576099">-</span>&nbsp;<span class="num" id="3576101">2</span>&nbsp;<span class="comment" id="3576103">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576138">k</span>&nbsp;<span class="op" id="3576140">:=</span>&nbsp;<span class="num" id="3576143">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576146">for</span>&nbsp;<span class="ident" id="3576150">r</span>&nbsp;<span class="op" id="3576152">:=</span>&nbsp;<span class="num" id="3576155">0</span><span class="op" id="3576156">;</span>&nbsp;<span class="ident" id="3576158">r</span>&nbsp;<span class="op" id="3576160">&lt;</span>&nbsp;<span class="ident" id="3576162">nr</span><span class="op" id="3576164">;</span>&nbsp;<span class="ident" id="3576166">r</span><span class="op" id="3576167">++</span>&nbsp;<span class="op" id="3576170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576174">t0</span>&nbsp;<span class="op" id="3576177">=</span>&nbsp;<span class="ident" id="3576179">xk</span><span class="op" id="3576181">[</span><span class="ident" id="3576182">k</span><span class="op" id="3576183">+</span><span class="num" id="3576184">0</span><span class="op" id="3576185">]</span>&nbsp;<span class="op" id="3576187">^</span>&nbsp;<span class="ident" id="3576189">te0</span><span class="op" id="3576192">[</span><span class="builtintype" id="3576193">uint8</span><span class="op" id="3576198">(</span><span class="ident" id="3576199">s0</span><span class="op" id="3576201">&gt;&gt;</span><span class="num" id="3576203">24</span><span class="op" id="3576205">)</span><span class="op" id="3576206">]</span>&nbsp;<span class="op" id="3576208">^</span>&nbsp;<span class="ident" id="3576210">te1</span><span class="op" id="3576213">[</span><span class="builtintype" id="3576214">uint8</span><span class="op" id="3576219">(</span><span class="ident" id="3576220">s1</span><span class="op" id="3576222">&gt;&gt;</span><span class="num" id="3576224">16</span><span class="op" id="3576226">)</span><span class="op" id="3576227">]</span>&nbsp;<span class="op" id="3576229">^</span>&nbsp;<span class="ident" id="3576231">te2</span><span class="op" id="3576234">[</span><span class="builtintype" id="3576235">uint8</span><span class="op" id="3576240">(</span><span class="ident" id="3576241">s2</span><span class="op" id="3576243">&gt;&gt;</span><span class="num" id="3576245">8</span><span class="op" id="3576246">)</span><span class="op" id="3576247">]</span>&nbsp;<span class="op" id="3576249">^</span>&nbsp;<span class="ident" id="3576251">te3</span><span class="op" id="3576254">[</span><span class="builtintype" id="3576255">uint8</span><span class="op" id="3576260">(</span><span class="ident" id="3576261">s3</span><span class="op" id="3576263">)</span><span class="op" id="3576264">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576268">t1</span>&nbsp;<span class="op" id="3576271">=</span>&nbsp;<span class="ident" id="3576273">xk</span><span class="op" id="3576275">[</span><span class="ident" id="3576276">k</span><span class="op" id="3576277">+</span><span class="num" id="3576278">1</span><span class="op" id="3576279">]</span>&nbsp;<span class="op" id="3576281">^</span>&nbsp;<span class="ident" id="3576283">te0</span><span class="op" id="3576286">[</span><span class="builtintype" id="3576287">uint8</span><span class="op" id="3576292">(</span><span class="ident" id="3576293">s1</span><span class="op" id="3576295">&gt;&gt;</span><span class="num" id="3576297">24</span><span class="op" id="3576299">)</span><span class="op" id="3576300">]</span>&nbsp;<span class="op" id="3576302">^</span>&nbsp;<span class="ident" id="3576304">te1</span><span class="op" id="3576307">[</span><span class="builtintype" id="3576308">uint8</span><span class="op" id="3576313">(</span><span class="ident" id="3576314">s2</span><span class="op" id="3576316">&gt;&gt;</span><span class="num" id="3576318">16</span><span class="op" id="3576320">)</span><span class="op" id="3576321">]</span>&nbsp;<span class="op" id="3576323">^</span>&nbsp;<span class="ident" id="3576325">te2</span><span class="op" id="3576328">[</span><span class="builtintype" id="3576329">uint8</span><span class="op" id="3576334">(</span><span class="ident" id="3576335">s3</span><span class="op" id="3576337">&gt;&gt;</span><span class="num" id="3576339">8</span><span class="op" id="3576340">)</span><span class="op" id="3576341">]</span>&nbsp;<span class="op" id="3576343">^</span>&nbsp;<span class="ident" id="3576345">te3</span><span class="op" id="3576348">[</span><span class="builtintype" id="3576349">uint8</span><span class="op" id="3576354">(</span><span class="ident" id="3576355">s0</span><span class="op" id="3576357">)</span><span class="op" id="3576358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576362">t2</span>&nbsp;<span class="op" id="3576365">=</span>&nbsp;<span class="ident" id="3576367">xk</span><span class="op" id="3576369">[</span><span class="ident" id="3576370">k</span><span class="op" id="3576371">+</span><span class="num" id="3576372">2</span><span class="op" id="3576373">]</span>&nbsp;<span class="op" id="3576375">^</span>&nbsp;<span class="ident" id="3576377">te0</span><span class="op" id="3576380">[</span><span class="builtintype" id="3576381">uint8</span><span class="op" id="3576386">(</span><span class="ident" id="3576387">s2</span><span class="op" id="3576389">&gt;&gt;</span><span class="num" id="3576391">24</span><span class="op" id="3576393">)</span><span class="op" id="3576394">]</span>&nbsp;<span class="op" id="3576396">^</span>&nbsp;<span class="ident" id="3576398">te1</span><span class="op" id="3576401">[</span><span class="builtintype" id="3576402">uint8</span><span class="op" id="3576407">(</span><span class="ident" id="3576408">s3</span><span class="op" id="3576410">&gt;&gt;</span><span class="num" id="3576412">16</span><span class="op" id="3576414">)</span><span class="op" id="3576415">]</span>&nbsp;<span class="op" id="3576417">^</span>&nbsp;<span class="ident" id="3576419">te2</span><span class="op" id="3576422">[</span><span class="builtintype" id="3576423">uint8</span><span class="op" id="3576428">(</span><span class="ident" id="3576429">s0</span><span class="op" id="3576431">&gt;&gt;</span><span class="num" id="3576433">8</span><span class="op" id="3576434">)</span><span class="op" id="3576435">]</span>&nbsp;<span class="op" id="3576437">^</span>&nbsp;<span class="ident" id="3576439">te3</span><span class="op" id="3576442">[</span><span class="builtintype" id="3576443">uint8</span><span class="op" id="3576448">(</span><span class="ident" id="3576449">s1</span><span class="op" id="3576451">)</span><span class="op" id="3576452">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576456">t3</span>&nbsp;<span class="op" id="3576459">=</span>&nbsp;<span class="ident" id="3576461">xk</span><span class="op" id="3576463">[</span><span class="ident" id="3576464">k</span><span class="op" id="3576465">+</span><span class="num" id="3576466">3</span><span class="op" id="3576467">]</span>&nbsp;<span class="op" id="3576469">^</span>&nbsp;<span class="ident" id="3576471">te0</span><span class="op" id="3576474">[</span><span class="builtintype" id="3576475">uint8</span><span class="op" id="3576480">(</span><span class="ident" id="3576481">s3</span><span class="op" id="3576483">&gt;&gt;</span><span class="num" id="3576485">24</span><span class="op" id="3576487">)</span><span class="op" id="3576488">]</span>&nbsp;<span class="op" id="3576490">^</span>&nbsp;<span class="ident" id="3576492">te1</span><span class="op" id="3576495">[</span><span class="builtintype" id="3576496">uint8</span><span class="op" id="3576501">(</span><span class="ident" id="3576502">s0</span><span class="op" id="3576504">&gt;&gt;</span><span class="num" id="3576506">16</span><span class="op" id="3576508">)</span><span class="op" id="3576509">]</span>&nbsp;<span class="op" id="3576511">^</span>&nbsp;<span class="ident" id="3576513">te2</span><span class="op" id="3576516">[</span><span class="builtintype" id="3576517">uint8</span><span class="op" id="3576522">(</span><span class="ident" id="3576523">s1</span><span class="op" id="3576525">&gt;&gt;</span><span class="num" id="3576527">8</span><span class="op" id="3576528">)</span><span class="op" id="3576529">]</span>&nbsp;<span class="op" id="3576531">^</span>&nbsp;<span class="ident" id="3576533">te3</span><span class="op" id="3576536">[</span><span class="builtintype" id="3576537">uint8</span><span class="op" id="3576542">(</span><span class="ident" id="3576543">s2</span><span class="op" id="3576545">)</span><span class="op" id="3576546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576550">k</span>&nbsp;<span class="op" id="3576552">+=</span>&nbsp;<span class="num" id="3576555">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576559">s0</span><span class="op" id="3576561">,</span>&nbsp;<span class="ident" id="3576563">s1</span><span class="op" id="3576565">,</span>&nbsp;<span class="ident" id="3576567">s2</span><span class="op" id="3576569">,</span>&nbsp;<span class="ident" id="3576571">s3</span>&nbsp;<span class="op" id="3576574">=</span>&nbsp;<span class="ident" id="3576576">t0</span><span class="op" id="3576578">,</span>&nbsp;<span class="ident" id="3576580">t1</span><span class="op" id="3576582">,</span>&nbsp;<span class="ident" id="3576584">t2</span><span class="op" id="3576586">,</span>&nbsp;<span class="ident" id="3576588">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576596">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576659">s0</span>&nbsp;<span class="op" id="3576662">=</span>&nbsp;<span class="builtintype" id="3576664">uint32</span><span class="op" id="3576670">(</span><span class="ident" id="3576671">sbox0</span><span class="op" id="3576676">[</span><span class="ident" id="3576677">t0</span><span class="op" id="3576679">&gt;&gt;</span><span class="num" id="3576681">24</span><span class="op" id="3576683">]</span><span class="op" id="3576684">)</span><span class="op" id="3576685">&lt;&lt;</span><span class="num" id="3576687">24</span>&nbsp;<span class="op" id="3576690">|</span>&nbsp;<span class="builtintype" id="3576692">uint32</span><span class="op" id="3576698">(</span><span class="ident" id="3576699">sbox0</span><span class="op" id="3576704">[</span><span class="ident" id="3576705">t1</span><span class="op" id="3576707">&gt;&gt;</span><span class="num" id="3576709">16</span><span class="op" id="3576711">&amp;</span><span class="num" id="3576712">0xff</span><span class="op" id="3576716">]</span><span class="op" id="3576717">)</span><span class="op" id="3576718">&lt;&lt;</span><span class="num" id="3576720">16</span>&nbsp;<span class="op" id="3576723">|</span>&nbsp;<span class="builtintype" id="3576725">uint32</span><span class="op" id="3576731">(</span><span class="ident" id="3576732">sbox0</span><span class="op" id="3576737">[</span><span class="ident" id="3576738">t2</span><span class="op" id="3576740">&gt;&gt;</span><span class="num" id="3576742">8</span><span class="op" id="3576743">&amp;</span><span class="num" id="3576744">0xff</span><span class="op" id="3576748">]</span><span class="op" id="3576749">)</span><span class="op" id="3576750">&lt;&lt;</span><span class="num" id="3576752">8</span>&nbsp;<span class="op" id="3576754">|</span>&nbsp;<span class="builtintype" id="3576756">uint32</span><span class="op" id="3576762">(</span><span class="ident" id="3576763">sbox0</span><span class="op" id="3576768">[</span><span class="ident" id="3576769">t3</span><span class="op" id="3576771">&amp;</span><span class="num" id="3576772">0xff</span><span class="op" id="3576776">]</span><span class="op" id="3576777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576780">s1</span>&nbsp;<span class="op" id="3576783">=</span>&nbsp;<span class="builtintype" id="3576785">uint32</span><span class="op" id="3576791">(</span><span class="ident" id="3576792">sbox0</span><span class="op" id="3576797">[</span><span class="ident" id="3576798">t1</span><span class="op" id="3576800">&gt;&gt;</span><span class="num" id="3576802">24</span><span class="op" id="3576804">]</span><span class="op" id="3576805">)</span><span class="op" id="3576806">&lt;&lt;</span><span class="num" id="3576808">24</span>&nbsp;<span class="op" id="3576811">|</span>&nbsp;<span class="builtintype" id="3576813">uint32</span><span class="op" id="3576819">(</span><span class="ident" id="3576820">sbox0</span><span class="op" id="3576825">[</span><span class="ident" id="3576826">t2</span><span class="op" id="3576828">&gt;&gt;</span><span class="num" id="3576830">16</span><span class="op" id="3576832">&amp;</span><span class="num" id="3576833">0xff</span><span class="op" id="3576837">]</span><span class="op" id="3576838">)</span><span class="op" id="3576839">&lt;&lt;</span><span class="num" id="3576841">16</span>&nbsp;<span class="op" id="3576844">|</span>&nbsp;<span class="builtintype" id="3576846">uint32</span><span class="op" id="3576852">(</span><span class="ident" id="3576853">sbox0</span><span class="op" id="3576858">[</span><span class="ident" id="3576859">t3</span><span class="op" id="3576861">&gt;&gt;</span><span class="num" id="3576863">8</span><span class="op" id="3576864">&amp;</span><span class="num" id="3576865">0xff</span><span class="op" id="3576869">]</span><span class="op" id="3576870">)</span><span class="op" id="3576871">&lt;&lt;</span><span class="num" id="3576873">8</span>&nbsp;<span class="op" id="3576875">|</span>&nbsp;<span class="builtintype" id="3576877">uint32</span><span class="op" id="3576883">(</span><span class="ident" id="3576884">sbox0</span><span class="op" id="3576889">[</span><span class="ident" id="3576890">t0</span><span class="op" id="3576892">&amp;</span><span class="num" id="3576893">0xff</span><span class="op" id="3576897">]</span><span class="op" id="3576898">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576901">s2</span>&nbsp;<span class="op" id="3576904">=</span>&nbsp;<span class="builtintype" id="3576906">uint32</span><span class="op" id="3576912">(</span><span class="ident" id="3576913">sbox0</span><span class="op" id="3576918">[</span><span class="ident" id="3576919">t2</span><span class="op" id="3576921">&gt;&gt;</span><span class="num" id="3576923">24</span><span class="op" id="3576925">]</span><span class="op" id="3576926">)</span><span class="op" id="3576927">&lt;&lt;</span><span class="num" id="3576929">24</span>&nbsp;<span class="op" id="3576932">|</span>&nbsp;<span class="builtintype" id="3576934">uint32</span><span class="op" id="3576940">(</span><span class="ident" id="3576941">sbox0</span><span class="op" id="3576946">[</span><span class="ident" id="3576947">t3</span><span class="op" id="3576949">&gt;&gt;</span><span class="num" id="3576951">16</span><span class="op" id="3576953">&amp;</span><span class="num" id="3576954">0xff</span><span class="op" id="3576958">]</span><span class="op" id="3576959">)</span><span class="op" id="3576960">&lt;&lt;</span><span class="num" id="3576962">16</span>&nbsp;<span class="op" id="3576965">|</span>&nbsp;<span class="builtintype" id="3576967">uint32</span><span class="op" id="3576973">(</span><span class="ident" id="3576974">sbox0</span><span class="op" id="3576979">[</span><span class="ident" id="3576980">t0</span><span class="op" id="3576982">&gt;&gt;</span><span class="num" id="3576984">8</span><span class="op" id="3576985">&amp;</span><span class="num" id="3576986">0xff</span><span class="op" id="3576990">]</span><span class="op" id="3576991">)</span><span class="op" id="3576992">&lt;&lt;</span><span class="num" id="3576994">8</span>&nbsp;<span class="op" id="3576996">|</span>&nbsp;<span class="builtintype" id="3576998">uint32</span><span class="op" id="3577004">(</span><span class="ident" id="3577005">sbox0</span><span class="op" id="3577010">[</span><span class="ident" id="3577011">t1</span><span class="op" id="3577013">&amp;</span><span class="num" id="3577014">0xff</span><span class="op" id="3577018">]</span><span class="op" id="3577019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577022">s3</span>&nbsp;<span class="op" id="3577025">=</span>&nbsp;<span class="builtintype" id="3577027">uint32</span><span class="op" id="3577033">(</span><span class="ident" id="3577034">sbox0</span><span class="op" id="3577039">[</span><span class="ident" id="3577040">t3</span><span class="op" id="3577042">&gt;&gt;</span><span class="num" id="3577044">24</span><span class="op" id="3577046">]</span><span class="op" id="3577047">)</span><span class="op" id="3577048">&lt;&lt;</span><span class="num" id="3577050">24</span>&nbsp;<span class="op" id="3577053">|</span>&nbsp;<span class="builtintype" id="3577055">uint32</span><span class="op" id="3577061">(</span><span class="ident" id="3577062">sbox0</span><span class="op" id="3577067">[</span><span class="ident" id="3577068">t0</span><span class="op" id="3577070">&gt;&gt;</span><span class="num" id="3577072">16</span><span class="op" id="3577074">&amp;</span><span class="num" id="3577075">0xff</span><span class="op" id="3577079">]</span><span class="op" id="3577080">)</span><span class="op" id="3577081">&lt;&lt;</span><span class="num" id="3577083">16</span>&nbsp;<span class="op" id="3577086">|</span>&nbsp;<span class="builtintype" id="3577088">uint32</span><span class="op" id="3577094">(</span><span class="ident" id="3577095">sbox0</span><span class="op" id="3577100">[</span><span class="ident" id="3577101">t1</span><span class="op" id="3577103">&gt;&gt;</span><span class="num" id="3577105">8</span><span class="op" id="3577106">&amp;</span><span class="num" id="3577107">0xff</span><span class="op" id="3577111">]</span><span class="op" id="3577112">)</span><span class="op" id="3577113">&lt;&lt;</span><span class="num" id="3577115">8</span>&nbsp;<span class="op" id="3577117">|</span>&nbsp;<span class="builtintype" id="3577119">uint32</span><span class="op" id="3577125">(</span><span class="ident" id="3577126">sbox0</span><span class="op" id="3577131">[</span><span class="ident" id="3577132">t2</span><span class="op" id="3577134">&amp;</span><span class="num" id="3577135">0xff</span><span class="op" id="3577139">]</span><span class="op" id="3577140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577144">s0</span>&nbsp;<span class="op" id="3577147">^=</span>&nbsp;<span class="ident" id="3577150">xk</span><span class="op" id="3577152">[</span><span class="ident" id="3577153">k</span><span class="op" id="3577154">+</span><span class="num" id="3577155">0</span><span class="op" id="3577156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577159">s1</span>&nbsp;<span class="op" id="3577162">^=</span>&nbsp;<span class="ident" id="3577165">xk</span><span class="op" id="3577167">[</span><span class="ident" id="3577168">k</span><span class="op" id="3577169">+</span><span class="num" id="3577170">1</span><span class="op" id="3577171">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577174">s2</span>&nbsp;<span class="op" id="3577177">^=</span>&nbsp;<span class="ident" id="3577180">xk</span><span class="op" id="3577182">[</span><span class="ident" id="3577183">k</span><span class="op" id="3577184">+</span><span class="num" id="3577185">2</span><span class="op" id="3577186">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577189">s3</span>&nbsp;<span class="op" id="3577192">^=</span>&nbsp;<span class="ident" id="3577195">xk</span><span class="op" id="3577197">[</span><span class="ident" id="3577198">k</span><span class="op" id="3577199">+</span><span class="num" id="3577200">3</span><span class="op" id="3577201">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577205">dst</span><span class="op" id="3577208">[</span><span class="num" id="3577209">0</span><span class="op" id="3577210">]</span><span class="op" id="3577211">,</span>&nbsp;<span class="ident" id="3577213">dst</span><span class="op" id="3577216">[</span><span class="num" id="3577217">1</span><span class="op" id="3577218">]</span><span class="op" id="3577219">,</span>&nbsp;<span class="ident" id="3577221">dst</span><span class="op" id="3577224">[</span><span class="num" id="3577225">2</span><span class="op" id="3577226">]</span><span class="op" id="3577227">,</span>&nbsp;<span class="ident" id="3577229">dst</span><span class="op" id="3577232">[</span><span class="num" id="3577233">3</span><span class="op" id="3577234">]</span>&nbsp;<span class="op" id="3577236">=</span>&nbsp;<span class="builtintype" id="3577238">byte</span><span class="op" id="3577242">(</span><span class="ident" id="3577243">s0</span><span class="op" id="3577245">&gt;&gt;</span><span class="num" id="3577247">24</span><span class="op" id="3577249">)</span><span class="op" id="3577250">,</span>&nbsp;<span class="builtintype" id="3577252">byte</span><span class="op" id="3577256">(</span><span class="ident" id="3577257">s0</span><span class="op" id="3577259">&gt;&gt;</span><span class="num" id="3577261">16</span><span class="op" id="3577263">)</span><span class="op" id="3577264">,</span>&nbsp;<span class="builtintype" id="3577266">byte</span><span class="op" id="3577270">(</span><span class="ident" id="3577271">s0</span><span class="op" id="3577273">&gt;&gt;</span><span class="num" id="3577275">8</span><span class="op" id="3577276">)</span><span class="op" id="3577277">,</span>&nbsp;<span class="builtintype" id="3577279">byte</span><span class="op" id="3577283">(</span><span class="ident" id="3577284">s0</span><span class="op" id="3577286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577289">dst</span><span class="op" id="3577292">[</span><span class="num" id="3577293">4</span><span class="op" id="3577294">]</span><span class="op" id="3577295">,</span>&nbsp;<span class="ident" id="3577297">dst</span><span class="op" id="3577300">[</span><span class="num" id="3577301">5</span><span class="op" id="3577302">]</span><span class="op" id="3577303">,</span>&nbsp;<span class="ident" id="3577305">dst</span><span class="op" id="3577308">[</span><span class="num" id="3577309">6</span><span class="op" id="3577310">]</span><span class="op" id="3577311">,</span>&nbsp;<span class="ident" id="3577313">dst</span><span class="op" id="3577316">[</span><span class="num" id="3577317">7</span><span class="op" id="3577318">]</span>&nbsp;<span class="op" id="3577320">=</span>&nbsp;<span class="builtintype" id="3577322">byte</span><span class="op" id="3577326">(</span><span class="ident" id="3577327">s1</span><span class="op" id="3577329">&gt;&gt;</span><span class="num" id="3577331">24</span><span class="op" id="3577333">)</span><span class="op" id="3577334">,</span>&nbsp;<span class="builtintype" id="3577336">byte</span><span class="op" id="3577340">(</span><span class="ident" id="3577341">s1</span><span class="op" id="3577343">&gt;&gt;</span><span class="num" id="3577345">16</span><span class="op" id="3577347">)</span><span class="op" id="3577348">,</span>&nbsp;<span class="builtintype" id="3577350">byte</span><span class="op" id="3577354">(</span><span class="ident" id="3577355">s1</span><span class="op" id="3577357">&gt;&gt;</span><span class="num" id="3577359">8</span><span class="op" id="3577360">)</span><span class="op" id="3577361">,</span>&nbsp;<span class="builtintype" id="3577363">byte</span><span class="op" id="3577367">(</span><span class="ident" id="3577368">s1</span><span class="op" id="3577370">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577373">dst</span><span class="op" id="3577376">[</span><span class="num" id="3577377">8</span><span class="op" id="3577378">]</span><span class="op" id="3577379">,</span>&nbsp;<span class="ident" id="3577381">dst</span><span class="op" id="3577384">[</span><span class="num" id="3577385">9</span><span class="op" id="3577386">]</span><span class="op" id="3577387">,</span>&nbsp;<span class="ident" id="3577389">dst</span><span class="op" id="3577392">[</span><span class="num" id="3577393">10</span><span class="op" id="3577395">]</span><span class="op" id="3577396">,</span>&nbsp;<span class="ident" id="3577398">dst</span><span class="op" id="3577401">[</span><span class="num" id="3577402">11</span><span class="op" id="3577404">]</span>&nbsp;<span class="op" id="3577406">=</span>&nbsp;<span class="builtintype" id="3577408">byte</span><span class="op" id="3577412">(</span><span class="ident" id="3577413">s2</span><span class="op" id="3577415">&gt;&gt;</span><span class="num" id="3577417">24</span><span class="op" id="3577419">)</span><span class="op" id="3577420">,</span>&nbsp;<span class="builtintype" id="3577422">byte</span><span class="op" id="3577426">(</span><span class="ident" id="3577427">s2</span><span class="op" id="3577429">&gt;&gt;</span><span class="num" id="3577431">16</span><span class="op" id="3577433">)</span><span class="op" id="3577434">,</span>&nbsp;<span class="builtintype" id="3577436">byte</span><span class="op" id="3577440">(</span><span class="ident" id="3577441">s2</span><span class="op" id="3577443">&gt;&gt;</span><span class="num" id="3577445">8</span><span class="op" id="3577446">)</span><span class="op" id="3577447">,</span>&nbsp;<span class="builtintype" id="3577449">byte</span><span class="op" id="3577453">(</span><span class="ident" id="3577454">s2</span><span class="op" id="3577456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577459">dst</span><span class="op" id="3577462">[</span><span class="num" id="3577463">12</span><span class="op" id="3577465">]</span><span class="op" id="3577466">,</span>&nbsp;<span class="ident" id="3577468">dst</span><span class="op" id="3577471">[</span><span class="num" id="3577472">13</span><span class="op" id="3577474">]</span><span class="op" id="3577475">,</span>&nbsp;<span class="ident" id="3577477">dst</span><span class="op" id="3577480">[</span><span class="num" id="3577481">14</span><span class="op" id="3577483">]</span><span class="op" id="3577484">,</span>&nbsp;<span class="ident" id="3577486">dst</span><span class="op" id="3577489">[</span><span class="num" id="3577490">15</span><span class="op" id="3577492">]</span>&nbsp;<span class="op" id="3577494">=</span>&nbsp;<span class="builtintype" id="3577496">byte</span><span class="op" id="3577500">(</span><span class="ident" id="3577501">s3</span><span class="op" id="3577503">&gt;&gt;</span><span class="num" id="3577505">24</span><span class="op" id="3577507">)</span><span class="op" id="3577508">,</span>&nbsp;<span class="builtintype" id="3577510">byte</span><span class="op" id="3577514">(</span><span class="ident" id="3577515">s3</span><span class="op" id="3577517">&gt;&gt;</span><span class="num" id="3577519">16</span><span class="op" id="3577521">)</span><span class="op" id="3577522">,</span>&nbsp;<span class="builtintype" id="3577524">byte</span><span class="op" id="3577528">(</span><span class="ident" id="3577529">s3</span><span class="op" id="3577531">&gt;&gt;</span><span class="num" id="3577533">8</span><span class="op" id="3577534">)</span><span class="op" id="3577535">,</span>&nbsp;<span class="builtintype" id="3577537">byte</span><span class="op" id="3577541">(</span><span class="ident" id="3577542">s3</span><span class="op" id="3577544">)</span><br>
<span class="lineno"></span><span class="op" id="3577546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3577549">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3577616">func</span>&nbsp;<span class="ident" id="3577621">decryptBlockGo</span><span class="op" id="3577635">(</span><span class="ident" id="3577636">xk</span>&nbsp;<span class="op" id="3577639">[</span><span class="op" id="3577640">]</span><span class="builtintype" id="3577641">uint32</span><span class="op" id="3577647">,</span>&nbsp;<span class="ident" id="3577649">dst</span><span class="op" id="3577652">,</span>&nbsp;<span class="ident" id="3577654">src</span>&nbsp;<span class="op" id="3577658">[</span><span class="op" id="3577659">]</span><span class="builtintype" id="3577660">byte</span><span class="op" id="3577664">)</span>&nbsp;<span class="op" id="3577666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577669">var</span>&nbsp;<span class="ident" id="3577673">s0</span><span class="op" id="3577675">,</span>&nbsp;<span class="ident" id="3577677">s1</span><span class="op" id="3577679">,</span>&nbsp;<span class="ident" id="3577681">s2</span><span class="op" id="3577683">,</span>&nbsp;<span class="ident" id="3577685">s3</span><span class="op" id="3577687">,</span>&nbsp;<span class="ident" id="3577689">t0</span><span class="op" id="3577691">,</span>&nbsp;<span class="ident" id="3577693">t1</span><span class="op" id="3577695">,</span>&nbsp;<span class="ident" id="3577697">t2</span><span class="op" id="3577699">,</span>&nbsp;<span class="ident" id="3577701">t3</span>&nbsp;<span class="builtintype" id="3577704">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577713">s0</span>&nbsp;<span class="op" id="3577716">=</span>&nbsp;<span class="builtintype" id="3577718">uint32</span><span class="op" id="3577724">(</span><span class="ident" id="3577725">src</span><span class="op" id="3577728">[</span><span class="num" id="3577729">0</span><span class="op" id="3577730">]</span><span class="op" id="3577731">)</span><span class="op" id="3577732">&lt;&lt;</span><span class="num" id="3577734">24</span>&nbsp;<span class="op" id="3577737">|</span>&nbsp;<span class="builtintype" id="3577739">uint32</span><span class="op" id="3577745">(</span><span class="ident" id="3577746">src</span><span class="op" id="3577749">[</span><span class="num" id="3577750">1</span><span class="op" id="3577751">]</span><span class="op" id="3577752">)</span><span class="op" id="3577753">&lt;&lt;</span><span class="num" id="3577755">16</span>&nbsp;<span class="op" id="3577758">|</span>&nbsp;<span class="builtintype" id="3577760">uint32</span><span class="op" id="3577766">(</span><span class="ident" id="3577767">src</span><span class="op" id="3577770">[</span><span class="num" id="3577771">2</span><span class="op" id="3577772">]</span><span class="op" id="3577773">)</span><span class="op" id="3577774">&lt;&lt;</span><span class="num" id="3577776">8</span>&nbsp;<span class="op" id="3577778">|</span>&nbsp;<span class="builtintype" id="3577780">uint32</span><span class="op" id="3577786">(</span><span class="ident" id="3577787">src</span><span class="op" id="3577790">[</span><span class="num" id="3577791">3</span><span class="op" id="3577792">]</span><span class="op" id="3577793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577796">s1</span>&nbsp;<span class="op" id="3577799">=</span>&nbsp;<span class="builtintype" id="3577801">uint32</span><span class="op" id="3577807">(</span><span class="ident" id="3577808">src</span><span class="op" id="3577811">[</span><span class="num" id="3577812">4</span><span class="op" id="3577813">]</span><span class="op" id="3577814">)</span><span class="op" id="3577815">&lt;&lt;</span><span class="num" id="3577817">24</span>&nbsp;<span class="op" id="3577820">|</span>&nbsp;<span class="builtintype" id="3577822">uint32</span><span class="op" id="3577828">(</span><span class="ident" id="3577829">src</span><span class="op" id="3577832">[</span><span class="num" id="3577833">5</span><span class="op" id="3577834">]</span><span class="op" id="3577835">)</span><span class="op" id="3577836">&lt;&lt;</span><span class="num" id="3577838">16</span>&nbsp;<span class="op" id="3577841">|</span>&nbsp;<span class="builtintype" id="3577843">uint32</span><span class="op" id="3577849">(</span><span class="ident" id="3577850">src</span><span class="op" id="3577853">[</span><span class="num" id="3577854">6</span><span class="op" id="3577855">]</span><span class="op" id="3577856">)</span><span class="op" id="3577857">&lt;&lt;</span><span class="num" id="3577859">8</span>&nbsp;<span class="op" id="3577861">|</span>&nbsp;<span class="builtintype" id="3577863">uint32</span><span class="op" id="3577869">(</span><span class="ident" id="3577870">src</span><span class="op" id="3577873">[</span><span class="num" id="3577874">7</span><span class="op" id="3577875">]</span><span class="op" id="3577876">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577879">s2</span>&nbsp;<span class="op" id="3577882">=</span>&nbsp;<span class="builtintype" id="3577884">uint32</span><span class="op" id="3577890">(</span><span class="ident" id="3577891">src</span><span class="op" id="3577894">[</span><span class="num" id="3577895">8</span><span class="op" id="3577896">]</span><span class="op" id="3577897">)</span><span class="op" id="3577898">&lt;&lt;</span><span class="num" id="3577900">24</span>&nbsp;<span class="op" id="3577903">|</span>&nbsp;<span class="builtintype" id="3577905">uint32</span><span class="op" id="3577911">(</span><span class="ident" id="3577912">src</span><span class="op" id="3577915">[</span><span class="num" id="3577916">9</span><span class="op" id="3577917">]</span><span class="op" id="3577918">)</span><span class="op" id="3577919">&lt;&lt;</span><span class="num" id="3577921">16</span>&nbsp;<span class="op" id="3577924">|</span>&nbsp;<span class="builtintype" id="3577926">uint32</span><span class="op" id="3577932">(</span><span class="ident" id="3577933">src</span><span class="op" id="3577936">[</span><span class="num" id="3577937">10</span><span class="op" id="3577939">]</span><span class="op" id="3577940">)</span><span class="op" id="3577941">&lt;&lt;</span><span class="num" id="3577943">8</span>&nbsp;<span class="op" id="3577945">|</span>&nbsp;<span class="builtintype" id="3577947">uint32</span><span class="op" id="3577953">(</span><span class="ident" id="3577954">src</span><span class="op" id="3577957">[</span><span class="num" id="3577958">11</span><span class="op" id="3577960">]</span><span class="op" id="3577961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577964">s3</span>&nbsp;<span class="op" id="3577967">=</span>&nbsp;<span class="builtintype" id="3577969">uint32</span><span class="op" id="3577975">(</span><span class="ident" id="3577976">src</span><span class="op" id="3577979">[</span><span class="num" id="3577980">12</span><span class="op" id="3577982">]</span><span class="op" id="3577983">)</span><span class="op" id="3577984">&lt;&lt;</span><span class="num" id="3577986">24</span>&nbsp;<span class="op" id="3577989">|</span>&nbsp;<span class="builtintype" id="3577991">uint32</span><span class="op" id="3577997">(</span><span class="ident" id="3577998">src</span><span class="op" id="3578001">[</span><span class="num" id="3578002">13</span><span class="op" id="3578004">]</span><span class="op" id="3578005">)</span><span class="op" id="3578006">&lt;&lt;</span><span class="num" id="3578008">16</span>&nbsp;<span class="op" id="3578011">|</span>&nbsp;<span class="builtintype" id="3578013">uint32</span><span class="op" id="3578019">(</span><span class="ident" id="3578020">src</span><span class="op" id="3578023">[</span><span class="num" id="3578024">14</span><span class="op" id="3578026">]</span><span class="op" id="3578027">)</span><span class="op" id="3578028">&lt;&lt;</span><span class="num" id="3578030">8</span>&nbsp;<span class="op" id="3578032">|</span>&nbsp;<span class="builtintype" id="3578034">uint32</span><span class="op" id="3578040">(</span><span class="ident" id="3578041">src</span><span class="op" id="3578044">[</span><span class="num" id="3578045">15</span><span class="op" id="3578047">]</span><span class="op" id="3578048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578052">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578094">s0</span>&nbsp;<span class="op" id="3578097">^=</span>&nbsp;<span class="ident" id="3578100">xk</span><span class="op" id="3578102">[</span><span class="num" id="3578103">0</span><span class="op" id="3578104">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578107">s1</span>&nbsp;<span class="op" id="3578110">^=</span>&nbsp;<span class="ident" id="3578113">xk</span><span class="op" id="3578115">[</span><span class="num" id="3578116">1</span><span class="op" id="3578117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578120">s2</span>&nbsp;<span class="op" id="3578123">^=</span>&nbsp;<span class="ident" id="3578126">xk</span><span class="op" id="3578128">[</span><span class="num" id="3578129">2</span><span class="op" id="3578130">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578133">s3</span>&nbsp;<span class="op" id="3578136">^=</span>&nbsp;<span class="ident" id="3578139">xk</span><span class="op" id="3578141">[</span><span class="num" id="3578142">3</span><span class="op" id="3578143">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578147">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578187">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578242">nr</span>&nbsp;<span class="op" id="3578245">:=</span>&nbsp;<span class="builtinfunc" id="3578248">len</span><span class="op" id="3578251">(</span><span class="ident" id="3578252">xk</span><span class="op" id="3578254">)</span><span class="op" id="3578255">/</span><span class="num" id="3578256">4</span>&nbsp;<span class="op" id="3578258">-</span>&nbsp;<span class="num" id="3578260">2</span>&nbsp;<span class="comment" id="3578262">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578297">k</span>&nbsp;<span class="op" id="3578299">:=</span>&nbsp;<span class="num" id="3578302">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578305">for</span>&nbsp;<span class="ident" id="3578309">r</span>&nbsp;<span class="op" id="3578311">:=</span>&nbsp;<span class="num" id="3578314">0</span><span class="op" id="3578315">;</span>&nbsp;<span class="ident" id="3578317">r</span>&nbsp;<span class="op" id="3578319">&lt;</span>&nbsp;<span class="ident" id="3578321">nr</span><span class="op" id="3578323">;</span>&nbsp;<span class="ident" id="3578325">r</span><span class="op" id="3578326">++</span>&nbsp;<span class="op" id="3578329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578333">t0</span>&nbsp;<span class="op" id="3578336">=</span>&nbsp;<span class="ident" id="3578338">xk</span><span class="op" id="3578340">[</span><span class="ident" id="3578341">k</span><span class="op" id="3578342">+</span><span class="num" id="3578343">0</span><span class="op" id="3578344">]</span>&nbsp;<span class="op" id="3578346">^</span>&nbsp;<span class="ident" id="3578348">td0</span><span class="op" id="3578351">[</span><span class="builtintype" id="3578352">uint8</span><span class="op" id="3578357">(</span><span class="ident" id="3578358">s0</span><span class="op" id="3578360">&gt;&gt;</span><span class="num" id="3578362">24</span><span class="op" id="3578364">)</span><span class="op" id="3578365">]</span>&nbsp;<span class="op" id="3578367">^</span>&nbsp;<span class="ident" id="3578369">td1</span><span class="op" id="3578372">[</span><span class="builtintype" id="3578373">uint8</span><span class="op" id="3578378">(</span><span class="ident" id="3578379">s3</span><span class="op" id="3578381">&gt;&gt;</span><span class="num" id="3578383">16</span><span class="op" id="3578385">)</span><span class="op" id="3578386">]</span>&nbsp;<span class="op" id="3578388">^</span>&nbsp;<span class="ident" id="3578390">td2</span><span class="op" id="3578393">[</span><span class="builtintype" id="3578394">uint8</span><span class="op" id="3578399">(</span><span class="ident" id="3578400">s2</span><span class="op" id="3578402">&gt;&gt;</span><span class="num" id="3578404">8</span><span class="op" id="3578405">)</span><span class="op" id="3578406">]</span>&nbsp;<span class="op" id="3578408">^</span>&nbsp;<span class="ident" id="3578410">td3</span><span class="op" id="3578413">[</span><span class="builtintype" id="3578414">uint8</span><span class="op" id="3578419">(</span><span class="ident" id="3578420">s1</span><span class="op" id="3578422">)</span><span class="op" id="3578423">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578427">t1</span>&nbsp;<span class="op" id="3578430">=</span>&nbsp;<span class="ident" id="3578432">xk</span><span class="op" id="3578434">[</span><span class="ident" id="3578435">k</span><span class="op" id="3578436">+</span><span class="num" id="3578437">1</span><span class="op" id="3578438">]</span>&nbsp;<span class="op" id="3578440">^</span>&nbsp;<span class="ident" id="3578442">td0</span><span class="op" id="3578445">[</span><span class="builtintype" id="3578446">uint8</span><span class="op" id="3578451">(</span><span class="ident" id="3578452">s1</span><span class="op" id="3578454">&gt;&gt;</span><span class="num" id="3578456">24</span><span class="op" id="3578458">)</span><span class="op" id="3578459">]</span>&nbsp;<span class="op" id="3578461">^</span>&nbsp;<span class="ident" id="3578463">td1</span><span class="op" id="3578466">[</span><span class="builtintype" id="3578467">uint8</span><span class="op" id="3578472">(</span><span class="ident" id="3578473">s0</span><span class="op" id="3578475">&gt;&gt;</span><span class="num" id="3578477">16</span><span class="op" id="3578479">)</span><span class="op" id="3578480">]</span>&nbsp;<span class="op" id="3578482">^</span>&nbsp;<span class="ident" id="3578484">td2</span><span class="op" id="3578487">[</span><span class="builtintype" id="3578488">uint8</span><span class="op" id="3578493">(</span><span class="ident" id="3578494">s3</span><span class="op" id="3578496">&gt;&gt;</span><span class="num" id="3578498">8</span><span class="op" id="3578499">)</span><span class="op" id="3578500">]</span>&nbsp;<span class="op" id="3578502">^</span>&nbsp;<span class="ident" id="3578504">td3</span><span class="op" id="3578507">[</span><span class="builtintype" id="3578508">uint8</span><span class="op" id="3578513">(</span><span class="ident" id="3578514">s2</span><span class="op" id="3578516">)</span><span class="op" id="3578517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578521">t2</span>&nbsp;<span class="op" id="3578524">=</span>&nbsp;<span class="ident" id="3578526">xk</span><span class="op" id="3578528">[</span><span class="ident" id="3578529">k</span><span class="op" id="3578530">+</span><span class="num" id="3578531">2</span><span class="op" id="3578532">]</span>&nbsp;<span class="op" id="3578534">^</span>&nbsp;<span class="ident" id="3578536">td0</span><span class="op" id="3578539">[</span><span class="builtintype" id="3578540">uint8</span><span class="op" id="3578545">(</span><span class="ident" id="3578546">s2</span><span class="op" id="3578548">&gt;&gt;</span><span class="num" id="3578550">24</span><span class="op" id="3578552">)</span><span class="op" id="3578553">]</span>&nbsp;<span class="op" id="3578555">^</span>&nbsp;<span class="ident" id="3578557">td1</span><span class="op" id="3578560">[</span><span class="builtintype" id="3578561">uint8</span><span class="op" id="3578566">(</span><span class="ident" id="3578567">s1</span><span class="op" id="3578569">&gt;&gt;</span><span class="num" id="3578571">16</span><span class="op" id="3578573">)</span><span class="op" id="3578574">]</span>&nbsp;<span class="op" id="3578576">^</span>&nbsp;<span class="ident" id="3578578">td2</span><span class="op" id="3578581">[</span><span class="builtintype" id="3578582">uint8</span><span class="op" id="3578587">(</span><span class="ident" id="3578588">s0</span><span class="op" id="3578590">&gt;&gt;</span><span class="num" id="3578592">8</span><span class="op" id="3578593">)</span><span class="op" id="3578594">]</span>&nbsp;<span class="op" id="3578596">^</span>&nbsp;<span class="ident" id="3578598">td3</span><span class="op" id="3578601">[</span><span class="builtintype" id="3578602">uint8</span><span class="op" id="3578607">(</span><span class="ident" id="3578608">s3</span><span class="op" id="3578610">)</span><span class="op" id="3578611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578615">t3</span>&nbsp;<span class="op" id="3578618">=</span>&nbsp;<span class="ident" id="3578620">xk</span><span class="op" id="3578622">[</span><span class="ident" id="3578623">k</span><span class="op" id="3578624">+</span><span class="num" id="3578625">3</span><span class="op" id="3578626">]</span>&nbsp;<span class="op" id="3578628">^</span>&nbsp;<span class="ident" id="3578630">td0</span><span class="op" id="3578633">[</span><span class="builtintype" id="3578634">uint8</span><span class="op" id="3578639">(</span><span class="ident" id="3578640">s3</span><span class="op" id="3578642">&gt;&gt;</span><span class="num" id="3578644">24</span><span class="op" id="3578646">)</span><span class="op" id="3578647">]</span>&nbsp;<span class="op" id="3578649">^</span>&nbsp;<span class="ident" id="3578651">td1</span><span class="op" id="3578654">[</span><span class="builtintype" id="3578655">uint8</span><span class="op" id="3578660">(</span><span class="ident" id="3578661">s2</span><span class="op" id="3578663">&gt;&gt;</span><span class="num" id="3578665">16</span><span class="op" id="3578667">)</span><span class="op" id="3578668">]</span>&nbsp;<span class="op" id="3578670">^</span>&nbsp;<span class="ident" id="3578672">td2</span><span class="op" id="3578675">[</span><span class="builtintype" id="3578676">uint8</span><span class="op" id="3578681">(</span><span class="ident" id="3578682">s1</span><span class="op" id="3578684">&gt;&gt;</span><span class="num" id="3578686">8</span><span class="op" id="3578687">)</span><span class="op" id="3578688">]</span>&nbsp;<span class="op" id="3578690">^</span>&nbsp;<span class="ident" id="3578692">td3</span><span class="op" id="3578695">[</span><span class="builtintype" id="3578696">uint8</span><span class="op" id="3578701">(</span><span class="ident" id="3578702">s0</span><span class="op" id="3578704">)</span><span class="op" id="3578705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578709">k</span>&nbsp;<span class="op" id="3578711">+=</span>&nbsp;<span class="num" id="3578714">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578718">s0</span><span class="op" id="3578720">,</span>&nbsp;<span class="ident" id="3578722">s1</span><span class="op" id="3578724">,</span>&nbsp;<span class="ident" id="3578726">s2</span><span class="op" id="3578728">,</span>&nbsp;<span class="ident" id="3578730">s3</span>&nbsp;<span class="op" id="3578733">=</span>&nbsp;<span class="ident" id="3578735">t0</span><span class="op" id="3578737">,</span>&nbsp;<span class="ident" id="3578739">t1</span><span class="op" id="3578741">,</span>&nbsp;<span class="ident" id="3578743">t2</span><span class="op" id="3578745">,</span>&nbsp;<span class="ident" id="3578747">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578755">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578818">s0</span>&nbsp;<span class="op" id="3578821">=</span>&nbsp;<span class="builtintype" id="3578823">uint32</span><span class="op" id="3578829">(</span><span class="ident" id="3578830">sbox1</span><span class="op" id="3578835">[</span><span class="ident" id="3578836">t0</span><span class="op" id="3578838">&gt;&gt;</span><span class="num" id="3578840">24</span><span class="op" id="3578842">]</span><span class="op" id="3578843">)</span><span class="op" id="3578844">&lt;&lt;</span><span class="num" id="3578846">24</span>&nbsp;<span class="op" id="3578849">|</span>&nbsp;<span class="builtintype" id="3578851">uint32</span><span class="op" id="3578857">(</span><span class="ident" id="3578858">sbox1</span><span class="op" id="3578863">[</span><span class="ident" id="3578864">t3</span><span class="op" id="3578866">&gt;&gt;</span><span class="num" id="3578868">16</span><span class="op" id="3578870">&amp;</span><span class="num" id="3578871">0xff</span><span class="op" id="3578875">]</span><span class="op" id="3578876">)</span><span class="op" id="3578877">&lt;&lt;</span><span class="num" id="3578879">16</span>&nbsp;<span class="op" id="3578882">|</span>&nbsp;<span class="builtintype" id="3578884">uint32</span><span class="op" id="3578890">(</span><span class="ident" id="3578891">sbox1</span><span class="op" id="3578896">[</span><span class="ident" id="3578897">t2</span><span class="op" id="3578899">&gt;&gt;</span><span class="num" id="3578901">8</span><span class="op" id="3578902">&amp;</span><span class="num" id="3578903">0xff</span><span class="op" id="3578907">]</span><span class="op" id="3578908">)</span><span class="op" id="3578909">&lt;&lt;</span><span class="num" id="3578911">8</span>&nbsp;<span class="op" id="3578913">|</span>&nbsp;<span class="builtintype" id="3578915">uint32</span><span class="op" id="3578921">(</span><span class="ident" id="3578922">sbox1</span><span class="op" id="3578927">[</span><span class="ident" id="3578928">t1</span><span class="op" id="3578930">&amp;</span><span class="num" id="3578931">0xff</span><span class="op" id="3578935">]</span><span class="op" id="3578936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3578939">s1</span>&nbsp;<span class="op" id="3578942">=</span>&nbsp;<span class="builtintype" id="3578944">uint32</span><span class="op" id="3578950">(</span><span class="ident" id="3578951">sbox1</span><span class="op" id="3578956">[</span><span class="ident" id="3578957">t1</span><span class="op" id="3578959">&gt;&gt;</span><span class="num" id="3578961">24</span><span class="op" id="3578963">]</span><span class="op" id="3578964">)</span><span class="op" id="3578965">&lt;&lt;</span><span class="num" id="3578967">24</span>&nbsp;<span class="op" id="3578970">|</span>&nbsp;<span class="builtintype" id="3578972">uint32</span><span class="op" id="3578978">(</span><span class="ident" id="3578979">sbox1</span><span class="op" id="3578984">[</span><span class="ident" id="3578985">t0</span><span class="op" id="3578987">&gt;&gt;</span><span class="num" id="3578989">16</span><span class="op" id="3578991">&amp;</span><span class="num" id="3578992">0xff</span><span class="op" id="3578996">]</span><span class="op" id="3578997">)</span><span class="op" id="3578998">&lt;&lt;</span><span class="num" id="3579000">16</span>&nbsp;<span class="op" id="3579003">|</span>&nbsp;<span class="builtintype" id="3579005">uint32</span><span class="op" id="3579011">(</span><span class="ident" id="3579012">sbox1</span><span class="op" id="3579017">[</span><span class="ident" id="3579018">t3</span><span class="op" id="3579020">&gt;&gt;</span><span class="num" id="3579022">8</span><span class="op" id="3579023">&amp;</span><span class="num" id="3579024">0xff</span><span class="op" id="3579028">]</span><span class="op" id="3579029">)</span><span class="op" id="3579030">&lt;&lt;</span><span class="num" id="3579032">8</span>&nbsp;<span class="op" id="3579034">|</span>&nbsp;<span class="builtintype" id="3579036">uint32</span><span class="op" id="3579042">(</span><span class="ident" id="3579043">sbox1</span><span class="op" id="3579048">[</span><span class="ident" id="3579049">t2</span><span class="op" id="3579051">&amp;</span><span class="num" id="3579052">0xff</span><span class="op" id="3579056">]</span><span class="op" id="3579057">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579060">s2</span>&nbsp;<span class="op" id="3579063">=</span>&nbsp;<span class="builtintype" id="3579065">uint32</span><span class="op" id="3579071">(</span><span class="ident" id="3579072">sbox1</span><span class="op" id="3579077">[</span><span class="ident" id="3579078">t2</span><span class="op" id="3579080">&gt;&gt;</span><span class="num" id="3579082">24</span><span class="op" id="3579084">]</span><span class="op" id="3579085">)</span><span class="op" id="3579086">&lt;&lt;</span><span class="num" id="3579088">24</span>&nbsp;<span class="op" id="3579091">|</span>&nbsp;<span class="builtintype" id="3579093">uint32</span><span class="op" id="3579099">(</span><span class="ident" id="3579100">sbox1</span><span class="op" id="3579105">[</span><span class="ident" id="3579106">t1</span><span class="op" id="3579108">&gt;&gt;</span><span class="num" id="3579110">16</span><span class="op" id="3579112">&amp;</span><span class="num" id="3579113">0xff</span><span class="op" id="3579117">]</span><span class="op" id="3579118">)</span><span class="op" id="3579119">&lt;&lt;</span><span class="num" id="3579121">16</span>&nbsp;<span class="op" id="3579124">|</span>&nbsp;<span class="builtintype" id="3579126">uint32</span><span class="op" id="3579132">(</span><span class="ident" id="3579133">sbox1</span><span class="op" id="3579138">[</span><span class="ident" id="3579139">t0</span><span class="op" id="3579141">&gt;&gt;</span><span class="num" id="3579143">8</span><span class="op" id="3579144">&amp;</span><span class="num" id="3579145">0xff</span><span class="op" id="3579149">]</span><span class="op" id="3579150">)</span><span class="op" id="3579151">&lt;&lt;</span><span class="num" id="3579153">8</span>&nbsp;<span class="op" id="3579155">|</span>&nbsp;<span class="builtintype" id="3579157">uint32</span><span class="op" id="3579163">(</span><span class="ident" id="3579164">sbox1</span><span class="op" id="3579169">[</span><span class="ident" id="3579170">t3</span><span class="op" id="3579172">&amp;</span><span class="num" id="3579173">0xff</span><span class="op" id="3579177">]</span><span class="op" id="3579178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579181">s3</span>&nbsp;<span class="op" id="3579184">=</span>&nbsp;<span class="builtintype" id="3579186">uint32</span><span class="op" id="3579192">(</span><span class="ident" id="3579193">sbox1</span><span class="op" id="3579198">[</span><span class="ident" id="3579199">t3</span><span class="op" id="3579201">&gt;&gt;</span><span class="num" id="3579203">24</span><span class="op" id="3579205">]</span><span class="op" id="3579206">)</span><span class="op" id="3579207">&lt;&lt;</span><span class="num" id="3579209">24</span>&nbsp;<span class="op" id="3579212">|</span>&nbsp;<span class="builtintype" id="3579214">uint32</span><span class="op" id="3579220">(</span><span class="ident" id="3579221">sbox1</span><span class="op" id="3579226">[</span><span class="ident" id="3579227">t2</span><span class="op" id="3579229">&gt;&gt;</span><span class="num" id="3579231">16</span><span class="op" id="3579233">&amp;</span><span class="num" id="3579234">0xff</span><span class="op" id="3579238">]</span><span class="op" id="3579239">)</span><span class="op" id="3579240">&lt;&lt;</span><span class="num" id="3579242">16</span>&nbsp;<span class="op" id="3579245">|</span>&nbsp;<span class="builtintype" id="3579247">uint32</span><span class="op" id="3579253">(</span><span class="ident" id="3579254">sbox1</span><span class="op" id="3579259">[</span><span class="ident" id="3579260">t1</span><span class="op" id="3579262">&gt;&gt;</span><span class="num" id="3579264">8</span><span class="op" id="3579265">&amp;</span><span class="num" id="3579266">0xff</span><span class="op" id="3579270">]</span><span class="op" id="3579271">)</span><span class="op" id="3579272">&lt;&lt;</span><span class="num" id="3579274">8</span>&nbsp;<span class="op" id="3579276">|</span>&nbsp;<span class="builtintype" id="3579278">uint32</span><span class="op" id="3579284">(</span><span class="ident" id="3579285">sbox1</span><span class="op" id="3579290">[</span><span class="ident" id="3579291">t0</span><span class="op" id="3579293">&amp;</span><span class="num" id="3579294">0xff</span><span class="op" id="3579298">]</span><span class="op" id="3579299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579303">s0</span>&nbsp;<span class="op" id="3579306">^=</span>&nbsp;<span class="ident" id="3579309">xk</span><span class="op" id="3579311">[</span><span class="ident" id="3579312">k</span><span class="op" id="3579313">+</span><span class="num" id="3579314">0</span><span class="op" id="3579315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579318">s1</span>&nbsp;<span class="op" id="3579321">^=</span>&nbsp;<span class="ident" id="3579324">xk</span><span class="op" id="3579326">[</span><span class="ident" id="3579327">k</span><span class="op" id="3579328">+</span><span class="num" id="3579329">1</span><span class="op" id="3579330">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579333">s2</span>&nbsp;<span class="op" id="3579336">^=</span>&nbsp;<span class="ident" id="3579339">xk</span><span class="op" id="3579341">[</span><span class="ident" id="3579342">k</span><span class="op" id="3579343">+</span><span class="num" id="3579344">2</span><span class="op" id="3579345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579348">s3</span>&nbsp;<span class="op" id="3579351">^=</span>&nbsp;<span class="ident" id="3579354">xk</span><span class="op" id="3579356">[</span><span class="ident" id="3579357">k</span><span class="op" id="3579358">+</span><span class="num" id="3579359">3</span><span class="op" id="3579360">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579364">dst</span><span class="op" id="3579367">[</span><span class="num" id="3579368">0</span><span class="op" id="3579369">]</span><span class="op" id="3579370">,</span>&nbsp;<span class="ident" id="3579372">dst</span><span class="op" id="3579375">[</span><span class="num" id="3579376">1</span><span class="op" id="3579377">]</span><span class="op" id="3579378">,</span>&nbsp;<span class="ident" id="3579380">dst</span><span class="op" id="3579383">[</span><span class="num" id="3579384">2</span><span class="op" id="3579385">]</span><span class="op" id="3579386">,</span>&nbsp;<span class="ident" id="3579388">dst</span><span class="op" id="3579391">[</span><span class="num" id="3579392">3</span><span class="op" id="3579393">]</span>&nbsp;<span class="op" id="3579395">=</span>&nbsp;<span class="builtintype" id="3579397">byte</span><span class="op" id="3579401">(</span><span class="ident" id="3579402">s0</span><span class="op" id="3579404">&gt;&gt;</span><span class="num" id="3579406">24</span><span class="op" id="3579408">)</span><span class="op" id="3579409">,</span>&nbsp;<span class="builtintype" id="3579411">byte</span><span class="op" id="3579415">(</span><span class="ident" id="3579416">s0</span><span class="op" id="3579418">&gt;&gt;</span><span class="num" id="3579420">16</span><span class="op" id="3579422">)</span><span class="op" id="3579423">,</span>&nbsp;<span class="builtintype" id="3579425">byte</span><span class="op" id="3579429">(</span><span class="ident" id="3579430">s0</span><span class="op" id="3579432">&gt;&gt;</span><span class="num" id="3579434">8</span><span class="op" id="3579435">)</span><span class="op" id="3579436">,</span>&nbsp;<span class="builtintype" id="3579438">byte</span><span class="op" id="3579442">(</span><span class="ident" id="3579443">s0</span><span class="op" id="3579445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579448">dst</span><span class="op" id="3579451">[</span><span class="num" id="3579452">4</span><span class="op" id="3579453">]</span><span class="op" id="3579454">,</span>&nbsp;<span class="ident" id="3579456">dst</span><span class="op" id="3579459">[</span><span class="num" id="3579460">5</span><span class="op" id="3579461">]</span><span class="op" id="3579462">,</span>&nbsp;<span class="ident" id="3579464">dst</span><span class="op" id="3579467">[</span><span class="num" id="3579468">6</span><span class="op" id="3579469">]</span><span class="op" id="3579470">,</span>&nbsp;<span class="ident" id="3579472">dst</span><span class="op" id="3579475">[</span><span class="num" id="3579476">7</span><span class="op" id="3579477">]</span>&nbsp;<span class="op" id="3579479">=</span>&nbsp;<span class="builtintype" id="3579481">byte</span><span class="op" id="3579485">(</span><span class="ident" id="3579486">s1</span><span class="op" id="3579488">&gt;&gt;</span><span class="num" id="3579490">24</span><span class="op" id="3579492">)</span><span class="op" id="3579493">,</span>&nbsp;<span class="builtintype" id="3579495">byte</span><span class="op" id="3579499">(</span><span class="ident" id="3579500">s1</span><span class="op" id="3579502">&gt;&gt;</span><span class="num" id="3579504">16</span><span class="op" id="3579506">)</span><span class="op" id="3579507">,</span>&nbsp;<span class="builtintype" id="3579509">byte</span><span class="op" id="3579513">(</span><span class="ident" id="3579514">s1</span><span class="op" id="3579516">&gt;&gt;</span><span class="num" id="3579518">8</span><span class="op" id="3579519">)</span><span class="op" id="3579520">,</span>&nbsp;<span class="builtintype" id="3579522">byte</span><span class="op" id="3579526">(</span><span class="ident" id="3579527">s1</span><span class="op" id="3579529">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579532">dst</span><span class="op" id="3579535">[</span><span class="num" id="3579536">8</span><span class="op" id="3579537">]</span><span class="op" id="3579538">,</span>&nbsp;<span class="ident" id="3579540">dst</span><span class="op" id="3579543">[</span><span class="num" id="3579544">9</span><span class="op" id="3579545">]</span><span class="op" id="3579546">,</span>&nbsp;<span class="ident" id="3579548">dst</span><span class="op" id="3579551">[</span><span class="num" id="3579552">10</span><span class="op" id="3579554">]</span><span class="op" id="3579555">,</span>&nbsp;<span class="ident" id="3579557">dst</span><span class="op" id="3579560">[</span><span class="num" id="3579561">11</span><span class="op" id="3579563">]</span>&nbsp;<span class="op" id="3579565">=</span>&nbsp;<span class="builtintype" id="3579567">byte</span><span class="op" id="3579571">(</span><span class="ident" id="3579572">s2</span><span class="op" id="3579574">&gt;&gt;</span><span class="num" id="3579576">24</span><span class="op" id="3579578">)</span><span class="op" id="3579579">,</span>&nbsp;<span class="builtintype" id="3579581">byte</span><span class="op" id="3579585">(</span><span class="ident" id="3579586">s2</span><span class="op" id="3579588">&gt;&gt;</span><span class="num" id="3579590">16</span><span class="op" id="3579592">)</span><span class="op" id="3579593">,</span>&nbsp;<span class="builtintype" id="3579595">byte</span><span class="op" id="3579599">(</span><span class="ident" id="3579600">s2</span><span class="op" id="3579602">&gt;&gt;</span><span class="num" id="3579604">8</span><span class="op" id="3579605">)</span><span class="op" id="3579606">,</span>&nbsp;<span class="builtintype" id="3579608">byte</span><span class="op" id="3579612">(</span><span class="ident" id="3579613">s2</span><span class="op" id="3579615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579618">dst</span><span class="op" id="3579621">[</span><span class="num" id="3579622">12</span><span class="op" id="3579624">]</span><span class="op" id="3579625">,</span>&nbsp;<span class="ident" id="3579627">dst</span><span class="op" id="3579630">[</span><span class="num" id="3579631">13</span><span class="op" id="3579633">]</span><span class="op" id="3579634">,</span>&nbsp;<span class="ident" id="3579636">dst</span><span class="op" id="3579639">[</span><span class="num" id="3579640">14</span><span class="op" id="3579642">]</span><span class="op" id="3579643">,</span>&nbsp;<span class="ident" id="3579645">dst</span><span class="op" id="3579648">[</span><span class="num" id="3579649">15</span><span class="op" id="3579651">]</span>&nbsp;<span class="op" id="3579653">=</span>&nbsp;<span class="builtintype" id="3579655">byte</span><span class="op" id="3579659">(</span><span class="ident" id="3579660">s3</span><span class="op" id="3579662">&gt;&gt;</span><span class="num" id="3579664">24</span><span class="op" id="3579666">)</span><span class="op" id="3579667">,</span>&nbsp;<span class="builtintype" id="3579669">byte</span><span class="op" id="3579673">(</span><span class="ident" id="3579674">s3</span><span class="op" id="3579676">&gt;&gt;</span><span class="num" id="3579678">16</span><span class="op" id="3579680">)</span><span class="op" id="3579681">,</span>&nbsp;<span class="builtintype" id="3579683">byte</span><span class="op" id="3579687">(</span><span class="ident" id="3579688">s3</span><span class="op" id="3579690">&gt;&gt;</span><span class="num" id="3579692">8</span><span class="op" id="3579693">)</span><span class="op" id="3579694">,</span>&nbsp;<span class="builtintype" id="3579696">byte</span><span class="op" id="3579700">(</span><span class="ident" id="3579701">s3</span><span class="op" id="3579703">)</span><br>
<span class="lineno"></span><span class="op" id="3579705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3579708">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3579742">func</span>&nbsp;<span class="ident" id="3579747">subw</span><span class="op" id="3579751">(</span><span class="ident" id="3579752">w</span>&nbsp;<span class="builtintype" id="3579754">uint32</span><span class="op" id="3579760">)</span>&nbsp;<span class="builtintype" id="3579762">uint32</span>&nbsp;<span class="op" id="3579769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579772">return</span>&nbsp;<span class="builtintype" id="3579779">uint32</span><span class="op" id="3579785">(</span><span class="ident" id="3579786">sbox0</span><span class="op" id="3579791">[</span><span class="ident" id="3579792">w</span><span class="op" id="3579793">&gt;&gt;</span><span class="num" id="3579795">24</span><span class="op" id="3579797">]</span><span class="op" id="3579798">)</span><span class="op" id="3579799">&lt;&lt;</span><span class="num" id="3579801">24</span>&nbsp;<span class="op" id="3579804">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3579808">uint32</span><span class="op" id="3579814">(</span><span class="ident" id="3579815">sbox0</span><span class="op" id="3579820">[</span><span class="ident" id="3579821">w</span><span class="op" id="3579822">&gt;&gt;</span><span class="num" id="3579824">16</span><span class="op" id="3579826">&amp;</span><span class="num" id="3579827">0xff</span><span class="op" id="3579831">]</span><span class="op" id="3579832">)</span><span class="op" id="3579833">&lt;&lt;</span><span class="num" id="3579835">16</span>&nbsp;<span class="op" id="3579838">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3579842">uint32</span><span class="op" id="3579848">(</span><span class="ident" id="3579849">sbox0</span><span class="op" id="3579854">[</span><span class="ident" id="3579855">w</span><span class="op" id="3579856">&gt;&gt;</span><span class="num" id="3579858">8</span><span class="op" id="3579859">&amp;</span><span class="num" id="3579860">0xff</span><span class="op" id="3579864">]</span><span class="op" id="3579865">)</span><span class="op" id="3579866">&lt;&lt;</span><span class="num" id="3579868">8</span>&nbsp;<span class="op" id="3579870">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3579874">uint32</span><span class="op" id="3579880">(</span><span class="ident" id="3579881">sbox0</span><span class="op" id="3579886">[</span><span class="ident" id="3579887">w</span><span class="op" id="3579888">&amp;</span><span class="num" id="3579889">0xff</span><span class="op" id="3579893">]</span><span class="op" id="3579894">)</span><br>
<span class="lineno">135</span><span class="op" id="3579896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3579899">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3579909">func</span>&nbsp;<span class="ident" id="3579914">rotw</span><span class="op" id="3579918">(</span><span class="ident" id="3579919">w</span>&nbsp;<span class="builtintype" id="3579921">uint32</span><span class="op" id="3579927">)</span>&nbsp;<span class="builtintype" id="3579929">uint32</span>&nbsp;<span class="op" id="3579936">{</span>&nbsp;<span class="keyword" id="3579938">return</span>&nbsp;<span class="ident" id="3579945">w</span><span class="op" id="3579946">&lt;&lt;</span><span class="num" id="3579948">8</span>&nbsp;<span class="op" id="3579950">|</span>&nbsp;<span class="ident" id="3579952">w</span><span class="op" id="3579953">&gt;&gt;</span><span class="num" id="3579955">24</span>&nbsp;<span class="op" id="3579958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3579961">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3580015">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3580056">func</span>&nbsp;<span class="ident" id="3580061">expandKeyGo</span><span class="op" id="3580072">(</span><span class="ident" id="3580073">key</span>&nbsp;<span class="op" id="3580077">[</span><span class="op" id="3580078">]</span><span class="builtintype" id="3580079">byte</span><span class="op" id="3580083">,</span>&nbsp;<span class="ident" id="3580085">enc</span><span class="op" id="3580088">,</span>&nbsp;<span class="ident" id="3580090">dec</span>&nbsp;<span class="op" id="3580094">[</span><span class="op" id="3580095">]</span><span class="builtintype" id="3580096">uint32</span><span class="op" id="3580102">)</span>&nbsp;<span class="op" id="3580104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580107">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580133">var</span>&nbsp;<span class="ident" id="3580137">i</span>&nbsp;<span class="builtintype" id="3580139">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580144">nk</span>&nbsp;<span class="op" id="3580147">:=</span>&nbsp;<span class="builtinfunc" id="3580150">len</span><span class="op" id="3580153">(</span><span class="ident" id="3580154">key</span><span class="op" id="3580157">)</span>&nbsp;<span class="op" id="3580159">/</span>&nbsp;<span class="num" id="3580161">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580164">for</span>&nbsp;<span class="ident" id="3580168">i</span>&nbsp;<span class="op" id="3580170">=</span>&nbsp;<span class="num" id="3580172">0</span><span class="op" id="3580173">;</span>&nbsp;<span class="ident" id="3580175">i</span>&nbsp;<span class="op" id="3580177">&lt;</span>&nbsp;<span class="ident" id="3580179">nk</span><span class="op" id="3580181">;</span>&nbsp;<span class="ident" id="3580183">i</span><span class="op" id="3580184">++</span>&nbsp;<span class="op" id="3580187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580191">enc</span><span class="op" id="3580194">[</span><span class="ident" id="3580195">i</span><span class="op" id="3580196">]</span>&nbsp;<span class="op" id="3580198">=</span>&nbsp;<span class="builtintype" id="3580200">uint32</span><span class="op" id="3580206">(</span><span class="ident" id="3580207">key</span><span class="op" id="3580210">[</span><span class="num" id="3580211">4</span><span class="op" id="3580212">*</span><span class="ident" id="3580213">i</span><span class="op" id="3580214">]</span><span class="op" id="3580215">)</span><span class="op" id="3580216">&lt;&lt;</span><span class="num" id="3580218">24</span>&nbsp;<span class="op" id="3580221">|</span>&nbsp;<span class="builtintype" id="3580223">uint32</span><span class="op" id="3580229">(</span><span class="ident" id="3580230">key</span><span class="op" id="3580233">[</span><span class="num" id="3580234">4</span><span class="op" id="3580235">*</span><span class="ident" id="3580236">i</span><span class="op" id="3580237">+</span><span class="num" id="3580238">1</span><span class="op" id="3580239">]</span><span class="op" id="3580240">)</span><span class="op" id="3580241">&lt;&lt;</span><span class="num" id="3580243">16</span>&nbsp;<span class="op" id="3580246">|</span>&nbsp;<span class="builtintype" id="3580248">uint32</span><span class="op" id="3580254">(</span><span class="ident" id="3580255">key</span><span class="op" id="3580258">[</span><span class="num" id="3580259">4</span><span class="op" id="3580260">*</span><span class="ident" id="3580261">i</span><span class="op" id="3580262">+</span><span class="num" id="3580263">2</span><span class="op" id="3580264">]</span><span class="op" id="3580265">)</span><span class="op" id="3580266">&lt;&lt;</span><span class="num" id="3580268">8</span>&nbsp;<span class="op" id="3580270">|</span>&nbsp;<span class="builtintype" id="3580272">uint32</span><span class="op" id="3580278">(</span><span class="ident" id="3580279">key</span><span class="op" id="3580282">[</span><span class="num" id="3580283">4</span><span class="op" id="3580284">*</span><span class="ident" id="3580285">i</span><span class="op" id="3580286">+</span><span class="num" id="3580287">3</span><span class="op" id="3580288">]</span><span class="op" id="3580289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580295">for</span>&nbsp;<span class="op" id="3580299">;</span>&nbsp;<span class="ident" id="3580301">i</span>&nbsp;<span class="op" id="3580303">&lt;</span>&nbsp;<span class="builtinfunc" id="3580305">len</span><span class="op" id="3580308">(</span><span class="ident" id="3580309">enc</span><span class="op" id="3580312">)</span><span class="op" id="3580313">;</span>&nbsp;<span class="ident" id="3580315">i</span><span class="op" id="3580316">++</span>&nbsp;<span class="op" id="3580319">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580323">t</span>&nbsp;<span class="op" id="3580325">:=</span>&nbsp;<span class="ident" id="3580328">enc</span><span class="op" id="3580331">[</span><span class="ident" id="3580332">i</span><span class="op" id="3580333">-</span><span class="num" id="3580334">1</span><span class="op" id="3580335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580339">if</span>&nbsp;<span class="ident" id="3580342">i</span><span class="op" id="3580343">%</span><span class="ident" id="3580344">nk</span>&nbsp;<span class="op" id="3580347">==</span>&nbsp;<span class="num" id="3580350">0</span>&nbsp;<span class="op" id="3580352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580357">t</span>&nbsp;<span class="op" id="3580359">=</span>&nbsp;<span class="ident" id="3580361">subw</span><span class="op" id="3580365">(</span><span class="ident" id="3580366">rotw</span><span class="op" id="3580370">(</span><span class="ident" id="3580371">t</span><span class="op" id="3580372">)</span><span class="op" id="3580373">)</span>&nbsp;<span class="op" id="3580375">^</span>&nbsp;<span class="op" id="3580377">(</span><span class="builtintype" id="3580378">uint32</span><span class="op" id="3580384">(</span><span class="ident" id="3580385">powx</span><span class="op" id="3580389">[</span><span class="ident" id="3580390">i</span><span class="op" id="3580391">/</span><span class="ident" id="3580392">nk</span><span class="op" id="3580394">-</span><span class="num" id="3580395">1</span><span class="op" id="3580396">]</span><span class="op" id="3580397">)</span>&nbsp;<span class="op" id="3580399">&lt;&lt;</span>&nbsp;<span class="num" id="3580402">24</span><span class="op" id="3580404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580408">}</span>&nbsp;<span class="keyword" id="3580410">else</span>&nbsp;<span class="keyword" id="3580415">if</span>&nbsp;<span class="ident" id="3580418">nk</span>&nbsp;<span class="op" id="3580421">&gt;</span>&nbsp;<span class="num" id="3580423">6</span>&nbsp;<span class="op" id="3580425">&amp;&amp;</span>&nbsp;<span class="ident" id="3580428">i</span><span class="op" id="3580429">%</span><span class="ident" id="3580430">nk</span>&nbsp;<span class="op" id="3580433">==</span>&nbsp;<span class="num" id="3580436">4</span>&nbsp;<span class="op" id="3580438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580443">t</span>&nbsp;<span class="op" id="3580445">=</span>&nbsp;<span class="ident" id="3580447">subw</span><span class="op" id="3580451">(</span><span class="ident" id="3580452">t</span><span class="op" id="3580453">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580461">enc</span><span class="op" id="3580464">[</span><span class="ident" id="3580465">i</span><span class="op" id="3580466">]</span>&nbsp;<span class="op" id="3580468">=</span>&nbsp;<span class="ident" id="3580470">enc</span><span class="op" id="3580473">[</span><span class="ident" id="3580474">i</span><span class="op" id="3580475">-</span><span class="ident" id="3580476">nk</span><span class="op" id="3580478">]</span>&nbsp;<span class="op" id="3580480">^</span>&nbsp;<span class="ident" id="3580482">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580489">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580536">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3580599">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580672">if</span>&nbsp;<span class="ident" id="3580675">dec</span>&nbsp;<span class="op" id="3580679">==</span>&nbsp;<span class="ident" id="3580682">nil</span>&nbsp;<span class="op" id="3580686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580698">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580701">n</span>&nbsp;<span class="op" id="3580703">:=</span>&nbsp;<span class="builtinfunc" id="3580706">len</span><span class="op" id="3580709">(</span><span class="ident" id="3580710">enc</span><span class="op" id="3580713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580716">for</span>&nbsp;<span class="ident" id="3580720">i</span>&nbsp;<span class="op" id="3580722">:=</span>&nbsp;<span class="num" id="3580725">0</span><span class="op" id="3580726">;</span>&nbsp;<span class="ident" id="3580728">i</span>&nbsp;<span class="op" id="3580730">&lt;</span>&nbsp;<span class="ident" id="3580732">n</span><span class="op" id="3580733">;</span>&nbsp;<span class="ident" id="3580735">i</span>&nbsp;<span class="op" id="3580737">+=</span>&nbsp;<span class="num" id="3580740">4</span>&nbsp;<span class="op" id="3580742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580746">ei</span>&nbsp;<span class="op" id="3580749">:=</span>&nbsp;<span class="ident" id="3580752">n</span>&nbsp;<span class="op" id="3580754">-</span>&nbsp;<span class="ident" id="3580756">i</span>&nbsp;<span class="op" id="3580758">-</span>&nbsp;<span class="num" id="3580760">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580764">for</span>&nbsp;<span class="ident" id="3580768">j</span>&nbsp;<span class="op" id="3580770">:=</span>&nbsp;<span class="num" id="3580773">0</span><span class="op" id="3580774">;</span>&nbsp;<span class="ident" id="3580776">j</span>&nbsp;<span class="op" id="3580778">&lt;</span>&nbsp;<span class="num" id="3580780">4</span><span class="op" id="3580781">;</span>&nbsp;<span class="ident" id="3580783">j</span><span class="op" id="3580784">++</span>&nbsp;<span class="op" id="3580787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580792">x</span>&nbsp;<span class="op" id="3580794">:=</span>&nbsp;<span class="ident" id="3580797">enc</span><span class="op" id="3580800">[</span><span class="ident" id="3580801">ei</span><span class="op" id="3580803">+</span><span class="ident" id="3580804">j</span><span class="op" id="3580805">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3580810">if</span>&nbsp;<span class="ident" id="3580813">i</span>&nbsp;<span class="op" id="3580815">&gt;</span>&nbsp;<span class="num" id="3580817">0</span>&nbsp;<span class="op" id="3580819">&amp;&amp;</span>&nbsp;<span class="ident" id="3580822">i</span><span class="op" id="3580823">+</span><span class="num" id="3580824">4</span>&nbsp;<span class="op" id="3580826">&lt;</span>&nbsp;<span class="ident" id="3580828">n</span>&nbsp;<span class="op" id="3580830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580836">x</span>&nbsp;<span class="op" id="3580838">=</span>&nbsp;<span class="ident" id="3580840">td0</span><span class="op" id="3580843">[</span><span class="ident" id="3580844">sbox0</span><span class="op" id="3580849">[</span><span class="ident" id="3580850">x</span><span class="op" id="3580851">&gt;&gt;</span><span class="num" id="3580853">24</span><span class="op" id="3580855">]</span><span class="op" id="3580856">]</span>&nbsp;<span class="op" id="3580858">^</span>&nbsp;<span class="ident" id="3580860">td1</span><span class="op" id="3580863">[</span><span class="ident" id="3580864">sbox0</span><span class="op" id="3580869">[</span><span class="ident" id="3580870">x</span><span class="op" id="3580871">&gt;&gt;</span><span class="num" id="3580873">16</span><span class="op" id="3580875">&amp;</span><span class="num" id="3580876">0xff</span><span class="op" id="3580880">]</span><span class="op" id="3580881">]</span>&nbsp;<span class="op" id="3580883">^</span>&nbsp;<span class="ident" id="3580885">td2</span><span class="op" id="3580888">[</span><span class="ident" id="3580889">sbox0</span><span class="op" id="3580894">[</span><span class="ident" id="3580895">x</span><span class="op" id="3580896">&gt;&gt;</span><span class="num" id="3580898">8</span><span class="op" id="3580899">&amp;</span><span class="num" id="3580900">0xff</span><span class="op" id="3580904">]</span><span class="op" id="3580905">]</span>&nbsp;<span class="op" id="3580907">^</span>&nbsp;<span class="ident" id="3580909">td3</span><span class="op" id="3580912">[</span><span class="ident" id="3580913">sbox0</span><span class="op" id="3580918">[</span><span class="ident" id="3580919">x</span><span class="op" id="3580920">&amp;</span><span class="num" id="3580921">0xff</span><span class="op" id="3580925">]</span><span class="op" id="3580926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3580936">dec</span><span class="op" id="3580939">[</span><span class="ident" id="3580940">i</span><span class="op" id="3580941">+</span><span class="ident" id="3580942">j</span><span class="op" id="3580943">]</span>&nbsp;<span class="op" id="3580945">=</span>&nbsp;<span class="ident" id="3580947">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580951">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3580954">}</span><br>
<span class="lineno"></span><span class="op" id="3580956">}</span>
</div>
</body>
</html>
