<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html" class="current">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3699551">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3699606">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3699660">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3699711">package</span>&nbsp;<span class="ident" id="3699719">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3699724">import</span>&nbsp;<span class="op" id="3699731">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3699734">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3699751">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3699761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3699764">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3699796">const</span>&nbsp;<span class="ident" id="3699802">BlockSize</span>&nbsp;<span class="op" id="3699812">=</span>&nbsp;<span class="num" id="3699814">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3699818">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3699887">type</span>&nbsp;<span class="ident" id="3699892">aesCipher</span>&nbsp;<span class="keyword" id="3699902">struct</span>&nbsp;<span class="op" id="3699909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699912">enc</span>&nbsp;<span class="op" id="3699916">[</span><span class="op" id="3699917">]</span><span class="builtintype" id="3699918">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699926">dec</span>&nbsp;<span class="op" id="3699930">[</span><span class="op" id="3699931">]</span><span class="builtintype" id="3699932">uint32</span><br>
<span class="lineno"></span><span class="op" id="3699939">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3699942">type</span>&nbsp;<span class="ident" id="3699947">KeySizeError</span>&nbsp;<span class="builtintype" id="3699960">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3699965">func</span>&nbsp;<span class="op" id="3699970">(</span><span class="ident" id="3699971">k</span>&nbsp;<span class="ident" id="3699973">KeySizeError</span><span class="op" id="3699985">)</span>&nbsp;<span class="ident" id="3699987">Error</span><span class="op" id="3699992">(</span><span class="op" id="3699993">)</span>&nbsp;<span class="builtintype" id="3699995">string</span>&nbsp;<span class="op" id="3700002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700005">return</span>&nbsp;<span class="string" id="3700012">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3700044">+</span>&nbsp;<span class="ident" id="3700046">strconv</span><span class="op" id="3700053">.</span><span class="ident" id="3700054">Itoa</span><span class="op" id="3700058">(</span><span class="builtintype" id="3700059">int</span><span class="op" id="3700062">(</span><span class="ident" id="3700063">k</span><span class="op" id="3700064">)</span><span class="op" id="3700065">)</span><br>
<span class="lineno">25</span><span class="op" id="3700067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700070">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3700123">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3700166">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3700206">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3700239">func</span>&nbsp;<span class="ident" id="3700244">NewCipher</span><span class="op" id="3700253">(</span><span class="ident" id="3700254">key</span>&nbsp;<span class="op" id="3700258">[</span><span class="op" id="3700259">]</span><span class="builtintype" id="3700260">byte</span><span class="op" id="3700264">)</span>&nbsp;<span class="op" id="3700266">(</span><span class="ident" id="3700267">cipher</span><span class="op" id="3700273">.</span><span class="ident" id="3700274">Block</span><span class="op" id="3700279">,</span>&nbsp;<span class="builtintype" id="3700281">error</span><span class="op" id="3700286">)</span>&nbsp;<span class="op" id="3700288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700291">k</span>&nbsp;<span class="op" id="3700293">:=</span>&nbsp;<span class="builtinfunc" id="3700296">len</span><span class="op" id="3700299">(</span><span class="ident" id="3700300">key</span><span class="op" id="3700303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700306">switch</span>&nbsp;<span class="ident" id="3700313">k</span>&nbsp;<span class="op" id="3700315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700318">default</span><span class="op" id="3700325">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700329">return</span>&nbsp;<span class="ident" id="3700336">nil</span><span class="op" id="3700339">,</span>&nbsp;<span class="ident" id="3700341">KeySizeError</span><span class="op" id="3700353">(</span><span class="ident" id="3700354">k</span><span class="op" id="3700355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700358">case</span>&nbsp;<span class="num" id="3700363">16</span><span class="op" id="3700365">,</span>&nbsp;<span class="num" id="3700367">24</span><span class="op" id="3700369">,</span>&nbsp;<span class="num" id="3700371">32</span><span class="op" id="3700373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700377">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700388">n</span>&nbsp;<span class="op" id="3700390">:=</span>&nbsp;<span class="ident" id="3700393">k</span>&nbsp;<span class="op" id="3700395">+</span>&nbsp;<span class="num" id="3700397">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700401">c</span>&nbsp;<span class="op" id="3700403">:=</span>&nbsp;<span class="op" id="3700406">&amp;</span><span class="ident" id="3700407">aesCipher</span><span class="op" id="3700416">{</span><span class="builtinfunc" id="3700417">make</span><span class="op" id="3700421">(</span><span class="op" id="3700422">[</span><span class="op" id="3700423">]</span><span class="builtintype" id="3700424">uint32</span><span class="op" id="3700430">,</span>&nbsp;<span class="ident" id="3700432">n</span><span class="op" id="3700433">)</span><span class="op" id="3700434">,</span>&nbsp;<span class="builtinfunc" id="3700436">make</span><span class="op" id="3700440">(</span><span class="op" id="3700441">[</span><span class="op" id="3700442">]</span><span class="builtintype" id="3700443">uint32</span><span class="op" id="3700449">,</span>&nbsp;<span class="ident" id="3700451">n</span><span class="op" id="3700452">)</span><span class="op" id="3700453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700456">expandKey</span><span class="op" id="3700465">(</span><span class="ident" id="3700466">key</span><span class="op" id="3700469">,</span>&nbsp;<span class="ident" id="3700471">c</span><span class="op" id="3700472">.</span><span class="ident" id="3700473">enc</span><span class="op" id="3700476">,</span>&nbsp;<span class="ident" id="3700478">c</span><span class="op" id="3700479">.</span><span class="ident" id="3700480">dec</span><span class="op" id="3700483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700486">return</span>&nbsp;<span class="ident" id="3700493">c</span><span class="op" id="3700494">,</span>&nbsp;<span class="ident" id="3700496">nil</span><br>
<span class="lineno"></span><span class="op" id="3700500">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3700503">func</span>&nbsp;<span class="op" id="3700508">(</span><span class="ident" id="3700509">c</span>&nbsp;<span class="op" id="3700511">*</span><span class="ident" id="3700512">aesCipher</span><span class="op" id="3700521">)</span>&nbsp;<span class="ident" id="3700523">BlockSize</span><span class="op" id="3700532">(</span><span class="op" id="3700533">)</span>&nbsp;<span class="builtintype" id="3700535">int</span>&nbsp;<span class="op" id="3700539">{</span>&nbsp;<span class="keyword" id="3700541">return</span>&nbsp;<span class="ident" id="3700548">BlockSize</span>&nbsp;<span class="op" id="3700558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3700561">func</span>&nbsp;<span class="op" id="3700566">(</span><span class="ident" id="3700567">c</span>&nbsp;<span class="op" id="3700569">*</span><span class="ident" id="3700570">aesCipher</span><span class="op" id="3700579">)</span>&nbsp;<span class="ident" id="3700581">Encrypt</span><span class="op" id="3700588">(</span><span class="ident" id="3700589">dst</span><span class="op" id="3700592">,</span>&nbsp;<span class="ident" id="3700594">src</span>&nbsp;<span class="op" id="3700598">[</span><span class="op" id="3700599">]</span><span class="builtintype" id="3700600">byte</span><span class="op" id="3700604">)</span>&nbsp;<span class="op" id="3700606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700609">if</span>&nbsp;<span class="builtinfunc" id="3700612">len</span><span class="op" id="3700615">(</span><span class="ident" id="3700616">src</span><span class="op" id="3700619">)</span>&nbsp;<span class="op" id="3700621">&lt;</span>&nbsp;<span class="ident" id="3700623">BlockSize</span>&nbsp;<span class="op" id="3700633">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3700637">panic</span><span class="op" id="3700642">(</span><span class="string" id="3700643">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3700677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700683">if</span>&nbsp;<span class="builtinfunc" id="3700686">len</span><span class="op" id="3700689">(</span><span class="ident" id="3700690">dst</span><span class="op" id="3700693">)</span>&nbsp;<span class="op" id="3700695">&lt;</span>&nbsp;<span class="ident" id="3700697">BlockSize</span>&nbsp;<span class="op" id="3700707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3700711">panic</span><span class="op" id="3700716">(</span><span class="string" id="3700717">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3700752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700755">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700758">encryptBlock</span><span class="op" id="3700770">(</span><span class="ident" id="3700771">c</span><span class="op" id="3700772">.</span><span class="ident" id="3700773">enc</span><span class="op" id="3700776">,</span>&nbsp;<span class="ident" id="3700778">dst</span><span class="op" id="3700781">,</span>&nbsp;<span class="ident" id="3700783">src</span><span class="op" id="3700786">)</span><br>
<span class="lineno"></span><span class="op" id="3700788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3700791">func</span>&nbsp;<span class="op" id="3700796">(</span><span class="ident" id="3700797">c</span>&nbsp;<span class="op" id="3700799">*</span><span class="ident" id="3700800">aesCipher</span><span class="op" id="3700809">)</span>&nbsp;<span class="ident" id="3700811">Decrypt</span><span class="op" id="3700818">(</span><span class="ident" id="3700819">dst</span><span class="op" id="3700822">,</span>&nbsp;<span class="ident" id="3700824">src</span>&nbsp;<span class="op" id="3700828">[</span><span class="op" id="3700829">]</span><span class="builtintype" id="3700830">byte</span><span class="op" id="3700834">)</span>&nbsp;<span class="op" id="3700836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700839">if</span>&nbsp;<span class="builtinfunc" id="3700842">len</span><span class="op" id="3700845">(</span><span class="ident" id="3700846">src</span><span class="op" id="3700849">)</span>&nbsp;<span class="op" id="3700851">&lt;</span>&nbsp;<span class="ident" id="3700853">BlockSize</span>&nbsp;<span class="op" id="3700863">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3700867">panic</span><span class="op" id="3700872">(</span><span class="string" id="3700873">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3700907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700913">if</span>&nbsp;<span class="builtinfunc" id="3700916">len</span><span class="op" id="3700919">(</span><span class="ident" id="3700920">dst</span><span class="op" id="3700923">)</span>&nbsp;<span class="op" id="3700925">&lt;</span>&nbsp;<span class="ident" id="3700927">BlockSize</span>&nbsp;<span class="op" id="3700937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3700941">panic</span><span class="op" id="3700946">(</span><span class="string" id="3700947">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3700982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3700985">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700988">decryptBlock</span><span class="op" id="3701000">(</span><span class="ident" id="3701001">c</span><span class="op" id="3701002">.</span><span class="ident" id="3701003">dec</span><span class="op" id="3701006">,</span>&nbsp;<span class="ident" id="3701008">dst</span><span class="op" id="3701011">,</span>&nbsp;<span class="ident" id="3701013">src</span><span class="op" id="3701016">)</span><br>
<span class="lineno"></span><span class="op" id="3701018">}</span>
</div>
</body>
</html>
