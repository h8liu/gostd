<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7433877">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7433932">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7433986">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7434037">package</span>&nbsp;<span class="ident" id="7434045">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7434056">import</span>&nbsp;<span class="op" id="7434063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434066">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434075">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434092">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434099">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434105">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434118">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434135">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434141">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434152">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7434163">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7434173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7434176">func</span>&nbsp;<span class="ident" id="7434181">TestBoundaryLine</span><span class="op" id="7434197">(</span><span class="ident" id="7434198">t</span>&nbsp;<span class="op" id="7434200">*</span><span class="ident" id="7434201">testing</span><span class="op" id="7434208">.</span><span class="ident" id="7434209">T</span><span class="op" id="7434210">)</span>&nbsp;<span class="op" id="7434212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434215">mr</span>&nbsp;<span class="op" id="7434218">:=</span>&nbsp;<span class="ident" id="7434221">NewReader</span><span class="op" id="7434230">(</span><span class="ident" id="7434231">strings</span><span class="op" id="7434238">.</span><span class="ident" id="7434239">NewReader</span><span class="op" id="7434248">(</span><span class="string" id="7434249">&#34;&#34;</span><span class="op" id="7434251">)</span><span class="op" id="7434252">,</span>&nbsp;<span class="string" id="7434254">&#34;myBoundary&#34;</span><span class="op" id="7434266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434269">if</span>&nbsp;<span class="op" id="7434272">!</span><span class="ident" id="7434273">mr</span><span class="op" id="7434275">.</span><span class="ident" id="7434276">isBoundaryDelimiterLine</span><span class="op" id="7434299">(</span><span class="op" id="7434300">[</span><span class="op" id="7434301">]</span><span class="builtintype" id="7434302">byte</span><span class="op" id="7434306">(</span><span class="string" id="7434307">&#34;--myBoundary\r\n&#34;</span><span class="op" id="7434325">)</span><span class="op" id="7434326">)</span>&nbsp;<span class="op" id="7434328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434332">t</span><span class="op" id="7434333">.</span><span class="ident" id="7434334">Error</span><span class="op" id="7434339">(</span><span class="string" id="7434340">&#34;expected&#34;</span><span class="op" id="7434350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434353">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434356">if</span>&nbsp;<span class="op" id="7434359">!</span><span class="ident" id="7434360">mr</span><span class="op" id="7434362">.</span><span class="ident" id="7434363">isBoundaryDelimiterLine</span><span class="op" id="7434386">(</span><span class="op" id="7434387">[</span><span class="op" id="7434388">]</span><span class="builtintype" id="7434389">byte</span><span class="op" id="7434393">(</span><span class="string" id="7434394">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="7434413">)</span><span class="op" id="7434414">)</span>&nbsp;<span class="op" id="7434416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434420">t</span><span class="op" id="7434421">.</span><span class="ident" id="7434422">Error</span><span class="op" id="7434427">(</span><span class="string" id="7434428">&#34;expected&#34;</span><span class="op" id="7434438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434444">if</span>&nbsp;<span class="op" id="7434447">!</span><span class="ident" id="7434448">mr</span><span class="op" id="7434450">.</span><span class="ident" id="7434451">isBoundaryDelimiterLine</span><span class="op" id="7434474">(</span><span class="op" id="7434475">[</span><span class="op" id="7434476">]</span><span class="builtintype" id="7434477">byte</span><span class="op" id="7434481">(</span><span class="string" id="7434482">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="7434499">)</span><span class="op" id="7434500">)</span>&nbsp;<span class="op" id="7434502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434506">t</span><span class="op" id="7434507">.</span><span class="ident" id="7434508">Error</span><span class="op" id="7434513">(</span><span class="string" id="7434514">&#34;expected&#34;</span><span class="op" id="7434524">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434530">if</span>&nbsp;<span class="ident" id="7434533">mr</span><span class="op" id="7434535">.</span><span class="ident" id="7434536">isBoundaryDelimiterLine</span><span class="op" id="7434559">(</span><span class="op" id="7434560">[</span><span class="op" id="7434561">]</span><span class="builtintype" id="7434562">byte</span><span class="op" id="7434566">(</span><span class="string" id="7434567">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="7434590">)</span><span class="op" id="7434591">)</span>&nbsp;<span class="op" id="7434593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434597">t</span><span class="op" id="7434598">.</span><span class="ident" id="7434599">Error</span><span class="op" id="7434604">(</span><span class="string" id="7434605">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7434620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434626">if</span>&nbsp;<span class="ident" id="7434629">mr</span><span class="op" id="7434631">.</span><span class="ident" id="7434632">isBoundaryDelimiterLine</span><span class="op" id="7434655">(</span><span class="op" id="7434656">[</span><span class="op" id="7434657">]</span><span class="builtintype" id="7434658">byte</span><span class="op" id="7434662">(</span><span class="string" id="7434663">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="7434685">)</span><span class="op" id="7434686">)</span>&nbsp;<span class="op" id="7434688">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434692">t</span><span class="op" id="7434693">.</span><span class="ident" id="7434694">Error</span><span class="op" id="7434699">(</span><span class="string" id="7434700">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7434715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434718">}</span><br>
<span class="lineno"></span><span class="op" id="7434720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7434723">func</span>&nbsp;<span class="ident" id="7434728">escapeString</span><span class="op" id="7434740">(</span><span class="ident" id="7434741">v</span>&nbsp;<span class="builtintype" id="7434743">string</span><span class="op" id="7434749">)</span>&nbsp;<span class="builtintype" id="7434751">string</span>&nbsp;<span class="op" id="7434758">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434761">bytes</span><span class="op" id="7434766">,</span>&nbsp;<span class="ident" id="7434768">_</span>&nbsp;<span class="op" id="7434770">:=</span>&nbsp;<span class="ident" id="7434773">json</span><span class="op" id="7434777">.</span><span class="ident" id="7434778">Marshal</span><span class="op" id="7434785">(</span><span class="ident" id="7434786">v</span><span class="op" id="7434787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434790">return</span>&nbsp;<span class="builtintype" id="7434797">string</span><span class="op" id="7434803">(</span><span class="ident" id="7434804">bytes</span><span class="op" id="7434809">)</span><br>
<span class="lineno"></span><span class="op" id="7434811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7434814">func</span>&nbsp;<span class="ident" id="7434819">expectEq</span><span class="op" id="7434827">(</span><span class="ident" id="7434828">t</span>&nbsp;<span class="op" id="7434830">*</span><span class="ident" id="7434831">testing</span><span class="op" id="7434838">.</span><span class="ident" id="7434839">T</span><span class="op" id="7434840">,</span>&nbsp;<span class="ident" id="7434842">expected</span><span class="op" id="7434850">,</span>&nbsp;<span class="ident" id="7434852">actual</span><span class="op" id="7434858">,</span>&nbsp;<span class="ident" id="7434860">what</span>&nbsp;<span class="builtintype" id="7434865">string</span><span class="op" id="7434871">)</span>&nbsp;<span class="op" id="7434873">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434876">if</span>&nbsp;<span class="ident" id="7434879">expected</span>&nbsp;<span class="op" id="7434888">==</span>&nbsp;<span class="ident" id="7434891">actual</span>&nbsp;<span class="op" id="7434898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7434902">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7434910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434913">t</span><span class="op" id="7434914">.</span><span class="ident" id="7434915">Errorf</span><span class="op" id="7434921">(</span><span class="string" id="7434922">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="7434990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7434994">what</span><span class="op" id="7434998">,</span>&nbsp;<span class="ident" id="7435000">escapeString</span><span class="op" id="7435012">(</span><span class="ident" id="7435013">actual</span><span class="op" id="7435019">)</span><span class="op" id="7435020">,</span>&nbsp;<span class="builtinfunc" id="7435022">len</span><span class="op" id="7435025">(</span><span class="ident" id="7435026">actual</span><span class="op" id="7435032">)</span><span class="op" id="7435033">,</span>&nbsp;<span class="ident" id="7435035">escapeString</span><span class="op" id="7435047">(</span><span class="ident" id="7435048">expected</span><span class="op" id="7435056">)</span><span class="op" id="7435057">,</span>&nbsp;<span class="builtinfunc" id="7435059">len</span><span class="op" id="7435062">(</span><span class="ident" id="7435063">expected</span><span class="op" id="7435071">)</span><span class="op" id="7435072">)</span><br>
<span class="lineno">50</span><span class="op" id="7435074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7435077">func</span>&nbsp;<span class="ident" id="7435082">TestNameAccessors</span><span class="op" id="7435099">(</span><span class="ident" id="7435100">t</span>&nbsp;<span class="op" id="7435102">*</span><span class="ident" id="7435103">testing</span><span class="op" id="7435110">.</span><span class="ident" id="7435111">T</span><span class="op" id="7435112">)</span>&nbsp;<span class="op" id="7435114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435117">tests</span>&nbsp;<span class="op" id="7435123">:=</span>&nbsp;<span class="op" id="7435126">[</span><span class="op" id="7435127">...</span><span class="op" id="7435130">]</span><span class="op" id="7435131">[</span><span class="num" id="7435132">3</span><span class="op" id="7435133">]</span><span class="builtintype" id="7435134">string</span><span class="op" id="7435140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435144">{</span><span class="string" id="7435145">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7435168">,</span>&nbsp;<span class="string" id="7435170">&#34;foo&#34;</span><span class="op" id="7435175">,</span>&nbsp;<span class="string" id="7435177">&#34;&#34;</span><span class="op" id="7435179">}</span><span class="op" id="7435180">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435184">{</span><span class="string" id="7435185">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="7435208">,</span>&nbsp;<span class="string" id="7435210">&#34;foo&#34;</span><span class="op" id="7435215">,</span>&nbsp;<span class="string" id="7435217">&#34;&#34;</span><span class="op" id="7435219">}</span><span class="op" id="7435220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435224">{</span><span class="string" id="7435225">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="7435247">,</span>&nbsp;<span class="string" id="7435249">&#34;foo&#34;</span><span class="op" id="7435254">,</span>&nbsp;<span class="string" id="7435256">&#34;&#34;</span><span class="op" id="7435258">}</span><span class="op" id="7435259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435263">{</span><span class="string" id="7435264">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7435289">,</span>&nbsp;<span class="string" id="7435291">&#34;foo&#34;</span><span class="op" id="7435296">,</span>&nbsp;<span class="string" id="7435298">&#34;&#34;</span><span class="op" id="7435300">}</span><span class="op" id="7435301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435305">{</span><span class="string" id="7435306">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7435331">,</span>&nbsp;<span class="string" id="7435333">&#34;foo&#34;</span><span class="op" id="7435338">,</span>&nbsp;<span class="string" id="7435340">&#34;&#34;</span><span class="op" id="7435342">}</span><span class="op" id="7435343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435347">{</span><span class="string" id="7435348">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="7435371">,</span>&nbsp;<span class="string" id="7435373">&#34;foo&#34;</span><span class="op" id="7435378">,</span>&nbsp;<span class="string" id="7435380">&#34;&#34;</span><span class="op" id="7435382">}</span><span class="op" id="7435383">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435387">{</span><span class="string" id="7435388">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7435441">,</span>&nbsp;<span class="string" id="7435443">&#34;foo&#34;</span><span class="op" id="7435448">,</span>&nbsp;<span class="string" id="7435450">&#34;foo.txt&#34;</span><span class="op" id="7435459">}</span><span class="op" id="7435460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435464">{</span><span class="string" id="7435465">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7435522">,</span>&nbsp;<span class="string" id="7435524">&#34;&#34;</span><span class="op" id="7435526">,</span>&nbsp;<span class="string" id="7435528">&#34;bar.txt&#34;</span><span class="op" id="7435537">}</span><span class="op" id="7435538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435544">for</span>&nbsp;<span class="ident" id="7435548">i</span><span class="op" id="7435549">,</span>&nbsp;<span class="ident" id="7435551">test</span>&nbsp;<span class="op" id="7435556">:=</span>&nbsp;<span class="keyword" id="7435559">range</span>&nbsp;<span class="ident" id="7435565">tests</span>&nbsp;<span class="op" id="7435571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435575">p</span>&nbsp;<span class="op" id="7435577">:=</span>&nbsp;<span class="op" id="7435580">&amp;</span><span class="ident" id="7435581">Part</span><span class="op" id="7435585">{</span><span class="ident" id="7435586">Header</span><span class="op" id="7435592">:</span>&nbsp;<span class="builtinfunc" id="7435594">make</span><span class="op" id="7435598">(</span><span class="keyword" id="7435599">map</span><span class="op" id="7435602">[</span><span class="builtintype" id="7435603">string</span><span class="op" id="7435609">]</span><span class="op" id="7435610">[</span><span class="op" id="7435611">]</span><span class="builtintype" id="7435612">string</span><span class="op" id="7435618">)</span><span class="op" id="7435619">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435623">p</span><span class="op" id="7435624">.</span><span class="ident" id="7435625">Header</span><span class="op" id="7435631">.</span><span class="ident" id="7435632">Set</span><span class="op" id="7435635">(</span><span class="string" id="7435636">&#34;Content-Disposition&#34;</span><span class="op" id="7435657">,</span>&nbsp;<span class="ident" id="7435659">test</span><span class="op" id="7435663">[</span><span class="num" id="7435664">0</span><span class="op" id="7435665">]</span><span class="op" id="7435666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435670">if</span>&nbsp;<span class="ident" id="7435673">g</span><span class="op" id="7435674">,</span>&nbsp;<span class="ident" id="7435676">e</span>&nbsp;<span class="op" id="7435678">:=</span>&nbsp;<span class="ident" id="7435681">p</span><span class="op" id="7435682">.</span><span class="ident" id="7435683">FormName</span><span class="op" id="7435691">(</span><span class="op" id="7435692">)</span><span class="op" id="7435693">,</span>&nbsp;<span class="ident" id="7435695">test</span><span class="op" id="7435699">[</span><span class="num" id="7435700">1</span><span class="op" id="7435701">]</span><span class="op" id="7435702">;</span>&nbsp;<span class="ident" id="7435704">g</span>&nbsp;<span class="op" id="7435706">!=</span>&nbsp;<span class="ident" id="7435709">e</span>&nbsp;<span class="op" id="7435711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435716">t</span><span class="op" id="7435717">.</span><span class="ident" id="7435718">Errorf</span><span class="op" id="7435724">(</span><span class="string" id="7435725">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7435760">,</span>&nbsp;<span class="ident" id="7435762">i</span><span class="op" id="7435763">,</span>&nbsp;<span class="ident" id="7435765">g</span><span class="op" id="7435766">,</span>&nbsp;<span class="ident" id="7435768">e</span><span class="op" id="7435769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7435777">if</span>&nbsp;<span class="ident" id="7435780">g</span><span class="op" id="7435781">,</span>&nbsp;<span class="ident" id="7435783">e</span>&nbsp;<span class="op" id="7435785">:=</span>&nbsp;<span class="ident" id="7435788">p</span><span class="op" id="7435789">.</span><span class="ident" id="7435790">FileName</span><span class="op" id="7435798">(</span><span class="op" id="7435799">)</span><span class="op" id="7435800">,</span>&nbsp;<span class="ident" id="7435802">test</span><span class="op" id="7435806">[</span><span class="num" id="7435807">2</span><span class="op" id="7435808">]</span><span class="op" id="7435809">;</span>&nbsp;<span class="ident" id="7435811">g</span>&nbsp;<span class="op" id="7435813">!=</span>&nbsp;<span class="ident" id="7435816">e</span>&nbsp;<span class="op" id="7435818">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435823">t</span><span class="op" id="7435824">.</span><span class="ident" id="7435825">Errorf</span><span class="op" id="7435831">(</span><span class="string" id="7435832">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7435867">,</span>&nbsp;<span class="ident" id="7435869">i</span><span class="op" id="7435870">,</span>&nbsp;<span class="ident" id="7435872">g</span><span class="op" id="7435873">,</span>&nbsp;<span class="ident" id="7435875">e</span><span class="op" id="7435876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7435883">}</span><br>
<span class="lineno"></span><span class="op" id="7435885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7435888">var</span>&nbsp;<span class="ident" id="7435892">longLine</span>&nbsp;<span class="op" id="7435901">=</span>&nbsp;<span class="ident" id="7435903">strings</span><span class="op" id="7435910">.</span><span class="ident" id="7435911">Repeat</span><span class="op" id="7435917">(</span><span class="string" id="7435918">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="7435938">,</span>&nbsp;<span class="op" id="7435940">(</span><span class="num" id="7435941">1</span><span class="op" id="7435942">&lt;&lt;</span><span class="num" id="7435944">20</span><span class="op" id="7435946">)</span><span class="op" id="7435947">/</span><span class="num" id="7435948">8</span><span class="op" id="7435949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7435952">func</span>&nbsp;<span class="ident" id="7435957">testMultipartBody</span><span class="op" id="7435974">(</span><span class="ident" id="7435975">sep</span>&nbsp;<span class="builtintype" id="7435979">string</span><span class="op" id="7435985">)</span>&nbsp;<span class="builtintype" id="7435987">string</span>&nbsp;<span class="op" id="7435994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7435997">testBody</span>&nbsp;<span class="op" id="7436006">:=</span>&nbsp;<span class="string" id="7436009">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436366">testBody</span>&nbsp;<span class="op" id="7436375">=</span>&nbsp;<span class="ident" id="7436377">strings</span><span class="op" id="7436384">.</span><span class="ident" id="7436385">Replace</span><span class="op" id="7436392">(</span><span class="ident" id="7436393">testBody</span><span class="op" id="7436401">,</span>&nbsp;<span class="string" id="7436403">&#34;\n&#34;</span><span class="op" id="7436407">,</span>&nbsp;<span class="ident" id="7436409">sep</span><span class="op" id="7436412">,</span>&nbsp;<span class="op" id="7436414">-</span><span class="num" id="7436415">1</span><span class="op" id="7436416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7436419">return</span>&nbsp;<span class="ident" id="7436426">strings</span><span class="op" id="7436433">.</span><span class="ident" id="7436434">Replace</span><span class="op" id="7436441">(</span><span class="ident" id="7436442">testBody</span><span class="op" id="7436450">,</span>&nbsp;<span class="string" id="7436452">&#34;[longline]&#34;</span><span class="op" id="7436464">,</span>&nbsp;<span class="ident" id="7436466">longLine</span><span class="op" id="7436474">,</span>&nbsp;<span class="num" id="7436476">1</span><span class="op" id="7436477">)</span><br>
<span class="lineno">110</span><span class="op" id="7436479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436482">func</span>&nbsp;<span class="ident" id="7436487">TestMultipart</span><span class="op" id="7436500">(</span><span class="ident" id="7436501">t</span>&nbsp;<span class="op" id="7436503">*</span><span class="ident" id="7436504">testing</span><span class="op" id="7436511">.</span><span class="ident" id="7436512">T</span><span class="op" id="7436513">)</span>&nbsp;<span class="op" id="7436515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436518">bodyReader</span>&nbsp;<span class="op" id="7436529">:=</span>&nbsp;<span class="ident" id="7436532">strings</span><span class="op" id="7436539">.</span><span class="ident" id="7436540">NewReader</span><span class="op" id="7436549">(</span><span class="ident" id="7436550">testMultipartBody</span><span class="op" id="7436567">(</span><span class="string" id="7436568">&#34;\r\n&#34;</span><span class="op" id="7436574">)</span><span class="op" id="7436575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436578">testMultipart</span><span class="op" id="7436591">(</span><span class="ident" id="7436592">t</span><span class="op" id="7436593">,</span>&nbsp;<span class="ident" id="7436595">bodyReader</span><span class="op" id="7436605">,</span>&nbsp;<span class="builtintype" id="7436607">false</span><span class="op" id="7436612">)</span><br>
<span class="lineno">115</span><span class="op" id="7436614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436617">func</span>&nbsp;<span class="ident" id="7436622">TestMultipartOnlyNewlines</span><span class="op" id="7436647">(</span><span class="ident" id="7436648">t</span>&nbsp;<span class="op" id="7436650">*</span><span class="ident" id="7436651">testing</span><span class="op" id="7436658">.</span><span class="ident" id="7436659">T</span><span class="op" id="7436660">)</span>&nbsp;<span class="op" id="7436662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436665">bodyReader</span>&nbsp;<span class="op" id="7436676">:=</span>&nbsp;<span class="ident" id="7436679">strings</span><span class="op" id="7436686">.</span><span class="ident" id="7436687">NewReader</span><span class="op" id="7436696">(</span><span class="ident" id="7436697">testMultipartBody</span><span class="op" id="7436714">(</span><span class="string" id="7436715">&#34;\n&#34;</span><span class="op" id="7436719">)</span><span class="op" id="7436720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436723">testMultipart</span><span class="op" id="7436736">(</span><span class="ident" id="7436737">t</span><span class="op" id="7436738">,</span>&nbsp;<span class="ident" id="7436740">bodyReader</span><span class="op" id="7436750">,</span>&nbsp;<span class="builtintype" id="7436752">true</span><span class="op" id="7436756">)</span><br>
<span class="lineno">120</span><span class="op" id="7436758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436761">func</span>&nbsp;<span class="ident" id="7436766">TestMultipartSlowInput</span><span class="op" id="7436788">(</span><span class="ident" id="7436789">t</span>&nbsp;<span class="op" id="7436791">*</span><span class="ident" id="7436792">testing</span><span class="op" id="7436799">.</span><span class="ident" id="7436800">T</span><span class="op" id="7436801">)</span>&nbsp;<span class="op" id="7436803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436806">bodyReader</span>&nbsp;<span class="op" id="7436817">:=</span>&nbsp;<span class="ident" id="7436820">strings</span><span class="op" id="7436827">.</span><span class="ident" id="7436828">NewReader</span><span class="op" id="7436837">(</span><span class="ident" id="7436838">testMultipartBody</span><span class="op" id="7436855">(</span><span class="string" id="7436856">&#34;\r\n&#34;</span><span class="op" id="7436862">)</span><span class="op" id="7436863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436866">testMultipart</span><span class="op" id="7436879">(</span><span class="ident" id="7436880">t</span><span class="op" id="7436881">,</span>&nbsp;<span class="op" id="7436883">&amp;</span><span class="ident" id="7436884">slowReader</span><span class="op" id="7436894">{</span><span class="ident" id="7436895">bodyReader</span><span class="op" id="7436905">}</span><span class="op" id="7436906">,</span>&nbsp;<span class="builtintype" id="7436908">false</span><span class="op" id="7436913">)</span><br>
<span class="lineno">125</span><span class="op" id="7436915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436918">func</span>&nbsp;<span class="ident" id="7436923">testMultipart</span><span class="op" id="7436936">(</span><span class="ident" id="7436937">t</span>&nbsp;<span class="op" id="7436939">*</span><span class="ident" id="7436940">testing</span><span class="op" id="7436947">.</span><span class="ident" id="7436948">T</span><span class="op" id="7436949">,</span>&nbsp;<span class="ident" id="7436951">r</span>&nbsp;<span class="ident" id="7436953">io</span><span class="op" id="7436955">.</span><span class="ident" id="7436956">Reader</span><span class="op" id="7436962">,</span>&nbsp;<span class="ident" id="7436964">onlyNewlines</span>&nbsp;<span class="builtintype" id="7436977">bool</span><span class="op" id="7436981">)</span>&nbsp;<span class="op" id="7436983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7436986">reader</span>&nbsp;<span class="op" id="7436993">:=</span>&nbsp;<span class="ident" id="7436996">NewReader</span><span class="op" id="7437005">(</span><span class="ident" id="7437006">r</span><span class="op" id="7437007">,</span>&nbsp;<span class="string" id="7437009">&#34;MyBoundary&#34;</span><span class="op" id="7437021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437024">buf</span>&nbsp;<span class="op" id="7437028">:=</span>&nbsp;<span class="builtinfunc" id="7437031">new</span><span class="op" id="7437034">(</span><span class="ident" id="7437035">bytes</span><span class="op" id="7437040">.</span><span class="ident" id="7437041">Buffer</span><span class="op" id="7437047">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7437051">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437061">part</span><span class="op" id="7437065">,</span>&nbsp;<span class="ident" id="7437067">err</span>&nbsp;<span class="op" id="7437071">:=</span>&nbsp;<span class="ident" id="7437074">reader</span><span class="op" id="7437080">.</span><span class="ident" id="7437081">NextPart</span><span class="op" id="7437089">(</span><span class="op" id="7437090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437093">if</span>&nbsp;<span class="ident" id="7437096">part</span>&nbsp;<span class="op" id="7437101">==</span>&nbsp;<span class="ident" id="7437104">nil</span>&nbsp;<span class="op" id="7437108">||</span>&nbsp;<span class="ident" id="7437111">err</span>&nbsp;<span class="op" id="7437115">!=</span>&nbsp;<span class="ident" id="7437118">nil</span>&nbsp;<span class="op" id="7437122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437126">t</span><span class="op" id="7437127">.</span><span class="ident" id="7437128">Error</span><span class="op" id="7437133">(</span><span class="string" id="7437134">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="7437150">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437165">if</span>&nbsp;<span class="ident" id="7437168">x</span>&nbsp;<span class="op" id="7437170">:=</span>&nbsp;<span class="ident" id="7437173">part</span><span class="op" id="7437177">.</span><span class="ident" id="7437178">Header</span><span class="op" id="7437184">.</span><span class="ident" id="7437185">Get</span><span class="op" id="7437188">(</span><span class="string" id="7437189">&#34;Header1&#34;</span><span class="op" id="7437198">)</span><span class="op" id="7437199">;</span>&nbsp;<span class="ident" id="7437201">x</span>&nbsp;<span class="op" id="7437203">!=</span>&nbsp;<span class="string" id="7437206">&#34;value1&#34;</span>&nbsp;<span class="op" id="7437215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437219">t</span><span class="op" id="7437220">.</span><span class="ident" id="7437221">Errorf</span><span class="op" id="7437227">(</span><span class="string" id="7437228">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7437263">,</span>&nbsp;<span class="string" id="7437265">&#34;Header1&#34;</span><span class="op" id="7437274">,</span>&nbsp;<span class="ident" id="7437276">x</span><span class="op" id="7437277">,</span>&nbsp;<span class="string" id="7437279">&#34;value1&#34;</span><span class="op" id="7437287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437290">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437293">if</span>&nbsp;<span class="ident" id="7437296">x</span>&nbsp;<span class="op" id="7437298">:=</span>&nbsp;<span class="ident" id="7437301">part</span><span class="op" id="7437305">.</span><span class="ident" id="7437306">Header</span><span class="op" id="7437312">.</span><span class="ident" id="7437313">Get</span><span class="op" id="7437316">(</span><span class="string" id="7437317">&#34;foo-bar&#34;</span><span class="op" id="7437326">)</span><span class="op" id="7437327">;</span>&nbsp;<span class="ident" id="7437329">x</span>&nbsp;<span class="op" id="7437331">!=</span>&nbsp;<span class="string" id="7437334">&#34;baz&#34;</span>&nbsp;<span class="op" id="7437340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437344">t</span><span class="op" id="7437345">.</span><span class="ident" id="7437346">Errorf</span><span class="op" id="7437352">(</span><span class="string" id="7437353">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7437388">,</span>&nbsp;<span class="string" id="7437390">&#34;foo-bar&#34;</span><span class="op" id="7437399">,</span>&nbsp;<span class="ident" id="7437401">x</span><span class="op" id="7437402">,</span>&nbsp;<span class="string" id="7437404">&#34;baz&#34;</span><span class="op" id="7437409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437415">if</span>&nbsp;<span class="ident" id="7437418">x</span>&nbsp;<span class="op" id="7437420">:=</span>&nbsp;<span class="ident" id="7437423">part</span><span class="op" id="7437427">.</span><span class="ident" id="7437428">Header</span><span class="op" id="7437434">.</span><span class="ident" id="7437435">Get</span><span class="op" id="7437438">(</span><span class="string" id="7437439">&#34;Foo-Bar&#34;</span><span class="op" id="7437448">)</span><span class="op" id="7437449">;</span>&nbsp;<span class="ident" id="7437451">x</span>&nbsp;<span class="op" id="7437453">!=</span>&nbsp;<span class="string" id="7437456">&#34;baz&#34;</span>&nbsp;<span class="op" id="7437462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437466">t</span><span class="op" id="7437467">.</span><span class="ident" id="7437468">Errorf</span><span class="op" id="7437474">(</span><span class="string" id="7437475">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7437510">,</span>&nbsp;<span class="string" id="7437512">&#34;Foo-Bar&#34;</span><span class="op" id="7437521">,</span>&nbsp;<span class="ident" id="7437523">x</span><span class="op" id="7437524">,</span>&nbsp;<span class="string" id="7437526">&#34;baz&#34;</span><span class="op" id="7437531">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437537">buf</span><span class="op" id="7437540">.</span><span class="ident" id="7437541">Reset</span><span class="op" id="7437546">(</span><span class="op" id="7437547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437550">if</span>&nbsp;<span class="ident" id="7437553">_</span><span class="op" id="7437554">,</span>&nbsp;<span class="ident" id="7437556">err</span>&nbsp;<span class="op" id="7437560">:=</span>&nbsp;<span class="ident" id="7437563">io</span><span class="op" id="7437565">.</span><span class="ident" id="7437566">Copy</span><span class="op" id="7437570">(</span><span class="ident" id="7437571">buf</span><span class="op" id="7437574">,</span>&nbsp;<span class="ident" id="7437576">part</span><span class="op" id="7437580">)</span><span class="op" id="7437581">;</span>&nbsp;<span class="ident" id="7437583">err</span>&nbsp;<span class="op" id="7437587">!=</span>&nbsp;<span class="ident" id="7437590">nil</span>&nbsp;<span class="op" id="7437594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437598">t</span><span class="op" id="7437599">.</span><span class="ident" id="7437600">Errorf</span><span class="op" id="7437606">(</span><span class="string" id="7437607">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7437624">,</span>&nbsp;<span class="ident" id="7437626">err</span><span class="op" id="7437629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437632">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437636">adjustNewlines</span>&nbsp;<span class="op" id="7437651">:=</span>&nbsp;<span class="keyword" id="7437654">func</span><span class="op" id="7437658">(</span><span class="ident" id="7437659">s</span>&nbsp;<span class="builtintype" id="7437661">string</span><span class="op" id="7437667">)</span>&nbsp;<span class="builtintype" id="7437669">string</span>&nbsp;<span class="op" id="7437676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437680">if</span>&nbsp;<span class="ident" id="7437683">onlyNewlines</span>&nbsp;<span class="op" id="7437696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437701">return</span>&nbsp;<span class="ident" id="7437708">strings</span><span class="op" id="7437715">.</span><span class="ident" id="7437716">Replace</span><span class="op" id="7437723">(</span><span class="ident" id="7437724">s</span><span class="op" id="7437725">,</span>&nbsp;<span class="string" id="7437727">&#34;\r\n&#34;</span><span class="op" id="7437733">,</span>&nbsp;<span class="string" id="7437735">&#34;\n&#34;</span><span class="op" id="7437739">,</span>&nbsp;<span class="op" id="7437741">-</span><span class="num" id="7437742">1</span><span class="op" id="7437743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437747">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437751">return</span>&nbsp;<span class="ident" id="7437758">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437765">expectEq</span><span class="op" id="7437773">(</span><span class="ident" id="7437774">t</span><span class="op" id="7437775">,</span>&nbsp;<span class="ident" id="7437777">adjustNewlines</span><span class="op" id="7437791">(</span><span class="string" id="7437792">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="7437814">)</span><span class="op" id="7437815">,</span>&nbsp;<span class="ident" id="7437817">buf</span><span class="op" id="7437820">.</span><span class="ident" id="7437821">String</span><span class="op" id="7437827">(</span><span class="op" id="7437828">)</span><span class="op" id="7437829">,</span>&nbsp;<span class="string" id="7437831">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="7437852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7437856">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437866">part</span><span class="op" id="7437870">,</span>&nbsp;<span class="ident" id="7437872">err</span>&nbsp;<span class="op" id="7437876">=</span>&nbsp;<span class="ident" id="7437878">reader</span><span class="op" id="7437884">.</span><span class="ident" id="7437885">NextPart</span><span class="op" id="7437893">(</span><span class="op" id="7437894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437897">if</span>&nbsp;<span class="ident" id="7437900">err</span>&nbsp;<span class="op" id="7437904">!=</span>&nbsp;<span class="ident" id="7437907">nil</span>&nbsp;<span class="op" id="7437911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7437915">t</span><span class="op" id="7437916">.</span><span class="ident" id="7437917">Fatalf</span><span class="op" id="7437923">(</span><span class="string" id="7437924">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7437949">,</span>&nbsp;<span class="ident" id="7437951">err</span><span class="op" id="7437954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437958">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7437966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7437969">if</span>&nbsp;<span class="ident" id="7437972">e</span><span class="op" id="7437973">,</span>&nbsp;<span class="ident" id="7437975">g</span>&nbsp;<span class="op" id="7437977">:=</span>&nbsp;<span class="string" id="7437980">&#34;bigsection&#34;</span><span class="op" id="7437992">,</span>&nbsp;<span class="ident" id="7437994">part</span><span class="op" id="7437998">.</span><span class="ident" id="7437999">Header</span><span class="op" id="7438005">.</span><span class="ident" id="7438006">Get</span><span class="op" id="7438009">(</span><span class="string" id="7438010">&#34;name&#34;</span><span class="op" id="7438016">)</span><span class="op" id="7438017">;</span>&nbsp;<span class="ident" id="7438019">e</span>&nbsp;<span class="op" id="7438021">!=</span>&nbsp;<span class="ident" id="7438024">g</span>&nbsp;<span class="op" id="7438026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438030">t</span><span class="op" id="7438031">.</span><span class="ident" id="7438032">Errorf</span><span class="op" id="7438038">(</span><span class="string" id="7438039">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7438081">,</span>&nbsp;<span class="ident" id="7438083">e</span><span class="op" id="7438084">,</span>&nbsp;<span class="ident" id="7438086">g</span><span class="op" id="7438087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438093">buf</span><span class="op" id="7438096">.</span><span class="ident" id="7438097">Reset</span><span class="op" id="7438102">(</span><span class="op" id="7438103">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438106">if</span>&nbsp;<span class="ident" id="7438109">_</span><span class="op" id="7438110">,</span>&nbsp;<span class="ident" id="7438112">err</span>&nbsp;<span class="op" id="7438116">:=</span>&nbsp;<span class="ident" id="7438119">io</span><span class="op" id="7438121">.</span><span class="ident" id="7438122">Copy</span><span class="op" id="7438126">(</span><span class="ident" id="7438127">buf</span><span class="op" id="7438130">,</span>&nbsp;<span class="ident" id="7438132">part</span><span class="op" id="7438136">)</span><span class="op" id="7438137">;</span>&nbsp;<span class="ident" id="7438139">err</span>&nbsp;<span class="op" id="7438143">!=</span>&nbsp;<span class="ident" id="7438146">nil</span>&nbsp;<span class="op" id="7438150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438154">t</span><span class="op" id="7438155">.</span><span class="ident" id="7438156">Errorf</span><span class="op" id="7438162">(</span><span class="string" id="7438163">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7438180">,</span>&nbsp;<span class="ident" id="7438182">err</span><span class="op" id="7438185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438191">s</span>&nbsp;<span class="op" id="7438193">:=</span>&nbsp;<span class="ident" id="7438196">buf</span><span class="op" id="7438199">.</span><span class="ident" id="7438200">String</span><span class="op" id="7438206">(</span><span class="op" id="7438207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438210">if</span>&nbsp;<span class="builtinfunc" id="7438213">len</span><span class="op" id="7438216">(</span><span class="ident" id="7438217">s</span><span class="op" id="7438218">)</span>&nbsp;<span class="op" id="7438220">!=</span>&nbsp;<span class="builtinfunc" id="7438223">len</span><span class="op" id="7438226">(</span><span class="ident" id="7438227">longLine</span><span class="op" id="7438235">)</span>&nbsp;<span class="op" id="7438237">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438241">t</span><span class="op" id="7438242">.</span><span class="ident" id="7438243">Errorf</span><span class="op" id="7438249">(</span><span class="string" id="7438250">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="7438309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7438314">len</span><span class="op" id="7438317">(</span><span class="ident" id="7438318">longLine</span><span class="op" id="7438326">)</span><span class="op" id="7438327">,</span>&nbsp;<span class="builtinfunc" id="7438329">len</span><span class="op" id="7438332">(</span><span class="ident" id="7438333">s</span><span class="op" id="7438334">)</span><span class="op" id="7438335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438341">if</span>&nbsp;<span class="ident" id="7438344">s</span>&nbsp;<span class="op" id="7438346">!=</span>&nbsp;<span class="ident" id="7438349">longLine</span>&nbsp;<span class="op" id="7438358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438362">t</span><span class="op" id="7438363">.</span><span class="ident" id="7438364">Errorf</span><span class="op" id="7438370">(</span><span class="string" id="7438371">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="7438401">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7438408">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438418">part</span><span class="op" id="7438422">,</span>&nbsp;<span class="ident" id="7438424">err</span>&nbsp;<span class="op" id="7438428">=</span>&nbsp;<span class="ident" id="7438430">reader</span><span class="op" id="7438436">.</span><span class="ident" id="7438437">NextPart</span><span class="op" id="7438445">(</span><span class="op" id="7438446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438449">if</span>&nbsp;<span class="ident" id="7438452">part</span>&nbsp;<span class="op" id="7438457">==</span>&nbsp;<span class="ident" id="7438460">nil</span>&nbsp;<span class="op" id="7438464">||</span>&nbsp;<span class="ident" id="7438467">err</span>&nbsp;<span class="op" id="7438471">!=</span>&nbsp;<span class="ident" id="7438474">nil</span>&nbsp;<span class="op" id="7438478">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438482">t</span><span class="op" id="7438483">.</span><span class="ident" id="7438484">Error</span><span class="op" id="7438489">(</span><span class="string" id="7438490">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="7438506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438510">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438521">if</span>&nbsp;<span class="ident" id="7438524">part</span><span class="op" id="7438528">.</span><span class="ident" id="7438529">Header</span><span class="op" id="7438535">.</span><span class="ident" id="7438536">Get</span><span class="op" id="7438539">(</span><span class="string" id="7438540">&#34;foo-bar&#34;</span><span class="op" id="7438549">)</span>&nbsp;<span class="op" id="7438551">!=</span>&nbsp;<span class="string" id="7438554">&#34;bazb&#34;</span>&nbsp;<span class="op" id="7438561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438565">t</span><span class="op" id="7438566">.</span><span class="ident" id="7438567">Error</span><span class="op" id="7438572">(</span><span class="string" id="7438573">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="7438597">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438603">buf</span><span class="op" id="7438606">.</span><span class="ident" id="7438607">Reset</span><span class="op" id="7438612">(</span><span class="op" id="7438613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438616">if</span>&nbsp;<span class="ident" id="7438619">_</span><span class="op" id="7438620">,</span>&nbsp;<span class="ident" id="7438622">err</span>&nbsp;<span class="op" id="7438626">:=</span>&nbsp;<span class="ident" id="7438629">io</span><span class="op" id="7438631">.</span><span class="ident" id="7438632">Copy</span><span class="op" id="7438636">(</span><span class="ident" id="7438637">buf</span><span class="op" id="7438640">,</span>&nbsp;<span class="ident" id="7438642">part</span><span class="op" id="7438646">)</span><span class="op" id="7438647">;</span>&nbsp;<span class="ident" id="7438649">err</span>&nbsp;<span class="op" id="7438653">!=</span>&nbsp;<span class="ident" id="7438656">nil</span>&nbsp;<span class="op" id="7438660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438664">t</span><span class="op" id="7438665">.</span><span class="ident" id="7438666">Errorf</span><span class="op" id="7438672">(</span><span class="string" id="7438673">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7438690">,</span>&nbsp;<span class="ident" id="7438692">err</span><span class="op" id="7438695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438698">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438701">expectEq</span><span class="op" id="7438709">(</span><span class="ident" id="7438710">t</span><span class="op" id="7438711">,</span>&nbsp;<span class="ident" id="7438713">adjustNewlines</span><span class="op" id="7438727">(</span><span class="string" id="7438728">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="7438793">)</span><span class="op" id="7438794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438798">buf</span><span class="op" id="7438801">.</span><span class="ident" id="7438802">String</span><span class="op" id="7438808">(</span><span class="op" id="7438809">)</span><span class="op" id="7438810">,</span>&nbsp;<span class="string" id="7438812">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="7438828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7438832">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438842">part</span><span class="op" id="7438846">,</span>&nbsp;<span class="ident" id="7438848">err</span>&nbsp;<span class="op" id="7438852">=</span>&nbsp;<span class="ident" id="7438854">reader</span><span class="op" id="7438860">.</span><span class="ident" id="7438861">NextPart</span><span class="op" id="7438869">(</span><span class="op" id="7438870">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438873">if</span>&nbsp;<span class="ident" id="7438876">part</span>&nbsp;<span class="op" id="7438881">==</span>&nbsp;<span class="ident" id="7438884">nil</span>&nbsp;<span class="op" id="7438888">||</span>&nbsp;<span class="ident" id="7438891">err</span>&nbsp;<span class="op" id="7438895">!=</span>&nbsp;<span class="ident" id="7438898">nil</span>&nbsp;<span class="op" id="7438902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438906">t</span><span class="op" id="7438907">.</span><span class="ident" id="7438908">Error</span><span class="op" id="7438913">(</span><span class="string" id="7438914">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="7438946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7438950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7438958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7438962">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7438985">part</span><span class="op" id="7438989">,</span>&nbsp;<span class="ident" id="7438991">err</span>&nbsp;<span class="op" id="7438995">=</span>&nbsp;<span class="ident" id="7438997">reader</span><span class="op" id="7439003">.</span><span class="ident" id="7439004">NextPart</span><span class="op" id="7439012">(</span><span class="op" id="7439013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439016">if</span>&nbsp;<span class="ident" id="7439019">part</span>&nbsp;<span class="op" id="7439024">!=</span>&nbsp;<span class="ident" id="7439027">nil</span>&nbsp;<span class="op" id="7439031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439035">t</span><span class="op" id="7439036">.</span><span class="ident" id="7439037">Error</span><span class="op" id="7439042">(</span><span class="string" id="7439043">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="7439072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7439075">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439078">if</span>&nbsp;<span class="ident" id="7439081">err</span>&nbsp;<span class="op" id="7439085">!=</span>&nbsp;<span class="ident" id="7439088">io</span><span class="op" id="7439090">.</span><span class="ident" id="7439091">EOF</span>&nbsp;<span class="op" id="7439095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439099">t</span><span class="op" id="7439100">.</span><span class="ident" id="7439101">Errorf</span><span class="op" id="7439107">(</span><span class="string" id="7439108">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7439147">,</span>&nbsp;<span class="ident" id="7439149">err</span><span class="op" id="7439152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7439155">}</span><br>
<span class="lineno"></span><span class="op" id="7439157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7439160">func</span>&nbsp;<span class="ident" id="7439165">TestVariousTextLineEndings</span><span class="op" id="7439191">(</span><span class="ident" id="7439192">t</span>&nbsp;<span class="op" id="7439194">*</span><span class="ident" id="7439195">testing</span><span class="op" id="7439202">.</span><span class="ident" id="7439203">T</span><span class="op" id="7439204">)</span>&nbsp;<span class="op" id="7439206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439209">tests</span>&nbsp;<span class="op" id="7439215">:=</span>&nbsp;<span class="op" id="7439218">[</span><span class="op" id="7439219">...</span><span class="op" id="7439222">]</span><span class="builtintype" id="7439223">string</span><span class="op" id="7439229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439233">&#34;Foo\nBar&#34;</span><span class="op" id="7439243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439247">&#34;Foo\nBar\n&#34;</span><span class="op" id="7439259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439263">&#34;Foo\r\nBar&#34;</span><span class="op" id="7439275">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439279">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="7439295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439299">&#34;Foo\rBar&#34;</span><span class="op" id="7439309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439313">&#34;Foo\rBar\r&#34;</span><span class="op" id="7439325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439329">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="7439375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7439378">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439382">for</span>&nbsp;<span class="ident" id="7439386">testNum</span><span class="op" id="7439393">,</span>&nbsp;<span class="ident" id="7439395">expectedBody</span>&nbsp;<span class="op" id="7439408">:=</span>&nbsp;<span class="keyword" id="7439411">range</span>&nbsp;<span class="ident" id="7439417">tests</span>&nbsp;<span class="op" id="7439423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439427">body</span>&nbsp;<span class="op" id="7439432">:=</span>&nbsp;<span class="string" id="7439435">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="7439452">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439457">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7439510">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439515">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7439522">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439527">expectedBody</span>&nbsp;<span class="op" id="7439540">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7439545">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439570">bodyReader</span>&nbsp;<span class="op" id="7439581">:=</span>&nbsp;<span class="ident" id="7439584">strings</span><span class="op" id="7439591">.</span><span class="ident" id="7439592">NewReader</span><span class="op" id="7439601">(</span><span class="ident" id="7439602">body</span><span class="op" id="7439606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439611">reader</span>&nbsp;<span class="op" id="7439618">:=</span>&nbsp;<span class="ident" id="7439621">NewReader</span><span class="op" id="7439630">(</span><span class="ident" id="7439631">bodyReader</span><span class="op" id="7439641">,</span>&nbsp;<span class="string" id="7439643">&#34;BOUNDARY&#34;</span><span class="op" id="7439653">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439657">buf</span>&nbsp;<span class="op" id="7439661">:=</span>&nbsp;<span class="builtinfunc" id="7439664">new</span><span class="op" id="7439667">(</span><span class="ident" id="7439668">bytes</span><span class="op" id="7439673">.</span><span class="ident" id="7439674">Buffer</span><span class="op" id="7439680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439684">part</span><span class="op" id="7439688">,</span>&nbsp;<span class="ident" id="7439690">err</span>&nbsp;<span class="op" id="7439694">:=</span>&nbsp;<span class="ident" id="7439697">reader</span><span class="op" id="7439703">.</span><span class="ident" id="7439704">NextPart</span><span class="op" id="7439712">(</span><span class="op" id="7439713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439717">if</span>&nbsp;<span class="ident" id="7439720">part</span>&nbsp;<span class="op" id="7439725">==</span>&nbsp;<span class="ident" id="7439728">nil</span>&nbsp;<span class="op" id="7439732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439737">t</span><span class="op" id="7439738">.</span><span class="ident" id="7439739">Errorf</span><span class="op" id="7439745">(</span><span class="string" id="7439746">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="7439779">,</span>&nbsp;<span class="ident" id="7439781">testNum</span><span class="op" id="7439788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439793">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7439804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439808">if</span>&nbsp;<span class="ident" id="7439811">err</span>&nbsp;<span class="op" id="7439815">!=</span>&nbsp;<span class="ident" id="7439818">nil</span>&nbsp;<span class="op" id="7439822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439827">t</span><span class="op" id="7439828">.</span><span class="ident" id="7439829">Errorf</span><span class="op" id="7439835">(</span><span class="string" id="7439836">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7439869">,</span>&nbsp;<span class="ident" id="7439871">testNum</span><span class="op" id="7439878">,</span>&nbsp;<span class="ident" id="7439880">err</span><span class="op" id="7439883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7439888">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7439899">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439903">written</span><span class="op" id="7439910">,</span>&nbsp;<span class="ident" id="7439912">err</span>&nbsp;<span class="op" id="7439916">:=</span>&nbsp;<span class="ident" id="7439919">io</span><span class="op" id="7439921">.</span><span class="ident" id="7439922">Copy</span><span class="op" id="7439926">(</span><span class="ident" id="7439927">buf</span><span class="op" id="7439930">,</span>&nbsp;<span class="ident" id="7439932">part</span><span class="op" id="7439936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7439940">expectEq</span><span class="op" id="7439948">(</span><span class="ident" id="7439949">t</span><span class="op" id="7439950">,</span>&nbsp;<span class="ident" id="7439952">expectedBody</span><span class="op" id="7439964">,</span>&nbsp;<span class="ident" id="7439966">buf</span><span class="op" id="7439969">.</span><span class="ident" id="7439970">String</span><span class="op" id="7439976">(</span><span class="op" id="7439977">)</span><span class="op" id="7439978">,</span>&nbsp;<span class="ident" id="7439980">fmt</span><span class="op" id="7439983">.</span><span class="ident" id="7439984">Sprintf</span><span class="op" id="7439991">(</span><span class="string" id="7439992">&#34;test&nbsp;%d&#34;</span><span class="op" id="7440001">,</span>&nbsp;<span class="ident" id="7440003">testNum</span><span class="op" id="7440010">)</span><span class="op" id="7440011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440015">if</span>&nbsp;<span class="ident" id="7440018">err</span>&nbsp;<span class="op" id="7440022">!=</span>&nbsp;<span class="ident" id="7440025">nil</span>&nbsp;<span class="op" id="7440029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440034">t</span><span class="op" id="7440035">.</span><span class="ident" id="7440036">Errorf</span><span class="op" id="7440042">(</span><span class="string" id="7440043">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="7440088">,</span>&nbsp;<span class="ident" id="7440090">written</span><span class="op" id="7440097">,</span>&nbsp;<span class="ident" id="7440099">err</span><span class="op" id="7440102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440106">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440111">part</span><span class="op" id="7440115">,</span>&nbsp;<span class="ident" id="7440117">err</span>&nbsp;<span class="op" id="7440121">=</span>&nbsp;<span class="ident" id="7440123">reader</span><span class="op" id="7440129">.</span><span class="ident" id="7440130">NextPart</span><span class="op" id="7440138">(</span><span class="op" id="7440139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440143">if</span>&nbsp;<span class="ident" id="7440146">part</span>&nbsp;<span class="op" id="7440151">!=</span>&nbsp;<span class="ident" id="7440154">nil</span>&nbsp;<span class="op" id="7440158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440163">t</span><span class="op" id="7440164">.</span><span class="ident" id="7440165">Errorf</span><span class="op" id="7440171">(</span><span class="string" id="7440172">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="7440200">,</span>&nbsp;<span class="ident" id="7440202">testNum</span><span class="op" id="7440209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440213">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440217">if</span>&nbsp;<span class="ident" id="7440220">err</span>&nbsp;<span class="op" id="7440224">!=</span>&nbsp;<span class="ident" id="7440227">io</span><span class="op" id="7440229">.</span><span class="ident" id="7440230">EOF</span>&nbsp;<span class="op" id="7440234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440239">t</span><span class="op" id="7440240">.</span><span class="ident" id="7440241">Errorf</span><span class="op" id="7440247">(</span><span class="string" id="7440248">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7440284">,</span>&nbsp;<span class="ident" id="7440286">testNum</span><span class="op" id="7440293">,</span>&nbsp;<span class="ident" id="7440295">err</span><span class="op" id="7440298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440306">}</span><br>
<span class="lineno">260</span><span class="op" id="7440308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440311">type</span>&nbsp;<span class="ident" id="7440316">maliciousReader</span>&nbsp;<span class="keyword" id="7440332">struct</span>&nbsp;<span class="op" id="7440339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440342">t</span>&nbsp;<span class="op" id="7440344">*</span><span class="ident" id="7440345">testing</span><span class="op" id="7440352">.</span><span class="ident" id="7440353">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440356">n</span>&nbsp;<span class="builtintype" id="7440358">int</span><br>
<span class="lineno">265</span><span class="op" id="7440362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440365">const</span>&nbsp;<span class="ident" id="7440371">maxReadThreshold</span>&nbsp;<span class="op" id="7440388">=</span>&nbsp;<span class="num" id="7440390">1</span>&nbsp;<span class="op" id="7440392">&lt;&lt;</span>&nbsp;<span class="num" id="7440395">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440399">func</span>&nbsp;<span class="op" id="7440404">(</span><span class="ident" id="7440405">mr</span>&nbsp;<span class="op" id="7440408">*</span><span class="ident" id="7440409">maliciousReader</span><span class="op" id="7440424">)</span>&nbsp;<span class="ident" id="7440426">Read</span><span class="op" id="7440430">(</span><span class="ident" id="7440431">b</span>&nbsp;<span class="op" id="7440433">[</span><span class="op" id="7440434">]</span><span class="builtintype" id="7440435">byte</span><span class="op" id="7440439">)</span>&nbsp;<span class="op" id="7440441">(</span><span class="ident" id="7440442">n</span>&nbsp;<span class="builtintype" id="7440444">int</span><span class="op" id="7440447">,</span>&nbsp;<span class="ident" id="7440449">err</span>&nbsp;<span class="builtintype" id="7440453">error</span><span class="op" id="7440458">)</span>&nbsp;<span class="op" id="7440460">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440463">mr</span><span class="op" id="7440465">.</span><span class="ident" id="7440466">n</span>&nbsp;<span class="op" id="7440468">+=</span>&nbsp;<span class="builtinfunc" id="7440471">len</span><span class="op" id="7440474">(</span><span class="ident" id="7440475">b</span><span class="op" id="7440476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440479">if</span>&nbsp;<span class="ident" id="7440482">mr</span><span class="op" id="7440484">.</span><span class="ident" id="7440485">n</span>&nbsp;<span class="op" id="7440487">&gt;=</span>&nbsp;<span class="ident" id="7440490">maxReadThreshold</span>&nbsp;<span class="op" id="7440507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440511">mr</span><span class="op" id="7440513">.</span><span class="ident" id="7440514">t</span><span class="op" id="7440515">.</span><span class="ident" id="7440516">Fatal</span><span class="op" id="7440521">(</span><span class="string" id="7440522">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="7440541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440545">return</span>&nbsp;<span class="num" id="7440552">0</span><span class="op" id="7440553">,</span>&nbsp;<span class="ident" id="7440555">io</span><span class="op" id="7440557">.</span><span class="ident" id="7440558">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440563">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440566">return</span>&nbsp;<span class="builtinfunc" id="7440573">len</span><span class="op" id="7440576">(</span><span class="ident" id="7440577">b</span><span class="op" id="7440578">)</span><span class="op" id="7440579">,</span>&nbsp;<span class="ident" id="7440581">nil</span><br>
<span class="lineno"></span><span class="op" id="7440585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440588">func</span>&nbsp;<span class="ident" id="7440593">TestLineLimit</span><span class="op" id="7440606">(</span><span class="ident" id="7440607">t</span>&nbsp;<span class="op" id="7440609">*</span><span class="ident" id="7440610">testing</span><span class="op" id="7440617">.</span><span class="ident" id="7440618">T</span><span class="op" id="7440619">)</span>&nbsp;<span class="op" id="7440621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440624">mr</span>&nbsp;<span class="op" id="7440627">:=</span>&nbsp;<span class="op" id="7440630">&amp;</span><span class="ident" id="7440631">maliciousReader</span><span class="op" id="7440646">{</span><span class="ident" id="7440647">t</span><span class="op" id="7440648">:</span>&nbsp;<span class="ident" id="7440650">t</span><span class="op" id="7440651">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440654">r</span>&nbsp;<span class="op" id="7440656">:=</span>&nbsp;<span class="ident" id="7440659">NewReader</span><span class="op" id="7440668">(</span><span class="ident" id="7440669">mr</span><span class="op" id="7440671">,</span>&nbsp;<span class="string" id="7440673">&#34;fooBoundary&#34;</span><span class="op" id="7440686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440689">part</span><span class="op" id="7440693">,</span>&nbsp;<span class="ident" id="7440695">err</span>&nbsp;<span class="op" id="7440699">:=</span>&nbsp;<span class="ident" id="7440702">r</span><span class="op" id="7440703">.</span><span class="ident" id="7440704">NextPart</span><span class="op" id="7440712">(</span><span class="op" id="7440713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440716">if</span>&nbsp;<span class="ident" id="7440719">part</span>&nbsp;<span class="op" id="7440724">!=</span>&nbsp;<span class="ident" id="7440727">nil</span>&nbsp;<span class="op" id="7440731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440735">t</span><span class="op" id="7440736">.</span><span class="ident" id="7440737">Errorf</span><span class="op" id="7440743">(</span><span class="string" id="7440744">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="7440766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440769">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440772">if</span>&nbsp;<span class="ident" id="7440775">err</span>&nbsp;<span class="op" id="7440779">==</span>&nbsp;<span class="ident" id="7440782">nil</span>&nbsp;<span class="op" id="7440786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440790">t</span><span class="op" id="7440791">.</span><span class="ident" id="7440792">Errorf</span><span class="op" id="7440798">(</span><span class="string" id="7440799">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="7440818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7440824">if</span>&nbsp;<span class="ident" id="7440827">mr</span><span class="op" id="7440829">.</span><span class="ident" id="7440830">n</span>&nbsp;<span class="op" id="7440832">&gt;=</span>&nbsp;<span class="ident" id="7440835">maxReadThreshold</span>&nbsp;<span class="op" id="7440852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440856">t</span><span class="op" id="7440857">.</span><span class="ident" id="7440858">Errorf</span><span class="op" id="7440864">(</span><span class="string" id="7440865">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7440903">,</span>&nbsp;<span class="ident" id="7440905">maxReadThreshold</span><span class="op" id="7440921">,</span>&nbsp;<span class="ident" id="7440923">mr</span><span class="op" id="7440925">.</span><span class="ident" id="7440926">n</span><span class="op" id="7440927">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7440930">}</span><br>
<span class="lineno"></span><span class="op" id="7440932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440935">func</span>&nbsp;<span class="ident" id="7440940">TestMultipartTruncated</span><span class="op" id="7440962">(</span><span class="ident" id="7440963">t</span>&nbsp;<span class="op" id="7440965">*</span><span class="ident" id="7440966">testing</span><span class="op" id="7440973">.</span><span class="ident" id="7440974">T</span><span class="op" id="7440975">)</span>&nbsp;<span class="op" id="7440977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7440980">testBody</span>&nbsp;<span class="op" id="7440989">:=</span>&nbsp;<span class="string" id="7440992">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441099">body</span>&nbsp;<span class="op" id="7441104">:=</span>&nbsp;<span class="ident" id="7441107">strings</span><span class="op" id="7441114">.</span><span class="ident" id="7441115">Replace</span><span class="op" id="7441122">(</span><span class="ident" id="7441123">testBody</span><span class="op" id="7441131">,</span>&nbsp;<span class="string" id="7441133">&#34;\n&#34;</span><span class="op" id="7441137">,</span>&nbsp;<span class="string" id="7441139">&#34;\r\n&#34;</span><span class="op" id="7441145">,</span>&nbsp;<span class="op" id="7441147">-</span><span class="num" id="7441148">1</span><span class="op" id="7441149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441152">bodyReader</span>&nbsp;<span class="op" id="7441163">:=</span>&nbsp;<span class="ident" id="7441166">strings</span><span class="op" id="7441173">.</span><span class="ident" id="7441174">NewReader</span><span class="op" id="7441183">(</span><span class="ident" id="7441184">body</span><span class="op" id="7441188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441191">r</span>&nbsp;<span class="op" id="7441193">:=</span>&nbsp;<span class="ident" id="7441196">NewReader</span><span class="op" id="7441205">(</span><span class="ident" id="7441206">bodyReader</span><span class="op" id="7441216">,</span>&nbsp;<span class="string" id="7441218">&#34;MyBoundary&#34;</span><span class="op" id="7441230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441234">part</span><span class="op" id="7441238">,</span>&nbsp;<span class="ident" id="7441240">err</span>&nbsp;<span class="op" id="7441244">:=</span>&nbsp;<span class="ident" id="7441247">r</span><span class="op" id="7441248">.</span><span class="ident" id="7441249">NextPart</span><span class="op" id="7441257">(</span><span class="op" id="7441258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7441261">if</span>&nbsp;<span class="ident" id="7441264">err</span>&nbsp;<span class="op" id="7441268">!=</span>&nbsp;<span class="ident" id="7441271">nil</span>&nbsp;<span class="op" id="7441275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441279">t</span><span class="op" id="7441280">.</span><span class="ident" id="7441281">Fatalf</span><span class="op" id="7441287">(</span><span class="string" id="7441288">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7441307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7441310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441313">_</span><span class="op" id="7441314">,</span>&nbsp;<span class="ident" id="7441316">err</span>&nbsp;<span class="op" id="7441320">=</span>&nbsp;<span class="ident" id="7441322">io</span><span class="op" id="7441324">.</span><span class="ident" id="7441325">Copy</span><span class="op" id="7441329">(</span><span class="ident" id="7441330">ioutil</span><span class="op" id="7441336">.</span><span class="ident" id="7441337">Discard</span><span class="op" id="7441344">,</span>&nbsp;<span class="ident" id="7441346">part</span><span class="op" id="7441350">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7441353">if</span>&nbsp;<span class="ident" id="7441356">err</span>&nbsp;<span class="op" id="7441360">!=</span>&nbsp;<span class="ident" id="7441363">io</span><span class="op" id="7441365">.</span><span class="ident" id="7441366">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7441383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441387">t</span><span class="op" id="7441388">.</span><span class="ident" id="7441389">Fatalf</span><span class="op" id="7441395">(</span><span class="string" id="7441396">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7441440">,</span>&nbsp;<span class="ident" id="7441442">err</span><span class="op" id="7441445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7441448">}</span><br>
<span class="lineno"></span><span class="op" id="7441450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7441453">type</span>&nbsp;<span class="ident" id="7441458">slowReader</span>&nbsp;<span class="keyword" id="7441469">struct</span>&nbsp;<span class="op" id="7441476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441479">r</span>&nbsp;<span class="ident" id="7441481">io</span><span class="op" id="7441483">.</span><span class="ident" id="7441484">Reader</span><br>
<span class="lineno"></span><span class="op" id="7441491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7441494">func</span>&nbsp;<span class="op" id="7441499">(</span><span class="ident" id="7441500">s</span>&nbsp;<span class="op" id="7441502">*</span><span class="ident" id="7441503">slowReader</span><span class="op" id="7441513">)</span>&nbsp;<span class="ident" id="7441515">Read</span><span class="op" id="7441519">(</span><span class="ident" id="7441520">p</span>&nbsp;<span class="op" id="7441522">[</span><span class="op" id="7441523">]</span><span class="builtintype" id="7441524">byte</span><span class="op" id="7441528">)</span>&nbsp;<span class="op" id="7441530">(</span><span class="builtintype" id="7441531">int</span><span class="op" id="7441534">,</span>&nbsp;<span class="builtintype" id="7441536">error</span><span class="op" id="7441541">)</span>&nbsp;<span class="op" id="7441543">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7441546">if</span>&nbsp;<span class="builtinfunc" id="7441549">len</span><span class="op" id="7441552">(</span><span class="ident" id="7441553">p</span><span class="op" id="7441554">)</span>&nbsp;<span class="op" id="7441556">==</span>&nbsp;<span class="num" id="7441559">0</span>&nbsp;<span class="op" id="7441561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7441565">return</span>&nbsp;<span class="ident" id="7441572">s</span><span class="op" id="7441573">.</span><span class="ident" id="7441574">r</span><span class="op" id="7441575">.</span><span class="ident" id="7441576">Read</span><span class="op" id="7441580">(</span><span class="ident" id="7441581">p</span><span class="op" id="7441582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7441585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7441588">return</span>&nbsp;<span class="ident" id="7441595">s</span><span class="op" id="7441596">.</span><span class="ident" id="7441597">r</span><span class="op" id="7441598">.</span><span class="ident" id="7441599">Read</span><span class="op" id="7441603">(</span><span class="ident" id="7441604">p</span><span class="op" id="7441605">[</span><span class="op" id="7441606">:</span><span class="num" id="7441607">1</span><span class="op" id="7441608">]</span><span class="op" id="7441609">)</span><br>
<span class="lineno"></span><span class="op" id="7441611">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7441614">func</span>&nbsp;<span class="ident" id="7441619">TestLineContinuation</span><span class="op" id="7441639">(</span><span class="ident" id="7441640">t</span>&nbsp;<span class="op" id="7441642">*</span><span class="ident" id="7441643">testing</span><span class="op" id="7441650">.</span><span class="ident" id="7441651">T</span><span class="op" id="7441652">)</span>&nbsp;<span class="op" id="7441654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7441657">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7441733">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7441745">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7441812">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7441873">testBody</span>&nbsp;<span class="op" id="7441882">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7441887">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442383">r</span>&nbsp;<span class="op" id="7442385">:=</span>&nbsp;<span class="ident" id="7442388">NewReader</span><span class="op" id="7442397">(</span><span class="ident" id="7442398">strings</span><span class="op" id="7442405">.</span><span class="ident" id="7442406">NewReader</span><span class="op" id="7442415">(</span><span class="ident" id="7442416">testBody</span><span class="op" id="7442424">)</span><span class="op" id="7442425">,</span>&nbsp;<span class="string" id="7442427">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="7442451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7442455">for</span>&nbsp;<span class="ident" id="7442459">i</span>&nbsp;<span class="op" id="7442461">:=</span>&nbsp;<span class="num" id="7442464">0</span><span class="op" id="7442465">;</span>&nbsp;<span class="ident" id="7442467">i</span>&nbsp;<span class="op" id="7442469">&lt;</span>&nbsp;<span class="num" id="7442471">2</span><span class="op" id="7442472">;</span>&nbsp;<span class="ident" id="7442474">i</span><span class="op" id="7442475">++</span>&nbsp;<span class="op" id="7442478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442482">part</span><span class="op" id="7442486">,</span>&nbsp;<span class="ident" id="7442488">err</span>&nbsp;<span class="op" id="7442492">:=</span>&nbsp;<span class="ident" id="7442495">r</span><span class="op" id="7442496">.</span><span class="ident" id="7442497">NextPart</span><span class="op" id="7442505">(</span><span class="op" id="7442506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7442510">if</span>&nbsp;<span class="ident" id="7442513">err</span>&nbsp;<span class="op" id="7442517">!=</span>&nbsp;<span class="ident" id="7442520">nil</span>&nbsp;<span class="op" id="7442524">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442529">t</span><span class="op" id="7442530">.</span><span class="ident" id="7442531">Fatalf</span><span class="op" id="7442537">(</span><span class="string" id="7442538">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7442557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7442561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7442565">var</span>&nbsp;<span class="ident" id="7442569">buf</span>&nbsp;<span class="ident" id="7442573">bytes</span><span class="op" id="7442578">.</span><span class="ident" id="7442579">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442588">n</span><span class="op" id="7442589">,</span>&nbsp;<span class="ident" id="7442591">err</span>&nbsp;<span class="op" id="7442595">:=</span>&nbsp;<span class="ident" id="7442598">io</span><span class="op" id="7442600">.</span><span class="ident" id="7442601">Copy</span><span class="op" id="7442605">(</span><span class="op" id="7442606">&amp;</span><span class="ident" id="7442607">buf</span><span class="op" id="7442610">,</span>&nbsp;<span class="ident" id="7442612">part</span><span class="op" id="7442616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7442620">if</span>&nbsp;<span class="ident" id="7442623">err</span>&nbsp;<span class="op" id="7442627">!=</span>&nbsp;<span class="ident" id="7442630">nil</span>&nbsp;<span class="op" id="7442634">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442639">t</span><span class="op" id="7442640">.</span><span class="ident" id="7442641">Errorf</span><span class="op" id="7442647">(</span><span class="string" id="7442648">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="7442689">,</span>&nbsp;<span class="ident" id="7442691">err</span><span class="op" id="7442694">,</span>&nbsp;<span class="ident" id="7442696">buf</span><span class="op" id="7442699">.</span><span class="ident" id="7442700">String</span><span class="op" id="7442706">(</span><span class="op" id="7442707">)</span><span class="op" id="7442708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7442712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7442716">if</span>&nbsp;<span class="ident" id="7442719">n</span>&nbsp;<span class="op" id="7442721">&lt;=</span>&nbsp;<span class="num" id="7442724">0</span>&nbsp;<span class="op" id="7442726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442731">t</span><span class="op" id="7442732">.</span><span class="ident" id="7442733">Errorf</span><span class="op" id="7442739">(</span><span class="string" id="7442740">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="7442768">,</span>&nbsp;<span class="ident" id="7442770">n</span><span class="op" id="7442771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7442775">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7442778">}</span><br>
<span class="lineno"></span><span class="op" id="7442780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442783">func</span>&nbsp;<span class="ident" id="7442788">TestQuotedPrintableEncoding</span><span class="op" id="7442815">(</span><span class="ident" id="7442816">t</span>&nbsp;<span class="op" id="7442818">*</span><span class="ident" id="7442819">testing</span><span class="op" id="7442826">.</span><span class="ident" id="7442827">T</span><span class="op" id="7442828">)</span>&nbsp;<span class="op" id="7442830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7442833">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7442871">body</span>&nbsp;<span class="op" id="7442876">:=</span>&nbsp;<span class="string" id="7442879">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443613">r</span>&nbsp;<span class="op" id="7443615">:=</span>&nbsp;<span class="ident" id="7443618">NewReader</span><span class="op" id="7443627">(</span><span class="ident" id="7443628">strings</span><span class="op" id="7443635">.</span><span class="ident" id="7443636">NewReader</span><span class="op" id="7443645">(</span><span class="ident" id="7443646">body</span><span class="op" id="7443650">)</span><span class="op" id="7443651">,</span>&nbsp;<span class="string" id="7443653">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="7443683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443686">part</span><span class="op" id="7443690">,</span>&nbsp;<span class="ident" id="7443692">err</span>&nbsp;<span class="op" id="7443696">:=</span>&nbsp;<span class="ident" id="7443699">r</span><span class="op" id="7443700">.</span><span class="ident" id="7443701">NextPart</span><span class="op" id="7443709">(</span><span class="op" id="7443710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443713">if</span>&nbsp;<span class="ident" id="7443716">err</span>&nbsp;<span class="op" id="7443720">!=</span>&nbsp;<span class="ident" id="7443723">nil</span>&nbsp;<span class="op" id="7443727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443731">t</span><span class="op" id="7443732">.</span><span class="ident" id="7443733">Fatal</span><span class="op" id="7443738">(</span><span class="ident" id="7443739">err</span><span class="op" id="7443742">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7443745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443748">if</span>&nbsp;<span class="ident" id="7443751">te</span><span class="op" id="7443753">,</span>&nbsp;<span class="ident" id="7443755">ok</span>&nbsp;<span class="op" id="7443758">:=</span>&nbsp;<span class="ident" id="7443761">part</span><span class="op" id="7443765">.</span><span class="ident" id="7443766">Header</span><span class="op" id="7443772">[</span><span class="string" id="7443773">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="7443800">]</span><span class="op" id="7443801">;</span>&nbsp;<span class="ident" id="7443803">ok</span>&nbsp;<span class="op" id="7443806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443810">t</span><span class="op" id="7443811">.</span><span class="ident" id="7443812">Errorf</span><span class="op" id="7443818">(</span><span class="string" id="7443819">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7443863">,</span>&nbsp;<span class="ident" id="7443865">te</span><span class="op" id="7443867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7443870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443873">var</span>&nbsp;<span class="ident" id="7443877">buf</span>&nbsp;<span class="ident" id="7443881">bytes</span><span class="op" id="7443886">.</span><span class="ident" id="7443887">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443895">_</span><span class="op" id="7443896">,</span>&nbsp;<span class="ident" id="7443898">err</span>&nbsp;<span class="op" id="7443902">=</span>&nbsp;<span class="ident" id="7443904">io</span><span class="op" id="7443906">.</span><span class="ident" id="7443907">Copy</span><span class="op" id="7443911">(</span><span class="op" id="7443912">&amp;</span><span class="ident" id="7443913">buf</span><span class="op" id="7443916">,</span>&nbsp;<span class="ident" id="7443918">part</span><span class="op" id="7443922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443925">if</span>&nbsp;<span class="ident" id="7443928">err</span>&nbsp;<span class="op" id="7443932">!=</span>&nbsp;<span class="ident" id="7443935">nil</span>&nbsp;<span class="op" id="7443939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443943">t</span><span class="op" id="7443944">.</span><span class="ident" id="7443945">Error</span><span class="op" id="7443950">(</span><span class="ident" id="7443951">err</span><span class="op" id="7443954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7443957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443960">got</span>&nbsp;<span class="op" id="7443964">:=</span>&nbsp;<span class="ident" id="7443967">buf</span><span class="op" id="7443970">.</span><span class="ident" id="7443971">String</span><span class="op" id="7443977">(</span><span class="op" id="7443978">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443981">want</span>&nbsp;<span class="op" id="7443986">:=</span>&nbsp;<span class="string" id="7443989">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444346">if</span>&nbsp;<span class="ident" id="7444349">got</span>&nbsp;<span class="op" id="7444353">!=</span>&nbsp;<span class="ident" id="7444356">want</span>&nbsp;<span class="op" id="7444361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444365">t</span><span class="op" id="7444366">.</span><span class="ident" id="7444367">Errorf</span><span class="op" id="7444373">(</span><span class="string" id="7444374">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="7444413">,</span>&nbsp;<span class="ident" id="7444415">got</span><span class="op" id="7444418">,</span>&nbsp;<span class="ident" id="7444420">want</span><span class="op" id="7444424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444427">}</span><br>
<span class="lineno"></span><span class="op" id="7444429">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="7444432">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="7444505">func</span>&nbsp;<span class="ident" id="7444510">TestNested</span><span class="op" id="7444520">(</span><span class="ident" id="7444521">t</span>&nbsp;<span class="op" id="7444523">*</span><span class="ident" id="7444524">testing</span><span class="op" id="7444531">.</span><span class="ident" id="7444532">T</span><span class="op" id="7444533">)</span>&nbsp;<span class="op" id="7444535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444538">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444598">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444645">f</span><span class="op" id="7444646">,</span>&nbsp;<span class="ident" id="7444648">err</span>&nbsp;<span class="op" id="7444652">:=</span>&nbsp;<span class="ident" id="7444655">os</span><span class="op" id="7444657">.</span><span class="ident" id="7444658">Open</span><span class="op" id="7444662">(</span><span class="string" id="7444663">&#34;testdata/nested-mime&#34;</span><span class="op" id="7444685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444688">if</span>&nbsp;<span class="ident" id="7444691">err</span>&nbsp;<span class="op" id="7444695">!=</span>&nbsp;<span class="ident" id="7444698">nil</span>&nbsp;<span class="op" id="7444702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444706">t</span><span class="op" id="7444707">.</span><span class="ident" id="7444708">Fatal</span><span class="op" id="7444713">(</span><span class="ident" id="7444714">err</span><span class="op" id="7444717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444723">defer</span>&nbsp;<span class="ident" id="7444729">f</span><span class="op" id="7444730">.</span><span class="ident" id="7444731">Close</span><span class="op" id="7444736">(</span><span class="op" id="7444737">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444740">mr</span>&nbsp;<span class="op" id="7444743">:=</span>&nbsp;<span class="ident" id="7444746">NewReader</span><span class="op" id="7444755">(</span><span class="ident" id="7444756">f</span><span class="op" id="7444757">,</span>&nbsp;<span class="string" id="7444759">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="7444789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444792">p</span><span class="op" id="7444793">,</span>&nbsp;<span class="ident" id="7444795">err</span>&nbsp;<span class="op" id="7444799">:=</span>&nbsp;<span class="ident" id="7444802">mr</span><span class="op" id="7444804">.</span><span class="ident" id="7444805">NextPart</span><span class="op" id="7444813">(</span><span class="op" id="7444814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444817">if</span>&nbsp;<span class="ident" id="7444820">err</span>&nbsp;<span class="op" id="7444824">!=</span>&nbsp;<span class="ident" id="7444827">nil</span>&nbsp;<span class="op" id="7444831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444835">t</span><span class="op" id="7444836">.</span><span class="ident" id="7444837">Fatalf</span><span class="op" id="7444843">(</span><span class="string" id="7444844">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="7444891">,</span>&nbsp;<span class="ident" id="7444893">err</span><span class="op" id="7444896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444899">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444903">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444986">mr2</span>&nbsp;<span class="op" id="7444990">:=</span>&nbsp;<span class="ident" id="7444993">NewReader</span><span class="op" id="7445002">(</span><span class="ident" id="7445003">p</span><span class="op" id="7445004">,</span>&nbsp;<span class="string" id="7445006">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="7445036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445039">p</span><span class="op" id="7445040">,</span>&nbsp;<span class="ident" id="7445042">err</span>&nbsp;<span class="op" id="7445046">=</span>&nbsp;<span class="ident" id="7445048">mr2</span><span class="op" id="7445051">.</span><span class="ident" id="7445052">NextPart</span><span class="op" id="7445060">(</span><span class="op" id="7445061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445064">if</span>&nbsp;<span class="ident" id="7445067">err</span>&nbsp;<span class="op" id="7445071">!=</span>&nbsp;<span class="ident" id="7445074">nil</span>&nbsp;<span class="op" id="7445078">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445082">t</span><span class="op" id="7445083">.</span><span class="ident" id="7445084">Fatalf</span><span class="op" id="7445090">(</span><span class="string" id="7445091">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7445120">,</span>&nbsp;<span class="ident" id="7445122">err</span><span class="op" id="7445125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445131">if</span>&nbsp;<span class="ident" id="7445134">b</span><span class="op" id="7445135">,</span>&nbsp;<span class="ident" id="7445137">err</span>&nbsp;<span class="op" id="7445141">:=</span>&nbsp;<span class="ident" id="7445144">ioutil</span><span class="op" id="7445150">.</span><span class="ident" id="7445151">ReadAll</span><span class="op" id="7445158">(</span><span class="ident" id="7445159">p</span><span class="op" id="7445160">)</span><span class="op" id="7445161">;</span>&nbsp;<span class="builtintype" id="7445163">string</span><span class="op" id="7445169">(</span><span class="ident" id="7445170">b</span><span class="op" id="7445171">)</span>&nbsp;<span class="op" id="7445173">!=</span>&nbsp;<span class="string" id="7445176">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="7445189">||</span>&nbsp;<span class="ident" id="7445192">err</span>&nbsp;<span class="op" id="7445196">!=</span>&nbsp;<span class="ident" id="7445199">nil</span>&nbsp;<span class="op" id="7445203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445207">t</span><span class="op" id="7445208">.</span><span class="ident" id="7445209">Fatalf</span><span class="op" id="7445215">(</span><span class="string" id="7445216">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7445253">,</span>&nbsp;<span class="ident" id="7445255">b</span><span class="op" id="7445256">,</span>&nbsp;<span class="ident" id="7445258">err</span><span class="op" id="7445261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445264">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445267">p</span><span class="op" id="7445268">,</span>&nbsp;<span class="ident" id="7445270">err</span>&nbsp;<span class="op" id="7445274">=</span>&nbsp;<span class="ident" id="7445276">mr2</span><span class="op" id="7445279">.</span><span class="ident" id="7445280">NextPart</span><span class="op" id="7445288">(</span><span class="op" id="7445289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445292">if</span>&nbsp;<span class="ident" id="7445295">err</span>&nbsp;<span class="op" id="7445299">!=</span>&nbsp;<span class="ident" id="7445302">nil</span>&nbsp;<span class="op" id="7445306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445310">t</span><span class="op" id="7445311">.</span><span class="ident" id="7445312">Fatalf</span><span class="op" id="7445318">(</span><span class="string" id="7445319">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7445347">,</span>&nbsp;<span class="ident" id="7445349">err</span><span class="op" id="7445352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445358">if</span>&nbsp;<span class="ident" id="7445361">b</span><span class="op" id="7445362">,</span>&nbsp;<span class="ident" id="7445364">err</span>&nbsp;<span class="op" id="7445368">:=</span>&nbsp;<span class="ident" id="7445371">ioutil</span><span class="op" id="7445377">.</span><span class="ident" id="7445378">ReadAll</span><span class="op" id="7445385">(</span><span class="ident" id="7445386">p</span><span class="op" id="7445387">)</span><span class="op" id="7445388">;</span>&nbsp;<span class="builtintype" id="7445390">string</span><span class="op" id="7445396">(</span><span class="ident" id="7445397">b</span><span class="op" id="7445398">)</span>&nbsp;<span class="op" id="7445400">!=</span>&nbsp;<span class="string" id="7445403">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="7445421">||</span>&nbsp;<span class="ident" id="7445424">err</span>&nbsp;<span class="op" id="7445428">!=</span>&nbsp;<span class="ident" id="7445431">nil</span>&nbsp;<span class="op" id="7445435">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445439">t</span><span class="op" id="7445440">.</span><span class="ident" id="7445441">Fatalf</span><span class="op" id="7445447">(</span><span class="string" id="7445448">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7445484">,</span>&nbsp;<span class="ident" id="7445486">b</span><span class="op" id="7445487">,</span>&nbsp;<span class="ident" id="7445489">err</span><span class="op" id="7445492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445499">p</span><span class="op" id="7445500">,</span>&nbsp;<span class="ident" id="7445502">err</span>&nbsp;<span class="op" id="7445506">=</span>&nbsp;<span class="ident" id="7445508">mr2</span><span class="op" id="7445511">.</span><span class="ident" id="7445512">NextPart</span><span class="op" id="7445520">(</span><span class="op" id="7445521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445524">if</span>&nbsp;<span class="ident" id="7445527">err</span>&nbsp;<span class="op" id="7445531">!=</span>&nbsp;<span class="ident" id="7445534">io</span><span class="op" id="7445536">.</span><span class="ident" id="7445537">EOF</span>&nbsp;<span class="op" id="7445541">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445545">t</span><span class="op" id="7445546">.</span><span class="ident" id="7445547">Fatalf</span><span class="op" id="7445553">(</span><span class="string" id="7445554">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7445594">,</span>&nbsp;<span class="ident" id="7445596">err</span><span class="op" id="7445599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445606">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445675">_</span><span class="op" id="7445676">,</span>&nbsp;<span class="ident" id="7445678">err</span>&nbsp;<span class="op" id="7445682">=</span>&nbsp;<span class="ident" id="7445684">mr</span><span class="op" id="7445686">.</span><span class="ident" id="7445687">NextPart</span><span class="op" id="7445695">(</span><span class="op" id="7445696">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445699">if</span>&nbsp;<span class="ident" id="7445702">err</span>&nbsp;<span class="op" id="7445706">!=</span>&nbsp;<span class="ident" id="7445709">nil</span>&nbsp;<span class="op" id="7445713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445717">t</span><span class="op" id="7445718">.</span><span class="ident" id="7445719">Fatalf</span><span class="op" id="7445725">(</span><span class="string" id="7445726">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="7445777">,</span>&nbsp;<span class="ident" id="7445779">err</span><span class="op" id="7445782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445789">_</span><span class="op" id="7445790">,</span>&nbsp;<span class="ident" id="7445792">err</span>&nbsp;<span class="op" id="7445796">=</span>&nbsp;<span class="ident" id="7445798">mr</span><span class="op" id="7445800">.</span><span class="ident" id="7445801">NextPart</span><span class="op" id="7445809">(</span><span class="op" id="7445810">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445813">if</span>&nbsp;<span class="ident" id="7445816">err</span>&nbsp;<span class="op" id="7445820">!=</span>&nbsp;<span class="ident" id="7445823">io</span><span class="op" id="7445825">.</span><span class="ident" id="7445826">EOF</span>&nbsp;<span class="op" id="7445830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445834">t</span><span class="op" id="7445835">.</span><span class="ident" id="7445836">Fatalf</span><span class="op" id="7445842">(</span><span class="string" id="7445843">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7445883">,</span>&nbsp;<span class="ident" id="7445885">err</span><span class="op" id="7445888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445891">}</span><br>
<span class="lineno"></span><span class="op" id="7445893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="7445896">type</span>&nbsp;<span class="ident" id="7445901">headerBody</span>&nbsp;<span class="keyword" id="7445912">struct</span>&nbsp;<span class="op" id="7445919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445922">header</span>&nbsp;<span class="ident" id="7445929">textproto</span><span class="op" id="7445938">.</span><span class="ident" id="7445939">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445951">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7445958">string</span><br>
<span class="lineno"></span><span class="op" id="7445965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7445968">func</span>&nbsp;<span class="ident" id="7445973">formData</span><span class="op" id="7445981">(</span><span class="ident" id="7445982">key</span><span class="op" id="7445985">,</span>&nbsp;<span class="ident" id="7445987">value</span>&nbsp;<span class="builtintype" id="7445993">string</span><span class="op" id="7445999">)</span>&nbsp;<span class="ident" id="7446001">headerBody</span>&nbsp;<span class="op" id="7446012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446015">return</span>&nbsp;<span class="ident" id="7446022">headerBody</span><span class="op" id="7446032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446036">textproto</span><span class="op" id="7446045">.</span><span class="ident" id="7446046">MIMEHeader</span><span class="op" id="7446056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7446061">&#34;Content-Type&#34;</span><span class="op" id="7446075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7446084">{</span><span class="string" id="7446085">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="7446117">}</span><span class="op" id="7446118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7446123">&#34;Content-Disposition&#34;</span><span class="op" id="7446144">:</span>&nbsp;<span class="op" id="7446146">{</span><span class="string" id="7446147">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="7446166">+</span>&nbsp;<span class="ident" id="7446168">key</span><span class="op" id="7446171">}</span><span class="op" id="7446172">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446176">}</span><span class="op" id="7446177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446181">value</span><span class="op" id="7446186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446189">}</span><br>
<span class="lineno"></span><span class="op" id="7446191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="7446194">type</span>&nbsp;<span class="ident" id="7446199">parseTest</span>&nbsp;<span class="keyword" id="7446209">struct</span>&nbsp;<span class="op" id="7446216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446219">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7446227">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446235">in</span><span class="op" id="7446237">,</span>&nbsp;<span class="ident" id="7446239">sep</span>&nbsp;<span class="builtintype" id="7446243">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446251">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7446259">[</span><span class="op" id="7446260">]</span><span class="ident" id="7446261">headerBody</span><br>
<span class="lineno"></span><span class="op" id="7446272">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7446275">var</span>&nbsp;<span class="ident" id="7446279">parseTests</span>&nbsp;<span class="op" id="7446290">=</span>&nbsp;<span class="op" id="7446292">[</span><span class="op" id="7446293">]</span><span class="ident" id="7446294">parseTest</span><span class="op" id="7446303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446306">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446376">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446445">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446511">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446574">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446640">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446707">name</span><span class="op" id="7446711">:</span>&nbsp;<span class="string" id="7446713">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="7446730">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446734">sep</span><span class="op" id="7446737">:</span>&nbsp;&nbsp;<span class="string" id="7446740">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="7446770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446774">in</span><span class="op" id="7446776">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7446780">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="7448688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448692">want</span><span class="op" id="7448696">:</span>&nbsp;<span class="op" id="7448698">[</span><span class="op" id="7448699">]</span><span class="ident" id="7448700">headerBody</span><span class="op" id="7448710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448715">formData</span><span class="op" id="7448723">(</span><span class="string" id="7448724">&#34;otherEmpty1&#34;</span><span class="op" id="7448737">,</span>&nbsp;<span class="string" id="7448739">&#34;&#34;</span><span class="op" id="7448741">)</span><span class="op" id="7448742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448747">formData</span><span class="op" id="7448755">(</span><span class="string" id="7448756">&#34;otherFoo1&#34;</span><span class="op" id="7448767">,</span>&nbsp;<span class="string" id="7448769">&#34;foo&#34;</span><span class="op" id="7448774">)</span><span class="op" id="7448775">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448780">formData</span><span class="op" id="7448788">(</span><span class="string" id="7448789">&#34;otherFoo2&#34;</span><span class="op" id="7448800">,</span>&nbsp;<span class="string" id="7448802">&#34;foo&#34;</span><span class="op" id="7448807">)</span><span class="op" id="7448808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448813">formData</span><span class="op" id="7448821">(</span><span class="string" id="7448822">&#34;otherEmpty2&#34;</span><span class="op" id="7448835">,</span>&nbsp;<span class="string" id="7448837">&#34;&#34;</span><span class="op" id="7448839">)</span><span class="op" id="7448840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448845">formData</span><span class="op" id="7448853">(</span><span class="string" id="7448854">&#34;otherRepeatFoo&#34;</span><span class="op" id="7448870">,</span>&nbsp;<span class="string" id="7448872">&#34;foo&#34;</span><span class="op" id="7448877">)</span><span class="op" id="7448878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448883">formData</span><span class="op" id="7448891">(</span><span class="string" id="7448892">&#34;otherRepeatFoo&#34;</span><span class="op" id="7448908">,</span>&nbsp;<span class="string" id="7448910">&#34;foo&#34;</span><span class="op" id="7448915">)</span><span class="op" id="7448916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448921">formData</span><span class="op" id="7448929">(</span><span class="string" id="7448930">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7448948">,</span>&nbsp;<span class="string" id="7448950">&#34;&#34;</span><span class="op" id="7448952">)</span><span class="op" id="7448953">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448958">formData</span><span class="op" id="7448966">(</span><span class="string" id="7448967">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7448985">,</span>&nbsp;<span class="string" id="7448987">&#34;&#34;</span><span class="op" id="7448989">)</span><span class="op" id="7448990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448995">formData</span><span class="op" id="7449003">(</span><span class="string" id="7449004">&#34;submit&#34;</span><span class="op" id="7449012">,</span>&nbsp;<span class="string" id="7449014">&#34;Submit&#34;</span><span class="op" id="7449022">)</span><span class="op" id="7449023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449028">{</span><span class="ident" id="7449029">textproto</span><span class="op" id="7449038">.</span><span class="ident" id="7449039">MIMEHeader</span><span class="op" id="7449049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7449055">&#34;Content-Type&#34;</span><span class="op" id="7449069">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7449078">{</span><span class="string" id="7449079">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="7449295">}</span><span class="op" id="7449296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7449302">&#34;Content-Disposition&#34;</span><span class="op" id="7449323">:</span>&nbsp;<span class="op" id="7449325">{</span><span class="string" id="7449326">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="7449371">}</span><span class="op" id="7449372">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449377">}</span><span class="op" id="7449378">,</span>&nbsp;<span class="string" id="7449380">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="7449627">}</span><span class="op" id="7449628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449632">}</span><span class="op" id="7449633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449636">}</span><span class="op" id="7449637">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7449641">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449717">name</span><span class="op" id="7449721">:</span>&nbsp;<span class="string" id="7449723">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="7449754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449758">sep</span><span class="op" id="7449761">:</span>&nbsp;&nbsp;<span class="string" id="7449764">&#34;abc&#34;</span><span class="op" id="7449769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449773">in</span><span class="op" id="7449775">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7449779">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="7449813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449817">want</span><span class="op" id="7449821">:</span>&nbsp;<span class="op" id="7449823">[</span><span class="op" id="7449824">]</span><span class="ident" id="7449825">headerBody</span><span class="op" id="7449835">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449840">{</span><span class="ident" id="7449841">textproto</span><span class="op" id="7449850">.</span><span class="ident" id="7449851">MIMEHeader</span><span class="op" id="7449861">{</span><span class="string" id="7449862">&#34;Foo&#34;</span><span class="op" id="7449867">:</span>&nbsp;<span class="op" id="7449869">{</span><span class="string" id="7449870">&#34;bar&#34;</span><span class="op" id="7449875">}</span><span class="op" id="7449876">}</span><span class="op" id="7449877">,</span>&nbsp;<span class="string" id="7449879">&#34;&#34;</span><span class="op" id="7449881">}</span><span class="op" id="7449882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449886">}</span><span class="op" id="7449887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449890">}</span><span class="op" id="7449891">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7449895">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449975">name</span><span class="op" id="7449979">:</span>&nbsp;<span class="string" id="7449981">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="7450016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450020">sep</span><span class="op" id="7450023">:</span>&nbsp;&nbsp;<span class="string" id="7450026">&#34;abc&#34;</span><span class="op" id="7450031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450035">in</span><span class="op" id="7450037">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7450041">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="7450079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450083">want</span><span class="op" id="7450087">:</span>&nbsp;<span class="op" id="7450089">[</span><span class="op" id="7450090">]</span><span class="ident" id="7450091">headerBody</span><span class="op" id="7450101">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450106">{</span><span class="ident" id="7450107">textproto</span><span class="op" id="7450116">.</span><span class="ident" id="7450117">MIMEHeader</span><span class="op" id="7450127">{</span><span class="string" id="7450128">&#34;Foo&#34;</span><span class="op" id="7450133">:</span>&nbsp;<span class="op" id="7450135">{</span><span class="string" id="7450136">&#34;bar&#34;</span><span class="op" id="7450141">}</span><span class="op" id="7450142">}</span><span class="op" id="7450143">,</span>&nbsp;<span class="string" id="7450145">&#34;&#34;</span><span class="op" id="7450147">}</span><span class="op" id="7450148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450152">}</span><span class="op" id="7450153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450156">}</span><span class="op" id="7450157">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450161">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450187">name</span><span class="op" id="7450191">:</span>&nbsp;<span class="string" id="7450193">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="7450211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450215">sep</span><span class="op" id="7450218">:</span>&nbsp;&nbsp;<span class="string" id="7450221">&#34;abc&#34;</span><span class="op" id="7450226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450230">in</span><span class="op" id="7450232">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7450236">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="7450297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450301">want</span><span class="op" id="7450305">:</span>&nbsp;<span class="op" id="7450307">[</span><span class="op" id="7450308">]</span><span class="ident" id="7450309">headerBody</span><span class="op" id="7450319">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450324">{</span><span class="ident" id="7450325">textproto</span><span class="op" id="7450334">.</span><span class="ident" id="7450335">MIMEHeader</span><span class="op" id="7450345">{</span><span class="string" id="7450346">&#34;Foo&#34;</span><span class="op" id="7450351">:</span>&nbsp;<span class="op" id="7450353">{</span><span class="string" id="7450354">&#34;bar&#34;</span><span class="op" id="7450359">}</span><span class="op" id="7450360">}</span><span class="op" id="7450361">,</span>&nbsp;<span class="string" id="7450363">&#34;&#34;</span><span class="op" id="7450365">}</span><span class="op" id="7450366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450371">{</span><span class="ident" id="7450372">textproto</span><span class="op" id="7450381">.</span><span class="ident" id="7450382">MIMEHeader</span><span class="op" id="7450392">{</span><span class="string" id="7450393">&#34;Foo2&#34;</span><span class="op" id="7450399">:</span>&nbsp;<span class="op" id="7450401">{</span><span class="string" id="7450402">&#34;bar2&#34;</span><span class="op" id="7450408">}</span><span class="op" id="7450409">}</span><span class="op" id="7450410">,</span>&nbsp;<span class="string" id="7450412">&#34;&#34;</span><span class="op" id="7450414">}</span><span class="op" id="7450415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450419">}</span><span class="op" id="7450420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450423">}</span><span class="op" id="7450424">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450428">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450490">name</span><span class="op" id="7450494">:</span>&nbsp;<span class="string" id="7450496">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="7450524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450528">sep</span><span class="op" id="7450531">:</span>&nbsp;&nbsp;<span class="string" id="7450534">&#34;abc&#34;</span><span class="op" id="7450539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450543">in</span><span class="op" id="7450545">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7450549">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="7450587">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450591">want</span><span class="op" id="7450595">:</span>&nbsp;<span class="op" id="7450597">[</span><span class="op" id="7450598">]</span><span class="ident" id="7450599">headerBody</span><span class="op" id="7450609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450614">{</span><span class="ident" id="7450615">textproto</span><span class="op" id="7450624">.</span><span class="ident" id="7450625">MIMEHeader</span><span class="op" id="7450635">{</span><span class="string" id="7450636">&#34;Foo&#34;</span><span class="op" id="7450641">:</span>&nbsp;<span class="op" id="7450643">{</span><span class="string" id="7450644">&#34;bar&#34;</span><span class="op" id="7450649">}</span><span class="op" id="7450650">}</span><span class="op" id="7450651">,</span>&nbsp;<span class="string" id="7450653">&#34;&#34;</span><span class="op" id="7450655">}</span><span class="op" id="7450656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450660">}</span><span class="op" id="7450661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450664">}</span><span class="op" id="7450665">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450669">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450733">name</span><span class="op" id="7450737">:</span>&nbsp;<span class="string" id="7450739">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="7450767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450771">sep</span><span class="op" id="7450774">:</span>&nbsp;&nbsp;<span class="string" id="7450777">&#34;abc&#34;</span><span class="op" id="7450782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450786">in</span><span class="op" id="7450788">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7450792">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="7450829">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450833">want</span><span class="op" id="7450837">:</span>&nbsp;<span class="op" id="7450839">[</span><span class="op" id="7450840">]</span><span class="ident" id="7450841">headerBody</span><span class="op" id="7450851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450856">{</span><span class="ident" id="7450857">textproto</span><span class="op" id="7450866">.</span><span class="ident" id="7450867">MIMEHeader</span><span class="op" id="7450877">{</span><span class="string" id="7450878">&#34;Foo&#34;</span><span class="op" id="7450883">:</span>&nbsp;<span class="op" id="7450885">{</span><span class="string" id="7450886">&#34;bar&#34;</span><span class="op" id="7450891">}</span><span class="op" id="7450892">}</span><span class="op" id="7450893">,</span>&nbsp;<span class="string" id="7450895">&#34;&#34;</span><span class="op" id="7450897">}</span><span class="op" id="7450898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450902">}</span><span class="op" id="7450903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450906">}</span><span class="op" id="7450907">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450911">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450964">name</span><span class="op" id="7450968">:</span>&nbsp;<span class="string" id="7450970">&#34;no&nbsp;parts&#34;</span><span class="op" id="7450980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450984">sep</span><span class="op" id="7450987">:</span>&nbsp;&nbsp;<span class="string" id="7450990">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="7451030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451034">in</span><span class="op" id="7451036">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7451040">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="7451088">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451092">want</span><span class="op" id="7451096">:</span>&nbsp;<span class="op" id="7451098">[</span><span class="op" id="7451099">]</span><span class="ident" id="7451100">headerBody</span><span class="op" id="7451110">{</span><span class="op" id="7451111">}</span><span class="op" id="7451112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451115">}</span><span class="op" id="7451116">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451120">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451201">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451205">name</span><span class="op" id="7451209">:</span>&nbsp;<span class="string" id="7451211">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="7451235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451239">sep</span><span class="op" id="7451242">:</span>&nbsp;&nbsp;<span class="string" id="7451245">&#34;sep&#34;</span><span class="op" id="7451250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451254">in</span><span class="op" id="7451256">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7451260">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="7451307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451311">want</span><span class="op" id="7451315">:</span>&nbsp;<span class="op" id="7451317">[</span><span class="op" id="7451318">]</span><span class="ident" id="7451319">headerBody</span><span class="op" id="7451329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451334">{</span><span class="ident" id="7451335">textproto</span><span class="op" id="7451344">.</span><span class="ident" id="7451345">MIMEHeader</span><span class="op" id="7451355">{</span><span class="string" id="7451356">&#34;Foo&#34;</span><span class="op" id="7451361">:</span>&nbsp;<span class="op" id="7451363">{</span><span class="string" id="7451364">&#34;bar&#34;</span><span class="op" id="7451369">}</span><span class="op" id="7451370">}</span><span class="op" id="7451371">,</span>&nbsp;<span class="string" id="7451373">&#34;--sepFAKE&#34;</span><span class="op" id="7451384">}</span><span class="op" id="7451385">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451389">}</span><span class="op" id="7451390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451393">}</span><span class="op" id="7451394">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451398">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451459">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451463">name</span><span class="op" id="7451467">:</span>&nbsp;<span class="string" id="7451469">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="7451495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451499">sep</span><span class="op" id="7451502">:</span>&nbsp;&nbsp;<span class="string" id="7451505">&#34;sep&#34;</span><span class="op" id="7451510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451514">in</span><span class="op" id="7451516">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7451520">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="7451563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451567">want</span><span class="op" id="7451571">:</span>&nbsp;<span class="op" id="7451573">[</span><span class="op" id="7451574">]</span><span class="ident" id="7451575">headerBody</span><span class="op" id="7451585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451590">{</span><span class="ident" id="7451591">textproto</span><span class="op" id="7451600">.</span><span class="ident" id="7451601">MIMEHeader</span><span class="op" id="7451611">{</span><span class="string" id="7451612">&#34;Foo&#34;</span><span class="op" id="7451617">:</span>&nbsp;<span class="op" id="7451619">{</span><span class="string" id="7451620">&#34;bar&#34;</span><span class="op" id="7451625">}</span><span class="op" id="7451626">}</span><span class="op" id="7451627">,</span>&nbsp;<span class="string" id="7451629">&#34;text&#34;</span><span class="op" id="7451635">}</span><span class="op" id="7451636">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451640">}</span><span class="op" id="7451641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451644">}</span><span class="op" id="7451645">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7451649">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451680">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451684">name</span><span class="op" id="7451688">:</span>&nbsp;<span class="string" id="7451690">&#34;leading&nbsp;line&#34;</span><span class="op" id="7451704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451708">sep</span><span class="op" id="7451711">:</span>&nbsp;&nbsp;<span class="string" id="7451714">&#34;MyBoundary&#34;</span><span class="op" id="7451726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451730">in</span><span class="op" id="7451732">:</span>&nbsp;<span class="ident" id="7451734">strings</span><span class="op" id="7451741">.</span><span class="ident" id="7451742">Replace</span><span class="op" id="7451749">(</span><span class="string" id="7451750">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="7451843">,</span>&nbsp;<span class="string" id="7451845">&#34;\n&#34;</span><span class="op" id="7451849">,</span>&nbsp;<span class="string" id="7451851">&#34;\r\n&#34;</span><span class="op" id="7451857">,</span>&nbsp;<span class="op" id="7451859">-</span><span class="num" id="7451860">1</span><span class="op" id="7451861">)</span><span class="op" id="7451862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451866">want</span><span class="op" id="7451870">:</span>&nbsp;<span class="op" id="7451872">[</span><span class="op" id="7451873">]</span><span class="ident" id="7451874">headerBody</span><span class="op" id="7451884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451889">{</span><span class="ident" id="7451890">textproto</span><span class="op" id="7451899">.</span><span class="ident" id="7451900">MIMEHeader</span><span class="op" id="7451910">{</span><span class="string" id="7451911">&#34;Foo&#34;</span><span class="op" id="7451916">:</span>&nbsp;<span class="op" id="7451918">{</span><span class="string" id="7451919">&#34;bar&#34;</span><span class="op" id="7451924">}</span><span class="op" id="7451925">}</span><span class="op" id="7451926">,</span>&nbsp;<span class="string" id="7451928">&#34;&#34;</span><span class="op" id="7451930">}</span><span class="op" id="7451931">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451935">}</span><span class="op" id="7451936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451939">}</span><span class="op" id="7451940">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451944">roundTripParseTest</span><span class="op" id="7451962">(</span><span class="op" id="7451963">)</span><span class="op" id="7451964">,</span><br>
<span class="lineno"></span><span class="op" id="7451966">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="7451969">func</span>&nbsp;<span class="ident" id="7451974">TestParse</span><span class="op" id="7451983">(</span><span class="ident" id="7451984">t</span>&nbsp;<span class="op" id="7451986">*</span><span class="ident" id="7451987">testing</span><span class="op" id="7451994">.</span><span class="ident" id="7451995">T</span><span class="op" id="7451996">)</span>&nbsp;<span class="op" id="7451998">{</span><br>
<span class="lineno"></span><span class="ident" id="7452000">Cases</span><span class="op" id="7452005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452008">for</span>&nbsp;<span class="ident" id="7452012">_</span><span class="op" id="7452013">,</span>&nbsp;<span class="ident" id="7452015">tt</span>&nbsp;<span class="op" id="7452018">:=</span>&nbsp;<span class="keyword" id="7452021">range</span>&nbsp;<span class="ident" id="7452027">parseTests</span>&nbsp;<span class="op" id="7452038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452042">r</span>&nbsp;<span class="op" id="7452044">:=</span>&nbsp;<span class="ident" id="7452047">NewReader</span><span class="op" id="7452056">(</span><span class="ident" id="7452057">strings</span><span class="op" id="7452064">.</span><span class="ident" id="7452065">NewReader</span><span class="op" id="7452074">(</span><span class="ident" id="7452075">tt</span><span class="op" id="7452077">.</span><span class="ident" id="7452078">in</span><span class="op" id="7452080">)</span><span class="op" id="7452081">,</span>&nbsp;<span class="ident" id="7452083">tt</span><span class="op" id="7452085">.</span><span class="ident" id="7452086">sep</span><span class="op" id="7452089">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452093">got</span>&nbsp;<span class="op" id="7452097">:=</span>&nbsp;<span class="op" id="7452100">[</span><span class="op" id="7452101">]</span><span class="ident" id="7452102">headerBody</span><span class="op" id="7452112">{</span><span class="op" id="7452113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452117">for</span>&nbsp;<span class="op" id="7452121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452126">p</span><span class="op" id="7452127">,</span>&nbsp;<span class="ident" id="7452129">err</span>&nbsp;<span class="op" id="7452133">:=</span>&nbsp;<span class="ident" id="7452136">r</span><span class="op" id="7452137">.</span><span class="ident" id="7452138">NextPart</span><span class="op" id="7452146">(</span><span class="op" id="7452147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452152">if</span>&nbsp;<span class="ident" id="7452155">err</span>&nbsp;<span class="op" id="7452159">==</span>&nbsp;<span class="ident" id="7452162">io</span><span class="op" id="7452164">.</span><span class="ident" id="7452165">EOF</span>&nbsp;<span class="op" id="7452169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452175">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452189">if</span>&nbsp;<span class="ident" id="7452192">err</span>&nbsp;<span class="op" id="7452196">!=</span>&nbsp;<span class="ident" id="7452199">nil</span>&nbsp;<span class="op" id="7452203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452209">t</span><span class="op" id="7452210">.</span><span class="ident" id="7452211">Errorf</span><span class="op" id="7452217">(</span><span class="string" id="7452218">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="7452244">,</span>&nbsp;<span class="ident" id="7452246">tt</span><span class="op" id="7452248">.</span><span class="ident" id="7452249">name</span><span class="op" id="7452253">,</span>&nbsp;<span class="ident" id="7452255">err</span><span class="op" id="7452258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452264">continue</span>&nbsp;<span class="ident" id="7452273">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452282">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452287">pbody</span><span class="op" id="7452292">,</span>&nbsp;<span class="ident" id="7452294">err</span>&nbsp;<span class="op" id="7452298">:=</span>&nbsp;<span class="ident" id="7452301">ioutil</span><span class="op" id="7452307">.</span><span class="ident" id="7452308">ReadAll</span><span class="op" id="7452315">(</span><span class="ident" id="7452316">p</span><span class="op" id="7452317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452322">if</span>&nbsp;<span class="ident" id="7452325">err</span>&nbsp;<span class="op" id="7452329">!=</span>&nbsp;<span class="ident" id="7452332">nil</span>&nbsp;<span class="op" id="7452336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452342">t</span><span class="op" id="7452343">.</span><span class="ident" id="7452344">Errorf</span><span class="op" id="7452350">(</span><span class="string" id="7452351">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7452387">,</span>&nbsp;<span class="ident" id="7452389">tt</span><span class="op" id="7452391">.</span><span class="ident" id="7452392">name</span><span class="op" id="7452396">,</span>&nbsp;<span class="ident" id="7452398">err</span><span class="op" id="7452401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452407">continue</span>&nbsp;<span class="ident" id="7452416">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452425">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452430">got</span>&nbsp;<span class="op" id="7452434">=</span>&nbsp;<span class="builtinfunc" id="7452436">append</span><span class="op" id="7452442">(</span><span class="ident" id="7452443">got</span><span class="op" id="7452446">,</span>&nbsp;<span class="ident" id="7452448">headerBody</span><span class="op" id="7452458">{</span><span class="ident" id="7452459">p</span><span class="op" id="7452460">.</span><span class="ident" id="7452461">Header</span><span class="op" id="7452467">,</span>&nbsp;<span class="builtintype" id="7452469">string</span><span class="op" id="7452475">(</span><span class="ident" id="7452476">pbody</span><span class="op" id="7452481">)</span><span class="op" id="7452482">}</span><span class="op" id="7452483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452491">if</span>&nbsp;<span class="op" id="7452494">!</span><span class="ident" id="7452495">reflect</span><span class="op" id="7452502">.</span><span class="ident" id="7452503">DeepEqual</span><span class="op" id="7452512">(</span><span class="ident" id="7452513">tt</span><span class="op" id="7452515">.</span><span class="ident" id="7452516">want</span><span class="op" id="7452520">,</span>&nbsp;<span class="ident" id="7452522">got</span><span class="op" id="7452525">)</span>&nbsp;<span class="op" id="7452527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452532">t</span><span class="op" id="7452533">.</span><span class="ident" id="7452534">Errorf</span><span class="op" id="7452540">(</span><span class="string" id="7452541">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7452571">,</span>&nbsp;<span class="ident" id="7452573">tt</span><span class="op" id="7452575">.</span><span class="ident" id="7452576">name</span><span class="op" id="7452580">,</span>&nbsp;<span class="ident" id="7452582">got</span><span class="op" id="7452585">,</span>&nbsp;<span class="ident" id="7452587">tt</span><span class="op" id="7452589">.</span><span class="ident" id="7452590">want</span><span class="op" id="7452594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452599">if</span>&nbsp;<span class="builtinfunc" id="7452602">len</span><span class="op" id="7452605">(</span><span class="ident" id="7452606">tt</span><span class="op" id="7452608">.</span><span class="ident" id="7452609">want</span><span class="op" id="7452613">)</span>&nbsp;<span class="op" id="7452615">!=</span>&nbsp;<span class="builtinfunc" id="7452618">len</span><span class="op" id="7452621">(</span><span class="ident" id="7452622">got</span><span class="op" id="7452625">)</span>&nbsp;<span class="op" id="7452627">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452633">t</span><span class="op" id="7452634">.</span><span class="ident" id="7452635">Errorf</span><span class="op" id="7452641">(</span><span class="string" id="7452642">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7452674">,</span>&nbsp;<span class="ident" id="7452676">tt</span><span class="op" id="7452678">.</span><span class="ident" id="7452679">name</span><span class="op" id="7452683">,</span>&nbsp;<span class="builtinfunc" id="7452685">len</span><span class="op" id="7452688">(</span><span class="ident" id="7452689">got</span><span class="op" id="7452692">)</span><span class="op" id="7452693">,</span>&nbsp;<span class="builtinfunc" id="7452695">len</span><span class="op" id="7452698">(</span><span class="ident" id="7452699">tt</span><span class="op" id="7452701">.</span><span class="ident" id="7452702">want</span><span class="op" id="7452706">)</span><span class="op" id="7452707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452712">}</span>&nbsp;<span class="keyword" id="7452714">else</span>&nbsp;<span class="keyword" id="7452719">if</span>&nbsp;<span class="builtinfunc" id="7452722">len</span><span class="op" id="7452725">(</span><span class="ident" id="7452726">got</span><span class="op" id="7452729">)</span>&nbsp;<span class="op" id="7452731">&gt;</span>&nbsp;<span class="num" id="7452733">1</span>&nbsp;<span class="op" id="7452735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452741">for</span>&nbsp;<span class="ident" id="7452745">pi</span><span class="op" id="7452747">,</span>&nbsp;<span class="ident" id="7452749">wantPart</span>&nbsp;<span class="op" id="7452758">:=</span>&nbsp;<span class="keyword" id="7452761">range</span>&nbsp;<span class="ident" id="7452767">tt</span><span class="op" id="7452769">.</span><span class="ident" id="7452770">want</span>&nbsp;<span class="op" id="7452775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452782">if</span>&nbsp;<span class="op" id="7452785">!</span><span class="ident" id="7452786">reflect</span><span class="op" id="7452793">.</span><span class="ident" id="7452794">DeepEqual</span><span class="op" id="7452803">(</span><span class="ident" id="7452804">wantPart</span><span class="op" id="7452812">,</span>&nbsp;<span class="ident" id="7452814">got</span><span class="op" id="7452817">[</span><span class="ident" id="7452818">pi</span><span class="op" id="7452820">]</span><span class="op" id="7452821">)</span>&nbsp;<span class="op" id="7452823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452831">t</span><span class="op" id="7452832">.</span><span class="ident" id="7452833">Errorf</span><span class="op" id="7452839">(</span><span class="string" id="7452840">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7452879">,</span>&nbsp;<span class="ident" id="7452881">tt</span><span class="op" id="7452883">.</span><span class="ident" id="7452884">name</span><span class="op" id="7452888">,</span>&nbsp;<span class="ident" id="7452890">pi</span><span class="op" id="7452892">,</span>&nbsp;<span class="ident" id="7452894">got</span><span class="op" id="7452897">[</span><span class="ident" id="7452898">pi</span><span class="op" id="7452900">]</span><span class="op" id="7452901">,</span>&nbsp;<span class="ident" id="7452903">wantPart</span><span class="op" id="7452911">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452936">}</span><br>
<span class="lineno">605</span><span class="op" id="7452938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7452941">func</span>&nbsp;<span class="ident" id="7452946">roundTripParseTest</span><span class="op" id="7452964">(</span><span class="op" id="7452965">)</span>&nbsp;<span class="ident" id="7452967">parseTest</span>&nbsp;<span class="op" id="7452977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452980">t</span>&nbsp;<span class="op" id="7452982">:=</span>&nbsp;<span class="ident" id="7452985">parseTest</span><span class="op" id="7452994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452998">name</span><span class="op" id="7453002">:</span>&nbsp;<span class="string" id="7453004">&#34;round&nbsp;trip&#34;</span><span class="op" id="7453016">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453020">want</span><span class="op" id="7453024">:</span>&nbsp;<span class="op" id="7453026">[</span><span class="op" id="7453027">]</span><span class="ident" id="7453028">headerBody</span><span class="op" id="7453038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453043">formData</span><span class="op" id="7453051">(</span><span class="string" id="7453052">&#34;empty&#34;</span><span class="op" id="7453059">,</span>&nbsp;<span class="string" id="7453061">&#34;&#34;</span><span class="op" id="7453063">)</span><span class="op" id="7453064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453069">formData</span><span class="op" id="7453077">(</span><span class="string" id="7453078">&#34;lf&#34;</span><span class="op" id="7453082">,</span>&nbsp;<span class="string" id="7453084">&#34;\n&#34;</span><span class="op" id="7453088">)</span><span class="op" id="7453089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453094">formData</span><span class="op" id="7453102">(</span><span class="string" id="7453103">&#34;cr&#34;</span><span class="op" id="7453107">,</span>&nbsp;<span class="string" id="7453109">&#34;\r&#34;</span><span class="op" id="7453113">)</span><span class="op" id="7453114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453119">formData</span><span class="op" id="7453127">(</span><span class="string" id="7453128">&#34;crlf&#34;</span><span class="op" id="7453134">,</span>&nbsp;<span class="string" id="7453136">&#34;\r\n&#34;</span><span class="op" id="7453142">)</span><span class="op" id="7453143">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453148">formData</span><span class="op" id="7453156">(</span><span class="string" id="7453157">&#34;foo&#34;</span><span class="op" id="7453162">,</span>&nbsp;<span class="string" id="7453164">&#34;bar&#34;</span><span class="op" id="7453169">)</span><span class="op" id="7453170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453174">}</span><span class="op" id="7453175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453181">var</span>&nbsp;<span class="ident" id="7453185">buf</span>&nbsp;<span class="ident" id="7453189">bytes</span><span class="op" id="7453194">.</span><span class="ident" id="7453195">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453203">w</span>&nbsp;<span class="op" id="7453205">:=</span>&nbsp;<span class="ident" id="7453208">NewWriter</span><span class="op" id="7453217">(</span><span class="op" id="7453218">&amp;</span><span class="ident" id="7453219">buf</span><span class="op" id="7453222">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453225">for</span>&nbsp;<span class="ident" id="7453229">_</span><span class="op" id="7453230">,</span>&nbsp;<span class="ident" id="7453232">p</span>&nbsp;<span class="op" id="7453234">:=</span>&nbsp;<span class="keyword" id="7453237">range</span>&nbsp;<span class="ident" id="7453243">t</span><span class="op" id="7453244">.</span><span class="ident" id="7453245">want</span>&nbsp;<span class="op" id="7453250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453254">pw</span><span class="op" id="7453256">,</span>&nbsp;<span class="ident" id="7453258">err</span>&nbsp;<span class="op" id="7453262">:=</span>&nbsp;<span class="ident" id="7453265">w</span><span class="op" id="7453266">.</span><span class="ident" id="7453267">CreatePart</span><span class="op" id="7453277">(</span><span class="ident" id="7453278">p</span><span class="op" id="7453279">.</span><span class="ident" id="7453280">header</span><span class="op" id="7453286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453290">if</span>&nbsp;<span class="ident" id="7453293">err</span>&nbsp;<span class="op" id="7453297">!=</span>&nbsp;<span class="ident" id="7453300">nil</span>&nbsp;<span class="op" id="7453304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7453309">panic</span><span class="op" id="7453314">(</span><span class="ident" id="7453315">err</span><span class="op" id="7453318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453322">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453326">_</span><span class="op" id="7453327">,</span>&nbsp;<span class="ident" id="7453329">err</span>&nbsp;<span class="op" id="7453333">=</span>&nbsp;<span class="ident" id="7453335">pw</span><span class="op" id="7453337">.</span><span class="ident" id="7453338">Write</span><span class="op" id="7453343">(</span><span class="op" id="7453344">[</span><span class="op" id="7453345">]</span><span class="builtintype" id="7453346">byte</span><span class="op" id="7453350">(</span><span class="ident" id="7453351">p</span><span class="op" id="7453352">.</span><span class="ident" id="7453353">body</span><span class="op" id="7453357">)</span><span class="op" id="7453358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453362">if</span>&nbsp;<span class="ident" id="7453365">err</span>&nbsp;<span class="op" id="7453369">!=</span>&nbsp;<span class="ident" id="7453372">nil</span>&nbsp;<span class="op" id="7453376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7453381">panic</span><span class="op" id="7453386">(</span><span class="ident" id="7453387">err</span><span class="op" id="7453390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453397">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453400">w</span><span class="op" id="7453401">.</span><span class="ident" id="7453402">Close</span><span class="op" id="7453407">(</span><span class="op" id="7453408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453411">t</span><span class="op" id="7453412">.</span><span class="ident" id="7453413">in</span>&nbsp;<span class="op" id="7453416">=</span>&nbsp;<span class="ident" id="7453418">buf</span><span class="op" id="7453421">.</span><span class="ident" id="7453422">String</span><span class="op" id="7453428">(</span><span class="op" id="7453429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453432">t</span><span class="op" id="7453433">.</span><span class="ident" id="7453434">sep</span>&nbsp;<span class="op" id="7453438">=</span>&nbsp;<span class="ident" id="7453440">w</span><span class="op" id="7453441">.</span><span class="ident" id="7453442">Boundary</span><span class="op" id="7453450">(</span><span class="op" id="7453451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453454">return</span>&nbsp;<span class="ident" id="7453461">t</span><br>
<span class="lineno"></span><span class="op" id="7453463">}</span>
</div>
</body>
</html>
