<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6068049">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6068104">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6068158">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6068209">package</span>&nbsp;<span class="ident" id="6068217">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6068223">import</span>&nbsp;<span class="op" id="6068230">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068233">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068248">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068262">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068272">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6068278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6068281">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6068341">type</span>&nbsp;<span class="ident" id="6068346">Auth</span>&nbsp;<span class="keyword" id="6068351">interface</span>&nbsp;<span class="op" id="6068361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068364">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068414">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068469">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068532">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068594">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068641">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068699">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6068757">Start</span><span class="op" id="6068762">(</span><span class="ident" id="6068763">server</span>&nbsp;<span class="op" id="6068770">*</span><span class="ident" id="6068771">ServerInfo</span><span class="op" id="6068781">)</span>&nbsp;<span class="op" id="6068783">(</span><span class="ident" id="6068784">proto</span>&nbsp;<span class="builtintype" id="6068790">string</span><span class="op" id="6068796">,</span>&nbsp;<span class="ident" id="6068798">toServer</span>&nbsp;<span class="op" id="6068807">[</span><span class="op" id="6068808">]</span><span class="builtintype" id="6068809">byte</span><span class="op" id="6068813">,</span>&nbsp;<span class="ident" id="6068815">err</span>&nbsp;<span class="builtintype" id="6068819">error</span><span class="op" id="6068824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068828">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068892">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068955">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069017">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069057">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069117">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069175">Next</span><span class="op" id="6069179">(</span><span class="ident" id="6069180">fromServer</span>&nbsp;<span class="op" id="6069191">[</span><span class="op" id="6069192">]</span><span class="builtintype" id="6069193">byte</span><span class="op" id="6069197">,</span>&nbsp;<span class="ident" id="6069199">more</span>&nbsp;<span class="builtintype" id="6069204">bool</span><span class="op" id="6069208">)</span>&nbsp;<span class="op" id="6069210">(</span><span class="ident" id="6069211">toServer</span>&nbsp;<span class="op" id="6069220">[</span><span class="op" id="6069221">]</span><span class="builtintype" id="6069222">byte</span><span class="op" id="6069226">,</span>&nbsp;<span class="ident" id="6069228">err</span>&nbsp;<span class="builtintype" id="6069232">error</span><span class="op" id="6069237">)</span><br>
<span class="lineno"></span><span class="op" id="6069239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069242">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6069298">type</span>&nbsp;<span class="ident" id="6069303">ServerInfo</span>&nbsp;<span class="keyword" id="6069314">struct</span>&nbsp;<span class="op" id="6069321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069324">Name</span>&nbsp;<span class="builtintype" id="6069329">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6069338">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069359">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6069364">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069373">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069420">Auth</span>&nbsp;<span class="op" id="6069425">[</span><span class="op" id="6069426">]</span><span class="builtintype" id="6069427">string</span>&nbsp;<span class="comment" id="6069434">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6069474">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6069477">type</span>&nbsp;<span class="ident" id="6069482">plainAuth</span>&nbsp;<span class="keyword" id="6069492">struct</span>&nbsp;<span class="op" id="6069499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069502">identity</span><span class="op" id="6069510">,</span>&nbsp;<span class="ident" id="6069512">username</span><span class="op" id="6069520">,</span>&nbsp;<span class="ident" id="6069522">password</span>&nbsp;<span class="builtintype" id="6069531">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069539">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069568">string</span><br>
<span class="lineno"></span><span class="op" id="6069575">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6069578">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6069648">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6069685">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6069759">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6069835">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6069869">func</span>&nbsp;<span class="ident" id="6069874">PlainAuth</span><span class="op" id="6069883">(</span><span class="ident" id="6069884">identity</span><span class="op" id="6069892">,</span>&nbsp;<span class="ident" id="6069894">username</span><span class="op" id="6069902">,</span>&nbsp;<span class="ident" id="6069904">password</span><span class="op" id="6069912">,</span>&nbsp;<span class="ident" id="6069914">host</span>&nbsp;<span class="builtintype" id="6069919">string</span><span class="op" id="6069925">)</span>&nbsp;<span class="ident" id="6069927">Auth</span>&nbsp;<span class="op" id="6069932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6069935">return</span>&nbsp;<span class="op" id="6069942">&amp;</span><span class="ident" id="6069943">plainAuth</span><span class="op" id="6069952">{</span><span class="ident" id="6069953">identity</span><span class="op" id="6069961">,</span>&nbsp;<span class="ident" id="6069963">username</span><span class="op" id="6069971">,</span>&nbsp;<span class="ident" id="6069973">password</span><span class="op" id="6069981">,</span>&nbsp;<span class="ident" id="6069983">host</span><span class="op" id="6069987">}</span><br>
<span class="lineno"></span><span class="op" id="6069989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6069992">func</span>&nbsp;<span class="op" id="6069997">(</span><span class="ident" id="6069998">a</span>&nbsp;<span class="op" id="6070000">*</span><span class="ident" id="6070001">plainAuth</span><span class="op" id="6070010">)</span>&nbsp;<span class="ident" id="6070012">Start</span><span class="op" id="6070017">(</span><span class="ident" id="6070018">server</span>&nbsp;<span class="op" id="6070025">*</span><span class="ident" id="6070026">ServerInfo</span><span class="op" id="6070036">)</span>&nbsp;<span class="op" id="6070038">(</span><span class="builtintype" id="6070039">string</span><span class="op" id="6070045">,</span>&nbsp;<span class="op" id="6070047">[</span><span class="op" id="6070048">]</span><span class="builtintype" id="6070049">byte</span><span class="op" id="6070053">,</span>&nbsp;<span class="builtintype" id="6070055">error</span><span class="op" id="6070060">)</span>&nbsp;<span class="op" id="6070062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070065">if</span>&nbsp;<span class="op" id="6070068">!</span><span class="ident" id="6070069">server</span><span class="op" id="6070075">.</span><span class="ident" id="6070076">TLS</span>&nbsp;<span class="op" id="6070080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070084">advertised</span>&nbsp;<span class="op" id="6070095">:=</span>&nbsp;<span class="builtintype" id="6070098">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070106">for</span>&nbsp;<span class="ident" id="6070110">_</span><span class="op" id="6070111">,</span>&nbsp;<span class="ident" id="6070113">mechanism</span>&nbsp;<span class="op" id="6070123">:=</span>&nbsp;<span class="keyword" id="6070126">range</span>&nbsp;<span class="ident" id="6070132">server</span><span class="op" id="6070138">.</span><span class="ident" id="6070139">Auth</span>&nbsp;<span class="op" id="6070144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070149">if</span>&nbsp;<span class="ident" id="6070152">mechanism</span>&nbsp;<span class="op" id="6070162">==</span>&nbsp;<span class="string" id="6070165">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6070173">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070179">advertised</span>&nbsp;<span class="op" id="6070190">=</span>&nbsp;<span class="builtintype" id="6070192">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070201">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070218">if</span>&nbsp;<span class="op" id="6070221">!</span><span class="ident" id="6070222">advertised</span>&nbsp;<span class="op" id="6070233">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070238">return</span>&nbsp;<span class="string" id="6070245">&#34;&#34;</span><span class="op" id="6070247">,</span>&nbsp;<span class="builtintype" id="6070249">nil</span><span class="op" id="6070252">,</span>&nbsp;<span class="ident" id="6070254">errors</span><span class="op" id="6070260">.</span><span class="ident" id="6070261">New</span><span class="op" id="6070264">(</span><span class="string" id="6070265">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6070289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070299">if</span>&nbsp;<span class="ident" id="6070302">server</span><span class="op" id="6070308">.</span><span class="ident" id="6070309">Name</span>&nbsp;<span class="op" id="6070314">!=</span>&nbsp;<span class="ident" id="6070317">a</span><span class="op" id="6070318">.</span><span class="ident" id="6070319">host</span>&nbsp;<span class="op" id="6070324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070328">return</span>&nbsp;<span class="string" id="6070335">&#34;&#34;</span><span class="op" id="6070337">,</span>&nbsp;<span class="builtintype" id="6070339">nil</span><span class="op" id="6070342">,</span>&nbsp;<span class="ident" id="6070344">errors</span><span class="op" id="6070350">.</span><span class="ident" id="6070351">New</span><span class="op" id="6070354">(</span><span class="string" id="6070355">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6070372">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070378">resp</span>&nbsp;<span class="op" id="6070383">:=</span>&nbsp;<span class="op" id="6070386">[</span><span class="op" id="6070387">]</span><span class="builtintype" id="6070388">byte</span><span class="op" id="6070392">(</span><span class="ident" id="6070393">a</span><span class="op" id="6070394">.</span><span class="ident" id="6070395">identity</span>&nbsp;<span class="op" id="6070404">+</span>&nbsp;<span class="string" id="6070406">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6070413">+</span>&nbsp;<span class="ident" id="6070415">a</span><span class="op" id="6070416">.</span><span class="ident" id="6070417">username</span>&nbsp;<span class="op" id="6070426">+</span>&nbsp;<span class="string" id="6070428">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6070435">+</span>&nbsp;<span class="ident" id="6070437">a</span><span class="op" id="6070438">.</span><span class="ident" id="6070439">password</span><span class="op" id="6070447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070450">return</span>&nbsp;<span class="string" id="6070457">&#34;PLAIN&#34;</span><span class="op" id="6070464">,</span>&nbsp;<span class="ident" id="6070466">resp</span><span class="op" id="6070470">,</span>&nbsp;<span class="builtintype" id="6070472">nil</span><br>
<span class="lineno"></span><span class="op" id="6070476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6070479">func</span>&nbsp;<span class="op" id="6070484">(</span><span class="ident" id="6070485">a</span>&nbsp;<span class="op" id="6070487">*</span><span class="ident" id="6070488">plainAuth</span><span class="op" id="6070497">)</span>&nbsp;<span class="ident" id="6070499">Next</span><span class="op" id="6070503">(</span><span class="ident" id="6070504">fromServer</span>&nbsp;<span class="op" id="6070515">[</span><span class="op" id="6070516">]</span><span class="builtintype" id="6070517">byte</span><span class="op" id="6070521">,</span>&nbsp;<span class="ident" id="6070523">more</span>&nbsp;<span class="builtintype" id="6070528">bool</span><span class="op" id="6070532">)</span>&nbsp;<span class="op" id="6070534">(</span><span class="op" id="6070535">[</span><span class="op" id="6070536">]</span><span class="builtintype" id="6070537">byte</span><span class="op" id="6070541">,</span>&nbsp;<span class="builtintype" id="6070543">error</span><span class="op" id="6070548">)</span>&nbsp;<span class="op" id="6070550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070553">if</span>&nbsp;<span class="ident" id="6070556">more</span>&nbsp;<span class="op" id="6070561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6070565">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070601">return</span>&nbsp;<span class="builtintype" id="6070608">nil</span><span class="op" id="6070611">,</span>&nbsp;<span class="ident" id="6070613">errors</span><span class="op" id="6070619">.</span><span class="ident" id="6070620">New</span><span class="op" id="6070623">(</span><span class="string" id="6070624">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6070653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070656">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070659">return</span>&nbsp;<span class="builtintype" id="6070666">nil</span><span class="op" id="6070669">,</span>&nbsp;<span class="builtintype" id="6070671">nil</span><br>
<span class="lineno"></span><span class="op" id="6070675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6070678">type</span>&nbsp;<span class="ident" id="6070683">cramMD5Auth</span>&nbsp;<span class="keyword" id="6070695">struct</span>&nbsp;<span class="op" id="6070702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070705">username</span><span class="op" id="6070713">,</span>&nbsp;<span class="ident" id="6070715">secret</span>&nbsp;<span class="builtintype" id="6070722">string</span><br>
<span class="lineno">85</span><span class="op" id="6070729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070732">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6070807">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6070844">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6070916">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6070973">func</span>&nbsp;<span class="ident" id="6070978">CRAMMD5Auth</span><span class="op" id="6070989">(</span><span class="ident" id="6070990">username</span><span class="op" id="6070998">,</span>&nbsp;<span class="ident" id="6071000">secret</span>&nbsp;<span class="builtintype" id="6071007">string</span><span class="op" id="6071013">)</span>&nbsp;<span class="ident" id="6071015">Auth</span>&nbsp;<span class="op" id="6071020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071023">return</span>&nbsp;<span class="op" id="6071030">&amp;</span><span class="ident" id="6071031">cramMD5Auth</span><span class="op" id="6071042">{</span><span class="ident" id="6071043">username</span><span class="op" id="6071051">,</span>&nbsp;<span class="ident" id="6071053">secret</span><span class="op" id="6071059">}</span><br>
<span class="lineno"></span><span class="op" id="6071061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6071064">func</span>&nbsp;<span class="op" id="6071069">(</span><span class="ident" id="6071070">a</span>&nbsp;<span class="op" id="6071072">*</span><span class="ident" id="6071073">cramMD5Auth</span><span class="op" id="6071084">)</span>&nbsp;<span class="ident" id="6071086">Start</span><span class="op" id="6071091">(</span><span class="ident" id="6071092">server</span>&nbsp;<span class="op" id="6071099">*</span><span class="ident" id="6071100">ServerInfo</span><span class="op" id="6071110">)</span>&nbsp;<span class="op" id="6071112">(</span><span class="builtintype" id="6071113">string</span><span class="op" id="6071119">,</span>&nbsp;<span class="op" id="6071121">[</span><span class="op" id="6071122">]</span><span class="builtintype" id="6071123">byte</span><span class="op" id="6071127">,</span>&nbsp;<span class="builtintype" id="6071129">error</span><span class="op" id="6071134">)</span>&nbsp;<span class="op" id="6071136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071139">return</span>&nbsp;<span class="string" id="6071146">&#34;CRAM-MD5&#34;</span><span class="op" id="6071156">,</span>&nbsp;<span class="builtintype" id="6071158">nil</span><span class="op" id="6071161">,</span>&nbsp;<span class="builtintype" id="6071163">nil</span><br>
<span class="lineno"></span><span class="op" id="6071167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6071170">func</span>&nbsp;<span class="op" id="6071175">(</span><span class="ident" id="6071176">a</span>&nbsp;<span class="op" id="6071178">*</span><span class="ident" id="6071179">cramMD5Auth</span><span class="op" id="6071190">)</span>&nbsp;<span class="ident" id="6071192">Next</span><span class="op" id="6071196">(</span><span class="ident" id="6071197">fromServer</span>&nbsp;<span class="op" id="6071208">[</span><span class="op" id="6071209">]</span><span class="builtintype" id="6071210">byte</span><span class="op" id="6071214">,</span>&nbsp;<span class="ident" id="6071216">more</span>&nbsp;<span class="builtintype" id="6071221">bool</span><span class="op" id="6071225">)</span>&nbsp;<span class="op" id="6071227">(</span><span class="op" id="6071228">[</span><span class="op" id="6071229">]</span><span class="builtintype" id="6071230">byte</span><span class="op" id="6071234">,</span>&nbsp;<span class="builtintype" id="6071236">error</span><span class="op" id="6071241">)</span>&nbsp;<span class="op" id="6071243">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071246">if</span>&nbsp;<span class="ident" id="6071249">more</span>&nbsp;<span class="op" id="6071254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071258">d</span>&nbsp;<span class="op" id="6071260">:=</span>&nbsp;<span class="ident" id="6071263">hmac</span><span class="op" id="6071267">.</span><span class="ident" id="6071268">New</span><span class="op" id="6071271">(</span><span class="ident" id="6071272">md5</span><span class="op" id="6071275">.</span><span class="ident" id="6071276">New</span><span class="op" id="6071279">,</span>&nbsp;<span class="op" id="6071281">[</span><span class="op" id="6071282">]</span><span class="builtintype" id="6071283">byte</span><span class="op" id="6071287">(</span><span class="ident" id="6071288">a</span><span class="op" id="6071289">.</span><span class="ident" id="6071290">secret</span><span class="op" id="6071296">)</span><span class="op" id="6071297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071301">d</span><span class="op" id="6071302">.</span><span class="ident" id="6071303">Write</span><span class="op" id="6071308">(</span><span class="ident" id="6071309">fromServer</span><span class="op" id="6071319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071323">s</span>&nbsp;<span class="op" id="6071325">:=</span>&nbsp;<span class="builtinfunc" id="6071328">make</span><span class="op" id="6071332">(</span><span class="op" id="6071333">[</span><span class="op" id="6071334">]</span><span class="builtintype" id="6071335">byte</span><span class="op" id="6071339">,</span>&nbsp;<span class="num" id="6071341">0</span><span class="op" id="6071342">,</span>&nbsp;<span class="ident" id="6071344">d</span><span class="op" id="6071345">.</span><span class="ident" id="6071346">Size</span><span class="op" id="6071350">(</span><span class="op" id="6071351">)</span><span class="op" id="6071352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071356">return</span>&nbsp;<span class="op" id="6071363">[</span><span class="op" id="6071364">]</span><span class="builtintype" id="6071365">byte</span><span class="op" id="6071369">(</span><span class="ident" id="6071370">fmt</span><span class="op" id="6071373">.</span><span class="ident" id="6071374">Sprintf</span><span class="op" id="6071381">(</span><span class="string" id="6071382">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6071389">,</span>&nbsp;<span class="ident" id="6071391">a</span><span class="op" id="6071392">.</span><span class="ident" id="6071393">username</span><span class="op" id="6071401">,</span>&nbsp;<span class="ident" id="6071403">d</span><span class="op" id="6071404">.</span><span class="ident" id="6071405">Sum</span><span class="op" id="6071408">(</span><span class="ident" id="6071409">s</span><span class="op" id="6071410">)</span><span class="op" id="6071411">)</span><span class="op" id="6071412">)</span><span class="op" id="6071413">,</span>&nbsp;<span class="builtintype" id="6071415">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071423">return</span>&nbsp;<span class="builtintype" id="6071430">nil</span><span class="op" id="6071433">,</span>&nbsp;<span class="builtintype" id="6071435">nil</span><br>
<span class="lineno"></span><span class="op" id="6071439">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
