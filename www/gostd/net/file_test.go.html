<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html" class="current">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6608810">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6608865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6608919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6608970">package</span>&nbsp;<span class="ident" id="6608978">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6608983">import</span>&nbsp;<span class="op" id="6608990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6608993">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6608999">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6609010">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6609021">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6609031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609034">type</span>&nbsp;<span class="ident" id="6609039">listenerFile</span>&nbsp;<span class="keyword" id="6609052">interface</span>&nbsp;<span class="op" id="6609062">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609065">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609075">File</span><span class="op" id="6609079">(</span><span class="op" id="6609080">)</span>&nbsp;<span class="op" id="6609082">(</span><span class="ident" id="6609083">f</span>&nbsp;<span class="op" id="6609085">*</span><span class="ident" id="6609086">os</span><span class="op" id="6609088">.</span><span class="ident" id="6609089">File</span><span class="op" id="6609093">,</span>&nbsp;<span class="ident" id="6609095">err</span>&nbsp;<span class="builtintype" id="6609099">error</span><span class="op" id="6609104">)</span><br>
<span class="lineno"></span><span class="op" id="6609106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609109">type</span>&nbsp;<span class="ident" id="6609114">packetConnFile</span>&nbsp;<span class="keyword" id="6609129">interface</span>&nbsp;<span class="op" id="6609139">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609142">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609154">File</span><span class="op" id="6609158">(</span><span class="op" id="6609159">)</span>&nbsp;<span class="op" id="6609161">(</span><span class="ident" id="6609162">f</span>&nbsp;<span class="op" id="6609164">*</span><span class="ident" id="6609165">os</span><span class="op" id="6609167">.</span><span class="ident" id="6609168">File</span><span class="op" id="6609172">,</span>&nbsp;<span class="ident" id="6609174">err</span>&nbsp;<span class="builtintype" id="6609178">error</span><span class="op" id="6609183">)</span><br>
<span class="lineno"></span><span class="op" id="6609185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609188">type</span>&nbsp;<span class="ident" id="6609193">connFile</span>&nbsp;<span class="keyword" id="6609202">interface</span>&nbsp;<span class="op" id="6609212">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609215">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609221">File</span><span class="op" id="6609225">(</span><span class="op" id="6609226">)</span>&nbsp;<span class="op" id="6609228">(</span><span class="ident" id="6609229">f</span>&nbsp;<span class="op" id="6609231">*</span><span class="ident" id="6609232">os</span><span class="op" id="6609234">.</span><span class="ident" id="6609235">File</span><span class="op" id="6609239">,</span>&nbsp;<span class="ident" id="6609241">err</span>&nbsp;<span class="builtintype" id="6609245">error</span><span class="op" id="6609250">)</span><br>
<span class="lineno"></span><span class="op" id="6609252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609255">func</span>&nbsp;<span class="ident" id="6609260">testFileListener</span><span class="op" id="6609276">(</span><span class="ident" id="6609277">t</span>&nbsp;<span class="op" id="6609279">*</span><span class="ident" id="6609280">testing</span><span class="op" id="6609287">.</span><span class="ident" id="6609288">T</span><span class="op" id="6609289">,</span>&nbsp;<span class="ident" id="6609291">net</span><span class="op" id="6609294">,</span>&nbsp;<span class="ident" id="6609296">laddr</span>&nbsp;<span class="builtintype" id="6609302">string</span><span class="op" id="6609308">)</span>&nbsp;<span class="op" id="6609310">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609313">switch</span>&nbsp;<span class="ident" id="6609320">net</span>&nbsp;<span class="op" id="6609324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609327">case</span>&nbsp;<span class="string" id="6609332">&#34;tcp&#34;</span><span class="op" id="6609337">,</span>&nbsp;<span class="string" id="6609339">&#34;tcp4&#34;</span><span class="op" id="6609345">,</span>&nbsp;<span class="string" id="6609347">&#34;tcp6&#34;</span><span class="op" id="6609353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609357">laddr</span>&nbsp;<span class="op" id="6609363">+=</span>&nbsp;<span class="string" id="6609366">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6609371">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609397">l</span><span class="op" id="6609398">,</span>&nbsp;<span class="ident" id="6609400">err</span>&nbsp;<span class="op" id="6609404">:=</span>&nbsp;<span class="ident" id="6609407">Listen</span><span class="op" id="6609413">(</span><span class="ident" id="6609414">net</span><span class="op" id="6609417">,</span>&nbsp;<span class="ident" id="6609419">laddr</span><span class="op" id="6609424">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609427">if</span>&nbsp;<span class="ident" id="6609430">err</span>&nbsp;<span class="op" id="6609434">!=</span>&nbsp;<span class="ident" id="6609437">nil</span>&nbsp;<span class="op" id="6609441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609445">t</span><span class="op" id="6609446">.</span><span class="ident" id="6609447">Fatalf</span><span class="op" id="6609453">(</span><span class="string" id="6609454">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609473">,</span>&nbsp;<span class="ident" id="6609475">err</span><span class="op" id="6609478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609484">defer</span>&nbsp;<span class="ident" id="6609490">l</span><span class="op" id="6609491">.</span><span class="ident" id="6609492">Close</span><span class="op" id="6609497">(</span><span class="op" id="6609498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609501">lf</span>&nbsp;<span class="op" id="6609504">:=</span>&nbsp;<span class="ident" id="6609507">l</span><span class="op" id="6609508">.</span><span class="op" id="6609509">(</span><span class="ident" id="6609510">listenerFile</span><span class="op" id="6609522">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609525">f</span><span class="op" id="6609526">,</span>&nbsp;<span class="ident" id="6609528">err</span>&nbsp;<span class="op" id="6609532">:=</span>&nbsp;<span class="ident" id="6609535">lf</span><span class="op" id="6609537">.</span><span class="ident" id="6609538">File</span><span class="op" id="6609542">(</span><span class="op" id="6609543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609546">if</span>&nbsp;<span class="ident" id="6609549">err</span>&nbsp;<span class="op" id="6609553">!=</span>&nbsp;<span class="ident" id="6609556">nil</span>&nbsp;<span class="op" id="6609560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609564">t</span><span class="op" id="6609565">.</span><span class="ident" id="6609566">Fatalf</span><span class="op" id="6609572">(</span><span class="string" id="6609573">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609590">,</span>&nbsp;<span class="ident" id="6609592">err</span><span class="op" id="6609595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609601">c</span><span class="op" id="6609602">,</span>&nbsp;<span class="ident" id="6609604">err</span>&nbsp;<span class="op" id="6609608">:=</span>&nbsp;<span class="ident" id="6609611">FileListener</span><span class="op" id="6609623">(</span><span class="ident" id="6609624">f</span><span class="op" id="6609625">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609628">if</span>&nbsp;<span class="ident" id="6609631">err</span>&nbsp;<span class="op" id="6609635">!=</span>&nbsp;<span class="ident" id="6609638">nil</span>&nbsp;<span class="op" id="6609642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609646">t</span><span class="op" id="6609647">.</span><span class="ident" id="6609648">Fatalf</span><span class="op" id="6609654">(</span><span class="string" id="6609655">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609680">,</span>&nbsp;<span class="ident" id="6609682">err</span><span class="op" id="6609685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609691">if</span>&nbsp;<span class="op" id="6609694">!</span><span class="ident" id="6609695">reflect</span><span class="op" id="6609702">.</span><span class="ident" id="6609703">DeepEqual</span><span class="op" id="6609712">(</span><span class="ident" id="6609713">l</span><span class="op" id="6609714">.</span><span class="ident" id="6609715">Addr</span><span class="op" id="6609719">(</span><span class="op" id="6609720">)</span><span class="op" id="6609721">,</span>&nbsp;<span class="ident" id="6609723">c</span><span class="op" id="6609724">.</span><span class="ident" id="6609725">Addr</span><span class="op" id="6609729">(</span><span class="op" id="6609730">)</span><span class="op" id="6609731">)</span>&nbsp;<span class="op" id="6609733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609737">t</span><span class="op" id="6609738">.</span><span class="ident" id="6609739">Fatalf</span><span class="op" id="6609745">(</span><span class="string" id="6609746">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6609775">,</span>&nbsp;<span class="ident" id="6609777">l</span><span class="op" id="6609778">.</span><span class="ident" id="6609779">Addr</span><span class="op" id="6609783">(</span><span class="op" id="6609784">)</span><span class="op" id="6609785">,</span>&nbsp;<span class="ident" id="6609787">c</span><span class="op" id="6609788">.</span><span class="ident" id="6609789">Addr</span><span class="op" id="6609793">(</span><span class="op" id="6609794">)</span><span class="op" id="6609795">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609801">if</span>&nbsp;<span class="ident" id="6609804">err</span>&nbsp;<span class="op" id="6609808">:=</span>&nbsp;<span class="ident" id="6609811">c</span><span class="op" id="6609812">.</span><span class="ident" id="6609813">Close</span><span class="op" id="6609818">(</span><span class="op" id="6609819">)</span><span class="op" id="6609820">;</span>&nbsp;<span class="ident" id="6609822">err</span>&nbsp;<span class="op" id="6609826">!=</span>&nbsp;<span class="ident" id="6609829">nil</span>&nbsp;<span class="op" id="6609833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609837">t</span><span class="op" id="6609838">.</span><span class="ident" id="6609839">Fatalf</span><span class="op" id="6609845">(</span><span class="string" id="6609846">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609864">,</span>&nbsp;<span class="ident" id="6609866">err</span><span class="op" id="6609869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6609875">if</span>&nbsp;<span class="ident" id="6609878">err</span>&nbsp;<span class="op" id="6609882">:=</span>&nbsp;<span class="ident" id="6609885">f</span><span class="op" id="6609886">.</span><span class="ident" id="6609887">Close</span><span class="op" id="6609892">(</span><span class="op" id="6609893">)</span><span class="op" id="6609894">;</span>&nbsp;<span class="ident" id="6609896">err</span>&nbsp;<span class="op" id="6609900">!=</span>&nbsp;<span class="ident" id="6609903">nil</span>&nbsp;<span class="op" id="6609907">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609911">t</span><span class="op" id="6609912">.</span><span class="ident" id="6609913">Fatalf</span><span class="op" id="6609919">(</span><span class="string" id="6609920">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6609938">,</span>&nbsp;<span class="ident" id="6609940">err</span><span class="op" id="6609943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6609946">}</span><br>
<span class="lineno"></span><span class="op" id="6609948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6609951">var</span>&nbsp;<span class="ident" id="6609955">fileListenerTests</span>&nbsp;<span class="op" id="6609973">=</span>&nbsp;<span class="op" id="6609975">[</span><span class="op" id="6609976">]</span><span class="keyword" id="6609977">struct</span>&nbsp;<span class="op" id="6609984">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6609987">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6609993">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6610001">laddr</span>&nbsp;<span class="builtintype" id="6610007">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6610015">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6610021">bool</span>&nbsp;<span class="comment" id="6610026">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6610067">linux</span>&nbsp;<span class="builtintype" id="6610073">bool</span>&nbsp;<span class="comment" id="6610078">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6610132">}</span><span class="op" id="6610133">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610136">{</span><span class="ident" id="6610137">net</span><span class="op" id="6610140">:</span>&nbsp;<span class="string" id="6610142">&#34;tcp&#34;</span><span class="op" id="6610147">,</span>&nbsp;<span class="ident" id="6610149">laddr</span><span class="op" id="6610154">:</span>&nbsp;<span class="string" id="6610156">&#34;&#34;</span><span class="op" id="6610158">}</span><span class="op" id="6610159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610162">{</span><span class="ident" id="6610163">net</span><span class="op" id="6610166">:</span>&nbsp;<span class="string" id="6610168">&#34;tcp&#34;</span><span class="op" id="6610173">,</span>&nbsp;<span class="ident" id="6610175">laddr</span><span class="op" id="6610180">:</span>&nbsp;<span class="string" id="6610182">&#34;0.0.0.0&#34;</span><span class="op" id="6610191">}</span><span class="op" id="6610192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610195">{</span><span class="ident" id="6610196">net</span><span class="op" id="6610199">:</span>&nbsp;<span class="string" id="6610201">&#34;tcp&#34;</span><span class="op" id="6610206">,</span>&nbsp;<span class="ident" id="6610208">laddr</span><span class="op" id="6610213">:</span>&nbsp;<span class="string" id="6610215">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6610233">}</span><span class="op" id="6610234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610237">{</span><span class="ident" id="6610238">net</span><span class="op" id="6610241">:</span>&nbsp;<span class="string" id="6610243">&#34;tcp&#34;</span><span class="op" id="6610248">,</span>&nbsp;<span class="ident" id="6610250">laddr</span><span class="op" id="6610255">:</span>&nbsp;<span class="string" id="6610257">&#34;[::]&#34;</span><span class="op" id="6610263">,</span>&nbsp;<span class="ident" id="6610265">ipv6</span><span class="op" id="6610269">:</span>&nbsp;<span class="builtintype" id="6610271">true</span><span class="op" id="6610275">}</span><span class="op" id="6610276">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610280">{</span><span class="ident" id="6610281">net</span><span class="op" id="6610284">:</span>&nbsp;<span class="string" id="6610286">&#34;tcp&#34;</span><span class="op" id="6610291">,</span>&nbsp;<span class="ident" id="6610293">laddr</span><span class="op" id="6610298">:</span>&nbsp;<span class="string" id="6610300">&#34;127.0.0.1&#34;</span><span class="op" id="6610311">}</span><span class="op" id="6610312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610315">{</span><span class="ident" id="6610316">net</span><span class="op" id="6610319">:</span>&nbsp;<span class="string" id="6610321">&#34;tcp&#34;</span><span class="op" id="6610326">,</span>&nbsp;<span class="ident" id="6610328">laddr</span><span class="op" id="6610333">:</span>&nbsp;<span class="string" id="6610335">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6610355">}</span><span class="op" id="6610356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610359">{</span><span class="ident" id="6610360">net</span><span class="op" id="6610363">:</span>&nbsp;<span class="string" id="6610365">&#34;tcp&#34;</span><span class="op" id="6610370">,</span>&nbsp;<span class="ident" id="6610372">laddr</span><span class="op" id="6610377">:</span>&nbsp;<span class="string" id="6610379">&#34;[::1]&#34;</span><span class="op" id="6610386">,</span>&nbsp;<span class="ident" id="6610388">ipv6</span><span class="op" id="6610392">:</span>&nbsp;<span class="builtintype" id="6610394">true</span><span class="op" id="6610398">}</span><span class="op" id="6610399">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610403">{</span><span class="ident" id="6610404">net</span><span class="op" id="6610407">:</span>&nbsp;<span class="string" id="6610409">&#34;tcp4&#34;</span><span class="op" id="6610415">,</span>&nbsp;<span class="ident" id="6610417">laddr</span><span class="op" id="6610422">:</span>&nbsp;<span class="string" id="6610424">&#34;&#34;</span><span class="op" id="6610426">}</span><span class="op" id="6610427">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610430">{</span><span class="ident" id="6610431">net</span><span class="op" id="6610434">:</span>&nbsp;<span class="string" id="6610436">&#34;tcp4&#34;</span><span class="op" id="6610442">,</span>&nbsp;<span class="ident" id="6610444">laddr</span><span class="op" id="6610449">:</span>&nbsp;<span class="string" id="6610451">&#34;0.0.0.0&#34;</span><span class="op" id="6610460">}</span><span class="op" id="6610461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610464">{</span><span class="ident" id="6610465">net</span><span class="op" id="6610468">:</span>&nbsp;<span class="string" id="6610470">&#34;tcp4&#34;</span><span class="op" id="6610476">,</span>&nbsp;<span class="ident" id="6610478">laddr</span><span class="op" id="6610483">:</span>&nbsp;<span class="string" id="6610485">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6610503">}</span><span class="op" id="6610504">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610508">{</span><span class="ident" id="6610509">net</span><span class="op" id="6610512">:</span>&nbsp;<span class="string" id="6610514">&#34;tcp4&#34;</span><span class="op" id="6610520">,</span>&nbsp;<span class="ident" id="6610522">laddr</span><span class="op" id="6610527">:</span>&nbsp;<span class="string" id="6610529">&#34;127.0.0.1&#34;</span><span class="op" id="6610540">}</span><span class="op" id="6610541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610544">{</span><span class="ident" id="6610545">net</span><span class="op" id="6610548">:</span>&nbsp;<span class="string" id="6610550">&#34;tcp4&#34;</span><span class="op" id="6610556">,</span>&nbsp;<span class="ident" id="6610558">laddr</span><span class="op" id="6610563">:</span>&nbsp;<span class="string" id="6610565">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6610585">}</span><span class="op" id="6610586">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610590">{</span><span class="ident" id="6610591">net</span><span class="op" id="6610594">:</span>&nbsp;<span class="string" id="6610596">&#34;tcp6&#34;</span><span class="op" id="6610602">,</span>&nbsp;<span class="ident" id="6610604">laddr</span><span class="op" id="6610609">:</span>&nbsp;<span class="string" id="6610611">&#34;&#34;</span><span class="op" id="6610613">,</span>&nbsp;<span class="ident" id="6610615">ipv6</span><span class="op" id="6610619">:</span>&nbsp;<span class="builtintype" id="6610621">true</span><span class="op" id="6610625">}</span><span class="op" id="6610626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610629">{</span><span class="ident" id="6610630">net</span><span class="op" id="6610633">:</span>&nbsp;<span class="string" id="6610635">&#34;tcp6&#34;</span><span class="op" id="6610641">,</span>&nbsp;<span class="ident" id="6610643">laddr</span><span class="op" id="6610648">:</span>&nbsp;<span class="string" id="6610650">&#34;[::]&#34;</span><span class="op" id="6610656">,</span>&nbsp;<span class="ident" id="6610658">ipv6</span><span class="op" id="6610662">:</span>&nbsp;<span class="builtintype" id="6610664">true</span><span class="op" id="6610668">}</span><span class="op" id="6610669">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610673">{</span><span class="ident" id="6610674">net</span><span class="op" id="6610677">:</span>&nbsp;<span class="string" id="6610679">&#34;tcp6&#34;</span><span class="op" id="6610685">,</span>&nbsp;<span class="ident" id="6610687">laddr</span><span class="op" id="6610692">:</span>&nbsp;<span class="string" id="6610694">&#34;[::1]&#34;</span><span class="op" id="6610701">,</span>&nbsp;<span class="ident" id="6610703">ipv6</span><span class="op" id="6610707">:</span>&nbsp;<span class="builtintype" id="6610709">true</span><span class="op" id="6610713">}</span><span class="op" id="6610714">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610718">{</span><span class="ident" id="6610719">net</span><span class="op" id="6610722">:</span>&nbsp;<span class="string" id="6610724">&#34;unix&#34;</span><span class="op" id="6610730">,</span>&nbsp;<span class="ident" id="6610732">laddr</span><span class="op" id="6610737">:</span>&nbsp;<span class="string" id="6610739">&#34;@gotest/net&#34;</span><span class="op" id="6610752">,</span>&nbsp;<span class="ident" id="6610754">linux</span><span class="op" id="6610759">:</span>&nbsp;<span class="builtintype" id="6610761">true</span><span class="op" id="6610765">}</span><span class="op" id="6610766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610769">{</span><span class="ident" id="6610770">net</span><span class="op" id="6610773">:</span>&nbsp;<span class="string" id="6610775">&#34;unixpacket&#34;</span><span class="op" id="6610787">,</span>&nbsp;<span class="ident" id="6610789">laddr</span><span class="op" id="6610794">:</span>&nbsp;<span class="string" id="6610796">&#34;@gotest/net&#34;</span><span class="op" id="6610809">,</span>&nbsp;<span class="ident" id="6610811">linux</span><span class="op" id="6610816">:</span>&nbsp;<span class="builtintype" id="6610818">true</span><span class="op" id="6610822">}</span><span class="op" id="6610823">,</span><br>
<span class="lineno"></span><span class="op" id="6610825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6610828">func</span>&nbsp;<span class="ident" id="6610833">TestFileListener</span><span class="op" id="6610849">(</span><span class="ident" id="6610850">t</span>&nbsp;<span class="op" id="6610852">*</span><span class="ident" id="6610853">testing</span><span class="op" id="6610860">.</span><span class="ident" id="6610861">T</span><span class="op" id="6610862">)</span>&nbsp;<span class="op" id="6610864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6610867">switch</span>&nbsp;<span class="ident" id="6610874">runtime</span><span class="op" id="6610881">.</span><span class="ident" id="6610882">GOOS</span>&nbsp;<span class="op" id="6610887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6610890">case</span>&nbsp;<span class="string" id="6610895">&#34;nacl&#34;</span><span class="op" id="6610901">,</span>&nbsp;<span class="string" id="6610903">&#34;windows&#34;</span><span class="op" id="6610912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6610916">t</span><span class="op" id="6610917">.</span><span class="ident" id="6610918">Skipf</span><span class="op" id="6610923">(</span><span class="string" id="6610924">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6610945">,</span>&nbsp;<span class="ident" id="6610947">runtime</span><span class="op" id="6610954">.</span><span class="ident" id="6610955">GOOS</span><span class="op" id="6610959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6610962">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6610966">for</span>&nbsp;<span class="ident" id="6610970">_</span><span class="op" id="6610971">,</span>&nbsp;<span class="ident" id="6610973">tt</span>&nbsp;<span class="op" id="6610976">:=</span>&nbsp;<span class="keyword" id="6610979">range</span>&nbsp;<span class="ident" id="6610985">fileListenerTests</span>&nbsp;<span class="op" id="6611003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611007">if</span>&nbsp;<span class="ident" id="6611010">skipServerTest</span><span class="op" id="6611024">(</span><span class="ident" id="6611025">tt</span><span class="op" id="6611027">.</span><span class="ident" id="6611028">net</span><span class="op" id="6611031">,</span>&nbsp;<span class="string" id="6611033">&#34;unix&#34;</span><span class="op" id="6611039">,</span>&nbsp;<span class="ident" id="6611041">tt</span><span class="op" id="6611043">.</span><span class="ident" id="6611044">laddr</span><span class="op" id="6611049">,</span>&nbsp;<span class="ident" id="6611051">tt</span><span class="op" id="6611053">.</span><span class="ident" id="6611054">ipv6</span><span class="op" id="6611058">,</span>&nbsp;<span class="builtintype" id="6611060">false</span><span class="op" id="6611065">,</span>&nbsp;<span class="ident" id="6611067">tt</span><span class="op" id="6611069">.</span><span class="ident" id="6611070">linux</span><span class="op" id="6611075">)</span>&nbsp;<span class="op" id="6611077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611082">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611093">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611097">if</span>&nbsp;<span class="ident" id="6611100">skipServerTest</span><span class="op" id="6611114">(</span><span class="ident" id="6611115">tt</span><span class="op" id="6611117">.</span><span class="ident" id="6611118">net</span><span class="op" id="6611121">,</span>&nbsp;<span class="string" id="6611123">&#34;unixpacket&#34;</span><span class="op" id="6611135">,</span>&nbsp;<span class="ident" id="6611137">tt</span><span class="op" id="6611139">.</span><span class="ident" id="6611140">laddr</span><span class="op" id="6611145">,</span>&nbsp;<span class="ident" id="6611147">tt</span><span class="op" id="6611149">.</span><span class="ident" id="6611150">ipv6</span><span class="op" id="6611154">,</span>&nbsp;<span class="builtintype" id="6611156">false</span><span class="op" id="6611161">,</span>&nbsp;<span class="ident" id="6611163">tt</span><span class="op" id="6611165">.</span><span class="ident" id="6611166">linux</span><span class="op" id="6611171">)</span>&nbsp;<span class="op" id="6611173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611193">testFileListener</span><span class="op" id="6611209">(</span><span class="ident" id="6611210">t</span><span class="op" id="6611211">,</span>&nbsp;<span class="ident" id="6611213">tt</span><span class="op" id="6611215">.</span><span class="ident" id="6611216">net</span><span class="op" id="6611219">,</span>&nbsp;<span class="ident" id="6611221">tt</span><span class="op" id="6611223">.</span><span class="ident" id="6611224">laddr</span><span class="op" id="6611229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611232">}</span><br>
<span class="lineno">105</span><span class="op" id="6611234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6611237">func</span>&nbsp;<span class="ident" id="6611242">testFilePacketConn</span><span class="op" id="6611260">(</span><span class="ident" id="6611261">t</span>&nbsp;<span class="op" id="6611263">*</span><span class="ident" id="6611264">testing</span><span class="op" id="6611271">.</span><span class="ident" id="6611272">T</span><span class="op" id="6611273">,</span>&nbsp;<span class="ident" id="6611275">pcf</span>&nbsp;<span class="ident" id="6611279">packetConnFile</span><span class="op" id="6611293">,</span>&nbsp;<span class="ident" id="6611295">listen</span>&nbsp;<span class="builtintype" id="6611302">bool</span><span class="op" id="6611306">)</span>&nbsp;<span class="op" id="6611308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611311">f</span><span class="op" id="6611312">,</span>&nbsp;<span class="ident" id="6611314">err</span>&nbsp;<span class="op" id="6611318">:=</span>&nbsp;<span class="ident" id="6611321">pcf</span><span class="op" id="6611324">.</span><span class="ident" id="6611325">File</span><span class="op" id="6611329">(</span><span class="op" id="6611330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611333">if</span>&nbsp;<span class="ident" id="6611336">err</span>&nbsp;<span class="op" id="6611340">!=</span>&nbsp;<span class="ident" id="6611343">nil</span>&nbsp;<span class="op" id="6611347">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611351">t</span><span class="op" id="6611352">.</span><span class="ident" id="6611353">Fatalf</span><span class="op" id="6611359">(</span><span class="string" id="6611360">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611377">,</span>&nbsp;<span class="ident" id="6611379">err</span><span class="op" id="6611382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611388">c</span><span class="op" id="6611389">,</span>&nbsp;<span class="ident" id="6611391">err</span>&nbsp;<span class="op" id="6611395">:=</span>&nbsp;<span class="ident" id="6611398">FilePacketConn</span><span class="op" id="6611412">(</span><span class="ident" id="6611413">f</span><span class="op" id="6611414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611417">if</span>&nbsp;<span class="ident" id="6611420">err</span>&nbsp;<span class="op" id="6611424">!=</span>&nbsp;<span class="ident" id="6611427">nil</span>&nbsp;<span class="op" id="6611431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611435">t</span><span class="op" id="6611436">.</span><span class="ident" id="6611437">Fatalf</span><span class="op" id="6611443">(</span><span class="string" id="6611444">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611471">,</span>&nbsp;<span class="ident" id="6611473">err</span><span class="op" id="6611476">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611482">if</span>&nbsp;<span class="op" id="6611485">!</span><span class="ident" id="6611486">reflect</span><span class="op" id="6611493">.</span><span class="ident" id="6611494">DeepEqual</span><span class="op" id="6611503">(</span><span class="ident" id="6611504">pcf</span><span class="op" id="6611507">.</span><span class="ident" id="6611508">LocalAddr</span><span class="op" id="6611517">(</span><span class="op" id="6611518">)</span><span class="op" id="6611519">,</span>&nbsp;<span class="ident" id="6611521">c</span><span class="op" id="6611522">.</span><span class="ident" id="6611523">LocalAddr</span><span class="op" id="6611532">(</span><span class="op" id="6611533">)</span><span class="op" id="6611534">)</span>&nbsp;<span class="op" id="6611536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611540">t</span><span class="op" id="6611541">.</span><span class="ident" id="6611542">Fatalf</span><span class="op" id="6611548">(</span><span class="string" id="6611549">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6611583">,</span>&nbsp;<span class="ident" id="6611585">pcf</span><span class="op" id="6611588">.</span><span class="ident" id="6611589">LocalAddr</span><span class="op" id="6611598">(</span><span class="op" id="6611599">)</span><span class="op" id="6611600">,</span>&nbsp;<span class="ident" id="6611602">c</span><span class="op" id="6611603">.</span><span class="ident" id="6611604">LocalAddr</span><span class="op" id="6611613">(</span><span class="op" id="6611614">)</span><span class="op" id="6611615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611621">if</span>&nbsp;<span class="ident" id="6611624">listen</span>&nbsp;<span class="op" id="6611631">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611635">if</span>&nbsp;<span class="ident" id="6611638">_</span><span class="op" id="6611639">,</span>&nbsp;<span class="ident" id="6611641">err</span>&nbsp;<span class="op" id="6611645">:=</span>&nbsp;<span class="ident" id="6611648">c</span><span class="op" id="6611649">.</span><span class="ident" id="6611650">WriteTo</span><span class="op" id="6611657">(</span><span class="op" id="6611658">[</span><span class="op" id="6611659">]</span><span class="builtintype" id="6611660">byte</span><span class="op" id="6611664">{</span><span class="op" id="6611665">}</span><span class="op" id="6611666">,</span>&nbsp;<span class="ident" id="6611668">c</span><span class="op" id="6611669">.</span><span class="ident" id="6611670">LocalAddr</span><span class="op" id="6611679">(</span><span class="op" id="6611680">)</span><span class="op" id="6611681">)</span><span class="op" id="6611682">;</span>&nbsp;<span class="ident" id="6611684">err</span>&nbsp;<span class="op" id="6611688">!=</span>&nbsp;<span class="ident" id="6611691">nil</span>&nbsp;<span class="op" id="6611695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611700">t</span><span class="op" id="6611701">.</span><span class="ident" id="6611702">Fatalf</span><span class="op" id="6611708">(</span><span class="string" id="6611709">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611729">,</span>&nbsp;<span class="ident" id="6611731">err</span><span class="op" id="6611734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611744">if</span>&nbsp;<span class="ident" id="6611747">err</span>&nbsp;<span class="op" id="6611751">:=</span>&nbsp;<span class="ident" id="6611754">c</span><span class="op" id="6611755">.</span><span class="ident" id="6611756">Close</span><span class="op" id="6611761">(</span><span class="op" id="6611762">)</span><span class="op" id="6611763">;</span>&nbsp;<span class="ident" id="6611765">err</span>&nbsp;<span class="op" id="6611769">!=</span>&nbsp;<span class="ident" id="6611772">nil</span>&nbsp;<span class="op" id="6611776">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611780">t</span><span class="op" id="6611781">.</span><span class="ident" id="6611782">Fatalf</span><span class="op" id="6611788">(</span><span class="string" id="6611789">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611807">,</span>&nbsp;<span class="ident" id="6611809">err</span><span class="op" id="6611812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611818">if</span>&nbsp;<span class="ident" id="6611821">err</span>&nbsp;<span class="op" id="6611825">:=</span>&nbsp;<span class="ident" id="6611828">f</span><span class="op" id="6611829">.</span><span class="ident" id="6611830">Close</span><span class="op" id="6611835">(</span><span class="op" id="6611836">)</span><span class="op" id="6611837">;</span>&nbsp;<span class="ident" id="6611839">err</span>&nbsp;<span class="op" id="6611843">!=</span>&nbsp;<span class="ident" id="6611846">nil</span>&nbsp;<span class="op" id="6611850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6611854">t</span><span class="op" id="6611855">.</span><span class="ident" id="6611856">Fatalf</span><span class="op" id="6611862">(</span><span class="string" id="6611863">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6611881">,</span>&nbsp;<span class="ident" id="6611883">err</span><span class="op" id="6611886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6611889">}</span><br>
<span class="lineno">130</span><span class="op" id="6611891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6611894">func</span>&nbsp;<span class="ident" id="6611899">testFilePacketConnListen</span><span class="op" id="6611923">(</span><span class="ident" id="6611924">t</span>&nbsp;<span class="op" id="6611926">*</span><span class="ident" id="6611927">testing</span><span class="op" id="6611934">.</span><span class="ident" id="6611935">T</span><span class="op" id="6611936">,</span>&nbsp;<span class="ident" id="6611938">net</span><span class="op" id="6611941">,</span>&nbsp;<span class="ident" id="6611943">laddr</span>&nbsp;<span class="builtintype" id="6611949">string</span><span class="op" id="6611955">)</span>&nbsp;<span class="op" id="6611957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611960">switch</span>&nbsp;<span class="ident" id="6611967">net</span>&nbsp;<span class="op" id="6611971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6611974">case</span>&nbsp;<span class="string" id="6611979">&#34;udp&#34;</span><span class="op" id="6611984">,</span>&nbsp;<span class="string" id="6611986">&#34;udp4&#34;</span><span class="op" id="6611992">,</span>&nbsp;<span class="string" id="6611994">&#34;udp6&#34;</span><span class="op" id="6612000">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612004">laddr</span>&nbsp;<span class="op" id="6612010">+=</span>&nbsp;<span class="string" id="6612013">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6612018">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612044">l</span><span class="op" id="6612045">,</span>&nbsp;<span class="ident" id="6612047">err</span>&nbsp;<span class="op" id="6612051">:=</span>&nbsp;<span class="ident" id="6612054">ListenPacket</span><span class="op" id="6612066">(</span><span class="ident" id="6612067">net</span><span class="op" id="6612070">,</span>&nbsp;<span class="ident" id="6612072">laddr</span><span class="op" id="6612077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612080">if</span>&nbsp;<span class="ident" id="6612083">err</span>&nbsp;<span class="op" id="6612087">!=</span>&nbsp;<span class="ident" id="6612090">nil</span>&nbsp;<span class="op" id="6612094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612098">t</span><span class="op" id="6612099">.</span><span class="ident" id="6612100">Fatalf</span><span class="op" id="6612106">(</span><span class="string" id="6612107">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612132">,</span>&nbsp;<span class="ident" id="6612134">err</span><span class="op" id="6612137">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612143">testFilePacketConn</span><span class="op" id="6612161">(</span><span class="ident" id="6612162">t</span><span class="op" id="6612163">,</span>&nbsp;<span class="ident" id="6612165">l</span><span class="op" id="6612166">.</span><span class="op" id="6612167">(</span><span class="ident" id="6612168">packetConnFile</span><span class="op" id="6612182">)</span><span class="op" id="6612183">,</span>&nbsp;<span class="builtintype" id="6612185">true</span><span class="op" id="6612189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612192">if</span>&nbsp;<span class="ident" id="6612195">err</span>&nbsp;<span class="op" id="6612199">:=</span>&nbsp;<span class="ident" id="6612202">l</span><span class="op" id="6612203">.</span><span class="ident" id="6612204">Close</span><span class="op" id="6612209">(</span><span class="op" id="6612210">)</span><span class="op" id="6612211">;</span>&nbsp;<span class="ident" id="6612213">err</span>&nbsp;<span class="op" id="6612217">!=</span>&nbsp;<span class="ident" id="6612220">nil</span>&nbsp;<span class="op" id="6612224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612228">t</span><span class="op" id="6612229">.</span><span class="ident" id="6612230">Fatalf</span><span class="op" id="6612236">(</span><span class="string" id="6612237">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612255">,</span>&nbsp;<span class="ident" id="6612257">err</span><span class="op" id="6612260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612263">}</span><br>
<span class="lineno">145</span><span class="op" id="6612265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6612268">func</span>&nbsp;<span class="ident" id="6612273">testFilePacketConnDial</span><span class="op" id="6612295">(</span><span class="ident" id="6612296">t</span>&nbsp;<span class="op" id="6612298">*</span><span class="ident" id="6612299">testing</span><span class="op" id="6612306">.</span><span class="ident" id="6612307">T</span><span class="op" id="6612308">,</span>&nbsp;<span class="ident" id="6612310">net</span><span class="op" id="6612313">,</span>&nbsp;<span class="ident" id="6612315">raddr</span>&nbsp;<span class="builtintype" id="6612321">string</span><span class="op" id="6612327">)</span>&nbsp;<span class="op" id="6612329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612332">switch</span>&nbsp;<span class="ident" id="6612339">net</span>&nbsp;<span class="op" id="6612343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612346">case</span>&nbsp;<span class="string" id="6612351">&#34;udp&#34;</span><span class="op" id="6612356">,</span>&nbsp;<span class="string" id="6612358">&#34;udp4&#34;</span><span class="op" id="6612364">,</span>&nbsp;<span class="string" id="6612366">&#34;udp6&#34;</span><span class="op" id="6612372">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612376">raddr</span>&nbsp;<span class="op" id="6612382">+=</span>&nbsp;<span class="string" id="6612385">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612398">c</span><span class="op" id="6612399">,</span>&nbsp;<span class="ident" id="6612401">err</span>&nbsp;<span class="op" id="6612405">:=</span>&nbsp;<span class="ident" id="6612408">Dial</span><span class="op" id="6612412">(</span><span class="ident" id="6612413">net</span><span class="op" id="6612416">,</span>&nbsp;<span class="ident" id="6612418">raddr</span><span class="op" id="6612423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612426">if</span>&nbsp;<span class="ident" id="6612429">err</span>&nbsp;<span class="op" id="6612433">!=</span>&nbsp;<span class="ident" id="6612436">nil</span>&nbsp;<span class="op" id="6612440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612444">t</span><span class="op" id="6612445">.</span><span class="ident" id="6612446">Fatalf</span><span class="op" id="6612452">(</span><span class="string" id="6612453">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612470">,</span>&nbsp;<span class="ident" id="6612472">err</span><span class="op" id="6612475">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612481">testFilePacketConn</span><span class="op" id="6612499">(</span><span class="ident" id="6612500">t</span><span class="op" id="6612501">,</span>&nbsp;<span class="ident" id="6612503">c</span><span class="op" id="6612504">.</span><span class="op" id="6612505">(</span><span class="ident" id="6612506">packetConnFile</span><span class="op" id="6612520">)</span><span class="op" id="6612521">,</span>&nbsp;<span class="builtintype" id="6612523">false</span><span class="op" id="6612528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6612531">if</span>&nbsp;<span class="ident" id="6612534">err</span>&nbsp;<span class="op" id="6612538">:=</span>&nbsp;<span class="ident" id="6612541">c</span><span class="op" id="6612542">.</span><span class="ident" id="6612543">Close</span><span class="op" id="6612548">(</span><span class="op" id="6612549">)</span><span class="op" id="6612550">;</span>&nbsp;<span class="ident" id="6612552">err</span>&nbsp;<span class="op" id="6612556">!=</span>&nbsp;<span class="ident" id="6612559">nil</span>&nbsp;<span class="op" id="6612563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612567">t</span><span class="op" id="6612568">.</span><span class="ident" id="6612569">Fatalf</span><span class="op" id="6612575">(</span><span class="string" id="6612576">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6612594">,</span>&nbsp;<span class="ident" id="6612596">err</span><span class="op" id="6612599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612602">}</span><br>
<span class="lineno">160</span><span class="op" id="6612604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6612607">var</span>&nbsp;<span class="ident" id="6612611">filePacketConnTests</span>&nbsp;<span class="op" id="6612631">=</span>&nbsp;<span class="op" id="6612633">[</span><span class="op" id="6612634">]</span><span class="keyword" id="6612635">struct</span>&nbsp;<span class="op" id="6612642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612645">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6612651">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612659">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6612665">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612673">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6612679">bool</span>&nbsp;<span class="comment" id="6612684">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6612725">linux</span>&nbsp;<span class="builtintype" id="6612731">bool</span>&nbsp;<span class="comment" id="6612736">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6612790">}</span><span class="op" id="6612791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612794">{</span><span class="ident" id="6612795">net</span><span class="op" id="6612798">:</span>&nbsp;<span class="string" id="6612800">&#34;udp&#34;</span><span class="op" id="6612805">,</span>&nbsp;<span class="ident" id="6612807">addr</span><span class="op" id="6612811">:</span>&nbsp;<span class="string" id="6612813">&#34;127.0.0.1&#34;</span><span class="op" id="6612824">}</span><span class="op" id="6612825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612828">{</span><span class="ident" id="6612829">net</span><span class="op" id="6612832">:</span>&nbsp;<span class="string" id="6612834">&#34;udp&#34;</span><span class="op" id="6612839">,</span>&nbsp;<span class="ident" id="6612841">addr</span><span class="op" id="6612845">:</span>&nbsp;<span class="string" id="6612847">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6612867">}</span><span class="op" id="6612868">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612871">{</span><span class="ident" id="6612872">net</span><span class="op" id="6612875">:</span>&nbsp;<span class="string" id="6612877">&#34;udp&#34;</span><span class="op" id="6612882">,</span>&nbsp;<span class="ident" id="6612884">addr</span><span class="op" id="6612888">:</span>&nbsp;<span class="string" id="6612890">&#34;[::1]&#34;</span><span class="op" id="6612897">,</span>&nbsp;<span class="ident" id="6612899">ipv6</span><span class="op" id="6612903">:</span>&nbsp;<span class="builtintype" id="6612905">true</span><span class="op" id="6612909">}</span><span class="op" id="6612910">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612914">{</span><span class="ident" id="6612915">net</span><span class="op" id="6612918">:</span>&nbsp;<span class="string" id="6612920">&#34;udp4&#34;</span><span class="op" id="6612926">,</span>&nbsp;<span class="ident" id="6612928">addr</span><span class="op" id="6612932">:</span>&nbsp;<span class="string" id="6612934">&#34;127.0.0.1&#34;</span><span class="op" id="6612945">}</span><span class="op" id="6612946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612949">{</span><span class="ident" id="6612950">net</span><span class="op" id="6612953">:</span>&nbsp;<span class="string" id="6612955">&#34;udp4&#34;</span><span class="op" id="6612961">,</span>&nbsp;<span class="ident" id="6612963">addr</span><span class="op" id="6612967">:</span>&nbsp;<span class="string" id="6612969">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6612989">}</span><span class="op" id="6612990">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6612994">{</span><span class="ident" id="6612995">net</span><span class="op" id="6612998">:</span>&nbsp;<span class="string" id="6613000">&#34;udp6&#34;</span><span class="op" id="6613006">,</span>&nbsp;<span class="ident" id="6613008">addr</span><span class="op" id="6613012">:</span>&nbsp;<span class="string" id="6613014">&#34;[::1]&#34;</span><span class="op" id="6613021">,</span>&nbsp;<span class="ident" id="6613023">ipv6</span><span class="op" id="6613027">:</span>&nbsp;<span class="builtintype" id="6613029">true</span><span class="op" id="6613033">}</span><span class="op" id="6613034">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613038">{</span><span class="ident" id="6613039">net</span><span class="op" id="6613042">:</span>&nbsp;<span class="string" id="6613044">&#34;ip4:icmp&#34;</span><span class="op" id="6613054">,</span>&nbsp;<span class="ident" id="6613056">addr</span><span class="op" id="6613060">:</span>&nbsp;<span class="string" id="6613062">&#34;127.0.0.1&#34;</span><span class="op" id="6613073">}</span><span class="op" id="6613074">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613078">{</span><span class="ident" id="6613079">net</span><span class="op" id="6613082">:</span>&nbsp;<span class="string" id="6613084">&#34;unixgram&#34;</span><span class="op" id="6613094">,</span>&nbsp;<span class="ident" id="6613096">addr</span><span class="op" id="6613100">:</span>&nbsp;<span class="string" id="6613102">&#34;@gotest3/net&#34;</span><span class="op" id="6613116">,</span>&nbsp;<span class="ident" id="6613118">linux</span><span class="op" id="6613123">:</span>&nbsp;<span class="builtintype" id="6613125">true</span><span class="op" id="6613129">}</span><span class="op" id="6613130">,</span><br>
<span class="lineno">180</span><span class="op" id="6613132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6613135">func</span>&nbsp;<span class="ident" id="6613140">TestFilePacketConn</span><span class="op" id="6613158">(</span><span class="ident" id="6613159">t</span>&nbsp;<span class="op" id="6613161">*</span><span class="ident" id="6613162">testing</span><span class="op" id="6613169">.</span><span class="ident" id="6613170">T</span><span class="op" id="6613171">)</span>&nbsp;<span class="op" id="6613173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613176">switch</span>&nbsp;<span class="ident" id="6613183">runtime</span><span class="op" id="6613190">.</span><span class="ident" id="6613191">GOOS</span>&nbsp;<span class="op" id="6613196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613199">case</span>&nbsp;<span class="string" id="6613204">&#34;nacl&#34;</span><span class="op" id="6613210">,</span>&nbsp;<span class="string" id="6613212">&#34;plan9&#34;</span><span class="op" id="6613219">,</span>&nbsp;<span class="string" id="6613221">&#34;windows&#34;</span><span class="op" id="6613230">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6613234">t</span><span class="op" id="6613235">.</span><span class="ident" id="6613236">Skipf</span><span class="op" id="6613241">(</span><span class="string" id="6613242">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6613263">,</span>&nbsp;<span class="ident" id="6613265">runtime</span><span class="op" id="6613272">.</span><span class="ident" id="6613273">GOOS</span><span class="op" id="6613277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613284">for</span>&nbsp;<span class="ident" id="6613288">_</span><span class="op" id="6613289">,</span>&nbsp;<span class="ident" id="6613291">tt</span>&nbsp;<span class="op" id="6613294">:=</span>&nbsp;<span class="keyword" id="6613297">range</span>&nbsp;<span class="ident" id="6613303">filePacketConnTests</span>&nbsp;<span class="op" id="6613323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613327">if</span>&nbsp;<span class="ident" id="6613330">skipServerTest</span><span class="op" id="6613344">(</span><span class="ident" id="6613345">tt</span><span class="op" id="6613347">.</span><span class="ident" id="6613348">net</span><span class="op" id="6613351">,</span>&nbsp;<span class="string" id="6613353">&#34;unixgram&#34;</span><span class="op" id="6613363">,</span>&nbsp;<span class="ident" id="6613365">tt</span><span class="op" id="6613367">.</span><span class="ident" id="6613368">addr</span><span class="op" id="6613372">,</span>&nbsp;<span class="ident" id="6613374">tt</span><span class="op" id="6613376">.</span><span class="ident" id="6613377">ipv6</span><span class="op" id="6613381">,</span>&nbsp;<span class="builtintype" id="6613383">false</span><span class="op" id="6613388">,</span>&nbsp;<span class="ident" id="6613390">tt</span><span class="op" id="6613392">.</span><span class="ident" id="6613393">linux</span><span class="op" id="6613398">)</span>&nbsp;<span class="op" id="6613400">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613405">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613420">if</span>&nbsp;<span class="ident" id="6613423">os</span><span class="op" id="6613425">.</span><span class="ident" id="6613426">Getuid</span><span class="op" id="6613432">(</span><span class="op" id="6613433">)</span>&nbsp;<span class="op" id="6613435">!=</span>&nbsp;<span class="num" id="6613438">0</span>&nbsp;<span class="op" id="6613440">&amp;&amp;</span>&nbsp;<span class="ident" id="6613443">tt</span><span class="op" id="6613445">.</span><span class="ident" id="6613446">net</span>&nbsp;<span class="op" id="6613450">==</span>&nbsp;<span class="string" id="6613453">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="6613464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6613469">t</span><span class="op" id="6613470">.</span><span class="ident" id="6613471">Log</span><span class="op" id="6613474">(</span><span class="string" id="6613475">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6613504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613509">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6613524">testFilePacketConnListen</span><span class="op" id="6613548">(</span><span class="ident" id="6613549">t</span><span class="op" id="6613550">,</span>&nbsp;<span class="ident" id="6613552">tt</span><span class="op" id="6613554">.</span><span class="ident" id="6613555">net</span><span class="op" id="6613558">,</span>&nbsp;<span class="ident" id="6613560">tt</span><span class="op" id="6613562">.</span><span class="ident" id="6613563">addr</span><span class="op" id="6613567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613571">switch</span>&nbsp;<span class="ident" id="6613578">tt</span><span class="op" id="6613580">.</span><span class="ident" id="6613581">addr</span>&nbsp;<span class="op" id="6613586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613590">case</span>&nbsp;<span class="string" id="6613595">&#34;&#34;</span><span class="op" id="6613597">,</span>&nbsp;<span class="string" id="6613599">&#34;0.0.0.0&#34;</span><span class="op" id="6613608">,</span>&nbsp;<span class="string" id="6613610">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6613628">,</span>&nbsp;<span class="string" id="6613630">&#34;[::]&#34;</span><span class="op" id="6613636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613640">default</span><span class="op" id="6613647">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6613652">if</span>&nbsp;<span class="ident" id="6613655">tt</span><span class="op" id="6613657">.</span><span class="ident" id="6613658">net</span>&nbsp;<span class="op" id="6613662">!=</span>&nbsp;<span class="string" id="6613665">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="6613676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6613682">testFilePacketConnDial</span><span class="op" id="6613704">(</span><span class="ident" id="6613705">t</span><span class="op" id="6613706">,</span>&nbsp;<span class="ident" id="6613708">tt</span><span class="op" id="6613710">.</span><span class="ident" id="6613711">net</span><span class="op" id="6613714">,</span>&nbsp;<span class="ident" id="6613716">tt</span><span class="op" id="6613718">.</span><span class="ident" id="6613719">addr</span><span class="op" id="6613723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6613735">}</span><br>
<span class="lineno">205</span><span class="op" id="6613737">}</span>
</div>
</body>
</html>
