<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html" class="current">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7033083">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7033139">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7033193">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7033244">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="7033313">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033326">package</span>&nbsp;<span class="ident" id="7033334">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7033340">import</span>&nbsp;<span class="op" id="7033347">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7033350">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7033357">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7033368">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7033375">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7033378">func</span>&nbsp;<span class="ident" id="7033383">NewLoggingConn</span><span class="op" id="7033397">(</span><span class="ident" id="7033398">baseName</span>&nbsp;<span class="builtintype" id="7033407">string</span><span class="op" id="7033413">,</span>&nbsp;<span class="ident" id="7033415">c</span>&nbsp;<span class="ident" id="7033417">net</span><span class="op" id="7033420">.</span><span class="ident" id="7033421">Conn</span><span class="op" id="7033425">)</span>&nbsp;<span class="ident" id="7033427">net</span><span class="op" id="7033430">.</span><span class="ident" id="7033431">Conn</span>&nbsp;<span class="op" id="7033436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033439">return</span>&nbsp;<span class="ident" id="7033446">newLoggingConn</span><span class="op" id="7033460">(</span><span class="ident" id="7033461">baseName</span><span class="op" id="7033469">,</span>&nbsp;<span class="ident" id="7033471">c</span><span class="op" id="7033472">)</span><br>
<span class="lineno"></span><span class="op" id="7033474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7033477">var</span>&nbsp;<span class="ident" id="7033481">ExportAppendTime</span>&nbsp;<span class="op" id="7033498">=</span>&nbsp;<span class="ident" id="7033500">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033512">func</span>&nbsp;<span class="op" id="7033517">(</span><span class="ident" id="7033518">t</span>&nbsp;<span class="op" id="7033520">*</span><span class="ident" id="7033521">Transport</span><span class="op" id="7033530">)</span>&nbsp;<span class="ident" id="7033532">NumPendingRequestsForTesting</span><span class="op" id="7033560">(</span><span class="op" id="7033561">)</span>&nbsp;<span class="builtintype" id="7033563">int</span>&nbsp;<span class="op" id="7033567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033570">t</span><span class="op" id="7033571">.</span><span class="ident" id="7033572">reqMu</span><span class="op" id="7033577">.</span><span class="ident" id="7033578">Lock</span><span class="op" id="7033582">(</span><span class="op" id="7033583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033586">defer</span>&nbsp;<span class="ident" id="7033592">t</span><span class="op" id="7033593">.</span><span class="ident" id="7033594">reqMu</span><span class="op" id="7033599">.</span><span class="ident" id="7033600">Unlock</span><span class="op" id="7033606">(</span><span class="op" id="7033607">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033610">return</span>&nbsp;<span class="builtinfunc" id="7033617">len</span><span class="op" id="7033620">(</span><span class="ident" id="7033621">t</span><span class="op" id="7033622">.</span><span class="ident" id="7033623">reqCanceler</span><span class="op" id="7033634">)</span><br>
<span class="lineno"></span><span class="op" id="7033636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033639">func</span>&nbsp;<span class="op" id="7033644">(</span><span class="ident" id="7033645">t</span>&nbsp;<span class="op" id="7033647">*</span><span class="ident" id="7033648">Transport</span><span class="op" id="7033657">)</span>&nbsp;<span class="ident" id="7033659">IdleConnKeysForTesting</span><span class="op" id="7033681">(</span><span class="op" id="7033682">)</span>&nbsp;<span class="op" id="7033684">(</span><span class="ident" id="7033685">keys</span>&nbsp;<span class="op" id="7033690">[</span><span class="op" id="7033691">]</span><span class="builtintype" id="7033692">string</span><span class="op" id="7033698">)</span>&nbsp;<span class="op" id="7033700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033703">keys</span>&nbsp;<span class="op" id="7033708">=</span>&nbsp;<span class="builtinfunc" id="7033710">make</span><span class="op" id="7033714">(</span><span class="op" id="7033715">[</span><span class="op" id="7033716">]</span><span class="builtintype" id="7033717">string</span><span class="op" id="7033723">,</span>&nbsp;<span class="num" id="7033725">0</span><span class="op" id="7033726">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033729">t</span><span class="op" id="7033730">.</span><span class="ident" id="7033731">idleMu</span><span class="op" id="7033737">.</span><span class="ident" id="7033738">Lock</span><span class="op" id="7033742">(</span><span class="op" id="7033743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033746">defer</span>&nbsp;<span class="ident" id="7033752">t</span><span class="op" id="7033753">.</span><span class="ident" id="7033754">idleMu</span><span class="op" id="7033760">.</span><span class="ident" id="7033761">Unlock</span><span class="op" id="7033767">(</span><span class="op" id="7033768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033771">if</span>&nbsp;<span class="ident" id="7033774">t</span><span class="op" id="7033775">.</span><span class="ident" id="7033776">idleConn</span>&nbsp;<span class="op" id="7033785">==</span>&nbsp;<span class="ident" id="7033788">nil</span>&nbsp;<span class="op" id="7033792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033796">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033804">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033807">for</span>&nbsp;<span class="ident" id="7033811">key</span>&nbsp;<span class="op" id="7033815">:=</span>&nbsp;<span class="keyword" id="7033818">range</span>&nbsp;<span class="ident" id="7033824">t</span><span class="op" id="7033825">.</span><span class="ident" id="7033826">idleConn</span>&nbsp;<span class="op" id="7033835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033839">keys</span>&nbsp;<span class="op" id="7033844">=</span>&nbsp;<span class="builtinfunc" id="7033846">append</span><span class="op" id="7033852">(</span><span class="ident" id="7033853">keys</span><span class="op" id="7033857">,</span>&nbsp;<span class="ident" id="7033859">key</span><span class="op" id="7033862">.</span><span class="ident" id="7033863">String</span><span class="op" id="7033869">(</span><span class="op" id="7033870">)</span><span class="op" id="7033871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7033874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033877">return</span><br>
<span class="lineno"></span><span class="op" id="7033884">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7033887">func</span>&nbsp;<span class="op" id="7033892">(</span><span class="ident" id="7033893">t</span>&nbsp;<span class="op" id="7033895">*</span><span class="ident" id="7033896">Transport</span><span class="op" id="7033905">)</span>&nbsp;<span class="ident" id="7033907">IdleConnCountForTesting</span><span class="op" id="7033930">(</span><span class="ident" id="7033931">cacheKey</span>&nbsp;<span class="builtintype" id="7033940">string</span><span class="op" id="7033946">)</span>&nbsp;<span class="builtintype" id="7033948">int</span>&nbsp;<span class="op" id="7033952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7033955">t</span><span class="op" id="7033956">.</span><span class="ident" id="7033957">idleMu</span><span class="op" id="7033963">.</span><span class="ident" id="7033964">Lock</span><span class="op" id="7033968">(</span><span class="op" id="7033969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033972">defer</span>&nbsp;<span class="ident" id="7033978">t</span><span class="op" id="7033979">.</span><span class="ident" id="7033980">idleMu</span><span class="op" id="7033986">.</span><span class="ident" id="7033987">Unlock</span><span class="op" id="7033993">(</span><span class="op" id="7033994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033997">if</span>&nbsp;<span class="ident" id="7034000">t</span><span class="op" id="7034001">.</span><span class="ident" id="7034002">idleConn</span>&nbsp;<span class="op" id="7034011">==</span>&nbsp;<span class="ident" id="7034014">nil</span>&nbsp;<span class="op" id="7034018">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034022">return</span>&nbsp;<span class="num" id="7034029">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034035">for</span>&nbsp;<span class="ident" id="7034039">k</span><span class="op" id="7034040">,</span>&nbsp;<span class="ident" id="7034042">conns</span>&nbsp;<span class="op" id="7034048">:=</span>&nbsp;<span class="keyword" id="7034051">range</span>&nbsp;<span class="ident" id="7034057">t</span><span class="op" id="7034058">.</span><span class="ident" id="7034059">idleConn</span>&nbsp;<span class="op" id="7034068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034072">if</span>&nbsp;<span class="ident" id="7034075">k</span><span class="op" id="7034076">.</span><span class="ident" id="7034077">String</span><span class="op" id="7034083">(</span><span class="op" id="7034084">)</span>&nbsp;<span class="op" id="7034086">==</span>&nbsp;<span class="ident" id="7034089">cacheKey</span>&nbsp;<span class="op" id="7034098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034103">return</span>&nbsp;<span class="builtinfunc" id="7034110">len</span><span class="op" id="7034113">(</span><span class="ident" id="7034114">conns</span><span class="op" id="7034119">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034129">return</span>&nbsp;<span class="num" id="7034136">0</span><br>
<span class="lineno"></span><span class="op" id="7034138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7034141">func</span>&nbsp;<span class="op" id="7034146">(</span><span class="ident" id="7034147">t</span>&nbsp;<span class="op" id="7034149">*</span><span class="ident" id="7034150">Transport</span><span class="op" id="7034159">)</span>&nbsp;<span class="ident" id="7034161">IdleConnChMapSizeForTesting</span><span class="op" id="7034188">(</span><span class="op" id="7034189">)</span>&nbsp;<span class="builtintype" id="7034191">int</span>&nbsp;<span class="op" id="7034195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034198">t</span><span class="op" id="7034199">.</span><span class="ident" id="7034200">idleMu</span><span class="op" id="7034206">.</span><span class="ident" id="7034207">Lock</span><span class="op" id="7034211">(</span><span class="op" id="7034212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034215">defer</span>&nbsp;<span class="ident" id="7034221">t</span><span class="op" id="7034222">.</span><span class="ident" id="7034223">idleMu</span><span class="op" id="7034229">.</span><span class="ident" id="7034230">Unlock</span><span class="op" id="7034236">(</span><span class="op" id="7034237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034240">return</span>&nbsp;<span class="builtinfunc" id="7034247">len</span><span class="op" id="7034250">(</span><span class="ident" id="7034251">t</span><span class="op" id="7034252">.</span><span class="ident" id="7034253">idleConnCh</span><span class="op" id="7034263">)</span><br>
<span class="lineno"></span><span class="op" id="7034265">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7034268">func</span>&nbsp;<span class="op" id="7034273">(</span><span class="ident" id="7034274">t</span>&nbsp;<span class="op" id="7034276">*</span><span class="ident" id="7034277">Transport</span><span class="op" id="7034286">)</span>&nbsp;<span class="ident" id="7034288">IsIdleForTesting</span><span class="op" id="7034304">(</span><span class="op" id="7034305">)</span>&nbsp;<span class="builtintype" id="7034307">bool</span>&nbsp;<span class="op" id="7034312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034315">t</span><span class="op" id="7034316">.</span><span class="ident" id="7034317">idleMu</span><span class="op" id="7034323">.</span><span class="ident" id="7034324">Lock</span><span class="op" id="7034328">(</span><span class="op" id="7034329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034332">defer</span>&nbsp;<span class="ident" id="7034338">t</span><span class="op" id="7034339">.</span><span class="ident" id="7034340">idleMu</span><span class="op" id="7034346">.</span><span class="ident" id="7034347">Unlock</span><span class="op" id="7034353">(</span><span class="op" id="7034354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034357">return</span>&nbsp;<span class="ident" id="7034364">t</span><span class="op" id="7034365">.</span><span class="ident" id="7034366">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="7034375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7034378">func</span>&nbsp;<span class="op" id="7034383">(</span><span class="ident" id="7034384">t</span>&nbsp;<span class="op" id="7034386">*</span><span class="ident" id="7034387">Transport</span><span class="op" id="7034396">)</span>&nbsp;<span class="ident" id="7034398">RequestIdleConnChForTesting</span><span class="op" id="7034425">(</span><span class="op" id="7034426">)</span>&nbsp;<span class="op" id="7034428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034431">t</span><span class="op" id="7034432">.</span><span class="ident" id="7034433">getIdleConnCh</span><span class="op" id="7034446">(</span><span class="ident" id="7034447">connectMethod</span><span class="op" id="7034460">{</span><span class="ident" id="7034461">nil</span><span class="op" id="7034464">,</span>&nbsp;<span class="string" id="7034466">&#34;http&#34;</span><span class="op" id="7034472">,</span>&nbsp;<span class="string" id="7034474">&#34;example.com&#34;</span><span class="op" id="7034487">}</span><span class="op" id="7034488">)</span><br>
<span class="lineno"></span><span class="op" id="7034490">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7034493">func</span>&nbsp;<span class="op" id="7034498">(</span><span class="ident" id="7034499">t</span>&nbsp;<span class="op" id="7034501">*</span><span class="ident" id="7034502">Transport</span><span class="op" id="7034511">)</span>&nbsp;<span class="ident" id="7034513">PutIdleTestConn</span><span class="op" id="7034528">(</span><span class="op" id="7034529">)</span>&nbsp;<span class="builtintype" id="7034531">bool</span>&nbsp;<span class="op" id="7034536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034539">c</span><span class="op" id="7034540">,</span>&nbsp;<span class="ident" id="7034542">_</span>&nbsp;<span class="op" id="7034544">:=</span>&nbsp;<span class="ident" id="7034547">net</span><span class="op" id="7034550">.</span><span class="ident" id="7034551">Pipe</span><span class="op" id="7034555">(</span><span class="op" id="7034556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034559">return</span>&nbsp;<span class="ident" id="7034566">t</span><span class="op" id="7034567">.</span><span class="ident" id="7034568">putIdleConn</span><span class="op" id="7034579">(</span><span class="op" id="7034580">&amp;</span><span class="ident" id="7034581">persistConn</span><span class="op" id="7034592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034596">t</span><span class="op" id="7034597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034606">t</span><span class="op" id="7034607">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034611">conn</span><span class="op" id="7034615">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034621">c</span><span class="op" id="7034622">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7034642">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034653">closech</span><span class="op" id="7034660">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="7034663">make</span><span class="op" id="7034667">(</span><span class="keyword" id="7034668">chan</span>&nbsp;<span class="keyword" id="7034673">struct</span><span class="op" id="7034679">{</span><span class="op" id="7034680">}</span><span class="op" id="7034681">)</span><span class="op" id="7034682">,</span>&nbsp;<span class="comment" id="7034684">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034709">cacheKey</span><span class="op" id="7034717">:</span>&nbsp;<span class="ident" id="7034719">connectMethodKey</span><span class="op" id="7034735">{</span><span class="string" id="7034736">&#34;&#34;</span><span class="op" id="7034738">,</span>&nbsp;<span class="string" id="7034740">&#34;http&#34;</span><span class="op" id="7034746">,</span>&nbsp;<span class="string" id="7034748">&#34;example.com&#34;</span><span class="op" id="7034761">}</span><span class="op" id="7034762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034765">}</span><span class="op" id="7034766">)</span><br>
<span class="lineno"></span><span class="op" id="7034768">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7034771">func</span>&nbsp;<span class="ident" id="7034776">NewTestTimeoutHandler</span><span class="op" id="7034797">(</span><span class="ident" id="7034798">handler</span>&nbsp;<span class="ident" id="7034806">Handler</span><span class="op" id="7034813">,</span>&nbsp;<span class="ident" id="7034815">ch</span>&nbsp;<span class="op" id="7034818">&lt;-</span><span class="keyword" id="7034820">chan</span>&nbsp;<span class="ident" id="7034825">time</span><span class="op" id="7034829">.</span><span class="ident" id="7034830">Time</span><span class="op" id="7034834">)</span>&nbsp;<span class="ident" id="7034836">Handler</span>&nbsp;<span class="op" id="7034844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034847">f</span>&nbsp;<span class="op" id="7034849">:=</span>&nbsp;<span class="keyword" id="7034852">func</span><span class="op" id="7034856">(</span><span class="op" id="7034857">)</span>&nbsp;<span class="op" id="7034859">&lt;-</span><span class="keyword" id="7034861">chan</span>&nbsp;<span class="ident" id="7034866">time</span><span class="op" id="7034870">.</span><span class="ident" id="7034871">Time</span>&nbsp;<span class="op" id="7034876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034880">return</span>&nbsp;<span class="ident" id="7034887">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034891">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034894">return</span>&nbsp;<span class="op" id="7034901">&amp;</span><span class="ident" id="7034902">timeoutHandler</span><span class="op" id="7034916">{</span><span class="ident" id="7034917">handler</span><span class="op" id="7034924">,</span>&nbsp;<span class="ident" id="7034926">f</span><span class="op" id="7034927">,</span>&nbsp;<span class="string" id="7034929">&#34;&#34;</span><span class="op" id="7034931">}</span><br>
<span class="lineno"></span><span class="op" id="7034933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7034936">func</span>&nbsp;<span class="ident" id="7034941">ResetCachedEnvironment</span><span class="op" id="7034963">(</span><span class="op" id="7034964">)</span>&nbsp;<span class="op" id="7034966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034969">httpProxyEnv</span><span class="op" id="7034981">.</span><span class="ident" id="7034982">reset</span><span class="op" id="7034987">(</span><span class="op" id="7034988">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034991">httpsProxyEnv</span><span class="op" id="7035004">.</span><span class="ident" id="7035005">reset</span><span class="op" id="7035010">(</span><span class="op" id="7035011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7035014">noProxyEnv</span><span class="op" id="7035024">.</span><span class="ident" id="7035025">reset</span><span class="op" id="7035030">(</span><span class="op" id="7035031">)</span><br>
<span class="lineno"></span><span class="op" id="7035033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035036">var</span>&nbsp;<span class="ident" id="7035040">DefaultUserAgent</span>&nbsp;<span class="op" id="7035057">=</span>&nbsp;<span class="ident" id="7035059">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="7035077">func</span>&nbsp;<span class="ident" id="7035082">ExportRefererForURL</span><span class="op" id="7035101">(</span><span class="ident" id="7035102">lastReq</span><span class="op" id="7035109">,</span>&nbsp;<span class="ident" id="7035111">newReq</span>&nbsp;<span class="op" id="7035118">*</span><span class="ident" id="7035119">url</span><span class="op" id="7035122">.</span><span class="ident" id="7035123">URL</span><span class="op" id="7035126">)</span>&nbsp;<span class="builtintype" id="7035128">string</span>&nbsp;<span class="op" id="7035135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7035138">return</span>&nbsp;<span class="ident" id="7035145">refererForURL</span><span class="op" id="7035158">(</span><span class="ident" id="7035159">lastReq</span><span class="op" id="7035166">,</span>&nbsp;<span class="ident" id="7035168">newReq</span><span class="op" id="7035174">)</span><br>
<span class="lineno"></span><span class="op" id="7035176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="7035179">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="7035252">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="7035270">func</span>&nbsp;<span class="ident" id="7035275">SetPendingDialHooks</span><span class="op" id="7035294">(</span><span class="ident" id="7035295">before</span><span class="op" id="7035301">,</span>&nbsp;<span class="ident" id="7035303">after</span>&nbsp;<span class="keyword" id="7035309">func</span><span class="op" id="7035313">(</span><span class="op" id="7035314">)</span><span class="op" id="7035315">)</span>&nbsp;<span class="op" id="7035317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7035320">prePendingDial</span><span class="op" id="7035334">,</span>&nbsp;<span class="ident" id="7035336">postPendingDial</span>&nbsp;<span class="op" id="7035352">=</span>&nbsp;<span class="ident" id="7035354">before</span><span class="op" id="7035360">,</span>&nbsp;<span class="ident" id="7035362">after</span><br>
<span class="lineno"></span><span class="op" id="7035368">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7035371">var</span>&nbsp;<span class="ident" id="7035375">ExportServerNewConn</span>&nbsp;<span class="op" id="7035395">=</span>&nbsp;<span class="op" id="7035397">(</span><span class="op" id="7035398">*</span><span class="ident" id="7035399">Server</span><span class="op" id="7035405">)</span><span class="op" id="7035406">.</span><span class="ident" id="7035407">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035416">var</span>&nbsp;<span class="ident" id="7035420">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="7035444">=</span>&nbsp;<span class="op" id="7035446">(</span><span class="op" id="7035447">*</span><span class="ident" id="7035448">conn</span><span class="op" id="7035452">)</span><span class="op" id="7035453">.</span><span class="ident" id="7035454">closeWriteAndWait</span>
</div>
</body>
</html>
