<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6673636">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6673692">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6673746">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6673797">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="6673876">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6673885">package</span>&nbsp;<span class="ident" id="6673893">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6673898">import</span>&nbsp;<span class="op" id="6673905">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6673908">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6673921">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6673927">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6673938">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6673949">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6673956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6673959">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6674029">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="6674097">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="6674119">func</span>&nbsp;<span class="ident" id="6674124">testUnixAddr</span><span class="op" id="6674136">(</span><span class="op" id="6674137">)</span>&nbsp;<span class="builtintype" id="6674139">string</span>&nbsp;<span class="op" id="6674146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674149">f</span><span class="op" id="6674150">,</span>&nbsp;<span class="ident" id="6674152">err</span>&nbsp;<span class="op" id="6674156">:=</span>&nbsp;<span class="ident" id="6674159">ioutil</span><span class="op" id="6674165">.</span><span class="ident" id="6674166">TempFile</span><span class="op" id="6674174">(</span><span class="string" id="6674175">&#34;&#34;</span><span class="op" id="6674177">,</span>&nbsp;<span class="string" id="6674179">&#34;nettest&#34;</span><span class="op" id="6674188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674191">if</span>&nbsp;<span class="ident" id="6674194">err</span>&nbsp;<span class="op" id="6674198">!=</span>&nbsp;<span class="ident" id="6674201">nil</span>&nbsp;<span class="op" id="6674205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6674209">panic</span><span class="op" id="6674214">(</span><span class="ident" id="6674215">err</span><span class="op" id="6674218">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674224">addr</span>&nbsp;<span class="op" id="6674229">:=</span>&nbsp;<span class="ident" id="6674232">f</span><span class="op" id="6674233">.</span><span class="ident" id="6674234">Name</span><span class="op" id="6674238">(</span><span class="op" id="6674239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674242">f</span><span class="op" id="6674243">.</span><span class="ident" id="6674244">Close</span><span class="op" id="6674249">(</span><span class="op" id="6674250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674253">os</span><span class="op" id="6674255">.</span><span class="ident" id="6674256">Remove</span><span class="op" id="6674262">(</span><span class="ident" id="6674263">addr</span><span class="op" id="6674267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674270">return</span>&nbsp;<span class="ident" id="6674277">addr</span><br>
<span class="lineno">30</span><span class="op" id="6674282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6674285">var</span>&nbsp;<span class="ident" id="6674289">condFatalf</span>&nbsp;<span class="op" id="6674300">=</span>&nbsp;<span class="keyword" id="6674302">func</span><span class="op" id="6674306">(</span><span class="op" id="6674307">)</span>&nbsp;<span class="keyword" id="6674309">func</span><span class="op" id="6674313">(</span><span class="op" id="6674314">*</span><span class="ident" id="6674315">testing</span><span class="op" id="6674322">.</span><span class="ident" id="6674323">T</span><span class="op" id="6674324">,</span>&nbsp;<span class="builtintype" id="6674326">string</span><span class="op" id="6674332">,</span>&nbsp;<span class="op" id="6674334">...</span><span class="keyword" id="6674337">interface</span><span class="op" id="6674346">{</span><span class="op" id="6674347">}</span><span class="op" id="6674348">)</span>&nbsp;<span class="op" id="6674350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6674353">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674420">switch</span>&nbsp;<span class="ident" id="6674427">runtime</span><span class="op" id="6674434">.</span><span class="ident" id="6674435">GOOS</span>&nbsp;<span class="op" id="6674440">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674443">case</span>&nbsp;<span class="string" id="6674448">&#34;plan9&#34;</span><span class="op" id="6674455">,</span>&nbsp;<span class="string" id="6674457">&#34;windows&#34;</span><span class="op" id="6674466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674470">return</span>&nbsp;<span class="op" id="6674477">(</span><span class="op" id="6674478">*</span><span class="ident" id="6674479">testing</span><span class="op" id="6674486">.</span><span class="ident" id="6674487">T</span><span class="op" id="6674488">)</span><span class="op" id="6674489">.</span><span class="ident" id="6674490">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674499">return</span>&nbsp;<span class="op" id="6674506">(</span><span class="op" id="6674507">*</span><span class="ident" id="6674508">testing</span><span class="op" id="6674515">.</span><span class="ident" id="6674516">T</span><span class="op" id="6674517">)</span><span class="op" id="6674518">.</span><span class="ident" id="6674519">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="6674526">}</span><span class="op" id="6674527">(</span><span class="op" id="6674528">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6674531">func</span>&nbsp;<span class="ident" id="6674536">TestTCPListenerSpecificMethods</span><span class="op" id="6674566">(</span><span class="ident" id="6674567">t</span>&nbsp;<span class="op" id="6674569">*</span><span class="ident" id="6674570">testing</span><span class="op" id="6674577">.</span><span class="ident" id="6674578">T</span><span class="op" id="6674579">)</span>&nbsp;<span class="op" id="6674581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674584">switch</span>&nbsp;<span class="ident" id="6674591">runtime</span><span class="op" id="6674598">.</span><span class="ident" id="6674599">GOOS</span>&nbsp;<span class="op" id="6674604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674607">case</span>&nbsp;<span class="string" id="6674612">&#34;plan9&#34;</span><span class="op" id="6674619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674623">t</span><span class="op" id="6674624">.</span><span class="ident" id="6674625">Skipf</span><span class="op" id="6674630">(</span><span class="string" id="6674631">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6674652">,</span>&nbsp;<span class="ident" id="6674654">runtime</span><span class="op" id="6674661">.</span><span class="ident" id="6674662">GOOS</span><span class="op" id="6674666">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674673">la</span><span class="op" id="6674675">,</span>&nbsp;<span class="ident" id="6674677">err</span>&nbsp;<span class="op" id="6674681">:=</span>&nbsp;<span class="ident" id="6674684">ResolveTCPAddr</span><span class="op" id="6674698">(</span><span class="string" id="6674699">&#34;tcp4&#34;</span><span class="op" id="6674705">,</span>&nbsp;<span class="string" id="6674707">&#34;127.0.0.1:0&#34;</span><span class="op" id="6674720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674723">if</span>&nbsp;<span class="ident" id="6674726">err</span>&nbsp;<span class="op" id="6674730">!=</span>&nbsp;<span class="ident" id="6674733">nil</span>&nbsp;<span class="op" id="6674737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674741">t</span><span class="op" id="6674742">.</span><span class="ident" id="6674743">Fatalf</span><span class="op" id="6674749">(</span><span class="string" id="6674750">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6674777">,</span>&nbsp;<span class="ident" id="6674779">err</span><span class="op" id="6674782">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674788">ln</span><span class="op" id="6674790">,</span>&nbsp;<span class="ident" id="6674792">err</span>&nbsp;<span class="op" id="6674796">:=</span>&nbsp;<span class="ident" id="6674799">ListenTCP</span><span class="op" id="6674808">(</span><span class="string" id="6674809">&#34;tcp4&#34;</span><span class="op" id="6674815">,</span>&nbsp;<span class="ident" id="6674817">la</span><span class="op" id="6674819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674822">if</span>&nbsp;<span class="ident" id="6674825">err</span>&nbsp;<span class="op" id="6674829">!=</span>&nbsp;<span class="ident" id="6674832">nil</span>&nbsp;<span class="op" id="6674836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674840">t</span><span class="op" id="6674841">.</span><span class="ident" id="6674842">Fatalf</span><span class="op" id="6674848">(</span><span class="string" id="6674849">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6674871">,</span>&nbsp;<span class="ident" id="6674873">err</span><span class="op" id="6674876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674879">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674882">defer</span>&nbsp;<span class="ident" id="6674888">ln</span><span class="op" id="6674890">.</span><span class="ident" id="6674891">Close</span><span class="op" id="6674896">(</span><span class="op" id="6674897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674900">ln</span><span class="op" id="6674902">.</span><span class="ident" id="6674903">Addr</span><span class="op" id="6674907">(</span><span class="op" id="6674908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674911">ln</span><span class="op" id="6674913">.</span><span class="ident" id="6674914">SetDeadline</span><span class="op" id="6674925">(</span><span class="ident" id="6674926">time</span><span class="op" id="6674930">.</span><span class="ident" id="6674931">Now</span><span class="op" id="6674934">(</span><span class="op" id="6674935">)</span><span class="op" id="6674936">.</span><span class="ident" id="6674937">Add</span><span class="op" id="6674940">(</span><span class="num" id="6674941">30</span>&nbsp;<span class="op" id="6674944">*</span>&nbsp;<span class="ident" id="6674946">time</span><span class="op" id="6674950">.</span><span class="ident" id="6674951">Nanosecond</span><span class="op" id="6674961">)</span><span class="op" id="6674962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6674966">if</span>&nbsp;<span class="ident" id="6674969">c</span><span class="op" id="6674970">,</span>&nbsp;<span class="ident" id="6674972">err</span>&nbsp;<span class="op" id="6674976">:=</span>&nbsp;<span class="ident" id="6674979">ln</span><span class="op" id="6674981">.</span><span class="ident" id="6674982">Accept</span><span class="op" id="6674988">(</span><span class="op" id="6674989">)</span><span class="op" id="6674990">;</span>&nbsp;<span class="ident" id="6674992">err</span>&nbsp;<span class="op" id="6674996">!=</span>&nbsp;<span class="ident" id="6674999">nil</span>&nbsp;<span class="op" id="6675003">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675007">if</span>&nbsp;<span class="op" id="6675010">!</span><span class="ident" id="6675011">err</span><span class="op" id="6675014">.</span><span class="op" id="6675015">(</span><span class="ident" id="6675016">Error</span><span class="op" id="6675021">)</span><span class="op" id="6675022">.</span><span class="ident" id="6675023">Timeout</span><span class="op" id="6675030">(</span><span class="op" id="6675031">)</span>&nbsp;<span class="op" id="6675033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675038">t</span><span class="op" id="6675039">.</span><span class="ident" id="6675040">Fatalf</span><span class="op" id="6675046">(</span><span class="string" id="6675047">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675078">,</span>&nbsp;<span class="ident" id="6675080">err</span><span class="op" id="6675083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675090">}</span>&nbsp;<span class="keyword" id="6675092">else</span>&nbsp;<span class="op" id="6675097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675101">c</span><span class="op" id="6675102">.</span><span class="ident" id="6675103">Close</span><span class="op" id="6675108">(</span><span class="op" id="6675109">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675115">if</span>&nbsp;<span class="ident" id="6675118">c</span><span class="op" id="6675119">,</span>&nbsp;<span class="ident" id="6675121">err</span>&nbsp;<span class="op" id="6675125">:=</span>&nbsp;<span class="ident" id="6675128">ln</span><span class="op" id="6675130">.</span><span class="ident" id="6675131">AcceptTCP</span><span class="op" id="6675140">(</span><span class="op" id="6675141">)</span><span class="op" id="6675142">;</span>&nbsp;<span class="ident" id="6675144">err</span>&nbsp;<span class="op" id="6675148">!=</span>&nbsp;<span class="ident" id="6675151">nil</span>&nbsp;<span class="op" id="6675155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675159">if</span>&nbsp;<span class="op" id="6675162">!</span><span class="ident" id="6675163">err</span><span class="op" id="6675166">.</span><span class="op" id="6675167">(</span><span class="ident" id="6675168">Error</span><span class="op" id="6675173">)</span><span class="op" id="6675174">.</span><span class="ident" id="6675175">Timeout</span><span class="op" id="6675182">(</span><span class="op" id="6675183">)</span>&nbsp;<span class="op" id="6675185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675190">t</span><span class="op" id="6675191">.</span><span class="ident" id="6675192">Fatalf</span><span class="op" id="6675198">(</span><span class="string" id="6675199">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675233">,</span>&nbsp;<span class="ident" id="6675235">err</span><span class="op" id="6675238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675242">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675245">}</span>&nbsp;<span class="keyword" id="6675247">else</span>&nbsp;<span class="op" id="6675252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675256">c</span><span class="op" id="6675257">.</span><span class="ident" id="6675258">Close</span><span class="op" id="6675263">(</span><span class="op" id="6675264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675271">if</span>&nbsp;<span class="ident" id="6675274">f</span><span class="op" id="6675275">,</span>&nbsp;<span class="ident" id="6675277">err</span>&nbsp;<span class="op" id="6675281">:=</span>&nbsp;<span class="ident" id="6675284">ln</span><span class="op" id="6675286">.</span><span class="ident" id="6675287">File</span><span class="op" id="6675291">(</span><span class="op" id="6675292">)</span><span class="op" id="6675293">;</span>&nbsp;<span class="ident" id="6675295">err</span>&nbsp;<span class="op" id="6675299">!=</span>&nbsp;<span class="ident" id="6675302">nil</span>&nbsp;<span class="op" id="6675306">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675310">condFatalf</span><span class="op" id="6675320">(</span><span class="ident" id="6675321">t</span><span class="op" id="6675322">,</span>&nbsp;<span class="string" id="6675324">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675353">,</span>&nbsp;<span class="ident" id="6675355">err</span><span class="op" id="6675358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675361">}</span>&nbsp;<span class="keyword" id="6675363">else</span>&nbsp;<span class="op" id="6675368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675372">f</span><span class="op" id="6675373">.</span><span class="ident" id="6675374">Close</span><span class="op" id="6675379">(</span><span class="op" id="6675380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675383">}</span><br>
<span class="lineno"></span><span class="op" id="6675385">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6675388">func</span>&nbsp;<span class="ident" id="6675393">TestTCPConnSpecificMethods</span><span class="op" id="6675419">(</span><span class="ident" id="6675420">t</span>&nbsp;<span class="op" id="6675422">*</span><span class="ident" id="6675423">testing</span><span class="op" id="6675430">.</span><span class="ident" id="6675431">T</span><span class="op" id="6675432">)</span>&nbsp;<span class="op" id="6675434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675437">la</span><span class="op" id="6675439">,</span>&nbsp;<span class="ident" id="6675441">err</span>&nbsp;<span class="op" id="6675445">:=</span>&nbsp;<span class="ident" id="6675448">ResolveTCPAddr</span><span class="op" id="6675462">(</span><span class="string" id="6675463">&#34;tcp4&#34;</span><span class="op" id="6675469">,</span>&nbsp;<span class="string" id="6675471">&#34;127.0.0.1:0&#34;</span><span class="op" id="6675484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675487">if</span>&nbsp;<span class="ident" id="6675490">err</span>&nbsp;<span class="op" id="6675494">!=</span>&nbsp;<span class="ident" id="6675497">nil</span>&nbsp;<span class="op" id="6675501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675505">t</span><span class="op" id="6675506">.</span><span class="ident" id="6675507">Fatalf</span><span class="op" id="6675513">(</span><span class="string" id="6675514">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675541">,</span>&nbsp;<span class="ident" id="6675543">err</span><span class="op" id="6675546">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675552">ln</span><span class="op" id="6675554">,</span>&nbsp;<span class="ident" id="6675556">err</span>&nbsp;<span class="op" id="6675560">:=</span>&nbsp;<span class="ident" id="6675563">ListenTCP</span><span class="op" id="6675572">(</span><span class="string" id="6675573">&#34;tcp4&#34;</span><span class="op" id="6675579">,</span>&nbsp;<span class="ident" id="6675581">la</span><span class="op" id="6675583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675586">if</span>&nbsp;<span class="ident" id="6675589">err</span>&nbsp;<span class="op" id="6675593">!=</span>&nbsp;<span class="ident" id="6675596">nil</span>&nbsp;<span class="op" id="6675600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675604">t</span><span class="op" id="6675605">.</span><span class="ident" id="6675606">Fatalf</span><span class="op" id="6675612">(</span><span class="string" id="6675613">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675635">,</span>&nbsp;<span class="ident" id="6675637">err</span><span class="op" id="6675640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675643">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675646">defer</span>&nbsp;<span class="ident" id="6675652">ln</span><span class="op" id="6675654">.</span><span class="ident" id="6675655">Close</span><span class="op" id="6675660">(</span><span class="op" id="6675661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675664">ln</span><span class="op" id="6675666">.</span><span class="ident" id="6675667">Addr</span><span class="op" id="6675671">(</span><span class="op" id="6675672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675676">done</span>&nbsp;<span class="op" id="6675681">:=</span>&nbsp;<span class="builtinfunc" id="6675684">make</span><span class="op" id="6675688">(</span><span class="keyword" id="6675689">chan</span>&nbsp;<span class="builtintype" id="6675694">int</span><span class="op" id="6675697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675700">go</span>&nbsp;<span class="ident" id="6675703">transponder</span><span class="op" id="6675714">(</span><span class="ident" id="6675715">t</span><span class="op" id="6675716">,</span>&nbsp;<span class="ident" id="6675718">ln</span><span class="op" id="6675720">,</span>&nbsp;<span class="ident" id="6675722">done</span><span class="op" id="6675726">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675730">ra</span><span class="op" id="6675732">,</span>&nbsp;<span class="ident" id="6675734">err</span>&nbsp;<span class="op" id="6675738">:=</span>&nbsp;<span class="ident" id="6675741">ResolveTCPAddr</span><span class="op" id="6675755">(</span><span class="string" id="6675756">&#34;tcp4&#34;</span><span class="op" id="6675762">,</span>&nbsp;<span class="ident" id="6675764">ln</span><span class="op" id="6675766">.</span><span class="ident" id="6675767">Addr</span><span class="op" id="6675771">(</span><span class="op" id="6675772">)</span><span class="op" id="6675773">.</span><span class="ident" id="6675774">String</span><span class="op" id="6675780">(</span><span class="op" id="6675781">)</span><span class="op" id="6675782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675785">if</span>&nbsp;<span class="ident" id="6675788">err</span>&nbsp;<span class="op" id="6675792">!=</span>&nbsp;<span class="ident" id="6675795">nil</span>&nbsp;<span class="op" id="6675799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675803">t</span><span class="op" id="6675804">.</span><span class="ident" id="6675805">Fatalf</span><span class="op" id="6675811">(</span><span class="string" id="6675812">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675839">,</span>&nbsp;<span class="ident" id="6675841">err</span><span class="op" id="6675844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675847">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675850">c</span><span class="op" id="6675851">,</span>&nbsp;<span class="ident" id="6675853">err</span>&nbsp;<span class="op" id="6675857">:=</span>&nbsp;<span class="ident" id="6675860">DialTCP</span><span class="op" id="6675867">(</span><span class="string" id="6675868">&#34;tcp4&#34;</span><span class="op" id="6675874">,</span>&nbsp;<span class="ident" id="6675876">nil</span><span class="op" id="6675879">,</span>&nbsp;<span class="ident" id="6675881">ra</span><span class="op" id="6675883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675886">if</span>&nbsp;<span class="ident" id="6675889">err</span>&nbsp;<span class="op" id="6675893">!=</span>&nbsp;<span class="ident" id="6675896">nil</span>&nbsp;<span class="op" id="6675900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675904">t</span><span class="op" id="6675905">.</span><span class="ident" id="6675906">Fatalf</span><span class="op" id="6675912">(</span><span class="string" id="6675913">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6675933">,</span>&nbsp;<span class="ident" id="6675935">err</span><span class="op" id="6675938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675944">defer</span>&nbsp;<span class="ident" id="6675950">c</span><span class="op" id="6675951">.</span><span class="ident" id="6675952">Close</span><span class="op" id="6675957">(</span><span class="op" id="6675958">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675961">c</span><span class="op" id="6675962">.</span><span class="ident" id="6675963">SetKeepAlive</span><span class="op" id="6675975">(</span><span class="builtintype" id="6675976">false</span><span class="op" id="6675981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675984">c</span><span class="op" id="6675985">.</span><span class="ident" id="6675986">SetKeepAlivePeriod</span><span class="op" id="6676004">(</span><span class="num" id="6676005">3</span>&nbsp;<span class="op" id="6676007">*</span>&nbsp;<span class="ident" id="6676009">time</span><span class="op" id="6676013">.</span><span class="ident" id="6676014">Second</span><span class="op" id="6676020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676023">c</span><span class="op" id="6676024">.</span><span class="ident" id="6676025">SetLinger</span><span class="op" id="6676034">(</span><span class="num" id="6676035">0</span><span class="op" id="6676036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676039">c</span><span class="op" id="6676040">.</span><span class="ident" id="6676041">SetNoDelay</span><span class="op" id="6676051">(</span><span class="builtintype" id="6676052">false</span><span class="op" id="6676057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676060">c</span><span class="op" id="6676061">.</span><span class="ident" id="6676062">LocalAddr</span><span class="op" id="6676071">(</span><span class="op" id="6676072">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676075">c</span><span class="op" id="6676076">.</span><span class="ident" id="6676077">RemoteAddr</span><span class="op" id="6676087">(</span><span class="op" id="6676088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676091">c</span><span class="op" id="6676092">.</span><span class="ident" id="6676093">SetDeadline</span><span class="op" id="6676104">(</span><span class="ident" id="6676105">time</span><span class="op" id="6676109">.</span><span class="ident" id="6676110">Now</span><span class="op" id="6676113">(</span><span class="op" id="6676114">)</span><span class="op" id="6676115">.</span><span class="ident" id="6676116">Add</span><span class="op" id="6676119">(</span><span class="ident" id="6676120">someTimeout</span><span class="op" id="6676131">)</span><span class="op" id="6676132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676135">c</span><span class="op" id="6676136">.</span><span class="ident" id="6676137">SetReadDeadline</span><span class="op" id="6676152">(</span><span class="ident" id="6676153">time</span><span class="op" id="6676157">.</span><span class="ident" id="6676158">Now</span><span class="op" id="6676161">(</span><span class="op" id="6676162">)</span><span class="op" id="6676163">.</span><span class="ident" id="6676164">Add</span><span class="op" id="6676167">(</span><span class="ident" id="6676168">someTimeout</span><span class="op" id="6676179">)</span><span class="op" id="6676180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676183">c</span><span class="op" id="6676184">.</span><span class="ident" id="6676185">SetWriteDeadline</span><span class="op" id="6676201">(</span><span class="ident" id="6676202">time</span><span class="op" id="6676206">.</span><span class="ident" id="6676207">Now</span><span class="op" id="6676210">(</span><span class="op" id="6676211">)</span><span class="op" id="6676212">.</span><span class="ident" id="6676213">Add</span><span class="op" id="6676216">(</span><span class="ident" id="6676217">someTimeout</span><span class="op" id="6676228">)</span><span class="op" id="6676229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676233">if</span>&nbsp;<span class="ident" id="6676236">_</span><span class="op" id="6676237">,</span>&nbsp;<span class="ident" id="6676239">err</span>&nbsp;<span class="op" id="6676243">:=</span>&nbsp;<span class="ident" id="6676246">c</span><span class="op" id="6676247">.</span><span class="ident" id="6676248">Write</span><span class="op" id="6676253">(</span><span class="op" id="6676254">[</span><span class="op" id="6676255">]</span><span class="builtintype" id="6676256">byte</span><span class="op" id="6676260">(</span><span class="string" id="6676261">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="6676275">)</span><span class="op" id="6676276">)</span><span class="op" id="6676277">;</span>&nbsp;<span class="ident" id="6676279">err</span>&nbsp;<span class="op" id="6676283">!=</span>&nbsp;<span class="ident" id="6676286">nil</span>&nbsp;<span class="op" id="6676290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676294">t</span><span class="op" id="6676295">.</span><span class="ident" id="6676296">Fatalf</span><span class="op" id="6676302">(</span><span class="string" id="6676303">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676329">,</span>&nbsp;<span class="ident" id="6676331">err</span><span class="op" id="6676334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676340">rb</span>&nbsp;<span class="op" id="6676343">:=</span>&nbsp;<span class="builtinfunc" id="6676346">make</span><span class="op" id="6676350">(</span><span class="op" id="6676351">[</span><span class="op" id="6676352">]</span><span class="builtintype" id="6676353">byte</span><span class="op" id="6676357">,</span>&nbsp;<span class="num" id="6676359">128</span><span class="op" id="6676362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676365">if</span>&nbsp;<span class="ident" id="6676368">_</span><span class="op" id="6676369">,</span>&nbsp;<span class="ident" id="6676371">err</span>&nbsp;<span class="op" id="6676375">:=</span>&nbsp;<span class="ident" id="6676378">c</span><span class="op" id="6676379">.</span><span class="ident" id="6676380">Read</span><span class="op" id="6676384">(</span><span class="ident" id="6676385">rb</span><span class="op" id="6676387">)</span><span class="op" id="6676388">;</span>&nbsp;<span class="ident" id="6676390">err</span>&nbsp;<span class="op" id="6676394">!=</span>&nbsp;<span class="ident" id="6676397">nil</span>&nbsp;<span class="op" id="6676401">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676405">t</span><span class="op" id="6676406">.</span><span class="ident" id="6676407">Fatalf</span><span class="op" id="6676413">(</span><span class="string" id="6676414">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676439">,</span>&nbsp;<span class="ident" id="6676441">err</span><span class="op" id="6676444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676451">&lt;-</span><span class="ident" id="6676453">done</span><br>
<span class="lineno"></span><span class="op" id="6676458">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6676461">func</span>&nbsp;<span class="ident" id="6676466">TestUDPConnSpecificMethods</span><span class="op" id="6676492">(</span><span class="ident" id="6676493">t</span>&nbsp;<span class="op" id="6676495">*</span><span class="ident" id="6676496">testing</span><span class="op" id="6676503">.</span><span class="ident" id="6676504">T</span><span class="op" id="6676505">)</span>&nbsp;<span class="op" id="6676507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676510">la</span><span class="op" id="6676512">,</span>&nbsp;<span class="ident" id="6676514">err</span>&nbsp;<span class="op" id="6676518">:=</span>&nbsp;<span class="ident" id="6676521">ResolveUDPAddr</span><span class="op" id="6676535">(</span><span class="string" id="6676536">&#34;udp4&#34;</span><span class="op" id="6676542">,</span>&nbsp;<span class="string" id="6676544">&#34;127.0.0.1:0&#34;</span><span class="op" id="6676557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676560">if</span>&nbsp;<span class="ident" id="6676563">err</span>&nbsp;<span class="op" id="6676567">!=</span>&nbsp;<span class="ident" id="6676570">nil</span>&nbsp;<span class="op" id="6676574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676578">t</span><span class="op" id="6676579">.</span><span class="ident" id="6676580">Fatalf</span><span class="op" id="6676586">(</span><span class="string" id="6676587">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676614">,</span>&nbsp;<span class="ident" id="6676616">err</span><span class="op" id="6676619">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676625">c</span><span class="op" id="6676626">,</span>&nbsp;<span class="ident" id="6676628">err</span>&nbsp;<span class="op" id="6676632">:=</span>&nbsp;<span class="ident" id="6676635">ListenUDP</span><span class="op" id="6676644">(</span><span class="string" id="6676645">&#34;udp4&#34;</span><span class="op" id="6676651">,</span>&nbsp;<span class="ident" id="6676653">la</span><span class="op" id="6676655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676658">if</span>&nbsp;<span class="ident" id="6676661">err</span>&nbsp;<span class="op" id="6676665">!=</span>&nbsp;<span class="ident" id="6676668">nil</span>&nbsp;<span class="op" id="6676672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676676">t</span><span class="op" id="6676677">.</span><span class="ident" id="6676678">Fatalf</span><span class="op" id="6676684">(</span><span class="string" id="6676685">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6676707">,</span>&nbsp;<span class="ident" id="6676709">err</span><span class="op" id="6676712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676715">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676718">defer</span>&nbsp;<span class="ident" id="6676724">c</span><span class="op" id="6676725">.</span><span class="ident" id="6676726">Close</span><span class="op" id="6676731">(</span><span class="op" id="6676732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676735">c</span><span class="op" id="6676736">.</span><span class="ident" id="6676737">LocalAddr</span><span class="op" id="6676746">(</span><span class="op" id="6676747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676750">c</span><span class="op" id="6676751">.</span><span class="ident" id="6676752">RemoteAddr</span><span class="op" id="6676762">(</span><span class="op" id="6676763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676766">c</span><span class="op" id="6676767">.</span><span class="ident" id="6676768">SetDeadline</span><span class="op" id="6676779">(</span><span class="ident" id="6676780">time</span><span class="op" id="6676784">.</span><span class="ident" id="6676785">Now</span><span class="op" id="6676788">(</span><span class="op" id="6676789">)</span><span class="op" id="6676790">.</span><span class="ident" id="6676791">Add</span><span class="op" id="6676794">(</span><span class="ident" id="6676795">someTimeout</span><span class="op" id="6676806">)</span><span class="op" id="6676807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676810">c</span><span class="op" id="6676811">.</span><span class="ident" id="6676812">SetReadDeadline</span><span class="op" id="6676827">(</span><span class="ident" id="6676828">time</span><span class="op" id="6676832">.</span><span class="ident" id="6676833">Now</span><span class="op" id="6676836">(</span><span class="op" id="6676837">)</span><span class="op" id="6676838">.</span><span class="ident" id="6676839">Add</span><span class="op" id="6676842">(</span><span class="ident" id="6676843">someTimeout</span><span class="op" id="6676854">)</span><span class="op" id="6676855">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676858">c</span><span class="op" id="6676859">.</span><span class="ident" id="6676860">SetWriteDeadline</span><span class="op" id="6676876">(</span><span class="ident" id="6676877">time</span><span class="op" id="6676881">.</span><span class="ident" id="6676882">Now</span><span class="op" id="6676885">(</span><span class="op" id="6676886">)</span><span class="op" id="6676887">.</span><span class="ident" id="6676888">Add</span><span class="op" id="6676891">(</span><span class="ident" id="6676892">someTimeout</span><span class="op" id="6676903">)</span><span class="op" id="6676904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676907">c</span><span class="op" id="6676908">.</span><span class="ident" id="6676909">SetReadBuffer</span><span class="op" id="6676922">(</span><span class="num" id="6676923">2048</span><span class="op" id="6676927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676930">c</span><span class="op" id="6676931">.</span><span class="ident" id="6676932">SetWriteBuffer</span><span class="op" id="6676946">(</span><span class="num" id="6676947">2048</span><span class="op" id="6676951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676955">wb</span>&nbsp;<span class="op" id="6676958">:=</span>&nbsp;<span class="op" id="6676961">[</span><span class="op" id="6676962">]</span><span class="builtintype" id="6676963">byte</span><span class="op" id="6676967">(</span><span class="string" id="6676968">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="6676982">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676985">rb</span>&nbsp;<span class="op" id="6676988">:=</span>&nbsp;<span class="builtinfunc" id="6676991">make</span><span class="op" id="6676995">(</span><span class="op" id="6676996">[</span><span class="op" id="6676997">]</span><span class="builtintype" id="6676998">byte</span><span class="op" id="6677002">,</span>&nbsp;<span class="num" id="6677004">128</span><span class="op" id="6677007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677010">if</span>&nbsp;<span class="ident" id="6677013">_</span><span class="op" id="6677014">,</span>&nbsp;<span class="ident" id="6677016">err</span>&nbsp;<span class="op" id="6677020">:=</span>&nbsp;<span class="ident" id="6677023">c</span><span class="op" id="6677024">.</span><span class="ident" id="6677025">WriteToUDP</span><span class="op" id="6677035">(</span><span class="ident" id="6677036">wb</span><span class="op" id="6677038">,</span>&nbsp;<span class="ident" id="6677040">c</span><span class="op" id="6677041">.</span><span class="ident" id="6677042">LocalAddr</span><span class="op" id="6677051">(</span><span class="op" id="6677052">)</span><span class="op" id="6677053">.</span><span class="op" id="6677054">(</span><span class="op" id="6677055">*</span><span class="ident" id="6677056">UDPAddr</span><span class="op" id="6677063">)</span><span class="op" id="6677064">)</span><span class="op" id="6677065">;</span>&nbsp;<span class="ident" id="6677067">err</span>&nbsp;<span class="op" id="6677071">!=</span>&nbsp;<span class="ident" id="6677074">nil</span>&nbsp;<span class="op" id="6677078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677082">t</span><span class="op" id="6677083">.</span><span class="ident" id="6677084">Fatalf</span><span class="op" id="6677090">(</span><span class="string" id="6677091">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677122">,</span>&nbsp;<span class="ident" id="6677124">err</span><span class="op" id="6677127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677133">if</span>&nbsp;<span class="ident" id="6677136">_</span><span class="op" id="6677137">,</span>&nbsp;<span class="ident" id="6677139">_</span><span class="op" id="6677140">,</span>&nbsp;<span class="ident" id="6677142">err</span>&nbsp;<span class="op" id="6677146">:=</span>&nbsp;<span class="ident" id="6677149">c</span><span class="op" id="6677150">.</span><span class="ident" id="6677151">ReadFromUDP</span><span class="op" id="6677162">(</span><span class="ident" id="6677163">rb</span><span class="op" id="6677165">)</span><span class="op" id="6677166">;</span>&nbsp;<span class="ident" id="6677168">err</span>&nbsp;<span class="op" id="6677172">!=</span>&nbsp;<span class="ident" id="6677175">nil</span>&nbsp;<span class="op" id="6677179">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677183">t</span><span class="op" id="6677184">.</span><span class="ident" id="6677185">Fatalf</span><span class="op" id="6677191">(</span><span class="string" id="6677192">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677224">,</span>&nbsp;<span class="ident" id="6677226">err</span><span class="op" id="6677229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677235">if</span>&nbsp;<span class="ident" id="6677238">_</span><span class="op" id="6677239">,</span>&nbsp;<span class="ident" id="6677241">_</span><span class="op" id="6677242">,</span>&nbsp;<span class="ident" id="6677244">err</span>&nbsp;<span class="op" id="6677248">:=</span>&nbsp;<span class="ident" id="6677251">c</span><span class="op" id="6677252">.</span><span class="ident" id="6677253">WriteMsgUDP</span><span class="op" id="6677264">(</span><span class="ident" id="6677265">wb</span><span class="op" id="6677267">,</span>&nbsp;<span class="ident" id="6677269">nil</span><span class="op" id="6677272">,</span>&nbsp;<span class="ident" id="6677274">c</span><span class="op" id="6677275">.</span><span class="ident" id="6677276">LocalAddr</span><span class="op" id="6677285">(</span><span class="op" id="6677286">)</span><span class="op" id="6677287">.</span><span class="op" id="6677288">(</span><span class="op" id="6677289">*</span><span class="ident" id="6677290">UDPAddr</span><span class="op" id="6677297">)</span><span class="op" id="6677298">)</span><span class="op" id="6677299">;</span>&nbsp;<span class="ident" id="6677301">err</span>&nbsp;<span class="op" id="6677305">!=</span>&nbsp;<span class="ident" id="6677308">nil</span>&nbsp;<span class="op" id="6677312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677316">condFatalf</span><span class="op" id="6677326">(</span><span class="ident" id="6677327">t</span><span class="op" id="6677328">,</span>&nbsp;<span class="string" id="6677330">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677362">,</span>&nbsp;<span class="ident" id="6677364">err</span><span class="op" id="6677367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677370">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677373">if</span>&nbsp;<span class="ident" id="6677376">_</span><span class="op" id="6677377">,</span>&nbsp;<span class="ident" id="6677379">_</span><span class="op" id="6677380">,</span>&nbsp;<span class="ident" id="6677382">_</span><span class="op" id="6677383">,</span>&nbsp;<span class="ident" id="6677385">_</span><span class="op" id="6677386">,</span>&nbsp;<span class="ident" id="6677388">err</span>&nbsp;<span class="op" id="6677392">:=</span>&nbsp;<span class="ident" id="6677395">c</span><span class="op" id="6677396">.</span><span class="ident" id="6677397">ReadMsgUDP</span><span class="op" id="6677407">(</span><span class="ident" id="6677408">rb</span><span class="op" id="6677410">,</span>&nbsp;<span class="ident" id="6677412">nil</span><span class="op" id="6677415">)</span><span class="op" id="6677416">;</span>&nbsp;<span class="ident" id="6677418">err</span>&nbsp;<span class="op" id="6677422">!=</span>&nbsp;<span class="ident" id="6677425">nil</span>&nbsp;<span class="op" id="6677429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677433">condFatalf</span><span class="op" id="6677443">(</span><span class="ident" id="6677444">t</span><span class="op" id="6677445">,</span>&nbsp;<span class="string" id="6677447">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677478">,</span>&nbsp;<span class="ident" id="6677480">err</span><span class="op" id="6677483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677490">if</span>&nbsp;<span class="ident" id="6677493">f</span><span class="op" id="6677494">,</span>&nbsp;<span class="ident" id="6677496">err</span>&nbsp;<span class="op" id="6677500">:=</span>&nbsp;<span class="ident" id="6677503">c</span><span class="op" id="6677504">.</span><span class="ident" id="6677505">File</span><span class="op" id="6677509">(</span><span class="op" id="6677510">)</span><span class="op" id="6677511">;</span>&nbsp;<span class="ident" id="6677513">err</span>&nbsp;<span class="op" id="6677517">!=</span>&nbsp;<span class="ident" id="6677520">nil</span>&nbsp;<span class="op" id="6677524">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677528">condFatalf</span><span class="op" id="6677538">(</span><span class="ident" id="6677539">t</span><span class="op" id="6677540">,</span>&nbsp;<span class="string" id="6677542">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677567">,</span>&nbsp;<span class="ident" id="6677569">err</span><span class="op" id="6677572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677575">}</span>&nbsp;<span class="keyword" id="6677577">else</span>&nbsp;<span class="op" id="6677582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677586">f</span><span class="op" id="6677587">.</span><span class="ident" id="6677588">Close</span><span class="op" id="6677593">(</span><span class="op" id="6677594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677601">defer</span>&nbsp;<span class="keyword" id="6677607">func</span><span class="op" id="6677611">(</span><span class="op" id="6677612">)</span>&nbsp;<span class="op" id="6677614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677618">if</span>&nbsp;<span class="ident" id="6677621">p</span>&nbsp;<span class="op" id="6677623">:=</span>&nbsp;<span class="builtinfunc" id="6677626">recover</span><span class="op" id="6677633">(</span><span class="op" id="6677634">)</span><span class="op" id="6677635">;</span>&nbsp;<span class="ident" id="6677637">p</span>&nbsp;<span class="op" id="6677639">!=</span>&nbsp;<span class="ident" id="6677642">nil</span>&nbsp;<span class="op" id="6677646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677651">t</span><span class="op" id="6677652">.</span><span class="ident" id="6677653">Fatalf</span><span class="op" id="6677659">(</span><span class="string" id="6677660">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6677708">,</span>&nbsp;<span class="ident" id="6677710">p</span><span class="op" id="6677711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677718">}</span><span class="op" id="6677719">(</span><span class="op" id="6677720">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677724">c</span><span class="op" id="6677725">.</span><span class="ident" id="6677726">WriteToUDP</span><span class="op" id="6677736">(</span><span class="ident" id="6677737">wb</span><span class="op" id="6677739">,</span>&nbsp;<span class="ident" id="6677741">nil</span><span class="op" id="6677744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677747">c</span><span class="op" id="6677748">.</span><span class="ident" id="6677749">WriteMsgUDP</span><span class="op" id="6677760">(</span><span class="ident" id="6677761">wb</span><span class="op" id="6677763">,</span>&nbsp;<span class="ident" id="6677765">nil</span><span class="op" id="6677768">,</span>&nbsp;<span class="ident" id="6677770">nil</span><span class="op" id="6677773">)</span><br>
<span class="lineno"></span><span class="op" id="6677775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6677778">func</span>&nbsp;<span class="ident" id="6677783">TestIPConnSpecificMethods</span><span class="op" id="6677808">(</span><span class="ident" id="6677809">t</span>&nbsp;<span class="op" id="6677811">*</span><span class="ident" id="6677812">testing</span><span class="op" id="6677819">.</span><span class="ident" id="6677820">T</span><span class="op" id="6677821">)</span>&nbsp;<span class="op" id="6677823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677826">if</span>&nbsp;<span class="ident" id="6677829">skip</span><span class="op" id="6677833">,</span>&nbsp;<span class="ident" id="6677835">skipmsg</span>&nbsp;<span class="op" id="6677843">:=</span>&nbsp;<span class="ident" id="6677846">skipRawSocketTest</span><span class="op" id="6677863">(</span><span class="ident" id="6677864">t</span><span class="op" id="6677865">)</span><span class="op" id="6677866">;</span>&nbsp;<span class="ident" id="6677868">skip</span>&nbsp;<span class="op" id="6677873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677877">t</span><span class="op" id="6677878">.</span><span class="ident" id="6677879">Skip</span><span class="op" id="6677883">(</span><span class="ident" id="6677884">skipmsg</span><span class="op" id="6677891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677898">la</span><span class="op" id="6677900">,</span>&nbsp;<span class="ident" id="6677902">err</span>&nbsp;<span class="op" id="6677906">:=</span>&nbsp;<span class="ident" id="6677909">ResolveIPAddr</span><span class="op" id="6677922">(</span><span class="string" id="6677923">&#34;ip4&#34;</span><span class="op" id="6677928">,</span>&nbsp;<span class="string" id="6677930">&#34;127.0.0.1&#34;</span><span class="op" id="6677941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677944">if</span>&nbsp;<span class="ident" id="6677947">err</span>&nbsp;<span class="op" id="6677951">!=</span>&nbsp;<span class="ident" id="6677954">nil</span>&nbsp;<span class="op" id="6677958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677962">t</span><span class="op" id="6677963">.</span><span class="ident" id="6677964">Fatalf</span><span class="op" id="6677970">(</span><span class="string" id="6677971">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6677997">,</span>&nbsp;<span class="ident" id="6677999">err</span><span class="op" id="6678002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678008">c</span><span class="op" id="6678009">,</span>&nbsp;<span class="ident" id="6678011">err</span>&nbsp;<span class="op" id="6678015">:=</span>&nbsp;<span class="ident" id="6678018">ListenIP</span><span class="op" id="6678026">(</span><span class="string" id="6678027">&#34;ip4:icmp&#34;</span><span class="op" id="6678037">,</span>&nbsp;<span class="ident" id="6678039">la</span><span class="op" id="6678041">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678044">if</span>&nbsp;<span class="ident" id="6678047">err</span>&nbsp;<span class="op" id="6678051">!=</span>&nbsp;<span class="ident" id="6678054">nil</span>&nbsp;<span class="op" id="6678058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678062">t</span><span class="op" id="6678063">.</span><span class="ident" id="6678064">Fatalf</span><span class="op" id="6678070">(</span><span class="string" id="6678071">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6678092">,</span>&nbsp;<span class="ident" id="6678094">err</span><span class="op" id="6678097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678103">defer</span>&nbsp;<span class="ident" id="6678109">c</span><span class="op" id="6678110">.</span><span class="ident" id="6678111">Close</span><span class="op" id="6678116">(</span><span class="op" id="6678117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678120">c</span><span class="op" id="6678121">.</span><span class="ident" id="6678122">LocalAddr</span><span class="op" id="6678131">(</span><span class="op" id="6678132">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678135">c</span><span class="op" id="6678136">.</span><span class="ident" id="6678137">RemoteAddr</span><span class="op" id="6678147">(</span><span class="op" id="6678148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678151">c</span><span class="op" id="6678152">.</span><span class="ident" id="6678153">SetDeadline</span><span class="op" id="6678164">(</span><span class="ident" id="6678165">time</span><span class="op" id="6678169">.</span><span class="ident" id="6678170">Now</span><span class="op" id="6678173">(</span><span class="op" id="6678174">)</span><span class="op" id="6678175">.</span><span class="ident" id="6678176">Add</span><span class="op" id="6678179">(</span><span class="ident" id="6678180">someTimeout</span><span class="op" id="6678191">)</span><span class="op" id="6678192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678195">c</span><span class="op" id="6678196">.</span><span class="ident" id="6678197">SetReadDeadline</span><span class="op" id="6678212">(</span><span class="ident" id="6678213">time</span><span class="op" id="6678217">.</span><span class="ident" id="6678218">Now</span><span class="op" id="6678221">(</span><span class="op" id="6678222">)</span><span class="op" id="6678223">.</span><span class="ident" id="6678224">Add</span><span class="op" id="6678227">(</span><span class="ident" id="6678228">someTimeout</span><span class="op" id="6678239">)</span><span class="op" id="6678240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678243">c</span><span class="op" id="6678244">.</span><span class="ident" id="6678245">SetWriteDeadline</span><span class="op" id="6678261">(</span><span class="ident" id="6678262">time</span><span class="op" id="6678266">.</span><span class="ident" id="6678267">Now</span><span class="op" id="6678270">(</span><span class="op" id="6678271">)</span><span class="op" id="6678272">.</span><span class="ident" id="6678273">Add</span><span class="op" id="6678276">(</span><span class="ident" id="6678277">someTimeout</span><span class="op" id="6678288">)</span><span class="op" id="6678289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678292">c</span><span class="op" id="6678293">.</span><span class="ident" id="6678294">SetReadBuffer</span><span class="op" id="6678307">(</span><span class="num" id="6678308">2048</span><span class="op" id="6678312">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678315">c</span><span class="op" id="6678316">.</span><span class="ident" id="6678317">SetWriteBuffer</span><span class="op" id="6678331">(</span><span class="num" id="6678332">2048</span><span class="op" id="6678336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678340">wb</span><span class="op" id="6678342">,</span>&nbsp;<span class="ident" id="6678344">err</span>&nbsp;<span class="op" id="6678348">:=</span>&nbsp;<span class="op" id="6678351">(</span><span class="op" id="6678352">&amp;</span><span class="ident" id="6678353">icmpMessage</span><span class="op" id="6678364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678368">Type</span><span class="op" id="6678372">:</span>&nbsp;<span class="ident" id="6678374">icmpv4EchoRequest</span><span class="op" id="6678391">,</span>&nbsp;<span class="ident" id="6678393">Code</span><span class="op" id="6678397">:</span>&nbsp;<span class="num" id="6678399">0</span><span class="op" id="6678400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678404">Body</span><span class="op" id="6678408">:</span>&nbsp;<span class="op" id="6678410">&amp;</span><span class="ident" id="6678411">icmpEcho</span><span class="op" id="6678419">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678424">ID</span><span class="op" id="6678426">:</span>&nbsp;<span class="ident" id="6678428">os</span><span class="op" id="6678430">.</span><span class="ident" id="6678431">Getpid</span><span class="op" id="6678437">(</span><span class="op" id="6678438">)</span>&nbsp;<span class="op" id="6678440">&amp;</span>&nbsp;<span class="num" id="6678442">0xffff</span><span class="op" id="6678448">,</span>&nbsp;<span class="ident" id="6678450">Seq</span><span class="op" id="6678453">:</span>&nbsp;<span class="num" id="6678455">1</span><span class="op" id="6678456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678461">Data</span><span class="op" id="6678465">:</span>&nbsp;<span class="op" id="6678467">[</span><span class="op" id="6678468">]</span><span class="builtintype" id="6678469">byte</span><span class="op" id="6678473">(</span><span class="string" id="6678474">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="6678488">)</span><span class="op" id="6678489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678493">}</span><span class="op" id="6678494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678497">}</span><span class="op" id="6678498">)</span><span class="op" id="6678499">.</span><span class="ident" id="6678500">Marshal</span><span class="op" id="6678507">(</span><span class="op" id="6678508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678511">if</span>&nbsp;<span class="ident" id="6678514">err</span>&nbsp;<span class="op" id="6678518">!=</span>&nbsp;<span class="ident" id="6678521">nil</span>&nbsp;<span class="op" id="6678525">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678529">t</span><span class="op" id="6678530">.</span><span class="ident" id="6678531">Fatalf</span><span class="op" id="6678537">(</span><span class="string" id="6678538">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6678570">,</span>&nbsp;<span class="ident" id="6678572">err</span><span class="op" id="6678575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678581">rb</span>&nbsp;<span class="op" id="6678584">:=</span>&nbsp;<span class="builtinfunc" id="6678587">make</span><span class="op" id="6678591">(</span><span class="op" id="6678592">[</span><span class="op" id="6678593">]</span><span class="builtintype" id="6678594">byte</span><span class="op" id="6678598">,</span>&nbsp;<span class="num" id="6678600">20</span><span class="op" id="6678602">+</span><span class="builtinfunc" id="6678603">len</span><span class="op" id="6678606">(</span><span class="ident" id="6678607">wb</span><span class="op" id="6678609">)</span><span class="op" id="6678610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678613">if</span>&nbsp;<span class="ident" id="6678616">_</span><span class="op" id="6678617">,</span>&nbsp;<span class="ident" id="6678619">err</span>&nbsp;<span class="op" id="6678623">:=</span>&nbsp;<span class="ident" id="6678626">c</span><span class="op" id="6678627">.</span><span class="ident" id="6678628">WriteToIP</span><span class="op" id="6678637">(</span><span class="ident" id="6678638">wb</span><span class="op" id="6678640">,</span>&nbsp;<span class="ident" id="6678642">c</span><span class="op" id="6678643">.</span><span class="ident" id="6678644">LocalAddr</span><span class="op" id="6678653">(</span><span class="op" id="6678654">)</span><span class="op" id="6678655">.</span><span class="op" id="6678656">(</span><span class="op" id="6678657">*</span><span class="ident" id="6678658">IPAddr</span><span class="op" id="6678664">)</span><span class="op" id="6678665">)</span><span class="op" id="6678666">;</span>&nbsp;<span class="ident" id="6678668">err</span>&nbsp;<span class="op" id="6678672">!=</span>&nbsp;<span class="ident" id="6678675">nil</span>&nbsp;<span class="op" id="6678679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678683">t</span><span class="op" id="6678684">.</span><span class="ident" id="6678685">Fatalf</span><span class="op" id="6678691">(</span><span class="string" id="6678692">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6678721">,</span>&nbsp;<span class="ident" id="6678723">err</span><span class="op" id="6678726">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678732">if</span>&nbsp;<span class="ident" id="6678735">_</span><span class="op" id="6678736">,</span>&nbsp;<span class="ident" id="6678738">_</span><span class="op" id="6678739">,</span>&nbsp;<span class="ident" id="6678741">err</span>&nbsp;<span class="op" id="6678745">:=</span>&nbsp;<span class="ident" id="6678748">c</span><span class="op" id="6678749">.</span><span class="ident" id="6678750">ReadFromIP</span><span class="op" id="6678760">(</span><span class="ident" id="6678761">rb</span><span class="op" id="6678763">)</span><span class="op" id="6678764">;</span>&nbsp;<span class="ident" id="6678766">err</span>&nbsp;<span class="op" id="6678770">!=</span>&nbsp;<span class="ident" id="6678773">nil</span>&nbsp;<span class="op" id="6678777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678781">t</span><span class="op" id="6678782">.</span><span class="ident" id="6678783">Fatalf</span><span class="op" id="6678789">(</span><span class="string" id="6678790">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6678820">,</span>&nbsp;<span class="ident" id="6678822">err</span><span class="op" id="6678825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678831">if</span>&nbsp;<span class="ident" id="6678834">_</span><span class="op" id="6678835">,</span>&nbsp;<span class="ident" id="6678837">_</span><span class="op" id="6678838">,</span>&nbsp;<span class="ident" id="6678840">err</span>&nbsp;<span class="op" id="6678844">:=</span>&nbsp;<span class="ident" id="6678847">c</span><span class="op" id="6678848">.</span><span class="ident" id="6678849">WriteMsgIP</span><span class="op" id="6678859">(</span><span class="ident" id="6678860">wb</span><span class="op" id="6678862">,</span>&nbsp;<span class="ident" id="6678864">nil</span><span class="op" id="6678867">,</span>&nbsp;<span class="ident" id="6678869">c</span><span class="op" id="6678870">.</span><span class="ident" id="6678871">LocalAddr</span><span class="op" id="6678880">(</span><span class="op" id="6678881">)</span><span class="op" id="6678882">.</span><span class="op" id="6678883">(</span><span class="op" id="6678884">*</span><span class="ident" id="6678885">IPAddr</span><span class="op" id="6678891">)</span><span class="op" id="6678892">)</span><span class="op" id="6678893">;</span>&nbsp;<span class="ident" id="6678895">err</span>&nbsp;<span class="op" id="6678899">!=</span>&nbsp;<span class="ident" id="6678902">nil</span>&nbsp;<span class="op" id="6678906">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678910">condFatalf</span><span class="op" id="6678920">(</span><span class="ident" id="6678921">t</span><span class="op" id="6678922">,</span>&nbsp;<span class="string" id="6678924">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6678954">,</span>&nbsp;<span class="ident" id="6678956">err</span><span class="op" id="6678959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6678965">if</span>&nbsp;<span class="ident" id="6678968">_</span><span class="op" id="6678969">,</span>&nbsp;<span class="ident" id="6678971">_</span><span class="op" id="6678972">,</span>&nbsp;<span class="ident" id="6678974">_</span><span class="op" id="6678975">,</span>&nbsp;<span class="ident" id="6678977">_</span><span class="op" id="6678978">,</span>&nbsp;<span class="ident" id="6678980">err</span>&nbsp;<span class="op" id="6678984">:=</span>&nbsp;<span class="ident" id="6678987">c</span><span class="op" id="6678988">.</span><span class="ident" id="6678989">ReadMsgIP</span><span class="op" id="6678998">(</span><span class="ident" id="6678999">rb</span><span class="op" id="6679001">,</span>&nbsp;<span class="ident" id="6679003">nil</span><span class="op" id="6679006">)</span><span class="op" id="6679007">;</span>&nbsp;<span class="ident" id="6679009">err</span>&nbsp;<span class="op" id="6679013">!=</span>&nbsp;<span class="ident" id="6679016">nil</span>&nbsp;<span class="op" id="6679020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679024">condFatalf</span><span class="op" id="6679034">(</span><span class="ident" id="6679035">t</span><span class="op" id="6679036">,</span>&nbsp;<span class="string" id="6679038">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679067">,</span>&nbsp;<span class="ident" id="6679069">err</span><span class="op" id="6679072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679075">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679079">if</span>&nbsp;<span class="ident" id="6679082">f</span><span class="op" id="6679083">,</span>&nbsp;<span class="ident" id="6679085">err</span>&nbsp;<span class="op" id="6679089">:=</span>&nbsp;<span class="ident" id="6679092">c</span><span class="op" id="6679093">.</span><span class="ident" id="6679094">File</span><span class="op" id="6679098">(</span><span class="op" id="6679099">)</span><span class="op" id="6679100">;</span>&nbsp;<span class="ident" id="6679102">err</span>&nbsp;<span class="op" id="6679106">!=</span>&nbsp;<span class="ident" id="6679109">nil</span>&nbsp;<span class="op" id="6679113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679117">condFatalf</span><span class="op" id="6679127">(</span><span class="ident" id="6679128">t</span><span class="op" id="6679129">,</span>&nbsp;<span class="string" id="6679131">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679155">,</span>&nbsp;<span class="ident" id="6679157">err</span><span class="op" id="6679160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679163">}</span>&nbsp;<span class="keyword" id="6679165">else</span>&nbsp;<span class="op" id="6679170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679174">f</span><span class="op" id="6679175">.</span><span class="ident" id="6679176">Close</span><span class="op" id="6679181">(</span><span class="op" id="6679182">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679189">defer</span>&nbsp;<span class="keyword" id="6679195">func</span><span class="op" id="6679199">(</span><span class="op" id="6679200">)</span>&nbsp;<span class="op" id="6679202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679206">if</span>&nbsp;<span class="ident" id="6679209">p</span>&nbsp;<span class="op" id="6679211">:=</span>&nbsp;<span class="builtinfunc" id="6679214">recover</span><span class="op" id="6679221">(</span><span class="op" id="6679222">)</span><span class="op" id="6679223">;</span>&nbsp;<span class="ident" id="6679225">p</span>&nbsp;<span class="op" id="6679227">!=</span>&nbsp;<span class="ident" id="6679230">nil</span>&nbsp;<span class="op" id="6679234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679239">t</span><span class="op" id="6679240">.</span><span class="ident" id="6679241">Fatalf</span><span class="op" id="6679247">(</span><span class="string" id="6679248">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6679293">,</span>&nbsp;<span class="ident" id="6679295">p</span><span class="op" id="6679296">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679303">}</span><span class="op" id="6679304">(</span><span class="op" id="6679305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679309">c</span><span class="op" id="6679310">.</span><span class="ident" id="6679311">WriteToIP</span><span class="op" id="6679320">(</span><span class="ident" id="6679321">wb</span><span class="op" id="6679323">,</span>&nbsp;<span class="ident" id="6679325">nil</span><span class="op" id="6679328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679331">c</span><span class="op" id="6679332">.</span><span class="ident" id="6679333">WriteMsgIP</span><span class="op" id="6679343">(</span><span class="ident" id="6679344">wb</span><span class="op" id="6679346">,</span>&nbsp;<span class="ident" id="6679348">nil</span><span class="op" id="6679351">,</span>&nbsp;<span class="ident" id="6679353">nil</span><span class="op" id="6679356">)</span><br>
<span class="lineno">235</span><span class="op" id="6679358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6679361">func</span>&nbsp;<span class="ident" id="6679366">TestUnixListenerSpecificMethods</span><span class="op" id="6679397">(</span><span class="ident" id="6679398">t</span>&nbsp;<span class="op" id="6679400">*</span><span class="ident" id="6679401">testing</span><span class="op" id="6679408">.</span><span class="ident" id="6679409">T</span><span class="op" id="6679410">)</span>&nbsp;<span class="op" id="6679412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679415">switch</span>&nbsp;<span class="ident" id="6679422">runtime</span><span class="op" id="6679429">.</span><span class="ident" id="6679430">GOOS</span>&nbsp;<span class="op" id="6679435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679438">case</span>&nbsp;<span class="string" id="6679443">&#34;nacl&#34;</span><span class="op" id="6679449">,</span>&nbsp;<span class="string" id="6679451">&#34;plan9&#34;</span><span class="op" id="6679458">,</span>&nbsp;<span class="string" id="6679460">&#34;windows&#34;</span><span class="op" id="6679469">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679473">t</span><span class="op" id="6679474">.</span><span class="ident" id="6679475">Skipf</span><span class="op" id="6679480">(</span><span class="string" id="6679481">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6679502">,</span>&nbsp;<span class="ident" id="6679504">runtime</span><span class="op" id="6679511">.</span><span class="ident" id="6679512">GOOS</span><span class="op" id="6679516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679523">addr</span>&nbsp;<span class="op" id="6679528">:=</span>&nbsp;<span class="ident" id="6679531">testUnixAddr</span><span class="op" id="6679543">(</span><span class="op" id="6679544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679547">la</span><span class="op" id="6679549">,</span>&nbsp;<span class="ident" id="6679551">err</span>&nbsp;<span class="op" id="6679555">:=</span>&nbsp;<span class="ident" id="6679558">ResolveUnixAddr</span><span class="op" id="6679573">(</span><span class="string" id="6679574">&#34;unix&#34;</span><span class="op" id="6679580">,</span>&nbsp;<span class="ident" id="6679582">addr</span><span class="op" id="6679586">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679589">if</span>&nbsp;<span class="ident" id="6679592">err</span>&nbsp;<span class="op" id="6679596">!=</span>&nbsp;<span class="ident" id="6679599">nil</span>&nbsp;<span class="op" id="6679603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679607">t</span><span class="op" id="6679608">.</span><span class="ident" id="6679609">Fatalf</span><span class="op" id="6679615">(</span><span class="string" id="6679616">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679644">,</span>&nbsp;<span class="ident" id="6679646">err</span><span class="op" id="6679649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679655">ln</span><span class="op" id="6679657">,</span>&nbsp;<span class="ident" id="6679659">err</span>&nbsp;<span class="op" id="6679663">:=</span>&nbsp;<span class="ident" id="6679666">ListenUnix</span><span class="op" id="6679676">(</span><span class="string" id="6679677">&#34;unix&#34;</span><span class="op" id="6679683">,</span>&nbsp;<span class="ident" id="6679685">la</span><span class="op" id="6679687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679690">if</span>&nbsp;<span class="ident" id="6679693">err</span>&nbsp;<span class="op" id="6679697">!=</span>&nbsp;<span class="ident" id="6679700">nil</span>&nbsp;<span class="op" id="6679704">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679708">t</span><span class="op" id="6679709">.</span><span class="ident" id="6679710">Fatalf</span><span class="op" id="6679716">(</span><span class="string" id="6679717">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679740">,</span>&nbsp;<span class="ident" id="6679742">err</span><span class="op" id="6679745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679751">defer</span>&nbsp;<span class="ident" id="6679757">ln</span><span class="op" id="6679759">.</span><span class="ident" id="6679760">Close</span><span class="op" id="6679765">(</span><span class="op" id="6679766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679769">defer</span>&nbsp;<span class="ident" id="6679775">os</span><span class="op" id="6679777">.</span><span class="ident" id="6679778">Remove</span><span class="op" id="6679784">(</span><span class="ident" id="6679785">addr</span><span class="op" id="6679789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679792">ln</span><span class="op" id="6679794">.</span><span class="ident" id="6679795">Addr</span><span class="op" id="6679799">(</span><span class="op" id="6679800">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679803">ln</span><span class="op" id="6679805">.</span><span class="ident" id="6679806">SetDeadline</span><span class="op" id="6679817">(</span><span class="ident" id="6679818">time</span><span class="op" id="6679822">.</span><span class="ident" id="6679823">Now</span><span class="op" id="6679826">(</span><span class="op" id="6679827">)</span><span class="op" id="6679828">.</span><span class="ident" id="6679829">Add</span><span class="op" id="6679832">(</span><span class="num" id="6679833">30</span>&nbsp;<span class="op" id="6679836">*</span>&nbsp;<span class="ident" id="6679838">time</span><span class="op" id="6679842">.</span><span class="ident" id="6679843">Nanosecond</span><span class="op" id="6679853">)</span><span class="op" id="6679854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679858">if</span>&nbsp;<span class="ident" id="6679861">c</span><span class="op" id="6679862">,</span>&nbsp;<span class="ident" id="6679864">err</span>&nbsp;<span class="op" id="6679868">:=</span>&nbsp;<span class="ident" id="6679871">ln</span><span class="op" id="6679873">.</span><span class="ident" id="6679874">Accept</span><span class="op" id="6679880">(</span><span class="op" id="6679881">)</span><span class="op" id="6679882">;</span>&nbsp;<span class="ident" id="6679884">err</span>&nbsp;<span class="op" id="6679888">!=</span>&nbsp;<span class="ident" id="6679891">nil</span>&nbsp;<span class="op" id="6679895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679899">if</span>&nbsp;<span class="op" id="6679902">!</span><span class="ident" id="6679903">err</span><span class="op" id="6679906">.</span><span class="op" id="6679907">(</span><span class="ident" id="6679908">Error</span><span class="op" id="6679913">)</span><span class="op" id="6679914">.</span><span class="ident" id="6679915">Timeout</span><span class="op" id="6679922">(</span><span class="op" id="6679923">)</span>&nbsp;<span class="op" id="6679925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679930">t</span><span class="op" id="6679931">.</span><span class="ident" id="6679932">Fatalf</span><span class="op" id="6679938">(</span><span class="string" id="6679939">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6679971">,</span>&nbsp;<span class="ident" id="6679973">err</span><span class="op" id="6679976">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679983">}</span>&nbsp;<span class="keyword" id="6679985">else</span>&nbsp;<span class="op" id="6679990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679994">c</span><span class="op" id="6679995">.</span><span class="ident" id="6679996">Close</span><span class="op" id="6680001">(</span><span class="op" id="6680002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680008">if</span>&nbsp;<span class="ident" id="6680011">c</span><span class="op" id="6680012">,</span>&nbsp;<span class="ident" id="6680014">err</span>&nbsp;<span class="op" id="6680018">:=</span>&nbsp;<span class="ident" id="6680021">ln</span><span class="op" id="6680023">.</span><span class="ident" id="6680024">AcceptUnix</span><span class="op" id="6680034">(</span><span class="op" id="6680035">)</span><span class="op" id="6680036">;</span>&nbsp;<span class="ident" id="6680038">err</span>&nbsp;<span class="op" id="6680042">!=</span>&nbsp;<span class="ident" id="6680045">nil</span>&nbsp;<span class="op" id="6680049">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680053">if</span>&nbsp;<span class="op" id="6680056">!</span><span class="ident" id="6680057">err</span><span class="op" id="6680060">.</span><span class="op" id="6680061">(</span><span class="ident" id="6680062">Error</span><span class="op" id="6680067">)</span><span class="op" id="6680068">.</span><span class="ident" id="6680069">Timeout</span><span class="op" id="6680076">(</span><span class="op" id="6680077">)</span>&nbsp;<span class="op" id="6680079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680084">t</span><span class="op" id="6680085">.</span><span class="ident" id="6680086">Fatalf</span><span class="op" id="6680092">(</span><span class="string" id="6680093">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6680129">,</span>&nbsp;<span class="ident" id="6680131">err</span><span class="op" id="6680134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680141">}</span>&nbsp;<span class="keyword" id="6680143">else</span>&nbsp;<span class="op" id="6680148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680152">c</span><span class="op" id="6680153">.</span><span class="ident" id="6680154">Close</span><span class="op" id="6680159">(</span><span class="op" id="6680160">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680167">if</span>&nbsp;<span class="ident" id="6680170">f</span><span class="op" id="6680171">,</span>&nbsp;<span class="ident" id="6680173">err</span>&nbsp;<span class="op" id="6680177">:=</span>&nbsp;<span class="ident" id="6680180">ln</span><span class="op" id="6680182">.</span><span class="ident" id="6680183">File</span><span class="op" id="6680187">(</span><span class="op" id="6680188">)</span><span class="op" id="6680189">;</span>&nbsp;<span class="ident" id="6680191">err</span>&nbsp;<span class="op" id="6680195">!=</span>&nbsp;<span class="ident" id="6680198">nil</span>&nbsp;<span class="op" id="6680202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680206">t</span><span class="op" id="6680207">.</span><span class="ident" id="6680208">Fatalf</span><span class="op" id="6680214">(</span><span class="string" id="6680215">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6680245">,</span>&nbsp;<span class="ident" id="6680247">err</span><span class="op" id="6680250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680253">}</span>&nbsp;<span class="keyword" id="6680255">else</span>&nbsp;<span class="op" id="6680260">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680264">f</span><span class="op" id="6680265">.</span><span class="ident" id="6680266">Close</span><span class="op" id="6680271">(</span><span class="op" id="6680272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680275">}</span><br>
<span class="lineno"></span><span class="op" id="6680277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6680280">func</span>&nbsp;<span class="ident" id="6680285">TestUnixConnSpecificMethods</span><span class="op" id="6680312">(</span><span class="ident" id="6680313">t</span>&nbsp;<span class="op" id="6680315">*</span><span class="ident" id="6680316">testing</span><span class="op" id="6680323">.</span><span class="ident" id="6680324">T</span><span class="op" id="6680325">)</span>&nbsp;<span class="op" id="6680327">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680330">switch</span>&nbsp;<span class="ident" id="6680337">runtime</span><span class="op" id="6680344">.</span><span class="ident" id="6680345">GOOS</span>&nbsp;<span class="op" id="6680350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680353">case</span>&nbsp;<span class="string" id="6680358">&#34;nacl&#34;</span><span class="op" id="6680364">,</span>&nbsp;<span class="string" id="6680366">&#34;plan9&#34;</span><span class="op" id="6680373">,</span>&nbsp;<span class="string" id="6680375">&#34;windows&#34;</span><span class="op" id="6680384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680388">t</span><span class="op" id="6680389">.</span><span class="ident" id="6680390">Skipf</span><span class="op" id="6680395">(</span><span class="string" id="6680396">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6680417">,</span>&nbsp;<span class="ident" id="6680419">runtime</span><span class="op" id="6680426">.</span><span class="ident" id="6680427">GOOS</span><span class="op" id="6680431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680438">addr1</span><span class="op" id="6680443">,</span>&nbsp;<span class="ident" id="6680445">addr2</span><span class="op" id="6680450">,</span>&nbsp;<span class="ident" id="6680452">addr3</span>&nbsp;<span class="op" id="6680458">:=</span>&nbsp;<span class="ident" id="6680461">testUnixAddr</span><span class="op" id="6680473">(</span><span class="op" id="6680474">)</span><span class="op" id="6680475">,</span>&nbsp;<span class="ident" id="6680477">testUnixAddr</span><span class="op" id="6680489">(</span><span class="op" id="6680490">)</span><span class="op" id="6680491">,</span>&nbsp;<span class="ident" id="6680493">testUnixAddr</span><span class="op" id="6680505">(</span><span class="op" id="6680506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680510">a1</span><span class="op" id="6680512">,</span>&nbsp;<span class="ident" id="6680514">err</span>&nbsp;<span class="op" id="6680518">:=</span>&nbsp;<span class="ident" id="6680521">ResolveUnixAddr</span><span class="op" id="6680536">(</span><span class="string" id="6680537">&#34;unixgram&#34;</span><span class="op" id="6680547">,</span>&nbsp;<span class="ident" id="6680549">addr1</span><span class="op" id="6680554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680557">if</span>&nbsp;<span class="ident" id="6680560">err</span>&nbsp;<span class="op" id="6680564">!=</span>&nbsp;<span class="ident" id="6680567">nil</span>&nbsp;<span class="op" id="6680571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680575">t</span><span class="op" id="6680576">.</span><span class="ident" id="6680577">Fatalf</span><span class="op" id="6680583">(</span><span class="string" id="6680584">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6680612">,</span>&nbsp;<span class="ident" id="6680614">err</span><span class="op" id="6680617">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680623">c1</span><span class="op" id="6680625">,</span>&nbsp;<span class="ident" id="6680627">err</span>&nbsp;<span class="op" id="6680631">:=</span>&nbsp;<span class="ident" id="6680634">DialUnix</span><span class="op" id="6680642">(</span><span class="string" id="6680643">&#34;unixgram&#34;</span><span class="op" id="6680653">,</span>&nbsp;<span class="ident" id="6680655">a1</span><span class="op" id="6680657">,</span>&nbsp;<span class="ident" id="6680659">nil</span><span class="op" id="6680662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680665">if</span>&nbsp;<span class="ident" id="6680668">err</span>&nbsp;<span class="op" id="6680672">!=</span>&nbsp;<span class="ident" id="6680675">nil</span>&nbsp;<span class="op" id="6680679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680683">t</span><span class="op" id="6680684">.</span><span class="ident" id="6680685">Fatalf</span><span class="op" id="6680691">(</span><span class="string" id="6680692">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6680713">,</span>&nbsp;<span class="ident" id="6680715">err</span><span class="op" id="6680718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680721">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680724">defer</span>&nbsp;<span class="ident" id="6680730">c1</span><span class="op" id="6680732">.</span><span class="ident" id="6680733">Close</span><span class="op" id="6680738">(</span><span class="op" id="6680739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680742">defer</span>&nbsp;<span class="ident" id="6680748">os</span><span class="op" id="6680750">.</span><span class="ident" id="6680751">Remove</span><span class="op" id="6680757">(</span><span class="ident" id="6680758">addr1</span><span class="op" id="6680763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680766">c1</span><span class="op" id="6680768">.</span><span class="ident" id="6680769">LocalAddr</span><span class="op" id="6680778">(</span><span class="op" id="6680779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680782">c1</span><span class="op" id="6680784">.</span><span class="ident" id="6680785">RemoteAddr</span><span class="op" id="6680795">(</span><span class="op" id="6680796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680799">c1</span><span class="op" id="6680801">.</span><span class="ident" id="6680802">SetDeadline</span><span class="op" id="6680813">(</span><span class="ident" id="6680814">time</span><span class="op" id="6680818">.</span><span class="ident" id="6680819">Now</span><span class="op" id="6680822">(</span><span class="op" id="6680823">)</span><span class="op" id="6680824">.</span><span class="ident" id="6680825">Add</span><span class="op" id="6680828">(</span><span class="ident" id="6680829">someTimeout</span><span class="op" id="6680840">)</span><span class="op" id="6680841">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680844">c1</span><span class="op" id="6680846">.</span><span class="ident" id="6680847">SetReadDeadline</span><span class="op" id="6680862">(</span><span class="ident" id="6680863">time</span><span class="op" id="6680867">.</span><span class="ident" id="6680868">Now</span><span class="op" id="6680871">(</span><span class="op" id="6680872">)</span><span class="op" id="6680873">.</span><span class="ident" id="6680874">Add</span><span class="op" id="6680877">(</span><span class="ident" id="6680878">someTimeout</span><span class="op" id="6680889">)</span><span class="op" id="6680890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680893">c1</span><span class="op" id="6680895">.</span><span class="ident" id="6680896">SetWriteDeadline</span><span class="op" id="6680912">(</span><span class="ident" id="6680913">time</span><span class="op" id="6680917">.</span><span class="ident" id="6680918">Now</span><span class="op" id="6680921">(</span><span class="op" id="6680922">)</span><span class="op" id="6680923">.</span><span class="ident" id="6680924">Add</span><span class="op" id="6680927">(</span><span class="ident" id="6680928">someTimeout</span><span class="op" id="6680939">)</span><span class="op" id="6680940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680943">c1</span><span class="op" id="6680945">.</span><span class="ident" id="6680946">SetReadBuffer</span><span class="op" id="6680959">(</span><span class="num" id="6680960">2048</span><span class="op" id="6680964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680967">c1</span><span class="op" id="6680969">.</span><span class="ident" id="6680970">SetWriteBuffer</span><span class="op" id="6680984">(</span><span class="num" id="6680985">2048</span><span class="op" id="6680989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680993">a2</span><span class="op" id="6680995">,</span>&nbsp;<span class="ident" id="6680997">err</span>&nbsp;<span class="op" id="6681001">:=</span>&nbsp;<span class="ident" id="6681004">ResolveUnixAddr</span><span class="op" id="6681019">(</span><span class="string" id="6681020">&#34;unixgram&#34;</span><span class="op" id="6681030">,</span>&nbsp;<span class="ident" id="6681032">addr2</span><span class="op" id="6681037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681040">if</span>&nbsp;<span class="ident" id="6681043">err</span>&nbsp;<span class="op" id="6681047">!=</span>&nbsp;<span class="ident" id="6681050">nil</span>&nbsp;<span class="op" id="6681054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681058">t</span><span class="op" id="6681059">.</span><span class="ident" id="6681060">Fatalf</span><span class="op" id="6681066">(</span><span class="string" id="6681067">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681095">,</span>&nbsp;<span class="ident" id="6681097">err</span><span class="op" id="6681100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681106">c2</span><span class="op" id="6681108">,</span>&nbsp;<span class="ident" id="6681110">err</span>&nbsp;<span class="op" id="6681114">:=</span>&nbsp;<span class="ident" id="6681117">DialUnix</span><span class="op" id="6681125">(</span><span class="string" id="6681126">&#34;unixgram&#34;</span><span class="op" id="6681136">,</span>&nbsp;<span class="ident" id="6681138">a2</span><span class="op" id="6681140">,</span>&nbsp;<span class="ident" id="6681142">nil</span><span class="op" id="6681145">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681148">if</span>&nbsp;<span class="ident" id="6681151">err</span>&nbsp;<span class="op" id="6681155">!=</span>&nbsp;<span class="ident" id="6681158">nil</span>&nbsp;<span class="op" id="6681162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681166">t</span><span class="op" id="6681167">.</span><span class="ident" id="6681168">Fatalf</span><span class="op" id="6681174">(</span><span class="string" id="6681175">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681196">,</span>&nbsp;<span class="ident" id="6681198">err</span><span class="op" id="6681201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681207">defer</span>&nbsp;<span class="ident" id="6681213">c2</span><span class="op" id="6681215">.</span><span class="ident" id="6681216">Close</span><span class="op" id="6681221">(</span><span class="op" id="6681222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681225">defer</span>&nbsp;<span class="ident" id="6681231">os</span><span class="op" id="6681233">.</span><span class="ident" id="6681234">Remove</span><span class="op" id="6681240">(</span><span class="ident" id="6681241">addr2</span><span class="op" id="6681246">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681249">c2</span><span class="op" id="6681251">.</span><span class="ident" id="6681252">LocalAddr</span><span class="op" id="6681261">(</span><span class="op" id="6681262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681265">c2</span><span class="op" id="6681267">.</span><span class="ident" id="6681268">RemoteAddr</span><span class="op" id="6681278">(</span><span class="op" id="6681279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681282">c2</span><span class="op" id="6681284">.</span><span class="ident" id="6681285">SetDeadline</span><span class="op" id="6681296">(</span><span class="ident" id="6681297">time</span><span class="op" id="6681301">.</span><span class="ident" id="6681302">Now</span><span class="op" id="6681305">(</span><span class="op" id="6681306">)</span><span class="op" id="6681307">.</span><span class="ident" id="6681308">Add</span><span class="op" id="6681311">(</span><span class="ident" id="6681312">someTimeout</span><span class="op" id="6681323">)</span><span class="op" id="6681324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681327">c2</span><span class="op" id="6681329">.</span><span class="ident" id="6681330">SetReadDeadline</span><span class="op" id="6681345">(</span><span class="ident" id="6681346">time</span><span class="op" id="6681350">.</span><span class="ident" id="6681351">Now</span><span class="op" id="6681354">(</span><span class="op" id="6681355">)</span><span class="op" id="6681356">.</span><span class="ident" id="6681357">Add</span><span class="op" id="6681360">(</span><span class="ident" id="6681361">someTimeout</span><span class="op" id="6681372">)</span><span class="op" id="6681373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681376">c2</span><span class="op" id="6681378">.</span><span class="ident" id="6681379">SetWriteDeadline</span><span class="op" id="6681395">(</span><span class="ident" id="6681396">time</span><span class="op" id="6681400">.</span><span class="ident" id="6681401">Now</span><span class="op" id="6681404">(</span><span class="op" id="6681405">)</span><span class="op" id="6681406">.</span><span class="ident" id="6681407">Add</span><span class="op" id="6681410">(</span><span class="ident" id="6681411">someTimeout</span><span class="op" id="6681422">)</span><span class="op" id="6681423">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681426">c2</span><span class="op" id="6681428">.</span><span class="ident" id="6681429">SetReadBuffer</span><span class="op" id="6681442">(</span><span class="num" id="6681443">2048</span><span class="op" id="6681447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681450">c2</span><span class="op" id="6681452">.</span><span class="ident" id="6681453">SetWriteBuffer</span><span class="op" id="6681467">(</span><span class="num" id="6681468">2048</span><span class="op" id="6681472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681476">a3</span><span class="op" id="6681478">,</span>&nbsp;<span class="ident" id="6681480">err</span>&nbsp;<span class="op" id="6681484">:=</span>&nbsp;<span class="ident" id="6681487">ResolveUnixAddr</span><span class="op" id="6681502">(</span><span class="string" id="6681503">&#34;unixgram&#34;</span><span class="op" id="6681513">,</span>&nbsp;<span class="ident" id="6681515">addr3</span><span class="op" id="6681520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681523">if</span>&nbsp;<span class="ident" id="6681526">err</span>&nbsp;<span class="op" id="6681530">!=</span>&nbsp;<span class="ident" id="6681533">nil</span>&nbsp;<span class="op" id="6681537">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681541">t</span><span class="op" id="6681542">.</span><span class="ident" id="6681543">Fatalf</span><span class="op" id="6681549">(</span><span class="string" id="6681550">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681578">,</span>&nbsp;<span class="ident" id="6681580">err</span><span class="op" id="6681583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681589">c3</span><span class="op" id="6681591">,</span>&nbsp;<span class="ident" id="6681593">err</span>&nbsp;<span class="op" id="6681597">:=</span>&nbsp;<span class="ident" id="6681600">ListenUnixgram</span><span class="op" id="6681614">(</span><span class="string" id="6681615">&#34;unixgram&#34;</span><span class="op" id="6681625">,</span>&nbsp;<span class="ident" id="6681627">a3</span><span class="op" id="6681629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681632">if</span>&nbsp;<span class="ident" id="6681635">err</span>&nbsp;<span class="op" id="6681639">!=</span>&nbsp;<span class="ident" id="6681642">nil</span>&nbsp;<span class="op" id="6681646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681650">t</span><span class="op" id="6681651">.</span><span class="ident" id="6681652">Fatalf</span><span class="op" id="6681658">(</span><span class="string" id="6681659">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6681686">,</span>&nbsp;<span class="ident" id="6681688">err</span><span class="op" id="6681691">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681697">defer</span>&nbsp;<span class="ident" id="6681703">c3</span><span class="op" id="6681705">.</span><span class="ident" id="6681706">Close</span><span class="op" id="6681711">(</span><span class="op" id="6681712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681715">defer</span>&nbsp;<span class="ident" id="6681721">os</span><span class="op" id="6681723">.</span><span class="ident" id="6681724">Remove</span><span class="op" id="6681730">(</span><span class="ident" id="6681731">addr3</span><span class="op" id="6681736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681739">c3</span><span class="op" id="6681741">.</span><span class="ident" id="6681742">LocalAddr</span><span class="op" id="6681751">(</span><span class="op" id="6681752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681755">c3</span><span class="op" id="6681757">.</span><span class="ident" id="6681758">RemoteAddr</span><span class="op" id="6681768">(</span><span class="op" id="6681769">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681772">c3</span><span class="op" id="6681774">.</span><span class="ident" id="6681775">SetDeadline</span><span class="op" id="6681786">(</span><span class="ident" id="6681787">time</span><span class="op" id="6681791">.</span><span class="ident" id="6681792">Now</span><span class="op" id="6681795">(</span><span class="op" id="6681796">)</span><span class="op" id="6681797">.</span><span class="ident" id="6681798">Add</span><span class="op" id="6681801">(</span><span class="ident" id="6681802">someTimeout</span><span class="op" id="6681813">)</span><span class="op" id="6681814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681817">c3</span><span class="op" id="6681819">.</span><span class="ident" id="6681820">SetReadDeadline</span><span class="op" id="6681835">(</span><span class="ident" id="6681836">time</span><span class="op" id="6681840">.</span><span class="ident" id="6681841">Now</span><span class="op" id="6681844">(</span><span class="op" id="6681845">)</span><span class="op" id="6681846">.</span><span class="ident" id="6681847">Add</span><span class="op" id="6681850">(</span><span class="ident" id="6681851">someTimeout</span><span class="op" id="6681862">)</span><span class="op" id="6681863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681866">c3</span><span class="op" id="6681868">.</span><span class="ident" id="6681869">SetWriteDeadline</span><span class="op" id="6681885">(</span><span class="ident" id="6681886">time</span><span class="op" id="6681890">.</span><span class="ident" id="6681891">Now</span><span class="op" id="6681894">(</span><span class="op" id="6681895">)</span><span class="op" id="6681896">.</span><span class="ident" id="6681897">Add</span><span class="op" id="6681900">(</span><span class="ident" id="6681901">someTimeout</span><span class="op" id="6681912">)</span><span class="op" id="6681913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681916">c3</span><span class="op" id="6681918">.</span><span class="ident" id="6681919">SetReadBuffer</span><span class="op" id="6681932">(</span><span class="num" id="6681933">2048</span><span class="op" id="6681937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681940">c3</span><span class="op" id="6681942">.</span><span class="ident" id="6681943">SetWriteBuffer</span><span class="op" id="6681957">(</span><span class="num" id="6681958">2048</span><span class="op" id="6681962">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681966">wb</span>&nbsp;<span class="op" id="6681969">:=</span>&nbsp;<span class="op" id="6681972">[</span><span class="op" id="6681973">]</span><span class="builtintype" id="6681974">byte</span><span class="op" id="6681978">(</span><span class="string" id="6681979">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="6681994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681997">rb1</span>&nbsp;<span class="op" id="6682001">:=</span>&nbsp;<span class="builtinfunc" id="6682004">make</span><span class="op" id="6682008">(</span><span class="op" id="6682009">[</span><span class="op" id="6682010">]</span><span class="builtintype" id="6682011">byte</span><span class="op" id="6682015">,</span>&nbsp;<span class="num" id="6682017">128</span><span class="op" id="6682020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682023">rb2</span>&nbsp;<span class="op" id="6682027">:=</span>&nbsp;<span class="builtinfunc" id="6682030">make</span><span class="op" id="6682034">(</span><span class="op" id="6682035">[</span><span class="op" id="6682036">]</span><span class="builtintype" id="6682037">byte</span><span class="op" id="6682041">,</span>&nbsp;<span class="num" id="6682043">128</span><span class="op" id="6682046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682049">rb3</span>&nbsp;<span class="op" id="6682053">:=</span>&nbsp;<span class="builtinfunc" id="6682056">make</span><span class="op" id="6682060">(</span><span class="op" id="6682061">[</span><span class="op" id="6682062">]</span><span class="builtintype" id="6682063">byte</span><span class="op" id="6682067">,</span>&nbsp;<span class="num" id="6682069">128</span><span class="op" id="6682072">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682075">if</span>&nbsp;<span class="ident" id="6682078">_</span><span class="op" id="6682079">,</span>&nbsp;<span class="ident" id="6682081">_</span><span class="op" id="6682082">,</span>&nbsp;<span class="ident" id="6682084">err</span>&nbsp;<span class="op" id="6682088">:=</span>&nbsp;<span class="ident" id="6682091">c1</span><span class="op" id="6682093">.</span><span class="ident" id="6682094">WriteMsgUnix</span><span class="op" id="6682106">(</span><span class="ident" id="6682107">wb</span><span class="op" id="6682109">,</span>&nbsp;<span class="ident" id="6682111">nil</span><span class="op" id="6682114">,</span>&nbsp;<span class="ident" id="6682116">a2</span><span class="op" id="6682118">)</span><span class="op" id="6682119">;</span>&nbsp;<span class="ident" id="6682121">err</span>&nbsp;<span class="op" id="6682125">!=</span>&nbsp;<span class="ident" id="6682128">nil</span>&nbsp;<span class="op" id="6682132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682136">t</span><span class="op" id="6682137">.</span><span class="ident" id="6682138">Fatalf</span><span class="op" id="6682144">(</span><span class="string" id="6682145">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682179">,</span>&nbsp;<span class="ident" id="6682181">err</span><span class="op" id="6682184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682190">if</span>&nbsp;<span class="ident" id="6682193">_</span><span class="op" id="6682194">,</span>&nbsp;<span class="ident" id="6682196">_</span><span class="op" id="6682197">,</span>&nbsp;<span class="ident" id="6682199">_</span><span class="op" id="6682200">,</span>&nbsp;<span class="ident" id="6682202">_</span><span class="op" id="6682203">,</span>&nbsp;<span class="ident" id="6682205">err</span>&nbsp;<span class="op" id="6682209">:=</span>&nbsp;<span class="ident" id="6682212">c2</span><span class="op" id="6682214">.</span><span class="ident" id="6682215">ReadMsgUnix</span><span class="op" id="6682226">(</span><span class="ident" id="6682227">rb2</span><span class="op" id="6682230">,</span>&nbsp;<span class="ident" id="6682232">nil</span><span class="op" id="6682235">)</span><span class="op" id="6682236">;</span>&nbsp;<span class="ident" id="6682238">err</span>&nbsp;<span class="op" id="6682242">!=</span>&nbsp;<span class="ident" id="6682245">nil</span>&nbsp;<span class="op" id="6682249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682253">t</span><span class="op" id="6682254">.</span><span class="ident" id="6682255">Fatalf</span><span class="op" id="6682261">(</span><span class="string" id="6682262">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682295">,</span>&nbsp;<span class="ident" id="6682297">err</span><span class="op" id="6682300">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682306">if</span>&nbsp;<span class="ident" id="6682309">_</span><span class="op" id="6682310">,</span>&nbsp;<span class="ident" id="6682312">err</span>&nbsp;<span class="op" id="6682316">:=</span>&nbsp;<span class="ident" id="6682319">c2</span><span class="op" id="6682321">.</span><span class="ident" id="6682322">WriteToUnix</span><span class="op" id="6682333">(</span><span class="ident" id="6682334">wb</span><span class="op" id="6682336">,</span>&nbsp;<span class="ident" id="6682338">a1</span><span class="op" id="6682340">)</span><span class="op" id="6682341">;</span>&nbsp;<span class="ident" id="6682343">err</span>&nbsp;<span class="op" id="6682347">!=</span>&nbsp;<span class="ident" id="6682350">nil</span>&nbsp;<span class="op" id="6682354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682358">t</span><span class="op" id="6682359">.</span><span class="ident" id="6682360">Fatalf</span><span class="op" id="6682366">(</span><span class="string" id="6682367">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682400">,</span>&nbsp;<span class="ident" id="6682402">err</span><span class="op" id="6682405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682411">if</span>&nbsp;<span class="ident" id="6682414">_</span><span class="op" id="6682415">,</span>&nbsp;<span class="ident" id="6682417">_</span><span class="op" id="6682418">,</span>&nbsp;<span class="ident" id="6682420">err</span>&nbsp;<span class="op" id="6682424">:=</span>&nbsp;<span class="ident" id="6682427">c1</span><span class="op" id="6682429">.</span><span class="ident" id="6682430">ReadFromUnix</span><span class="op" id="6682442">(</span><span class="ident" id="6682443">rb1</span><span class="op" id="6682446">)</span><span class="op" id="6682447">;</span>&nbsp;<span class="ident" id="6682449">err</span>&nbsp;<span class="op" id="6682453">!=</span>&nbsp;<span class="ident" id="6682456">nil</span>&nbsp;<span class="op" id="6682460">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682464">t</span><span class="op" id="6682465">.</span><span class="ident" id="6682466">Fatalf</span><span class="op" id="6682472">(</span><span class="string" id="6682473">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682507">,</span>&nbsp;<span class="ident" id="6682509">err</span><span class="op" id="6682512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682518">if</span>&nbsp;<span class="ident" id="6682521">_</span><span class="op" id="6682522">,</span>&nbsp;<span class="ident" id="6682524">err</span>&nbsp;<span class="op" id="6682528">:=</span>&nbsp;<span class="ident" id="6682531">c3</span><span class="op" id="6682533">.</span><span class="ident" id="6682534">WriteToUnix</span><span class="op" id="6682545">(</span><span class="ident" id="6682546">wb</span><span class="op" id="6682548">,</span>&nbsp;<span class="ident" id="6682550">a1</span><span class="op" id="6682552">)</span><span class="op" id="6682553">;</span>&nbsp;<span class="ident" id="6682555">err</span>&nbsp;<span class="op" id="6682559">!=</span>&nbsp;<span class="ident" id="6682562">nil</span>&nbsp;<span class="op" id="6682566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682570">t</span><span class="op" id="6682571">.</span><span class="ident" id="6682572">Fatalf</span><span class="op" id="6682578">(</span><span class="string" id="6682579">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682612">,</span>&nbsp;<span class="ident" id="6682614">err</span><span class="op" id="6682617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682620">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682623">if</span>&nbsp;<span class="ident" id="6682626">_</span><span class="op" id="6682627">,</span>&nbsp;<span class="ident" id="6682629">_</span><span class="op" id="6682630">,</span>&nbsp;<span class="ident" id="6682632">err</span>&nbsp;<span class="op" id="6682636">:=</span>&nbsp;<span class="ident" id="6682639">c1</span><span class="op" id="6682641">.</span><span class="ident" id="6682642">ReadFromUnix</span><span class="op" id="6682654">(</span><span class="ident" id="6682655">rb1</span><span class="op" id="6682658">)</span><span class="op" id="6682659">;</span>&nbsp;<span class="ident" id="6682661">err</span>&nbsp;<span class="op" id="6682665">!=</span>&nbsp;<span class="ident" id="6682668">nil</span>&nbsp;<span class="op" id="6682672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682676">t</span><span class="op" id="6682677">.</span><span class="ident" id="6682678">Fatalf</span><span class="op" id="6682684">(</span><span class="string" id="6682685">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682719">,</span>&nbsp;<span class="ident" id="6682721">err</span><span class="op" id="6682724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682730">if</span>&nbsp;<span class="ident" id="6682733">_</span><span class="op" id="6682734">,</span>&nbsp;<span class="ident" id="6682736">err</span>&nbsp;<span class="op" id="6682740">:=</span>&nbsp;<span class="ident" id="6682743">c2</span><span class="op" id="6682745">.</span><span class="ident" id="6682746">WriteToUnix</span><span class="op" id="6682757">(</span><span class="ident" id="6682758">wb</span><span class="op" id="6682760">,</span>&nbsp;<span class="ident" id="6682762">a3</span><span class="op" id="6682764">)</span><span class="op" id="6682765">;</span>&nbsp;<span class="ident" id="6682767">err</span>&nbsp;<span class="op" id="6682771">!=</span>&nbsp;<span class="ident" id="6682774">nil</span>&nbsp;<span class="op" id="6682778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682782">t</span><span class="op" id="6682783">.</span><span class="ident" id="6682784">Fatalf</span><span class="op" id="6682790">(</span><span class="string" id="6682791">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682824">,</span>&nbsp;<span class="ident" id="6682826">err</span><span class="op" id="6682829">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682835">if</span>&nbsp;<span class="ident" id="6682838">_</span><span class="op" id="6682839">,</span>&nbsp;<span class="ident" id="6682841">_</span><span class="op" id="6682842">,</span>&nbsp;<span class="ident" id="6682844">err</span>&nbsp;<span class="op" id="6682848">:=</span>&nbsp;<span class="ident" id="6682851">c3</span><span class="op" id="6682853">.</span><span class="ident" id="6682854">ReadFromUnix</span><span class="op" id="6682866">(</span><span class="ident" id="6682867">rb3</span><span class="op" id="6682870">)</span><span class="op" id="6682871">;</span>&nbsp;<span class="ident" id="6682873">err</span>&nbsp;<span class="op" id="6682877">!=</span>&nbsp;<span class="ident" id="6682880">nil</span>&nbsp;<span class="op" id="6682884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682888">t</span><span class="op" id="6682889">.</span><span class="ident" id="6682890">Fatalf</span><span class="op" id="6682896">(</span><span class="string" id="6682897">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6682931">,</span>&nbsp;<span class="ident" id="6682933">err</span><span class="op" id="6682936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682943">if</span>&nbsp;<span class="ident" id="6682946">f</span><span class="op" id="6682947">,</span>&nbsp;<span class="ident" id="6682949">err</span>&nbsp;<span class="op" id="6682953">:=</span>&nbsp;<span class="ident" id="6682956">c1</span><span class="op" id="6682958">.</span><span class="ident" id="6682959">File</span><span class="op" id="6682963">(</span><span class="op" id="6682964">)</span><span class="op" id="6682965">;</span>&nbsp;<span class="ident" id="6682967">err</span>&nbsp;<span class="op" id="6682971">!=</span>&nbsp;<span class="ident" id="6682974">nil</span>&nbsp;<span class="op" id="6682978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682982">t</span><span class="op" id="6682983">.</span><span class="ident" id="6682984">Fatalf</span><span class="op" id="6682990">(</span><span class="string" id="6682991">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6683017">,</span>&nbsp;<span class="ident" id="6683019">err</span><span class="op" id="6683022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683025">}</span>&nbsp;<span class="keyword" id="6683027">else</span>&nbsp;<span class="op" id="6683032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683036">f</span><span class="op" id="6683037">.</span><span class="ident" id="6683038">Close</span><span class="op" id="6683043">(</span><span class="op" id="6683044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683047">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683051">defer</span>&nbsp;<span class="keyword" id="6683057">func</span><span class="op" id="6683061">(</span><span class="op" id="6683062">)</span>&nbsp;<span class="op" id="6683064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683068">if</span>&nbsp;<span class="ident" id="6683071">p</span>&nbsp;<span class="op" id="6683073">:=</span>&nbsp;<span class="builtinfunc" id="6683076">recover</span><span class="op" id="6683083">(</span><span class="op" id="6683084">)</span><span class="op" id="6683085">;</span>&nbsp;<span class="ident" id="6683087">p</span>&nbsp;<span class="op" id="6683089">!=</span>&nbsp;<span class="ident" id="6683092">nil</span>&nbsp;<span class="op" id="6683096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683101">t</span><span class="op" id="6683102">.</span><span class="ident" id="6683103">Fatalf</span><span class="op" id="6683109">(</span><span class="string" id="6683110">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6683161">,</span>&nbsp;<span class="ident" id="6683163">p</span><span class="op" id="6683164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683168">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683171">}</span><span class="op" id="6683172">(</span><span class="op" id="6683173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683177">c1</span><span class="op" id="6683179">.</span><span class="ident" id="6683180">WriteToUnix</span><span class="op" id="6683191">(</span><span class="ident" id="6683192">wb</span><span class="op" id="6683194">,</span>&nbsp;<span class="ident" id="6683196">nil</span><span class="op" id="6683199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683202">c1</span><span class="op" id="6683204">.</span><span class="ident" id="6683205">WriteMsgUnix</span><span class="op" id="6683217">(</span><span class="ident" id="6683218">wb</span><span class="op" id="6683220">,</span>&nbsp;<span class="ident" id="6683222">nil</span><span class="op" id="6683225">,</span>&nbsp;<span class="ident" id="6683227">nil</span><span class="op" id="6683230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683233">c3</span><span class="op" id="6683235">.</span><span class="ident" id="6683236">WriteToUnix</span><span class="op" id="6683247">(</span><span class="ident" id="6683248">wb</span><span class="op" id="6683250">,</span>&nbsp;<span class="ident" id="6683252">nil</span><span class="op" id="6683255">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683258">c3</span><span class="op" id="6683260">.</span><span class="ident" id="6683261">WriteMsgUnix</span><span class="op" id="6683273">(</span><span class="ident" id="6683274">wb</span><span class="op" id="6683276">,</span>&nbsp;<span class="ident" id="6683278">nil</span><span class="op" id="6683281">,</span>&nbsp;<span class="ident" id="6683283">nil</span><span class="op" id="6683286">)</span><br>
<span class="lineno"></span><span class="op" id="6683288">}</span>
</div>
</body>
</html>
