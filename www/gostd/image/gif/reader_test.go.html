<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7943663">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7943718">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7943772">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7943823">package</span>&nbsp;<span class="ident" id="7943831">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7943836">import</span>&nbsp;<span class="op" id="7943843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943846">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943855">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943871">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943880">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943895">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7943906">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7943916">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7943919">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7943986">const</span>&nbsp;<span class="op" id="7943992">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7943995">headerStr</span>&nbsp;<span class="op" id="7944005">=</span>&nbsp;<span class="string" id="7944007">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7944016">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7944020">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7944039">+</span>&nbsp;<span class="comment" id="7944041">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7944064">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7944079">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944147">paletteStr</span>&nbsp;<span class="op" id="7944158">=</span>&nbsp;<span class="string" id="7944160">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7944187">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944230">trailerStr</span>&nbsp;<span class="op" id="7944241">=</span>&nbsp;<span class="string" id="7944243">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7944250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7944253">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7944325">func</span>&nbsp;<span class="ident" id="7944330">lzwEncode</span><span class="op" id="7944339">(</span><span class="ident" id="7944340">n</span>&nbsp;<span class="builtintype" id="7944342">int</span><span class="op" id="7944345">)</span>&nbsp;<span class="op" id="7944347">[</span><span class="op" id="7944348">]</span><span class="builtintype" id="7944349">byte</span>&nbsp;<span class="op" id="7944354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944357">b</span>&nbsp;<span class="op" id="7944359">:=</span>&nbsp;<span class="op" id="7944362">&amp;</span><span class="ident" id="7944363">bytes</span><span class="op" id="7944368">.</span><span class="ident" id="7944369">Buffer</span><span class="op" id="7944375">{</span><span class="op" id="7944376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944379">w</span>&nbsp;<span class="op" id="7944381">:=</span>&nbsp;<span class="ident" id="7944384">lzw</span><span class="op" id="7944387">.</span><span class="ident" id="7944388">NewWriter</span><span class="op" id="7944397">(</span><span class="ident" id="7944398">b</span><span class="op" id="7944399">,</span>&nbsp;<span class="ident" id="7944401">lzw</span><span class="op" id="7944404">.</span><span class="ident" id="7944405">LSB</span><span class="op" id="7944408">,</span>&nbsp;<span class="num" id="7944410">2</span><span class="op" id="7944411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944414">w</span><span class="op" id="7944415">.</span><span class="ident" id="7944416">Write</span><span class="op" id="7944421">(</span><span class="builtinfunc" id="7944422">make</span><span class="op" id="7944426">(</span><span class="op" id="7944427">[</span><span class="op" id="7944428">]</span><span class="builtintype" id="7944429">byte</span><span class="op" id="7944433">,</span>&nbsp;<span class="ident" id="7944435">n</span><span class="op" id="7944436">)</span><span class="op" id="7944437">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944440">w</span><span class="op" id="7944441">.</span><span class="ident" id="7944442">Close</span><span class="op" id="7944447">(</span><span class="op" id="7944448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7944451">return</span>&nbsp;<span class="ident" id="7944458">b</span><span class="op" id="7944459">.</span><span class="ident" id="7944460">Bytes</span><span class="op" id="7944465">(</span><span class="op" id="7944466">)</span><br>
<span class="lineno"></span><span class="op" id="7944468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7944471">func</span>&nbsp;<span class="ident" id="7944476">TestDecode</span><span class="op" id="7944486">(</span><span class="ident" id="7944487">t</span>&nbsp;<span class="op" id="7944489">*</span><span class="ident" id="7944490">testing</span><span class="op" id="7944497">.</span><span class="ident" id="7944498">T</span><span class="op" id="7944499">)</span>&nbsp;<span class="op" id="7944501">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944504">testCases</span>&nbsp;<span class="op" id="7944514">:=</span>&nbsp;<span class="op" id="7944517">[</span><span class="op" id="7944518">]</span><span class="keyword" id="7944519">struct</span>&nbsp;<span class="op" id="7944526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944530">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7944538">int</span>&nbsp;&nbsp;<span class="comment" id="7944543">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944588">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7944596">bool</span>&nbsp;<span class="comment" id="7944601">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944666">wantErr</span>&nbsp;<span class="builtintype" id="7944674">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944681">}</span><span class="op" id="7944682">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944686">{</span><span class="num" id="7944687">0</span><span class="op" id="7944688">,</span>&nbsp;<span class="builtintype" id="7944690">false</span><span class="op" id="7944695">,</span>&nbsp;<span class="ident" id="7944697">errNotEnough</span><span class="op" id="7944709">}</span><span class="op" id="7944710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944714">{</span><span class="num" id="7944715">1</span><span class="op" id="7944716">,</span>&nbsp;<span class="builtintype" id="7944718">false</span><span class="op" id="7944723">,</span>&nbsp;<span class="ident" id="7944725">errNotEnough</span><span class="op" id="7944737">}</span><span class="op" id="7944738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944742">{</span><span class="num" id="7944743">2</span><span class="op" id="7944744">,</span>&nbsp;<span class="builtintype" id="7944746">false</span><span class="op" id="7944751">,</span>&nbsp;<span class="builtintype" id="7944753">nil</span><span class="op" id="7944756">}</span><span class="op" id="7944757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944761">{</span><span class="num" id="7944762">2</span><span class="op" id="7944763">,</span>&nbsp;<span class="builtintype" id="7944765">true</span><span class="op" id="7944769">,</span>&nbsp;<span class="ident" id="7944771">errTooMuch</span><span class="op" id="7944781">}</span><span class="op" id="7944782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944786">{</span><span class="num" id="7944787">3</span><span class="op" id="7944788">,</span>&nbsp;<span class="builtintype" id="7944790">false</span><span class="op" id="7944795">,</span>&nbsp;<span class="ident" id="7944797">errTooMuch</span><span class="op" id="7944807">}</span><span class="op" id="7944808">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7944814">for</span>&nbsp;<span class="ident" id="7944818">_</span><span class="op" id="7944819">,</span>&nbsp;<span class="ident" id="7944821">tc</span>&nbsp;<span class="op" id="7944824">:=</span>&nbsp;<span class="keyword" id="7944827">range</span>&nbsp;<span class="ident" id="7944833">testCases</span>&nbsp;<span class="op" id="7944843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944847">b</span>&nbsp;<span class="op" id="7944849">:=</span>&nbsp;<span class="op" id="7944852">&amp;</span><span class="ident" id="7944853">bytes</span><span class="op" id="7944858">.</span><span class="ident" id="7944859">Buffer</span><span class="op" id="7944865">{</span><span class="op" id="7944866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944870">b</span><span class="op" id="7944871">.</span><span class="ident" id="7944872">WriteString</span><span class="op" id="7944883">(</span><span class="ident" id="7944884">headerStr</span><span class="op" id="7944893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7944897">b</span><span class="op" id="7944898">.</span><span class="ident" id="7944899">WriteString</span><span class="op" id="7944910">(</span><span class="ident" id="7944911">paletteStr</span><span class="op" id="7944921">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7944925">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7944997">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7945066">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7945135">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945170">b</span><span class="op" id="7945171">.</span><span class="ident" id="7945172">WriteString</span><span class="op" id="7945183">(</span><span class="string" id="7945184">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7945230">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945234">if</span>&nbsp;<span class="ident" id="7945237">tc</span><span class="op" id="7945239">.</span><span class="ident" id="7945240">nPix</span>&nbsp;<span class="op" id="7945245">&gt;</span>&nbsp;<span class="num" id="7945247">0</span>&nbsp;<span class="op" id="7945249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945254">enc</span>&nbsp;<span class="op" id="7945258">:=</span>&nbsp;<span class="ident" id="7945261">lzwEncode</span><span class="op" id="7945270">(</span><span class="ident" id="7945271">tc</span><span class="op" id="7945273">.</span><span class="ident" id="7945274">nPix</span><span class="op" id="7945278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945283">if</span>&nbsp;<span class="builtinfunc" id="7945286">len</span><span class="op" id="7945289">(</span><span class="ident" id="7945290">enc</span><span class="op" id="7945293">)</span>&nbsp;<span class="op" id="7945295">&gt;</span>&nbsp;<span class="num" id="7945297">0xff</span>&nbsp;<span class="op" id="7945302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945308">t</span><span class="op" id="7945309">.</span><span class="ident" id="7945310">Errorf</span><span class="op" id="7945316">(</span><span class="string" id="7945317">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7945371">,</span>&nbsp;<span class="ident" id="7945373">tc</span><span class="op" id="7945375">.</span><span class="ident" id="7945376">nPix</span><span class="op" id="7945380">,</span>&nbsp;<span class="ident" id="7945382">tc</span><span class="op" id="7945384">.</span><span class="ident" id="7945385">extra</span><span class="op" id="7945390">,</span>&nbsp;<span class="builtinfunc" id="7945392">len</span><span class="op" id="7945395">(</span><span class="ident" id="7945396">enc</span><span class="op" id="7945399">)</span><span class="op" id="7945400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945406">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945423">b</span><span class="op" id="7945424">.</span><span class="ident" id="7945425">WriteByte</span><span class="op" id="7945434">(</span><span class="builtintype" id="7945435">byte</span><span class="op" id="7945439">(</span><span class="builtinfunc" id="7945440">len</span><span class="op" id="7945443">(</span><span class="ident" id="7945444">enc</span><span class="op" id="7945447">)</span><span class="op" id="7945448">)</span><span class="op" id="7945449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945454">b</span><span class="op" id="7945455">.</span><span class="ident" id="7945456">Write</span><span class="op" id="7945461">(</span><span class="ident" id="7945462">enc</span><span class="op" id="7945465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945473">if</span>&nbsp;<span class="ident" id="7945476">tc</span><span class="op" id="7945478">.</span><span class="ident" id="7945479">extra</span>&nbsp;<span class="op" id="7945485">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945490">b</span><span class="op" id="7945491">.</span><span class="ident" id="7945492">WriteString</span><span class="op" id="7945503">(</span><span class="string" id="7945504">&#34;\x01\x02&#34;</span><span class="op" id="7945514">)</span>&nbsp;<span class="comment" id="7945516">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945561">b</span><span class="op" id="7945562">.</span><span class="ident" id="7945563">WriteByte</span><span class="op" id="7945572">(</span><span class="num" id="7945573">0x00</span><span class="op" id="7945577">)</span>&nbsp;<span class="comment" id="7945579">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945636">b</span><span class="op" id="7945637">.</span><span class="ident" id="7945638">WriteString</span><span class="op" id="7945649">(</span><span class="ident" id="7945650">trailerStr</span><span class="op" id="7945660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945665">got</span><span class="op" id="7945668">,</span>&nbsp;<span class="ident" id="7945670">err</span>&nbsp;<span class="op" id="7945674">:=</span>&nbsp;<span class="ident" id="7945677">Decode</span><span class="op" id="7945683">(</span><span class="ident" id="7945684">b</span><span class="op" id="7945685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945689">if</span>&nbsp;<span class="ident" id="7945692">err</span>&nbsp;<span class="op" id="7945696">!=</span>&nbsp;<span class="ident" id="7945699">tc</span><span class="op" id="7945701">.</span><span class="ident" id="7945702">wantErr</span>&nbsp;<span class="op" id="7945710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945715">t</span><span class="op" id="7945716">.</span><span class="ident" id="7945717">Errorf</span><span class="op" id="7945723">(</span><span class="string" id="7945724">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7945761">,</span>&nbsp;<span class="ident" id="7945763">tc</span><span class="op" id="7945765">.</span><span class="ident" id="7945766">nPix</span><span class="op" id="7945770">,</span>&nbsp;<span class="ident" id="7945772">tc</span><span class="op" id="7945774">.</span><span class="ident" id="7945775">extra</span><span class="op" id="7945780">,</span>&nbsp;<span class="ident" id="7945782">err</span><span class="op" id="7945785">,</span>&nbsp;<span class="ident" id="7945787">tc</span><span class="op" id="7945789">.</span><span class="ident" id="7945790">wantErr</span><span class="op" id="7945797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945806">if</span>&nbsp;<span class="ident" id="7945809">tc</span><span class="op" id="7945811">.</span><span class="ident" id="7945812">wantErr</span>&nbsp;<span class="op" id="7945820">!=</span>&nbsp;<span class="builtintype" id="7945823">nil</span>&nbsp;<span class="op" id="7945827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7945832">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945847">want</span>&nbsp;<span class="op" id="7945852">:=</span>&nbsp;<span class="op" id="7945855">&amp;</span><span class="ident" id="7945856">image</span><span class="op" id="7945861">.</span><span class="ident" id="7945862">Paletted</span><span class="op" id="7945870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945875">Pix</span><span class="op" id="7945878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7945883">[</span><span class="op" id="7945884">]</span><span class="builtintype" id="7945885">uint8</span><span class="op" id="7945890">{</span><span class="num" id="7945891">0</span><span class="op" id="7945892">,</span>&nbsp;<span class="num" id="7945894">0</span><span class="op" id="7945895">}</span><span class="op" id="7945896">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945901">Stride</span><span class="op" id="7945907">:</span>&nbsp;<span class="num" id="7945909">2</span><span class="op" id="7945910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945915">Rect</span><span class="op" id="7945919">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7945923">image</span><span class="op" id="7945928">.</span><span class="ident" id="7945929">Rect</span><span class="op" id="7945933">(</span><span class="num" id="7945934">0</span><span class="op" id="7945935">,</span>&nbsp;<span class="num" id="7945937">0</span><span class="op" id="7945938">,</span>&nbsp;<span class="num" id="7945940">2</span><span class="op" id="7945941">,</span>&nbsp;<span class="num" id="7945943">1</span><span class="op" id="7945944">)</span><span class="op" id="7945945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945950">Palette</span><span class="op" id="7945957">:</span>&nbsp;<span class="ident" id="7945959">color</span><span class="op" id="7945964">.</span><span class="ident" id="7945965">Palette</span><span class="op" id="7945972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7945978">color</span><span class="op" id="7945983">.</span><span class="ident" id="7945984">RGBA</span><span class="op" id="7945988">{</span><span class="num" id="7945989">0x10</span><span class="op" id="7945993">,</span>&nbsp;<span class="num" id="7945995">0x20</span><span class="op" id="7945999">,</span>&nbsp;<span class="num" id="7946001">0x30</span><span class="op" id="7946005">,</span>&nbsp;<span class="num" id="7946007">0xff</span><span class="op" id="7946011">}</span><span class="op" id="7946012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946018">color</span><span class="op" id="7946023">.</span><span class="ident" id="7946024">RGBA</span><span class="op" id="7946028">{</span><span class="num" id="7946029">0x40</span><span class="op" id="7946033">,</span>&nbsp;<span class="num" id="7946035">0x50</span><span class="op" id="7946039">,</span>&nbsp;<span class="num" id="7946041">0x60</span><span class="op" id="7946045">,</span>&nbsp;<span class="num" id="7946047">0xff</span><span class="op" id="7946051">}</span><span class="op" id="7946052">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946057">}</span><span class="op" id="7946058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7946066">if</span>&nbsp;<span class="op" id="7946069">!</span><span class="ident" id="7946070">reflect</span><span class="op" id="7946077">.</span><span class="ident" id="7946078">DeepEqual</span><span class="op" id="7946087">(</span><span class="ident" id="7946088">got</span><span class="op" id="7946091">,</span>&nbsp;<span class="ident" id="7946093">want</span><span class="op" id="7946097">)</span>&nbsp;<span class="op" id="7946099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946104">t</span><span class="op" id="7946105">.</span><span class="ident" id="7946106">Errorf</span><span class="op" id="7946112">(</span><span class="string" id="7946113">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7946150">,</span>&nbsp;<span class="ident" id="7946152">tc</span><span class="op" id="7946154">.</span><span class="ident" id="7946155">nPix</span><span class="op" id="7946159">,</span>&nbsp;<span class="ident" id="7946161">tc</span><span class="op" id="7946163">.</span><span class="ident" id="7946164">extra</span><span class="op" id="7946169">,</span>&nbsp;<span class="ident" id="7946171">got</span><span class="op" id="7946174">,</span>&nbsp;<span class="ident" id="7946176">want</span><span class="op" id="7946180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946184">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946187">}</span><br>
<span class="lineno"></span><span class="op" id="7946189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7946192">func</span>&nbsp;<span class="ident" id="7946197">TestTransparentIndex</span><span class="op" id="7946217">(</span><span class="ident" id="7946218">t</span>&nbsp;<span class="op" id="7946220">*</span><span class="ident" id="7946221">testing</span><span class="op" id="7946228">.</span><span class="ident" id="7946229">T</span><span class="op" id="7946230">)</span>&nbsp;<span class="op" id="7946232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946235">b</span>&nbsp;<span class="op" id="7946237">:=</span>&nbsp;<span class="op" id="7946240">&amp;</span><span class="ident" id="7946241">bytes</span><span class="op" id="7946246">.</span><span class="ident" id="7946247">Buffer</span><span class="op" id="7946253">{</span><span class="op" id="7946254">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946257">b</span><span class="op" id="7946258">.</span><span class="ident" id="7946259">WriteString</span><span class="op" id="7946270">(</span><span class="ident" id="7946271">headerStr</span><span class="op" id="7946280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946283">b</span><span class="op" id="7946284">.</span><span class="ident" id="7946285">WriteString</span><span class="op" id="7946296">(</span><span class="ident" id="7946297">paletteStr</span><span class="op" id="7946307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7946310">for</span>&nbsp;<span class="ident" id="7946314">transparentIndex</span>&nbsp;<span class="op" id="7946331">:=</span>&nbsp;<span class="num" id="7946334">0</span><span class="op" id="7946335">;</span>&nbsp;<span class="ident" id="7946337">transparentIndex</span>&nbsp;<span class="op" id="7946354">&lt;</span>&nbsp;<span class="num" id="7946356">3</span><span class="op" id="7946357">;</span>&nbsp;<span class="ident" id="7946359">transparentIndex</span><span class="op" id="7946375">++</span>&nbsp;<span class="op" id="7946378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7946382">if</span>&nbsp;<span class="ident" id="7946385">transparentIndex</span>&nbsp;<span class="op" id="7946402">&lt;</span>&nbsp;<span class="num" id="7946404">2</span>&nbsp;<span class="op" id="7946406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7946411">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946470">b</span><span class="op" id="7946471">.</span><span class="ident" id="7946472">WriteString</span><span class="op" id="7946483">(</span><span class="string" id="7946484">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7946510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946515">b</span><span class="op" id="7946516">.</span><span class="ident" id="7946517">WriteByte</span><span class="op" id="7946526">(</span><span class="builtintype" id="7946527">byte</span><span class="op" id="7946531">(</span><span class="ident" id="7946532">transparentIndex</span><span class="op" id="7946548">)</span><span class="op" id="7946549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946554">b</span><span class="op" id="7946555">.</span><span class="ident" id="7946556">WriteByte</span><span class="op" id="7946565">(</span><span class="num" id="7946566">0</span><span class="op" id="7946567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7946575">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946631">b</span><span class="op" id="7946632">.</span><span class="ident" id="7946633">WriteString</span><span class="op" id="7946644">(</span><span class="string" id="7946645">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7946691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946695">enc</span>&nbsp;<span class="op" id="7946699">:=</span>&nbsp;<span class="ident" id="7946702">lzwEncode</span><span class="op" id="7946711">(</span><span class="num" id="7946712">2</span><span class="op" id="7946713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7946717">if</span>&nbsp;<span class="builtinfunc" id="7946720">len</span><span class="op" id="7946723">(</span><span class="ident" id="7946724">enc</span><span class="op" id="7946727">)</span>&nbsp;<span class="op" id="7946729">&gt;</span>&nbsp;<span class="num" id="7946731">0xff</span>&nbsp;<span class="op" id="7946736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946741">t</span><span class="op" id="7946742">.</span><span class="ident" id="7946743">Fatalf</span><span class="op" id="7946749">(</span><span class="string" id="7946750">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7946785">,</span>&nbsp;<span class="builtinfunc" id="7946787">len</span><span class="op" id="7946790">(</span><span class="ident" id="7946791">enc</span><span class="op" id="7946794">)</span><span class="op" id="7946795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946799">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946803">b</span><span class="op" id="7946804">.</span><span class="ident" id="7946805">WriteByte</span><span class="op" id="7946814">(</span><span class="builtintype" id="7946815">byte</span><span class="op" id="7946819">(</span><span class="builtinfunc" id="7946820">len</span><span class="op" id="7946823">(</span><span class="ident" id="7946824">enc</span><span class="op" id="7946827">)</span><span class="op" id="7946828">)</span><span class="op" id="7946829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946833">b</span><span class="op" id="7946834">.</span><span class="ident" id="7946835">Write</span><span class="op" id="7946840">(</span><span class="ident" id="7946841">enc</span><span class="op" id="7946844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946848">b</span><span class="op" id="7946849">.</span><span class="ident" id="7946850">WriteByte</span><span class="op" id="7946859">(</span><span class="num" id="7946860">0x00</span><span class="op" id="7946864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946870">b</span><span class="op" id="7946871">.</span><span class="ident" id="7946872">WriteString</span><span class="op" id="7946883">(</span><span class="ident" id="7946884">trailerStr</span><span class="op" id="7946894">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946898">g</span><span class="op" id="7946899">,</span>&nbsp;<span class="ident" id="7946901">err</span>&nbsp;<span class="op" id="7946905">:=</span>&nbsp;<span class="ident" id="7946908">DecodeAll</span><span class="op" id="7946917">(</span><span class="ident" id="7946918">b</span><span class="op" id="7946919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7946922">if</span>&nbsp;<span class="ident" id="7946925">err</span>&nbsp;<span class="op" id="7946929">!=</span>&nbsp;<span class="builtintype" id="7946932">nil</span>&nbsp;<span class="op" id="7946936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946940">t</span><span class="op" id="7946941">.</span><span class="ident" id="7946942">Fatalf</span><span class="op" id="7946948">(</span><span class="string" id="7946949">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7946964">,</span>&nbsp;<span class="ident" id="7946966">err</span><span class="op" id="7946969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7946972">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7946975">c0</span>&nbsp;<span class="op" id="7946978">:=</span>&nbsp;<span class="ident" id="7946981">color</span><span class="op" id="7946986">.</span><span class="ident" id="7946987">RGBA</span><span class="op" id="7946991">{</span><span class="ident" id="7946992">paletteStr</span><span class="op" id="7947002">[</span><span class="num" id="7947003">0</span><span class="op" id="7947004">]</span><span class="op" id="7947005">,</span>&nbsp;<span class="ident" id="7947007">paletteStr</span><span class="op" id="7947017">[</span><span class="num" id="7947018">1</span><span class="op" id="7947019">]</span><span class="op" id="7947020">,</span>&nbsp;<span class="ident" id="7947022">paletteStr</span><span class="op" id="7947032">[</span><span class="num" id="7947033">2</span><span class="op" id="7947034">]</span><span class="op" id="7947035">,</span>&nbsp;<span class="num" id="7947037">0xff</span><span class="op" id="7947041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947044">c1</span>&nbsp;<span class="op" id="7947047">:=</span>&nbsp;<span class="ident" id="7947050">color</span><span class="op" id="7947055">.</span><span class="ident" id="7947056">RGBA</span><span class="op" id="7947060">{</span><span class="ident" id="7947061">paletteStr</span><span class="op" id="7947071">[</span><span class="num" id="7947072">3</span><span class="op" id="7947073">]</span><span class="op" id="7947074">,</span>&nbsp;<span class="ident" id="7947076">paletteStr</span><span class="op" id="7947086">[</span><span class="num" id="7947087">4</span><span class="op" id="7947088">]</span><span class="op" id="7947089">,</span>&nbsp;<span class="ident" id="7947091">paletteStr</span><span class="op" id="7947101">[</span><span class="num" id="7947102">5</span><span class="op" id="7947103">]</span><span class="op" id="7947104">,</span>&nbsp;<span class="num" id="7947106">0xff</span><span class="op" id="7947110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947113">cz</span>&nbsp;<span class="op" id="7947116">:=</span>&nbsp;<span class="ident" id="7947119">color</span><span class="op" id="7947124">.</span><span class="ident" id="7947125">RGBA</span><span class="op" id="7947129">{</span><span class="op" id="7947130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947133">wants</span>&nbsp;<span class="op" id="7947139">:=</span>&nbsp;<span class="op" id="7947142">[</span><span class="op" id="7947143">]</span><span class="ident" id="7947144">color</span><span class="op" id="7947149">.</span><span class="ident" id="7947150">Palette</span><span class="op" id="7947157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947161">{</span><span class="ident" id="7947162">cz</span><span class="op" id="7947164">,</span>&nbsp;<span class="ident" id="7947166">c1</span><span class="op" id="7947168">}</span><span class="op" id="7947169">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947173">{</span><span class="ident" id="7947174">c0</span><span class="op" id="7947176">,</span>&nbsp;<span class="ident" id="7947178">cz</span><span class="op" id="7947180">}</span><span class="op" id="7947181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947185">{</span><span class="ident" id="7947186">c0</span><span class="op" id="7947188">,</span>&nbsp;<span class="ident" id="7947190">c1</span><span class="op" id="7947192">}</span><span class="op" id="7947193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7947199">if</span>&nbsp;<span class="builtinfunc" id="7947202">len</span><span class="op" id="7947205">(</span><span class="ident" id="7947206">g</span><span class="op" id="7947207">.</span><span class="ident" id="7947208">Image</span><span class="op" id="7947213">)</span>&nbsp;<span class="op" id="7947215">!=</span>&nbsp;<span class="builtinfunc" id="7947218">len</span><span class="op" id="7947221">(</span><span class="ident" id="7947222">wants</span><span class="op" id="7947227">)</span>&nbsp;<span class="op" id="7947229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947233">t</span><span class="op" id="7947234">.</span><span class="ident" id="7947235">Fatalf</span><span class="op" id="7947241">(</span><span class="string" id="7947242">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7947266">,</span>&nbsp;<span class="builtinfunc" id="7947268">len</span><span class="op" id="7947271">(</span><span class="ident" id="7947272">g</span><span class="op" id="7947273">.</span><span class="ident" id="7947274">Image</span><span class="op" id="7947279">)</span><span class="op" id="7947280">,</span>&nbsp;<span class="builtinfunc" id="7947282">len</span><span class="op" id="7947285">(</span><span class="ident" id="7947286">wants</span><span class="op" id="7947291">)</span><span class="op" id="7947292">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7947298">for</span>&nbsp;<span class="ident" id="7947302">i</span><span class="op" id="7947303">,</span>&nbsp;<span class="ident" id="7947305">want</span>&nbsp;<span class="op" id="7947310">:=</span>&nbsp;<span class="keyword" id="7947313">range</span>&nbsp;<span class="ident" id="7947319">wants</span>&nbsp;<span class="op" id="7947325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947329">got</span>&nbsp;<span class="op" id="7947333">:=</span>&nbsp;<span class="ident" id="7947336">g</span><span class="op" id="7947337">.</span><span class="ident" id="7947338">Image</span><span class="op" id="7947343">[</span><span class="ident" id="7947344">i</span><span class="op" id="7947345">]</span><span class="op" id="7947346">.</span><span class="ident" id="7947347">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7947357">if</span>&nbsp;<span class="op" id="7947360">!</span><span class="ident" id="7947361">reflect</span><span class="op" id="7947368">.</span><span class="ident" id="7947369">DeepEqual</span><span class="op" id="7947378">(</span><span class="ident" id="7947379">got</span><span class="op" id="7947382">,</span>&nbsp;<span class="ident" id="7947384">want</span><span class="op" id="7947388">)</span>&nbsp;<span class="op" id="7947390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947395">t</span><span class="op" id="7947396">.</span><span class="ident" id="7947397">Errorf</span><span class="op" id="7947403">(</span><span class="string" id="7947404">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7947436">,</span>&nbsp;<span class="ident" id="7947438">i</span><span class="op" id="7947439">,</span>&nbsp;<span class="ident" id="7947441">got</span><span class="op" id="7947444">,</span>&nbsp;<span class="ident" id="7947446">want</span><span class="op" id="7947450">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7947457">}</span><br>
<span class="lineno"></span><span class="op" id="7947459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7947462">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7947537">var</span>&nbsp;<span class="ident" id="7947541">testGIF</span>&nbsp;<span class="op" id="7947549">=</span>&nbsp;<span class="op" id="7947551">[</span><span class="op" id="7947552">]</span><span class="builtintype" id="7947553">byte</span><span class="op" id="7947557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7947560">&#39;G&#39;</span><span class="op" id="7947563">,</span>&nbsp;<span class="string" id="7947565">&#39;I&#39;</span><span class="op" id="7947568">,</span>&nbsp;<span class="string" id="7947570">&#39;F&#39;</span><span class="op" id="7947573">,</span>&nbsp;<span class="string" id="7947575">&#39;8&#39;</span><span class="op" id="7947578">,</span>&nbsp;<span class="string" id="7947580">&#39;9&#39;</span><span class="op" id="7947583">,</span>&nbsp;<span class="string" id="7947585">&#39;a&#39;</span><span class="op" id="7947588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947591">1</span><span class="op" id="7947592">,</span>&nbsp;<span class="num" id="7947594">0</span><span class="op" id="7947595">,</span>&nbsp;<span class="num" id="7947597">1</span><span class="op" id="7947598">,</span>&nbsp;<span class="num" id="7947600">0</span><span class="op" id="7947601">,</span>&nbsp;<span class="comment" id="7947603">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947620">128</span><span class="op" id="7947623">,</span>&nbsp;<span class="num" id="7947625">0</span><span class="op" id="7947626">,</span>&nbsp;<span class="num" id="7947628">0</span><span class="op" id="7947629">,</span>&nbsp;<span class="comment" id="7947631">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947665">0</span><span class="op" id="7947666">,</span>&nbsp;<span class="num" id="7947668">0</span><span class="op" id="7947669">,</span>&nbsp;<span class="num" id="7947671">0</span><span class="op" id="7947672">,</span>&nbsp;<span class="num" id="7947674">1</span><span class="op" id="7947675">,</span>&nbsp;<span class="num" id="7947677">1</span><span class="op" id="7947678">,</span>&nbsp;<span class="num" id="7947680">1</span><span class="op" id="7947681">,</span>&nbsp;<span class="comment" id="7947683">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947723">0x21</span><span class="op" id="7947727">,</span>&nbsp;<span class="num" id="7947729">0xf9</span><span class="op" id="7947733">,</span>&nbsp;<span class="num" id="7947735">0x04</span><span class="op" id="7947739">,</span>&nbsp;<span class="num" id="7947741">0x00</span><span class="op" id="7947745">,</span>&nbsp;<span class="num" id="7947747">0x00</span><span class="op" id="7947751">,</span>&nbsp;<span class="num" id="7947753">0x00</span><span class="op" id="7947757">,</span>&nbsp;<span class="num" id="7947759">0xff</span><span class="op" id="7947763">,</span>&nbsp;<span class="num" id="7947765">0x00</span><span class="op" id="7947769">,</span>&nbsp;<span class="comment" id="7947771">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7947780">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947804">0x2c</span><span class="op" id="7947808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947811">0x00</span><span class="op" id="7947815">,</span>&nbsp;<span class="num" id="7947817">0x00</span><span class="op" id="7947821">,</span>&nbsp;<span class="num" id="7947823">0x00</span><span class="op" id="7947827">,</span>&nbsp;<span class="num" id="7947829">0x00</span><span class="op" id="7947833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947836">0x01</span><span class="op" id="7947840">,</span>&nbsp;<span class="num" id="7947842">0x00</span><span class="op" id="7947846">,</span>&nbsp;<span class="num" id="7947848">0x01</span><span class="op" id="7947852">,</span>&nbsp;<span class="num" id="7947854">0x00</span><span class="op" id="7947858">,</span>&nbsp;<span class="comment" id="7947860">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947869">0x00</span><span class="op" id="7947873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947876">0x02</span><span class="op" id="7947880">,</span>&nbsp;<span class="num" id="7947882">0x02</span><span class="op" id="7947886">,</span>&nbsp;<span class="num" id="7947888">0x4c</span><span class="op" id="7947892">,</span>&nbsp;<span class="num" id="7947894">0x01</span><span class="op" id="7947898">,</span>&nbsp;<span class="num" id="7947900">0x00</span><span class="op" id="7947904">,</span>&nbsp;<span class="comment" id="7947906">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7947921">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7947933">0x3b</span><span class="op" id="7947937">,</span><br>
<span class="lineno"></span><span class="op" id="7947939">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7947942">func</span>&nbsp;<span class="ident" id="7947947">try</span><span class="op" id="7947950">(</span><span class="ident" id="7947951">t</span>&nbsp;<span class="op" id="7947953">*</span><span class="ident" id="7947954">testing</span><span class="op" id="7947961">.</span><span class="ident" id="7947962">T</span><span class="op" id="7947963">,</span>&nbsp;<span class="ident" id="7947965">b</span>&nbsp;<span class="op" id="7947967">[</span><span class="op" id="7947968">]</span><span class="builtintype" id="7947969">byte</span><span class="op" id="7947973">,</span>&nbsp;<span class="ident" id="7947975">want</span>&nbsp;<span class="builtintype" id="7947980">string</span><span class="op" id="7947986">)</span>&nbsp;<span class="op" id="7947988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7947991">_</span><span class="op" id="7947992">,</span>&nbsp;<span class="ident" id="7947994">err</span>&nbsp;<span class="op" id="7947998">:=</span>&nbsp;<span class="ident" id="7948001">DecodeAll</span><span class="op" id="7948010">(</span><span class="ident" id="7948011">bytes</span><span class="op" id="7948016">.</span><span class="ident" id="7948017">NewReader</span><span class="op" id="7948026">(</span><span class="ident" id="7948027">b</span><span class="op" id="7948028">)</span><span class="op" id="7948029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7948032">var</span>&nbsp;<span class="ident" id="7948036">got</span>&nbsp;<span class="builtintype" id="7948040">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7948048">if</span>&nbsp;<span class="ident" id="7948051">err</span>&nbsp;<span class="op" id="7948055">!=</span>&nbsp;<span class="builtintype" id="7948058">nil</span>&nbsp;<span class="op" id="7948062">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948066">got</span>&nbsp;<span class="op" id="7948070">=</span>&nbsp;<span class="ident" id="7948072">err</span><span class="op" id="7948075">.</span><span class="ident" id="7948076">Error</span><span class="op" id="7948081">(</span><span class="op" id="7948082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7948085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7948088">if</span>&nbsp;<span class="ident" id="7948091">got</span>&nbsp;<span class="op" id="7948095">!=</span>&nbsp;<span class="ident" id="7948098">want</span>&nbsp;<span class="op" id="7948103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948107">t</span><span class="op" id="7948108">.</span><span class="ident" id="7948109">Fatalf</span><span class="op" id="7948115">(</span><span class="string" id="7948116">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7948133">,</span>&nbsp;<span class="ident" id="7948135">got</span><span class="op" id="7948138">,</span>&nbsp;<span class="ident" id="7948140">want</span><span class="op" id="7948144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7948147">}</span><br>
<span class="lineno">165</span><span class="op" id="7948149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7948152">func</span>&nbsp;<span class="ident" id="7948157">TestBounds</span><span class="op" id="7948167">(</span><span class="ident" id="7948168">t</span>&nbsp;<span class="op" id="7948170">*</span><span class="ident" id="7948171">testing</span><span class="op" id="7948178">.</span><span class="ident" id="7948179">T</span><span class="op" id="7948180">)</span>&nbsp;<span class="op" id="7948182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948185">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948219">gif</span>&nbsp;<span class="op" id="7948223">:=</span>&nbsp;<span class="builtinfunc" id="7948226">make</span><span class="op" id="7948230">(</span><span class="op" id="7948231">[</span><span class="op" id="7948232">]</span><span class="builtintype" id="7948233">byte</span><span class="op" id="7948237">,</span>&nbsp;<span class="builtinfunc" id="7948239">len</span><span class="op" id="7948242">(</span><span class="ident" id="7948243">testGIF</span><span class="op" id="7948250">)</span><span class="op" id="7948251">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7948254">copy</span><span class="op" id="7948258">(</span><span class="ident" id="7948259">gif</span><span class="op" id="7948262">,</span>&nbsp;<span class="ident" id="7948264">testGIF</span><span class="op" id="7948271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948274">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948316">gif</span><span class="op" id="7948319">[</span><span class="num" id="7948320">32</span><span class="op" id="7948322">]</span>&nbsp;<span class="op" id="7948324">=</span>&nbsp;<span class="num" id="7948326">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948329">want</span>&nbsp;<span class="op" id="7948334">:=</span>&nbsp;<span class="string" id="7948337">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948383">try</span><span class="op" id="7948386">(</span><span class="ident" id="7948387">t</span><span class="op" id="7948388">,</span>&nbsp;<span class="ident" id="7948390">gif</span><span class="op" id="7948393">,</span>&nbsp;<span class="ident" id="7948395">want</span><span class="op" id="7948399">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948403">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948458">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948500">gif</span><span class="op" id="7948503">[</span><span class="num" id="7948504">32</span><span class="op" id="7948506">]</span>&nbsp;<span class="op" id="7948508">=</span>&nbsp;<span class="num" id="7948510">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948513">want</span>&nbsp;<span class="op" id="7948518">=</span>&nbsp;<span class="string" id="7948520">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948548">try</span><span class="op" id="7948551">(</span><span class="ident" id="7948552">t</span><span class="op" id="7948553">,</span>&nbsp;<span class="ident" id="7948555">gif</span><span class="op" id="7948558">,</span>&nbsp;<span class="ident" id="7948560">want</span><span class="op" id="7948564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948567">gif</span><span class="op" id="7948570">[</span><span class="num" id="7948571">32</span><span class="op" id="7948573">]</span>&nbsp;<span class="op" id="7948575">=</span>&nbsp;<span class="num" id="7948577">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948581">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948630">want</span>&nbsp;<span class="op" id="7948635">=</span>&nbsp;<span class="string" id="7948637">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7948683">for</span>&nbsp;<span class="ident" id="7948687">i</span>&nbsp;<span class="op" id="7948689">:=</span>&nbsp;<span class="num" id="7948692">0</span><span class="op" id="7948693">;</span>&nbsp;<span class="ident" id="7948695">i</span>&nbsp;<span class="op" id="7948697">&lt;</span>&nbsp;<span class="num" id="7948699">4</span><span class="op" id="7948700">;</span>&nbsp;<span class="ident" id="7948702">i</span><span class="op" id="7948703">++</span>&nbsp;<span class="op" id="7948706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948710">gif</span><span class="op" id="7948713">[</span><span class="num" id="7948714">32</span><span class="op" id="7948716">+</span><span class="ident" id="7948717">i</span><span class="op" id="7948718">]</span>&nbsp;<span class="op" id="7948720">=</span>&nbsp;<span class="num" id="7948722">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7948728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948731">try</span><span class="op" id="7948734">(</span><span class="ident" id="7948735">t</span><span class="op" id="7948736">,</span>&nbsp;<span class="ident" id="7948738">gif</span><span class="op" id="7948741">,</span>&nbsp;<span class="ident" id="7948743">want</span><span class="op" id="7948747">)</span><br>
<span class="lineno"></span><span class="op" id="7948749">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7948752">func</span>&nbsp;<span class="ident" id="7948757">TestNoPalette</span><span class="op" id="7948770">(</span><span class="ident" id="7948771">t</span>&nbsp;<span class="op" id="7948773">*</span><span class="ident" id="7948774">testing</span><span class="op" id="7948781">.</span><span class="ident" id="7948782">T</span><span class="op" id="7948783">)</span>&nbsp;<span class="op" id="7948785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948788">b</span>&nbsp;<span class="op" id="7948790">:=</span>&nbsp;<span class="op" id="7948793">&amp;</span><span class="ident" id="7948794">bytes</span><span class="op" id="7948799">.</span><span class="ident" id="7948800">Buffer</span><span class="op" id="7948806">{</span><span class="op" id="7948807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948811">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948870">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948891">b</span><span class="op" id="7948892">.</span><span class="ident" id="7948893">WriteString</span><span class="op" id="7948904">(</span><span class="ident" id="7948905">headerStr</span><span class="op" id="7948914">[</span><span class="op" id="7948915">:</span><span class="builtinfunc" id="7948916">len</span><span class="op" id="7948919">(</span><span class="ident" id="7948920">headerStr</span><span class="op" id="7948929">)</span><span class="op" id="7948930">-</span><span class="num" id="7948931">3</span><span class="op" id="7948932">]</span><span class="op" id="7948933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7948936">b</span><span class="op" id="7948937">.</span><span class="ident" id="7948938">WriteString</span><span class="op" id="7948949">(</span><span class="string" id="7948950">&#34;\x00\x00\x00&#34;</span><span class="op" id="7948964">)</span>&nbsp;<span class="comment" id="7948966">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7948990">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949035">b</span><span class="op" id="7949036">.</span><span class="ident" id="7949037">WriteString</span><span class="op" id="7949048">(</span><span class="string" id="7949049">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7949095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7949099">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949172">pix</span>&nbsp;<span class="op" id="7949176">:=</span>&nbsp;<span class="op" id="7949179">[</span><span class="op" id="7949180">]</span><span class="builtintype" id="7949181">byte</span><span class="op" id="7949185">{</span><span class="num" id="7949186">0</span><span class="op" id="7949187">,</span>&nbsp;<span class="num" id="7949189">128</span><span class="op" id="7949192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949195">enc</span>&nbsp;<span class="op" id="7949199">:=</span>&nbsp;<span class="op" id="7949202">&amp;</span><span class="ident" id="7949203">bytes</span><span class="op" id="7949208">.</span><span class="ident" id="7949209">Buffer</span><span class="op" id="7949215">{</span><span class="op" id="7949216">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949219">w</span>&nbsp;<span class="op" id="7949221">:=</span>&nbsp;<span class="ident" id="7949224">lzw</span><span class="op" id="7949227">.</span><span class="ident" id="7949228">NewWriter</span><span class="op" id="7949237">(</span><span class="ident" id="7949238">enc</span><span class="op" id="7949241">,</span>&nbsp;<span class="ident" id="7949243">lzw</span><span class="op" id="7949246">.</span><span class="ident" id="7949247">LSB</span><span class="op" id="7949250">,</span>&nbsp;<span class="num" id="7949252">2</span><span class="op" id="7949253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949256">w</span><span class="op" id="7949257">.</span><span class="ident" id="7949258">Write</span><span class="op" id="7949263">(</span><span class="ident" id="7949264">pix</span><span class="op" id="7949267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949270">w</span><span class="op" id="7949271">.</span><span class="ident" id="7949272">Close</span><span class="op" id="7949277">(</span><span class="op" id="7949278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949281">b</span><span class="op" id="7949282">.</span><span class="ident" id="7949283">WriteByte</span><span class="op" id="7949292">(</span><span class="builtintype" id="7949293">byte</span><span class="op" id="7949297">(</span><span class="builtinfunc" id="7949298">len</span><span class="op" id="7949301">(</span><span class="ident" id="7949302">enc</span><span class="op" id="7949305">.</span><span class="ident" id="7949306">Bytes</span><span class="op" id="7949311">(</span><span class="op" id="7949312">)</span><span class="op" id="7949313">)</span><span class="op" id="7949314">)</span><span class="op" id="7949315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949318">b</span><span class="op" id="7949319">.</span><span class="ident" id="7949320">Write</span><span class="op" id="7949325">(</span><span class="ident" id="7949326">enc</span><span class="op" id="7949329">.</span><span class="ident" id="7949330">Bytes</span><span class="op" id="7949335">(</span><span class="op" id="7949336">)</span><span class="op" id="7949337">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949340">b</span><span class="op" id="7949341">.</span><span class="ident" id="7949342">WriteByte</span><span class="op" id="7949351">(</span><span class="num" id="7949352">0x00</span><span class="op" id="7949356">)</span>&nbsp;<span class="comment" id="7949358">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949415">b</span><span class="op" id="7949416">.</span><span class="ident" id="7949417">WriteString</span><span class="op" id="7949428">(</span><span class="ident" id="7949429">trailerStr</span><span class="op" id="7949439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949443">try</span><span class="op" id="7949446">(</span><span class="ident" id="7949447">t</span><span class="op" id="7949448">,</span>&nbsp;<span class="ident" id="7949450">b</span><span class="op" id="7949451">.</span><span class="ident" id="7949452">Bytes</span><span class="op" id="7949457">(</span><span class="op" id="7949458">)</span><span class="op" id="7949459">,</span>&nbsp;<span class="string" id="7949461">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7949487">)</span><br>
<span class="lineno">215</span><span class="op" id="7949489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7949492">func</span>&nbsp;<span class="ident" id="7949497">TestPixelOutsidePaletteRange</span><span class="op" id="7949525">(</span><span class="ident" id="7949526">t</span>&nbsp;<span class="op" id="7949528">*</span><span class="ident" id="7949529">testing</span><span class="op" id="7949536">.</span><span class="ident" id="7949537">T</span><span class="op" id="7949538">)</span>&nbsp;<span class="op" id="7949540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7949543">for</span>&nbsp;<span class="ident" id="7949547">_</span><span class="op" id="7949548">,</span>&nbsp;<span class="ident" id="7949550">pval</span>&nbsp;<span class="op" id="7949555">:=</span>&nbsp;<span class="keyword" id="7949558">range</span>&nbsp;<span class="op" id="7949564">[</span><span class="op" id="7949565">]</span><span class="builtintype" id="7949566">byte</span><span class="op" id="7949570">{</span><span class="num" id="7949571">0</span><span class="op" id="7949572">,</span>&nbsp;<span class="num" id="7949574">1</span><span class="op" id="7949575">,</span>&nbsp;<span class="num" id="7949577">2</span><span class="op" id="7949578">,</span>&nbsp;<span class="num" id="7949580">3</span><span class="op" id="7949581">,</span>&nbsp;<span class="num" id="7949583">255</span><span class="op" id="7949586">}</span>&nbsp;<span class="op" id="7949588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949592">b</span>&nbsp;<span class="op" id="7949594">:=</span>&nbsp;<span class="op" id="7949597">&amp;</span><span class="ident" id="7949598">bytes</span><span class="op" id="7949603">.</span><span class="ident" id="7949604">Buffer</span><span class="op" id="7949610">{</span><span class="op" id="7949611">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7949616">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949663">b</span><span class="op" id="7949664">.</span><span class="ident" id="7949665">WriteString</span><span class="op" id="7949676">(</span><span class="ident" id="7949677">headerStr</span><span class="op" id="7949686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949690">b</span><span class="op" id="7949691">.</span><span class="ident" id="7949692">WriteString</span><span class="op" id="7949703">(</span><span class="ident" id="7949704">paletteStr</span><span class="op" id="7949714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7949719">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949765">b</span><span class="op" id="7949766">.</span><span class="ident" id="7949767">WriteString</span><span class="op" id="7949778">(</span><span class="string" id="7949779">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7949825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7949830">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949893">pix</span>&nbsp;<span class="op" id="7949897">:=</span>&nbsp;<span class="op" id="7949900">[</span><span class="op" id="7949901">]</span><span class="builtintype" id="7949902">byte</span><span class="op" id="7949906">{</span><span class="ident" id="7949907">pval</span><span class="op" id="7949911">,</span>&nbsp;<span class="ident" id="7949913">pval</span><span class="op" id="7949917">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949921">enc</span>&nbsp;<span class="op" id="7949925">:=</span>&nbsp;<span class="op" id="7949928">&amp;</span><span class="ident" id="7949929">bytes</span><span class="op" id="7949934">.</span><span class="ident" id="7949935">Buffer</span><span class="op" id="7949941">{</span><span class="op" id="7949942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949946">w</span>&nbsp;<span class="op" id="7949948">:=</span>&nbsp;<span class="ident" id="7949951">lzw</span><span class="op" id="7949954">.</span><span class="ident" id="7949955">NewWriter</span><span class="op" id="7949964">(</span><span class="ident" id="7949965">enc</span><span class="op" id="7949968">,</span>&nbsp;<span class="ident" id="7949970">lzw</span><span class="op" id="7949973">.</span><span class="ident" id="7949974">LSB</span><span class="op" id="7949977">,</span>&nbsp;<span class="num" id="7949979">2</span><span class="op" id="7949980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949984">w</span><span class="op" id="7949985">.</span><span class="ident" id="7949986">Write</span><span class="op" id="7949991">(</span><span class="ident" id="7949992">pix</span><span class="op" id="7949995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7949999">w</span><span class="op" id="7950000">.</span><span class="ident" id="7950001">Close</span><span class="op" id="7950006">(</span><span class="op" id="7950007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950011">b</span><span class="op" id="7950012">.</span><span class="ident" id="7950013">WriteByte</span><span class="op" id="7950022">(</span><span class="builtintype" id="7950023">byte</span><span class="op" id="7950027">(</span><span class="builtinfunc" id="7950028">len</span><span class="op" id="7950031">(</span><span class="ident" id="7950032">enc</span><span class="op" id="7950035">.</span><span class="ident" id="7950036">Bytes</span><span class="op" id="7950041">(</span><span class="op" id="7950042">)</span><span class="op" id="7950043">)</span><span class="op" id="7950044">)</span><span class="op" id="7950045">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950049">b</span><span class="op" id="7950050">.</span><span class="ident" id="7950051">Write</span><span class="op" id="7950056">(</span><span class="ident" id="7950057">enc</span><span class="op" id="7950060">.</span><span class="ident" id="7950061">Bytes</span><span class="op" id="7950066">(</span><span class="op" id="7950067">)</span><span class="op" id="7950068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950072">b</span><span class="op" id="7950073">.</span><span class="ident" id="7950074">WriteByte</span><span class="op" id="7950083">(</span><span class="num" id="7950084">0x00</span><span class="op" id="7950088">)</span>&nbsp;<span class="comment" id="7950090">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950148">b</span><span class="op" id="7950149">.</span><span class="ident" id="7950150">WriteString</span><span class="op" id="7950161">(</span><span class="ident" id="7950162">trailerStr</span><span class="op" id="7950172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7950177">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950251">want</span>&nbsp;<span class="op" id="7950256">:=</span>&nbsp;<span class="string" id="7950259">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7950264">if</span>&nbsp;<span class="ident" id="7950267">pval</span>&nbsp;<span class="op" id="7950272">&gt;=</span>&nbsp;<span class="num" id="7950275">2</span>&nbsp;<span class="op" id="7950277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950282">want</span>&nbsp;<span class="op" id="7950287">=</span>&nbsp;<span class="string" id="7950289">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950318">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7950322">try</span><span class="op" id="7950325">(</span><span class="ident" id="7950326">t</span><span class="op" id="7950327">,</span>&nbsp;<span class="ident" id="7950329">b</span><span class="op" id="7950330">.</span><span class="ident" id="7950331">Bytes</span><span class="op" id="7950336">(</span><span class="op" id="7950337">)</span><span class="op" id="7950338">,</span>&nbsp;<span class="ident" id="7950340">want</span><span class="op" id="7950344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7950347">}</span><br>
<span class="lineno"></span><span class="op" id="7950349">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
