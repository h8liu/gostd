<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5431542">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5431597">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5431651">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5431702">package</span>&nbsp;<span class="ident" id="5431710">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431715">import</span>&nbsp;<span class="op" id="5431722">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431725">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431734">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431753">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431763">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431771">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5431785">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5431790">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5431793">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5431833">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431881">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5431921">type</span>&nbsp;<span class="ident" id="5431926">Writer</span>&nbsp;<span class="keyword" id="5431933">struct</span>&nbsp;<span class="op" id="5431940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431943">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431950">*</span><span class="ident" id="5431951">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431964">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431971">[</span><span class="op" id="5431972">]</span><span class="op" id="5431973">*</span><span class="ident" id="5431974">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431982">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5431989">*</span><span class="ident" id="5431990">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432002">closed</span>&nbsp;<span class="builtintype" id="5432009">bool</span><br>
<span class="lineno">25</span><span class="op" id="5432014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5432017">type</span>&nbsp;<span class="ident" id="5432022">header</span>&nbsp;<span class="keyword" id="5432029">struct</span>&nbsp;<span class="op" id="5432036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432039">*</span><span class="ident" id="5432040">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432052">offset</span>&nbsp;<span class="builtintype" id="5432059">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5432066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432069">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5432128">func</span>&nbsp;<span class="ident" id="5432133">NewWriter</span><span class="op" id="5432142">(</span><span class="ident" id="5432143">w</span>&nbsp;<span class="ident" id="5432145">io</span><span class="op" id="5432147">.</span><span class="ident" id="5432148">Writer</span><span class="op" id="5432154">)</span>&nbsp;<span class="op" id="5432156">*</span><span class="ident" id="5432157">Writer</span>&nbsp;<span class="op" id="5432164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432167">return</span>&nbsp;<span class="op" id="5432174">&amp;</span><span class="ident" id="5432175">Writer</span><span class="op" id="5432181">{</span><span class="ident" id="5432182">cw</span><span class="op" id="5432184">:</span>&nbsp;<span class="op" id="5432186">&amp;</span><span class="ident" id="5432187">countWriter</span><span class="op" id="5432198">{</span><span class="ident" id="5432199">w</span><span class="op" id="5432200">:</span>&nbsp;<span class="ident" id="5432202">bufio</span><span class="op" id="5432207">.</span><span class="ident" id="5432208">NewWriter</span><span class="op" id="5432217">(</span><span class="ident" id="5432218">w</span><span class="op" id="5432219">)</span><span class="op" id="5432220">}</span><span class="op" id="5432221">}</span><br>
<span class="lineno">35</span><span class="op" id="5432223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432226">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5432287">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5432360">func</span>&nbsp;<span class="op" id="5432365">(</span><span class="ident" id="5432366">w</span>&nbsp;<span class="op" id="5432368">*</span><span class="ident" id="5432369">Writer</span><span class="op" id="5432375">)</span>&nbsp;<span class="ident" id="5432377">Flush</span><span class="op" id="5432382">(</span><span class="op" id="5432383">)</span>&nbsp;<span class="builtintype" id="5432385">error</span>&nbsp;<span class="op" id="5432391">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432394">return</span>&nbsp;<span class="ident" id="5432401">w</span><span class="op" id="5432402">.</span><span class="ident" id="5432403">cw</span><span class="op" id="5432405">.</span><span class="ident" id="5432406">w</span><span class="op" id="5432407">.</span><span class="op" id="5432408">(</span><span class="op" id="5432409">*</span><span class="ident" id="5432410">bufio</span><span class="op" id="5432415">.</span><span class="ident" id="5432416">Writer</span><span class="op" id="5432422">)</span><span class="op" id="5432423">.</span><span class="ident" id="5432424">Flush</span><span class="op" id="5432429">(</span><span class="op" id="5432430">)</span><br>
<span class="lineno"></span><span class="op" id="5432432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432435">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5432508">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5432566">func</span>&nbsp;<span class="op" id="5432571">(</span><span class="ident" id="5432572">w</span>&nbsp;<span class="op" id="5432574">*</span><span class="ident" id="5432575">Writer</span><span class="op" id="5432581">)</span>&nbsp;<span class="ident" id="5432583">Close</span><span class="op" id="5432588">(</span><span class="op" id="5432589">)</span>&nbsp;<span class="builtintype" id="5432591">error</span>&nbsp;<span class="op" id="5432597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432600">if</span>&nbsp;<span class="ident" id="5432603">w</span><span class="op" id="5432604">.</span><span class="ident" id="5432605">last</span>&nbsp;<span class="op" id="5432610">!=</span>&nbsp;<span class="builtintype" id="5432613">nil</span>&nbsp;<span class="op" id="5432617">&amp;&amp;</span>&nbsp;<span class="op" id="5432620">!</span><span class="ident" id="5432621">w</span><span class="op" id="5432622">.</span><span class="ident" id="5432623">last</span><span class="op" id="5432627">.</span><span class="ident" id="5432628">closed</span>&nbsp;<span class="op" id="5432635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432639">if</span>&nbsp;<span class="ident" id="5432642">err</span>&nbsp;<span class="op" id="5432646">:=</span>&nbsp;<span class="ident" id="5432649">w</span><span class="op" id="5432650">.</span><span class="ident" id="5432651">last</span><span class="op" id="5432655">.</span><span class="builtinfunc" id="5432656">close</span><span class="op" id="5432661">(</span><span class="op" id="5432662">)</span><span class="op" id="5432663">;</span>&nbsp;<span class="ident" id="5432665">err</span>&nbsp;<span class="op" id="5432669">!=</span>&nbsp;<span class="builtintype" id="5432672">nil</span>&nbsp;<span class="op" id="5432676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432681">return</span>&nbsp;<span class="ident" id="5432688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432694">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432698">w</span><span class="op" id="5432699">.</span><span class="ident" id="5432700">last</span>&nbsp;<span class="op" id="5432705">=</span>&nbsp;<span class="builtintype" id="5432707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432715">if</span>&nbsp;<span class="ident" id="5432718">w</span><span class="op" id="5432719">.</span><span class="ident" id="5432720">closed</span>&nbsp;<span class="op" id="5432727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432731">return</span>&nbsp;<span class="ident" id="5432738">errors</span><span class="op" id="5432744">.</span><span class="ident" id="5432745">New</span><span class="op" id="5432748">(</span><span class="string" id="5432749">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5432775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432778">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432781">w</span><span class="op" id="5432782">.</span><span class="ident" id="5432783">closed</span>&nbsp;<span class="op" id="5432790">=</span>&nbsp;<span class="builtintype" id="5432792">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5432799">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432827">start</span>&nbsp;<span class="op" id="5432833">:=</span>&nbsp;<span class="ident" id="5432836">w</span><span class="op" id="5432837">.</span><span class="ident" id="5432838">cw</span><span class="op" id="5432840">.</span><span class="ident" id="5432841">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432848">for</span>&nbsp;<span class="ident" id="5432852">_</span><span class="op" id="5432853">,</span>&nbsp;<span class="ident" id="5432855">h</span>&nbsp;<span class="op" id="5432857">:=</span>&nbsp;<span class="keyword" id="5432860">range</span>&nbsp;<span class="ident" id="5432866">w</span><span class="op" id="5432867">.</span><span class="ident" id="5432868">dir</span>&nbsp;<span class="op" id="5432872">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432876">var</span>&nbsp;<span class="ident" id="5432880">buf</span>&nbsp;<span class="op" id="5432884">[</span><span class="ident" id="5432885">directoryHeaderLen</span><span class="op" id="5432903">]</span><span class="builtintype" id="5432904">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432911">b</span>&nbsp;<span class="op" id="5432913">:=</span>&nbsp;<span class="ident" id="5432916">writeBuf</span><span class="op" id="5432924">(</span><span class="ident" id="5432925">buf</span><span class="op" id="5432928">[</span><span class="op" id="5432929">:</span><span class="op" id="5432930">]</span><span class="op" id="5432931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432935">b</span><span class="op" id="5432936">.</span><span class="builtintype" id="5432937">uint32</span><span class="op" id="5432943">(</span><span class="builtintype" id="5432944">uint32</span><span class="op" id="5432950">(</span><span class="ident" id="5432951">directoryHeaderSignature</span><span class="op" id="5432975">)</span><span class="op" id="5432976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432980">b</span><span class="op" id="5432981">.</span><span class="builtintype" id="5432982">uint16</span><span class="op" id="5432988">(</span><span class="ident" id="5432989">h</span><span class="op" id="5432990">.</span><span class="ident" id="5432991">CreatorVersion</span><span class="op" id="5433005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433009">b</span><span class="op" id="5433010">.</span><span class="builtintype" id="5433011">uint16</span><span class="op" id="5433017">(</span><span class="ident" id="5433018">h</span><span class="op" id="5433019">.</span><span class="ident" id="5433020">ReaderVersion</span><span class="op" id="5433033">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433037">b</span><span class="op" id="5433038">.</span><span class="builtintype" id="5433039">uint16</span><span class="op" id="5433045">(</span><span class="ident" id="5433046">h</span><span class="op" id="5433047">.</span><span class="ident" id="5433048">Flags</span><span class="op" id="5433053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433057">b</span><span class="op" id="5433058">.</span><span class="builtintype" id="5433059">uint16</span><span class="op" id="5433065">(</span><span class="ident" id="5433066">h</span><span class="op" id="5433067">.</span><span class="ident" id="5433068">Method</span><span class="op" id="5433074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433078">b</span><span class="op" id="5433079">.</span><span class="builtintype" id="5433080">uint16</span><span class="op" id="5433086">(</span><span class="ident" id="5433087">h</span><span class="op" id="5433088">.</span><span class="ident" id="5433089">ModifiedTime</span><span class="op" id="5433101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433105">b</span><span class="op" id="5433106">.</span><span class="builtintype" id="5433107">uint16</span><span class="op" id="5433113">(</span><span class="ident" id="5433114">h</span><span class="op" id="5433115">.</span><span class="ident" id="5433116">ModifiedDate</span><span class="op" id="5433128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433132">b</span><span class="op" id="5433133">.</span><span class="builtintype" id="5433134">uint32</span><span class="op" id="5433140">(</span><span class="ident" id="5433141">h</span><span class="op" id="5433142">.</span><span class="ident" id="5433143">CRC32</span><span class="op" id="5433148">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433152">if</span>&nbsp;<span class="ident" id="5433155">h</span><span class="op" id="5433156">.</span><span class="ident" id="5433157">isZip64</span><span class="op" id="5433164">(</span><span class="op" id="5433165">)</span>&nbsp;<span class="op" id="5433167">||</span>&nbsp;<span class="ident" id="5433170">h</span><span class="op" id="5433171">.</span><span class="ident" id="5433172">offset</span>&nbsp;<span class="op" id="5433179">&gt;</span>&nbsp;<span class="ident" id="5433181">uint32max</span>&nbsp;<span class="op" id="5433191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433196">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433254">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433317">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433358">b</span><span class="op" id="5433359">.</span><span class="builtintype" id="5433360">uint32</span><span class="op" id="5433366">(</span><span class="ident" id="5433367">uint32max</span><span class="op" id="5433376">)</span>&nbsp;<span class="comment" id="5433378">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433400">b</span><span class="op" id="5433401">.</span><span class="builtintype" id="5433402">uint32</span><span class="op" id="5433408">(</span><span class="ident" id="5433409">uint32max</span><span class="op" id="5433418">)</span>&nbsp;<span class="comment" id="5433420">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433445">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433487">var</span>&nbsp;<span class="ident" id="5433491">buf</span>&nbsp;<span class="op" id="5433495">[</span><span class="num" id="5433496">28</span><span class="op" id="5433498">]</span><span class="builtintype" id="5433499">byte</span>&nbsp;<span class="comment" id="5433504">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433532">eb</span>&nbsp;<span class="op" id="5433535">:=</span>&nbsp;<span class="ident" id="5433538">writeBuf</span><span class="op" id="5433546">(</span><span class="ident" id="5433547">buf</span><span class="op" id="5433550">[</span><span class="op" id="5433551">:</span><span class="op" id="5433552">]</span><span class="op" id="5433553">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433558">eb</span><span class="op" id="5433560">.</span><span class="builtintype" id="5433561">uint16</span><span class="op" id="5433567">(</span><span class="ident" id="5433568">zip64ExtraId</span><span class="op" id="5433580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433585">eb</span><span class="op" id="5433587">.</span><span class="builtintype" id="5433588">uint16</span><span class="op" id="5433594">(</span><span class="num" id="5433595">24</span><span class="op" id="5433597">)</span>&nbsp;<span class="comment" id="5433599">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433622">eb</span><span class="op" id="5433624">.</span><span class="builtintype" id="5433625">uint64</span><span class="op" id="5433631">(</span><span class="ident" id="5433632">h</span><span class="op" id="5433633">.</span><span class="ident" id="5433634">UncompressedSize64</span><span class="op" id="5433652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433657">eb</span><span class="op" id="5433659">.</span><span class="builtintype" id="5433660">uint64</span><span class="op" id="5433666">(</span><span class="ident" id="5433667">h</span><span class="op" id="5433668">.</span><span class="ident" id="5433669">CompressedSize64</span><span class="op" id="5433685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433690">eb</span><span class="op" id="5433692">.</span><span class="builtintype" id="5433693">uint64</span><span class="op" id="5433699">(</span><span class="ident" id="5433700">h</span><span class="op" id="5433701">.</span><span class="ident" id="5433702">offset</span><span class="op" id="5433708">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433713">h</span><span class="op" id="5433714">.</span><span class="ident" id="5433715">Extra</span>&nbsp;<span class="op" id="5433721">=</span>&nbsp;<span class="builtinfunc" id="5433723">append</span><span class="op" id="5433729">(</span><span class="ident" id="5433730">h</span><span class="op" id="5433731">.</span><span class="ident" id="5433732">Extra</span><span class="op" id="5433737">,</span>&nbsp;<span class="ident" id="5433739">buf</span><span class="op" id="5433742">[</span><span class="op" id="5433743">:</span><span class="op" id="5433744">]</span><span class="op" id="5433745">...</span><span class="op" id="5433748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433752">}</span>&nbsp;<span class="keyword" id="5433754">else</span>&nbsp;<span class="op" id="5433759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433764">b</span><span class="op" id="5433765">.</span><span class="builtintype" id="5433766">uint32</span><span class="op" id="5433772">(</span><span class="ident" id="5433773">h</span><span class="op" id="5433774">.</span><span class="ident" id="5433775">CompressedSize</span><span class="op" id="5433789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433794">b</span><span class="op" id="5433795">.</span><span class="builtintype" id="5433796">uint32</span><span class="op" id="5433802">(</span><span class="ident" id="5433803">h</span><span class="op" id="5433804">.</span><span class="ident" id="5433805">UncompressedSize</span><span class="op" id="5433821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433825">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433829">b</span><span class="op" id="5433830">.</span><span class="builtintype" id="5433831">uint16</span><span class="op" id="5433837">(</span><span class="builtintype" id="5433838">uint16</span><span class="op" id="5433844">(</span><span class="builtinfunc" id="5433845">len</span><span class="op" id="5433848">(</span><span class="ident" id="5433849">h</span><span class="op" id="5433850">.</span><span class="ident" id="5433851">Name</span><span class="op" id="5433855">)</span><span class="op" id="5433856">)</span><span class="op" id="5433857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433861">b</span><span class="op" id="5433862">.</span><span class="builtintype" id="5433863">uint16</span><span class="op" id="5433869">(</span><span class="builtintype" id="5433870">uint16</span><span class="op" id="5433876">(</span><span class="builtinfunc" id="5433877">len</span><span class="op" id="5433880">(</span><span class="ident" id="5433881">h</span><span class="op" id="5433882">.</span><span class="ident" id="5433883">Extra</span><span class="op" id="5433888">)</span><span class="op" id="5433889">)</span><span class="op" id="5433890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433894">b</span><span class="op" id="5433895">.</span><span class="builtintype" id="5433896">uint16</span><span class="op" id="5433902">(</span><span class="builtintype" id="5433903">uint16</span><span class="op" id="5433909">(</span><span class="builtinfunc" id="5433910">len</span><span class="op" id="5433913">(</span><span class="ident" id="5433914">h</span><span class="op" id="5433915">.</span><span class="ident" id="5433916">Comment</span><span class="op" id="5433923">)</span><span class="op" id="5433924">)</span><span class="op" id="5433925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433929">b</span>&nbsp;<span class="op" id="5433931">=</span>&nbsp;<span class="ident" id="5433933">b</span><span class="op" id="5433934">[</span><span class="num" id="5433935">4</span><span class="op" id="5433936">:</span><span class="op" id="5433937">]</span>&nbsp;<span class="comment" id="5433939">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434002">b</span><span class="op" id="5434003">.</span><span class="builtintype" id="5434004">uint32</span><span class="op" id="5434010">(</span><span class="ident" id="5434011">h</span><span class="op" id="5434012">.</span><span class="ident" id="5434013">ExternalAttrs</span><span class="op" id="5434026">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434030">if</span>&nbsp;<span class="ident" id="5434033">h</span><span class="op" id="5434034">.</span><span class="ident" id="5434035">offset</span>&nbsp;<span class="op" id="5434042">&gt;</span>&nbsp;<span class="ident" id="5434044">uint32max</span>&nbsp;<span class="op" id="5434054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434059">b</span><span class="op" id="5434060">.</span><span class="builtintype" id="5434061">uint32</span><span class="op" id="5434067">(</span><span class="ident" id="5434068">uint32max</span><span class="op" id="5434077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434081">}</span>&nbsp;<span class="keyword" id="5434083">else</span>&nbsp;<span class="op" id="5434088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434093">b</span><span class="op" id="5434094">.</span><span class="builtintype" id="5434095">uint32</span><span class="op" id="5434101">(</span><span class="builtintype" id="5434102">uint32</span><span class="op" id="5434108">(</span><span class="ident" id="5434109">h</span><span class="op" id="5434110">.</span><span class="ident" id="5434111">offset</span><span class="op" id="5434117">)</span><span class="op" id="5434118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434122">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434126">if</span>&nbsp;<span class="ident" id="5434129">_</span><span class="op" id="5434130">,</span>&nbsp;<span class="ident" id="5434132">err</span>&nbsp;<span class="op" id="5434136">:=</span>&nbsp;<span class="ident" id="5434139">w</span><span class="op" id="5434140">.</span><span class="ident" id="5434141">cw</span><span class="op" id="5434143">.</span><span class="ident" id="5434144">Write</span><span class="op" id="5434149">(</span><span class="ident" id="5434150">buf</span><span class="op" id="5434153">[</span><span class="op" id="5434154">:</span><span class="op" id="5434155">]</span><span class="op" id="5434156">)</span><span class="op" id="5434157">;</span>&nbsp;<span class="ident" id="5434159">err</span>&nbsp;<span class="op" id="5434163">!=</span>&nbsp;<span class="builtintype" id="5434166">nil</span>&nbsp;<span class="op" id="5434170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434175">return</span>&nbsp;<span class="ident" id="5434182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434192">if</span>&nbsp;<span class="ident" id="5434195">_</span><span class="op" id="5434196">,</span>&nbsp;<span class="ident" id="5434198">err</span>&nbsp;<span class="op" id="5434202">:=</span>&nbsp;<span class="ident" id="5434205">io</span><span class="op" id="5434207">.</span><span class="ident" id="5434208">WriteString</span><span class="op" id="5434219">(</span><span class="ident" id="5434220">w</span><span class="op" id="5434221">.</span><span class="ident" id="5434222">cw</span><span class="op" id="5434224">,</span>&nbsp;<span class="ident" id="5434226">h</span><span class="op" id="5434227">.</span><span class="ident" id="5434228">Name</span><span class="op" id="5434232">)</span><span class="op" id="5434233">;</span>&nbsp;<span class="ident" id="5434235">err</span>&nbsp;<span class="op" id="5434239">!=</span>&nbsp;<span class="builtintype" id="5434242">nil</span>&nbsp;<span class="op" id="5434246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434251">return</span>&nbsp;<span class="ident" id="5434258">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434268">if</span>&nbsp;<span class="ident" id="5434271">_</span><span class="op" id="5434272">,</span>&nbsp;<span class="ident" id="5434274">err</span>&nbsp;<span class="op" id="5434278">:=</span>&nbsp;<span class="ident" id="5434281">w</span><span class="op" id="5434282">.</span><span class="ident" id="5434283">cw</span><span class="op" id="5434285">.</span><span class="ident" id="5434286">Write</span><span class="op" id="5434291">(</span><span class="ident" id="5434292">h</span><span class="op" id="5434293">.</span><span class="ident" id="5434294">Extra</span><span class="op" id="5434299">)</span><span class="op" id="5434300">;</span>&nbsp;<span class="ident" id="5434302">err</span>&nbsp;<span class="op" id="5434306">!=</span>&nbsp;<span class="builtintype" id="5434309">nil</span>&nbsp;<span class="op" id="5434313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434318">return</span>&nbsp;<span class="ident" id="5434325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434335">if</span>&nbsp;<span class="ident" id="5434338">_</span><span class="op" id="5434339">,</span>&nbsp;<span class="ident" id="5434341">err</span>&nbsp;<span class="op" id="5434345">:=</span>&nbsp;<span class="ident" id="5434348">io</span><span class="op" id="5434350">.</span><span class="ident" id="5434351">WriteString</span><span class="op" id="5434362">(</span><span class="ident" id="5434363">w</span><span class="op" id="5434364">.</span><span class="ident" id="5434365">cw</span><span class="op" id="5434367">,</span>&nbsp;<span class="ident" id="5434369">h</span><span class="op" id="5434370">.</span><span class="ident" id="5434371">Comment</span><span class="op" id="5434378">)</span><span class="op" id="5434379">;</span>&nbsp;<span class="ident" id="5434381">err</span>&nbsp;<span class="op" id="5434385">!=</span>&nbsp;<span class="builtintype" id="5434388">nil</span>&nbsp;<span class="op" id="5434392">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434397">return</span>&nbsp;<span class="ident" id="5434404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434416">end</span>&nbsp;<span class="op" id="5434420">:=</span>&nbsp;<span class="ident" id="5434423">w</span><span class="op" id="5434424">.</span><span class="ident" id="5434425">cw</span><span class="op" id="5434427">.</span><span class="ident" id="5434428">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434436">records</span>&nbsp;<span class="op" id="5434444">:=</span>&nbsp;<span class="builtintype" id="5434447">uint64</span><span class="op" id="5434453">(</span><span class="builtinfunc" id="5434454">len</span><span class="op" id="5434457">(</span><span class="ident" id="5434458">w</span><span class="op" id="5434459">.</span><span class="ident" id="5434460">dir</span><span class="op" id="5434463">)</span><span class="op" id="5434464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434467">size</span>&nbsp;<span class="op" id="5434472">:=</span>&nbsp;<span class="builtintype" id="5434475">uint64</span><span class="op" id="5434481">(</span><span class="ident" id="5434482">end</span>&nbsp;<span class="op" id="5434486">-</span>&nbsp;<span class="ident" id="5434488">start</span><span class="op" id="5434493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434496">offset</span>&nbsp;<span class="op" id="5434503">:=</span>&nbsp;<span class="builtintype" id="5434506">uint64</span><span class="op" id="5434512">(</span><span class="ident" id="5434513">start</span><span class="op" id="5434518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434522">if</span>&nbsp;<span class="ident" id="5434525">records</span>&nbsp;<span class="op" id="5434533">&gt;</span>&nbsp;<span class="ident" id="5434535">uint16max</span>&nbsp;<span class="op" id="5434545">||</span>&nbsp;<span class="ident" id="5434548">size</span>&nbsp;<span class="op" id="5434553">&gt;</span>&nbsp;<span class="ident" id="5434555">uint32max</span>&nbsp;<span class="op" id="5434565">||</span>&nbsp;<span class="ident" id="5434568">offset</span>&nbsp;<span class="op" id="5434575">&gt;</span>&nbsp;<span class="ident" id="5434577">uint32max</span>&nbsp;<span class="op" id="5434587">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434591">var</span>&nbsp;<span class="ident" id="5434595">buf</span>&nbsp;<span class="op" id="5434599">[</span><span class="ident" id="5434600">directory64EndLen</span>&nbsp;<span class="op" id="5434618">+</span>&nbsp;<span class="ident" id="5434620">directory64LocLen</span><span class="op" id="5434637">]</span><span class="builtintype" id="5434638">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434645">b</span>&nbsp;<span class="op" id="5434647">:=</span>&nbsp;<span class="ident" id="5434650">writeBuf</span><span class="op" id="5434658">(</span><span class="ident" id="5434659">buf</span><span class="op" id="5434662">[</span><span class="op" id="5434663">:</span><span class="op" id="5434664">]</span><span class="op" id="5434665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434670">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434713">b</span><span class="op" id="5434714">.</span><span class="builtintype" id="5434715">uint32</span><span class="op" id="5434721">(</span><span class="ident" id="5434722">directory64EndSignature</span><span class="op" id="5434745">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434749">b</span><span class="op" id="5434750">.</span><span class="builtintype" id="5434751">uint64</span><span class="op" id="5434757">(</span><span class="ident" id="5434758">directory64EndLen</span><span class="op" id="5434775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434779">b</span><span class="op" id="5434780">.</span><span class="builtintype" id="5434781">uint16</span><span class="op" id="5434787">(</span><span class="ident" id="5434788">zipVersion45</span><span class="op" id="5434800">)</span>&nbsp;<span class="comment" id="5434802">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434823">b</span><span class="op" id="5434824">.</span><span class="builtintype" id="5434825">uint16</span><span class="op" id="5434831">(</span><span class="ident" id="5434832">zipVersion45</span><span class="op" id="5434844">)</span>&nbsp;<span class="comment" id="5434846">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434877">b</span><span class="op" id="5434878">.</span><span class="builtintype" id="5434879">uint32</span><span class="op" id="5434885">(</span><span class="num" id="5434886">0</span><span class="op" id="5434887">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434900">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434925">b</span><span class="op" id="5434926">.</span><span class="builtintype" id="5434927">uint32</span><span class="op" id="5434933">(</span><span class="num" id="5434934">0</span><span class="op" id="5434935">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434948">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435012">b</span><span class="op" id="5435013">.</span><span class="builtintype" id="5435014">uint64</span><span class="op" id="5435020">(</span><span class="ident" id="5435021">records</span><span class="op" id="5435028">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435035">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435102">b</span><span class="op" id="5435103">.</span><span class="builtintype" id="5435104">uint64</span><span class="op" id="5435110">(</span><span class="ident" id="5435111">records</span><span class="op" id="5435118">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435125">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435179">b</span><span class="op" id="5435180">.</span><span class="builtintype" id="5435181">uint64</span><span class="op" id="5435187">(</span><span class="ident" id="5435188">size</span><span class="op" id="5435192">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435202">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435237">b</span><span class="op" id="5435238">.</span><span class="builtintype" id="5435239">uint64</span><span class="op" id="5435245">(</span><span class="ident" id="5435246">offset</span><span class="op" id="5435252">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435260">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435344">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435388">b</span><span class="op" id="5435389">.</span><span class="builtintype" id="5435390">uint32</span><span class="op" id="5435396">(</span><span class="ident" id="5435397">directory64LocSignature</span><span class="op" id="5435420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435424">b</span><span class="op" id="5435425">.</span><span class="builtintype" id="5435426">uint32</span><span class="op" id="5435432">(</span><span class="num" id="5435433">0</span><span class="op" id="5435434">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435446">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435523">b</span><span class="op" id="5435524">.</span><span class="builtintype" id="5435525">uint64</span><span class="op" id="5435531">(</span><span class="builtintype" id="5435532">uint64</span><span class="op" id="5435538">(</span><span class="ident" id="5435539">end</span><span class="op" id="5435542">)</span><span class="op" id="5435543">)</span>&nbsp;<span class="comment" id="5435545">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435611">b</span><span class="op" id="5435612">.</span><span class="builtintype" id="5435613">uint32</span><span class="op" id="5435619">(</span><span class="num" id="5435620">1</span><span class="op" id="5435621">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435633">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435661">if</span>&nbsp;<span class="ident" id="5435664">_</span><span class="op" id="5435665">,</span>&nbsp;<span class="ident" id="5435667">err</span>&nbsp;<span class="op" id="5435671">:=</span>&nbsp;<span class="ident" id="5435674">w</span><span class="op" id="5435675">.</span><span class="ident" id="5435676">cw</span><span class="op" id="5435678">.</span><span class="ident" id="5435679">Write</span><span class="op" id="5435684">(</span><span class="ident" id="5435685">buf</span><span class="op" id="5435688">[</span><span class="op" id="5435689">:</span><span class="op" id="5435690">]</span><span class="op" id="5435691">)</span><span class="op" id="5435692">;</span>&nbsp;<span class="ident" id="5435694">err</span>&nbsp;<span class="op" id="5435698">!=</span>&nbsp;<span class="builtintype" id="5435701">nil</span>&nbsp;<span class="op" id="5435705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435710">return</span>&nbsp;<span class="ident" id="5435717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435728">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435791">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435841">records</span>&nbsp;<span class="op" id="5435849">=</span>&nbsp;<span class="ident" id="5435851">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435863">size</span>&nbsp;<span class="op" id="5435868">=</span>&nbsp;<span class="ident" id="5435870">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435882">offset</span>&nbsp;<span class="op" id="5435889">=</span>&nbsp;<span class="ident" id="5435891">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435906">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435927">var</span>&nbsp;<span class="ident" id="5435931">buf</span>&nbsp;<span class="op" id="5435935">[</span><span class="ident" id="5435936">directoryEndLen</span><span class="op" id="5435951">]</span><span class="builtintype" id="5435952">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435958">b</span>&nbsp;<span class="op" id="5435960">:=</span>&nbsp;<span class="ident" id="5435963">writeBuf</span><span class="op" id="5435971">(</span><span class="ident" id="5435972">buf</span><span class="op" id="5435975">[</span><span class="op" id="5435976">:</span><span class="op" id="5435977">]</span><span class="op" id="5435978">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435981">b</span><span class="op" id="5435982">.</span><span class="builtintype" id="5435983">uint32</span><span class="op" id="5435989">(</span><span class="builtintype" id="5435990">uint32</span><span class="op" id="5435996">(</span><span class="ident" id="5435997">directoryEndSignature</span><span class="op" id="5436018">)</span><span class="op" id="5436019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436022">b</span>&nbsp;<span class="op" id="5436024">=</span>&nbsp;<span class="ident" id="5436026">b</span><span class="op" id="5436027">[</span><span class="num" id="5436028">4</span><span class="op" id="5436029">:</span><span class="op" id="5436030">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436048">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436108">b</span><span class="op" id="5436109">.</span><span class="builtintype" id="5436110">uint16</span><span class="op" id="5436116">(</span><span class="builtintype" id="5436117">uint16</span><span class="op" id="5436123">(</span><span class="ident" id="5436124">records</span><span class="op" id="5436131">)</span><span class="op" id="5436132">)</span>&nbsp;<span class="comment" id="5436134">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436166">b</span><span class="op" id="5436167">.</span><span class="builtintype" id="5436168">uint16</span><span class="op" id="5436174">(</span><span class="builtintype" id="5436175">uint16</span><span class="op" id="5436181">(</span><span class="ident" id="5436182">records</span><span class="op" id="5436189">)</span><span class="op" id="5436190">)</span>&nbsp;<span class="comment" id="5436192">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436220">b</span><span class="op" id="5436221">.</span><span class="builtintype" id="5436222">uint32</span><span class="op" id="5436228">(</span><span class="builtintype" id="5436229">uint32</span><span class="op" id="5436235">(</span><span class="ident" id="5436236">size</span><span class="op" id="5436240">)</span><span class="op" id="5436241">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436246">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436268">b</span><span class="op" id="5436269">.</span><span class="builtintype" id="5436270">uint32</span><span class="op" id="5436276">(</span><span class="builtintype" id="5436277">uint32</span><span class="op" id="5436283">(</span><span class="ident" id="5436284">offset</span><span class="op" id="5436290">)</span><span class="op" id="5436291">)</span>&nbsp;&nbsp;<span class="comment" id="5436294">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436317">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436359">if</span>&nbsp;<span class="ident" id="5436362">_</span><span class="op" id="5436363">,</span>&nbsp;<span class="ident" id="5436365">err</span>&nbsp;<span class="op" id="5436369">:=</span>&nbsp;<span class="ident" id="5436372">w</span><span class="op" id="5436373">.</span><span class="ident" id="5436374">cw</span><span class="op" id="5436376">.</span><span class="ident" id="5436377">Write</span><span class="op" id="5436382">(</span><span class="ident" id="5436383">buf</span><span class="op" id="5436386">[</span><span class="op" id="5436387">:</span><span class="op" id="5436388">]</span><span class="op" id="5436389">)</span><span class="op" id="5436390">;</span>&nbsp;<span class="ident" id="5436392">err</span>&nbsp;<span class="op" id="5436396">!=</span>&nbsp;<span class="builtintype" id="5436399">nil</span>&nbsp;<span class="op" id="5436403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436407">return</span>&nbsp;<span class="ident" id="5436414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436419">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436423">return</span>&nbsp;<span class="ident" id="5436430">w</span><span class="op" id="5436431">.</span><span class="ident" id="5436432">cw</span><span class="op" id="5436434">.</span><span class="ident" id="5436435">w</span><span class="op" id="5436436">.</span><span class="op" id="5436437">(</span><span class="op" id="5436438">*</span><span class="ident" id="5436439">bufio</span><span class="op" id="5436444">.</span><span class="ident" id="5436445">Writer</span><span class="op" id="5436451">)</span><span class="op" id="5436452">.</span><span class="ident" id="5436453">Flush</span><span class="op" id="5436458">(</span><span class="op" id="5436459">)</span><br>
<span class="lineno"></span><span class="op" id="5436461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5436464">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5436527">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5436596">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5436664">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5436731">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5436743">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5436815">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5436858">func</span>&nbsp;<span class="op" id="5436863">(</span><span class="ident" id="5436864">w</span>&nbsp;<span class="op" id="5436866">*</span><span class="ident" id="5436867">Writer</span><span class="op" id="5436873">)</span>&nbsp;<span class="ident" id="5436875">Create</span><span class="op" id="5436881">(</span><span class="ident" id="5436882">name</span>&nbsp;<span class="builtintype" id="5436887">string</span><span class="op" id="5436893">)</span>&nbsp;<span class="op" id="5436895">(</span><span class="ident" id="5436896">io</span><span class="op" id="5436898">.</span><span class="ident" id="5436899">Writer</span><span class="op" id="5436905">,</span>&nbsp;<span class="builtintype" id="5436907">error</span><span class="op" id="5436912">)</span>&nbsp;<span class="op" id="5436914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436917">header</span>&nbsp;<span class="op" id="5436924">:=</span>&nbsp;<span class="op" id="5436927">&amp;</span><span class="ident" id="5436928">FileHeader</span><span class="op" id="5436938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436942">Name</span><span class="op" id="5436946">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5436950">name</span><span class="op" id="5436954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436958">Method</span><span class="op" id="5436964">:</span>&nbsp;<span class="ident" id="5436966">Deflate</span><span class="op" id="5436973">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436979">return</span>&nbsp;<span class="ident" id="5436986">w</span><span class="op" id="5436987">.</span><span class="ident" id="5436988">CreateHeader</span><span class="op" id="5437000">(</span><span class="ident" id="5437001">header</span><span class="op" id="5437007">)</span><br>
<span class="lineno"></span><span class="op" id="5437009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437012">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5437086">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5437112">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5437181">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5437253">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5437296">func</span>&nbsp;<span class="op" id="5437301">(</span><span class="ident" id="5437302">w</span>&nbsp;<span class="op" id="5437304">*</span><span class="ident" id="5437305">Writer</span><span class="op" id="5437311">)</span>&nbsp;<span class="ident" id="5437313">CreateHeader</span><span class="op" id="5437325">(</span><span class="ident" id="5437326">fh</span>&nbsp;<span class="op" id="5437329">*</span><span class="ident" id="5437330">FileHeader</span><span class="op" id="5437340">)</span>&nbsp;<span class="op" id="5437342">(</span><span class="ident" id="5437343">io</span><span class="op" id="5437345">.</span><span class="ident" id="5437346">Writer</span><span class="op" id="5437352">,</span>&nbsp;<span class="builtintype" id="5437354">error</span><span class="op" id="5437359">)</span>&nbsp;<span class="op" id="5437361">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437364">if</span>&nbsp;<span class="ident" id="5437367">w</span><span class="op" id="5437368">.</span><span class="ident" id="5437369">last</span>&nbsp;<span class="op" id="5437374">!=</span>&nbsp;<span class="builtintype" id="5437377">nil</span>&nbsp;<span class="op" id="5437381">&amp;&amp;</span>&nbsp;<span class="op" id="5437384">!</span><span class="ident" id="5437385">w</span><span class="op" id="5437386">.</span><span class="ident" id="5437387">last</span><span class="op" id="5437391">.</span><span class="ident" id="5437392">closed</span>&nbsp;<span class="op" id="5437399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437403">if</span>&nbsp;<span class="ident" id="5437406">err</span>&nbsp;<span class="op" id="5437410">:=</span>&nbsp;<span class="ident" id="5437413">w</span><span class="op" id="5437414">.</span><span class="ident" id="5437415">last</span><span class="op" id="5437419">.</span><span class="builtinfunc" id="5437420">close</span><span class="op" id="5437425">(</span><span class="op" id="5437426">)</span><span class="op" id="5437427">;</span>&nbsp;<span class="ident" id="5437429">err</span>&nbsp;<span class="op" id="5437433">!=</span>&nbsp;<span class="builtintype" id="5437436">nil</span>&nbsp;<span class="op" id="5437440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437445">return</span>&nbsp;<span class="builtintype" id="5437452">nil</span><span class="op" id="5437455">,</span>&nbsp;<span class="ident" id="5437457">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437466">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437470">fh</span><span class="op" id="5437472">.</span><span class="ident" id="5437473">Flags</span>&nbsp;<span class="op" id="5437479">|=</span>&nbsp;<span class="num" id="5437482">0x8</span>&nbsp;<span class="comment" id="5437486">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437523">fh</span><span class="op" id="5437525">.</span><span class="ident" id="5437526">CreatorVersion</span>&nbsp;<span class="op" id="5437541">=</span>&nbsp;<span class="ident" id="5437543">fh</span><span class="op" id="5437545">.</span><span class="ident" id="5437546">CreatorVersion</span><span class="op" id="5437560">&amp;</span><span class="num" id="5437561">0xff00</span>&nbsp;<span class="op" id="5437568">|</span>&nbsp;<span class="ident" id="5437570">zipVersion20</span>&nbsp;<span class="comment" id="5437583">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437615">fh</span><span class="op" id="5437617">.</span><span class="ident" id="5437618">ReaderVersion</span>&nbsp;<span class="op" id="5437632">=</span>&nbsp;<span class="ident" id="5437634">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437649">fw</span>&nbsp;<span class="op" id="5437652">:=</span>&nbsp;<span class="op" id="5437655">&amp;</span><span class="ident" id="5437656">fileWriter</span><span class="op" id="5437666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437670">zipw</span><span class="op" id="5437674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437681">w</span><span class="op" id="5437682">.</span><span class="ident" id="5437683">cw</span><span class="op" id="5437685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437689">compCount</span><span class="op" id="5437698">:</span>&nbsp;<span class="op" id="5437700">&amp;</span><span class="ident" id="5437701">countWriter</span><span class="op" id="5437712">{</span><span class="ident" id="5437713">w</span><span class="op" id="5437714">:</span>&nbsp;<span class="ident" id="5437716">w</span><span class="op" id="5437717">.</span><span class="ident" id="5437718">cw</span><span class="op" id="5437720">}</span><span class="op" id="5437721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437725">crc32</span><span class="op" id="5437730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437736">crc32</span><span class="op" id="5437741">.</span><span class="ident" id="5437742">NewIEEE</span><span class="op" id="5437749">(</span><span class="op" id="5437750">)</span><span class="op" id="5437751">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437757">comp</span>&nbsp;<span class="op" id="5437762">:=</span>&nbsp;<span class="ident" id="5437765">compressor</span><span class="op" id="5437775">(</span><span class="ident" id="5437776">fh</span><span class="op" id="5437778">.</span><span class="ident" id="5437779">Method</span><span class="op" id="5437785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437788">if</span>&nbsp;<span class="ident" id="5437791">comp</span>&nbsp;<span class="op" id="5437796">==</span>&nbsp;<span class="builtintype" id="5437799">nil</span>&nbsp;<span class="op" id="5437803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437807">return</span>&nbsp;<span class="builtintype" id="5437814">nil</span><span class="op" id="5437817">,</span>&nbsp;<span class="ident" id="5437819">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437833">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437836">var</span>&nbsp;<span class="ident" id="5437840">err</span>&nbsp;<span class="builtintype" id="5437844">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437851">fw</span><span class="op" id="5437853">.</span><span class="ident" id="5437854">comp</span><span class="op" id="5437858">,</span>&nbsp;<span class="ident" id="5437860">err</span>&nbsp;<span class="op" id="5437864">=</span>&nbsp;<span class="ident" id="5437866">comp</span><span class="op" id="5437870">(</span><span class="ident" id="5437871">fw</span><span class="op" id="5437873">.</span><span class="ident" id="5437874">compCount</span><span class="op" id="5437883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437886">if</span>&nbsp;<span class="ident" id="5437889">err</span>&nbsp;<span class="op" id="5437893">!=</span>&nbsp;<span class="builtintype" id="5437896">nil</span>&nbsp;<span class="op" id="5437900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437904">return</span>&nbsp;<span class="builtintype" id="5437911">nil</span><span class="op" id="5437914">,</span>&nbsp;<span class="ident" id="5437916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437921">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437924">fw</span><span class="op" id="5437926">.</span><span class="ident" id="5437927">rawCount</span>&nbsp;<span class="op" id="5437936">=</span>&nbsp;<span class="op" id="5437938">&amp;</span><span class="ident" id="5437939">countWriter</span><span class="op" id="5437950">{</span><span class="ident" id="5437951">w</span><span class="op" id="5437952">:</span>&nbsp;<span class="ident" id="5437954">fw</span><span class="op" id="5437956">.</span><span class="ident" id="5437957">comp</span><span class="op" id="5437961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437965">h</span>&nbsp;<span class="op" id="5437967">:=</span>&nbsp;<span class="op" id="5437970">&amp;</span><span class="ident" id="5437971">header</span><span class="op" id="5437977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437981">FileHeader</span><span class="op" id="5437991">:</span>&nbsp;<span class="ident" id="5437993">fh</span><span class="op" id="5437995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437999">offset</span><span class="op" id="5438005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5438011">uint64</span><span class="op" id="5438017">(</span><span class="ident" id="5438018">w</span><span class="op" id="5438019">.</span><span class="ident" id="5438020">cw</span><span class="op" id="5438022">.</span><span class="ident" id="5438023">count</span><span class="op" id="5438028">)</span><span class="op" id="5438029">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438035">w</span><span class="op" id="5438036">.</span><span class="ident" id="5438037">dir</span>&nbsp;<span class="op" id="5438041">=</span>&nbsp;<span class="builtinfunc" id="5438043">append</span><span class="op" id="5438049">(</span><span class="ident" id="5438050">w</span><span class="op" id="5438051">.</span><span class="ident" id="5438052">dir</span><span class="op" id="5438055">,</span>&nbsp;<span class="ident" id="5438057">h</span><span class="op" id="5438058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438061">fw</span><span class="op" id="5438063">.</span><span class="ident" id="5438064">header</span>&nbsp;<span class="op" id="5438071">=</span>&nbsp;<span class="ident" id="5438073">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438077">if</span>&nbsp;<span class="ident" id="5438080">err</span>&nbsp;<span class="op" id="5438084">:=</span>&nbsp;<span class="ident" id="5438087">writeHeader</span><span class="op" id="5438098">(</span><span class="ident" id="5438099">w</span><span class="op" id="5438100">.</span><span class="ident" id="5438101">cw</span><span class="op" id="5438103">,</span>&nbsp;<span class="ident" id="5438105">fh</span><span class="op" id="5438107">)</span><span class="op" id="5438108">;</span>&nbsp;<span class="ident" id="5438110">err</span>&nbsp;<span class="op" id="5438114">!=</span>&nbsp;<span class="builtintype" id="5438117">nil</span>&nbsp;<span class="op" id="5438121">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438125">return</span>&nbsp;<span class="builtintype" id="5438132">nil</span><span class="op" id="5438135">,</span>&nbsp;<span class="ident" id="5438137">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438146">w</span><span class="op" id="5438147">.</span><span class="ident" id="5438148">last</span>&nbsp;<span class="op" id="5438153">=</span>&nbsp;<span class="ident" id="5438155">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438159">return</span>&nbsp;<span class="ident" id="5438166">fw</span><span class="op" id="5438168">,</span>&nbsp;<span class="builtintype" id="5438170">nil</span><br>
<span class="lineno">230</span><span class="op" id="5438174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5438177">func</span>&nbsp;<span class="ident" id="5438182">writeHeader</span><span class="op" id="5438193">(</span><span class="ident" id="5438194">w</span>&nbsp;<span class="ident" id="5438196">io</span><span class="op" id="5438198">.</span><span class="ident" id="5438199">Writer</span><span class="op" id="5438205">,</span>&nbsp;<span class="ident" id="5438207">h</span>&nbsp;<span class="op" id="5438209">*</span><span class="ident" id="5438210">FileHeader</span><span class="op" id="5438220">)</span>&nbsp;<span class="builtintype" id="5438222">error</span>&nbsp;<span class="op" id="5438228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438231">var</span>&nbsp;<span class="ident" id="5438235">buf</span>&nbsp;<span class="op" id="5438239">[</span><span class="ident" id="5438240">fileHeaderLen</span><span class="op" id="5438253">]</span><span class="builtintype" id="5438254">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438260">b</span>&nbsp;<span class="op" id="5438262">:=</span>&nbsp;<span class="ident" id="5438265">writeBuf</span><span class="op" id="5438273">(</span><span class="ident" id="5438274">buf</span><span class="op" id="5438277">[</span><span class="op" id="5438278">:</span><span class="op" id="5438279">]</span><span class="op" id="5438280">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438283">b</span><span class="op" id="5438284">.</span><span class="builtintype" id="5438285">uint32</span><span class="op" id="5438291">(</span><span class="builtintype" id="5438292">uint32</span><span class="op" id="5438298">(</span><span class="ident" id="5438299">fileHeaderSignature</span><span class="op" id="5438318">)</span><span class="op" id="5438319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438322">b</span><span class="op" id="5438323">.</span><span class="builtintype" id="5438324">uint16</span><span class="op" id="5438330">(</span><span class="ident" id="5438331">h</span><span class="op" id="5438332">.</span><span class="ident" id="5438333">ReaderVersion</span><span class="op" id="5438346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438349">b</span><span class="op" id="5438350">.</span><span class="builtintype" id="5438351">uint16</span><span class="op" id="5438357">(</span><span class="ident" id="5438358">h</span><span class="op" id="5438359">.</span><span class="ident" id="5438360">Flags</span><span class="op" id="5438365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438368">b</span><span class="op" id="5438369">.</span><span class="builtintype" id="5438370">uint16</span><span class="op" id="5438376">(</span><span class="ident" id="5438377">h</span><span class="op" id="5438378">.</span><span class="ident" id="5438379">Method</span><span class="op" id="5438385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438388">b</span><span class="op" id="5438389">.</span><span class="builtintype" id="5438390">uint16</span><span class="op" id="5438396">(</span><span class="ident" id="5438397">h</span><span class="op" id="5438398">.</span><span class="ident" id="5438399">ModifiedTime</span><span class="op" id="5438411">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438414">b</span><span class="op" id="5438415">.</span><span class="builtintype" id="5438416">uint16</span><span class="op" id="5438422">(</span><span class="ident" id="5438423">h</span><span class="op" id="5438424">.</span><span class="ident" id="5438425">ModifiedDate</span><span class="op" id="5438437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438440">b</span><span class="op" id="5438441">.</span><span class="builtintype" id="5438442">uint32</span><span class="op" id="5438448">(</span><span class="num" id="5438449">0</span><span class="op" id="5438450">)</span>&nbsp;<span class="comment" id="5438452">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438502">b</span><span class="op" id="5438503">.</span><span class="builtintype" id="5438504">uint32</span><span class="op" id="5438510">(</span><span class="num" id="5438511">0</span><span class="op" id="5438512">)</span>&nbsp;<span class="comment" id="5438514">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438535">b</span><span class="op" id="5438536">.</span><span class="builtintype" id="5438537">uint32</span><span class="op" id="5438543">(</span><span class="num" id="5438544">0</span><span class="op" id="5438545">)</span>&nbsp;<span class="comment" id="5438547">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438588">b</span><span class="op" id="5438589">.</span><span class="builtintype" id="5438590">uint16</span><span class="op" id="5438596">(</span><span class="builtintype" id="5438597">uint16</span><span class="op" id="5438603">(</span><span class="builtinfunc" id="5438604">len</span><span class="op" id="5438607">(</span><span class="ident" id="5438608">h</span><span class="op" id="5438609">.</span><span class="ident" id="5438610">Name</span><span class="op" id="5438614">)</span><span class="op" id="5438615">)</span><span class="op" id="5438616">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438619">b</span><span class="op" id="5438620">.</span><span class="builtintype" id="5438621">uint16</span><span class="op" id="5438627">(</span><span class="builtintype" id="5438628">uint16</span><span class="op" id="5438634">(</span><span class="builtinfunc" id="5438635">len</span><span class="op" id="5438638">(</span><span class="ident" id="5438639">h</span><span class="op" id="5438640">.</span><span class="ident" id="5438641">Extra</span><span class="op" id="5438646">)</span><span class="op" id="5438647">)</span><span class="op" id="5438648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438651">if</span>&nbsp;<span class="ident" id="5438654">_</span><span class="op" id="5438655">,</span>&nbsp;<span class="ident" id="5438657">err</span>&nbsp;<span class="op" id="5438661">:=</span>&nbsp;<span class="ident" id="5438664">w</span><span class="op" id="5438665">.</span><span class="ident" id="5438666">Write</span><span class="op" id="5438671">(</span><span class="ident" id="5438672">buf</span><span class="op" id="5438675">[</span><span class="op" id="5438676">:</span><span class="op" id="5438677">]</span><span class="op" id="5438678">)</span><span class="op" id="5438679">;</span>&nbsp;<span class="ident" id="5438681">err</span>&nbsp;<span class="op" id="5438685">!=</span>&nbsp;<span class="builtintype" id="5438688">nil</span>&nbsp;<span class="op" id="5438692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438696">return</span>&nbsp;<span class="ident" id="5438703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438711">if</span>&nbsp;<span class="ident" id="5438714">_</span><span class="op" id="5438715">,</span>&nbsp;<span class="ident" id="5438717">err</span>&nbsp;<span class="op" id="5438721">:=</span>&nbsp;<span class="ident" id="5438724">io</span><span class="op" id="5438726">.</span><span class="ident" id="5438727">WriteString</span><span class="op" id="5438738">(</span><span class="ident" id="5438739">w</span><span class="op" id="5438740">,</span>&nbsp;<span class="ident" id="5438742">h</span><span class="op" id="5438743">.</span><span class="ident" id="5438744">Name</span><span class="op" id="5438748">)</span><span class="op" id="5438749">;</span>&nbsp;<span class="ident" id="5438751">err</span>&nbsp;<span class="op" id="5438755">!=</span>&nbsp;<span class="builtintype" id="5438758">nil</span>&nbsp;<span class="op" id="5438762">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438766">return</span>&nbsp;<span class="ident" id="5438773">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438781">_</span><span class="op" id="5438782">,</span>&nbsp;<span class="ident" id="5438784">err</span>&nbsp;<span class="op" id="5438788">:=</span>&nbsp;<span class="ident" id="5438791">w</span><span class="op" id="5438792">.</span><span class="ident" id="5438793">Write</span><span class="op" id="5438798">(</span><span class="ident" id="5438799">h</span><span class="op" id="5438800">.</span><span class="ident" id="5438801">Extra</span><span class="op" id="5438806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438809">return</span>&nbsp;<span class="ident" id="5438816">err</span><br>
<span class="lineno"></span><span class="op" id="5438820">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5438823">type</span>&nbsp;<span class="ident" id="5438828">fileWriter</span>&nbsp;<span class="keyword" id="5438839">struct</span>&nbsp;<span class="op" id="5438846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438849">*</span><span class="ident" id="5438850">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438858">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438868">io</span><span class="op" id="5438870">.</span><span class="ident" id="5438871">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438879">rawCount</span>&nbsp;&nbsp;<span class="op" id="5438889">*</span><span class="ident" id="5438890">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438903">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438913">io</span><span class="op" id="5438915">.</span><span class="ident" id="5438916">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438929">compCount</span>&nbsp;<span class="op" id="5438939">*</span><span class="ident" id="5438940">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438953">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438963">hash</span><span class="op" id="5438967">.</span><span class="ident" id="5438968">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438976">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5438986">bool</span><br>
<span class="lineno"></span><span class="op" id="5438991">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5438994">func</span>&nbsp;<span class="op" id="5438999">(</span><span class="ident" id="5439000">w</span>&nbsp;<span class="op" id="5439002">*</span><span class="ident" id="5439003">fileWriter</span><span class="op" id="5439013">)</span>&nbsp;<span class="ident" id="5439015">Write</span><span class="op" id="5439020">(</span><span class="ident" id="5439021">p</span>&nbsp;<span class="op" id="5439023">[</span><span class="op" id="5439024">]</span><span class="builtintype" id="5439025">byte</span><span class="op" id="5439029">)</span>&nbsp;<span class="op" id="5439031">(</span><span class="builtintype" id="5439032">int</span><span class="op" id="5439035">,</span>&nbsp;<span class="builtintype" id="5439037">error</span><span class="op" id="5439042">)</span>&nbsp;<span class="op" id="5439044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439047">if</span>&nbsp;<span class="ident" id="5439050">w</span><span class="op" id="5439051">.</span><span class="ident" id="5439052">closed</span>&nbsp;<span class="op" id="5439059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439063">return</span>&nbsp;<span class="num" id="5439070">0</span><span class="op" id="5439071">,</span>&nbsp;<span class="ident" id="5439073">errors</span><span class="op" id="5439079">.</span><span class="ident" id="5439080">New</span><span class="op" id="5439083">(</span><span class="string" id="5439084">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5439111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439114">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439117">w</span><span class="op" id="5439118">.</span><span class="ident" id="5439119">crc32</span><span class="op" id="5439124">.</span><span class="ident" id="5439125">Write</span><span class="op" id="5439130">(</span><span class="ident" id="5439131">p</span><span class="op" id="5439132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439135">return</span>&nbsp;<span class="ident" id="5439142">w</span><span class="op" id="5439143">.</span><span class="ident" id="5439144">rawCount</span><span class="op" id="5439152">.</span><span class="ident" id="5439153">Write</span><span class="op" id="5439158">(</span><span class="ident" id="5439159">p</span><span class="op" id="5439160">)</span><br>
<span class="lineno"></span><span class="op" id="5439162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5439165">func</span>&nbsp;<span class="op" id="5439170">(</span><span class="ident" id="5439171">w</span>&nbsp;<span class="op" id="5439173">*</span><span class="ident" id="5439174">fileWriter</span><span class="op" id="5439184">)</span>&nbsp;<span class="builtinfunc" id="5439186">close</span><span class="op" id="5439191">(</span><span class="op" id="5439192">)</span>&nbsp;<span class="builtintype" id="5439194">error</span>&nbsp;<span class="op" id="5439200">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439203">if</span>&nbsp;<span class="ident" id="5439206">w</span><span class="op" id="5439207">.</span><span class="ident" id="5439208">closed</span>&nbsp;<span class="op" id="5439215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439219">return</span>&nbsp;<span class="ident" id="5439226">errors</span><span class="op" id="5439232">.</span><span class="ident" id="5439233">New</span><span class="op" id="5439236">(</span><span class="string" id="5439237">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5439261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439267">w</span><span class="op" id="5439268">.</span><span class="ident" id="5439269">closed</span>&nbsp;<span class="op" id="5439276">=</span>&nbsp;<span class="builtintype" id="5439278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439284">if</span>&nbsp;<span class="ident" id="5439287">err</span>&nbsp;<span class="op" id="5439291">:=</span>&nbsp;<span class="ident" id="5439294">w</span><span class="op" id="5439295">.</span><span class="ident" id="5439296">comp</span><span class="op" id="5439300">.</span><span class="ident" id="5439301">Close</span><span class="op" id="5439306">(</span><span class="op" id="5439307">)</span><span class="op" id="5439308">;</span>&nbsp;<span class="ident" id="5439310">err</span>&nbsp;<span class="op" id="5439314">!=</span>&nbsp;<span class="builtintype" id="5439317">nil</span>&nbsp;<span class="op" id="5439321">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439325">return</span>&nbsp;<span class="ident" id="5439332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439341">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439363">fh</span>&nbsp;<span class="op" id="5439366">:=</span>&nbsp;<span class="ident" id="5439369">w</span><span class="op" id="5439370">.</span><span class="ident" id="5439371">header</span><span class="op" id="5439377">.</span><span class="ident" id="5439378">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439390">fh</span><span class="op" id="5439392">.</span><span class="ident" id="5439393">CRC32</span>&nbsp;<span class="op" id="5439399">=</span>&nbsp;<span class="ident" id="5439401">w</span><span class="op" id="5439402">.</span><span class="ident" id="5439403">crc32</span><span class="op" id="5439408">.</span><span class="ident" id="5439409">Sum32</span><span class="op" id="5439414">(</span><span class="op" id="5439415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439418">fh</span><span class="op" id="5439420">.</span><span class="ident" id="5439421">CompressedSize64</span>&nbsp;<span class="op" id="5439438">=</span>&nbsp;<span class="builtintype" id="5439440">uint64</span><span class="op" id="5439446">(</span><span class="ident" id="5439447">w</span><span class="op" id="5439448">.</span><span class="ident" id="5439449">compCount</span><span class="op" id="5439458">.</span><span class="ident" id="5439459">count</span><span class="op" id="5439464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439467">fh</span><span class="op" id="5439469">.</span><span class="ident" id="5439470">UncompressedSize64</span>&nbsp;<span class="op" id="5439489">=</span>&nbsp;<span class="builtintype" id="5439491">uint64</span><span class="op" id="5439497">(</span><span class="ident" id="5439498">w</span><span class="op" id="5439499">.</span><span class="ident" id="5439500">rawCount</span><span class="op" id="5439508">.</span><span class="ident" id="5439509">count</span><span class="op" id="5439514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439518">if</span>&nbsp;<span class="ident" id="5439521">fh</span><span class="op" id="5439523">.</span><span class="ident" id="5439524">isZip64</span><span class="op" id="5439531">(</span><span class="op" id="5439532">)</span>&nbsp;<span class="op" id="5439534">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439538">fh</span><span class="op" id="5439540">.</span><span class="ident" id="5439541">CompressedSize</span>&nbsp;<span class="op" id="5439556">=</span>&nbsp;<span class="ident" id="5439558">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439570">fh</span><span class="op" id="5439572">.</span><span class="ident" id="5439573">UncompressedSize</span>&nbsp;<span class="op" id="5439590">=</span>&nbsp;<span class="ident" id="5439592">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439604">fh</span><span class="op" id="5439606">.</span><span class="ident" id="5439607">ReaderVersion</span>&nbsp;<span class="op" id="5439621">=</span>&nbsp;<span class="ident" id="5439623">zipVersion45</span>&nbsp;<span class="comment" id="5439636">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439689">}</span>&nbsp;<span class="keyword" id="5439691">else</span>&nbsp;<span class="op" id="5439696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439700">fh</span><span class="op" id="5439702">.</span><span class="ident" id="5439703">CompressedSize</span>&nbsp;<span class="op" id="5439718">=</span>&nbsp;<span class="builtintype" id="5439720">uint32</span><span class="op" id="5439726">(</span><span class="ident" id="5439727">fh</span><span class="op" id="5439729">.</span><span class="ident" id="5439730">CompressedSize64</span><span class="op" id="5439746">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439750">fh</span><span class="op" id="5439752">.</span><span class="ident" id="5439753">UncompressedSize</span>&nbsp;<span class="op" id="5439770">=</span>&nbsp;<span class="builtintype" id="5439772">uint32</span><span class="op" id="5439778">(</span><span class="ident" id="5439779">fh</span><span class="op" id="5439781">.</span><span class="ident" id="5439782">UncompressedSize64</span><span class="op" id="5439800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439807">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439874">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439934">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439998">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440063">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440127">var</span>&nbsp;<span class="ident" id="5440131">buf</span>&nbsp;<span class="op" id="5440135">[</span><span class="op" id="5440136">]</span><span class="builtintype" id="5440137">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440143">if</span>&nbsp;<span class="ident" id="5440146">fh</span><span class="op" id="5440148">.</span><span class="ident" id="5440149">isZip64</span><span class="op" id="5440156">(</span><span class="op" id="5440157">)</span>&nbsp;<span class="op" id="5440159">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440163">buf</span>&nbsp;<span class="op" id="5440167">=</span>&nbsp;<span class="builtinfunc" id="5440169">make</span><span class="op" id="5440173">(</span><span class="op" id="5440174">[</span><span class="op" id="5440175">]</span><span class="builtintype" id="5440176">byte</span><span class="op" id="5440180">,</span>&nbsp;<span class="ident" id="5440182">dataDescriptor64Len</span><span class="op" id="5440201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440204">}</span>&nbsp;<span class="keyword" id="5440206">else</span>&nbsp;<span class="op" id="5440211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440215">buf</span>&nbsp;<span class="op" id="5440219">=</span>&nbsp;<span class="builtinfunc" id="5440221">make</span><span class="op" id="5440225">(</span><span class="op" id="5440226">[</span><span class="op" id="5440227">]</span><span class="builtintype" id="5440228">byte</span><span class="op" id="5440232">,</span>&nbsp;<span class="ident" id="5440234">dataDescriptorLen</span><span class="op" id="5440251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440257">b</span>&nbsp;<span class="op" id="5440259">:=</span>&nbsp;<span class="ident" id="5440262">writeBuf</span><span class="op" id="5440270">(</span><span class="ident" id="5440271">buf</span><span class="op" id="5440274">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440277">b</span><span class="op" id="5440278">.</span><span class="builtintype" id="5440279">uint32</span><span class="op" id="5440285">(</span><span class="ident" id="5440286">dataDescriptorSignature</span><span class="op" id="5440309">)</span>&nbsp;<span class="comment" id="5440311">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440351">b</span><span class="op" id="5440352">.</span><span class="builtintype" id="5440353">uint32</span><span class="op" id="5440359">(</span><span class="ident" id="5440360">fh</span><span class="op" id="5440362">.</span><span class="ident" id="5440363">CRC32</span><span class="op" id="5440368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440371">if</span>&nbsp;<span class="ident" id="5440374">fh</span><span class="op" id="5440376">.</span><span class="ident" id="5440377">isZip64</span><span class="op" id="5440384">(</span><span class="op" id="5440385">)</span>&nbsp;<span class="op" id="5440387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440391">b</span><span class="op" id="5440392">.</span><span class="builtintype" id="5440393">uint64</span><span class="op" id="5440399">(</span><span class="ident" id="5440400">fh</span><span class="op" id="5440402">.</span><span class="ident" id="5440403">CompressedSize64</span><span class="op" id="5440419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440423">b</span><span class="op" id="5440424">.</span><span class="builtintype" id="5440425">uint64</span><span class="op" id="5440431">(</span><span class="ident" id="5440432">fh</span><span class="op" id="5440434">.</span><span class="ident" id="5440435">UncompressedSize64</span><span class="op" id="5440453">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440456">}</span>&nbsp;<span class="keyword" id="5440458">else</span>&nbsp;<span class="op" id="5440463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440467">b</span><span class="op" id="5440468">.</span><span class="builtintype" id="5440469">uint32</span><span class="op" id="5440475">(</span><span class="ident" id="5440476">fh</span><span class="op" id="5440478">.</span><span class="ident" id="5440479">CompressedSize</span><span class="op" id="5440493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440497">b</span><span class="op" id="5440498">.</span><span class="builtintype" id="5440499">uint32</span><span class="op" id="5440505">(</span><span class="ident" id="5440506">fh</span><span class="op" id="5440508">.</span><span class="ident" id="5440509">UncompressedSize</span><span class="op" id="5440525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440531">_</span><span class="op" id="5440532">,</span>&nbsp;<span class="ident" id="5440534">err</span>&nbsp;<span class="op" id="5440538">:=</span>&nbsp;<span class="ident" id="5440541">w</span><span class="op" id="5440542">.</span><span class="ident" id="5440543">zipw</span><span class="op" id="5440547">.</span><span class="ident" id="5440548">Write</span><span class="op" id="5440553">(</span><span class="ident" id="5440554">buf</span><span class="op" id="5440557">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440560">return</span>&nbsp;<span class="ident" id="5440567">err</span><br>
<span class="lineno"></span><span class="op" id="5440571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440574">type</span>&nbsp;<span class="ident" id="5440579">countWriter</span>&nbsp;<span class="keyword" id="5440591">struct</span>&nbsp;<span class="op" id="5440598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440601">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440607">io</span><span class="op" id="5440609">.</span><span class="ident" id="5440610">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440618">count</span>&nbsp;<span class="builtintype" id="5440624">int64</span><br>
<span class="lineno"></span><span class="op" id="5440630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440633">func</span>&nbsp;<span class="op" id="5440638">(</span><span class="ident" id="5440639">w</span>&nbsp;<span class="op" id="5440641">*</span><span class="ident" id="5440642">countWriter</span><span class="op" id="5440653">)</span>&nbsp;<span class="ident" id="5440655">Write</span><span class="op" id="5440660">(</span><span class="ident" id="5440661">p</span>&nbsp;<span class="op" id="5440663">[</span><span class="op" id="5440664">]</span><span class="builtintype" id="5440665">byte</span><span class="op" id="5440669">)</span>&nbsp;<span class="op" id="5440671">(</span><span class="builtintype" id="5440672">int</span><span class="op" id="5440675">,</span>&nbsp;<span class="builtintype" id="5440677">error</span><span class="op" id="5440682">)</span>&nbsp;<span class="op" id="5440684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440687">n</span><span class="op" id="5440688">,</span>&nbsp;<span class="ident" id="5440690">err</span>&nbsp;<span class="op" id="5440694">:=</span>&nbsp;<span class="ident" id="5440697">w</span><span class="op" id="5440698">.</span><span class="ident" id="5440699">w</span><span class="op" id="5440700">.</span><span class="ident" id="5440701">Write</span><span class="op" id="5440706">(</span><span class="ident" id="5440707">p</span><span class="op" id="5440708">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440711">w</span><span class="op" id="5440712">.</span><span class="ident" id="5440713">count</span>&nbsp;<span class="op" id="5440719">+=</span>&nbsp;<span class="builtintype" id="5440722">int64</span><span class="op" id="5440727">(</span><span class="ident" id="5440728">n</span><span class="op" id="5440729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440732">return</span>&nbsp;<span class="ident" id="5440739">n</span><span class="op" id="5440740">,</span>&nbsp;<span class="ident" id="5440742">err</span><br>
<span class="lineno"></span><span class="op" id="5440746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440749">type</span>&nbsp;<span class="ident" id="5440754">nopCloser</span>&nbsp;<span class="keyword" id="5440764">struct</span>&nbsp;<span class="op" id="5440771">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440774">io</span><span class="op" id="5440776">.</span><span class="ident" id="5440777">Writer</span><br>
<span class="lineno"></span><span class="op" id="5440784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440787">func</span>&nbsp;<span class="op" id="5440792">(</span><span class="ident" id="5440793">w</span>&nbsp;<span class="ident" id="5440795">nopCloser</span><span class="op" id="5440804">)</span>&nbsp;<span class="ident" id="5440806">Close</span><span class="op" id="5440811">(</span><span class="op" id="5440812">)</span>&nbsp;<span class="builtintype" id="5440814">error</span>&nbsp;<span class="op" id="5440820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440823">return</span>&nbsp;<span class="builtintype" id="5440830">nil</span><br>
<span class="lineno">340</span><span class="op" id="5440834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440837">type</span>&nbsp;<span class="ident" id="5440842">writeBuf</span>&nbsp;<span class="op" id="5440851">[</span><span class="op" id="5440852">]</span><span class="builtintype" id="5440853">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440859">func</span>&nbsp;<span class="op" id="5440864">(</span><span class="ident" id="5440865">b</span>&nbsp;<span class="op" id="5440867">*</span><span class="ident" id="5440868">writeBuf</span><span class="op" id="5440876">)</span>&nbsp;<span class="builtintype" id="5440878">uint16</span><span class="op" id="5440884">(</span><span class="ident" id="5440885">v</span>&nbsp;<span class="builtintype" id="5440887">uint16</span><span class="op" id="5440893">)</span>&nbsp;<span class="op" id="5440895">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440898">binary</span><span class="op" id="5440904">.</span><span class="ident" id="5440905">LittleEndian</span><span class="op" id="5440917">.</span><span class="ident" id="5440918">PutUint16</span><span class="op" id="5440927">(</span><span class="op" id="5440928">*</span><span class="ident" id="5440929">b</span><span class="op" id="5440930">,</span>&nbsp;<span class="ident" id="5440932">v</span><span class="op" id="5440933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440936">*</span><span class="ident" id="5440937">b</span>&nbsp;<span class="op" id="5440939">=</span>&nbsp;<span class="op" id="5440941">(</span><span class="op" id="5440942">*</span><span class="ident" id="5440943">b</span><span class="op" id="5440944">)</span><span class="op" id="5440945">[</span><span class="num" id="5440946">2</span><span class="op" id="5440947">:</span><span class="op" id="5440948">]</span><br>
<span class="lineno"></span><span class="op" id="5440950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440953">func</span>&nbsp;<span class="op" id="5440958">(</span><span class="ident" id="5440959">b</span>&nbsp;<span class="op" id="5440961">*</span><span class="ident" id="5440962">writeBuf</span><span class="op" id="5440970">)</span>&nbsp;<span class="builtintype" id="5440972">uint32</span><span class="op" id="5440978">(</span><span class="ident" id="5440979">v</span>&nbsp;<span class="builtintype" id="5440981">uint32</span><span class="op" id="5440987">)</span>&nbsp;<span class="op" id="5440989">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440992">binary</span><span class="op" id="5440998">.</span><span class="ident" id="5440999">LittleEndian</span><span class="op" id="5441011">.</span><span class="ident" id="5441012">PutUint32</span><span class="op" id="5441021">(</span><span class="op" id="5441022">*</span><span class="ident" id="5441023">b</span><span class="op" id="5441024">,</span>&nbsp;<span class="ident" id="5441026">v</span><span class="op" id="5441027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441030">*</span><span class="ident" id="5441031">b</span>&nbsp;<span class="op" id="5441033">=</span>&nbsp;<span class="op" id="5441035">(</span><span class="op" id="5441036">*</span><span class="ident" id="5441037">b</span><span class="op" id="5441038">)</span><span class="op" id="5441039">[</span><span class="num" id="5441040">4</span><span class="op" id="5441041">:</span><span class="op" id="5441042">]</span><br>
<span class="lineno"></span><span class="op" id="5441044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5441047">func</span>&nbsp;<span class="op" id="5441052">(</span><span class="ident" id="5441053">b</span>&nbsp;<span class="op" id="5441055">*</span><span class="ident" id="5441056">writeBuf</span><span class="op" id="5441064">)</span>&nbsp;<span class="builtintype" id="5441066">uint64</span><span class="op" id="5441072">(</span><span class="ident" id="5441073">v</span>&nbsp;<span class="builtintype" id="5441075">uint64</span><span class="op" id="5441081">)</span>&nbsp;<span class="op" id="5441083">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441086">binary</span><span class="op" id="5441092">.</span><span class="ident" id="5441093">LittleEndian</span><span class="op" id="5441105">.</span><span class="ident" id="5441106">PutUint64</span><span class="op" id="5441115">(</span><span class="op" id="5441116">*</span><span class="ident" id="5441117">b</span><span class="op" id="5441118">,</span>&nbsp;<span class="ident" id="5441120">v</span><span class="op" id="5441121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441124">*</span><span class="ident" id="5441125">b</span>&nbsp;<span class="op" id="5441127">=</span>&nbsp;<span class="op" id="5441129">(</span><span class="op" id="5441130">*</span><span class="ident" id="5441131">b</span><span class="op" id="5441132">)</span><span class="op" id="5441133">[</span><span class="num" id="5441134">8</span><span class="op" id="5441135">:</span><span class="op" id="5441136">]</span><br>
<span class="lineno"></span><span class="op" id="5441138">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
