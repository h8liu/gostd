<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3835956">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3836011">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3836065">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3836116">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3836189">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3836204">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3836276">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3836350">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3836399">package</span>&nbsp;<span class="ident" id="3836407">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836418">import</span>&nbsp;<span class="op" id="3836425">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836428">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836437">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836446">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3836453">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3836458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3836461">type</span>&nbsp;<span class="ident" id="3836466">qpReader</span>&nbsp;<span class="keyword" id="3836475">struct</span>&nbsp;<span class="op" id="3836482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3836485">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3836490">*</span><span class="ident" id="3836491">bufio</span><span class="op" id="3836496">.</span><span class="ident" id="3836497">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3836505">rerr</span>&nbsp;<span class="builtintype" id="3836510">error</span>&nbsp;&nbsp;<span class="comment" id="3836517">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3836537">line</span>&nbsp;<span class="op" id="3836542">[</span><span class="op" id="3836543">]</span><span class="builtintype" id="3836544">byte</span>&nbsp;<span class="comment" id="3836549">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3836585">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3836588">func</span>&nbsp;<span class="ident" id="3836593">newQuotedPrintableReader</span><span class="op" id="3836617">(</span><span class="ident" id="3836618">r</span>&nbsp;<span class="ident" id="3836620">io</span><span class="op" id="3836622">.</span><span class="ident" id="3836623">Reader</span><span class="op" id="3836629">)</span>&nbsp;<span class="ident" id="3836631">io</span><span class="op" id="3836633">.</span><span class="ident" id="3836634">Reader</span>&nbsp;<span class="op" id="3836641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836644">return</span>&nbsp;<span class="op" id="3836651">&amp;</span><span class="ident" id="3836652">qpReader</span><span class="op" id="3836660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3836664">br</span><span class="op" id="3836666">:</span>&nbsp;<span class="ident" id="3836668">bufio</span><span class="op" id="3836673">.</span><span class="ident" id="3836674">NewReader</span><span class="op" id="3836683">(</span><span class="ident" id="3836684">r</span><span class="op" id="3836685">)</span><span class="op" id="3836686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3836689">}</span><br>
<span class="lineno">30</span><span class="op" id="3836691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836694">func</span>&nbsp;<span class="ident" id="3836699">fromHex</span><span class="op" id="3836706">(</span><span class="ident" id="3836707">b</span>&nbsp;<span class="builtintype" id="3836709">byte</span><span class="op" id="3836713">)</span>&nbsp;<span class="op" id="3836715">(</span><span class="builtintype" id="3836716">byte</span><span class="op" id="3836720">,</span>&nbsp;<span class="builtintype" id="3836722">error</span><span class="op" id="3836727">)</span>&nbsp;<span class="op" id="3836729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836732">switch</span>&nbsp;<span class="op" id="3836739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836742">case</span>&nbsp;<span class="ident" id="3836747">b</span>&nbsp;<span class="op" id="3836749">&gt;=</span>&nbsp;<span class="string" id="3836752">&#39;0&#39;</span>&nbsp;<span class="op" id="3836756">&amp;&amp;</span>&nbsp;<span class="ident" id="3836759">b</span>&nbsp;<span class="op" id="3836761">&lt;=</span>&nbsp;<span class="string" id="3836764">&#39;9&#39;</span><span class="op" id="3836767">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836771">return</span>&nbsp;<span class="ident" id="3836778">b</span>&nbsp;<span class="op" id="3836780">-</span>&nbsp;<span class="string" id="3836782">&#39;0&#39;</span><span class="op" id="3836785">,</span>&nbsp;<span class="ident" id="3836787">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836792">case</span>&nbsp;<span class="ident" id="3836797">b</span>&nbsp;<span class="op" id="3836799">&gt;=</span>&nbsp;<span class="string" id="3836802">&#39;A&#39;</span>&nbsp;<span class="op" id="3836806">&amp;&amp;</span>&nbsp;<span class="ident" id="3836809">b</span>&nbsp;<span class="op" id="3836811">&lt;=</span>&nbsp;<span class="string" id="3836814">&#39;F&#39;</span><span class="op" id="3836817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836821">return</span>&nbsp;<span class="ident" id="3836828">b</span>&nbsp;<span class="op" id="3836830">-</span>&nbsp;<span class="string" id="3836832">&#39;A&#39;</span>&nbsp;<span class="op" id="3836836">+</span>&nbsp;<span class="num" id="3836838">10</span><span class="op" id="3836840">,</span>&nbsp;<span class="ident" id="3836842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3836847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836850">return</span>&nbsp;<span class="num" id="3836857">0</span><span class="op" id="3836858">,</span>&nbsp;<span class="ident" id="3836860">fmt</span><span class="op" id="3836863">.</span><span class="ident" id="3836864">Errorf</span><span class="op" id="3836870">(</span><span class="string" id="3836871">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3836924">,</span>&nbsp;<span class="ident" id="3836926">b</span><span class="op" id="3836927">)</span><br>
<span class="lineno">40</span><span class="op" id="3836929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836932">func</span>&nbsp;<span class="op" id="3836937">(</span><span class="ident" id="3836938">q</span>&nbsp;<span class="op" id="3836940">*</span><span class="ident" id="3836941">qpReader</span><span class="op" id="3836949">)</span>&nbsp;<span class="ident" id="3836951">readHexByte</span><span class="op" id="3836962">(</span><span class="ident" id="3836963">v</span>&nbsp;<span class="op" id="3836965">[</span><span class="op" id="3836966">]</span><span class="builtintype" id="3836967">byte</span><span class="op" id="3836971">)</span>&nbsp;<span class="op" id="3836973">(</span><span class="ident" id="3836974">b</span>&nbsp;<span class="builtintype" id="3836976">byte</span><span class="op" id="3836980">,</span>&nbsp;<span class="ident" id="3836982">err</span>&nbsp;<span class="builtintype" id="3836986">error</span><span class="op" id="3836991">)</span>&nbsp;<span class="op" id="3836993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3836996">if</span>&nbsp;<span class="builtinfunc" id="3836999">len</span><span class="op" id="3837002">(</span><span class="ident" id="3837003">v</span><span class="op" id="3837004">)</span>&nbsp;<span class="op" id="3837006">&lt;</span>&nbsp;<span class="num" id="3837008">2</span>&nbsp;<span class="op" id="3837010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837014">return</span>&nbsp;<span class="num" id="3837021">0</span><span class="op" id="3837022">,</span>&nbsp;<span class="ident" id="3837024">io</span><span class="op" id="3837026">.</span><span class="ident" id="3837027">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837048">var</span>&nbsp;<span class="ident" id="3837052">hb</span><span class="op" id="3837054">,</span>&nbsp;<span class="ident" id="3837056">lb</span>&nbsp;<span class="builtintype" id="3837059">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837065">if</span>&nbsp;<span class="ident" id="3837068">hb</span><span class="op" id="3837070">,</span>&nbsp;<span class="ident" id="3837072">err</span>&nbsp;<span class="op" id="3837076">=</span>&nbsp;<span class="ident" id="3837078">fromHex</span><span class="op" id="3837085">(</span><span class="ident" id="3837086">v</span><span class="op" id="3837087">[</span><span class="num" id="3837088">0</span><span class="op" id="3837089">]</span><span class="op" id="3837090">)</span><span class="op" id="3837091">;</span>&nbsp;<span class="ident" id="3837093">err</span>&nbsp;<span class="op" id="3837097">!=</span>&nbsp;<span class="ident" id="3837100">nil</span>&nbsp;<span class="op" id="3837104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837108">return</span>&nbsp;<span class="num" id="3837115">0</span><span class="op" id="3837116">,</span>&nbsp;<span class="ident" id="3837118">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837123">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837126">if</span>&nbsp;<span class="ident" id="3837129">lb</span><span class="op" id="3837131">,</span>&nbsp;<span class="ident" id="3837133">err</span>&nbsp;<span class="op" id="3837137">=</span>&nbsp;<span class="ident" id="3837139">fromHex</span><span class="op" id="3837146">(</span><span class="ident" id="3837147">v</span><span class="op" id="3837148">[</span><span class="num" id="3837149">1</span><span class="op" id="3837150">]</span><span class="op" id="3837151">)</span><span class="op" id="3837152">;</span>&nbsp;<span class="ident" id="3837154">err</span>&nbsp;<span class="op" id="3837158">!=</span>&nbsp;<span class="ident" id="3837161">nil</span>&nbsp;<span class="op" id="3837165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837169">return</span>&nbsp;<span class="num" id="3837176">0</span><span class="op" id="3837177">,</span>&nbsp;<span class="ident" id="3837179">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837187">return</span>&nbsp;<span class="ident" id="3837194">hb</span><span class="op" id="3837196">&lt;&lt;</span><span class="num" id="3837198">4</span>&nbsp;<span class="op" id="3837200">|</span>&nbsp;<span class="ident" id="3837202">lb</span><span class="op" id="3837204">,</span>&nbsp;<span class="ident" id="3837206">nil</span><br>
<span class="lineno"></span><span class="op" id="3837210">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3837213">func</span>&nbsp;<span class="ident" id="3837218">isQPDiscardWhitespace</span><span class="op" id="3837239">(</span><span class="ident" id="3837240">r</span>&nbsp;<span class="builtintype" id="3837242">rune</span><span class="op" id="3837246">)</span>&nbsp;<span class="builtintype" id="3837248">bool</span>&nbsp;<span class="op" id="3837253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837256">switch</span>&nbsp;<span class="ident" id="3837263">r</span>&nbsp;<span class="op" id="3837265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837268">case</span>&nbsp;<span class="string" id="3837273">&#39;\n&#39;</span><span class="op" id="3837277">,</span>&nbsp;<span class="string" id="3837279">&#39;\r&#39;</span><span class="op" id="3837283">,</span>&nbsp;<span class="string" id="3837285">&#39;&nbsp;&#39;</span><span class="op" id="3837288">,</span>&nbsp;<span class="string" id="3837290">&#39;\t&#39;</span><span class="op" id="3837294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837298">return</span>&nbsp;<span class="builtintype" id="3837305">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837314">return</span>&nbsp;<span class="builtintype" id="3837321">false</span><br>
<span class="lineno"></span><span class="op" id="3837327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3837330">var</span>&nbsp;<span class="op" id="3837334">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837337">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837348">=</span>&nbsp;<span class="op" id="3837350">[</span><span class="op" id="3837351">]</span><span class="builtintype" id="3837352">byte</span><span class="op" id="3837356">(</span><span class="string" id="3837357">&#34;\r\n&#34;</span><span class="op" id="3837363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837366">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837377">=</span>&nbsp;<span class="op" id="3837379">[</span><span class="op" id="3837380">]</span><span class="builtintype" id="3837381">byte</span><span class="op" id="3837385">(</span><span class="string" id="3837386">&#34;\n&#34;</span><span class="op" id="3837390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837393">softSuffix</span>&nbsp;<span class="op" id="3837404">=</span>&nbsp;<span class="op" id="3837406">[</span><span class="op" id="3837407">]</span><span class="builtintype" id="3837408">byte</span><span class="op" id="3837412">(</span><span class="string" id="3837413">&#34;=&#34;</span><span class="op" id="3837416">)</span><br>
<span class="lineno"></span><span class="op" id="3837418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3837421">func</span>&nbsp;<span class="op" id="3837426">(</span><span class="ident" id="3837427">q</span>&nbsp;<span class="op" id="3837429">*</span><span class="ident" id="3837430">qpReader</span><span class="op" id="3837438">)</span>&nbsp;<span class="ident" id="3837440">Read</span><span class="op" id="3837444">(</span><span class="ident" id="3837445">p</span>&nbsp;<span class="op" id="3837447">[</span><span class="op" id="3837448">]</span><span class="builtintype" id="3837449">byte</span><span class="op" id="3837453">)</span>&nbsp;<span class="op" id="3837455">(</span><span class="ident" id="3837456">n</span>&nbsp;<span class="builtintype" id="3837458">int</span><span class="op" id="3837461">,</span>&nbsp;<span class="ident" id="3837463">err</span>&nbsp;<span class="builtintype" id="3837467">error</span><span class="op" id="3837472">)</span>&nbsp;<span class="op" id="3837474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837477">for</span>&nbsp;<span class="builtinfunc" id="3837481">len</span><span class="op" id="3837484">(</span><span class="ident" id="3837485">p</span><span class="op" id="3837486">)</span>&nbsp;<span class="op" id="3837488">&gt;</span>&nbsp;<span class="num" id="3837490">0</span>&nbsp;<span class="op" id="3837492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837496">if</span>&nbsp;<span class="builtinfunc" id="3837499">len</span><span class="op" id="3837502">(</span><span class="ident" id="3837503">q</span><span class="op" id="3837504">.</span><span class="ident" id="3837505">line</span><span class="op" id="3837509">)</span>&nbsp;<span class="op" id="3837511">==</span>&nbsp;<span class="num" id="3837514">0</span>&nbsp;<span class="op" id="3837516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837521">if</span>&nbsp;<span class="ident" id="3837524">q</span><span class="op" id="3837525">.</span><span class="ident" id="3837526">rerr</span>&nbsp;<span class="op" id="3837531">!=</span>&nbsp;<span class="ident" id="3837534">nil</span>&nbsp;<span class="op" id="3837538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837544">return</span>&nbsp;<span class="ident" id="3837551">n</span><span class="op" id="3837552">,</span>&nbsp;<span class="ident" id="3837554">q</span><span class="op" id="3837555">.</span><span class="ident" id="3837556">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3837564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837569">q</span><span class="op" id="3837570">.</span><span class="ident" id="3837571">line</span><span class="op" id="3837575">,</span>&nbsp;<span class="ident" id="3837577">q</span><span class="op" id="3837578">.</span><span class="ident" id="3837579">rerr</span>&nbsp;<span class="op" id="3837584">=</span>&nbsp;<span class="ident" id="3837586">q</span><span class="op" id="3837587">.</span><span class="ident" id="3837588">br</span><span class="op" id="3837590">.</span><span class="ident" id="3837591">ReadSlice</span><span class="op" id="3837600">(</span><span class="string" id="3837601">&#39;\n&#39;</span><span class="op" id="3837605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3837611">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837663">hasLF</span>&nbsp;<span class="op" id="3837669">:=</span>&nbsp;<span class="ident" id="3837672">bytes</span><span class="op" id="3837677">.</span><span class="ident" id="3837678">HasSuffix</span><span class="op" id="3837687">(</span><span class="ident" id="3837688">q</span><span class="op" id="3837689">.</span><span class="ident" id="3837690">line</span><span class="op" id="3837694">,</span>&nbsp;<span class="ident" id="3837696">lf</span><span class="op" id="3837698">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837703">hasCR</span>&nbsp;<span class="op" id="3837709">:=</span>&nbsp;<span class="ident" id="3837712">bytes</span><span class="op" id="3837717">.</span><span class="ident" id="3837718">HasSuffix</span><span class="op" id="3837727">(</span><span class="ident" id="3837728">q</span><span class="op" id="3837729">.</span><span class="ident" id="3837730">line</span><span class="op" id="3837734">,</span>&nbsp;<span class="ident" id="3837736">crlf</span><span class="op" id="3837740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837745">wholeLine</span>&nbsp;<span class="op" id="3837755">:=</span>&nbsp;<span class="ident" id="3837758">q</span><span class="op" id="3837759">.</span><span class="ident" id="3837760">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837768">q</span><span class="op" id="3837769">.</span><span class="ident" id="3837770">line</span>&nbsp;<span class="op" id="3837775">=</span>&nbsp;<span class="ident" id="3837777">bytes</span><span class="op" id="3837782">.</span><span class="ident" id="3837783">TrimRightFunc</span><span class="op" id="3837796">(</span><span class="ident" id="3837797">wholeLine</span><span class="op" id="3837806">,</span>&nbsp;<span class="ident" id="3837808">isQPDiscardWhitespace</span><span class="op" id="3837829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837834">if</span>&nbsp;<span class="ident" id="3837837">bytes</span><span class="op" id="3837842">.</span><span class="ident" id="3837843">HasSuffix</span><span class="op" id="3837852">(</span><span class="ident" id="3837853">q</span><span class="op" id="3837854">.</span><span class="ident" id="3837855">line</span><span class="op" id="3837859">,</span>&nbsp;<span class="ident" id="3837861">softSuffix</span><span class="op" id="3837871">)</span>&nbsp;<span class="op" id="3837873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837879">rightStripped</span>&nbsp;<span class="op" id="3837893">:=</span>&nbsp;<span class="ident" id="3837896">wholeLine</span><span class="op" id="3837905">[</span><span class="builtinfunc" id="3837906">len</span><span class="op" id="3837909">(</span><span class="ident" id="3837910">q</span><span class="op" id="3837911">.</span><span class="ident" id="3837912">line</span><span class="op" id="3837916">)</span><span class="op" id="3837917">:</span><span class="op" id="3837918">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3837924">q</span><span class="op" id="3837925">.</span><span class="ident" id="3837926">line</span>&nbsp;<span class="op" id="3837931">=</span>&nbsp;<span class="ident" id="3837933">q</span><span class="op" id="3837934">.</span><span class="ident" id="3837935">line</span><span class="op" id="3837939">[</span><span class="op" id="3837940">:</span><span class="builtinfunc" id="3837941">len</span><span class="op" id="3837944">(</span><span class="ident" id="3837945">q</span><span class="op" id="3837946">.</span><span class="ident" id="3837947">line</span><span class="op" id="3837951">)</span><span class="op" id="3837952">-</span><span class="num" id="3837953">1</span><span class="op" id="3837954">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3837960">if</span>&nbsp;<span class="op" id="3837963">!</span><span class="ident" id="3837964">bytes</span><span class="op" id="3837969">.</span><span class="ident" id="3837970">HasPrefix</span><span class="op" id="3837979">(</span><span class="ident" id="3837980">rightStripped</span><span class="op" id="3837993">,</span>&nbsp;<span class="ident" id="3837995">lf</span><span class="op" id="3837997">)</span>&nbsp;<span class="op" id="3837999">&amp;&amp;</span>&nbsp;<span class="op" id="3838002">!</span><span class="ident" id="3838003">bytes</span><span class="op" id="3838008">.</span><span class="ident" id="3838009">HasPrefix</span><span class="op" id="3838018">(</span><span class="ident" id="3838019">rightStripped</span><span class="op" id="3838032">,</span>&nbsp;<span class="ident" id="3838034">crlf</span><span class="op" id="3838038">)</span>&nbsp;<span class="op" id="3838040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838047">q</span><span class="op" id="3838048">.</span><span class="ident" id="3838049">rerr</span>&nbsp;<span class="op" id="3838054">=</span>&nbsp;<span class="ident" id="3838056">fmt</span><span class="op" id="3838059">.</span><span class="ident" id="3838060">Errorf</span><span class="op" id="3838066">(</span><span class="string" id="3838067">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3838105">,</span>&nbsp;<span class="ident" id="3838107">rightStripped</span><span class="op" id="3838120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838131">}</span>&nbsp;<span class="keyword" id="3838133">else</span>&nbsp;<span class="keyword" id="3838138">if</span>&nbsp;<span class="ident" id="3838141">hasLF</span>&nbsp;<span class="op" id="3838147">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838153">if</span>&nbsp;<span class="ident" id="3838156">hasCR</span>&nbsp;<span class="op" id="3838162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838169">q</span><span class="op" id="3838170">.</span><span class="ident" id="3838171">line</span>&nbsp;<span class="op" id="3838176">=</span>&nbsp;<span class="builtinfunc" id="3838178">append</span><span class="op" id="3838184">(</span><span class="ident" id="3838185">q</span><span class="op" id="3838186">.</span><span class="ident" id="3838187">line</span><span class="op" id="3838191">,</span>&nbsp;<span class="string" id="3838193">&#39;\r&#39;</span><span class="op" id="3838197">,</span>&nbsp;<span class="string" id="3838199">&#39;\n&#39;</span><span class="op" id="3838203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838209">}</span>&nbsp;<span class="keyword" id="3838211">else</span>&nbsp;<span class="op" id="3838216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838223">q</span><span class="op" id="3838224">.</span><span class="ident" id="3838225">line</span>&nbsp;<span class="op" id="3838230">=</span>&nbsp;<span class="builtinfunc" id="3838232">append</span><span class="op" id="3838238">(</span><span class="ident" id="3838239">q</span><span class="op" id="3838240">.</span><span class="ident" id="3838241">line</span><span class="op" id="3838245">,</span>&nbsp;<span class="string" id="3838247">&#39;\n&#39;</span><span class="op" id="3838251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838257">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838267">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838282">b</span>&nbsp;<span class="op" id="3838284">:=</span>&nbsp;<span class="ident" id="3838287">q</span><span class="op" id="3838288">.</span><span class="ident" id="3838289">line</span><span class="op" id="3838293">[</span><span class="num" id="3838294">0</span><span class="op" id="3838295">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838300">switch</span>&nbsp;<span class="op" id="3838307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838311">case</span>&nbsp;<span class="ident" id="3838316">b</span>&nbsp;<span class="op" id="3838318">==</span>&nbsp;<span class="string" id="3838321">&#39;=&#39;</span><span class="op" id="3838324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838329">b</span><span class="op" id="3838330">,</span>&nbsp;<span class="ident" id="3838332">err</span>&nbsp;<span class="op" id="3838336">=</span>&nbsp;<span class="ident" id="3838338">q</span><span class="op" id="3838339">.</span><span class="ident" id="3838340">readHexByte</span><span class="op" id="3838351">(</span><span class="ident" id="3838352">q</span><span class="op" id="3838353">.</span><span class="ident" id="3838354">line</span><span class="op" id="3838358">[</span><span class="num" id="3838359">1</span><span class="op" id="3838360">:</span><span class="op" id="3838361">]</span><span class="op" id="3838362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838367">if</span>&nbsp;<span class="ident" id="3838370">err</span>&nbsp;<span class="op" id="3838374">!=</span>&nbsp;<span class="ident" id="3838377">nil</span>&nbsp;<span class="op" id="3838381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838387">return</span>&nbsp;<span class="ident" id="3838394">n</span><span class="op" id="3838395">,</span>&nbsp;<span class="ident" id="3838397">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838409">q</span><span class="op" id="3838410">.</span><span class="ident" id="3838411">line</span>&nbsp;<span class="op" id="3838416">=</span>&nbsp;<span class="ident" id="3838418">q</span><span class="op" id="3838419">.</span><span class="ident" id="3838420">line</span><span class="op" id="3838424">[</span><span class="num" id="3838425">2</span><span class="op" id="3838426">:</span><span class="op" id="3838427">]</span>&nbsp;<span class="comment" id="3838429">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838468">case</span>&nbsp;<span class="ident" id="3838473">b</span>&nbsp;<span class="op" id="3838475">==</span>&nbsp;<span class="string" id="3838478">&#39;\t&#39;</span>&nbsp;<span class="op" id="3838483">||</span>&nbsp;<span class="ident" id="3838486">b</span>&nbsp;<span class="op" id="3838488">==</span>&nbsp;<span class="string" id="3838491">&#39;\r&#39;</span>&nbsp;<span class="op" id="3838496">||</span>&nbsp;<span class="ident" id="3838499">b</span>&nbsp;<span class="op" id="3838501">==</span>&nbsp;<span class="string" id="3838504">&#39;\n&#39;</span><span class="op" id="3838508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838513">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838521">case</span>&nbsp;<span class="ident" id="3838526">b</span>&nbsp;<span class="op" id="3838528">&lt;</span>&nbsp;<span class="string" id="3838530">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3838534">||</span>&nbsp;<span class="ident" id="3838537">b</span>&nbsp;<span class="op" id="3838539">&gt;</span>&nbsp;<span class="string" id="3838541">&#39;~&#39;</span><span class="op" id="3838544">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838549">return</span>&nbsp;<span class="ident" id="3838556">n</span><span class="op" id="3838557">,</span>&nbsp;<span class="ident" id="3838559">fmt</span><span class="op" id="3838562">.</span><span class="ident" id="3838563">Errorf</span><span class="op" id="3838569">(</span><span class="string" id="3838570">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3838637">,</span>&nbsp;<span class="ident" id="3838639">b</span><span class="op" id="3838640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838648">p</span><span class="op" id="3838649">[</span><span class="num" id="3838650">0</span><span class="op" id="3838651">]</span>&nbsp;<span class="op" id="3838653">=</span>&nbsp;<span class="ident" id="3838655">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838659">p</span>&nbsp;<span class="op" id="3838661">=</span>&nbsp;<span class="ident" id="3838663">p</span><span class="op" id="3838664">[</span><span class="num" id="3838665">1</span><span class="op" id="3838666">:</span><span class="op" id="3838667">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838671">q</span><span class="op" id="3838672">.</span><span class="ident" id="3838673">line</span>&nbsp;<span class="op" id="3838678">=</span>&nbsp;<span class="ident" id="3838680">q</span><span class="op" id="3838681">.</span><span class="ident" id="3838682">line</span><span class="op" id="3838686">[</span><span class="num" id="3838687">1</span><span class="op" id="3838688">:</span><span class="op" id="3838689">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3838693">n</span><span class="op" id="3838694">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3838698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3838701">return</span>&nbsp;<span class="ident" id="3838708">n</span><span class="op" id="3838709">,</span>&nbsp;<span class="ident" id="3838711">nil</span><br>
<span class="lineno"></span><span class="op" id="3838715">}</span>
</div>
</body>
</html>
