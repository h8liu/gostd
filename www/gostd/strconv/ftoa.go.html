<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2279111">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2279166">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2279220">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2279271">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2279319">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2279333">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2279382">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2279416">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2279450">package</span>&nbsp;<span class="ident" id="2279458">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2279467">import</span>&nbsp;<span class="string" id="2279474">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2279482">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2279507">type</span>&nbsp;<span class="ident" id="2279512">floatInfo</span>&nbsp;<span class="keyword" id="2279522">struct</span>&nbsp;<span class="op" id="2279529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2279532">mantbits</span>&nbsp;<span class="builtintype" id="2279541">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2279547">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2279556">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2279562">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2279571">int</span><br>
<span class="lineno">20</span><span class="op" id="2279575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2279578">var</span>&nbsp;<span class="ident" id="2279582">float32info</span>&nbsp;<span class="op" id="2279594">=</span>&nbsp;<span class="ident" id="2279596">floatInfo</span><span class="op" id="2279605">{</span><span class="num" id="2279606">23</span><span class="op" id="2279608">,</span>&nbsp;<span class="num" id="2279610">8</span><span class="op" id="2279611">,</span>&nbsp;<span class="op" id="2279613">-</span><span class="num" id="2279614">127</span><span class="op" id="2279617">}</span><br>
<span class="lineno"></span><span class="keyword" id="2279619">var</span>&nbsp;<span class="ident" id="2279623">float64info</span>&nbsp;<span class="op" id="2279635">=</span>&nbsp;<span class="ident" id="2279637">floatInfo</span><span class="op" id="2279646">{</span><span class="num" id="2279647">52</span><span class="op" id="2279649">,</span>&nbsp;<span class="num" id="2279651">11</span><span class="op" id="2279653">,</span>&nbsp;<span class="op" id="2279655">-</span><span class="num" id="2279656">1023</span><span class="op" id="2279660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2279663">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2279728">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2279794">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2279866">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2279925">//</span><br>
<span class="lineno">30</span><span class="comment" id="2279928">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2279956">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2279997">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2280040">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2280083">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2280116">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2280168">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2280217">//</span><br>
<span class="lineno"></span><span class="comment" id="2280220">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2280272">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2280352">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2280429">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2280482">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2280545">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2280602">func</span>&nbsp;<span class="ident" id="2280607">FormatFloat</span><span class="op" id="2280618">(</span><span class="ident" id="2280619">f</span>&nbsp;<span class="builtintype" id="2280621">float64</span><span class="op" id="2280628">,</span>&nbsp;<span class="ident" id="2280630">fmt</span>&nbsp;<span class="builtintype" id="2280634">byte</span><span class="op" id="2280638">,</span>&nbsp;<span class="ident" id="2280640">prec</span><span class="op" id="2280644">,</span>&nbsp;<span class="ident" id="2280646">bitSize</span>&nbsp;<span class="builtintype" id="2280654">int</span><span class="op" id="2280657">)</span>&nbsp;<span class="builtintype" id="2280659">string</span>&nbsp;<span class="op" id="2280666">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2280669">return</span>&nbsp;<span class="builtintype" id="2280676">string</span><span class="op" id="2280682">(</span><span class="ident" id="2280683">genericFtoa</span><span class="op" id="2280694">(</span><span class="builtinfunc" id="2280695">make</span><span class="op" id="2280699">(</span><span class="op" id="2280700">[</span><span class="op" id="2280701">]</span><span class="builtintype" id="2280702">byte</span><span class="op" id="2280706">,</span>&nbsp;<span class="num" id="2280708">0</span><span class="op" id="2280709">,</span>&nbsp;<span class="ident" id="2280711">max</span><span class="op" id="2280714">(</span><span class="ident" id="2280715">prec</span><span class="op" id="2280719">+</span><span class="num" id="2280720">4</span><span class="op" id="2280721">,</span>&nbsp;<span class="num" id="2280723">24</span><span class="op" id="2280725">)</span><span class="op" id="2280726">)</span><span class="op" id="2280727">,</span>&nbsp;<span class="ident" id="2280729">f</span><span class="op" id="2280730">,</span>&nbsp;<span class="ident" id="2280732">fmt</span><span class="op" id="2280735">,</span>&nbsp;<span class="ident" id="2280737">prec</span><span class="op" id="2280741">,</span>&nbsp;<span class="ident" id="2280743">bitSize</span><span class="op" id="2280750">)</span><span class="op" id="2280751">)</span><br>
<span class="lineno"></span><span class="op" id="2280753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2280756">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2280827">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2280899">func</span>&nbsp;<span class="ident" id="2280904">AppendFloat</span><span class="op" id="2280915">(</span><span class="ident" id="2280916">dst</span>&nbsp;<span class="op" id="2280920">[</span><span class="op" id="2280921">]</span><span class="builtintype" id="2280922">byte</span><span class="op" id="2280926">,</span>&nbsp;<span class="ident" id="2280928">f</span>&nbsp;<span class="builtintype" id="2280930">float64</span><span class="op" id="2280937">,</span>&nbsp;<span class="ident" id="2280939">fmt</span>&nbsp;<span class="builtintype" id="2280943">byte</span><span class="op" id="2280947">,</span>&nbsp;<span class="ident" id="2280949">prec</span>&nbsp;<span class="builtintype" id="2280954">int</span><span class="op" id="2280957">,</span>&nbsp;<span class="ident" id="2280959">bitSize</span>&nbsp;<span class="builtintype" id="2280967">int</span><span class="op" id="2280970">)</span>&nbsp;<span class="op" id="2280972">[</span><span class="op" id="2280973">]</span><span class="builtintype" id="2280974">byte</span>&nbsp;<span class="op" id="2280979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2280982">return</span>&nbsp;<span class="ident" id="2280989">genericFtoa</span><span class="op" id="2281000">(</span><span class="ident" id="2281001">dst</span><span class="op" id="2281004">,</span>&nbsp;<span class="ident" id="2281006">f</span><span class="op" id="2281007">,</span>&nbsp;<span class="ident" id="2281009">fmt</span><span class="op" id="2281012">,</span>&nbsp;<span class="ident" id="2281014">prec</span><span class="op" id="2281018">,</span>&nbsp;<span class="ident" id="2281020">bitSize</span><span class="op" id="2281027">)</span><br>
<span class="lineno"></span><span class="op" id="2281029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2281032">func</span>&nbsp;<span class="ident" id="2281037">genericFtoa</span><span class="op" id="2281048">(</span><span class="ident" id="2281049">dst</span>&nbsp;<span class="op" id="2281053">[</span><span class="op" id="2281054">]</span><span class="builtintype" id="2281055">byte</span><span class="op" id="2281059">,</span>&nbsp;<span class="ident" id="2281061">val</span>&nbsp;<span class="builtintype" id="2281065">float64</span><span class="op" id="2281072">,</span>&nbsp;<span class="ident" id="2281074">fmt</span>&nbsp;<span class="builtintype" id="2281078">byte</span><span class="op" id="2281082">,</span>&nbsp;<span class="ident" id="2281084">prec</span><span class="op" id="2281088">,</span>&nbsp;<span class="ident" id="2281090">bitSize</span>&nbsp;<span class="builtintype" id="2281098">int</span><span class="op" id="2281101">)</span>&nbsp;<span class="op" id="2281103">[</span><span class="op" id="2281104">]</span><span class="builtintype" id="2281105">byte</span>&nbsp;<span class="op" id="2281110">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281113">var</span>&nbsp;<span class="ident" id="2281117">bits</span>&nbsp;<span class="ident" id="2281122">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281130">var</span>&nbsp;<span class="ident" id="2281134">flt</span>&nbsp;<span class="op" id="2281138">*</span><span class="ident" id="2281139">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281150">switch</span>&nbsp;<span class="ident" id="2281157">bitSize</span>&nbsp;<span class="op" id="2281165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281168">case</span>&nbsp;<span class="num" id="2281173">32</span><span class="op" id="2281175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281179">bits</span>&nbsp;<span class="op" id="2281184">=</span>&nbsp;<span class="ident" id="2281186">uint64</span><span class="op" id="2281192">(</span><span class="ident" id="2281193">math</span><span class="op" id="2281197">.</span><span class="ident" id="2281198">Float32bits</span><span class="op" id="2281209">(</span><span class="builtintype" id="2281210">float32</span><span class="op" id="2281217">(</span><span class="ident" id="2281218">val</span><span class="op" id="2281221">)</span><span class="op" id="2281222">)</span><span class="op" id="2281223">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281227">flt</span>&nbsp;<span class="op" id="2281231">=</span>&nbsp;<span class="op" id="2281233">&amp;</span><span class="ident" id="2281234">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281247">case</span>&nbsp;<span class="num" id="2281252">64</span><span class="op" id="2281254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281258">bits</span>&nbsp;<span class="op" id="2281263">=</span>&nbsp;<span class="ident" id="2281265">math</span><span class="op" id="2281269">.</span><span class="ident" id="2281270">Float64bits</span><span class="op" id="2281281">(</span><span class="ident" id="2281282">val</span><span class="op" id="2281285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281289">flt</span>&nbsp;<span class="op" id="2281293">=</span>&nbsp;<span class="op" id="2281295">&amp;</span><span class="ident" id="2281296">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281309">default</span><span class="op" id="2281316">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2281320">panic</span><span class="op" id="2281325">(</span><span class="string" id="2281326">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2281376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281383">neg</span>&nbsp;<span class="op" id="2281387">:=</span>&nbsp;<span class="ident" id="2281390">bits</span><span class="op" id="2281394">&gt;&gt;</span><span class="op" id="2281396">(</span><span class="ident" id="2281397">flt</span><span class="op" id="2281400">.</span><span class="ident" id="2281401">expbits</span><span class="op" id="2281408">+</span><span class="ident" id="2281409">flt</span><span class="op" id="2281412">.</span><span class="ident" id="2281413">mantbits</span><span class="op" id="2281421">)</span>&nbsp;<span class="op" id="2281423">!=</span>&nbsp;<span class="num" id="2281426">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281429">exp</span>&nbsp;<span class="op" id="2281433">:=</span>&nbsp;<span class="builtintype" id="2281436">int</span><span class="op" id="2281439">(</span><span class="ident" id="2281440">bits</span><span class="op" id="2281444">&gt;&gt;</span><span class="ident" id="2281446">flt</span><span class="op" id="2281449">.</span><span class="ident" id="2281450">mantbits</span><span class="op" id="2281458">)</span>&nbsp;<span class="op" id="2281460">&amp;</span>&nbsp;<span class="op" id="2281462">(</span><span class="num" id="2281463">1</span><span class="op" id="2281464">&lt;&lt;</span><span class="ident" id="2281466">flt</span><span class="op" id="2281469">.</span><span class="ident" id="2281470">expbits</span>&nbsp;<span class="op" id="2281478">-</span>&nbsp;<span class="num" id="2281480">1</span><span class="op" id="2281481">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281484">mant</span>&nbsp;<span class="op" id="2281489">:=</span>&nbsp;<span class="ident" id="2281492">bits</span>&nbsp;<span class="op" id="2281497">&amp;</span>&nbsp;<span class="op" id="2281499">(</span><span class="ident" id="2281500">uint64</span><span class="op" id="2281506">(</span><span class="num" id="2281507">1</span><span class="op" id="2281508">)</span><span class="op" id="2281509">&lt;&lt;</span><span class="ident" id="2281511">flt</span><span class="op" id="2281514">.</span><span class="ident" id="2281515">mantbits</span>&nbsp;<span class="op" id="2281524">-</span>&nbsp;<span class="num" id="2281526">1</span><span class="op" id="2281527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281531">switch</span>&nbsp;<span class="ident" id="2281538">exp</span>&nbsp;<span class="op" id="2281542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281545">case</span>&nbsp;<span class="num" id="2281550">1</span><span class="op" id="2281551">&lt;&lt;</span><span class="ident" id="2281553">flt</span><span class="op" id="2281556">.</span><span class="ident" id="2281557">expbits</span>&nbsp;<span class="op" id="2281565">-</span>&nbsp;<span class="num" id="2281567">1</span><span class="op" id="2281568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2281572">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281586">var</span>&nbsp;<span class="ident" id="2281590">s</span>&nbsp;<span class="builtintype" id="2281592">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281601">switch</span>&nbsp;<span class="op" id="2281608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281612">case</span>&nbsp;<span class="ident" id="2281617">mant</span>&nbsp;<span class="op" id="2281622">!=</span>&nbsp;<span class="num" id="2281625">0</span><span class="op" id="2281626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281631">s</span>&nbsp;<span class="op" id="2281633">=</span>&nbsp;<span class="string" id="2281635">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281643">case</span>&nbsp;<span class="ident" id="2281648">neg</span><span class="op" id="2281651">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281656">s</span>&nbsp;<span class="op" id="2281658">=</span>&nbsp;<span class="string" id="2281660">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281669">default</span><span class="op" id="2281676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281681">s</span>&nbsp;<span class="op" id="2281683">=</span>&nbsp;<span class="string" id="2281685">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281698">return</span>&nbsp;<span class="builtinfunc" id="2281705">append</span><span class="op" id="2281711">(</span><span class="ident" id="2281712">dst</span><span class="op" id="2281715">,</span>&nbsp;<span class="ident" id="2281717">s</span><span class="op" id="2281718">...</span><span class="op" id="2281721">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281725">case</span>&nbsp;<span class="num" id="2281730">0</span><span class="op" id="2281731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2281735">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281753">exp</span><span class="op" id="2281756">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281761">default</span><span class="op" id="2281768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2281772">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281798">mant</span>&nbsp;<span class="op" id="2281803">|=</span>&nbsp;<span class="ident" id="2281806">uint64</span><span class="op" id="2281812">(</span><span class="num" id="2281813">1</span><span class="op" id="2281814">)</span>&nbsp;<span class="op" id="2281816">&lt;&lt;</span>&nbsp;<span class="ident" id="2281819">flt</span><span class="op" id="2281822">.</span><span class="ident" id="2281823">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2281836">exp</span>&nbsp;<span class="op" id="2281840">+=</span>&nbsp;<span class="ident" id="2281843">flt</span><span class="op" id="2281846">.</span><span class="ident" id="2281847">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2281854">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281887">if</span>&nbsp;<span class="ident" id="2281890">fmt</span>&nbsp;<span class="op" id="2281894">==</span>&nbsp;<span class="string" id="2281897">&#39;b&#39;</span>&nbsp;<span class="op" id="2281901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281905">return</span>&nbsp;<span class="ident" id="2281912">fmtB</span><span class="op" id="2281916">(</span><span class="ident" id="2281917">dst</span><span class="op" id="2281920">,</span>&nbsp;<span class="ident" id="2281922">neg</span><span class="op" id="2281925">,</span>&nbsp;<span class="ident" id="2281927">mant</span><span class="op" id="2281931">,</span>&nbsp;<span class="ident" id="2281933">exp</span><span class="op" id="2281936">,</span>&nbsp;<span class="ident" id="2281938">flt</span><span class="op" id="2281941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2281944">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281948">if</span>&nbsp;<span class="op" id="2281951">!</span><span class="ident" id="2281952">optimize</span>&nbsp;<span class="op" id="2281961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2281965">return</span>&nbsp;<span class="ident" id="2281972">bigFtoa</span><span class="op" id="2281979">(</span><span class="ident" id="2281980">dst</span><span class="op" id="2281983">,</span>&nbsp;<span class="ident" id="2281985">prec</span><span class="op" id="2281989">,</span>&nbsp;<span class="ident" id="2281991">fmt</span><span class="op" id="2281994">,</span>&nbsp;<span class="ident" id="2281996">neg</span><span class="op" id="2281999">,</span>&nbsp;<span class="ident" id="2282001">mant</span><span class="op" id="2282005">,</span>&nbsp;<span class="ident" id="2282007">exp</span><span class="op" id="2282010">,</span>&nbsp;<span class="ident" id="2282012">flt</span><span class="op" id="2282015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282022">var</span>&nbsp;<span class="ident" id="2282026">digs</span>&nbsp;<span class="ident" id="2282031">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282045">ok</span>&nbsp;<span class="op" id="2282048">:=</span>&nbsp;<span class="builtintype" id="2282051">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282058">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282125">shortest</span>&nbsp;<span class="op" id="2282134">:=</span>&nbsp;<span class="ident" id="2282137">prec</span>&nbsp;<span class="op" id="2282142">&lt;</span>&nbsp;<span class="num" id="2282144">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282147">if</span>&nbsp;<span class="ident" id="2282150">shortest</span>&nbsp;<span class="op" id="2282159">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282163">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282190">f</span>&nbsp;<span class="op" id="2282192">:=</span>&nbsp;<span class="builtinfunc" id="2282195">new</span><span class="op" id="2282198">(</span><span class="ident" id="2282199">extFloat</span><span class="op" id="2282207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282211">lower</span><span class="op" id="2282216">,</span>&nbsp;<span class="ident" id="2282218">upper</span>&nbsp;<span class="op" id="2282224">:=</span>&nbsp;<span class="ident" id="2282227">f</span><span class="op" id="2282228">.</span><span class="ident" id="2282229">AssignComputeBounds</span><span class="op" id="2282248">(</span><span class="ident" id="2282249">mant</span><span class="op" id="2282253">,</span>&nbsp;<span class="ident" id="2282255">exp</span><span class="op" id="2282258">,</span>&nbsp;<span class="ident" id="2282260">neg</span><span class="op" id="2282263">,</span>&nbsp;<span class="ident" id="2282265">flt</span><span class="op" id="2282268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282272">var</span>&nbsp;<span class="ident" id="2282276">buf</span>&nbsp;<span class="op" id="2282280">[</span><span class="num" id="2282281">32</span><span class="op" id="2282283">]</span><span class="builtintype" id="2282284">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282291">digs</span><span class="op" id="2282295">.</span><span class="ident" id="2282296">d</span>&nbsp;<span class="op" id="2282298">=</span>&nbsp;<span class="ident" id="2282300">buf</span><span class="op" id="2282303">[</span><span class="op" id="2282304">:</span><span class="op" id="2282305">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282309">ok</span>&nbsp;<span class="op" id="2282312">=</span>&nbsp;<span class="ident" id="2282314">f</span><span class="op" id="2282315">.</span><span class="ident" id="2282316">ShortestDecimal</span><span class="op" id="2282331">(</span><span class="op" id="2282332">&amp;</span><span class="ident" id="2282333">digs</span><span class="op" id="2282337">,</span>&nbsp;<span class="op" id="2282339">&amp;</span><span class="ident" id="2282340">lower</span><span class="op" id="2282345">,</span>&nbsp;<span class="op" id="2282347">&amp;</span><span class="ident" id="2282348">upper</span><span class="op" id="2282353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282357">if</span>&nbsp;<span class="op" id="2282360">!</span><span class="ident" id="2282361">ok</span>&nbsp;<span class="op" id="2282364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282369">return</span>&nbsp;<span class="ident" id="2282376">bigFtoa</span><span class="op" id="2282383">(</span><span class="ident" id="2282384">dst</span><span class="op" id="2282387">,</span>&nbsp;<span class="ident" id="2282389">prec</span><span class="op" id="2282393">,</span>&nbsp;<span class="ident" id="2282395">fmt</span><span class="op" id="2282398">,</span>&nbsp;<span class="ident" id="2282400">neg</span><span class="op" id="2282403">,</span>&nbsp;<span class="ident" id="2282405">mant</span><span class="op" id="2282409">,</span>&nbsp;<span class="ident" id="2282411">exp</span><span class="op" id="2282414">,</span>&nbsp;<span class="ident" id="2282416">flt</span><span class="op" id="2282419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282427">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282476">switch</span>&nbsp;<span class="ident" id="2282483">fmt</span>&nbsp;<span class="op" id="2282487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282491">case</span>&nbsp;<span class="string" id="2282496">&#39;e&#39;</span><span class="op" id="2282499">,</span>&nbsp;<span class="string" id="2282501">&#39;E&#39;</span><span class="op" id="2282504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282509">prec</span>&nbsp;<span class="op" id="2282514">=</span>&nbsp;<span class="ident" id="2282516">digs</span><span class="op" id="2282520">.</span><span class="ident" id="2282521">nd</span>&nbsp;<span class="op" id="2282524">-</span>&nbsp;<span class="num" id="2282526">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282530">case</span>&nbsp;<span class="string" id="2282535">&#39;f&#39;</span><span class="op" id="2282538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282543">prec</span>&nbsp;<span class="op" id="2282548">=</span>&nbsp;<span class="ident" id="2282550">max</span><span class="op" id="2282553">(</span><span class="ident" id="2282554">digs</span><span class="op" id="2282558">.</span><span class="ident" id="2282559">nd</span><span class="op" id="2282561">-</span><span class="ident" id="2282562">digs</span><span class="op" id="2282566">.</span><span class="ident" id="2282567">dp</span><span class="op" id="2282569">,</span>&nbsp;<span class="num" id="2282571">0</span><span class="op" id="2282572">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282576">case</span>&nbsp;<span class="string" id="2282581">&#39;g&#39;</span><span class="op" id="2282584">,</span>&nbsp;<span class="string" id="2282586">&#39;G&#39;</span><span class="op" id="2282589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282594">prec</span>&nbsp;<span class="op" id="2282599">=</span>&nbsp;<span class="ident" id="2282601">digs</span><span class="op" id="2282605">.</span><span class="ident" id="2282606">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282614">}</span>&nbsp;<span class="keyword" id="2282616">else</span>&nbsp;<span class="keyword" id="2282621">if</span>&nbsp;<span class="ident" id="2282624">fmt</span>&nbsp;<span class="op" id="2282628">!=</span>&nbsp;<span class="string" id="2282631">&#39;f&#39;</span>&nbsp;<span class="op" id="2282635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282639">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282668">digits</span>&nbsp;<span class="op" id="2282675">:=</span>&nbsp;<span class="ident" id="2282678">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282685">switch</span>&nbsp;<span class="ident" id="2282692">fmt</span>&nbsp;<span class="op" id="2282696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282700">case</span>&nbsp;<span class="string" id="2282705">&#39;e&#39;</span><span class="op" id="2282708">,</span>&nbsp;<span class="string" id="2282710">&#39;E&#39;</span><span class="op" id="2282713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282718">digits</span><span class="op" id="2282724">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282729">case</span>&nbsp;<span class="string" id="2282734">&#39;g&#39;</span><span class="op" id="2282737">,</span>&nbsp;<span class="string" id="2282739">&#39;G&#39;</span><span class="op" id="2282742">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282747">if</span>&nbsp;<span class="ident" id="2282750">prec</span>&nbsp;<span class="op" id="2282755">==</span>&nbsp;<span class="num" id="2282758">0</span>&nbsp;<span class="op" id="2282760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282766">prec</span>&nbsp;<span class="op" id="2282771">=</span>&nbsp;<span class="num" id="2282773">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282783">digits</span>&nbsp;<span class="op" id="2282790">=</span>&nbsp;<span class="ident" id="2282792">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2282799">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282803">if</span>&nbsp;<span class="ident" id="2282806">digits</span>&nbsp;<span class="op" id="2282813">&lt;=</span>&nbsp;<span class="num" id="2282816">15</span>&nbsp;<span class="op" id="2282819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282824">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2282890">var</span>&nbsp;<span class="ident" id="2282894">buf</span>&nbsp;<span class="op" id="2282898">[</span><span class="num" id="2282899">24</span><span class="op" id="2282901">]</span><span class="builtintype" id="2282902">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282910">digs</span><span class="op" id="2282914">.</span><span class="ident" id="2282915">d</span>&nbsp;<span class="op" id="2282917">=</span>&nbsp;<span class="ident" id="2282919">buf</span><span class="op" id="2282922">[</span><span class="op" id="2282923">:</span><span class="op" id="2282924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282929">f</span>&nbsp;<span class="op" id="2282931">:=</span>&nbsp;<span class="ident" id="2282934">extFloat</span><span class="op" id="2282942">{</span><span class="ident" id="2282943">mant</span><span class="op" id="2282947">,</span>&nbsp;<span class="ident" id="2282949">exp</span>&nbsp;<span class="op" id="2282953">-</span>&nbsp;<span class="builtintype" id="2282955">int</span><span class="op" id="2282958">(</span><span class="ident" id="2282959">flt</span><span class="op" id="2282962">.</span><span class="ident" id="2282963">mantbits</span><span class="op" id="2282971">)</span><span class="op" id="2282972">,</span>&nbsp;<span class="ident" id="2282974">neg</span><span class="op" id="2282977">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2282982">ok</span>&nbsp;<span class="op" id="2282985">=</span>&nbsp;<span class="ident" id="2282987">f</span><span class="op" id="2282988">.</span><span class="ident" id="2282989">FixedDecimal</span><span class="op" id="2283001">(</span><span class="op" id="2283002">&amp;</span><span class="ident" id="2283003">digs</span><span class="op" id="2283007">,</span>&nbsp;<span class="ident" id="2283009">digits</span><span class="op" id="2283015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283025">if</span>&nbsp;<span class="op" id="2283028">!</span><span class="ident" id="2283029">ok</span>&nbsp;<span class="op" id="2283032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283036">return</span>&nbsp;<span class="ident" id="2283043">bigFtoa</span><span class="op" id="2283050">(</span><span class="ident" id="2283051">dst</span><span class="op" id="2283054">,</span>&nbsp;<span class="ident" id="2283056">prec</span><span class="op" id="2283060">,</span>&nbsp;<span class="ident" id="2283062">fmt</span><span class="op" id="2283065">,</span>&nbsp;<span class="ident" id="2283067">neg</span><span class="op" id="2283070">,</span>&nbsp;<span class="ident" id="2283072">mant</span><span class="op" id="2283076">,</span>&nbsp;<span class="ident" id="2283078">exp</span><span class="op" id="2283081">,</span>&nbsp;<span class="ident" id="2283083">flt</span><span class="op" id="2283086">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283092">return</span>&nbsp;<span class="ident" id="2283099">formatDigits</span><span class="op" id="2283111">(</span><span class="ident" id="2283112">dst</span><span class="op" id="2283115">,</span>&nbsp;<span class="ident" id="2283117">shortest</span><span class="op" id="2283125">,</span>&nbsp;<span class="ident" id="2283127">neg</span><span class="op" id="2283130">,</span>&nbsp;<span class="ident" id="2283132">digs</span><span class="op" id="2283136">,</span>&nbsp;<span class="ident" id="2283138">prec</span><span class="op" id="2283142">,</span>&nbsp;<span class="ident" id="2283144">fmt</span><span class="op" id="2283147">)</span><br>
<span class="lineno"></span><span class="op" id="2283149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2283152">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2283215">func</span>&nbsp;<span class="ident" id="2283220">bigFtoa</span><span class="op" id="2283227">(</span><span class="ident" id="2283228">dst</span>&nbsp;<span class="op" id="2283232">[</span><span class="op" id="2283233">]</span><span class="builtintype" id="2283234">byte</span><span class="op" id="2283238">,</span>&nbsp;<span class="ident" id="2283240">prec</span>&nbsp;<span class="builtintype" id="2283245">int</span><span class="op" id="2283248">,</span>&nbsp;<span class="ident" id="2283250">fmt</span>&nbsp;<span class="builtintype" id="2283254">byte</span><span class="op" id="2283258">,</span>&nbsp;<span class="ident" id="2283260">neg</span>&nbsp;<span class="builtintype" id="2283264">bool</span><span class="op" id="2283268">,</span>&nbsp;<span class="ident" id="2283270">mant</span>&nbsp;<span class="ident" id="2283275">uint64</span><span class="op" id="2283281">,</span>&nbsp;<span class="ident" id="2283283">exp</span>&nbsp;<span class="builtintype" id="2283287">int</span><span class="op" id="2283290">,</span>&nbsp;<span class="ident" id="2283292">flt</span>&nbsp;<span class="op" id="2283296">*</span><span class="ident" id="2283297">floatInfo</span><span class="op" id="2283306">)</span>&nbsp;<span class="op" id="2283308">[</span><span class="op" id="2283309">]</span><span class="builtintype" id="2283310">byte</span>&nbsp;<span class="op" id="2283315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283318">d</span>&nbsp;<span class="op" id="2283320">:=</span>&nbsp;<span class="builtinfunc" id="2283323">new</span><span class="op" id="2283326">(</span><span class="ident" id="2283327">decimal</span><span class="op" id="2283334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283337">d</span><span class="op" id="2283338">.</span><span class="ident" id="2283339">Assign</span><span class="op" id="2283345">(</span><span class="ident" id="2283346">mant</span><span class="op" id="2283350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283353">d</span><span class="op" id="2283354">.</span><span class="ident" id="2283355">Shift</span><span class="op" id="2283360">(</span><span class="ident" id="2283361">exp</span>&nbsp;<span class="op" id="2283365">-</span>&nbsp;<span class="builtintype" id="2283367">int</span><span class="op" id="2283370">(</span><span class="ident" id="2283371">flt</span><span class="op" id="2283374">.</span><span class="ident" id="2283375">mantbits</span><span class="op" id="2283383">)</span><span class="op" id="2283384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283387">var</span>&nbsp;<span class="ident" id="2283391">digs</span>&nbsp;<span class="ident" id="2283396">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283410">shortest</span>&nbsp;<span class="op" id="2283419">:=</span>&nbsp;<span class="ident" id="2283422">prec</span>&nbsp;<span class="op" id="2283427">&lt;</span>&nbsp;<span class="num" id="2283429">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283432">if</span>&nbsp;<span class="ident" id="2283435">shortest</span>&nbsp;<span class="op" id="2283444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283448">roundShortest</span><span class="op" id="2283461">(</span><span class="ident" id="2283462">d</span><span class="op" id="2283463">,</span>&nbsp;<span class="ident" id="2283465">mant</span><span class="op" id="2283469">,</span>&nbsp;<span class="ident" id="2283471">exp</span><span class="op" id="2283474">,</span>&nbsp;<span class="ident" id="2283476">flt</span><span class="op" id="2283479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283483">digs</span>&nbsp;<span class="op" id="2283488">=</span>&nbsp;<span class="ident" id="2283490">decimalSlice</span><span class="op" id="2283502">{</span><span class="ident" id="2283503">d</span><span class="op" id="2283504">:</span>&nbsp;<span class="ident" id="2283506">d</span><span class="op" id="2283507">.</span><span class="ident" id="2283508">d</span><span class="op" id="2283509">[</span><span class="op" id="2283510">:</span><span class="op" id="2283511">]</span><span class="op" id="2283512">,</span>&nbsp;<span class="ident" id="2283514">nd</span><span class="op" id="2283516">:</span>&nbsp;<span class="ident" id="2283518">d</span><span class="op" id="2283519">.</span><span class="ident" id="2283520">nd</span><span class="op" id="2283522">,</span>&nbsp;<span class="ident" id="2283524">dp</span><span class="op" id="2283526">:</span>&nbsp;<span class="ident" id="2283528">d</span><span class="op" id="2283529">.</span><span class="ident" id="2283530">dp</span><span class="op" id="2283532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2283536">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283585">switch</span>&nbsp;<span class="ident" id="2283592">fmt</span>&nbsp;<span class="op" id="2283596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283600">case</span>&nbsp;<span class="string" id="2283605">&#39;e&#39;</span><span class="op" id="2283608">,</span>&nbsp;<span class="string" id="2283610">&#39;E&#39;</span><span class="op" id="2283613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283618">prec</span>&nbsp;<span class="op" id="2283623">=</span>&nbsp;<span class="ident" id="2283625">digs</span><span class="op" id="2283629">.</span><span class="ident" id="2283630">nd</span>&nbsp;<span class="op" id="2283633">-</span>&nbsp;<span class="num" id="2283635">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283639">case</span>&nbsp;<span class="string" id="2283644">&#39;f&#39;</span><span class="op" id="2283647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283652">prec</span>&nbsp;<span class="op" id="2283657">=</span>&nbsp;<span class="ident" id="2283659">max</span><span class="op" id="2283662">(</span><span class="ident" id="2283663">digs</span><span class="op" id="2283667">.</span><span class="ident" id="2283668">nd</span><span class="op" id="2283670">-</span><span class="ident" id="2283671">digs</span><span class="op" id="2283675">.</span><span class="ident" id="2283676">dp</span><span class="op" id="2283678">,</span>&nbsp;<span class="num" id="2283680">0</span><span class="op" id="2283681">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283685">case</span>&nbsp;<span class="string" id="2283690">&#39;g&#39;</span><span class="op" id="2283693">,</span>&nbsp;<span class="string" id="2283695">&#39;G&#39;</span><span class="op" id="2283698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283703">prec</span>&nbsp;<span class="op" id="2283708">=</span>&nbsp;<span class="ident" id="2283710">digs</span><span class="op" id="2283714">.</span><span class="ident" id="2283715">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283723">}</span>&nbsp;<span class="keyword" id="2283725">else</span>&nbsp;<span class="op" id="2283730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2283734">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283760">switch</span>&nbsp;<span class="ident" id="2283767">fmt</span>&nbsp;<span class="op" id="2283771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283775">case</span>&nbsp;<span class="string" id="2283780">&#39;e&#39;</span><span class="op" id="2283783">,</span>&nbsp;<span class="string" id="2283785">&#39;E&#39;</span><span class="op" id="2283788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283793">d</span><span class="op" id="2283794">.</span><span class="ident" id="2283795">Round</span><span class="op" id="2283800">(</span><span class="ident" id="2283801">prec</span>&nbsp;<span class="op" id="2283806">+</span>&nbsp;<span class="num" id="2283808">1</span><span class="op" id="2283809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283813">case</span>&nbsp;<span class="string" id="2283818">&#39;f&#39;</span><span class="op" id="2283821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283826">d</span><span class="op" id="2283827">.</span><span class="ident" id="2283828">Round</span><span class="op" id="2283833">(</span><span class="ident" id="2283834">d</span><span class="op" id="2283835">.</span><span class="ident" id="2283836">dp</span>&nbsp;<span class="op" id="2283839">+</span>&nbsp;<span class="ident" id="2283841">prec</span><span class="op" id="2283845">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283849">case</span>&nbsp;<span class="string" id="2283854">&#39;g&#39;</span><span class="op" id="2283857">,</span>&nbsp;<span class="string" id="2283859">&#39;G&#39;</span><span class="op" id="2283862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283867">if</span>&nbsp;<span class="ident" id="2283870">prec</span>&nbsp;<span class="op" id="2283875">==</span>&nbsp;<span class="num" id="2283878">0</span>&nbsp;<span class="op" id="2283880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283886">prec</span>&nbsp;<span class="op" id="2283891">=</span>&nbsp;<span class="num" id="2283893">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283903">d</span><span class="op" id="2283904">.</span><span class="ident" id="2283905">Round</span><span class="op" id="2283910">(</span><span class="ident" id="2283911">prec</span><span class="op" id="2283915">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2283923">digs</span>&nbsp;<span class="op" id="2283928">=</span>&nbsp;<span class="ident" id="2283930">decimalSlice</span><span class="op" id="2283942">{</span><span class="ident" id="2283943">d</span><span class="op" id="2283944">:</span>&nbsp;<span class="ident" id="2283946">d</span><span class="op" id="2283947">.</span><span class="ident" id="2283948">d</span><span class="op" id="2283949">[</span><span class="op" id="2283950">:</span><span class="op" id="2283951">]</span><span class="op" id="2283952">,</span>&nbsp;<span class="ident" id="2283954">nd</span><span class="op" id="2283956">:</span>&nbsp;<span class="ident" id="2283958">d</span><span class="op" id="2283959">.</span><span class="ident" id="2283960">nd</span><span class="op" id="2283962">,</span>&nbsp;<span class="ident" id="2283964">dp</span><span class="op" id="2283966">:</span>&nbsp;<span class="ident" id="2283968">d</span><span class="op" id="2283969">.</span><span class="ident" id="2283970">dp</span><span class="op" id="2283972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2283975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2283978">return</span>&nbsp;<span class="ident" id="2283985">formatDigits</span><span class="op" id="2283997">(</span><span class="ident" id="2283998">dst</span><span class="op" id="2284001">,</span>&nbsp;<span class="ident" id="2284003">shortest</span><span class="op" id="2284011">,</span>&nbsp;<span class="ident" id="2284013">neg</span><span class="op" id="2284016">,</span>&nbsp;<span class="ident" id="2284018">digs</span><span class="op" id="2284022">,</span>&nbsp;<span class="ident" id="2284024">prec</span><span class="op" id="2284028">,</span>&nbsp;<span class="ident" id="2284030">fmt</span><span class="op" id="2284033">)</span><br>
<span class="lineno"></span><span class="op" id="2284035">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2284038">func</span>&nbsp;<span class="ident" id="2284043">formatDigits</span><span class="op" id="2284055">(</span><span class="ident" id="2284056">dst</span>&nbsp;<span class="op" id="2284060">[</span><span class="op" id="2284061">]</span><span class="builtintype" id="2284062">byte</span><span class="op" id="2284066">,</span>&nbsp;<span class="ident" id="2284068">shortest</span>&nbsp;<span class="builtintype" id="2284077">bool</span><span class="op" id="2284081">,</span>&nbsp;<span class="ident" id="2284083">neg</span>&nbsp;<span class="builtintype" id="2284087">bool</span><span class="op" id="2284091">,</span>&nbsp;<span class="ident" id="2284093">digs</span>&nbsp;<span class="ident" id="2284098">decimalSlice</span><span class="op" id="2284110">,</span>&nbsp;<span class="ident" id="2284112">prec</span>&nbsp;<span class="builtintype" id="2284117">int</span><span class="op" id="2284120">,</span>&nbsp;<span class="ident" id="2284122">fmt</span>&nbsp;<span class="builtintype" id="2284126">byte</span><span class="op" id="2284130">)</span>&nbsp;<span class="op" id="2284132">[</span><span class="op" id="2284133">]</span><span class="builtintype" id="2284134">byte</span>&nbsp;<span class="op" id="2284139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284142">switch</span>&nbsp;<span class="ident" id="2284149">fmt</span>&nbsp;<span class="op" id="2284153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284156">case</span>&nbsp;<span class="string" id="2284161">&#39;e&#39;</span><span class="op" id="2284164">,</span>&nbsp;<span class="string" id="2284166">&#39;E&#39;</span><span class="op" id="2284169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284173">return</span>&nbsp;<span class="ident" id="2284180">fmtE</span><span class="op" id="2284184">(</span><span class="ident" id="2284185">dst</span><span class="op" id="2284188">,</span>&nbsp;<span class="ident" id="2284190">neg</span><span class="op" id="2284193">,</span>&nbsp;<span class="ident" id="2284195">digs</span><span class="op" id="2284199">,</span>&nbsp;<span class="ident" id="2284201">prec</span><span class="op" id="2284205">,</span>&nbsp;<span class="ident" id="2284207">fmt</span><span class="op" id="2284210">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284213">case</span>&nbsp;<span class="string" id="2284218">&#39;f&#39;</span><span class="op" id="2284221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284225">return</span>&nbsp;<span class="ident" id="2284232">fmtF</span><span class="op" id="2284236">(</span><span class="ident" id="2284237">dst</span><span class="op" id="2284240">,</span>&nbsp;<span class="ident" id="2284242">neg</span><span class="op" id="2284245">,</span>&nbsp;<span class="ident" id="2284247">digs</span><span class="op" id="2284251">,</span>&nbsp;<span class="ident" id="2284253">prec</span><span class="op" id="2284257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284260">case</span>&nbsp;<span class="string" id="2284265">&#39;g&#39;</span><span class="op" id="2284268">,</span>&nbsp;<span class="string" id="2284270">&#39;G&#39;</span><span class="op" id="2284273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2284277">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284337">eprec</span>&nbsp;<span class="op" id="2284343">:=</span>&nbsp;<span class="ident" id="2284346">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284353">if</span>&nbsp;<span class="ident" id="2284356">eprec</span>&nbsp;<span class="op" id="2284362">&gt;</span>&nbsp;<span class="ident" id="2284364">digs</span><span class="op" id="2284368">.</span><span class="ident" id="2284369">nd</span>&nbsp;<span class="op" id="2284372">&amp;&amp;</span>&nbsp;<span class="ident" id="2284375">digs</span><span class="op" id="2284379">.</span><span class="ident" id="2284380">nd</span>&nbsp;<span class="op" id="2284383">&gt;=</span>&nbsp;<span class="ident" id="2284386">digs</span><span class="op" id="2284390">.</span><span class="ident" id="2284391">dp</span>&nbsp;<span class="op" id="2284394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284399">eprec</span>&nbsp;<span class="op" id="2284405">=</span>&nbsp;<span class="ident" id="2284407">digs</span><span class="op" id="2284411">.</span><span class="ident" id="2284412">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2284421">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2284473">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2284537">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284617">if</span>&nbsp;<span class="ident" id="2284620">shortest</span>&nbsp;<span class="op" id="2284629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284634">eprec</span>&nbsp;<span class="op" id="2284640">=</span>&nbsp;<span class="num" id="2284642">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284650">exp</span>&nbsp;<span class="op" id="2284654">:=</span>&nbsp;<span class="ident" id="2284657">digs</span><span class="op" id="2284661">.</span><span class="ident" id="2284662">dp</span>&nbsp;<span class="op" id="2284665">-</span>&nbsp;<span class="num" id="2284667">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284671">if</span>&nbsp;<span class="ident" id="2284674">exp</span>&nbsp;<span class="op" id="2284678">&lt;</span>&nbsp;<span class="op" id="2284680">-</span><span class="num" id="2284681">4</span>&nbsp;<span class="op" id="2284683">||</span>&nbsp;<span class="ident" id="2284686">exp</span>&nbsp;<span class="op" id="2284690">&gt;=</span>&nbsp;<span class="ident" id="2284693">eprec</span>&nbsp;<span class="op" id="2284699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284704">if</span>&nbsp;<span class="ident" id="2284707">prec</span>&nbsp;<span class="op" id="2284712">&gt;</span>&nbsp;<span class="ident" id="2284714">digs</span><span class="op" id="2284718">.</span><span class="ident" id="2284719">nd</span>&nbsp;<span class="op" id="2284722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284728">prec</span>&nbsp;<span class="op" id="2284733">=</span>&nbsp;<span class="ident" id="2284735">digs</span><span class="op" id="2284739">.</span><span class="ident" id="2284740">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284751">return</span>&nbsp;<span class="ident" id="2284758">fmtE</span><span class="op" id="2284762">(</span><span class="ident" id="2284763">dst</span><span class="op" id="2284766">,</span>&nbsp;<span class="ident" id="2284768">neg</span><span class="op" id="2284771">,</span>&nbsp;<span class="ident" id="2284773">digs</span><span class="op" id="2284777">,</span>&nbsp;<span class="ident" id="2284779">prec</span><span class="op" id="2284783">-</span><span class="num" id="2284784">1</span><span class="op" id="2284785">,</span>&nbsp;<span class="ident" id="2284787">fmt</span><span class="op" id="2284790">+</span><span class="string" id="2284791">&#39;e&#39;</span><span class="op" id="2284794">-</span><span class="string" id="2284795">&#39;g&#39;</span><span class="op" id="2284798">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284806">if</span>&nbsp;<span class="ident" id="2284809">prec</span>&nbsp;<span class="op" id="2284814">&gt;</span>&nbsp;<span class="ident" id="2284816">digs</span><span class="op" id="2284820">.</span><span class="ident" id="2284821">dp</span>&nbsp;<span class="op" id="2284824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2284829">prec</span>&nbsp;<span class="op" id="2284834">=</span>&nbsp;<span class="ident" id="2284836">digs</span><span class="op" id="2284840">.</span><span class="ident" id="2284841">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284850">return</span>&nbsp;<span class="ident" id="2284857">fmtF</span><span class="op" id="2284861">(</span><span class="ident" id="2284862">dst</span><span class="op" id="2284865">,</span>&nbsp;<span class="ident" id="2284867">neg</span><span class="op" id="2284870">,</span>&nbsp;<span class="ident" id="2284872">digs</span><span class="op" id="2284876">,</span>&nbsp;<span class="ident" id="2284878">max</span><span class="op" id="2284881">(</span><span class="ident" id="2284882">prec</span><span class="op" id="2284886">-</span><span class="ident" id="2284887">digs</span><span class="op" id="2284891">.</span><span class="ident" id="2284892">dp</span><span class="op" id="2284894">,</span>&nbsp;<span class="num" id="2284896">0</span><span class="op" id="2284897">)</span><span class="op" id="2284898">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2284905">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2284924">return</span>&nbsp;<span class="builtinfunc" id="2284931">append</span><span class="op" id="2284937">(</span><span class="ident" id="2284938">dst</span><span class="op" id="2284941">,</span>&nbsp;<span class="string" id="2284943">&#39;%&#39;</span><span class="op" id="2284946">,</span>&nbsp;<span class="ident" id="2284948">fmt</span><span class="op" id="2284951">)</span><br>
<span class="lineno"></span><span class="op" id="2284953">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2284956">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2285017">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2285081">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2285149">func</span>&nbsp;<span class="ident" id="2285154">roundShortest</span><span class="op" id="2285167">(</span><span class="ident" id="2285168">d</span>&nbsp;<span class="op" id="2285170">*</span><span class="ident" id="2285171">decimal</span><span class="op" id="2285178">,</span>&nbsp;<span class="ident" id="2285180">mant</span>&nbsp;<span class="ident" id="2285185">uint64</span><span class="op" id="2285191">,</span>&nbsp;<span class="ident" id="2285193">exp</span>&nbsp;<span class="builtintype" id="2285197">int</span><span class="op" id="2285200">,</span>&nbsp;<span class="ident" id="2285202">flt</span>&nbsp;<span class="op" id="2285206">*</span><span class="ident" id="2285207">floatInfo</span><span class="op" id="2285216">)</span>&nbsp;<span class="op" id="2285218">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285221">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2285276">if</span>&nbsp;<span class="ident" id="2285279">mant</span>&nbsp;<span class="op" id="2285284">==</span>&nbsp;<span class="num" id="2285287">0</span>&nbsp;<span class="op" id="2285289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2285293">d</span><span class="op" id="2285294">.</span><span class="ident" id="2285295">nd</span>&nbsp;<span class="op" id="2285298">=</span>&nbsp;<span class="num" id="2285300">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2285304">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2285312">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285316">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285373">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285422">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285477">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285537">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285541">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285600">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285660">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285718">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285748">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285752">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285824">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2285877">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2285946">minexp</span>&nbsp;<span class="op" id="2285953">:=</span>&nbsp;<span class="ident" id="2285956">flt</span><span class="op" id="2285959">.</span><span class="ident" id="2285960">bias</span>&nbsp;<span class="op" id="2285965">+</span>&nbsp;<span class="num" id="2285967">1</span>&nbsp;<span class="comment" id="2285969">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2285999">if</span>&nbsp;<span class="ident" id="2286002">exp</span>&nbsp;<span class="op" id="2286006">&gt;</span>&nbsp;<span class="ident" id="2286008">minexp</span>&nbsp;<span class="op" id="2286015">&amp;&amp;</span>&nbsp;<span class="num" id="2286018">332</span><span class="op" id="2286021">*</span><span class="op" id="2286022">(</span><span class="ident" id="2286023">d</span><span class="op" id="2286024">.</span><span class="ident" id="2286025">dp</span><span class="op" id="2286027">-</span><span class="ident" id="2286028">d</span><span class="op" id="2286029">.</span><span class="ident" id="2286030">nd</span><span class="op" id="2286032">)</span>&nbsp;<span class="op" id="2286034">&gt;=</span>&nbsp;<span class="num" id="2286037">100</span><span class="op" id="2286040">*</span><span class="op" id="2286041">(</span><span class="ident" id="2286042">exp</span><span class="op" id="2286045">-</span><span class="builtintype" id="2286046">int</span><span class="op" id="2286049">(</span><span class="ident" id="2286050">flt</span><span class="op" id="2286053">.</span><span class="ident" id="2286054">mantbits</span><span class="op" id="2286062">)</span><span class="op" id="2286063">)</span>&nbsp;<span class="op" id="2286065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286069">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2286106">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2286114">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286118">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286151">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286217">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286285">upper</span>&nbsp;<span class="op" id="2286291">:=</span>&nbsp;<span class="builtinfunc" id="2286294">new</span><span class="op" id="2286297">(</span><span class="ident" id="2286298">decimal</span><span class="op" id="2286305">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286308">upper</span><span class="op" id="2286313">.</span><span class="ident" id="2286314">Assign</span><span class="op" id="2286320">(</span><span class="ident" id="2286321">mant</span><span class="op" id="2286325">*</span><span class="num" id="2286326">2</span>&nbsp;<span class="op" id="2286328">+</span>&nbsp;<span class="num" id="2286330">1</span><span class="op" id="2286331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286334">upper</span><span class="op" id="2286339">.</span><span class="ident" id="2286340">Shift</span><span class="op" id="2286345">(</span><span class="ident" id="2286346">exp</span>&nbsp;<span class="op" id="2286350">-</span>&nbsp;<span class="builtintype" id="2286352">int</span><span class="op" id="2286355">(</span><span class="ident" id="2286356">flt</span><span class="op" id="2286359">.</span><span class="ident" id="2286360">mantbits</span><span class="op" id="2286368">)</span>&nbsp;<span class="op" id="2286370">-</span>&nbsp;<span class="num" id="2286372">1</span><span class="op" id="2286373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286377">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286410">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286475">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286551">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286616">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2286666">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2286738">var</span>&nbsp;<span class="ident" id="2286742">mantlo</span>&nbsp;<span class="ident" id="2286749">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2286757">var</span>&nbsp;<span class="ident" id="2286761">explo</span>&nbsp;<span class="builtintype" id="2286767">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2286772">if</span>&nbsp;<span class="ident" id="2286775">mant</span>&nbsp;<span class="op" id="2286780">&gt;</span>&nbsp;<span class="num" id="2286782">1</span><span class="op" id="2286783">&lt;&lt;</span><span class="ident" id="2286785">flt</span><span class="op" id="2286788">.</span><span class="ident" id="2286789">mantbits</span>&nbsp;<span class="op" id="2286798">||</span>&nbsp;<span class="ident" id="2286801">exp</span>&nbsp;<span class="op" id="2286805">==</span>&nbsp;<span class="ident" id="2286808">minexp</span>&nbsp;<span class="op" id="2286815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286819">mantlo</span>&nbsp;<span class="op" id="2286826">=</span>&nbsp;<span class="ident" id="2286828">mant</span>&nbsp;<span class="op" id="2286833">-</span>&nbsp;<span class="num" id="2286835">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286839">explo</span>&nbsp;<span class="op" id="2286845">=</span>&nbsp;<span class="ident" id="2286847">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2286852">}</span>&nbsp;<span class="keyword" id="2286854">else</span>&nbsp;<span class="op" id="2286859">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286863">mantlo</span>&nbsp;<span class="op" id="2286870">=</span>&nbsp;<span class="ident" id="2286872">mant</span><span class="op" id="2286876">*</span><span class="num" id="2286877">2</span>&nbsp;<span class="op" id="2286879">-</span>&nbsp;<span class="num" id="2286881">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286885">explo</span>&nbsp;<span class="op" id="2286891">=</span>&nbsp;<span class="ident" id="2286893">exp</span>&nbsp;<span class="op" id="2286897">-</span>&nbsp;<span class="num" id="2286899">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2286902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286905">lower</span>&nbsp;<span class="op" id="2286911">:=</span>&nbsp;<span class="builtinfunc" id="2286914">new</span><span class="op" id="2286917">(</span><span class="ident" id="2286918">decimal</span><span class="op" id="2286925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286928">lower</span><span class="op" id="2286933">.</span><span class="ident" id="2286934">Assign</span><span class="op" id="2286940">(</span><span class="ident" id="2286941">mantlo</span><span class="op" id="2286947">*</span><span class="num" id="2286948">2</span>&nbsp;<span class="op" id="2286950">+</span>&nbsp;<span class="num" id="2286952">1</span><span class="op" id="2286953">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2286956">lower</span><span class="op" id="2286961">.</span><span class="ident" id="2286962">Shift</span><span class="op" id="2286967">(</span><span class="ident" id="2286968">explo</span>&nbsp;<span class="op" id="2286974">-</span>&nbsp;<span class="builtintype" id="2286976">int</span><span class="op" id="2286979">(</span><span class="ident" id="2286980">flt</span><span class="op" id="2286983">.</span><span class="ident" id="2286984">mantbits</span><span class="op" id="2286992">)</span>&nbsp;<span class="op" id="2286994">-</span>&nbsp;<span class="num" id="2286996">1</span><span class="op" id="2286997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287001">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287061">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287123">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287187">inclusive</span>&nbsp;<span class="op" id="2287197">:=</span>&nbsp;<span class="ident" id="2287200">mant</span><span class="op" id="2287204">%</span><span class="num" id="2287205">2</span>&nbsp;<span class="op" id="2287207">==</span>&nbsp;<span class="num" id="2287210">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287214">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287279">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2287349">for</span>&nbsp;<span class="ident" id="2287353">i</span>&nbsp;<span class="op" id="2287355">:=</span>&nbsp;<span class="num" id="2287358">0</span><span class="op" id="2287359">;</span>&nbsp;<span class="ident" id="2287361">i</span>&nbsp;<span class="op" id="2287363">&lt;</span>&nbsp;<span class="ident" id="2287365">d</span><span class="op" id="2287366">.</span><span class="ident" id="2287367">nd</span><span class="op" id="2287369">;</span>&nbsp;<span class="ident" id="2287371">i</span><span class="op" id="2287372">++</span>&nbsp;<span class="op" id="2287375">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2287379">var</span>&nbsp;<span class="ident" id="2287383">l</span><span class="op" id="2287384">,</span>&nbsp;<span class="ident" id="2287386">m</span><span class="op" id="2287387">,</span>&nbsp;<span class="ident" id="2287389">u</span>&nbsp;<span class="builtintype" id="2287391">byte</span>&nbsp;<span class="comment" id="2287396">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2287429">if</span>&nbsp;<span class="ident" id="2287432">i</span>&nbsp;<span class="op" id="2287434">&lt;</span>&nbsp;<span class="ident" id="2287436">lower</span><span class="op" id="2287441">.</span><span class="ident" id="2287442">nd</span>&nbsp;<span class="op" id="2287445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287450">l</span>&nbsp;<span class="op" id="2287452">=</span>&nbsp;<span class="ident" id="2287454">lower</span><span class="op" id="2287459">.</span><span class="ident" id="2287460">d</span><span class="op" id="2287461">[</span><span class="ident" id="2287462">i</span><span class="op" id="2287463">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2287467">}</span>&nbsp;<span class="keyword" id="2287469">else</span>&nbsp;<span class="op" id="2287474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287479">l</span>&nbsp;<span class="op" id="2287481">=</span>&nbsp;<span class="string" id="2287483">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2287489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287493">m</span>&nbsp;<span class="op" id="2287495">=</span>&nbsp;<span class="ident" id="2287497">d</span><span class="op" id="2287498">.</span><span class="ident" id="2287499">d</span><span class="op" id="2287500">[</span><span class="ident" id="2287501">i</span><span class="op" id="2287502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2287506">if</span>&nbsp;<span class="ident" id="2287509">i</span>&nbsp;<span class="op" id="2287511">&lt;</span>&nbsp;<span class="ident" id="2287513">upper</span><span class="op" id="2287518">.</span><span class="ident" id="2287519">nd</span>&nbsp;<span class="op" id="2287522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287527">u</span>&nbsp;<span class="op" id="2287529">=</span>&nbsp;<span class="ident" id="2287531">upper</span><span class="op" id="2287536">.</span><span class="ident" id="2287537">d</span><span class="op" id="2287538">[</span><span class="ident" id="2287539">i</span><span class="op" id="2287540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2287544">}</span>&nbsp;<span class="keyword" id="2287546">else</span>&nbsp;<span class="op" id="2287551">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287556">u</span>&nbsp;<span class="op" id="2287558">=</span>&nbsp;<span class="string" id="2287560">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2287566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287571">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287637">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287711">okdown</span>&nbsp;<span class="op" id="2287718">:=</span>&nbsp;<span class="ident" id="2287721">l</span>&nbsp;<span class="op" id="2287723">!=</span>&nbsp;<span class="ident" id="2287726">m</span>&nbsp;<span class="op" id="2287728">||</span>&nbsp;<span class="op" id="2287731">(</span><span class="ident" id="2287732">inclusive</span>&nbsp;<span class="op" id="2287742">&amp;&amp;</span>&nbsp;<span class="ident" id="2287745">l</span>&nbsp;<span class="op" id="2287747">==</span>&nbsp;<span class="ident" id="2287750">m</span>&nbsp;<span class="op" id="2287752">&amp;&amp;</span>&nbsp;<span class="ident" id="2287755">i</span><span class="op" id="2287756">+</span><span class="num" id="2287757">1</span>&nbsp;<span class="op" id="2287759">==</span>&nbsp;<span class="ident" id="2287762">lower</span><span class="op" id="2287767">.</span><span class="ident" id="2287768">nd</span><span class="op" id="2287770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287775">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287832">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2287914">okup</span>&nbsp;<span class="op" id="2287919">:=</span>&nbsp;<span class="ident" id="2287922">m</span>&nbsp;<span class="op" id="2287924">!=</span>&nbsp;<span class="ident" id="2287927">u</span>&nbsp;<span class="op" id="2287929">&amp;&amp;</span>&nbsp;<span class="op" id="2287932">(</span><span class="ident" id="2287933">inclusive</span>&nbsp;<span class="op" id="2287943">||</span>&nbsp;<span class="ident" id="2287946">m</span><span class="op" id="2287947">+</span><span class="num" id="2287948">1</span>&nbsp;<span class="op" id="2287950">&lt;</span>&nbsp;<span class="ident" id="2287952">u</span>&nbsp;<span class="op" id="2287954">||</span>&nbsp;<span class="ident" id="2287957">i</span><span class="op" id="2287958">+</span><span class="num" id="2287959">1</span>&nbsp;<span class="op" id="2287961">&lt;</span>&nbsp;<span class="ident" id="2287963">upper</span><span class="op" id="2287968">.</span><span class="ident" id="2287969">nd</span><span class="op" id="2287971">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2287976">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288039">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288080">switch</span>&nbsp;<span class="op" id="2288087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288091">case</span>&nbsp;<span class="ident" id="2288096">okdown</span>&nbsp;<span class="op" id="2288103">&amp;&amp;</span>&nbsp;<span class="ident" id="2288106">okup</span><span class="op" id="2288110">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288115">d</span><span class="op" id="2288116">.</span><span class="ident" id="2288117">Round</span><span class="op" id="2288122">(</span><span class="ident" id="2288123">i</span>&nbsp;<span class="op" id="2288125">+</span>&nbsp;<span class="num" id="2288127">1</span><span class="op" id="2288128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288133">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288142">case</span>&nbsp;<span class="ident" id="2288147">okdown</span><span class="op" id="2288153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288158">d</span><span class="op" id="2288159">.</span><span class="ident" id="2288160">RoundDown</span><span class="op" id="2288169">(</span><span class="ident" id="2288170">i</span>&nbsp;<span class="op" id="2288172">+</span>&nbsp;<span class="num" id="2288174">1</span><span class="op" id="2288175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288180">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288189">case</span>&nbsp;<span class="ident" id="2288194">okup</span><span class="op" id="2288198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288203">d</span><span class="op" id="2288204">.</span><span class="ident" id="2288205">RoundUp</span><span class="op" id="2288212">(</span><span class="ident" id="2288213">i</span>&nbsp;<span class="op" id="2288215">+</span>&nbsp;<span class="num" id="2288217">1</span><span class="op" id="2288218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288223">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288235">}</span><br>
<span class="lineno">325</span><span class="op" id="2288237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2288240">type</span>&nbsp;<span class="ident" id="2288245">decimalSlice</span>&nbsp;<span class="keyword" id="2288258">struct</span>&nbsp;<span class="op" id="2288265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288268">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288275">[</span><span class="op" id="2288276">]</span><span class="builtintype" id="2288277">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288283">nd</span><span class="op" id="2288285">,</span>&nbsp;<span class="ident" id="2288287">dp</span>&nbsp;<span class="builtintype" id="2288290">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288295">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2288302">bool</span><br>
<span class="lineno"></span><span class="op" id="2288307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2288310">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2288331">func</span>&nbsp;<span class="ident" id="2288336">fmtE</span><span class="op" id="2288340">(</span><span class="ident" id="2288341">dst</span>&nbsp;<span class="op" id="2288345">[</span><span class="op" id="2288346">]</span><span class="builtintype" id="2288347">byte</span><span class="op" id="2288351">,</span>&nbsp;<span class="ident" id="2288353">neg</span>&nbsp;<span class="builtintype" id="2288357">bool</span><span class="op" id="2288361">,</span>&nbsp;<span class="ident" id="2288363">d</span>&nbsp;<span class="ident" id="2288365">decimalSlice</span><span class="op" id="2288377">,</span>&nbsp;<span class="ident" id="2288379">prec</span>&nbsp;<span class="builtintype" id="2288384">int</span><span class="op" id="2288387">,</span>&nbsp;<span class="ident" id="2288389">fmt</span>&nbsp;<span class="builtintype" id="2288393">byte</span><span class="op" id="2288397">)</span>&nbsp;<span class="op" id="2288399">[</span><span class="op" id="2288400">]</span><span class="builtintype" id="2288401">byte</span>&nbsp;<span class="op" id="2288406">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288409">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288418">if</span>&nbsp;<span class="ident" id="2288421">neg</span>&nbsp;<span class="op" id="2288425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288429">dst</span>&nbsp;<span class="op" id="2288433">=</span>&nbsp;<span class="builtinfunc" id="2288435">append</span><span class="op" id="2288441">(</span><span class="ident" id="2288442">dst</span><span class="op" id="2288445">,</span>&nbsp;<span class="string" id="2288447">&#39;-&#39;</span><span class="op" id="2288450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288457">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288473">ch</span>&nbsp;<span class="op" id="2288476">:=</span>&nbsp;<span class="builtintype" id="2288479">byte</span><span class="op" id="2288483">(</span><span class="string" id="2288484">&#39;0&#39;</span><span class="op" id="2288487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288490">if</span>&nbsp;<span class="ident" id="2288493">d</span><span class="op" id="2288494">.</span><span class="ident" id="2288495">nd</span>&nbsp;<span class="op" id="2288498">!=</span>&nbsp;<span class="num" id="2288501">0</span>&nbsp;<span class="op" id="2288503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288507">ch</span>&nbsp;<span class="op" id="2288510">=</span>&nbsp;<span class="ident" id="2288512">d</span><span class="op" id="2288513">.</span><span class="ident" id="2288514">d</span><span class="op" id="2288515">[</span><span class="num" id="2288516">0</span><span class="op" id="2288517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288520">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288523">dst</span>&nbsp;<span class="op" id="2288527">=</span>&nbsp;<span class="builtinfunc" id="2288529">append</span><span class="op" id="2288535">(</span><span class="ident" id="2288536">dst</span><span class="op" id="2288539">,</span>&nbsp;<span class="ident" id="2288541">ch</span><span class="op" id="2288543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288547">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288563">if</span>&nbsp;<span class="ident" id="2288566">prec</span>&nbsp;<span class="op" id="2288571">&gt;</span>&nbsp;<span class="num" id="2288573">0</span>&nbsp;<span class="op" id="2288575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288579">dst</span>&nbsp;<span class="op" id="2288583">=</span>&nbsp;<span class="builtinfunc" id="2288585">append</span><span class="op" id="2288591">(</span><span class="ident" id="2288592">dst</span><span class="op" id="2288595">,</span>&nbsp;<span class="string" id="2288597">&#39;.&#39;</span><span class="op" id="2288600">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288604">i</span>&nbsp;<span class="op" id="2288606">:=</span>&nbsp;<span class="num" id="2288609">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288613">m</span>&nbsp;<span class="op" id="2288615">:=</span>&nbsp;<span class="ident" id="2288618">d</span><span class="op" id="2288619">.</span><span class="ident" id="2288620">nd</span>&nbsp;<span class="op" id="2288623">+</span>&nbsp;<span class="ident" id="2288625">prec</span>&nbsp;<span class="op" id="2288630">+</span>&nbsp;<span class="num" id="2288632">1</span>&nbsp;<span class="op" id="2288634">-</span>&nbsp;<span class="ident" id="2288636">max</span><span class="op" id="2288639">(</span><span class="ident" id="2288640">d</span><span class="op" id="2288641">.</span><span class="ident" id="2288642">nd</span><span class="op" id="2288644">,</span>&nbsp;<span class="ident" id="2288646">prec</span><span class="op" id="2288650">+</span><span class="num" id="2288651">1</span><span class="op" id="2288652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288656">for</span>&nbsp;<span class="ident" id="2288660">i</span>&nbsp;<span class="op" id="2288662">&lt;</span>&nbsp;<span class="ident" id="2288664">m</span>&nbsp;<span class="op" id="2288666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288671">dst</span>&nbsp;<span class="op" id="2288675">=</span>&nbsp;<span class="builtinfunc" id="2288677">append</span><span class="op" id="2288683">(</span><span class="ident" id="2288684">dst</span><span class="op" id="2288687">,</span>&nbsp;<span class="ident" id="2288689">d</span><span class="op" id="2288690">.</span><span class="ident" id="2288691">d</span><span class="op" id="2288692">[</span><span class="ident" id="2288693">i</span><span class="op" id="2288694">]</span><span class="op" id="2288695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288700">i</span><span class="op" id="2288701">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288710">for</span>&nbsp;<span class="ident" id="2288714">i</span>&nbsp;<span class="op" id="2288716">&lt;=</span>&nbsp;<span class="ident" id="2288719">prec</span>&nbsp;<span class="op" id="2288724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288729">dst</span>&nbsp;<span class="op" id="2288733">=</span>&nbsp;<span class="builtinfunc" id="2288735">append</span><span class="op" id="2288741">(</span><span class="ident" id="2288742">dst</span><span class="op" id="2288745">,</span>&nbsp;<span class="string" id="2288747">&#39;0&#39;</span><span class="op" id="2288750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288755">i</span><span class="op" id="2288756">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288761">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288768">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288776">dst</span>&nbsp;<span class="op" id="2288780">=</span>&nbsp;<span class="builtinfunc" id="2288782">append</span><span class="op" id="2288788">(</span><span class="ident" id="2288789">dst</span><span class="op" id="2288792">,</span>&nbsp;<span class="ident" id="2288794">fmt</span><span class="op" id="2288797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288800">exp</span>&nbsp;<span class="op" id="2288804">:=</span>&nbsp;<span class="ident" id="2288807">d</span><span class="op" id="2288808">.</span><span class="ident" id="2288809">dp</span>&nbsp;<span class="op" id="2288812">-</span>&nbsp;<span class="num" id="2288814">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288817">if</span>&nbsp;<span class="ident" id="2288820">d</span><span class="op" id="2288821">.</span><span class="ident" id="2288822">nd</span>&nbsp;<span class="op" id="2288825">==</span>&nbsp;<span class="num" id="2288828">0</span>&nbsp;<span class="op" id="2288830">{</span>&nbsp;<span class="comment" id="2288832">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288868">exp</span>&nbsp;<span class="op" id="2288872">=</span>&nbsp;<span class="num" id="2288874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288880">if</span>&nbsp;<span class="ident" id="2288883">exp</span>&nbsp;<span class="op" id="2288887">&lt;</span>&nbsp;<span class="num" id="2288889">0</span>&nbsp;<span class="op" id="2288891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288895">ch</span>&nbsp;<span class="op" id="2288898">=</span>&nbsp;<span class="string" id="2288900">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288906">exp</span>&nbsp;<span class="op" id="2288910">=</span>&nbsp;<span class="op" id="2288912">-</span><span class="ident" id="2288913">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288918">}</span>&nbsp;<span class="keyword" id="2288920">else</span>&nbsp;<span class="op" id="2288925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288929">ch</span>&nbsp;<span class="op" id="2288932">=</span>&nbsp;<span class="string" id="2288934">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2288939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288942">dst</span>&nbsp;<span class="op" id="2288946">=</span>&nbsp;<span class="builtinfunc" id="2288948">append</span><span class="op" id="2288954">(</span><span class="ident" id="2288955">dst</span><span class="op" id="2288958">,</span>&nbsp;<span class="ident" id="2288960">ch</span><span class="op" id="2288962">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2288966">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2288975">var</span>&nbsp;<span class="ident" id="2288979">buf</span>&nbsp;<span class="op" id="2288983">[</span><span class="num" id="2288984">3</span><span class="op" id="2288985">]</span><span class="builtintype" id="2288986">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2288992">i</span>&nbsp;<span class="op" id="2288994">:=</span>&nbsp;<span class="builtinfunc" id="2288997">len</span><span class="op" id="2289000">(</span><span class="ident" id="2289001">buf</span><span class="op" id="2289004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289007">for</span>&nbsp;<span class="ident" id="2289011">exp</span>&nbsp;<span class="op" id="2289015">&gt;=</span>&nbsp;<span class="num" id="2289018">10</span>&nbsp;<span class="op" id="2289021">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289025">i</span><span class="op" id="2289026">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289031">buf</span><span class="op" id="2289034">[</span><span class="ident" id="2289035">i</span><span class="op" id="2289036">]</span>&nbsp;<span class="op" id="2289038">=</span>&nbsp;<span class="builtintype" id="2289040">byte</span><span class="op" id="2289044">(</span><span class="ident" id="2289045">exp</span><span class="op" id="2289048">%</span><span class="num" id="2289049">10</span>&nbsp;<span class="op" id="2289052">+</span>&nbsp;<span class="string" id="2289054">&#39;0&#39;</span><span class="op" id="2289057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289061">exp</span>&nbsp;<span class="op" id="2289065">/=</span>&nbsp;<span class="num" id="2289068">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2289075">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289088">i</span><span class="op" id="2289089">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289093">buf</span><span class="op" id="2289096">[</span><span class="ident" id="2289097">i</span><span class="op" id="2289098">]</span>&nbsp;<span class="op" id="2289100">=</span>&nbsp;<span class="builtintype" id="2289102">byte</span><span class="op" id="2289106">(</span><span class="ident" id="2289107">exp</span>&nbsp;<span class="op" id="2289111">+</span>&nbsp;<span class="string" id="2289113">&#39;0&#39;</span><span class="op" id="2289116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289120">switch</span>&nbsp;<span class="ident" id="2289127">i</span>&nbsp;<span class="op" id="2289129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289132">case</span>&nbsp;<span class="num" id="2289137">0</span><span class="op" id="2289138">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289142">dst</span>&nbsp;<span class="op" id="2289146">=</span>&nbsp;<span class="builtinfunc" id="2289148">append</span><span class="op" id="2289154">(</span><span class="ident" id="2289155">dst</span><span class="op" id="2289158">,</span>&nbsp;<span class="ident" id="2289160">buf</span><span class="op" id="2289163">[</span><span class="num" id="2289164">0</span><span class="op" id="2289165">]</span><span class="op" id="2289166">,</span>&nbsp;<span class="ident" id="2289168">buf</span><span class="op" id="2289171">[</span><span class="num" id="2289172">1</span><span class="op" id="2289173">]</span><span class="op" id="2289174">,</span>&nbsp;<span class="ident" id="2289176">buf</span><span class="op" id="2289179">[</span><span class="num" id="2289180">2</span><span class="op" id="2289181">]</span><span class="op" id="2289182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289185">case</span>&nbsp;<span class="num" id="2289190">1</span><span class="op" id="2289191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289195">dst</span>&nbsp;<span class="op" id="2289199">=</span>&nbsp;<span class="builtinfunc" id="2289201">append</span><span class="op" id="2289207">(</span><span class="ident" id="2289208">dst</span><span class="op" id="2289211">,</span>&nbsp;<span class="ident" id="2289213">buf</span><span class="op" id="2289216">[</span><span class="num" id="2289217">1</span><span class="op" id="2289218">]</span><span class="op" id="2289219">,</span>&nbsp;<span class="ident" id="2289221">buf</span><span class="op" id="2289224">[</span><span class="num" id="2289225">2</span><span class="op" id="2289226">]</span><span class="op" id="2289227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289230">case</span>&nbsp;<span class="num" id="2289235">2</span><span class="op" id="2289236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2289240">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289260">dst</span>&nbsp;<span class="op" id="2289264">=</span>&nbsp;<span class="builtinfunc" id="2289266">append</span><span class="op" id="2289272">(</span><span class="ident" id="2289273">dst</span><span class="op" id="2289276">,</span>&nbsp;<span class="string" id="2289278">&#39;0&#39;</span><span class="op" id="2289281">,</span>&nbsp;<span class="ident" id="2289283">buf</span><span class="op" id="2289286">[</span><span class="num" id="2289287">2</span><span class="op" id="2289288">]</span><span class="op" id="2289289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289295">return</span>&nbsp;<span class="ident" id="2289302">dst</span><br>
<span class="lineno"></span><span class="op" id="2289306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2289309">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2289331">func</span>&nbsp;<span class="ident" id="2289336">fmtF</span><span class="op" id="2289340">(</span><span class="ident" id="2289341">dst</span>&nbsp;<span class="op" id="2289345">[</span><span class="op" id="2289346">]</span><span class="builtintype" id="2289347">byte</span><span class="op" id="2289351">,</span>&nbsp;<span class="ident" id="2289353">neg</span>&nbsp;<span class="builtintype" id="2289357">bool</span><span class="op" id="2289361">,</span>&nbsp;<span class="ident" id="2289363">d</span>&nbsp;<span class="ident" id="2289365">decimalSlice</span><span class="op" id="2289377">,</span>&nbsp;<span class="ident" id="2289379">prec</span>&nbsp;<span class="builtintype" id="2289384">int</span><span class="op" id="2289387">)</span>&nbsp;<span class="op" id="2289389">[</span><span class="op" id="2289390">]</span><span class="builtintype" id="2289391">byte</span>&nbsp;<span class="op" id="2289396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2289399">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289408">if</span>&nbsp;<span class="ident" id="2289411">neg</span>&nbsp;<span class="op" id="2289415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289419">dst</span>&nbsp;<span class="op" id="2289423">=</span>&nbsp;<span class="builtinfunc" id="2289425">append</span><span class="op" id="2289431">(</span><span class="ident" id="2289432">dst</span><span class="op" id="2289435">,</span>&nbsp;<span class="string" id="2289437">&#39;-&#39;</span><span class="op" id="2289440">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2289447">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289489">if</span>&nbsp;<span class="ident" id="2289492">d</span><span class="op" id="2289493">.</span><span class="ident" id="2289494">dp</span>&nbsp;<span class="op" id="2289497">&gt;</span>&nbsp;<span class="num" id="2289499">0</span>&nbsp;<span class="op" id="2289501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289505">var</span>&nbsp;<span class="ident" id="2289509">i</span>&nbsp;<span class="builtintype" id="2289511">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289517">for</span>&nbsp;<span class="ident" id="2289521">i</span>&nbsp;<span class="op" id="2289523">=</span>&nbsp;<span class="num" id="2289525">0</span><span class="op" id="2289526">;</span>&nbsp;<span class="ident" id="2289528">i</span>&nbsp;<span class="op" id="2289530">&lt;</span>&nbsp;<span class="ident" id="2289532">d</span><span class="op" id="2289533">.</span><span class="ident" id="2289534">dp</span>&nbsp;<span class="op" id="2289537">&amp;&amp;</span>&nbsp;<span class="ident" id="2289540">i</span>&nbsp;<span class="op" id="2289542">&lt;</span>&nbsp;<span class="ident" id="2289544">d</span><span class="op" id="2289545">.</span><span class="ident" id="2289546">nd</span><span class="op" id="2289548">;</span>&nbsp;<span class="ident" id="2289550">i</span><span class="op" id="2289551">++</span>&nbsp;<span class="op" id="2289554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289559">dst</span>&nbsp;<span class="op" id="2289563">=</span>&nbsp;<span class="builtinfunc" id="2289565">append</span><span class="op" id="2289571">(</span><span class="ident" id="2289572">dst</span><span class="op" id="2289575">,</span>&nbsp;<span class="ident" id="2289577">d</span><span class="op" id="2289578">.</span><span class="ident" id="2289579">d</span><span class="op" id="2289580">[</span><span class="ident" id="2289581">i</span><span class="op" id="2289582">]</span><span class="op" id="2289583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289591">for</span>&nbsp;<span class="op" id="2289595">;</span>&nbsp;<span class="ident" id="2289597">i</span>&nbsp;<span class="op" id="2289599">&lt;</span>&nbsp;<span class="ident" id="2289601">d</span><span class="op" id="2289602">.</span><span class="ident" id="2289603">dp</span><span class="op" id="2289605">;</span>&nbsp;<span class="ident" id="2289607">i</span><span class="op" id="2289608">++</span>&nbsp;<span class="op" id="2289611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289616">dst</span>&nbsp;<span class="op" id="2289620">=</span>&nbsp;<span class="builtinfunc" id="2289622">append</span><span class="op" id="2289628">(</span><span class="ident" id="2289629">dst</span><span class="op" id="2289632">,</span>&nbsp;<span class="string" id="2289634">&#39;0&#39;</span><span class="op" id="2289637">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289644">}</span>&nbsp;<span class="keyword" id="2289646">else</span>&nbsp;<span class="op" id="2289651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289655">dst</span>&nbsp;<span class="op" id="2289659">=</span>&nbsp;<span class="builtinfunc" id="2289661">append</span><span class="op" id="2289667">(</span><span class="ident" id="2289668">dst</span><span class="op" id="2289671">,</span>&nbsp;<span class="string" id="2289673">&#39;0&#39;</span><span class="op" id="2289676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2289683">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289696">if</span>&nbsp;<span class="ident" id="2289699">prec</span>&nbsp;<span class="op" id="2289704">&gt;</span>&nbsp;<span class="num" id="2289706">0</span>&nbsp;<span class="op" id="2289708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289712">dst</span>&nbsp;<span class="op" id="2289716">=</span>&nbsp;<span class="builtinfunc" id="2289718">append</span><span class="op" id="2289724">(</span><span class="ident" id="2289725">dst</span><span class="op" id="2289728">,</span>&nbsp;<span class="string" id="2289730">&#39;.&#39;</span><span class="op" id="2289733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289737">for</span>&nbsp;<span class="ident" id="2289741">i</span>&nbsp;<span class="op" id="2289743">:=</span>&nbsp;<span class="num" id="2289746">0</span><span class="op" id="2289747">;</span>&nbsp;<span class="ident" id="2289749">i</span>&nbsp;<span class="op" id="2289751">&lt;</span>&nbsp;<span class="ident" id="2289753">prec</span><span class="op" id="2289757">;</span>&nbsp;<span class="ident" id="2289759">i</span><span class="op" id="2289760">++</span>&nbsp;<span class="op" id="2289763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289768">ch</span>&nbsp;<span class="op" id="2289771">:=</span>&nbsp;<span class="builtintype" id="2289774">byte</span><span class="op" id="2289778">(</span><span class="string" id="2289779">&#39;0&#39;</span><span class="op" id="2289782">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289787">if</span>&nbsp;<span class="ident" id="2289790">j</span>&nbsp;<span class="op" id="2289792">:=</span>&nbsp;<span class="ident" id="2289795">d</span><span class="op" id="2289796">.</span><span class="ident" id="2289797">dp</span>&nbsp;<span class="op" id="2289800">+</span>&nbsp;<span class="ident" id="2289802">i</span><span class="op" id="2289803">;</span>&nbsp;<span class="num" id="2289805">0</span>&nbsp;<span class="op" id="2289807">&lt;=</span>&nbsp;<span class="ident" id="2289810">j</span>&nbsp;<span class="op" id="2289812">&amp;&amp;</span>&nbsp;<span class="ident" id="2289815">j</span>&nbsp;<span class="op" id="2289817">&lt;</span>&nbsp;<span class="ident" id="2289819">d</span><span class="op" id="2289820">.</span><span class="ident" id="2289821">nd</span>&nbsp;<span class="op" id="2289824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289830">ch</span>&nbsp;<span class="op" id="2289833">=</span>&nbsp;<span class="ident" id="2289835">d</span><span class="op" id="2289836">.</span><span class="ident" id="2289837">d</span><span class="op" id="2289838">[</span><span class="ident" id="2289839">j</span><span class="op" id="2289840">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2289850">dst</span>&nbsp;<span class="op" id="2289854">=</span>&nbsp;<span class="builtinfunc" id="2289856">append</span><span class="op" id="2289862">(</span><span class="ident" id="2289863">dst</span><span class="op" id="2289866">,</span>&nbsp;<span class="ident" id="2289868">ch</span><span class="op" id="2289870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289874">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2289877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289881">return</span>&nbsp;<span class="ident" id="2289888">dst</span><br>
<span class="lineno"></span><span class="op" id="2289892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2289895">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2289917">func</span>&nbsp;<span class="ident" id="2289922">fmtB</span><span class="op" id="2289926">(</span><span class="ident" id="2289927">dst</span>&nbsp;<span class="op" id="2289931">[</span><span class="op" id="2289932">]</span><span class="builtintype" id="2289933">byte</span><span class="op" id="2289937">,</span>&nbsp;<span class="ident" id="2289939">neg</span>&nbsp;<span class="builtintype" id="2289943">bool</span><span class="op" id="2289947">,</span>&nbsp;<span class="ident" id="2289949">mant</span>&nbsp;<span class="ident" id="2289954">uint64</span><span class="op" id="2289960">,</span>&nbsp;<span class="ident" id="2289962">exp</span>&nbsp;<span class="builtintype" id="2289966">int</span><span class="op" id="2289969">,</span>&nbsp;<span class="ident" id="2289971">flt</span>&nbsp;<span class="op" id="2289975">*</span><span class="ident" id="2289976">floatInfo</span><span class="op" id="2289985">)</span>&nbsp;<span class="op" id="2289987">[</span><span class="op" id="2289988">]</span><span class="builtintype" id="2289989">byte</span>&nbsp;<span class="op" id="2289994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2289997">var</span>&nbsp;<span class="ident" id="2290001">buf</span>&nbsp;<span class="op" id="2290005">[</span><span class="num" id="2290006">50</span><span class="op" id="2290008">]</span><span class="builtintype" id="2290009">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290015">w</span>&nbsp;<span class="op" id="2290017">:=</span>&nbsp;<span class="builtinfunc" id="2290020">len</span><span class="op" id="2290023">(</span><span class="ident" id="2290024">buf</span><span class="op" id="2290027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290030">exp</span>&nbsp;<span class="op" id="2290034">-=</span>&nbsp;<span class="builtintype" id="2290037">int</span><span class="op" id="2290040">(</span><span class="ident" id="2290041">flt</span><span class="op" id="2290044">.</span><span class="ident" id="2290045">mantbits</span><span class="op" id="2290053">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290056">esign</span>&nbsp;<span class="op" id="2290062">:=</span>&nbsp;<span class="builtintype" id="2290065">byte</span><span class="op" id="2290069">(</span><span class="string" id="2290070">&#39;+&#39;</span><span class="op" id="2290073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290076">if</span>&nbsp;<span class="ident" id="2290079">exp</span>&nbsp;<span class="op" id="2290083">&lt;</span>&nbsp;<span class="num" id="2290085">0</span>&nbsp;<span class="op" id="2290087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290091">esign</span>&nbsp;<span class="op" id="2290097">=</span>&nbsp;<span class="string" id="2290099">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290105">exp</span>&nbsp;<span class="op" id="2290109">=</span>&nbsp;<span class="op" id="2290111">-</span><span class="ident" id="2290112">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2290117">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290120">n</span>&nbsp;<span class="op" id="2290122">:=</span>&nbsp;<span class="num" id="2290125">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290128">for</span>&nbsp;<span class="ident" id="2290132">exp</span>&nbsp;<span class="op" id="2290136">&gt;</span>&nbsp;<span class="num" id="2290138">0</span>&nbsp;<span class="op" id="2290140">||</span>&nbsp;<span class="ident" id="2290143">n</span>&nbsp;<span class="op" id="2290145">&lt;</span>&nbsp;<span class="num" id="2290147">1</span>&nbsp;<span class="op" id="2290149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290153">n</span><span class="op" id="2290154">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290159">w</span><span class="op" id="2290160">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290165">buf</span><span class="op" id="2290168">[</span><span class="ident" id="2290169">w</span><span class="op" id="2290170">]</span>&nbsp;<span class="op" id="2290172">=</span>&nbsp;<span class="builtintype" id="2290174">byte</span><span class="op" id="2290178">(</span><span class="ident" id="2290179">exp</span><span class="op" id="2290182">%</span><span class="num" id="2290183">10</span>&nbsp;<span class="op" id="2290186">+</span>&nbsp;<span class="string" id="2290188">&#39;0&#39;</span><span class="op" id="2290191">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290195">exp</span>&nbsp;<span class="op" id="2290199">/=</span>&nbsp;<span class="num" id="2290202">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2290206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290209">w</span><span class="op" id="2290210">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290214">buf</span><span class="op" id="2290217">[</span><span class="ident" id="2290218">w</span><span class="op" id="2290219">]</span>&nbsp;<span class="op" id="2290221">=</span>&nbsp;<span class="ident" id="2290223">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290230">w</span><span class="op" id="2290231">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290235">buf</span><span class="op" id="2290238">[</span><span class="ident" id="2290239">w</span><span class="op" id="2290240">]</span>&nbsp;<span class="op" id="2290242">=</span>&nbsp;<span class="string" id="2290244">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290249">n</span>&nbsp;<span class="op" id="2290251">=</span>&nbsp;<span class="num" id="2290253">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290256">for</span>&nbsp;<span class="ident" id="2290260">mant</span>&nbsp;<span class="op" id="2290265">&gt;</span>&nbsp;<span class="num" id="2290267">0</span>&nbsp;<span class="op" id="2290269">||</span>&nbsp;<span class="ident" id="2290272">n</span>&nbsp;<span class="op" id="2290274">&lt;</span>&nbsp;<span class="num" id="2290276">1</span>&nbsp;<span class="op" id="2290278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290282">n</span><span class="op" id="2290283">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290288">w</span><span class="op" id="2290289">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290294">buf</span><span class="op" id="2290297">[</span><span class="ident" id="2290298">w</span><span class="op" id="2290299">]</span>&nbsp;<span class="op" id="2290301">=</span>&nbsp;<span class="builtintype" id="2290303">byte</span><span class="op" id="2290307">(</span><span class="ident" id="2290308">mant</span><span class="op" id="2290312">%</span><span class="num" id="2290313">10</span>&nbsp;<span class="op" id="2290316">+</span>&nbsp;<span class="string" id="2290318">&#39;0&#39;</span><span class="op" id="2290321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290325">mant</span>&nbsp;<span class="op" id="2290330">/=</span>&nbsp;<span class="num" id="2290333">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2290337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290340">if</span>&nbsp;<span class="ident" id="2290343">neg</span>&nbsp;<span class="op" id="2290347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290351">w</span><span class="op" id="2290352">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2290357">buf</span><span class="op" id="2290360">[</span><span class="ident" id="2290361">w</span><span class="op" id="2290362">]</span>&nbsp;<span class="op" id="2290364">=</span>&nbsp;<span class="string" id="2290366">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2290371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290374">return</span>&nbsp;<span class="builtinfunc" id="2290381">append</span><span class="op" id="2290387">(</span><span class="ident" id="2290388">dst</span><span class="op" id="2290391">,</span>&nbsp;<span class="ident" id="2290393">buf</span><span class="op" id="2290396">[</span><span class="ident" id="2290397">w</span><span class="op" id="2290398">:</span><span class="op" id="2290399">]</span><span class="op" id="2290400">...</span><span class="op" id="2290403">)</span><br>
<span class="lineno"></span><span class="op" id="2290405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2290408">func</span>&nbsp;<span class="ident" id="2290413">max</span><span class="op" id="2290416">(</span><span class="ident" id="2290417">a</span><span class="op" id="2290418">,</span>&nbsp;<span class="ident" id="2290420">b</span>&nbsp;<span class="builtintype" id="2290422">int</span><span class="op" id="2290425">)</span>&nbsp;<span class="builtintype" id="2290427">int</span>&nbsp;<span class="op" id="2290431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290434">if</span>&nbsp;<span class="ident" id="2290437">a</span>&nbsp;<span class="op" id="2290439">&gt;</span>&nbsp;<span class="ident" id="2290441">b</span>&nbsp;<span class="op" id="2290443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290447">return</span>&nbsp;<span class="ident" id="2290454">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2290457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2290460">return</span>&nbsp;<span class="ident" id="2290467">b</span><br>
<span class="lineno">475</span><span class="op" id="2290469">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
