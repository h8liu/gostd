<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5977689">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5977744">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5977798">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5977849">package</span>&nbsp;<span class="ident" id="5977857">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5977862">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5977881">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5977929">import</span>&nbsp;<span class="op" id="5977936">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977939">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977948">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977958">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977965">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977971">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977977">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977985">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5977996">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978007">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5978014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978017">var</span>&nbsp;<span class="op" id="5978021">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978024">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978043">=</span>&nbsp;<span class="ident" id="5978045">errors</span><span class="op" id="5978051">.</span><span class="ident" id="5978052">New</span><span class="op" id="5978055">(</span><span class="string" id="5978056">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="5978085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978088">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978107">=</span>&nbsp;<span class="ident" id="5978109">errors</span><span class="op" id="5978115">.</span><span class="ident" id="5978116">New</span><span class="op" id="5978119">(</span><span class="string" id="5978120">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="5978156">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978159">ErrWriteAfterClose</span>&nbsp;<span class="op" id="5978178">=</span>&nbsp;<span class="ident" id="5978180">errors</span><span class="op" id="5978186">.</span><span class="ident" id="5978187">New</span><span class="op" id="5978190">(</span><span class="string" id="5978191">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="5978223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978226">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978245">=</span>&nbsp;<span class="ident" id="5978247">errors</span><span class="op" id="5978253">.</span><span class="ident" id="5978254">New</span><span class="op" id="5978257">(</span><span class="string" id="5978258">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="5978286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978289">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5978308">=</span>&nbsp;<span class="ident" id="5978310">errors</span><span class="op" id="5978316">.</span><span class="ident" id="5978317">New</span><span class="op" id="5978320">(</span><span class="string" id="5978321">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="5978384">)</span><br>
<span class="lineno"></span><span class="op" id="5978386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5978389">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5978465">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5978515">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="5978604">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="5978648">type</span>&nbsp;<span class="ident" id="5978653">Writer</span>&nbsp;<span class="keyword" id="5978660">struct</span>&nbsp;<span class="op" id="5978667">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978670">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978681">io</span><span class="op" id="5978683">.</span><span class="ident" id="5978684">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978692">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978703">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978710">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978721">int64</span>&nbsp;<span class="comment" id="5978727">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978780">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978791">int64</span>&nbsp;<span class="comment" id="5978797">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978853">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978864">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978870">usedBinary</span>&nbsp;<span class="builtintype" id="5978881">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978897">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978953">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="5978964">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978980">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979032">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979043">[</span><span class="ident" id="5979044">blockSize</span><span class="op" id="5979053">]</span><span class="builtintype" id="5979054">byte</span>&nbsp;<span class="comment" id="5979059">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979122">paxHdrBuff</span>&nbsp;<span class="op" id="5979133">[</span><span class="ident" id="5979134">blockSize</span><span class="op" id="5979143">]</span><span class="builtintype" id="5979144">byte</span>&nbsp;<span class="comment" id="5979149">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="5979207">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5979210">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5979258">func</span>&nbsp;<span class="ident" id="5979263">NewWriter</span><span class="op" id="5979272">(</span><span class="ident" id="5979273">w</span>&nbsp;<span class="ident" id="5979275">io</span><span class="op" id="5979277">.</span><span class="ident" id="5979278">Writer</span><span class="op" id="5979284">)</span>&nbsp;<span class="op" id="5979286">*</span><span class="ident" id="5979287">Writer</span>&nbsp;<span class="op" id="5979294">{</span>&nbsp;<span class="keyword" id="5979296">return</span>&nbsp;<span class="op" id="5979303">&amp;</span><span class="ident" id="5979304">Writer</span><span class="op" id="5979310">{</span><span class="ident" id="5979311">w</span><span class="op" id="5979312">:</span>&nbsp;<span class="ident" id="5979314">w</span><span class="op" id="5979315">}</span>&nbsp;<span class="op" id="5979317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979320">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="5979375">func</span>&nbsp;<span class="op" id="5979380">(</span><span class="ident" id="5979381">tw</span>&nbsp;<span class="op" id="5979384">*</span><span class="ident" id="5979385">Writer</span><span class="op" id="5979391">)</span>&nbsp;<span class="ident" id="5979393">Flush</span><span class="op" id="5979398">(</span><span class="op" id="5979399">)</span>&nbsp;<span class="builtintype" id="5979401">error</span>&nbsp;<span class="op" id="5979407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979410">if</span>&nbsp;<span class="ident" id="5979413">tw</span><span class="op" id="5979415">.</span><span class="ident" id="5979416">nb</span>&nbsp;<span class="op" id="5979419">&gt;</span>&nbsp;<span class="num" id="5979421">0</span>&nbsp;<span class="op" id="5979423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979427">tw</span><span class="op" id="5979429">.</span><span class="ident" id="5979430">err</span>&nbsp;<span class="op" id="5979434">=</span>&nbsp;<span class="ident" id="5979436">fmt</span><span class="op" id="5979439">.</span><span class="ident" id="5979440">Errorf</span><span class="op" id="5979446">(</span><span class="string" id="5979447">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5979485">,</span>&nbsp;<span class="ident" id="5979487">tw</span><span class="op" id="5979489">.</span><span class="ident" id="5979490">nb</span><span class="op" id="5979492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979496">return</span>&nbsp;<span class="ident" id="5979503">tw</span><span class="op" id="5979505">.</span><span class="ident" id="5979506">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979511">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979515">n</span>&nbsp;<span class="op" id="5979517">:=</span>&nbsp;<span class="ident" id="5979520">tw</span><span class="op" id="5979522">.</span><span class="ident" id="5979523">nb</span>&nbsp;<span class="op" id="5979526">+</span>&nbsp;<span class="ident" id="5979528">tw</span><span class="op" id="5979530">.</span><span class="ident" id="5979531">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979536">for</span>&nbsp;<span class="ident" id="5979540">n</span>&nbsp;<span class="op" id="5979542">&gt;</span>&nbsp;<span class="num" id="5979544">0</span>&nbsp;<span class="op" id="5979546">&amp;&amp;</span>&nbsp;<span class="ident" id="5979549">tw</span><span class="op" id="5979551">.</span><span class="ident" id="5979552">err</span>&nbsp;<span class="op" id="5979556">==</span>&nbsp;<span class="builtintype" id="5979559">nil</span>&nbsp;<span class="op" id="5979563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979567">nr</span>&nbsp;<span class="op" id="5979570">:=</span>&nbsp;<span class="ident" id="5979573">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979577">if</span>&nbsp;<span class="ident" id="5979580">nr</span>&nbsp;<span class="op" id="5979583">&gt;</span>&nbsp;<span class="ident" id="5979585">blockSize</span>&nbsp;<span class="op" id="5979595">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979600">nr</span>&nbsp;<span class="op" id="5979603">=</span>&nbsp;<span class="ident" id="5979605">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979621">var</span>&nbsp;<span class="ident" id="5979625">nw</span>&nbsp;<span class="builtintype" id="5979628">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979634">nw</span><span class="op" id="5979636">,</span>&nbsp;<span class="ident" id="5979638">tw</span><span class="op" id="5979640">.</span><span class="ident" id="5979641">err</span>&nbsp;<span class="op" id="5979645">=</span>&nbsp;<span class="ident" id="5979647">tw</span><span class="op" id="5979649">.</span><span class="ident" id="5979650">w</span><span class="op" id="5979651">.</span><span class="ident" id="5979652">Write</span><span class="op" id="5979657">(</span><span class="ident" id="5979658">zeroBlock</span><span class="op" id="5979667">[</span><span class="num" id="5979668">0</span><span class="op" id="5979669">:</span><span class="ident" id="5979670">nr</span><span class="op" id="5979672">]</span><span class="op" id="5979673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979677">n</span>&nbsp;<span class="op" id="5979679">-=</span>&nbsp;<span class="builtintype" id="5979682">int64</span><span class="op" id="5979687">(</span><span class="ident" id="5979688">nw</span><span class="op" id="5979690">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979696">tw</span><span class="op" id="5979698">.</span><span class="ident" id="5979699">nb</span>&nbsp;<span class="op" id="5979702">=</span>&nbsp;<span class="num" id="5979704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979707">tw</span><span class="op" id="5979709">.</span><span class="ident" id="5979710">pad</span>&nbsp;<span class="op" id="5979714">=</span>&nbsp;<span class="num" id="5979716">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979719">return</span>&nbsp;<span class="ident" id="5979726">tw</span><span class="op" id="5979728">.</span><span class="ident" id="5979729">err</span><br>
<span class="lineno"></span><span class="op" id="5979733">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5979736">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="5979799">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5979893">func</span>&nbsp;<span class="op" id="5979898">(</span><span class="ident" id="5979899">tw</span>&nbsp;<span class="op" id="5979902">*</span><span class="ident" id="5979903">Writer</span><span class="op" id="5979909">)</span>&nbsp;<span class="ident" id="5979911">cString</span><span class="op" id="5979918">(</span><span class="ident" id="5979919">b</span>&nbsp;<span class="op" id="5979921">[</span><span class="op" id="5979922">]</span><span class="builtintype" id="5979923">byte</span><span class="op" id="5979927">,</span>&nbsp;<span class="ident" id="5979929">s</span>&nbsp;<span class="builtintype" id="5979931">string</span><span class="op" id="5979937">,</span>&nbsp;<span class="ident" id="5979939">allowPax</span>&nbsp;<span class="builtintype" id="5979948">bool</span><span class="op" id="5979952">,</span>&nbsp;<span class="ident" id="5979954">paxKeyword</span>&nbsp;<span class="builtintype" id="5979965">string</span><span class="op" id="5979971">,</span>&nbsp;<span class="ident" id="5979973">paxHeaders</span>&nbsp;<span class="keyword" id="5979984">map</span><span class="op" id="5979987">[</span><span class="builtintype" id="5979988">string</span><span class="op" id="5979994">]</span><span class="builtintype" id="5979995">string</span><span class="op" id="5980001">)</span>&nbsp;<span class="op" id="5980003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980006">needsPaxHeader</span>&nbsp;<span class="op" id="5980021">:=</span>&nbsp;<span class="ident" id="5980024">allowPax</span>&nbsp;<span class="op" id="5980033">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5980036">len</span><span class="op" id="5980039">(</span><span class="ident" id="5980040">s</span><span class="op" id="5980041">)</span>&nbsp;<span class="op" id="5980043">&gt;</span>&nbsp;<span class="builtinfunc" id="5980045">len</span><span class="op" id="5980048">(</span><span class="ident" id="5980049">b</span><span class="op" id="5980050">)</span>&nbsp;<span class="op" id="5980052">||</span>&nbsp;<span class="op" id="5980055">!</span><span class="ident" id="5980056">isASCII</span><span class="op" id="5980063">(</span><span class="ident" id="5980064">s</span><span class="op" id="5980065">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980068">if</span>&nbsp;<span class="ident" id="5980071">needsPaxHeader</span>&nbsp;<span class="op" id="5980086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980090">paxHeaders</span><span class="op" id="5980100">[</span><span class="ident" id="5980101">paxKeyword</span><span class="op" id="5980111">]</span>&nbsp;<span class="op" id="5980113">=</span>&nbsp;<span class="ident" id="5980115">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980130">if</span>&nbsp;<span class="builtinfunc" id="5980133">len</span><span class="op" id="5980136">(</span><span class="ident" id="5980137">s</span><span class="op" id="5980138">)</span>&nbsp;<span class="op" id="5980140">&gt;</span>&nbsp;<span class="builtinfunc" id="5980142">len</span><span class="op" id="5980145">(</span><span class="ident" id="5980146">b</span><span class="op" id="5980147">)</span>&nbsp;<span class="op" id="5980149">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980153">if</span>&nbsp;<span class="ident" id="5980156">tw</span><span class="op" id="5980158">.</span><span class="ident" id="5980159">err</span>&nbsp;<span class="op" id="5980163">==</span>&nbsp;<span class="builtintype" id="5980166">nil</span>&nbsp;<span class="op" id="5980170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980175">tw</span><span class="op" id="5980177">.</span><span class="ident" id="5980178">err</span>&nbsp;<span class="op" id="5980182">=</span>&nbsp;<span class="ident" id="5980184">ErrFieldTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980206">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980214">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980217">ascii</span>&nbsp;<span class="op" id="5980223">:=</span>&nbsp;<span class="ident" id="5980226">toASCII</span><span class="op" id="5980233">(</span><span class="ident" id="5980234">s</span><span class="op" id="5980235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5980238">copy</span><span class="op" id="5980242">(</span><span class="ident" id="5980243">b</span><span class="op" id="5980244">,</span>&nbsp;<span class="ident" id="5980246">ascii</span><span class="op" id="5980251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980254">if</span>&nbsp;<span class="builtinfunc" id="5980257">len</span><span class="op" id="5980260">(</span><span class="ident" id="5980261">ascii</span><span class="op" id="5980266">)</span>&nbsp;<span class="op" id="5980268">&lt;</span>&nbsp;<span class="builtinfunc" id="5980270">len</span><span class="op" id="5980273">(</span><span class="ident" id="5980274">b</span><span class="op" id="5980275">)</span>&nbsp;<span class="op" id="5980277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980281">b</span><span class="op" id="5980282">[</span><span class="builtinfunc" id="5980283">len</span><span class="op" id="5980286">(</span><span class="ident" id="5980287">ascii</span><span class="op" id="5980292">)</span><span class="op" id="5980293">]</span>&nbsp;<span class="op" id="5980295">=</span>&nbsp;<span class="num" id="5980297">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980300">}</span><br>
<span class="lineno">90</span><span class="op" id="5980302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5980305">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="5980382">func</span>&nbsp;<span class="op" id="5980387">(</span><span class="ident" id="5980388">tw</span>&nbsp;<span class="op" id="5980391">*</span><span class="ident" id="5980392">Writer</span><span class="op" id="5980398">)</span>&nbsp;<span class="ident" id="5980400">octal</span><span class="op" id="5980405">(</span><span class="ident" id="5980406">b</span>&nbsp;<span class="op" id="5980408">[</span><span class="op" id="5980409">]</span><span class="builtintype" id="5980410">byte</span><span class="op" id="5980414">,</span>&nbsp;<span class="ident" id="5980416">x</span>&nbsp;<span class="builtintype" id="5980418">int64</span><span class="op" id="5980423">)</span>&nbsp;<span class="op" id="5980425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980428">s</span>&nbsp;<span class="op" id="5980430">:=</span>&nbsp;<span class="ident" id="5980433">strconv</span><span class="op" id="5980440">.</span><span class="ident" id="5980441">FormatInt</span><span class="op" id="5980450">(</span><span class="ident" id="5980451">x</span><span class="op" id="5980452">,</span>&nbsp;<span class="num" id="5980454">8</span><span class="op" id="5980455">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980458">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980503">for</span>&nbsp;<span class="builtinfunc" id="5980507">len</span><span class="op" id="5980510">(</span><span class="ident" id="5980511">s</span><span class="op" id="5980512">)</span><span class="op" id="5980513">+</span><span class="num" id="5980514">1</span>&nbsp;<span class="op" id="5980516">&lt;</span>&nbsp;<span class="builtinfunc" id="5980518">len</span><span class="op" id="5980521">(</span><span class="ident" id="5980522">b</span><span class="op" id="5980523">)</span>&nbsp;<span class="op" id="5980525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980529">s</span>&nbsp;<span class="op" id="5980531">=</span>&nbsp;<span class="string" id="5980533">&#34;0&#34;</span>&nbsp;<span class="op" id="5980537">+</span>&nbsp;<span class="ident" id="5980539">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980545">tw</span><span class="op" id="5980547">.</span><span class="ident" id="5980548">cString</span><span class="op" id="5980555">(</span><span class="ident" id="5980556">b</span><span class="op" id="5980557">,</span>&nbsp;<span class="ident" id="5980559">s</span><span class="op" id="5980560">,</span>&nbsp;<span class="builtintype" id="5980562">false</span><span class="op" id="5980567">,</span>&nbsp;<span class="ident" id="5980569">paxNone</span><span class="op" id="5980576">,</span>&nbsp;<span class="builtintype" id="5980578">nil</span><span class="op" id="5980581">)</span><br>
<span class="lineno">100</span><span class="op" id="5980583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5980586">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="5980659">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5980785">func</span>&nbsp;<span class="op" id="5980790">(</span><span class="ident" id="5980791">tw</span>&nbsp;<span class="op" id="5980794">*</span><span class="ident" id="5980795">Writer</span><span class="op" id="5980801">)</span>&nbsp;<span class="ident" id="5980803">numeric</span><span class="op" id="5980810">(</span><span class="ident" id="5980811">b</span>&nbsp;<span class="op" id="5980813">[</span><span class="op" id="5980814">]</span><span class="builtintype" id="5980815">byte</span><span class="op" id="5980819">,</span>&nbsp;<span class="ident" id="5980821">x</span>&nbsp;<span class="builtintype" id="5980823">int64</span><span class="op" id="5980828">,</span>&nbsp;<span class="ident" id="5980830">allowPax</span>&nbsp;<span class="builtintype" id="5980839">bool</span><span class="op" id="5980843">,</span>&nbsp;<span class="ident" id="5980845">paxKeyword</span>&nbsp;<span class="builtintype" id="5980856">string</span><span class="op" id="5980862">,</span>&nbsp;<span class="ident" id="5980864">paxHeaders</span>&nbsp;<span class="keyword" id="5980875">map</span><span class="op" id="5980878">[</span><span class="builtintype" id="5980879">string</span><span class="op" id="5980885">]</span><span class="builtintype" id="5980886">string</span><span class="op" id="5980892">)</span>&nbsp;<span class="op" id="5980894">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980897">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980918">s</span>&nbsp;<span class="op" id="5980920">:=</span>&nbsp;<span class="ident" id="5980923">strconv</span><span class="op" id="5980930">.</span><span class="ident" id="5980931">FormatInt</span><span class="op" id="5980940">(</span><span class="ident" id="5980941">x</span><span class="op" id="5980942">,</span>&nbsp;<span class="num" id="5980944">8</span><span class="op" id="5980945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980948">if</span>&nbsp;<span class="builtinfunc" id="5980951">len</span><span class="op" id="5980954">(</span><span class="ident" id="5980955">s</span><span class="op" id="5980956">)</span>&nbsp;<span class="op" id="5980958">&lt;</span>&nbsp;<span class="builtinfunc" id="5980960">len</span><span class="op" id="5980963">(</span><span class="ident" id="5980964">b</span><span class="op" id="5980965">)</span>&nbsp;<span class="op" id="5980967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980971">tw</span><span class="op" id="5980973">.</span><span class="ident" id="5980974">octal</span><span class="op" id="5980979">(</span><span class="ident" id="5980980">b</span><span class="op" id="5980981">,</span>&nbsp;<span class="ident" id="5980983">x</span><span class="op" id="5980984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980988">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981000">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981072">if</span>&nbsp;<span class="ident" id="5981075">allowPax</span>&nbsp;<span class="op" id="5981084">&amp;&amp;</span>&nbsp;<span class="ident" id="5981087">tw</span><span class="op" id="5981089">.</span><span class="ident" id="5981090">preferPax</span>&nbsp;<span class="op" id="5981100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981104">tw</span><span class="op" id="5981106">.</span><span class="ident" id="5981107">octal</span><span class="op" id="5981112">(</span><span class="ident" id="5981113">b</span><span class="op" id="5981114">,</span>&nbsp;<span class="num" id="5981116">0</span><span class="op" id="5981117">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981121">s</span>&nbsp;<span class="op" id="5981123">:=</span>&nbsp;<span class="ident" id="5981126">strconv</span><span class="op" id="5981133">.</span><span class="ident" id="5981134">FormatInt</span><span class="op" id="5981143">(</span><span class="ident" id="5981144">x</span><span class="op" id="5981145">,</span>&nbsp;<span class="num" id="5981147">10</span><span class="op" id="5981149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981153">paxHeaders</span><span class="op" id="5981163">[</span><span class="ident" id="5981164">paxKeyword</span><span class="op" id="5981174">]</span>&nbsp;<span class="op" id="5981176">=</span>&nbsp;<span class="ident" id="5981178">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981194">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981232">tw</span><span class="op" id="5981234">.</span><span class="ident" id="5981235">usedBinary</span>&nbsp;<span class="op" id="5981246">=</span>&nbsp;<span class="builtintype" id="5981248">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981254">for</span>&nbsp;<span class="ident" id="5981258">i</span>&nbsp;<span class="op" id="5981260">:=</span>&nbsp;<span class="builtinfunc" id="5981263">len</span><span class="op" id="5981266">(</span><span class="ident" id="5981267">b</span><span class="op" id="5981268">)</span>&nbsp;<span class="op" id="5981270">-</span>&nbsp;<span class="num" id="5981272">1</span><span class="op" id="5981273">;</span>&nbsp;<span class="ident" id="5981275">x</span>&nbsp;<span class="op" id="5981277">&gt;</span>&nbsp;<span class="num" id="5981279">0</span>&nbsp;<span class="op" id="5981281">&amp;&amp;</span>&nbsp;<span class="ident" id="5981284">i</span>&nbsp;<span class="op" id="5981286">&gt;=</span>&nbsp;<span class="num" id="5981289">0</span><span class="op" id="5981290">;</span>&nbsp;<span class="ident" id="5981292">i</span><span class="op" id="5981293">--</span>&nbsp;<span class="op" id="5981296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981300">b</span><span class="op" id="5981301">[</span><span class="ident" id="5981302">i</span><span class="op" id="5981303">]</span>&nbsp;<span class="op" id="5981305">=</span>&nbsp;<span class="builtintype" id="5981307">byte</span><span class="op" id="5981311">(</span><span class="ident" id="5981312">x</span><span class="op" id="5981313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981317">x</span>&nbsp;<span class="op" id="5981319">&gt;&gt;=</span>&nbsp;<span class="num" id="5981323">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981329">b</span><span class="op" id="5981330">[</span><span class="num" id="5981331">0</span><span class="op" id="5981332">]</span>&nbsp;<span class="op" id="5981334">|=</span>&nbsp;<span class="num" id="5981337">0x80</span>&nbsp;<span class="comment" id="5981342">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="5981381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5981384">var</span>&nbsp;<span class="op" id="5981388">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981391">minTime</span>&nbsp;<span class="op" id="5981399">=</span>&nbsp;<span class="ident" id="5981401">time</span><span class="op" id="5981405">.</span><span class="ident" id="5981406">Unix</span><span class="op" id="5981410">(</span><span class="num" id="5981411">0</span><span class="op" id="5981412">,</span>&nbsp;<span class="num" id="5981414">0</span><span class="op" id="5981415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981418">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981476">maxTime</span>&nbsp;<span class="op" id="5981484">=</span>&nbsp;<span class="ident" id="5981486">minTime</span><span class="op" id="5981493">.</span><span class="ident" id="5981494">Add</span><span class="op" id="5981497">(</span><span class="op" id="5981498">(</span><span class="num" id="5981499">1</span><span class="op" id="5981500">&lt;&lt;</span><span class="num" id="5981502">33</span>&nbsp;<span class="op" id="5981505">-</span>&nbsp;<span class="num" id="5981507">1</span><span class="op" id="5981508">)</span>&nbsp;<span class="op" id="5981510">*</span>&nbsp;<span class="ident" id="5981512">time</span><span class="op" id="5981516">.</span><span class="ident" id="5981517">Second</span><span class="op" id="5981523">)</span><br>
<span class="lineno"></span><span class="op" id="5981525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5981528">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5981598">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5981656">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="5981713">func</span>&nbsp;<span class="op" id="5981718">(</span><span class="ident" id="5981719">tw</span>&nbsp;<span class="op" id="5981722">*</span><span class="ident" id="5981723">Writer</span><span class="op" id="5981729">)</span>&nbsp;<span class="ident" id="5981731">WriteHeader</span><span class="op" id="5981742">(</span><span class="ident" id="5981743">hdr</span>&nbsp;<span class="op" id="5981747">*</span><span class="ident" id="5981748">Header</span><span class="op" id="5981754">)</span>&nbsp;<span class="builtintype" id="5981756">error</span>&nbsp;<span class="op" id="5981762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981765">return</span>&nbsp;<span class="ident" id="5981772">tw</span><span class="op" id="5981774">.</span><span class="ident" id="5981775">writeHeader</span><span class="op" id="5981786">(</span><span class="ident" id="5981787">hdr</span><span class="op" id="5981790">,</span>&nbsp;<span class="builtintype" id="5981792">true</span><span class="op" id="5981796">)</span><br>
<span class="lineno">140</span><span class="op" id="5981798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981801">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5981871">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5981929">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="5981986">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5982059">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5982095">func</span>&nbsp;<span class="op" id="5982100">(</span><span class="ident" id="5982101">tw</span>&nbsp;<span class="op" id="5982104">*</span><span class="ident" id="5982105">Writer</span><span class="op" id="5982111">)</span>&nbsp;<span class="ident" id="5982113">writeHeader</span><span class="op" id="5982124">(</span><span class="ident" id="5982125">hdr</span>&nbsp;<span class="op" id="5982129">*</span><span class="ident" id="5982130">Header</span><span class="op" id="5982136">,</span>&nbsp;<span class="ident" id="5982138">allowPax</span>&nbsp;<span class="builtintype" id="5982147">bool</span><span class="op" id="5982151">)</span>&nbsp;<span class="builtintype" id="5982153">error</span>&nbsp;<span class="op" id="5982159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982162">if</span>&nbsp;<span class="ident" id="5982165">tw</span><span class="op" id="5982167">.</span><span class="ident" id="5982168">closed</span>&nbsp;<span class="op" id="5982175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982179">return</span>&nbsp;<span class="ident" id="5982186">ErrWriteAfterClose</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982209">if</span>&nbsp;<span class="ident" id="5982212">tw</span><span class="op" id="5982214">.</span><span class="ident" id="5982215">err</span>&nbsp;<span class="op" id="5982219">==</span>&nbsp;<span class="builtintype" id="5982222">nil</span>&nbsp;<span class="op" id="5982226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982230">tw</span><span class="op" id="5982232">.</span><span class="ident" id="5982233">Flush</span><span class="op" id="5982238">(</span><span class="op" id="5982239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982245">if</span>&nbsp;<span class="ident" id="5982248">tw</span><span class="op" id="5982250">.</span><span class="ident" id="5982251">err</span>&nbsp;<span class="op" id="5982255">!=</span>&nbsp;<span class="builtintype" id="5982258">nil</span>&nbsp;<span class="op" id="5982262">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982266">return</span>&nbsp;<span class="ident" id="5982273">tw</span><span class="op" id="5982275">.</span><span class="ident" id="5982276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982285">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982341">paxHeaders</span>&nbsp;<span class="op" id="5982352">:=</span>&nbsp;<span class="builtinfunc" id="5982355">make</span><span class="op" id="5982359">(</span><span class="keyword" id="5982360">map</span><span class="op" id="5982363">[</span><span class="builtintype" id="5982364">string</span><span class="op" id="5982370">]</span><span class="builtintype" id="5982371">string</span><span class="op" id="5982377">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982381">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982442">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982504">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982549">var</span>&nbsp;<span class="ident" id="5982553">header</span>&nbsp;<span class="op" id="5982560">[</span><span class="op" id="5982561">]</span><span class="builtintype" id="5982562">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982569">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982630">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982696">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982778">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982858">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982935">header</span>&nbsp;<span class="op" id="5982942">=</span>&nbsp;<span class="ident" id="5982944">tw</span><span class="op" id="5982946">.</span><span class="ident" id="5982947">hdrBuff</span><span class="op" id="5982954">[</span><span class="op" id="5982955">:</span><span class="op" id="5982956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982959">if</span>&nbsp;<span class="op" id="5982962">!</span><span class="ident" id="5982963">allowPax</span>&nbsp;<span class="op" id="5982972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982976">header</span>&nbsp;<span class="op" id="5982983">=</span>&nbsp;<span class="ident" id="5982985">tw</span><span class="op" id="5982987">.</span><span class="ident" id="5982988">paxHdrBuff</span><span class="op" id="5982998">[</span><span class="op" id="5982999">:</span><span class="op" id="5983000">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5983006">copy</span><span class="op" id="5983010">(</span><span class="ident" id="5983011">header</span><span class="op" id="5983017">,</span>&nbsp;<span class="ident" id="5983019">zeroBlock</span><span class="op" id="5983028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983031">s</span>&nbsp;<span class="op" id="5983033">:=</span>&nbsp;<span class="ident" id="5983036">slicer</span><span class="op" id="5983042">(</span><span class="ident" id="5983043">header</span><span class="op" id="5983049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983053">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983181">pathHeaderBytes</span>&nbsp;<span class="op" id="5983197">:=</span>&nbsp;<span class="ident" id="5983200">s</span><span class="op" id="5983201">.</span><span class="ident" id="5983202">next</span><span class="op" id="5983206">(</span><span class="ident" id="5983207">fileNameSize</span><span class="op" id="5983219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983223">tw</span><span class="op" id="5983225">.</span><span class="ident" id="5983226">cString</span><span class="op" id="5983233">(</span><span class="ident" id="5983234">pathHeaderBytes</span><span class="op" id="5983249">,</span>&nbsp;<span class="ident" id="5983251">hdr</span><span class="op" id="5983254">.</span><span class="ident" id="5983255">Name</span><span class="op" id="5983259">,</span>&nbsp;<span class="builtintype" id="5983261">true</span><span class="op" id="5983265">,</span>&nbsp;<span class="ident" id="5983267">paxPath</span><span class="op" id="5983274">,</span>&nbsp;<span class="ident" id="5983276">paxHeaders</span><span class="op" id="5983286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983290">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983333">var</span>&nbsp;<span class="ident" id="5983337">modTime</span>&nbsp;<span class="builtintype" id="5983345">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983352">if</span>&nbsp;<span class="op" id="5983355">!</span><span class="ident" id="5983356">hdr</span><span class="op" id="5983359">.</span><span class="ident" id="5983360">ModTime</span><span class="op" id="5983367">.</span><span class="ident" id="5983368">Before</span><span class="op" id="5983374">(</span><span class="ident" id="5983375">minTime</span><span class="op" id="5983382">)</span>&nbsp;<span class="op" id="5983384">&amp;&amp;</span>&nbsp;<span class="op" id="5983387">!</span><span class="ident" id="5983388">hdr</span><span class="op" id="5983391">.</span><span class="ident" id="5983392">ModTime</span><span class="op" id="5983399">.</span><span class="ident" id="5983400">After</span><span class="op" id="5983405">(</span><span class="ident" id="5983406">maxTime</span><span class="op" id="5983413">)</span>&nbsp;<span class="op" id="5983415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983419">modTime</span>&nbsp;<span class="op" id="5983427">=</span>&nbsp;<span class="ident" id="5983429">hdr</span><span class="op" id="5983432">.</span><span class="ident" id="5983433">ModTime</span><span class="op" id="5983440">.</span><span class="ident" id="5983441">Unix</span><span class="op" id="5983445">(</span><span class="op" id="5983446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983453">tw</span><span class="op" id="5983455">.</span><span class="ident" id="5983456">octal</span><span class="op" id="5983461">(</span><span class="ident" id="5983462">s</span><span class="op" id="5983463">.</span><span class="ident" id="5983464">next</span><span class="op" id="5983468">(</span><span class="num" id="5983469">8</span><span class="op" id="5983470">)</span><span class="op" id="5983471">,</span>&nbsp;<span class="ident" id="5983473">hdr</span><span class="op" id="5983476">.</span><span class="ident" id="5983477">Mode</span><span class="op" id="5983481">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983517">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983529">tw</span><span class="op" id="5983531">.</span><span class="ident" id="5983532">numeric</span><span class="op" id="5983539">(</span><span class="ident" id="5983540">s</span><span class="op" id="5983541">.</span><span class="ident" id="5983542">next</span><span class="op" id="5983546">(</span><span class="num" id="5983547">8</span><span class="op" id="5983548">)</span><span class="op" id="5983549">,</span>&nbsp;<span class="builtintype" id="5983551">int64</span><span class="op" id="5983556">(</span><span class="ident" id="5983557">hdr</span><span class="op" id="5983560">.</span><span class="ident" id="5983561">Uid</span><span class="op" id="5983564">)</span><span class="op" id="5983565">,</span>&nbsp;<span class="builtintype" id="5983567">true</span><span class="op" id="5983571">,</span>&nbsp;<span class="ident" id="5983573">paxUid</span><span class="op" id="5983579">,</span>&nbsp;<span class="ident" id="5983581">paxHeaders</span><span class="op" id="5983591">)</span>&nbsp;<span class="comment" id="5983593">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983605">tw</span><span class="op" id="5983607">.</span><span class="ident" id="5983608">numeric</span><span class="op" id="5983615">(</span><span class="ident" id="5983616">s</span><span class="op" id="5983617">.</span><span class="ident" id="5983618">next</span><span class="op" id="5983622">(</span><span class="num" id="5983623">8</span><span class="op" id="5983624">)</span><span class="op" id="5983625">,</span>&nbsp;<span class="builtintype" id="5983627">int64</span><span class="op" id="5983632">(</span><span class="ident" id="5983633">hdr</span><span class="op" id="5983636">.</span><span class="ident" id="5983637">Gid</span><span class="op" id="5983640">)</span><span class="op" id="5983641">,</span>&nbsp;<span class="builtintype" id="5983643">true</span><span class="op" id="5983647">,</span>&nbsp;<span class="ident" id="5983649">paxGid</span><span class="op" id="5983655">,</span>&nbsp;<span class="ident" id="5983657">paxHeaders</span><span class="op" id="5983667">)</span>&nbsp;<span class="comment" id="5983669">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983681">tw</span><span class="op" id="5983683">.</span><span class="ident" id="5983684">numeric</span><span class="op" id="5983691">(</span><span class="ident" id="5983692">s</span><span class="op" id="5983693">.</span><span class="ident" id="5983694">next</span><span class="op" id="5983698">(</span><span class="num" id="5983699">12</span><span class="op" id="5983701">)</span><span class="op" id="5983702">,</span>&nbsp;<span class="ident" id="5983704">hdr</span><span class="op" id="5983707">.</span><span class="ident" id="5983708">Size</span><span class="op" id="5983712">,</span>&nbsp;<span class="builtintype" id="5983714">true</span><span class="op" id="5983718">,</span>&nbsp;<span class="ident" id="5983720">paxSize</span><span class="op" id="5983727">,</span>&nbsp;<span class="ident" id="5983729">paxHeaders</span><span class="op" id="5983739">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983745">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983757">tw</span><span class="op" id="5983759">.</span><span class="ident" id="5983760">numeric</span><span class="op" id="5983767">(</span><span class="ident" id="5983768">s</span><span class="op" id="5983769">.</span><span class="ident" id="5983770">next</span><span class="op" id="5983774">(</span><span class="num" id="5983775">12</span><span class="op" id="5983777">)</span><span class="op" id="5983778">,</span>&nbsp;<span class="ident" id="5983780">modTime</span><span class="op" id="5983787">,</span>&nbsp;<span class="builtintype" id="5983789">false</span><span class="op" id="5983794">,</span>&nbsp;<span class="ident" id="5983796">paxNone</span><span class="op" id="5983803">,</span>&nbsp;<span class="builtintype" id="5983805">nil</span><span class="op" id="5983808">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983821">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983878">s</span><span class="op" id="5983879">.</span><span class="ident" id="5983880">next</span><span class="op" id="5983884">(</span><span class="num" id="5983885">8</span><span class="op" id="5983886">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983942">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983963">s</span><span class="op" id="5983964">.</span><span class="ident" id="5983965">next</span><span class="op" id="5983969">(</span><span class="num" id="5983970">1</span><span class="op" id="5983971">)</span><span class="op" id="5983972">[</span><span class="num" id="5983973">0</span><span class="op" id="5983974">]</span>&nbsp;<span class="op" id="5983976">=</span>&nbsp;<span class="ident" id="5983978">hdr</span><span class="op" id="5983981">.</span><span class="ident" id="5983982">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984027">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984040">tw</span><span class="op" id="5984042">.</span><span class="ident" id="5984043">cString</span><span class="op" id="5984050">(</span><span class="ident" id="5984051">s</span><span class="op" id="5984052">.</span><span class="ident" id="5984053">next</span><span class="op" id="5984057">(</span><span class="num" id="5984058">100</span><span class="op" id="5984061">)</span><span class="op" id="5984062">,</span>&nbsp;<span class="ident" id="5984064">hdr</span><span class="op" id="5984067">.</span><span class="ident" id="5984068">Linkname</span><span class="op" id="5984076">,</span>&nbsp;<span class="builtintype" id="5984078">true</span><span class="op" id="5984082">,</span>&nbsp;<span class="ident" id="5984084">paxLinkpath</span><span class="op" id="5984095">,</span>&nbsp;<span class="ident" id="5984097">paxHeaders</span><span class="op" id="5984107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5984111">copy</span><span class="op" id="5984115">(</span><span class="ident" id="5984116">s</span><span class="op" id="5984117">.</span><span class="ident" id="5984118">next</span><span class="op" id="5984122">(</span><span class="num" id="5984123">8</span><span class="op" id="5984124">)</span><span class="op" id="5984125">,</span>&nbsp;<span class="op" id="5984127">[</span><span class="op" id="5984128">]</span><span class="builtintype" id="5984129">byte</span><span class="op" id="5984133">(</span><span class="string" id="5984134">&#34;ustar\x0000&#34;</span><span class="op" id="5984147">)</span><span class="op" id="5984148">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984173">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984185">tw</span><span class="op" id="5984187">.</span><span class="ident" id="5984188">cString</span><span class="op" id="5984195">(</span><span class="ident" id="5984196">s</span><span class="op" id="5984197">.</span><span class="ident" id="5984198">next</span><span class="op" id="5984202">(</span><span class="num" id="5984203">32</span><span class="op" id="5984205">)</span><span class="op" id="5984206">,</span>&nbsp;<span class="ident" id="5984208">hdr</span><span class="op" id="5984211">.</span><span class="ident" id="5984212">Uname</span><span class="op" id="5984217">,</span>&nbsp;<span class="builtintype" id="5984219">true</span><span class="op" id="5984223">,</span>&nbsp;<span class="ident" id="5984225">paxUname</span><span class="op" id="5984233">,</span>&nbsp;<span class="ident" id="5984235">paxHeaders</span><span class="op" id="5984245">)</span>&nbsp;<span class="comment" id="5984247">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984259">tw</span><span class="op" id="5984261">.</span><span class="ident" id="5984262">cString</span><span class="op" id="5984269">(</span><span class="ident" id="5984270">s</span><span class="op" id="5984271">.</span><span class="ident" id="5984272">next</span><span class="op" id="5984276">(</span><span class="num" id="5984277">32</span><span class="op" id="5984279">)</span><span class="op" id="5984280">,</span>&nbsp;<span class="ident" id="5984282">hdr</span><span class="op" id="5984285">.</span><span class="ident" id="5984286">Gname</span><span class="op" id="5984291">,</span>&nbsp;<span class="builtintype" id="5984293">true</span><span class="op" id="5984297">,</span>&nbsp;<span class="ident" id="5984299">paxGname</span><span class="op" id="5984307">,</span>&nbsp;<span class="ident" id="5984309">paxHeaders</span><span class="op" id="5984319">)</span>&nbsp;<span class="comment" id="5984321">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984333">tw</span><span class="op" id="5984335">.</span><span class="ident" id="5984336">numeric</span><span class="op" id="5984343">(</span><span class="ident" id="5984344">s</span><span class="op" id="5984345">.</span><span class="ident" id="5984346">next</span><span class="op" id="5984350">(</span><span class="num" id="5984351">8</span><span class="op" id="5984352">)</span><span class="op" id="5984353">,</span>&nbsp;<span class="ident" id="5984355">hdr</span><span class="op" id="5984358">.</span><span class="ident" id="5984359">Devmajor</span><span class="op" id="5984367">,</span>&nbsp;<span class="builtintype" id="5984369">false</span><span class="op" id="5984374">,</span>&nbsp;<span class="ident" id="5984376">paxNone</span><span class="op" id="5984383">,</span>&nbsp;<span class="builtintype" id="5984385">nil</span><span class="op" id="5984388">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984395">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984407">tw</span><span class="op" id="5984409">.</span><span class="ident" id="5984410">numeric</span><span class="op" id="5984417">(</span><span class="ident" id="5984418">s</span><span class="op" id="5984419">.</span><span class="ident" id="5984420">next</span><span class="op" id="5984424">(</span><span class="num" id="5984425">8</span><span class="op" id="5984426">)</span><span class="op" id="5984427">,</span>&nbsp;<span class="ident" id="5984429">hdr</span><span class="op" id="5984432">.</span><span class="ident" id="5984433">Devminor</span><span class="op" id="5984441">,</span>&nbsp;<span class="builtintype" id="5984443">false</span><span class="op" id="5984448">,</span>&nbsp;<span class="ident" id="5984450">paxNone</span><span class="op" id="5984457">,</span>&nbsp;<span class="builtintype" id="5984459">nil</span><span class="op" id="5984462">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984469">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984482">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984608">prefixHeaderBytes</span>&nbsp;<span class="op" id="5984626">:=</span>&nbsp;<span class="ident" id="5984629">s</span><span class="op" id="5984630">.</span><span class="ident" id="5984631">next</span><span class="op" id="5984635">(</span><span class="num" id="5984636">155</span><span class="op" id="5984639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984642">tw</span><span class="op" id="5984644">.</span><span class="ident" id="5984645">cString</span><span class="op" id="5984652">(</span><span class="ident" id="5984653">prefixHeaderBytes</span><span class="op" id="5984670">,</span>&nbsp;<span class="string" id="5984672">&#34;&#34;</span><span class="op" id="5984674">,</span>&nbsp;<span class="builtintype" id="5984676">false</span><span class="op" id="5984681">,</span>&nbsp;<span class="ident" id="5984683">paxNone</span><span class="op" id="5984690">,</span>&nbsp;<span class="builtintype" id="5984692">nil</span><span class="op" id="5984695">)</span>&nbsp;<span class="comment" id="5984697">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984718">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984794">if</span>&nbsp;<span class="ident" id="5984797">tw</span><span class="op" id="5984799">.</span><span class="ident" id="5984800">usedBinary</span>&nbsp;<span class="op" id="5984811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5984815">copy</span><span class="op" id="5984819">(</span><span class="ident" id="5984820">header</span><span class="op" id="5984826">[</span><span class="num" id="5984827">257</span><span class="op" id="5984830">:</span><span class="num" id="5984831">265</span><span class="op" id="5984834">]</span><span class="op" id="5984835">,</span>&nbsp;<span class="op" id="5984837">[</span><span class="op" id="5984838">]</span><span class="builtintype" id="5984839">byte</span><span class="op" id="5984843">(</span><span class="string" id="5984844">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5984857">)</span><span class="op" id="5984858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5984865">_</span><span class="op" id="5984866">,</span>&nbsp;<span class="ident" id="5984868">paxPathUsed</span>&nbsp;<span class="op" id="5984880">:=</span>&nbsp;<span class="ident" id="5984883">paxHeaders</span><span class="op" id="5984893">[</span><span class="ident" id="5984894">paxPath</span><span class="op" id="5984901">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984904">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5984965">if</span>&nbsp;<span class="op" id="5984968">!</span><span class="ident" id="5984969">tw</span><span class="op" id="5984971">.</span><span class="ident" id="5984972">preferPax</span>&nbsp;<span class="op" id="5984982">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5984985">len</span><span class="op" id="5984988">(</span><span class="ident" id="5984989">paxHeaders</span><span class="op" id="5984999">)</span>&nbsp;<span class="op" id="5985001">==</span>&nbsp;<span class="num" id="5985004">1</span>&nbsp;<span class="op" id="5985006">&amp;&amp;</span>&nbsp;<span class="ident" id="5985009">paxPathUsed</span>&nbsp;<span class="op" id="5985021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985025">suffix</span>&nbsp;<span class="op" id="5985032">:=</span>&nbsp;<span class="ident" id="5985035">hdr</span><span class="op" id="5985038">.</span><span class="ident" id="5985039">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985046">prefix</span>&nbsp;<span class="op" id="5985053">:=</span>&nbsp;<span class="string" id="5985056">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985061">if</span>&nbsp;<span class="builtinfunc" id="5985064">len</span><span class="op" id="5985067">(</span><span class="ident" id="5985068">hdr</span><span class="op" id="5985071">.</span><span class="ident" id="5985072">Name</span><span class="op" id="5985076">)</span>&nbsp;<span class="op" id="5985078">&gt;</span>&nbsp;<span class="ident" id="5985080">fileNameSize</span>&nbsp;<span class="op" id="5985093">&amp;&amp;</span>&nbsp;<span class="ident" id="5985096">isASCII</span><span class="op" id="5985103">(</span><span class="ident" id="5985104">hdr</span><span class="op" id="5985107">.</span><span class="ident" id="5985108">Name</span><span class="op" id="5985112">)</span>&nbsp;<span class="op" id="5985114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985119">var</span>&nbsp;<span class="ident" id="5985123">err</span>&nbsp;<span class="builtintype" id="5985127">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985136">prefix</span><span class="op" id="5985142">,</span>&nbsp;<span class="ident" id="5985144">suffix</span><span class="op" id="5985150">,</span>&nbsp;<span class="ident" id="5985152">err</span>&nbsp;<span class="op" id="5985156">=</span>&nbsp;<span class="ident" id="5985158">tw</span><span class="op" id="5985160">.</span><span class="ident" id="5985161">splitUSTARLongName</span><span class="op" id="5985179">(</span><span class="ident" id="5985180">hdr</span><span class="op" id="5985183">.</span><span class="ident" id="5985184">Name</span><span class="op" id="5985188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985193">if</span>&nbsp;<span class="ident" id="5985196">err</span>&nbsp;<span class="op" id="5985200">==</span>&nbsp;<span class="builtintype" id="5985203">nil</span>&nbsp;<span class="op" id="5985207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985213">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985292">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5985376">delete</span><span class="op" id="5985382">(</span><span class="ident" id="5985383">paxHeaders</span><span class="op" id="5985393">,</span>&nbsp;<span class="ident" id="5985395">paxPath</span><span class="op" id="5985402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985409">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985439">tw</span><span class="op" id="5985441">.</span><span class="ident" id="5985442">cString</span><span class="op" id="5985449">(</span><span class="ident" id="5985450">pathHeaderBytes</span><span class="op" id="5985465">,</span>&nbsp;<span class="ident" id="5985467">suffix</span><span class="op" id="5985473">,</span>&nbsp;<span class="builtintype" id="5985475">false</span><span class="op" id="5985480">,</span>&nbsp;<span class="ident" id="5985482">paxNone</span><span class="op" id="5985489">,</span>&nbsp;<span class="builtintype" id="5985491">nil</span><span class="op" id="5985494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985500">tw</span><span class="op" id="5985502">.</span><span class="ident" id="5985503">cString</span><span class="op" id="5985510">(</span><span class="ident" id="5985511">prefixHeaderBytes</span><span class="op" id="5985528">,</span>&nbsp;<span class="ident" id="5985530">prefix</span><span class="op" id="5985536">,</span>&nbsp;<span class="builtintype" id="5985538">false</span><span class="op" id="5985543">,</span>&nbsp;<span class="ident" id="5985545">paxNone</span><span class="op" id="5985552">,</span>&nbsp;<span class="builtintype" id="5985554">nil</span><span class="op" id="5985557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985564">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985620">if</span>&nbsp;<span class="builtinfunc" id="5985623">len</span><span class="op" id="5985626">(</span><span class="ident" id="5985627">prefix</span><span class="op" id="5985633">)</span>&nbsp;<span class="op" id="5985635">&gt;</span>&nbsp;<span class="num" id="5985637">0</span>&nbsp;<span class="op" id="5985639">&amp;&amp;</span>&nbsp;<span class="op" id="5985642">!</span><span class="ident" id="5985643">tw</span><span class="op" id="5985645">.</span><span class="ident" id="5985646">usedBinary</span>&nbsp;<span class="op" id="5985657">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5985664">copy</span><span class="op" id="5985668">(</span><span class="ident" id="5985669">header</span><span class="op" id="5985675">[</span><span class="num" id="5985676">257</span><span class="op" id="5985679">:</span><span class="num" id="5985680">265</span><span class="op" id="5985683">]</span><span class="op" id="5985684">,</span>&nbsp;<span class="op" id="5985686">[</span><span class="op" id="5985687">]</span><span class="builtintype" id="5985688">byte</span><span class="op" id="5985692">(</span><span class="string" id="5985693">&#34;ustar\x00&#34;</span><span class="op" id="5985704">)</span><span class="op" id="5985705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985723">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985727">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985784">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985835">chksum</span><span class="op" id="5985841">,</span>&nbsp;<span class="ident" id="5985843">_</span>&nbsp;<span class="op" id="5985845">:=</span>&nbsp;<span class="ident" id="5985848">checksum</span><span class="op" id="5985856">(</span><span class="ident" id="5985857">header</span><span class="op" id="5985863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985866">tw</span><span class="op" id="5985868">.</span><span class="ident" id="5985869">octal</span><span class="op" id="5985874">(</span><span class="ident" id="5985875">header</span><span class="op" id="5985881">[</span><span class="num" id="5985882">148</span><span class="op" id="5985885">:</span><span class="num" id="5985886">155</span><span class="op" id="5985889">]</span><span class="op" id="5985890">,</span>&nbsp;<span class="ident" id="5985892">chksum</span><span class="op" id="5985898">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5985901">header</span><span class="op" id="5985907">[</span><span class="num" id="5985908">155</span><span class="op" id="5985911">]</span>&nbsp;<span class="op" id="5985913">=</span>&nbsp;<span class="string" id="5985915">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5985921">if</span>&nbsp;<span class="ident" id="5985924">tw</span><span class="op" id="5985926">.</span><span class="ident" id="5985927">err</span>&nbsp;<span class="op" id="5985931">!=</span>&nbsp;<span class="builtintype" id="5985934">nil</span>&nbsp;<span class="op" id="5985938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985942">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986006">return</span>&nbsp;<span class="ident" id="5986013">tw</span><span class="op" id="5986015">.</span><span class="ident" id="5986016">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986025">if</span>&nbsp;<span class="ident" id="5986028">allowPax</span>&nbsp;<span class="op" id="5986037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986041">for</span>&nbsp;<span class="ident" id="5986045">k</span><span class="op" id="5986046">,</span>&nbsp;<span class="ident" id="5986048">v</span>&nbsp;<span class="op" id="5986050">:=</span>&nbsp;<span class="keyword" id="5986053">range</span>&nbsp;<span class="ident" id="5986059">hdr</span><span class="op" id="5986062">.</span><span class="ident" id="5986063">Xattrs</span>&nbsp;<span class="op" id="5986070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986075">paxHeaders</span><span class="op" id="5986085">[</span><span class="ident" id="5986086">paxXattr</span><span class="op" id="5986094">+</span><span class="ident" id="5986095">k</span><span class="op" id="5986096">]</span>&nbsp;<span class="op" id="5986098">=</span>&nbsp;<span class="ident" id="5986100">v</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986111">if</span>&nbsp;<span class="builtinfunc" id="5986114">len</span><span class="op" id="5986117">(</span><span class="ident" id="5986118">paxHeaders</span><span class="op" id="5986128">)</span>&nbsp;<span class="op" id="5986130">&gt;</span>&nbsp;<span class="num" id="5986132">0</span>&nbsp;<span class="op" id="5986134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986138">if</span>&nbsp;<span class="op" id="5986141">!</span><span class="ident" id="5986142">allowPax</span>&nbsp;<span class="op" id="5986151">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986156">return</span>&nbsp;<span class="ident" id="5986163">errInvalidHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986186">if</span>&nbsp;<span class="ident" id="5986189">err</span>&nbsp;<span class="op" id="5986193">:=</span>&nbsp;<span class="ident" id="5986196">tw</span><span class="op" id="5986198">.</span><span class="ident" id="5986199">writePAXHeader</span><span class="op" id="5986213">(</span><span class="ident" id="5986214">hdr</span><span class="op" id="5986217">,</span>&nbsp;<span class="ident" id="5986219">paxHeaders</span><span class="op" id="5986229">)</span><span class="op" id="5986230">;</span>&nbsp;<span class="ident" id="5986232">err</span>&nbsp;<span class="op" id="5986236">!=</span>&nbsp;<span class="builtintype" id="5986239">nil</span>&nbsp;<span class="op" id="5986243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986248">return</span>&nbsp;<span class="ident" id="5986255">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986261">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986267">tw</span><span class="op" id="5986269">.</span><span class="ident" id="5986270">nb</span>&nbsp;<span class="op" id="5986273">=</span>&nbsp;<span class="builtintype" id="5986275">int64</span><span class="op" id="5986280">(</span><span class="ident" id="5986281">hdr</span><span class="op" id="5986284">.</span><span class="ident" id="5986285">Size</span><span class="op" id="5986289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986292">tw</span><span class="op" id="5986294">.</span><span class="ident" id="5986295">pad</span>&nbsp;<span class="op" id="5986299">=</span>&nbsp;<span class="op" id="5986301">(</span><span class="ident" id="5986302">blockSize</span>&nbsp;<span class="op" id="5986312">-</span>&nbsp;<span class="op" id="5986314">(</span><span class="ident" id="5986315">tw</span><span class="op" id="5986317">.</span><span class="ident" id="5986318">nb</span>&nbsp;<span class="op" id="5986321">%</span>&nbsp;<span class="ident" id="5986323">blockSize</span><span class="op" id="5986332">)</span><span class="op" id="5986333">)</span>&nbsp;<span class="op" id="5986335">%</span>&nbsp;<span class="ident" id="5986337">blockSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986349">_</span><span class="op" id="5986350">,</span>&nbsp;<span class="ident" id="5986352">tw</span><span class="op" id="5986354">.</span><span class="ident" id="5986355">err</span>&nbsp;<span class="op" id="5986359">=</span>&nbsp;<span class="ident" id="5986361">tw</span><span class="op" id="5986363">.</span><span class="ident" id="5986364">w</span><span class="op" id="5986365">.</span><span class="ident" id="5986366">Write</span><span class="op" id="5986371">(</span><span class="ident" id="5986372">header</span><span class="op" id="5986378">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986381">return</span>&nbsp;<span class="ident" id="5986388">tw</span><span class="op" id="5986390">.</span><span class="ident" id="5986391">err</span><br>
<span class="lineno"></span><span class="op" id="5986395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5986398">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="5986455">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="5986516">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="5986571">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="5986602">func</span>&nbsp;<span class="op" id="5986607">(</span><span class="ident" id="5986608">tw</span>&nbsp;<span class="op" id="5986611">*</span><span class="ident" id="5986612">Writer</span><span class="op" id="5986618">)</span>&nbsp;<span class="ident" id="5986620">splitUSTARLongName</span><span class="op" id="5986638">(</span><span class="ident" id="5986639">name</span>&nbsp;<span class="builtintype" id="5986644">string</span><span class="op" id="5986650">)</span>&nbsp;<span class="op" id="5986652">(</span><span class="ident" id="5986653">prefix</span><span class="op" id="5986659">,</span>&nbsp;<span class="ident" id="5986661">suffix</span>&nbsp;<span class="builtintype" id="5986668">string</span><span class="op" id="5986674">,</span>&nbsp;<span class="ident" id="5986676">err</span>&nbsp;<span class="builtintype" id="5986680">error</span><span class="op" id="5986685">)</span>&nbsp;<span class="op" id="5986687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986690">length</span>&nbsp;<span class="op" id="5986697">:=</span>&nbsp;<span class="builtinfunc" id="5986700">len</span><span class="op" id="5986703">(</span><span class="ident" id="5986704">name</span><span class="op" id="5986708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5986711">if</span>&nbsp;<span class="ident" id="5986714">length</span>&nbsp;<span class="op" id="5986721">&gt;</span>&nbsp;<span class="ident" id="5986723">fileNamePrefixSize</span><span class="op" id="5986741">+</span><span class="num" id="5986742">1</span>&nbsp;<span class="op" id="5986744">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986748">length</span>&nbsp;<span class="op" id="5986755">=</span>&nbsp;<span class="ident" id="5986757">fileNamePrefixSize</span>&nbsp;<span class="op" id="5986776">+</span>&nbsp;<span class="num" id="5986778">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986781">}</span>&nbsp;<span class="keyword" id="5986783">else</span>&nbsp;<span class="keyword" id="5986788">if</span>&nbsp;<span class="ident" id="5986791">name</span><span class="op" id="5986795">[</span><span class="ident" id="5986796">length</span><span class="op" id="5986802">-</span><span class="num" id="5986803">1</span><span class="op" id="5986804">]</span>&nbsp;<span class="op" id="5986806">==</span>&nbsp;<span class="string" id="5986809">&#39;/&#39;</span>&nbsp;<span class="op" id="5986813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986817">length</span><span class="op" id="5986823">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5986827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986830">i</span>&nbsp;<span class="op" id="5986832">:=</span>&nbsp;<span class="ident" id="5986835">strings</span><span class="op" id="5986842">.</span><span class="ident" id="5986843">LastIndex</span><span class="op" id="5986852">(</span><span class="ident" id="5986853">name</span><span class="op" id="5986857">[</span><span class="op" id="5986858">:</span><span class="ident" id="5986859">length</span><span class="op" id="5986865">]</span><span class="op" id="5986866">,</span>&nbsp;<span class="string" id="5986868">&#34;/&#34;</span><span class="op" id="5986871">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986874">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5986932">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5986992">nlen</span>&nbsp;<span class="op" id="5986997">:=</span>&nbsp;<span class="builtinfunc" id="5987000">len</span><span class="op" id="5987003">(</span><span class="ident" id="5987004">name</span><span class="op" id="5987008">)</span>&nbsp;<span class="op" id="5987010">-</span>&nbsp;<span class="ident" id="5987012">i</span>&nbsp;<span class="op" id="5987014">-</span>&nbsp;<span class="num" id="5987016">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987019">plen</span>&nbsp;<span class="op" id="5987024">:=</span>&nbsp;<span class="ident" id="5987027">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987030">if</span>&nbsp;<span class="ident" id="5987033">i</span>&nbsp;<span class="op" id="5987035">&lt;=</span>&nbsp;<span class="num" id="5987038">0</span>&nbsp;<span class="op" id="5987040">||</span>&nbsp;<span class="ident" id="5987043">nlen</span>&nbsp;<span class="op" id="5987048">&gt;</span>&nbsp;<span class="ident" id="5987050">fileNameSize</span>&nbsp;<span class="op" id="5987063">||</span>&nbsp;<span class="ident" id="5987066">nlen</span>&nbsp;<span class="op" id="5987071">==</span>&nbsp;<span class="num" id="5987074">0</span>&nbsp;<span class="op" id="5987076">||</span>&nbsp;<span class="ident" id="5987079">plen</span>&nbsp;<span class="op" id="5987084">&gt;</span>&nbsp;<span class="ident" id="5987086">fileNamePrefixSize</span>&nbsp;<span class="op" id="5987105">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987109">err</span>&nbsp;<span class="op" id="5987113">=</span>&nbsp;<span class="ident" id="5987115">errNameTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987132">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987143">prefix</span><span class="op" id="5987149">,</span>&nbsp;<span class="ident" id="5987151">suffix</span>&nbsp;<span class="op" id="5987158">=</span>&nbsp;<span class="ident" id="5987160">name</span><span class="op" id="5987164">[</span><span class="op" id="5987165">:</span><span class="ident" id="5987166">i</span><span class="op" id="5987167">]</span><span class="op" id="5987168">,</span>&nbsp;<span class="ident" id="5987170">name</span><span class="op" id="5987174">[</span><span class="ident" id="5987175">i</span><span class="op" id="5987176">+</span><span class="num" id="5987177">1</span><span class="op" id="5987178">:</span><span class="op" id="5987179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987182">return</span><br>
<span class="lineno">295</span><span class="op" id="5987189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987192">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5987247">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5987259">func</span>&nbsp;<span class="op" id="5987264">(</span><span class="ident" id="5987265">tw</span>&nbsp;<span class="op" id="5987268">*</span><span class="ident" id="5987269">Writer</span><span class="op" id="5987275">)</span>&nbsp;<span class="ident" id="5987277">writePAXHeader</span><span class="op" id="5987291">(</span><span class="ident" id="5987292">hdr</span>&nbsp;<span class="op" id="5987296">*</span><span class="ident" id="5987297">Header</span><span class="op" id="5987303">,</span>&nbsp;<span class="ident" id="5987305">paxHeaders</span>&nbsp;<span class="keyword" id="5987316">map</span><span class="op" id="5987319">[</span><span class="builtintype" id="5987320">string</span><span class="op" id="5987326">]</span><span class="builtintype" id="5987327">string</span><span class="op" id="5987333">)</span>&nbsp;<span class="builtintype" id="5987335">error</span>&nbsp;<span class="op" id="5987341">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987344">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987372">ext</span>&nbsp;<span class="op" id="5987376">:=</span>&nbsp;<span class="builtinfunc" id="5987379">new</span><span class="op" id="5987382">(</span><span class="ident" id="5987383">Header</span><span class="op" id="5987389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987392">ext</span><span class="op" id="5987395">.</span><span class="ident" id="5987396">Typeflag</span>&nbsp;<span class="op" id="5987405">=</span>&nbsp;<span class="ident" id="5987407">TypeXHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987420">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987474">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987514">ext</span><span class="op" id="5987517">.</span><span class="ident" id="5987518">ModTime</span>&nbsp;<span class="op" id="5987526">=</span>&nbsp;<span class="ident" id="5987528">hdr</span><span class="op" id="5987531">.</span><span class="ident" id="5987532">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987541">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987594">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987620">pid</span>&nbsp;<span class="op" id="5987624">:=</span>&nbsp;<span class="ident" id="5987627">os</span><span class="op" id="5987629">.</span><span class="ident" id="5987630">Getpid</span><span class="op" id="5987636">(</span><span class="op" id="5987637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987640">dir</span><span class="op" id="5987643">,</span>&nbsp;<span class="ident" id="5987645">file</span>&nbsp;<span class="op" id="5987650">:=</span>&nbsp;<span class="ident" id="5987653">path</span><span class="op" id="5987657">.</span><span class="ident" id="5987658">Split</span><span class="op" id="5987663">(</span><span class="ident" id="5987664">hdr</span><span class="op" id="5987667">.</span><span class="ident" id="5987668">Name</span><span class="op" id="5987672">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987675">fullName</span>&nbsp;<span class="op" id="5987684">:=</span>&nbsp;<span class="ident" id="5987687">path</span><span class="op" id="5987691">.</span><span class="ident" id="5987692">Join</span><span class="op" id="5987696">(</span><span class="ident" id="5987697">dir</span><span class="op" id="5987700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987704">fmt</span><span class="op" id="5987707">.</span><span class="ident" id="5987708">Sprintf</span><span class="op" id="5987715">(</span><span class="string" id="5987716">&#34;PaxHeaders.%d&#34;</span><span class="op" id="5987731">,</span>&nbsp;<span class="ident" id="5987733">pid</span><span class="op" id="5987736">)</span><span class="op" id="5987737">,</span>&nbsp;<span class="ident" id="5987739">file</span><span class="op" id="5987743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987747">ascii</span>&nbsp;<span class="op" id="5987753">:=</span>&nbsp;<span class="ident" id="5987756">toASCII</span><span class="op" id="5987763">(</span><span class="ident" id="5987764">fullName</span><span class="op" id="5987772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987775">if</span>&nbsp;<span class="builtinfunc" id="5987778">len</span><span class="op" id="5987781">(</span><span class="ident" id="5987782">ascii</span><span class="op" id="5987787">)</span>&nbsp;<span class="op" id="5987789">&gt;</span>&nbsp;<span class="num" id="5987791">100</span>&nbsp;<span class="op" id="5987795">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987799">ascii</span>&nbsp;<span class="op" id="5987805">=</span>&nbsp;<span class="ident" id="5987807">ascii</span><span class="op" id="5987812">[</span><span class="op" id="5987813">:</span><span class="num" id="5987814">100</span><span class="op" id="5987817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987823">ext</span><span class="op" id="5987826">.</span><span class="ident" id="5987827">Name</span>&nbsp;<span class="op" id="5987832">=</span>&nbsp;<span class="ident" id="5987834">ascii</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5987841">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987864">var</span>&nbsp;<span class="ident" id="5987868">buf</span>&nbsp;<span class="ident" id="5987872">bytes</span><span class="op" id="5987877">.</span><span class="ident" id="5987878">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987887">for</span>&nbsp;<span class="ident" id="5987891">k</span><span class="op" id="5987892">,</span>&nbsp;<span class="ident" id="5987894">v</span>&nbsp;<span class="op" id="5987896">:=</span>&nbsp;<span class="keyword" id="5987899">range</span>&nbsp;<span class="ident" id="5987905">paxHeaders</span>&nbsp;<span class="op" id="5987916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987920">fmt</span><span class="op" id="5987923">.</span><span class="ident" id="5987924">Fprint</span><span class="op" id="5987930">(</span><span class="op" id="5987931">&amp;</span><span class="ident" id="5987932">buf</span><span class="op" id="5987935">,</span>&nbsp;<span class="ident" id="5987937">paxHeader</span><span class="op" id="5987946">(</span><span class="ident" id="5987947">k</span><span class="op" id="5987948">+</span><span class="string" id="5987949">&#34;=&#34;</span><span class="op" id="5987952">+</span><span class="ident" id="5987953">v</span><span class="op" id="5987954">)</span><span class="op" id="5987955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5987962">ext</span><span class="op" id="5987965">.</span><span class="ident" id="5987966">Size</span>&nbsp;<span class="op" id="5987971">=</span>&nbsp;<span class="builtintype" id="5987973">int64</span><span class="op" id="5987978">(</span><span class="builtinfunc" id="5987979">len</span><span class="op" id="5987982">(</span><span class="ident" id="5987983">buf</span><span class="op" id="5987986">.</span><span class="ident" id="5987987">Bytes</span><span class="op" id="5987992">(</span><span class="op" id="5987993">)</span><span class="op" id="5987994">)</span><span class="op" id="5987995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5987998">if</span>&nbsp;<span class="ident" id="5988001">err</span>&nbsp;<span class="op" id="5988005">:=</span>&nbsp;<span class="ident" id="5988008">tw</span><span class="op" id="5988010">.</span><span class="ident" id="5988011">writeHeader</span><span class="op" id="5988022">(</span><span class="ident" id="5988023">ext</span><span class="op" id="5988026">,</span>&nbsp;<span class="builtintype" id="5988028">false</span><span class="op" id="5988033">)</span><span class="op" id="5988034">;</span>&nbsp;<span class="ident" id="5988036">err</span>&nbsp;<span class="op" id="5988040">!=</span>&nbsp;<span class="builtintype" id="5988043">nil</span>&nbsp;<span class="op" id="5988047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988051">return</span>&nbsp;<span class="ident" id="5988058">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988066">if</span>&nbsp;<span class="ident" id="5988069">_</span><span class="op" id="5988070">,</span>&nbsp;<span class="ident" id="5988072">err</span>&nbsp;<span class="op" id="5988076">:=</span>&nbsp;<span class="ident" id="5988079">tw</span><span class="op" id="5988081">.</span><span class="ident" id="5988082">Write</span><span class="op" id="5988087">(</span><span class="ident" id="5988088">buf</span><span class="op" id="5988091">.</span><span class="ident" id="5988092">Bytes</span><span class="op" id="5988097">(</span><span class="op" id="5988098">)</span><span class="op" id="5988099">)</span><span class="op" id="5988100">;</span>&nbsp;<span class="ident" id="5988102">err</span>&nbsp;<span class="op" id="5988106">!=</span>&nbsp;<span class="builtintype" id="5988109">nil</span>&nbsp;<span class="op" id="5988113">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988117">return</span>&nbsp;<span class="ident" id="5988124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988132">if</span>&nbsp;<span class="ident" id="5988135">err</span>&nbsp;<span class="op" id="5988139">:=</span>&nbsp;<span class="ident" id="5988142">tw</span><span class="op" id="5988144">.</span><span class="ident" id="5988145">Flush</span><span class="op" id="5988150">(</span><span class="op" id="5988151">)</span><span class="op" id="5988152">;</span>&nbsp;<span class="ident" id="5988154">err</span>&nbsp;<span class="op" id="5988158">!=</span>&nbsp;<span class="builtintype" id="5988161">nil</span>&nbsp;<span class="op" id="5988165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988169">return</span>&nbsp;<span class="ident" id="5988176">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988181">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988184">return</span>&nbsp;<span class="builtintype" id="5988191">nil</span><br>
<span class="lineno"></span><span class="op" id="5988195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988198">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="5988281">func</span>&nbsp;<span class="ident" id="5988286">paxHeader</span><span class="op" id="5988295">(</span><span class="ident" id="5988296">msg</span>&nbsp;<span class="builtintype" id="5988300">string</span><span class="op" id="5988306">)</span>&nbsp;<span class="builtintype" id="5988308">string</span>&nbsp;<span class="op" id="5988315">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988318">const</span>&nbsp;<span class="ident" id="5988324">padding</span>&nbsp;<span class="op" id="5988332">=</span>&nbsp;<span class="num" id="5988334">2</span>&nbsp;<span class="comment" id="5988336">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988376">size</span>&nbsp;<span class="op" id="5988381">:=</span>&nbsp;<span class="builtinfunc" id="5988384">len</span><span class="op" id="5988387">(</span><span class="ident" id="5988388">msg</span><span class="op" id="5988391">)</span>&nbsp;<span class="op" id="5988393">+</span>&nbsp;<span class="ident" id="5988395">padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988404">size</span>&nbsp;<span class="op" id="5988409">+=</span>&nbsp;<span class="builtinfunc" id="5988412">len</span><span class="op" id="5988415">(</span><span class="ident" id="5988416">strconv</span><span class="op" id="5988423">.</span><span class="ident" id="5988424">Itoa</span><span class="op" id="5988428">(</span><span class="ident" id="5988429">size</span><span class="op" id="5988433">)</span><span class="op" id="5988434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988437">record</span>&nbsp;<span class="op" id="5988444">:=</span>&nbsp;<span class="ident" id="5988447">fmt</span><span class="op" id="5988450">.</span><span class="ident" id="5988451">Sprintf</span><span class="op" id="5988458">(</span><span class="string" id="5988459">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5988468">,</span>&nbsp;<span class="ident" id="5988470">size</span><span class="op" id="5988474">,</span>&nbsp;<span class="ident" id="5988476">msg</span><span class="op" id="5988479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988482">if</span>&nbsp;<span class="builtinfunc" id="5988485">len</span><span class="op" id="5988488">(</span><span class="ident" id="5988489">record</span><span class="op" id="5988495">)</span>&nbsp;<span class="op" id="5988497">!=</span>&nbsp;<span class="ident" id="5988500">size</span>&nbsp;<span class="op" id="5988505">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5988509">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5988556">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988590">size</span>&nbsp;<span class="op" id="5988595">=</span>&nbsp;<span class="builtinfunc" id="5988597">len</span><span class="op" id="5988600">(</span><span class="ident" id="5988601">record</span><span class="op" id="5988607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988611">record</span>&nbsp;<span class="op" id="5988618">=</span>&nbsp;<span class="ident" id="5988620">fmt</span><span class="op" id="5988623">.</span><span class="ident" id="5988624">Sprintf</span><span class="op" id="5988631">(</span><span class="string" id="5988632">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5988641">,</span>&nbsp;<span class="ident" id="5988643">size</span><span class="op" id="5988647">,</span>&nbsp;<span class="ident" id="5988649">msg</span><span class="op" id="5988652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988655">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988658">return</span>&nbsp;<span class="ident" id="5988665">record</span><br>
<span class="lineno"></span><span class="op" id="5988672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988675">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5988732">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="5988788">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5988837">func</span>&nbsp;<span class="op" id="5988842">(</span><span class="ident" id="5988843">tw</span>&nbsp;<span class="op" id="5988846">*</span><span class="ident" id="5988847">Writer</span><span class="op" id="5988853">)</span>&nbsp;<span class="ident" id="5988855">Write</span><span class="op" id="5988860">(</span><span class="ident" id="5988861">b</span>&nbsp;<span class="op" id="5988863">[</span><span class="op" id="5988864">]</span><span class="builtintype" id="5988865">byte</span><span class="op" id="5988869">)</span>&nbsp;<span class="op" id="5988871">(</span><span class="ident" id="5988872">n</span>&nbsp;<span class="builtintype" id="5988874">int</span><span class="op" id="5988877">,</span>&nbsp;<span class="ident" id="5988879">err</span>&nbsp;<span class="builtintype" id="5988883">error</span><span class="op" id="5988888">)</span>&nbsp;<span class="op" id="5988890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988893">if</span>&nbsp;<span class="ident" id="5988896">tw</span><span class="op" id="5988898">.</span><span class="ident" id="5988899">closed</span>&nbsp;<span class="op" id="5988906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988910">err</span>&nbsp;<span class="op" id="5988914">=</span>&nbsp;<span class="ident" id="5988916">ErrWriteTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988934">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988945">overwrite</span>&nbsp;<span class="op" id="5988955">:=</span>&nbsp;<span class="builtintype" id="5988958">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988965">if</span>&nbsp;<span class="builtintype" id="5988968">int64</span><span class="op" id="5988973">(</span><span class="builtinfunc" id="5988974">len</span><span class="op" id="5988977">(</span><span class="ident" id="5988978">b</span><span class="op" id="5988979">)</span><span class="op" id="5988980">)</span>&nbsp;<span class="op" id="5988982">&gt;</span>&nbsp;<span class="ident" id="5988984">tw</span><span class="op" id="5988986">.</span><span class="ident" id="5988987">nb</span>&nbsp;<span class="op" id="5988990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988994">b</span>&nbsp;<span class="op" id="5988996">=</span>&nbsp;<span class="ident" id="5988998">b</span><span class="op" id="5988999">[</span><span class="num" id="5989000">0</span><span class="op" id="5989001">:</span><span class="ident" id="5989002">tw</span><span class="op" id="5989004">.</span><span class="ident" id="5989005">nb</span><span class="op" id="5989007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989011">overwrite</span>&nbsp;<span class="op" id="5989021">=</span>&nbsp;<span class="builtintype" id="5989023">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989032">n</span><span class="op" id="5989033">,</span>&nbsp;<span class="ident" id="5989035">err</span>&nbsp;<span class="op" id="5989039">=</span>&nbsp;<span class="ident" id="5989041">tw</span><span class="op" id="5989043">.</span><span class="ident" id="5989044">w</span><span class="op" id="5989045">.</span><span class="ident" id="5989046">Write</span><span class="op" id="5989051">(</span><span class="ident" id="5989052">b</span><span class="op" id="5989053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989056">tw</span><span class="op" id="5989058">.</span><span class="ident" id="5989059">nb</span>&nbsp;<span class="op" id="5989062">-=</span>&nbsp;<span class="builtintype" id="5989065">int64</span><span class="op" id="5989070">(</span><span class="ident" id="5989071">n</span><span class="op" id="5989072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989075">if</span>&nbsp;<span class="ident" id="5989078">err</span>&nbsp;<span class="op" id="5989082">==</span>&nbsp;<span class="builtintype" id="5989085">nil</span>&nbsp;<span class="op" id="5989089">&amp;&amp;</span>&nbsp;<span class="ident" id="5989092">overwrite</span>&nbsp;<span class="op" id="5989102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989106">err</span>&nbsp;<span class="op" id="5989110">=</span>&nbsp;<span class="ident" id="5989112">ErrWriteTooLong</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989141">tw</span><span class="op" id="5989143">.</span><span class="ident" id="5989144">err</span>&nbsp;<span class="op" id="5989148">=</span>&nbsp;<span class="ident" id="5989150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989155">return</span><br>
<span class="lineno"></span><span class="op" id="5989162">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5989165">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="5989221">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5989255">func</span>&nbsp;<span class="op" id="5989260">(</span><span class="ident" id="5989261">tw</span>&nbsp;<span class="op" id="5989264">*</span><span class="ident" id="5989265">Writer</span><span class="op" id="5989271">)</span>&nbsp;<span class="ident" id="5989273">Close</span><span class="op" id="5989278">(</span><span class="op" id="5989279">)</span>&nbsp;<span class="builtintype" id="5989281">error</span>&nbsp;<span class="op" id="5989287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989290">if</span>&nbsp;<span class="ident" id="5989293">tw</span><span class="op" id="5989295">.</span><span class="ident" id="5989296">err</span>&nbsp;<span class="op" id="5989300">!=</span>&nbsp;<span class="builtintype" id="5989303">nil</span>&nbsp;<span class="op" id="5989307">||</span>&nbsp;<span class="ident" id="5989310">tw</span><span class="op" id="5989312">.</span><span class="ident" id="5989313">closed</span>&nbsp;<span class="op" id="5989320">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989324">return</span>&nbsp;<span class="ident" id="5989331">tw</span><span class="op" id="5989333">.</span><span class="ident" id="5989334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989342">tw</span><span class="op" id="5989344">.</span><span class="ident" id="5989345">Flush</span><span class="op" id="5989350">(</span><span class="op" id="5989351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989354">tw</span><span class="op" id="5989356">.</span><span class="ident" id="5989357">closed</span>&nbsp;<span class="op" id="5989364">=</span>&nbsp;<span class="builtintype" id="5989366">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989372">if</span>&nbsp;<span class="ident" id="5989375">tw</span><span class="op" id="5989377">.</span><span class="ident" id="5989378">err</span>&nbsp;<span class="op" id="5989382">!=</span>&nbsp;<span class="builtintype" id="5989385">nil</span>&nbsp;<span class="op" id="5989389">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989393">return</span>&nbsp;<span class="ident" id="5989400">tw</span><span class="op" id="5989402">.</span><span class="ident" id="5989403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5989412">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989441">for</span>&nbsp;<span class="ident" id="5989445">i</span>&nbsp;<span class="op" id="5989447">:=</span>&nbsp;<span class="num" id="5989450">0</span><span class="op" id="5989451">;</span>&nbsp;<span class="ident" id="5989453">i</span>&nbsp;<span class="op" id="5989455">&lt;</span>&nbsp;<span class="num" id="5989457">2</span><span class="op" id="5989458">;</span>&nbsp;<span class="ident" id="5989460">i</span><span class="op" id="5989461">++</span>&nbsp;<span class="op" id="5989464">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989468">_</span><span class="op" id="5989469">,</span>&nbsp;<span class="ident" id="5989471">tw</span><span class="op" id="5989473">.</span><span class="ident" id="5989474">err</span>&nbsp;<span class="op" id="5989478">=</span>&nbsp;<span class="ident" id="5989480">tw</span><span class="op" id="5989482">.</span><span class="ident" id="5989483">w</span><span class="op" id="5989484">.</span><span class="ident" id="5989485">Write</span><span class="op" id="5989490">(</span><span class="ident" id="5989491">zeroBlock</span><span class="op" id="5989500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989504">if</span>&nbsp;<span class="ident" id="5989507">tw</span><span class="op" id="5989509">.</span><span class="ident" id="5989510">err</span>&nbsp;<span class="op" id="5989514">!=</span>&nbsp;<span class="builtintype" id="5989517">nil</span>&nbsp;<span class="op" id="5989521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989526">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989537">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989540">return</span>&nbsp;<span class="ident" id="5989547">tw</span><span class="op" id="5989549">.</span><span class="ident" id="5989550">err</span><br>
<span class="lineno"></span><span class="op" id="5989554">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
