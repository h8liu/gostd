<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5297242">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5297298">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5297352">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5297403">package</span>&nbsp;<span class="ident" id="5297411">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5297419">import</span>&nbsp;<span class="op" id="5297426">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5297429">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5297437">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5297448">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5297459">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5297474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5297477">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5297539">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5297578">type</span>&nbsp;<span class="ident" id="5297583">Error</span>&nbsp;<span class="keyword" id="5297589">struct</span>&nbsp;<span class="op" id="5297596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5297599">Code</span>&nbsp;<span class="ident" id="5297604">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5297615">Expr</span>&nbsp;<span class="builtintype" id="5297620">string</span><br>
<span class="lineno"></span><span class="op" id="5297627">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5297630">func</span>&nbsp;<span class="op" id="5297635">(</span><span class="ident" id="5297636">e</span>&nbsp;<span class="op" id="5297638">*</span><span class="ident" id="5297639">Error</span><span class="op" id="5297644">)</span>&nbsp;<span class="ident" id="5297646">Error</span><span class="op" id="5297651">(</span><span class="op" id="5297652">)</span>&nbsp;<span class="builtintype" id="5297654">string</span>&nbsp;<span class="op" id="5297661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5297664">return</span>&nbsp;<span class="string" id="5297671">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5297696">+</span>&nbsp;<span class="ident" id="5297698">e</span><span class="op" id="5297699">.</span><span class="ident" id="5297700">Code</span><span class="op" id="5297704">.</span><span class="ident" id="5297705">String</span><span class="op" id="5297711">(</span><span class="op" id="5297712">)</span>&nbsp;<span class="op" id="5297714">+</span>&nbsp;<span class="string" id="5297716">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5297722">+</span>&nbsp;<span class="ident" id="5297724">e</span><span class="op" id="5297725">.</span><span class="ident" id="5297726">Expr</span>&nbsp;<span class="op" id="5297731">+</span>&nbsp;<span class="string" id="5297733">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5297737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5297740">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5297807">type</span>&nbsp;<span class="ident" id="5297812">ErrorCode</span>&nbsp;<span class="builtintype" id="5297822">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5297830">const</span>&nbsp;<span class="op" id="5297836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5297839">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5297860">ErrInternalError</span>&nbsp;<span class="ident" id="5297877">ErrorCode</span>&nbsp;<span class="op" id="5297887">=</span>&nbsp;<span class="string" id="5297889">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5297923">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5297940">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297965">ErrorCode</span>&nbsp;<span class="op" id="5297975">=</span>&nbsp;<span class="string" id="5297977">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298004">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298029">ErrorCode</span>&nbsp;<span class="op" id="5298039">=</span>&nbsp;<span class="string" id="5298041">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298074">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298099">ErrorCode</span>&nbsp;<span class="op" id="5298109">=</span>&nbsp;<span class="string" id="5298111">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298138">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5298163">ErrorCode</span>&nbsp;<span class="op" id="5298173">=</span>&nbsp;<span class="string" id="5298175">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298200">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298225">ErrorCode</span>&nbsp;<span class="op" id="5298235">=</span>&nbsp;<span class="string" id="5298237">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298275">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298300">ErrorCode</span>&nbsp;<span class="op" id="5298310">=</span>&nbsp;<span class="string" id="5298312">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298350">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298375">ErrorCode</span>&nbsp;<span class="op" id="5298385">=</span>&nbsp;<span class="string" id="5298387">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298411">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298436">ErrorCode</span>&nbsp;<span class="op" id="5298446">=</span>&nbsp;<span class="string" id="5298448">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298465">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298490">ErrorCode</span>&nbsp;<span class="op" id="5298500">=</span>&nbsp;<span class="string" id="5298502">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298523">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298548">ErrorCode</span>&nbsp;<span class="op" id="5298558">=</span>&nbsp;<span class="string" id="5298560">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298581">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5298606">ErrorCode</span>&nbsp;<span class="op" id="5298616">=</span>&nbsp;<span class="string" id="5298618">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298661">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298686">ErrorCode</span>&nbsp;<span class="op" id="5298696">=</span>&nbsp;<span class="string" id="5298698">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298741">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298766">ErrorCode</span>&nbsp;<span class="op" id="5298776">=</span>&nbsp;<span class="string" id="5298778">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5298793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5298796">func</span>&nbsp;<span class="op" id="5298801">(</span><span class="ident" id="5298802">e</span>&nbsp;<span class="ident" id="5298804">ErrorCode</span><span class="op" id="5298813">)</span>&nbsp;<span class="ident" id="5298815">String</span><span class="op" id="5298821">(</span><span class="op" id="5298822">)</span>&nbsp;<span class="builtintype" id="5298824">string</span>&nbsp;<span class="op" id="5298831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5298834">return</span>&nbsp;<span class="builtintype" id="5298841">string</span><span class="op" id="5298847">(</span><span class="ident" id="5298848">e</span><span class="op" id="5298849">)</span><br>
<span class="lineno">50</span><span class="op" id="5298851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5298854">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5298943">type</span>&nbsp;<span class="ident" id="5298948">Flags</span>&nbsp;<span class="builtintype" id="5298954">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5298962">const</span>&nbsp;<span class="op" id="5298968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5298971">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298985">Flags</span>&nbsp;<span class="op" id="5298991">=</span>&nbsp;<span class="num" id="5298993">1</span>&nbsp;<span class="op" id="5298995">&lt;&lt;</span>&nbsp;<span class="ident" id="5298998">iota</span>&nbsp;<span class="comment" id="5299003">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299030">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299062">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299098">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299130">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299203">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299235">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299264">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299296">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299360">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299392">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299444">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299476">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299502">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299534">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299592">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299624">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299659">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299691">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299734">MatchNL</span>&nbsp;<span class="op" id="5299742">=</span>&nbsp;<span class="ident" id="5299744">ClassNL</span>&nbsp;<span class="op" id="5299752">|</span>&nbsp;<span class="ident" id="5299754">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299762">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299774">=</span>&nbsp;<span class="ident" id="5299776">ClassNL</span>&nbsp;<span class="op" id="5299784">|</span>&nbsp;<span class="ident" id="5299786">OneLine</span>&nbsp;<span class="op" id="5299794">|</span>&nbsp;<span class="ident" id="5299796">PerlX</span>&nbsp;<span class="op" id="5299802">|</span>&nbsp;<span class="ident" id="5299804">UnicodeGroups</span>&nbsp;<span class="comment" id="5299818">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299851">POSIX</span>&nbsp;<span class="ident" id="5299857">Flags</span>&nbsp;<span class="op" id="5299863">=</span>&nbsp;<span class="num" id="5299865">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299907">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5299923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5299926">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5299959">const</span>&nbsp;<span class="op" id="5299965">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299968">opLeftParen</span>&nbsp;<span class="op" id="5299980">=</span>&nbsp;<span class="ident" id="5299982">opPseudo</span>&nbsp;<span class="op" id="5299991">+</span>&nbsp;<span class="ident" id="5299993">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5299999">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5300013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5300016">type</span>&nbsp;<span class="ident" id="5300021">parser</span>&nbsp;<span class="keyword" id="5300028">struct</span>&nbsp;<span class="op" id="5300035">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300038">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300050">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5300060">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300081">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300093">[</span><span class="op" id="5300094">]</span><span class="op" id="5300095">*</span><span class="ident" id="5300096">Regexp</span>&nbsp;<span class="comment" id="5300103">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300135">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300147">*</span><span class="ident" id="5300148">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300156">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5300168">int</span>&nbsp;<span class="comment" id="5300172">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300208">wholeRegexp</span>&nbsp;<span class="builtintype" id="5300220">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300228">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300240">[</span><span class="op" id="5300241">]</span><span class="builtintype" id="5300242">rune</span>&nbsp;<span class="comment" id="5300247">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5300282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5300285">func</span>&nbsp;<span class="op" id="5300290">(</span><span class="ident" id="5300291">p</span>&nbsp;<span class="op" id="5300293">*</span><span class="ident" id="5300294">parser</span><span class="op" id="5300300">)</span>&nbsp;<span class="ident" id="5300302">newRegexp</span><span class="op" id="5300311">(</span><span class="ident" id="5300312">op</span>&nbsp;<span class="ident" id="5300315">Op</span><span class="op" id="5300317">)</span>&nbsp;<span class="op" id="5300319">*</span><span class="ident" id="5300320">Regexp</span>&nbsp;<span class="op" id="5300327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300330">re</span>&nbsp;<span class="op" id="5300333">:=</span>&nbsp;<span class="ident" id="5300336">p</span><span class="op" id="5300337">.</span><span class="ident" id="5300338">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300344">if</span>&nbsp;<span class="ident" id="5300347">re</span>&nbsp;<span class="op" id="5300350">!=</span>&nbsp;<span class="ident" id="5300353">nil</span>&nbsp;<span class="op" id="5300357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300361">p</span><span class="op" id="5300362">.</span><span class="ident" id="5300363">free</span>&nbsp;<span class="op" id="5300368">=</span>&nbsp;<span class="ident" id="5300370">re</span><span class="op" id="5300372">.</span><span class="ident" id="5300373">Sub0</span><span class="op" id="5300377">[</span><span class="num" id="5300378">0</span><span class="op" id="5300379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300383">*</span><span class="ident" id="5300384">re</span>&nbsp;<span class="op" id="5300387">=</span>&nbsp;<span class="ident" id="5300389">Regexp</span><span class="op" id="5300395">{</span><span class="op" id="5300396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300399">}</span>&nbsp;<span class="keyword" id="5300401">else</span>&nbsp;<span class="op" id="5300406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300410">re</span>&nbsp;<span class="op" id="5300413">=</span>&nbsp;<span class="builtinfunc" id="5300415">new</span><span class="op" id="5300418">(</span><span class="ident" id="5300419">Regexp</span><span class="op" id="5300425">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300431">re</span><span class="op" id="5300433">.</span><span class="ident" id="5300434">Op</span>&nbsp;<span class="op" id="5300437">=</span>&nbsp;<span class="ident" id="5300439">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300443">return</span>&nbsp;<span class="ident" id="5300450">re</span><br>
<span class="lineno"></span><span class="op" id="5300453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5300456">func</span>&nbsp;<span class="op" id="5300461">(</span><span class="ident" id="5300462">p</span>&nbsp;<span class="op" id="5300464">*</span><span class="ident" id="5300465">parser</span><span class="op" id="5300471">)</span>&nbsp;<span class="ident" id="5300473">reuse</span><span class="op" id="5300478">(</span><span class="ident" id="5300479">re</span>&nbsp;<span class="op" id="5300482">*</span><span class="ident" id="5300483">Regexp</span><span class="op" id="5300489">)</span>&nbsp;<span class="op" id="5300491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300494">re</span><span class="op" id="5300496">.</span><span class="ident" id="5300497">Sub0</span><span class="op" id="5300501">[</span><span class="num" id="5300502">0</span><span class="op" id="5300503">]</span>&nbsp;<span class="op" id="5300505">=</span>&nbsp;<span class="ident" id="5300507">p</span><span class="op" id="5300508">.</span><span class="ident" id="5300509">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300515">p</span><span class="op" id="5300516">.</span><span class="ident" id="5300517">free</span>&nbsp;<span class="op" id="5300522">=</span>&nbsp;<span class="ident" id="5300524">re</span><br>
<span class="lineno"></span><span class="op" id="5300527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5300530">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5300560">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5300634">func</span>&nbsp;<span class="op" id="5300639">(</span><span class="ident" id="5300640">p</span>&nbsp;<span class="op" id="5300642">*</span><span class="ident" id="5300643">parser</span><span class="op" id="5300649">)</span>&nbsp;<span class="ident" id="5300651">push</span><span class="op" id="5300655">(</span><span class="ident" id="5300656">re</span>&nbsp;<span class="op" id="5300659">*</span><span class="ident" id="5300660">Regexp</span><span class="op" id="5300666">)</span>&nbsp;<span class="op" id="5300668">*</span><span class="ident" id="5300669">Regexp</span>&nbsp;<span class="op" id="5300676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300679">if</span>&nbsp;<span class="ident" id="5300682">re</span><span class="op" id="5300684">.</span><span class="ident" id="5300685">Op</span>&nbsp;<span class="op" id="5300688">==</span>&nbsp;<span class="ident" id="5300691">OpCharClass</span>&nbsp;<span class="op" id="5300703">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5300706">len</span><span class="op" id="5300709">(</span><span class="ident" id="5300710">re</span><span class="op" id="5300712">.</span><span class="ident" id="5300713">Rune</span><span class="op" id="5300717">)</span>&nbsp;<span class="op" id="5300719">==</span>&nbsp;<span class="num" id="5300722">2</span>&nbsp;<span class="op" id="5300724">&amp;&amp;</span>&nbsp;<span class="ident" id="5300727">re</span><span class="op" id="5300729">.</span><span class="ident" id="5300730">Rune</span><span class="op" id="5300734">[</span><span class="num" id="5300735">0</span><span class="op" id="5300736">]</span>&nbsp;<span class="op" id="5300738">==</span>&nbsp;<span class="ident" id="5300741">re</span><span class="op" id="5300743">.</span><span class="ident" id="5300744">Rune</span><span class="op" id="5300748">[</span><span class="num" id="5300749">1</span><span class="op" id="5300750">]</span>&nbsp;<span class="op" id="5300752">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5300756">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300774">if</span>&nbsp;<span class="ident" id="5300777">p</span><span class="op" id="5300778">.</span><span class="ident" id="5300779">maybeConcat</span><span class="op" id="5300790">(</span><span class="ident" id="5300791">re</span><span class="op" id="5300793">.</span><span class="ident" id="5300794">Rune</span><span class="op" id="5300798">[</span><span class="num" id="5300799">0</span><span class="op" id="5300800">]</span><span class="op" id="5300801">,</span>&nbsp;<span class="ident" id="5300803">p</span><span class="op" id="5300804">.</span><span class="ident" id="5300805">flags</span><span class="op" id="5300810">&amp;^</span><span class="ident" id="5300812">FoldCase</span><span class="op" id="5300820">)</span>&nbsp;<span class="op" id="5300822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5300827">return</span>&nbsp;<span class="ident" id="5300834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300844">re</span><span class="op" id="5300846">.</span><span class="ident" id="5300847">Op</span>&nbsp;<span class="op" id="5300850">=</span>&nbsp;<span class="ident" id="5300852">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300864">re</span><span class="op" id="5300866">.</span><span class="ident" id="5300867">Rune</span>&nbsp;<span class="op" id="5300872">=</span>&nbsp;<span class="ident" id="5300874">re</span><span class="op" id="5300876">.</span><span class="ident" id="5300877">Rune</span><span class="op" id="5300881">[</span><span class="op" id="5300882">:</span><span class="num" id="5300883">1</span><span class="op" id="5300884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300888">re</span><span class="op" id="5300890">.</span><span class="ident" id="5300891">Flags</span>&nbsp;<span class="op" id="5300897">=</span>&nbsp;<span class="ident" id="5300899">p</span><span class="op" id="5300900">.</span><span class="ident" id="5300901">flags</span>&nbsp;<span class="op" id="5300907">&amp;^</span>&nbsp;<span class="ident" id="5300910">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5300920">}</span>&nbsp;<span class="keyword" id="5300922">else</span>&nbsp;<span class="keyword" id="5300927">if</span>&nbsp;<span class="ident" id="5300930">re</span><span class="op" id="5300932">.</span><span class="ident" id="5300933">Op</span>&nbsp;<span class="op" id="5300936">==</span>&nbsp;<span class="ident" id="5300939">OpCharClass</span>&nbsp;<span class="op" id="5300951">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5300954">len</span><span class="op" id="5300957">(</span><span class="ident" id="5300958">re</span><span class="op" id="5300960">.</span><span class="ident" id="5300961">Rune</span><span class="op" id="5300965">)</span>&nbsp;<span class="op" id="5300967">==</span>&nbsp;<span class="num" id="5300970">4</span>&nbsp;<span class="op" id="5300972">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5300977">re</span><span class="op" id="5300979">.</span><span class="ident" id="5300980">Rune</span><span class="op" id="5300984">[</span><span class="num" id="5300985">0</span><span class="op" id="5300986">]</span>&nbsp;<span class="op" id="5300988">==</span>&nbsp;<span class="ident" id="5300991">re</span><span class="op" id="5300993">.</span><span class="ident" id="5300994">Rune</span><span class="op" id="5300998">[</span><span class="num" id="5300999">1</span><span class="op" id="5301000">]</span>&nbsp;<span class="op" id="5301002">&amp;&amp;</span>&nbsp;<span class="ident" id="5301005">re</span><span class="op" id="5301007">.</span><span class="ident" id="5301008">Rune</span><span class="op" id="5301012">[</span><span class="num" id="5301013">2</span><span class="op" id="5301014">]</span>&nbsp;<span class="op" id="5301016">==</span>&nbsp;<span class="ident" id="5301019">re</span><span class="op" id="5301021">.</span><span class="ident" id="5301022">Rune</span><span class="op" id="5301026">[</span><span class="num" id="5301027">3</span><span class="op" id="5301028">]</span>&nbsp;<span class="op" id="5301030">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301035">unicode</span><span class="op" id="5301042">.</span><span class="ident" id="5301043">SimpleFold</span><span class="op" id="5301053">(</span><span class="ident" id="5301054">re</span><span class="op" id="5301056">.</span><span class="ident" id="5301057">Rune</span><span class="op" id="5301061">[</span><span class="num" id="5301062">0</span><span class="op" id="5301063">]</span><span class="op" id="5301064">)</span>&nbsp;<span class="op" id="5301066">==</span>&nbsp;<span class="ident" id="5301069">re</span><span class="op" id="5301071">.</span><span class="ident" id="5301072">Rune</span><span class="op" id="5301076">[</span><span class="num" id="5301077">2</span><span class="op" id="5301078">]</span>&nbsp;<span class="op" id="5301080">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301085">unicode</span><span class="op" id="5301092">.</span><span class="ident" id="5301093">SimpleFold</span><span class="op" id="5301103">(</span><span class="ident" id="5301104">re</span><span class="op" id="5301106">.</span><span class="ident" id="5301107">Rune</span><span class="op" id="5301111">[</span><span class="num" id="5301112">2</span><span class="op" id="5301113">]</span><span class="op" id="5301114">)</span>&nbsp;<span class="op" id="5301116">==</span>&nbsp;<span class="ident" id="5301119">re</span><span class="op" id="5301121">.</span><span class="ident" id="5301122">Rune</span><span class="op" id="5301126">[</span><span class="num" id="5301127">0</span><span class="op" id="5301128">]</span>&nbsp;<span class="op" id="5301130">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301135">re</span><span class="op" id="5301137">.</span><span class="ident" id="5301138">Op</span>&nbsp;<span class="op" id="5301141">==</span>&nbsp;<span class="ident" id="5301144">OpCharClass</span>&nbsp;<span class="op" id="5301156">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5301159">len</span><span class="op" id="5301162">(</span><span class="ident" id="5301163">re</span><span class="op" id="5301165">.</span><span class="ident" id="5301166">Rune</span><span class="op" id="5301170">)</span>&nbsp;<span class="op" id="5301172">==</span>&nbsp;<span class="num" id="5301175">2</span>&nbsp;<span class="op" id="5301177">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301183">re</span><span class="op" id="5301185">.</span><span class="ident" id="5301186">Rune</span><span class="op" id="5301190">[</span><span class="num" id="5301191">0</span><span class="op" id="5301192">]</span><span class="op" id="5301193">+</span><span class="num" id="5301194">1</span>&nbsp;<span class="op" id="5301196">==</span>&nbsp;<span class="ident" id="5301199">re</span><span class="op" id="5301201">.</span><span class="ident" id="5301202">Rune</span><span class="op" id="5301206">[</span><span class="num" id="5301207">1</span><span class="op" id="5301208">]</span>&nbsp;<span class="op" id="5301210">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301216">unicode</span><span class="op" id="5301223">.</span><span class="ident" id="5301224">SimpleFold</span><span class="op" id="5301234">(</span><span class="ident" id="5301235">re</span><span class="op" id="5301237">.</span><span class="ident" id="5301238">Rune</span><span class="op" id="5301242">[</span><span class="num" id="5301243">0</span><span class="op" id="5301244">]</span><span class="op" id="5301245">)</span>&nbsp;<span class="op" id="5301247">==</span>&nbsp;<span class="ident" id="5301250">re</span><span class="op" id="5301252">.</span><span class="ident" id="5301253">Rune</span><span class="op" id="5301257">[</span><span class="num" id="5301258">1</span><span class="op" id="5301259">]</span>&nbsp;<span class="op" id="5301261">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301267">unicode</span><span class="op" id="5301274">.</span><span class="ident" id="5301275">SimpleFold</span><span class="op" id="5301285">(</span><span class="ident" id="5301286">re</span><span class="op" id="5301288">.</span><span class="ident" id="5301289">Rune</span><span class="op" id="5301293">[</span><span class="num" id="5301294">1</span><span class="op" id="5301295">]</span><span class="op" id="5301296">)</span>&nbsp;<span class="op" id="5301298">==</span>&nbsp;<span class="ident" id="5301301">re</span><span class="op" id="5301303">.</span><span class="ident" id="5301304">Rune</span><span class="op" id="5301308">[</span><span class="num" id="5301309">0</span><span class="op" id="5301310">]</span>&nbsp;<span class="op" id="5301312">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301316">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301364">if</span>&nbsp;<span class="ident" id="5301367">p</span><span class="op" id="5301368">.</span><span class="ident" id="5301369">maybeConcat</span><span class="op" id="5301380">(</span><span class="ident" id="5301381">re</span><span class="op" id="5301383">.</span><span class="ident" id="5301384">Rune</span><span class="op" id="5301388">[</span><span class="num" id="5301389">0</span><span class="op" id="5301390">]</span><span class="op" id="5301391">,</span>&nbsp;<span class="ident" id="5301393">p</span><span class="op" id="5301394">.</span><span class="ident" id="5301395">flags</span><span class="op" id="5301400">|</span><span class="ident" id="5301401">FoldCase</span><span class="op" id="5301409">)</span>&nbsp;<span class="op" id="5301411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301416">return</span>&nbsp;<span class="ident" id="5301423">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301434">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301478">re</span><span class="op" id="5301480">.</span><span class="ident" id="5301481">Op</span>&nbsp;<span class="op" id="5301484">=</span>&nbsp;<span class="ident" id="5301486">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301498">re</span><span class="op" id="5301500">.</span><span class="ident" id="5301501">Rune</span>&nbsp;<span class="op" id="5301506">=</span>&nbsp;<span class="ident" id="5301508">re</span><span class="op" id="5301510">.</span><span class="ident" id="5301511">Rune</span><span class="op" id="5301515">[</span><span class="op" id="5301516">:</span><span class="num" id="5301517">1</span><span class="op" id="5301518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301522">re</span><span class="op" id="5301524">.</span><span class="ident" id="5301525">Flags</span>&nbsp;<span class="op" id="5301531">=</span>&nbsp;<span class="ident" id="5301533">p</span><span class="op" id="5301534">.</span><span class="ident" id="5301535">flags</span>&nbsp;<span class="op" id="5301541">|</span>&nbsp;<span class="ident" id="5301543">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301553">}</span>&nbsp;<span class="keyword" id="5301555">else</span>&nbsp;<span class="op" id="5301560">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5301564">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301596">p</span><span class="op" id="5301597">.</span><span class="ident" id="5301598">maybeConcat</span><span class="op" id="5301609">(</span><span class="op" id="5301610">-</span><span class="num" id="5301611">1</span><span class="op" id="5301612">,</span>&nbsp;<span class="num" id="5301614">0</span><span class="op" id="5301615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5301618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5301622">p</span><span class="op" id="5301623">.</span><span class="ident" id="5301624">stack</span>&nbsp;<span class="op" id="5301630">=</span>&nbsp;<span class="builtinfunc" id="5301632">append</span><span class="op" id="5301638">(</span><span class="ident" id="5301639">p</span><span class="op" id="5301640">.</span><span class="ident" id="5301641">stack</span><span class="op" id="5301646">,</span>&nbsp;<span class="ident" id="5301648">re</span><span class="op" id="5301650">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5301653">return</span>&nbsp;<span class="ident" id="5301660">re</span><br>
<span class="lineno"></span><span class="op" id="5301663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5301666">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5301718">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5301780">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5301839">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5301902">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5301966">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5302008">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5302071">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5302106">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5302151">func</span>&nbsp;<span class="op" id="5302156">(</span><span class="ident" id="5302157">p</span>&nbsp;<span class="op" id="5302159">*</span><span class="ident" id="5302160">parser</span><span class="op" id="5302166">)</span>&nbsp;<span class="ident" id="5302168">maybeConcat</span><span class="op" id="5302179">(</span><span class="ident" id="5302180">r</span>&nbsp;<span class="builtintype" id="5302182">rune</span><span class="op" id="5302186">,</span>&nbsp;<span class="ident" id="5302188">flags</span>&nbsp;<span class="ident" id="5302194">Flags</span><span class="op" id="5302199">)</span>&nbsp;<span class="builtintype" id="5302201">bool</span>&nbsp;<span class="op" id="5302206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302209">n</span>&nbsp;<span class="op" id="5302211">:=</span>&nbsp;<span class="builtinfunc" id="5302214">len</span><span class="op" id="5302217">(</span><span class="ident" id="5302218">p</span><span class="op" id="5302219">.</span><span class="ident" id="5302220">stack</span><span class="op" id="5302225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302228">if</span>&nbsp;<span class="ident" id="5302231">n</span>&nbsp;<span class="op" id="5302233">&lt;</span>&nbsp;<span class="num" id="5302235">2</span>&nbsp;<span class="op" id="5302237">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302241">return</span>&nbsp;<span class="builtintype" id="5302248">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5302255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302259">re1</span>&nbsp;<span class="op" id="5302263">:=</span>&nbsp;<span class="ident" id="5302266">p</span><span class="op" id="5302267">.</span><span class="ident" id="5302268">stack</span><span class="op" id="5302273">[</span><span class="ident" id="5302274">n</span><span class="op" id="5302275">-</span><span class="num" id="5302276">1</span><span class="op" id="5302277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302280">re2</span>&nbsp;<span class="op" id="5302284">:=</span>&nbsp;<span class="ident" id="5302287">p</span><span class="op" id="5302288">.</span><span class="ident" id="5302289">stack</span><span class="op" id="5302294">[</span><span class="ident" id="5302295">n</span><span class="op" id="5302296">-</span><span class="num" id="5302297">2</span><span class="op" id="5302298">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302301">if</span>&nbsp;<span class="ident" id="5302304">re1</span><span class="op" id="5302307">.</span><span class="ident" id="5302308">Op</span>&nbsp;<span class="op" id="5302311">!=</span>&nbsp;<span class="ident" id="5302314">OpLiteral</span>&nbsp;<span class="op" id="5302324">||</span>&nbsp;<span class="ident" id="5302327">re2</span><span class="op" id="5302330">.</span><span class="ident" id="5302331">Op</span>&nbsp;<span class="op" id="5302334">!=</span>&nbsp;<span class="ident" id="5302337">OpLiteral</span>&nbsp;<span class="op" id="5302347">||</span>&nbsp;<span class="ident" id="5302350">re1</span><span class="op" id="5302353">.</span><span class="ident" id="5302354">Flags</span><span class="op" id="5302359">&amp;</span><span class="ident" id="5302360">FoldCase</span>&nbsp;<span class="op" id="5302369">!=</span>&nbsp;<span class="ident" id="5302372">re2</span><span class="op" id="5302375">.</span><span class="ident" id="5302376">Flags</span><span class="op" id="5302381">&amp;</span><span class="ident" id="5302382">FoldCase</span>&nbsp;<span class="op" id="5302391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302395">return</span>&nbsp;<span class="builtintype" id="5302402">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5302409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5302413">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302436">re2</span><span class="op" id="5302439">.</span><span class="ident" id="5302440">Rune</span>&nbsp;<span class="op" id="5302445">=</span>&nbsp;<span class="builtinfunc" id="5302447">append</span><span class="op" id="5302453">(</span><span class="ident" id="5302454">re2</span><span class="op" id="5302457">.</span><span class="ident" id="5302458">Rune</span><span class="op" id="5302462">,</span>&nbsp;<span class="ident" id="5302464">re1</span><span class="op" id="5302467">.</span><span class="ident" id="5302468">Rune</span><span class="op" id="5302472">...</span><span class="op" id="5302475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5302479">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302506">if</span>&nbsp;<span class="ident" id="5302509">r</span>&nbsp;<span class="op" id="5302511">&gt;=</span>&nbsp;<span class="num" id="5302514">0</span>&nbsp;<span class="op" id="5302516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302520">re1</span><span class="op" id="5302523">.</span><span class="ident" id="5302524">Rune</span>&nbsp;<span class="op" id="5302529">=</span>&nbsp;<span class="ident" id="5302531">re1</span><span class="op" id="5302534">.</span><span class="ident" id="5302535">Rune0</span><span class="op" id="5302540">[</span><span class="op" id="5302541">:</span><span class="num" id="5302542">1</span><span class="op" id="5302543">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302547">re1</span><span class="op" id="5302550">.</span><span class="ident" id="5302551">Rune</span><span class="op" id="5302555">[</span><span class="num" id="5302556">0</span><span class="op" id="5302557">]</span>&nbsp;<span class="op" id="5302559">=</span>&nbsp;<span class="ident" id="5302561">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302565">re1</span><span class="op" id="5302568">.</span><span class="ident" id="5302569">Flags</span>&nbsp;<span class="op" id="5302575">=</span>&nbsp;<span class="ident" id="5302577">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302585">return</span>&nbsp;<span class="builtintype" id="5302592">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5302598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302602">p</span><span class="op" id="5302603">.</span><span class="ident" id="5302604">stack</span>&nbsp;<span class="op" id="5302610">=</span>&nbsp;<span class="ident" id="5302612">p</span><span class="op" id="5302613">.</span><span class="ident" id="5302614">stack</span><span class="op" id="5302619">[</span><span class="op" id="5302620">:</span><span class="ident" id="5302621">n</span><span class="op" id="5302622">-</span><span class="num" id="5302623">1</span><span class="op" id="5302624">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302627">p</span><span class="op" id="5302628">.</span><span class="ident" id="5302629">reuse</span><span class="op" id="5302634">(</span><span class="ident" id="5302635">re1</span><span class="op" id="5302638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302641">return</span>&nbsp;<span class="builtintype" id="5302648">false</span>&nbsp;<span class="comment" id="5302654">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5302672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5302675">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5302741">func</span>&nbsp;<span class="op" id="5302746">(</span><span class="ident" id="5302747">p</span>&nbsp;<span class="op" id="5302749">*</span><span class="ident" id="5302750">parser</span><span class="op" id="5302756">)</span>&nbsp;<span class="ident" id="5302758">newLiteral</span><span class="op" id="5302768">(</span><span class="ident" id="5302769">r</span>&nbsp;<span class="builtintype" id="5302771">rune</span><span class="op" id="5302775">,</span>&nbsp;<span class="ident" id="5302777">flags</span>&nbsp;<span class="ident" id="5302783">Flags</span><span class="op" id="5302788">)</span>&nbsp;<span class="op" id="5302790">*</span><span class="ident" id="5302791">Regexp</span>&nbsp;<span class="op" id="5302798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302801">re</span>&nbsp;<span class="op" id="5302804">:=</span>&nbsp;<span class="ident" id="5302807">p</span><span class="op" id="5302808">.</span><span class="ident" id="5302809">newRegexp</span><span class="op" id="5302818">(</span><span class="ident" id="5302819">OpLiteral</span><span class="op" id="5302828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302831">re</span><span class="op" id="5302833">.</span><span class="ident" id="5302834">Flags</span>&nbsp;<span class="op" id="5302840">=</span>&nbsp;<span class="ident" id="5302842">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302849">if</span>&nbsp;<span class="ident" id="5302852">flags</span><span class="op" id="5302857">&amp;</span><span class="ident" id="5302858">FoldCase</span>&nbsp;<span class="op" id="5302867">!=</span>&nbsp;<span class="num" id="5302870">0</span>&nbsp;<span class="op" id="5302872">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302876">r</span>&nbsp;<span class="op" id="5302878">=</span>&nbsp;<span class="ident" id="5302880">minFoldRune</span><span class="op" id="5302891">(</span><span class="ident" id="5302892">r</span><span class="op" id="5302893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5302896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302899">re</span><span class="op" id="5302901">.</span><span class="ident" id="5302902">Rune0</span><span class="op" id="5302907">[</span><span class="num" id="5302908">0</span><span class="op" id="5302909">]</span>&nbsp;<span class="op" id="5302911">=</span>&nbsp;<span class="ident" id="5302913">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5302916">re</span><span class="op" id="5302918">.</span><span class="ident" id="5302919">Rune</span>&nbsp;<span class="op" id="5302924">=</span>&nbsp;<span class="ident" id="5302926">re</span><span class="op" id="5302928">.</span><span class="ident" id="5302929">Rune0</span><span class="op" id="5302934">[</span><span class="op" id="5302935">:</span><span class="num" id="5302936">1</span><span class="op" id="5302937">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5302940">return</span>&nbsp;<span class="ident" id="5302947">re</span><br>
<span class="lineno">190</span><span class="op" id="5302950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5302953">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5303015">func</span>&nbsp;<span class="ident" id="5303020">minFoldRune</span><span class="op" id="5303031">(</span><span class="ident" id="5303032">r</span>&nbsp;<span class="builtintype" id="5303034">rune</span><span class="op" id="5303038">)</span>&nbsp;<span class="builtintype" id="5303040">rune</span>&nbsp;<span class="op" id="5303045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303048">if</span>&nbsp;<span class="ident" id="5303051">r</span>&nbsp;<span class="op" id="5303053">&lt;</span>&nbsp;<span class="ident" id="5303055">minFold</span>&nbsp;<span class="op" id="5303063">||</span>&nbsp;<span class="ident" id="5303066">r</span>&nbsp;<span class="op" id="5303068">&gt;</span>&nbsp;<span class="ident" id="5303070">maxFold</span>&nbsp;<span class="op" id="5303078">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303082">return</span>&nbsp;<span class="ident" id="5303089">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5303092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303095">min</span>&nbsp;<span class="op" id="5303099">:=</span>&nbsp;<span class="ident" id="5303102">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303105">r0</span>&nbsp;<span class="op" id="5303108">:=</span>&nbsp;<span class="ident" id="5303111">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303114">for</span>&nbsp;<span class="ident" id="5303118">r</span>&nbsp;<span class="op" id="5303120">=</span>&nbsp;<span class="ident" id="5303122">unicode</span><span class="op" id="5303129">.</span><span class="ident" id="5303130">SimpleFold</span><span class="op" id="5303140">(</span><span class="ident" id="5303141">r</span><span class="op" id="5303142">)</span><span class="op" id="5303143">;</span>&nbsp;<span class="ident" id="5303145">r</span>&nbsp;<span class="op" id="5303147">!=</span>&nbsp;<span class="ident" id="5303150">r0</span><span class="op" id="5303152">;</span>&nbsp;<span class="ident" id="5303154">r</span>&nbsp;<span class="op" id="5303156">=</span>&nbsp;<span class="ident" id="5303158">unicode</span><span class="op" id="5303165">.</span><span class="ident" id="5303166">SimpleFold</span><span class="op" id="5303176">(</span><span class="ident" id="5303177">r</span><span class="op" id="5303178">)</span>&nbsp;<span class="op" id="5303180">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303184">if</span>&nbsp;<span class="ident" id="5303187">min</span>&nbsp;<span class="op" id="5303191">&gt;</span>&nbsp;<span class="ident" id="5303193">r</span>&nbsp;<span class="op" id="5303195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303200">min</span>&nbsp;<span class="op" id="5303204">=</span>&nbsp;<span class="ident" id="5303206">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5303210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5303213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303216">return</span>&nbsp;<span class="ident" id="5303223">min</span><br>
<span class="lineno">205</span><span class="op" id="5303227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5303230">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5303293">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5303321">func</span>&nbsp;<span class="op" id="5303326">(</span><span class="ident" id="5303327">p</span>&nbsp;<span class="op" id="5303329">*</span><span class="ident" id="5303330">parser</span><span class="op" id="5303336">)</span>&nbsp;<span class="ident" id="5303338">literal</span><span class="op" id="5303345">(</span><span class="ident" id="5303346">r</span>&nbsp;<span class="builtintype" id="5303348">rune</span><span class="op" id="5303352">)</span>&nbsp;<span class="op" id="5303354">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303357">p</span><span class="op" id="5303358">.</span><span class="ident" id="5303359">push</span><span class="op" id="5303363">(</span><span class="ident" id="5303364">p</span><span class="op" id="5303365">.</span><span class="ident" id="5303366">newLiteral</span><span class="op" id="5303376">(</span><span class="ident" id="5303377">r</span><span class="op" id="5303378">,</span>&nbsp;<span class="ident" id="5303380">p</span><span class="op" id="5303381">.</span><span class="ident" id="5303382">flags</span><span class="op" id="5303387">)</span><span class="op" id="5303388">)</span><br>
<span class="lineno"></span><span class="op" id="5303390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5303393">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5303448">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5303476">func</span>&nbsp;<span class="op" id="5303481">(</span><span class="ident" id="5303482">p</span>&nbsp;<span class="op" id="5303484">*</span><span class="ident" id="5303485">parser</span><span class="op" id="5303491">)</span>&nbsp;<span class="ident" id="5303493">op</span><span class="op" id="5303495">(</span><span class="ident" id="5303496">op</span>&nbsp;<span class="ident" id="5303499">Op</span><span class="op" id="5303501">)</span>&nbsp;<span class="op" id="5303503">*</span><span class="ident" id="5303504">Regexp</span>&nbsp;<span class="op" id="5303511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303514">re</span>&nbsp;<span class="op" id="5303517">:=</span>&nbsp;<span class="ident" id="5303520">p</span><span class="op" id="5303521">.</span><span class="ident" id="5303522">newRegexp</span><span class="op" id="5303531">(</span><span class="ident" id="5303532">op</span><span class="op" id="5303534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303537">re</span><span class="op" id="5303539">.</span><span class="ident" id="5303540">Flags</span>&nbsp;<span class="op" id="5303546">=</span>&nbsp;<span class="ident" id="5303548">p</span><span class="op" id="5303549">.</span><span class="ident" id="5303550">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303557">return</span>&nbsp;<span class="ident" id="5303564">p</span><span class="op" id="5303565">.</span><span class="ident" id="5303566">push</span><span class="op" id="5303570">(</span><span class="ident" id="5303571">re</span><span class="op" id="5303573">)</span><br>
<span class="lineno"></span><span class="op" id="5303575">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5303578">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5303667">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5303735">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5303806">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5303865">func</span>&nbsp;<span class="op" id="5303870">(</span><span class="ident" id="5303871">p</span>&nbsp;<span class="op" id="5303873">*</span><span class="ident" id="5303874">parser</span><span class="op" id="5303880">)</span>&nbsp;<span class="ident" id="5303882">repeat</span><span class="op" id="5303888">(</span><span class="ident" id="5303889">op</span>&nbsp;<span class="ident" id="5303892">Op</span><span class="op" id="5303894">,</span>&nbsp;<span class="ident" id="5303896">min</span><span class="op" id="5303899">,</span>&nbsp;<span class="ident" id="5303901">max</span>&nbsp;<span class="builtintype" id="5303905">int</span><span class="op" id="5303908">,</span>&nbsp;<span class="ident" id="5303910">before</span><span class="op" id="5303916">,</span>&nbsp;<span class="ident" id="5303918">after</span><span class="op" id="5303923">,</span>&nbsp;<span class="ident" id="5303925">lastRepeat</span>&nbsp;<span class="builtintype" id="5303936">string</span><span class="op" id="5303942">)</span>&nbsp;<span class="op" id="5303944">(</span><span class="builtintype" id="5303945">string</span><span class="op" id="5303951">,</span>&nbsp;<span class="builtintype" id="5303953">error</span><span class="op" id="5303958">)</span>&nbsp;<span class="op" id="5303960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5303963">flags</span>&nbsp;<span class="op" id="5303969">:=</span>&nbsp;<span class="ident" id="5303972">p</span><span class="op" id="5303973">.</span><span class="ident" id="5303974">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5303981">if</span>&nbsp;<span class="ident" id="5303984">p</span><span class="op" id="5303985">.</span><span class="ident" id="5303986">flags</span><span class="op" id="5303991">&amp;</span><span class="ident" id="5303992">PerlX</span>&nbsp;<span class="op" id="5303998">!=</span>&nbsp;<span class="num" id="5304001">0</span>&nbsp;<span class="op" id="5304003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304007">if</span>&nbsp;<span class="builtinfunc" id="5304010">len</span><span class="op" id="5304013">(</span><span class="ident" id="5304014">after</span><span class="op" id="5304019">)</span>&nbsp;<span class="op" id="5304021">&gt;</span>&nbsp;<span class="num" id="5304023">0</span>&nbsp;<span class="op" id="5304025">&amp;&amp;</span>&nbsp;<span class="ident" id="5304028">after</span><span class="op" id="5304033">[</span><span class="num" id="5304034">0</span><span class="op" id="5304035">]</span>&nbsp;<span class="op" id="5304037">==</span>&nbsp;<span class="string" id="5304040">&#39;?&#39;</span>&nbsp;<span class="op" id="5304044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304049">after</span>&nbsp;<span class="op" id="5304055">=</span>&nbsp;<span class="ident" id="5304057">after</span><span class="op" id="5304062">[</span><span class="num" id="5304063">1</span><span class="op" id="5304064">:</span><span class="op" id="5304065">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304070">flags</span>&nbsp;<span class="op" id="5304076">^=</span>&nbsp;<span class="ident" id="5304079">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304095">if</span>&nbsp;<span class="ident" id="5304098">lastRepeat</span>&nbsp;<span class="op" id="5304109">!=</span>&nbsp;<span class="string" id="5304112">&#34;&#34;</span>&nbsp;<span class="op" id="5304115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5304120">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5304183">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5304246">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304301">return</span>&nbsp;<span class="string" id="5304308">&#34;&#34;</span><span class="op" id="5304310">,</span>&nbsp;<span class="op" id="5304312">&amp;</span><span class="ident" id="5304313">Error</span><span class="op" id="5304318">{</span><span class="ident" id="5304319">ErrInvalidRepeatOp</span><span class="op" id="5304337">,</span>&nbsp;<span class="ident" id="5304339">lastRepeat</span><span class="op" id="5304349">[</span><span class="op" id="5304350">:</span><span class="builtinfunc" id="5304351">len</span><span class="op" id="5304354">(</span><span class="ident" id="5304355">lastRepeat</span><span class="op" id="5304365">)</span><span class="op" id="5304366">-</span><span class="builtinfunc" id="5304367">len</span><span class="op" id="5304370">(</span><span class="ident" id="5304371">after</span><span class="op" id="5304376">)</span><span class="op" id="5304377">]</span><span class="op" id="5304378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304388">n</span>&nbsp;<span class="op" id="5304390">:=</span>&nbsp;<span class="builtinfunc" id="5304393">len</span><span class="op" id="5304396">(</span><span class="ident" id="5304397">p</span><span class="op" id="5304398">.</span><span class="ident" id="5304399">stack</span><span class="op" id="5304404">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304407">if</span>&nbsp;<span class="ident" id="5304410">n</span>&nbsp;<span class="op" id="5304412">==</span>&nbsp;<span class="num" id="5304415">0</span>&nbsp;<span class="op" id="5304417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304421">return</span>&nbsp;<span class="string" id="5304428">&#34;&#34;</span><span class="op" id="5304430">,</span>&nbsp;<span class="op" id="5304432">&amp;</span><span class="ident" id="5304433">Error</span><span class="op" id="5304438">{</span><span class="ident" id="5304439">ErrMissingRepeatArgument</span><span class="op" id="5304463">,</span>&nbsp;<span class="ident" id="5304465">before</span><span class="op" id="5304471">[</span><span class="op" id="5304472">:</span><span class="builtinfunc" id="5304473">len</span><span class="op" id="5304476">(</span><span class="ident" id="5304477">before</span><span class="op" id="5304483">)</span><span class="op" id="5304484">-</span><span class="builtinfunc" id="5304485">len</span><span class="op" id="5304488">(</span><span class="ident" id="5304489">after</span><span class="op" id="5304494">)</span><span class="op" id="5304495">]</span><span class="op" id="5304496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304502">sub</span>&nbsp;<span class="op" id="5304506">:=</span>&nbsp;<span class="ident" id="5304509">p</span><span class="op" id="5304510">.</span><span class="ident" id="5304511">stack</span><span class="op" id="5304516">[</span><span class="ident" id="5304517">n</span><span class="op" id="5304518">-</span><span class="num" id="5304519">1</span><span class="op" id="5304520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304523">if</span>&nbsp;<span class="ident" id="5304526">sub</span><span class="op" id="5304529">.</span><span class="ident" id="5304530">Op</span>&nbsp;<span class="op" id="5304533">&gt;=</span>&nbsp;<span class="ident" id="5304536">opPseudo</span>&nbsp;<span class="op" id="5304545">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304549">return</span>&nbsp;<span class="string" id="5304556">&#34;&#34;</span><span class="op" id="5304558">,</span>&nbsp;<span class="op" id="5304560">&amp;</span><span class="ident" id="5304561">Error</span><span class="op" id="5304566">{</span><span class="ident" id="5304567">ErrMissingRepeatArgument</span><span class="op" id="5304591">,</span>&nbsp;<span class="ident" id="5304593">before</span><span class="op" id="5304599">[</span><span class="op" id="5304600">:</span><span class="builtinfunc" id="5304601">len</span><span class="op" id="5304604">(</span><span class="ident" id="5304605">before</span><span class="op" id="5304611">)</span><span class="op" id="5304612">-</span><span class="builtinfunc" id="5304613">len</span><span class="op" id="5304616">(</span><span class="ident" id="5304617">after</span><span class="op" id="5304622">)</span><span class="op" id="5304623">]</span><span class="op" id="5304624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304631">re</span>&nbsp;<span class="op" id="5304634">:=</span>&nbsp;<span class="ident" id="5304637">p</span><span class="op" id="5304638">.</span><span class="ident" id="5304639">newRegexp</span><span class="op" id="5304648">(</span><span class="ident" id="5304649">op</span><span class="op" id="5304651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304654">re</span><span class="op" id="5304656">.</span><span class="ident" id="5304657">Min</span>&nbsp;<span class="op" id="5304661">=</span>&nbsp;<span class="ident" id="5304663">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304668">re</span><span class="op" id="5304670">.</span><span class="ident" id="5304671">Max</span>&nbsp;<span class="op" id="5304675">=</span>&nbsp;<span class="ident" id="5304677">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304682">re</span><span class="op" id="5304684">.</span><span class="ident" id="5304685">Flags</span>&nbsp;<span class="op" id="5304691">=</span>&nbsp;<span class="ident" id="5304693">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304700">re</span><span class="op" id="5304702">.</span><span class="ident" id="5304703">Sub</span>&nbsp;<span class="op" id="5304707">=</span>&nbsp;<span class="ident" id="5304709">re</span><span class="op" id="5304711">.</span><span class="ident" id="5304712">Sub0</span><span class="op" id="5304716">[</span><span class="op" id="5304717">:</span><span class="num" id="5304718">1</span><span class="op" id="5304719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304722">re</span><span class="op" id="5304724">.</span><span class="ident" id="5304725">Sub</span><span class="op" id="5304728">[</span><span class="num" id="5304729">0</span><span class="op" id="5304730">]</span>&nbsp;<span class="op" id="5304732">=</span>&nbsp;<span class="ident" id="5304734">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5304739">p</span><span class="op" id="5304740">.</span><span class="ident" id="5304741">stack</span><span class="op" id="5304746">[</span><span class="ident" id="5304747">n</span><span class="op" id="5304748">-</span><span class="num" id="5304749">1</span><span class="op" id="5304750">]</span>&nbsp;<span class="op" id="5304752">=</span>&nbsp;<span class="ident" id="5304754">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304759">if</span>&nbsp;<span class="ident" id="5304762">op</span>&nbsp;<span class="op" id="5304765">==</span>&nbsp;<span class="ident" id="5304768">OpRepeat</span>&nbsp;<span class="op" id="5304777">&amp;&amp;</span>&nbsp;<span class="op" id="5304780">(</span><span class="ident" id="5304781">min</span>&nbsp;<span class="op" id="5304785">&gt;=</span>&nbsp;<span class="num" id="5304788">2</span>&nbsp;<span class="op" id="5304790">||</span>&nbsp;<span class="ident" id="5304793">max</span>&nbsp;<span class="op" id="5304797">&gt;=</span>&nbsp;<span class="num" id="5304800">2</span><span class="op" id="5304801">)</span>&nbsp;<span class="op" id="5304803">&amp;&amp;</span>&nbsp;<span class="op" id="5304806">!</span><span class="ident" id="5304807">repeatIsValid</span><span class="op" id="5304820">(</span><span class="ident" id="5304821">re</span><span class="op" id="5304823">,</span>&nbsp;<span class="num" id="5304825">1000</span><span class="op" id="5304829">)</span>&nbsp;<span class="op" id="5304831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304835">return</span>&nbsp;<span class="string" id="5304842">&#34;&#34;</span><span class="op" id="5304844">,</span>&nbsp;<span class="op" id="5304846">&amp;</span><span class="ident" id="5304847">Error</span><span class="op" id="5304852">{</span><span class="ident" id="5304853">ErrInvalidRepeatSize</span><span class="op" id="5304873">,</span>&nbsp;<span class="ident" id="5304875">before</span><span class="op" id="5304881">[</span><span class="op" id="5304882">:</span><span class="builtinfunc" id="5304883">len</span><span class="op" id="5304886">(</span><span class="ident" id="5304887">before</span><span class="op" id="5304893">)</span><span class="op" id="5304894">-</span><span class="builtinfunc" id="5304895">len</span><span class="op" id="5304898">(</span><span class="ident" id="5304899">after</span><span class="op" id="5304904">)</span><span class="op" id="5304905">]</span><span class="op" id="5304906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5304909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5304913">return</span>&nbsp;<span class="ident" id="5304920">after</span><span class="op" id="5304925">,</span>&nbsp;<span class="ident" id="5304927">nil</span><br>
<span class="lineno"></span><span class="op" id="5304931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5304934">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5304995">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5305059">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5305120">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5305140">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5305217">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5305289">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5305358">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5305430">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5305505">func</span>&nbsp;<span class="ident" id="5305510">repeatIsValid</span><span class="op" id="5305523">(</span><span class="ident" id="5305524">re</span>&nbsp;<span class="op" id="5305527">*</span><span class="ident" id="5305528">Regexp</span><span class="op" id="5305534">,</span>&nbsp;<span class="ident" id="5305536">n</span>&nbsp;<span class="builtintype" id="5305538">int</span><span class="op" id="5305541">)</span>&nbsp;<span class="builtintype" id="5305543">bool</span>&nbsp;<span class="op" id="5305548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305551">if</span>&nbsp;<span class="ident" id="5305554">re</span><span class="op" id="5305556">.</span><span class="ident" id="5305557">Op</span>&nbsp;<span class="op" id="5305560">==</span>&nbsp;<span class="ident" id="5305563">OpRepeat</span>&nbsp;<span class="op" id="5305572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5305576">m</span>&nbsp;<span class="op" id="5305578">:=</span>&nbsp;<span class="ident" id="5305581">re</span><span class="op" id="5305583">.</span><span class="ident" id="5305584">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305590">if</span>&nbsp;<span class="ident" id="5305593">m</span>&nbsp;<span class="op" id="5305595">==</span>&nbsp;<span class="num" id="5305598">0</span>&nbsp;<span class="op" id="5305600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305605">return</span>&nbsp;<span class="builtintype" id="5305612">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305623">if</span>&nbsp;<span class="ident" id="5305626">m</span>&nbsp;<span class="op" id="5305628">&lt;</span>&nbsp;<span class="num" id="5305630">0</span>&nbsp;<span class="op" id="5305632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5305637">m</span>&nbsp;<span class="op" id="5305639">=</span>&nbsp;<span class="ident" id="5305641">re</span><span class="op" id="5305643">.</span><span class="ident" id="5305644">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305654">if</span>&nbsp;<span class="ident" id="5305657">m</span>&nbsp;<span class="op" id="5305659">&gt;</span>&nbsp;<span class="ident" id="5305661">n</span>&nbsp;<span class="op" id="5305663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305668">return</span>&nbsp;<span class="builtintype" id="5305675">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305687">if</span>&nbsp;<span class="ident" id="5305690">m</span>&nbsp;<span class="op" id="5305692">&gt;</span>&nbsp;<span class="num" id="5305694">0</span>&nbsp;<span class="op" id="5305696">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5305701">n</span>&nbsp;<span class="op" id="5305703">/=</span>&nbsp;<span class="ident" id="5305706">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305716">for</span>&nbsp;<span class="ident" id="5305720">_</span><span class="op" id="5305721">,</span>&nbsp;<span class="ident" id="5305723">sub</span>&nbsp;<span class="op" id="5305727">:=</span>&nbsp;<span class="keyword" id="5305730">range</span>&nbsp;<span class="ident" id="5305736">re</span><span class="op" id="5305738">.</span><span class="ident" id="5305739">Sub</span>&nbsp;<span class="op" id="5305743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305747">if</span>&nbsp;<span class="op" id="5305750">!</span><span class="ident" id="5305751">repeatIsValid</span><span class="op" id="5305764">(</span><span class="ident" id="5305765">sub</span><span class="op" id="5305768">,</span>&nbsp;<span class="ident" id="5305770">n</span><span class="op" id="5305771">)</span>&nbsp;<span class="op" id="5305773">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305778">return</span>&nbsp;<span class="builtintype" id="5305785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5305796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5305799">return</span>&nbsp;<span class="builtintype" id="5305806">true</span><br>
<span class="lineno"></span><span class="op" id="5305811">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5305814">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5305909">func</span>&nbsp;<span class="op" id="5305914">(</span><span class="ident" id="5305915">p</span>&nbsp;<span class="op" id="5305917">*</span><span class="ident" id="5305918">parser</span><span class="op" id="5305924">)</span>&nbsp;<span class="ident" id="5305926">concat</span><span class="op" id="5305932">(</span><span class="op" id="5305933">)</span>&nbsp;<span class="op" id="5305935">*</span><span class="ident" id="5305936">Regexp</span>&nbsp;<span class="op" id="5305943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5305946">p</span><span class="op" id="5305947">.</span><span class="ident" id="5305948">maybeConcat</span><span class="op" id="5305959">(</span><span class="op" id="5305960">-</span><span class="num" id="5305961">1</span><span class="op" id="5305962">,</span>&nbsp;<span class="num" id="5305964">0</span><span class="op" id="5305965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5305969">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306015">i</span>&nbsp;<span class="op" id="5306017">:=</span>&nbsp;<span class="builtinfunc" id="5306020">len</span><span class="op" id="5306023">(</span><span class="ident" id="5306024">p</span><span class="op" id="5306025">.</span><span class="ident" id="5306026">stack</span><span class="op" id="5306031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306034">for</span>&nbsp;<span class="ident" id="5306038">i</span>&nbsp;<span class="op" id="5306040">&gt;</span>&nbsp;<span class="num" id="5306042">0</span>&nbsp;<span class="op" id="5306044">&amp;&amp;</span>&nbsp;<span class="ident" id="5306047">p</span><span class="op" id="5306048">.</span><span class="ident" id="5306049">stack</span><span class="op" id="5306054">[</span><span class="ident" id="5306055">i</span><span class="op" id="5306056">-</span><span class="num" id="5306057">1</span><span class="op" id="5306058">]</span><span class="op" id="5306059">.</span><span class="ident" id="5306060">Op</span>&nbsp;<span class="op" id="5306063">&lt;</span>&nbsp;<span class="ident" id="5306065">opPseudo</span>&nbsp;<span class="op" id="5306074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306078">i</span><span class="op" id="5306079">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5306083">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306086">subs</span>&nbsp;<span class="op" id="5306091">:=</span>&nbsp;<span class="ident" id="5306094">p</span><span class="op" id="5306095">.</span><span class="ident" id="5306096">stack</span><span class="op" id="5306101">[</span><span class="ident" id="5306102">i</span><span class="op" id="5306103">:</span><span class="op" id="5306104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306107">p</span><span class="op" id="5306108">.</span><span class="ident" id="5306109">stack</span>&nbsp;<span class="op" id="5306115">=</span>&nbsp;<span class="ident" id="5306117">p</span><span class="op" id="5306118">.</span><span class="ident" id="5306119">stack</span><span class="op" id="5306124">[</span><span class="op" id="5306125">:</span><span class="ident" id="5306126">i</span><span class="op" id="5306127">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306131">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306172">if</span>&nbsp;<span class="builtinfunc" id="5306175">len</span><span class="op" id="5306178">(</span><span class="ident" id="5306179">subs</span><span class="op" id="5306183">)</span>&nbsp;<span class="op" id="5306185">==</span>&nbsp;<span class="num" id="5306188">0</span>&nbsp;<span class="op" id="5306190">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306194">return</span>&nbsp;<span class="ident" id="5306201">p</span><span class="op" id="5306202">.</span><span class="ident" id="5306203">push</span><span class="op" id="5306207">(</span><span class="ident" id="5306208">p</span><span class="op" id="5306209">.</span><span class="ident" id="5306210">newRegexp</span><span class="op" id="5306219">(</span><span class="ident" id="5306220">OpEmptyMatch</span><span class="op" id="5306232">)</span><span class="op" id="5306233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5306236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306240">return</span>&nbsp;<span class="ident" id="5306247">p</span><span class="op" id="5306248">.</span><span class="ident" id="5306249">push</span><span class="op" id="5306253">(</span><span class="ident" id="5306254">p</span><span class="op" id="5306255">.</span><span class="ident" id="5306256">collapse</span><span class="op" id="5306264">(</span><span class="ident" id="5306265">subs</span><span class="op" id="5306269">,</span>&nbsp;<span class="ident" id="5306271">OpConcat</span><span class="op" id="5306279">)</span><span class="op" id="5306280">)</span><br>
<span class="lineno"></span><span class="op" id="5306282">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5306285">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5306374">func</span>&nbsp;<span class="op" id="5306379">(</span><span class="ident" id="5306380">p</span>&nbsp;<span class="op" id="5306382">*</span><span class="ident" id="5306383">parser</span><span class="op" id="5306389">)</span>&nbsp;<span class="ident" id="5306391">alternate</span><span class="op" id="5306400">(</span><span class="op" id="5306401">)</span>&nbsp;<span class="op" id="5306403">*</span><span class="ident" id="5306404">Regexp</span>&nbsp;<span class="op" id="5306411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306414">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306455">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306483">i</span>&nbsp;<span class="op" id="5306485">:=</span>&nbsp;<span class="builtinfunc" id="5306488">len</span><span class="op" id="5306491">(</span><span class="ident" id="5306492">p</span><span class="op" id="5306493">.</span><span class="ident" id="5306494">stack</span><span class="op" id="5306499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306502">for</span>&nbsp;<span class="ident" id="5306506">i</span>&nbsp;<span class="op" id="5306508">&gt;</span>&nbsp;<span class="num" id="5306510">0</span>&nbsp;<span class="op" id="5306512">&amp;&amp;</span>&nbsp;<span class="ident" id="5306515">p</span><span class="op" id="5306516">.</span><span class="ident" id="5306517">stack</span><span class="op" id="5306522">[</span><span class="ident" id="5306523">i</span><span class="op" id="5306524">-</span><span class="num" id="5306525">1</span><span class="op" id="5306526">]</span><span class="op" id="5306527">.</span><span class="ident" id="5306528">Op</span>&nbsp;<span class="op" id="5306531">&lt;</span>&nbsp;<span class="ident" id="5306533">opPseudo</span>&nbsp;<span class="op" id="5306542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306546">i</span><span class="op" id="5306547">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5306551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306554">subs</span>&nbsp;<span class="op" id="5306559">:=</span>&nbsp;<span class="ident" id="5306562">p</span><span class="op" id="5306563">.</span><span class="ident" id="5306564">stack</span><span class="op" id="5306569">[</span><span class="ident" id="5306570">i</span><span class="op" id="5306571">:</span><span class="op" id="5306572">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306575">p</span><span class="op" id="5306576">.</span><span class="ident" id="5306577">stack</span>&nbsp;<span class="op" id="5306583">=</span>&nbsp;<span class="ident" id="5306585">p</span><span class="op" id="5306586">.</span><span class="ident" id="5306587">stack</span><span class="op" id="5306592">[</span><span class="op" id="5306593">:</span><span class="ident" id="5306594">i</span><span class="op" id="5306595">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306599">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306633">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306687">if</span>&nbsp;<span class="builtinfunc" id="5306690">len</span><span class="op" id="5306693">(</span><span class="ident" id="5306694">subs</span><span class="op" id="5306698">)</span>&nbsp;<span class="op" id="5306700">&gt;</span>&nbsp;<span class="num" id="5306702">0</span>&nbsp;<span class="op" id="5306704">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5306708">cleanAlt</span><span class="op" id="5306716">(</span><span class="ident" id="5306717">subs</span><span class="op" id="5306721">[</span><span class="builtinfunc" id="5306722">len</span><span class="op" id="5306725">(</span><span class="ident" id="5306726">subs</span><span class="op" id="5306730">)</span><span class="op" id="5306731">-</span><span class="num" id="5306732">1</span><span class="op" id="5306733">]</span><span class="op" id="5306734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5306737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306741">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5306777">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306820">if</span>&nbsp;<span class="builtinfunc" id="5306823">len</span><span class="op" id="5306826">(</span><span class="ident" id="5306827">subs</span><span class="op" id="5306831">)</span>&nbsp;<span class="op" id="5306833">==</span>&nbsp;<span class="num" id="5306836">0</span>&nbsp;<span class="op" id="5306838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306842">return</span>&nbsp;<span class="ident" id="5306849">p</span><span class="op" id="5306850">.</span><span class="ident" id="5306851">push</span><span class="op" id="5306855">(</span><span class="ident" id="5306856">p</span><span class="op" id="5306857">.</span><span class="ident" id="5306858">newRegexp</span><span class="op" id="5306867">(</span><span class="ident" id="5306868">OpNoMatch</span><span class="op" id="5306877">)</span><span class="op" id="5306878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5306881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5306885">return</span>&nbsp;<span class="ident" id="5306892">p</span><span class="op" id="5306893">.</span><span class="ident" id="5306894">push</span><span class="op" id="5306898">(</span><span class="ident" id="5306899">p</span><span class="op" id="5306900">.</span><span class="ident" id="5306901">collapse</span><span class="op" id="5306909">(</span><span class="ident" id="5306910">subs</span><span class="op" id="5306914">,</span>&nbsp;<span class="ident" id="5306916">OpAlternate</span><span class="op" id="5306927">)</span><span class="op" id="5306928">)</span><br>
<span class="lineno">340</span><span class="op" id="5306930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5306933">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5306997">func</span>&nbsp;<span class="ident" id="5307002">cleanAlt</span><span class="op" id="5307010">(</span><span class="ident" id="5307011">re</span>&nbsp;<span class="op" id="5307014">*</span><span class="ident" id="5307015">Regexp</span><span class="op" id="5307021">)</span>&nbsp;<span class="op" id="5307023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307026">switch</span>&nbsp;<span class="ident" id="5307033">re</span><span class="op" id="5307035">.</span><span class="ident" id="5307036">Op</span>&nbsp;<span class="op" id="5307039">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307042">case</span>&nbsp;<span class="ident" id="5307047">OpCharClass</span><span class="op" id="5307058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307062">re</span><span class="op" id="5307064">.</span><span class="ident" id="5307065">Rune</span>&nbsp;<span class="op" id="5307070">=</span>&nbsp;<span class="ident" id="5307072">cleanClass</span><span class="op" id="5307082">(</span><span class="op" id="5307083">&amp;</span><span class="ident" id="5307084">re</span><span class="op" id="5307086">.</span><span class="ident" id="5307087">Rune</span><span class="op" id="5307091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307095">if</span>&nbsp;<span class="builtinfunc" id="5307098">len</span><span class="op" id="5307101">(</span><span class="ident" id="5307102">re</span><span class="op" id="5307104">.</span><span class="ident" id="5307105">Rune</span><span class="op" id="5307109">)</span>&nbsp;<span class="op" id="5307111">==</span>&nbsp;<span class="num" id="5307114">2</span>&nbsp;<span class="op" id="5307116">&amp;&amp;</span>&nbsp;<span class="ident" id="5307119">re</span><span class="op" id="5307121">.</span><span class="ident" id="5307122">Rune</span><span class="op" id="5307126">[</span><span class="num" id="5307127">0</span><span class="op" id="5307128">]</span>&nbsp;<span class="op" id="5307130">==</span>&nbsp;<span class="num" id="5307133">0</span>&nbsp;<span class="op" id="5307135">&amp;&amp;</span>&nbsp;<span class="ident" id="5307138">re</span><span class="op" id="5307140">.</span><span class="ident" id="5307141">Rune</span><span class="op" id="5307145">[</span><span class="num" id="5307146">1</span><span class="op" id="5307147">]</span>&nbsp;<span class="op" id="5307149">==</span>&nbsp;<span class="ident" id="5307152">unicode</span><span class="op" id="5307159">.</span><span class="ident" id="5307160">MaxRune</span>&nbsp;<span class="op" id="5307168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307173">re</span><span class="op" id="5307175">.</span><span class="ident" id="5307176">Rune</span>&nbsp;<span class="op" id="5307181">=</span>&nbsp;<span class="ident" id="5307183">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307190">re</span><span class="op" id="5307192">.</span><span class="ident" id="5307193">Op</span>&nbsp;<span class="op" id="5307196">=</span>&nbsp;<span class="ident" id="5307198">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307211">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5307220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307224">if</span>&nbsp;<span class="builtinfunc" id="5307227">len</span><span class="op" id="5307230">(</span><span class="ident" id="5307231">re</span><span class="op" id="5307233">.</span><span class="ident" id="5307234">Rune</span><span class="op" id="5307238">)</span>&nbsp;<span class="op" id="5307240">==</span>&nbsp;<span class="num" id="5307243">4</span>&nbsp;<span class="op" id="5307245">&amp;&amp;</span>&nbsp;<span class="ident" id="5307248">re</span><span class="op" id="5307250">.</span><span class="ident" id="5307251">Rune</span><span class="op" id="5307255">[</span><span class="num" id="5307256">0</span><span class="op" id="5307257">]</span>&nbsp;<span class="op" id="5307259">==</span>&nbsp;<span class="num" id="5307262">0</span>&nbsp;<span class="op" id="5307264">&amp;&amp;</span>&nbsp;<span class="ident" id="5307267">re</span><span class="op" id="5307269">.</span><span class="ident" id="5307270">Rune</span><span class="op" id="5307274">[</span><span class="num" id="5307275">1</span><span class="op" id="5307276">]</span>&nbsp;<span class="op" id="5307278">==</span>&nbsp;<span class="string" id="5307281">&#39;\n&#39;</span><span class="op" id="5307285">-</span><span class="num" id="5307286">1</span>&nbsp;<span class="op" id="5307288">&amp;&amp;</span>&nbsp;<span class="ident" id="5307291">re</span><span class="op" id="5307293">.</span><span class="ident" id="5307294">Rune</span><span class="op" id="5307298">[</span><span class="num" id="5307299">2</span><span class="op" id="5307300">]</span>&nbsp;<span class="op" id="5307302">==</span>&nbsp;<span class="string" id="5307305">&#39;\n&#39;</span><span class="op" id="5307309">+</span><span class="num" id="5307310">1</span>&nbsp;<span class="op" id="5307312">&amp;&amp;</span>&nbsp;<span class="ident" id="5307315">re</span><span class="op" id="5307317">.</span><span class="ident" id="5307318">Rune</span><span class="op" id="5307322">[</span><span class="num" id="5307323">3</span><span class="op" id="5307324">]</span>&nbsp;<span class="op" id="5307326">==</span>&nbsp;<span class="ident" id="5307329">unicode</span><span class="op" id="5307336">.</span><span class="ident" id="5307337">MaxRune</span>&nbsp;<span class="op" id="5307345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307350">re</span><span class="op" id="5307352">.</span><span class="ident" id="5307353">Rune</span>&nbsp;<span class="op" id="5307358">=</span>&nbsp;<span class="ident" id="5307360">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307367">re</span><span class="op" id="5307369">.</span><span class="ident" id="5307370">Op</span>&nbsp;<span class="op" id="5307373">=</span>&nbsp;<span class="ident" id="5307375">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5307402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307406">if</span>&nbsp;<span class="builtinfunc" id="5307409">cap</span><span class="op" id="5307412">(</span><span class="ident" id="5307413">re</span><span class="op" id="5307415">.</span><span class="ident" id="5307416">Rune</span><span class="op" id="5307420">)</span><span class="op" id="5307421">-</span><span class="builtinfunc" id="5307422">len</span><span class="op" id="5307425">(</span><span class="ident" id="5307426">re</span><span class="op" id="5307428">.</span><span class="ident" id="5307429">Rune</span><span class="op" id="5307433">)</span>&nbsp;<span class="op" id="5307435">&gt;</span>&nbsp;<span class="num" id="5307437">100</span>&nbsp;<span class="op" id="5307441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5307446">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5307484">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307532">re</span><span class="op" id="5307534">.</span><span class="ident" id="5307535">Rune</span>&nbsp;<span class="op" id="5307540">=</span>&nbsp;<span class="builtinfunc" id="5307542">append</span><span class="op" id="5307548">(</span><span class="ident" id="5307549">re</span><span class="op" id="5307551">.</span><span class="ident" id="5307552">Rune0</span><span class="op" id="5307557">[</span><span class="op" id="5307558">:</span><span class="num" id="5307559">0</span><span class="op" id="5307560">]</span><span class="op" id="5307561">,</span>&nbsp;<span class="ident" id="5307563">re</span><span class="op" id="5307565">.</span><span class="ident" id="5307566">Rune</span><span class="op" id="5307570">...</span><span class="op" id="5307573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5307577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5307580">}</span><br>
<span class="lineno"></span><span class="op" id="5307582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5307585">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5307639">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5307692">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5307745">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5307775">func</span>&nbsp;<span class="op" id="5307780">(</span><span class="ident" id="5307781">p</span>&nbsp;<span class="op" id="5307783">*</span><span class="ident" id="5307784">parser</span><span class="op" id="5307790">)</span>&nbsp;<span class="ident" id="5307792">collapse</span><span class="op" id="5307800">(</span><span class="ident" id="5307801">subs</span>&nbsp;<span class="op" id="5307806">[</span><span class="op" id="5307807">]</span><span class="op" id="5307808">*</span><span class="ident" id="5307809">Regexp</span><span class="op" id="5307815">,</span>&nbsp;<span class="ident" id="5307817">op</span>&nbsp;<span class="ident" id="5307820">Op</span><span class="op" id="5307822">)</span>&nbsp;<span class="op" id="5307824">*</span><span class="ident" id="5307825">Regexp</span>&nbsp;<span class="op" id="5307832">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307835">if</span>&nbsp;<span class="builtinfunc" id="5307838">len</span><span class="op" id="5307841">(</span><span class="ident" id="5307842">subs</span><span class="op" id="5307846">)</span>&nbsp;<span class="op" id="5307848">==</span>&nbsp;<span class="num" id="5307851">1</span>&nbsp;<span class="op" id="5307853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307857">return</span>&nbsp;<span class="ident" id="5307864">subs</span><span class="op" id="5307868">[</span><span class="num" id="5307869">0</span><span class="op" id="5307870">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5307873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307876">re</span>&nbsp;<span class="op" id="5307879">:=</span>&nbsp;<span class="ident" id="5307882">p</span><span class="op" id="5307883">.</span><span class="ident" id="5307884">newRegexp</span><span class="op" id="5307893">(</span><span class="ident" id="5307894">op</span><span class="op" id="5307896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307899">re</span><span class="op" id="5307901">.</span><span class="ident" id="5307902">Sub</span>&nbsp;<span class="op" id="5307906">=</span>&nbsp;<span class="ident" id="5307908">re</span><span class="op" id="5307910">.</span><span class="ident" id="5307911">Sub0</span><span class="op" id="5307915">[</span><span class="op" id="5307916">:</span><span class="num" id="5307917">0</span><span class="op" id="5307918">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307921">for</span>&nbsp;<span class="ident" id="5307925">_</span><span class="op" id="5307926">,</span>&nbsp;<span class="ident" id="5307928">sub</span>&nbsp;<span class="op" id="5307932">:=</span>&nbsp;<span class="keyword" id="5307935">range</span>&nbsp;<span class="ident" id="5307941">subs</span>&nbsp;<span class="op" id="5307946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5307950">if</span>&nbsp;<span class="ident" id="5307953">sub</span><span class="op" id="5307956">.</span><span class="ident" id="5307957">Op</span>&nbsp;<span class="op" id="5307960">==</span>&nbsp;<span class="ident" id="5307963">op</span>&nbsp;<span class="op" id="5307966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5307971">re</span><span class="op" id="5307973">.</span><span class="ident" id="5307974">Sub</span>&nbsp;<span class="op" id="5307978">=</span>&nbsp;<span class="builtinfunc" id="5307980">append</span><span class="op" id="5307986">(</span><span class="ident" id="5307987">re</span><span class="op" id="5307989">.</span><span class="ident" id="5307990">Sub</span><span class="op" id="5307993">,</span>&nbsp;<span class="ident" id="5307995">sub</span><span class="op" id="5307998">.</span><span class="ident" id="5307999">Sub</span><span class="op" id="5308002">...</span><span class="op" id="5308005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308010">p</span><span class="op" id="5308011">.</span><span class="ident" id="5308012">reuse</span><span class="op" id="5308017">(</span><span class="ident" id="5308018">sub</span><span class="op" id="5308021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308025">}</span>&nbsp;<span class="keyword" id="5308027">else</span>&nbsp;<span class="op" id="5308032">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308037">re</span><span class="op" id="5308039">.</span><span class="ident" id="5308040">Sub</span>&nbsp;<span class="op" id="5308044">=</span>&nbsp;<span class="builtinfunc" id="5308046">append</span><span class="op" id="5308052">(</span><span class="ident" id="5308053">re</span><span class="op" id="5308055">.</span><span class="ident" id="5308056">Sub</span><span class="op" id="5308059">,</span>&nbsp;<span class="ident" id="5308061">sub</span><span class="op" id="5308064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308074">if</span>&nbsp;<span class="ident" id="5308077">op</span>&nbsp;<span class="op" id="5308080">==</span>&nbsp;<span class="ident" id="5308083">OpAlternate</span>&nbsp;<span class="op" id="5308095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308099">re</span><span class="op" id="5308101">.</span><span class="ident" id="5308102">Sub</span>&nbsp;<span class="op" id="5308106">=</span>&nbsp;<span class="ident" id="5308108">p</span><span class="op" id="5308109">.</span><span class="ident" id="5308110">factor</span><span class="op" id="5308116">(</span><span class="ident" id="5308117">re</span><span class="op" id="5308119">.</span><span class="ident" id="5308120">Sub</span><span class="op" id="5308123">,</span>&nbsp;<span class="ident" id="5308125">re</span><span class="op" id="5308127">.</span><span class="ident" id="5308128">Flags</span><span class="op" id="5308133">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308137">if</span>&nbsp;<span class="builtinfunc" id="5308140">len</span><span class="op" id="5308143">(</span><span class="ident" id="5308144">re</span><span class="op" id="5308146">.</span><span class="ident" id="5308147">Sub</span><span class="op" id="5308150">)</span>&nbsp;<span class="op" id="5308152">==</span>&nbsp;<span class="num" id="5308155">1</span>&nbsp;<span class="op" id="5308157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308162">old</span>&nbsp;<span class="op" id="5308166">:=</span>&nbsp;<span class="ident" id="5308169">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308175">re</span>&nbsp;<span class="op" id="5308178">=</span>&nbsp;<span class="ident" id="5308180">re</span><span class="op" id="5308182">.</span><span class="ident" id="5308183">Sub</span><span class="op" id="5308186">[</span><span class="num" id="5308187">0</span><span class="op" id="5308188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308193">p</span><span class="op" id="5308194">.</span><span class="ident" id="5308195">reuse</span><span class="op" id="5308200">(</span><span class="ident" id="5308201">old</span><span class="op" id="5308204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308208">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308214">return</span>&nbsp;<span class="ident" id="5308221">re</span><br>
<span class="lineno"></span><span class="op" id="5308224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5308227">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5308292">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5308358">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5308409">//</span><br>
<span class="lineno"></span><span class="comment" id="5308412">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5308428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5308455">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5308501">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5308529">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5308584">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5308610">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5308613">func</span>&nbsp;<span class="op" id="5308618">(</span><span class="ident" id="5308619">p</span>&nbsp;<span class="op" id="5308621">*</span><span class="ident" id="5308622">parser</span><span class="op" id="5308628">)</span>&nbsp;<span class="ident" id="5308630">factor</span><span class="op" id="5308636">(</span><span class="ident" id="5308637">sub</span>&nbsp;<span class="op" id="5308641">[</span><span class="op" id="5308642">]</span><span class="op" id="5308643">*</span><span class="ident" id="5308644">Regexp</span><span class="op" id="5308650">,</span>&nbsp;<span class="ident" id="5308652">flags</span>&nbsp;<span class="ident" id="5308658">Flags</span><span class="op" id="5308663">)</span>&nbsp;<span class="op" id="5308665">[</span><span class="op" id="5308666">]</span><span class="op" id="5308667">*</span><span class="ident" id="5308668">Regexp</span>&nbsp;<span class="op" id="5308675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308678">if</span>&nbsp;<span class="builtinfunc" id="5308681">len</span><span class="op" id="5308684">(</span><span class="ident" id="5308685">sub</span><span class="op" id="5308688">)</span>&nbsp;<span class="op" id="5308690">&lt;</span>&nbsp;<span class="num" id="5308692">2</span>&nbsp;<span class="op" id="5308694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308698">return</span>&nbsp;<span class="ident" id="5308705">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5308710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5308714">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308763">var</span>&nbsp;<span class="ident" id="5308767">str</span>&nbsp;<span class="op" id="5308771">[</span><span class="op" id="5308772">]</span><span class="builtintype" id="5308773">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308779">var</span>&nbsp;<span class="ident" id="5308783">strflags</span>&nbsp;<span class="ident" id="5308792">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308799">start</span>&nbsp;<span class="op" id="5308805">:=</span>&nbsp;<span class="num" id="5308808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5308811">out</span>&nbsp;<span class="op" id="5308815">:=</span>&nbsp;<span class="ident" id="5308818">sub</span><span class="op" id="5308821">[</span><span class="op" id="5308822">:</span><span class="num" id="5308823">0</span><span class="op" id="5308824">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5308827">for</span>&nbsp;<span class="ident" id="5308831">i</span>&nbsp;<span class="op" id="5308833">:=</span>&nbsp;<span class="num" id="5308836">0</span><span class="op" id="5308837">;</span>&nbsp;<span class="ident" id="5308839">i</span>&nbsp;<span class="op" id="5308841">&lt;=</span>&nbsp;<span class="builtinfunc" id="5308844">len</span><span class="op" id="5308847">(</span><span class="ident" id="5308848">sub</span><span class="op" id="5308851">)</span><span class="op" id="5308852">;</span>&nbsp;<span class="ident" id="5308854">i</span><span class="op" id="5308855">++</span>&nbsp;<span class="op" id="5308858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5308862">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5308926">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5308993">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309027">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309032">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309096">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309135">var</span>&nbsp;<span class="ident" id="5309139">istr</span>&nbsp;<span class="op" id="5309144">[</span><span class="op" id="5309145">]</span><span class="builtintype" id="5309146">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309153">var</span>&nbsp;<span class="ident" id="5309157">iflags</span>&nbsp;<span class="ident" id="5309164">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309172">if</span>&nbsp;<span class="ident" id="5309175">i</span>&nbsp;<span class="op" id="5309177">&lt;</span>&nbsp;<span class="builtinfunc" id="5309179">len</span><span class="op" id="5309182">(</span><span class="ident" id="5309183">sub</span><span class="op" id="5309186">)</span>&nbsp;<span class="op" id="5309188">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309193">istr</span><span class="op" id="5309197">,</span>&nbsp;<span class="ident" id="5309199">iflags</span>&nbsp;<span class="op" id="5309206">=</span>&nbsp;<span class="ident" id="5309208">p</span><span class="op" id="5309209">.</span><span class="ident" id="5309210">leadingString</span><span class="op" id="5309223">(</span><span class="ident" id="5309224">sub</span><span class="op" id="5309227">[</span><span class="ident" id="5309228">i</span><span class="op" id="5309229">]</span><span class="op" id="5309230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309235">if</span>&nbsp;<span class="ident" id="5309238">iflags</span>&nbsp;<span class="op" id="5309245">==</span>&nbsp;<span class="ident" id="5309248">strflags</span>&nbsp;<span class="op" id="5309257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309263">same</span>&nbsp;<span class="op" id="5309268">:=</span>&nbsp;<span class="num" id="5309271">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309277">for</span>&nbsp;<span class="ident" id="5309281">same</span>&nbsp;<span class="op" id="5309286">&lt;</span>&nbsp;<span class="builtinfunc" id="5309288">len</span><span class="op" id="5309291">(</span><span class="ident" id="5309292">str</span><span class="op" id="5309295">)</span>&nbsp;<span class="op" id="5309297">&amp;&amp;</span>&nbsp;<span class="ident" id="5309300">same</span>&nbsp;<span class="op" id="5309305">&lt;</span>&nbsp;<span class="builtinfunc" id="5309307">len</span><span class="op" id="5309310">(</span><span class="ident" id="5309311">istr</span><span class="op" id="5309315">)</span>&nbsp;<span class="op" id="5309317">&amp;&amp;</span>&nbsp;<span class="ident" id="5309320">str</span><span class="op" id="5309323">[</span><span class="ident" id="5309324">same</span><span class="op" id="5309328">]</span>&nbsp;<span class="op" id="5309330">==</span>&nbsp;<span class="ident" id="5309333">istr</span><span class="op" id="5309337">[</span><span class="ident" id="5309338">same</span><span class="op" id="5309342">]</span>&nbsp;<span class="op" id="5309344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309351">same</span><span class="op" id="5309355">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309368">if</span>&nbsp;<span class="ident" id="5309371">same</span>&nbsp;<span class="op" id="5309376">&gt;</span>&nbsp;<span class="num" id="5309378">0</span>&nbsp;<span class="op" id="5309380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309387">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309439">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309466">str</span>&nbsp;<span class="op" id="5309470">=</span>&nbsp;<span class="ident" id="5309472">str</span><span class="op" id="5309475">[</span><span class="op" id="5309476">:</span><span class="ident" id="5309477">same</span><span class="op" id="5309481">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309488">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309515">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309575">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309636">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309674">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309679">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309748">if</span>&nbsp;<span class="ident" id="5309751">i</span>&nbsp;<span class="op" id="5309753">==</span>&nbsp;<span class="ident" id="5309756">start</span>&nbsp;<span class="op" id="5309762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309767">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309805">}</span>&nbsp;<span class="keyword" id="5309807">else</span>&nbsp;<span class="keyword" id="5309812">if</span>&nbsp;<span class="ident" id="5309815">i</span>&nbsp;<span class="op" id="5309817">==</span>&nbsp;<span class="ident" id="5309820">start</span><span class="op" id="5309825">+</span><span class="num" id="5309826">1</span>&nbsp;<span class="op" id="5309828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309833">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309873">out</span>&nbsp;<span class="op" id="5309877">=</span>&nbsp;<span class="builtinfunc" id="5309879">append</span><span class="op" id="5309885">(</span><span class="ident" id="5309886">out</span><span class="op" id="5309889">,</span>&nbsp;<span class="ident" id="5309891">sub</span><span class="op" id="5309894">[</span><span class="ident" id="5309895">start</span><span class="op" id="5309900">]</span><span class="op" id="5309901">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309905">}</span>&nbsp;<span class="keyword" id="5309907">else</span>&nbsp;<span class="op" id="5309912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5309917">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309976">prefix</span>&nbsp;<span class="op" id="5309983">:=</span>&nbsp;<span class="ident" id="5309986">p</span><span class="op" id="5309987">.</span><span class="ident" id="5309988">newRegexp</span><span class="op" id="5309997">(</span><span class="ident" id="5309998">OpLiteral</span><span class="op" id="5310007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310012">prefix</span><span class="op" id="5310018">.</span><span class="ident" id="5310019">Flags</span>&nbsp;<span class="op" id="5310025">=</span>&nbsp;<span class="ident" id="5310027">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310039">prefix</span><span class="op" id="5310045">.</span><span class="ident" id="5310046">Rune</span>&nbsp;<span class="op" id="5310051">=</span>&nbsp;<span class="builtinfunc" id="5310053">append</span><span class="op" id="5310059">(</span><span class="ident" id="5310060">prefix</span><span class="op" id="5310066">.</span><span class="ident" id="5310067">Rune</span><span class="op" id="5310071">[</span><span class="op" id="5310072">:</span><span class="num" id="5310073">0</span><span class="op" id="5310074">]</span><span class="op" id="5310075">,</span>&nbsp;<span class="ident" id="5310077">str</span><span class="op" id="5310080">...</span><span class="op" id="5310083">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310089">for</span>&nbsp;<span class="ident" id="5310093">j</span>&nbsp;<span class="op" id="5310095">:=</span>&nbsp;<span class="ident" id="5310098">start</span><span class="op" id="5310103">;</span>&nbsp;<span class="ident" id="5310105">j</span>&nbsp;<span class="op" id="5310107">&lt;</span>&nbsp;<span class="ident" id="5310109">i</span><span class="op" id="5310110">;</span>&nbsp;<span class="ident" id="5310112">j</span><span class="op" id="5310113">++</span>&nbsp;<span class="op" id="5310116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310122">sub</span><span class="op" id="5310125">[</span><span class="ident" id="5310126">j</span><span class="op" id="5310127">]</span>&nbsp;<span class="op" id="5310129">=</span>&nbsp;<span class="ident" id="5310131">p</span><span class="op" id="5310132">.</span><span class="ident" id="5310133">removeLeadingString</span><span class="op" id="5310152">(</span><span class="ident" id="5310153">sub</span><span class="op" id="5310156">[</span><span class="ident" id="5310157">j</span><span class="op" id="5310158">]</span><span class="op" id="5310159">,</span>&nbsp;<span class="builtinfunc" id="5310161">len</span><span class="op" id="5310164">(</span><span class="ident" id="5310165">str</span><span class="op" id="5310168">)</span><span class="op" id="5310169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5310174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310179">suffix</span>&nbsp;<span class="op" id="5310186">:=</span>&nbsp;<span class="ident" id="5310189">p</span><span class="op" id="5310190">.</span><span class="ident" id="5310191">collapse</span><span class="op" id="5310199">(</span><span class="ident" id="5310200">sub</span><span class="op" id="5310203">[</span><span class="ident" id="5310204">start</span><span class="op" id="5310209">:</span><span class="ident" id="5310210">i</span><span class="op" id="5310211">]</span><span class="op" id="5310212">,</span>&nbsp;<span class="ident" id="5310214">OpAlternate</span><span class="op" id="5310225">)</span>&nbsp;<span class="comment" id="5310227">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310242">re</span>&nbsp;<span class="op" id="5310245">:=</span>&nbsp;<span class="ident" id="5310248">p</span><span class="op" id="5310249">.</span><span class="ident" id="5310250">newRegexp</span><span class="op" id="5310259">(</span><span class="ident" id="5310260">OpConcat</span><span class="op" id="5310268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310273">re</span><span class="op" id="5310275">.</span><span class="ident" id="5310276">Sub</span>&nbsp;<span class="op" id="5310280">=</span>&nbsp;<span class="builtinfunc" id="5310282">append</span><span class="op" id="5310288">(</span><span class="ident" id="5310289">re</span><span class="op" id="5310291">.</span><span class="ident" id="5310292">Sub</span><span class="op" id="5310295">[</span><span class="op" id="5310296">:</span><span class="num" id="5310297">0</span><span class="op" id="5310298">]</span><span class="op" id="5310299">,</span>&nbsp;<span class="ident" id="5310301">prefix</span><span class="op" id="5310307">,</span>&nbsp;<span class="ident" id="5310309">suffix</span><span class="op" id="5310315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310320">out</span>&nbsp;<span class="op" id="5310324">=</span>&nbsp;<span class="builtinfunc" id="5310326">append</span><span class="op" id="5310332">(</span><span class="ident" id="5310333">out</span><span class="op" id="5310336">,</span>&nbsp;<span class="ident" id="5310338">re</span><span class="op" id="5310340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5310344">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310349">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310382">start</span>&nbsp;<span class="op" id="5310388">=</span>&nbsp;<span class="ident" id="5310390">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310394">str</span>&nbsp;<span class="op" id="5310398">=</span>&nbsp;<span class="ident" id="5310400">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310407">strflags</span>&nbsp;<span class="op" id="5310416">=</span>&nbsp;<span class="ident" id="5310418">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5310426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310429">sub</span>&nbsp;<span class="op" id="5310433">=</span>&nbsp;<span class="ident" id="5310435">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310441">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310490">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310538">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310598">start</span>&nbsp;<span class="op" id="5310604">=</span>&nbsp;<span class="num" id="5310606">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310609">out</span>&nbsp;<span class="op" id="5310613">=</span>&nbsp;<span class="ident" id="5310615">sub</span><span class="op" id="5310618">[</span><span class="op" id="5310619">:</span><span class="num" id="5310620">0</span><span class="op" id="5310621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310624">var</span>&nbsp;<span class="ident" id="5310628">first</span>&nbsp;<span class="op" id="5310634">*</span><span class="ident" id="5310635">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310643">for</span>&nbsp;<span class="ident" id="5310647">i</span>&nbsp;<span class="op" id="5310649">:=</span>&nbsp;<span class="num" id="5310652">0</span><span class="op" id="5310653">;</span>&nbsp;<span class="ident" id="5310655">i</span>&nbsp;<span class="op" id="5310657">&lt;=</span>&nbsp;<span class="builtinfunc" id="5310660">len</span><span class="op" id="5310663">(</span><span class="ident" id="5310664">sub</span><span class="op" id="5310667">)</span><span class="op" id="5310668">;</span>&nbsp;<span class="ident" id="5310670">i</span><span class="op" id="5310671">++</span>&nbsp;<span class="op" id="5310674">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310678">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310742">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310809">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310843">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310848">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310925">var</span>&nbsp;<span class="ident" id="5310929">ifirst</span>&nbsp;<span class="op" id="5310936">*</span><span class="ident" id="5310937">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310946">if</span>&nbsp;<span class="ident" id="5310949">i</span>&nbsp;<span class="op" id="5310951">&lt;</span>&nbsp;<span class="builtinfunc" id="5310953">len</span><span class="op" id="5310956">(</span><span class="ident" id="5310957">sub</span><span class="op" id="5310960">)</span>&nbsp;<span class="op" id="5310962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310967">ifirst</span>&nbsp;<span class="op" id="5310974">=</span>&nbsp;<span class="ident" id="5310976">p</span><span class="op" id="5310977">.</span><span class="ident" id="5310978">leadingRegexp</span><span class="op" id="5310991">(</span><span class="ident" id="5310992">sub</span><span class="op" id="5310995">[</span><span class="ident" id="5310996">i</span><span class="op" id="5310997">]</span><span class="op" id="5310998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311003">if</span>&nbsp;<span class="ident" id="5311006">first</span>&nbsp;<span class="op" id="5311012">!=</span>&nbsp;<span class="ident" id="5311015">nil</span>&nbsp;<span class="op" id="5311019">&amp;&amp;</span>&nbsp;<span class="ident" id="5311022">first</span><span class="op" id="5311027">.</span><span class="ident" id="5311028">Equal</span><span class="op" id="5311033">(</span><span class="ident" id="5311034">ifirst</span><span class="op" id="5311040">)</span>&nbsp;<span class="op" id="5311042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311048">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311069">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311121">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311181">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311186">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311255">if</span>&nbsp;<span class="ident" id="5311258">i</span>&nbsp;<span class="op" id="5311260">==</span>&nbsp;<span class="ident" id="5311263">start</span>&nbsp;<span class="op" id="5311269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311274">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311312">}</span>&nbsp;<span class="keyword" id="5311314">else</span>&nbsp;<span class="keyword" id="5311319">if</span>&nbsp;<span class="ident" id="5311322">i</span>&nbsp;<span class="op" id="5311324">==</span>&nbsp;<span class="ident" id="5311327">start</span><span class="op" id="5311332">+</span><span class="num" id="5311333">1</span>&nbsp;<span class="op" id="5311335">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311340">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311380">out</span>&nbsp;<span class="op" id="5311384">=</span>&nbsp;<span class="builtinfunc" id="5311386">append</span><span class="op" id="5311392">(</span><span class="ident" id="5311393">out</span><span class="op" id="5311396">,</span>&nbsp;<span class="ident" id="5311398">sub</span><span class="op" id="5311401">[</span><span class="ident" id="5311402">start</span><span class="op" id="5311407">]</span><span class="op" id="5311408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311412">}</span>&nbsp;<span class="keyword" id="5311414">else</span>&nbsp;<span class="op" id="5311419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311424">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311483">prefix</span>&nbsp;<span class="op" id="5311490">:=</span>&nbsp;<span class="ident" id="5311493">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311502">for</span>&nbsp;<span class="ident" id="5311506">j</span>&nbsp;<span class="op" id="5311508">:=</span>&nbsp;<span class="ident" id="5311511">start</span><span class="op" id="5311516">;</span>&nbsp;<span class="ident" id="5311518">j</span>&nbsp;<span class="op" id="5311520">&lt;</span>&nbsp;<span class="ident" id="5311522">i</span><span class="op" id="5311523">;</span>&nbsp;<span class="ident" id="5311525">j</span><span class="op" id="5311526">++</span>&nbsp;<span class="op" id="5311529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311535">reuse</span>&nbsp;<span class="op" id="5311541">:=</span>&nbsp;<span class="ident" id="5311544">j</span>&nbsp;<span class="op" id="5311546">!=</span>&nbsp;<span class="ident" id="5311549">start</span>&nbsp;<span class="comment" id="5311555">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311590">sub</span><span class="op" id="5311593">[</span><span class="ident" id="5311594">j</span><span class="op" id="5311595">]</span>&nbsp;<span class="op" id="5311597">=</span>&nbsp;<span class="ident" id="5311599">p</span><span class="op" id="5311600">.</span><span class="ident" id="5311601">removeLeadingRegexp</span><span class="op" id="5311620">(</span><span class="ident" id="5311621">sub</span><span class="op" id="5311624">[</span><span class="ident" id="5311625">j</span><span class="op" id="5311626">]</span><span class="op" id="5311627">,</span>&nbsp;<span class="ident" id="5311629">reuse</span><span class="op" id="5311634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311644">suffix</span>&nbsp;<span class="op" id="5311651">:=</span>&nbsp;<span class="ident" id="5311654">p</span><span class="op" id="5311655">.</span><span class="ident" id="5311656">collapse</span><span class="op" id="5311664">(</span><span class="ident" id="5311665">sub</span><span class="op" id="5311668">[</span><span class="ident" id="5311669">start</span><span class="op" id="5311674">:</span><span class="ident" id="5311675">i</span><span class="op" id="5311676">]</span><span class="op" id="5311677">,</span>&nbsp;<span class="ident" id="5311679">OpAlternate</span><span class="op" id="5311690">)</span>&nbsp;<span class="comment" id="5311692">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311707">re</span>&nbsp;<span class="op" id="5311710">:=</span>&nbsp;<span class="ident" id="5311713">p</span><span class="op" id="5311714">.</span><span class="ident" id="5311715">newRegexp</span><span class="op" id="5311724">(</span><span class="ident" id="5311725">OpConcat</span><span class="op" id="5311733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311738">re</span><span class="op" id="5311740">.</span><span class="ident" id="5311741">Sub</span>&nbsp;<span class="op" id="5311745">=</span>&nbsp;<span class="builtinfunc" id="5311747">append</span><span class="op" id="5311753">(</span><span class="ident" id="5311754">re</span><span class="op" id="5311756">.</span><span class="ident" id="5311757">Sub</span><span class="op" id="5311760">[</span><span class="op" id="5311761">:</span><span class="num" id="5311762">0</span><span class="op" id="5311763">]</span><span class="op" id="5311764">,</span>&nbsp;<span class="ident" id="5311766">prefix</span><span class="op" id="5311772">,</span>&nbsp;<span class="ident" id="5311774">suffix</span><span class="op" id="5311780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311785">out</span>&nbsp;<span class="op" id="5311789">=</span>&nbsp;<span class="builtinfunc" id="5311791">append</span><span class="op" id="5311797">(</span><span class="ident" id="5311798">out</span><span class="op" id="5311801">,</span>&nbsp;<span class="ident" id="5311803">re</span><span class="op" id="5311805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311809">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311814">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311847">start</span>&nbsp;<span class="op" id="5311853">=</span>&nbsp;<span class="ident" id="5311855">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311859">first</span>&nbsp;<span class="op" id="5311865">=</span>&nbsp;<span class="ident" id="5311867">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311875">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311878">sub</span>&nbsp;<span class="op" id="5311882">=</span>&nbsp;<span class="ident" id="5311884">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311890">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311960">start</span>&nbsp;<span class="op" id="5311966">=</span>&nbsp;<span class="num" id="5311968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311971">out</span>&nbsp;<span class="op" id="5311975">=</span>&nbsp;<span class="ident" id="5311977">sub</span><span class="op" id="5311980">[</span><span class="op" id="5311981">:</span><span class="num" id="5311982">0</span><span class="op" id="5311983">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311986">for</span>&nbsp;<span class="ident" id="5311990">i</span>&nbsp;<span class="op" id="5311992">:=</span>&nbsp;<span class="num" id="5311995">0</span><span class="op" id="5311996">;</span>&nbsp;<span class="ident" id="5311998">i</span>&nbsp;<span class="op" id="5312000">&lt;=</span>&nbsp;<span class="builtinfunc" id="5312003">len</span><span class="op" id="5312006">(</span><span class="ident" id="5312007">sub</span><span class="op" id="5312010">)</span><span class="op" id="5312011">;</span>&nbsp;<span class="ident" id="5312013">i</span><span class="op" id="5312014">++</span>&nbsp;<span class="op" id="5312017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312021">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312085">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312152">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312186">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312191">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312256">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312297">if</span>&nbsp;<span class="ident" id="5312300">i</span>&nbsp;<span class="op" id="5312302">&lt;</span>&nbsp;<span class="builtinfunc" id="5312304">len</span><span class="op" id="5312307">(</span><span class="ident" id="5312308">sub</span><span class="op" id="5312311">)</span>&nbsp;<span class="op" id="5312313">&amp;&amp;</span>&nbsp;<span class="ident" id="5312316">isCharClass</span><span class="op" id="5312327">(</span><span class="ident" id="5312328">sub</span><span class="op" id="5312331">[</span><span class="ident" id="5312332">i</span><span class="op" id="5312333">]</span><span class="op" id="5312334">)</span>&nbsp;<span class="op" id="5312336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312341">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312352">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312357">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312398">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312439">if</span>&nbsp;<span class="ident" id="5312442">i</span>&nbsp;<span class="op" id="5312444">==</span>&nbsp;<span class="ident" id="5312447">start</span>&nbsp;<span class="op" id="5312453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312458">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312496">}</span>&nbsp;<span class="keyword" id="5312498">else</span>&nbsp;<span class="keyword" id="5312503">if</span>&nbsp;<span class="ident" id="5312506">i</span>&nbsp;<span class="op" id="5312508">==</span>&nbsp;<span class="ident" id="5312511">start</span><span class="op" id="5312516">+</span><span class="num" id="5312517">1</span>&nbsp;<span class="op" id="5312519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312524">out</span>&nbsp;<span class="op" id="5312528">=</span>&nbsp;<span class="builtinfunc" id="5312530">append</span><span class="op" id="5312536">(</span><span class="ident" id="5312537">out</span><span class="op" id="5312540">,</span>&nbsp;<span class="ident" id="5312542">sub</span><span class="op" id="5312545">[</span><span class="ident" id="5312546">start</span><span class="op" id="5312551">]</span><span class="op" id="5312552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312556">}</span>&nbsp;<span class="keyword" id="5312558">else</span>&nbsp;<span class="op" id="5312563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312568">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312595">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312647">max</span>&nbsp;<span class="op" id="5312651">:=</span>&nbsp;<span class="ident" id="5312654">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312663">for</span>&nbsp;<span class="ident" id="5312667">j</span>&nbsp;<span class="op" id="5312669">:=</span>&nbsp;<span class="ident" id="5312672">start</span>&nbsp;<span class="op" id="5312678">+</span>&nbsp;<span class="num" id="5312680">1</span><span class="op" id="5312681">;</span>&nbsp;<span class="ident" id="5312683">j</span>&nbsp;<span class="op" id="5312685">&lt;</span>&nbsp;<span class="ident" id="5312687">i</span><span class="op" id="5312688">;</span>&nbsp;<span class="ident" id="5312690">j</span><span class="op" id="5312691">++</span>&nbsp;<span class="op" id="5312694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312700">if</span>&nbsp;<span class="ident" id="5312703">sub</span><span class="op" id="5312706">[</span><span class="ident" id="5312707">max</span><span class="op" id="5312710">]</span><span class="op" id="5312711">.</span><span class="ident" id="5312712">Op</span>&nbsp;<span class="op" id="5312715">&lt;</span>&nbsp;<span class="ident" id="5312717">sub</span><span class="op" id="5312720">[</span><span class="ident" id="5312721">j</span><span class="op" id="5312722">]</span><span class="op" id="5312723">.</span><span class="ident" id="5312724">Op</span>&nbsp;<span class="op" id="5312727">||</span>&nbsp;<span class="ident" id="5312730">sub</span><span class="op" id="5312733">[</span><span class="ident" id="5312734">max</span><span class="op" id="5312737">]</span><span class="op" id="5312738">.</span><span class="ident" id="5312739">Op</span>&nbsp;<span class="op" id="5312742">==</span>&nbsp;<span class="ident" id="5312745">sub</span><span class="op" id="5312748">[</span><span class="ident" id="5312749">j</span><span class="op" id="5312750">]</span><span class="op" id="5312751">.</span><span class="ident" id="5312752">Op</span>&nbsp;<span class="op" id="5312755">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5312758">len</span><span class="op" id="5312761">(</span><span class="ident" id="5312762">sub</span><span class="op" id="5312765">[</span><span class="ident" id="5312766">max</span><span class="op" id="5312769">]</span><span class="op" id="5312770">.</span><span class="ident" id="5312771">Rune</span><span class="op" id="5312775">)</span>&nbsp;<span class="op" id="5312777">&lt;</span>&nbsp;<span class="builtinfunc" id="5312779">len</span><span class="op" id="5312782">(</span><span class="ident" id="5312783">sub</span><span class="op" id="5312786">[</span><span class="ident" id="5312787">j</span><span class="op" id="5312788">]</span><span class="op" id="5312789">.</span><span class="ident" id="5312790">Rune</span><span class="op" id="5312794">)</span>&nbsp;<span class="op" id="5312796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312803">max</span>&nbsp;<span class="op" id="5312807">=</span>&nbsp;<span class="ident" id="5312809">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312815">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312825">sub</span><span class="op" id="5312828">[</span><span class="ident" id="5312829">start</span><span class="op" id="5312834">]</span><span class="op" id="5312835">,</span>&nbsp;<span class="ident" id="5312837">sub</span><span class="op" id="5312840">[</span><span class="ident" id="5312841">max</span><span class="op" id="5312844">]</span>&nbsp;<span class="op" id="5312846">=</span>&nbsp;<span class="ident" id="5312848">sub</span><span class="op" id="5312851">[</span><span class="ident" id="5312852">max</span><span class="op" id="5312855">]</span><span class="op" id="5312856">,</span>&nbsp;<span class="ident" id="5312858">sub</span><span class="op" id="5312861">[</span><span class="ident" id="5312862">start</span><span class="op" id="5312867">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312873">for</span>&nbsp;<span class="ident" id="5312877">j</span>&nbsp;<span class="op" id="5312879">:=</span>&nbsp;<span class="ident" id="5312882">start</span>&nbsp;<span class="op" id="5312888">+</span>&nbsp;<span class="num" id="5312890">1</span><span class="op" id="5312891">;</span>&nbsp;<span class="ident" id="5312893">j</span>&nbsp;<span class="op" id="5312895">&lt;</span>&nbsp;<span class="ident" id="5312897">i</span><span class="op" id="5312898">;</span>&nbsp;<span class="ident" id="5312900">j</span><span class="op" id="5312901">++</span>&nbsp;<span class="op" id="5312904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312910">mergeCharClass</span><span class="op" id="5312924">(</span><span class="ident" id="5312925">sub</span><span class="op" id="5312928">[</span><span class="ident" id="5312929">start</span><span class="op" id="5312934">]</span><span class="op" id="5312935">,</span>&nbsp;<span class="ident" id="5312937">sub</span><span class="op" id="5312940">[</span><span class="ident" id="5312941">j</span><span class="op" id="5312942">]</span><span class="op" id="5312943">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312949">p</span><span class="op" id="5312950">.</span><span class="ident" id="5312951">reuse</span><span class="op" id="5312956">(</span><span class="ident" id="5312957">sub</span><span class="op" id="5312960">[</span><span class="ident" id="5312961">j</span><span class="op" id="5312962">]</span><span class="op" id="5312963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312973">cleanAlt</span><span class="op" id="5312981">(</span><span class="ident" id="5312982">sub</span><span class="op" id="5312985">[</span><span class="ident" id="5312986">start</span><span class="op" id="5312991">]</span><span class="op" id="5312992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312997">out</span>&nbsp;<span class="op" id="5313001">=</span>&nbsp;<span class="builtinfunc" id="5313003">append</span><span class="op" id="5313009">(</span><span class="ident" id="5313010">out</span><span class="op" id="5313013">,</span>&nbsp;<span class="ident" id="5313015">sub</span><span class="op" id="5313018">[</span><span class="ident" id="5313019">start</span><span class="op" id="5313024">]</span><span class="op" id="5313025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313029">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5313034">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313065">if</span>&nbsp;<span class="ident" id="5313068">i</span>&nbsp;<span class="op" id="5313070">&lt;</span>&nbsp;<span class="builtinfunc" id="5313072">len</span><span class="op" id="5313075">(</span><span class="ident" id="5313076">sub</span><span class="op" id="5313079">)</span>&nbsp;<span class="op" id="5313081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313086">out</span>&nbsp;<span class="op" id="5313090">=</span>&nbsp;<span class="builtinfunc" id="5313092">append</span><span class="op" id="5313098">(</span><span class="ident" id="5313099">out</span><span class="op" id="5313102">,</span>&nbsp;<span class="ident" id="5313104">sub</span><span class="op" id="5313107">[</span><span class="ident" id="5313108">i</span><span class="op" id="5313109">]</span><span class="op" id="5313110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313114">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313118">start</span>&nbsp;<span class="op" id="5313124">=</span>&nbsp;<span class="ident" id="5313126">i</span>&nbsp;<span class="op" id="5313128">+</span>&nbsp;<span class="num" id="5313130">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313136">sub</span>&nbsp;<span class="op" id="5313140">=</span>&nbsp;<span class="ident" id="5313142">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5313148">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313219">start</span>&nbsp;<span class="op" id="5313225">=</span>&nbsp;<span class="num" id="5313227">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313230">out</span>&nbsp;<span class="op" id="5313234">=</span>&nbsp;<span class="ident" id="5313236">sub</span><span class="op" id="5313239">[</span><span class="op" id="5313240">:</span><span class="num" id="5313241">0</span><span class="op" id="5313242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313245">for</span>&nbsp;<span class="ident" id="5313249">i</span>&nbsp;<span class="op" id="5313251">:=</span>&nbsp;<span class="keyword" id="5313254">range</span>&nbsp;<span class="ident" id="5313260">sub</span>&nbsp;<span class="op" id="5313264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313268">if</span>&nbsp;<span class="ident" id="5313271">i</span><span class="op" id="5313272">+</span><span class="num" id="5313273">1</span>&nbsp;<span class="op" id="5313275">&lt;</span>&nbsp;<span class="builtinfunc" id="5313277">len</span><span class="op" id="5313280">(</span><span class="ident" id="5313281">sub</span><span class="op" id="5313284">)</span>&nbsp;<span class="op" id="5313286">&amp;&amp;</span>&nbsp;<span class="ident" id="5313289">sub</span><span class="op" id="5313292">[</span><span class="ident" id="5313293">i</span><span class="op" id="5313294">]</span><span class="op" id="5313295">.</span><span class="ident" id="5313296">Op</span>&nbsp;<span class="op" id="5313299">==</span>&nbsp;<span class="ident" id="5313302">OpEmptyMatch</span>&nbsp;<span class="op" id="5313315">&amp;&amp;</span>&nbsp;<span class="ident" id="5313318">sub</span><span class="op" id="5313321">[</span><span class="ident" id="5313322">i</span><span class="op" id="5313323">+</span><span class="num" id="5313324">1</span><span class="op" id="5313325">]</span><span class="op" id="5313326">.</span><span class="ident" id="5313327">Op</span>&nbsp;<span class="op" id="5313330">==</span>&nbsp;<span class="ident" id="5313333">OpEmptyMatch</span>&nbsp;<span class="op" id="5313346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313351">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313366">out</span>&nbsp;<span class="op" id="5313370">=</span>&nbsp;<span class="builtinfunc" id="5313372">append</span><span class="op" id="5313378">(</span><span class="ident" id="5313379">out</span><span class="op" id="5313382">,</span>&nbsp;<span class="ident" id="5313384">sub</span><span class="op" id="5313387">[</span><span class="ident" id="5313388">i</span><span class="op" id="5313389">]</span><span class="op" id="5313390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313396">sub</span>&nbsp;<span class="op" id="5313400">=</span>&nbsp;<span class="ident" id="5313402">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313408">return</span>&nbsp;<span class="ident" id="5313415">sub</span><br>
<span class="lineno"></span><span class="op" id="5313419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5313422">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5313495">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5313550">func</span>&nbsp;<span class="op" id="5313555">(</span><span class="ident" id="5313556">p</span>&nbsp;<span class="op" id="5313558">*</span><span class="ident" id="5313559">parser</span><span class="op" id="5313565">)</span>&nbsp;<span class="ident" id="5313567">leadingString</span><span class="op" id="5313580">(</span><span class="ident" id="5313581">re</span>&nbsp;<span class="op" id="5313584">*</span><span class="ident" id="5313585">Regexp</span><span class="op" id="5313591">)</span>&nbsp;<span class="op" id="5313593">(</span><span class="op" id="5313594">[</span><span class="op" id="5313595">]</span><span class="builtintype" id="5313596">rune</span><span class="op" id="5313600">,</span>&nbsp;<span class="ident" id="5313602">Flags</span><span class="op" id="5313607">)</span>&nbsp;<span class="op" id="5313609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313612">if</span>&nbsp;<span class="ident" id="5313615">re</span><span class="op" id="5313617">.</span><span class="ident" id="5313618">Op</span>&nbsp;<span class="op" id="5313621">==</span>&nbsp;<span class="ident" id="5313624">OpConcat</span>&nbsp;<span class="op" id="5313633">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5313636">len</span><span class="op" id="5313639">(</span><span class="ident" id="5313640">re</span><span class="op" id="5313642">.</span><span class="ident" id="5313643">Sub</span><span class="op" id="5313646">)</span>&nbsp;<span class="op" id="5313648">&gt;</span>&nbsp;<span class="num" id="5313650">0</span>&nbsp;<span class="op" id="5313652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313656">re</span>&nbsp;<span class="op" id="5313659">=</span>&nbsp;<span class="ident" id="5313661">re</span><span class="op" id="5313663">.</span><span class="ident" id="5313664">Sub</span><span class="op" id="5313667">[</span><span class="num" id="5313668">0</span><span class="op" id="5313669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313675">if</span>&nbsp;<span class="ident" id="5313678">re</span><span class="op" id="5313680">.</span><span class="ident" id="5313681">Op</span>&nbsp;<span class="op" id="5313684">!=</span>&nbsp;<span class="ident" id="5313687">OpLiteral</span>&nbsp;<span class="op" id="5313697">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313701">return</span>&nbsp;<span class="ident" id="5313708">nil</span><span class="op" id="5313711">,</span>&nbsp;<span class="num" id="5313713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313719">return</span>&nbsp;<span class="ident" id="5313726">re</span><span class="op" id="5313728">.</span><span class="ident" id="5313729">Rune</span><span class="op" id="5313733">,</span>&nbsp;<span class="ident" id="5313735">re</span><span class="op" id="5313737">.</span><span class="ident" id="5313738">Flags</span>&nbsp;<span class="op" id="5313744">&amp;</span>&nbsp;<span class="ident" id="5313746">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="5313755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5313758">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5313815">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5313880">func</span>&nbsp;<span class="op" id="5313885">(</span><span class="ident" id="5313886">p</span>&nbsp;<span class="op" id="5313888">*</span><span class="ident" id="5313889">parser</span><span class="op" id="5313895">)</span>&nbsp;<span class="ident" id="5313897">removeLeadingString</span><span class="op" id="5313916">(</span><span class="ident" id="5313917">re</span>&nbsp;<span class="op" id="5313920">*</span><span class="ident" id="5313921">Regexp</span><span class="op" id="5313927">,</span>&nbsp;<span class="ident" id="5313929">n</span>&nbsp;<span class="builtintype" id="5313931">int</span><span class="op" id="5313934">)</span>&nbsp;<span class="op" id="5313936">*</span><span class="ident" id="5313937">Regexp</span>&nbsp;<span class="op" id="5313944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313947">if</span>&nbsp;<span class="ident" id="5313950">re</span><span class="op" id="5313952">.</span><span class="ident" id="5313953">Op</span>&nbsp;<span class="op" id="5313956">==</span>&nbsp;<span class="ident" id="5313959">OpConcat</span>&nbsp;<span class="op" id="5313968">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5313971">len</span><span class="op" id="5313974">(</span><span class="ident" id="5313975">re</span><span class="op" id="5313977">.</span><span class="ident" id="5313978">Sub</span><span class="op" id="5313981">)</span>&nbsp;<span class="op" id="5313983">&gt;</span>&nbsp;<span class="num" id="5313985">0</span>&nbsp;<span class="op" id="5313987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5313991">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314041">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314080">sub</span>&nbsp;<span class="op" id="5314084">:=</span>&nbsp;<span class="ident" id="5314087">re</span><span class="op" id="5314089">.</span><span class="ident" id="5314090">Sub</span><span class="op" id="5314093">[</span><span class="num" id="5314094">0</span><span class="op" id="5314095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314099">sub</span>&nbsp;<span class="op" id="5314103">=</span>&nbsp;<span class="ident" id="5314105">p</span><span class="op" id="5314106">.</span><span class="ident" id="5314107">removeLeadingString</span><span class="op" id="5314126">(</span><span class="ident" id="5314127">sub</span><span class="op" id="5314130">,</span>&nbsp;<span class="ident" id="5314132">n</span><span class="op" id="5314133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314137">re</span><span class="op" id="5314139">.</span><span class="ident" id="5314140">Sub</span><span class="op" id="5314143">[</span><span class="num" id="5314144">0</span><span class="op" id="5314145">]</span>&nbsp;<span class="op" id="5314147">=</span>&nbsp;<span class="ident" id="5314149">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314155">if</span>&nbsp;<span class="ident" id="5314158">sub</span><span class="op" id="5314161">.</span><span class="ident" id="5314162">Op</span>&nbsp;<span class="op" id="5314165">==</span>&nbsp;<span class="ident" id="5314168">OpEmptyMatch</span>&nbsp;<span class="op" id="5314181">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314186">p</span><span class="op" id="5314187">.</span><span class="ident" id="5314188">reuse</span><span class="op" id="5314193">(</span><span class="ident" id="5314194">sub</span><span class="op" id="5314197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314202">switch</span>&nbsp;<span class="builtinfunc" id="5314209">len</span><span class="op" id="5314212">(</span><span class="ident" id="5314213">re</span><span class="op" id="5314215">.</span><span class="ident" id="5314216">Sub</span><span class="op" id="5314219">)</span>&nbsp;<span class="op" id="5314221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314226">case</span>&nbsp;<span class="num" id="5314231">0</span><span class="op" id="5314232">,</span>&nbsp;<span class="num" id="5314234">1</span><span class="op" id="5314235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314241">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314271">re</span><span class="op" id="5314273">.</span><span class="ident" id="5314274">Op</span>&nbsp;<span class="op" id="5314277">=</span>&nbsp;<span class="ident" id="5314279">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314296">re</span><span class="op" id="5314298">.</span><span class="ident" id="5314299">Sub</span>&nbsp;<span class="op" id="5314303">=</span>&nbsp;<span class="ident" id="5314305">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314312">case</span>&nbsp;<span class="num" id="5314317">2</span><span class="op" id="5314318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314324">old</span>&nbsp;<span class="op" id="5314328">:=</span>&nbsp;<span class="ident" id="5314331">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314338">re</span>&nbsp;<span class="op" id="5314341">=</span>&nbsp;<span class="ident" id="5314343">re</span><span class="op" id="5314345">.</span><span class="ident" id="5314346">Sub</span><span class="op" id="5314349">[</span><span class="num" id="5314350">1</span><span class="op" id="5314351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314357">p</span><span class="op" id="5314358">.</span><span class="ident" id="5314359">reuse</span><span class="op" id="5314364">(</span><span class="ident" id="5314365">old</span><span class="op" id="5314368">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314373">default</span><span class="op" id="5314380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5314386">copy</span><span class="op" id="5314390">(</span><span class="ident" id="5314391">re</span><span class="op" id="5314393">.</span><span class="ident" id="5314394">Sub</span><span class="op" id="5314397">,</span>&nbsp;<span class="ident" id="5314399">re</span><span class="op" id="5314401">.</span><span class="ident" id="5314402">Sub</span><span class="op" id="5314405">[</span><span class="num" id="5314406">1</span><span class="op" id="5314407">:</span><span class="op" id="5314408">]</span><span class="op" id="5314409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314415">re</span><span class="op" id="5314417">.</span><span class="ident" id="5314418">Sub</span>&nbsp;<span class="op" id="5314422">=</span>&nbsp;<span class="ident" id="5314424">re</span><span class="op" id="5314426">.</span><span class="ident" id="5314427">Sub</span><span class="op" id="5314430">[</span><span class="op" id="5314431">:</span><span class="builtinfunc" id="5314432">len</span><span class="op" id="5314435">(</span><span class="ident" id="5314436">re</span><span class="op" id="5314438">.</span><span class="ident" id="5314439">Sub</span><span class="op" id="5314442">)</span><span class="op" id="5314443">-</span><span class="num" id="5314444">1</span><span class="op" id="5314445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314454">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314458">return</span>&nbsp;<span class="ident" id="5314465">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314473">if</span>&nbsp;<span class="ident" id="5314476">re</span><span class="op" id="5314478">.</span><span class="ident" id="5314479">Op</span>&nbsp;<span class="op" id="5314482">==</span>&nbsp;<span class="ident" id="5314485">OpLiteral</span>&nbsp;<span class="op" id="5314495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314499">re</span><span class="op" id="5314501">.</span><span class="ident" id="5314502">Rune</span>&nbsp;<span class="op" id="5314507">=</span>&nbsp;<span class="ident" id="5314509">re</span><span class="op" id="5314511">.</span><span class="ident" id="5314512">Rune</span><span class="op" id="5314516">[</span><span class="op" id="5314517">:</span><span class="builtinfunc" id="5314518">copy</span><span class="op" id="5314522">(</span><span class="ident" id="5314523">re</span><span class="op" id="5314525">.</span><span class="ident" id="5314526">Rune</span><span class="op" id="5314530">,</span>&nbsp;<span class="ident" id="5314532">re</span><span class="op" id="5314534">.</span><span class="ident" id="5314535">Rune</span><span class="op" id="5314539">[</span><span class="ident" id="5314540">n</span><span class="op" id="5314541">:</span><span class="op" id="5314542">]</span><span class="op" id="5314543">)</span><span class="op" id="5314544">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314548">if</span>&nbsp;<span class="builtinfunc" id="5314551">len</span><span class="op" id="5314554">(</span><span class="ident" id="5314555">re</span><span class="op" id="5314557">.</span><span class="ident" id="5314558">Rune</span><span class="op" id="5314562">)</span>&nbsp;<span class="op" id="5314564">==</span>&nbsp;<span class="num" id="5314567">0</span>&nbsp;<span class="op" id="5314569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314574">re</span><span class="op" id="5314576">.</span><span class="ident" id="5314577">Op</span>&nbsp;<span class="op" id="5314580">=</span>&nbsp;<span class="ident" id="5314582">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314603">return</span>&nbsp;<span class="ident" id="5314610">re</span><br>
<span class="lineno">630</span><span class="op" id="5314613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5314616">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5314681">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5314736">func</span>&nbsp;<span class="op" id="5314741">(</span><span class="ident" id="5314742">p</span>&nbsp;<span class="op" id="5314744">*</span><span class="ident" id="5314745">parser</span><span class="op" id="5314751">)</span>&nbsp;<span class="ident" id="5314753">leadingRegexp</span><span class="op" id="5314766">(</span><span class="ident" id="5314767">re</span>&nbsp;<span class="op" id="5314770">*</span><span class="ident" id="5314771">Regexp</span><span class="op" id="5314777">)</span>&nbsp;<span class="op" id="5314779">*</span><span class="ident" id="5314780">Regexp</span>&nbsp;<span class="op" id="5314787">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314790">if</span>&nbsp;<span class="ident" id="5314793">re</span><span class="op" id="5314795">.</span><span class="ident" id="5314796">Op</span>&nbsp;<span class="op" id="5314799">==</span>&nbsp;<span class="ident" id="5314802">OpEmptyMatch</span>&nbsp;<span class="op" id="5314815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314819">return</span>&nbsp;<span class="ident" id="5314826">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314834">if</span>&nbsp;<span class="ident" id="5314837">re</span><span class="op" id="5314839">.</span><span class="ident" id="5314840">Op</span>&nbsp;<span class="op" id="5314843">==</span>&nbsp;<span class="ident" id="5314846">OpConcat</span>&nbsp;<span class="op" id="5314855">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5314858">len</span><span class="op" id="5314861">(</span><span class="ident" id="5314862">re</span><span class="op" id="5314864">.</span><span class="ident" id="5314865">Sub</span><span class="op" id="5314868">)</span>&nbsp;<span class="op" id="5314870">&gt;</span>&nbsp;<span class="num" id="5314872">0</span>&nbsp;<span class="op" id="5314874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314878">sub</span>&nbsp;<span class="op" id="5314882">:=</span>&nbsp;<span class="ident" id="5314885">re</span><span class="op" id="5314887">.</span><span class="ident" id="5314888">Sub</span><span class="op" id="5314891">[</span><span class="num" id="5314892">0</span><span class="op" id="5314893">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314897">if</span>&nbsp;<span class="ident" id="5314900">sub</span><span class="op" id="5314903">.</span><span class="ident" id="5314904">Op</span>&nbsp;<span class="op" id="5314907">==</span>&nbsp;<span class="ident" id="5314910">OpEmptyMatch</span>&nbsp;<span class="op" id="5314923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314928">return</span>&nbsp;<span class="ident" id="5314935">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314945">return</span>&nbsp;<span class="ident" id="5314952">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314957">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314960">return</span>&nbsp;<span class="ident" id="5314967">re</span><br>
<span class="lineno"></span><span class="op" id="5314970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5314973">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5315030">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5315068">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5315152">func</span>&nbsp;<span class="op" id="5315157">(</span><span class="ident" id="5315158">p</span>&nbsp;<span class="op" id="5315160">*</span><span class="ident" id="5315161">parser</span><span class="op" id="5315167">)</span>&nbsp;<span class="ident" id="5315169">removeLeadingRegexp</span><span class="op" id="5315188">(</span><span class="ident" id="5315189">re</span>&nbsp;<span class="op" id="5315192">*</span><span class="ident" id="5315193">Regexp</span><span class="op" id="5315199">,</span>&nbsp;<span class="ident" id="5315201">reuse</span>&nbsp;<span class="builtintype" id="5315207">bool</span><span class="op" id="5315211">)</span>&nbsp;<span class="op" id="5315213">*</span><span class="ident" id="5315214">Regexp</span>&nbsp;<span class="op" id="5315221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315224">if</span>&nbsp;<span class="ident" id="5315227">re</span><span class="op" id="5315229">.</span><span class="ident" id="5315230">Op</span>&nbsp;<span class="op" id="5315233">==</span>&nbsp;<span class="ident" id="5315236">OpConcat</span>&nbsp;<span class="op" id="5315245">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5315248">len</span><span class="op" id="5315251">(</span><span class="ident" id="5315252">re</span><span class="op" id="5315254">.</span><span class="ident" id="5315255">Sub</span><span class="op" id="5315258">)</span>&nbsp;<span class="op" id="5315260">&gt;</span>&nbsp;<span class="num" id="5315262">0</span>&nbsp;<span class="op" id="5315264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315268">if</span>&nbsp;<span class="ident" id="5315271">reuse</span>&nbsp;<span class="op" id="5315277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315282">p</span><span class="op" id="5315283">.</span><span class="ident" id="5315284">reuse</span><span class="op" id="5315289">(</span><span class="ident" id="5315290">re</span><span class="op" id="5315292">.</span><span class="ident" id="5315293">Sub</span><span class="op" id="5315296">[</span><span class="num" id="5315297">0</span><span class="op" id="5315298">]</span><span class="op" id="5315299">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315307">re</span><span class="op" id="5315309">.</span><span class="ident" id="5315310">Sub</span>&nbsp;<span class="op" id="5315314">=</span>&nbsp;<span class="ident" id="5315316">re</span><span class="op" id="5315318">.</span><span class="ident" id="5315319">Sub</span><span class="op" id="5315322">[</span><span class="op" id="5315323">:</span><span class="builtinfunc" id="5315324">copy</span><span class="op" id="5315328">(</span><span class="ident" id="5315329">re</span><span class="op" id="5315331">.</span><span class="ident" id="5315332">Sub</span><span class="op" id="5315335">,</span>&nbsp;<span class="ident" id="5315337">re</span><span class="op" id="5315339">.</span><span class="ident" id="5315340">Sub</span><span class="op" id="5315343">[</span><span class="num" id="5315344">1</span><span class="op" id="5315345">:</span><span class="op" id="5315346">]</span><span class="op" id="5315347">)</span><span class="op" id="5315348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315352">switch</span>&nbsp;<span class="builtinfunc" id="5315359">len</span><span class="op" id="5315362">(</span><span class="ident" id="5315363">re</span><span class="op" id="5315365">.</span><span class="ident" id="5315366">Sub</span><span class="op" id="5315369">)</span>&nbsp;<span class="op" id="5315371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315375">case</span>&nbsp;<span class="num" id="5315380">0</span><span class="op" id="5315381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315386">re</span><span class="op" id="5315388">.</span><span class="ident" id="5315389">Op</span>&nbsp;<span class="op" id="5315392">=</span>&nbsp;<span class="ident" id="5315394">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315410">re</span><span class="op" id="5315412">.</span><span class="ident" id="5315413">Sub</span>&nbsp;<span class="op" id="5315417">=</span>&nbsp;<span class="ident" id="5315419">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315425">case</span>&nbsp;<span class="num" id="5315430">1</span><span class="op" id="5315431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315436">old</span>&nbsp;<span class="op" id="5315440">:=</span>&nbsp;<span class="ident" id="5315443">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315449">re</span>&nbsp;<span class="op" id="5315452">=</span>&nbsp;<span class="ident" id="5315454">re</span><span class="op" id="5315456">.</span><span class="ident" id="5315457">Sub</span><span class="op" id="5315460">[</span><span class="num" id="5315461">0</span><span class="op" id="5315462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315467">p</span><span class="op" id="5315468">.</span><span class="ident" id="5315469">reuse</span><span class="op" id="5315474">(</span><span class="ident" id="5315475">old</span><span class="op" id="5315478">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315486">return</span>&nbsp;<span class="ident" id="5315493">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315500">if</span>&nbsp;<span class="ident" id="5315503">reuse</span>&nbsp;<span class="op" id="5315509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315513">p</span><span class="op" id="5315514">.</span><span class="ident" id="5315515">reuse</span><span class="op" id="5315520">(</span><span class="ident" id="5315521">re</span><span class="op" id="5315523">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315529">return</span>&nbsp;<span class="ident" id="5315536">p</span><span class="op" id="5315537">.</span><span class="ident" id="5315538">newRegexp</span><span class="op" id="5315547">(</span><span class="ident" id="5315548">OpEmptyMatch</span><span class="op" id="5315560">)</span><br>
<span class="lineno"></span><span class="op" id="5315562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5315565">func</span>&nbsp;<span class="ident" id="5315570">literalRegexp</span><span class="op" id="5315583">(</span><span class="ident" id="5315584">s</span>&nbsp;<span class="builtintype" id="5315586">string</span><span class="op" id="5315592">,</span>&nbsp;<span class="ident" id="5315594">flags</span>&nbsp;<span class="ident" id="5315600">Flags</span><span class="op" id="5315605">)</span>&nbsp;<span class="op" id="5315607">*</span><span class="ident" id="5315608">Regexp</span>&nbsp;<span class="op" id="5315615">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315618">re</span>&nbsp;<span class="op" id="5315621">:=</span>&nbsp;<span class="op" id="5315624">&amp;</span><span class="ident" id="5315625">Regexp</span><span class="op" id="5315631">{</span><span class="ident" id="5315632">Op</span><span class="op" id="5315634">:</span>&nbsp;<span class="ident" id="5315636">OpLiteral</span><span class="op" id="5315645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315648">re</span><span class="op" id="5315650">.</span><span class="ident" id="5315651">Flags</span>&nbsp;<span class="op" id="5315657">=</span>&nbsp;<span class="ident" id="5315659">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315666">re</span><span class="op" id="5315668">.</span><span class="ident" id="5315669">Rune</span>&nbsp;<span class="op" id="5315674">=</span>&nbsp;<span class="ident" id="5315676">re</span><span class="op" id="5315678">.</span><span class="ident" id="5315679">Rune0</span><span class="op" id="5315684">[</span><span class="op" id="5315685">:</span><span class="num" id="5315686">0</span><span class="op" id="5315687">]</span>&nbsp;<span class="comment" id="5315689">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315729">for</span>&nbsp;<span class="ident" id="5315733">_</span><span class="op" id="5315734">,</span>&nbsp;<span class="ident" id="5315736">c</span>&nbsp;<span class="op" id="5315738">:=</span>&nbsp;<span class="keyword" id="5315741">range</span>&nbsp;<span class="ident" id="5315747">s</span>&nbsp;<span class="op" id="5315749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315753">if</span>&nbsp;<span class="builtinfunc" id="5315756">len</span><span class="op" id="5315759">(</span><span class="ident" id="5315760">re</span><span class="op" id="5315762">.</span><span class="ident" id="5315763">Rune</span><span class="op" id="5315767">)</span>&nbsp;<span class="op" id="5315769">&gt;=</span>&nbsp;<span class="builtinfunc" id="5315772">cap</span><span class="op" id="5315775">(</span><span class="ident" id="5315776">re</span><span class="op" id="5315778">.</span><span class="ident" id="5315779">Rune</span><span class="op" id="5315783">)</span>&nbsp;<span class="op" id="5315785">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5315790">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315850">re</span><span class="op" id="5315852">.</span><span class="ident" id="5315853">Rune</span>&nbsp;<span class="op" id="5315858">=</span>&nbsp;<span class="op" id="5315860">[</span><span class="op" id="5315861">]</span><span class="builtintype" id="5315862">rune</span><span class="op" id="5315866">(</span><span class="ident" id="5315867">s</span><span class="op" id="5315868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315873">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315885">re</span><span class="op" id="5315887">.</span><span class="ident" id="5315888">Rune</span>&nbsp;<span class="op" id="5315893">=</span>&nbsp;<span class="builtinfunc" id="5315895">append</span><span class="op" id="5315901">(</span><span class="ident" id="5315902">re</span><span class="op" id="5315904">.</span><span class="ident" id="5315905">Rune</span><span class="op" id="5315909">,</span>&nbsp;<span class="ident" id="5315911">c</span><span class="op" id="5315912">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315918">return</span>&nbsp;<span class="ident" id="5315925">re</span><br>
<span class="lineno"></span><span class="op" id="5315928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5315931">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5315944">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5316019">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5316088">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5316127">func</span>&nbsp;<span class="ident" id="5316132">Parse</span><span class="op" id="5316137">(</span><span class="ident" id="5316138">s</span>&nbsp;<span class="builtintype" id="5316140">string</span><span class="op" id="5316146">,</span>&nbsp;<span class="ident" id="5316148">flags</span>&nbsp;<span class="ident" id="5316154">Flags</span><span class="op" id="5316159">)</span>&nbsp;<span class="op" id="5316161">(</span><span class="op" id="5316162">*</span><span class="ident" id="5316163">Regexp</span><span class="op" id="5316169">,</span>&nbsp;<span class="builtintype" id="5316171">error</span><span class="op" id="5316176">)</span>&nbsp;<span class="op" id="5316178">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316181">if</span>&nbsp;<span class="ident" id="5316184">flags</span><span class="op" id="5316189">&amp;</span><span class="ident" id="5316190">Literal</span>&nbsp;<span class="op" id="5316198">!=</span>&nbsp;<span class="num" id="5316201">0</span>&nbsp;<span class="op" id="5316203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5316207">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316247">if</span>&nbsp;<span class="ident" id="5316250">err</span>&nbsp;<span class="op" id="5316254">:=</span>&nbsp;<span class="ident" id="5316257">checkUTF8</span><span class="op" id="5316266">(</span><span class="ident" id="5316267">s</span><span class="op" id="5316268">)</span><span class="op" id="5316269">;</span>&nbsp;<span class="ident" id="5316271">err</span>&nbsp;<span class="op" id="5316275">!=</span>&nbsp;<span class="ident" id="5316278">nil</span>&nbsp;<span class="op" id="5316282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316287">return</span>&nbsp;<span class="ident" id="5316294">nil</span><span class="op" id="5316297">,</span>&nbsp;<span class="ident" id="5316299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316305">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316309">return</span>&nbsp;<span class="ident" id="5316316">literalRegexp</span><span class="op" id="5316329">(</span><span class="ident" id="5316330">s</span><span class="op" id="5316331">,</span>&nbsp;<span class="ident" id="5316333">flags</span><span class="op" id="5316338">)</span><span class="op" id="5316339">,</span>&nbsp;<span class="ident" id="5316341">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5316350">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316384">var</span>&nbsp;<span class="op" id="5316388">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316392">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316403">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316412">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5316423">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316431">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5316442">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316449">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316460">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316465">lastRepeat</span>&nbsp;<span class="builtintype" id="5316476">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316487">p</span><span class="op" id="5316488">.</span><span class="ident" id="5316489">flags</span>&nbsp;<span class="op" id="5316495">=</span>&nbsp;<span class="ident" id="5316497">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316504">p</span><span class="op" id="5316505">.</span><span class="ident" id="5316506">wholeRegexp</span>&nbsp;<span class="op" id="5316518">=</span>&nbsp;<span class="ident" id="5316520">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316523">t</span>&nbsp;<span class="op" id="5316525">:=</span>&nbsp;<span class="ident" id="5316528">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316531">for</span>&nbsp;<span class="ident" id="5316535">t</span>&nbsp;<span class="op" id="5316537">!=</span>&nbsp;<span class="string" id="5316540">&#34;&#34;</span>&nbsp;<span class="op" id="5316543">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316547">repeat</span>&nbsp;<span class="op" id="5316554">:=</span>&nbsp;<span class="string" id="5316557">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316561">BigSwitch</span><span class="op" id="5316570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316574">switch</span>&nbsp;<span class="ident" id="5316581">t</span><span class="op" id="5316582">[</span><span class="num" id="5316583">0</span><span class="op" id="5316584">]</span>&nbsp;<span class="op" id="5316586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316590">default</span><span class="op" id="5316597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316602">if</span>&nbsp;<span class="ident" id="5316605">c</span><span class="op" id="5316606">,</span>&nbsp;<span class="ident" id="5316608">t</span><span class="op" id="5316609">,</span>&nbsp;<span class="ident" id="5316611">err</span>&nbsp;<span class="op" id="5316615">=</span>&nbsp;<span class="ident" id="5316617">nextRune</span><span class="op" id="5316625">(</span><span class="ident" id="5316626">t</span><span class="op" id="5316627">)</span><span class="op" id="5316628">;</span>&nbsp;<span class="ident" id="5316630">err</span>&nbsp;<span class="op" id="5316634">!=</span>&nbsp;<span class="ident" id="5316637">nil</span>&nbsp;<span class="op" id="5316641">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316647">return</span>&nbsp;<span class="ident" id="5316654">nil</span><span class="op" id="5316657">,</span>&nbsp;<span class="ident" id="5316659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316671">p</span><span class="op" id="5316672">.</span><span class="ident" id="5316673">literal</span><span class="op" id="5316680">(</span><span class="ident" id="5316681">c</span><span class="op" id="5316682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316687">case</span>&nbsp;<span class="string" id="5316692">&#39;(&#39;</span><span class="op" id="5316695">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316700">if</span>&nbsp;<span class="ident" id="5316703">p</span><span class="op" id="5316704">.</span><span class="ident" id="5316705">flags</span><span class="op" id="5316710">&amp;</span><span class="ident" id="5316711">PerlX</span>&nbsp;<span class="op" id="5316717">!=</span>&nbsp;<span class="num" id="5316720">0</span>&nbsp;<span class="op" id="5316722">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5316725">len</span><span class="op" id="5316728">(</span><span class="ident" id="5316729">t</span><span class="op" id="5316730">)</span>&nbsp;<span class="op" id="5316732">&gt;=</span>&nbsp;<span class="num" id="5316735">2</span>&nbsp;<span class="op" id="5316737">&amp;&amp;</span>&nbsp;<span class="ident" id="5316740">t</span><span class="op" id="5316741">[</span><span class="num" id="5316742">1</span><span class="op" id="5316743">]</span>&nbsp;<span class="op" id="5316745">==</span>&nbsp;<span class="string" id="5316748">&#39;?&#39;</span>&nbsp;<span class="op" id="5316752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5316758">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316804">if</span>&nbsp;<span class="ident" id="5316807">t</span><span class="op" id="5316808">,</span>&nbsp;<span class="ident" id="5316810">err</span>&nbsp;<span class="op" id="5316814">=</span>&nbsp;<span class="ident" id="5316816">p</span><span class="op" id="5316817">.</span><span class="ident" id="5316818">parsePerlFlags</span><span class="op" id="5316832">(</span><span class="ident" id="5316833">t</span><span class="op" id="5316834">)</span><span class="op" id="5316835">;</span>&nbsp;<span class="ident" id="5316837">err</span>&nbsp;<span class="op" id="5316841">!=</span>&nbsp;<span class="ident" id="5316844">nil</span>&nbsp;<span class="op" id="5316848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316855">return</span>&nbsp;<span class="ident" id="5316862">nil</span><span class="op" id="5316865">,</span>&nbsp;<span class="ident" id="5316867">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316875">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316881">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316895">p</span><span class="op" id="5316896">.</span><span class="ident" id="5316897">numCap</span><span class="op" id="5316903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316909">p</span><span class="op" id="5316910">.</span><span class="ident" id="5316911">op</span><span class="op" id="5316913">(</span><span class="ident" id="5316914">opLeftParen</span><span class="op" id="5316925">)</span><span class="op" id="5316926">.</span><span class="ident" id="5316927">Cap</span>&nbsp;<span class="op" id="5316931">=</span>&nbsp;<span class="ident" id="5316933">p</span><span class="op" id="5316934">.</span><span class="ident" id="5316935">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316945">t</span>&nbsp;<span class="op" id="5316947">=</span>&nbsp;<span class="ident" id="5316949">t</span><span class="op" id="5316950">[</span><span class="num" id="5316951">1</span><span class="op" id="5316952">:</span><span class="op" id="5316953">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316957">case</span>&nbsp;<span class="string" id="5316962">&#39;|&#39;</span><span class="op" id="5316965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316970">if</span>&nbsp;<span class="ident" id="5316973">err</span>&nbsp;<span class="op" id="5316977">=</span>&nbsp;<span class="ident" id="5316979">p</span><span class="op" id="5316980">.</span><span class="ident" id="5316981">parseVerticalBar</span><span class="op" id="5316997">(</span><span class="op" id="5316998">)</span><span class="op" id="5316999">;</span>&nbsp;<span class="ident" id="5317001">err</span>&nbsp;<span class="op" id="5317005">!=</span>&nbsp;<span class="ident" id="5317008">nil</span>&nbsp;<span class="op" id="5317012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317018">return</span>&nbsp;<span class="ident" id="5317025">nil</span><span class="op" id="5317028">,</span>&nbsp;<span class="ident" id="5317030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317042">t</span>&nbsp;<span class="op" id="5317044">=</span>&nbsp;<span class="ident" id="5317046">t</span><span class="op" id="5317047">[</span><span class="num" id="5317048">1</span><span class="op" id="5317049">:</span><span class="op" id="5317050">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317054">case</span>&nbsp;<span class="string" id="5317059">&#39;)&#39;</span><span class="op" id="5317062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317067">if</span>&nbsp;<span class="ident" id="5317070">err</span>&nbsp;<span class="op" id="5317074">=</span>&nbsp;<span class="ident" id="5317076">p</span><span class="op" id="5317077">.</span><span class="ident" id="5317078">parseRightParen</span><span class="op" id="5317093">(</span><span class="op" id="5317094">)</span><span class="op" id="5317095">;</span>&nbsp;<span class="ident" id="5317097">err</span>&nbsp;<span class="op" id="5317101">!=</span>&nbsp;<span class="ident" id="5317104">nil</span>&nbsp;<span class="op" id="5317108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317114">return</span>&nbsp;<span class="ident" id="5317121">nil</span><span class="op" id="5317124">,</span>&nbsp;<span class="ident" id="5317126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317138">t</span>&nbsp;<span class="op" id="5317140">=</span>&nbsp;<span class="ident" id="5317142">t</span><span class="op" id="5317143">[</span><span class="num" id="5317144">1</span><span class="op" id="5317145">:</span><span class="op" id="5317146">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317150">case</span>&nbsp;<span class="string" id="5317155">&#39;^&#39;</span><span class="op" id="5317158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317163">if</span>&nbsp;<span class="ident" id="5317166">p</span><span class="op" id="5317167">.</span><span class="ident" id="5317168">flags</span><span class="op" id="5317173">&amp;</span><span class="ident" id="5317174">OneLine</span>&nbsp;<span class="op" id="5317182">!=</span>&nbsp;<span class="num" id="5317185">0</span>&nbsp;<span class="op" id="5317187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317193">p</span><span class="op" id="5317194">.</span><span class="ident" id="5317195">op</span><span class="op" id="5317197">(</span><span class="ident" id="5317198">OpBeginText</span><span class="op" id="5317209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317214">}</span>&nbsp;<span class="keyword" id="5317216">else</span>&nbsp;<span class="op" id="5317221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317227">p</span><span class="op" id="5317228">.</span><span class="ident" id="5317229">op</span><span class="op" id="5317231">(</span><span class="ident" id="5317232">OpBeginLine</span><span class="op" id="5317243">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317253">t</span>&nbsp;<span class="op" id="5317255">=</span>&nbsp;<span class="ident" id="5317257">t</span><span class="op" id="5317258">[</span><span class="num" id="5317259">1</span><span class="op" id="5317260">:</span><span class="op" id="5317261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317265">case</span>&nbsp;<span class="string" id="5317270">&#39;$&#39;</span><span class="op" id="5317273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317278">if</span>&nbsp;<span class="ident" id="5317281">p</span><span class="op" id="5317282">.</span><span class="ident" id="5317283">flags</span><span class="op" id="5317288">&amp;</span><span class="ident" id="5317289">OneLine</span>&nbsp;<span class="op" id="5317297">!=</span>&nbsp;<span class="num" id="5317300">0</span>&nbsp;<span class="op" id="5317302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317308">p</span><span class="op" id="5317309">.</span><span class="ident" id="5317310">op</span><span class="op" id="5317312">(</span><span class="ident" id="5317313">OpEndText</span><span class="op" id="5317322">)</span><span class="op" id="5317323">.</span><span class="ident" id="5317324">Flags</span>&nbsp;<span class="op" id="5317330">|=</span>&nbsp;<span class="ident" id="5317333">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317346">}</span>&nbsp;<span class="keyword" id="5317348">else</span>&nbsp;<span class="op" id="5317353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317359">p</span><span class="op" id="5317360">.</span><span class="ident" id="5317361">op</span><span class="op" id="5317363">(</span><span class="ident" id="5317364">OpEndLine</span><span class="op" id="5317373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317383">t</span>&nbsp;<span class="op" id="5317385">=</span>&nbsp;<span class="ident" id="5317387">t</span><span class="op" id="5317388">[</span><span class="num" id="5317389">1</span><span class="op" id="5317390">:</span><span class="op" id="5317391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317395">case</span>&nbsp;<span class="string" id="5317400">&#39;.&#39;</span><span class="op" id="5317403">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317408">if</span>&nbsp;<span class="ident" id="5317411">p</span><span class="op" id="5317412">.</span><span class="ident" id="5317413">flags</span><span class="op" id="5317418">&amp;</span><span class="ident" id="5317419">DotNL</span>&nbsp;<span class="op" id="5317425">!=</span>&nbsp;<span class="num" id="5317428">0</span>&nbsp;<span class="op" id="5317430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317436">p</span><span class="op" id="5317437">.</span><span class="ident" id="5317438">op</span><span class="op" id="5317440">(</span><span class="ident" id="5317441">OpAnyChar</span><span class="op" id="5317450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317455">}</span>&nbsp;<span class="keyword" id="5317457">else</span>&nbsp;<span class="op" id="5317462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317468">p</span><span class="op" id="5317469">.</span><span class="ident" id="5317470">op</span><span class="op" id="5317472">(</span><span class="ident" id="5317473">OpAnyCharNotNL</span><span class="op" id="5317487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317492">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317497">t</span>&nbsp;<span class="op" id="5317499">=</span>&nbsp;<span class="ident" id="5317501">t</span><span class="op" id="5317502">[</span><span class="num" id="5317503">1</span><span class="op" id="5317504">:</span><span class="op" id="5317505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317509">case</span>&nbsp;<span class="string" id="5317514">&#39;[&#39;</span><span class="op" id="5317517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317522">if</span>&nbsp;<span class="ident" id="5317525">t</span><span class="op" id="5317526">,</span>&nbsp;<span class="ident" id="5317528">err</span>&nbsp;<span class="op" id="5317532">=</span>&nbsp;<span class="ident" id="5317534">p</span><span class="op" id="5317535">.</span><span class="ident" id="5317536">parseClass</span><span class="op" id="5317546">(</span><span class="ident" id="5317547">t</span><span class="op" id="5317548">)</span><span class="op" id="5317549">;</span>&nbsp;<span class="ident" id="5317551">err</span>&nbsp;<span class="op" id="5317555">!=</span>&nbsp;<span class="ident" id="5317558">nil</span>&nbsp;<span class="op" id="5317562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317568">return</span>&nbsp;<span class="ident" id="5317575">nil</span><span class="op" id="5317578">,</span>&nbsp;<span class="ident" id="5317580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317587">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317591">case</span>&nbsp;<span class="string" id="5317596">&#39;*&#39;</span><span class="op" id="5317599">,</span>&nbsp;<span class="string" id="5317601">&#39;+&#39;</span><span class="op" id="5317604">,</span>&nbsp;<span class="string" id="5317606">&#39;?&#39;</span><span class="op" id="5317609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317614">before</span>&nbsp;<span class="op" id="5317621">:=</span>&nbsp;<span class="ident" id="5317624">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317629">switch</span>&nbsp;<span class="ident" id="5317636">t</span><span class="op" id="5317637">[</span><span class="num" id="5317638">0</span><span class="op" id="5317639">]</span>&nbsp;<span class="op" id="5317641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317646">case</span>&nbsp;<span class="string" id="5317651">&#39;*&#39;</span><span class="op" id="5317654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317660">op</span>&nbsp;<span class="op" id="5317663">=</span>&nbsp;<span class="ident" id="5317665">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317675">case</span>&nbsp;<span class="string" id="5317680">&#39;+&#39;</span><span class="op" id="5317683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317689">op</span>&nbsp;<span class="op" id="5317692">=</span>&nbsp;<span class="ident" id="5317694">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317704">case</span>&nbsp;<span class="string" id="5317709">&#39;?&#39;</span><span class="op" id="5317712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317718">op</span>&nbsp;<span class="op" id="5317721">=</span>&nbsp;<span class="ident" id="5317723">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317734">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317739">after</span>&nbsp;<span class="op" id="5317745">:=</span>&nbsp;<span class="ident" id="5317748">t</span><span class="op" id="5317749">[</span><span class="num" id="5317750">1</span><span class="op" id="5317751">:</span><span class="op" id="5317752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317757">if</span>&nbsp;<span class="ident" id="5317760">after</span><span class="op" id="5317765">,</span>&nbsp;<span class="ident" id="5317767">err</span>&nbsp;<span class="op" id="5317771">=</span>&nbsp;<span class="ident" id="5317773">p</span><span class="op" id="5317774">.</span><span class="ident" id="5317775">repeat</span><span class="op" id="5317781">(</span><span class="ident" id="5317782">op</span><span class="op" id="5317784">,</span>&nbsp;<span class="num" id="5317786">0</span><span class="op" id="5317787">,</span>&nbsp;<span class="num" id="5317789">0</span><span class="op" id="5317790">,</span>&nbsp;<span class="ident" id="5317792">before</span><span class="op" id="5317798">,</span>&nbsp;<span class="ident" id="5317800">after</span><span class="op" id="5317805">,</span>&nbsp;<span class="ident" id="5317807">lastRepeat</span><span class="op" id="5317817">)</span><span class="op" id="5317818">;</span>&nbsp;<span class="ident" id="5317820">err</span>&nbsp;<span class="op" id="5317824">!=</span>&nbsp;<span class="ident" id="5317827">nil</span>&nbsp;<span class="op" id="5317831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317837">return</span>&nbsp;<span class="ident" id="5317844">nil</span><span class="op" id="5317847">,</span>&nbsp;<span class="ident" id="5317849">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317861">repeat</span>&nbsp;<span class="op" id="5317868">=</span>&nbsp;<span class="ident" id="5317870">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317880">t</span>&nbsp;<span class="op" id="5317882">=</span>&nbsp;<span class="ident" id="5317884">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317892">case</span>&nbsp;<span class="string" id="5317897">&#39;{&#39;</span><span class="op" id="5317900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317905">op</span>&nbsp;<span class="op" id="5317908">=</span>&nbsp;<span class="ident" id="5317910">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317922">before</span>&nbsp;<span class="op" id="5317929">:=</span>&nbsp;<span class="ident" id="5317932">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317937">min</span><span class="op" id="5317940">,</span>&nbsp;<span class="ident" id="5317942">max</span><span class="op" id="5317945">,</span>&nbsp;<span class="ident" id="5317947">after</span><span class="op" id="5317952">,</span>&nbsp;<span class="ident" id="5317954">ok</span>&nbsp;<span class="op" id="5317957">:=</span>&nbsp;<span class="ident" id="5317960">p</span><span class="op" id="5317961">.</span><span class="ident" id="5317962">parseRepeat</span><span class="op" id="5317973">(</span><span class="ident" id="5317974">t</span><span class="op" id="5317975">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317980">if</span>&nbsp;<span class="op" id="5317983">!</span><span class="ident" id="5317984">ok</span>&nbsp;<span class="op" id="5317987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317993">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318048">p</span><span class="op" id="5318049">.</span><span class="ident" id="5318050">literal</span><span class="op" id="5318057">(</span><span class="string" id="5318058">&#39;{&#39;</span><span class="op" id="5318061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318067">t</span>&nbsp;<span class="op" id="5318069">=</span>&nbsp;<span class="ident" id="5318071">t</span><span class="op" id="5318072">[</span><span class="num" id="5318073">1</span><span class="op" id="5318074">:</span><span class="op" id="5318075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318081">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318095">if</span>&nbsp;<span class="ident" id="5318098">min</span>&nbsp;<span class="op" id="5318102">&lt;</span>&nbsp;<span class="num" id="5318104">0</span>&nbsp;<span class="op" id="5318106">||</span>&nbsp;<span class="ident" id="5318109">min</span>&nbsp;<span class="op" id="5318113">&gt;</span>&nbsp;<span class="num" id="5318115">1000</span>&nbsp;<span class="op" id="5318120">||</span>&nbsp;<span class="ident" id="5318123">max</span>&nbsp;<span class="op" id="5318127">&gt;</span>&nbsp;<span class="num" id="5318129">1000</span>&nbsp;<span class="op" id="5318134">||</span>&nbsp;<span class="ident" id="5318137">max</span>&nbsp;<span class="op" id="5318141">&gt;=</span>&nbsp;<span class="num" id="5318144">0</span>&nbsp;<span class="op" id="5318146">&amp;&amp;</span>&nbsp;<span class="ident" id="5318149">min</span>&nbsp;<span class="op" id="5318153">&gt;</span>&nbsp;<span class="ident" id="5318155">max</span>&nbsp;<span class="op" id="5318159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318165">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318227">return</span>&nbsp;<span class="ident" id="5318234">nil</span><span class="op" id="5318237">,</span>&nbsp;<span class="op" id="5318239">&amp;</span><span class="ident" id="5318240">Error</span><span class="op" id="5318245">{</span><span class="ident" id="5318246">ErrInvalidRepeatSize</span><span class="op" id="5318266">,</span>&nbsp;<span class="ident" id="5318268">before</span><span class="op" id="5318274">[</span><span class="op" id="5318275">:</span><span class="builtinfunc" id="5318276">len</span><span class="op" id="5318279">(</span><span class="ident" id="5318280">before</span><span class="op" id="5318286">)</span><span class="op" id="5318287">-</span><span class="builtinfunc" id="5318288">len</span><span class="op" id="5318291">(</span><span class="ident" id="5318292">after</span><span class="op" id="5318297">)</span><span class="op" id="5318298">]</span><span class="op" id="5318299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318304">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318309">if</span>&nbsp;<span class="ident" id="5318312">after</span><span class="op" id="5318317">,</span>&nbsp;<span class="ident" id="5318319">err</span>&nbsp;<span class="op" id="5318323">=</span>&nbsp;<span class="ident" id="5318325">p</span><span class="op" id="5318326">.</span><span class="ident" id="5318327">repeat</span><span class="op" id="5318333">(</span><span class="ident" id="5318334">op</span><span class="op" id="5318336">,</span>&nbsp;<span class="ident" id="5318338">min</span><span class="op" id="5318341">,</span>&nbsp;<span class="ident" id="5318343">max</span><span class="op" id="5318346">,</span>&nbsp;<span class="ident" id="5318348">before</span><span class="op" id="5318354">,</span>&nbsp;<span class="ident" id="5318356">after</span><span class="op" id="5318361">,</span>&nbsp;<span class="ident" id="5318363">lastRepeat</span><span class="op" id="5318373">)</span><span class="op" id="5318374">;</span>&nbsp;<span class="ident" id="5318376">err</span>&nbsp;<span class="op" id="5318380">!=</span>&nbsp;<span class="ident" id="5318383">nil</span>&nbsp;<span class="op" id="5318387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318393">return</span>&nbsp;<span class="ident" id="5318400">nil</span><span class="op" id="5318403">,</span>&nbsp;<span class="ident" id="5318405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318417">repeat</span>&nbsp;<span class="op" id="5318424">=</span>&nbsp;<span class="ident" id="5318426">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318436">t</span>&nbsp;<span class="op" id="5318438">=</span>&nbsp;<span class="ident" id="5318440">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318448">case</span>&nbsp;<span class="string" id="5318453">&#39;\\&#39;</span><span class="op" id="5318457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318462">if</span>&nbsp;<span class="ident" id="5318465">p</span><span class="op" id="5318466">.</span><span class="ident" id="5318467">flags</span><span class="op" id="5318472">&amp;</span><span class="ident" id="5318473">PerlX</span>&nbsp;<span class="op" id="5318479">!=</span>&nbsp;<span class="num" id="5318482">0</span>&nbsp;<span class="op" id="5318484">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5318487">len</span><span class="op" id="5318490">(</span><span class="ident" id="5318491">t</span><span class="op" id="5318492">)</span>&nbsp;<span class="op" id="5318494">&gt;=</span>&nbsp;<span class="num" id="5318497">2</span>&nbsp;<span class="op" id="5318499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318505">switch</span>&nbsp;<span class="ident" id="5318512">t</span><span class="op" id="5318513">[</span><span class="num" id="5318514">1</span><span class="op" id="5318515">]</span>&nbsp;<span class="op" id="5318517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318523">case</span>&nbsp;<span class="string" id="5318528">&#39;A&#39;</span><span class="op" id="5318531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318538">p</span><span class="op" id="5318539">.</span><span class="ident" id="5318540">op</span><span class="op" id="5318542">(</span><span class="ident" id="5318543">OpBeginText</span><span class="op" id="5318554">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318561">t</span>&nbsp;<span class="op" id="5318563">=</span>&nbsp;<span class="ident" id="5318565">t</span><span class="op" id="5318566">[</span><span class="num" id="5318567">2</span><span class="op" id="5318568">:</span><span class="op" id="5318569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318576">break</span>&nbsp;<span class="ident" id="5318582">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318596">case</span>&nbsp;<span class="string" id="5318601">&#39;b&#39;</span><span class="op" id="5318604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318611">p</span><span class="op" id="5318612">.</span><span class="ident" id="5318613">op</span><span class="op" id="5318615">(</span><span class="ident" id="5318616">OpWordBoundary</span><span class="op" id="5318630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318637">t</span>&nbsp;<span class="op" id="5318639">=</span>&nbsp;<span class="ident" id="5318641">t</span><span class="op" id="5318642">[</span><span class="num" id="5318643">2</span><span class="op" id="5318644">:</span><span class="op" id="5318645">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318652">break</span>&nbsp;<span class="ident" id="5318658">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318672">case</span>&nbsp;<span class="string" id="5318677">&#39;B&#39;</span><span class="op" id="5318680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318687">p</span><span class="op" id="5318688">.</span><span class="ident" id="5318689">op</span><span class="op" id="5318691">(</span><span class="ident" id="5318692">OpNoWordBoundary</span><span class="op" id="5318708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318715">t</span>&nbsp;<span class="op" id="5318717">=</span>&nbsp;<span class="ident" id="5318719">t</span><span class="op" id="5318720">[</span><span class="num" id="5318721">2</span><span class="op" id="5318722">:</span><span class="op" id="5318723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318730">break</span>&nbsp;<span class="ident" id="5318736">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318750">case</span>&nbsp;<span class="string" id="5318755">&#39;C&#39;</span><span class="op" id="5318758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318765">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318797">return</span>&nbsp;<span class="ident" id="5318804">nil</span><span class="op" id="5318807">,</span>&nbsp;<span class="op" id="5318809">&amp;</span><span class="ident" id="5318810">Error</span><span class="op" id="5318815">{</span><span class="ident" id="5318816">ErrInvalidEscape</span><span class="op" id="5318832">,</span>&nbsp;<span class="ident" id="5318834">t</span><span class="op" id="5318835">[</span><span class="op" id="5318836">:</span><span class="num" id="5318837">2</span><span class="op" id="5318838">]</span><span class="op" id="5318839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318845">case</span>&nbsp;<span class="string" id="5318850">&#39;Q&#39;</span><span class="op" id="5318853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318860">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318906">var</span>&nbsp;<span class="ident" id="5318910">lit</span>&nbsp;<span class="builtintype" id="5318914">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318926">if</span>&nbsp;<span class="ident" id="5318929">i</span>&nbsp;<span class="op" id="5318931">:=</span>&nbsp;<span class="ident" id="5318934">strings</span><span class="op" id="5318941">.</span><span class="ident" id="5318942">Index</span><span class="op" id="5318947">(</span><span class="ident" id="5318948">t</span><span class="op" id="5318949">,</span>&nbsp;<span class="string" id="5318951">`\E`</span><span class="op" id="5318955">)</span><span class="op" id="5318956">;</span>&nbsp;<span class="ident" id="5318958">i</span>&nbsp;<span class="op" id="5318960">&lt;</span>&nbsp;<span class="num" id="5318962">0</span>&nbsp;<span class="op" id="5318964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318972">lit</span>&nbsp;<span class="op" id="5318976">=</span>&nbsp;<span class="ident" id="5318978">t</span><span class="op" id="5318979">[</span><span class="num" id="5318980">2</span><span class="op" id="5318981">:</span><span class="op" id="5318982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318990">t</span>&nbsp;<span class="op" id="5318992">=</span>&nbsp;<span class="string" id="5318994">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319002">}</span>&nbsp;<span class="keyword" id="5319004">else</span>&nbsp;<span class="op" id="5319009">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319017">lit</span>&nbsp;<span class="op" id="5319021">=</span>&nbsp;<span class="ident" id="5319023">t</span><span class="op" id="5319024">[</span><span class="num" id="5319025">2</span><span class="op" id="5319026">:</span><span class="ident" id="5319027">i</span><span class="op" id="5319028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319036">t</span>&nbsp;<span class="op" id="5319038">=</span>&nbsp;<span class="ident" id="5319040">t</span><span class="op" id="5319041">[</span><span class="ident" id="5319042">i</span><span class="op" id="5319043">+</span><span class="num" id="5319044">2</span><span class="op" id="5319045">:</span><span class="op" id="5319046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319060">p</span><span class="op" id="5319061">.</span><span class="ident" id="5319062">push</span><span class="op" id="5319066">(</span><span class="ident" id="5319067">literalRegexp</span><span class="op" id="5319080">(</span><span class="ident" id="5319081">lit</span><span class="op" id="5319084">,</span>&nbsp;<span class="ident" id="5319086">p</span><span class="op" id="5319087">.</span><span class="ident" id="5319088">flags</span><span class="op" id="5319093">)</span><span class="op" id="5319094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319101">break</span>&nbsp;<span class="ident" id="5319107">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319121">case</span>&nbsp;<span class="string" id="5319126">&#39;z&#39;</span><span class="op" id="5319129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319136">p</span><span class="op" id="5319137">.</span><span class="ident" id="5319138">op</span><span class="op" id="5319140">(</span><span class="ident" id="5319141">OpEndText</span><span class="op" id="5319150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319157">t</span>&nbsp;<span class="op" id="5319159">=</span>&nbsp;<span class="ident" id="5319161">t</span><span class="op" id="5319162">[</span><span class="num" id="5319163">2</span><span class="op" id="5319164">:</span><span class="op" id="5319165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319172">break</span>&nbsp;<span class="ident" id="5319178">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319192">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319203">re</span>&nbsp;<span class="op" id="5319206">:=</span>&nbsp;<span class="ident" id="5319209">p</span><span class="op" id="5319210">.</span><span class="ident" id="5319211">newRegexp</span><span class="op" id="5319220">(</span><span class="ident" id="5319221">OpCharClass</span><span class="op" id="5319232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319237">re</span><span class="op" id="5319239">.</span><span class="ident" id="5319240">Flags</span>&nbsp;<span class="op" id="5319246">=</span>&nbsp;<span class="ident" id="5319248">p</span><span class="op" id="5319249">.</span><span class="ident" id="5319250">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319260">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319312">if</span>&nbsp;<span class="builtinfunc" id="5319315">len</span><span class="op" id="5319318">(</span><span class="ident" id="5319319">t</span><span class="op" id="5319320">)</span>&nbsp;<span class="op" id="5319322">&gt;=</span>&nbsp;<span class="num" id="5319325">2</span>&nbsp;<span class="op" id="5319327">&amp;&amp;</span>&nbsp;<span class="op" id="5319330">(</span><span class="ident" id="5319331">t</span><span class="op" id="5319332">[</span><span class="num" id="5319333">1</span><span class="op" id="5319334">]</span>&nbsp;<span class="op" id="5319336">==</span>&nbsp;<span class="string" id="5319339">&#39;p&#39;</span>&nbsp;<span class="op" id="5319343">||</span>&nbsp;<span class="ident" id="5319346">t</span><span class="op" id="5319347">[</span><span class="num" id="5319348">1</span><span class="op" id="5319349">]</span>&nbsp;<span class="op" id="5319351">==</span>&nbsp;<span class="string" id="5319354">&#39;P&#39;</span><span class="op" id="5319357">)</span>&nbsp;<span class="op" id="5319359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319365">r</span><span class="op" id="5319366">,</span>&nbsp;<span class="ident" id="5319368">rest</span><span class="op" id="5319372">,</span>&nbsp;<span class="ident" id="5319374">err</span>&nbsp;<span class="op" id="5319378">:=</span>&nbsp;<span class="ident" id="5319381">p</span><span class="op" id="5319382">.</span><span class="ident" id="5319383">parseUnicodeClass</span><span class="op" id="5319400">(</span><span class="ident" id="5319401">t</span><span class="op" id="5319402">,</span>&nbsp;<span class="ident" id="5319404">re</span><span class="op" id="5319406">.</span><span class="ident" id="5319407">Rune0</span><span class="op" id="5319412">[</span><span class="op" id="5319413">:</span><span class="num" id="5319414">0</span><span class="op" id="5319415">]</span><span class="op" id="5319416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319422">if</span>&nbsp;<span class="ident" id="5319425">err</span>&nbsp;<span class="op" id="5319429">!=</span>&nbsp;<span class="ident" id="5319432">nil</span>&nbsp;<span class="op" id="5319436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319443">return</span>&nbsp;<span class="ident" id="5319450">nil</span><span class="op" id="5319453">,</span>&nbsp;<span class="ident" id="5319455">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319469">if</span>&nbsp;<span class="ident" id="5319472">r</span>&nbsp;<span class="op" id="5319474">!=</span>&nbsp;<span class="ident" id="5319477">nil</span>&nbsp;<span class="op" id="5319481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319488">re</span><span class="op" id="5319490">.</span><span class="ident" id="5319491">Rune</span>&nbsp;<span class="op" id="5319496">=</span>&nbsp;<span class="ident" id="5319498">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319505">t</span>&nbsp;<span class="op" id="5319507">=</span>&nbsp;<span class="ident" id="5319509">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319519">p</span><span class="op" id="5319520">.</span><span class="ident" id="5319521">push</span><span class="op" id="5319525">(</span><span class="ident" id="5319526">re</span><span class="op" id="5319528">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319535">break</span>&nbsp;<span class="ident" id="5319541">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319566">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319601">if</span>&nbsp;<span class="ident" id="5319604">r</span><span class="op" id="5319605">,</span>&nbsp;<span class="ident" id="5319607">rest</span>&nbsp;<span class="op" id="5319612">:=</span>&nbsp;<span class="ident" id="5319615">p</span><span class="op" id="5319616">.</span><span class="ident" id="5319617">parsePerlClassEscape</span><span class="op" id="5319637">(</span><span class="ident" id="5319638">t</span><span class="op" id="5319639">,</span>&nbsp;<span class="ident" id="5319641">re</span><span class="op" id="5319643">.</span><span class="ident" id="5319644">Rune0</span><span class="op" id="5319649">[</span><span class="op" id="5319650">:</span><span class="num" id="5319651">0</span><span class="op" id="5319652">]</span><span class="op" id="5319653">)</span><span class="op" id="5319654">;</span>&nbsp;<span class="ident" id="5319656">r</span>&nbsp;<span class="op" id="5319658">!=</span>&nbsp;<span class="ident" id="5319661">nil</span>&nbsp;<span class="op" id="5319665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319671">re</span><span class="op" id="5319673">.</span><span class="ident" id="5319674">Rune</span>&nbsp;<span class="op" id="5319679">=</span>&nbsp;<span class="ident" id="5319681">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319687">t</span>&nbsp;<span class="op" id="5319689">=</span>&nbsp;<span class="ident" id="5319691">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319700">p</span><span class="op" id="5319701">.</span><span class="ident" id="5319702">push</span><span class="op" id="5319706">(</span><span class="ident" id="5319707">re</span><span class="op" id="5319709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319715">break</span>&nbsp;<span class="ident" id="5319721">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319739">p</span><span class="op" id="5319740">.</span><span class="ident" id="5319741">reuse</span><span class="op" id="5319746">(</span><span class="ident" id="5319747">re</span><span class="op" id="5319749">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319755">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319795">if</span>&nbsp;<span class="ident" id="5319798">c</span><span class="op" id="5319799">,</span>&nbsp;<span class="ident" id="5319801">t</span><span class="op" id="5319802">,</span>&nbsp;<span class="ident" id="5319804">err</span>&nbsp;<span class="op" id="5319808">=</span>&nbsp;<span class="ident" id="5319810">p</span><span class="op" id="5319811">.</span><span class="ident" id="5319812">parseEscape</span><span class="op" id="5319823">(</span><span class="ident" id="5319824">t</span><span class="op" id="5319825">)</span><span class="op" id="5319826">;</span>&nbsp;<span class="ident" id="5319828">err</span>&nbsp;<span class="op" id="5319832">!=</span>&nbsp;<span class="ident" id="5319835">nil</span>&nbsp;<span class="op" id="5319839">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319845">return</span>&nbsp;<span class="ident" id="5319852">nil</span><span class="op" id="5319855">,</span>&nbsp;<span class="ident" id="5319857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319869">p</span><span class="op" id="5319870">.</span><span class="ident" id="5319871">literal</span><span class="op" id="5319878">(</span><span class="ident" id="5319879">c</span><span class="op" id="5319880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319888">lastRepeat</span>&nbsp;<span class="op" id="5319899">=</span>&nbsp;<span class="ident" id="5319901">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319913">p</span><span class="op" id="5319914">.</span><span class="ident" id="5319915">concat</span><span class="op" id="5319921">(</span><span class="op" id="5319922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319925">if</span>&nbsp;<span class="ident" id="5319928">p</span><span class="op" id="5319929">.</span><span class="ident" id="5319930">swapVerticalBar</span><span class="op" id="5319945">(</span><span class="op" id="5319946">)</span>&nbsp;<span class="op" id="5319948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319952">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319974">p</span><span class="op" id="5319975">.</span><span class="ident" id="5319976">stack</span>&nbsp;<span class="op" id="5319982">=</span>&nbsp;<span class="ident" id="5319984">p</span><span class="op" id="5319985">.</span><span class="ident" id="5319986">stack</span><span class="op" id="5319991">[</span><span class="op" id="5319992">:</span><span class="builtinfunc" id="5319993">len</span><span class="op" id="5319996">(</span><span class="ident" id="5319997">p</span><span class="op" id="5319998">.</span><span class="ident" id="5319999">stack</span><span class="op" id="5320004">)</span><span class="op" id="5320005">-</span><span class="num" id="5320006">1</span><span class="op" id="5320007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320013">p</span><span class="op" id="5320014">.</span><span class="ident" id="5320015">alternate</span><span class="op" id="5320024">(</span><span class="op" id="5320025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320029">n</span>&nbsp;<span class="op" id="5320031">:=</span>&nbsp;<span class="builtinfunc" id="5320034">len</span><span class="op" id="5320037">(</span><span class="ident" id="5320038">p</span><span class="op" id="5320039">.</span><span class="ident" id="5320040">stack</span><span class="op" id="5320045">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320048">if</span>&nbsp;<span class="ident" id="5320051">n</span>&nbsp;<span class="op" id="5320053">!=</span>&nbsp;<span class="num" id="5320056">1</span>&nbsp;<span class="op" id="5320058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320062">return</span>&nbsp;<span class="ident" id="5320069">nil</span><span class="op" id="5320072">,</span>&nbsp;<span class="op" id="5320074">&amp;</span><span class="ident" id="5320075">Error</span><span class="op" id="5320080">{</span><span class="ident" id="5320081">ErrMissingParen</span><span class="op" id="5320096">,</span>&nbsp;<span class="ident" id="5320098">s</span><span class="op" id="5320099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320105">return</span>&nbsp;<span class="ident" id="5320112">p</span><span class="op" id="5320113">.</span><span class="ident" id="5320114">stack</span><span class="op" id="5320119">[</span><span class="num" id="5320120">0</span><span class="op" id="5320121">]</span><span class="op" id="5320122">,</span>&nbsp;<span class="ident" id="5320124">nil</span><br>
<span class="lineno"></span><span class="op" id="5320128">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5320131">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5320202">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5320255">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5320344">func</span>&nbsp;<span class="op" id="5320349">(</span><span class="ident" id="5320350">p</span>&nbsp;<span class="op" id="5320352">*</span><span class="ident" id="5320353">parser</span><span class="op" id="5320359">)</span>&nbsp;<span class="ident" id="5320361">parseRepeat</span><span class="op" id="5320372">(</span><span class="ident" id="5320373">s</span>&nbsp;<span class="builtintype" id="5320375">string</span><span class="op" id="5320381">)</span>&nbsp;<span class="op" id="5320383">(</span><span class="ident" id="5320384">min</span><span class="op" id="5320387">,</span>&nbsp;<span class="ident" id="5320389">max</span>&nbsp;<span class="builtintype" id="5320393">int</span><span class="op" id="5320396">,</span>&nbsp;<span class="ident" id="5320398">rest</span>&nbsp;<span class="builtintype" id="5320403">string</span><span class="op" id="5320409">,</span>&nbsp;<span class="ident" id="5320411">ok</span>&nbsp;<span class="builtintype" id="5320414">bool</span><span class="op" id="5320418">)</span>&nbsp;<span class="op" id="5320420">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320423">if</span>&nbsp;<span class="ident" id="5320426">s</span>&nbsp;<span class="op" id="5320428">==</span>&nbsp;<span class="string" id="5320431">&#34;&#34;</span>&nbsp;<span class="op" id="5320434">||</span>&nbsp;<span class="ident" id="5320437">s</span><span class="op" id="5320438">[</span><span class="num" id="5320439">0</span><span class="op" id="5320440">]</span>&nbsp;<span class="op" id="5320442">!=</span>&nbsp;<span class="string" id="5320445">&#39;{&#39;</span>&nbsp;<span class="op" id="5320449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320453">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320464">s</span>&nbsp;<span class="op" id="5320466">=</span>&nbsp;<span class="ident" id="5320468">s</span><span class="op" id="5320469">[</span><span class="num" id="5320470">1</span><span class="op" id="5320471">:</span><span class="op" id="5320472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320475">var</span>&nbsp;<span class="ident" id="5320479">ok1</span>&nbsp;<span class="builtintype" id="5320483">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320489">if</span>&nbsp;<span class="ident" id="5320492">min</span><span class="op" id="5320495">,</span>&nbsp;<span class="ident" id="5320497">s</span><span class="op" id="5320498">,</span>&nbsp;<span class="ident" id="5320500">ok1</span>&nbsp;<span class="op" id="5320504">=</span>&nbsp;<span class="ident" id="5320506">p</span><span class="op" id="5320507">.</span><span class="ident" id="5320508">parseInt</span><span class="op" id="5320516">(</span><span class="ident" id="5320517">s</span><span class="op" id="5320518">)</span><span class="op" id="5320519">;</span>&nbsp;<span class="op" id="5320521">!</span><span class="ident" id="5320522">ok1</span>&nbsp;<span class="op" id="5320526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320530">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320541">if</span>&nbsp;<span class="ident" id="5320544">s</span>&nbsp;<span class="op" id="5320546">==</span>&nbsp;<span class="string" id="5320549">&#34;&#34;</span>&nbsp;<span class="op" id="5320552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320556">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320567">if</span>&nbsp;<span class="ident" id="5320570">s</span><span class="op" id="5320571">[</span><span class="num" id="5320572">0</span><span class="op" id="5320573">]</span>&nbsp;<span class="op" id="5320575">!=</span>&nbsp;<span class="string" id="5320578">&#39;,&#39;</span>&nbsp;<span class="op" id="5320582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320586">max</span>&nbsp;<span class="op" id="5320590">=</span>&nbsp;<span class="ident" id="5320592">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320597">}</span>&nbsp;<span class="keyword" id="5320599">else</span>&nbsp;<span class="op" id="5320604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320608">s</span>&nbsp;<span class="op" id="5320610">=</span>&nbsp;<span class="ident" id="5320612">s</span><span class="op" id="5320613">[</span><span class="num" id="5320614">1</span><span class="op" id="5320615">:</span><span class="op" id="5320616">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320620">if</span>&nbsp;<span class="ident" id="5320623">s</span>&nbsp;<span class="op" id="5320625">==</span>&nbsp;<span class="string" id="5320628">&#34;&#34;</span>&nbsp;<span class="op" id="5320631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320636">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320649">if</span>&nbsp;<span class="ident" id="5320652">s</span><span class="op" id="5320653">[</span><span class="num" id="5320654">0</span><span class="op" id="5320655">]</span>&nbsp;<span class="op" id="5320657">==</span>&nbsp;<span class="string" id="5320660">&#39;}&#39;</span>&nbsp;<span class="op" id="5320664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320669">max</span>&nbsp;<span class="op" id="5320673">=</span>&nbsp;<span class="op" id="5320675">-</span><span class="num" id="5320676">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320680">}</span>&nbsp;<span class="keyword" id="5320682">else</span>&nbsp;<span class="keyword" id="5320687">if</span>&nbsp;<span class="ident" id="5320690">max</span><span class="op" id="5320693">,</span>&nbsp;<span class="ident" id="5320695">s</span><span class="op" id="5320696">,</span>&nbsp;<span class="ident" id="5320698">ok1</span>&nbsp;<span class="op" id="5320702">=</span>&nbsp;<span class="ident" id="5320704">p</span><span class="op" id="5320705">.</span><span class="ident" id="5320706">parseInt</span><span class="op" id="5320714">(</span><span class="ident" id="5320715">s</span><span class="op" id="5320716">)</span><span class="op" id="5320717">;</span>&nbsp;<span class="op" id="5320719">!</span><span class="ident" id="5320720">ok1</span>&nbsp;<span class="op" id="5320724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320738">}</span>&nbsp;<span class="keyword" id="5320740">else</span>&nbsp;<span class="keyword" id="5320745">if</span>&nbsp;<span class="ident" id="5320748">max</span>&nbsp;<span class="op" id="5320752">&lt;</span>&nbsp;<span class="num" id="5320754">0</span>&nbsp;<span class="op" id="5320756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320761">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320799">min</span>&nbsp;<span class="op" id="5320803">=</span>&nbsp;<span class="op" id="5320805">-</span><span class="num" id="5320806">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320816">if</span>&nbsp;<span class="ident" id="5320819">s</span>&nbsp;<span class="op" id="5320821">==</span>&nbsp;<span class="string" id="5320824">&#34;&#34;</span>&nbsp;<span class="op" id="5320827">||</span>&nbsp;<span class="ident" id="5320830">s</span><span class="op" id="5320831">[</span><span class="num" id="5320832">0</span><span class="op" id="5320833">]</span>&nbsp;<span class="op" id="5320835">!=</span>&nbsp;<span class="string" id="5320838">&#39;}&#39;</span>&nbsp;<span class="op" id="5320842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320854">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320857">rest</span>&nbsp;<span class="op" id="5320862">=</span>&nbsp;<span class="ident" id="5320864">s</span><span class="op" id="5320865">[</span><span class="num" id="5320866">1</span><span class="op" id="5320867">:</span><span class="op" id="5320868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320871">ok</span>&nbsp;<span class="op" id="5320874">=</span>&nbsp;<span class="builtintype" id="5320876">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320882">return</span><br>
<span class="lineno"></span><span class="op" id="5320889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5320892">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5320969">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5321057">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5321114">func</span>&nbsp;<span class="op" id="5321119">(</span><span class="ident" id="5321120">p</span>&nbsp;<span class="op" id="5321122">*</span><span class="ident" id="5321123">parser</span><span class="op" id="5321129">)</span>&nbsp;<span class="ident" id="5321131">parsePerlFlags</span><span class="op" id="5321145">(</span><span class="ident" id="5321146">s</span>&nbsp;<span class="builtintype" id="5321148">string</span><span class="op" id="5321154">)</span>&nbsp;<span class="op" id="5321156">(</span><span class="ident" id="5321157">rest</span>&nbsp;<span class="builtintype" id="5321162">string</span><span class="op" id="5321168">,</span>&nbsp;<span class="ident" id="5321170">err</span>&nbsp;<span class="builtintype" id="5321174">error</span><span class="op" id="5321179">)</span>&nbsp;<span class="op" id="5321181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321184">t</span>&nbsp;<span class="op" id="5321186">:=</span>&nbsp;<span class="ident" id="5321189">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321193">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321268">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321327">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321331">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321389">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321454">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321523">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321527">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321589">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321651">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321715">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321787">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321791">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321851">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321912">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321964">if</span>&nbsp;<span class="builtinfunc" id="5321967">len</span><span class="op" id="5321970">(</span><span class="ident" id="5321971">t</span><span class="op" id="5321972">)</span>&nbsp;<span class="op" id="5321974">&gt;</span>&nbsp;<span class="num" id="5321976">4</span>&nbsp;<span class="op" id="5321978">&amp;&amp;</span>&nbsp;<span class="ident" id="5321981">t</span><span class="op" id="5321982">[</span><span class="num" id="5321983">2</span><span class="op" id="5321984">]</span>&nbsp;<span class="op" id="5321986">==</span>&nbsp;<span class="string" id="5321989">&#39;P&#39;</span>&nbsp;<span class="op" id="5321993">&amp;&amp;</span>&nbsp;<span class="ident" id="5321996">t</span><span class="op" id="5321997">[</span><span class="num" id="5321998">3</span><span class="op" id="5321999">]</span>&nbsp;<span class="op" id="5322001">==</span>&nbsp;<span class="string" id="5322004">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5322008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322012">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322032">end</span>&nbsp;<span class="op" id="5322036">:=</span>&nbsp;<span class="ident" id="5322039">strings</span><span class="op" id="5322046">.</span><span class="ident" id="5322047">IndexRune</span><span class="op" id="5322056">(</span><span class="ident" id="5322057">t</span><span class="op" id="5322058">,</span>&nbsp;<span class="string" id="5322060">&#39;&gt;&#39;</span><span class="op" id="5322063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322067">if</span>&nbsp;<span class="ident" id="5322070">end</span>&nbsp;<span class="op" id="5322074">&lt;</span>&nbsp;<span class="num" id="5322076">0</span>&nbsp;<span class="op" id="5322078">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322083">if</span>&nbsp;<span class="ident" id="5322086">err</span>&nbsp;<span class="op" id="5322090">=</span>&nbsp;<span class="ident" id="5322092">checkUTF8</span><span class="op" id="5322101">(</span><span class="ident" id="5322102">t</span><span class="op" id="5322103">)</span><span class="op" id="5322104">;</span>&nbsp;<span class="ident" id="5322106">err</span>&nbsp;<span class="op" id="5322110">!=</span>&nbsp;<span class="ident" id="5322113">nil</span>&nbsp;<span class="op" id="5322117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322123">return</span>&nbsp;<span class="string" id="5322130">&#34;&#34;</span><span class="op" id="5322132">,</span>&nbsp;<span class="ident" id="5322134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322146">return</span>&nbsp;<span class="string" id="5322153">&#34;&#34;</span><span class="op" id="5322155">,</span>&nbsp;<span class="op" id="5322157">&amp;</span><span class="ident" id="5322158">Error</span><span class="op" id="5322163">{</span><span class="ident" id="5322164">ErrInvalidNamedCapture</span><span class="op" id="5322186">,</span>&nbsp;<span class="ident" id="5322188">s</span><span class="op" id="5322189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322193">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322198">capture</span>&nbsp;<span class="op" id="5322206">:=</span>&nbsp;<span class="ident" id="5322209">t</span><span class="op" id="5322210">[</span><span class="op" id="5322211">:</span><span class="ident" id="5322212">end</span><span class="op" id="5322215">+</span><span class="num" id="5322216">1</span><span class="op" id="5322217">]</span>&nbsp;<span class="comment" id="5322219">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322236">name</span>&nbsp;<span class="op" id="5322241">:=</span>&nbsp;<span class="ident" id="5322244">t</span><span class="op" id="5322245">[</span><span class="num" id="5322246">4</span><span class="op" id="5322247">:</span><span class="ident" id="5322248">end</span><span class="op" id="5322251">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322257">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322269">if</span>&nbsp;<span class="ident" id="5322272">err</span>&nbsp;<span class="op" id="5322276">=</span>&nbsp;<span class="ident" id="5322278">checkUTF8</span><span class="op" id="5322287">(</span><span class="ident" id="5322288">name</span><span class="op" id="5322292">)</span><span class="op" id="5322293">;</span>&nbsp;<span class="ident" id="5322295">err</span>&nbsp;<span class="op" id="5322299">!=</span>&nbsp;<span class="ident" id="5322302">nil</span>&nbsp;<span class="op" id="5322306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322311">return</span>&nbsp;<span class="string" id="5322318">&#34;&#34;</span><span class="op" id="5322320">,</span>&nbsp;<span class="ident" id="5322322">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322332">if</span>&nbsp;<span class="op" id="5322335">!</span><span class="ident" id="5322336">isValidCaptureName</span><span class="op" id="5322354">(</span><span class="ident" id="5322355">name</span><span class="op" id="5322359">)</span>&nbsp;<span class="op" id="5322361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322366">return</span>&nbsp;<span class="string" id="5322373">&#34;&#34;</span><span class="op" id="5322375">,</span>&nbsp;<span class="op" id="5322377">&amp;</span><span class="ident" id="5322378">Error</span><span class="op" id="5322383">{</span><span class="ident" id="5322384">ErrInvalidNamedCapture</span><span class="op" id="5322406">,</span>&nbsp;<span class="ident" id="5322408">capture</span><span class="op" id="5322415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322424">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322463">p</span><span class="op" id="5322464">.</span><span class="ident" id="5322465">numCap</span><span class="op" id="5322471">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322476">re</span>&nbsp;<span class="op" id="5322479">:=</span>&nbsp;<span class="ident" id="5322482">p</span><span class="op" id="5322483">.</span><span class="ident" id="5322484">op</span><span class="op" id="5322486">(</span><span class="ident" id="5322487">opLeftParen</span><span class="op" id="5322498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322502">re</span><span class="op" id="5322504">.</span><span class="ident" id="5322505">Cap</span>&nbsp;<span class="op" id="5322509">=</span>&nbsp;<span class="ident" id="5322511">p</span><span class="op" id="5322512">.</span><span class="ident" id="5322513">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322522">re</span><span class="op" id="5322524">.</span><span class="ident" id="5322525">Name</span>&nbsp;<span class="op" id="5322530">=</span>&nbsp;<span class="ident" id="5322532">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322539">return</span>&nbsp;<span class="ident" id="5322546">t</span><span class="op" id="5322547">[</span><span class="ident" id="5322548">end</span><span class="op" id="5322551">+</span><span class="num" id="5322552">1</span><span class="op" id="5322553">:</span><span class="op" id="5322554">]</span><span class="op" id="5322555">,</span>&nbsp;<span class="ident" id="5322557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322566">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322623">var</span>&nbsp;<span class="ident" id="5322627">c</span>&nbsp;<span class="builtintype" id="5322629">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322635">t</span>&nbsp;<span class="op" id="5322637">=</span>&nbsp;<span class="ident" id="5322639">t</span><span class="op" id="5322640">[</span><span class="num" id="5322641">2</span><span class="op" id="5322642">:</span><span class="op" id="5322643">]</span>&nbsp;<span class="comment" id="5322645">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322657">flags</span>&nbsp;<span class="op" id="5322663">:=</span>&nbsp;<span class="ident" id="5322666">p</span><span class="op" id="5322667">.</span><span class="ident" id="5322668">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322675">sign</span>&nbsp;<span class="op" id="5322680">:=</span>&nbsp;<span class="op" id="5322683">+</span><span class="num" id="5322684">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322687">sawFlag</span>&nbsp;<span class="op" id="5322695">:=</span>&nbsp;<span class="builtintype" id="5322698">false</span><br>
<span class="lineno"></span><span class="ident" id="5322704">Loop</span><span class="op" id="5322708">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322711">for</span>&nbsp;<span class="ident" id="5322715">t</span>&nbsp;<span class="op" id="5322717">!=</span>&nbsp;<span class="string" id="5322720">&#34;&#34;</span>&nbsp;<span class="op" id="5322723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322727">if</span>&nbsp;<span class="ident" id="5322730">c</span><span class="op" id="5322731">,</span>&nbsp;<span class="ident" id="5322733">t</span><span class="op" id="5322734">,</span>&nbsp;<span class="ident" id="5322736">err</span>&nbsp;<span class="op" id="5322740">=</span>&nbsp;<span class="ident" id="5322742">nextRune</span><span class="op" id="5322750">(</span><span class="ident" id="5322751">t</span><span class="op" id="5322752">)</span><span class="op" id="5322753">;</span>&nbsp;<span class="ident" id="5322755">err</span>&nbsp;<span class="op" id="5322759">!=</span>&nbsp;<span class="ident" id="5322762">nil</span>&nbsp;<span class="op" id="5322766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322771">return</span>&nbsp;<span class="string" id="5322778">&#34;&#34;</span><span class="op" id="5322780">,</span>&nbsp;<span class="ident" id="5322782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322792">switch</span>&nbsp;<span class="ident" id="5322799">c</span>&nbsp;<span class="op" id="5322801">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322805">default</span><span class="op" id="5322812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322817">break</span>&nbsp;<span class="ident" id="5322823">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322831">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322843">case</span>&nbsp;<span class="string" id="5322848">&#39;i&#39;</span><span class="op" id="5322851">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322856">flags</span>&nbsp;<span class="op" id="5322862">|=</span>&nbsp;<span class="ident" id="5322865">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322877">sawFlag</span>&nbsp;<span class="op" id="5322885">=</span>&nbsp;<span class="builtintype" id="5322887">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322894">case</span>&nbsp;<span class="string" id="5322899">&#39;m&#39;</span><span class="op" id="5322902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322907">flags</span>&nbsp;<span class="op" id="5322913">&amp;^=</span>&nbsp;<span class="ident" id="5322917">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322928">sawFlag</span>&nbsp;<span class="op" id="5322936">=</span>&nbsp;<span class="builtintype" id="5322938">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322945">case</span>&nbsp;<span class="string" id="5322950">&#39;s&#39;</span><span class="op" id="5322953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322958">flags</span>&nbsp;<span class="op" id="5322964">|=</span>&nbsp;<span class="ident" id="5322967">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322976">sawFlag</span>&nbsp;<span class="op" id="5322984">=</span>&nbsp;<span class="builtintype" id="5322986">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322993">case</span>&nbsp;<span class="string" id="5322998">&#39;U&#39;</span><span class="op" id="5323001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323006">flags</span>&nbsp;<span class="op" id="5323012">|=</span>&nbsp;<span class="ident" id="5323015">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323028">sawFlag</span>&nbsp;<span class="op" id="5323036">=</span>&nbsp;<span class="builtintype" id="5323038">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323046">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323071">case</span>&nbsp;<span class="string" id="5323076">&#39;-&#39;</span><span class="op" id="5323079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323084">if</span>&nbsp;<span class="ident" id="5323087">sign</span>&nbsp;<span class="op" id="5323092">&lt;</span>&nbsp;<span class="num" id="5323094">0</span>&nbsp;<span class="op" id="5323096">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323102">break</span>&nbsp;<span class="ident" id="5323108">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323121">sign</span>&nbsp;<span class="op" id="5323126">=</span>&nbsp;<span class="op" id="5323128">-</span><span class="num" id="5323129">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323134">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323198">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323252">flags</span>&nbsp;<span class="op" id="5323258">=</span>&nbsp;<span class="op" id="5323260">^</span><span class="ident" id="5323261">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323270">sawFlag</span>&nbsp;<span class="op" id="5323278">=</span>&nbsp;<span class="builtintype" id="5323280">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323289">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323331">case</span>&nbsp;<span class="string" id="5323336">&#39;:&#39;</span><span class="op" id="5323339">,</span>&nbsp;<span class="string" id="5323341">&#39;)&#39;</span><span class="op" id="5323344">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323349">if</span>&nbsp;<span class="ident" id="5323352">sign</span>&nbsp;<span class="op" id="5323357">&lt;</span>&nbsp;<span class="num" id="5323359">0</span>&nbsp;<span class="op" id="5323361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323367">if</span>&nbsp;<span class="op" id="5323370">!</span><span class="ident" id="5323371">sawFlag</span>&nbsp;<span class="op" id="5323379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323386">break</span>&nbsp;<span class="ident" id="5323392">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323407">flags</span>&nbsp;<span class="op" id="5323413">=</span>&nbsp;<span class="op" id="5323415">^</span><span class="ident" id="5323416">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323430">if</span>&nbsp;<span class="ident" id="5323433">c</span>&nbsp;<span class="op" id="5323435">==</span>&nbsp;<span class="string" id="5323438">&#39;:&#39;</span>&nbsp;<span class="op" id="5323442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323448">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323470">p</span><span class="op" id="5323471">.</span><span class="ident" id="5323472">op</span><span class="op" id="5323474">(</span><span class="ident" id="5323475">opLeftParen</span><span class="op" id="5323486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323491">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323496">p</span><span class="op" id="5323497">.</span><span class="ident" id="5323498">flags</span>&nbsp;<span class="op" id="5323504">=</span>&nbsp;<span class="ident" id="5323506">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323515">return</span>&nbsp;<span class="ident" id="5323522">t</span><span class="op" id="5323523">,</span>&nbsp;<span class="ident" id="5323525">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323538">return</span>&nbsp;<span class="string" id="5323545">&#34;&#34;</span><span class="op" id="5323547">,</span>&nbsp;<span class="op" id="5323549">&amp;</span><span class="ident" id="5323550">Error</span><span class="op" id="5323555">{</span><span class="ident" id="5323556">ErrInvalidPerlOp</span><span class="op" id="5323572">,</span>&nbsp;<span class="ident" id="5323574">s</span><span class="op" id="5323575">[</span><span class="op" id="5323576">:</span><span class="builtinfunc" id="5323577">len</span><span class="op" id="5323580">(</span><span class="ident" id="5323581">s</span><span class="op" id="5323582">)</span><span class="op" id="5323583">-</span><span class="builtinfunc" id="5323584">len</span><span class="op" id="5323587">(</span><span class="ident" id="5323588">t</span><span class="op" id="5323589">)</span><span class="op" id="5323590">]</span><span class="op" id="5323591">}</span><br>
<span class="lineno"></span><span class="op" id="5323593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5323596">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5323639">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5323682">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5323716">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5323762">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5323799">func</span>&nbsp;<span class="ident" id="5323804">isValidCaptureName</span><span class="op" id="5323822">(</span><span class="ident" id="5323823">name</span>&nbsp;<span class="builtintype" id="5323828">string</span><span class="op" id="5323834">)</span>&nbsp;<span class="builtintype" id="5323836">bool</span>&nbsp;<span class="op" id="5323841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323844">if</span>&nbsp;<span class="ident" id="5323847">name</span>&nbsp;<span class="op" id="5323852">==</span>&nbsp;<span class="string" id="5323855">&#34;&#34;</span>&nbsp;<span class="op" id="5323858">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323862">return</span>&nbsp;<span class="builtintype" id="5323869">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323879">for</span>&nbsp;<span class="ident" id="5323883">_</span><span class="op" id="5323884">,</span>&nbsp;<span class="ident" id="5323886">c</span>&nbsp;<span class="op" id="5323888">:=</span>&nbsp;<span class="keyword" id="5323891">range</span>&nbsp;<span class="ident" id="5323897">name</span>&nbsp;<span class="op" id="5323902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323906">if</span>&nbsp;<span class="ident" id="5323909">c</span>&nbsp;<span class="op" id="5323911">!=</span>&nbsp;<span class="string" id="5323914">&#39;_&#39;</span>&nbsp;<span class="op" id="5323918">&amp;&amp;</span>&nbsp;<span class="op" id="5323921">!</span><span class="ident" id="5323922">isalnum</span><span class="op" id="5323929">(</span><span class="ident" id="5323930">c</span><span class="op" id="5323931">)</span>&nbsp;<span class="op" id="5323933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323938">return</span>&nbsp;<span class="builtintype" id="5323945">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323959">return</span>&nbsp;<span class="builtintype" id="5323966">true</span><br>
<span class="lineno"></span><span class="op" id="5323971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5323974">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5324012">func</span>&nbsp;<span class="op" id="5324017">(</span><span class="ident" id="5324018">p</span>&nbsp;<span class="op" id="5324020">*</span><span class="ident" id="5324021">parser</span><span class="op" id="5324027">)</span>&nbsp;<span class="ident" id="5324029">parseInt</span><span class="op" id="5324037">(</span><span class="ident" id="5324038">s</span>&nbsp;<span class="builtintype" id="5324040">string</span><span class="op" id="5324046">)</span>&nbsp;<span class="op" id="5324048">(</span><span class="ident" id="5324049">n</span>&nbsp;<span class="builtintype" id="5324051">int</span><span class="op" id="5324054">,</span>&nbsp;<span class="ident" id="5324056">rest</span>&nbsp;<span class="builtintype" id="5324061">string</span><span class="op" id="5324067">,</span>&nbsp;<span class="ident" id="5324069">ok</span>&nbsp;<span class="builtintype" id="5324072">bool</span><span class="op" id="5324076">)</span>&nbsp;<span class="op" id="5324078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324081">if</span>&nbsp;<span class="ident" id="5324084">s</span>&nbsp;<span class="op" id="5324086">==</span>&nbsp;<span class="string" id="5324089">&#34;&#34;</span>&nbsp;<span class="op" id="5324092">||</span>&nbsp;<span class="ident" id="5324095">s</span><span class="op" id="5324096">[</span><span class="num" id="5324097">0</span><span class="op" id="5324098">]</span>&nbsp;<span class="op" id="5324100">&lt;</span>&nbsp;<span class="string" id="5324102">&#39;0&#39;</span>&nbsp;<span class="op" id="5324106">||</span>&nbsp;<span class="string" id="5324109">&#39;9&#39;</span>&nbsp;<span class="op" id="5324113">&lt;</span>&nbsp;<span class="ident" id="5324115">s</span><span class="op" id="5324116">[</span><span class="num" id="5324117">0</span><span class="op" id="5324118">]</span>&nbsp;<span class="op" id="5324120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324124">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324132">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324135">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324163">if</span>&nbsp;<span class="builtinfunc" id="5324166">len</span><span class="op" id="5324169">(</span><span class="ident" id="5324170">s</span><span class="op" id="5324171">)</span>&nbsp;<span class="op" id="5324173">&gt;=</span>&nbsp;<span class="num" id="5324176">2</span>&nbsp;<span class="op" id="5324178">&amp;&amp;</span>&nbsp;<span class="ident" id="5324181">s</span><span class="op" id="5324182">[</span><span class="num" id="5324183">0</span><span class="op" id="5324184">]</span>&nbsp;<span class="op" id="5324186">==</span>&nbsp;<span class="string" id="5324189">&#39;0&#39;</span>&nbsp;<span class="op" id="5324193">&amp;&amp;</span>&nbsp;<span class="string" id="5324196">&#39;0&#39;</span>&nbsp;<span class="op" id="5324200">&lt;=</span>&nbsp;<span class="ident" id="5324203">s</span><span class="op" id="5324204">[</span><span class="num" id="5324205">1</span><span class="op" id="5324206">]</span>&nbsp;<span class="op" id="5324208">&amp;&amp;</span>&nbsp;<span class="ident" id="5324211">s</span><span class="op" id="5324212">[</span><span class="num" id="5324213">1</span><span class="op" id="5324214">]</span>&nbsp;<span class="op" id="5324216">&lt;=</span>&nbsp;<span class="string" id="5324219">&#39;9&#39;</span>&nbsp;<span class="op" id="5324223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324227">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324238">t</span>&nbsp;<span class="op" id="5324240">:=</span>&nbsp;<span class="ident" id="5324243">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324246">for</span>&nbsp;<span class="ident" id="5324250">s</span>&nbsp;<span class="op" id="5324252">!=</span>&nbsp;<span class="string" id="5324255">&#34;&#34;</span>&nbsp;<span class="op" id="5324258">&amp;&amp;</span>&nbsp;<span class="string" id="5324261">&#39;0&#39;</span>&nbsp;<span class="op" id="5324265">&lt;=</span>&nbsp;<span class="ident" id="5324268">s</span><span class="op" id="5324269">[</span><span class="num" id="5324270">0</span><span class="op" id="5324271">]</span>&nbsp;<span class="op" id="5324273">&amp;&amp;</span>&nbsp;<span class="ident" id="5324276">s</span><span class="op" id="5324277">[</span><span class="num" id="5324278">0</span><span class="op" id="5324279">]</span>&nbsp;<span class="op" id="5324281">&lt;=</span>&nbsp;<span class="string" id="5324284">&#39;9&#39;</span>&nbsp;<span class="op" id="5324288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324292">s</span>&nbsp;<span class="op" id="5324294">=</span>&nbsp;<span class="ident" id="5324296">s</span><span class="op" id="5324297">[</span><span class="num" id="5324298">1</span><span class="op" id="5324299">:</span><span class="op" id="5324300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324306">rest</span>&nbsp;<span class="op" id="5324311">=</span>&nbsp;<span class="ident" id="5324313">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324316">ok</span>&nbsp;<span class="op" id="5324319">=</span>&nbsp;<span class="builtintype" id="5324321">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324327">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324359">t</span>&nbsp;<span class="op" id="5324361">=</span>&nbsp;<span class="ident" id="5324363">t</span><span class="op" id="5324364">[</span><span class="op" id="5324365">:</span><span class="builtinfunc" id="5324366">len</span><span class="op" id="5324369">(</span><span class="ident" id="5324370">t</span><span class="op" id="5324371">)</span><span class="op" id="5324372">-</span><span class="builtinfunc" id="5324373">len</span><span class="op" id="5324376">(</span><span class="ident" id="5324377">s</span><span class="op" id="5324378">)</span><span class="op" id="5324379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324382">for</span>&nbsp;<span class="ident" id="5324386">i</span>&nbsp;<span class="op" id="5324388">:=</span>&nbsp;<span class="num" id="5324391">0</span><span class="op" id="5324392">;</span>&nbsp;<span class="ident" id="5324394">i</span>&nbsp;<span class="op" id="5324396">&lt;</span>&nbsp;<span class="builtinfunc" id="5324398">len</span><span class="op" id="5324401">(</span><span class="ident" id="5324402">t</span><span class="op" id="5324403">)</span><span class="op" id="5324404">;</span>&nbsp;<span class="ident" id="5324406">i</span><span class="op" id="5324407">++</span>&nbsp;<span class="op" id="5324410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324414">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324435">if</span>&nbsp;<span class="ident" id="5324438">n</span>&nbsp;<span class="op" id="5324440">&gt;=</span>&nbsp;<span class="num" id="5324443">1e8</span>&nbsp;<span class="op" id="5324447">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324452">n</span>&nbsp;<span class="op" id="5324454">=</span>&nbsp;<span class="op" id="5324456">-</span><span class="num" id="5324457">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324462">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324474">n</span>&nbsp;<span class="op" id="5324476">=</span>&nbsp;<span class="ident" id="5324478">n</span><span class="op" id="5324479">*</span><span class="num" id="5324480">10</span>&nbsp;<span class="op" id="5324483">+</span>&nbsp;<span class="builtintype" id="5324485">int</span><span class="op" id="5324488">(</span><span class="ident" id="5324489">t</span><span class="op" id="5324490">[</span><span class="ident" id="5324491">i</span><span class="op" id="5324492">]</span><span class="op" id="5324493">)</span>&nbsp;<span class="op" id="5324495">-</span>&nbsp;<span class="string" id="5324497">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324502">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324505">return</span><br>
<span class="lineno"></span><span class="op" id="5324512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5324515">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5324564">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5324620">func</span>&nbsp;<span class="ident" id="5324625">isCharClass</span><span class="op" id="5324636">(</span><span class="ident" id="5324637">re</span>&nbsp;<span class="op" id="5324640">*</span><span class="ident" id="5324641">Regexp</span><span class="op" id="5324647">)</span>&nbsp;<span class="builtintype" id="5324649">bool</span>&nbsp;<span class="op" id="5324654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324657">return</span>&nbsp;<span class="ident" id="5324664">re</span><span class="op" id="5324666">.</span><span class="ident" id="5324667">Op</span>&nbsp;<span class="op" id="5324670">==</span>&nbsp;<span class="ident" id="5324673">OpLiteral</span>&nbsp;<span class="op" id="5324683">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5324686">len</span><span class="op" id="5324689">(</span><span class="ident" id="5324690">re</span><span class="op" id="5324692">.</span><span class="ident" id="5324693">Rune</span><span class="op" id="5324697">)</span>&nbsp;<span class="op" id="5324699">==</span>&nbsp;<span class="num" id="5324702">1</span>&nbsp;<span class="op" id="5324704">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324709">re</span><span class="op" id="5324711">.</span><span class="ident" id="5324712">Op</span>&nbsp;<span class="op" id="5324715">==</span>&nbsp;<span class="ident" id="5324718">OpCharClass</span>&nbsp;<span class="op" id="5324730">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324735">re</span><span class="op" id="5324737">.</span><span class="ident" id="5324738">Op</span>&nbsp;<span class="op" id="5324741">==</span>&nbsp;<span class="ident" id="5324744">OpAnyCharNotNL</span>&nbsp;<span class="op" id="5324759">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324764">re</span><span class="op" id="5324766">.</span><span class="ident" id="5324767">Op</span>&nbsp;<span class="op" id="5324770">==</span>&nbsp;<span class="ident" id="5324773">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="5324783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5324786">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5324806">func</span>&nbsp;<span class="ident" id="5324811">matchRune</span><span class="op" id="5324820">(</span><span class="ident" id="5324821">re</span>&nbsp;<span class="op" id="5324824">*</span><span class="ident" id="5324825">Regexp</span><span class="op" id="5324831">,</span>&nbsp;<span class="ident" id="5324833">r</span>&nbsp;<span class="builtintype" id="5324835">rune</span><span class="op" id="5324839">)</span>&nbsp;<span class="builtintype" id="5324841">bool</span>&nbsp;<span class="op" id="5324846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324849">switch</span>&nbsp;<span class="ident" id="5324856">re</span><span class="op" id="5324858">.</span><span class="ident" id="5324859">Op</span>&nbsp;<span class="op" id="5324862">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324865">case</span>&nbsp;<span class="ident" id="5324870">OpLiteral</span><span class="op" id="5324879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324883">return</span>&nbsp;<span class="builtinfunc" id="5324890">len</span><span class="op" id="5324893">(</span><span class="ident" id="5324894">re</span><span class="op" id="5324896">.</span><span class="ident" id="5324897">Rune</span><span class="op" id="5324901">)</span>&nbsp;<span class="op" id="5324903">==</span>&nbsp;<span class="num" id="5324906">1</span>&nbsp;<span class="op" id="5324908">&amp;&amp;</span>&nbsp;<span class="ident" id="5324911">re</span><span class="op" id="5324913">.</span><span class="ident" id="5324914">Rune</span><span class="op" id="5324918">[</span><span class="num" id="5324919">0</span><span class="op" id="5324920">]</span>&nbsp;<span class="op" id="5324922">==</span>&nbsp;<span class="ident" id="5324925">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324928">case</span>&nbsp;<span class="ident" id="5324933">OpCharClass</span><span class="op" id="5324944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324948">for</span>&nbsp;<span class="ident" id="5324952">i</span>&nbsp;<span class="op" id="5324954">:=</span>&nbsp;<span class="num" id="5324957">0</span><span class="op" id="5324958">;</span>&nbsp;<span class="ident" id="5324960">i</span>&nbsp;<span class="op" id="5324962">&lt;</span>&nbsp;<span class="builtinfunc" id="5324964">len</span><span class="op" id="5324967">(</span><span class="ident" id="5324968">re</span><span class="op" id="5324970">.</span><span class="ident" id="5324971">Rune</span><span class="op" id="5324975">)</span><span class="op" id="5324976">;</span>&nbsp;<span class="ident" id="5324978">i</span>&nbsp;<span class="op" id="5324980">+=</span>&nbsp;<span class="num" id="5324983">2</span>&nbsp;<span class="op" id="5324985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324990">if</span>&nbsp;<span class="ident" id="5324993">re</span><span class="op" id="5324995">.</span><span class="ident" id="5324996">Rune</span><span class="op" id="5325000">[</span><span class="ident" id="5325001">i</span><span class="op" id="5325002">]</span>&nbsp;<span class="op" id="5325004">&lt;=</span>&nbsp;<span class="ident" id="5325007">r</span>&nbsp;<span class="op" id="5325009">&amp;&amp;</span>&nbsp;<span class="ident" id="5325012">r</span>&nbsp;<span class="op" id="5325014">&lt;=</span>&nbsp;<span class="ident" id="5325017">re</span><span class="op" id="5325019">.</span><span class="ident" id="5325020">Rune</span><span class="op" id="5325024">[</span><span class="ident" id="5325025">i</span><span class="op" id="5325026">+</span><span class="num" id="5325027">1</span><span class="op" id="5325028">]</span>&nbsp;<span class="op" id="5325030">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325036">return</span>&nbsp;<span class="builtintype" id="5325043">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325059">return</span>&nbsp;<span class="builtintype" id="5325066">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325073">case</span>&nbsp;<span class="ident" id="5325078">OpAnyCharNotNL</span><span class="op" id="5325092">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325096">return</span>&nbsp;<span class="ident" id="5325103">r</span>&nbsp;<span class="op" id="5325105">!=</span>&nbsp;<span class="string" id="5325108">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325114">case</span>&nbsp;<span class="ident" id="5325119">OpAnyChar</span><span class="op" id="5325128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325132">return</span>&nbsp;<span class="builtintype" id="5325139">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325148">return</span>&nbsp;<span class="builtintype" id="5325155">false</span><br>
<span class="lineno">1110</span><span class="op" id="5325161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325164">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5325210">func</span>&nbsp;<span class="op" id="5325215">(</span><span class="ident" id="5325216">p</span>&nbsp;<span class="op" id="5325218">*</span><span class="ident" id="5325219">parser</span><span class="op" id="5325225">)</span>&nbsp;<span class="ident" id="5325227">parseVerticalBar</span><span class="op" id="5325243">(</span><span class="op" id="5325244">)</span>&nbsp;<span class="builtintype" id="5325246">error</span>&nbsp;<span class="op" id="5325252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325255">p</span><span class="op" id="5325256">.</span><span class="ident" id="5325257">concat</span><span class="op" id="5325263">(</span><span class="op" id="5325264">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325268">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325329">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325382">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325441">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325481">if</span>&nbsp;<span class="op" id="5325484">!</span><span class="ident" id="5325485">p</span><span class="op" id="5325486">.</span><span class="ident" id="5325487">swapVerticalBar</span><span class="op" id="5325502">(</span><span class="op" id="5325503">)</span>&nbsp;<span class="op" id="5325505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325509">p</span><span class="op" id="5325510">.</span><span class="ident" id="5325511">op</span><span class="op" id="5325513">(</span><span class="ident" id="5325514">opVerticalBar</span><span class="op" id="5325527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325534">return</span>&nbsp;<span class="ident" id="5325541">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5325545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325548">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5325587">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5325636">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5325672">func</span>&nbsp;<span class="ident" id="5325677">mergeCharClass</span><span class="op" id="5325691">(</span><span class="ident" id="5325692">dst</span><span class="op" id="5325695">,</span>&nbsp;<span class="ident" id="5325697">src</span>&nbsp;<span class="op" id="5325701">*</span><span class="ident" id="5325702">Regexp</span><span class="op" id="5325708">)</span>&nbsp;<span class="op" id="5325710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325713">switch</span>&nbsp;<span class="ident" id="5325720">dst</span><span class="op" id="5325723">.</span><span class="ident" id="5325724">Op</span>&nbsp;<span class="op" id="5325727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325730">case</span>&nbsp;<span class="ident" id="5325735">OpAnyChar</span><span class="op" id="5325744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325748">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325778">case</span>&nbsp;<span class="ident" id="5325783">OpAnyCharNotNL</span><span class="op" id="5325797">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325801">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325823">if</span>&nbsp;<span class="ident" id="5325826">matchRune</span><span class="op" id="5325835">(</span><span class="ident" id="5325836">src</span><span class="op" id="5325839">,</span>&nbsp;<span class="string" id="5325841">&#39;\n&#39;</span><span class="op" id="5325845">)</span>&nbsp;<span class="op" id="5325847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325852">dst</span><span class="op" id="5325855">.</span><span class="ident" id="5325856">Op</span>&nbsp;<span class="op" id="5325859">=</span>&nbsp;<span class="ident" id="5325861">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325876">case</span>&nbsp;<span class="ident" id="5325881">OpCharClass</span><span class="op" id="5325892">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5325896">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325949">if</span>&nbsp;<span class="ident" id="5325952">src</span><span class="op" id="5325955">.</span><span class="ident" id="5325956">Op</span>&nbsp;<span class="op" id="5325959">==</span>&nbsp;<span class="ident" id="5325962">OpLiteral</span>&nbsp;<span class="op" id="5325972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325977">dst</span><span class="op" id="5325980">.</span><span class="ident" id="5325981">Rune</span>&nbsp;<span class="op" id="5325986">=</span>&nbsp;<span class="ident" id="5325988">appendLiteral</span><span class="op" id="5326001">(</span><span class="ident" id="5326002">dst</span><span class="op" id="5326005">.</span><span class="ident" id="5326006">Rune</span><span class="op" id="5326010">,</span>&nbsp;<span class="ident" id="5326012">src</span><span class="op" id="5326015">.</span><span class="ident" id="5326016">Rune</span><span class="op" id="5326020">[</span><span class="num" id="5326021">0</span><span class="op" id="5326022">]</span><span class="op" id="5326023">,</span>&nbsp;<span class="ident" id="5326025">src</span><span class="op" id="5326028">.</span><span class="ident" id="5326029">Flags</span><span class="op" id="5326034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326038">}</span>&nbsp;<span class="keyword" id="5326040">else</span>&nbsp;<span class="op" id="5326045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326050">dst</span><span class="op" id="5326053">.</span><span class="ident" id="5326054">Rune</span>&nbsp;<span class="op" id="5326059">=</span>&nbsp;<span class="ident" id="5326061">appendClass</span><span class="op" id="5326072">(</span><span class="ident" id="5326073">dst</span><span class="op" id="5326076">.</span><span class="ident" id="5326077">Rune</span><span class="op" id="5326081">,</span>&nbsp;<span class="ident" id="5326083">src</span><span class="op" id="5326086">.</span><span class="ident" id="5326087">Rune</span><span class="op" id="5326091">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326098">case</span>&nbsp;<span class="ident" id="5326103">OpLiteral</span><span class="op" id="5326112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5326116">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326134">if</span>&nbsp;<span class="ident" id="5326137">src</span><span class="op" id="5326140">.</span><span class="ident" id="5326141">Rune</span><span class="op" id="5326145">[</span><span class="num" id="5326146">0</span><span class="op" id="5326147">]</span>&nbsp;<span class="op" id="5326149">==</span>&nbsp;<span class="ident" id="5326152">dst</span><span class="op" id="5326155">.</span><span class="ident" id="5326156">Rune</span><span class="op" id="5326160">[</span><span class="num" id="5326161">0</span><span class="op" id="5326162">]</span>&nbsp;<span class="op" id="5326164">&amp;&amp;</span>&nbsp;<span class="ident" id="5326167">src</span><span class="op" id="5326170">.</span><span class="ident" id="5326171">Flags</span>&nbsp;<span class="op" id="5326177">==</span>&nbsp;<span class="ident" id="5326180">dst</span><span class="op" id="5326183">.</span><span class="ident" id="5326184">Flags</span>&nbsp;<span class="op" id="5326190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326195">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326207">dst</span><span class="op" id="5326210">.</span><span class="ident" id="5326211">Op</span>&nbsp;<span class="op" id="5326214">=</span>&nbsp;<span class="ident" id="5326216">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326230">dst</span><span class="op" id="5326233">.</span><span class="ident" id="5326234">Rune</span>&nbsp;<span class="op" id="5326239">=</span>&nbsp;<span class="ident" id="5326241">appendLiteral</span><span class="op" id="5326254">(</span><span class="ident" id="5326255">dst</span><span class="op" id="5326258">.</span><span class="ident" id="5326259">Rune</span><span class="op" id="5326263">[</span><span class="op" id="5326264">:</span><span class="num" id="5326265">0</span><span class="op" id="5326266">]</span><span class="op" id="5326267">,</span>&nbsp;<span class="ident" id="5326269">dst</span><span class="op" id="5326272">.</span><span class="ident" id="5326273">Rune</span><span class="op" id="5326277">[</span><span class="num" id="5326278">0</span><span class="op" id="5326279">]</span><span class="op" id="5326280">,</span>&nbsp;<span class="ident" id="5326282">dst</span><span class="op" id="5326285">.</span><span class="ident" id="5326286">Flags</span><span class="op" id="5326291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326295">dst</span><span class="op" id="5326298">.</span><span class="ident" id="5326299">Rune</span>&nbsp;<span class="op" id="5326304">=</span>&nbsp;<span class="ident" id="5326306">appendLiteral</span><span class="op" id="5326319">(</span><span class="ident" id="5326320">dst</span><span class="op" id="5326323">.</span><span class="ident" id="5326324">Rune</span><span class="op" id="5326328">,</span>&nbsp;<span class="ident" id="5326330">src</span><span class="op" id="5326333">.</span><span class="ident" id="5326334">Rune</span><span class="op" id="5326338">[</span><span class="num" id="5326339">0</span><span class="op" id="5326340">]</span><span class="op" id="5326341">,</span>&nbsp;<span class="ident" id="5326343">src</span><span class="op" id="5326346">.</span><span class="ident" id="5326347">Flags</span><span class="op" id="5326352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326355">}</span><br>
<span class="lineno">1155</span><span class="op" id="5326357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5326360">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5326430">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5326481">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5326512">func</span>&nbsp;<span class="op" id="5326517">(</span><span class="ident" id="5326518">p</span>&nbsp;<span class="op" id="5326520">*</span><span class="ident" id="5326521">parser</span><span class="op" id="5326527">)</span>&nbsp;<span class="ident" id="5326529">swapVerticalBar</span><span class="op" id="5326544">(</span><span class="op" id="5326545">)</span>&nbsp;<span class="builtintype" id="5326547">bool</span>&nbsp;<span class="op" id="5326552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5326555">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5326618">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326658">n</span>&nbsp;<span class="op" id="5326660">:=</span>&nbsp;<span class="builtinfunc" id="5326663">len</span><span class="op" id="5326666">(</span><span class="ident" id="5326667">p</span><span class="op" id="5326668">.</span><span class="ident" id="5326669">stack</span><span class="op" id="5326674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326677">if</span>&nbsp;<span class="ident" id="5326680">n</span>&nbsp;<span class="op" id="5326682">&gt;=</span>&nbsp;<span class="num" id="5326685">3</span>&nbsp;<span class="op" id="5326687">&amp;&amp;</span>&nbsp;<span class="ident" id="5326690">p</span><span class="op" id="5326691">.</span><span class="ident" id="5326692">stack</span><span class="op" id="5326697">[</span><span class="ident" id="5326698">n</span><span class="op" id="5326699">-</span><span class="num" id="5326700">2</span><span class="op" id="5326701">]</span><span class="op" id="5326702">.</span><span class="ident" id="5326703">Op</span>&nbsp;<span class="op" id="5326706">==</span>&nbsp;<span class="ident" id="5326709">opVerticalBar</span>&nbsp;<span class="op" id="5326723">&amp;&amp;</span>&nbsp;<span class="ident" id="5326726">isCharClass</span><span class="op" id="5326737">(</span><span class="ident" id="5326738">p</span><span class="op" id="5326739">.</span><span class="ident" id="5326740">stack</span><span class="op" id="5326745">[</span><span class="ident" id="5326746">n</span><span class="op" id="5326747">-</span><span class="num" id="5326748">1</span><span class="op" id="5326749">]</span><span class="op" id="5326750">)</span>&nbsp;<span class="op" id="5326752">&amp;&amp;</span>&nbsp;<span class="ident" id="5326755">isCharClass</span><span class="op" id="5326766">(</span><span class="ident" id="5326767">p</span><span class="op" id="5326768">.</span><span class="ident" id="5326769">stack</span><span class="op" id="5326774">[</span><span class="ident" id="5326775">n</span><span class="op" id="5326776">-</span><span class="num" id="5326777">3</span><span class="op" id="5326778">]</span><span class="op" id="5326779">)</span>&nbsp;<span class="op" id="5326781">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326785">re1</span>&nbsp;<span class="op" id="5326789">:=</span>&nbsp;<span class="ident" id="5326792">p</span><span class="op" id="5326793">.</span><span class="ident" id="5326794">stack</span><span class="op" id="5326799">[</span><span class="ident" id="5326800">n</span><span class="op" id="5326801">-</span><span class="num" id="5326802">1</span><span class="op" id="5326803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326807">re3</span>&nbsp;<span class="op" id="5326811">:=</span>&nbsp;<span class="ident" id="5326814">p</span><span class="op" id="5326815">.</span><span class="ident" id="5326816">stack</span><span class="op" id="5326821">[</span><span class="ident" id="5326822">n</span><span class="op" id="5326823">-</span><span class="num" id="5326824">3</span><span class="op" id="5326825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5326829">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326872">if</span>&nbsp;<span class="ident" id="5326875">re1</span><span class="op" id="5326878">.</span><span class="ident" id="5326879">Op</span>&nbsp;<span class="op" id="5326882">&gt;</span>&nbsp;<span class="ident" id="5326884">re3</span><span class="op" id="5326887">.</span><span class="ident" id="5326888">Op</span>&nbsp;<span class="op" id="5326891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326896">re1</span><span class="op" id="5326899">,</span>&nbsp;<span class="ident" id="5326901">re3</span>&nbsp;<span class="op" id="5326905">=</span>&nbsp;<span class="ident" id="5326907">re3</span><span class="op" id="5326910">,</span>&nbsp;<span class="ident" id="5326912">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326919">p</span><span class="op" id="5326920">.</span><span class="ident" id="5326921">stack</span><span class="op" id="5326926">[</span><span class="ident" id="5326927">n</span><span class="op" id="5326928">-</span><span class="num" id="5326929">3</span><span class="op" id="5326930">]</span>&nbsp;<span class="op" id="5326932">=</span>&nbsp;<span class="ident" id="5326934">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326944">mergeCharClass</span><span class="op" id="5326958">(</span><span class="ident" id="5326959">re3</span><span class="op" id="5326962">,</span>&nbsp;<span class="ident" id="5326964">re1</span><span class="op" id="5326967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326971">p</span><span class="op" id="5326972">.</span><span class="ident" id="5326973">reuse</span><span class="op" id="5326978">(</span><span class="ident" id="5326979">re1</span><span class="op" id="5326982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326986">p</span><span class="op" id="5326987">.</span><span class="ident" id="5326988">stack</span>&nbsp;<span class="op" id="5326994">=</span>&nbsp;<span class="ident" id="5326996">p</span><span class="op" id="5326997">.</span><span class="ident" id="5326998">stack</span><span class="op" id="5327003">[</span><span class="op" id="5327004">:</span><span class="ident" id="5327005">n</span><span class="op" id="5327006">-</span><span class="num" id="5327007">1</span><span class="op" id="5327008">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327012">return</span>&nbsp;<span class="builtintype" id="5327019">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327029">if</span>&nbsp;<span class="ident" id="5327032">n</span>&nbsp;<span class="op" id="5327034">&gt;=</span>&nbsp;<span class="num" id="5327037">2</span>&nbsp;<span class="op" id="5327039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327043">re1</span>&nbsp;<span class="op" id="5327047">:=</span>&nbsp;<span class="ident" id="5327050">p</span><span class="op" id="5327051">.</span><span class="ident" id="5327052">stack</span><span class="op" id="5327057">[</span><span class="ident" id="5327058">n</span><span class="op" id="5327059">-</span><span class="num" id="5327060">1</span><span class="op" id="5327061">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327065">re2</span>&nbsp;<span class="op" id="5327069">:=</span>&nbsp;<span class="ident" id="5327072">p</span><span class="op" id="5327073">.</span><span class="ident" id="5327074">stack</span><span class="op" id="5327079">[</span><span class="ident" id="5327080">n</span><span class="op" id="5327081">-</span><span class="num" id="5327082">2</span><span class="op" id="5327083">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327087">if</span>&nbsp;<span class="ident" id="5327090">re2</span><span class="op" id="5327093">.</span><span class="ident" id="5327094">Op</span>&nbsp;<span class="op" id="5327097">==</span>&nbsp;<span class="ident" id="5327100">opVerticalBar</span>&nbsp;<span class="op" id="5327114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327119">if</span>&nbsp;<span class="ident" id="5327122">n</span>&nbsp;<span class="op" id="5327124">&gt;=</span>&nbsp;<span class="num" id="5327127">3</span>&nbsp;<span class="op" id="5327129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5327135">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5327160">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327192">cleanAlt</span><span class="op" id="5327200">(</span><span class="ident" id="5327201">p</span><span class="op" id="5327202">.</span><span class="ident" id="5327203">stack</span><span class="op" id="5327208">[</span><span class="ident" id="5327209">n</span><span class="op" id="5327210">-</span><span class="num" id="5327211">3</span><span class="op" id="5327212">]</span><span class="op" id="5327213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327223">p</span><span class="op" id="5327224">.</span><span class="ident" id="5327225">stack</span><span class="op" id="5327230">[</span><span class="ident" id="5327231">n</span><span class="op" id="5327232">-</span><span class="num" id="5327233">2</span><span class="op" id="5327234">]</span>&nbsp;<span class="op" id="5327236">=</span>&nbsp;<span class="ident" id="5327238">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327245">p</span><span class="op" id="5327246">.</span><span class="ident" id="5327247">stack</span><span class="op" id="5327252">[</span><span class="ident" id="5327253">n</span><span class="op" id="5327254">-</span><span class="num" id="5327255">1</span><span class="op" id="5327256">]</span>&nbsp;<span class="op" id="5327258">=</span>&nbsp;<span class="ident" id="5327260">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327267">return</span>&nbsp;<span class="builtintype" id="5327274">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327287">return</span>&nbsp;<span class="builtintype" id="5327294">false</span><br>
<span class="lineno"></span><span class="op" id="5327300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5327303">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5327348">func</span>&nbsp;<span class="op" id="5327353">(</span><span class="ident" id="5327354">p</span>&nbsp;<span class="op" id="5327356">*</span><span class="ident" id="5327357">parser</span><span class="op" id="5327363">)</span>&nbsp;<span class="ident" id="5327365">parseRightParen</span><span class="op" id="5327380">(</span><span class="op" id="5327381">)</span>&nbsp;<span class="builtintype" id="5327383">error</span>&nbsp;<span class="op" id="5327389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327392">p</span><span class="op" id="5327393">.</span><span class="ident" id="5327394">concat</span><span class="op" id="5327400">(</span><span class="op" id="5327401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327404">if</span>&nbsp;<span class="ident" id="5327407">p</span><span class="op" id="5327408">.</span><span class="ident" id="5327409">swapVerticalBar</span><span class="op" id="5327424">(</span><span class="op" id="5327425">)</span>&nbsp;<span class="op" id="5327427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5327431">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327453">p</span><span class="op" id="5327454">.</span><span class="ident" id="5327455">stack</span>&nbsp;<span class="op" id="5327461">=</span>&nbsp;<span class="ident" id="5327463">p</span><span class="op" id="5327464">.</span><span class="ident" id="5327465">stack</span><span class="op" id="5327470">[</span><span class="op" id="5327471">:</span><span class="builtinfunc" id="5327472">len</span><span class="op" id="5327475">(</span><span class="ident" id="5327476">p</span><span class="op" id="5327477">.</span><span class="ident" id="5327478">stack</span><span class="op" id="5327483">)</span><span class="op" id="5327484">-</span><span class="num" id="5327485">1</span><span class="op" id="5327486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327492">p</span><span class="op" id="5327493">.</span><span class="ident" id="5327494">alternate</span><span class="op" id="5327503">(</span><span class="op" id="5327504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327508">n</span>&nbsp;<span class="op" id="5327510">:=</span>&nbsp;<span class="builtinfunc" id="5327513">len</span><span class="op" id="5327516">(</span><span class="ident" id="5327517">p</span><span class="op" id="5327518">.</span><span class="ident" id="5327519">stack</span><span class="op" id="5327524">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327527">if</span>&nbsp;<span class="ident" id="5327530">n</span>&nbsp;<span class="op" id="5327532">&lt;</span>&nbsp;<span class="num" id="5327534">2</span>&nbsp;<span class="op" id="5327536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327540">return</span>&nbsp;<span class="op" id="5327547">&amp;</span><span class="ident" id="5327548">Error</span><span class="op" id="5327553">{</span><span class="ident" id="5327554">ErrUnexpectedParen</span><span class="op" id="5327572">,</span>&nbsp;<span class="ident" id="5327574">p</span><span class="op" id="5327575">.</span><span class="ident" id="5327576">wholeRegexp</span><span class="op" id="5327587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327593">re1</span>&nbsp;<span class="op" id="5327597">:=</span>&nbsp;<span class="ident" id="5327600">p</span><span class="op" id="5327601">.</span><span class="ident" id="5327602">stack</span><span class="op" id="5327607">[</span><span class="ident" id="5327608">n</span><span class="op" id="5327609">-</span><span class="num" id="5327610">1</span><span class="op" id="5327611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327614">re2</span>&nbsp;<span class="op" id="5327618">:=</span>&nbsp;<span class="ident" id="5327621">p</span><span class="op" id="5327622">.</span><span class="ident" id="5327623">stack</span><span class="op" id="5327628">[</span><span class="ident" id="5327629">n</span><span class="op" id="5327630">-</span><span class="num" id="5327631">2</span><span class="op" id="5327632">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327635">p</span><span class="op" id="5327636">.</span><span class="ident" id="5327637">stack</span>&nbsp;<span class="op" id="5327643">=</span>&nbsp;<span class="ident" id="5327645">p</span><span class="op" id="5327646">.</span><span class="ident" id="5327647">stack</span><span class="op" id="5327652">[</span><span class="op" id="5327653">:</span><span class="ident" id="5327654">n</span><span class="op" id="5327655">-</span><span class="num" id="5327656">2</span><span class="op" id="5327657">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327660">if</span>&nbsp;<span class="ident" id="5327663">re2</span><span class="op" id="5327666">.</span><span class="ident" id="5327667">Op</span>&nbsp;<span class="op" id="5327670">!=</span>&nbsp;<span class="ident" id="5327673">opLeftParen</span>&nbsp;<span class="op" id="5327685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327689">return</span>&nbsp;<span class="op" id="5327696">&amp;</span><span class="ident" id="5327697">Error</span><span class="op" id="5327702">{</span><span class="ident" id="5327703">ErrUnexpectedParen</span><span class="op" id="5327721">,</span>&nbsp;<span class="ident" id="5327723">p</span><span class="op" id="5327724">.</span><span class="ident" id="5327725">wholeRegexp</span><span class="op" id="5327736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5327742">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327778">p</span><span class="op" id="5327779">.</span><span class="ident" id="5327780">flags</span>&nbsp;<span class="op" id="5327786">=</span>&nbsp;<span class="ident" id="5327788">re2</span><span class="op" id="5327791">.</span><span class="ident" id="5327792">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327799">if</span>&nbsp;<span class="ident" id="5327802">re2</span><span class="op" id="5327805">.</span><span class="ident" id="5327806">Cap</span>&nbsp;<span class="op" id="5327810">==</span>&nbsp;<span class="num" id="5327813">0</span>&nbsp;<span class="op" id="5327815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5327819">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327843">p</span><span class="op" id="5327844">.</span><span class="ident" id="5327845">push</span><span class="op" id="5327849">(</span><span class="ident" id="5327850">re1</span><span class="op" id="5327853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327856">}</span>&nbsp;<span class="keyword" id="5327858">else</span>&nbsp;<span class="op" id="5327863">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327867">re2</span><span class="op" id="5327870">.</span><span class="ident" id="5327871">Op</span>&nbsp;<span class="op" id="5327874">=</span>&nbsp;<span class="ident" id="5327876">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327888">re2</span><span class="op" id="5327891">.</span><span class="ident" id="5327892">Sub</span>&nbsp;<span class="op" id="5327896">=</span>&nbsp;<span class="ident" id="5327898">re2</span><span class="op" id="5327901">.</span><span class="ident" id="5327902">Sub0</span><span class="op" id="5327906">[</span><span class="op" id="5327907">:</span><span class="num" id="5327908">1</span><span class="op" id="5327909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327913">re2</span><span class="op" id="5327916">.</span><span class="ident" id="5327917">Sub</span><span class="op" id="5327920">[</span><span class="num" id="5327921">0</span><span class="op" id="5327922">]</span>&nbsp;<span class="op" id="5327924">=</span>&nbsp;<span class="ident" id="5327926">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5327932">p</span><span class="op" id="5327933">.</span><span class="ident" id="5327934">push</span><span class="op" id="5327938">(</span><span class="ident" id="5327939">re2</span><span class="op" id="5327942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5327945">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5327948">return</span>&nbsp;<span class="ident" id="5327955">nil</span><br>
<span class="lineno"></span><span class="op" id="5327959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5327962">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5328025">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5328050">func</span>&nbsp;<span class="op" id="5328055">(</span><span class="ident" id="5328056">p</span>&nbsp;<span class="op" id="5328058">*</span><span class="ident" id="5328059">parser</span><span class="op" id="5328065">)</span>&nbsp;<span class="ident" id="5328067">parseEscape</span><span class="op" id="5328078">(</span><span class="ident" id="5328079">s</span>&nbsp;<span class="builtintype" id="5328081">string</span><span class="op" id="5328087">)</span>&nbsp;<span class="op" id="5328089">(</span><span class="ident" id="5328090">r</span>&nbsp;<span class="builtintype" id="5328092">rune</span><span class="op" id="5328096">,</span>&nbsp;<span class="ident" id="5328098">rest</span>&nbsp;<span class="builtintype" id="5328103">string</span><span class="op" id="5328109">,</span>&nbsp;<span class="ident" id="5328111">err</span>&nbsp;<span class="builtintype" id="5328115">error</span><span class="op" id="5328120">)</span>&nbsp;<span class="op" id="5328122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5328125">t</span>&nbsp;<span class="op" id="5328127">:=</span>&nbsp;<span class="ident" id="5328130">s</span><span class="op" id="5328131">[</span><span class="num" id="5328132">1</span><span class="op" id="5328133">:</span><span class="op" id="5328134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328137">if</span>&nbsp;<span class="ident" id="5328140">t</span>&nbsp;<span class="op" id="5328142">==</span>&nbsp;<span class="string" id="5328145">&#34;&#34;</span>&nbsp;<span class="op" id="5328148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328152">return</span>&nbsp;<span class="num" id="5328159">0</span><span class="op" id="5328160">,</span>&nbsp;<span class="string" id="5328162">&#34;&#34;</span><span class="op" id="5328164">,</span>&nbsp;<span class="op" id="5328166">&amp;</span><span class="ident" id="5328167">Error</span><span class="op" id="5328172">{</span><span class="ident" id="5328173">ErrTrailingBackslash</span><span class="op" id="5328193">,</span>&nbsp;<span class="string" id="5328195">&#34;&#34;</span><span class="op" id="5328197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5328200">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5328203">c</span><span class="op" id="5328204">,</span>&nbsp;<span class="ident" id="5328206">t</span><span class="op" id="5328207">,</span>&nbsp;<span class="ident" id="5328209">err</span>&nbsp;<span class="op" id="5328213">:=</span>&nbsp;<span class="ident" id="5328216">nextRune</span><span class="op" id="5328224">(</span><span class="ident" id="5328225">t</span><span class="op" id="5328226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328229">if</span>&nbsp;<span class="ident" id="5328232">err</span>&nbsp;<span class="op" id="5328236">!=</span>&nbsp;<span class="ident" id="5328239">nil</span>&nbsp;<span class="op" id="5328243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328247">return</span>&nbsp;<span class="num" id="5328254">0</span><span class="op" id="5328255">,</span>&nbsp;<span class="string" id="5328257">&#34;&#34;</span><span class="op" id="5328259">,</span>&nbsp;<span class="ident" id="5328261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5328266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5328269">Switch</span><span class="op" id="5328275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328278">switch</span>&nbsp;<span class="ident" id="5328285">c</span>&nbsp;<span class="op" id="5328287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328290">default</span><span class="op" id="5328297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328301">if</span>&nbsp;<span class="ident" id="5328304">c</span>&nbsp;<span class="op" id="5328306">&lt;</span>&nbsp;<span class="ident" id="5328308">utf8</span><span class="op" id="5328312">.</span><span class="ident" id="5328313">RuneSelf</span>&nbsp;<span class="op" id="5328322">&amp;&amp;</span>&nbsp;<span class="op" id="5328325">!</span><span class="ident" id="5328326">isalnum</span><span class="op" id="5328333">(</span><span class="ident" id="5328334">c</span><span class="op" id="5328335">)</span>&nbsp;<span class="op" id="5328337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328342">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328399">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328459">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328518">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328577">return</span>&nbsp;<span class="ident" id="5328584">c</span><span class="op" id="5328585">,</span>&nbsp;<span class="ident" id="5328587">t</span><span class="op" id="5328588">,</span>&nbsp;<span class="ident" id="5328590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5328596">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328600">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328619">case</span>&nbsp;<span class="string" id="5328624">&#39;1&#39;</span><span class="op" id="5328627">,</span>&nbsp;<span class="string" id="5328629">&#39;2&#39;</span><span class="op" id="5328632">,</span>&nbsp;<span class="string" id="5328634">&#39;3&#39;</span><span class="op" id="5328637">,</span>&nbsp;<span class="string" id="5328639">&#39;4&#39;</span><span class="op" id="5328642">,</span>&nbsp;<span class="string" id="5328644">&#39;5&#39;</span><span class="op" id="5328647">,</span>&nbsp;<span class="string" id="5328649">&#39;6&#39;</span><span class="op" id="5328652">,</span>&nbsp;<span class="string" id="5328654">&#39;7&#39;</span><span class="op" id="5328657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328661">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328722">if</span>&nbsp;<span class="ident" id="5328725">t</span>&nbsp;<span class="op" id="5328727">==</span>&nbsp;<span class="string" id="5328730">&#34;&#34;</span>&nbsp;<span class="op" id="5328733">||</span>&nbsp;<span class="ident" id="5328736">t</span><span class="op" id="5328737">[</span><span class="num" id="5328738">0</span><span class="op" id="5328739">]</span>&nbsp;<span class="op" id="5328741">&lt;</span>&nbsp;<span class="string" id="5328743">&#39;0&#39;</span>&nbsp;<span class="op" id="5328747">||</span>&nbsp;<span class="ident" id="5328750">t</span><span class="op" id="5328751">[</span><span class="num" id="5328752">0</span><span class="op" id="5328753">]</span>&nbsp;<span class="op" id="5328755">&gt;</span>&nbsp;<span class="string" id="5328757">&#39;7&#39;</span>&nbsp;<span class="op" id="5328761">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328766">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5328774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328778">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328791">case</span>&nbsp;<span class="string" id="5328796">&#39;0&#39;</span><span class="op" id="5328799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5328803">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5328860">r</span>&nbsp;<span class="op" id="5328862">=</span>&nbsp;<span class="ident" id="5328864">c</span>&nbsp;<span class="op" id="5328866">-</span>&nbsp;<span class="string" id="5328868">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328874">for</span>&nbsp;<span class="ident" id="5328878">i</span>&nbsp;<span class="op" id="5328880">:=</span>&nbsp;<span class="num" id="5328883">1</span><span class="op" id="5328884">;</span>&nbsp;<span class="ident" id="5328886">i</span>&nbsp;<span class="op" id="5328888">&lt;</span>&nbsp;<span class="num" id="5328890">3</span><span class="op" id="5328891">;</span>&nbsp;<span class="ident" id="5328893">i</span><span class="op" id="5328894">++</span>&nbsp;<span class="op" id="5328897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328902">if</span>&nbsp;<span class="ident" id="5328905">t</span>&nbsp;<span class="op" id="5328907">==</span>&nbsp;<span class="string" id="5328910">&#34;&#34;</span>&nbsp;<span class="op" id="5328913">||</span>&nbsp;<span class="ident" id="5328916">t</span><span class="op" id="5328917">[</span><span class="num" id="5328918">0</span><span class="op" id="5328919">]</span>&nbsp;<span class="op" id="5328921">&lt;</span>&nbsp;<span class="string" id="5328923">&#39;0&#39;</span>&nbsp;<span class="op" id="5328927">||</span>&nbsp;<span class="ident" id="5328930">t</span><span class="op" id="5328931">[</span><span class="num" id="5328932">0</span><span class="op" id="5328933">]</span>&nbsp;<span class="op" id="5328935">&gt;</span>&nbsp;<span class="string" id="5328937">&#39;7&#39;</span>&nbsp;<span class="op" id="5328941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5328947">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5328956">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5328961">r</span>&nbsp;<span class="op" id="5328963">=</span>&nbsp;<span class="ident" id="5328965">r</span><span class="op" id="5328966">*</span><span class="num" id="5328967">8</span>&nbsp;<span class="op" id="5328969">+</span>&nbsp;<span class="builtintype" id="5328971">rune</span><span class="op" id="5328975">(</span><span class="ident" id="5328976">t</span><span class="op" id="5328977">[</span><span class="num" id="5328978">0</span><span class="op" id="5328979">]</span><span class="op" id="5328980">)</span>&nbsp;<span class="op" id="5328982">-</span>&nbsp;<span class="string" id="5328984">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5328991">t</span>&nbsp;<span class="op" id="5328993">=</span>&nbsp;<span class="ident" id="5328995">t</span><span class="op" id="5328996">[</span><span class="num" id="5328997">1</span><span class="op" id="5328998">:</span><span class="op" id="5328999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329007">return</span>&nbsp;<span class="ident" id="5329014">r</span><span class="op" id="5329015">,</span>&nbsp;<span class="ident" id="5329017">t</span><span class="op" id="5329018">,</span>&nbsp;<span class="ident" id="5329020">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329026">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329051">case</span>&nbsp;<span class="string" id="5329056">&#39;x&#39;</span><span class="op" id="5329059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329063">if</span>&nbsp;<span class="ident" id="5329066">t</span>&nbsp;<span class="op" id="5329068">==</span>&nbsp;<span class="string" id="5329071">&#34;&#34;</span>&nbsp;<span class="op" id="5329074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329079">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329087">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329091">if</span>&nbsp;<span class="ident" id="5329094">c</span><span class="op" id="5329095">,</span>&nbsp;<span class="ident" id="5329097">t</span><span class="op" id="5329098">,</span>&nbsp;<span class="ident" id="5329100">err</span>&nbsp;<span class="op" id="5329104">=</span>&nbsp;<span class="ident" id="5329106">nextRune</span><span class="op" id="5329114">(</span><span class="ident" id="5329115">t</span><span class="op" id="5329116">)</span><span class="op" id="5329117">;</span>&nbsp;<span class="ident" id="5329119">err</span>&nbsp;<span class="op" id="5329123">!=</span>&nbsp;<span class="ident" id="5329126">nil</span>&nbsp;<span class="op" id="5329130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329135">return</span>&nbsp;<span class="num" id="5329142">0</span><span class="op" id="5329143">,</span>&nbsp;<span class="string" id="5329145">&#34;&#34;</span><span class="op" id="5329147">,</span>&nbsp;<span class="ident" id="5329149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329159">if</span>&nbsp;<span class="ident" id="5329162">c</span>&nbsp;<span class="op" id="5329164">==</span>&nbsp;<span class="string" id="5329167">&#39;{&#39;</span>&nbsp;<span class="op" id="5329171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329176">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329214">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329270">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329336">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329360">nhex</span>&nbsp;<span class="op" id="5329365">:=</span>&nbsp;<span class="num" id="5329368">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329373">r</span>&nbsp;<span class="op" id="5329375">=</span>&nbsp;<span class="num" id="5329377">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329382">for</span>&nbsp;<span class="op" id="5329386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329392">if</span>&nbsp;<span class="ident" id="5329395">t</span>&nbsp;<span class="op" id="5329397">==</span>&nbsp;<span class="string" id="5329400">&#34;&#34;</span>&nbsp;<span class="op" id="5329403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329410">break</span>&nbsp;<span class="ident" id="5329416">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329433">if</span>&nbsp;<span class="ident" id="5329436">c</span><span class="op" id="5329437">,</span>&nbsp;<span class="ident" id="5329439">t</span><span class="op" id="5329440">,</span>&nbsp;<span class="ident" id="5329442">err</span>&nbsp;<span class="op" id="5329446">=</span>&nbsp;<span class="ident" id="5329448">nextRune</span><span class="op" id="5329456">(</span><span class="ident" id="5329457">t</span><span class="op" id="5329458">)</span><span class="op" id="5329459">;</span>&nbsp;<span class="ident" id="5329461">err</span>&nbsp;<span class="op" id="5329465">!=</span>&nbsp;<span class="ident" id="5329468">nil</span>&nbsp;<span class="op" id="5329472">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329479">return</span>&nbsp;<span class="num" id="5329486">0</span><span class="op" id="5329487">,</span>&nbsp;<span class="string" id="5329489">&#34;&#34;</span><span class="op" id="5329491">,</span>&nbsp;<span class="ident" id="5329493">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329507">if</span>&nbsp;<span class="ident" id="5329510">c</span>&nbsp;<span class="op" id="5329512">==</span>&nbsp;<span class="string" id="5329515">&#39;}&#39;</span>&nbsp;<span class="op" id="5329519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329526">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329536">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329542">v</span>&nbsp;<span class="op" id="5329544">:=</span>&nbsp;<span class="ident" id="5329547">unhex</span><span class="op" id="5329552">(</span><span class="ident" id="5329553">c</span><span class="op" id="5329554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329560">if</span>&nbsp;<span class="ident" id="5329563">v</span>&nbsp;<span class="op" id="5329565">&lt;</span>&nbsp;<span class="num" id="5329567">0</span>&nbsp;<span class="op" id="5329569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329576">break</span>&nbsp;<span class="ident" id="5329582">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329599">r</span>&nbsp;<span class="op" id="5329601">=</span>&nbsp;<span class="ident" id="5329603">r</span><span class="op" id="5329604">*</span><span class="num" id="5329605">16</span>&nbsp;<span class="op" id="5329608">+</span>&nbsp;<span class="ident" id="5329610">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329616">if</span>&nbsp;<span class="ident" id="5329619">r</span>&nbsp;<span class="op" id="5329621">&gt;</span>&nbsp;<span class="ident" id="5329623">unicode</span><span class="op" id="5329630">.</span><span class="ident" id="5329631">MaxRune</span>&nbsp;<span class="op" id="5329639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329646">break</span>&nbsp;<span class="ident" id="5329652">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329669">nhex</span><span class="op" id="5329673">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329679">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329684">if</span>&nbsp;<span class="ident" id="5329687">nhex</span>&nbsp;<span class="op" id="5329692">==</span>&nbsp;<span class="num" id="5329695">0</span>&nbsp;<span class="op" id="5329697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329703">break</span>&nbsp;<span class="ident" id="5329709">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329724">return</span>&nbsp;<span class="ident" id="5329731">r</span><span class="op" id="5329732">,</span>&nbsp;<span class="ident" id="5329734">t</span><span class="op" id="5329735">,</span>&nbsp;<span class="ident" id="5329737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329743">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329748">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329780">x</span>&nbsp;<span class="op" id="5329782">:=</span>&nbsp;<span class="ident" id="5329785">unhex</span><span class="op" id="5329790">(</span><span class="ident" id="5329791">c</span><span class="op" id="5329792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329796">if</span>&nbsp;<span class="ident" id="5329799">c</span><span class="op" id="5329800">,</span>&nbsp;<span class="ident" id="5329802">t</span><span class="op" id="5329803">,</span>&nbsp;<span class="ident" id="5329805">err</span>&nbsp;<span class="op" id="5329809">=</span>&nbsp;<span class="ident" id="5329811">nextRune</span><span class="op" id="5329819">(</span><span class="ident" id="5329820">t</span><span class="op" id="5329821">)</span><span class="op" id="5329822">;</span>&nbsp;<span class="ident" id="5329824">err</span>&nbsp;<span class="op" id="5329828">!=</span>&nbsp;<span class="ident" id="5329831">nil</span>&nbsp;<span class="op" id="5329835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329840">return</span>&nbsp;<span class="num" id="5329847">0</span><span class="op" id="5329848">,</span>&nbsp;<span class="string" id="5329850">&#34;&#34;</span><span class="op" id="5329852">,</span>&nbsp;<span class="ident" id="5329854">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5329864">y</span>&nbsp;<span class="op" id="5329866">:=</span>&nbsp;<span class="ident" id="5329869">unhex</span><span class="op" id="5329874">(</span><span class="ident" id="5329875">c</span><span class="op" id="5329876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329880">if</span>&nbsp;<span class="ident" id="5329883">x</span>&nbsp;<span class="op" id="5329885">&lt;</span>&nbsp;<span class="num" id="5329887">0</span>&nbsp;<span class="op" id="5329889">||</span>&nbsp;<span class="ident" id="5329892">y</span>&nbsp;<span class="op" id="5329894">&lt;</span>&nbsp;<span class="num" id="5329896">0</span>&nbsp;<span class="op" id="5329898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329903">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5329911">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5329915">return</span>&nbsp;<span class="ident" id="5329922">x</span><span class="op" id="5329923">*</span><span class="num" id="5329924">16</span>&nbsp;<span class="op" id="5329927">+</span>&nbsp;<span class="ident" id="5329929">y</span><span class="op" id="5329930">,</span>&nbsp;<span class="ident" id="5329932">t</span><span class="op" id="5329933">,</span>&nbsp;<span class="ident" id="5329935">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329941">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5329999">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330051">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330110">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330166">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330221">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330248">case</span>&nbsp;<span class="string" id="5330253">&#39;a&#39;</span><span class="op" id="5330256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330260">return</span>&nbsp;<span class="string" id="5330267">&#39;\a&#39;</span><span class="op" id="5330271">,</span>&nbsp;<span class="ident" id="5330273">t</span><span class="op" id="5330274">,</span>&nbsp;<span class="ident" id="5330276">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330281">case</span>&nbsp;<span class="string" id="5330286">&#39;f&#39;</span><span class="op" id="5330289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330293">return</span>&nbsp;<span class="string" id="5330300">&#39;\f&#39;</span><span class="op" id="5330304">,</span>&nbsp;<span class="ident" id="5330306">t</span><span class="op" id="5330307">,</span>&nbsp;<span class="ident" id="5330309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330314">case</span>&nbsp;<span class="string" id="5330319">&#39;n&#39;</span><span class="op" id="5330322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330326">return</span>&nbsp;<span class="string" id="5330333">&#39;\n&#39;</span><span class="op" id="5330337">,</span>&nbsp;<span class="ident" id="5330339">t</span><span class="op" id="5330340">,</span>&nbsp;<span class="ident" id="5330342">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330347">case</span>&nbsp;<span class="string" id="5330352">&#39;r&#39;</span><span class="op" id="5330355">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330359">return</span>&nbsp;<span class="string" id="5330366">&#39;\r&#39;</span><span class="op" id="5330370">,</span>&nbsp;<span class="ident" id="5330372">t</span><span class="op" id="5330373">,</span>&nbsp;<span class="ident" id="5330375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330380">case</span>&nbsp;<span class="string" id="5330385">&#39;t&#39;</span><span class="op" id="5330388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330392">return</span>&nbsp;<span class="string" id="5330399">&#39;\t&#39;</span><span class="op" id="5330403">,</span>&nbsp;<span class="ident" id="5330405">t</span><span class="op" id="5330406">,</span>&nbsp;<span class="ident" id="5330408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330413">case</span>&nbsp;<span class="string" id="5330418">&#39;v&#39;</span><span class="op" id="5330421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330425">return</span>&nbsp;<span class="string" id="5330432">&#39;\v&#39;</span><span class="op" id="5330436">,</span>&nbsp;<span class="ident" id="5330438">t</span><span class="op" id="5330439">,</span>&nbsp;<span class="ident" id="5330441">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5330446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330449">return</span>&nbsp;<span class="num" id="5330456">0</span><span class="op" id="5330457">,</span>&nbsp;<span class="string" id="5330459">&#34;&#34;</span><span class="op" id="5330461">,</span>&nbsp;<span class="op" id="5330463">&amp;</span><span class="ident" id="5330464">Error</span><span class="op" id="5330469">{</span><span class="ident" id="5330470">ErrInvalidEscape</span><span class="op" id="5330486">,</span>&nbsp;<span class="ident" id="5330488">s</span><span class="op" id="5330489">[</span><span class="op" id="5330490">:</span><span class="builtinfunc" id="5330491">len</span><span class="op" id="5330494">(</span><span class="ident" id="5330495">s</span><span class="op" id="5330496">)</span><span class="op" id="5330497">-</span><span class="builtinfunc" id="5330498">len</span><span class="op" id="5330501">(</span><span class="ident" id="5330502">t</span><span class="op" id="5330503">)</span><span class="op" id="5330504">]</span><span class="op" id="5330505">}</span><br>
<span class="lineno"></span><span class="op" id="5330507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5330510">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5330585">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5330604">func</span>&nbsp;<span class="op" id="5330609">(</span><span class="ident" id="5330610">p</span>&nbsp;<span class="op" id="5330612">*</span><span class="ident" id="5330613">parser</span><span class="op" id="5330619">)</span>&nbsp;<span class="ident" id="5330621">parseClassChar</span><span class="op" id="5330635">(</span><span class="ident" id="5330636">s</span><span class="op" id="5330637">,</span>&nbsp;<span class="ident" id="5330639">wholeClass</span>&nbsp;<span class="builtintype" id="5330650">string</span><span class="op" id="5330656">)</span>&nbsp;<span class="op" id="5330658">(</span><span class="ident" id="5330659">r</span>&nbsp;<span class="builtintype" id="5330661">rune</span><span class="op" id="5330665">,</span>&nbsp;<span class="ident" id="5330667">rest</span>&nbsp;<span class="builtintype" id="5330672">string</span><span class="op" id="5330678">,</span>&nbsp;<span class="ident" id="5330680">err</span>&nbsp;<span class="builtintype" id="5330684">error</span><span class="op" id="5330689">)</span>&nbsp;<span class="op" id="5330691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330694">if</span>&nbsp;<span class="ident" id="5330697">s</span>&nbsp;<span class="op" id="5330699">==</span>&nbsp;<span class="string" id="5330702">&#34;&#34;</span>&nbsp;<span class="op" id="5330705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330709">return</span>&nbsp;<span class="num" id="5330716">0</span><span class="op" id="5330717">,</span>&nbsp;<span class="string" id="5330719">&#34;&#34;</span><span class="op" id="5330721">,</span>&nbsp;<span class="op" id="5330723">&amp;</span><span class="ident" id="5330724">Error</span><span class="op" id="5330729">{</span><span class="ident" id="5330730">Code</span><span class="op" id="5330734">:</span>&nbsp;<span class="ident" id="5330736">ErrMissingBracket</span><span class="op" id="5330753">,</span>&nbsp;<span class="ident" id="5330755">Expr</span><span class="op" id="5330759">:</span>&nbsp;<span class="ident" id="5330761">wholeClass</span><span class="op" id="5330771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5330774">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330778">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5330825">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330871">if</span>&nbsp;<span class="ident" id="5330874">s</span><span class="op" id="5330875">[</span><span class="num" id="5330876">0</span><span class="op" id="5330877">]</span>&nbsp;<span class="op" id="5330879">==</span>&nbsp;<span class="string" id="5330882">&#39;\\&#39;</span>&nbsp;<span class="op" id="5330887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330891">return</span>&nbsp;<span class="ident" id="5330898">p</span><span class="op" id="5330899">.</span><span class="ident" id="5330900">parseEscape</span><span class="op" id="5330911">(</span><span class="ident" id="5330912">s</span><span class="op" id="5330913">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5330916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5330920">return</span>&nbsp;<span class="ident" id="5330927">nextRune</span><span class="op" id="5330935">(</span><span class="ident" id="5330936">s</span><span class="op" id="5330937">)</span><br>
<span class="lineno"></span><span class="op" id="5330939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5330942">type</span>&nbsp;<span class="ident" id="5330947">charGroup</span>&nbsp;<span class="keyword" id="5330957">struct</span>&nbsp;<span class="op" id="5330964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5330967">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5330973">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5330978">class</span>&nbsp;<span class="op" id="5330984">[</span><span class="op" id="5330985">]</span><span class="builtintype" id="5330986">rune</span><br>
<span class="lineno"></span><span class="op" id="5330991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5330994">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5331071">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5331150">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5331214">func</span>&nbsp;<span class="op" id="5331219">(</span><span class="ident" id="5331220">p</span>&nbsp;<span class="op" id="5331222">*</span><span class="ident" id="5331223">parser</span><span class="op" id="5331229">)</span>&nbsp;<span class="ident" id="5331231">parsePerlClassEscape</span><span class="op" id="5331251">(</span><span class="ident" id="5331252">s</span>&nbsp;<span class="builtintype" id="5331254">string</span><span class="op" id="5331260">,</span>&nbsp;<span class="ident" id="5331262">r</span>&nbsp;<span class="op" id="5331264">[</span><span class="op" id="5331265">]</span><span class="builtintype" id="5331266">rune</span><span class="op" id="5331270">)</span>&nbsp;<span class="op" id="5331272">(</span><span class="ident" id="5331273">out</span>&nbsp;<span class="op" id="5331277">[</span><span class="op" id="5331278">]</span><span class="builtintype" id="5331279">rune</span><span class="op" id="5331283">,</span>&nbsp;<span class="ident" id="5331285">rest</span>&nbsp;<span class="builtintype" id="5331290">string</span><span class="op" id="5331296">)</span>&nbsp;<span class="op" id="5331298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331301">if</span>&nbsp;<span class="ident" id="5331304">p</span><span class="op" id="5331305">.</span><span class="ident" id="5331306">flags</span><span class="op" id="5331311">&amp;</span><span class="ident" id="5331312">PerlX</span>&nbsp;<span class="op" id="5331318">==</span>&nbsp;<span class="num" id="5331321">0</span>&nbsp;<span class="op" id="5331323">||</span>&nbsp;<span class="builtinfunc" id="5331326">len</span><span class="op" id="5331329">(</span><span class="ident" id="5331330">s</span><span class="op" id="5331331">)</span>&nbsp;<span class="op" id="5331333">&lt;</span>&nbsp;<span class="num" id="5331335">2</span>&nbsp;<span class="op" id="5331337">||</span>&nbsp;<span class="ident" id="5331340">s</span><span class="op" id="5331341">[</span><span class="num" id="5331342">0</span><span class="op" id="5331343">]</span>&nbsp;<span class="op" id="5331345">!=</span>&nbsp;<span class="string" id="5331348">&#39;\\&#39;</span>&nbsp;<span class="op" id="5331353">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331357">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5331365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5331368">g</span>&nbsp;<span class="op" id="5331370">:=</span>&nbsp;<span class="ident" id="5331373">perlGroup</span><span class="op" id="5331382">[</span><span class="ident" id="5331383">s</span><span class="op" id="5331384">[</span><span class="num" id="5331385">0</span><span class="op" id="5331386">:</span><span class="num" id="5331387">2</span><span class="op" id="5331388">]</span><span class="op" id="5331389">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331392">if</span>&nbsp;<span class="ident" id="5331395">g</span><span class="op" id="5331396">.</span><span class="ident" id="5331397">sign</span>&nbsp;<span class="op" id="5331402">==</span>&nbsp;<span class="num" id="5331405">0</span>&nbsp;<span class="op" id="5331407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331411">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5331419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331422">return</span>&nbsp;<span class="ident" id="5331429">p</span><span class="op" id="5331430">.</span><span class="ident" id="5331431">appendGroup</span><span class="op" id="5331442">(</span><span class="ident" id="5331443">r</span><span class="op" id="5331444">,</span>&nbsp;<span class="ident" id="5331446">g</span><span class="op" id="5331447">)</span><span class="op" id="5331448">,</span>&nbsp;<span class="ident" id="5331450">s</span><span class="op" id="5331451">[</span><span class="num" id="5331452">2</span><span class="op" id="5331453">:</span><span class="op" id="5331454">]</span><br>
<span class="lineno"></span><span class="op" id="5331456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5331459">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5331538">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5331617">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5331681">func</span>&nbsp;<span class="op" id="5331686">(</span><span class="ident" id="5331687">p</span>&nbsp;<span class="op" id="5331689">*</span><span class="ident" id="5331690">parser</span><span class="op" id="5331696">)</span>&nbsp;<span class="ident" id="5331698">parseNamedClass</span><span class="op" id="5331713">(</span><span class="ident" id="5331714">s</span>&nbsp;<span class="builtintype" id="5331716">string</span><span class="op" id="5331722">,</span>&nbsp;<span class="ident" id="5331724">r</span>&nbsp;<span class="op" id="5331726">[</span><span class="op" id="5331727">]</span><span class="builtintype" id="5331728">rune</span><span class="op" id="5331732">)</span>&nbsp;<span class="op" id="5331734">(</span><span class="ident" id="5331735">out</span>&nbsp;<span class="op" id="5331739">[</span><span class="op" id="5331740">]</span><span class="builtintype" id="5331741">rune</span><span class="op" id="5331745">,</span>&nbsp;<span class="ident" id="5331747">rest</span>&nbsp;<span class="builtintype" id="5331752">string</span><span class="op" id="5331758">,</span>&nbsp;<span class="ident" id="5331760">err</span>&nbsp;<span class="builtintype" id="5331764">error</span><span class="op" id="5331769">)</span>&nbsp;<span class="op" id="5331771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331774">if</span>&nbsp;<span class="builtinfunc" id="5331777">len</span><span class="op" id="5331780">(</span><span class="ident" id="5331781">s</span><span class="op" id="5331782">)</span>&nbsp;<span class="op" id="5331784">&lt;</span>&nbsp;<span class="num" id="5331786">2</span>&nbsp;<span class="op" id="5331788">||</span>&nbsp;<span class="ident" id="5331791">s</span><span class="op" id="5331792">[</span><span class="num" id="5331793">0</span><span class="op" id="5331794">]</span>&nbsp;<span class="op" id="5331796">!=</span>&nbsp;<span class="string" id="5331799">&#39;[&#39;</span>&nbsp;<span class="op" id="5331803">||</span>&nbsp;<span class="ident" id="5331806">s</span><span class="op" id="5331807">[</span><span class="num" id="5331808">1</span><span class="op" id="5331809">]</span>&nbsp;<span class="op" id="5331811">!=</span>&nbsp;<span class="string" id="5331814">&#39;:&#39;</span>&nbsp;<span class="op" id="5331818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331822">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5331830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5331834">i</span>&nbsp;<span class="op" id="5331836">:=</span>&nbsp;<span class="ident" id="5331839">strings</span><span class="op" id="5331846">.</span><span class="ident" id="5331847">Index</span><span class="op" id="5331852">(</span><span class="ident" id="5331853">s</span><span class="op" id="5331854">[</span><span class="num" id="5331855">2</span><span class="op" id="5331856">:</span><span class="op" id="5331857">]</span><span class="op" id="5331858">,</span>&nbsp;<span class="string" id="5331860">&#34;:]&#34;</span><span class="op" id="5331864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331867">if</span>&nbsp;<span class="ident" id="5331870">i</span>&nbsp;<span class="op" id="5331872">&lt;</span>&nbsp;<span class="num" id="5331874">0</span>&nbsp;<span class="op" id="5331876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331880">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5331888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5331891">i</span>&nbsp;<span class="op" id="5331893">+=</span>&nbsp;<span class="num" id="5331896">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5331899">name</span><span class="op" id="5331903">,</span>&nbsp;<span class="ident" id="5331905">s</span>&nbsp;<span class="op" id="5331907">:=</span>&nbsp;<span class="ident" id="5331910">s</span><span class="op" id="5331911">[</span><span class="num" id="5331912">0</span><span class="op" id="5331913">:</span><span class="ident" id="5331914">i</span><span class="op" id="5331915">+</span><span class="num" id="5331916">2</span><span class="op" id="5331917">]</span><span class="op" id="5331918">,</span>&nbsp;<span class="ident" id="5331920">s</span><span class="op" id="5331921">[</span><span class="ident" id="5331922">i</span><span class="op" id="5331923">+</span><span class="num" id="5331924">2</span><span class="op" id="5331925">:</span><span class="op" id="5331926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5331929">g</span>&nbsp;<span class="op" id="5331931">:=</span>&nbsp;<span class="ident" id="5331934">posixGroup</span><span class="op" id="5331944">[</span><span class="ident" id="5331945">name</span><span class="op" id="5331949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331952">if</span>&nbsp;<span class="ident" id="5331955">g</span><span class="op" id="5331956">.</span><span class="ident" id="5331957">sign</span>&nbsp;<span class="op" id="5331962">==</span>&nbsp;<span class="num" id="5331965">0</span>&nbsp;<span class="op" id="5331967">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5331971">return</span>&nbsp;<span class="ident" id="5331978">nil</span><span class="op" id="5331981">,</span>&nbsp;<span class="string" id="5331983">&#34;&#34;</span><span class="op" id="5331985">,</span>&nbsp;<span class="op" id="5331987">&amp;</span><span class="ident" id="5331988">Error</span><span class="op" id="5331993">{</span><span class="ident" id="5331994">ErrInvalidCharRange</span><span class="op" id="5332013">,</span>&nbsp;<span class="ident" id="5332015">name</span><span class="op" id="5332019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332025">return</span>&nbsp;<span class="ident" id="5332032">p</span><span class="op" id="5332033">.</span><span class="ident" id="5332034">appendGroup</span><span class="op" id="5332045">(</span><span class="ident" id="5332046">r</span><span class="op" id="5332047">,</span>&nbsp;<span class="ident" id="5332049">g</span><span class="op" id="5332050">)</span><span class="op" id="5332051">,</span>&nbsp;<span class="ident" id="5332053">s</span><span class="op" id="5332054">,</span>&nbsp;<span class="ident" id="5332056">nil</span><br>
<span class="lineno"></span><span class="op" id="5332060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5332063">func</span>&nbsp;<span class="op" id="5332068">(</span><span class="ident" id="5332069">p</span>&nbsp;<span class="op" id="5332071">*</span><span class="ident" id="5332072">parser</span><span class="op" id="5332078">)</span>&nbsp;<span class="ident" id="5332080">appendGroup</span><span class="op" id="5332091">(</span><span class="ident" id="5332092">r</span>&nbsp;<span class="op" id="5332094">[</span><span class="op" id="5332095">]</span><span class="builtintype" id="5332096">rune</span><span class="op" id="5332100">,</span>&nbsp;<span class="ident" id="5332102">g</span>&nbsp;<span class="ident" id="5332104">charGroup</span><span class="op" id="5332113">)</span>&nbsp;<span class="op" id="5332115">[</span><span class="op" id="5332116">]</span><span class="builtintype" id="5332117">rune</span>&nbsp;<span class="op" id="5332122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332125">if</span>&nbsp;<span class="ident" id="5332128">p</span><span class="op" id="5332129">.</span><span class="ident" id="5332130">flags</span><span class="op" id="5332135">&amp;</span><span class="ident" id="5332136">FoldCase</span>&nbsp;<span class="op" id="5332145">==</span>&nbsp;<span class="num" id="5332148">0</span>&nbsp;<span class="op" id="5332150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332154">if</span>&nbsp;<span class="ident" id="5332157">g</span><span class="op" id="5332158">.</span><span class="ident" id="5332159">sign</span>&nbsp;<span class="op" id="5332164">&lt;</span>&nbsp;<span class="num" id="5332166">0</span>&nbsp;<span class="op" id="5332168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332173">r</span>&nbsp;<span class="op" id="5332175">=</span>&nbsp;<span class="ident" id="5332177">appendNegatedClass</span><span class="op" id="5332195">(</span><span class="ident" id="5332196">r</span><span class="op" id="5332197">,</span>&nbsp;<span class="ident" id="5332199">g</span><span class="op" id="5332200">.</span><span class="ident" id="5332201">class</span><span class="op" id="5332206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332210">}</span>&nbsp;<span class="keyword" id="5332212">else</span>&nbsp;<span class="op" id="5332217">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332222">r</span>&nbsp;<span class="op" id="5332224">=</span>&nbsp;<span class="ident" id="5332226">appendClass</span><span class="op" id="5332237">(</span><span class="ident" id="5332238">r</span><span class="op" id="5332239">,</span>&nbsp;<span class="ident" id="5332241">g</span><span class="op" id="5332242">.</span><span class="ident" id="5332243">class</span><span class="op" id="5332248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332255">}</span>&nbsp;<span class="keyword" id="5332257">else</span>&nbsp;<span class="op" id="5332262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332266">tmp</span>&nbsp;<span class="op" id="5332270">:=</span>&nbsp;<span class="ident" id="5332273">p</span><span class="op" id="5332274">.</span><span class="ident" id="5332275">tmpClass</span><span class="op" id="5332283">[</span><span class="op" id="5332284">:</span><span class="num" id="5332285">0</span><span class="op" id="5332286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332290">tmp</span>&nbsp;<span class="op" id="5332294">=</span>&nbsp;<span class="ident" id="5332296">appendFoldedClass</span><span class="op" id="5332313">(</span><span class="ident" id="5332314">tmp</span><span class="op" id="5332317">,</span>&nbsp;<span class="ident" id="5332319">g</span><span class="op" id="5332320">.</span><span class="ident" id="5332321">class</span><span class="op" id="5332326">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332330">p</span><span class="op" id="5332331">.</span><span class="ident" id="5332332">tmpClass</span>&nbsp;<span class="op" id="5332341">=</span>&nbsp;<span class="ident" id="5332343">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332349">tmp</span>&nbsp;<span class="op" id="5332353">=</span>&nbsp;<span class="ident" id="5332355">cleanClass</span><span class="op" id="5332365">(</span><span class="op" id="5332366">&amp;</span><span class="ident" id="5332367">p</span><span class="op" id="5332368">.</span><span class="ident" id="5332369">tmpClass</span><span class="op" id="5332377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332381">if</span>&nbsp;<span class="ident" id="5332384">g</span><span class="op" id="5332385">.</span><span class="ident" id="5332386">sign</span>&nbsp;<span class="op" id="5332391">&lt;</span>&nbsp;<span class="num" id="5332393">0</span>&nbsp;<span class="op" id="5332395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332400">r</span>&nbsp;<span class="op" id="5332402">=</span>&nbsp;<span class="ident" id="5332404">appendNegatedClass</span><span class="op" id="5332422">(</span><span class="ident" id="5332423">r</span><span class="op" id="5332424">,</span>&nbsp;<span class="ident" id="5332426">tmp</span><span class="op" id="5332429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332433">}</span>&nbsp;<span class="keyword" id="5332435">else</span>&nbsp;<span class="op" id="5332440">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332445">r</span>&nbsp;<span class="op" id="5332447">=</span>&nbsp;<span class="ident" id="5332449">appendClass</span><span class="op" id="5332460">(</span><span class="ident" id="5332461">r</span><span class="op" id="5332462">,</span>&nbsp;<span class="ident" id="5332464">tmp</span><span class="op" id="5332467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332477">return</span>&nbsp;<span class="ident" id="5332484">r</span><br>
<span class="lineno"></span><span class="op" id="5332486">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5332489">var</span>&nbsp;<span class="ident" id="5332493">anyTable</span>&nbsp;<span class="op" id="5332502">=</span>&nbsp;<span class="op" id="5332504">&amp;</span><span class="ident" id="5332505">unicode</span><span class="op" id="5332512">.</span><span class="ident" id="5332513">RangeTable</span><span class="op" id="5332523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332526">R16</span><span class="op" id="5332529">:</span>&nbsp;<span class="op" id="5332531">[</span><span class="op" id="5332532">]</span><span class="ident" id="5332533">unicode</span><span class="op" id="5332540">.</span><span class="ident" id="5332541">Range16</span><span class="op" id="5332548">{</span><span class="op" id="5332549">{</span><span class="ident" id="5332550">Lo</span><span class="op" id="5332552">:</span>&nbsp;<span class="num" id="5332554">0</span><span class="op" id="5332555">,</span>&nbsp;<span class="ident" id="5332557">Hi</span><span class="op" id="5332559">:</span>&nbsp;<span class="num" id="5332561">1</span><span class="op" id="5332562">&lt;&lt;</span><span class="num" id="5332564">16</span>&nbsp;<span class="op" id="5332567">-</span>&nbsp;<span class="num" id="5332569">1</span><span class="op" id="5332570">,</span>&nbsp;<span class="ident" id="5332572">Stride</span><span class="op" id="5332578">:</span>&nbsp;<span class="num" id="5332580">1</span><span class="op" id="5332581">}</span><span class="op" id="5332582">}</span><span class="op" id="5332583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5332586">R32</span><span class="op" id="5332589">:</span>&nbsp;<span class="op" id="5332591">[</span><span class="op" id="5332592">]</span><span class="ident" id="5332593">unicode</span><span class="op" id="5332600">.</span><span class="ident" id="5332601">Range32</span><span class="op" id="5332608">{</span><span class="op" id="5332609">{</span><span class="ident" id="5332610">Lo</span><span class="op" id="5332612">:</span>&nbsp;<span class="num" id="5332614">1</span>&nbsp;<span class="op" id="5332616">&lt;&lt;</span>&nbsp;<span class="num" id="5332619">16</span><span class="op" id="5332621">,</span>&nbsp;<span class="ident" id="5332623">Hi</span><span class="op" id="5332625">:</span>&nbsp;<span class="ident" id="5332627">unicode</span><span class="op" id="5332634">.</span><span class="ident" id="5332635">MaxRune</span><span class="op" id="5332642">,</span>&nbsp;<span class="ident" id="5332644">Stride</span><span class="op" id="5332650">:</span>&nbsp;<span class="num" id="5332652">1</span><span class="op" id="5332653">}</span><span class="op" id="5332654">}</span><span class="op" id="5332655">,</span><br>
<span class="lineno"></span><span class="op" id="5332657">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5332660">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5332726">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5332786">func</span>&nbsp;<span class="ident" id="5332791">unicodeTable</span><span class="op" id="5332803">(</span><span class="ident" id="5332804">name</span>&nbsp;<span class="builtintype" id="5332809">string</span><span class="op" id="5332815">)</span>&nbsp;<span class="op" id="5332817">(</span><span class="op" id="5332818">*</span><span class="ident" id="5332819">unicode</span><span class="op" id="5332826">.</span><span class="ident" id="5332827">RangeTable</span><span class="op" id="5332837">,</span>&nbsp;<span class="op" id="5332839">*</span><span class="ident" id="5332840">unicode</span><span class="op" id="5332847">.</span><span class="ident" id="5332848">RangeTable</span><span class="op" id="5332858">)</span>&nbsp;<span class="op" id="5332860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5332863">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332898">if</span>&nbsp;<span class="ident" id="5332901">name</span>&nbsp;<span class="op" id="5332906">==</span>&nbsp;<span class="string" id="5332909">&#34;Any&#34;</span>&nbsp;<span class="op" id="5332915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332919">return</span>&nbsp;<span class="ident" id="5332926">anyTable</span><span class="op" id="5332934">,</span>&nbsp;<span class="ident" id="5332936">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5332946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332949">if</span>&nbsp;<span class="ident" id="5332952">t</span>&nbsp;<span class="op" id="5332954">:=</span>&nbsp;<span class="ident" id="5332957">unicode</span><span class="op" id="5332964">.</span><span class="ident" id="5332965">Categories</span><span class="op" id="5332975">[</span><span class="ident" id="5332976">name</span><span class="op" id="5332980">]</span><span class="op" id="5332981">;</span>&nbsp;<span class="ident" id="5332983">t</span>&nbsp;<span class="op" id="5332985">!=</span>&nbsp;<span class="ident" id="5332988">nil</span>&nbsp;<span class="op" id="5332992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5332996">return</span>&nbsp;<span class="ident" id="5333003">t</span><span class="op" id="5333004">,</span>&nbsp;<span class="ident" id="5333006">unicode</span><span class="op" id="5333013">.</span><span class="ident" id="5333014">FoldCategory</span><span class="op" id="5333026">[</span><span class="ident" id="5333027">name</span><span class="op" id="5333031">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333037">if</span>&nbsp;<span class="ident" id="5333040">t</span>&nbsp;<span class="op" id="5333042">:=</span>&nbsp;<span class="ident" id="5333045">unicode</span><span class="op" id="5333052">.</span><span class="ident" id="5333053">Scripts</span><span class="op" id="5333060">[</span><span class="ident" id="5333061">name</span><span class="op" id="5333065">]</span><span class="op" id="5333066">;</span>&nbsp;<span class="ident" id="5333068">t</span>&nbsp;<span class="op" id="5333070">!=</span>&nbsp;<span class="ident" id="5333073">nil</span>&nbsp;<span class="op" id="5333077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333081">return</span>&nbsp;<span class="ident" id="5333088">t</span><span class="op" id="5333089">,</span>&nbsp;<span class="ident" id="5333091">unicode</span><span class="op" id="5333098">.</span><span class="ident" id="5333099">FoldScript</span><span class="op" id="5333109">[</span><span class="ident" id="5333110">name</span><span class="op" id="5333114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333120">return</span>&nbsp;<span class="ident" id="5333127">nil</span><span class="op" id="5333130">,</span>&nbsp;<span class="ident" id="5333132">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5333136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5333139">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5333214">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5333293">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5333357">func</span>&nbsp;<span class="op" id="5333362">(</span><span class="ident" id="5333363">p</span>&nbsp;<span class="op" id="5333365">*</span><span class="ident" id="5333366">parser</span><span class="op" id="5333372">)</span>&nbsp;<span class="ident" id="5333374">parseUnicodeClass</span><span class="op" id="5333391">(</span><span class="ident" id="5333392">s</span>&nbsp;<span class="builtintype" id="5333394">string</span><span class="op" id="5333400">,</span>&nbsp;<span class="ident" id="5333402">r</span>&nbsp;<span class="op" id="5333404">[</span><span class="op" id="5333405">]</span><span class="builtintype" id="5333406">rune</span><span class="op" id="5333410">)</span>&nbsp;<span class="op" id="5333412">(</span><span class="ident" id="5333413">out</span>&nbsp;<span class="op" id="5333417">[</span><span class="op" id="5333418">]</span><span class="builtintype" id="5333419">rune</span><span class="op" id="5333423">,</span>&nbsp;<span class="ident" id="5333425">rest</span>&nbsp;<span class="builtintype" id="5333430">string</span><span class="op" id="5333436">,</span>&nbsp;<span class="ident" id="5333438">err</span>&nbsp;<span class="builtintype" id="5333442">error</span><span class="op" id="5333447">)</span>&nbsp;<span class="op" id="5333449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333452">if</span>&nbsp;<span class="ident" id="5333455">p</span><span class="op" id="5333456">.</span><span class="ident" id="5333457">flags</span><span class="op" id="5333462">&amp;</span><span class="ident" id="5333463">UnicodeGroups</span>&nbsp;<span class="op" id="5333477">==</span>&nbsp;<span class="num" id="5333480">0</span>&nbsp;<span class="op" id="5333482">||</span>&nbsp;<span class="builtinfunc" id="5333485">len</span><span class="op" id="5333488">(</span><span class="ident" id="5333489">s</span><span class="op" id="5333490">)</span>&nbsp;<span class="op" id="5333492">&lt;</span>&nbsp;<span class="num" id="5333494">2</span>&nbsp;<span class="op" id="5333496">||</span>&nbsp;<span class="ident" id="5333499">s</span><span class="op" id="5333500">[</span><span class="num" id="5333501">0</span><span class="op" id="5333502">]</span>&nbsp;<span class="op" id="5333504">!=</span>&nbsp;<span class="string" id="5333507">&#39;\\&#39;</span>&nbsp;<span class="op" id="5333512">||</span>&nbsp;<span class="ident" id="5333515">s</span><span class="op" id="5333516">[</span><span class="num" id="5333517">1</span><span class="op" id="5333518">]</span>&nbsp;<span class="op" id="5333520">!=</span>&nbsp;<span class="string" id="5333523">&#39;p&#39;</span>&nbsp;<span class="op" id="5333527">&amp;&amp;</span>&nbsp;<span class="ident" id="5333530">s</span><span class="op" id="5333531">[</span><span class="num" id="5333532">1</span><span class="op" id="5333533">]</span>&nbsp;<span class="op" id="5333535">!=</span>&nbsp;<span class="string" id="5333538">&#39;P&#39;</span>&nbsp;<span class="op" id="5333542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333546">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5333558">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333598">sign</span>&nbsp;<span class="op" id="5333603">:=</span>&nbsp;<span class="op" id="5333606">+</span><span class="num" id="5333607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333610">if</span>&nbsp;<span class="ident" id="5333613">s</span><span class="op" id="5333614">[</span><span class="num" id="5333615">1</span><span class="op" id="5333616">]</span>&nbsp;<span class="op" id="5333618">==</span>&nbsp;<span class="string" id="5333621">&#39;P&#39;</span>&nbsp;<span class="op" id="5333625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333629">sign</span>&nbsp;<span class="op" id="5333634">=</span>&nbsp;<span class="op" id="5333636">-</span><span class="num" id="5333637">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333640">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333643">t</span>&nbsp;<span class="op" id="5333645">:=</span>&nbsp;<span class="ident" id="5333648">s</span><span class="op" id="5333649">[</span><span class="num" id="5333650">2</span><span class="op" id="5333651">:</span><span class="op" id="5333652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333655">c</span><span class="op" id="5333656">,</span>&nbsp;<span class="ident" id="5333658">t</span><span class="op" id="5333659">,</span>&nbsp;<span class="ident" id="5333661">err</span>&nbsp;<span class="op" id="5333665">:=</span>&nbsp;<span class="ident" id="5333668">nextRune</span><span class="op" id="5333676">(</span><span class="ident" id="5333677">t</span><span class="op" id="5333678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333681">if</span>&nbsp;<span class="ident" id="5333684">err</span>&nbsp;<span class="op" id="5333688">!=</span>&nbsp;<span class="ident" id="5333691">nil</span>&nbsp;<span class="op" id="5333695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333699">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333707">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333710">var</span>&nbsp;<span class="ident" id="5333714">seq</span><span class="op" id="5333717">,</span>&nbsp;<span class="ident" id="5333719">name</span>&nbsp;<span class="builtintype" id="5333724">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333732">if</span>&nbsp;<span class="ident" id="5333735">c</span>&nbsp;<span class="op" id="5333737">!=</span>&nbsp;<span class="string" id="5333740">&#39;{&#39;</span>&nbsp;<span class="op" id="5333744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5333748">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333773">seq</span>&nbsp;<span class="op" id="5333777">=</span>&nbsp;<span class="ident" id="5333779">s</span><span class="op" id="5333780">[</span><span class="op" id="5333781">:</span><span class="builtinfunc" id="5333782">len</span><span class="op" id="5333785">(</span><span class="ident" id="5333786">s</span><span class="op" id="5333787">)</span><span class="op" id="5333788">-</span><span class="builtinfunc" id="5333789">len</span><span class="op" id="5333792">(</span><span class="ident" id="5333793">t</span><span class="op" id="5333794">)</span><span class="op" id="5333795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333799">name</span>&nbsp;<span class="op" id="5333804">=</span>&nbsp;<span class="ident" id="5333806">seq</span><span class="op" id="5333809">[</span><span class="num" id="5333810">2</span><span class="op" id="5333811">:</span><span class="op" id="5333812">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333815">}</span>&nbsp;<span class="keyword" id="5333817">else</span>&nbsp;<span class="op" id="5333822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5333826">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5333850">end</span>&nbsp;<span class="op" id="5333854">:=</span>&nbsp;<span class="ident" id="5333857">strings</span><span class="op" id="5333864">.</span><span class="ident" id="5333865">IndexRune</span><span class="op" id="5333874">(</span><span class="ident" id="5333875">s</span><span class="op" id="5333876">,</span>&nbsp;<span class="string" id="5333878">&#39;}&#39;</span><span class="op" id="5333881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333885">if</span>&nbsp;<span class="ident" id="5333888">end</span>&nbsp;<span class="op" id="5333892">&lt;</span>&nbsp;<span class="num" id="5333894">0</span>&nbsp;<span class="op" id="5333896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333901">if</span>&nbsp;<span class="ident" id="5333904">err</span>&nbsp;<span class="op" id="5333908">=</span>&nbsp;<span class="ident" id="5333910">checkUTF8</span><span class="op" id="5333919">(</span><span class="ident" id="5333920">s</span><span class="op" id="5333921">)</span><span class="op" id="5333922">;</span>&nbsp;<span class="ident" id="5333924">err</span>&nbsp;<span class="op" id="5333928">!=</span>&nbsp;<span class="ident" id="5333931">nil</span>&nbsp;<span class="op" id="5333935">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5333951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5333956">return</span>&nbsp;<span class="ident" id="5333963">nil</span><span class="op" id="5333966">,</span>&nbsp;<span class="string" id="5333968">&#34;&#34;</span><span class="op" id="5333970">,</span>&nbsp;<span class="op" id="5333972">&amp;</span><span class="ident" id="5333973">Error</span><span class="op" id="5333978">{</span><span class="ident" id="5333979">ErrInvalidCharRange</span><span class="op" id="5333998">,</span>&nbsp;<span class="ident" id="5334000">s</span><span class="op" id="5334001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334009">seq</span><span class="op" id="5334012">,</span>&nbsp;<span class="ident" id="5334014">t</span>&nbsp;<span class="op" id="5334016">=</span>&nbsp;<span class="ident" id="5334018">s</span><span class="op" id="5334019">[</span><span class="op" id="5334020">:</span><span class="ident" id="5334021">end</span><span class="op" id="5334024">+</span><span class="num" id="5334025">1</span><span class="op" id="5334026">]</span><span class="op" id="5334027">,</span>&nbsp;<span class="ident" id="5334029">s</span><span class="op" id="5334030">[</span><span class="ident" id="5334031">end</span><span class="op" id="5334034">+</span><span class="num" id="5334035">1</span><span class="op" id="5334036">:</span><span class="op" id="5334037">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334041">name</span>&nbsp;<span class="op" id="5334046">=</span>&nbsp;<span class="ident" id="5334048">s</span><span class="op" id="5334049">[</span><span class="num" id="5334050">3</span><span class="op" id="5334051">:</span><span class="ident" id="5334052">end</span><span class="op" id="5334055">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334059">if</span>&nbsp;<span class="ident" id="5334062">err</span>&nbsp;<span class="op" id="5334066">=</span>&nbsp;<span class="ident" id="5334068">checkUTF8</span><span class="op" id="5334077">(</span><span class="ident" id="5334078">name</span><span class="op" id="5334082">)</span><span class="op" id="5334083">;</span>&nbsp;<span class="ident" id="5334085">err</span>&nbsp;<span class="op" id="5334089">!=</span>&nbsp;<span class="ident" id="5334092">nil</span>&nbsp;<span class="op" id="5334096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334101">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334113">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5334117">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334201">if</span>&nbsp;<span class="ident" id="5334204">name</span>&nbsp;<span class="op" id="5334209">!=</span>&nbsp;<span class="string" id="5334212">&#34;&#34;</span>&nbsp;<span class="op" id="5334215">&amp;&amp;</span>&nbsp;<span class="ident" id="5334218">name</span><span class="op" id="5334222">[</span><span class="num" id="5334223">0</span><span class="op" id="5334224">]</span>&nbsp;<span class="op" id="5334226">==</span>&nbsp;<span class="string" id="5334229">&#39;^&#39;</span>&nbsp;<span class="op" id="5334233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334237">sign</span>&nbsp;<span class="op" id="5334242">=</span>&nbsp;<span class="op" id="5334244">-</span><span class="ident" id="5334245">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334252">name</span>&nbsp;<span class="op" id="5334257">=</span>&nbsp;<span class="ident" id="5334259">name</span><span class="op" id="5334263">[</span><span class="num" id="5334264">1</span><span class="op" id="5334265">:</span><span class="op" id="5334266">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334273">tab</span><span class="op" id="5334276">,</span>&nbsp;<span class="ident" id="5334278">fold</span>&nbsp;<span class="op" id="5334283">:=</span>&nbsp;<span class="ident" id="5334286">unicodeTable</span><span class="op" id="5334298">(</span><span class="ident" id="5334299">name</span><span class="op" id="5334303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334306">if</span>&nbsp;<span class="ident" id="5334309">tab</span>&nbsp;<span class="op" id="5334313">==</span>&nbsp;<span class="ident" id="5334316">nil</span>&nbsp;<span class="op" id="5334320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334324">return</span>&nbsp;<span class="ident" id="5334331">nil</span><span class="op" id="5334334">,</span>&nbsp;<span class="string" id="5334336">&#34;&#34;</span><span class="op" id="5334338">,</span>&nbsp;<span class="op" id="5334340">&amp;</span><span class="ident" id="5334341">Error</span><span class="op" id="5334346">{</span><span class="ident" id="5334347">ErrInvalidCharRange</span><span class="op" id="5334366">,</span>&nbsp;<span class="ident" id="5334368">seq</span><span class="op" id="5334371">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334378">if</span>&nbsp;<span class="ident" id="5334381">p</span><span class="op" id="5334382">.</span><span class="ident" id="5334383">flags</span><span class="op" id="5334388">&amp;</span><span class="ident" id="5334389">FoldCase</span>&nbsp;<span class="op" id="5334398">==</span>&nbsp;<span class="num" id="5334401">0</span>&nbsp;<span class="op" id="5334403">||</span>&nbsp;<span class="ident" id="5334406">fold</span>&nbsp;<span class="op" id="5334411">==</span>&nbsp;<span class="ident" id="5334414">nil</span>&nbsp;<span class="op" id="5334418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334422">if</span>&nbsp;<span class="ident" id="5334425">sign</span>&nbsp;<span class="op" id="5334430">&gt;</span>&nbsp;<span class="num" id="5334432">0</span>&nbsp;<span class="op" id="5334434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334439">r</span>&nbsp;<span class="op" id="5334441">=</span>&nbsp;<span class="ident" id="5334443">appendTable</span><span class="op" id="5334454">(</span><span class="ident" id="5334455">r</span><span class="op" id="5334456">,</span>&nbsp;<span class="ident" id="5334458">tab</span><span class="op" id="5334461">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334465">}</span>&nbsp;<span class="keyword" id="5334467">else</span>&nbsp;<span class="op" id="5334472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334477">r</span>&nbsp;<span class="op" id="5334479">=</span>&nbsp;<span class="ident" id="5334481">appendNegatedTable</span><span class="op" id="5334499">(</span><span class="ident" id="5334500">r</span><span class="op" id="5334501">,</span>&nbsp;<span class="ident" id="5334503">tab</span><span class="op" id="5334506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334513">}</span>&nbsp;<span class="keyword" id="5334515">else</span>&nbsp;<span class="op" id="5334520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5334524">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5334581">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5334640">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334668">tmp</span>&nbsp;<span class="op" id="5334672">:=</span>&nbsp;<span class="ident" id="5334675">p</span><span class="op" id="5334676">.</span><span class="ident" id="5334677">tmpClass</span><span class="op" id="5334685">[</span><span class="op" id="5334686">:</span><span class="num" id="5334687">0</span><span class="op" id="5334688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334692">tmp</span>&nbsp;<span class="op" id="5334696">=</span>&nbsp;<span class="ident" id="5334698">appendTable</span><span class="op" id="5334709">(</span><span class="ident" id="5334710">tmp</span><span class="op" id="5334713">,</span>&nbsp;<span class="ident" id="5334715">tab</span><span class="op" id="5334718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334722">tmp</span>&nbsp;<span class="op" id="5334726">=</span>&nbsp;<span class="ident" id="5334728">appendTable</span><span class="op" id="5334739">(</span><span class="ident" id="5334740">tmp</span><span class="op" id="5334743">,</span>&nbsp;<span class="ident" id="5334745">fold</span><span class="op" id="5334749">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334753">p</span><span class="op" id="5334754">.</span><span class="ident" id="5334755">tmpClass</span>&nbsp;<span class="op" id="5334764">=</span>&nbsp;<span class="ident" id="5334766">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334772">tmp</span>&nbsp;<span class="op" id="5334776">=</span>&nbsp;<span class="ident" id="5334778">cleanClass</span><span class="op" id="5334788">(</span><span class="op" id="5334789">&amp;</span><span class="ident" id="5334790">p</span><span class="op" id="5334791">.</span><span class="ident" id="5334792">tmpClass</span><span class="op" id="5334800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334804">if</span>&nbsp;<span class="ident" id="5334807">sign</span>&nbsp;<span class="op" id="5334812">&gt;</span>&nbsp;<span class="num" id="5334814">0</span>&nbsp;<span class="op" id="5334816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334821">r</span>&nbsp;<span class="op" id="5334823">=</span>&nbsp;<span class="ident" id="5334825">appendClass</span><span class="op" id="5334836">(</span><span class="ident" id="5334837">r</span><span class="op" id="5334838">,</span>&nbsp;<span class="ident" id="5334840">tmp</span><span class="op" id="5334843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334847">}</span>&nbsp;<span class="keyword" id="5334849">else</span>&nbsp;<span class="op" id="5334854">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5334859">r</span>&nbsp;<span class="op" id="5334861">=</span>&nbsp;<span class="ident" id="5334863">appendNegatedClass</span><span class="op" id="5334881">(</span><span class="ident" id="5334882">r</span><span class="op" id="5334883">,</span>&nbsp;<span class="ident" id="5334885">tmp</span><span class="op" id="5334888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5334895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5334898">return</span>&nbsp;<span class="ident" id="5334905">r</span><span class="op" id="5334906">,</span>&nbsp;<span class="ident" id="5334908">t</span><span class="op" id="5334909">,</span>&nbsp;<span class="ident" id="5334911">nil</span><br>
<span class="lineno"></span><span class="op" id="5334915">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5334918">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5334979">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5335018">func</span>&nbsp;<span class="op" id="5335023">(</span><span class="ident" id="5335024">p</span>&nbsp;<span class="op" id="5335026">*</span><span class="ident" id="5335027">parser</span><span class="op" id="5335033">)</span>&nbsp;<span class="ident" id="5335035">parseClass</span><span class="op" id="5335045">(</span><span class="ident" id="5335046">s</span>&nbsp;<span class="builtintype" id="5335048">string</span><span class="op" id="5335054">)</span>&nbsp;<span class="op" id="5335056">(</span><span class="ident" id="5335057">rest</span>&nbsp;<span class="builtintype" id="5335062">string</span><span class="op" id="5335068">,</span>&nbsp;<span class="ident" id="5335070">err</span>&nbsp;<span class="builtintype" id="5335074">error</span><span class="op" id="5335079">)</span>&nbsp;<span class="op" id="5335081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335084">t</span>&nbsp;<span class="op" id="5335086">:=</span>&nbsp;<span class="ident" id="5335089">s</span><span class="op" id="5335090">[</span><span class="num" id="5335091">1</span><span class="op" id="5335092">:</span><span class="op" id="5335093">]</span>&nbsp;<span class="comment" id="5335095">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335106">re</span>&nbsp;<span class="op" id="5335109">:=</span>&nbsp;<span class="ident" id="5335112">p</span><span class="op" id="5335113">.</span><span class="ident" id="5335114">newRegexp</span><span class="op" id="5335123">(</span><span class="ident" id="5335124">OpCharClass</span><span class="op" id="5335135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335138">re</span><span class="op" id="5335140">.</span><span class="ident" id="5335141">Flags</span>&nbsp;<span class="op" id="5335147">=</span>&nbsp;<span class="ident" id="5335149">p</span><span class="op" id="5335150">.</span><span class="ident" id="5335151">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335158">re</span><span class="op" id="5335160">.</span><span class="ident" id="5335161">Rune</span>&nbsp;<span class="op" id="5335166">=</span>&nbsp;<span class="ident" id="5335168">re</span><span class="op" id="5335170">.</span><span class="ident" id="5335171">Rune0</span><span class="op" id="5335176">[</span><span class="op" id="5335177">:</span><span class="num" id="5335178">0</span><span class="op" id="5335179">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335183">sign</span>&nbsp;<span class="op" id="5335188">:=</span>&nbsp;<span class="op" id="5335191">+</span><span class="num" id="5335192">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335195">if</span>&nbsp;<span class="ident" id="5335198">t</span>&nbsp;<span class="op" id="5335200">!=</span>&nbsp;<span class="string" id="5335203">&#34;&#34;</span>&nbsp;<span class="op" id="5335206">&amp;&amp;</span>&nbsp;<span class="ident" id="5335209">t</span><span class="op" id="5335210">[</span><span class="num" id="5335211">0</span><span class="op" id="5335212">]</span>&nbsp;<span class="op" id="5335214">==</span>&nbsp;<span class="string" id="5335217">&#39;^&#39;</span>&nbsp;<span class="op" id="5335221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335225">sign</span>&nbsp;<span class="op" id="5335230">=</span>&nbsp;<span class="op" id="5335232">-</span><span class="num" id="5335233">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335237">t</span>&nbsp;<span class="op" id="5335239">=</span>&nbsp;<span class="ident" id="5335241">t</span><span class="op" id="5335242">[</span><span class="num" id="5335243">1</span><span class="op" id="5335244">:</span><span class="op" id="5335245">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335250">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335306">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335359">if</span>&nbsp;<span class="ident" id="5335362">p</span><span class="op" id="5335363">.</span><span class="ident" id="5335364">flags</span><span class="op" id="5335369">&amp;</span><span class="ident" id="5335370">ClassNL</span>&nbsp;<span class="op" id="5335378">==</span>&nbsp;<span class="num" id="5335381">0</span>&nbsp;<span class="op" id="5335383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335388">re</span><span class="op" id="5335390">.</span><span class="ident" id="5335391">Rune</span>&nbsp;<span class="op" id="5335396">=</span>&nbsp;<span class="builtinfunc" id="5335398">append</span><span class="op" id="5335404">(</span><span class="ident" id="5335405">re</span><span class="op" id="5335407">.</span><span class="ident" id="5335408">Rune</span><span class="op" id="5335412">,</span>&nbsp;<span class="string" id="5335414">&#39;\n&#39;</span><span class="op" id="5335418">,</span>&nbsp;<span class="string" id="5335420">&#39;\n&#39;</span><span class="op" id="5335424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335431">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335435">class</span>&nbsp;<span class="op" id="5335441">:=</span>&nbsp;<span class="ident" id="5335444">re</span><span class="op" id="5335446">.</span><span class="ident" id="5335447">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335453">first</span>&nbsp;<span class="op" id="5335459">:=</span>&nbsp;<span class="builtintype" id="5335462">true</span>&nbsp;<span class="comment" id="5335467">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335511">for</span>&nbsp;<span class="ident" id="5335515">t</span>&nbsp;<span class="op" id="5335517">==</span>&nbsp;<span class="string" id="5335520">&#34;&#34;</span>&nbsp;<span class="op" id="5335523">||</span>&nbsp;<span class="ident" id="5335526">t</span><span class="op" id="5335527">[</span><span class="num" id="5335528">0</span><span class="op" id="5335529">]</span>&nbsp;<span class="op" id="5335531">!=</span>&nbsp;<span class="string" id="5335534">&#39;]&#39;</span>&nbsp;<span class="op" id="5335538">||</span>&nbsp;<span class="ident" id="5335541">first</span>&nbsp;<span class="op" id="5335547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335551">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335615">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335646">if</span>&nbsp;<span class="ident" id="5335649">t</span>&nbsp;<span class="op" id="5335651">!=</span>&nbsp;<span class="string" id="5335654">&#34;&#34;</span>&nbsp;<span class="op" id="5335657">&amp;&amp;</span>&nbsp;<span class="ident" id="5335660">t</span><span class="op" id="5335661">[</span><span class="num" id="5335662">0</span><span class="op" id="5335663">]</span>&nbsp;<span class="op" id="5335665">==</span>&nbsp;<span class="string" id="5335668">&#39;-&#39;</span>&nbsp;<span class="op" id="5335672">&amp;&amp;</span>&nbsp;<span class="ident" id="5335675">p</span><span class="op" id="5335676">.</span><span class="ident" id="5335677">flags</span><span class="op" id="5335682">&amp;</span><span class="ident" id="5335683">PerlX</span>&nbsp;<span class="op" id="5335689">==</span>&nbsp;<span class="num" id="5335692">0</span>&nbsp;<span class="op" id="5335694">&amp;&amp;</span>&nbsp;<span class="op" id="5335697">!</span><span class="ident" id="5335698">first</span>&nbsp;<span class="op" id="5335704">&amp;&amp;</span>&nbsp;<span class="op" id="5335707">(</span><span class="builtinfunc" id="5335708">len</span><span class="op" id="5335711">(</span><span class="ident" id="5335712">t</span><span class="op" id="5335713">)</span>&nbsp;<span class="op" id="5335715">==</span>&nbsp;<span class="num" id="5335718">1</span>&nbsp;<span class="op" id="5335720">||</span>&nbsp;<span class="ident" id="5335723">t</span><span class="op" id="5335724">[</span><span class="num" id="5335725">1</span><span class="op" id="5335726">]</span>&nbsp;<span class="op" id="5335728">!=</span>&nbsp;<span class="string" id="5335731">&#39;]&#39;</span><span class="op" id="5335734">)</span>&nbsp;<span class="op" id="5335736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335741">_</span><span class="op" id="5335742">,</span>&nbsp;<span class="ident" id="5335744">size</span>&nbsp;<span class="op" id="5335749">:=</span>&nbsp;<span class="ident" id="5335752">utf8</span><span class="op" id="5335756">.</span><span class="ident" id="5335757">DecodeRuneInString</span><span class="op" id="5335775">(</span><span class="ident" id="5335776">t</span><span class="op" id="5335777">[</span><span class="num" id="5335778">1</span><span class="op" id="5335779">:</span><span class="op" id="5335780">]</span><span class="op" id="5335781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335786">return</span>&nbsp;<span class="string" id="5335793">&#34;&#34;</span><span class="op" id="5335795">,</span>&nbsp;<span class="op" id="5335797">&amp;</span><span class="ident" id="5335798">Error</span><span class="op" id="5335803">{</span><span class="ident" id="5335804">Code</span><span class="op" id="5335808">:</span>&nbsp;<span class="ident" id="5335810">ErrInvalidCharRange</span><span class="op" id="5335829">,</span>&nbsp;<span class="ident" id="5335831">Expr</span><span class="op" id="5335835">:</span>&nbsp;<span class="ident" id="5335837">t</span><span class="op" id="5335838">[</span><span class="op" id="5335839">:</span><span class="num" id="5335840">1</span><span class="op" id="5335841">+</span><span class="ident" id="5335842">size</span><span class="op" id="5335846">]</span><span class="op" id="5335847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335851">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335855">first</span>&nbsp;<span class="op" id="5335861">=</span>&nbsp;<span class="builtintype" id="5335863">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335872">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335907">if</span>&nbsp;<span class="builtinfunc" id="5335910">len</span><span class="op" id="5335913">(</span><span class="ident" id="5335914">t</span><span class="op" id="5335915">)</span>&nbsp;<span class="op" id="5335917">&gt;</span>&nbsp;<span class="num" id="5335919">2</span>&nbsp;<span class="op" id="5335921">&amp;&amp;</span>&nbsp;<span class="ident" id="5335924">t</span><span class="op" id="5335925">[</span><span class="num" id="5335926">0</span><span class="op" id="5335927">]</span>&nbsp;<span class="op" id="5335929">==</span>&nbsp;<span class="string" id="5335932">&#39;[&#39;</span>&nbsp;<span class="op" id="5335936">&amp;&amp;</span>&nbsp;<span class="ident" id="5335939">t</span><span class="op" id="5335940">[</span><span class="num" id="5335941">1</span><span class="op" id="5335942">]</span>&nbsp;<span class="op" id="5335944">==</span>&nbsp;<span class="string" id="5335947">&#39;:&#39;</span>&nbsp;<span class="op" id="5335951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335956">nclass</span><span class="op" id="5335962">,</span>&nbsp;<span class="ident" id="5335964">nt</span><span class="op" id="5335966">,</span>&nbsp;<span class="ident" id="5335968">err</span>&nbsp;<span class="op" id="5335972">:=</span>&nbsp;<span class="ident" id="5335975">p</span><span class="op" id="5335976">.</span><span class="ident" id="5335977">parseNamedClass</span><span class="op" id="5335992">(</span><span class="ident" id="5335993">t</span><span class="op" id="5335994">,</span>&nbsp;<span class="ident" id="5335996">class</span><span class="op" id="5336001">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336006">if</span>&nbsp;<span class="ident" id="5336009">err</span>&nbsp;<span class="op" id="5336013">!=</span>&nbsp;<span class="ident" id="5336016">nil</span>&nbsp;<span class="op" id="5336020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336026">return</span>&nbsp;<span class="string" id="5336033">&#34;&#34;</span><span class="op" id="5336035">,</span>&nbsp;<span class="ident" id="5336037">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336049">if</span>&nbsp;<span class="ident" id="5336052">nclass</span>&nbsp;<span class="op" id="5336059">!=</span>&nbsp;<span class="ident" id="5336062">nil</span>&nbsp;<span class="op" id="5336066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336072">class</span><span class="op" id="5336077">,</span>&nbsp;<span class="ident" id="5336079">t</span>&nbsp;<span class="op" id="5336081">=</span>&nbsp;<span class="ident" id="5336083">nclass</span><span class="op" id="5336089">,</span>&nbsp;<span class="ident" id="5336091">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336119">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336171">nclass</span><span class="op" id="5336177">,</span>&nbsp;<span class="ident" id="5336179">nt</span><span class="op" id="5336181">,</span>&nbsp;<span class="ident" id="5336183">err</span>&nbsp;<span class="op" id="5336187">:=</span>&nbsp;<span class="ident" id="5336190">p</span><span class="op" id="5336191">.</span><span class="ident" id="5336192">parseUnicodeClass</span><span class="op" id="5336209">(</span><span class="ident" id="5336210">t</span><span class="op" id="5336211">,</span>&nbsp;<span class="ident" id="5336213">class</span><span class="op" id="5336218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336222">if</span>&nbsp;<span class="ident" id="5336225">err</span>&nbsp;<span class="op" id="5336229">!=</span>&nbsp;<span class="ident" id="5336232">nil</span>&nbsp;<span class="op" id="5336236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336241">return</span>&nbsp;<span class="string" id="5336248">&#34;&#34;</span><span class="op" id="5336250">,</span>&nbsp;<span class="ident" id="5336252">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336262">if</span>&nbsp;<span class="ident" id="5336265">nclass</span>&nbsp;<span class="op" id="5336272">!=</span>&nbsp;<span class="ident" id="5336275">nil</span>&nbsp;<span class="op" id="5336279">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336284">class</span><span class="op" id="5336289">,</span>&nbsp;<span class="ident" id="5336291">t</span>&nbsp;<span class="op" id="5336293">=</span>&nbsp;<span class="ident" id="5336295">nclass</span><span class="op" id="5336301">,</span>&nbsp;<span class="ident" id="5336303">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336309">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336325">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336381">if</span>&nbsp;<span class="ident" id="5336384">nclass</span><span class="op" id="5336390">,</span>&nbsp;<span class="ident" id="5336392">nt</span>&nbsp;<span class="op" id="5336395">:=</span>&nbsp;<span class="ident" id="5336398">p</span><span class="op" id="5336399">.</span><span class="ident" id="5336400">parsePerlClassEscape</span><span class="op" id="5336420">(</span><span class="ident" id="5336421">t</span><span class="op" id="5336422">,</span>&nbsp;<span class="ident" id="5336424">class</span><span class="op" id="5336429">)</span><span class="op" id="5336430">;</span>&nbsp;<span class="ident" id="5336432">nclass</span>&nbsp;<span class="op" id="5336439">!=</span>&nbsp;<span class="ident" id="5336442">nil</span>&nbsp;<span class="op" id="5336446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336451">class</span><span class="op" id="5336456">,</span>&nbsp;<span class="ident" id="5336458">t</span>&nbsp;<span class="op" id="5336460">=</span>&nbsp;<span class="ident" id="5336462">nclass</span><span class="op" id="5336468">,</span>&nbsp;<span class="ident" id="5336470">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336476">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336492">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336531">rng</span>&nbsp;<span class="op" id="5336535">:=</span>&nbsp;<span class="ident" id="5336538">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336542">var</span>&nbsp;<span class="ident" id="5336546">lo</span><span class="op" id="5336548">,</span>&nbsp;<span class="ident" id="5336550">hi</span>&nbsp;<span class="builtintype" id="5336553">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336560">if</span>&nbsp;<span class="ident" id="5336563">lo</span><span class="op" id="5336565">,</span>&nbsp;<span class="ident" id="5336567">t</span><span class="op" id="5336568">,</span>&nbsp;<span class="ident" id="5336570">err</span>&nbsp;<span class="op" id="5336574">=</span>&nbsp;<span class="ident" id="5336576">p</span><span class="op" id="5336577">.</span><span class="ident" id="5336578">parseClassChar</span><span class="op" id="5336592">(</span><span class="ident" id="5336593">t</span><span class="op" id="5336594">,</span>&nbsp;<span class="ident" id="5336596">s</span><span class="op" id="5336597">)</span><span class="op" id="5336598">;</span>&nbsp;<span class="ident" id="5336600">err</span>&nbsp;<span class="op" id="5336604">!=</span>&nbsp;<span class="ident" id="5336607">nil</span>&nbsp;<span class="op" id="5336611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336616">return</span>&nbsp;<span class="string" id="5336623">&#34;&#34;</span><span class="op" id="5336625">,</span>&nbsp;<span class="ident" id="5336627">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336637">hi</span>&nbsp;<span class="op" id="5336640">=</span>&nbsp;<span class="ident" id="5336642">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336647">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336691">if</span>&nbsp;<span class="builtinfunc" id="5336694">len</span><span class="op" id="5336697">(</span><span class="ident" id="5336698">t</span><span class="op" id="5336699">)</span>&nbsp;<span class="op" id="5336701">&gt;=</span>&nbsp;<span class="num" id="5336704">2</span>&nbsp;<span class="op" id="5336706">&amp;&amp;</span>&nbsp;<span class="ident" id="5336709">t</span><span class="op" id="5336710">[</span><span class="num" id="5336711">0</span><span class="op" id="5336712">]</span>&nbsp;<span class="op" id="5336714">==</span>&nbsp;<span class="string" id="5336717">&#39;-&#39;</span>&nbsp;<span class="op" id="5336721">&amp;&amp;</span>&nbsp;<span class="ident" id="5336724">t</span><span class="op" id="5336725">[</span><span class="num" id="5336726">1</span><span class="op" id="5336727">]</span>&nbsp;<span class="op" id="5336729">!=</span>&nbsp;<span class="string" id="5336732">&#39;]&#39;</span>&nbsp;<span class="op" id="5336736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336741">t</span>&nbsp;<span class="op" id="5336743">=</span>&nbsp;<span class="ident" id="5336745">t</span><span class="op" id="5336746">[</span><span class="num" id="5336747">1</span><span class="op" id="5336748">:</span><span class="op" id="5336749">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336754">if</span>&nbsp;<span class="ident" id="5336757">hi</span><span class="op" id="5336759">,</span>&nbsp;<span class="ident" id="5336761">t</span><span class="op" id="5336762">,</span>&nbsp;<span class="ident" id="5336764">err</span>&nbsp;<span class="op" id="5336768">=</span>&nbsp;<span class="ident" id="5336770">p</span><span class="op" id="5336771">.</span><span class="ident" id="5336772">parseClassChar</span><span class="op" id="5336786">(</span><span class="ident" id="5336787">t</span><span class="op" id="5336788">,</span>&nbsp;<span class="ident" id="5336790">s</span><span class="op" id="5336791">)</span><span class="op" id="5336792">;</span>&nbsp;<span class="ident" id="5336794">err</span>&nbsp;<span class="op" id="5336798">!=</span>&nbsp;<span class="ident" id="5336801">nil</span>&nbsp;<span class="op" id="5336805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336811">return</span>&nbsp;<span class="string" id="5336818">&#34;&#34;</span><span class="op" id="5336820">,</span>&nbsp;<span class="ident" id="5336822">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336834">if</span>&nbsp;<span class="ident" id="5336837">hi</span>&nbsp;<span class="op" id="5336840">&lt;</span>&nbsp;<span class="ident" id="5336842">lo</span>&nbsp;<span class="op" id="5336845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336851">rng</span>&nbsp;<span class="op" id="5336855">=</span>&nbsp;<span class="ident" id="5336857">rng</span><span class="op" id="5336860">[</span><span class="op" id="5336861">:</span><span class="builtinfunc" id="5336862">len</span><span class="op" id="5336865">(</span><span class="ident" id="5336866">rng</span><span class="op" id="5336869">)</span><span class="op" id="5336870">-</span><span class="builtinfunc" id="5336871">len</span><span class="op" id="5336874">(</span><span class="ident" id="5336875">t</span><span class="op" id="5336876">)</span><span class="op" id="5336877">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336883">return</span>&nbsp;<span class="string" id="5336890">&#34;&#34;</span><span class="op" id="5336892">,</span>&nbsp;<span class="op" id="5336894">&amp;</span><span class="ident" id="5336895">Error</span><span class="op" id="5336900">{</span><span class="ident" id="5336901">Code</span><span class="op" id="5336905">:</span>&nbsp;<span class="ident" id="5336907">ErrInvalidCharRange</span><span class="op" id="5336926">,</span>&nbsp;<span class="ident" id="5336928">Expr</span><span class="op" id="5336932">:</span>&nbsp;<span class="ident" id="5336934">rng</span><span class="op" id="5336937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336950">if</span>&nbsp;<span class="ident" id="5336953">p</span><span class="op" id="5336954">.</span><span class="ident" id="5336955">flags</span><span class="op" id="5336960">&amp;</span><span class="ident" id="5336961">FoldCase</span>&nbsp;<span class="op" id="5336970">==</span>&nbsp;<span class="num" id="5336973">0</span>&nbsp;<span class="op" id="5336975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336980">class</span>&nbsp;<span class="op" id="5336986">=</span>&nbsp;<span class="ident" id="5336988">appendRange</span><span class="op" id="5336999">(</span><span class="ident" id="5337000">class</span><span class="op" id="5337005">,</span>&nbsp;<span class="ident" id="5337007">lo</span><span class="op" id="5337009">,</span>&nbsp;<span class="ident" id="5337011">hi</span><span class="op" id="5337013">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337017">}</span>&nbsp;<span class="keyword" id="5337019">else</span>&nbsp;<span class="op" id="5337024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337029">class</span>&nbsp;<span class="op" id="5337035">=</span>&nbsp;<span class="ident" id="5337037">appendFoldedRange</span><span class="op" id="5337054">(</span><span class="ident" id="5337055">class</span><span class="op" id="5337060">,</span>&nbsp;<span class="ident" id="5337062">lo</span><span class="op" id="5337064">,</span>&nbsp;<span class="ident" id="5337066">hi</span><span class="op" id="5337068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337078">t</span>&nbsp;<span class="op" id="5337080">=</span>&nbsp;<span class="ident" id="5337082">t</span><span class="op" id="5337083">[</span><span class="num" id="5337084">1</span><span class="op" id="5337085">:</span><span class="op" id="5337086">]</span>&nbsp;<span class="comment" id="5337088">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337100">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337156">re</span><span class="op" id="5337158">.</span><span class="ident" id="5337159">Rune</span>&nbsp;<span class="op" id="5337164">=</span>&nbsp;<span class="ident" id="5337166">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337173">class</span>&nbsp;<span class="op" id="5337179">=</span>&nbsp;<span class="ident" id="5337181">cleanClass</span><span class="op" id="5337191">(</span><span class="op" id="5337192">&amp;</span><span class="ident" id="5337193">re</span><span class="op" id="5337195">.</span><span class="ident" id="5337196">Rune</span><span class="op" id="5337200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337203">if</span>&nbsp;<span class="ident" id="5337206">sign</span>&nbsp;<span class="op" id="5337211">&lt;</span>&nbsp;<span class="num" id="5337213">0</span>&nbsp;<span class="op" id="5337215">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337219">class</span>&nbsp;<span class="op" id="5337225">=</span>&nbsp;<span class="ident" id="5337227">negateClass</span><span class="op" id="5337238">(</span><span class="ident" id="5337239">class</span><span class="op" id="5337244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337250">re</span><span class="op" id="5337252">.</span><span class="ident" id="5337253">Rune</span>&nbsp;<span class="op" id="5337258">=</span>&nbsp;<span class="ident" id="5337260">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337267">p</span><span class="op" id="5337268">.</span><span class="ident" id="5337269">push</span><span class="op" id="5337273">(</span><span class="ident" id="5337274">re</span><span class="op" id="5337276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337279">return</span>&nbsp;<span class="ident" id="5337286">t</span><span class="op" id="5337287">,</span>&nbsp;<span class="ident" id="5337289">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5337293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5337296">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5337353">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5337396">func</span>&nbsp;<span class="ident" id="5337401">cleanClass</span><span class="op" id="5337411">(</span><span class="ident" id="5337412">rp</span>&nbsp;<span class="op" id="5337415">*</span><span class="op" id="5337416">[</span><span class="op" id="5337417">]</span><span class="builtintype" id="5337418">rune</span><span class="op" id="5337422">)</span>&nbsp;<span class="op" id="5337424">[</span><span class="op" id="5337425">]</span><span class="builtintype" id="5337426">rune</span>&nbsp;<span class="op" id="5337431">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337435">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337491">sort</span><span class="op" id="5337495">.</span><span class="ident" id="5337496">Sort</span><span class="op" id="5337500">(</span><span class="ident" id="5337501">ranges</span><span class="op" id="5337507">{</span><span class="ident" id="5337508">rp</span><span class="op" id="5337510">}</span><span class="op" id="5337511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337515">r</span>&nbsp;<span class="op" id="5337517">:=</span>&nbsp;<span class="op" id="5337520">*</span><span class="ident" id="5337521">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337525">if</span>&nbsp;<span class="builtinfunc" id="5337528">len</span><span class="op" id="5337531">(</span><span class="ident" id="5337532">r</span><span class="op" id="5337533">)</span>&nbsp;<span class="op" id="5337535">&lt;</span>&nbsp;<span class="num" id="5337537">2</span>&nbsp;<span class="op" id="5337539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337543">return</span>&nbsp;<span class="ident" id="5337550">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337557">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337590">w</span>&nbsp;<span class="op" id="5337592">:=</span>&nbsp;<span class="num" id="5337595">2</span>&nbsp;<span class="comment" id="5337597">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337613">for</span>&nbsp;<span class="ident" id="5337617">i</span>&nbsp;<span class="op" id="5337619">:=</span>&nbsp;<span class="num" id="5337622">2</span><span class="op" id="5337623">;</span>&nbsp;<span class="ident" id="5337625">i</span>&nbsp;<span class="op" id="5337627">&lt;</span>&nbsp;<span class="builtinfunc" id="5337629">len</span><span class="op" id="5337632">(</span><span class="ident" id="5337633">r</span><span class="op" id="5337634">)</span><span class="op" id="5337635">;</span>&nbsp;<span class="ident" id="5337637">i</span>&nbsp;<span class="op" id="5337639">+=</span>&nbsp;<span class="num" id="5337642">2</span>&nbsp;<span class="op" id="5337644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337648">lo</span><span class="op" id="5337650">,</span>&nbsp;<span class="ident" id="5337652">hi</span>&nbsp;<span class="op" id="5337655">:=</span>&nbsp;<span class="ident" id="5337658">r</span><span class="op" id="5337659">[</span><span class="ident" id="5337660">i</span><span class="op" id="5337661">]</span><span class="op" id="5337662">,</span>&nbsp;<span class="ident" id="5337664">r</span><span class="op" id="5337665">[</span><span class="ident" id="5337666">i</span><span class="op" id="5337667">+</span><span class="num" id="5337668">1</span><span class="op" id="5337669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337673">if</span>&nbsp;<span class="ident" id="5337676">lo</span>&nbsp;<span class="op" id="5337679">&lt;=</span>&nbsp;<span class="ident" id="5337682">r</span><span class="op" id="5337683">[</span><span class="ident" id="5337684">w</span><span class="op" id="5337685">-</span><span class="num" id="5337686">1</span><span class="op" id="5337687">]</span><span class="op" id="5337688">+</span><span class="num" id="5337689">1</span>&nbsp;<span class="op" id="5337691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337696">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337728">if</span>&nbsp;<span class="ident" id="5337731">hi</span>&nbsp;<span class="op" id="5337734">&gt;</span>&nbsp;<span class="ident" id="5337736">r</span><span class="op" id="5337737">[</span><span class="ident" id="5337738">w</span><span class="op" id="5337739">-</span><span class="num" id="5337740">1</span><span class="op" id="5337741">]</span>&nbsp;<span class="op" id="5337743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337749">r</span><span class="op" id="5337750">[</span><span class="ident" id="5337751">w</span><span class="op" id="5337752">-</span><span class="num" id="5337753">1</span><span class="op" id="5337754">]</span>&nbsp;<span class="op" id="5337756">=</span>&nbsp;<span class="ident" id="5337758">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337769">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337780">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337784">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337808">r</span><span class="op" id="5337809">[</span><span class="ident" id="5337810">w</span><span class="op" id="5337811">]</span>&nbsp;<span class="op" id="5337813">=</span>&nbsp;<span class="ident" id="5337815">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337820">r</span><span class="op" id="5337821">[</span><span class="ident" id="5337822">w</span><span class="op" id="5337823">+</span><span class="num" id="5337824">1</span><span class="op" id="5337825">]</span>&nbsp;<span class="op" id="5337827">=</span>&nbsp;<span class="ident" id="5337829">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337834">w</span>&nbsp;<span class="op" id="5337836">+=</span>&nbsp;<span class="num" id="5337839">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337842">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337846">return</span>&nbsp;<span class="ident" id="5337853">r</span><span class="op" id="5337854">[</span><span class="op" id="5337855">:</span><span class="ident" id="5337856">w</span><span class="op" id="5337857">]</span><br>
<span class="lineno"></span><span class="op" id="5337859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5337862">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5337941">func</span>&nbsp;<span class="ident" id="5337946">appendLiteral</span><span class="op" id="5337959">(</span><span class="ident" id="5337960">r</span>&nbsp;<span class="op" id="5337962">[</span><span class="op" id="5337963">]</span><span class="builtintype" id="5337964">rune</span><span class="op" id="5337968">,</span>&nbsp;<span class="ident" id="5337970">x</span>&nbsp;<span class="builtintype" id="5337972">rune</span><span class="op" id="5337976">,</span>&nbsp;<span class="ident" id="5337978">flags</span>&nbsp;<span class="ident" id="5337984">Flags</span><span class="op" id="5337989">)</span>&nbsp;<span class="op" id="5337991">[</span><span class="op" id="5337992">]</span><span class="builtintype" id="5337993">rune</span>&nbsp;<span class="op" id="5337998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338001">if</span>&nbsp;<span class="ident" id="5338004">flags</span><span class="op" id="5338009">&amp;</span><span class="ident" id="5338010">FoldCase</span>&nbsp;<span class="op" id="5338019">!=</span>&nbsp;<span class="num" id="5338022">0</span>&nbsp;<span class="op" id="5338024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338028">return</span>&nbsp;<span class="ident" id="5338035">appendFoldedRange</span><span class="op" id="5338052">(</span><span class="ident" id="5338053">r</span><span class="op" id="5338054">,</span>&nbsp;<span class="ident" id="5338056">x</span><span class="op" id="5338057">,</span>&nbsp;<span class="ident" id="5338059">x</span><span class="op" id="5338060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338066">return</span>&nbsp;<span class="ident" id="5338073">appendRange</span><span class="op" id="5338084">(</span><span class="ident" id="5338085">r</span><span class="op" id="5338086">,</span>&nbsp;<span class="ident" id="5338088">x</span><span class="op" id="5338089">,</span>&nbsp;<span class="ident" id="5338091">x</span><span class="op" id="5338092">)</span><br>
<span class="lineno">1650</span><span class="op" id="5338094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5338097">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5338176">func</span>&nbsp;<span class="ident" id="5338181">appendRange</span><span class="op" id="5338192">(</span><span class="ident" id="5338193">r</span>&nbsp;<span class="op" id="5338195">[</span><span class="op" id="5338196">]</span><span class="builtintype" id="5338197">rune</span><span class="op" id="5338201">,</span>&nbsp;<span class="ident" id="5338203">lo</span><span class="op" id="5338205">,</span>&nbsp;<span class="ident" id="5338207">hi</span>&nbsp;<span class="builtintype" id="5338210">rune</span><span class="op" id="5338214">)</span>&nbsp;<span class="op" id="5338216">[</span><span class="op" id="5338217">]</span><span class="builtintype" id="5338218">rune</span>&nbsp;<span class="op" id="5338223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338226">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338295">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338352">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338414">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338439">n</span>&nbsp;<span class="op" id="5338441">:=</span>&nbsp;<span class="builtinfunc" id="5338444">len</span><span class="op" id="5338447">(</span><span class="ident" id="5338448">r</span><span class="op" id="5338449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338452">for</span>&nbsp;<span class="ident" id="5338456">i</span>&nbsp;<span class="op" id="5338458">:=</span>&nbsp;<span class="num" id="5338461">2</span><span class="op" id="5338462">;</span>&nbsp;<span class="ident" id="5338464">i</span>&nbsp;<span class="op" id="5338466">&lt;=</span>&nbsp;<span class="num" id="5338469">4</span><span class="op" id="5338470">;</span>&nbsp;<span class="ident" id="5338472">i</span>&nbsp;<span class="op" id="5338474">+=</span>&nbsp;<span class="num" id="5338477">2</span>&nbsp;<span class="op" id="5338479">{</span>&nbsp;<span class="comment" id="5338481">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338508">if</span>&nbsp;<span class="ident" id="5338511">n</span>&nbsp;<span class="op" id="5338513">&gt;=</span>&nbsp;<span class="ident" id="5338516">i</span>&nbsp;<span class="op" id="5338518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338523">rlo</span><span class="op" id="5338526">,</span>&nbsp;<span class="ident" id="5338528">rhi</span>&nbsp;<span class="op" id="5338532">:=</span>&nbsp;<span class="ident" id="5338535">r</span><span class="op" id="5338536">[</span><span class="ident" id="5338537">n</span><span class="op" id="5338538">-</span><span class="ident" id="5338539">i</span><span class="op" id="5338540">]</span><span class="op" id="5338541">,</span>&nbsp;<span class="ident" id="5338543">r</span><span class="op" id="5338544">[</span><span class="ident" id="5338545">n</span><span class="op" id="5338546">-</span><span class="ident" id="5338547">i</span><span class="op" id="5338548">+</span><span class="num" id="5338549">1</span><span class="op" id="5338550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338555">if</span>&nbsp;<span class="ident" id="5338558">lo</span>&nbsp;<span class="op" id="5338561">&lt;=</span>&nbsp;<span class="ident" id="5338564">rhi</span><span class="op" id="5338567">+</span><span class="num" id="5338568">1</span>&nbsp;<span class="op" id="5338570">&amp;&amp;</span>&nbsp;<span class="ident" id="5338573">rlo</span>&nbsp;<span class="op" id="5338577">&lt;=</span>&nbsp;<span class="ident" id="5338580">hi</span><span class="op" id="5338582">+</span><span class="num" id="5338583">1</span>&nbsp;<span class="op" id="5338585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338591">if</span>&nbsp;<span class="ident" id="5338594">lo</span>&nbsp;<span class="op" id="5338597">&lt;</span>&nbsp;<span class="ident" id="5338599">rlo</span>&nbsp;<span class="op" id="5338603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338610">r</span><span class="op" id="5338611">[</span><span class="ident" id="5338612">n</span><span class="op" id="5338613">-</span><span class="ident" id="5338614">i</span><span class="op" id="5338615">]</span>&nbsp;<span class="op" id="5338617">=</span>&nbsp;<span class="ident" id="5338619">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338632">if</span>&nbsp;<span class="ident" id="5338635">hi</span>&nbsp;<span class="op" id="5338638">&gt;</span>&nbsp;<span class="ident" id="5338640">rhi</span>&nbsp;<span class="op" id="5338644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338651">r</span><span class="op" id="5338652">[</span><span class="ident" id="5338653">n</span><span class="op" id="5338654">-</span><span class="ident" id="5338655">i</span><span class="op" id="5338656">+</span><span class="num" id="5338657">1</span><span class="op" id="5338658">]</span>&nbsp;<span class="op" id="5338660">=</span>&nbsp;<span class="ident" id="5338662">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338675">return</span>&nbsp;<span class="ident" id="5338682">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338698">return</span>&nbsp;<span class="builtinfunc" id="5338705">append</span><span class="op" id="5338711">(</span><span class="ident" id="5338712">r</span><span class="op" id="5338713">,</span>&nbsp;<span class="ident" id="5338715">lo</span><span class="op" id="5338717">,</span>&nbsp;<span class="ident" id="5338719">hi</span><span class="op" id="5338721">)</span><br>
<span class="lineno">1675</span><span class="op" id="5338723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5338726">const</span>&nbsp;<span class="op" id="5338732">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338735">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338786">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338811">minFold</span>&nbsp;<span class="op" id="5338819">=</span>&nbsp;<span class="num" id="5338821">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338829">maxFold</span>&nbsp;<span class="op" id="5338837">=</span>&nbsp;<span class="num" id="5338839">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5338847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5338850">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5338919">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5338976">func</span>&nbsp;<span class="ident" id="5338981">appendFoldedRange</span><span class="op" id="5338998">(</span><span class="ident" id="5338999">r</span>&nbsp;<span class="op" id="5339001">[</span><span class="op" id="5339002">]</span><span class="builtintype" id="5339003">rune</span><span class="op" id="5339007">,</span>&nbsp;<span class="ident" id="5339009">lo</span><span class="op" id="5339011">,</span>&nbsp;<span class="ident" id="5339013">hi</span>&nbsp;<span class="builtintype" id="5339016">rune</span><span class="op" id="5339020">)</span>&nbsp;<span class="op" id="5339022">[</span><span class="op" id="5339023">]</span><span class="builtintype" id="5339024">rune</span>&nbsp;<span class="op" id="5339029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339032">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339051">if</span>&nbsp;<span class="ident" id="5339054">lo</span>&nbsp;<span class="op" id="5339057">&lt;=</span>&nbsp;<span class="ident" id="5339060">minFold</span>&nbsp;<span class="op" id="5339068">&amp;&amp;</span>&nbsp;<span class="ident" id="5339071">hi</span>&nbsp;<span class="op" id="5339074">&gt;=</span>&nbsp;<span class="ident" id="5339077">maxFold</span>&nbsp;<span class="op" id="5339085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339089">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339133">return</span>&nbsp;<span class="ident" id="5339140">appendRange</span><span class="op" id="5339151">(</span><span class="ident" id="5339152">r</span><span class="op" id="5339153">,</span>&nbsp;<span class="ident" id="5339155">lo</span><span class="op" id="5339157">,</span>&nbsp;<span class="ident" id="5339159">hi</span><span class="op" id="5339161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339167">if</span>&nbsp;<span class="ident" id="5339170">hi</span>&nbsp;<span class="op" id="5339173">&lt;</span>&nbsp;<span class="ident" id="5339175">minFold</span>&nbsp;<span class="op" id="5339183">||</span>&nbsp;<span class="ident" id="5339186">lo</span>&nbsp;<span class="op" id="5339189">&gt;</span>&nbsp;<span class="ident" id="5339191">maxFold</span>&nbsp;<span class="op" id="5339199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339203">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339248">return</span>&nbsp;<span class="ident" id="5339255">appendRange</span><span class="op" id="5339266">(</span><span class="ident" id="5339267">r</span><span class="op" id="5339268">,</span>&nbsp;<span class="ident" id="5339270">lo</span><span class="op" id="5339272">,</span>&nbsp;<span class="ident" id="5339274">hi</span><span class="op" id="5339276">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339282">if</span>&nbsp;<span class="ident" id="5339285">lo</span>&nbsp;<span class="op" id="5339288">&lt;</span>&nbsp;<span class="ident" id="5339290">minFold</span>&nbsp;<span class="op" id="5339298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339302">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339341">r</span>&nbsp;<span class="op" id="5339343">=</span>&nbsp;<span class="ident" id="5339345">appendRange</span><span class="op" id="5339356">(</span><span class="ident" id="5339357">r</span><span class="op" id="5339358">,</span>&nbsp;<span class="ident" id="5339360">lo</span><span class="op" id="5339362">,</span>&nbsp;<span class="ident" id="5339364">minFold</span><span class="op" id="5339371">-</span><span class="num" id="5339372">1</span><span class="op" id="5339373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339377">lo</span>&nbsp;<span class="op" id="5339380">=</span>&nbsp;<span class="ident" id="5339382">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339394">if</span>&nbsp;<span class="ident" id="5339397">hi</span>&nbsp;<span class="op" id="5339400">&gt;</span>&nbsp;<span class="ident" id="5339402">maxFold</span>&nbsp;<span class="op" id="5339410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339414">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339453">r</span>&nbsp;<span class="op" id="5339455">=</span>&nbsp;<span class="ident" id="5339457">appendRange</span><span class="op" id="5339468">(</span><span class="ident" id="5339469">r</span><span class="op" id="5339470">,</span>&nbsp;<span class="ident" id="5339472">maxFold</span><span class="op" id="5339479">+</span><span class="num" id="5339480">1</span><span class="op" id="5339481">,</span>&nbsp;<span class="ident" id="5339483">hi</span><span class="op" id="5339485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339489">hi</span>&nbsp;<span class="op" id="5339492">=</span>&nbsp;<span class="ident" id="5339494">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339507">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339578">for</span>&nbsp;<span class="ident" id="5339582">c</span>&nbsp;<span class="op" id="5339584">:=</span>&nbsp;<span class="ident" id="5339587">lo</span><span class="op" id="5339589">;</span>&nbsp;<span class="ident" id="5339591">c</span>&nbsp;<span class="op" id="5339593">&lt;=</span>&nbsp;<span class="ident" id="5339596">hi</span><span class="op" id="5339598">;</span>&nbsp;<span class="ident" id="5339600">c</span><span class="op" id="5339601">++</span>&nbsp;<span class="op" id="5339604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339608">r</span>&nbsp;<span class="op" id="5339610">=</span>&nbsp;<span class="ident" id="5339612">appendRange</span><span class="op" id="5339623">(</span><span class="ident" id="5339624">r</span><span class="op" id="5339625">,</span>&nbsp;<span class="ident" id="5339627">c</span><span class="op" id="5339628">,</span>&nbsp;<span class="ident" id="5339630">c</span><span class="op" id="5339631">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339635">f</span>&nbsp;<span class="op" id="5339637">:=</span>&nbsp;<span class="ident" id="5339640">unicode</span><span class="op" id="5339647">.</span><span class="ident" id="5339648">SimpleFold</span><span class="op" id="5339658">(</span><span class="ident" id="5339659">c</span><span class="op" id="5339660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339664">for</span>&nbsp;<span class="ident" id="5339668">f</span>&nbsp;<span class="op" id="5339670">!=</span>&nbsp;<span class="ident" id="5339673">c</span>&nbsp;<span class="op" id="5339675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339680">r</span>&nbsp;<span class="op" id="5339682">=</span>&nbsp;<span class="ident" id="5339684">appendRange</span><span class="op" id="5339695">(</span><span class="ident" id="5339696">r</span><span class="op" id="5339697">,</span>&nbsp;<span class="ident" id="5339699">f</span><span class="op" id="5339700">,</span>&nbsp;<span class="ident" id="5339702">f</span><span class="op" id="5339703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339708">f</span>&nbsp;<span class="op" id="5339710">=</span>&nbsp;<span class="ident" id="5339712">unicode</span><span class="op" id="5339719">.</span><span class="ident" id="5339720">SimpleFold</span><span class="op" id="5339730">(</span><span class="ident" id="5339731">f</span><span class="op" id="5339732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339736">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339742">return</span>&nbsp;<span class="ident" id="5339749">r</span><br>
<span class="lineno"></span><span class="op" id="5339751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5339754">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5339829">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5339854">func</span>&nbsp;<span class="ident" id="5339859">appendClass</span><span class="op" id="5339870">(</span><span class="ident" id="5339871">r</span>&nbsp;<span class="op" id="5339873">[</span><span class="op" id="5339874">]</span><span class="builtintype" id="5339875">rune</span><span class="op" id="5339879">,</span>&nbsp;<span class="ident" id="5339881">x</span>&nbsp;<span class="op" id="5339883">[</span><span class="op" id="5339884">]</span><span class="builtintype" id="5339885">rune</span><span class="op" id="5339889">)</span>&nbsp;<span class="op" id="5339891">[</span><span class="op" id="5339892">]</span><span class="builtintype" id="5339893">rune</span>&nbsp;<span class="op" id="5339898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339901">for</span>&nbsp;<span class="ident" id="5339905">i</span>&nbsp;<span class="op" id="5339907">:=</span>&nbsp;<span class="num" id="5339910">0</span><span class="op" id="5339911">;</span>&nbsp;<span class="ident" id="5339913">i</span>&nbsp;<span class="op" id="5339915">&lt;</span>&nbsp;<span class="builtinfunc" id="5339917">len</span><span class="op" id="5339920">(</span><span class="ident" id="5339921">x</span><span class="op" id="5339922">)</span><span class="op" id="5339923">;</span>&nbsp;<span class="ident" id="5339925">i</span>&nbsp;<span class="op" id="5339927">+=</span>&nbsp;<span class="num" id="5339930">2</span>&nbsp;<span class="op" id="5339932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339936">r</span>&nbsp;<span class="op" id="5339938">=</span>&nbsp;<span class="ident" id="5339940">appendRange</span><span class="op" id="5339951">(</span><span class="ident" id="5339952">r</span><span class="op" id="5339953">,</span>&nbsp;<span class="ident" id="5339955">x</span><span class="op" id="5339956">[</span><span class="ident" id="5339957">i</span><span class="op" id="5339958">]</span><span class="op" id="5339959">,</span>&nbsp;<span class="ident" id="5339961">x</span><span class="op" id="5339962">[</span><span class="ident" id="5339963">i</span><span class="op" id="5339964">+</span><span class="num" id="5339965">1</span><span class="op" id="5339966">]</span><span class="op" id="5339967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5339970">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5339973">return</span>&nbsp;<span class="ident" id="5339980">r</span><br>
<span class="lineno"></span><span class="op" id="5339982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5339985">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5340081">func</span>&nbsp;<span class="ident" id="5340086">appendFoldedClass</span><span class="op" id="5340103">(</span><span class="ident" id="5340104">r</span>&nbsp;<span class="op" id="5340106">[</span><span class="op" id="5340107">]</span><span class="builtintype" id="5340108">rune</span><span class="op" id="5340112">,</span>&nbsp;<span class="ident" id="5340114">x</span>&nbsp;<span class="op" id="5340116">[</span><span class="op" id="5340117">]</span><span class="builtintype" id="5340118">rune</span><span class="op" id="5340122">)</span>&nbsp;<span class="op" id="5340124">[</span><span class="op" id="5340125">]</span><span class="builtintype" id="5340126">rune</span>&nbsp;<span class="op" id="5340131">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340134">for</span>&nbsp;<span class="ident" id="5340138">i</span>&nbsp;<span class="op" id="5340140">:=</span>&nbsp;<span class="num" id="5340143">0</span><span class="op" id="5340144">;</span>&nbsp;<span class="ident" id="5340146">i</span>&nbsp;<span class="op" id="5340148">&lt;</span>&nbsp;<span class="builtinfunc" id="5340150">len</span><span class="op" id="5340153">(</span><span class="ident" id="5340154">x</span><span class="op" id="5340155">)</span><span class="op" id="5340156">;</span>&nbsp;<span class="ident" id="5340158">i</span>&nbsp;<span class="op" id="5340160">+=</span>&nbsp;<span class="num" id="5340163">2</span>&nbsp;<span class="op" id="5340165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340169">r</span>&nbsp;<span class="op" id="5340171">=</span>&nbsp;<span class="ident" id="5340173">appendFoldedRange</span><span class="op" id="5340190">(</span><span class="ident" id="5340191">r</span><span class="op" id="5340192">,</span>&nbsp;<span class="ident" id="5340194">x</span><span class="op" id="5340195">[</span><span class="ident" id="5340196">i</span><span class="op" id="5340197">]</span><span class="op" id="5340198">,</span>&nbsp;<span class="ident" id="5340200">x</span><span class="op" id="5340201">[</span><span class="ident" id="5340202">i</span><span class="op" id="5340203">+</span><span class="num" id="5340204">1</span><span class="op" id="5340205">]</span><span class="op" id="5340206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5340209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340212">return</span>&nbsp;<span class="ident" id="5340219">r</span><br>
<span class="lineno"></span><span class="op" id="5340221">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5340224">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5340322">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5340348">func</span>&nbsp;<span class="ident" id="5340353">appendNegatedClass</span><span class="op" id="5340371">(</span><span class="ident" id="5340372">r</span>&nbsp;<span class="op" id="5340374">[</span><span class="op" id="5340375">]</span><span class="builtintype" id="5340376">rune</span><span class="op" id="5340380">,</span>&nbsp;<span class="ident" id="5340382">x</span>&nbsp;<span class="op" id="5340384">[</span><span class="op" id="5340385">]</span><span class="builtintype" id="5340386">rune</span><span class="op" id="5340390">)</span>&nbsp;<span class="op" id="5340392">[</span><span class="op" id="5340393">]</span><span class="builtintype" id="5340394">rune</span>&nbsp;<span class="op" id="5340399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340402">nextLo</span>&nbsp;<span class="op" id="5340409">:=</span>&nbsp;<span class="string" id="5340412">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340422">for</span>&nbsp;<span class="ident" id="5340426">i</span>&nbsp;<span class="op" id="5340428">:=</span>&nbsp;<span class="num" id="5340431">0</span><span class="op" id="5340432">;</span>&nbsp;<span class="ident" id="5340434">i</span>&nbsp;<span class="op" id="5340436">&lt;</span>&nbsp;<span class="builtinfunc" id="5340438">len</span><span class="op" id="5340441">(</span><span class="ident" id="5340442">x</span><span class="op" id="5340443">)</span><span class="op" id="5340444">;</span>&nbsp;<span class="ident" id="5340446">i</span>&nbsp;<span class="op" id="5340448">+=</span>&nbsp;<span class="num" id="5340451">2</span>&nbsp;<span class="op" id="5340453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340457">lo</span><span class="op" id="5340459">,</span>&nbsp;<span class="ident" id="5340461">hi</span>&nbsp;<span class="op" id="5340464">:=</span>&nbsp;<span class="ident" id="5340467">x</span><span class="op" id="5340468">[</span><span class="ident" id="5340469">i</span><span class="op" id="5340470">]</span><span class="op" id="5340471">,</span>&nbsp;<span class="ident" id="5340473">x</span><span class="op" id="5340474">[</span><span class="ident" id="5340475">i</span><span class="op" id="5340476">+</span><span class="num" id="5340477">1</span><span class="op" id="5340478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340482">if</span>&nbsp;<span class="ident" id="5340485">nextLo</span>&nbsp;<span class="op" id="5340492">&lt;=</span>&nbsp;<span class="ident" id="5340495">lo</span><span class="op" id="5340497">-</span><span class="num" id="5340498">1</span>&nbsp;<span class="op" id="5340500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340505">r</span>&nbsp;<span class="op" id="5340507">=</span>&nbsp;<span class="ident" id="5340509">appendRange</span><span class="op" id="5340520">(</span><span class="ident" id="5340521">r</span><span class="op" id="5340522">,</span>&nbsp;<span class="ident" id="5340524">nextLo</span><span class="op" id="5340530">,</span>&nbsp;<span class="ident" id="5340532">lo</span><span class="op" id="5340534">-</span><span class="num" id="5340535">1</span><span class="op" id="5340536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5340540">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340544">nextLo</span>&nbsp;<span class="op" id="5340551">=</span>&nbsp;<span class="ident" id="5340553">hi</span>&nbsp;<span class="op" id="5340556">+</span>&nbsp;<span class="num" id="5340558">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5340561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340564">if</span>&nbsp;<span class="ident" id="5340567">nextLo</span>&nbsp;<span class="op" id="5340574">&lt;=</span>&nbsp;<span class="ident" id="5340577">unicode</span><span class="op" id="5340584">.</span><span class="ident" id="5340585">MaxRune</span>&nbsp;<span class="op" id="5340593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340597">r</span>&nbsp;<span class="op" id="5340599">=</span>&nbsp;<span class="ident" id="5340601">appendRange</span><span class="op" id="5340612">(</span><span class="ident" id="5340613">r</span><span class="op" id="5340614">,</span>&nbsp;<span class="ident" id="5340616">nextLo</span><span class="op" id="5340622">,</span>&nbsp;<span class="ident" id="5340624">unicode</span><span class="op" id="5340631">.</span><span class="ident" id="5340632">MaxRune</span><span class="op" id="5340639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5340642">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340645">return</span>&nbsp;<span class="ident" id="5340652">r</span><br>
<span class="lineno"></span><span class="op" id="5340654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5340657">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5340722">func</span>&nbsp;<span class="ident" id="5340727">appendTable</span><span class="op" id="5340738">(</span><span class="ident" id="5340739">r</span>&nbsp;<span class="op" id="5340741">[</span><span class="op" id="5340742">]</span><span class="builtintype" id="5340743">rune</span><span class="op" id="5340747">,</span>&nbsp;<span class="ident" id="5340749">x</span>&nbsp;<span class="op" id="5340751">*</span><span class="ident" id="5340752">unicode</span><span class="op" id="5340759">.</span><span class="ident" id="5340760">RangeTable</span><span class="op" id="5340770">)</span>&nbsp;<span class="op" id="5340772">[</span><span class="op" id="5340773">]</span><span class="builtintype" id="5340774">rune</span>&nbsp;<span class="op" id="5340779">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340782">for</span>&nbsp;<span class="ident" id="5340786">_</span><span class="op" id="5340787">,</span>&nbsp;<span class="ident" id="5340789">xr</span>&nbsp;<span class="op" id="5340792">:=</span>&nbsp;<span class="keyword" id="5340795">range</span>&nbsp;<span class="ident" id="5340801">x</span><span class="op" id="5340802">.</span><span class="ident" id="5340803">R16</span>&nbsp;<span class="op" id="5340807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340811">lo</span><span class="op" id="5340813">,</span>&nbsp;<span class="ident" id="5340815">hi</span><span class="op" id="5340817">,</span>&nbsp;<span class="ident" id="5340819">stride</span>&nbsp;<span class="op" id="5340826">:=</span>&nbsp;<span class="builtintype" id="5340829">rune</span><span class="op" id="5340833">(</span><span class="ident" id="5340834">xr</span><span class="op" id="5340836">.</span><span class="ident" id="5340837">Lo</span><span class="op" id="5340839">)</span><span class="op" id="5340840">,</span>&nbsp;<span class="builtintype" id="5340842">rune</span><span class="op" id="5340846">(</span><span class="ident" id="5340847">xr</span><span class="op" id="5340849">.</span><span class="ident" id="5340850">Hi</span><span class="op" id="5340852">)</span><span class="op" id="5340853">,</span>&nbsp;<span class="builtintype" id="5340855">rune</span><span class="op" id="5340859">(</span><span class="ident" id="5340860">xr</span><span class="op" id="5340862">.</span><span class="ident" id="5340863">Stride</span><span class="op" id="5340869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340873">if</span>&nbsp;<span class="ident" id="5340876">stride</span>&nbsp;<span class="op" id="5340883">==</span>&nbsp;<span class="num" id="5340886">1</span>&nbsp;<span class="op" id="5340888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340893">r</span>&nbsp;<span class="op" id="5340895">=</span>&nbsp;<span class="ident" id="5340897">appendRange</span><span class="op" id="5340908">(</span><span class="ident" id="5340909">r</span><span class="op" id="5340910">,</span>&nbsp;<span class="ident" id="5340912">lo</span><span class="op" id="5340914">,</span>&nbsp;<span class="ident" id="5340916">hi</span><span class="op" id="5340918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340923">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5340934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5340938">for</span>&nbsp;<span class="ident" id="5340942">c</span>&nbsp;<span class="op" id="5340944">:=</span>&nbsp;<span class="ident" id="5340947">lo</span><span class="op" id="5340949">;</span>&nbsp;<span class="ident" id="5340951">c</span>&nbsp;<span class="op" id="5340953">&lt;=</span>&nbsp;<span class="ident" id="5340956">hi</span><span class="op" id="5340958">;</span>&nbsp;<span class="ident" id="5340960">c</span>&nbsp;<span class="op" id="5340962">+=</span>&nbsp;<span class="ident" id="5340965">stride</span>&nbsp;<span class="op" id="5340972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340977">r</span>&nbsp;<span class="op" id="5340979">=</span>&nbsp;<span class="ident" id="5340981">appendRange</span><span class="op" id="5340992">(</span><span class="ident" id="5340993">r</span><span class="op" id="5340994">,</span>&nbsp;<span class="ident" id="5340996">c</span><span class="op" id="5340997">,</span>&nbsp;<span class="ident" id="5340999">c</span><span class="op" id="5341000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341007">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341010">for</span>&nbsp;<span class="ident" id="5341014">_</span><span class="op" id="5341015">,</span>&nbsp;<span class="ident" id="5341017">xr</span>&nbsp;<span class="op" id="5341020">:=</span>&nbsp;<span class="keyword" id="5341023">range</span>&nbsp;<span class="ident" id="5341029">x</span><span class="op" id="5341030">.</span><span class="ident" id="5341031">R32</span>&nbsp;<span class="op" id="5341035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341039">lo</span><span class="op" id="5341041">,</span>&nbsp;<span class="ident" id="5341043">hi</span><span class="op" id="5341045">,</span>&nbsp;<span class="ident" id="5341047">stride</span>&nbsp;<span class="op" id="5341054">:=</span>&nbsp;<span class="builtintype" id="5341057">rune</span><span class="op" id="5341061">(</span><span class="ident" id="5341062">xr</span><span class="op" id="5341064">.</span><span class="ident" id="5341065">Lo</span><span class="op" id="5341067">)</span><span class="op" id="5341068">,</span>&nbsp;<span class="builtintype" id="5341070">rune</span><span class="op" id="5341074">(</span><span class="ident" id="5341075">xr</span><span class="op" id="5341077">.</span><span class="ident" id="5341078">Hi</span><span class="op" id="5341080">)</span><span class="op" id="5341081">,</span>&nbsp;<span class="builtintype" id="5341083">rune</span><span class="op" id="5341087">(</span><span class="ident" id="5341088">xr</span><span class="op" id="5341090">.</span><span class="ident" id="5341091">Stride</span><span class="op" id="5341097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341101">if</span>&nbsp;<span class="ident" id="5341104">stride</span>&nbsp;<span class="op" id="5341111">==</span>&nbsp;<span class="num" id="5341114">1</span>&nbsp;<span class="op" id="5341116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341121">r</span>&nbsp;<span class="op" id="5341123">=</span>&nbsp;<span class="ident" id="5341125">appendRange</span><span class="op" id="5341136">(</span><span class="ident" id="5341137">r</span><span class="op" id="5341138">,</span>&nbsp;<span class="ident" id="5341140">lo</span><span class="op" id="5341142">,</span>&nbsp;<span class="ident" id="5341144">hi</span><span class="op" id="5341146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341151">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341166">for</span>&nbsp;<span class="ident" id="5341170">c</span>&nbsp;<span class="op" id="5341172">:=</span>&nbsp;<span class="ident" id="5341175">lo</span><span class="op" id="5341177">;</span>&nbsp;<span class="ident" id="5341179">c</span>&nbsp;<span class="op" id="5341181">&lt;=</span>&nbsp;<span class="ident" id="5341184">hi</span><span class="op" id="5341186">;</span>&nbsp;<span class="ident" id="5341188">c</span>&nbsp;<span class="op" id="5341190">+=</span>&nbsp;<span class="ident" id="5341193">stride</span>&nbsp;<span class="op" id="5341200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341205">r</span>&nbsp;<span class="op" id="5341207">=</span>&nbsp;<span class="ident" id="5341209">appendRange</span><span class="op" id="5341220">(</span><span class="ident" id="5341221">r</span><span class="op" id="5341222">,</span>&nbsp;<span class="ident" id="5341224">c</span><span class="op" id="5341225">,</span>&nbsp;<span class="ident" id="5341227">c</span><span class="op" id="5341228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341235">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341238">return</span>&nbsp;<span class="ident" id="5341245">r</span><br>
<span class="lineno"></span><span class="op" id="5341247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5341250">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5341338">func</span>&nbsp;<span class="ident" id="5341343">appendNegatedTable</span><span class="op" id="5341361">(</span><span class="ident" id="5341362">r</span>&nbsp;<span class="op" id="5341364">[</span><span class="op" id="5341365">]</span><span class="builtintype" id="5341366">rune</span><span class="op" id="5341370">,</span>&nbsp;<span class="ident" id="5341372">x</span>&nbsp;<span class="op" id="5341374">*</span><span class="ident" id="5341375">unicode</span><span class="op" id="5341382">.</span><span class="ident" id="5341383">RangeTable</span><span class="op" id="5341393">)</span>&nbsp;<span class="op" id="5341395">[</span><span class="op" id="5341396">]</span><span class="builtintype" id="5341397">rune</span>&nbsp;<span class="op" id="5341402">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341405">nextLo</span>&nbsp;<span class="op" id="5341412">:=</span>&nbsp;<span class="string" id="5341415">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5341424">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341456">for</span>&nbsp;<span class="ident" id="5341460">_</span><span class="op" id="5341461">,</span>&nbsp;<span class="ident" id="5341463">xr</span>&nbsp;<span class="op" id="5341466">:=</span>&nbsp;<span class="keyword" id="5341469">range</span>&nbsp;<span class="ident" id="5341475">x</span><span class="op" id="5341476">.</span><span class="ident" id="5341477">R16</span>&nbsp;<span class="op" id="5341481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341485">lo</span><span class="op" id="5341487">,</span>&nbsp;<span class="ident" id="5341489">hi</span><span class="op" id="5341491">,</span>&nbsp;<span class="ident" id="5341493">stride</span>&nbsp;<span class="op" id="5341500">:=</span>&nbsp;<span class="builtintype" id="5341503">rune</span><span class="op" id="5341507">(</span><span class="ident" id="5341508">xr</span><span class="op" id="5341510">.</span><span class="ident" id="5341511">Lo</span><span class="op" id="5341513">)</span><span class="op" id="5341514">,</span>&nbsp;<span class="builtintype" id="5341516">rune</span><span class="op" id="5341520">(</span><span class="ident" id="5341521">xr</span><span class="op" id="5341523">.</span><span class="ident" id="5341524">Hi</span><span class="op" id="5341526">)</span><span class="op" id="5341527">,</span>&nbsp;<span class="builtintype" id="5341529">rune</span><span class="op" id="5341533">(</span><span class="ident" id="5341534">xr</span><span class="op" id="5341536">.</span><span class="ident" id="5341537">Stride</span><span class="op" id="5341543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341547">if</span>&nbsp;<span class="ident" id="5341550">stride</span>&nbsp;<span class="op" id="5341557">==</span>&nbsp;<span class="num" id="5341560">1</span>&nbsp;<span class="op" id="5341562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341567">if</span>&nbsp;<span class="ident" id="5341570">nextLo</span>&nbsp;<span class="op" id="5341577">&lt;=</span>&nbsp;<span class="ident" id="5341580">lo</span><span class="op" id="5341582">-</span><span class="num" id="5341583">1</span>&nbsp;<span class="op" id="5341585">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341591">r</span>&nbsp;<span class="op" id="5341593">=</span>&nbsp;<span class="ident" id="5341595">appendRange</span><span class="op" id="5341606">(</span><span class="ident" id="5341607">r</span><span class="op" id="5341608">,</span>&nbsp;<span class="ident" id="5341610">nextLo</span><span class="op" id="5341616">,</span>&nbsp;<span class="ident" id="5341618">lo</span><span class="op" id="5341620">-</span><span class="num" id="5341621">1</span><span class="op" id="5341622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341632">nextLo</span>&nbsp;<span class="op" id="5341639">=</span>&nbsp;<span class="ident" id="5341641">hi</span>&nbsp;<span class="op" id="5341644">+</span>&nbsp;<span class="num" id="5341646">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341651">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341662">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341666">for</span>&nbsp;<span class="ident" id="5341670">c</span>&nbsp;<span class="op" id="5341672">:=</span>&nbsp;<span class="ident" id="5341675">lo</span><span class="op" id="5341677">;</span>&nbsp;<span class="ident" id="5341679">c</span>&nbsp;<span class="op" id="5341681">&lt;=</span>&nbsp;<span class="ident" id="5341684">hi</span><span class="op" id="5341686">;</span>&nbsp;<span class="ident" id="5341688">c</span>&nbsp;<span class="op" id="5341690">+=</span>&nbsp;<span class="ident" id="5341693">stride</span>&nbsp;<span class="op" id="5341700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341705">if</span>&nbsp;<span class="ident" id="5341708">nextLo</span>&nbsp;<span class="op" id="5341715">&lt;=</span>&nbsp;<span class="ident" id="5341718">c</span><span class="op" id="5341719">-</span><span class="num" id="5341720">1</span>&nbsp;<span class="op" id="5341722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341728">r</span>&nbsp;<span class="op" id="5341730">=</span>&nbsp;<span class="ident" id="5341732">appendRange</span><span class="op" id="5341743">(</span><span class="ident" id="5341744">r</span><span class="op" id="5341745">,</span>&nbsp;<span class="ident" id="5341747">nextLo</span><span class="op" id="5341753">,</span>&nbsp;<span class="ident" id="5341755">c</span><span class="op" id="5341756">-</span><span class="num" id="5341757">1</span><span class="op" id="5341758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341768">nextLo</span>&nbsp;<span class="op" id="5341775">=</span>&nbsp;<span class="ident" id="5341777">c</span>&nbsp;<span class="op" id="5341779">+</span>&nbsp;<span class="num" id="5341781">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341791">for</span>&nbsp;<span class="ident" id="5341795">_</span><span class="op" id="5341796">,</span>&nbsp;<span class="ident" id="5341798">xr</span>&nbsp;<span class="op" id="5341801">:=</span>&nbsp;<span class="keyword" id="5341804">range</span>&nbsp;<span class="ident" id="5341810">x</span><span class="op" id="5341811">.</span><span class="ident" id="5341812">R32</span>&nbsp;<span class="op" id="5341816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341820">lo</span><span class="op" id="5341822">,</span>&nbsp;<span class="ident" id="5341824">hi</span><span class="op" id="5341826">,</span>&nbsp;<span class="ident" id="5341828">stride</span>&nbsp;<span class="op" id="5341835">:=</span>&nbsp;<span class="builtintype" id="5341838">rune</span><span class="op" id="5341842">(</span><span class="ident" id="5341843">xr</span><span class="op" id="5341845">.</span><span class="ident" id="5341846">Lo</span><span class="op" id="5341848">)</span><span class="op" id="5341849">,</span>&nbsp;<span class="builtintype" id="5341851">rune</span><span class="op" id="5341855">(</span><span class="ident" id="5341856">xr</span><span class="op" id="5341858">.</span><span class="ident" id="5341859">Hi</span><span class="op" id="5341861">)</span><span class="op" id="5341862">,</span>&nbsp;<span class="builtintype" id="5341864">rune</span><span class="op" id="5341868">(</span><span class="ident" id="5341869">xr</span><span class="op" id="5341871">.</span><span class="ident" id="5341872">Stride</span><span class="op" id="5341878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341882">if</span>&nbsp;<span class="ident" id="5341885">stride</span>&nbsp;<span class="op" id="5341892">==</span>&nbsp;<span class="num" id="5341895">1</span>&nbsp;<span class="op" id="5341897">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341902">if</span>&nbsp;<span class="ident" id="5341905">nextLo</span>&nbsp;<span class="op" id="5341912">&lt;=</span>&nbsp;<span class="ident" id="5341915">lo</span><span class="op" id="5341917">-</span><span class="num" id="5341918">1</span>&nbsp;<span class="op" id="5341920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341926">r</span>&nbsp;<span class="op" id="5341928">=</span>&nbsp;<span class="ident" id="5341930">appendRange</span><span class="op" id="5341941">(</span><span class="ident" id="5341942">r</span><span class="op" id="5341943">,</span>&nbsp;<span class="ident" id="5341945">nextLo</span><span class="op" id="5341951">,</span>&nbsp;<span class="ident" id="5341953">lo</span><span class="op" id="5341955">-</span><span class="num" id="5341956">1</span><span class="op" id="5341957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341967">nextLo</span>&nbsp;<span class="op" id="5341974">=</span>&nbsp;<span class="ident" id="5341976">hi</span>&nbsp;<span class="op" id="5341979">+</span>&nbsp;<span class="num" id="5341981">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341986">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342001">for</span>&nbsp;<span class="ident" id="5342005">c</span>&nbsp;<span class="op" id="5342007">:=</span>&nbsp;<span class="ident" id="5342010">lo</span><span class="op" id="5342012">;</span>&nbsp;<span class="ident" id="5342014">c</span>&nbsp;<span class="op" id="5342016">&lt;=</span>&nbsp;<span class="ident" id="5342019">hi</span><span class="op" id="5342021">;</span>&nbsp;<span class="ident" id="5342023">c</span>&nbsp;<span class="op" id="5342025">+=</span>&nbsp;<span class="ident" id="5342028">stride</span>&nbsp;<span class="op" id="5342035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342040">if</span>&nbsp;<span class="ident" id="5342043">nextLo</span>&nbsp;<span class="op" id="5342050">&lt;=</span>&nbsp;<span class="ident" id="5342053">c</span><span class="op" id="5342054">-</span><span class="num" id="5342055">1</span>&nbsp;<span class="op" id="5342057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342063">r</span>&nbsp;<span class="op" id="5342065">=</span>&nbsp;<span class="ident" id="5342067">appendRange</span><span class="op" id="5342078">(</span><span class="ident" id="5342079">r</span><span class="op" id="5342080">,</span>&nbsp;<span class="ident" id="5342082">nextLo</span><span class="op" id="5342088">,</span>&nbsp;<span class="ident" id="5342090">c</span><span class="op" id="5342091">-</span><span class="num" id="5342092">1</span><span class="op" id="5342093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342098">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342103">nextLo</span>&nbsp;<span class="op" id="5342110">=</span>&nbsp;<span class="ident" id="5342112">c</span>&nbsp;<span class="op" id="5342114">+</span>&nbsp;<span class="num" id="5342116">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342126">if</span>&nbsp;<span class="ident" id="5342129">nextLo</span>&nbsp;<span class="op" id="5342136">&lt;=</span>&nbsp;<span class="ident" id="5342139">unicode</span><span class="op" id="5342146">.</span><span class="ident" id="5342147">MaxRune</span>&nbsp;<span class="op" id="5342155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342159">r</span>&nbsp;<span class="op" id="5342161">=</span>&nbsp;<span class="ident" id="5342163">appendRange</span><span class="op" id="5342174">(</span><span class="ident" id="5342175">r</span><span class="op" id="5342176">,</span>&nbsp;<span class="ident" id="5342178">nextLo</span><span class="op" id="5342184">,</span>&nbsp;<span class="ident" id="5342186">unicode</span><span class="op" id="5342193">.</span><span class="ident" id="5342194">MaxRune</span><span class="op" id="5342201">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342207">return</span>&nbsp;<span class="ident" id="5342214">r</span><br>
<span class="lineno"></span><span class="op" id="5342216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5342219">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5342273">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5342317">func</span>&nbsp;<span class="ident" id="5342322">negateClass</span><span class="op" id="5342333">(</span><span class="ident" id="5342334">r</span>&nbsp;<span class="op" id="5342336">[</span><span class="op" id="5342337">]</span><span class="builtintype" id="5342338">rune</span><span class="op" id="5342342">)</span>&nbsp;<span class="op" id="5342344">[</span><span class="op" id="5342345">]</span><span class="builtintype" id="5342346">rune</span>&nbsp;<span class="op" id="5342351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342354">nextLo</span>&nbsp;<span class="op" id="5342361">:=</span>&nbsp;<span class="string" id="5342364">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5342373">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342405">w</span>&nbsp;<span class="op" id="5342407">:=</span>&nbsp;<span class="num" id="5342410">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342424">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342440">for</span>&nbsp;<span class="ident" id="5342444">i</span>&nbsp;<span class="op" id="5342446">:=</span>&nbsp;<span class="num" id="5342449">0</span><span class="op" id="5342450">;</span>&nbsp;<span class="ident" id="5342452">i</span>&nbsp;<span class="op" id="5342454">&lt;</span>&nbsp;<span class="builtinfunc" id="5342456">len</span><span class="op" id="5342459">(</span><span class="ident" id="5342460">r</span><span class="op" id="5342461">)</span><span class="op" id="5342462">;</span>&nbsp;<span class="ident" id="5342464">i</span>&nbsp;<span class="op" id="5342466">+=</span>&nbsp;<span class="num" id="5342469">2</span>&nbsp;<span class="op" id="5342471">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342475">lo</span><span class="op" id="5342477">,</span>&nbsp;<span class="ident" id="5342479">hi</span>&nbsp;<span class="op" id="5342482">:=</span>&nbsp;<span class="ident" id="5342485">r</span><span class="op" id="5342486">[</span><span class="ident" id="5342487">i</span><span class="op" id="5342488">]</span><span class="op" id="5342489">,</span>&nbsp;<span class="ident" id="5342491">r</span><span class="op" id="5342492">[</span><span class="ident" id="5342493">i</span><span class="op" id="5342494">+</span><span class="num" id="5342495">1</span><span class="op" id="5342496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342500">if</span>&nbsp;<span class="ident" id="5342503">nextLo</span>&nbsp;<span class="op" id="5342510">&lt;=</span>&nbsp;<span class="ident" id="5342513">lo</span><span class="op" id="5342515">-</span><span class="num" id="5342516">1</span>&nbsp;<span class="op" id="5342518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342523">r</span><span class="op" id="5342524">[</span><span class="ident" id="5342525">w</span><span class="op" id="5342526">]</span>&nbsp;<span class="op" id="5342528">=</span>&nbsp;<span class="ident" id="5342530">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342540">r</span><span class="op" id="5342541">[</span><span class="ident" id="5342542">w</span><span class="op" id="5342543">+</span><span class="num" id="5342544">1</span><span class="op" id="5342545">]</span>&nbsp;<span class="op" id="5342547">=</span>&nbsp;<span class="ident" id="5342549">lo</span>&nbsp;<span class="op" id="5342552">-</span>&nbsp;<span class="num" id="5342554">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342559">w</span>&nbsp;<span class="op" id="5342561">+=</span>&nbsp;<span class="num" id="5342564">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342572">nextLo</span>&nbsp;<span class="op" id="5342579">=</span>&nbsp;<span class="ident" id="5342581">hi</span>&nbsp;<span class="op" id="5342584">+</span>&nbsp;<span class="num" id="5342586">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342592">r</span>&nbsp;<span class="op" id="5342594">=</span>&nbsp;<span class="ident" id="5342596">r</span><span class="op" id="5342597">[</span><span class="op" id="5342598">:</span><span class="ident" id="5342599">w</span><span class="op" id="5342600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342603">if</span>&nbsp;<span class="ident" id="5342606">nextLo</span>&nbsp;<span class="op" id="5342613">&lt;=</span>&nbsp;<span class="ident" id="5342616">unicode</span><span class="op" id="5342623">.</span><span class="ident" id="5342624">MaxRune</span>&nbsp;<span class="op" id="5342632">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5342636">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5342689">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342753">r</span>&nbsp;<span class="op" id="5342755">=</span>&nbsp;<span class="builtinfunc" id="5342757">append</span><span class="op" id="5342763">(</span><span class="ident" id="5342764">r</span><span class="op" id="5342765">,</span>&nbsp;<span class="ident" id="5342767">nextLo</span><span class="op" id="5342773">,</span>&nbsp;<span class="ident" id="5342775">unicode</span><span class="op" id="5342782">.</span><span class="ident" id="5342783">MaxRune</span><span class="op" id="5342790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342796">return</span>&nbsp;<span class="ident" id="5342803">r</span><br>
<span class="lineno">1840</span><span class="op" id="5342805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5342808">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5342857">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5342910">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5342960">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5342974">type</span>&nbsp;<span class="ident" id="5342979">ranges</span>&nbsp;<span class="keyword" id="5342986">struct</span>&nbsp;<span class="op" id="5342993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342996">p</span>&nbsp;<span class="op" id="5342998">*</span><span class="op" id="5342999">[</span><span class="op" id="5343000">]</span><span class="builtintype" id="5343001">rune</span><br>
<span class="lineno"></span><span class="op" id="5343006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5343009">func</span>&nbsp;<span class="op" id="5343014">(</span><span class="ident" id="5343015">ra</span>&nbsp;<span class="ident" id="5343018">ranges</span><span class="op" id="5343024">)</span>&nbsp;<span class="ident" id="5343026">Less</span><span class="op" id="5343030">(</span><span class="ident" id="5343031">i</span><span class="op" id="5343032">,</span>&nbsp;<span class="ident" id="5343034">j</span>&nbsp;<span class="builtintype" id="5343036">int</span><span class="op" id="5343039">)</span>&nbsp;<span class="builtintype" id="5343041">bool</span>&nbsp;<span class="op" id="5343046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343049">p</span>&nbsp;<span class="op" id="5343051">:=</span>&nbsp;<span class="op" id="5343054">*</span><span class="ident" id="5343055">ra</span><span class="op" id="5343057">.</span><span class="ident" id="5343058">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343061">i</span>&nbsp;<span class="op" id="5343063">*=</span>&nbsp;<span class="num" id="5343066">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343069">j</span>&nbsp;<span class="op" id="5343071">*=</span>&nbsp;<span class="num" id="5343074">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343077">return</span>&nbsp;<span class="ident" id="5343084">p</span><span class="op" id="5343085">[</span><span class="ident" id="5343086">i</span><span class="op" id="5343087">]</span>&nbsp;<span class="op" id="5343089">&lt;</span>&nbsp;<span class="ident" id="5343091">p</span><span class="op" id="5343092">[</span><span class="ident" id="5343093">j</span><span class="op" id="5343094">]</span>&nbsp;<span class="op" id="5343096">||</span>&nbsp;<span class="ident" id="5343099">p</span><span class="op" id="5343100">[</span><span class="ident" id="5343101">i</span><span class="op" id="5343102">]</span>&nbsp;<span class="op" id="5343104">==</span>&nbsp;<span class="ident" id="5343107">p</span><span class="op" id="5343108">[</span><span class="ident" id="5343109">j</span><span class="op" id="5343110">]</span>&nbsp;<span class="op" id="5343112">&amp;&amp;</span>&nbsp;<span class="ident" id="5343115">p</span><span class="op" id="5343116">[</span><span class="ident" id="5343117">i</span><span class="op" id="5343118">+</span><span class="num" id="5343119">1</span><span class="op" id="5343120">]</span>&nbsp;<span class="op" id="5343122">&gt;</span>&nbsp;<span class="ident" id="5343124">p</span><span class="op" id="5343125">[</span><span class="ident" id="5343126">j</span><span class="op" id="5343127">+</span><span class="num" id="5343128">1</span><span class="op" id="5343129">]</span><br>
<span class="lineno">1855</span><span class="op" id="5343131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5343134">func</span>&nbsp;<span class="op" id="5343139">(</span><span class="ident" id="5343140">ra</span>&nbsp;<span class="ident" id="5343143">ranges</span><span class="op" id="5343149">)</span>&nbsp;<span class="ident" id="5343151">Len</span><span class="op" id="5343154">(</span><span class="op" id="5343155">)</span>&nbsp;<span class="builtintype" id="5343157">int</span>&nbsp;<span class="op" id="5343161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343164">return</span>&nbsp;<span class="builtinfunc" id="5343171">len</span><span class="op" id="5343174">(</span><span class="op" id="5343175">*</span><span class="ident" id="5343176">ra</span><span class="op" id="5343178">.</span><span class="ident" id="5343179">p</span><span class="op" id="5343180">)</span>&nbsp;<span class="op" id="5343182">/</span>&nbsp;<span class="num" id="5343184">2</span><br>
<span class="lineno"></span><span class="op" id="5343186">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5343189">func</span>&nbsp;<span class="op" id="5343194">(</span><span class="ident" id="5343195">ra</span>&nbsp;<span class="ident" id="5343198">ranges</span><span class="op" id="5343204">)</span>&nbsp;<span class="ident" id="5343206">Swap</span><span class="op" id="5343210">(</span><span class="ident" id="5343211">i</span><span class="op" id="5343212">,</span>&nbsp;<span class="ident" id="5343214">j</span>&nbsp;<span class="builtintype" id="5343216">int</span><span class="op" id="5343219">)</span>&nbsp;<span class="op" id="5343221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343224">p</span>&nbsp;<span class="op" id="5343226">:=</span>&nbsp;<span class="op" id="5343229">*</span><span class="ident" id="5343230">ra</span><span class="op" id="5343232">.</span><span class="ident" id="5343233">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343236">i</span>&nbsp;<span class="op" id="5343238">*=</span>&nbsp;<span class="num" id="5343241">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343244">j</span>&nbsp;<span class="op" id="5343246">*=</span>&nbsp;<span class="num" id="5343249">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343252">p</span><span class="op" id="5343253">[</span><span class="ident" id="5343254">i</span><span class="op" id="5343255">]</span><span class="op" id="5343256">,</span>&nbsp;<span class="ident" id="5343258">p</span><span class="op" id="5343259">[</span><span class="ident" id="5343260">i</span><span class="op" id="5343261">+</span><span class="num" id="5343262">1</span><span class="op" id="5343263">]</span><span class="op" id="5343264">,</span>&nbsp;<span class="ident" id="5343266">p</span><span class="op" id="5343267">[</span><span class="ident" id="5343268">j</span><span class="op" id="5343269">]</span><span class="op" id="5343270">,</span>&nbsp;<span class="ident" id="5343272">p</span><span class="op" id="5343273">[</span><span class="ident" id="5343274">j</span><span class="op" id="5343275">+</span><span class="num" id="5343276">1</span><span class="op" id="5343277">]</span>&nbsp;<span class="op" id="5343279">=</span>&nbsp;<span class="ident" id="5343281">p</span><span class="op" id="5343282">[</span><span class="ident" id="5343283">j</span><span class="op" id="5343284">]</span><span class="op" id="5343285">,</span>&nbsp;<span class="ident" id="5343287">p</span><span class="op" id="5343288">[</span><span class="ident" id="5343289">j</span><span class="op" id="5343290">+</span><span class="num" id="5343291">1</span><span class="op" id="5343292">]</span><span class="op" id="5343293">,</span>&nbsp;<span class="ident" id="5343295">p</span><span class="op" id="5343296">[</span><span class="ident" id="5343297">i</span><span class="op" id="5343298">]</span><span class="op" id="5343299">,</span>&nbsp;<span class="ident" id="5343301">p</span><span class="op" id="5343302">[</span><span class="ident" id="5343303">i</span><span class="op" id="5343304">+</span><span class="num" id="5343305">1</span><span class="op" id="5343306">]</span><br>
<span class="lineno"></span><span class="op" id="5343308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5343311">func</span>&nbsp;<span class="ident" id="5343316">checkUTF8</span><span class="op" id="5343325">(</span><span class="ident" id="5343326">s</span>&nbsp;<span class="builtintype" id="5343328">string</span><span class="op" id="5343334">)</span>&nbsp;<span class="builtintype" id="5343336">error</span>&nbsp;<span class="op" id="5343342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343345">for</span>&nbsp;<span class="ident" id="5343349">s</span>&nbsp;<span class="op" id="5343351">!=</span>&nbsp;<span class="string" id="5343354">&#34;&#34;</span>&nbsp;<span class="op" id="5343357">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5343361">rune</span><span class="op" id="5343365">,</span>&nbsp;<span class="ident" id="5343367">size</span>&nbsp;<span class="op" id="5343372">:=</span>&nbsp;<span class="ident" id="5343375">utf8</span><span class="op" id="5343379">.</span><span class="ident" id="5343380">DecodeRuneInString</span><span class="op" id="5343398">(</span><span class="ident" id="5343399">s</span><span class="op" id="5343400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343404">if</span>&nbsp;<span class="builtintype" id="5343407">rune</span>&nbsp;<span class="op" id="5343412">==</span>&nbsp;<span class="ident" id="5343415">utf8</span><span class="op" id="5343419">.</span><span class="ident" id="5343420">RuneError</span>&nbsp;<span class="op" id="5343430">&amp;&amp;</span>&nbsp;<span class="ident" id="5343433">size</span>&nbsp;<span class="op" id="5343438">==</span>&nbsp;<span class="num" id="5343441">1</span>&nbsp;<span class="op" id="5343443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343448">return</span>&nbsp;<span class="op" id="5343455">&amp;</span><span class="ident" id="5343456">Error</span><span class="op" id="5343461">{</span><span class="ident" id="5343462">Code</span><span class="op" id="5343466">:</span>&nbsp;<span class="ident" id="5343468">ErrInvalidUTF8</span><span class="op" id="5343482">,</span>&nbsp;<span class="ident" id="5343484">Expr</span><span class="op" id="5343488">:</span>&nbsp;<span class="ident" id="5343490">s</span><span class="op" id="5343491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343499">s</span>&nbsp;<span class="op" id="5343501">=</span>&nbsp;<span class="ident" id="5343503">s</span><span class="op" id="5343504">[</span><span class="ident" id="5343505">size</span><span class="op" id="5343509">:</span><span class="op" id="5343510">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343516">return</span>&nbsp;<span class="ident" id="5343523">nil</span><br>
<span class="lineno"></span><span class="op" id="5343527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5343530">func</span>&nbsp;<span class="ident" id="5343535">nextRune</span><span class="op" id="5343543">(</span><span class="ident" id="5343544">s</span>&nbsp;<span class="builtintype" id="5343546">string</span><span class="op" id="5343552">)</span>&nbsp;<span class="op" id="5343554">(</span><span class="ident" id="5343555">c</span>&nbsp;<span class="builtintype" id="5343557">rune</span><span class="op" id="5343561">,</span>&nbsp;<span class="ident" id="5343563">t</span>&nbsp;<span class="builtintype" id="5343565">string</span><span class="op" id="5343571">,</span>&nbsp;<span class="ident" id="5343573">err</span>&nbsp;<span class="builtintype" id="5343577">error</span><span class="op" id="5343582">)</span>&nbsp;<span class="op" id="5343584">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343587">c</span><span class="op" id="5343588">,</span>&nbsp;<span class="ident" id="5343590">size</span>&nbsp;<span class="op" id="5343595">:=</span>&nbsp;<span class="ident" id="5343598">utf8</span><span class="op" id="5343602">.</span><span class="ident" id="5343603">DecodeRuneInString</span><span class="op" id="5343621">(</span><span class="ident" id="5343622">s</span><span class="op" id="5343623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343626">if</span>&nbsp;<span class="ident" id="5343629">c</span>&nbsp;<span class="op" id="5343631">==</span>&nbsp;<span class="ident" id="5343634">utf8</span><span class="op" id="5343638">.</span><span class="ident" id="5343639">RuneError</span>&nbsp;<span class="op" id="5343649">&amp;&amp;</span>&nbsp;<span class="ident" id="5343652">size</span>&nbsp;<span class="op" id="5343657">==</span>&nbsp;<span class="num" id="5343660">1</span>&nbsp;<span class="op" id="5343662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343666">return</span>&nbsp;<span class="num" id="5343673">0</span><span class="op" id="5343674">,</span>&nbsp;<span class="string" id="5343676">&#34;&#34;</span><span class="op" id="5343678">,</span>&nbsp;<span class="op" id="5343680">&amp;</span><span class="ident" id="5343681">Error</span><span class="op" id="5343686">{</span><span class="ident" id="5343687">Code</span><span class="op" id="5343691">:</span>&nbsp;<span class="ident" id="5343693">ErrInvalidUTF8</span><span class="op" id="5343707">,</span>&nbsp;<span class="ident" id="5343709">Expr</span><span class="op" id="5343713">:</span>&nbsp;<span class="ident" id="5343715">s</span><span class="op" id="5343716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343722">return</span>&nbsp;<span class="ident" id="5343729">c</span><span class="op" id="5343730">,</span>&nbsp;<span class="ident" id="5343732">s</span><span class="op" id="5343733">[</span><span class="ident" id="5343734">size</span><span class="op" id="5343738">:</span><span class="op" id="5343739">]</span><span class="op" id="5343740">,</span>&nbsp;<span class="ident" id="5343742">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5343746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5343749">func</span>&nbsp;<span class="ident" id="5343754">isalnum</span><span class="op" id="5343761">(</span><span class="ident" id="5343762">c</span>&nbsp;<span class="builtintype" id="5343764">rune</span><span class="op" id="5343768">)</span>&nbsp;<span class="builtintype" id="5343770">bool</span>&nbsp;<span class="op" id="5343775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343778">return</span>&nbsp;<span class="string" id="5343785">&#39;0&#39;</span>&nbsp;<span class="op" id="5343789">&lt;=</span>&nbsp;<span class="ident" id="5343792">c</span>&nbsp;<span class="op" id="5343794">&amp;&amp;</span>&nbsp;<span class="ident" id="5343797">c</span>&nbsp;<span class="op" id="5343799">&lt;=</span>&nbsp;<span class="string" id="5343802">&#39;9&#39;</span>&nbsp;<span class="op" id="5343806">||</span>&nbsp;<span class="string" id="5343809">&#39;A&#39;</span>&nbsp;<span class="op" id="5343813">&lt;=</span>&nbsp;<span class="ident" id="5343816">c</span>&nbsp;<span class="op" id="5343818">&amp;&amp;</span>&nbsp;<span class="ident" id="5343821">c</span>&nbsp;<span class="op" id="5343823">&lt;=</span>&nbsp;<span class="string" id="5343826">&#39;Z&#39;</span>&nbsp;<span class="op" id="5343830">||</span>&nbsp;<span class="string" id="5343833">&#39;a&#39;</span>&nbsp;<span class="op" id="5343837">&lt;=</span>&nbsp;<span class="ident" id="5343840">c</span>&nbsp;<span class="op" id="5343842">&amp;&amp;</span>&nbsp;<span class="ident" id="5343845">c</span>&nbsp;<span class="op" id="5343847">&lt;=</span>&nbsp;<span class="string" id="5343850">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5343854">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5343857">func</span>&nbsp;<span class="ident" id="5343862">unhex</span><span class="op" id="5343867">(</span><span class="ident" id="5343868">c</span>&nbsp;<span class="builtintype" id="5343870">rune</span><span class="op" id="5343874">)</span>&nbsp;<span class="builtintype" id="5343876">rune</span>&nbsp;<span class="op" id="5343881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343884">if</span>&nbsp;<span class="string" id="5343887">&#39;0&#39;</span>&nbsp;<span class="op" id="5343891">&lt;=</span>&nbsp;<span class="ident" id="5343894">c</span>&nbsp;<span class="op" id="5343896">&amp;&amp;</span>&nbsp;<span class="ident" id="5343899">c</span>&nbsp;<span class="op" id="5343901">&lt;=</span>&nbsp;<span class="string" id="5343904">&#39;9&#39;</span>&nbsp;<span class="op" id="5343908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343912">return</span>&nbsp;<span class="ident" id="5343919">c</span>&nbsp;<span class="op" id="5343921">-</span>&nbsp;<span class="string" id="5343923">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343928">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343931">if</span>&nbsp;<span class="string" id="5343934">&#39;a&#39;</span>&nbsp;<span class="op" id="5343938">&lt;=</span>&nbsp;<span class="ident" id="5343941">c</span>&nbsp;<span class="op" id="5343943">&amp;&amp;</span>&nbsp;<span class="ident" id="5343946">c</span>&nbsp;<span class="op" id="5343948">&lt;=</span>&nbsp;<span class="string" id="5343951">&#39;f&#39;</span>&nbsp;<span class="op" id="5343955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343959">return</span>&nbsp;<span class="ident" id="5343966">c</span>&nbsp;<span class="op" id="5343968">-</span>&nbsp;<span class="string" id="5343970">&#39;a&#39;</span>&nbsp;<span class="op" id="5343974">+</span>&nbsp;<span class="num" id="5343976">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343983">if</span>&nbsp;<span class="string" id="5343986">&#39;A&#39;</span>&nbsp;<span class="op" id="5343990">&lt;=</span>&nbsp;<span class="ident" id="5343993">c</span>&nbsp;<span class="op" id="5343995">&amp;&amp;</span>&nbsp;<span class="ident" id="5343998">c</span>&nbsp;<span class="op" id="5344000">&lt;=</span>&nbsp;<span class="string" id="5344003">&#39;F&#39;</span>&nbsp;<span class="op" id="5344007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344011">return</span>&nbsp;<span class="ident" id="5344018">c</span>&nbsp;<span class="op" id="5344020">-</span>&nbsp;<span class="string" id="5344022">&#39;A&#39;</span>&nbsp;<span class="op" id="5344026">+</span>&nbsp;<span class="num" id="5344028">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344035">return</span>&nbsp;<span class="op" id="5344042">-</span><span class="num" id="5344043">1</span><br>
<span class="lineno"></span><span class="op" id="5344045">}</span>
</div>
</body>
</html>
