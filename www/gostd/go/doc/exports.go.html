<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3298197">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3298252">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3298306">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3298357">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3298410">package</span>&nbsp;<span class="ident" id="3298418">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3298423">import</span>&nbsp;<span class="op" id="3298430">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3298433">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3298443">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="3298454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298457">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="3298520">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="3298580">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="3298626">//</span><br>
<span class="lineno"></span><span class="keyword" id="3298629">func</span>&nbsp;<span class="ident" id="3298634">filterIdentList</span><span class="op" id="3298649">(</span><span class="ident" id="3298650">list</span>&nbsp;<span class="op" id="3298655">[</span><span class="op" id="3298656">]</span><span class="op" id="3298657">*</span><span class="ident" id="3298658">ast</span><span class="op" id="3298661">.</span><span class="ident" id="3298662">Ident</span><span class="op" id="3298667">,</span>&nbsp;<span class="ident" id="3298669">blankOk</span>&nbsp;<span class="builtintype" id="3298677">bool</span><span class="op" id="3298681">)</span>&nbsp;<span class="op" id="3298683">[</span><span class="op" id="3298684">]</span><span class="op" id="3298685">*</span><span class="ident" id="3298686">ast</span><span class="op" id="3298689">.</span><span class="ident" id="3298690">Ident</span>&nbsp;<span class="op" id="3298696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298699">j</span>&nbsp;<span class="op" id="3298701">:=</span>&nbsp;<span class="num" id="3298704">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298707">for</span>&nbsp;<span class="ident" id="3298711">_</span><span class="op" id="3298712">,</span>&nbsp;<span class="ident" id="3298714">x</span>&nbsp;<span class="op" id="3298716">:=</span>&nbsp;<span class="keyword" id="3298719">range</span>&nbsp;<span class="ident" id="3298725">list</span>&nbsp;<span class="op" id="3298730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298734">if</span>&nbsp;<span class="ident" id="3298737">ast</span><span class="op" id="3298740">.</span><span class="ident" id="3298741">IsExported</span><span class="op" id="3298751">(</span><span class="ident" id="3298752">x</span><span class="op" id="3298753">.</span><span class="ident" id="3298754">Name</span><span class="op" id="3298758">)</span>&nbsp;<span class="op" id="3298760">||</span>&nbsp;<span class="op" id="3298763">(</span><span class="ident" id="3298764">blankOk</span>&nbsp;<span class="op" id="3298772">&amp;&amp;</span>&nbsp;<span class="ident" id="3298775">x</span><span class="op" id="3298776">.</span><span class="ident" id="3298777">Name</span>&nbsp;<span class="op" id="3298782">==</span>&nbsp;<span class="string" id="3298785">&#34;_&#34;</span><span class="op" id="3298788">)</span>&nbsp;<span class="op" id="3298790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298795">list</span><span class="op" id="3298799">[</span><span class="ident" id="3298800">j</span><span class="op" id="3298801">]</span>&nbsp;<span class="op" id="3298803">=</span>&nbsp;<span class="ident" id="3298805">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3298810">j</span><span class="op" id="3298811">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3298816">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3298819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3298822">return</span>&nbsp;<span class="ident" id="3298829">list</span><span class="op" id="3298833">[</span><span class="num" id="3298834">0</span><span class="op" id="3298835">:</span><span class="ident" id="3298836">j</span><span class="op" id="3298837">]</span><br>
<span class="lineno"></span><span class="op" id="3298839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298842">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="3298920">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="3298991">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3299020">//</span><br>
<span class="lineno"></span><span class="keyword" id="3299023">func</span>&nbsp;<span class="ident" id="3299028">removeErrorField</span><span class="op" id="3299044">(</span><span class="ident" id="3299045">ityp</span>&nbsp;<span class="op" id="3299050">*</span><span class="ident" id="3299051">ast</span><span class="op" id="3299054">.</span><span class="ident" id="3299055">InterfaceType</span><span class="op" id="3299068">)</span>&nbsp;<span class="op" id="3299070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299073">list</span>&nbsp;<span class="op" id="3299078">:=</span>&nbsp;<span class="ident" id="3299081">ityp</span><span class="op" id="3299085">.</span><span class="ident" id="3299086">Methods</span><span class="op" id="3299093">.</span><span class="ident" id="3299094">List</span>&nbsp;<span class="comment" id="3299099">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299136">j</span>&nbsp;<span class="op" id="3299138">:=</span>&nbsp;<span class="num" id="3299141">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299144">for</span>&nbsp;<span class="ident" id="3299148">_</span><span class="op" id="3299149">,</span>&nbsp;<span class="ident" id="3299151">field</span>&nbsp;<span class="op" id="3299157">:=</span>&nbsp;<span class="keyword" id="3299160">range</span>&nbsp;<span class="ident" id="3299166">list</span>&nbsp;<span class="op" id="3299171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299175">keepField</span>&nbsp;<span class="op" id="3299185">:=</span>&nbsp;<span class="builtintype" id="3299188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299195">if</span>&nbsp;<span class="ident" id="3299198">n</span>&nbsp;<span class="op" id="3299200">:=</span>&nbsp;<span class="builtinfunc" id="3299203">len</span><span class="op" id="3299206">(</span><span class="ident" id="3299207">field</span><span class="op" id="3299212">.</span><span class="ident" id="3299213">Names</span><span class="op" id="3299218">)</span><span class="op" id="3299219">;</span>&nbsp;<span class="ident" id="3299221">n</span>&nbsp;<span class="op" id="3299223">==</span>&nbsp;<span class="num" id="3299226">0</span>&nbsp;<span class="op" id="3299228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3299233">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299255">if</span>&nbsp;<span class="ident" id="3299258">fname</span><span class="op" id="3299263">,</span>&nbsp;<span class="ident" id="3299265">_</span>&nbsp;<span class="op" id="3299267">:=</span>&nbsp;<span class="ident" id="3299270">baseTypeName</span><span class="op" id="3299282">(</span><span class="ident" id="3299283">field</span><span class="op" id="3299288">.</span><span class="ident" id="3299289">Type</span><span class="op" id="3299293">)</span><span class="op" id="3299294">;</span>&nbsp;<span class="ident" id="3299296">fname</span>&nbsp;<span class="op" id="3299302">==</span>&nbsp;<span class="string" id="3299305">&#34;error&#34;</span>&nbsp;<span class="op" id="3299313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299319">keepField</span>&nbsp;<span class="op" id="3299329">=</span>&nbsp;<span class="builtintype" id="3299331">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299348">if</span>&nbsp;<span class="ident" id="3299351">keepField</span>&nbsp;<span class="op" id="3299361">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299366">list</span><span class="op" id="3299370">[</span><span class="ident" id="3299371">j</span><span class="op" id="3299372">]</span>&nbsp;<span class="op" id="3299374">=</span>&nbsp;<span class="ident" id="3299376">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299385">j</span><span class="op" id="3299386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299397">if</span>&nbsp;<span class="ident" id="3299400">j</span>&nbsp;<span class="op" id="3299402">&lt;</span>&nbsp;<span class="builtinfunc" id="3299404">len</span><span class="op" id="3299407">(</span><span class="ident" id="3299408">list</span><span class="op" id="3299412">)</span>&nbsp;<span class="op" id="3299414">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299418">ityp</span><span class="op" id="3299422">.</span><span class="ident" id="3299423">Incomplete</span>&nbsp;<span class="op" id="3299434">=</span>&nbsp;<span class="builtintype" id="3299436">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299445">ityp</span><span class="op" id="3299449">.</span><span class="ident" id="3299450">Methods</span><span class="op" id="3299457">.</span><span class="ident" id="3299458">List</span>&nbsp;<span class="op" id="3299463">=</span>&nbsp;<span class="ident" id="3299465">list</span><span class="op" id="3299469">[</span><span class="num" id="3299470">0</span><span class="op" id="3299471">:</span><span class="ident" id="3299472">j</span><span class="op" id="3299473">]</span><br>
<span class="lineno"></span><span class="op" id="3299475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3299478">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3299557">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3299631">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3299704">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3299729">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3299732">func</span>&nbsp;<span class="op" id="3299737">(</span><span class="ident" id="3299738">r</span>&nbsp;<span class="op" id="3299740">*</span><span class="ident" id="3299741">reader</span><span class="op" id="3299747">)</span>&nbsp;<span class="ident" id="3299749">filterFieldList</span><span class="op" id="3299764">(</span><span class="ident" id="3299765">parent</span>&nbsp;<span class="op" id="3299772">*</span><span class="ident" id="3299773">namedType</span><span class="op" id="3299782">,</span>&nbsp;<span class="ident" id="3299784">fields</span>&nbsp;<span class="op" id="3299791">*</span><span class="ident" id="3299792">ast</span><span class="op" id="3299795">.</span><span class="ident" id="3299796">FieldList</span><span class="op" id="3299805">,</span>&nbsp;<span class="ident" id="3299807">ityp</span>&nbsp;<span class="op" id="3299812">*</span><span class="ident" id="3299813">ast</span><span class="op" id="3299816">.</span><span class="ident" id="3299817">InterfaceType</span><span class="op" id="3299830">)</span>&nbsp;<span class="op" id="3299832">(</span><span class="ident" id="3299833">removedFields</span>&nbsp;<span class="builtintype" id="3299847">bool</span><span class="op" id="3299851">)</span>&nbsp;<span class="op" id="3299853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299856">if</span>&nbsp;<span class="ident" id="3299859">fields</span>&nbsp;<span class="op" id="3299866">==</span>&nbsp;<span class="ident" id="3299869">nil</span>&nbsp;<span class="op" id="3299873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299877">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3299885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299888">list</span>&nbsp;<span class="op" id="3299893">:=</span>&nbsp;<span class="ident" id="3299896">fields</span><span class="op" id="3299902">.</span><span class="ident" id="3299903">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299909">j</span>&nbsp;<span class="op" id="3299911">:=</span>&nbsp;<span class="num" id="3299914">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299917">for</span>&nbsp;<span class="ident" id="3299921">_</span><span class="op" id="3299922">,</span>&nbsp;<span class="ident" id="3299924">field</span>&nbsp;<span class="op" id="3299930">:=</span>&nbsp;<span class="keyword" id="3299933">range</span>&nbsp;<span class="ident" id="3299939">list</span>&nbsp;<span class="op" id="3299944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3299948">keepField</span>&nbsp;<span class="op" id="3299958">:=</span>&nbsp;<span class="builtintype" id="3299961">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3299969">if</span>&nbsp;<span class="ident" id="3299972">n</span>&nbsp;<span class="op" id="3299974">:=</span>&nbsp;<span class="builtinfunc" id="3299977">len</span><span class="op" id="3299980">(</span><span class="ident" id="3299981">field</span><span class="op" id="3299986">.</span><span class="ident" id="3299987">Names</span><span class="op" id="3299992">)</span><span class="op" id="3299993">;</span>&nbsp;<span class="ident" id="3299995">n</span>&nbsp;<span class="op" id="3299997">==</span>&nbsp;<span class="num" id="3300000">0</span>&nbsp;<span class="op" id="3300002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300007">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300029">fname</span>&nbsp;<span class="op" id="3300035">:=</span>&nbsp;<span class="ident" id="3300038">r</span><span class="op" id="3300039">.</span><span class="ident" id="3300040">recordAnonymousField</span><span class="op" id="3300060">(</span><span class="ident" id="3300061">parent</span><span class="op" id="3300067">,</span>&nbsp;<span class="ident" id="3300069">field</span><span class="op" id="3300074">.</span><span class="ident" id="3300075">Type</span><span class="op" id="3300079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300084">if</span>&nbsp;<span class="ident" id="3300087">ast</span><span class="op" id="3300090">.</span><span class="ident" id="3300091">IsExported</span><span class="op" id="3300101">(</span><span class="ident" id="3300102">fname</span><span class="op" id="3300107">)</span>&nbsp;<span class="op" id="3300109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300115">keepField</span>&nbsp;<span class="op" id="3300125">=</span>&nbsp;<span class="builtintype" id="3300127">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300135">}</span>&nbsp;<span class="keyword" id="3300137">else</span>&nbsp;<span class="keyword" id="3300142">if</span>&nbsp;<span class="ident" id="3300145">ityp</span>&nbsp;<span class="op" id="3300150">!=</span>&nbsp;<span class="ident" id="3300153">nil</span>&nbsp;<span class="op" id="3300157">&amp;&amp;</span>&nbsp;<span class="ident" id="3300160">fname</span>&nbsp;<span class="op" id="3300166">==</span>&nbsp;<span class="string" id="3300169">&#34;error&#34;</span>&nbsp;<span class="op" id="3300177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300183">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300237">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3300291">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300347">keepField</span>&nbsp;<span class="op" id="3300357">=</span>&nbsp;<span class="builtintype" id="3300359">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300368">r</span><span class="op" id="3300369">.</span><span class="ident" id="3300370">remember</span><span class="op" id="3300378">(</span><span class="ident" id="3300379">ityp</span><span class="op" id="3300383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300388">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300392">}</span>&nbsp;<span class="keyword" id="3300394">else</span>&nbsp;<span class="op" id="3300399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300404">field</span><span class="op" id="3300409">.</span><span class="ident" id="3300410">Names</span>&nbsp;<span class="op" id="3300416">=</span>&nbsp;<span class="ident" id="3300418">filterIdentList</span><span class="op" id="3300433">(</span><span class="ident" id="3300434">field</span><span class="op" id="3300439">.</span><span class="ident" id="3300440">Names</span><span class="op" id="3300445">,</span>&nbsp;<span class="builtintype" id="3300447">false</span><span class="op" id="3300452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300457">if</span>&nbsp;<span class="builtinfunc" id="3300460">len</span><span class="op" id="3300463">(</span><span class="ident" id="3300464">field</span><span class="op" id="3300469">.</span><span class="ident" id="3300470">Names</span><span class="op" id="3300475">)</span>&nbsp;<span class="op" id="3300477">&lt;</span>&nbsp;<span class="ident" id="3300479">n</span>&nbsp;<span class="op" id="3300481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300487">removedFields</span>&nbsp;<span class="op" id="3300501">=</span>&nbsp;<span class="builtintype" id="3300503">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300511">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300516">if</span>&nbsp;<span class="builtinfunc" id="3300519">len</span><span class="op" id="3300522">(</span><span class="ident" id="3300523">field</span><span class="op" id="3300528">.</span><span class="ident" id="3300529">Names</span><span class="op" id="3300534">)</span>&nbsp;<span class="op" id="3300536">&gt;</span>&nbsp;<span class="num" id="3300538">0</span>&nbsp;<span class="op" id="3300540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300546">keepField</span>&nbsp;<span class="op" id="3300556">=</span>&nbsp;<span class="builtintype" id="3300558">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300574">if</span>&nbsp;<span class="ident" id="3300577">keepField</span>&nbsp;<span class="op" id="3300587">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300592">r</span><span class="op" id="3300593">.</span><span class="ident" id="3300594">filterType</span><span class="op" id="3300604">(</span><span class="ident" id="3300605">nil</span><span class="op" id="3300608">,</span>&nbsp;<span class="ident" id="3300610">field</span><span class="op" id="3300615">.</span><span class="ident" id="3300616">Type</span><span class="op" id="3300620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300625">list</span><span class="op" id="3300629">[</span><span class="ident" id="3300630">j</span><span class="op" id="3300631">]</span>&nbsp;<span class="op" id="3300633">=</span>&nbsp;<span class="ident" id="3300635">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300644">j</span><span class="op" id="3300645">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300653">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300656">if</span>&nbsp;<span class="ident" id="3300659">j</span>&nbsp;<span class="op" id="3300661">&lt;</span>&nbsp;<span class="builtinfunc" id="3300663">len</span><span class="op" id="3300666">(</span><span class="ident" id="3300667">list</span><span class="op" id="3300671">)</span>&nbsp;<span class="op" id="3300673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300677">removedFields</span>&nbsp;<span class="op" id="3300691">=</span>&nbsp;<span class="builtintype" id="3300693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300702">fields</span><span class="op" id="3300708">.</span><span class="ident" id="3300709">List</span>&nbsp;<span class="op" id="3300714">=</span>&nbsp;<span class="ident" id="3300716">list</span><span class="op" id="3300720">[</span><span class="num" id="3300721">0</span><span class="op" id="3300722">:</span><span class="ident" id="3300723">j</span><span class="op" id="3300724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300727">return</span><br>
<span class="lineno">100</span><span class="op" id="3300734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300737">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3300809">//</span><br>
<span class="lineno"></span><span class="keyword" id="3300812">func</span>&nbsp;<span class="op" id="3300817">(</span><span class="ident" id="3300818">r</span>&nbsp;<span class="op" id="3300820">*</span><span class="ident" id="3300821">reader</span><span class="op" id="3300827">)</span>&nbsp;<span class="ident" id="3300829">filterParamList</span><span class="op" id="3300844">(</span><span class="ident" id="3300845">fields</span>&nbsp;<span class="op" id="3300852">*</span><span class="ident" id="3300853">ast</span><span class="op" id="3300856">.</span><span class="ident" id="3300857">FieldList</span><span class="op" id="3300866">)</span>&nbsp;<span class="op" id="3300868">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300871">if</span>&nbsp;<span class="ident" id="3300874">fields</span>&nbsp;<span class="op" id="3300881">!=</span>&nbsp;<span class="ident" id="3300884">nil</span>&nbsp;<span class="op" id="3300888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3300892">for</span>&nbsp;<span class="ident" id="3300896">_</span><span class="op" id="3300897">,</span>&nbsp;<span class="ident" id="3300899">f</span>&nbsp;<span class="op" id="3300901">:=</span>&nbsp;<span class="keyword" id="3300904">range</span>&nbsp;<span class="ident" id="3300910">fields</span><span class="op" id="3300916">.</span><span class="ident" id="3300917">List</span>&nbsp;<span class="op" id="3300922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3300927">r</span><span class="op" id="3300928">.</span><span class="ident" id="3300929">filterType</span><span class="op" id="3300939">(</span><span class="ident" id="3300940">nil</span><span class="op" id="3300943">,</span>&nbsp;<span class="ident" id="3300945">f</span><span class="op" id="3300946">.</span><span class="ident" id="3300947">Type</span><span class="op" id="3300951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3300958">}</span><br>
<span class="lineno">110</span><span class="op" id="3300960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300963">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="3301038">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3301111">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="3301177">//</span><br>
<span class="lineno"></span><span class="keyword" id="3301180">func</span>&nbsp;<span class="op" id="3301185">(</span><span class="ident" id="3301186">r</span>&nbsp;<span class="op" id="3301188">*</span><span class="ident" id="3301189">reader</span><span class="op" id="3301195">)</span>&nbsp;<span class="ident" id="3301197">filterType</span><span class="op" id="3301207">(</span><span class="ident" id="3301208">parent</span>&nbsp;<span class="op" id="3301215">*</span><span class="ident" id="3301216">namedType</span><span class="op" id="3301225">,</span>&nbsp;<span class="ident" id="3301227">typ</span>&nbsp;<span class="ident" id="3301231">ast</span><span class="op" id="3301234">.</span><span class="ident" id="3301235">Expr</span><span class="op" id="3301239">)</span>&nbsp;<span class="op" id="3301241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301244">switch</span>&nbsp;<span class="ident" id="3301251">t</span>&nbsp;<span class="op" id="3301253">:=</span>&nbsp;<span class="ident" id="3301256">typ</span><span class="op" id="3301259">.</span><span class="op" id="3301260">(</span><span class="keyword" id="3301261">type</span><span class="op" id="3301265">)</span>&nbsp;<span class="op" id="3301267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301270">case</span>&nbsp;<span class="op" id="3301275">*</span><span class="ident" id="3301276">ast</span><span class="op" id="3301279">.</span><span class="ident" id="3301280">Ident</span><span class="op" id="3301285">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3301289">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301307">case</span>&nbsp;<span class="op" id="3301312">*</span><span class="ident" id="3301313">ast</span><span class="op" id="3301316">.</span><span class="ident" id="3301317">ParenExpr</span><span class="op" id="3301326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301330">r</span><span class="op" id="3301331">.</span><span class="ident" id="3301332">filterType</span><span class="op" id="3301342">(</span><span class="ident" id="3301343">nil</span><span class="op" id="3301346">,</span>&nbsp;<span class="ident" id="3301348">t</span><span class="op" id="3301349">.</span><span class="ident" id="3301350">X</span><span class="op" id="3301351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301354">case</span>&nbsp;<span class="op" id="3301359">*</span><span class="ident" id="3301360">ast</span><span class="op" id="3301363">.</span><span class="ident" id="3301364">ArrayType</span><span class="op" id="3301373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301377">r</span><span class="op" id="3301378">.</span><span class="ident" id="3301379">filterType</span><span class="op" id="3301389">(</span><span class="ident" id="3301390">nil</span><span class="op" id="3301393">,</span>&nbsp;<span class="ident" id="3301395">t</span><span class="op" id="3301396">.</span><span class="ident" id="3301397">Elt</span><span class="op" id="3301400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301403">case</span>&nbsp;<span class="op" id="3301408">*</span><span class="ident" id="3301409">ast</span><span class="op" id="3301412">.</span><span class="ident" id="3301413">StructType</span><span class="op" id="3301423">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301427">if</span>&nbsp;<span class="ident" id="3301430">r</span><span class="op" id="3301431">.</span><span class="ident" id="3301432">filterFieldList</span><span class="op" id="3301447">(</span><span class="ident" id="3301448">parent</span><span class="op" id="3301454">,</span>&nbsp;<span class="ident" id="3301456">t</span><span class="op" id="3301457">.</span><span class="ident" id="3301458">Fields</span><span class="op" id="3301464">,</span>&nbsp;<span class="ident" id="3301466">nil</span><span class="op" id="3301469">)</span>&nbsp;<span class="op" id="3301471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301476">t</span><span class="op" id="3301477">.</span><span class="ident" id="3301478">Incomplete</span>&nbsp;<span class="op" id="3301489">=</span>&nbsp;<span class="builtintype" id="3301491">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301501">case</span>&nbsp;<span class="op" id="3301506">*</span><span class="ident" id="3301507">ast</span><span class="op" id="3301510">.</span><span class="ident" id="3301511">FuncType</span><span class="op" id="3301519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301523">r</span><span class="op" id="3301524">.</span><span class="ident" id="3301525">filterParamList</span><span class="op" id="3301540">(</span><span class="ident" id="3301541">t</span><span class="op" id="3301542">.</span><span class="ident" id="3301543">Params</span><span class="op" id="3301549">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301553">r</span><span class="op" id="3301554">.</span><span class="ident" id="3301555">filterParamList</span><span class="op" id="3301570">(</span><span class="ident" id="3301571">t</span><span class="op" id="3301572">.</span><span class="ident" id="3301573">Results</span><span class="op" id="3301580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301583">case</span>&nbsp;<span class="op" id="3301588">*</span><span class="ident" id="3301589">ast</span><span class="op" id="3301592">.</span><span class="ident" id="3301593">InterfaceType</span><span class="op" id="3301606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301610">if</span>&nbsp;<span class="ident" id="3301613">r</span><span class="op" id="3301614">.</span><span class="ident" id="3301615">filterFieldList</span><span class="op" id="3301630">(</span><span class="ident" id="3301631">parent</span><span class="op" id="3301637">,</span>&nbsp;<span class="ident" id="3301639">t</span><span class="op" id="3301640">.</span><span class="ident" id="3301641">Methods</span><span class="op" id="3301648">,</span>&nbsp;<span class="ident" id="3301650">t</span><span class="op" id="3301651">)</span>&nbsp;<span class="op" id="3301653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301658">t</span><span class="op" id="3301659">.</span><span class="ident" id="3301660">Incomplete</span>&nbsp;<span class="op" id="3301671">=</span>&nbsp;<span class="builtintype" id="3301673">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301680">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301683">case</span>&nbsp;<span class="op" id="3301688">*</span><span class="ident" id="3301689">ast</span><span class="op" id="3301692">.</span><span class="ident" id="3301693">MapType</span><span class="op" id="3301700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301704">r</span><span class="op" id="3301705">.</span><span class="ident" id="3301706">filterType</span><span class="op" id="3301716">(</span><span class="ident" id="3301717">nil</span><span class="op" id="3301720">,</span>&nbsp;<span class="ident" id="3301722">t</span><span class="op" id="3301723">.</span><span class="ident" id="3301724">Key</span><span class="op" id="3301727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301731">r</span><span class="op" id="3301732">.</span><span class="ident" id="3301733">filterType</span><span class="op" id="3301743">(</span><span class="ident" id="3301744">nil</span><span class="op" id="3301747">,</span>&nbsp;<span class="ident" id="3301749">t</span><span class="op" id="3301750">.</span><span class="ident" id="3301751">Value</span><span class="op" id="3301756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301759">case</span>&nbsp;<span class="op" id="3301764">*</span><span class="ident" id="3301765">ast</span><span class="op" id="3301768">.</span><span class="ident" id="3301769">ChanType</span><span class="op" id="3301777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3301781">r</span><span class="op" id="3301782">.</span><span class="ident" id="3301783">filterType</span><span class="op" id="3301793">(</span><span class="ident" id="3301794">nil</span><span class="op" id="3301797">,</span>&nbsp;<span class="ident" id="3301799">t</span><span class="op" id="3301800">.</span><span class="ident" id="3301801">Value</span><span class="op" id="3301806">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3301809">}</span><br>
<span class="lineno"></span><span class="op" id="3301811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3301814">func</span>&nbsp;<span class="op" id="3301819">(</span><span class="ident" id="3301820">r</span>&nbsp;<span class="op" id="3301822">*</span><span class="ident" id="3301823">reader</span><span class="op" id="3301829">)</span>&nbsp;<span class="ident" id="3301831">filterSpec</span><span class="op" id="3301841">(</span><span class="ident" id="3301842">spec</span>&nbsp;<span class="ident" id="3301847">ast</span><span class="op" id="3301850">.</span><span class="ident" id="3301851">Spec</span><span class="op" id="3301855">,</span>&nbsp;<span class="ident" id="3301857">tok</span>&nbsp;<span class="ident" id="3301861">token</span><span class="op" id="3301866">.</span><span class="ident" id="3301867">Token</span><span class="op" id="3301872">)</span>&nbsp;<span class="builtintype" id="3301874">bool</span>&nbsp;<span class="op" id="3301879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301882">switch</span>&nbsp;<span class="ident" id="3301889">s</span>&nbsp;<span class="op" id="3301891">:=</span>&nbsp;<span class="ident" id="3301894">spec</span><span class="op" id="3301898">.</span><span class="op" id="3301899">(</span><span class="keyword" id="3301900">type</span><span class="op" id="3301904">)</span>&nbsp;<span class="op" id="3301906">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301909">case</span>&nbsp;<span class="op" id="3301914">*</span><span class="ident" id="3301915">ast</span><span class="op" id="3301918">.</span><span class="ident" id="3301919">ImportSpec</span><span class="op" id="3301929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3301933">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301981">return</span>&nbsp;<span class="builtintype" id="3301988">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3301994">case</span>&nbsp;<span class="op" id="3301999">*</span><span class="ident" id="3302000">ast</span><span class="op" id="3302003">.</span><span class="ident" id="3302004">ValueSpec</span><span class="op" id="3302013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302017">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302073">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302107">s</span><span class="op" id="3302108">.</span><span class="ident" id="3302109">Names</span>&nbsp;<span class="op" id="3302115">=</span>&nbsp;<span class="ident" id="3302117">filterIdentList</span><span class="op" id="3302132">(</span><span class="ident" id="3302133">s</span><span class="op" id="3302134">.</span><span class="ident" id="3302135">Names</span><span class="op" id="3302140">,</span>&nbsp;<span class="ident" id="3302142">tok</span>&nbsp;<span class="op" id="3302146">==</span>&nbsp;<span class="ident" id="3302149">token</span><span class="op" id="3302154">.</span><span class="ident" id="3302155">CONST</span><span class="op" id="3302160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302164">if</span>&nbsp;<span class="builtinfunc" id="3302167">len</span><span class="op" id="3302170">(</span><span class="ident" id="3302171">s</span><span class="op" id="3302172">.</span><span class="ident" id="3302173">Names</span><span class="op" id="3302178">)</span>&nbsp;<span class="op" id="3302180">&gt;</span>&nbsp;<span class="num" id="3302182">0</span>&nbsp;<span class="op" id="3302184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302189">r</span><span class="op" id="3302190">.</span><span class="ident" id="3302191">filterType</span><span class="op" id="3302201">(</span><span class="ident" id="3302202">nil</span><span class="op" id="3302205">,</span>&nbsp;<span class="ident" id="3302207">s</span><span class="op" id="3302208">.</span><span class="ident" id="3302209">Type</span><span class="op" id="3302213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302218">return</span>&nbsp;<span class="builtintype" id="3302225">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302235">case</span>&nbsp;<span class="op" id="3302240">*</span><span class="ident" id="3302241">ast</span><span class="op" id="3302244">.</span><span class="ident" id="3302245">TypeSpec</span><span class="op" id="3302253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302257">if</span>&nbsp;<span class="ident" id="3302260">name</span>&nbsp;<span class="op" id="3302265">:=</span>&nbsp;<span class="ident" id="3302268">s</span><span class="op" id="3302269">.</span><span class="ident" id="3302270">Name</span><span class="op" id="3302274">.</span><span class="ident" id="3302275">Name</span><span class="op" id="3302279">;</span>&nbsp;<span class="ident" id="3302281">ast</span><span class="op" id="3302284">.</span><span class="ident" id="3302285">IsExported</span><span class="op" id="3302295">(</span><span class="ident" id="3302296">name</span><span class="op" id="3302300">)</span>&nbsp;<span class="op" id="3302302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302307">r</span><span class="op" id="3302308">.</span><span class="ident" id="3302309">filterType</span><span class="op" id="3302319">(</span><span class="ident" id="3302320">r</span><span class="op" id="3302321">.</span><span class="ident" id="3302322">lookupType</span><span class="op" id="3302332">(</span><span class="ident" id="3302333">s</span><span class="op" id="3302334">.</span><span class="ident" id="3302335">Name</span><span class="op" id="3302339">.</span><span class="ident" id="3302340">Name</span><span class="op" id="3302344">)</span><span class="op" id="3302345">,</span>&nbsp;<span class="ident" id="3302347">s</span><span class="op" id="3302348">.</span><span class="ident" id="3302349">Type</span><span class="op" id="3302353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302358">return</span>&nbsp;<span class="builtintype" id="3302365">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302372">}</span>&nbsp;<span class="keyword" id="3302374">else</span>&nbsp;<span class="keyword" id="3302379">if</span>&nbsp;<span class="ident" id="3302382">name</span>&nbsp;<span class="op" id="3302387">==</span>&nbsp;<span class="string" id="3302390">&#34;error&#34;</span>&nbsp;<span class="op" id="3302398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302403">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302463">r</span><span class="op" id="3302464">.</span><span class="ident" id="3302465">errorDecl</span>&nbsp;<span class="op" id="3302475">=</span>&nbsp;<span class="builtintype" id="3302477">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302487">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302490">return</span>&nbsp;<span class="builtintype" id="3302497">false</span><br>
<span class="lineno"></span><span class="op" id="3302503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3302506">func</span>&nbsp;<span class="op" id="3302511">(</span><span class="ident" id="3302512">r</span>&nbsp;<span class="op" id="3302514">*</span><span class="ident" id="3302515">reader</span><span class="op" id="3302521">)</span>&nbsp;<span class="ident" id="3302523">filterSpecList</span><span class="op" id="3302537">(</span><span class="ident" id="3302538">list</span>&nbsp;<span class="op" id="3302543">[</span><span class="op" id="3302544">]</span><span class="ident" id="3302545">ast</span><span class="op" id="3302548">.</span><span class="ident" id="3302549">Spec</span><span class="op" id="3302553">,</span>&nbsp;<span class="ident" id="3302555">tok</span>&nbsp;<span class="ident" id="3302559">token</span><span class="op" id="3302564">.</span><span class="ident" id="3302565">Token</span><span class="op" id="3302570">)</span>&nbsp;<span class="op" id="3302572">[</span><span class="op" id="3302573">]</span><span class="ident" id="3302574">ast</span><span class="op" id="3302577">.</span><span class="ident" id="3302578">Spec</span>&nbsp;<span class="op" id="3302583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302586">j</span>&nbsp;<span class="op" id="3302588">:=</span>&nbsp;<span class="num" id="3302591">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302594">for</span>&nbsp;<span class="ident" id="3302598">_</span><span class="op" id="3302599">,</span>&nbsp;<span class="ident" id="3302601">s</span>&nbsp;<span class="op" id="3302603">:=</span>&nbsp;<span class="keyword" id="3302606">range</span>&nbsp;<span class="ident" id="3302612">list</span>&nbsp;<span class="op" id="3302617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302621">if</span>&nbsp;<span class="ident" id="3302624">r</span><span class="op" id="3302625">.</span><span class="ident" id="3302626">filterSpec</span><span class="op" id="3302636">(</span><span class="ident" id="3302637">s</span><span class="op" id="3302638">,</span>&nbsp;<span class="ident" id="3302640">tok</span><span class="op" id="3302643">)</span>&nbsp;<span class="op" id="3302645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302650">list</span><span class="op" id="3302654">[</span><span class="ident" id="3302655">j</span><span class="op" id="3302656">]</span>&nbsp;<span class="op" id="3302658">=</span>&nbsp;<span class="ident" id="3302660">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302665">j</span><span class="op" id="3302666">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302671">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3302674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302677">return</span>&nbsp;<span class="ident" id="3302684">list</span><span class="op" id="3302688">[</span><span class="num" id="3302689">0</span><span class="op" id="3302690">:</span><span class="ident" id="3302691">j</span><span class="op" id="3302692">]</span><br>
<span class="lineno"></span><span class="op" id="3302694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3302697">func</span>&nbsp;<span class="op" id="3302702">(</span><span class="ident" id="3302703">r</span>&nbsp;<span class="op" id="3302705">*</span><span class="ident" id="3302706">reader</span><span class="op" id="3302712">)</span>&nbsp;<span class="ident" id="3302714">filterDecl</span><span class="op" id="3302724">(</span><span class="ident" id="3302725">decl</span>&nbsp;<span class="ident" id="3302730">ast</span><span class="op" id="3302733">.</span><span class="ident" id="3302734">Decl</span><span class="op" id="3302738">)</span>&nbsp;<span class="builtintype" id="3302740">bool</span>&nbsp;<span class="op" id="3302745">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302748">switch</span>&nbsp;<span class="ident" id="3302755">d</span>&nbsp;<span class="op" id="3302757">:=</span>&nbsp;<span class="ident" id="3302760">decl</span><span class="op" id="3302764">.</span><span class="op" id="3302765">(</span><span class="keyword" id="3302766">type</span><span class="op" id="3302770">)</span>&nbsp;<span class="op" id="3302772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302775">case</span>&nbsp;<span class="op" id="3302780">*</span><span class="ident" id="3302781">ast</span><span class="op" id="3302784">.</span><span class="ident" id="3302785">GenDecl</span><span class="op" id="3302792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3302796">d</span><span class="op" id="3302797">.</span><span class="ident" id="3302798">Specs</span>&nbsp;<span class="op" id="3302804">=</span>&nbsp;<span class="ident" id="3302806">r</span><span class="op" id="3302807">.</span><span class="ident" id="3302808">filterSpecList</span><span class="op" id="3302822">(</span><span class="ident" id="3302823">d</span><span class="op" id="3302824">.</span><span class="ident" id="3302825">Specs</span><span class="op" id="3302830">,</span>&nbsp;<span class="ident" id="3302832">d</span><span class="op" id="3302833">.</span><span class="ident" id="3302834">Tok</span><span class="op" id="3302837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302841">return</span>&nbsp;<span class="builtinfunc" id="3302848">len</span><span class="op" id="3302851">(</span><span class="ident" id="3302852">d</span><span class="op" id="3302853">.</span><span class="ident" id="3302854">Specs</span><span class="op" id="3302859">)</span>&nbsp;<span class="op" id="3302861">&gt;</span>&nbsp;<span class="num" id="3302863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3302866">case</span>&nbsp;<span class="op" id="3302871">*</span><span class="ident" id="3302872">ast</span><span class="op" id="3302875">.</span><span class="ident" id="3302876">FuncDecl</span><span class="op" id="3302884">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302888">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302938">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3302991">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3303045">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303093">return</span>&nbsp;<span class="ident" id="3303100">ast</span><span class="op" id="3303103">.</span><span class="ident" id="3303104">IsExported</span><span class="op" id="3303114">(</span><span class="ident" id="3303115">d</span><span class="op" id="3303116">.</span><span class="ident" id="3303117">Name</span><span class="op" id="3303121">.</span><span class="ident" id="3303122">Name</span><span class="op" id="3303126">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303132">return</span>&nbsp;<span class="builtintype" id="3303139">false</span><br>
<span class="lineno"></span><span class="op" id="3303145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3303148">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="3303214">//</span><br>
<span class="lineno"></span><span class="keyword" id="3303217">func</span>&nbsp;<span class="op" id="3303222">(</span><span class="ident" id="3303223">r</span>&nbsp;<span class="op" id="3303225">*</span><span class="ident" id="3303226">reader</span><span class="op" id="3303232">)</span>&nbsp;<span class="ident" id="3303234">fileExports</span><span class="op" id="3303245">(</span><span class="ident" id="3303246">src</span>&nbsp;<span class="op" id="3303250">*</span><span class="ident" id="3303251">ast</span><span class="op" id="3303254">.</span><span class="ident" id="3303255">File</span><span class="op" id="3303259">)</span>&nbsp;<span class="op" id="3303261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303264">j</span>&nbsp;<span class="op" id="3303266">:=</span>&nbsp;<span class="num" id="3303269">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303272">for</span>&nbsp;<span class="ident" id="3303276">_</span><span class="op" id="3303277">,</span>&nbsp;<span class="ident" id="3303279">d</span>&nbsp;<span class="op" id="3303281">:=</span>&nbsp;<span class="keyword" id="3303284">range</span>&nbsp;<span class="ident" id="3303290">src</span><span class="op" id="3303293">.</span><span class="ident" id="3303294">Decls</span>&nbsp;<span class="op" id="3303300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3303304">if</span>&nbsp;<span class="ident" id="3303307">r</span><span class="op" id="3303308">.</span><span class="ident" id="3303309">filterDecl</span><span class="op" id="3303319">(</span><span class="ident" id="3303320">d</span><span class="op" id="3303321">)</span>&nbsp;<span class="op" id="3303323">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303328">src</span><span class="op" id="3303331">.</span><span class="ident" id="3303332">Decls</span><span class="op" id="3303337">[</span><span class="ident" id="3303338">j</span><span class="op" id="3303339">]</span>&nbsp;<span class="op" id="3303341">=</span>&nbsp;<span class="ident" id="3303343">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303348">j</span><span class="op" id="3303349">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3303357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3303360">src</span><span class="op" id="3303363">.</span><span class="ident" id="3303364">Decls</span>&nbsp;<span class="op" id="3303370">=</span>&nbsp;<span class="ident" id="3303372">src</span><span class="op" id="3303375">.</span><span class="ident" id="3303376">Decls</span><span class="op" id="3303381">[</span><span class="num" id="3303382">0</span><span class="op" id="3303383">:</span><span class="ident" id="3303384">j</span><span class="op" id="3303385">]</span><br>
<span class="lineno">205</span><span class="op" id="3303387">}</span>
</div>
</body>
</html>
