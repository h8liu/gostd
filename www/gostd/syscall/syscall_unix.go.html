<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2565123">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2565178">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2565232">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2565283">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2565348">package</span>&nbsp;<span class="ident" id="2565356">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2565365">import</span>&nbsp;<span class="op" id="2565372">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2565375">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2565386">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2565394">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2565403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2565406">var</span>&nbsp;<span class="op" id="2565410">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565413">Stdin</span>&nbsp;&nbsp;<span class="op" id="2565420">=</span>&nbsp;<span class="num" id="2565422">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565425">Stdout</span>&nbsp;<span class="op" id="2565432">=</span>&nbsp;<span class="num" id="2565434">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565437">Stderr</span>&nbsp;<span class="op" id="2565444">=</span>&nbsp;<span class="num" id="2565446">2</span><br>
<span class="lineno"></span><span class="op" id="2565448">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2565451">const</span>&nbsp;<span class="op" id="2565457">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565460">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2565475">=</span>&nbsp;<span class="ident" id="2565477">runtime</span><span class="op" id="2565484">.</span><span class="ident" id="2565485">GOOS</span>&nbsp;<span class="op" id="2565490">==</span>&nbsp;<span class="string" id="2565493">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2565502">&amp;&amp;</span>&nbsp;<span class="ident" id="2565505">sizeofPtr</span>&nbsp;<span class="op" id="2565515">==</span>&nbsp;<span class="num" id="2565518">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565521">dragonfly64Bit</span>&nbsp;<span class="op" id="2565536">=</span>&nbsp;<span class="ident" id="2565538">runtime</span><span class="op" id="2565545">.</span><span class="ident" id="2565546">GOOS</span>&nbsp;<span class="op" id="2565551">==</span>&nbsp;<span class="string" id="2565554">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2565566">&amp;&amp;</span>&nbsp;<span class="ident" id="2565569">sizeofPtr</span>&nbsp;<span class="op" id="2565579">==</span>&nbsp;<span class="num" id="2565582">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2565585">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2565600">=</span>&nbsp;<span class="ident" id="2565602">runtime</span><span class="op" id="2565609">.</span><span class="ident" id="2565610">GOOS</span>&nbsp;<span class="op" id="2565615">==</span>&nbsp;<span class="string" id="2565618">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2565627">&amp;&amp;</span>&nbsp;<span class="ident" id="2565630">sizeofPtr</span>&nbsp;<span class="op" id="2565640">==</span>&nbsp;<span class="num" id="2565643">4</span><br>
<span class="lineno">25</span><span class="op" id="2565645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2565648">func</span>&nbsp;<span class="ident" id="2565653">Syscall</span><span class="op" id="2565660">(</span><span class="ident" id="2565661">trap</span><span class="op" id="2565665">,</span>&nbsp;<span class="ident" id="2565667">a1</span><span class="op" id="2565669">,</span>&nbsp;<span class="ident" id="2565671">a2</span><span class="op" id="2565673">,</span>&nbsp;<span class="ident" id="2565675">a3</span>&nbsp;<span class="builtintype" id="2565678">uintptr</span><span class="op" id="2565685">)</span>&nbsp;<span class="op" id="2565687">(</span><span class="ident" id="2565688">r1</span><span class="op" id="2565690">,</span>&nbsp;<span class="ident" id="2565692">r2</span>&nbsp;<span class="builtintype" id="2565695">uintptr</span><span class="op" id="2565702">,</span>&nbsp;<span class="ident" id="2565704">err</span>&nbsp;<span class="ident" id="2565708">Errno</span><span class="op" id="2565713">)</span><br>
<span class="lineno"></span><span class="keyword" id="2565715">func</span>&nbsp;<span class="ident" id="2565720">Syscall6</span><span class="op" id="2565728">(</span><span class="ident" id="2565729">trap</span><span class="op" id="2565733">,</span>&nbsp;<span class="ident" id="2565735">a1</span><span class="op" id="2565737">,</span>&nbsp;<span class="ident" id="2565739">a2</span><span class="op" id="2565741">,</span>&nbsp;<span class="ident" id="2565743">a3</span><span class="op" id="2565745">,</span>&nbsp;<span class="ident" id="2565747">a4</span><span class="op" id="2565749">,</span>&nbsp;<span class="ident" id="2565751">a5</span><span class="op" id="2565753">,</span>&nbsp;<span class="ident" id="2565755">a6</span>&nbsp;<span class="builtintype" id="2565758">uintptr</span><span class="op" id="2565765">)</span>&nbsp;<span class="op" id="2565767">(</span><span class="ident" id="2565768">r1</span><span class="op" id="2565770">,</span>&nbsp;<span class="ident" id="2565772">r2</span>&nbsp;<span class="builtintype" id="2565775">uintptr</span><span class="op" id="2565782">,</span>&nbsp;<span class="ident" id="2565784">err</span>&nbsp;<span class="ident" id="2565788">Errno</span><span class="op" id="2565793">)</span><br>
<span class="lineno"></span><span class="keyword" id="2565795">func</span>&nbsp;<span class="ident" id="2565800">RawSyscall</span><span class="op" id="2565810">(</span><span class="ident" id="2565811">trap</span><span class="op" id="2565815">,</span>&nbsp;<span class="ident" id="2565817">a1</span><span class="op" id="2565819">,</span>&nbsp;<span class="ident" id="2565821">a2</span><span class="op" id="2565823">,</span>&nbsp;<span class="ident" id="2565825">a3</span>&nbsp;<span class="builtintype" id="2565828">uintptr</span><span class="op" id="2565835">)</span>&nbsp;<span class="op" id="2565837">(</span><span class="ident" id="2565838">r1</span><span class="op" id="2565840">,</span>&nbsp;<span class="ident" id="2565842">r2</span>&nbsp;<span class="builtintype" id="2565845">uintptr</span><span class="op" id="2565852">,</span>&nbsp;<span class="ident" id="2565854">err</span>&nbsp;<span class="ident" id="2565858">Errno</span><span class="op" id="2565863">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2565865">func</span>&nbsp;<span class="ident" id="2565870">RawSyscall6</span><span class="op" id="2565881">(</span><span class="ident" id="2565882">trap</span><span class="op" id="2565886">,</span>&nbsp;<span class="ident" id="2565888">a1</span><span class="op" id="2565890">,</span>&nbsp;<span class="ident" id="2565892">a2</span><span class="op" id="2565894">,</span>&nbsp;<span class="ident" id="2565896">a3</span><span class="op" id="2565898">,</span>&nbsp;<span class="ident" id="2565900">a4</span><span class="op" id="2565902">,</span>&nbsp;<span class="ident" id="2565904">a5</span><span class="op" id="2565906">,</span>&nbsp;<span class="ident" id="2565908">a6</span>&nbsp;<span class="builtintype" id="2565911">uintptr</span><span class="op" id="2565918">)</span>&nbsp;<span class="op" id="2565920">(</span><span class="ident" id="2565921">r1</span><span class="op" id="2565923">,</span>&nbsp;<span class="ident" id="2565925">r2</span>&nbsp;<span class="builtintype" id="2565928">uintptr</span><span class="op" id="2565935">,</span>&nbsp;<span class="ident" id="2565937">err</span>&nbsp;<span class="ident" id="2565941">Errno</span><span class="op" id="2565946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2565949">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2566021">type</span>&nbsp;<span class="ident" id="2566026">mmapper</span>&nbsp;<span class="keyword" id="2566034">struct</span>&nbsp;<span class="op" id="2566041">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566044">sync</span><span class="op" id="2566048">.</span><span class="ident" id="2566049">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566056">active</span>&nbsp;<span class="keyword" id="2566063">map</span><span class="op" id="2566066">[</span><span class="op" id="2566067">*</span><span class="builtintype" id="2566068">byte</span><span class="op" id="2566072">]</span><span class="op" id="2566073">[</span><span class="op" id="2566074">]</span><span class="builtintype" id="2566075">byte</span>&nbsp;<span class="comment" id="2566080">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566129">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2566136">func</span><span class="op" id="2566140">(</span><span class="ident" id="2566141">addr</span><span class="op" id="2566145">,</span>&nbsp;<span class="ident" id="2566147">length</span>&nbsp;<span class="builtintype" id="2566154">uintptr</span><span class="op" id="2566161">,</span>&nbsp;<span class="ident" id="2566163">prot</span><span class="op" id="2566167">,</span>&nbsp;<span class="ident" id="2566169">flags</span><span class="op" id="2566174">,</span>&nbsp;<span class="ident" id="2566176">fd</span>&nbsp;<span class="builtintype" id="2566179">int</span><span class="op" id="2566182">,</span>&nbsp;<span class="ident" id="2566184">offset</span>&nbsp;<span class="ident" id="2566191">int64</span><span class="op" id="2566196">)</span>&nbsp;<span class="op" id="2566198">(</span><span class="builtintype" id="2566199">uintptr</span><span class="op" id="2566206">,</span>&nbsp;<span class="builtintype" id="2566208">error</span><span class="op" id="2566213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566216">munmap</span>&nbsp;<span class="keyword" id="2566223">func</span><span class="op" id="2566227">(</span><span class="ident" id="2566228">addr</span>&nbsp;<span class="builtintype" id="2566233">uintptr</span><span class="op" id="2566240">,</span>&nbsp;<span class="ident" id="2566242">length</span>&nbsp;<span class="builtintype" id="2566249">uintptr</span><span class="op" id="2566256">)</span>&nbsp;<span class="builtintype" id="2566258">error</span><br>
<span class="lineno"></span><span class="op" id="2566264">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2566267">func</span>&nbsp;<span class="op" id="2566272">(</span><span class="ident" id="2566273">m</span>&nbsp;<span class="op" id="2566275">*</span><span class="ident" id="2566276">mmapper</span><span class="op" id="2566283">)</span>&nbsp;<span class="ident" id="2566285">Mmap</span><span class="op" id="2566289">(</span><span class="ident" id="2566290">fd</span>&nbsp;<span class="builtintype" id="2566293">int</span><span class="op" id="2566296">,</span>&nbsp;<span class="ident" id="2566298">offset</span>&nbsp;<span class="ident" id="2566305">int64</span><span class="op" id="2566310">,</span>&nbsp;<span class="ident" id="2566312">length</span>&nbsp;<span class="builtintype" id="2566319">int</span><span class="op" id="2566322">,</span>&nbsp;<span class="ident" id="2566324">prot</span>&nbsp;<span class="builtintype" id="2566329">int</span><span class="op" id="2566332">,</span>&nbsp;<span class="ident" id="2566334">flags</span>&nbsp;<span class="builtintype" id="2566340">int</span><span class="op" id="2566343">)</span>&nbsp;<span class="op" id="2566345">(</span><span class="ident" id="2566346">data</span>&nbsp;<span class="op" id="2566351">[</span><span class="op" id="2566352">]</span><span class="builtintype" id="2566353">byte</span><span class="op" id="2566357">,</span>&nbsp;<span class="ident" id="2566359">err</span>&nbsp;<span class="builtintype" id="2566363">error</span><span class="op" id="2566368">)</span>&nbsp;<span class="op" id="2566370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566373">if</span>&nbsp;<span class="ident" id="2566376">length</span>&nbsp;<span class="op" id="2566383">&lt;=</span>&nbsp;<span class="num" id="2566386">0</span>&nbsp;<span class="op" id="2566388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566392">return</span>&nbsp;<span class="ident" id="2566399">nil</span><span class="op" id="2566402">,</span>&nbsp;<span class="ident" id="2566404">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2566412">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2566416">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566446">addr</span><span class="op" id="2566450">,</span>&nbsp;<span class="ident" id="2566452">errno</span>&nbsp;<span class="op" id="2566458">:=</span>&nbsp;<span class="ident" id="2566461">m</span><span class="op" id="2566462">.</span><span class="ident" id="2566463">mmap</span><span class="op" id="2566467">(</span><span class="num" id="2566468">0</span><span class="op" id="2566469">,</span>&nbsp;<span class="builtintype" id="2566471">uintptr</span><span class="op" id="2566478">(</span><span class="ident" id="2566479">length</span><span class="op" id="2566485">)</span><span class="op" id="2566486">,</span>&nbsp;<span class="ident" id="2566488">prot</span><span class="op" id="2566492">,</span>&nbsp;<span class="ident" id="2566494">flags</span><span class="op" id="2566499">,</span>&nbsp;<span class="ident" id="2566501">fd</span><span class="op" id="2566503">,</span>&nbsp;<span class="ident" id="2566505">offset</span><span class="op" id="2566511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566514">if</span>&nbsp;<span class="ident" id="2566517">errno</span>&nbsp;<span class="op" id="2566523">!=</span>&nbsp;<span class="ident" id="2566526">nil</span>&nbsp;<span class="op" id="2566530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566534">return</span>&nbsp;<span class="ident" id="2566541">nil</span><span class="op" id="2566544">,</span>&nbsp;<span class="ident" id="2566546">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2566553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2566557">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566581">var</span>&nbsp;<span class="ident" id="2566585">sl</span>&nbsp;<span class="op" id="2566588">=</span>&nbsp;<span class="keyword" id="2566590">struct</span>&nbsp;<span class="op" id="2566597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566601">addr</span>&nbsp;<span class="builtintype" id="2566606">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2566616">len</span>&nbsp;&nbsp;<span class="builtintype" id="2566621">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2566627">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2566632">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2566637">}</span><span class="op" id="2566638">{</span><span class="ident" id="2566639">addr</span><span class="op" id="2566643">,</span>&nbsp;<span class="ident" id="2566645">length</span><span class="op" id="2566651">,</span>&nbsp;<span class="ident" id="2566653">length</span><span class="op" id="2566659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2566663">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566704">b</span>&nbsp;<span class="op" id="2566706">:=</span>&nbsp;<span class="op" id="2566709">*</span><span class="op" id="2566710">(</span><span class="op" id="2566711">*</span><span class="op" id="2566712">[</span><span class="op" id="2566713">]</span><span class="builtintype" id="2566714">byte</span><span class="op" id="2566718">)</span><span class="op" id="2566719">(</span><span class="ident" id="2566720">unsafe</span><span class="op" id="2566726">.</span><span class="ident" id="2566727">Pointer</span><span class="op" id="2566734">(</span><span class="op" id="2566735">&amp;</span><span class="ident" id="2566736">sl</span><span class="op" id="2566738">)</span><span class="op" id="2566739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2566743">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566784">p</span>&nbsp;<span class="op" id="2566786">:=</span>&nbsp;<span class="op" id="2566789">&amp;</span><span class="ident" id="2566790">b</span><span class="op" id="2566791">[</span><span class="builtinfunc" id="2566792">cap</span><span class="op" id="2566795">(</span><span class="ident" id="2566796">b</span><span class="op" id="2566797">)</span><span class="op" id="2566798">-</span><span class="num" id="2566799">1</span><span class="op" id="2566800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566803">m</span><span class="op" id="2566804">.</span><span class="ident" id="2566805">Lock</span><span class="op" id="2566809">(</span><span class="op" id="2566810">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566813">defer</span>&nbsp;<span class="ident" id="2566819">m</span><span class="op" id="2566820">.</span><span class="ident" id="2566821">Unlock</span><span class="op" id="2566827">(</span><span class="op" id="2566828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2566831">m</span><span class="op" id="2566832">.</span><span class="ident" id="2566833">active</span><span class="op" id="2566839">[</span><span class="ident" id="2566840">p</span><span class="op" id="2566841">]</span>&nbsp;<span class="op" id="2566843">=</span>&nbsp;<span class="ident" id="2566845">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566848">return</span>&nbsp;<span class="ident" id="2566855">b</span><span class="op" id="2566856">,</span>&nbsp;<span class="ident" id="2566858">nil</span><br>
<span class="lineno"></span><span class="op" id="2566862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2566865">func</span>&nbsp;<span class="op" id="2566870">(</span><span class="ident" id="2566871">m</span>&nbsp;<span class="op" id="2566873">*</span><span class="ident" id="2566874">mmapper</span><span class="op" id="2566881">)</span>&nbsp;<span class="ident" id="2566883">Munmap</span><span class="op" id="2566889">(</span><span class="ident" id="2566890">data</span>&nbsp;<span class="op" id="2566895">[</span><span class="op" id="2566896">]</span><span class="builtintype" id="2566897">byte</span><span class="op" id="2566901">)</span>&nbsp;<span class="op" id="2566903">(</span><span class="ident" id="2566904">err</span>&nbsp;<span class="builtintype" id="2566908">error</span><span class="op" id="2566913">)</span>&nbsp;<span class="op" id="2566915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566918">if</span>&nbsp;<span class="builtinfunc" id="2566921">len</span><span class="op" id="2566924">(</span><span class="ident" id="2566925">data</span><span class="op" id="2566929">)</span>&nbsp;<span class="op" id="2566931">==</span>&nbsp;<span class="num" id="2566934">0</span>&nbsp;<span class="op" id="2566936">||</span>&nbsp;<span class="builtinfunc" id="2566939">len</span><span class="op" id="2566942">(</span><span class="ident" id="2566943">data</span><span class="op" id="2566947">)</span>&nbsp;<span class="op" id="2566949">!=</span>&nbsp;<span class="builtinfunc" id="2566952">cap</span><span class="op" id="2566955">(</span><span class="ident" id="2566956">data</span><span class="op" id="2566960">)</span>&nbsp;<span class="op" id="2566962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2566966">return</span>&nbsp;<span class="ident" id="2566973">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2566981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2566985">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2567019">p</span>&nbsp;<span class="op" id="2567021">:=</span>&nbsp;<span class="op" id="2567024">&amp;</span><span class="ident" id="2567025">data</span><span class="op" id="2567029">[</span><span class="builtinfunc" id="2567030">cap</span><span class="op" id="2567033">(</span><span class="ident" id="2567034">data</span><span class="op" id="2567038">)</span><span class="op" id="2567039">-</span><span class="num" id="2567040">1</span><span class="op" id="2567041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2567044">m</span><span class="op" id="2567045">.</span><span class="ident" id="2567046">Lock</span><span class="op" id="2567050">(</span><span class="op" id="2567051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567054">defer</span>&nbsp;<span class="ident" id="2567060">m</span><span class="op" id="2567061">.</span><span class="ident" id="2567062">Unlock</span><span class="op" id="2567068">(</span><span class="op" id="2567069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2567072">b</span>&nbsp;<span class="op" id="2567074">:=</span>&nbsp;<span class="ident" id="2567077">m</span><span class="op" id="2567078">.</span><span class="ident" id="2567079">active</span><span class="op" id="2567085">[</span><span class="ident" id="2567086">p</span><span class="op" id="2567087">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567090">if</span>&nbsp;<span class="ident" id="2567093">b</span>&nbsp;<span class="op" id="2567095">==</span>&nbsp;<span class="ident" id="2567098">nil</span>&nbsp;<span class="op" id="2567102">||</span>&nbsp;<span class="op" id="2567105">&amp;</span><span class="ident" id="2567106">b</span><span class="op" id="2567107">[</span><span class="num" id="2567108">0</span><span class="op" id="2567109">]</span>&nbsp;<span class="op" id="2567111">!=</span>&nbsp;<span class="op" id="2567114">&amp;</span><span class="ident" id="2567115">data</span><span class="op" id="2567119">[</span><span class="num" id="2567120">0</span><span class="op" id="2567121">]</span>&nbsp;<span class="op" id="2567123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567127">return</span>&nbsp;<span class="ident" id="2567134">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2567142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2567146">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567181">if</span>&nbsp;<span class="ident" id="2567184">errno</span>&nbsp;<span class="op" id="2567190">:=</span>&nbsp;<span class="ident" id="2567193">m</span><span class="op" id="2567194">.</span><span class="ident" id="2567195">munmap</span><span class="op" id="2567201">(</span><span class="builtintype" id="2567202">uintptr</span><span class="op" id="2567209">(</span><span class="ident" id="2567210">unsafe</span><span class="op" id="2567216">.</span><span class="ident" id="2567217">Pointer</span><span class="op" id="2567224">(</span><span class="op" id="2567225">&amp;</span><span class="ident" id="2567226">b</span><span class="op" id="2567227">[</span><span class="num" id="2567228">0</span><span class="op" id="2567229">]</span><span class="op" id="2567230">)</span><span class="op" id="2567231">)</span><span class="op" id="2567232">,</span>&nbsp;<span class="builtintype" id="2567234">uintptr</span><span class="op" id="2567241">(</span><span class="builtinfunc" id="2567242">len</span><span class="op" id="2567245">(</span><span class="ident" id="2567246">b</span><span class="op" id="2567247">)</span><span class="op" id="2567248">)</span><span class="op" id="2567249">)</span><span class="op" id="2567250">;</span>&nbsp;<span class="ident" id="2567252">errno</span>&nbsp;<span class="op" id="2567258">!=</span>&nbsp;<span class="ident" id="2567261">nil</span>&nbsp;<span class="op" id="2567265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567269">return</span>&nbsp;<span class="ident" id="2567276">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2567283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2567286">delete</span><span class="op" id="2567292">(</span><span class="ident" id="2567293">m</span><span class="op" id="2567294">.</span><span class="ident" id="2567295">active</span><span class="op" id="2567301">,</span>&nbsp;<span class="ident" id="2567303">p</span><span class="op" id="2567304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567307">return</span>&nbsp;<span class="ident" id="2567314">nil</span><br>
<span class="lineno">90</span><span class="op" id="2567318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2567321">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2567386">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2567457">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2567524">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2567537">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2567556">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2567572">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2567577">type</span>&nbsp;<span class="ident" id="2567582">Errno</span>&nbsp;<span class="builtintype" id="2567588">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2567597">func</span>&nbsp;<span class="op" id="2567602">(</span><span class="ident" id="2567603">e</span>&nbsp;<span class="ident" id="2567605">Errno</span><span class="op" id="2567610">)</span>&nbsp;<span class="ident" id="2567612">Error</span><span class="op" id="2567617">(</span><span class="op" id="2567618">)</span>&nbsp;<span class="builtintype" id="2567620">string</span>&nbsp;<span class="op" id="2567627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567630">if</span>&nbsp;<span class="num" id="2567633">0</span>&nbsp;<span class="op" id="2567635">&lt;=</span>&nbsp;<span class="builtintype" id="2567638">int</span><span class="op" id="2567641">(</span><span class="ident" id="2567642">e</span><span class="op" id="2567643">)</span>&nbsp;<span class="op" id="2567645">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2567648">int</span><span class="op" id="2567651">(</span><span class="ident" id="2567652">e</span><span class="op" id="2567653">)</span>&nbsp;<span class="op" id="2567655">&lt;</span>&nbsp;<span class="builtinfunc" id="2567657">len</span><span class="op" id="2567660">(</span><span class="ident" id="2567661">errors</span><span class="op" id="2567667">)</span>&nbsp;<span class="op" id="2567669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2567673">s</span>&nbsp;<span class="op" id="2567675">:=</span>&nbsp;<span class="ident" id="2567678">errors</span><span class="op" id="2567684">[</span><span class="ident" id="2567685">e</span><span class="op" id="2567686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567690">if</span>&nbsp;<span class="ident" id="2567693">s</span>&nbsp;<span class="op" id="2567695">!=</span>&nbsp;<span class="string" id="2567698">&#34;&#34;</span>&nbsp;<span class="op" id="2567701">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567706">return</span>&nbsp;<span class="ident" id="2567713">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2567717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2567720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567723">return</span>&nbsp;<span class="string" id="2567730">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2567739">+</span>&nbsp;<span class="ident" id="2567741">itoa</span><span class="op" id="2567745">(</span><span class="builtintype" id="2567746">int</span><span class="op" id="2567749">(</span><span class="ident" id="2567750">e</span><span class="op" id="2567751">)</span><span class="op" id="2567752">)</span><br>
<span class="lineno"></span><span class="op" id="2567754">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2567757">func</span>&nbsp;<span class="op" id="2567762">(</span><span class="ident" id="2567763">e</span>&nbsp;<span class="ident" id="2567765">Errno</span><span class="op" id="2567770">)</span>&nbsp;<span class="ident" id="2567772">Temporary</span><span class="op" id="2567781">(</span><span class="op" id="2567782">)</span>&nbsp;<span class="builtintype" id="2567784">bool</span>&nbsp;<span class="op" id="2567789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567792">return</span>&nbsp;<span class="ident" id="2567799">e</span>&nbsp;<span class="op" id="2567801">==</span>&nbsp;<span class="ident" id="2567804">EINTR</span>&nbsp;<span class="op" id="2567810">||</span>&nbsp;<span class="ident" id="2567813">e</span>&nbsp;<span class="op" id="2567815">==</span>&nbsp;<span class="ident" id="2567818">EMFILE</span>&nbsp;<span class="op" id="2567825">||</span>&nbsp;<span class="ident" id="2567828">e</span>&nbsp;<span class="op" id="2567830">==</span>&nbsp;<span class="ident" id="2567833">ECONNRESET</span>&nbsp;<span class="op" id="2567844">||</span>&nbsp;<span class="ident" id="2567847">e</span>&nbsp;<span class="op" id="2567849">==</span>&nbsp;<span class="ident" id="2567852">ECONNABORTED</span>&nbsp;<span class="op" id="2567865">||</span>&nbsp;<span class="ident" id="2567868">e</span><span class="op" id="2567869">.</span><span class="ident" id="2567870">Timeout</span><span class="op" id="2567877">(</span><span class="op" id="2567878">)</span><br>
<span class="lineno"></span><span class="op" id="2567880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2567883">func</span>&nbsp;<span class="op" id="2567888">(</span><span class="ident" id="2567889">e</span>&nbsp;<span class="ident" id="2567891">Errno</span><span class="op" id="2567896">)</span>&nbsp;<span class="ident" id="2567898">Timeout</span><span class="op" id="2567905">(</span><span class="op" id="2567906">)</span>&nbsp;<span class="builtintype" id="2567908">bool</span>&nbsp;<span class="op" id="2567913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2567916">return</span>&nbsp;<span class="ident" id="2567923">e</span>&nbsp;<span class="op" id="2567925">==</span>&nbsp;<span class="ident" id="2567928">EAGAIN</span>&nbsp;<span class="op" id="2567935">||</span>&nbsp;<span class="ident" id="2567938">e</span>&nbsp;<span class="op" id="2567940">==</span>&nbsp;<span class="ident" id="2567943">EWOULDBLOCK</span>&nbsp;<span class="op" id="2567955">||</span>&nbsp;<span class="ident" id="2567958">e</span>&nbsp;<span class="op" id="2567960">==</span>&nbsp;<span class="ident" id="2567963">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2567973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2567976">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2568029">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2568071">type</span>&nbsp;<span class="ident" id="2568076">Signal</span>&nbsp;<span class="builtintype" id="2568083">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2568088">func</span>&nbsp;<span class="op" id="2568093">(</span><span class="ident" id="2568094">s</span>&nbsp;<span class="ident" id="2568096">Signal</span><span class="op" id="2568102">)</span>&nbsp;<span class="ident" id="2568104">Signal</span><span class="op" id="2568110">(</span><span class="op" id="2568111">)</span>&nbsp;<span class="op" id="2568113">{</span><span class="op" id="2568114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2568117">func</span>&nbsp;<span class="op" id="2568122">(</span><span class="ident" id="2568123">s</span>&nbsp;<span class="ident" id="2568125">Signal</span><span class="op" id="2568131">)</span>&nbsp;<span class="ident" id="2568133">String</span><span class="op" id="2568139">(</span><span class="op" id="2568140">)</span>&nbsp;<span class="builtintype" id="2568142">string</span>&nbsp;<span class="op" id="2568149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568152">if</span>&nbsp;<span class="num" id="2568155">0</span>&nbsp;<span class="op" id="2568157">&lt;=</span>&nbsp;<span class="ident" id="2568160">s</span>&nbsp;<span class="op" id="2568162">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2568165">int</span><span class="op" id="2568168">(</span><span class="ident" id="2568169">s</span><span class="op" id="2568170">)</span>&nbsp;<span class="op" id="2568172">&lt;</span>&nbsp;<span class="builtinfunc" id="2568174">len</span><span class="op" id="2568177">(</span><span class="ident" id="2568178">signals</span><span class="op" id="2568185">)</span>&nbsp;<span class="op" id="2568187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568191">str</span>&nbsp;<span class="op" id="2568195">:=</span>&nbsp;<span class="ident" id="2568198">signals</span><span class="op" id="2568205">[</span><span class="ident" id="2568206">s</span><span class="op" id="2568207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568211">if</span>&nbsp;<span class="ident" id="2568214">str</span>&nbsp;<span class="op" id="2568218">!=</span>&nbsp;<span class="string" id="2568221">&#34;&#34;</span>&nbsp;<span class="op" id="2568224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568229">return</span>&nbsp;<span class="ident" id="2568236">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568248">return</span>&nbsp;<span class="string" id="2568255">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2568265">+</span>&nbsp;<span class="ident" id="2568267">itoa</span><span class="op" id="2568271">(</span><span class="builtintype" id="2568272">int</span><span class="op" id="2568275">(</span><span class="ident" id="2568276">s</span><span class="op" id="2568277">)</span><span class="op" id="2568278">)</span><br>
<span class="lineno"></span><span class="op" id="2568280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2568283">func</span>&nbsp;<span class="ident" id="2568288">Read</span><span class="op" id="2568292">(</span><span class="ident" id="2568293">fd</span>&nbsp;<span class="builtintype" id="2568296">int</span><span class="op" id="2568299">,</span>&nbsp;<span class="ident" id="2568301">p</span>&nbsp;<span class="op" id="2568303">[</span><span class="op" id="2568304">]</span><span class="builtintype" id="2568305">byte</span><span class="op" id="2568309">)</span>&nbsp;<span class="op" id="2568311">(</span><span class="ident" id="2568312">n</span>&nbsp;<span class="builtintype" id="2568314">int</span><span class="op" id="2568317">,</span>&nbsp;<span class="ident" id="2568319">err</span>&nbsp;<span class="builtintype" id="2568323">error</span><span class="op" id="2568328">)</span>&nbsp;<span class="op" id="2568330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568333">n</span><span class="op" id="2568334">,</span>&nbsp;<span class="ident" id="2568336">err</span>&nbsp;<span class="op" id="2568340">=</span>&nbsp;<span class="ident" id="2568342">read</span><span class="op" id="2568346">(</span><span class="ident" id="2568347">fd</span><span class="op" id="2568349">,</span>&nbsp;<span class="ident" id="2568351">p</span><span class="op" id="2568352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568355">if</span>&nbsp;<span class="ident" id="2568358">raceenabled</span>&nbsp;<span class="op" id="2568370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568374">if</span>&nbsp;<span class="ident" id="2568377">n</span>&nbsp;<span class="op" id="2568379">&gt;</span>&nbsp;<span class="num" id="2568381">0</span>&nbsp;<span class="op" id="2568383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568388">raceWriteRange</span><span class="op" id="2568402">(</span><span class="ident" id="2568403">unsafe</span><span class="op" id="2568409">.</span><span class="ident" id="2568410">Pointer</span><span class="op" id="2568417">(</span><span class="op" id="2568418">&amp;</span><span class="ident" id="2568419">p</span><span class="op" id="2568420">[</span><span class="num" id="2568421">0</span><span class="op" id="2568422">]</span><span class="op" id="2568423">)</span><span class="op" id="2568424">,</span>&nbsp;<span class="ident" id="2568426">n</span><span class="op" id="2568427">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568435">if</span>&nbsp;<span class="ident" id="2568438">err</span>&nbsp;<span class="op" id="2568442">==</span>&nbsp;<span class="ident" id="2568445">nil</span>&nbsp;<span class="op" id="2568449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568454">raceAcquire</span><span class="op" id="2568465">(</span><span class="ident" id="2568466">unsafe</span><span class="op" id="2568472">.</span><span class="ident" id="2568473">Pointer</span><span class="op" id="2568480">(</span><span class="op" id="2568481">&amp;</span><span class="ident" id="2568482">ioSync</span><span class="op" id="2568488">)</span><span class="op" id="2568489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568496">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568499">return</span><br>
<span class="lineno"></span><span class="op" id="2568506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2568509">func</span>&nbsp;<span class="ident" id="2568514">Write</span><span class="op" id="2568519">(</span><span class="ident" id="2568520">fd</span>&nbsp;<span class="builtintype" id="2568523">int</span><span class="op" id="2568526">,</span>&nbsp;<span class="ident" id="2568528">p</span>&nbsp;<span class="op" id="2568530">[</span><span class="op" id="2568531">]</span><span class="builtintype" id="2568532">byte</span><span class="op" id="2568536">)</span>&nbsp;<span class="op" id="2568538">(</span><span class="ident" id="2568539">n</span>&nbsp;<span class="builtintype" id="2568541">int</span><span class="op" id="2568544">,</span>&nbsp;<span class="ident" id="2568546">err</span>&nbsp;<span class="builtintype" id="2568550">error</span><span class="op" id="2568555">)</span>&nbsp;<span class="op" id="2568557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568560">if</span>&nbsp;<span class="ident" id="2568563">raceenabled</span>&nbsp;<span class="op" id="2568575">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568579">raceReleaseMerge</span><span class="op" id="2568595">(</span><span class="ident" id="2568596">unsafe</span><span class="op" id="2568602">.</span><span class="ident" id="2568603">Pointer</span><span class="op" id="2568610">(</span><span class="op" id="2568611">&amp;</span><span class="ident" id="2568612">ioSync</span><span class="op" id="2568618">)</span><span class="op" id="2568619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568625">n</span><span class="op" id="2568626">,</span>&nbsp;<span class="ident" id="2568628">err</span>&nbsp;<span class="op" id="2568632">=</span>&nbsp;<span class="ident" id="2568634">write</span><span class="op" id="2568639">(</span><span class="ident" id="2568640">fd</span><span class="op" id="2568642">,</span>&nbsp;<span class="ident" id="2568644">p</span><span class="op" id="2568645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568648">if</span>&nbsp;<span class="ident" id="2568651">raceenabled</span>&nbsp;<span class="op" id="2568663">&amp;&amp;</span>&nbsp;<span class="ident" id="2568666">n</span>&nbsp;<span class="op" id="2568668">&gt;</span>&nbsp;<span class="num" id="2568670">0</span>&nbsp;<span class="op" id="2568672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568676">raceReadRange</span><span class="op" id="2568689">(</span><span class="ident" id="2568690">unsafe</span><span class="op" id="2568696">.</span><span class="ident" id="2568697">Pointer</span><span class="op" id="2568704">(</span><span class="op" id="2568705">&amp;</span><span class="ident" id="2568706">p</span><span class="op" id="2568707">[</span><span class="num" id="2568708">0</span><span class="op" id="2568709">]</span><span class="op" id="2568710">)</span><span class="op" id="2568711">,</span>&nbsp;<span class="ident" id="2568713">n</span><span class="op" id="2568714">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2568717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2568720">return</span><br>
<span class="lineno"></span><span class="op" id="2568727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2568730">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2568781">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2568833">var</span>&nbsp;<span class="ident" id="2568837">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2568855">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2568861">type</span>&nbsp;<span class="ident" id="2568866">Sockaddr</span>&nbsp;<span class="keyword" id="2568875">interface</span>&nbsp;<span class="op" id="2568885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2568888">sockaddr</span><span class="op" id="2568896">(</span><span class="op" id="2568897">)</span>&nbsp;<span class="op" id="2568899">(</span><span class="ident" id="2568900">ptr</span>&nbsp;<span class="ident" id="2568904">unsafe</span><span class="op" id="2568910">.</span><span class="ident" id="2568911">Pointer</span><span class="op" id="2568918">,</span>&nbsp;<span class="builtinfunc" id="2568920">len</span>&nbsp;<span class="ident" id="2568924">_Socklen</span><span class="op" id="2568932">,</span>&nbsp;<span class="ident" id="2568934">err</span>&nbsp;<span class="builtintype" id="2568938">error</span><span class="op" id="2568943">)</span>&nbsp;<span class="comment" id="2568945">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2568988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2568991">type</span>&nbsp;<span class="ident" id="2568996">SockaddrInet4</span>&nbsp;<span class="keyword" id="2569010">struct</span>&nbsp;<span class="op" id="2569017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569020">Port</span>&nbsp;<span class="builtintype" id="2569025">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569030">Addr</span>&nbsp;<span class="op" id="2569035">[</span><span class="num" id="2569036">4</span><span class="op" id="2569037">]</span><span class="builtintype" id="2569038">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569044">raw</span>&nbsp;&nbsp;<span class="ident" id="2569049">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2569066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2569069">type</span>&nbsp;<span class="ident" id="2569074">SockaddrInet6</span>&nbsp;<span class="keyword" id="2569088">struct</span>&nbsp;<span class="op" id="2569095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569098">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2569105">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569110">ZoneId</span>&nbsp;<span class="builtintype" id="2569117">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569125">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2569132">[</span><span class="num" id="2569133">16</span><span class="op" id="2569135">]</span><span class="builtintype" id="2569136">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569142">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2569149">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2569166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2569169">type</span>&nbsp;<span class="ident" id="2569174">SockaddrUnix</span>&nbsp;<span class="keyword" id="2569187">struct</span>&nbsp;<span class="op" id="2569194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569197">Name</span>&nbsp;<span class="builtintype" id="2569202">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569210">raw</span>&nbsp;&nbsp;<span class="ident" id="2569215">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2569231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2569234">func</span>&nbsp;<span class="ident" id="2569239">Bind</span><span class="op" id="2569243">(</span><span class="ident" id="2569244">fd</span>&nbsp;<span class="builtintype" id="2569247">int</span><span class="op" id="2569250">,</span>&nbsp;<span class="ident" id="2569252">sa</span>&nbsp;<span class="ident" id="2569255">Sockaddr</span><span class="op" id="2569263">)</span>&nbsp;<span class="op" id="2569265">(</span><span class="ident" id="2569266">err</span>&nbsp;<span class="builtintype" id="2569270">error</span><span class="op" id="2569275">)</span>&nbsp;<span class="op" id="2569277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569280">ptr</span><span class="op" id="2569283">,</span>&nbsp;<span class="ident" id="2569285">n</span><span class="op" id="2569286">,</span>&nbsp;<span class="ident" id="2569288">err</span>&nbsp;<span class="op" id="2569292">:=</span>&nbsp;<span class="ident" id="2569295">sa</span><span class="op" id="2569297">.</span><span class="ident" id="2569298">sockaddr</span><span class="op" id="2569306">(</span><span class="op" id="2569307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569310">if</span>&nbsp;<span class="ident" id="2569313">err</span>&nbsp;<span class="op" id="2569317">!=</span>&nbsp;<span class="ident" id="2569320">nil</span>&nbsp;<span class="op" id="2569324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569328">return</span>&nbsp;<span class="ident" id="2569335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2569340">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569343">return</span>&nbsp;<span class="ident" id="2569350">bind</span><span class="op" id="2569354">(</span><span class="ident" id="2569355">fd</span><span class="op" id="2569357">,</span>&nbsp;<span class="ident" id="2569359">ptr</span><span class="op" id="2569362">,</span>&nbsp;<span class="ident" id="2569364">n</span><span class="op" id="2569365">)</span><br>
<span class="lineno"></span><span class="op" id="2569367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2569370">func</span>&nbsp;<span class="ident" id="2569375">Connect</span><span class="op" id="2569382">(</span><span class="ident" id="2569383">fd</span>&nbsp;<span class="builtintype" id="2569386">int</span><span class="op" id="2569389">,</span>&nbsp;<span class="ident" id="2569391">sa</span>&nbsp;<span class="ident" id="2569394">Sockaddr</span><span class="op" id="2569402">)</span>&nbsp;<span class="op" id="2569404">(</span><span class="ident" id="2569405">err</span>&nbsp;<span class="builtintype" id="2569409">error</span><span class="op" id="2569414">)</span>&nbsp;<span class="op" id="2569416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569419">ptr</span><span class="op" id="2569422">,</span>&nbsp;<span class="ident" id="2569424">n</span><span class="op" id="2569425">,</span>&nbsp;<span class="ident" id="2569427">err</span>&nbsp;<span class="op" id="2569431">:=</span>&nbsp;<span class="ident" id="2569434">sa</span><span class="op" id="2569436">.</span><span class="ident" id="2569437">sockaddr</span><span class="op" id="2569445">(</span><span class="op" id="2569446">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569449">if</span>&nbsp;<span class="ident" id="2569452">err</span>&nbsp;<span class="op" id="2569456">!=</span>&nbsp;<span class="ident" id="2569459">nil</span>&nbsp;<span class="op" id="2569463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569467">return</span>&nbsp;<span class="ident" id="2569474">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2569479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569482">return</span>&nbsp;<span class="ident" id="2569489">connect</span><span class="op" id="2569496">(</span><span class="ident" id="2569497">fd</span><span class="op" id="2569499">,</span>&nbsp;<span class="ident" id="2569501">ptr</span><span class="op" id="2569504">,</span>&nbsp;<span class="ident" id="2569506">n</span><span class="op" id="2569507">)</span><br>
<span class="lineno"></span><span class="op" id="2569509">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2569512">func</span>&nbsp;<span class="ident" id="2569517">Getpeername</span><span class="op" id="2569528">(</span><span class="ident" id="2569529">fd</span>&nbsp;<span class="builtintype" id="2569532">int</span><span class="op" id="2569535">)</span>&nbsp;<span class="op" id="2569537">(</span><span class="ident" id="2569538">sa</span>&nbsp;<span class="ident" id="2569541">Sockaddr</span><span class="op" id="2569549">,</span>&nbsp;<span class="ident" id="2569551">err</span>&nbsp;<span class="builtintype" id="2569555">error</span><span class="op" id="2569560">)</span>&nbsp;<span class="op" id="2569562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569565">var</span>&nbsp;<span class="ident" id="2569569">rsa</span>&nbsp;<span class="ident" id="2569573">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569589">var</span>&nbsp;<span class="builtinfunc" id="2569593">len</span>&nbsp;<span class="ident" id="2569597">_Socklen</span>&nbsp;<span class="op" id="2569606">=</span>&nbsp;<span class="ident" id="2569608">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569627">if</span>&nbsp;<span class="ident" id="2569630">err</span>&nbsp;<span class="op" id="2569634">=</span>&nbsp;<span class="ident" id="2569636">getpeername</span><span class="op" id="2569647">(</span><span class="ident" id="2569648">fd</span><span class="op" id="2569650">,</span>&nbsp;<span class="op" id="2569652">&amp;</span><span class="ident" id="2569653">rsa</span><span class="op" id="2569656">,</span>&nbsp;<span class="op" id="2569658">&amp;</span><span class="builtinfunc" id="2569659">len</span><span class="op" id="2569662">)</span><span class="op" id="2569663">;</span>&nbsp;<span class="ident" id="2569665">err</span>&nbsp;<span class="op" id="2569669">!=</span>&nbsp;<span class="ident" id="2569672">nil</span>&nbsp;<span class="op" id="2569676">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2569688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569691">return</span>&nbsp;<span class="ident" id="2569698">anyToSockaddr</span><span class="op" id="2569711">(</span><span class="op" id="2569712">&amp;</span><span class="ident" id="2569713">rsa</span><span class="op" id="2569716">)</span><br>
<span class="lineno"></span><span class="op" id="2569718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2569721">func</span>&nbsp;<span class="ident" id="2569726">GetsockoptInt</span><span class="op" id="2569739">(</span><span class="ident" id="2569740">fd</span><span class="op" id="2569742">,</span>&nbsp;<span class="ident" id="2569744">level</span><span class="op" id="2569749">,</span>&nbsp;<span class="ident" id="2569751">opt</span>&nbsp;<span class="builtintype" id="2569755">int</span><span class="op" id="2569758">)</span>&nbsp;<span class="op" id="2569760">(</span><span class="ident" id="2569761">value</span>&nbsp;<span class="builtintype" id="2569767">int</span><span class="op" id="2569770">,</span>&nbsp;<span class="ident" id="2569772">err</span>&nbsp;<span class="builtintype" id="2569776">error</span><span class="op" id="2569781">)</span>&nbsp;<span class="op" id="2569783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569786">var</span>&nbsp;<span class="ident" id="2569790">n</span>&nbsp;<span class="builtintype" id="2569792">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569799">vallen</span>&nbsp;<span class="op" id="2569806">:=</span>&nbsp;<span class="ident" id="2569809">_Socklen</span><span class="op" id="2569817">(</span><span class="num" id="2569818">4</span><span class="op" id="2569819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2569822">err</span>&nbsp;<span class="op" id="2569826">=</span>&nbsp;<span class="ident" id="2569828">getsockopt</span><span class="op" id="2569838">(</span><span class="ident" id="2569839">fd</span><span class="op" id="2569841">,</span>&nbsp;<span class="ident" id="2569843">level</span><span class="op" id="2569848">,</span>&nbsp;<span class="ident" id="2569850">opt</span><span class="op" id="2569853">,</span>&nbsp;<span class="ident" id="2569855">unsafe</span><span class="op" id="2569861">.</span><span class="ident" id="2569862">Pointer</span><span class="op" id="2569869">(</span><span class="op" id="2569870">&amp;</span><span class="ident" id="2569871">n</span><span class="op" id="2569872">)</span><span class="op" id="2569873">,</span>&nbsp;<span class="op" id="2569875">&amp;</span><span class="ident" id="2569876">vallen</span><span class="op" id="2569882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569885">return</span>&nbsp;<span class="builtintype" id="2569892">int</span><span class="op" id="2569895">(</span><span class="ident" id="2569896">n</span><span class="op" id="2569897">)</span><span class="op" id="2569898">,</span>&nbsp;<span class="ident" id="2569900">err</span><br>
<span class="lineno">215</span><span class="op" id="2569904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2569907">func</span>&nbsp;<span class="ident" id="2569912">Recvfrom</span><span class="op" id="2569920">(</span><span class="ident" id="2569921">fd</span>&nbsp;<span class="builtintype" id="2569924">int</span><span class="op" id="2569927">,</span>&nbsp;<span class="ident" id="2569929">p</span>&nbsp;<span class="op" id="2569931">[</span><span class="op" id="2569932">]</span><span class="builtintype" id="2569933">byte</span><span class="op" id="2569937">,</span>&nbsp;<span class="ident" id="2569939">flags</span>&nbsp;<span class="builtintype" id="2569945">int</span><span class="op" id="2569948">)</span>&nbsp;<span class="op" id="2569950">(</span><span class="ident" id="2569951">n</span>&nbsp;<span class="builtintype" id="2569953">int</span><span class="op" id="2569956">,</span>&nbsp;<span class="ident" id="2569958">from</span>&nbsp;<span class="ident" id="2569963">Sockaddr</span><span class="op" id="2569971">,</span>&nbsp;<span class="ident" id="2569973">err</span>&nbsp;<span class="builtintype" id="2569977">error</span><span class="op" id="2569982">)</span>&nbsp;<span class="op" id="2569984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2569987">var</span>&nbsp;<span class="ident" id="2569991">rsa</span>&nbsp;<span class="ident" id="2569995">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570011">var</span>&nbsp;<span class="builtinfunc" id="2570015">len</span>&nbsp;<span class="ident" id="2570019">_Socklen</span>&nbsp;<span class="op" id="2570028">=</span>&nbsp;<span class="ident" id="2570030">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570049">if</span>&nbsp;<span class="ident" id="2570052">n</span><span class="op" id="2570053">,</span>&nbsp;<span class="ident" id="2570055">err</span>&nbsp;<span class="op" id="2570059">=</span>&nbsp;<span class="ident" id="2570061">recvfrom</span><span class="op" id="2570069">(</span><span class="ident" id="2570070">fd</span><span class="op" id="2570072">,</span>&nbsp;<span class="ident" id="2570074">p</span><span class="op" id="2570075">,</span>&nbsp;<span class="ident" id="2570077">flags</span><span class="op" id="2570082">,</span>&nbsp;<span class="op" id="2570084">&amp;</span><span class="ident" id="2570085">rsa</span><span class="op" id="2570088">,</span>&nbsp;<span class="op" id="2570090">&amp;</span><span class="builtinfunc" id="2570091">len</span><span class="op" id="2570094">)</span><span class="op" id="2570095">;</span>&nbsp;<span class="ident" id="2570097">err</span>&nbsp;<span class="op" id="2570101">!=</span>&nbsp;<span class="ident" id="2570104">nil</span>&nbsp;<span class="op" id="2570108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570112">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2570120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570123">if</span>&nbsp;<span class="ident" id="2570126">rsa</span><span class="op" id="2570129">.</span><span class="ident" id="2570130">Addr</span><span class="op" id="2570134">.</span><span class="ident" id="2570135">Family</span>&nbsp;<span class="op" id="2570142">!=</span>&nbsp;<span class="ident" id="2570145">AF_UNSPEC</span>&nbsp;<span class="op" id="2570155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2570159">from</span><span class="op" id="2570163">,</span>&nbsp;<span class="ident" id="2570165">err</span>&nbsp;<span class="op" id="2570169">=</span>&nbsp;<span class="ident" id="2570171">anyToSockaddr</span><span class="op" id="2570184">(</span><span class="op" id="2570185">&amp;</span><span class="ident" id="2570186">rsa</span><span class="op" id="2570189">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2570192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570195">return</span><br>
<span class="lineno"></span><span class="op" id="2570202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2570205">func</span>&nbsp;<span class="ident" id="2570210">Sendto</span><span class="op" id="2570216">(</span><span class="ident" id="2570217">fd</span>&nbsp;<span class="builtintype" id="2570220">int</span><span class="op" id="2570223">,</span>&nbsp;<span class="ident" id="2570225">p</span>&nbsp;<span class="op" id="2570227">[</span><span class="op" id="2570228">]</span><span class="builtintype" id="2570229">byte</span><span class="op" id="2570233">,</span>&nbsp;<span class="ident" id="2570235">flags</span>&nbsp;<span class="builtintype" id="2570241">int</span><span class="op" id="2570244">,</span>&nbsp;<span class="ident" id="2570246">to</span>&nbsp;<span class="ident" id="2570249">Sockaddr</span><span class="op" id="2570257">)</span>&nbsp;<span class="op" id="2570259">(</span><span class="ident" id="2570260">err</span>&nbsp;<span class="builtintype" id="2570264">error</span><span class="op" id="2570269">)</span>&nbsp;<span class="op" id="2570271">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2570274">ptr</span><span class="op" id="2570277">,</span>&nbsp;<span class="ident" id="2570279">n</span><span class="op" id="2570280">,</span>&nbsp;<span class="ident" id="2570282">err</span>&nbsp;<span class="op" id="2570286">:=</span>&nbsp;<span class="ident" id="2570289">to</span><span class="op" id="2570291">.</span><span class="ident" id="2570292">sockaddr</span><span class="op" id="2570300">(</span><span class="op" id="2570301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570304">if</span>&nbsp;<span class="ident" id="2570307">err</span>&nbsp;<span class="op" id="2570311">!=</span>&nbsp;<span class="ident" id="2570314">nil</span>&nbsp;<span class="op" id="2570318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570322">return</span>&nbsp;<span class="ident" id="2570329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2570334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570337">return</span>&nbsp;<span class="ident" id="2570344">sendto</span><span class="op" id="2570350">(</span><span class="ident" id="2570351">fd</span><span class="op" id="2570353">,</span>&nbsp;<span class="ident" id="2570355">p</span><span class="op" id="2570356">,</span>&nbsp;<span class="ident" id="2570358">flags</span><span class="op" id="2570363">,</span>&nbsp;<span class="ident" id="2570365">ptr</span><span class="op" id="2570368">,</span>&nbsp;<span class="ident" id="2570370">n</span><span class="op" id="2570371">)</span><br>
<span class="lineno">235</span><span class="op" id="2570373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2570376">func</span>&nbsp;<span class="ident" id="2570381">SetsockoptByte</span><span class="op" id="2570395">(</span><span class="ident" id="2570396">fd</span><span class="op" id="2570398">,</span>&nbsp;<span class="ident" id="2570400">level</span><span class="op" id="2570405">,</span>&nbsp;<span class="ident" id="2570407">opt</span>&nbsp;<span class="builtintype" id="2570411">int</span><span class="op" id="2570414">,</span>&nbsp;<span class="ident" id="2570416">value</span>&nbsp;<span class="builtintype" id="2570422">byte</span><span class="op" id="2570426">)</span>&nbsp;<span class="op" id="2570428">(</span><span class="ident" id="2570429">err</span>&nbsp;<span class="builtintype" id="2570433">error</span><span class="op" id="2570438">)</span>&nbsp;<span class="op" id="2570440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570443">return</span>&nbsp;<span class="ident" id="2570450">setsockopt</span><span class="op" id="2570460">(</span><span class="ident" id="2570461">fd</span><span class="op" id="2570463">,</span>&nbsp;<span class="ident" id="2570465">level</span><span class="op" id="2570470">,</span>&nbsp;<span class="ident" id="2570472">opt</span><span class="op" id="2570475">,</span>&nbsp;<span class="ident" id="2570477">unsafe</span><span class="op" id="2570483">.</span><span class="ident" id="2570484">Pointer</span><span class="op" id="2570491">(</span><span class="op" id="2570492">&amp;</span><span class="ident" id="2570493">value</span><span class="op" id="2570498">)</span><span class="op" id="2570499">,</span>&nbsp;<span class="num" id="2570501">1</span><span class="op" id="2570502">)</span><br>
<span class="lineno"></span><span class="op" id="2570504">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2570507">func</span>&nbsp;<span class="ident" id="2570512">SetsockoptInt</span><span class="op" id="2570525">(</span><span class="ident" id="2570526">fd</span><span class="op" id="2570528">,</span>&nbsp;<span class="ident" id="2570530">level</span><span class="op" id="2570535">,</span>&nbsp;<span class="ident" id="2570537">opt</span>&nbsp;<span class="builtintype" id="2570541">int</span><span class="op" id="2570544">,</span>&nbsp;<span class="ident" id="2570546">value</span>&nbsp;<span class="builtintype" id="2570552">int</span><span class="op" id="2570555">)</span>&nbsp;<span class="op" id="2570557">(</span><span class="ident" id="2570558">err</span>&nbsp;<span class="builtintype" id="2570562">error</span><span class="op" id="2570567">)</span>&nbsp;<span class="op" id="2570569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570572">var</span>&nbsp;<span class="ident" id="2570576">n</span>&nbsp;<span class="op" id="2570578">=</span>&nbsp;<span class="builtintype" id="2570580">int32</span><span class="op" id="2570585">(</span><span class="ident" id="2570586">value</span><span class="op" id="2570591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570594">return</span>&nbsp;<span class="ident" id="2570601">setsockopt</span><span class="op" id="2570611">(</span><span class="ident" id="2570612">fd</span><span class="op" id="2570614">,</span>&nbsp;<span class="ident" id="2570616">level</span><span class="op" id="2570621">,</span>&nbsp;<span class="ident" id="2570623">opt</span><span class="op" id="2570626">,</span>&nbsp;<span class="ident" id="2570628">unsafe</span><span class="op" id="2570634">.</span><span class="ident" id="2570635">Pointer</span><span class="op" id="2570642">(</span><span class="op" id="2570643">&amp;</span><span class="ident" id="2570644">n</span><span class="op" id="2570645">)</span><span class="op" id="2570646">,</span>&nbsp;<span class="num" id="2570648">4</span><span class="op" id="2570649">)</span><br>
<span class="lineno"></span><span class="op" id="2570651">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2570654">func</span>&nbsp;<span class="ident" id="2570659">SetsockoptInet4Addr</span><span class="op" id="2570678">(</span><span class="ident" id="2570679">fd</span><span class="op" id="2570681">,</span>&nbsp;<span class="ident" id="2570683">level</span><span class="op" id="2570688">,</span>&nbsp;<span class="ident" id="2570690">opt</span>&nbsp;<span class="builtintype" id="2570694">int</span><span class="op" id="2570697">,</span>&nbsp;<span class="ident" id="2570699">value</span>&nbsp;<span class="op" id="2570705">[</span><span class="num" id="2570706">4</span><span class="op" id="2570707">]</span><span class="builtintype" id="2570708">byte</span><span class="op" id="2570712">)</span>&nbsp;<span class="op" id="2570714">(</span><span class="ident" id="2570715">err</span>&nbsp;<span class="builtintype" id="2570719">error</span><span class="op" id="2570724">)</span>&nbsp;<span class="op" id="2570726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570729">return</span>&nbsp;<span class="ident" id="2570736">setsockopt</span><span class="op" id="2570746">(</span><span class="ident" id="2570747">fd</span><span class="op" id="2570749">,</span>&nbsp;<span class="ident" id="2570751">level</span><span class="op" id="2570756">,</span>&nbsp;<span class="ident" id="2570758">opt</span><span class="op" id="2570761">,</span>&nbsp;<span class="ident" id="2570763">unsafe</span><span class="op" id="2570769">.</span><span class="ident" id="2570770">Pointer</span><span class="op" id="2570777">(</span><span class="op" id="2570778">&amp;</span><span class="ident" id="2570779">value</span><span class="op" id="2570784">[</span><span class="num" id="2570785">0</span><span class="op" id="2570786">]</span><span class="op" id="2570787">)</span><span class="op" id="2570788">,</span>&nbsp;<span class="num" id="2570790">4</span><span class="op" id="2570791">)</span><br>
<span class="lineno"></span><span class="op" id="2570793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2570796">func</span>&nbsp;<span class="ident" id="2570801">SetsockoptIPMreq</span><span class="op" id="2570817">(</span><span class="ident" id="2570818">fd</span><span class="op" id="2570820">,</span>&nbsp;<span class="ident" id="2570822">level</span><span class="op" id="2570827">,</span>&nbsp;<span class="ident" id="2570829">opt</span>&nbsp;<span class="builtintype" id="2570833">int</span><span class="op" id="2570836">,</span>&nbsp;<span class="ident" id="2570838">mreq</span>&nbsp;<span class="op" id="2570843">*</span><span class="ident" id="2570844">IPMreq</span><span class="op" id="2570850">)</span>&nbsp;<span class="op" id="2570852">(</span><span class="ident" id="2570853">err</span>&nbsp;<span class="builtintype" id="2570857">error</span><span class="op" id="2570862">)</span>&nbsp;<span class="op" id="2570864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2570867">return</span>&nbsp;<span class="ident" id="2570874">setsockopt</span><span class="op" id="2570884">(</span><span class="ident" id="2570885">fd</span><span class="op" id="2570887">,</span>&nbsp;<span class="ident" id="2570889">level</span><span class="op" id="2570894">,</span>&nbsp;<span class="ident" id="2570896">opt</span><span class="op" id="2570899">,</span>&nbsp;<span class="ident" id="2570901">unsafe</span><span class="op" id="2570907">.</span><span class="ident" id="2570908">Pointer</span><span class="op" id="2570915">(</span><span class="ident" id="2570916">mreq</span><span class="op" id="2570920">)</span><span class="op" id="2570921">,</span>&nbsp;<span class="ident" id="2570923">SizeofIPMreq</span><span class="op" id="2570935">)</span><br>
<span class="lineno"></span><span class="op" id="2570937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2570940">func</span>&nbsp;<span class="ident" id="2570945">SetsockoptIPv6Mreq</span><span class="op" id="2570963">(</span><span class="ident" id="2570964">fd</span><span class="op" id="2570966">,</span>&nbsp;<span class="ident" id="2570968">level</span><span class="op" id="2570973">,</span>&nbsp;<span class="ident" id="2570975">opt</span>&nbsp;<span class="builtintype" id="2570979">int</span><span class="op" id="2570982">,</span>&nbsp;<span class="ident" id="2570984">mreq</span>&nbsp;<span class="op" id="2570989">*</span><span class="ident" id="2570990">IPv6Mreq</span><span class="op" id="2570998">)</span>&nbsp;<span class="op" id="2571000">(</span><span class="ident" id="2571001">err</span>&nbsp;<span class="builtintype" id="2571005">error</span><span class="op" id="2571010">)</span>&nbsp;<span class="op" id="2571012">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571015">return</span>&nbsp;<span class="ident" id="2571022">setsockopt</span><span class="op" id="2571032">(</span><span class="ident" id="2571033">fd</span><span class="op" id="2571035">,</span>&nbsp;<span class="ident" id="2571037">level</span><span class="op" id="2571042">,</span>&nbsp;<span class="ident" id="2571044">opt</span><span class="op" id="2571047">,</span>&nbsp;<span class="ident" id="2571049">unsafe</span><span class="op" id="2571055">.</span><span class="ident" id="2571056">Pointer</span><span class="op" id="2571063">(</span><span class="ident" id="2571064">mreq</span><span class="op" id="2571068">)</span><span class="op" id="2571069">,</span>&nbsp;<span class="ident" id="2571071">SizeofIPv6Mreq</span><span class="op" id="2571085">)</span><br>
<span class="lineno"></span><span class="op" id="2571087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2571090">func</span>&nbsp;<span class="ident" id="2571095">SetsockoptICMPv6Filter</span><span class="op" id="2571117">(</span><span class="ident" id="2571118">fd</span><span class="op" id="2571120">,</span>&nbsp;<span class="ident" id="2571122">level</span><span class="op" id="2571127">,</span>&nbsp;<span class="ident" id="2571129">opt</span>&nbsp;<span class="builtintype" id="2571133">int</span><span class="op" id="2571136">,</span>&nbsp;<span class="ident" id="2571138">filter</span>&nbsp;<span class="op" id="2571145">*</span><span class="ident" id="2571146">ICMPv6Filter</span><span class="op" id="2571158">)</span>&nbsp;<span class="builtintype" id="2571160">error</span>&nbsp;<span class="op" id="2571166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571169">return</span>&nbsp;<span class="ident" id="2571176">setsockopt</span><span class="op" id="2571186">(</span><span class="ident" id="2571187">fd</span><span class="op" id="2571189">,</span>&nbsp;<span class="ident" id="2571191">level</span><span class="op" id="2571196">,</span>&nbsp;<span class="ident" id="2571198">opt</span><span class="op" id="2571201">,</span>&nbsp;<span class="ident" id="2571203">unsafe</span><span class="op" id="2571209">.</span><span class="ident" id="2571210">Pointer</span><span class="op" id="2571217">(</span><span class="ident" id="2571218">filter</span><span class="op" id="2571224">)</span><span class="op" id="2571225">,</span>&nbsp;<span class="ident" id="2571227">SizeofICMPv6Filter</span><span class="op" id="2571245">)</span><br>
<span class="lineno">260</span><span class="op" id="2571247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2571250">func</span>&nbsp;<span class="ident" id="2571255">SetsockoptLinger</span><span class="op" id="2571271">(</span><span class="ident" id="2571272">fd</span><span class="op" id="2571274">,</span>&nbsp;<span class="ident" id="2571276">level</span><span class="op" id="2571281">,</span>&nbsp;<span class="ident" id="2571283">opt</span>&nbsp;<span class="builtintype" id="2571287">int</span><span class="op" id="2571290">,</span>&nbsp;<span class="ident" id="2571292">l</span>&nbsp;<span class="op" id="2571294">*</span><span class="ident" id="2571295">Linger</span><span class="op" id="2571301">)</span>&nbsp;<span class="op" id="2571303">(</span><span class="ident" id="2571304">err</span>&nbsp;<span class="builtintype" id="2571308">error</span><span class="op" id="2571313">)</span>&nbsp;<span class="op" id="2571315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571318">return</span>&nbsp;<span class="ident" id="2571325">setsockopt</span><span class="op" id="2571335">(</span><span class="ident" id="2571336">fd</span><span class="op" id="2571338">,</span>&nbsp;<span class="ident" id="2571340">level</span><span class="op" id="2571345">,</span>&nbsp;<span class="ident" id="2571347">opt</span><span class="op" id="2571350">,</span>&nbsp;<span class="ident" id="2571352">unsafe</span><span class="op" id="2571358">.</span><span class="ident" id="2571359">Pointer</span><span class="op" id="2571366">(</span><span class="ident" id="2571367">l</span><span class="op" id="2571368">)</span><span class="op" id="2571369">,</span>&nbsp;<span class="ident" id="2571371">SizeofLinger</span><span class="op" id="2571383">)</span><br>
<span class="lineno"></span><span class="op" id="2571385">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2571388">func</span>&nbsp;<span class="ident" id="2571393">SetsockoptString</span><span class="op" id="2571409">(</span><span class="ident" id="2571410">fd</span><span class="op" id="2571412">,</span>&nbsp;<span class="ident" id="2571414">level</span><span class="op" id="2571419">,</span>&nbsp;<span class="ident" id="2571421">opt</span>&nbsp;<span class="builtintype" id="2571425">int</span><span class="op" id="2571428">,</span>&nbsp;<span class="ident" id="2571430">s</span>&nbsp;<span class="builtintype" id="2571432">string</span><span class="op" id="2571438">)</span>&nbsp;<span class="op" id="2571440">(</span><span class="ident" id="2571441">err</span>&nbsp;<span class="builtintype" id="2571445">error</span><span class="op" id="2571450">)</span>&nbsp;<span class="op" id="2571452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571455">return</span>&nbsp;<span class="ident" id="2571462">setsockopt</span><span class="op" id="2571472">(</span><span class="ident" id="2571473">fd</span><span class="op" id="2571475">,</span>&nbsp;<span class="ident" id="2571477">level</span><span class="op" id="2571482">,</span>&nbsp;<span class="ident" id="2571484">opt</span><span class="op" id="2571487">,</span>&nbsp;<span class="ident" id="2571489">unsafe</span><span class="op" id="2571495">.</span><span class="ident" id="2571496">Pointer</span><span class="op" id="2571503">(</span><span class="op" id="2571504">&amp;</span><span class="op" id="2571505">[</span><span class="op" id="2571506">]</span><span class="builtintype" id="2571507">byte</span><span class="op" id="2571511">(</span><span class="ident" id="2571512">s</span><span class="op" id="2571513">)</span><span class="op" id="2571514">[</span><span class="num" id="2571515">0</span><span class="op" id="2571516">]</span><span class="op" id="2571517">)</span><span class="op" id="2571518">,</span>&nbsp;<span class="builtintype" id="2571520">uintptr</span><span class="op" id="2571527">(</span><span class="builtinfunc" id="2571528">len</span><span class="op" id="2571531">(</span><span class="ident" id="2571532">s</span><span class="op" id="2571533">)</span><span class="op" id="2571534">)</span><span class="op" id="2571535">)</span><br>
<span class="lineno"></span><span class="op" id="2571537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2571540">func</span>&nbsp;<span class="ident" id="2571545">SetsockoptTimeval</span><span class="op" id="2571562">(</span><span class="ident" id="2571563">fd</span><span class="op" id="2571565">,</span>&nbsp;<span class="ident" id="2571567">level</span><span class="op" id="2571572">,</span>&nbsp;<span class="ident" id="2571574">opt</span>&nbsp;<span class="builtintype" id="2571578">int</span><span class="op" id="2571581">,</span>&nbsp;<span class="ident" id="2571583">tv</span>&nbsp;<span class="op" id="2571586">*</span><span class="ident" id="2571587">Timeval</span><span class="op" id="2571594">)</span>&nbsp;<span class="op" id="2571596">(</span><span class="ident" id="2571597">err</span>&nbsp;<span class="builtintype" id="2571601">error</span><span class="op" id="2571606">)</span>&nbsp;<span class="op" id="2571608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571611">return</span>&nbsp;<span class="ident" id="2571618">setsockopt</span><span class="op" id="2571628">(</span><span class="ident" id="2571629">fd</span><span class="op" id="2571631">,</span>&nbsp;<span class="ident" id="2571633">level</span><span class="op" id="2571638">,</span>&nbsp;<span class="ident" id="2571640">opt</span><span class="op" id="2571643">,</span>&nbsp;<span class="ident" id="2571645">unsafe</span><span class="op" id="2571651">.</span><span class="ident" id="2571652">Pointer</span><span class="op" id="2571659">(</span><span class="ident" id="2571660">tv</span><span class="op" id="2571662">)</span><span class="op" id="2571663">,</span>&nbsp;<span class="ident" id="2571665">unsafe</span><span class="op" id="2571671">.</span><span class="ident" id="2571672">Sizeof</span><span class="op" id="2571678">(</span><span class="op" id="2571679">*</span><span class="ident" id="2571680">tv</span><span class="op" id="2571682">)</span><span class="op" id="2571683">)</span><br>
<span class="lineno"></span><span class="op" id="2571685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2571688">func</span>&nbsp;<span class="ident" id="2571693">Socket</span><span class="op" id="2571699">(</span><span class="ident" id="2571700">domain</span><span class="op" id="2571706">,</span>&nbsp;<span class="ident" id="2571708">typ</span><span class="op" id="2571711">,</span>&nbsp;<span class="ident" id="2571713">proto</span>&nbsp;<span class="builtintype" id="2571719">int</span><span class="op" id="2571722">)</span>&nbsp;<span class="op" id="2571724">(</span><span class="ident" id="2571725">fd</span>&nbsp;<span class="builtintype" id="2571728">int</span><span class="op" id="2571731">,</span>&nbsp;<span class="ident" id="2571733">err</span>&nbsp;<span class="builtintype" id="2571737">error</span><span class="op" id="2571742">)</span>&nbsp;<span class="op" id="2571744">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571747">if</span>&nbsp;<span class="ident" id="2571750">domain</span>&nbsp;<span class="op" id="2571757">==</span>&nbsp;<span class="ident" id="2571760">AF_INET6</span>&nbsp;<span class="op" id="2571769">&amp;&amp;</span>&nbsp;<span class="ident" id="2571772">SocketDisableIPv6</span>&nbsp;<span class="op" id="2571790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571794">return</span>&nbsp;<span class="op" id="2571801">-</span><span class="num" id="2571802">1</span><span class="op" id="2571803">,</span>&nbsp;<span class="ident" id="2571805">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2571819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571822">fd</span><span class="op" id="2571824">,</span>&nbsp;<span class="ident" id="2571826">err</span>&nbsp;<span class="op" id="2571830">=</span>&nbsp;<span class="ident" id="2571832">socket</span><span class="op" id="2571838">(</span><span class="ident" id="2571839">domain</span><span class="op" id="2571845">,</span>&nbsp;<span class="ident" id="2571847">typ</span><span class="op" id="2571850">,</span>&nbsp;<span class="ident" id="2571852">proto</span><span class="op" id="2571857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571860">return</span><br>
<span class="lineno">280</span><span class="op" id="2571867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2571870">func</span>&nbsp;<span class="ident" id="2571875">Socketpair</span><span class="op" id="2571885">(</span><span class="ident" id="2571886">domain</span><span class="op" id="2571892">,</span>&nbsp;<span class="ident" id="2571894">typ</span><span class="op" id="2571897">,</span>&nbsp;<span class="ident" id="2571899">proto</span>&nbsp;<span class="builtintype" id="2571905">int</span><span class="op" id="2571908">)</span>&nbsp;<span class="op" id="2571910">(</span><span class="ident" id="2571911">fd</span>&nbsp;<span class="op" id="2571914">[</span><span class="num" id="2571915">2</span><span class="op" id="2571916">]</span><span class="builtintype" id="2571917">int</span><span class="op" id="2571920">,</span>&nbsp;<span class="ident" id="2571922">err</span>&nbsp;<span class="builtintype" id="2571926">error</span><span class="op" id="2571931">)</span>&nbsp;<span class="op" id="2571933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571936">var</span>&nbsp;<span class="ident" id="2571940">fdx</span>&nbsp;<span class="op" id="2571944">[</span><span class="num" id="2571945">2</span><span class="op" id="2571946">]</span><span class="builtintype" id="2571947">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571954">err</span>&nbsp;<span class="op" id="2571958">=</span>&nbsp;<span class="ident" id="2571960">socketpair</span><span class="op" id="2571970">(</span><span class="ident" id="2571971">domain</span><span class="op" id="2571977">,</span>&nbsp;<span class="ident" id="2571979">typ</span><span class="op" id="2571982">,</span>&nbsp;<span class="ident" id="2571984">proto</span><span class="op" id="2571989">,</span>&nbsp;<span class="op" id="2571991">&amp;</span><span class="ident" id="2571992">fdx</span><span class="op" id="2571995">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571998">if</span>&nbsp;<span class="ident" id="2572001">err</span>&nbsp;<span class="op" id="2572005">==</span>&nbsp;<span class="ident" id="2572008">nil</span>&nbsp;<span class="op" id="2572012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2572016">fd</span><span class="op" id="2572018">[</span><span class="num" id="2572019">0</span><span class="op" id="2572020">]</span>&nbsp;<span class="op" id="2572022">=</span>&nbsp;<span class="builtintype" id="2572024">int</span><span class="op" id="2572027">(</span><span class="ident" id="2572028">fdx</span><span class="op" id="2572031">[</span><span class="num" id="2572032">0</span><span class="op" id="2572033">]</span><span class="op" id="2572034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2572038">fd</span><span class="op" id="2572040">[</span><span class="num" id="2572041">1</span><span class="op" id="2572042">]</span>&nbsp;<span class="op" id="2572044">=</span>&nbsp;<span class="builtintype" id="2572046">int</span><span class="op" id="2572049">(</span><span class="ident" id="2572050">fdx</span><span class="op" id="2572053">[</span><span class="num" id="2572054">1</span><span class="op" id="2572055">]</span><span class="op" id="2572056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2572059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2572062">return</span><br>
<span class="lineno">290</span><span class="op" id="2572069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2572072">func</span>&nbsp;<span class="ident" id="2572077">Sendfile</span><span class="op" id="2572085">(</span><span class="ident" id="2572086">outfd</span>&nbsp;<span class="builtintype" id="2572092">int</span><span class="op" id="2572095">,</span>&nbsp;<span class="ident" id="2572097">infd</span>&nbsp;<span class="builtintype" id="2572102">int</span><span class="op" id="2572105">,</span>&nbsp;<span class="ident" id="2572107">offset</span>&nbsp;<span class="op" id="2572114">*</span><span class="ident" id="2572115">int64</span><span class="op" id="2572120">,</span>&nbsp;<span class="ident" id="2572122">count</span>&nbsp;<span class="builtintype" id="2572128">int</span><span class="op" id="2572131">)</span>&nbsp;<span class="op" id="2572133">(</span><span class="ident" id="2572134">written</span>&nbsp;<span class="builtintype" id="2572142">int</span><span class="op" id="2572145">,</span>&nbsp;<span class="ident" id="2572147">err</span>&nbsp;<span class="builtintype" id="2572151">error</span><span class="op" id="2572156">)</span>&nbsp;<span class="op" id="2572158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2572161">if</span>&nbsp;<span class="ident" id="2572164">raceenabled</span>&nbsp;<span class="op" id="2572176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2572180">raceReleaseMerge</span><span class="op" id="2572196">(</span><span class="ident" id="2572197">unsafe</span><span class="op" id="2572203">.</span><span class="ident" id="2572204">Pointer</span><span class="op" id="2572211">(</span><span class="op" id="2572212">&amp;</span><span class="ident" id="2572213">ioSync</span><span class="op" id="2572219">)</span><span class="op" id="2572220">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2572223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2572226">return</span>&nbsp;<span class="ident" id="2572233">sendfile</span><span class="op" id="2572241">(</span><span class="ident" id="2572242">outfd</span><span class="op" id="2572247">,</span>&nbsp;<span class="ident" id="2572249">infd</span><span class="op" id="2572253">,</span>&nbsp;<span class="ident" id="2572255">offset</span><span class="op" id="2572261">,</span>&nbsp;<span class="ident" id="2572263">count</span><span class="op" id="2572268">)</span><br>
<span class="lineno"></span><span class="op" id="2572270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2572273">var</span>&nbsp;<span class="ident" id="2572277">ioSync</span>&nbsp;<span class="ident" id="2572284">int64</span>
</div>
</body>
</html>
