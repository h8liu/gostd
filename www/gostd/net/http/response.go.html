<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html" class="current">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3542087">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3542142">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3542196">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3542247">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3542286">package</span>&nbsp;<span class="ident" id="3542294">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3542300">import</span>&nbsp;<span class="op" id="3542307">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542310">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542319">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542328">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542342">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542352">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542358">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542375">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542386">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542397">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3542407">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3542410">var</span>&nbsp;<span class="ident" id="3542414">respExcludeHeader</span>&nbsp;<span class="op" id="3542432">=</span>&nbsp;<span class="keyword" id="3542434">map</span><span class="op" id="3542437">[</span><span class="builtintype" id="3542438">string</span><span class="op" id="3542444">]</span><span class="builtintype" id="3542445">bool</span><span class="op" id="3542449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542452">&#34;Content-Length&#34;</span><span class="op" id="3542468">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542473">true</span><span class="op" id="3542477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542480">&#34;Transfer-Encoding&#34;</span><span class="op" id="3542499">:</span>&nbsp;<span class="builtintype" id="3542501">true</span><span class="op" id="3542505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3542508">&#34;Trailer&#34;</span><span class="op" id="3542517">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542529">true</span><span class="op" id="3542533">,</span><br>
<span class="lineno">25</span><span class="op" id="3542535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3542538">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3542596">//</span><br>
<span class="lineno"></span><span class="keyword" id="3542599">type</span>&nbsp;<span class="ident" id="3542604">Response</span>&nbsp;<span class="keyword" id="3542613">struct</span>&nbsp;<span class="op" id="3542620">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542623">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542634">string</span>&nbsp;<span class="comment" id="3542641">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542659">StatusCode</span>&nbsp;<span class="builtintype" id="3542670">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542677">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542690">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542701">string</span>&nbsp;<span class="comment" id="3542708">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542728">ProtoMajor</span>&nbsp;<span class="builtintype" id="3542739">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542746">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542757">ProtoMinor</span>&nbsp;<span class="builtintype" id="3542768">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542775">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542787">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542856">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542924">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542997">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543067">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543139">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543164">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543168">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543232">Header</span>&nbsp;<span class="ident" id="3543239">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543248">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543287">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543291">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543355">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543419">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543480">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543496">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543500">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543562">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543602">Body</span>&nbsp;<span class="ident" id="3543607">io</span><span class="op" id="3543609">.</span><span class="ident" id="3543610">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543623">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543692">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543766">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543837">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543860">ContentLength</span>&nbsp;<span class="builtintype" id="3543874">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543882">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543954">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544003">TransferEncoding</span>&nbsp;<span class="op" id="3544020">[</span><span class="op" id="3544021">]</span><span class="builtintype" id="3544022">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544031">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544100">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544173">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544235">Close</span>&nbsp;<span class="builtintype" id="3544241">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544248">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544301">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544327">Trailer</span>&nbsp;<span class="ident" id="3544335">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544344">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544399">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544457">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544505">Request</span>&nbsp;<span class="op" id="3544513">*</span><span class="ident" id="3544514">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544524">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544591">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544655">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3544717">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3544731">TLS</span>&nbsp;<span class="op" id="3544735">*</span><span class="ident" id="3544736">tls</span><span class="op" id="3544739">.</span><span class="ident" id="3544740">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3544756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3544759">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3544832">func</span>&nbsp;<span class="op" id="3544837">(</span><span class="ident" id="3544838">r</span>&nbsp;<span class="op" id="3544840">*</span><span class="ident" id="3544841">Response</span><span class="op" id="3544849">)</span>&nbsp;<span class="ident" id="3544851">Cookies</span><span class="op" id="3544858">(</span><span class="op" id="3544859">)</span>&nbsp;<span class="op" id="3544861">[</span><span class="op" id="3544862">]</span><span class="op" id="3544863">*</span><span class="ident" id="3544864">Cookie</span>&nbsp;<span class="op" id="3544871">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3544874">return</span>&nbsp;<span class="ident" id="3544881">readSetCookies</span><span class="op" id="3544895">(</span><span class="ident" id="3544896">r</span><span class="op" id="3544897">.</span><span class="ident" id="3544898">Header</span><span class="op" id="3544904">)</span><br>
<span class="lineno"></span><span class="op" id="3544906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3544909">var</span>&nbsp;<span class="ident" id="3544913">ErrNoLocation</span>&nbsp;<span class="op" id="3544927">=</span>&nbsp;<span class="ident" id="3544929">errors</span><span class="op" id="3544935">.</span><span class="ident" id="3544936">New</span><span class="op" id="3544939">(</span><span class="string" id="3544940">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3544978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3544981">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3545046">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3545106">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3545166">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3545197">func</span>&nbsp;<span class="op" id="3545202">(</span><span class="ident" id="3545203">r</span>&nbsp;<span class="op" id="3545205">*</span><span class="ident" id="3545206">Response</span><span class="op" id="3545214">)</span>&nbsp;<span class="ident" id="3545216">Location</span><span class="op" id="3545224">(</span><span class="op" id="3545225">)</span>&nbsp;<span class="op" id="3545227">(</span><span class="op" id="3545228">*</span><span class="ident" id="3545229">url</span><span class="op" id="3545232">.</span><span class="ident" id="3545233">URL</span><span class="op" id="3545236">,</span>&nbsp;<span class="builtintype" id="3545238">error</span><span class="op" id="3545243">)</span>&nbsp;<span class="op" id="3545245">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545248">lv</span>&nbsp;<span class="op" id="3545251">:=</span>&nbsp;<span class="ident" id="3545254">r</span><span class="op" id="3545255">.</span><span class="ident" id="3545256">Header</span><span class="op" id="3545262">.</span><span class="ident" id="3545263">Get</span><span class="op" id="3545266">(</span><span class="string" id="3545267">&#34;Location&#34;</span><span class="op" id="3545277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3545280">if</span>&nbsp;<span class="ident" id="3545283">lv</span>&nbsp;<span class="op" id="3545286">==</span>&nbsp;<span class="string" id="3545289">&#34;&#34;</span>&nbsp;<span class="op" id="3545292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3545296">return</span>&nbsp;<span class="builtintype" id="3545303">nil</span><span class="op" id="3545306">,</span>&nbsp;<span class="ident" id="3545308">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3545323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3545326">if</span>&nbsp;<span class="ident" id="3545329">r</span><span class="op" id="3545330">.</span><span class="ident" id="3545331">Request</span>&nbsp;<span class="op" id="3545339">!=</span>&nbsp;<span class="builtintype" id="3545342">nil</span>&nbsp;<span class="op" id="3545346">&amp;&amp;</span>&nbsp;<span class="ident" id="3545349">r</span><span class="op" id="3545350">.</span><span class="ident" id="3545351">Request</span><span class="op" id="3545358">.</span><span class="ident" id="3545359">URL</span>&nbsp;<span class="op" id="3545363">!=</span>&nbsp;<span class="builtintype" id="3545366">nil</span>&nbsp;<span class="op" id="3545370">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3545374">return</span>&nbsp;<span class="ident" id="3545381">r</span><span class="op" id="3545382">.</span><span class="ident" id="3545383">Request</span><span class="op" id="3545390">.</span><span class="ident" id="3545391">URL</span><span class="op" id="3545394">.</span><span class="ident" id="3545395">Parse</span><span class="op" id="3545400">(</span><span class="ident" id="3545401">lv</span><span class="op" id="3545403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3545406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3545409">return</span>&nbsp;<span class="ident" id="3545416">url</span><span class="op" id="3545419">.</span><span class="ident" id="3545420">Parse</span><span class="op" id="3545425">(</span><span class="ident" id="3545426">lv</span><span class="op" id="3545428">)</span><br>
<span class="lineno"></span><span class="op" id="3545430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3545433">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3545492">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3545563">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3545618">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3545688">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3545759">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3545802">func</span>&nbsp;<span class="ident" id="3545807">ReadResponse</span><span class="op" id="3545819">(</span><span class="ident" id="3545820">r</span>&nbsp;<span class="op" id="3545822">*</span><span class="ident" id="3545823">bufio</span><span class="op" id="3545828">.</span><span class="ident" id="3545829">Reader</span><span class="op" id="3545835">,</span>&nbsp;<span class="ident" id="3545837">req</span>&nbsp;<span class="op" id="3545841">*</span><span class="ident" id="3545842">Request</span><span class="op" id="3545849">)</span>&nbsp;<span class="op" id="3545851">(</span><span class="op" id="3545852">*</span><span class="ident" id="3545853">Response</span><span class="op" id="3545861">,</span>&nbsp;<span class="builtintype" id="3545863">error</span><span class="op" id="3545868">)</span>&nbsp;<span class="op" id="3545870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545873">tp</span>&nbsp;<span class="op" id="3545876">:=</span>&nbsp;<span class="ident" id="3545879">textproto</span><span class="op" id="3545888">.</span><span class="ident" id="3545889">NewReader</span><span class="op" id="3545898">(</span><span class="ident" id="3545899">r</span><span class="op" id="3545900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545903">resp</span>&nbsp;<span class="op" id="3545908">:=</span>&nbsp;<span class="op" id="3545911">&amp;</span><span class="ident" id="3545912">Response</span><span class="op" id="3545920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545924">Request</span><span class="op" id="3545931">:</span>&nbsp;<span class="ident" id="3545933">req</span><span class="op" id="3545936">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3545939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3545943">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3545985">line</span><span class="op" id="3545989">,</span>&nbsp;<span class="ident" id="3545991">err</span>&nbsp;<span class="op" id="3545995">:=</span>&nbsp;<span class="ident" id="3545998">tp</span><span class="op" id="3546000">.</span><span class="ident" id="3546001">ReadLine</span><span class="op" id="3546009">(</span><span class="op" id="3546010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546013">if</span>&nbsp;<span class="ident" id="3546016">err</span>&nbsp;<span class="op" id="3546020">!=</span>&nbsp;<span class="builtintype" id="3546023">nil</span>&nbsp;<span class="op" id="3546027">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546031">if</span>&nbsp;<span class="ident" id="3546034">err</span>&nbsp;<span class="op" id="3546038">==</span>&nbsp;<span class="ident" id="3546041">io</span><span class="op" id="3546043">.</span><span class="ident" id="3546044">EOF</span>&nbsp;<span class="op" id="3546048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546053">err</span>&nbsp;<span class="op" id="3546057">=</span>&nbsp;<span class="ident" id="3546059">io</span><span class="op" id="3546061">.</span><span class="ident" id="3546062">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546085">return</span>&nbsp;<span class="builtintype" id="3546092">nil</span><span class="op" id="3546095">,</span>&nbsp;<span class="ident" id="3546097">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546102">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546105">f</span>&nbsp;<span class="op" id="3546107">:=</span>&nbsp;<span class="ident" id="3546110">strings</span><span class="op" id="3546117">.</span><span class="ident" id="3546118">SplitN</span><span class="op" id="3546124">(</span><span class="ident" id="3546125">line</span><span class="op" id="3546129">,</span>&nbsp;<span class="string" id="3546131">&#34;&nbsp;&#34;</span><span class="op" id="3546134">,</span>&nbsp;<span class="num" id="3546136">3</span><span class="op" id="3546137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546140">if</span>&nbsp;<span class="builtinfunc" id="3546143">len</span><span class="op" id="3546146">(</span><span class="ident" id="3546147">f</span><span class="op" id="3546148">)</span>&nbsp;<span class="op" id="3546150">&lt;</span>&nbsp;<span class="num" id="3546152">2</span>&nbsp;<span class="op" id="3546154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546158">return</span>&nbsp;<span class="builtintype" id="3546165">nil</span><span class="op" id="3546168">,</span>&nbsp;<span class="op" id="3546170">&amp;</span><span class="ident" id="3546171">badStringError</span><span class="op" id="3546185">{</span><span class="string" id="3546186">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3546211">,</span>&nbsp;<span class="ident" id="3546213">line</span><span class="op" id="3546217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546223">reasonPhrase</span>&nbsp;<span class="op" id="3546236">:=</span>&nbsp;<span class="string" id="3546239">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546243">if</span>&nbsp;<span class="builtinfunc" id="3546246">len</span><span class="op" id="3546249">(</span><span class="ident" id="3546250">f</span><span class="op" id="3546251">)</span>&nbsp;<span class="op" id="3546253">&gt;</span>&nbsp;<span class="num" id="3546255">2</span>&nbsp;<span class="op" id="3546257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546261">reasonPhrase</span>&nbsp;<span class="op" id="3546274">=</span>&nbsp;<span class="ident" id="3546276">f</span><span class="op" id="3546277">[</span><span class="num" id="3546278">2</span><span class="op" id="3546279">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546285">resp</span><span class="op" id="3546289">.</span><span class="ident" id="3546290">Status</span>&nbsp;<span class="op" id="3546297">=</span>&nbsp;<span class="ident" id="3546299">f</span><span class="op" id="3546300">[</span><span class="num" id="3546301">1</span><span class="op" id="3546302">]</span>&nbsp;<span class="op" id="3546304">+</span>&nbsp;<span class="string" id="3546306">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3546310">+</span>&nbsp;<span class="ident" id="3546312">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546326">resp</span><span class="op" id="3546330">.</span><span class="ident" id="3546331">StatusCode</span><span class="op" id="3546341">,</span>&nbsp;<span class="ident" id="3546343">err</span>&nbsp;<span class="op" id="3546347">=</span>&nbsp;<span class="ident" id="3546349">strconv</span><span class="op" id="3546356">.</span><span class="ident" id="3546357">Atoi</span><span class="op" id="3546361">(</span><span class="ident" id="3546362">f</span><span class="op" id="3546363">[</span><span class="num" id="3546364">1</span><span class="op" id="3546365">]</span><span class="op" id="3546366">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546369">if</span>&nbsp;<span class="ident" id="3546372">err</span>&nbsp;<span class="op" id="3546376">!=</span>&nbsp;<span class="builtintype" id="3546379">nil</span>&nbsp;<span class="op" id="3546383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546387">return</span>&nbsp;<span class="builtintype" id="3546394">nil</span><span class="op" id="3546397">,</span>&nbsp;<span class="op" id="3546399">&amp;</span><span class="ident" id="3546400">badStringError</span><span class="op" id="3546414">{</span><span class="string" id="3546415">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3546443">,</span>&nbsp;<span class="ident" id="3546445">f</span><span class="op" id="3546446">[</span><span class="num" id="3546447">1</span><span class="op" id="3546448">]</span><span class="op" id="3546449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546456">resp</span><span class="op" id="3546460">.</span><span class="ident" id="3546461">Proto</span>&nbsp;<span class="op" id="3546467">=</span>&nbsp;<span class="ident" id="3546469">f</span><span class="op" id="3546470">[</span><span class="num" id="3546471">0</span><span class="op" id="3546472">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546475">var</span>&nbsp;<span class="ident" id="3546479">ok</span>&nbsp;<span class="builtintype" id="3546482">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546488">if</span>&nbsp;<span class="ident" id="3546491">resp</span><span class="op" id="3546495">.</span><span class="ident" id="3546496">ProtoMajor</span><span class="op" id="3546506">,</span>&nbsp;<span class="ident" id="3546508">resp</span><span class="op" id="3546512">.</span><span class="ident" id="3546513">ProtoMinor</span><span class="op" id="3546523">,</span>&nbsp;<span class="ident" id="3546525">ok</span>&nbsp;<span class="op" id="3546528">=</span>&nbsp;<span class="ident" id="3546530">ParseHTTPVersion</span><span class="op" id="3546546">(</span><span class="ident" id="3546547">resp</span><span class="op" id="3546551">.</span><span class="ident" id="3546552">Proto</span><span class="op" id="3546557">)</span><span class="op" id="3546558">;</span>&nbsp;<span class="op" id="3546560">!</span><span class="ident" id="3546561">ok</span>&nbsp;<span class="op" id="3546564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546568">return</span>&nbsp;<span class="builtintype" id="3546575">nil</span><span class="op" id="3546578">,</span>&nbsp;<span class="op" id="3546580">&amp;</span><span class="ident" id="3546581">badStringError</span><span class="op" id="3546595">{</span><span class="string" id="3546596">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3546620">,</span>&nbsp;<span class="ident" id="3546622">resp</span><span class="op" id="3546626">.</span><span class="ident" id="3546627">Proto</span><span class="op" id="3546632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3546639">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546671">mimeHeader</span><span class="op" id="3546681">,</span>&nbsp;<span class="ident" id="3546683">err</span>&nbsp;<span class="op" id="3546687">:=</span>&nbsp;<span class="ident" id="3546690">tp</span><span class="op" id="3546692">.</span><span class="ident" id="3546693">ReadMIMEHeader</span><span class="op" id="3546707">(</span><span class="op" id="3546708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546711">if</span>&nbsp;<span class="ident" id="3546714">err</span>&nbsp;<span class="op" id="3546718">!=</span>&nbsp;<span class="builtintype" id="3546721">nil</span>&nbsp;<span class="op" id="3546725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546729">if</span>&nbsp;<span class="ident" id="3546732">err</span>&nbsp;<span class="op" id="3546736">==</span>&nbsp;<span class="ident" id="3546739">io</span><span class="op" id="3546741">.</span><span class="ident" id="3546742">EOF</span>&nbsp;<span class="op" id="3546746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546751">err</span>&nbsp;<span class="op" id="3546755">=</span>&nbsp;<span class="ident" id="3546757">io</span><span class="op" id="3546759">.</span><span class="ident" id="3546760">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546783">return</span>&nbsp;<span class="builtintype" id="3546790">nil</span><span class="op" id="3546793">,</span>&nbsp;<span class="ident" id="3546795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546803">resp</span><span class="op" id="3546807">.</span><span class="ident" id="3546808">Header</span>&nbsp;<span class="op" id="3546815">=</span>&nbsp;<span class="ident" id="3546817">Header</span><span class="op" id="3546823">(</span><span class="ident" id="3546824">mimeHeader</span><span class="op" id="3546834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546838">fixPragmaCacheControl</span><span class="op" id="3546859">(</span><span class="ident" id="3546860">resp</span><span class="op" id="3546864">.</span><span class="ident" id="3546865">Header</span><span class="op" id="3546871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3546875">err</span>&nbsp;<span class="op" id="3546879">=</span>&nbsp;<span class="ident" id="3546881">readTransfer</span><span class="op" id="3546893">(</span><span class="ident" id="3546894">resp</span><span class="op" id="3546898">,</span>&nbsp;<span class="ident" id="3546900">r</span><span class="op" id="3546901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546904">if</span>&nbsp;<span class="ident" id="3546907">err</span>&nbsp;<span class="op" id="3546911">!=</span>&nbsp;<span class="builtintype" id="3546914">nil</span>&nbsp;<span class="op" id="3546918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546922">return</span>&nbsp;<span class="builtintype" id="3546929">nil</span><span class="op" id="3546932">,</span>&nbsp;<span class="ident" id="3546934">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3546939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3546943">return</span>&nbsp;<span class="ident" id="3546950">resp</span><span class="op" id="3546954">,</span>&nbsp;<span class="builtintype" id="3546956">nil</span><br>
<span class="lineno"></span><span class="op" id="3546960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3546963">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3546988">//&nbsp;&nbsp;&nbsp;&nbsp;Pragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3547008">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3547016">//&nbsp;&nbsp;&nbsp;&nbsp;Cache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3547043">func</span>&nbsp;<span class="ident" id="3547048">fixPragmaCacheControl</span><span class="op" id="3547069">(</span><span class="ident" id="3547070">header</span>&nbsp;<span class="ident" id="3547077">Header</span><span class="op" id="3547083">)</span>&nbsp;<span class="op" id="3547085">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3547088">if</span>&nbsp;<span class="ident" id="3547091">hp</span><span class="op" id="3547093">,</span>&nbsp;<span class="ident" id="3547095">ok</span>&nbsp;<span class="op" id="3547098">:=</span>&nbsp;<span class="ident" id="3547101">header</span><span class="op" id="3547107">[</span><span class="string" id="3547108">&#34;Pragma&#34;</span><span class="op" id="3547116">]</span><span class="op" id="3547117">;</span>&nbsp;<span class="ident" id="3547119">ok</span>&nbsp;<span class="op" id="3547122">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3547125">len</span><span class="op" id="3547128">(</span><span class="ident" id="3547129">hp</span><span class="op" id="3547131">)</span>&nbsp;<span class="op" id="3547133">&gt;</span>&nbsp;<span class="num" id="3547135">0</span>&nbsp;<span class="op" id="3547137">&amp;&amp;</span>&nbsp;<span class="ident" id="3547140">hp</span><span class="op" id="3547142">[</span><span class="num" id="3547143">0</span><span class="op" id="3547144">]</span>&nbsp;<span class="op" id="3547146">==</span>&nbsp;<span class="string" id="3547149">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3547160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3547164">if</span>&nbsp;<span class="ident" id="3547167">_</span><span class="op" id="3547168">,</span>&nbsp;<span class="ident" id="3547170">presentcc</span>&nbsp;<span class="op" id="3547180">:=</span>&nbsp;<span class="ident" id="3547183">header</span><span class="op" id="3547189">[</span><span class="string" id="3547190">&#34;Cache-Control&#34;</span><span class="op" id="3547205">]</span><span class="op" id="3547206">;</span>&nbsp;<span class="op" id="3547208">!</span><span class="ident" id="3547209">presentcc</span>&nbsp;<span class="op" id="3547219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3547224">header</span><span class="op" id="3547230">[</span><span class="string" id="3547231">&#34;Cache-Control&#34;</span><span class="op" id="3547246">]</span>&nbsp;<span class="op" id="3547248">=</span>&nbsp;<span class="op" id="3547250">[</span><span class="op" id="3547251">]</span><span class="builtintype" id="3547252">string</span><span class="op" id="3547258">{</span><span class="string" id="3547259">&#34;no-cache&#34;</span><span class="op" id="3547269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3547273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3547276">}</span><br>
<span class="lineno">180</span><span class="op" id="3547278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3547281">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3547336">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3547380">func</span>&nbsp;<span class="op" id="3547385">(</span><span class="ident" id="3547386">r</span>&nbsp;<span class="op" id="3547388">*</span><span class="ident" id="3547389">Response</span><span class="op" id="3547397">)</span>&nbsp;<span class="ident" id="3547399">ProtoAtLeast</span><span class="op" id="3547411">(</span><span class="ident" id="3547412">major</span><span class="op" id="3547417">,</span>&nbsp;<span class="ident" id="3547419">minor</span>&nbsp;<span class="builtintype" id="3547425">int</span><span class="op" id="3547428">)</span>&nbsp;<span class="builtintype" id="3547430">bool</span>&nbsp;<span class="op" id="3547435">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3547438">return</span>&nbsp;<span class="ident" id="3547445">r</span><span class="op" id="3547446">.</span><span class="ident" id="3547447">ProtoMajor</span>&nbsp;<span class="op" id="3547458">&gt;</span>&nbsp;<span class="ident" id="3547460">major</span>&nbsp;<span class="op" id="3547466">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3547471">r</span><span class="op" id="3547472">.</span><span class="ident" id="3547473">ProtoMajor</span>&nbsp;<span class="op" id="3547484">==</span>&nbsp;<span class="ident" id="3547487">major</span>&nbsp;<span class="op" id="3547493">&amp;&amp;</span>&nbsp;<span class="ident" id="3547496">r</span><span class="op" id="3547497">.</span><span class="ident" id="3547498">ProtoMinor</span>&nbsp;<span class="op" id="3547509">&gt;=</span>&nbsp;<span class="ident" id="3547512">minor</span><br>
<span class="lineno"></span><span class="op" id="3547518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3547521">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3547599">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3547649">//</span><br>
<span class="lineno"></span><span class="comment" id="3547652">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3547667">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3547682">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3547697">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3547716">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3547737">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3547749">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3547758">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3547776">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3547851">//</span><br>
<span class="lineno"></span><span class="comment" id="3547854">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3547890">func</span>&nbsp;<span class="op" id="3547895">(</span><span class="ident" id="3547896">r</span>&nbsp;<span class="op" id="3547898">*</span><span class="ident" id="3547899">Response</span><span class="op" id="3547907">)</span>&nbsp;<span class="ident" id="3547909">Write</span><span class="op" id="3547914">(</span><span class="ident" id="3547915">w</span>&nbsp;<span class="ident" id="3547917">io</span><span class="op" id="3547919">.</span><span class="ident" id="3547920">Writer</span><span class="op" id="3547926">)</span>&nbsp;<span class="builtintype" id="3547928">error</span>&nbsp;<span class="op" id="3547934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3547937">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3547953">text</span>&nbsp;<span class="op" id="3547958">:=</span>&nbsp;<span class="ident" id="3547961">r</span><span class="op" id="3547962">.</span><span class="ident" id="3547963">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3547971">if</span>&nbsp;<span class="ident" id="3547974">text</span>&nbsp;<span class="op" id="3547979">==</span>&nbsp;<span class="string" id="3547982">&#34;&#34;</span>&nbsp;<span class="op" id="3547985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3547989">var</span>&nbsp;<span class="ident" id="3547993">ok</span>&nbsp;<span class="builtintype" id="3547996">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548003">text</span><span class="op" id="3548007">,</span>&nbsp;<span class="ident" id="3548009">ok</span>&nbsp;<span class="op" id="3548012">=</span>&nbsp;<span class="ident" id="3548014">statusText</span><span class="op" id="3548024">[</span><span class="ident" id="3548025">r</span><span class="op" id="3548026">.</span><span class="ident" id="3548027">StatusCode</span><span class="op" id="3548037">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548041">if</span>&nbsp;<span class="op" id="3548044">!</span><span class="ident" id="3548045">ok</span>&nbsp;<span class="op" id="3548048">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548053">text</span>&nbsp;<span class="op" id="3548058">=</span>&nbsp;<span class="string" id="3548060">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3548075">+</span>&nbsp;<span class="ident" id="3548077">strconv</span><span class="op" id="3548084">.</span><span class="ident" id="3548085">Itoa</span><span class="op" id="3548089">(</span><span class="ident" id="3548090">r</span><span class="op" id="3548091">.</span><span class="ident" id="3548092">StatusCode</span><span class="op" id="3548102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548112">protoMajor</span><span class="op" id="3548122">,</span>&nbsp;<span class="ident" id="3548124">protoMinor</span>&nbsp;<span class="op" id="3548135">:=</span>&nbsp;<span class="ident" id="3548138">strconv</span><span class="op" id="3548145">.</span><span class="ident" id="3548146">Itoa</span><span class="op" id="3548150">(</span><span class="ident" id="3548151">r</span><span class="op" id="3548152">.</span><span class="ident" id="3548153">ProtoMajor</span><span class="op" id="3548163">)</span><span class="op" id="3548164">,</span>&nbsp;<span class="ident" id="3548166">strconv</span><span class="op" id="3548173">.</span><span class="ident" id="3548174">Itoa</span><span class="op" id="3548178">(</span><span class="ident" id="3548179">r</span><span class="op" id="3548180">.</span><span class="ident" id="3548181">ProtoMinor</span><span class="op" id="3548191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548194">statusCode</span>&nbsp;<span class="op" id="3548205">:=</span>&nbsp;<span class="ident" id="3548208">strconv</span><span class="op" id="3548215">.</span><span class="ident" id="3548216">Itoa</span><span class="op" id="3548220">(</span><span class="ident" id="3548221">r</span><span class="op" id="3548222">.</span><span class="ident" id="3548223">StatusCode</span><span class="op" id="3548233">)</span>&nbsp;<span class="op" id="3548235">+</span>&nbsp;<span class="string" id="3548237">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548242">text</span>&nbsp;<span class="op" id="3548247">=</span>&nbsp;<span class="ident" id="3548249">strings</span><span class="op" id="3548256">.</span><span class="ident" id="3548257">TrimPrefix</span><span class="op" id="3548267">(</span><span class="ident" id="3548268">text</span><span class="op" id="3548272">,</span>&nbsp;<span class="ident" id="3548274">statusCode</span><span class="op" id="3548284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548287">if</span>&nbsp;<span class="ident" id="3548290">_</span><span class="op" id="3548291">,</span>&nbsp;<span class="ident" id="3548293">err</span>&nbsp;<span class="op" id="3548297">:=</span>&nbsp;<span class="ident" id="3548300">io</span><span class="op" id="3548302">.</span><span class="ident" id="3548303">WriteString</span><span class="op" id="3548314">(</span><span class="ident" id="3548315">w</span><span class="op" id="3548316">,</span>&nbsp;<span class="string" id="3548318">&#34;HTTP/&#34;</span><span class="op" id="3548325">+</span><span class="ident" id="3548326">protoMajor</span><span class="op" id="3548336">+</span><span class="string" id="3548337">&#34;.&#34;</span><span class="op" id="3548340">+</span><span class="ident" id="3548341">protoMinor</span><span class="op" id="3548351">+</span><span class="string" id="3548352">&#34;&nbsp;&#34;</span><span class="op" id="3548355">+</span><span class="ident" id="3548356">statusCode</span><span class="op" id="3548366">+</span><span class="ident" id="3548367">text</span><span class="op" id="3548371">+</span><span class="string" id="3548372">&#34;\r\n&#34;</span><span class="op" id="3548378">)</span><span class="op" id="3548379">;</span>&nbsp;<span class="ident" id="3548381">err</span>&nbsp;<span class="op" id="3548385">!=</span>&nbsp;<span class="builtintype" id="3548388">nil</span>&nbsp;<span class="op" id="3548392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548396">return</span>&nbsp;<span class="ident" id="3548403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3548412">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548457">r1</span>&nbsp;<span class="op" id="3548460">:=</span>&nbsp;<span class="builtinfunc" id="3548463">new</span><span class="op" id="3548466">(</span><span class="ident" id="3548467">Response</span><span class="op" id="3548475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548478">*</span><span class="ident" id="3548479">r1</span>&nbsp;<span class="op" id="3548482">=</span>&nbsp;<span class="op" id="3548484">*</span><span class="ident" id="3548485">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548488">if</span>&nbsp;<span class="ident" id="3548491">r1</span><span class="op" id="3548493">.</span><span class="ident" id="3548494">ContentLength</span>&nbsp;<span class="op" id="3548508">==</span>&nbsp;<span class="num" id="3548511">0</span>&nbsp;<span class="op" id="3548513">&amp;&amp;</span>&nbsp;<span class="ident" id="3548516">r1</span><span class="op" id="3548518">.</span><span class="ident" id="3548519">Body</span>&nbsp;<span class="op" id="3548524">!=</span>&nbsp;<span class="builtintype" id="3548527">nil</span>&nbsp;<span class="op" id="3548531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3548535">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548582">var</span>&nbsp;<span class="ident" id="3548586">buf</span>&nbsp;<span class="op" id="3548590">[</span><span class="num" id="3548591">1</span><span class="op" id="3548592">]</span><span class="builtintype" id="3548593">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548600">n</span><span class="op" id="3548601">,</span>&nbsp;<span class="ident" id="3548603">err</span>&nbsp;<span class="op" id="3548607">:=</span>&nbsp;<span class="ident" id="3548610">r1</span><span class="op" id="3548612">.</span><span class="ident" id="3548613">Body</span><span class="op" id="3548617">.</span><span class="ident" id="3548618">Read</span><span class="op" id="3548622">(</span><span class="ident" id="3548623">buf</span><span class="op" id="3548626">[</span><span class="op" id="3548627">:</span><span class="op" id="3548628">]</span><span class="op" id="3548629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548633">if</span>&nbsp;<span class="ident" id="3548636">err</span>&nbsp;<span class="op" id="3548640">!=</span>&nbsp;<span class="builtintype" id="3548643">nil</span>&nbsp;<span class="op" id="3548647">&amp;&amp;</span>&nbsp;<span class="ident" id="3548650">err</span>&nbsp;<span class="op" id="3548654">!=</span>&nbsp;<span class="ident" id="3548657">io</span><span class="op" id="3548659">.</span><span class="ident" id="3548660">EOF</span>&nbsp;<span class="op" id="3548664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548669">return</span>&nbsp;<span class="ident" id="3548676">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548682">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3548686">if</span>&nbsp;<span class="ident" id="3548689">n</span>&nbsp;<span class="op" id="3548691">==</span>&nbsp;<span class="num" id="3548694">0</span>&nbsp;<span class="op" id="3548696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3548701">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3548763">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548803">r1</span><span class="op" id="3548805">.</span><span class="ident" id="3548806">Body</span>&nbsp;<span class="op" id="3548811">=</span>&nbsp;<span class="ident" id="3548813">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548825">}</span>&nbsp;<span class="keyword" id="3548827">else</span>&nbsp;<span class="op" id="3548832">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548837">r1</span><span class="op" id="3548839">.</span><span class="ident" id="3548840">ContentLength</span>&nbsp;<span class="op" id="3548854">=</span>&nbsp;<span class="op" id="3548856">-</span><span class="num" id="3548857">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548862">r1</span><span class="op" id="3548864">.</span><span class="ident" id="3548865">Body</span>&nbsp;<span class="op" id="3548870">=</span>&nbsp;<span class="keyword" id="3548872">struct</span>&nbsp;<span class="op" id="3548879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548885">io</span><span class="op" id="3548887">.</span><span class="ident" id="3548888">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548899">io</span><span class="op" id="3548901">.</span><span class="ident" id="3548902">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548912">}</span><span class="op" id="3548913">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548919">io</span><span class="op" id="3548921">.</span><span class="ident" id="3548922">MultiReader</span><span class="op" id="3548933">(</span><span class="ident" id="3548934">bytes</span><span class="op" id="3548939">.</span><span class="ident" id="3548940">NewReader</span><span class="op" id="3548949">(</span><span class="ident" id="3548950">buf</span><span class="op" id="3548953">[</span><span class="op" id="3548954">:</span><span class="num" id="3548955">1</span><span class="op" id="3548956">]</span><span class="op" id="3548957">)</span><span class="op" id="3548958">,</span>&nbsp;<span class="ident" id="3548960">r</span><span class="op" id="3548961">.</span><span class="ident" id="3548962">Body</span><span class="op" id="3548966">)</span><span class="op" id="3548967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3548973">r</span><span class="op" id="3548974">.</span><span class="ident" id="3548975">Body</span><span class="op" id="3548979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3548991">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3548994">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549057">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549121">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549184">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549202">if</span>&nbsp;<span class="ident" id="3549205">r1</span><span class="op" id="3549207">.</span><span class="ident" id="3549208">ContentLength</span>&nbsp;<span class="op" id="3549222">==</span>&nbsp;<span class="op" id="3549225">-</span><span class="num" id="3549226">1</span>&nbsp;<span class="op" id="3549228">&amp;&amp;</span>&nbsp;<span class="op" id="3549231">!</span><span class="ident" id="3549232">r1</span><span class="op" id="3549234">.</span><span class="ident" id="3549235">Close</span>&nbsp;<span class="op" id="3549241">&amp;&amp;</span>&nbsp;<span class="ident" id="3549244">r1</span><span class="op" id="3549246">.</span><span class="ident" id="3549247">ProtoAtLeast</span><span class="op" id="3549259">(</span><span class="num" id="3549260">1</span><span class="op" id="3549261">,</span>&nbsp;<span class="num" id="3549263">1</span><span class="op" id="3549264">)</span>&nbsp;<span class="op" id="3549266">&amp;&amp;</span>&nbsp;<span class="op" id="3549269">!</span><span class="ident" id="3549270">chunked</span><span class="op" id="3549277">(</span><span class="ident" id="3549278">r1</span><span class="op" id="3549280">.</span><span class="ident" id="3549281">TransferEncoding</span><span class="op" id="3549297">)</span>&nbsp;<span class="op" id="3549299">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549303">r1</span><span class="op" id="3549305">.</span><span class="ident" id="3549306">Close</span>&nbsp;<span class="op" id="3549312">=</span>&nbsp;<span class="builtintype" id="3549314">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549324">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549369">tw</span><span class="op" id="3549371">,</span>&nbsp;<span class="ident" id="3549373">err</span>&nbsp;<span class="op" id="3549377">:=</span>&nbsp;<span class="ident" id="3549380">newTransferWriter</span><span class="op" id="3549397">(</span><span class="ident" id="3549398">r1</span><span class="op" id="3549400">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549403">if</span>&nbsp;<span class="ident" id="3549406">err</span>&nbsp;<span class="op" id="3549410">!=</span>&nbsp;<span class="builtintype" id="3549413">nil</span>&nbsp;<span class="op" id="3549417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549421">return</span>&nbsp;<span class="ident" id="3549428">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549436">err</span>&nbsp;<span class="op" id="3549440">=</span>&nbsp;<span class="ident" id="3549442">tw</span><span class="op" id="3549444">.</span><span class="ident" id="3549445">WriteHeader</span><span class="op" id="3549456">(</span><span class="ident" id="3549457">w</span><span class="op" id="3549458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549461">if</span>&nbsp;<span class="ident" id="3549464">err</span>&nbsp;<span class="op" id="3549468">!=</span>&nbsp;<span class="builtintype" id="3549471">nil</span>&nbsp;<span class="op" id="3549475">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549479">return</span>&nbsp;<span class="ident" id="3549486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549495">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549514">err</span>&nbsp;<span class="op" id="3549518">=</span>&nbsp;<span class="ident" id="3549520">r</span><span class="op" id="3549521">.</span><span class="ident" id="3549522">Header</span><span class="op" id="3549528">.</span><span class="ident" id="3549529">WriteSubset</span><span class="op" id="3549540">(</span><span class="ident" id="3549541">w</span><span class="op" id="3549542">,</span>&nbsp;<span class="ident" id="3549544">respExcludeHeader</span><span class="op" id="3549561">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549564">if</span>&nbsp;<span class="ident" id="3549567">err</span>&nbsp;<span class="op" id="3549571">!=</span>&nbsp;<span class="builtintype" id="3549574">nil</span>&nbsp;<span class="op" id="3549578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549582">return</span>&nbsp;<span class="ident" id="3549589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549598">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549658">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549718">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3549743">:=</span>&nbsp;<span class="ident" id="3549746">tw</span><span class="op" id="3549748">.</span><span class="ident" id="3549749">shouldSendContentLength</span><span class="op" id="3549772">(</span><span class="op" id="3549773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549776">if</span>&nbsp;<span class="ident" id="3549779">r1</span><span class="op" id="3549781">.</span><span class="ident" id="3549782">ContentLength</span>&nbsp;<span class="op" id="3549796">==</span>&nbsp;<span class="num" id="3549799">0</span>&nbsp;<span class="op" id="3549801">&amp;&amp;</span>&nbsp;<span class="op" id="3549804">!</span><span class="ident" id="3549805">chunked</span><span class="op" id="3549812">(</span><span class="ident" id="3549813">r1</span><span class="op" id="3549815">.</span><span class="ident" id="3549816">TransferEncoding</span><span class="op" id="3549832">)</span>&nbsp;<span class="op" id="3549834">&amp;&amp;</span>&nbsp;<span class="op" id="3549837">!</span><span class="ident" id="3549838">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3549863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549867">if</span>&nbsp;<span class="ident" id="3549870">_</span><span class="op" id="3549871">,</span>&nbsp;<span class="ident" id="3549873">err</span>&nbsp;<span class="op" id="3549877">:=</span>&nbsp;<span class="ident" id="3549880">io</span><span class="op" id="3549882">.</span><span class="ident" id="3549883">WriteString</span><span class="op" id="3549894">(</span><span class="ident" id="3549895">w</span><span class="op" id="3549896">,</span>&nbsp;<span class="string" id="3549898">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3549921">)</span><span class="op" id="3549922">;</span>&nbsp;<span class="ident" id="3549924">err</span>&nbsp;<span class="op" id="3549928">!=</span>&nbsp;<span class="builtintype" id="3549931">nil</span>&nbsp;<span class="op" id="3549935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549940">return</span>&nbsp;<span class="ident" id="3549947">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549960">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3549978">if</span>&nbsp;<span class="ident" id="3549981">_</span><span class="op" id="3549982">,</span>&nbsp;<span class="ident" id="3549984">err</span>&nbsp;<span class="op" id="3549988">:=</span>&nbsp;<span class="ident" id="3549991">io</span><span class="op" id="3549993">.</span><span class="ident" id="3549994">WriteString</span><span class="op" id="3550005">(</span><span class="ident" id="3550006">w</span><span class="op" id="3550007">,</span>&nbsp;<span class="string" id="3550009">&#34;\r\n&#34;</span><span class="op" id="3550015">)</span><span class="op" id="3550016">;</span>&nbsp;<span class="ident" id="3550018">err</span>&nbsp;<span class="op" id="3550022">!=</span>&nbsp;<span class="builtintype" id="3550025">nil</span>&nbsp;<span class="op" id="3550029">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3550033">return</span>&nbsp;<span class="ident" id="3550040">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3550045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3550049">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3550076">err</span>&nbsp;<span class="op" id="3550080">=</span>&nbsp;<span class="ident" id="3550082">tw</span><span class="op" id="3550084">.</span><span class="ident" id="3550085">WriteBody</span><span class="op" id="3550094">(</span><span class="ident" id="3550095">w</span><span class="op" id="3550096">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3550099">if</span>&nbsp;<span class="ident" id="3550102">err</span>&nbsp;<span class="op" id="3550106">!=</span>&nbsp;<span class="builtintype" id="3550109">nil</span>&nbsp;<span class="op" id="3550113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3550117">return</span>&nbsp;<span class="ident" id="3550124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3550129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3550133">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3550145">return</span>&nbsp;<span class="builtintype" id="3550152">nil</span><br>
<span class="lineno"></span><span class="op" id="3550156">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
