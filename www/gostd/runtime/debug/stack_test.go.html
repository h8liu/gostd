<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html" class="current">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6958370">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6958425">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6958479">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6958530">package</span>&nbsp;<span class="ident" id="6958538">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6958545">import</span>&nbsp;<span class="op" id="6958552">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6958555">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6958566">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6958576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6958579">type</span>&nbsp;<span class="ident" id="6958584">T</span>&nbsp;<span class="builtintype" id="6958586">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6958591">func</span>&nbsp;<span class="op" id="6958596">(</span><span class="ident" id="6958597">t</span>&nbsp;<span class="op" id="6958599">*</span><span class="ident" id="6958600">T</span><span class="op" id="6958601">)</span>&nbsp;<span class="ident" id="6958603">ptrmethod</span><span class="op" id="6958612">(</span><span class="op" id="6958613">)</span>&nbsp;<span class="op" id="6958615">[</span><span class="op" id="6958616">]</span><span class="builtintype" id="6958617">byte</span>&nbsp;<span class="op" id="6958622">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958625">return</span>&nbsp;<span class="ident" id="6958632">Stack</span><span class="op" id="6958637">(</span><span class="op" id="6958638">)</span><br>
<span class="lineno"></span><span class="op" id="6958640">}</span><br>
<span class="lineno"></span><span class="keyword" id="6958642">func</span>&nbsp;<span class="op" id="6958647">(</span><span class="ident" id="6958648">t</span>&nbsp;<span class="ident" id="6958650">T</span><span class="op" id="6958651">)</span>&nbsp;<span class="ident" id="6958653">method</span><span class="op" id="6958659">(</span><span class="op" id="6958660">)</span>&nbsp;<span class="op" id="6958662">[</span><span class="op" id="6958663">]</span><span class="builtintype" id="6958664">byte</span>&nbsp;<span class="op" id="6958669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958672">return</span>&nbsp;<span class="ident" id="6958679">t</span><span class="op" id="6958680">.</span><span class="ident" id="6958681">ptrmethod</span><span class="op" id="6958690">(</span><span class="op" id="6958691">)</span><br>
<span class="lineno"></span><span class="op" id="6958693">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6958696">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="6959309">func</span>&nbsp;<span class="ident" id="6959314">TestStack</span><span class="op" id="6959323">(</span><span class="ident" id="6959324">t</span>&nbsp;<span class="op" id="6959326">*</span><span class="ident" id="6959327">testing</span><span class="op" id="6959334">.</span><span class="ident" id="6959335">T</span><span class="op" id="6959336">)</span>&nbsp;<span class="op" id="6959338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959341">b</span>&nbsp;<span class="op" id="6959343">:=</span>&nbsp;<span class="ident" id="6959346">T</span><span class="op" id="6959347">(</span><span class="num" id="6959348">0</span><span class="op" id="6959349">)</span><span class="op" id="6959350">.</span><span class="ident" id="6959351">method</span><span class="op" id="6959357">(</span><span class="op" id="6959358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959361">lines</span>&nbsp;<span class="op" id="6959367">:=</span>&nbsp;<span class="ident" id="6959370">strings</span><span class="op" id="6959377">.</span><span class="ident" id="6959378">Split</span><span class="op" id="6959383">(</span><span class="builtintype" id="6959384">string</span><span class="op" id="6959390">(</span><span class="ident" id="6959391">b</span><span class="op" id="6959392">)</span><span class="op" id="6959393">,</span>&nbsp;<span class="string" id="6959395">&#34;\n&#34;</span><span class="op" id="6959399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959402">if</span>&nbsp;<span class="builtinfunc" id="6959405">len</span><span class="op" id="6959408">(</span><span class="ident" id="6959409">lines</span><span class="op" id="6959414">)</span>&nbsp;<span class="op" id="6959416">&lt;</span>&nbsp;<span class="num" id="6959418">6</span>&nbsp;<span class="op" id="6959420">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959424">t</span><span class="op" id="6959425">.</span><span class="ident" id="6959426">Fatal</span><span class="op" id="6959431">(</span><span class="string" id="6959432">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="6959447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959453">n</span>&nbsp;<span class="op" id="6959455">:=</span>&nbsp;<span class="num" id="6959458">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959461">frame</span>&nbsp;<span class="op" id="6959467">:=</span>&nbsp;<span class="keyword" id="6959470">func</span><span class="op" id="6959474">(</span><span class="ident" id="6959475">line</span><span class="op" id="6959479">,</span>&nbsp;<span class="ident" id="6959481">code</span>&nbsp;<span class="builtintype" id="6959486">string</span><span class="op" id="6959492">)</span>&nbsp;<span class="op" id="6959494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959498">check</span><span class="op" id="6959503">(</span><span class="ident" id="6959504">t</span><span class="op" id="6959505">,</span>&nbsp;<span class="ident" id="6959507">lines</span><span class="op" id="6959512">[</span><span class="ident" id="6959513">n</span><span class="op" id="6959514">]</span><span class="op" id="6959515">,</span>&nbsp;<span class="ident" id="6959517">line</span><span class="op" id="6959521">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959525">n</span><span class="op" id="6959526">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6959531">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959594">if</span>&nbsp;<span class="ident" id="6959597">strings</span><span class="op" id="6959604">.</span><span class="ident" id="6959605">HasPrefix</span><span class="op" id="6959614">(</span><span class="ident" id="6959615">lines</span><span class="op" id="6959620">[</span><span class="ident" id="6959621">n</span><span class="op" id="6959622">]</span><span class="op" id="6959623">,</span>&nbsp;<span class="string" id="6959625">&#34;\t&#34;</span><span class="op" id="6959629">)</span>&nbsp;<span class="op" id="6959631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959636">check</span><span class="op" id="6959641">(</span><span class="ident" id="6959642">t</span><span class="op" id="6959643">,</span>&nbsp;<span class="ident" id="6959645">lines</span><span class="op" id="6959650">[</span><span class="ident" id="6959651">n</span><span class="op" id="6959652">]</span><span class="op" id="6959653">,</span>&nbsp;<span class="ident" id="6959655">code</span><span class="op" id="6959659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959664">n</span><span class="op" id="6959665">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959676">frame</span><span class="op" id="6959681">(</span><span class="string" id="6959682">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6959715">,</span>&nbsp;<span class="string" id="6959717">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="6959751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959754">frame</span><span class="op" id="6959759">(</span><span class="string" id="6959760">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6959793">,</span>&nbsp;<span class="string" id="6959795">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="6959829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959832">frame</span><span class="op" id="6959837">(</span><span class="string" id="6959838">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6959871">,</span>&nbsp;<span class="string" id="6959873">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="6959906">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959909">frame</span><span class="op" id="6959914">(</span><span class="string" id="6959915">&#34;src/testing/testing.go&#34;</span><span class="op" id="6959939">,</span>&nbsp;<span class="string" id="6959941">&#34;&#34;</span><span class="op" id="6959943">)</span><br>
<span class="lineno"></span><span class="op" id="6959945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6959948">func</span>&nbsp;<span class="ident" id="6959953">check</span><span class="op" id="6959958">(</span><span class="ident" id="6959959">t</span>&nbsp;<span class="op" id="6959961">*</span><span class="ident" id="6959962">testing</span><span class="op" id="6959969">.</span><span class="ident" id="6959970">T</span><span class="op" id="6959971">,</span>&nbsp;<span class="ident" id="6959973">line</span><span class="op" id="6959977">,</span>&nbsp;<span class="ident" id="6959979">has</span>&nbsp;<span class="builtintype" id="6959983">string</span><span class="op" id="6959989">)</span>&nbsp;<span class="op" id="6959991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959994">if</span>&nbsp;<span class="ident" id="6959997">strings</span><span class="op" id="6960004">.</span><span class="ident" id="6960005">Index</span><span class="op" id="6960010">(</span><span class="ident" id="6960011">line</span><span class="op" id="6960015">,</span>&nbsp;<span class="ident" id="6960017">has</span><span class="op" id="6960020">)</span>&nbsp;<span class="op" id="6960022">&lt;</span>&nbsp;<span class="num" id="6960024">0</span>&nbsp;<span class="op" id="6960026">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960030">t</span><span class="op" id="6960031">.</span><span class="ident" id="6960032">Errorf</span><span class="op" id="6960038">(</span><span class="string" id="6960039">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="6960058">,</span>&nbsp;<span class="ident" id="6960060">has</span><span class="op" id="6960063">,</span>&nbsp;<span class="ident" id="6960065">line</span><span class="op" id="6960069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960072">}</span><br>
<span class="lineno"></span><span class="op" id="6960074">}</span>
</div>
</body>
</html>
