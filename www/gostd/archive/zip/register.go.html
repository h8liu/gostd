<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5956148">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5956203">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5956257">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5956308">package</span>&nbsp;<span class="ident" id="5956316">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5956321">import</span>&nbsp;<span class="op" id="5956328">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5956331">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5956349">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5956359">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5956365">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5956378">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5956385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5956388">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5956449">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5956515">type</span>&nbsp;<span class="ident" id="5956520">Compressor</span>&nbsp;<span class="keyword" id="5956531">func</span><span class="op" id="5956535">(</span><span class="ident" id="5956536">io</span><span class="op" id="5956538">.</span><span class="ident" id="5956539">Writer</span><span class="op" id="5956545">)</span>&nbsp;<span class="op" id="5956547">(</span><span class="ident" id="5956548">io</span><span class="op" id="5956550">.</span><span class="ident" id="5956551">WriteCloser</span><span class="op" id="5956562">,</span>&nbsp;<span class="builtintype" id="5956564">error</span><span class="op" id="5956569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956572">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="5956651">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5956725">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5956803">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="5956837">type</span>&nbsp;<span class="ident" id="5956842">Decompressor</span>&nbsp;<span class="keyword" id="5956855">func</span><span class="op" id="5956859">(</span><span class="ident" id="5956860">io</span><span class="op" id="5956862">.</span><span class="ident" id="5956863">Reader</span><span class="op" id="5956869">)</span>&nbsp;<span class="ident" id="5956871">io</span><span class="op" id="5956873">.</span><span class="ident" id="5956874">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5956886">var</span>&nbsp;<span class="ident" id="5956890">flateWriterPool</span>&nbsp;<span class="ident" id="5956906">sync</span><span class="op" id="5956910">.</span><span class="ident" id="5956911">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5956917">func</span>&nbsp;<span class="ident" id="5956922">newFlateWriter</span><span class="op" id="5956936">(</span><span class="ident" id="5956937">w</span>&nbsp;<span class="ident" id="5956939">io</span><span class="op" id="5956941">.</span><span class="ident" id="5956942">Writer</span><span class="op" id="5956948">)</span>&nbsp;<span class="ident" id="5956950">io</span><span class="op" id="5956952">.</span><span class="ident" id="5956953">WriteCloser</span>&nbsp;<span class="op" id="5956965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956968">fw</span><span class="op" id="5956970">,</span>&nbsp;<span class="ident" id="5956972">ok</span>&nbsp;<span class="op" id="5956975">:=</span>&nbsp;<span class="ident" id="5956978">flateWriterPool</span><span class="op" id="5956993">.</span><span class="ident" id="5956994">Get</span><span class="op" id="5956997">(</span><span class="op" id="5956998">)</span><span class="op" id="5956999">.</span><span class="op" id="5957000">(</span><span class="op" id="5957001">*</span><span class="ident" id="5957002">flate</span><span class="op" id="5957007">.</span><span class="ident" id="5957008">Writer</span><span class="op" id="5957014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957017">if</span>&nbsp;<span class="ident" id="5957020">ok</span>&nbsp;<span class="op" id="5957023">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957027">fw</span><span class="op" id="5957029">.</span><span class="ident" id="5957030">Reset</span><span class="op" id="5957035">(</span><span class="ident" id="5957036">w</span><span class="op" id="5957037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957040">}</span>&nbsp;<span class="keyword" id="5957042">else</span>&nbsp;<span class="op" id="5957047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957051">fw</span><span class="op" id="5957053">,</span>&nbsp;<span class="ident" id="5957055">_</span>&nbsp;<span class="op" id="5957057">=</span>&nbsp;<span class="ident" id="5957059">flate</span><span class="op" id="5957064">.</span><span class="ident" id="5957065">NewWriter</span><span class="op" id="5957074">(</span><span class="ident" id="5957075">w</span><span class="op" id="5957076">,</span>&nbsp;<span class="num" id="5957078">5</span><span class="op" id="5957079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957085">return</span>&nbsp;<span class="op" id="5957092">&amp;</span><span class="ident" id="5957093">pooledFlateWriter</span><span class="op" id="5957110">{</span><span class="ident" id="5957111">fw</span><span class="op" id="5957113">:</span>&nbsp;<span class="ident" id="5957115">fw</span><span class="op" id="5957117">}</span><br>
<span class="lineno">35</span><span class="op" id="5957119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957122">type</span>&nbsp;<span class="ident" id="5957127">pooledFlateWriter</span>&nbsp;<span class="keyword" id="5957145">struct</span>&nbsp;<span class="op" id="5957152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957155">mu</span>&nbsp;<span class="ident" id="5957158">sync</span><span class="op" id="5957162">.</span><span class="ident" id="5957163">Mutex</span>&nbsp;<span class="comment" id="5957169">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957196">fw</span>&nbsp;<span class="op" id="5957199">*</span><span class="ident" id="5957200">flate</span><span class="op" id="5957205">.</span><span class="ident" id="5957206">Writer</span><br>
<span class="lineno">40</span><span class="op" id="5957213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957216">func</span>&nbsp;<span class="op" id="5957221">(</span><span class="ident" id="5957222">w</span>&nbsp;<span class="op" id="5957224">*</span><span class="ident" id="5957225">pooledFlateWriter</span><span class="op" id="5957242">)</span>&nbsp;<span class="ident" id="5957244">Write</span><span class="op" id="5957249">(</span><span class="ident" id="5957250">p</span>&nbsp;<span class="op" id="5957252">[</span><span class="op" id="5957253">]</span><span class="builtintype" id="5957254">byte</span><span class="op" id="5957258">)</span>&nbsp;<span class="op" id="5957260">(</span><span class="ident" id="5957261">n</span>&nbsp;<span class="builtintype" id="5957263">int</span><span class="op" id="5957266">,</span>&nbsp;<span class="ident" id="5957268">err</span>&nbsp;<span class="builtintype" id="5957272">error</span><span class="op" id="5957277">)</span>&nbsp;<span class="op" id="5957279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957282">w</span><span class="op" id="5957283">.</span><span class="ident" id="5957284">mu</span><span class="op" id="5957286">.</span><span class="ident" id="5957287">Lock</span><span class="op" id="5957291">(</span><span class="op" id="5957292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957295">defer</span>&nbsp;<span class="ident" id="5957301">w</span><span class="op" id="5957302">.</span><span class="ident" id="5957303">mu</span><span class="op" id="5957305">.</span><span class="ident" id="5957306">Unlock</span><span class="op" id="5957312">(</span><span class="op" id="5957313">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957316">if</span>&nbsp;<span class="ident" id="5957319">w</span><span class="op" id="5957320">.</span><span class="ident" id="5957321">fw</span>&nbsp;<span class="op" id="5957324">==</span>&nbsp;<span class="ident" id="5957327">nil</span>&nbsp;<span class="op" id="5957331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957335">return</span>&nbsp;<span class="num" id="5957342">0</span><span class="op" id="5957343">,</span>&nbsp;<span class="ident" id="5957345">errors</span><span class="op" id="5957351">.</span><span class="ident" id="5957352">New</span><span class="op" id="5957355">(</span><span class="string" id="5957356">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="5957375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957381">return</span>&nbsp;<span class="ident" id="5957388">w</span><span class="op" id="5957389">.</span><span class="ident" id="5957390">fw</span><span class="op" id="5957392">.</span><span class="ident" id="5957393">Write</span><span class="op" id="5957398">(</span><span class="ident" id="5957399">p</span><span class="op" id="5957400">)</span><br>
<span class="lineno"></span><span class="op" id="5957402">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5957405">func</span>&nbsp;<span class="op" id="5957410">(</span><span class="ident" id="5957411">w</span>&nbsp;<span class="op" id="5957413">*</span><span class="ident" id="5957414">pooledFlateWriter</span><span class="op" id="5957431">)</span>&nbsp;<span class="ident" id="5957433">Close</span><span class="op" id="5957438">(</span><span class="op" id="5957439">)</span>&nbsp;<span class="builtintype" id="5957441">error</span>&nbsp;<span class="op" id="5957447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957450">w</span><span class="op" id="5957451">.</span><span class="ident" id="5957452">mu</span><span class="op" id="5957454">.</span><span class="ident" id="5957455">Lock</span><span class="op" id="5957459">(</span><span class="op" id="5957460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957463">defer</span>&nbsp;<span class="ident" id="5957469">w</span><span class="op" id="5957470">.</span><span class="ident" id="5957471">mu</span><span class="op" id="5957473">.</span><span class="ident" id="5957474">Unlock</span><span class="op" id="5957480">(</span><span class="op" id="5957481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957484">var</span>&nbsp;<span class="ident" id="5957488">err</span>&nbsp;<span class="builtintype" id="5957492">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957499">if</span>&nbsp;<span class="ident" id="5957502">w</span><span class="op" id="5957503">.</span><span class="ident" id="5957504">fw</span>&nbsp;<span class="op" id="5957507">!=</span>&nbsp;<span class="ident" id="5957510">nil</span>&nbsp;<span class="op" id="5957514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957518">err</span>&nbsp;<span class="op" id="5957522">=</span>&nbsp;<span class="ident" id="5957524">w</span><span class="op" id="5957525">.</span><span class="ident" id="5957526">fw</span><span class="op" id="5957528">.</span><span class="ident" id="5957529">Close</span><span class="op" id="5957534">(</span><span class="op" id="5957535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957539">flateWriterPool</span><span class="op" id="5957554">.</span><span class="ident" id="5957555">Put</span><span class="op" id="5957558">(</span><span class="ident" id="5957559">w</span><span class="op" id="5957560">.</span><span class="ident" id="5957561">fw</span><span class="op" id="5957563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957567">w</span><span class="op" id="5957568">.</span><span class="ident" id="5957569">fw</span>&nbsp;<span class="op" id="5957572">=</span>&nbsp;<span class="ident" id="5957574">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957579">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957582">return</span>&nbsp;<span class="ident" id="5957589">err</span><br>
<span class="lineno"></span><span class="op" id="5957593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5957596">var</span>&nbsp;<span class="op" id="5957600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957603">mu</span>&nbsp;<span class="ident" id="5957606">sync</span><span class="op" id="5957610">.</span><span class="ident" id="5957611">RWMutex</span>&nbsp;<span class="comment" id="5957619">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957664">compressors</span>&nbsp;<span class="op" id="5957676">=</span>&nbsp;<span class="keyword" id="5957678">map</span><span class="op" id="5957681">[</span><span class="builtintype" id="5957682">uint16</span><span class="op" id="5957688">]</span><span class="ident" id="5957689">Compressor</span><span class="op" id="5957699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957703">Store</span><span class="op" id="5957708">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957712">func</span><span class="op" id="5957716">(</span><span class="ident" id="5957717">w</span>&nbsp;<span class="ident" id="5957719">io</span><span class="op" id="5957721">.</span><span class="ident" id="5957722">Writer</span><span class="op" id="5957728">)</span>&nbsp;<span class="op" id="5957730">(</span><span class="ident" id="5957731">io</span><span class="op" id="5957733">.</span><span class="ident" id="5957734">WriteCloser</span><span class="op" id="5957745">,</span>&nbsp;<span class="builtintype" id="5957747">error</span><span class="op" id="5957752">)</span>&nbsp;<span class="op" id="5957754">{</span>&nbsp;<span class="keyword" id="5957756">return</span>&nbsp;<span class="op" id="5957763">&amp;</span><span class="ident" id="5957764">nopCloser</span><span class="op" id="5957773">{</span><span class="ident" id="5957774">w</span><span class="op" id="5957775">}</span><span class="op" id="5957776">,</span>&nbsp;<span class="ident" id="5957778">nil</span>&nbsp;<span class="op" id="5957782">}</span><span class="op" id="5957783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957787">Deflate</span><span class="op" id="5957794">:</span>&nbsp;<span class="keyword" id="5957796">func</span><span class="op" id="5957800">(</span><span class="ident" id="5957801">w</span>&nbsp;<span class="ident" id="5957803">io</span><span class="op" id="5957805">.</span><span class="ident" id="5957806">Writer</span><span class="op" id="5957812">)</span>&nbsp;<span class="op" id="5957814">(</span><span class="ident" id="5957815">io</span><span class="op" id="5957817">.</span><span class="ident" id="5957818">WriteCloser</span><span class="op" id="5957829">,</span>&nbsp;<span class="builtintype" id="5957831">error</span><span class="op" id="5957836">)</span>&nbsp;<span class="op" id="5957838">{</span>&nbsp;<span class="keyword" id="5957840">return</span>&nbsp;<span class="ident" id="5957847">newFlateWriter</span><span class="op" id="5957861">(</span><span class="ident" id="5957862">w</span><span class="op" id="5957863">)</span><span class="op" id="5957864">,</span>&nbsp;<span class="ident" id="5957866">nil</span>&nbsp;<span class="op" id="5957870">}</span><span class="op" id="5957871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957874">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957878">decompressors</span>&nbsp;<span class="op" id="5957892">=</span>&nbsp;<span class="keyword" id="5957894">map</span><span class="op" id="5957897">[</span><span class="builtintype" id="5957898">uint16</span><span class="op" id="5957904">]</span><span class="ident" id="5957905">Decompressor</span><span class="op" id="5957917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957921">Store</span><span class="op" id="5957926">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5957930">ioutil</span><span class="op" id="5957936">.</span><span class="ident" id="5957937">NopCloser</span><span class="op" id="5957946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957950">Deflate</span><span class="op" id="5957957">:</span>&nbsp;<span class="ident" id="5957959">flate</span><span class="op" id="5957964">.</span><span class="ident" id="5957965">NewReader</span><span class="op" id="5957974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957977">}</span><br>
<span class="lineno">75</span><span class="op" id="5957979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5957982">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="5958061">func</span>&nbsp;<span class="ident" id="5958066">RegisterDecompressor</span><span class="op" id="5958086">(</span><span class="ident" id="5958087">method</span>&nbsp;<span class="builtintype" id="5958094">uint16</span><span class="op" id="5958100">,</span>&nbsp;<span class="ident" id="5958102">d</span>&nbsp;<span class="ident" id="5958104">Decompressor</span><span class="op" id="5958116">)</span>&nbsp;<span class="op" id="5958118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958121">mu</span><span class="op" id="5958123">.</span><span class="ident" id="5958124">Lock</span><span class="op" id="5958128">(</span><span class="op" id="5958129">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958132">defer</span>&nbsp;<span class="ident" id="5958138">mu</span><span class="op" id="5958140">.</span><span class="ident" id="5958141">Unlock</span><span class="op" id="5958147">(</span><span class="op" id="5958148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958152">if</span>&nbsp;<span class="ident" id="5958155">_</span><span class="op" id="5958156">,</span>&nbsp;<span class="ident" id="5958158">ok</span>&nbsp;<span class="op" id="5958161">:=</span>&nbsp;<span class="ident" id="5958164">decompressors</span><span class="op" id="5958177">[</span><span class="ident" id="5958178">method</span><span class="op" id="5958184">]</span><span class="op" id="5958185">;</span>&nbsp;<span class="ident" id="5958187">ok</span>&nbsp;<span class="op" id="5958190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5958194">panic</span><span class="op" id="5958199">(</span><span class="string" id="5958200">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5958233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958236">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958239">decompressors</span><span class="op" id="5958252">[</span><span class="ident" id="5958253">method</span><span class="op" id="5958259">]</span>&nbsp;<span class="op" id="5958261">=</span>&nbsp;<span class="ident" id="5958263">d</span><br>
<span class="lineno"></span><span class="op" id="5958265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5958268">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="5958346">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="5958400">func</span>&nbsp;<span class="ident" id="5958405">RegisterCompressor</span><span class="op" id="5958423">(</span><span class="ident" id="5958424">method</span>&nbsp;<span class="builtintype" id="5958431">uint16</span><span class="op" id="5958437">,</span>&nbsp;<span class="ident" id="5958439">comp</span>&nbsp;<span class="ident" id="5958444">Compressor</span><span class="op" id="5958454">)</span>&nbsp;<span class="op" id="5958456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958459">mu</span><span class="op" id="5958461">.</span><span class="ident" id="5958462">Lock</span><span class="op" id="5958466">(</span><span class="op" id="5958467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958470">defer</span>&nbsp;<span class="ident" id="5958476">mu</span><span class="op" id="5958478">.</span><span class="ident" id="5958479">Unlock</span><span class="op" id="5958485">(</span><span class="op" id="5958486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958490">if</span>&nbsp;<span class="ident" id="5958493">_</span><span class="op" id="5958494">,</span>&nbsp;<span class="ident" id="5958496">ok</span>&nbsp;<span class="op" id="5958499">:=</span>&nbsp;<span class="ident" id="5958502">compressors</span><span class="op" id="5958513">[</span><span class="ident" id="5958514">method</span><span class="op" id="5958520">]</span><span class="op" id="5958521">;</span>&nbsp;<span class="ident" id="5958523">ok</span>&nbsp;<span class="op" id="5958526">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5958530">panic</span><span class="op" id="5958535">(</span><span class="string" id="5958536">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5958567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5958570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958573">compressors</span><span class="op" id="5958584">[</span><span class="ident" id="5958585">method</span><span class="op" id="5958591">]</span>&nbsp;<span class="op" id="5958593">=</span>&nbsp;<span class="ident" id="5958595">comp</span><br>
<span class="lineno"></span><span class="op" id="5958600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5958603">func</span>&nbsp;<span class="ident" id="5958608">compressor</span><span class="op" id="5958618">(</span><span class="ident" id="5958619">method</span>&nbsp;<span class="builtintype" id="5958626">uint16</span><span class="op" id="5958632">)</span>&nbsp;<span class="ident" id="5958634">Compressor</span>&nbsp;<span class="op" id="5958645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958648">mu</span><span class="op" id="5958650">.</span><span class="ident" id="5958651">RLock</span><span class="op" id="5958656">(</span><span class="op" id="5958657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958660">defer</span>&nbsp;<span class="ident" id="5958666">mu</span><span class="op" id="5958668">.</span><span class="ident" id="5958669">RUnlock</span><span class="op" id="5958676">(</span><span class="op" id="5958677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958680">return</span>&nbsp;<span class="ident" id="5958687">compressors</span><span class="op" id="5958698">[</span><span class="ident" id="5958699">method</span><span class="op" id="5958705">]</span><br>
<span class="lineno"></span><span class="op" id="5958707">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5958710">func</span>&nbsp;<span class="ident" id="5958715">decompressor</span><span class="op" id="5958727">(</span><span class="ident" id="5958728">method</span>&nbsp;<span class="builtintype" id="5958735">uint16</span><span class="op" id="5958741">)</span>&nbsp;<span class="ident" id="5958743">Decompressor</span>&nbsp;<span class="op" id="5958756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958759">mu</span><span class="op" id="5958761">.</span><span class="ident" id="5958762">RLock</span><span class="op" id="5958767">(</span><span class="op" id="5958768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958771">defer</span>&nbsp;<span class="ident" id="5958777">mu</span><span class="op" id="5958779">.</span><span class="ident" id="5958780">RUnlock</span><span class="op" id="5958787">(</span><span class="op" id="5958788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958791">return</span>&nbsp;<span class="ident" id="5958798">decompressors</span><span class="op" id="5958811">[</span><span class="ident" id="5958812">method</span><span class="op" id="5958818">]</span><br>
<span class="lineno">110</span><span class="op" id="5958820">}</span>
</div>
</body>
</html>
