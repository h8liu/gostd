<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5545532">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5545587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5545641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5545692">package</span>&nbsp;<span class="ident" id="5545700">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5545707">import</span>&nbsp;<span class="op" id="5545714">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5545717">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5545731">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5545734">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5545810">type</span>&nbsp;<span class="ident" id="5545815">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5545835">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5545840">const</span>&nbsp;<span class="op" id="5545846">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545849">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5545872">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5545892">=</span>&nbsp;<span class="ident" id="5545894">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545900">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545924">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545948">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5545971">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5545974">func</span>&nbsp;<span class="op" id="5545979">(</span><span class="ident" id="5545980">s</span>&nbsp;<span class="ident" id="5545982">YCbCrSubsampleRatio</span><span class="op" id="5546001">)</span>&nbsp;<span class="ident" id="5546003">String</span><span class="op" id="5546009">(</span><span class="op" id="5546010">)</span>&nbsp;<span class="builtintype" id="5546012">string</span>&nbsp;<span class="op" id="5546019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546022">switch</span>&nbsp;<span class="ident" id="5546029">s</span>&nbsp;<span class="op" id="5546031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546034">case</span>&nbsp;<span class="ident" id="5546039">YCbCrSubsampleRatio444</span><span class="op" id="5546061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546065">return</span>&nbsp;<span class="string" id="5546072">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546098">case</span>&nbsp;<span class="ident" id="5546103">YCbCrSubsampleRatio422</span><span class="op" id="5546125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546129">return</span>&nbsp;<span class="string" id="5546136">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546162">case</span>&nbsp;<span class="ident" id="5546167">YCbCrSubsampleRatio420</span><span class="op" id="5546189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546193">return</span>&nbsp;<span class="string" id="5546200">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546226">case</span>&nbsp;<span class="ident" id="5546231">YCbCrSubsampleRatio440</span><span class="op" id="5546253">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546257">return</span>&nbsp;<span class="string" id="5546264">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5546290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5546293">return</span>&nbsp;<span class="string" id="5546300">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5546329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5546332">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5546407">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5546472">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5546546">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5546627">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5546667">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5546742">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5546766">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5546836">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5546906">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5546976">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5547046">type</span>&nbsp;<span class="ident" id="5547051">YCbCr</span>&nbsp;<span class="keyword" id="5547057">struct</span>&nbsp;<span class="op" id="5547064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547067">Y</span><span class="op" id="5547068">,</span>&nbsp;<span class="ident" id="5547070">Cb</span><span class="op" id="5547072">,</span>&nbsp;<span class="ident" id="5547074">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5547082">[</span><span class="op" id="5547083">]</span><span class="builtintype" id="5547084">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547091">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5547106">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547111">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5547126">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547131">SubsampleRatio</span>&nbsp;<span class="ident" id="5547146">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547167">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547182">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5547192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547195">func</span>&nbsp;<span class="op" id="5547200">(</span><span class="ident" id="5547201">p</span>&nbsp;<span class="op" id="5547203">*</span><span class="ident" id="5547204">YCbCr</span><span class="op" id="5547209">)</span>&nbsp;<span class="ident" id="5547211">ColorModel</span><span class="op" id="5547221">(</span><span class="op" id="5547222">)</span>&nbsp;<span class="ident" id="5547224">color</span><span class="op" id="5547229">.</span><span class="ident" id="5547230">Model</span>&nbsp;<span class="op" id="5547236">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547239">return</span>&nbsp;<span class="ident" id="5547246">color</span><span class="op" id="5547251">.</span><span class="ident" id="5547252">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5547263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547266">func</span>&nbsp;<span class="op" id="5547271">(</span><span class="ident" id="5547272">p</span>&nbsp;<span class="op" id="5547274">*</span><span class="ident" id="5547275">YCbCr</span><span class="op" id="5547280">)</span>&nbsp;<span class="ident" id="5547282">Bounds</span><span class="op" id="5547288">(</span><span class="op" id="5547289">)</span>&nbsp;<span class="ident" id="5547291">Rectangle</span>&nbsp;<span class="op" id="5547301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547304">return</span>&nbsp;<span class="ident" id="5547311">p</span><span class="op" id="5547312">.</span><span class="ident" id="5547313">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5547318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5547321">func</span>&nbsp;<span class="op" id="5547326">(</span><span class="ident" id="5547327">p</span>&nbsp;<span class="op" id="5547329">*</span><span class="ident" id="5547330">YCbCr</span><span class="op" id="5547335">)</span>&nbsp;<span class="ident" id="5547337">At</span><span class="op" id="5547339">(</span><span class="ident" id="5547340">x</span><span class="op" id="5547341">,</span>&nbsp;<span class="ident" id="5547343">y</span>&nbsp;<span class="builtintype" id="5547345">int</span><span class="op" id="5547348">)</span>&nbsp;<span class="ident" id="5547350">color</span><span class="op" id="5547355">.</span><span class="ident" id="5547356">Color</span>&nbsp;<span class="op" id="5547362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547365">return</span>&nbsp;<span class="ident" id="5547372">p</span><span class="op" id="5547373">.</span><span class="ident" id="5547374">YCbCrAt</span><span class="op" id="5547381">(</span><span class="ident" id="5547382">x</span><span class="op" id="5547383">,</span>&nbsp;<span class="ident" id="5547385">y</span><span class="op" id="5547386">)</span><br>
<span class="lineno"></span><span class="op" id="5547388">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5547391">func</span>&nbsp;<span class="op" id="5547396">(</span><span class="ident" id="5547397">p</span>&nbsp;<span class="op" id="5547399">*</span><span class="ident" id="5547400">YCbCr</span><span class="op" id="5547405">)</span>&nbsp;<span class="ident" id="5547407">YCbCrAt</span><span class="op" id="5547414">(</span><span class="ident" id="5547415">x</span><span class="op" id="5547416">,</span>&nbsp;<span class="ident" id="5547418">y</span>&nbsp;<span class="builtintype" id="5547420">int</span><span class="op" id="5547423">)</span>&nbsp;<span class="ident" id="5547425">color</span><span class="op" id="5547430">.</span><span class="ident" id="5547431">YCbCr</span>&nbsp;<span class="op" id="5547437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547440">if</span>&nbsp;<span class="op" id="5547443">!</span><span class="op" id="5547444">(</span><span class="ident" id="5547445">Point</span><span class="op" id="5547450">{</span><span class="ident" id="5547451">x</span><span class="op" id="5547452">,</span>&nbsp;<span class="ident" id="5547454">y</span><span class="op" id="5547455">}</span><span class="op" id="5547456">.</span><span class="ident" id="5547457">In</span><span class="op" id="5547459">(</span><span class="ident" id="5547460">p</span><span class="op" id="5547461">.</span><span class="ident" id="5547462">Rect</span><span class="op" id="5547466">)</span><span class="op" id="5547467">)</span>&nbsp;<span class="op" id="5547469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547473">return</span>&nbsp;<span class="ident" id="5547480">color</span><span class="op" id="5547485">.</span><span class="ident" id="5547486">YCbCr</span><span class="op" id="5547491">{</span><span class="op" id="5547492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547495">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547498">yi</span>&nbsp;<span class="op" id="5547501">:=</span>&nbsp;<span class="ident" id="5547504">p</span><span class="op" id="5547505">.</span><span class="ident" id="5547506">YOffset</span><span class="op" id="5547513">(</span><span class="ident" id="5547514">x</span><span class="op" id="5547515">,</span>&nbsp;<span class="ident" id="5547517">y</span><span class="op" id="5547518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547521">ci</span>&nbsp;<span class="op" id="5547524">:=</span>&nbsp;<span class="ident" id="5547527">p</span><span class="op" id="5547528">.</span><span class="ident" id="5547529">COffset</span><span class="op" id="5547536">(</span><span class="ident" id="5547537">x</span><span class="op" id="5547538">,</span>&nbsp;<span class="ident" id="5547540">y</span><span class="op" id="5547541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547544">return</span>&nbsp;<span class="ident" id="5547551">color</span><span class="op" id="5547556">.</span><span class="ident" id="5547557">YCbCr</span><span class="op" id="5547562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547566">p</span><span class="op" id="5547567">.</span><span class="ident" id="5547568">Y</span><span class="op" id="5547569">[</span><span class="ident" id="5547570">yi</span><span class="op" id="5547572">]</span><span class="op" id="5547573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547577">p</span><span class="op" id="5547578">.</span><span class="ident" id="5547579">Cb</span><span class="op" id="5547581">[</span><span class="ident" id="5547582">ci</span><span class="op" id="5547584">]</span><span class="op" id="5547585">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547589">p</span><span class="op" id="5547590">.</span><span class="ident" id="5547591">Cr</span><span class="op" id="5547593">[</span><span class="ident" id="5547594">ci</span><span class="op" id="5547596">]</span><span class="op" id="5547597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547600">}</span><br>
<span class="lineno"></span><span class="op" id="5547602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547605">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5547680">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5547704">func</span>&nbsp;<span class="op" id="5547709">(</span><span class="ident" id="5547710">p</span>&nbsp;<span class="op" id="5547712">*</span><span class="ident" id="5547713">YCbCr</span><span class="op" id="5547718">)</span>&nbsp;<span class="ident" id="5547720">YOffset</span><span class="op" id="5547727">(</span><span class="ident" id="5547728">x</span><span class="op" id="5547729">,</span>&nbsp;<span class="ident" id="5547731">y</span>&nbsp;<span class="builtintype" id="5547733">int</span><span class="op" id="5547736">)</span>&nbsp;<span class="builtintype" id="5547738">int</span>&nbsp;<span class="op" id="5547742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547745">return</span>&nbsp;<span class="op" id="5547752">(</span><span class="ident" id="5547753">y</span><span class="op" id="5547754">-</span><span class="ident" id="5547755">p</span><span class="op" id="5547756">.</span><span class="ident" id="5547757">Rect</span><span class="op" id="5547761">.</span><span class="ident" id="5547762">Min</span><span class="op" id="5547765">.</span><span class="ident" id="5547766">Y</span><span class="op" id="5547767">)</span><span class="op" id="5547768">*</span><span class="ident" id="5547769">p</span><span class="op" id="5547770">.</span><span class="ident" id="5547771">YStride</span>&nbsp;<span class="op" id="5547779">+</span>&nbsp;<span class="op" id="5547781">(</span><span class="ident" id="5547782">x</span>&nbsp;<span class="op" id="5547784">-</span>&nbsp;<span class="ident" id="5547786">p</span><span class="op" id="5547787">.</span><span class="ident" id="5547788">Rect</span><span class="op" id="5547792">.</span><span class="ident" id="5547793">Min</span><span class="op" id="5547796">.</span><span class="ident" id="5547797">X</span><span class="op" id="5547798">)</span><br>
<span class="lineno"></span><span class="op" id="5547800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5547803">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5547882">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5547909">func</span>&nbsp;<span class="op" id="5547914">(</span><span class="ident" id="5547915">p</span>&nbsp;<span class="op" id="5547917">*</span><span class="ident" id="5547918">YCbCr</span><span class="op" id="5547923">)</span>&nbsp;<span class="ident" id="5547925">COffset</span><span class="op" id="5547932">(</span><span class="ident" id="5547933">x</span><span class="op" id="5547934">,</span>&nbsp;<span class="ident" id="5547936">y</span>&nbsp;<span class="builtintype" id="5547938">int</span><span class="op" id="5547941">)</span>&nbsp;<span class="builtintype" id="5547943">int</span>&nbsp;<span class="op" id="5547947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547950">switch</span>&nbsp;<span class="ident" id="5547957">p</span><span class="op" id="5547958">.</span><span class="ident" id="5547959">SubsampleRatio</span>&nbsp;<span class="op" id="5547974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547977">case</span>&nbsp;<span class="ident" id="5547982">YCbCrSubsampleRatio422</span><span class="op" id="5548004">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548008">return</span>&nbsp;<span class="op" id="5548015">(</span><span class="ident" id="5548016">y</span><span class="op" id="5548017">-</span><span class="ident" id="5548018">p</span><span class="op" id="5548019">.</span><span class="ident" id="5548020">Rect</span><span class="op" id="5548024">.</span><span class="ident" id="5548025">Min</span><span class="op" id="5548028">.</span><span class="ident" id="5548029">Y</span><span class="op" id="5548030">)</span><span class="op" id="5548031">*</span><span class="ident" id="5548032">p</span><span class="op" id="5548033">.</span><span class="ident" id="5548034">CStride</span>&nbsp;<span class="op" id="5548042">+</span>&nbsp;<span class="op" id="5548044">(</span><span class="ident" id="5548045">x</span><span class="op" id="5548046">/</span><span class="num" id="5548047">2</span>&nbsp;<span class="op" id="5548049">-</span>&nbsp;<span class="ident" id="5548051">p</span><span class="op" id="5548052">.</span><span class="ident" id="5548053">Rect</span><span class="op" id="5548057">.</span><span class="ident" id="5548058">Min</span><span class="op" id="5548061">.</span><span class="ident" id="5548062">X</span><span class="op" id="5548063">/</span><span class="num" id="5548064">2</span><span class="op" id="5548065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548068">case</span>&nbsp;<span class="ident" id="5548073">YCbCrSubsampleRatio420</span><span class="op" id="5548095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548099">return</span>&nbsp;<span class="op" id="5548106">(</span><span class="ident" id="5548107">y</span><span class="op" id="5548108">/</span><span class="num" id="5548109">2</span><span class="op" id="5548110">-</span><span class="ident" id="5548111">p</span><span class="op" id="5548112">.</span><span class="ident" id="5548113">Rect</span><span class="op" id="5548117">.</span><span class="ident" id="5548118">Min</span><span class="op" id="5548121">.</span><span class="ident" id="5548122">Y</span><span class="op" id="5548123">/</span><span class="num" id="5548124">2</span><span class="op" id="5548125">)</span><span class="op" id="5548126">*</span><span class="ident" id="5548127">p</span><span class="op" id="5548128">.</span><span class="ident" id="5548129">CStride</span>&nbsp;<span class="op" id="5548137">+</span>&nbsp;<span class="op" id="5548139">(</span><span class="ident" id="5548140">x</span><span class="op" id="5548141">/</span><span class="num" id="5548142">2</span>&nbsp;<span class="op" id="5548144">-</span>&nbsp;<span class="ident" id="5548146">p</span><span class="op" id="5548147">.</span><span class="ident" id="5548148">Rect</span><span class="op" id="5548152">.</span><span class="ident" id="5548153">Min</span><span class="op" id="5548156">.</span><span class="ident" id="5548157">X</span><span class="op" id="5548158">/</span><span class="num" id="5548159">2</span><span class="op" id="5548160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548163">case</span>&nbsp;<span class="ident" id="5548168">YCbCrSubsampleRatio440</span><span class="op" id="5548190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548194">return</span>&nbsp;<span class="op" id="5548201">(</span><span class="ident" id="5548202">y</span><span class="op" id="5548203">/</span><span class="num" id="5548204">2</span><span class="op" id="5548205">-</span><span class="ident" id="5548206">p</span><span class="op" id="5548207">.</span><span class="ident" id="5548208">Rect</span><span class="op" id="5548212">.</span><span class="ident" id="5548213">Min</span><span class="op" id="5548216">.</span><span class="ident" id="5548217">Y</span><span class="op" id="5548218">/</span><span class="num" id="5548219">2</span><span class="op" id="5548220">)</span><span class="op" id="5548221">*</span><span class="ident" id="5548222">p</span><span class="op" id="5548223">.</span><span class="ident" id="5548224">CStride</span>&nbsp;<span class="op" id="5548232">+</span>&nbsp;<span class="op" id="5548234">(</span><span class="ident" id="5548235">x</span>&nbsp;<span class="op" id="5548237">-</span>&nbsp;<span class="ident" id="5548239">p</span><span class="op" id="5548240">.</span><span class="ident" id="5548241">Rect</span><span class="op" id="5548245">.</span><span class="ident" id="5548246">Min</span><span class="op" id="5548249">.</span><span class="ident" id="5548250">X</span><span class="op" id="5548251">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548257">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548291">return</span>&nbsp;<span class="op" id="5548298">(</span><span class="ident" id="5548299">y</span><span class="op" id="5548300">-</span><span class="ident" id="5548301">p</span><span class="op" id="5548302">.</span><span class="ident" id="5548303">Rect</span><span class="op" id="5548307">.</span><span class="ident" id="5548308">Min</span><span class="op" id="5548311">.</span><span class="ident" id="5548312">Y</span><span class="op" id="5548313">)</span><span class="op" id="5548314">*</span><span class="ident" id="5548315">p</span><span class="op" id="5548316">.</span><span class="ident" id="5548317">CStride</span>&nbsp;<span class="op" id="5548325">+</span>&nbsp;<span class="op" id="5548327">(</span><span class="ident" id="5548328">x</span>&nbsp;<span class="op" id="5548330">-</span>&nbsp;<span class="ident" id="5548332">p</span><span class="op" id="5548333">.</span><span class="ident" id="5548334">Rect</span><span class="op" id="5548338">.</span><span class="ident" id="5548339">Min</span><span class="op" id="5548342">.</span><span class="ident" id="5548343">X</span><span class="op" id="5548344">)</span><br>
<span class="lineno"></span><span class="op" id="5548346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5548349">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5548426">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5548498">func</span>&nbsp;<span class="op" id="5548503">(</span><span class="ident" id="5548504">p</span>&nbsp;<span class="op" id="5548506">*</span><span class="ident" id="5548507">YCbCr</span><span class="op" id="5548512">)</span>&nbsp;<span class="ident" id="5548514">SubImage</span><span class="op" id="5548522">(</span><span class="ident" id="5548523">r</span>&nbsp;<span class="ident" id="5548525">Rectangle</span><span class="op" id="5548534">)</span>&nbsp;<span class="ident" id="5548536">Image</span>&nbsp;<span class="op" id="5548542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548545">r</span>&nbsp;<span class="op" id="5548547">=</span>&nbsp;<span class="ident" id="5548549">r</span><span class="op" id="5548550">.</span><span class="ident" id="5548551">Intersect</span><span class="op" id="5548560">(</span><span class="ident" id="5548561">p</span><span class="op" id="5548562">.</span><span class="ident" id="5548563">Rect</span><span class="op" id="5548567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548570">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548651">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548733">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548783">if</span>&nbsp;<span class="ident" id="5548786">r</span><span class="op" id="5548787">.</span><span class="ident" id="5548788">Empty</span><span class="op" id="5548793">(</span><span class="op" id="5548794">)</span>&nbsp;<span class="op" id="5548796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548800">return</span>&nbsp;<span class="op" id="5548807">&amp;</span><span class="ident" id="5548808">YCbCr</span><span class="op" id="5548813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548818">SubsampleRatio</span><span class="op" id="5548832">:</span>&nbsp;<span class="ident" id="5548834">p</span><span class="op" id="5548835">.</span><span class="ident" id="5548836">SubsampleRatio</span><span class="op" id="5548850">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548860">yi</span>&nbsp;<span class="op" id="5548863">:=</span>&nbsp;<span class="ident" id="5548866">p</span><span class="op" id="5548867">.</span><span class="ident" id="5548868">YOffset</span><span class="op" id="5548875">(</span><span class="ident" id="5548876">r</span><span class="op" id="5548877">.</span><span class="ident" id="5548878">Min</span><span class="op" id="5548881">.</span><span class="ident" id="5548882">X</span><span class="op" id="5548883">,</span>&nbsp;<span class="ident" id="5548885">r</span><span class="op" id="5548886">.</span><span class="ident" id="5548887">Min</span><span class="op" id="5548890">.</span><span class="ident" id="5548891">Y</span><span class="op" id="5548892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548895">ci</span>&nbsp;<span class="op" id="5548898">:=</span>&nbsp;<span class="ident" id="5548901">p</span><span class="op" id="5548902">.</span><span class="ident" id="5548903">COffset</span><span class="op" id="5548910">(</span><span class="ident" id="5548911">r</span><span class="op" id="5548912">.</span><span class="ident" id="5548913">Min</span><span class="op" id="5548916">.</span><span class="ident" id="5548917">X</span><span class="op" id="5548918">,</span>&nbsp;<span class="ident" id="5548920">r</span><span class="op" id="5548921">.</span><span class="ident" id="5548922">Min</span><span class="op" id="5548925">.</span><span class="ident" id="5548926">Y</span><span class="op" id="5548927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548930">return</span>&nbsp;<span class="op" id="5548937">&amp;</span><span class="ident" id="5548938">YCbCr</span><span class="op" id="5548943">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548947">Y</span><span class="op" id="5548948">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548963">p</span><span class="op" id="5548964">.</span><span class="ident" id="5548965">Y</span><span class="op" id="5548966">[</span><span class="ident" id="5548967">yi</span><span class="op" id="5548969">:</span><span class="op" id="5548970">]</span><span class="op" id="5548971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548975">Cb</span><span class="op" id="5548977">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5548991">p</span><span class="op" id="5548992">.</span><span class="ident" id="5548993">Cb</span><span class="op" id="5548995">[</span><span class="ident" id="5548996">ci</span><span class="op" id="5548998">:</span><span class="op" id="5548999">]</span><span class="op" id="5549000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549004">Cr</span><span class="op" id="5549006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549020">p</span><span class="op" id="5549021">.</span><span class="ident" id="5549022">Cr</span><span class="op" id="5549024">[</span><span class="ident" id="5549025">ci</span><span class="op" id="5549027">:</span><span class="op" id="5549028">]</span><span class="op" id="5549029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549033">SubsampleRatio</span><span class="op" id="5549047">:</span>&nbsp;<span class="ident" id="5549049">p</span><span class="op" id="5549050">.</span><span class="ident" id="5549051">SubsampleRatio</span><span class="op" id="5549065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549069">YStride</span><span class="op" id="5549076">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549085">p</span><span class="op" id="5549086">.</span><span class="ident" id="5549087">YStride</span><span class="op" id="5549094">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549098">CStride</span><span class="op" id="5549105">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549114">p</span><span class="op" id="5549115">.</span><span class="ident" id="5549116">CStride</span><span class="op" id="5549123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549127">Rect</span><span class="op" id="5549131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549143">r</span><span class="op" id="5549144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549147">}</span><br>
<span class="lineno"></span><span class="op" id="5549149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5549152">func</span>&nbsp;<span class="op" id="5549157">(</span><span class="ident" id="5549158">p</span>&nbsp;<span class="op" id="5549160">*</span><span class="ident" id="5549161">YCbCr</span><span class="op" id="5549166">)</span>&nbsp;<span class="ident" id="5549168">Opaque</span><span class="op" id="5549174">(</span><span class="op" id="5549175">)</span>&nbsp;<span class="builtintype" id="5549177">bool</span>&nbsp;<span class="op" id="5549182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549185">return</span>&nbsp;<span class="ident" id="5549192">true</span><br>
<span class="lineno"></span><span class="op" id="5549197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549200">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5549275">func</span>&nbsp;<span class="ident" id="5549280">NewYCbCr</span><span class="op" id="5549288">(</span><span class="ident" id="5549289">r</span>&nbsp;<span class="ident" id="5549291">Rectangle</span><span class="op" id="5549300">,</span>&nbsp;<span class="ident" id="5549302">subsampleRatio</span>&nbsp;<span class="ident" id="5549317">YCbCrSubsampleRatio</span><span class="op" id="5549336">)</span>&nbsp;<span class="op" id="5549338">*</span><span class="ident" id="5549339">YCbCr</span>&nbsp;<span class="op" id="5549345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549348">w</span><span class="op" id="5549349">,</span>&nbsp;<span class="ident" id="5549351">h</span><span class="op" id="5549352">,</span>&nbsp;<span class="ident" id="5549354">cw</span><span class="op" id="5549356">,</span>&nbsp;<span class="ident" id="5549358">ch</span>&nbsp;<span class="op" id="5549361">:=</span>&nbsp;<span class="ident" id="5549364">r</span><span class="op" id="5549365">.</span><span class="ident" id="5549366">Dx</span><span class="op" id="5549368">(</span><span class="op" id="5549369">)</span><span class="op" id="5549370">,</span>&nbsp;<span class="ident" id="5549372">r</span><span class="op" id="5549373">.</span><span class="ident" id="5549374">Dy</span><span class="op" id="5549376">(</span><span class="op" id="5549377">)</span><span class="op" id="5549378">,</span>&nbsp;<span class="num" id="5549380">0</span><span class="op" id="5549381">,</span>&nbsp;<span class="num" id="5549383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549386">switch</span>&nbsp;<span class="ident" id="5549393">subsampleRatio</span>&nbsp;<span class="op" id="5549408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549411">case</span>&nbsp;<span class="ident" id="5549416">YCbCrSubsampleRatio422</span><span class="op" id="5549438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549442">cw</span>&nbsp;<span class="op" id="5549445">=</span>&nbsp;<span class="op" id="5549447">(</span><span class="ident" id="5549448">r</span><span class="op" id="5549449">.</span><span class="ident" id="5549450">Max</span><span class="op" id="5549453">.</span><span class="ident" id="5549454">X</span><span class="op" id="5549455">+</span><span class="num" id="5549456">1</span><span class="op" id="5549457">)</span><span class="op" id="5549458">/</span><span class="num" id="5549459">2</span>&nbsp;<span class="op" id="5549461">-</span>&nbsp;<span class="ident" id="5549463">r</span><span class="op" id="5549464">.</span><span class="ident" id="5549465">Min</span><span class="op" id="5549468">.</span><span class="ident" id="5549469">X</span><span class="op" id="5549470">/</span><span class="num" id="5549471">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549475">ch</span>&nbsp;<span class="op" id="5549478">=</span>&nbsp;<span class="ident" id="5549480">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549483">case</span>&nbsp;<span class="ident" id="5549488">YCbCrSubsampleRatio420</span><span class="op" id="5549510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549514">cw</span>&nbsp;<span class="op" id="5549517">=</span>&nbsp;<span class="op" id="5549519">(</span><span class="ident" id="5549520">r</span><span class="op" id="5549521">.</span><span class="ident" id="5549522">Max</span><span class="op" id="5549525">.</span><span class="ident" id="5549526">X</span><span class="op" id="5549527">+</span><span class="num" id="5549528">1</span><span class="op" id="5549529">)</span><span class="op" id="5549530">/</span><span class="num" id="5549531">2</span>&nbsp;<span class="op" id="5549533">-</span>&nbsp;<span class="ident" id="5549535">r</span><span class="op" id="5549536">.</span><span class="ident" id="5549537">Min</span><span class="op" id="5549540">.</span><span class="ident" id="5549541">X</span><span class="op" id="5549542">/</span><span class="num" id="5549543">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549547">ch</span>&nbsp;<span class="op" id="5549550">=</span>&nbsp;<span class="op" id="5549552">(</span><span class="ident" id="5549553">r</span><span class="op" id="5549554">.</span><span class="ident" id="5549555">Max</span><span class="op" id="5549558">.</span><span class="ident" id="5549559">Y</span><span class="op" id="5549560">+</span><span class="num" id="5549561">1</span><span class="op" id="5549562">)</span><span class="op" id="5549563">/</span><span class="num" id="5549564">2</span>&nbsp;<span class="op" id="5549566">-</span>&nbsp;<span class="ident" id="5549568">r</span><span class="op" id="5549569">.</span><span class="ident" id="5549570">Min</span><span class="op" id="5549573">.</span><span class="ident" id="5549574">Y</span><span class="op" id="5549575">/</span><span class="num" id="5549576">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549579">case</span>&nbsp;<span class="ident" id="5549584">YCbCrSubsampleRatio440</span><span class="op" id="5549606">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549610">cw</span>&nbsp;<span class="op" id="5549613">=</span>&nbsp;<span class="ident" id="5549615">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549619">ch</span>&nbsp;<span class="op" id="5549622">=</span>&nbsp;<span class="op" id="5549624">(</span><span class="ident" id="5549625">r</span><span class="op" id="5549626">.</span><span class="ident" id="5549627">Max</span><span class="op" id="5549630">.</span><span class="ident" id="5549631">Y</span><span class="op" id="5549632">+</span><span class="num" id="5549633">1</span><span class="op" id="5549634">)</span><span class="op" id="5549635">/</span><span class="num" id="5549636">2</span>&nbsp;<span class="op" id="5549638">-</span>&nbsp;<span class="ident" id="5549640">r</span><span class="op" id="5549641">.</span><span class="ident" id="5549642">Min</span><span class="op" id="5549645">.</span><span class="ident" id="5549646">Y</span><span class="op" id="5549647">/</span><span class="num" id="5549648">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549651">default</span><span class="op" id="5549658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549662">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549697">cw</span>&nbsp;<span class="op" id="5549700">=</span>&nbsp;<span class="ident" id="5549702">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549706">ch</span>&nbsp;<span class="op" id="5549709">=</span>&nbsp;<span class="ident" id="5549711">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549717">b</span>&nbsp;<span class="op" id="5549719">:=</span>&nbsp;<span class="builtinfunc" id="5549722">make</span><span class="op" id="5549726">(</span><span class="op" id="5549727">[</span><span class="op" id="5549728">]</span><span class="builtintype" id="5549729">byte</span><span class="op" id="5549733">,</span>&nbsp;<span class="ident" id="5549735">w</span><span class="op" id="5549736">*</span><span class="ident" id="5549737">h</span><span class="op" id="5549738">+</span><span class="num" id="5549739">2</span><span class="op" id="5549740">*</span><span class="ident" id="5549741">cw</span><span class="op" id="5549743">*</span><span class="ident" id="5549744">ch</span><span class="op" id="5549746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549749">return</span>&nbsp;<span class="op" id="5549756">&amp;</span><span class="ident" id="5549757">YCbCr</span><span class="op" id="5549762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549766">Y</span><span class="op" id="5549767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549782">b</span><span class="op" id="5549783">[</span><span class="op" id="5549784">:</span><span class="ident" id="5549785">w</span><span class="op" id="5549786">*</span><span class="ident" id="5549787">h</span><span class="op" id="5549788">]</span><span class="op" id="5549789">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549793">Cb</span><span class="op" id="5549795">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549809">b</span><span class="op" id="5549810">[</span><span class="ident" id="5549811">w</span><span class="op" id="5549812">*</span><span class="ident" id="5549813">h</span><span class="op" id="5549814">+</span><span class="num" id="5549815">0</span><span class="op" id="5549816">*</span><span class="ident" id="5549817">cw</span><span class="op" id="5549819">*</span><span class="ident" id="5549820">ch</span>&nbsp;<span class="op" id="5549823">:</span>&nbsp;<span class="ident" id="5549825">w</span><span class="op" id="5549826">*</span><span class="ident" id="5549827">h</span><span class="op" id="5549828">+</span><span class="num" id="5549829">1</span><span class="op" id="5549830">*</span><span class="ident" id="5549831">cw</span><span class="op" id="5549833">*</span><span class="ident" id="5549834">ch</span><span class="op" id="5549836">]</span><span class="op" id="5549837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549841">Cr</span><span class="op" id="5549843">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549857">b</span><span class="op" id="5549858">[</span><span class="ident" id="5549859">w</span><span class="op" id="5549860">*</span><span class="ident" id="5549861">h</span><span class="op" id="5549862">+</span><span class="num" id="5549863">1</span><span class="op" id="5549864">*</span><span class="ident" id="5549865">cw</span><span class="op" id="5549867">*</span><span class="ident" id="5549868">ch</span>&nbsp;<span class="op" id="5549871">:</span>&nbsp;<span class="ident" id="5549873">w</span><span class="op" id="5549874">*</span><span class="ident" id="5549875">h</span><span class="op" id="5549876">+</span><span class="num" id="5549877">2</span><span class="op" id="5549878">*</span><span class="ident" id="5549879">cw</span><span class="op" id="5549881">*</span><span class="ident" id="5549882">ch</span><span class="op" id="5549884">]</span><span class="op" id="5549885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549889">SubsampleRatio</span><span class="op" id="5549903">:</span>&nbsp;<span class="ident" id="5549905">subsampleRatio</span><span class="op" id="5549919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549923">YStride</span><span class="op" id="5549930">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549939">w</span><span class="op" id="5549940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549944">CStride</span><span class="op" id="5549951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549960">cw</span><span class="op" id="5549962">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549966">Rect</span><span class="op" id="5549970">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5549982">r</span><span class="op" id="5549983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549986">}</span><br>
<span class="lineno"></span><span class="op" id="5549988">}</span>
</div>
</body>
</html>
