<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5783796">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5783851">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5783905">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5783956">package</span>&nbsp;<span class="ident" id="5783964">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5783970">import</span>&nbsp;<span class="op" id="5783977">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5783980">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5783995">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5784009">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5784019">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5784025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784028">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5784088">type</span>&nbsp;<span class="ident" id="5784093">Auth</span>&nbsp;<span class="keyword" id="5784098">interface</span>&nbsp;<span class="op" id="5784108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784111">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784161">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784216">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784279">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784341">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784388">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784446">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5784504">Start</span><span class="op" id="5784509">(</span><span class="ident" id="5784510">server</span>&nbsp;<span class="op" id="5784517">*</span><span class="ident" id="5784518">ServerInfo</span><span class="op" id="5784528">)</span>&nbsp;<span class="op" id="5784530">(</span><span class="ident" id="5784531">proto</span>&nbsp;<span class="builtintype" id="5784537">string</span><span class="op" id="5784543">,</span>&nbsp;<span class="ident" id="5784545">toServer</span>&nbsp;<span class="op" id="5784554">[</span><span class="op" id="5784555">]</span><span class="builtintype" id="5784556">byte</span><span class="op" id="5784560">,</span>&nbsp;<span class="ident" id="5784562">err</span>&nbsp;<span class="builtintype" id="5784566">error</span><span class="op" id="5784571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784575">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784639">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784702">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784764">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784804">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5784864">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5784922">Next</span><span class="op" id="5784926">(</span><span class="ident" id="5784927">fromServer</span>&nbsp;<span class="op" id="5784938">[</span><span class="op" id="5784939">]</span><span class="builtintype" id="5784940">byte</span><span class="op" id="5784944">,</span>&nbsp;<span class="ident" id="5784946">more</span>&nbsp;<span class="builtintype" id="5784951">bool</span><span class="op" id="5784955">)</span>&nbsp;<span class="op" id="5784957">(</span><span class="ident" id="5784958">toServer</span>&nbsp;<span class="op" id="5784967">[</span><span class="op" id="5784968">]</span><span class="builtintype" id="5784969">byte</span><span class="op" id="5784973">,</span>&nbsp;<span class="ident" id="5784975">err</span>&nbsp;<span class="builtintype" id="5784979">error</span><span class="op" id="5784984">)</span><br>
<span class="lineno"></span><span class="op" id="5784986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784989">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5785045">type</span>&nbsp;<span class="ident" id="5785050">ServerInfo</span>&nbsp;<span class="keyword" id="5785061">struct</span>&nbsp;<span class="op" id="5785068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785071">Name</span>&nbsp;<span class="builtintype" id="5785076">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5785085">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785106">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5785111">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5785120">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785167">Auth</span>&nbsp;<span class="op" id="5785172">[</span><span class="op" id="5785173">]</span><span class="builtintype" id="5785174">string</span>&nbsp;<span class="comment" id="5785181">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5785221">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5785224">type</span>&nbsp;<span class="ident" id="5785229">plainAuth</span>&nbsp;<span class="keyword" id="5785239">struct</span>&nbsp;<span class="op" id="5785246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785249">identity</span><span class="op" id="5785257">,</span>&nbsp;<span class="ident" id="5785259">username</span><span class="op" id="5785267">,</span>&nbsp;<span class="ident" id="5785269">password</span>&nbsp;<span class="builtintype" id="5785278">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785286">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5785315">string</span><br>
<span class="lineno"></span><span class="op" id="5785322">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5785325">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5785395">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5785432">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5785506">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5785582">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5785616">func</span>&nbsp;<span class="ident" id="5785621">PlainAuth</span><span class="op" id="5785630">(</span><span class="ident" id="5785631">identity</span><span class="op" id="5785639">,</span>&nbsp;<span class="ident" id="5785641">username</span><span class="op" id="5785649">,</span>&nbsp;<span class="ident" id="5785651">password</span><span class="op" id="5785659">,</span>&nbsp;<span class="ident" id="5785661">host</span>&nbsp;<span class="builtintype" id="5785666">string</span><span class="op" id="5785672">)</span>&nbsp;<span class="ident" id="5785674">Auth</span>&nbsp;<span class="op" id="5785679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785682">return</span>&nbsp;<span class="op" id="5785689">&amp;</span><span class="ident" id="5785690">plainAuth</span><span class="op" id="5785699">{</span><span class="ident" id="5785700">identity</span><span class="op" id="5785708">,</span>&nbsp;<span class="ident" id="5785710">username</span><span class="op" id="5785718">,</span>&nbsp;<span class="ident" id="5785720">password</span><span class="op" id="5785728">,</span>&nbsp;<span class="ident" id="5785730">host</span><span class="op" id="5785734">}</span><br>
<span class="lineno"></span><span class="op" id="5785736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5785739">func</span>&nbsp;<span class="op" id="5785744">(</span><span class="ident" id="5785745">a</span>&nbsp;<span class="op" id="5785747">*</span><span class="ident" id="5785748">plainAuth</span><span class="op" id="5785757">)</span>&nbsp;<span class="ident" id="5785759">Start</span><span class="op" id="5785764">(</span><span class="ident" id="5785765">server</span>&nbsp;<span class="op" id="5785772">*</span><span class="ident" id="5785773">ServerInfo</span><span class="op" id="5785783">)</span>&nbsp;<span class="op" id="5785785">(</span><span class="builtintype" id="5785786">string</span><span class="op" id="5785792">,</span>&nbsp;<span class="op" id="5785794">[</span><span class="op" id="5785795">]</span><span class="builtintype" id="5785796">byte</span><span class="op" id="5785800">,</span>&nbsp;<span class="builtintype" id="5785802">error</span><span class="op" id="5785807">)</span>&nbsp;<span class="op" id="5785809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785812">if</span>&nbsp;<span class="op" id="5785815">!</span><span class="ident" id="5785816">server</span><span class="op" id="5785822">.</span><span class="ident" id="5785823">TLS</span>&nbsp;<span class="op" id="5785827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785831">advertised</span>&nbsp;<span class="op" id="5785842">:=</span>&nbsp;<span class="builtintype" id="5785845">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785853">for</span>&nbsp;<span class="ident" id="5785857">_</span><span class="op" id="5785858">,</span>&nbsp;<span class="ident" id="5785860">mechanism</span>&nbsp;<span class="op" id="5785870">:=</span>&nbsp;<span class="keyword" id="5785873">range</span>&nbsp;<span class="ident" id="5785879">server</span><span class="op" id="5785885">.</span><span class="ident" id="5785886">Auth</span>&nbsp;<span class="op" id="5785891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785896">if</span>&nbsp;<span class="ident" id="5785899">mechanism</span>&nbsp;<span class="op" id="5785909">==</span>&nbsp;<span class="string" id="5785912">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5785920">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785926">advertised</span>&nbsp;<span class="op" id="5785937">=</span>&nbsp;<span class="builtintype" id="5785939">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785948">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5785957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5785961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785965">if</span>&nbsp;<span class="op" id="5785968">!</span><span class="ident" id="5785969">advertised</span>&nbsp;<span class="op" id="5785980">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5785985">return</span>&nbsp;<span class="string" id="5785992">&#34;&#34;</span><span class="op" id="5785994">,</span>&nbsp;<span class="builtintype" id="5785996">nil</span><span class="op" id="5785999">,</span>&nbsp;<span class="ident" id="5786001">errors</span><span class="op" id="5786007">.</span><span class="ident" id="5786008">New</span><span class="op" id="5786011">(</span><span class="string" id="5786012">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5786036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5786040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5786043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786046">if</span>&nbsp;<span class="ident" id="5786049">server</span><span class="op" id="5786055">.</span><span class="ident" id="5786056">Name</span>&nbsp;<span class="op" id="5786061">!=</span>&nbsp;<span class="ident" id="5786064">a</span><span class="op" id="5786065">.</span><span class="ident" id="5786066">host</span>&nbsp;<span class="op" id="5786071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786075">return</span>&nbsp;<span class="string" id="5786082">&#34;&#34;</span><span class="op" id="5786084">,</span>&nbsp;<span class="builtintype" id="5786086">nil</span><span class="op" id="5786089">,</span>&nbsp;<span class="ident" id="5786091">errors</span><span class="op" id="5786097">.</span><span class="ident" id="5786098">New</span><span class="op" id="5786101">(</span><span class="string" id="5786102">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5786119">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5786122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786125">resp</span>&nbsp;<span class="op" id="5786130">:=</span>&nbsp;<span class="op" id="5786133">[</span><span class="op" id="5786134">]</span><span class="builtintype" id="5786135">byte</span><span class="op" id="5786139">(</span><span class="ident" id="5786140">a</span><span class="op" id="5786141">.</span><span class="ident" id="5786142">identity</span>&nbsp;<span class="op" id="5786151">+</span>&nbsp;<span class="string" id="5786153">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5786160">+</span>&nbsp;<span class="ident" id="5786162">a</span><span class="op" id="5786163">.</span><span class="ident" id="5786164">username</span>&nbsp;<span class="op" id="5786173">+</span>&nbsp;<span class="string" id="5786175">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5786182">+</span>&nbsp;<span class="ident" id="5786184">a</span><span class="op" id="5786185">.</span><span class="ident" id="5786186">password</span><span class="op" id="5786194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786197">return</span>&nbsp;<span class="string" id="5786204">&#34;PLAIN&#34;</span><span class="op" id="5786211">,</span>&nbsp;<span class="ident" id="5786213">resp</span><span class="op" id="5786217">,</span>&nbsp;<span class="builtintype" id="5786219">nil</span><br>
<span class="lineno"></span><span class="op" id="5786223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5786226">func</span>&nbsp;<span class="op" id="5786231">(</span><span class="ident" id="5786232">a</span>&nbsp;<span class="op" id="5786234">*</span><span class="ident" id="5786235">plainAuth</span><span class="op" id="5786244">)</span>&nbsp;<span class="ident" id="5786246">Next</span><span class="op" id="5786250">(</span><span class="ident" id="5786251">fromServer</span>&nbsp;<span class="op" id="5786262">[</span><span class="op" id="5786263">]</span><span class="builtintype" id="5786264">byte</span><span class="op" id="5786268">,</span>&nbsp;<span class="ident" id="5786270">more</span>&nbsp;<span class="builtintype" id="5786275">bool</span><span class="op" id="5786279">)</span>&nbsp;<span class="op" id="5786281">(</span><span class="op" id="5786282">[</span><span class="op" id="5786283">]</span><span class="builtintype" id="5786284">byte</span><span class="op" id="5786288">,</span>&nbsp;<span class="builtintype" id="5786290">error</span><span class="op" id="5786295">)</span>&nbsp;<span class="op" id="5786297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786300">if</span>&nbsp;<span class="ident" id="5786303">more</span>&nbsp;<span class="op" id="5786308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5786312">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786348">return</span>&nbsp;<span class="builtintype" id="5786355">nil</span><span class="op" id="5786358">,</span>&nbsp;<span class="ident" id="5786360">errors</span><span class="op" id="5786366">.</span><span class="ident" id="5786367">New</span><span class="op" id="5786370">(</span><span class="string" id="5786371">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5786400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5786403">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786406">return</span>&nbsp;<span class="builtintype" id="5786413">nil</span><span class="op" id="5786416">,</span>&nbsp;<span class="builtintype" id="5786418">nil</span><br>
<span class="lineno"></span><span class="op" id="5786422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5786425">type</span>&nbsp;<span class="ident" id="5786430">cramMD5Auth</span>&nbsp;<span class="keyword" id="5786442">struct</span>&nbsp;<span class="op" id="5786449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5786452">username</span><span class="op" id="5786460">,</span>&nbsp;<span class="ident" id="5786462">secret</span>&nbsp;<span class="builtintype" id="5786469">string</span><br>
<span class="lineno">85</span><span class="op" id="5786476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5786479">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5786554">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5786591">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5786663">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5786720">func</span>&nbsp;<span class="ident" id="5786725">CRAMMD5Auth</span><span class="op" id="5786736">(</span><span class="ident" id="5786737">username</span><span class="op" id="5786745">,</span>&nbsp;<span class="ident" id="5786747">secret</span>&nbsp;<span class="builtintype" id="5786754">string</span><span class="op" id="5786760">)</span>&nbsp;<span class="ident" id="5786762">Auth</span>&nbsp;<span class="op" id="5786767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786770">return</span>&nbsp;<span class="op" id="5786777">&amp;</span><span class="ident" id="5786778">cramMD5Auth</span><span class="op" id="5786789">{</span><span class="ident" id="5786790">username</span><span class="op" id="5786798">,</span>&nbsp;<span class="ident" id="5786800">secret</span><span class="op" id="5786806">}</span><br>
<span class="lineno"></span><span class="op" id="5786808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5786811">func</span>&nbsp;<span class="op" id="5786816">(</span><span class="ident" id="5786817">a</span>&nbsp;<span class="op" id="5786819">*</span><span class="ident" id="5786820">cramMD5Auth</span><span class="op" id="5786831">)</span>&nbsp;<span class="ident" id="5786833">Start</span><span class="op" id="5786838">(</span><span class="ident" id="5786839">server</span>&nbsp;<span class="op" id="5786846">*</span><span class="ident" id="5786847">ServerInfo</span><span class="op" id="5786857">)</span>&nbsp;<span class="op" id="5786859">(</span><span class="builtintype" id="5786860">string</span><span class="op" id="5786866">,</span>&nbsp;<span class="op" id="5786868">[</span><span class="op" id="5786869">]</span><span class="builtintype" id="5786870">byte</span><span class="op" id="5786874">,</span>&nbsp;<span class="builtintype" id="5786876">error</span><span class="op" id="5786881">)</span>&nbsp;<span class="op" id="5786883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786886">return</span>&nbsp;<span class="string" id="5786893">&#34;CRAM-MD5&#34;</span><span class="op" id="5786903">,</span>&nbsp;<span class="builtintype" id="5786905">nil</span><span class="op" id="5786908">,</span>&nbsp;<span class="builtintype" id="5786910">nil</span><br>
<span class="lineno"></span><span class="op" id="5786914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5786917">func</span>&nbsp;<span class="op" id="5786922">(</span><span class="ident" id="5786923">a</span>&nbsp;<span class="op" id="5786925">*</span><span class="ident" id="5786926">cramMD5Auth</span><span class="op" id="5786937">)</span>&nbsp;<span class="ident" id="5786939">Next</span><span class="op" id="5786943">(</span><span class="ident" id="5786944">fromServer</span>&nbsp;<span class="op" id="5786955">[</span><span class="op" id="5786956">]</span><span class="builtintype" id="5786957">byte</span><span class="op" id="5786961">,</span>&nbsp;<span class="ident" id="5786963">more</span>&nbsp;<span class="builtintype" id="5786968">bool</span><span class="op" id="5786972">)</span>&nbsp;<span class="op" id="5786974">(</span><span class="op" id="5786975">[</span><span class="op" id="5786976">]</span><span class="builtintype" id="5786977">byte</span><span class="op" id="5786981">,</span>&nbsp;<span class="builtintype" id="5786983">error</span><span class="op" id="5786988">)</span>&nbsp;<span class="op" id="5786990">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5786993">if</span>&nbsp;<span class="ident" id="5786996">more</span>&nbsp;<span class="op" id="5787001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5787005">d</span>&nbsp;<span class="op" id="5787007">:=</span>&nbsp;<span class="ident" id="5787010">hmac</span><span class="op" id="5787014">.</span><span class="ident" id="5787015">New</span><span class="op" id="5787018">(</span><span class="ident" id="5787019">md5</span><span class="op" id="5787022">.</span><span class="ident" id="5787023">New</span><span class="op" id="5787026">,</span>&nbsp;<span class="op" id="5787028">[</span><span class="op" id="5787029">]</span><span class="builtintype" id="5787030">byte</span><span class="op" id="5787034">(</span><span class="ident" id="5787035">a</span><span class="op" id="5787036">.</span><span class="ident" id="5787037">secret</span><span class="op" id="5787043">)</span><span class="op" id="5787044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5787048">d</span><span class="op" id="5787049">.</span><span class="ident" id="5787050">Write</span><span class="op" id="5787055">(</span><span class="ident" id="5787056">fromServer</span><span class="op" id="5787066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5787070">s</span>&nbsp;<span class="op" id="5787072">:=</span>&nbsp;<span class="builtinfunc" id="5787075">make</span><span class="op" id="5787079">(</span><span class="op" id="5787080">[</span><span class="op" id="5787081">]</span><span class="builtintype" id="5787082">byte</span><span class="op" id="5787086">,</span>&nbsp;<span class="num" id="5787088">0</span><span class="op" id="5787089">,</span>&nbsp;<span class="ident" id="5787091">d</span><span class="op" id="5787092">.</span><span class="ident" id="5787093">Size</span><span class="op" id="5787097">(</span><span class="op" id="5787098">)</span><span class="op" id="5787099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5787103">return</span>&nbsp;<span class="op" id="5787110">[</span><span class="op" id="5787111">]</span><span class="builtintype" id="5787112">byte</span><span class="op" id="5787116">(</span><span class="ident" id="5787117">fmt</span><span class="op" id="5787120">.</span><span class="ident" id="5787121">Sprintf</span><span class="op" id="5787128">(</span><span class="string" id="5787129">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5787136">,</span>&nbsp;<span class="ident" id="5787138">a</span><span class="op" id="5787139">.</span><span class="ident" id="5787140">username</span><span class="op" id="5787148">,</span>&nbsp;<span class="ident" id="5787150">d</span><span class="op" id="5787151">.</span><span class="ident" id="5787152">Sum</span><span class="op" id="5787155">(</span><span class="ident" id="5787156">s</span><span class="op" id="5787157">)</span><span class="op" id="5787158">)</span><span class="op" id="5787159">)</span><span class="op" id="5787160">,</span>&nbsp;<span class="builtintype" id="5787162">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5787167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5787170">return</span>&nbsp;<span class="builtintype" id="5787177">nil</span><span class="op" id="5787180">,</span>&nbsp;<span class="builtintype" id="5787182">nil</span><br>
<span class="lineno"></span><span class="op" id="5787186">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
