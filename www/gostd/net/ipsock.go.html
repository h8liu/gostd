<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3296627">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3296683">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3296737">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3296788">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3296825">package</span>&nbsp;<span class="ident" id="3296833">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3296838">import</span>&nbsp;<span class="op" id="3296845">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3296848">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3296858">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3296865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3296868">var</span>&nbsp;<span class="op" id="3296872">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296875">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296935">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296965">supportsIPv4</span>&nbsp;<span class="builtintype" id="3296978">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296985">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297045">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297075">supportsIPv6</span>&nbsp;<span class="builtintype" id="3297088">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297095">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297153">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297217">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297276">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3297292">bool</span><br>
<span class="lineno"></span><span class="op" id="3297297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3297300">func</span>&nbsp;<span class="ident" id="3297305">init</span><span class="op" id="3297309">(</span><span class="op" id="3297310">)</span>&nbsp;<span class="op" id="3297312">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297315">sysInit</span><span class="op" id="3297322">(</span><span class="op" id="3297323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297326">supportsIPv4</span>&nbsp;<span class="op" id="3297339">=</span>&nbsp;<span class="ident" id="3297341">probeIPv4Stack</span><span class="op" id="3297355">(</span><span class="op" id="3297356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297359">supportsIPv6</span><span class="op" id="3297371">,</span>&nbsp;<span class="ident" id="3297373">supportsIPv4map</span>&nbsp;<span class="op" id="3297389">=</span>&nbsp;<span class="ident" id="3297391">probeIPv6Stack</span><span class="op" id="3297405">(</span><span class="op" id="3297406">)</span><br>
<span class="lineno"></span><span class="op" id="3297408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3297411">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3297475">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3297506">type</span>&nbsp;<span class="ident" id="3297511">netaddr</span>&nbsp;<span class="keyword" id="3297519">interface</span>&nbsp;<span class="op" id="3297529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297532">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297594">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297650">toAddr</span><span class="op" id="3297656">(</span><span class="op" id="3297657">)</span>&nbsp;<span class="ident" id="3297659">Addr</span><br>
<span class="lineno"></span><span class="op" id="3297664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3297667">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3297731">type</span>&nbsp;<span class="ident" id="3297736">addrList</span>&nbsp;<span class="op" id="3297745">[</span><span class="op" id="3297746">]</span><span class="ident" id="3297747">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3297756">func</span>&nbsp;<span class="op" id="3297761">(</span><span class="ident" id="3297762">al</span>&nbsp;<span class="ident" id="3297765">addrList</span><span class="op" id="3297773">)</span>&nbsp;<span class="ident" id="3297775">toAddr</span><span class="op" id="3297781">(</span><span class="op" id="3297782">)</span>&nbsp;<span class="ident" id="3297784">Addr</span>&nbsp;<span class="op" id="3297789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297792">switch</span>&nbsp;<span class="builtinfunc" id="3297799">len</span><span class="op" id="3297802">(</span><span class="ident" id="3297803">al</span><span class="op" id="3297805">)</span>&nbsp;<span class="op" id="3297807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297810">case</span>&nbsp;<span class="num" id="3297815">0</span><span class="op" id="3297816">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297820">return</span>&nbsp;<span class="builtintype" id="3297827">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297832">case</span>&nbsp;<span class="num" id="3297837">1</span><span class="op" id="3297838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297842">return</span>&nbsp;<span class="ident" id="3297849">al</span><span class="op" id="3297851">[</span><span class="num" id="3297852">0</span><span class="op" id="3297853">]</span><span class="op" id="3297854">.</span><span class="ident" id="3297855">toAddr</span><span class="op" id="3297861">(</span><span class="op" id="3297862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297865">default</span><span class="op" id="3297872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297876">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297927">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3297981">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298035">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298053">return</span>&nbsp;<span class="ident" id="3298060">al</span><span class="op" id="3298062">[</span><span class="num" id="3298063">0</span><span class="op" id="3298064">]</span><span class="op" id="3298065">.</span><span class="ident" id="3298066">toAddr</span><span class="op" id="3298072">(</span><span class="op" id="3298073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298076">}</span><br>
<span class="lineno"></span><span class="op" id="3298078">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3298081">var</span>&nbsp;<span class="ident" id="3298085">errNoSuitableAddress</span>&nbsp;<span class="op" id="3298106">=</span>&nbsp;<span class="ident" id="3298108">errors</span><span class="op" id="3298114">.</span><span class="ident" id="3298115">New</span><span class="op" id="3298118">(</span><span class="string" id="3298119">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3298146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3298149">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3298217">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3298285">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3298356">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3298408">func</span>&nbsp;<span class="ident" id="3298413">firstFavoriteAddr</span><span class="op" id="3298430">(</span><span class="ident" id="3298431">filter</span>&nbsp;<span class="keyword" id="3298438">func</span><span class="op" id="3298442">(</span><span class="ident" id="3298443">IP</span><span class="op" id="3298445">)</span>&nbsp;<span class="ident" id="3298447">IP</span><span class="op" id="3298449">,</span>&nbsp;<span class="ident" id="3298451">ips</span>&nbsp;<span class="op" id="3298455">[</span><span class="op" id="3298456">]</span><span class="ident" id="3298457">IP</span><span class="op" id="3298459">,</span>&nbsp;<span class="ident" id="3298461">inetaddr</span>&nbsp;<span class="keyword" id="3298470">func</span><span class="op" id="3298474">(</span><span class="ident" id="3298475">IP</span><span class="op" id="3298477">)</span>&nbsp;<span class="ident" id="3298479">netaddr</span><span class="op" id="3298486">)</span>&nbsp;<span class="op" id="3298488">(</span><span class="ident" id="3298489">netaddr</span><span class="op" id="3298496">,</span>&nbsp;<span class="builtintype" id="3298498">error</span><span class="op" id="3298503">)</span>&nbsp;<span class="op" id="3298505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298508">if</span>&nbsp;<span class="ident" id="3298511">filter</span>&nbsp;<span class="op" id="3298518">!=</span>&nbsp;<span class="builtintype" id="3298521">nil</span>&nbsp;<span class="op" id="3298525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298529">return</span>&nbsp;<span class="ident" id="3298536">firstSupportedAddr</span><span class="op" id="3298554">(</span><span class="ident" id="3298555">filter</span><span class="op" id="3298561">,</span>&nbsp;<span class="ident" id="3298563">ips</span><span class="op" id="3298566">,</span>&nbsp;<span class="ident" id="3298568">inetaddr</span><span class="op" id="3298576">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298582">var</span>&nbsp;<span class="op" id="3298586">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298590">ipv4</span><span class="op" id="3298594">,</span>&nbsp;<span class="ident" id="3298596">ipv6</span><span class="op" id="3298600">,</span>&nbsp;<span class="ident" id="3298602">swap</span>&nbsp;<span class="builtintype" id="3298607">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298614">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298631">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298641">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298644">for</span>&nbsp;<span class="ident" id="3298648">_</span><span class="op" id="3298649">,</span>&nbsp;<span class="ident" id="3298651">ip</span>&nbsp;<span class="op" id="3298654">:=</span>&nbsp;<span class="keyword" id="3298657">range</span>&nbsp;<span class="ident" id="3298663">ips</span>&nbsp;<span class="op" id="3298667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298671">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298725">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298771">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298822">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298878">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298933">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298985">if</span>&nbsp;<span class="ident" id="3298988">ip4</span>&nbsp;<span class="op" id="3298992">:=</span>&nbsp;<span class="ident" id="3298995">ipv4only</span><span class="op" id="3299003">(</span><span class="ident" id="3299004">ip</span><span class="op" id="3299006">)</span><span class="op" id="3299007">;</span>&nbsp;<span class="ident" id="3299009">ip4</span>&nbsp;<span class="op" id="3299013">!=</span>&nbsp;<span class="builtintype" id="3299016">nil</span>&nbsp;<span class="op" id="3299020">&amp;&amp;</span>&nbsp;<span class="op" id="3299023">!</span><span class="ident" id="3299024">ipv4</span>&nbsp;<span class="op" id="3299029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299034">list</span>&nbsp;<span class="op" id="3299039">=</span>&nbsp;<span class="builtinfunc" id="3299041">append</span><span class="op" id="3299047">(</span><span class="ident" id="3299048">list</span><span class="op" id="3299052">,</span>&nbsp;<span class="ident" id="3299054">inetaddr</span><span class="op" id="3299062">(</span><span class="ident" id="3299063">ip4</span><span class="op" id="3299066">)</span><span class="op" id="3299067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299072">ipv4</span>&nbsp;<span class="op" id="3299077">=</span>&nbsp;<span class="builtintype" id="3299079">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299087">if</span>&nbsp;<span class="ident" id="3299090">ipv6</span>&nbsp;<span class="op" id="3299095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299101">swap</span>&nbsp;<span class="op" id="3299106">=</span>&nbsp;<span class="builtintype" id="3299108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299120">}</span>&nbsp;<span class="keyword" id="3299122">else</span>&nbsp;<span class="keyword" id="3299127">if</span>&nbsp;<span class="ident" id="3299130">ip6</span>&nbsp;<span class="op" id="3299134">:=</span>&nbsp;<span class="ident" id="3299137">ipv6only</span><span class="op" id="3299145">(</span><span class="ident" id="3299146">ip</span><span class="op" id="3299148">)</span><span class="op" id="3299149">;</span>&nbsp;<span class="ident" id="3299151">ip6</span>&nbsp;<span class="op" id="3299155">!=</span>&nbsp;<span class="builtintype" id="3299158">nil</span>&nbsp;<span class="op" id="3299162">&amp;&amp;</span>&nbsp;<span class="op" id="3299165">!</span><span class="ident" id="3299166">ipv6</span>&nbsp;<span class="op" id="3299171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299176">list</span>&nbsp;<span class="op" id="3299181">=</span>&nbsp;<span class="builtinfunc" id="3299183">append</span><span class="op" id="3299189">(</span><span class="ident" id="3299190">list</span><span class="op" id="3299194">,</span>&nbsp;<span class="ident" id="3299196">inetaddr</span><span class="op" id="3299204">(</span><span class="ident" id="3299205">ip6</span><span class="op" id="3299208">)</span><span class="op" id="3299209">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299214">ipv6</span>&nbsp;<span class="op" id="3299219">=</span>&nbsp;<span class="builtintype" id="3299221">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299232">if</span>&nbsp;<span class="ident" id="3299235">ipv4</span>&nbsp;<span class="op" id="3299240">&amp;&amp;</span>&nbsp;<span class="ident" id="3299243">ipv6</span>&nbsp;<span class="op" id="3299248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299253">if</span>&nbsp;<span class="ident" id="3299256">swap</span>&nbsp;<span class="op" id="3299261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299267">list</span><span class="op" id="3299271">[</span><span class="num" id="3299272">0</span><span class="op" id="3299273">]</span><span class="op" id="3299274">,</span>&nbsp;<span class="ident" id="3299276">list</span><span class="op" id="3299280">[</span><span class="num" id="3299281">1</span><span class="op" id="3299282">]</span>&nbsp;<span class="op" id="3299284">=</span>&nbsp;<span class="ident" id="3299286">list</span><span class="op" id="3299290">[</span><span class="num" id="3299291">1</span><span class="op" id="3299292">]</span><span class="op" id="3299293">,</span>&nbsp;<span class="ident" id="3299295">list</span><span class="op" id="3299299">[</span><span class="num" id="3299300">0</span><span class="op" id="3299301">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299311">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299325">switch</span>&nbsp;<span class="builtinfunc" id="3299332">len</span><span class="op" id="3299335">(</span><span class="ident" id="3299336">list</span><span class="op" id="3299340">)</span>&nbsp;<span class="op" id="3299342">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299345">case</span>&nbsp;<span class="num" id="3299350">0</span><span class="op" id="3299351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299355">return</span>&nbsp;<span class="builtintype" id="3299362">nil</span><span class="op" id="3299365">,</span>&nbsp;<span class="ident" id="3299367">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299389">case</span>&nbsp;<span class="num" id="3299394">1</span><span class="op" id="3299395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299399">return</span>&nbsp;<span class="ident" id="3299406">list</span><span class="op" id="3299410">[</span><span class="num" id="3299411">0</span><span class="op" id="3299412">]</span><span class="op" id="3299413">,</span>&nbsp;<span class="builtintype" id="3299415">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299420">default</span><span class="op" id="3299427">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299431">return</span>&nbsp;<span class="ident" id="3299438">list</span><span class="op" id="3299442">,</span>&nbsp;<span class="builtintype" id="3299444">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299449">}</span><br>
<span class="lineno"></span><span class="op" id="3299451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3299454">func</span>&nbsp;<span class="ident" id="3299459">firstSupportedAddr</span><span class="op" id="3299477">(</span><span class="ident" id="3299478">filter</span>&nbsp;<span class="keyword" id="3299485">func</span><span class="op" id="3299489">(</span><span class="ident" id="3299490">IP</span><span class="op" id="3299492">)</span>&nbsp;<span class="ident" id="3299494">IP</span><span class="op" id="3299496">,</span>&nbsp;<span class="ident" id="3299498">ips</span>&nbsp;<span class="op" id="3299502">[</span><span class="op" id="3299503">]</span><span class="ident" id="3299504">IP</span><span class="op" id="3299506">,</span>&nbsp;<span class="ident" id="3299508">inetaddr</span>&nbsp;<span class="keyword" id="3299517">func</span><span class="op" id="3299521">(</span><span class="ident" id="3299522">IP</span><span class="op" id="3299524">)</span>&nbsp;<span class="ident" id="3299526">netaddr</span><span class="op" id="3299533">)</span>&nbsp;<span class="op" id="3299535">(</span><span class="ident" id="3299536">netaddr</span><span class="op" id="3299543">,</span>&nbsp;<span class="builtintype" id="3299545">error</span><span class="op" id="3299550">)</span>&nbsp;<span class="op" id="3299552">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299555">for</span>&nbsp;<span class="ident" id="3299559">_</span><span class="op" id="3299560">,</span>&nbsp;<span class="ident" id="3299562">ip</span>&nbsp;<span class="op" id="3299565">:=</span>&nbsp;<span class="keyword" id="3299568">range</span>&nbsp;<span class="ident" id="3299574">ips</span>&nbsp;<span class="op" id="3299578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299582">if</span>&nbsp;<span class="ident" id="3299585">ip</span>&nbsp;<span class="op" id="3299588">:=</span>&nbsp;<span class="ident" id="3299591">filter</span><span class="op" id="3299597">(</span><span class="ident" id="3299598">ip</span><span class="op" id="3299600">)</span><span class="op" id="3299601">;</span>&nbsp;<span class="ident" id="3299603">ip</span>&nbsp;<span class="op" id="3299606">!=</span>&nbsp;<span class="builtintype" id="3299609">nil</span>&nbsp;<span class="op" id="3299613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299618">return</span>&nbsp;<span class="ident" id="3299625">inetaddr</span><span class="op" id="3299633">(</span><span class="ident" id="3299634">ip</span><span class="op" id="3299636">)</span><span class="op" id="3299637">,</span>&nbsp;<span class="builtintype" id="3299639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299648">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299651">return</span>&nbsp;<span class="builtintype" id="3299658">nil</span><span class="op" id="3299661">,</span>&nbsp;<span class="ident" id="3299663">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3299684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3299687">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3299756">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3299829">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3299858">func</span>&nbsp;<span class="ident" id="3299863">ipv4only</span><span class="op" id="3299871">(</span><span class="ident" id="3299872">ip</span>&nbsp;<span class="ident" id="3299875">IP</span><span class="op" id="3299877">)</span>&nbsp;<span class="ident" id="3299879">IP</span>&nbsp;<span class="op" id="3299882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299885">if</span>&nbsp;<span class="ident" id="3299888">supportsIPv4</span>&nbsp;<span class="op" id="3299901">&amp;&amp;</span>&nbsp;<span class="ident" id="3299904">ip</span><span class="op" id="3299906">.</span><span class="ident" id="3299907">To4</span><span class="op" id="3299910">(</span><span class="op" id="3299911">)</span>&nbsp;<span class="op" id="3299913">!=</span>&nbsp;<span class="builtintype" id="3299916">nil</span>&nbsp;<span class="op" id="3299920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299924">return</span>&nbsp;<span class="ident" id="3299931">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299935">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299938">return</span>&nbsp;<span class="builtintype" id="3299945">nil</span><br>
<span class="lineno"></span><span class="op" id="3299949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3299952">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3300021">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3300089">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3300153">func</span>&nbsp;<span class="ident" id="3300158">ipv6only</span><span class="op" id="3300166">(</span><span class="ident" id="3300167">ip</span>&nbsp;<span class="ident" id="3300170">IP</span><span class="op" id="3300172">)</span>&nbsp;<span class="ident" id="3300174">IP</span>&nbsp;<span class="op" id="3300177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300180">if</span>&nbsp;<span class="ident" id="3300183">supportsIPv6</span>&nbsp;<span class="op" id="3300196">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3300199">len</span><span class="op" id="3300202">(</span><span class="ident" id="3300203">ip</span><span class="op" id="3300205">)</span>&nbsp;<span class="op" id="3300207">==</span>&nbsp;<span class="ident" id="3300210">IPv6len</span>&nbsp;<span class="op" id="3300218">&amp;&amp;</span>&nbsp;<span class="ident" id="3300221">ip</span><span class="op" id="3300223">.</span><span class="ident" id="3300224">To4</span><span class="op" id="3300227">(</span><span class="op" id="3300228">)</span>&nbsp;<span class="op" id="3300230">==</span>&nbsp;<span class="builtintype" id="3300233">nil</span>&nbsp;<span class="op" id="3300237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300241">return</span>&nbsp;<span class="ident" id="3300248">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300252">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300255">return</span>&nbsp;<span class="builtintype" id="3300262">nil</span><br>
<span class="lineno"></span><span class="op" id="3300266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300269">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3300336">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3300393">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3300462">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3300520">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3300568">func</span>&nbsp;<span class="ident" id="3300573">SplitHostPort</span><span class="op" id="3300586">(</span><span class="ident" id="3300587">hostport</span>&nbsp;<span class="builtintype" id="3300596">string</span><span class="op" id="3300602">)</span>&nbsp;<span class="op" id="3300604">(</span><span class="ident" id="3300605">host</span><span class="op" id="3300609">,</span>&nbsp;<span class="ident" id="3300611">port</span>&nbsp;<span class="builtintype" id="3300616">string</span><span class="op" id="3300622">,</span>&nbsp;<span class="ident" id="3300624">err</span>&nbsp;<span class="builtintype" id="3300628">error</span><span class="op" id="3300633">)</span>&nbsp;<span class="op" id="3300635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300638">j</span><span class="op" id="3300639">,</span>&nbsp;<span class="ident" id="3300641">k</span>&nbsp;<span class="op" id="3300643">:=</span>&nbsp;<span class="num" id="3300646">0</span><span class="op" id="3300647">,</span>&nbsp;<span class="num" id="3300649">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3300653">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300695">i</span>&nbsp;<span class="op" id="3300697">:=</span>&nbsp;<span class="ident" id="3300700">last</span><span class="op" id="3300704">(</span><span class="ident" id="3300705">hostport</span><span class="op" id="3300713">,</span>&nbsp;<span class="string" id="3300715">&#39;:&#39;</span><span class="op" id="3300718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300721">if</span>&nbsp;<span class="ident" id="3300724">i</span>&nbsp;<span class="op" id="3300726">&lt;</span>&nbsp;<span class="num" id="3300728">0</span>&nbsp;<span class="op" id="3300730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300734">goto</span>&nbsp;<span class="ident" id="3300739">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300756">if</span>&nbsp;<span class="ident" id="3300759">hostport</span><span class="op" id="3300767">[</span><span class="num" id="3300768">0</span><span class="op" id="3300769">]</span>&nbsp;<span class="op" id="3300771">==</span>&nbsp;<span class="string" id="3300774">&#39;[&#39;</span>&nbsp;<span class="op" id="3300778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3300782">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300834">end</span>&nbsp;<span class="op" id="3300838">:=</span>&nbsp;<span class="ident" id="3300841">byteIndex</span><span class="op" id="3300850">(</span><span class="ident" id="3300851">hostport</span><span class="op" id="3300859">,</span>&nbsp;<span class="string" id="3300861">&#39;]&#39;</span><span class="op" id="3300864">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300868">if</span>&nbsp;<span class="ident" id="3300871">end</span>&nbsp;<span class="op" id="3300875">&lt;</span>&nbsp;<span class="num" id="3300877">0</span>&nbsp;<span class="op" id="3300879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300884">err</span>&nbsp;<span class="op" id="3300888">=</span>&nbsp;<span class="op" id="3300890">&amp;</span><span class="ident" id="3300891">AddrError</span><span class="op" id="3300900">{</span><span class="string" id="3300901">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3300925">,</span>&nbsp;<span class="ident" id="3300927">hostport</span><span class="op" id="3300935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300940">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300953">switch</span>&nbsp;<span class="ident" id="3300960">end</span>&nbsp;<span class="op" id="3300964">+</span>&nbsp;<span class="num" id="3300966">1</span>&nbsp;<span class="op" id="3300968">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300972">case</span>&nbsp;<span class="builtinfunc" id="3300977">len</span><span class="op" id="3300980">(</span><span class="ident" id="3300981">hostport</span><span class="op" id="3300989">)</span><span class="op" id="3300990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3300995">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301042">goto</span>&nbsp;<span class="ident" id="3301047">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301061">case</span>&nbsp;<span class="ident" id="3301066">i</span><span class="op" id="3301067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301072">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301098">default</span><span class="op" id="3301105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301110">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301163">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301215">if</span>&nbsp;<span class="ident" id="3301218">hostport</span><span class="op" id="3301226">[</span><span class="ident" id="3301227">end</span><span class="op" id="3301230">+</span><span class="num" id="3301231">1</span><span class="op" id="3301232">]</span>&nbsp;<span class="op" id="3301234">==</span>&nbsp;<span class="string" id="3301237">&#39;:&#39;</span>&nbsp;<span class="op" id="3301241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301247">goto</span>&nbsp;<span class="ident" id="3301252">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301274">goto</span>&nbsp;<span class="ident" id="3301279">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301297">host</span>&nbsp;<span class="op" id="3301302">=</span>&nbsp;<span class="ident" id="3301304">hostport</span><span class="op" id="3301312">[</span><span class="num" id="3301313">1</span><span class="op" id="3301314">:</span><span class="ident" id="3301315">end</span><span class="op" id="3301318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301322">j</span><span class="op" id="3301323">,</span>&nbsp;<span class="ident" id="3301325">k</span>&nbsp;<span class="op" id="3301327">=</span>&nbsp;<span class="num" id="3301329">1</span><span class="op" id="3301330">,</span>&nbsp;<span class="ident" id="3301332">end</span><span class="op" id="3301335">+</span><span class="num" id="3301336">1</span>&nbsp;<span class="comment" id="3301338">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301396">}</span>&nbsp;<span class="keyword" id="3301398">else</span>&nbsp;<span class="op" id="3301403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301407">host</span>&nbsp;<span class="op" id="3301412">=</span>&nbsp;<span class="ident" id="3301414">hostport</span><span class="op" id="3301422">[</span><span class="op" id="3301423">:</span><span class="ident" id="3301424">i</span><span class="op" id="3301425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301429">if</span>&nbsp;<span class="ident" id="3301432">byteIndex</span><span class="op" id="3301441">(</span><span class="ident" id="3301442">host</span><span class="op" id="3301446">,</span>&nbsp;<span class="string" id="3301448">&#39;:&#39;</span><span class="op" id="3301451">)</span>&nbsp;<span class="op" id="3301453">&gt;=</span>&nbsp;<span class="num" id="3301456">0</span>&nbsp;<span class="op" id="3301458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301463">goto</span>&nbsp;<span class="ident" id="3301468">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301484">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301488">if</span>&nbsp;<span class="ident" id="3301491">byteIndex</span><span class="op" id="3301500">(</span><span class="ident" id="3301501">host</span><span class="op" id="3301505">,</span>&nbsp;<span class="string" id="3301507">&#39;%&#39;</span><span class="op" id="3301510">)</span>&nbsp;<span class="op" id="3301512">&gt;=</span>&nbsp;<span class="num" id="3301515">0</span>&nbsp;<span class="op" id="3301517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301522">goto</span>&nbsp;<span class="ident" id="3301527">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301551">if</span>&nbsp;<span class="ident" id="3301554">byteIndex</span><span class="op" id="3301563">(</span><span class="ident" id="3301564">hostport</span><span class="op" id="3301572">[</span><span class="ident" id="3301573">j</span><span class="op" id="3301574">:</span><span class="op" id="3301575">]</span><span class="op" id="3301576">,</span>&nbsp;<span class="string" id="3301578">&#39;[&#39;</span><span class="op" id="3301581">)</span>&nbsp;<span class="op" id="3301583">&gt;=</span>&nbsp;<span class="num" id="3301586">0</span>&nbsp;<span class="op" id="3301588">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301592">err</span>&nbsp;<span class="op" id="3301596">=</span>&nbsp;<span class="op" id="3301598">&amp;</span><span class="ident" id="3301599">AddrError</span><span class="op" id="3301608">{</span><span class="string" id="3301609">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3301636">,</span>&nbsp;<span class="ident" id="3301638">hostport</span><span class="op" id="3301646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301650">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301661">if</span>&nbsp;<span class="ident" id="3301664">byteIndex</span><span class="op" id="3301673">(</span><span class="ident" id="3301674">hostport</span><span class="op" id="3301682">[</span><span class="ident" id="3301683">k</span><span class="op" id="3301684">:</span><span class="op" id="3301685">]</span><span class="op" id="3301686">,</span>&nbsp;<span class="string" id="3301688">&#39;]&#39;</span><span class="op" id="3301691">)</span>&nbsp;<span class="op" id="3301693">&gt;=</span>&nbsp;<span class="num" id="3301696">0</span>&nbsp;<span class="op" id="3301698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301702">err</span>&nbsp;<span class="op" id="3301706">=</span>&nbsp;<span class="op" id="3301708">&amp;</span><span class="ident" id="3301709">AddrError</span><span class="op" id="3301718">{</span><span class="string" id="3301719">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3301746">,</span>&nbsp;<span class="ident" id="3301748">hostport</span><span class="op" id="3301756">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301760">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301772">port</span>&nbsp;<span class="op" id="3301777">=</span>&nbsp;<span class="ident" id="3301779">hostport</span><span class="op" id="3301787">[</span><span class="ident" id="3301788">i</span><span class="op" id="3301789">+</span><span class="num" id="3301790">1</span><span class="op" id="3301791">:</span><span class="op" id="3301792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301795">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3301803">missingPort</span><span class="op" id="3301814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301817">err</span>&nbsp;<span class="op" id="3301821">=</span>&nbsp;<span class="op" id="3301823">&amp;</span><span class="ident" id="3301824">AddrError</span><span class="op" id="3301833">{</span><span class="string" id="3301834">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3301859">,</span>&nbsp;<span class="ident" id="3301861">hostport</span><span class="op" id="3301869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301872">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3301880">tooManyColons</span><span class="op" id="3301893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301896">err</span>&nbsp;<span class="op" id="3301900">=</span>&nbsp;<span class="op" id="3301902">&amp;</span><span class="ident" id="3301903">AddrError</span><span class="op" id="3301912">{</span><span class="string" id="3301913">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3301941">,</span>&nbsp;<span class="ident" id="3301943">hostport</span><span class="op" id="3301951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301954">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3301962">missingBrackets</span><span class="op" id="3301977">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301980">err</span>&nbsp;<span class="op" id="3301984">=</span>&nbsp;<span class="op" id="3301986">&amp;</span><span class="ident" id="3301987">AddrError</span><span class="op" id="3301996">{</span><span class="string" id="3301997">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3302026">,</span>&nbsp;<span class="ident" id="3302028">hostport</span><span class="op" id="3302036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302039">return</span><br>
<span class="lineno"></span><span class="op" id="3302046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3302049">func</span>&nbsp;<span class="ident" id="3302054">splitHostZone</span><span class="op" id="3302067">(</span><span class="ident" id="3302068">s</span>&nbsp;<span class="builtintype" id="3302070">string</span><span class="op" id="3302076">)</span>&nbsp;<span class="op" id="3302078">(</span><span class="ident" id="3302079">host</span><span class="op" id="3302083">,</span>&nbsp;<span class="ident" id="3302085">zone</span>&nbsp;<span class="builtintype" id="3302090">string</span><span class="op" id="3302096">)</span>&nbsp;<span class="op" id="3302098">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3302101">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3302165">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302188">if</span>&nbsp;<span class="ident" id="3302191">i</span>&nbsp;<span class="op" id="3302193">:=</span>&nbsp;<span class="ident" id="3302196">last</span><span class="op" id="3302200">(</span><span class="ident" id="3302201">s</span><span class="op" id="3302202">,</span>&nbsp;<span class="string" id="3302204">&#39;%&#39;</span><span class="op" id="3302207">)</span><span class="op" id="3302208">;</span>&nbsp;<span class="ident" id="3302210">i</span>&nbsp;<span class="op" id="3302212">&gt;</span>&nbsp;<span class="num" id="3302214">0</span>&nbsp;<span class="op" id="3302216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302220">host</span><span class="op" id="3302224">,</span>&nbsp;<span class="ident" id="3302226">zone</span>&nbsp;<span class="op" id="3302231">=</span>&nbsp;<span class="ident" id="3302233">s</span><span class="op" id="3302234">[</span><span class="op" id="3302235">:</span><span class="ident" id="3302236">i</span><span class="op" id="3302237">]</span><span class="op" id="3302238">,</span>&nbsp;<span class="ident" id="3302240">s</span><span class="op" id="3302241">[</span><span class="ident" id="3302242">i</span><span class="op" id="3302243">+</span><span class="num" id="3302244">1</span><span class="op" id="3302245">:</span><span class="op" id="3302246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302249">}</span>&nbsp;<span class="keyword" id="3302251">else</span>&nbsp;<span class="op" id="3302256">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302260">host</span>&nbsp;<span class="op" id="3302265">=</span>&nbsp;<span class="ident" id="3302267">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302273">return</span><br>
<span class="lineno"></span><span class="op" id="3302280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3302283">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3302352">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3302420">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3302438">func</span>&nbsp;<span class="ident" id="3302443">JoinHostPort</span><span class="op" id="3302455">(</span><span class="ident" id="3302456">host</span><span class="op" id="3302460">,</span>&nbsp;<span class="ident" id="3302462">port</span>&nbsp;<span class="builtintype" id="3302467">string</span><span class="op" id="3302473">)</span>&nbsp;<span class="builtintype" id="3302475">string</span>&nbsp;<span class="op" id="3302482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3302485">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302547">if</span>&nbsp;<span class="ident" id="3302550">byteIndex</span><span class="op" id="3302559">(</span><span class="ident" id="3302560">host</span><span class="op" id="3302564">,</span>&nbsp;<span class="string" id="3302566">&#39;:&#39;</span><span class="op" id="3302569">)</span>&nbsp;<span class="op" id="3302571">&gt;=</span>&nbsp;<span class="num" id="3302574">0</span>&nbsp;<span class="op" id="3302576">||</span>&nbsp;<span class="ident" id="3302579">byteIndex</span><span class="op" id="3302588">(</span><span class="ident" id="3302589">host</span><span class="op" id="3302593">,</span>&nbsp;<span class="string" id="3302595">&#39;%&#39;</span><span class="op" id="3302598">)</span>&nbsp;<span class="op" id="3302600">&gt;=</span>&nbsp;<span class="num" id="3302603">0</span>&nbsp;<span class="op" id="3302605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302609">return</span>&nbsp;<span class="string" id="3302616">&#34;[&#34;</span>&nbsp;<span class="op" id="3302620">+</span>&nbsp;<span class="ident" id="3302622">host</span>&nbsp;<span class="op" id="3302627">+</span>&nbsp;<span class="string" id="3302629">&#34;]:&#34;</span>&nbsp;<span class="op" id="3302634">+</span>&nbsp;<span class="ident" id="3302636">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302645">return</span>&nbsp;<span class="ident" id="3302652">host</span>&nbsp;<span class="op" id="3302657">+</span>&nbsp;<span class="string" id="3302659">&#34;:&#34;</span>&nbsp;<span class="op" id="3302663">+</span>&nbsp;<span class="ident" id="3302665">port</span><br>
<span class="lineno"></span><span class="op" id="3302670">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3302673">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3302738">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3302803">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3302867">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3302936">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3303005">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3303035">func</span>&nbsp;<span class="ident" id="3303040">resolveInternetAddr</span><span class="op" id="3303059">(</span><span class="ident" id="3303060">net</span><span class="op" id="3303063">,</span>&nbsp;<span class="ident" id="3303065">addr</span>&nbsp;<span class="builtintype" id="3303070">string</span><span class="op" id="3303076">,</span>&nbsp;<span class="ident" id="3303078">deadline</span>&nbsp;<span class="ident" id="3303087">time</span><span class="op" id="3303091">.</span><span class="ident" id="3303092">Time</span><span class="op" id="3303096">)</span>&nbsp;<span class="op" id="3303098">(</span><span class="ident" id="3303099">netaddr</span><span class="op" id="3303106">,</span>&nbsp;<span class="builtintype" id="3303108">error</span><span class="op" id="3303113">)</span>&nbsp;<span class="op" id="3303115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303118">var</span>&nbsp;<span class="op" id="3303122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303126">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3303143">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303151">host</span><span class="op" id="3303155">,</span>&nbsp;<span class="ident" id="3303157">port</span><span class="op" id="3303161">,</span>&nbsp;<span class="ident" id="3303163">zone</span>&nbsp;<span class="builtintype" id="3303168">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303177">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3303194">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303202">switch</span>&nbsp;<span class="ident" id="3303209">net</span>&nbsp;<span class="op" id="3303213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303216">case</span>&nbsp;<span class="string" id="3303221">&#34;tcp&#34;</span><span class="op" id="3303226">,</span>&nbsp;<span class="string" id="3303228">&#34;tcp4&#34;</span><span class="op" id="3303234">,</span>&nbsp;<span class="string" id="3303236">&#34;tcp6&#34;</span><span class="op" id="3303242">,</span>&nbsp;<span class="string" id="3303244">&#34;udp&#34;</span><span class="op" id="3303249">,</span>&nbsp;<span class="string" id="3303251">&#34;udp4&#34;</span><span class="op" id="3303257">,</span>&nbsp;<span class="string" id="3303259">&#34;udp6&#34;</span><span class="op" id="3303265">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303269">if</span>&nbsp;<span class="ident" id="3303272">addr</span>&nbsp;<span class="op" id="3303277">!=</span>&nbsp;<span class="string" id="3303280">&#34;&#34;</span>&nbsp;<span class="op" id="3303283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303288">if</span>&nbsp;<span class="ident" id="3303291">host</span><span class="op" id="3303295">,</span>&nbsp;<span class="ident" id="3303297">port</span><span class="op" id="3303301">,</span>&nbsp;<span class="ident" id="3303303">err</span>&nbsp;<span class="op" id="3303307">=</span>&nbsp;<span class="ident" id="3303309">SplitHostPort</span><span class="op" id="3303322">(</span><span class="ident" id="3303323">addr</span><span class="op" id="3303327">)</span><span class="op" id="3303328">;</span>&nbsp;<span class="ident" id="3303330">err</span>&nbsp;<span class="op" id="3303334">!=</span>&nbsp;<span class="builtintype" id="3303337">nil</span>&nbsp;<span class="op" id="3303341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303347">return</span>&nbsp;<span class="builtintype" id="3303354">nil</span><span class="op" id="3303357">,</span>&nbsp;<span class="ident" id="3303359">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303371">if</span>&nbsp;<span class="ident" id="3303374">portnum</span><span class="op" id="3303381">,</span>&nbsp;<span class="ident" id="3303383">err</span>&nbsp;<span class="op" id="3303387">=</span>&nbsp;<span class="ident" id="3303389">parsePort</span><span class="op" id="3303398">(</span><span class="ident" id="3303399">net</span><span class="op" id="3303402">,</span>&nbsp;<span class="ident" id="3303404">port</span><span class="op" id="3303408">)</span><span class="op" id="3303409">;</span>&nbsp;<span class="ident" id="3303411">err</span>&nbsp;<span class="op" id="3303415">!=</span>&nbsp;<span class="builtintype" id="3303418">nil</span>&nbsp;<span class="op" id="3303422">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303428">return</span>&nbsp;<span class="builtintype" id="3303435">nil</span><span class="op" id="3303438">,</span>&nbsp;<span class="ident" id="3303440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303454">case</span>&nbsp;<span class="string" id="3303459">&#34;ip&#34;</span><span class="op" id="3303463">,</span>&nbsp;<span class="string" id="3303465">&#34;ip4&#34;</span><span class="op" id="3303470">,</span>&nbsp;<span class="string" id="3303472">&#34;ip6&#34;</span><span class="op" id="3303477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303481">if</span>&nbsp;<span class="ident" id="3303484">addr</span>&nbsp;<span class="op" id="3303489">!=</span>&nbsp;<span class="string" id="3303492">&#34;&#34;</span>&nbsp;<span class="op" id="3303495">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303500">host</span>&nbsp;<span class="op" id="3303505">=</span>&nbsp;<span class="ident" id="3303507">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303517">default</span><span class="op" id="3303524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303528">return</span>&nbsp;<span class="builtintype" id="3303535">nil</span><span class="op" id="3303538">,</span>&nbsp;<span class="ident" id="3303540">UnknownNetworkError</span><span class="op" id="3303559">(</span><span class="ident" id="3303560">net</span><span class="op" id="3303563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303566">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3303569">inetaddr</span>&nbsp;<span class="op" id="3303578">:=</span>&nbsp;<span class="keyword" id="3303581">func</span><span class="op" id="3303585">(</span><span class="ident" id="3303586">ip</span>&nbsp;<span class="ident" id="3303589">IP</span><span class="op" id="3303591">)</span>&nbsp;<span class="ident" id="3303593">netaddr</span>&nbsp;<span class="op" id="3303601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303605">switch</span>&nbsp;<span class="ident" id="3303612">net</span>&nbsp;<span class="op" id="3303616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303620">case</span>&nbsp;<span class="string" id="3303625">&#34;tcp&#34;</span><span class="op" id="3303630">,</span>&nbsp;<span class="string" id="3303632">&#34;tcp4&#34;</span><span class="op" id="3303638">,</span>&nbsp;<span class="string" id="3303640">&#34;tcp6&#34;</span><span class="op" id="3303646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303651">return</span>&nbsp;<span class="op" id="3303658">&amp;</span><span class="ident" id="3303659">TCPAddr</span><span class="op" id="3303666">{</span><span class="ident" id="3303667">IP</span><span class="op" id="3303669">:</span>&nbsp;<span class="ident" id="3303671">ip</span><span class="op" id="3303673">,</span>&nbsp;<span class="ident" id="3303675">Port</span><span class="op" id="3303679">:</span>&nbsp;<span class="ident" id="3303681">portnum</span><span class="op" id="3303688">,</span>&nbsp;<span class="ident" id="3303690">Zone</span><span class="op" id="3303694">:</span>&nbsp;<span class="ident" id="3303696">zone</span><span class="op" id="3303700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303704">case</span>&nbsp;<span class="string" id="3303709">&#34;udp&#34;</span><span class="op" id="3303714">,</span>&nbsp;<span class="string" id="3303716">&#34;udp4&#34;</span><span class="op" id="3303722">,</span>&nbsp;<span class="string" id="3303724">&#34;udp6&#34;</span><span class="op" id="3303730">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303735">return</span>&nbsp;<span class="op" id="3303742">&amp;</span><span class="ident" id="3303743">UDPAddr</span><span class="op" id="3303750">{</span><span class="ident" id="3303751">IP</span><span class="op" id="3303753">:</span>&nbsp;<span class="ident" id="3303755">ip</span><span class="op" id="3303757">,</span>&nbsp;<span class="ident" id="3303759">Port</span><span class="op" id="3303763">:</span>&nbsp;<span class="ident" id="3303765">portnum</span><span class="op" id="3303772">,</span>&nbsp;<span class="ident" id="3303774">Zone</span><span class="op" id="3303778">:</span>&nbsp;<span class="ident" id="3303780">zone</span><span class="op" id="3303784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303788">case</span>&nbsp;<span class="string" id="3303793">&#34;ip&#34;</span><span class="op" id="3303797">,</span>&nbsp;<span class="string" id="3303799">&#34;ip4&#34;</span><span class="op" id="3303804">,</span>&nbsp;<span class="string" id="3303806">&#34;ip6&#34;</span><span class="op" id="3303811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303816">return</span>&nbsp;<span class="op" id="3303823">&amp;</span><span class="ident" id="3303824">IPAddr</span><span class="op" id="3303830">{</span><span class="ident" id="3303831">IP</span><span class="op" id="3303833">:</span>&nbsp;<span class="ident" id="3303835">ip</span><span class="op" id="3303837">,</span>&nbsp;<span class="ident" id="3303839">Zone</span><span class="op" id="3303843">:</span>&nbsp;<span class="ident" id="3303845">zone</span><span class="op" id="3303849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303853">default</span><span class="op" id="3303860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3303865">panic</span><span class="op" id="3303870">(</span><span class="string" id="3303871">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3303894">+</span>&nbsp;<span class="ident" id="3303896">net</span><span class="op" id="3303899">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303909">if</span>&nbsp;<span class="ident" id="3303912">host</span>&nbsp;<span class="op" id="3303917">==</span>&nbsp;<span class="string" id="3303920">&#34;&#34;</span>&nbsp;<span class="op" id="3303923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303927">return</span>&nbsp;<span class="ident" id="3303934">inetaddr</span><span class="op" id="3303942">(</span><span class="builtintype" id="3303943">nil</span><span class="op" id="3303946">)</span><span class="op" id="3303947">,</span>&nbsp;<span class="builtintype" id="3303949">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3303954">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3303957">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3303990">var</span>&nbsp;<span class="ident" id="3303994">ip</span>&nbsp;<span class="ident" id="3303997">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304001">if</span>&nbsp;<span class="ident" id="3304004">ip</span>&nbsp;<span class="op" id="3304007">=</span>&nbsp;<span class="ident" id="3304009">parseIPv4</span><span class="op" id="3304018">(</span><span class="ident" id="3304019">host</span><span class="op" id="3304023">)</span><span class="op" id="3304024">;</span>&nbsp;<span class="ident" id="3304026">ip</span>&nbsp;<span class="op" id="3304029">!=</span>&nbsp;<span class="builtintype" id="3304032">nil</span>&nbsp;<span class="op" id="3304036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304040">return</span>&nbsp;<span class="ident" id="3304047">inetaddr</span><span class="op" id="3304055">(</span><span class="ident" id="3304056">ip</span><span class="op" id="3304058">)</span><span class="op" id="3304059">,</span>&nbsp;<span class="builtintype" id="3304061">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304066">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304069">if</span>&nbsp;<span class="ident" id="3304072">ip</span><span class="op" id="3304074">,</span>&nbsp;<span class="ident" id="3304076">zone</span>&nbsp;<span class="op" id="3304081">=</span>&nbsp;<span class="ident" id="3304083">parseIPv6</span><span class="op" id="3304092">(</span><span class="ident" id="3304093">host</span><span class="op" id="3304097">,</span>&nbsp;<span class="builtintype" id="3304099">true</span><span class="op" id="3304103">)</span><span class="op" id="3304104">;</span>&nbsp;<span class="ident" id="3304106">ip</span>&nbsp;<span class="op" id="3304109">!=</span>&nbsp;<span class="builtintype" id="3304112">nil</span>&nbsp;<span class="op" id="3304116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304120">return</span>&nbsp;<span class="ident" id="3304127">inetaddr</span><span class="op" id="3304135">(</span><span class="ident" id="3304136">ip</span><span class="op" id="3304138">)</span><span class="op" id="3304139">,</span>&nbsp;<span class="builtintype" id="3304141">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3304149">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304172">host</span><span class="op" id="3304176">,</span>&nbsp;<span class="ident" id="3304178">zone</span>&nbsp;<span class="op" id="3304183">=</span>&nbsp;<span class="ident" id="3304185">splitHostZone</span><span class="op" id="3304198">(</span><span class="ident" id="3304199">host</span><span class="op" id="3304203">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304206">ips</span><span class="op" id="3304209">,</span>&nbsp;<span class="ident" id="3304211">err</span>&nbsp;<span class="op" id="3304215">:=</span>&nbsp;<span class="ident" id="3304218">lookupIPDeadline</span><span class="op" id="3304234">(</span><span class="ident" id="3304235">host</span><span class="op" id="3304239">,</span>&nbsp;<span class="ident" id="3304241">deadline</span><span class="op" id="3304249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304252">if</span>&nbsp;<span class="ident" id="3304255">err</span>&nbsp;<span class="op" id="3304259">!=</span>&nbsp;<span class="builtintype" id="3304262">nil</span>&nbsp;<span class="op" id="3304266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304270">return</span>&nbsp;<span class="builtintype" id="3304277">nil</span><span class="op" id="3304280">,</span>&nbsp;<span class="ident" id="3304282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304290">var</span>&nbsp;<span class="ident" id="3304294">filter</span>&nbsp;<span class="keyword" id="3304301">func</span><span class="op" id="3304305">(</span><span class="ident" id="3304306">IP</span><span class="op" id="3304308">)</span>&nbsp;<span class="ident" id="3304310">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304314">if</span>&nbsp;<span class="ident" id="3304317">net</span>&nbsp;<span class="op" id="3304321">!=</span>&nbsp;<span class="string" id="3304324">&#34;&#34;</span>&nbsp;<span class="op" id="3304327">&amp;&amp;</span>&nbsp;<span class="ident" id="3304330">net</span><span class="op" id="3304333">[</span><span class="builtinfunc" id="3304334">len</span><span class="op" id="3304337">(</span><span class="ident" id="3304338">net</span><span class="op" id="3304341">)</span><span class="op" id="3304342">-</span><span class="num" id="3304343">1</span><span class="op" id="3304344">]</span>&nbsp;<span class="op" id="3304346">==</span>&nbsp;<span class="string" id="3304349">&#39;4&#39;</span>&nbsp;<span class="op" id="3304353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304357">filter</span>&nbsp;<span class="op" id="3304364">=</span>&nbsp;<span class="ident" id="3304366">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304379">if</span>&nbsp;<span class="ident" id="3304382">net</span>&nbsp;<span class="op" id="3304386">!=</span>&nbsp;<span class="string" id="3304389">&#34;&#34;</span>&nbsp;<span class="op" id="3304392">&amp;&amp;</span>&nbsp;<span class="ident" id="3304395">net</span><span class="op" id="3304398">[</span><span class="builtinfunc" id="3304399">len</span><span class="op" id="3304402">(</span><span class="ident" id="3304403">net</span><span class="op" id="3304406">)</span><span class="op" id="3304407">-</span><span class="num" id="3304408">1</span><span class="op" id="3304409">]</span>&nbsp;<span class="op" id="3304411">==</span>&nbsp;<span class="string" id="3304414">&#39;6&#39;</span>&nbsp;<span class="op" id="3304418">||</span>&nbsp;<span class="ident" id="3304421">zone</span>&nbsp;<span class="op" id="3304426">!=</span>&nbsp;<span class="string" id="3304429">&#34;&#34;</span>&nbsp;<span class="op" id="3304432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304436">filter</span>&nbsp;<span class="op" id="3304443">=</span>&nbsp;<span class="ident" id="3304445">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304458">return</span>&nbsp;<span class="ident" id="3304465">firstFavoriteAddr</span><span class="op" id="3304482">(</span><span class="ident" id="3304483">filter</span><span class="op" id="3304489">,</span>&nbsp;<span class="ident" id="3304491">ips</span><span class="op" id="3304494">,</span>&nbsp;<span class="ident" id="3304496">inetaddr</span><span class="op" id="3304504">)</span><br>
<span class="lineno"></span><span class="op" id="3304506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304509">func</span>&nbsp;<span class="ident" id="3304514">zoneToString</span><span class="op" id="3304526">(</span><span class="ident" id="3304527">zone</span>&nbsp;<span class="builtintype" id="3304532">int</span><span class="op" id="3304535">)</span>&nbsp;<span class="builtintype" id="3304537">string</span>&nbsp;<span class="op" id="3304544">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304547">if</span>&nbsp;<span class="ident" id="3304550">zone</span>&nbsp;<span class="op" id="3304555">==</span>&nbsp;<span class="num" id="3304558">0</span>&nbsp;<span class="op" id="3304560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304564">return</span>&nbsp;<span class="string" id="3304571">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304578">if</span>&nbsp;<span class="ident" id="3304581">ifi</span><span class="op" id="3304584">,</span>&nbsp;<span class="ident" id="3304586">err</span>&nbsp;<span class="op" id="3304590">:=</span>&nbsp;<span class="ident" id="3304593">InterfaceByIndex</span><span class="op" id="3304609">(</span><span class="ident" id="3304610">zone</span><span class="op" id="3304614">)</span><span class="op" id="3304615">;</span>&nbsp;<span class="ident" id="3304617">err</span>&nbsp;<span class="op" id="3304621">==</span>&nbsp;<span class="builtintype" id="3304624">nil</span>&nbsp;<span class="op" id="3304628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304632">return</span>&nbsp;<span class="ident" id="3304639">ifi</span><span class="op" id="3304642">.</span><span class="ident" id="3304643">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304652">return</span>&nbsp;<span class="ident" id="3304659">itod</span><span class="op" id="3304663">(</span><span class="builtintype" id="3304664">uint</span><span class="op" id="3304668">(</span><span class="ident" id="3304669">zone</span><span class="op" id="3304673">)</span><span class="op" id="3304674">)</span><br>
<span class="lineno"></span><span class="op" id="3304676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3304679">func</span>&nbsp;<span class="ident" id="3304684">zoneToInt</span><span class="op" id="3304693">(</span><span class="ident" id="3304694">zone</span>&nbsp;<span class="builtintype" id="3304699">string</span><span class="op" id="3304705">)</span>&nbsp;<span class="builtintype" id="3304707">int</span>&nbsp;<span class="op" id="3304711">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304714">if</span>&nbsp;<span class="ident" id="3304717">zone</span>&nbsp;<span class="op" id="3304722">==</span>&nbsp;<span class="string" id="3304725">&#34;&#34;</span>&nbsp;<span class="op" id="3304728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304732">return</span>&nbsp;<span class="num" id="3304739">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304745">if</span>&nbsp;<span class="ident" id="3304748">ifi</span><span class="op" id="3304751">,</span>&nbsp;<span class="ident" id="3304753">err</span>&nbsp;<span class="op" id="3304757">:=</span>&nbsp;<span class="ident" id="3304760">InterfaceByName</span><span class="op" id="3304775">(</span><span class="ident" id="3304776">zone</span><span class="op" id="3304780">)</span><span class="op" id="3304781">;</span>&nbsp;<span class="ident" id="3304783">err</span>&nbsp;<span class="op" id="3304787">==</span>&nbsp;<span class="builtintype" id="3304790">nil</span>&nbsp;<span class="op" id="3304794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304798">return</span>&nbsp;<span class="ident" id="3304805">ifi</span><span class="op" id="3304808">.</span><span class="ident" id="3304809">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3304816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3304819">n</span><span class="op" id="3304820">,</span>&nbsp;<span class="ident" id="3304822">_</span><span class="op" id="3304823">,</span>&nbsp;<span class="ident" id="3304825">_</span>&nbsp;<span class="op" id="3304827">:=</span>&nbsp;<span class="ident" id="3304830">dtoi</span><span class="op" id="3304834">(</span><span class="ident" id="3304835">zone</span><span class="op" id="3304839">,</span>&nbsp;<span class="num" id="3304841">0</span><span class="op" id="3304842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3304845">return</span>&nbsp;<span class="ident" id="3304852">n</span><br>
<span class="lineno"></span><span class="op" id="3304854">}</span>
</div>
</body>
</html>
