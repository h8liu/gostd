<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html" class="current">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2534141">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2534196">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2534250">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2534301">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534366">package</span>&nbsp;<span class="ident" id="2534374">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534383">import</span>&nbsp;<span class="op" id="2534390">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2534393">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2534404">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2534412">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2534421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2534424">var</span>&nbsp;<span class="op" id="2534428">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534431">Stdin</span>&nbsp;&nbsp;<span class="op" id="2534438">=</span>&nbsp;<span class="num" id="2534440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534443">Stdout</span>&nbsp;<span class="op" id="2534450">=</span>&nbsp;<span class="num" id="2534452">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534455">Stderr</span>&nbsp;<span class="op" id="2534462">=</span>&nbsp;<span class="num" id="2534464">2</span><br>
<span class="lineno"></span><span class="op" id="2534466">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2534469">const</span>&nbsp;<span class="op" id="2534475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534478">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2534493">=</span>&nbsp;<span class="ident" id="2534495">runtime</span><span class="op" id="2534502">.</span><span class="ident" id="2534503">GOOS</span>&nbsp;<span class="op" id="2534508">==</span>&nbsp;<span class="string" id="2534511">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2534520">&amp;&amp;</span>&nbsp;<span class="ident" id="2534523">sizeofPtr</span>&nbsp;<span class="op" id="2534533">==</span>&nbsp;<span class="num" id="2534536">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534539">dragonfly64Bit</span>&nbsp;<span class="op" id="2534554">=</span>&nbsp;<span class="ident" id="2534556">runtime</span><span class="op" id="2534563">.</span><span class="ident" id="2534564">GOOS</span>&nbsp;<span class="op" id="2534569">==</span>&nbsp;<span class="string" id="2534572">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2534584">&amp;&amp;</span>&nbsp;<span class="ident" id="2534587">sizeofPtr</span>&nbsp;<span class="op" id="2534597">==</span>&nbsp;<span class="num" id="2534600">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534603">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2534618">=</span>&nbsp;<span class="ident" id="2534620">runtime</span><span class="op" id="2534627">.</span><span class="ident" id="2534628">GOOS</span>&nbsp;<span class="op" id="2534633">==</span>&nbsp;<span class="string" id="2534636">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2534645">&amp;&amp;</span>&nbsp;<span class="ident" id="2534648">sizeofPtr</span>&nbsp;<span class="op" id="2534658">==</span>&nbsp;<span class="num" id="2534661">4</span><br>
<span class="lineno">25</span><span class="op" id="2534663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534666">func</span>&nbsp;<span class="ident" id="2534671">Syscall</span><span class="op" id="2534678">(</span><span class="ident" id="2534679">trap</span><span class="op" id="2534683">,</span>&nbsp;<span class="ident" id="2534685">a1</span><span class="op" id="2534687">,</span>&nbsp;<span class="ident" id="2534689">a2</span><span class="op" id="2534691">,</span>&nbsp;<span class="ident" id="2534693">a3</span>&nbsp;<span class="builtintype" id="2534696">uintptr</span><span class="op" id="2534703">)</span>&nbsp;<span class="op" id="2534705">(</span><span class="ident" id="2534706">r1</span><span class="op" id="2534708">,</span>&nbsp;<span class="ident" id="2534710">r2</span>&nbsp;<span class="builtintype" id="2534713">uintptr</span><span class="op" id="2534720">,</span>&nbsp;<span class="ident" id="2534722">err</span>&nbsp;<span class="ident" id="2534726">Errno</span><span class="op" id="2534731">)</span><br>
<span class="lineno"></span><span class="keyword" id="2534733">func</span>&nbsp;<span class="ident" id="2534738">Syscall6</span><span class="op" id="2534746">(</span><span class="ident" id="2534747">trap</span><span class="op" id="2534751">,</span>&nbsp;<span class="ident" id="2534753">a1</span><span class="op" id="2534755">,</span>&nbsp;<span class="ident" id="2534757">a2</span><span class="op" id="2534759">,</span>&nbsp;<span class="ident" id="2534761">a3</span><span class="op" id="2534763">,</span>&nbsp;<span class="ident" id="2534765">a4</span><span class="op" id="2534767">,</span>&nbsp;<span class="ident" id="2534769">a5</span><span class="op" id="2534771">,</span>&nbsp;<span class="ident" id="2534773">a6</span>&nbsp;<span class="builtintype" id="2534776">uintptr</span><span class="op" id="2534783">)</span>&nbsp;<span class="op" id="2534785">(</span><span class="ident" id="2534786">r1</span><span class="op" id="2534788">,</span>&nbsp;<span class="ident" id="2534790">r2</span>&nbsp;<span class="builtintype" id="2534793">uintptr</span><span class="op" id="2534800">,</span>&nbsp;<span class="ident" id="2534802">err</span>&nbsp;<span class="ident" id="2534806">Errno</span><span class="op" id="2534811">)</span><br>
<span class="lineno"></span><span class="keyword" id="2534813">func</span>&nbsp;<span class="ident" id="2534818">RawSyscall</span><span class="op" id="2534828">(</span><span class="ident" id="2534829">trap</span><span class="op" id="2534833">,</span>&nbsp;<span class="ident" id="2534835">a1</span><span class="op" id="2534837">,</span>&nbsp;<span class="ident" id="2534839">a2</span><span class="op" id="2534841">,</span>&nbsp;<span class="ident" id="2534843">a3</span>&nbsp;<span class="builtintype" id="2534846">uintptr</span><span class="op" id="2534853">)</span>&nbsp;<span class="op" id="2534855">(</span><span class="ident" id="2534856">r1</span><span class="op" id="2534858">,</span>&nbsp;<span class="ident" id="2534860">r2</span>&nbsp;<span class="builtintype" id="2534863">uintptr</span><span class="op" id="2534870">,</span>&nbsp;<span class="ident" id="2534872">err</span>&nbsp;<span class="ident" id="2534876">Errno</span><span class="op" id="2534881">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2534883">func</span>&nbsp;<span class="ident" id="2534888">RawSyscall6</span><span class="op" id="2534899">(</span><span class="ident" id="2534900">trap</span><span class="op" id="2534904">,</span>&nbsp;<span class="ident" id="2534906">a1</span><span class="op" id="2534908">,</span>&nbsp;<span class="ident" id="2534910">a2</span><span class="op" id="2534912">,</span>&nbsp;<span class="ident" id="2534914">a3</span><span class="op" id="2534916">,</span>&nbsp;<span class="ident" id="2534918">a4</span><span class="op" id="2534920">,</span>&nbsp;<span class="ident" id="2534922">a5</span><span class="op" id="2534924">,</span>&nbsp;<span class="ident" id="2534926">a6</span>&nbsp;<span class="builtintype" id="2534929">uintptr</span><span class="op" id="2534936">)</span>&nbsp;<span class="op" id="2534938">(</span><span class="ident" id="2534939">r1</span><span class="op" id="2534941">,</span>&nbsp;<span class="ident" id="2534943">r2</span>&nbsp;<span class="builtintype" id="2534946">uintptr</span><span class="op" id="2534953">,</span>&nbsp;<span class="ident" id="2534955">err</span>&nbsp;<span class="ident" id="2534959">Errno</span><span class="op" id="2534964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2534967">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2535039">type</span>&nbsp;<span class="ident" id="2535044">mmapper</span>&nbsp;<span class="keyword" id="2535052">struct</span>&nbsp;<span class="op" id="2535059">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535062">sync</span><span class="op" id="2535066">.</span><span class="ident" id="2535067">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535074">active</span>&nbsp;<span class="keyword" id="2535081">map</span><span class="op" id="2535084">[</span><span class="op" id="2535085">*</span><span class="builtintype" id="2535086">byte</span><span class="op" id="2535090">]</span><span class="op" id="2535091">[</span><span class="op" id="2535092">]</span><span class="builtintype" id="2535093">byte</span>&nbsp;<span class="comment" id="2535098">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535147">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535154">func</span><span class="op" id="2535158">(</span><span class="ident" id="2535159">addr</span><span class="op" id="2535163">,</span>&nbsp;<span class="ident" id="2535165">length</span>&nbsp;<span class="builtintype" id="2535172">uintptr</span><span class="op" id="2535179">,</span>&nbsp;<span class="ident" id="2535181">prot</span><span class="op" id="2535185">,</span>&nbsp;<span class="ident" id="2535187">flags</span><span class="op" id="2535192">,</span>&nbsp;<span class="ident" id="2535194">fd</span>&nbsp;<span class="builtintype" id="2535197">int</span><span class="op" id="2535200">,</span>&nbsp;<span class="ident" id="2535202">offset</span>&nbsp;<span class="ident" id="2535209">int64</span><span class="op" id="2535214">)</span>&nbsp;<span class="op" id="2535216">(</span><span class="builtintype" id="2535217">uintptr</span><span class="op" id="2535224">,</span>&nbsp;<span class="builtintype" id="2535226">error</span><span class="op" id="2535231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535234">munmap</span>&nbsp;<span class="keyword" id="2535241">func</span><span class="op" id="2535245">(</span><span class="ident" id="2535246">addr</span>&nbsp;<span class="builtintype" id="2535251">uintptr</span><span class="op" id="2535258">,</span>&nbsp;<span class="ident" id="2535260">length</span>&nbsp;<span class="builtintype" id="2535267">uintptr</span><span class="op" id="2535274">)</span>&nbsp;<span class="builtintype" id="2535276">error</span><br>
<span class="lineno"></span><span class="op" id="2535282">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2535285">func</span>&nbsp;<span class="op" id="2535290">(</span><span class="ident" id="2535291">m</span>&nbsp;<span class="op" id="2535293">*</span><span class="ident" id="2535294">mmapper</span><span class="op" id="2535301">)</span>&nbsp;<span class="ident" id="2535303">Mmap</span><span class="op" id="2535307">(</span><span class="ident" id="2535308">fd</span>&nbsp;<span class="builtintype" id="2535311">int</span><span class="op" id="2535314">,</span>&nbsp;<span class="ident" id="2535316">offset</span>&nbsp;<span class="ident" id="2535323">int64</span><span class="op" id="2535328">,</span>&nbsp;<span class="ident" id="2535330">length</span>&nbsp;<span class="builtintype" id="2535337">int</span><span class="op" id="2535340">,</span>&nbsp;<span class="ident" id="2535342">prot</span>&nbsp;<span class="builtintype" id="2535347">int</span><span class="op" id="2535350">,</span>&nbsp;<span class="ident" id="2535352">flags</span>&nbsp;<span class="builtintype" id="2535358">int</span><span class="op" id="2535361">)</span>&nbsp;<span class="op" id="2535363">(</span><span class="ident" id="2535364">data</span>&nbsp;<span class="op" id="2535369">[</span><span class="op" id="2535370">]</span><span class="builtintype" id="2535371">byte</span><span class="op" id="2535375">,</span>&nbsp;<span class="ident" id="2535377">err</span>&nbsp;<span class="builtintype" id="2535381">error</span><span class="op" id="2535386">)</span>&nbsp;<span class="op" id="2535388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535391">if</span>&nbsp;<span class="ident" id="2535394">length</span>&nbsp;<span class="op" id="2535401">&lt;=</span>&nbsp;<span class="num" id="2535404">0</span>&nbsp;<span class="op" id="2535406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535410">return</span>&nbsp;<span class="builtintype" id="2535417">nil</span><span class="op" id="2535420">,</span>&nbsp;<span class="ident" id="2535422">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535430">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535434">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535464">addr</span><span class="op" id="2535468">,</span>&nbsp;<span class="ident" id="2535470">errno</span>&nbsp;<span class="op" id="2535476">:=</span>&nbsp;<span class="ident" id="2535479">m</span><span class="op" id="2535480">.</span><span class="ident" id="2535481">mmap</span><span class="op" id="2535485">(</span><span class="num" id="2535486">0</span><span class="op" id="2535487">,</span>&nbsp;<span class="builtintype" id="2535489">uintptr</span><span class="op" id="2535496">(</span><span class="ident" id="2535497">length</span><span class="op" id="2535503">)</span><span class="op" id="2535504">,</span>&nbsp;<span class="ident" id="2535506">prot</span><span class="op" id="2535510">,</span>&nbsp;<span class="ident" id="2535512">flags</span><span class="op" id="2535517">,</span>&nbsp;<span class="ident" id="2535519">fd</span><span class="op" id="2535521">,</span>&nbsp;<span class="ident" id="2535523">offset</span><span class="op" id="2535529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535532">if</span>&nbsp;<span class="ident" id="2535535">errno</span>&nbsp;<span class="op" id="2535541">!=</span>&nbsp;<span class="builtintype" id="2535544">nil</span>&nbsp;<span class="op" id="2535548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535552">return</span>&nbsp;<span class="builtintype" id="2535559">nil</span><span class="op" id="2535562">,</span>&nbsp;<span class="ident" id="2535564">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535575">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535599">var</span>&nbsp;<span class="ident" id="2535603">sl</span>&nbsp;<span class="op" id="2535606">=</span>&nbsp;<span class="keyword" id="2535608">struct</span>&nbsp;<span class="op" id="2535615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535619">addr</span>&nbsp;<span class="builtintype" id="2535624">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2535634">len</span>&nbsp;&nbsp;<span class="builtintype" id="2535639">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2535645">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2535650">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535655">}</span><span class="op" id="2535656">{</span><span class="ident" id="2535657">addr</span><span class="op" id="2535661">,</span>&nbsp;<span class="ident" id="2535663">length</span><span class="op" id="2535669">,</span>&nbsp;<span class="ident" id="2535671">length</span><span class="op" id="2535677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535681">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535722">b</span>&nbsp;<span class="op" id="2535724">:=</span>&nbsp;<span class="op" id="2535727">*</span><span class="op" id="2535728">(</span><span class="op" id="2535729">*</span><span class="op" id="2535730">[</span><span class="op" id="2535731">]</span><span class="builtintype" id="2535732">byte</span><span class="op" id="2535736">)</span><span class="op" id="2535737">(</span><span class="ident" id="2535738">unsafe</span><span class="op" id="2535744">.</span><span class="ident" id="2535745">Pointer</span><span class="op" id="2535752">(</span><span class="op" id="2535753">&amp;</span><span class="ident" id="2535754">sl</span><span class="op" id="2535756">)</span><span class="op" id="2535757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535761">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535802">p</span>&nbsp;<span class="op" id="2535804">:=</span>&nbsp;<span class="op" id="2535807">&amp;</span><span class="ident" id="2535808">b</span><span class="op" id="2535809">[</span><span class="builtinfunc" id="2535810">cap</span><span class="op" id="2535813">(</span><span class="ident" id="2535814">b</span><span class="op" id="2535815">)</span><span class="op" id="2535816">-</span><span class="num" id="2535817">1</span><span class="op" id="2535818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535821">m</span><span class="op" id="2535822">.</span><span class="ident" id="2535823">Lock</span><span class="op" id="2535827">(</span><span class="op" id="2535828">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535831">defer</span>&nbsp;<span class="ident" id="2535837">m</span><span class="op" id="2535838">.</span><span class="ident" id="2535839">Unlock</span><span class="op" id="2535845">(</span><span class="op" id="2535846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535849">m</span><span class="op" id="2535850">.</span><span class="ident" id="2535851">active</span><span class="op" id="2535857">[</span><span class="ident" id="2535858">p</span><span class="op" id="2535859">]</span>&nbsp;<span class="op" id="2535861">=</span>&nbsp;<span class="ident" id="2535863">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535866">return</span>&nbsp;<span class="ident" id="2535873">b</span><span class="op" id="2535874">,</span>&nbsp;<span class="builtintype" id="2535876">nil</span><br>
<span class="lineno"></span><span class="op" id="2535880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2535883">func</span>&nbsp;<span class="op" id="2535888">(</span><span class="ident" id="2535889">m</span>&nbsp;<span class="op" id="2535891">*</span><span class="ident" id="2535892">mmapper</span><span class="op" id="2535899">)</span>&nbsp;<span class="ident" id="2535901">Munmap</span><span class="op" id="2535907">(</span><span class="ident" id="2535908">data</span>&nbsp;<span class="op" id="2535913">[</span><span class="op" id="2535914">]</span><span class="builtintype" id="2535915">byte</span><span class="op" id="2535919">)</span>&nbsp;<span class="op" id="2535921">(</span><span class="ident" id="2535922">err</span>&nbsp;<span class="builtintype" id="2535926">error</span><span class="op" id="2535931">)</span>&nbsp;<span class="op" id="2535933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535936">if</span>&nbsp;<span class="builtinfunc" id="2535939">len</span><span class="op" id="2535942">(</span><span class="ident" id="2535943">data</span><span class="op" id="2535947">)</span>&nbsp;<span class="op" id="2535949">==</span>&nbsp;<span class="num" id="2535952">0</span>&nbsp;<span class="op" id="2535954">||</span>&nbsp;<span class="builtinfunc" id="2535957">len</span><span class="op" id="2535960">(</span><span class="ident" id="2535961">data</span><span class="op" id="2535965">)</span>&nbsp;<span class="op" id="2535967">!=</span>&nbsp;<span class="builtinfunc" id="2535970">cap</span><span class="op" id="2535973">(</span><span class="ident" id="2535974">data</span><span class="op" id="2535978">)</span>&nbsp;<span class="op" id="2535980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535984">return</span>&nbsp;<span class="ident" id="2535991">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2536003">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536037">p</span>&nbsp;<span class="op" id="2536039">:=</span>&nbsp;<span class="op" id="2536042">&amp;</span><span class="ident" id="2536043">data</span><span class="op" id="2536047">[</span><span class="builtinfunc" id="2536048">cap</span><span class="op" id="2536051">(</span><span class="ident" id="2536052">data</span><span class="op" id="2536056">)</span><span class="op" id="2536057">-</span><span class="num" id="2536058">1</span><span class="op" id="2536059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536062">m</span><span class="op" id="2536063">.</span><span class="ident" id="2536064">Lock</span><span class="op" id="2536068">(</span><span class="op" id="2536069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536072">defer</span>&nbsp;<span class="ident" id="2536078">m</span><span class="op" id="2536079">.</span><span class="ident" id="2536080">Unlock</span><span class="op" id="2536086">(</span><span class="op" id="2536087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536090">b</span>&nbsp;<span class="op" id="2536092">:=</span>&nbsp;<span class="ident" id="2536095">m</span><span class="op" id="2536096">.</span><span class="ident" id="2536097">active</span><span class="op" id="2536103">[</span><span class="ident" id="2536104">p</span><span class="op" id="2536105">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536108">if</span>&nbsp;<span class="ident" id="2536111">b</span>&nbsp;<span class="op" id="2536113">==</span>&nbsp;<span class="builtintype" id="2536116">nil</span>&nbsp;<span class="op" id="2536120">||</span>&nbsp;<span class="op" id="2536123">&amp;</span><span class="ident" id="2536124">b</span><span class="op" id="2536125">[</span><span class="num" id="2536126">0</span><span class="op" id="2536127">]</span>&nbsp;<span class="op" id="2536129">!=</span>&nbsp;<span class="op" id="2536132">&amp;</span><span class="ident" id="2536133">data</span><span class="op" id="2536137">[</span><span class="num" id="2536138">0</span><span class="op" id="2536139">]</span>&nbsp;<span class="op" id="2536141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536145">return</span>&nbsp;<span class="ident" id="2536152">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2536164">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536199">if</span>&nbsp;<span class="ident" id="2536202">errno</span>&nbsp;<span class="op" id="2536208">:=</span>&nbsp;<span class="ident" id="2536211">m</span><span class="op" id="2536212">.</span><span class="ident" id="2536213">munmap</span><span class="op" id="2536219">(</span><span class="builtintype" id="2536220">uintptr</span><span class="op" id="2536227">(</span><span class="ident" id="2536228">unsafe</span><span class="op" id="2536234">.</span><span class="ident" id="2536235">Pointer</span><span class="op" id="2536242">(</span><span class="op" id="2536243">&amp;</span><span class="ident" id="2536244">b</span><span class="op" id="2536245">[</span><span class="num" id="2536246">0</span><span class="op" id="2536247">]</span><span class="op" id="2536248">)</span><span class="op" id="2536249">)</span><span class="op" id="2536250">,</span>&nbsp;<span class="builtintype" id="2536252">uintptr</span><span class="op" id="2536259">(</span><span class="builtinfunc" id="2536260">len</span><span class="op" id="2536263">(</span><span class="ident" id="2536264">b</span><span class="op" id="2536265">)</span><span class="op" id="2536266">)</span><span class="op" id="2536267">)</span><span class="op" id="2536268">;</span>&nbsp;<span class="ident" id="2536270">errno</span>&nbsp;<span class="op" id="2536276">!=</span>&nbsp;<span class="builtintype" id="2536279">nil</span>&nbsp;<span class="op" id="2536283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536287">return</span>&nbsp;<span class="ident" id="2536294">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2536304">delete</span><span class="op" id="2536310">(</span><span class="ident" id="2536311">m</span><span class="op" id="2536312">.</span><span class="ident" id="2536313">active</span><span class="op" id="2536319">,</span>&nbsp;<span class="ident" id="2536321">p</span><span class="op" id="2536322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536325">return</span>&nbsp;<span class="builtintype" id="2536332">nil</span><br>
<span class="lineno">90</span><span class="op" id="2536336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2536339">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2536404">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2536475">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2536542">//&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2536555">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2536574">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2536590">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="2536595">type</span>&nbsp;<span class="ident" id="2536600">Errno</span>&nbsp;<span class="builtintype" id="2536606">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2536615">func</span>&nbsp;<span class="op" id="2536620">(</span><span class="ident" id="2536621">e</span>&nbsp;<span class="ident" id="2536623">Errno</span><span class="op" id="2536628">)</span>&nbsp;<span class="ident" id="2536630">Error</span><span class="op" id="2536635">(</span><span class="op" id="2536636">)</span>&nbsp;<span class="builtintype" id="2536638">string</span>&nbsp;<span class="op" id="2536645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536648">if</span>&nbsp;<span class="num" id="2536651">0</span>&nbsp;<span class="op" id="2536653">&lt;=</span>&nbsp;<span class="builtintype" id="2536656">int</span><span class="op" id="2536659">(</span><span class="ident" id="2536660">e</span><span class="op" id="2536661">)</span>&nbsp;<span class="op" id="2536663">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2536666">int</span><span class="op" id="2536669">(</span><span class="ident" id="2536670">e</span><span class="op" id="2536671">)</span>&nbsp;<span class="op" id="2536673">&lt;</span>&nbsp;<span class="builtinfunc" id="2536675">len</span><span class="op" id="2536678">(</span><span class="ident" id="2536679">errors</span><span class="op" id="2536685">)</span>&nbsp;<span class="op" id="2536687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536691">s</span>&nbsp;<span class="op" id="2536693">:=</span>&nbsp;<span class="ident" id="2536696">errors</span><span class="op" id="2536702">[</span><span class="ident" id="2536703">e</span><span class="op" id="2536704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536708">if</span>&nbsp;<span class="ident" id="2536711">s</span>&nbsp;<span class="op" id="2536713">!=</span>&nbsp;<span class="string" id="2536716">&#34;&#34;</span>&nbsp;<span class="op" id="2536719">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536724">return</span>&nbsp;<span class="ident" id="2536731">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536741">return</span>&nbsp;<span class="string" id="2536748">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2536757">+</span>&nbsp;<span class="ident" id="2536759">itoa</span><span class="op" id="2536763">(</span><span class="builtintype" id="2536764">int</span><span class="op" id="2536767">(</span><span class="ident" id="2536768">e</span><span class="op" id="2536769">)</span><span class="op" id="2536770">)</span><br>
<span class="lineno"></span><span class="op" id="2536772">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2536775">func</span>&nbsp;<span class="op" id="2536780">(</span><span class="ident" id="2536781">e</span>&nbsp;<span class="ident" id="2536783">Errno</span><span class="op" id="2536788">)</span>&nbsp;<span class="ident" id="2536790">Temporary</span><span class="op" id="2536799">(</span><span class="op" id="2536800">)</span>&nbsp;<span class="builtintype" id="2536802">bool</span>&nbsp;<span class="op" id="2536807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536810">return</span>&nbsp;<span class="ident" id="2536817">e</span>&nbsp;<span class="op" id="2536819">==</span>&nbsp;<span class="ident" id="2536822">EINTR</span>&nbsp;<span class="op" id="2536828">||</span>&nbsp;<span class="ident" id="2536831">e</span>&nbsp;<span class="op" id="2536833">==</span>&nbsp;<span class="ident" id="2536836">EMFILE</span>&nbsp;<span class="op" id="2536843">||</span>&nbsp;<span class="ident" id="2536846">e</span>&nbsp;<span class="op" id="2536848">==</span>&nbsp;<span class="ident" id="2536851">ECONNRESET</span>&nbsp;<span class="op" id="2536862">||</span>&nbsp;<span class="ident" id="2536865">e</span>&nbsp;<span class="op" id="2536867">==</span>&nbsp;<span class="ident" id="2536870">ECONNABORTED</span>&nbsp;<span class="op" id="2536883">||</span>&nbsp;<span class="ident" id="2536886">e</span><span class="op" id="2536887">.</span><span class="ident" id="2536888">Timeout</span><span class="op" id="2536895">(</span><span class="op" id="2536896">)</span><br>
<span class="lineno"></span><span class="op" id="2536898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2536901">func</span>&nbsp;<span class="op" id="2536906">(</span><span class="ident" id="2536907">e</span>&nbsp;<span class="ident" id="2536909">Errno</span><span class="op" id="2536914">)</span>&nbsp;<span class="ident" id="2536916">Timeout</span><span class="op" id="2536923">(</span><span class="op" id="2536924">)</span>&nbsp;<span class="builtintype" id="2536926">bool</span>&nbsp;<span class="op" id="2536931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536934">return</span>&nbsp;<span class="ident" id="2536941">e</span>&nbsp;<span class="op" id="2536943">==</span>&nbsp;<span class="ident" id="2536946">EAGAIN</span>&nbsp;<span class="op" id="2536953">||</span>&nbsp;<span class="ident" id="2536956">e</span>&nbsp;<span class="op" id="2536958">==</span>&nbsp;<span class="ident" id="2536961">EWOULDBLOCK</span>&nbsp;<span class="op" id="2536973">||</span>&nbsp;<span class="ident" id="2536976">e</span>&nbsp;<span class="op" id="2536978">==</span>&nbsp;<span class="ident" id="2536981">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2536991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2536994">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2537047">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2537089">type</span>&nbsp;<span class="ident" id="2537094">Signal</span>&nbsp;<span class="builtintype" id="2537101">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2537106">func</span>&nbsp;<span class="op" id="2537111">(</span><span class="ident" id="2537112">s</span>&nbsp;<span class="ident" id="2537114">Signal</span><span class="op" id="2537120">)</span>&nbsp;<span class="ident" id="2537122">Signal</span><span class="op" id="2537128">(</span><span class="op" id="2537129">)</span>&nbsp;<span class="op" id="2537131">{</span><span class="op" id="2537132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2537135">func</span>&nbsp;<span class="op" id="2537140">(</span><span class="ident" id="2537141">s</span>&nbsp;<span class="ident" id="2537143">Signal</span><span class="op" id="2537149">)</span>&nbsp;<span class="ident" id="2537151">String</span><span class="op" id="2537157">(</span><span class="op" id="2537158">)</span>&nbsp;<span class="builtintype" id="2537160">string</span>&nbsp;<span class="op" id="2537167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537170">if</span>&nbsp;<span class="num" id="2537173">0</span>&nbsp;<span class="op" id="2537175">&lt;=</span>&nbsp;<span class="ident" id="2537178">s</span>&nbsp;<span class="op" id="2537180">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2537183">int</span><span class="op" id="2537186">(</span><span class="ident" id="2537187">s</span><span class="op" id="2537188">)</span>&nbsp;<span class="op" id="2537190">&lt;</span>&nbsp;<span class="builtinfunc" id="2537192">len</span><span class="op" id="2537195">(</span><span class="ident" id="2537196">signals</span><span class="op" id="2537203">)</span>&nbsp;<span class="op" id="2537205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537209">str</span>&nbsp;<span class="op" id="2537213">:=</span>&nbsp;<span class="ident" id="2537216">signals</span><span class="op" id="2537223">[</span><span class="ident" id="2537224">s</span><span class="op" id="2537225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537229">if</span>&nbsp;<span class="ident" id="2537232">str</span>&nbsp;<span class="op" id="2537236">!=</span>&nbsp;<span class="string" id="2537239">&#34;&#34;</span>&nbsp;<span class="op" id="2537242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537247">return</span>&nbsp;<span class="ident" id="2537254">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537266">return</span>&nbsp;<span class="string" id="2537273">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2537283">+</span>&nbsp;<span class="ident" id="2537285">itoa</span><span class="op" id="2537289">(</span><span class="builtintype" id="2537290">int</span><span class="op" id="2537293">(</span><span class="ident" id="2537294">s</span><span class="op" id="2537295">)</span><span class="op" id="2537296">)</span><br>
<span class="lineno"></span><span class="op" id="2537298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2537301">func</span>&nbsp;<span class="ident" id="2537306">Read</span><span class="op" id="2537310">(</span><span class="ident" id="2537311">fd</span>&nbsp;<span class="builtintype" id="2537314">int</span><span class="op" id="2537317">,</span>&nbsp;<span class="ident" id="2537319">p</span>&nbsp;<span class="op" id="2537321">[</span><span class="op" id="2537322">]</span><span class="builtintype" id="2537323">byte</span><span class="op" id="2537327">)</span>&nbsp;<span class="op" id="2537329">(</span><span class="ident" id="2537330">n</span>&nbsp;<span class="builtintype" id="2537332">int</span><span class="op" id="2537335">,</span>&nbsp;<span class="ident" id="2537337">err</span>&nbsp;<span class="builtintype" id="2537341">error</span><span class="op" id="2537346">)</span>&nbsp;<span class="op" id="2537348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537351">n</span><span class="op" id="2537352">,</span>&nbsp;<span class="ident" id="2537354">err</span>&nbsp;<span class="op" id="2537358">=</span>&nbsp;<span class="ident" id="2537360">read</span><span class="op" id="2537364">(</span><span class="ident" id="2537365">fd</span><span class="op" id="2537367">,</span>&nbsp;<span class="ident" id="2537369">p</span><span class="op" id="2537370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537373">if</span>&nbsp;<span class="ident" id="2537376">raceenabled</span>&nbsp;<span class="op" id="2537388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537392">if</span>&nbsp;<span class="ident" id="2537395">n</span>&nbsp;<span class="op" id="2537397">&gt;</span>&nbsp;<span class="num" id="2537399">0</span>&nbsp;<span class="op" id="2537401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537406">raceWriteRange</span><span class="op" id="2537420">(</span><span class="ident" id="2537421">unsafe</span><span class="op" id="2537427">.</span><span class="ident" id="2537428">Pointer</span><span class="op" id="2537435">(</span><span class="op" id="2537436">&amp;</span><span class="ident" id="2537437">p</span><span class="op" id="2537438">[</span><span class="num" id="2537439">0</span><span class="op" id="2537440">]</span><span class="op" id="2537441">)</span><span class="op" id="2537442">,</span>&nbsp;<span class="ident" id="2537444">n</span><span class="op" id="2537445">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537453">if</span>&nbsp;<span class="ident" id="2537456">err</span>&nbsp;<span class="op" id="2537460">==</span>&nbsp;<span class="builtintype" id="2537463">nil</span>&nbsp;<span class="op" id="2537467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537472">raceAcquire</span><span class="op" id="2537483">(</span><span class="ident" id="2537484">unsafe</span><span class="op" id="2537490">.</span><span class="ident" id="2537491">Pointer</span><span class="op" id="2537498">(</span><span class="op" id="2537499">&amp;</span><span class="ident" id="2537500">ioSync</span><span class="op" id="2537506">)</span><span class="op" id="2537507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537514">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537517">return</span><br>
<span class="lineno"></span><span class="op" id="2537524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2537527">func</span>&nbsp;<span class="ident" id="2537532">Write</span><span class="op" id="2537537">(</span><span class="ident" id="2537538">fd</span>&nbsp;<span class="builtintype" id="2537541">int</span><span class="op" id="2537544">,</span>&nbsp;<span class="ident" id="2537546">p</span>&nbsp;<span class="op" id="2537548">[</span><span class="op" id="2537549">]</span><span class="builtintype" id="2537550">byte</span><span class="op" id="2537554">)</span>&nbsp;<span class="op" id="2537556">(</span><span class="ident" id="2537557">n</span>&nbsp;<span class="builtintype" id="2537559">int</span><span class="op" id="2537562">,</span>&nbsp;<span class="ident" id="2537564">err</span>&nbsp;<span class="builtintype" id="2537568">error</span><span class="op" id="2537573">)</span>&nbsp;<span class="op" id="2537575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537578">if</span>&nbsp;<span class="ident" id="2537581">raceenabled</span>&nbsp;<span class="op" id="2537593">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537597">raceReleaseMerge</span><span class="op" id="2537613">(</span><span class="ident" id="2537614">unsafe</span><span class="op" id="2537620">.</span><span class="ident" id="2537621">Pointer</span><span class="op" id="2537628">(</span><span class="op" id="2537629">&amp;</span><span class="ident" id="2537630">ioSync</span><span class="op" id="2537636">)</span><span class="op" id="2537637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537643">n</span><span class="op" id="2537644">,</span>&nbsp;<span class="ident" id="2537646">err</span>&nbsp;<span class="op" id="2537650">=</span>&nbsp;<span class="ident" id="2537652">write</span><span class="op" id="2537657">(</span><span class="ident" id="2537658">fd</span><span class="op" id="2537660">,</span>&nbsp;<span class="ident" id="2537662">p</span><span class="op" id="2537663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537666">if</span>&nbsp;<span class="ident" id="2537669">raceenabled</span>&nbsp;<span class="op" id="2537681">&amp;&amp;</span>&nbsp;<span class="ident" id="2537684">n</span>&nbsp;<span class="op" id="2537686">&gt;</span>&nbsp;<span class="num" id="2537688">0</span>&nbsp;<span class="op" id="2537690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537694">raceReadRange</span><span class="op" id="2537707">(</span><span class="ident" id="2537708">unsafe</span><span class="op" id="2537714">.</span><span class="ident" id="2537715">Pointer</span><span class="op" id="2537722">(</span><span class="op" id="2537723">&amp;</span><span class="ident" id="2537724">p</span><span class="op" id="2537725">[</span><span class="num" id="2537726">0</span><span class="op" id="2537727">]</span><span class="op" id="2537728">)</span><span class="op" id="2537729">,</span>&nbsp;<span class="ident" id="2537731">n</span><span class="op" id="2537732">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2537735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2537738">return</span><br>
<span class="lineno"></span><span class="op" id="2537745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2537748">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2537799">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2537851">var</span>&nbsp;<span class="ident" id="2537855">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2537873">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2537879">type</span>&nbsp;<span class="ident" id="2537884">Sockaddr</span>&nbsp;<span class="keyword" id="2537893">interface</span>&nbsp;<span class="op" id="2537903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537906">sockaddr</span><span class="op" id="2537914">(</span><span class="op" id="2537915">)</span>&nbsp;<span class="op" id="2537917">(</span><span class="ident" id="2537918">ptr</span>&nbsp;<span class="ident" id="2537922">unsafe</span><span class="op" id="2537928">.</span><span class="ident" id="2537929">Pointer</span><span class="op" id="2537936">,</span>&nbsp;<span class="builtinfunc" id="2537938">len</span>&nbsp;<span class="ident" id="2537942">_Socklen</span><span class="op" id="2537950">,</span>&nbsp;<span class="ident" id="2537952">err</span>&nbsp;<span class="builtintype" id="2537956">error</span><span class="op" id="2537961">)</span>&nbsp;<span class="comment" id="2537963">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2538006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538009">type</span>&nbsp;<span class="ident" id="2538014">SockaddrInet4</span>&nbsp;<span class="keyword" id="2538028">struct</span>&nbsp;<span class="op" id="2538035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538038">Port</span>&nbsp;<span class="builtintype" id="2538043">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538048">Addr</span>&nbsp;<span class="op" id="2538053">[</span><span class="num" id="2538054">4</span><span class="op" id="2538055">]</span><span class="builtintype" id="2538056">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538062">raw</span>&nbsp;&nbsp;<span class="ident" id="2538067">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2538084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538087">type</span>&nbsp;<span class="ident" id="2538092">SockaddrInet6</span>&nbsp;<span class="keyword" id="2538106">struct</span>&nbsp;<span class="op" id="2538113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538116">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2538123">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538128">ZoneId</span>&nbsp;<span class="builtintype" id="2538135">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538143">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2538150">[</span><span class="num" id="2538151">16</span><span class="op" id="2538153">]</span><span class="builtintype" id="2538154">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538160">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538167">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2538184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2538187">type</span>&nbsp;<span class="ident" id="2538192">SockaddrUnix</span>&nbsp;<span class="keyword" id="2538205">struct</span>&nbsp;<span class="op" id="2538212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538215">Name</span>&nbsp;<span class="builtintype" id="2538220">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538228">raw</span>&nbsp;&nbsp;<span class="ident" id="2538233">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2538249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2538252">func</span>&nbsp;<span class="ident" id="2538257">Bind</span><span class="op" id="2538261">(</span><span class="ident" id="2538262">fd</span>&nbsp;<span class="builtintype" id="2538265">int</span><span class="op" id="2538268">,</span>&nbsp;<span class="ident" id="2538270">sa</span>&nbsp;<span class="ident" id="2538273">Sockaddr</span><span class="op" id="2538281">)</span>&nbsp;<span class="op" id="2538283">(</span><span class="ident" id="2538284">err</span>&nbsp;<span class="builtintype" id="2538288">error</span><span class="op" id="2538293">)</span>&nbsp;<span class="op" id="2538295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538298">ptr</span><span class="op" id="2538301">,</span>&nbsp;<span class="ident" id="2538303">n</span><span class="op" id="2538304">,</span>&nbsp;<span class="ident" id="2538306">err</span>&nbsp;<span class="op" id="2538310">:=</span>&nbsp;<span class="ident" id="2538313">sa</span><span class="op" id="2538315">.</span><span class="ident" id="2538316">sockaddr</span><span class="op" id="2538324">(</span><span class="op" id="2538325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538328">if</span>&nbsp;<span class="ident" id="2538331">err</span>&nbsp;<span class="op" id="2538335">!=</span>&nbsp;<span class="builtintype" id="2538338">nil</span>&nbsp;<span class="op" id="2538342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538346">return</span>&nbsp;<span class="ident" id="2538353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2538358">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538361">return</span>&nbsp;<span class="ident" id="2538368">bind</span><span class="op" id="2538372">(</span><span class="ident" id="2538373">fd</span><span class="op" id="2538375">,</span>&nbsp;<span class="ident" id="2538377">ptr</span><span class="op" id="2538380">,</span>&nbsp;<span class="ident" id="2538382">n</span><span class="op" id="2538383">)</span><br>
<span class="lineno"></span><span class="op" id="2538385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538388">func</span>&nbsp;<span class="ident" id="2538393">Connect</span><span class="op" id="2538400">(</span><span class="ident" id="2538401">fd</span>&nbsp;<span class="builtintype" id="2538404">int</span><span class="op" id="2538407">,</span>&nbsp;<span class="ident" id="2538409">sa</span>&nbsp;<span class="ident" id="2538412">Sockaddr</span><span class="op" id="2538420">)</span>&nbsp;<span class="op" id="2538422">(</span><span class="ident" id="2538423">err</span>&nbsp;<span class="builtintype" id="2538427">error</span><span class="op" id="2538432">)</span>&nbsp;<span class="op" id="2538434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538437">ptr</span><span class="op" id="2538440">,</span>&nbsp;<span class="ident" id="2538442">n</span><span class="op" id="2538443">,</span>&nbsp;<span class="ident" id="2538445">err</span>&nbsp;<span class="op" id="2538449">:=</span>&nbsp;<span class="ident" id="2538452">sa</span><span class="op" id="2538454">.</span><span class="ident" id="2538455">sockaddr</span><span class="op" id="2538463">(</span><span class="op" id="2538464">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538467">if</span>&nbsp;<span class="ident" id="2538470">err</span>&nbsp;<span class="op" id="2538474">!=</span>&nbsp;<span class="builtintype" id="2538477">nil</span>&nbsp;<span class="op" id="2538481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538485">return</span>&nbsp;<span class="ident" id="2538492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2538497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538500">return</span>&nbsp;<span class="ident" id="2538507">connect</span><span class="op" id="2538514">(</span><span class="ident" id="2538515">fd</span><span class="op" id="2538517">,</span>&nbsp;<span class="ident" id="2538519">ptr</span><span class="op" id="2538522">,</span>&nbsp;<span class="ident" id="2538524">n</span><span class="op" id="2538525">)</span><br>
<span class="lineno"></span><span class="op" id="2538527">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2538530">func</span>&nbsp;<span class="ident" id="2538535">Getpeername</span><span class="op" id="2538546">(</span><span class="ident" id="2538547">fd</span>&nbsp;<span class="builtintype" id="2538550">int</span><span class="op" id="2538553">)</span>&nbsp;<span class="op" id="2538555">(</span><span class="ident" id="2538556">sa</span>&nbsp;<span class="ident" id="2538559">Sockaddr</span><span class="op" id="2538567">,</span>&nbsp;<span class="ident" id="2538569">err</span>&nbsp;<span class="builtintype" id="2538573">error</span><span class="op" id="2538578">)</span>&nbsp;<span class="op" id="2538580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538583">var</span>&nbsp;<span class="ident" id="2538587">rsa</span>&nbsp;<span class="ident" id="2538591">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538607">var</span>&nbsp;<span class="builtinfunc" id="2538611">len</span>&nbsp;<span class="ident" id="2538615">_Socklen</span>&nbsp;<span class="op" id="2538624">=</span>&nbsp;<span class="ident" id="2538626">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538645">if</span>&nbsp;<span class="ident" id="2538648">err</span>&nbsp;<span class="op" id="2538652">=</span>&nbsp;<span class="ident" id="2538654">getpeername</span><span class="op" id="2538665">(</span><span class="ident" id="2538666">fd</span><span class="op" id="2538668">,</span>&nbsp;<span class="op" id="2538670">&amp;</span><span class="ident" id="2538671">rsa</span><span class="op" id="2538674">,</span>&nbsp;<span class="op" id="2538676">&amp;</span><span class="builtinfunc" id="2538677">len</span><span class="op" id="2538680">)</span><span class="op" id="2538681">;</span>&nbsp;<span class="ident" id="2538683">err</span>&nbsp;<span class="op" id="2538687">!=</span>&nbsp;<span class="builtintype" id="2538690">nil</span>&nbsp;<span class="op" id="2538694">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2538706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538709">return</span>&nbsp;<span class="ident" id="2538716">anyToSockaddr</span><span class="op" id="2538729">(</span><span class="op" id="2538730">&amp;</span><span class="ident" id="2538731">rsa</span><span class="op" id="2538734">)</span><br>
<span class="lineno"></span><span class="op" id="2538736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2538739">func</span>&nbsp;<span class="ident" id="2538744">GetsockoptInt</span><span class="op" id="2538757">(</span><span class="ident" id="2538758">fd</span><span class="op" id="2538760">,</span>&nbsp;<span class="ident" id="2538762">level</span><span class="op" id="2538767">,</span>&nbsp;<span class="ident" id="2538769">opt</span>&nbsp;<span class="builtintype" id="2538773">int</span><span class="op" id="2538776">)</span>&nbsp;<span class="op" id="2538778">(</span><span class="ident" id="2538779">value</span>&nbsp;<span class="builtintype" id="2538785">int</span><span class="op" id="2538788">,</span>&nbsp;<span class="ident" id="2538790">err</span>&nbsp;<span class="builtintype" id="2538794">error</span><span class="op" id="2538799">)</span>&nbsp;<span class="op" id="2538801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538804">var</span>&nbsp;<span class="ident" id="2538808">n</span>&nbsp;<span class="builtintype" id="2538810">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538817">vallen</span>&nbsp;<span class="op" id="2538824">:=</span>&nbsp;<span class="ident" id="2538827">_Socklen</span><span class="op" id="2538835">(</span><span class="num" id="2538836">4</span><span class="op" id="2538837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538840">err</span>&nbsp;<span class="op" id="2538844">=</span>&nbsp;<span class="ident" id="2538846">getsockopt</span><span class="op" id="2538856">(</span><span class="ident" id="2538857">fd</span><span class="op" id="2538859">,</span>&nbsp;<span class="ident" id="2538861">level</span><span class="op" id="2538866">,</span>&nbsp;<span class="ident" id="2538868">opt</span><span class="op" id="2538871">,</span>&nbsp;<span class="ident" id="2538873">unsafe</span><span class="op" id="2538879">.</span><span class="ident" id="2538880">Pointer</span><span class="op" id="2538887">(</span><span class="op" id="2538888">&amp;</span><span class="ident" id="2538889">n</span><span class="op" id="2538890">)</span><span class="op" id="2538891">,</span>&nbsp;<span class="op" id="2538893">&amp;</span><span class="ident" id="2538894">vallen</span><span class="op" id="2538900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538903">return</span>&nbsp;<span class="builtintype" id="2538910">int</span><span class="op" id="2538913">(</span><span class="ident" id="2538914">n</span><span class="op" id="2538915">)</span><span class="op" id="2538916">,</span>&nbsp;<span class="ident" id="2538918">err</span><br>
<span class="lineno">215</span><span class="op" id="2538922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538925">func</span>&nbsp;<span class="ident" id="2538930">Recvfrom</span><span class="op" id="2538938">(</span><span class="ident" id="2538939">fd</span>&nbsp;<span class="builtintype" id="2538942">int</span><span class="op" id="2538945">,</span>&nbsp;<span class="ident" id="2538947">p</span>&nbsp;<span class="op" id="2538949">[</span><span class="op" id="2538950">]</span><span class="builtintype" id="2538951">byte</span><span class="op" id="2538955">,</span>&nbsp;<span class="ident" id="2538957">flags</span>&nbsp;<span class="builtintype" id="2538963">int</span><span class="op" id="2538966">)</span>&nbsp;<span class="op" id="2538968">(</span><span class="ident" id="2538969">n</span>&nbsp;<span class="builtintype" id="2538971">int</span><span class="op" id="2538974">,</span>&nbsp;<span class="ident" id="2538976">from</span>&nbsp;<span class="ident" id="2538981">Sockaddr</span><span class="op" id="2538989">,</span>&nbsp;<span class="ident" id="2538991">err</span>&nbsp;<span class="builtintype" id="2538995">error</span><span class="op" id="2539000">)</span>&nbsp;<span class="op" id="2539002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539005">var</span>&nbsp;<span class="ident" id="2539009">rsa</span>&nbsp;<span class="ident" id="2539013">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539029">var</span>&nbsp;<span class="builtinfunc" id="2539033">len</span>&nbsp;<span class="ident" id="2539037">_Socklen</span>&nbsp;<span class="op" id="2539046">=</span>&nbsp;<span class="ident" id="2539048">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539067">if</span>&nbsp;<span class="ident" id="2539070">n</span><span class="op" id="2539071">,</span>&nbsp;<span class="ident" id="2539073">err</span>&nbsp;<span class="op" id="2539077">=</span>&nbsp;<span class="ident" id="2539079">recvfrom</span><span class="op" id="2539087">(</span><span class="ident" id="2539088">fd</span><span class="op" id="2539090">,</span>&nbsp;<span class="ident" id="2539092">p</span><span class="op" id="2539093">,</span>&nbsp;<span class="ident" id="2539095">flags</span><span class="op" id="2539100">,</span>&nbsp;<span class="op" id="2539102">&amp;</span><span class="ident" id="2539103">rsa</span><span class="op" id="2539106">,</span>&nbsp;<span class="op" id="2539108">&amp;</span><span class="builtinfunc" id="2539109">len</span><span class="op" id="2539112">)</span><span class="op" id="2539113">;</span>&nbsp;<span class="ident" id="2539115">err</span>&nbsp;<span class="op" id="2539119">!=</span>&nbsp;<span class="builtintype" id="2539122">nil</span>&nbsp;<span class="op" id="2539126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2539138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539141">if</span>&nbsp;<span class="ident" id="2539144">rsa</span><span class="op" id="2539147">.</span><span class="ident" id="2539148">Addr</span><span class="op" id="2539152">.</span><span class="ident" id="2539153">Family</span>&nbsp;<span class="op" id="2539160">!=</span>&nbsp;<span class="ident" id="2539163">AF_UNSPEC</span>&nbsp;<span class="op" id="2539173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2539177">from</span><span class="op" id="2539181">,</span>&nbsp;<span class="ident" id="2539183">err</span>&nbsp;<span class="op" id="2539187">=</span>&nbsp;<span class="ident" id="2539189">anyToSockaddr</span><span class="op" id="2539202">(</span><span class="op" id="2539203">&amp;</span><span class="ident" id="2539204">rsa</span><span class="op" id="2539207">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2539210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539213">return</span><br>
<span class="lineno"></span><span class="op" id="2539220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2539223">func</span>&nbsp;<span class="ident" id="2539228">Sendto</span><span class="op" id="2539234">(</span><span class="ident" id="2539235">fd</span>&nbsp;<span class="builtintype" id="2539238">int</span><span class="op" id="2539241">,</span>&nbsp;<span class="ident" id="2539243">p</span>&nbsp;<span class="op" id="2539245">[</span><span class="op" id="2539246">]</span><span class="builtintype" id="2539247">byte</span><span class="op" id="2539251">,</span>&nbsp;<span class="ident" id="2539253">flags</span>&nbsp;<span class="builtintype" id="2539259">int</span><span class="op" id="2539262">,</span>&nbsp;<span class="ident" id="2539264">to</span>&nbsp;<span class="ident" id="2539267">Sockaddr</span><span class="op" id="2539275">)</span>&nbsp;<span class="op" id="2539277">(</span><span class="ident" id="2539278">err</span>&nbsp;<span class="builtintype" id="2539282">error</span><span class="op" id="2539287">)</span>&nbsp;<span class="op" id="2539289">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2539292">ptr</span><span class="op" id="2539295">,</span>&nbsp;<span class="ident" id="2539297">n</span><span class="op" id="2539298">,</span>&nbsp;<span class="ident" id="2539300">err</span>&nbsp;<span class="op" id="2539304">:=</span>&nbsp;<span class="ident" id="2539307">to</span><span class="op" id="2539309">.</span><span class="ident" id="2539310">sockaddr</span><span class="op" id="2539318">(</span><span class="op" id="2539319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539322">if</span>&nbsp;<span class="ident" id="2539325">err</span>&nbsp;<span class="op" id="2539329">!=</span>&nbsp;<span class="builtintype" id="2539332">nil</span>&nbsp;<span class="op" id="2539336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539340">return</span>&nbsp;<span class="ident" id="2539347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2539352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539355">return</span>&nbsp;<span class="ident" id="2539362">sendto</span><span class="op" id="2539368">(</span><span class="ident" id="2539369">fd</span><span class="op" id="2539371">,</span>&nbsp;<span class="ident" id="2539373">p</span><span class="op" id="2539374">,</span>&nbsp;<span class="ident" id="2539376">flags</span><span class="op" id="2539381">,</span>&nbsp;<span class="ident" id="2539383">ptr</span><span class="op" id="2539386">,</span>&nbsp;<span class="ident" id="2539388">n</span><span class="op" id="2539389">)</span><br>
<span class="lineno">235</span><span class="op" id="2539391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2539394">func</span>&nbsp;<span class="ident" id="2539399">SetsockoptByte</span><span class="op" id="2539413">(</span><span class="ident" id="2539414">fd</span><span class="op" id="2539416">,</span>&nbsp;<span class="ident" id="2539418">level</span><span class="op" id="2539423">,</span>&nbsp;<span class="ident" id="2539425">opt</span>&nbsp;<span class="builtintype" id="2539429">int</span><span class="op" id="2539432">,</span>&nbsp;<span class="ident" id="2539434">value</span>&nbsp;<span class="builtintype" id="2539440">byte</span><span class="op" id="2539444">)</span>&nbsp;<span class="op" id="2539446">(</span><span class="ident" id="2539447">err</span>&nbsp;<span class="builtintype" id="2539451">error</span><span class="op" id="2539456">)</span>&nbsp;<span class="op" id="2539458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539461">return</span>&nbsp;<span class="ident" id="2539468">setsockopt</span><span class="op" id="2539478">(</span><span class="ident" id="2539479">fd</span><span class="op" id="2539481">,</span>&nbsp;<span class="ident" id="2539483">level</span><span class="op" id="2539488">,</span>&nbsp;<span class="ident" id="2539490">opt</span><span class="op" id="2539493">,</span>&nbsp;<span class="ident" id="2539495">unsafe</span><span class="op" id="2539501">.</span><span class="ident" id="2539502">Pointer</span><span class="op" id="2539509">(</span><span class="op" id="2539510">&amp;</span><span class="ident" id="2539511">value</span><span class="op" id="2539516">)</span><span class="op" id="2539517">,</span>&nbsp;<span class="num" id="2539519">1</span><span class="op" id="2539520">)</span><br>
<span class="lineno"></span><span class="op" id="2539522">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2539525">func</span>&nbsp;<span class="ident" id="2539530">SetsockoptInt</span><span class="op" id="2539543">(</span><span class="ident" id="2539544">fd</span><span class="op" id="2539546">,</span>&nbsp;<span class="ident" id="2539548">level</span><span class="op" id="2539553">,</span>&nbsp;<span class="ident" id="2539555">opt</span>&nbsp;<span class="builtintype" id="2539559">int</span><span class="op" id="2539562">,</span>&nbsp;<span class="ident" id="2539564">value</span>&nbsp;<span class="builtintype" id="2539570">int</span><span class="op" id="2539573">)</span>&nbsp;<span class="op" id="2539575">(</span><span class="ident" id="2539576">err</span>&nbsp;<span class="builtintype" id="2539580">error</span><span class="op" id="2539585">)</span>&nbsp;<span class="op" id="2539587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539590">var</span>&nbsp;<span class="ident" id="2539594">n</span>&nbsp;<span class="op" id="2539596">=</span>&nbsp;<span class="builtintype" id="2539598">int32</span><span class="op" id="2539603">(</span><span class="ident" id="2539604">value</span><span class="op" id="2539609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539612">return</span>&nbsp;<span class="ident" id="2539619">setsockopt</span><span class="op" id="2539629">(</span><span class="ident" id="2539630">fd</span><span class="op" id="2539632">,</span>&nbsp;<span class="ident" id="2539634">level</span><span class="op" id="2539639">,</span>&nbsp;<span class="ident" id="2539641">opt</span><span class="op" id="2539644">,</span>&nbsp;<span class="ident" id="2539646">unsafe</span><span class="op" id="2539652">.</span><span class="ident" id="2539653">Pointer</span><span class="op" id="2539660">(</span><span class="op" id="2539661">&amp;</span><span class="ident" id="2539662">n</span><span class="op" id="2539663">)</span><span class="op" id="2539664">,</span>&nbsp;<span class="num" id="2539666">4</span><span class="op" id="2539667">)</span><br>
<span class="lineno"></span><span class="op" id="2539669">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2539672">func</span>&nbsp;<span class="ident" id="2539677">SetsockoptInet4Addr</span><span class="op" id="2539696">(</span><span class="ident" id="2539697">fd</span><span class="op" id="2539699">,</span>&nbsp;<span class="ident" id="2539701">level</span><span class="op" id="2539706">,</span>&nbsp;<span class="ident" id="2539708">opt</span>&nbsp;<span class="builtintype" id="2539712">int</span><span class="op" id="2539715">,</span>&nbsp;<span class="ident" id="2539717">value</span>&nbsp;<span class="op" id="2539723">[</span><span class="num" id="2539724">4</span><span class="op" id="2539725">]</span><span class="builtintype" id="2539726">byte</span><span class="op" id="2539730">)</span>&nbsp;<span class="op" id="2539732">(</span><span class="ident" id="2539733">err</span>&nbsp;<span class="builtintype" id="2539737">error</span><span class="op" id="2539742">)</span>&nbsp;<span class="op" id="2539744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539747">return</span>&nbsp;<span class="ident" id="2539754">setsockopt</span><span class="op" id="2539764">(</span><span class="ident" id="2539765">fd</span><span class="op" id="2539767">,</span>&nbsp;<span class="ident" id="2539769">level</span><span class="op" id="2539774">,</span>&nbsp;<span class="ident" id="2539776">opt</span><span class="op" id="2539779">,</span>&nbsp;<span class="ident" id="2539781">unsafe</span><span class="op" id="2539787">.</span><span class="ident" id="2539788">Pointer</span><span class="op" id="2539795">(</span><span class="op" id="2539796">&amp;</span><span class="ident" id="2539797">value</span><span class="op" id="2539802">[</span><span class="num" id="2539803">0</span><span class="op" id="2539804">]</span><span class="op" id="2539805">)</span><span class="op" id="2539806">,</span>&nbsp;<span class="num" id="2539808">4</span><span class="op" id="2539809">)</span><br>
<span class="lineno"></span><span class="op" id="2539811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2539814">func</span>&nbsp;<span class="ident" id="2539819">SetsockoptIPMreq</span><span class="op" id="2539835">(</span><span class="ident" id="2539836">fd</span><span class="op" id="2539838">,</span>&nbsp;<span class="ident" id="2539840">level</span><span class="op" id="2539845">,</span>&nbsp;<span class="ident" id="2539847">opt</span>&nbsp;<span class="builtintype" id="2539851">int</span><span class="op" id="2539854">,</span>&nbsp;<span class="ident" id="2539856">mreq</span>&nbsp;<span class="op" id="2539861">*</span><span class="ident" id="2539862">IPMreq</span><span class="op" id="2539868">)</span>&nbsp;<span class="op" id="2539870">(</span><span class="ident" id="2539871">err</span>&nbsp;<span class="builtintype" id="2539875">error</span><span class="op" id="2539880">)</span>&nbsp;<span class="op" id="2539882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2539885">return</span>&nbsp;<span class="ident" id="2539892">setsockopt</span><span class="op" id="2539902">(</span><span class="ident" id="2539903">fd</span><span class="op" id="2539905">,</span>&nbsp;<span class="ident" id="2539907">level</span><span class="op" id="2539912">,</span>&nbsp;<span class="ident" id="2539914">opt</span><span class="op" id="2539917">,</span>&nbsp;<span class="ident" id="2539919">unsafe</span><span class="op" id="2539925">.</span><span class="ident" id="2539926">Pointer</span><span class="op" id="2539933">(</span><span class="ident" id="2539934">mreq</span><span class="op" id="2539938">)</span><span class="op" id="2539939">,</span>&nbsp;<span class="ident" id="2539941">SizeofIPMreq</span><span class="op" id="2539953">)</span><br>
<span class="lineno"></span><span class="op" id="2539955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2539958">func</span>&nbsp;<span class="ident" id="2539963">SetsockoptIPv6Mreq</span><span class="op" id="2539981">(</span><span class="ident" id="2539982">fd</span><span class="op" id="2539984">,</span>&nbsp;<span class="ident" id="2539986">level</span><span class="op" id="2539991">,</span>&nbsp;<span class="ident" id="2539993">opt</span>&nbsp;<span class="builtintype" id="2539997">int</span><span class="op" id="2540000">,</span>&nbsp;<span class="ident" id="2540002">mreq</span>&nbsp;<span class="op" id="2540007">*</span><span class="ident" id="2540008">IPv6Mreq</span><span class="op" id="2540016">)</span>&nbsp;<span class="op" id="2540018">(</span><span class="ident" id="2540019">err</span>&nbsp;<span class="builtintype" id="2540023">error</span><span class="op" id="2540028">)</span>&nbsp;<span class="op" id="2540030">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540033">return</span>&nbsp;<span class="ident" id="2540040">setsockopt</span><span class="op" id="2540050">(</span><span class="ident" id="2540051">fd</span><span class="op" id="2540053">,</span>&nbsp;<span class="ident" id="2540055">level</span><span class="op" id="2540060">,</span>&nbsp;<span class="ident" id="2540062">opt</span><span class="op" id="2540065">,</span>&nbsp;<span class="ident" id="2540067">unsafe</span><span class="op" id="2540073">.</span><span class="ident" id="2540074">Pointer</span><span class="op" id="2540081">(</span><span class="ident" id="2540082">mreq</span><span class="op" id="2540086">)</span><span class="op" id="2540087">,</span>&nbsp;<span class="ident" id="2540089">SizeofIPv6Mreq</span><span class="op" id="2540103">)</span><br>
<span class="lineno"></span><span class="op" id="2540105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2540108">func</span>&nbsp;<span class="ident" id="2540113">SetsockoptICMPv6Filter</span><span class="op" id="2540135">(</span><span class="ident" id="2540136">fd</span><span class="op" id="2540138">,</span>&nbsp;<span class="ident" id="2540140">level</span><span class="op" id="2540145">,</span>&nbsp;<span class="ident" id="2540147">opt</span>&nbsp;<span class="builtintype" id="2540151">int</span><span class="op" id="2540154">,</span>&nbsp;<span class="ident" id="2540156">filter</span>&nbsp;<span class="op" id="2540163">*</span><span class="ident" id="2540164">ICMPv6Filter</span><span class="op" id="2540176">)</span>&nbsp;<span class="builtintype" id="2540178">error</span>&nbsp;<span class="op" id="2540184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540187">return</span>&nbsp;<span class="ident" id="2540194">setsockopt</span><span class="op" id="2540204">(</span><span class="ident" id="2540205">fd</span><span class="op" id="2540207">,</span>&nbsp;<span class="ident" id="2540209">level</span><span class="op" id="2540214">,</span>&nbsp;<span class="ident" id="2540216">opt</span><span class="op" id="2540219">,</span>&nbsp;<span class="ident" id="2540221">unsafe</span><span class="op" id="2540227">.</span><span class="ident" id="2540228">Pointer</span><span class="op" id="2540235">(</span><span class="ident" id="2540236">filter</span><span class="op" id="2540242">)</span><span class="op" id="2540243">,</span>&nbsp;<span class="ident" id="2540245">SizeofICMPv6Filter</span><span class="op" id="2540263">)</span><br>
<span class="lineno">260</span><span class="op" id="2540265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2540268">func</span>&nbsp;<span class="ident" id="2540273">SetsockoptLinger</span><span class="op" id="2540289">(</span><span class="ident" id="2540290">fd</span><span class="op" id="2540292">,</span>&nbsp;<span class="ident" id="2540294">level</span><span class="op" id="2540299">,</span>&nbsp;<span class="ident" id="2540301">opt</span>&nbsp;<span class="builtintype" id="2540305">int</span><span class="op" id="2540308">,</span>&nbsp;<span class="ident" id="2540310">l</span>&nbsp;<span class="op" id="2540312">*</span><span class="ident" id="2540313">Linger</span><span class="op" id="2540319">)</span>&nbsp;<span class="op" id="2540321">(</span><span class="ident" id="2540322">err</span>&nbsp;<span class="builtintype" id="2540326">error</span><span class="op" id="2540331">)</span>&nbsp;<span class="op" id="2540333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540336">return</span>&nbsp;<span class="ident" id="2540343">setsockopt</span><span class="op" id="2540353">(</span><span class="ident" id="2540354">fd</span><span class="op" id="2540356">,</span>&nbsp;<span class="ident" id="2540358">level</span><span class="op" id="2540363">,</span>&nbsp;<span class="ident" id="2540365">opt</span><span class="op" id="2540368">,</span>&nbsp;<span class="ident" id="2540370">unsafe</span><span class="op" id="2540376">.</span><span class="ident" id="2540377">Pointer</span><span class="op" id="2540384">(</span><span class="ident" id="2540385">l</span><span class="op" id="2540386">)</span><span class="op" id="2540387">,</span>&nbsp;<span class="ident" id="2540389">SizeofLinger</span><span class="op" id="2540401">)</span><br>
<span class="lineno"></span><span class="op" id="2540403">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2540406">func</span>&nbsp;<span class="ident" id="2540411">SetsockoptString</span><span class="op" id="2540427">(</span><span class="ident" id="2540428">fd</span><span class="op" id="2540430">,</span>&nbsp;<span class="ident" id="2540432">level</span><span class="op" id="2540437">,</span>&nbsp;<span class="ident" id="2540439">opt</span>&nbsp;<span class="builtintype" id="2540443">int</span><span class="op" id="2540446">,</span>&nbsp;<span class="ident" id="2540448">s</span>&nbsp;<span class="builtintype" id="2540450">string</span><span class="op" id="2540456">)</span>&nbsp;<span class="op" id="2540458">(</span><span class="ident" id="2540459">err</span>&nbsp;<span class="builtintype" id="2540463">error</span><span class="op" id="2540468">)</span>&nbsp;<span class="op" id="2540470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540473">return</span>&nbsp;<span class="ident" id="2540480">setsockopt</span><span class="op" id="2540490">(</span><span class="ident" id="2540491">fd</span><span class="op" id="2540493">,</span>&nbsp;<span class="ident" id="2540495">level</span><span class="op" id="2540500">,</span>&nbsp;<span class="ident" id="2540502">opt</span><span class="op" id="2540505">,</span>&nbsp;<span class="ident" id="2540507">unsafe</span><span class="op" id="2540513">.</span><span class="ident" id="2540514">Pointer</span><span class="op" id="2540521">(</span><span class="op" id="2540522">&amp;</span><span class="op" id="2540523">[</span><span class="op" id="2540524">]</span><span class="builtintype" id="2540525">byte</span><span class="op" id="2540529">(</span><span class="ident" id="2540530">s</span><span class="op" id="2540531">)</span><span class="op" id="2540532">[</span><span class="num" id="2540533">0</span><span class="op" id="2540534">]</span><span class="op" id="2540535">)</span><span class="op" id="2540536">,</span>&nbsp;<span class="builtintype" id="2540538">uintptr</span><span class="op" id="2540545">(</span><span class="builtinfunc" id="2540546">len</span><span class="op" id="2540549">(</span><span class="ident" id="2540550">s</span><span class="op" id="2540551">)</span><span class="op" id="2540552">)</span><span class="op" id="2540553">)</span><br>
<span class="lineno"></span><span class="op" id="2540555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2540558">func</span>&nbsp;<span class="ident" id="2540563">SetsockoptTimeval</span><span class="op" id="2540580">(</span><span class="ident" id="2540581">fd</span><span class="op" id="2540583">,</span>&nbsp;<span class="ident" id="2540585">level</span><span class="op" id="2540590">,</span>&nbsp;<span class="ident" id="2540592">opt</span>&nbsp;<span class="builtintype" id="2540596">int</span><span class="op" id="2540599">,</span>&nbsp;<span class="ident" id="2540601">tv</span>&nbsp;<span class="op" id="2540604">*</span><span class="ident" id="2540605">Timeval</span><span class="op" id="2540612">)</span>&nbsp;<span class="op" id="2540614">(</span><span class="ident" id="2540615">err</span>&nbsp;<span class="builtintype" id="2540619">error</span><span class="op" id="2540624">)</span>&nbsp;<span class="op" id="2540626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540629">return</span>&nbsp;<span class="ident" id="2540636">setsockopt</span><span class="op" id="2540646">(</span><span class="ident" id="2540647">fd</span><span class="op" id="2540649">,</span>&nbsp;<span class="ident" id="2540651">level</span><span class="op" id="2540656">,</span>&nbsp;<span class="ident" id="2540658">opt</span><span class="op" id="2540661">,</span>&nbsp;<span class="ident" id="2540663">unsafe</span><span class="op" id="2540669">.</span><span class="ident" id="2540670">Pointer</span><span class="op" id="2540677">(</span><span class="ident" id="2540678">tv</span><span class="op" id="2540680">)</span><span class="op" id="2540681">,</span>&nbsp;<span class="ident" id="2540683">unsafe</span><span class="op" id="2540689">.</span><span class="ident" id="2540690">Sizeof</span><span class="op" id="2540696">(</span><span class="op" id="2540697">*</span><span class="ident" id="2540698">tv</span><span class="op" id="2540700">)</span><span class="op" id="2540701">)</span><br>
<span class="lineno"></span><span class="op" id="2540703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2540706">func</span>&nbsp;<span class="ident" id="2540711">Socket</span><span class="op" id="2540717">(</span><span class="ident" id="2540718">domain</span><span class="op" id="2540724">,</span>&nbsp;<span class="ident" id="2540726">typ</span><span class="op" id="2540729">,</span>&nbsp;<span class="ident" id="2540731">proto</span>&nbsp;<span class="builtintype" id="2540737">int</span><span class="op" id="2540740">)</span>&nbsp;<span class="op" id="2540742">(</span><span class="ident" id="2540743">fd</span>&nbsp;<span class="builtintype" id="2540746">int</span><span class="op" id="2540749">,</span>&nbsp;<span class="ident" id="2540751">err</span>&nbsp;<span class="builtintype" id="2540755">error</span><span class="op" id="2540760">)</span>&nbsp;<span class="op" id="2540762">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540765">if</span>&nbsp;<span class="ident" id="2540768">domain</span>&nbsp;<span class="op" id="2540775">==</span>&nbsp;<span class="ident" id="2540778">AF_INET6</span>&nbsp;<span class="op" id="2540787">&amp;&amp;</span>&nbsp;<span class="ident" id="2540790">SocketDisableIPv6</span>&nbsp;<span class="op" id="2540808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540812">return</span>&nbsp;<span class="op" id="2540819">-</span><span class="num" id="2540820">1</span><span class="op" id="2540821">,</span>&nbsp;<span class="ident" id="2540823">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2540837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2540840">fd</span><span class="op" id="2540842">,</span>&nbsp;<span class="ident" id="2540844">err</span>&nbsp;<span class="op" id="2540848">=</span>&nbsp;<span class="ident" id="2540850">socket</span><span class="op" id="2540856">(</span><span class="ident" id="2540857">domain</span><span class="op" id="2540863">,</span>&nbsp;<span class="ident" id="2540865">typ</span><span class="op" id="2540868">,</span>&nbsp;<span class="ident" id="2540870">proto</span><span class="op" id="2540875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540878">return</span><br>
<span class="lineno">280</span><span class="op" id="2540885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2540888">func</span>&nbsp;<span class="ident" id="2540893">Socketpair</span><span class="op" id="2540903">(</span><span class="ident" id="2540904">domain</span><span class="op" id="2540910">,</span>&nbsp;<span class="ident" id="2540912">typ</span><span class="op" id="2540915">,</span>&nbsp;<span class="ident" id="2540917">proto</span>&nbsp;<span class="builtintype" id="2540923">int</span><span class="op" id="2540926">)</span>&nbsp;<span class="op" id="2540928">(</span><span class="ident" id="2540929">fd</span>&nbsp;<span class="op" id="2540932">[</span><span class="num" id="2540933">2</span><span class="op" id="2540934">]</span><span class="builtintype" id="2540935">int</span><span class="op" id="2540938">,</span>&nbsp;<span class="ident" id="2540940">err</span>&nbsp;<span class="builtintype" id="2540944">error</span><span class="op" id="2540949">)</span>&nbsp;<span class="op" id="2540951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2540954">var</span>&nbsp;<span class="ident" id="2540958">fdx</span>&nbsp;<span class="op" id="2540962">[</span><span class="num" id="2540963">2</span><span class="op" id="2540964">]</span><span class="builtintype" id="2540965">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2540972">err</span>&nbsp;<span class="op" id="2540976">=</span>&nbsp;<span class="ident" id="2540978">socketpair</span><span class="op" id="2540988">(</span><span class="ident" id="2540989">domain</span><span class="op" id="2540995">,</span>&nbsp;<span class="ident" id="2540997">typ</span><span class="op" id="2541000">,</span>&nbsp;<span class="ident" id="2541002">proto</span><span class="op" id="2541007">,</span>&nbsp;<span class="op" id="2541009">&amp;</span><span class="ident" id="2541010">fdx</span><span class="op" id="2541013">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541016">if</span>&nbsp;<span class="ident" id="2541019">err</span>&nbsp;<span class="op" id="2541023">==</span>&nbsp;<span class="builtintype" id="2541026">nil</span>&nbsp;<span class="op" id="2541030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541034">fd</span><span class="op" id="2541036">[</span><span class="num" id="2541037">0</span><span class="op" id="2541038">]</span>&nbsp;<span class="op" id="2541040">=</span>&nbsp;<span class="builtintype" id="2541042">int</span><span class="op" id="2541045">(</span><span class="ident" id="2541046">fdx</span><span class="op" id="2541049">[</span><span class="num" id="2541050">0</span><span class="op" id="2541051">]</span><span class="op" id="2541052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541056">fd</span><span class="op" id="2541058">[</span><span class="num" id="2541059">1</span><span class="op" id="2541060">]</span>&nbsp;<span class="op" id="2541062">=</span>&nbsp;<span class="builtintype" id="2541064">int</span><span class="op" id="2541067">(</span><span class="ident" id="2541068">fdx</span><span class="op" id="2541071">[</span><span class="num" id="2541072">1</span><span class="op" id="2541073">]</span><span class="op" id="2541074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2541077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541080">return</span><br>
<span class="lineno">290</span><span class="op" id="2541087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2541090">func</span>&nbsp;<span class="ident" id="2541095">Sendfile</span><span class="op" id="2541103">(</span><span class="ident" id="2541104">outfd</span>&nbsp;<span class="builtintype" id="2541110">int</span><span class="op" id="2541113">,</span>&nbsp;<span class="ident" id="2541115">infd</span>&nbsp;<span class="builtintype" id="2541120">int</span><span class="op" id="2541123">,</span>&nbsp;<span class="ident" id="2541125">offset</span>&nbsp;<span class="op" id="2541132">*</span><span class="ident" id="2541133">int64</span><span class="op" id="2541138">,</span>&nbsp;<span class="ident" id="2541140">count</span>&nbsp;<span class="builtintype" id="2541146">int</span><span class="op" id="2541149">)</span>&nbsp;<span class="op" id="2541151">(</span><span class="ident" id="2541152">written</span>&nbsp;<span class="builtintype" id="2541160">int</span><span class="op" id="2541163">,</span>&nbsp;<span class="ident" id="2541165">err</span>&nbsp;<span class="builtintype" id="2541169">error</span><span class="op" id="2541174">)</span>&nbsp;<span class="op" id="2541176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541179">if</span>&nbsp;<span class="ident" id="2541182">raceenabled</span>&nbsp;<span class="op" id="2541194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2541198">raceReleaseMerge</span><span class="op" id="2541214">(</span><span class="ident" id="2541215">unsafe</span><span class="op" id="2541221">.</span><span class="ident" id="2541222">Pointer</span><span class="op" id="2541229">(</span><span class="op" id="2541230">&amp;</span><span class="ident" id="2541231">ioSync</span><span class="op" id="2541237">)</span><span class="op" id="2541238">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2541241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2541244">return</span>&nbsp;<span class="ident" id="2541251">sendfile</span><span class="op" id="2541259">(</span><span class="ident" id="2541260">outfd</span><span class="op" id="2541265">,</span>&nbsp;<span class="ident" id="2541267">infd</span><span class="op" id="2541271">,</span>&nbsp;<span class="ident" id="2541273">offset</span><span class="op" id="2541279">,</span>&nbsp;<span class="ident" id="2541281">count</span><span class="op" id="2541286">)</span><br>
<span class="lineno"></span><span class="op" id="2541288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2541291">var</span>&nbsp;<span class="ident" id="2541295">ioSync</span>&nbsp;<span class="ident" id="2541302">int64</span>
</div>
</body>
</html>
