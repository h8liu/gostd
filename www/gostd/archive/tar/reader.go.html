<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5954211">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5954266">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5954320">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5954371">package</span>&nbsp;<span class="ident" id="5954379">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954384">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5954403">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5954426">import</span>&nbsp;<span class="op" id="5954433">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954436">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954445">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954455">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954461">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954474">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954480">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954491">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5954502">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5954509">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5954512">var</span>&nbsp;<span class="op" id="5954516">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954519">ErrHeader</span>&nbsp;<span class="op" id="5954529">=</span>&nbsp;<span class="ident" id="5954531">errors</span><span class="op" id="5954537">.</span><span class="ident" id="5954538">New</span><span class="op" id="5954541">(</span><span class="string" id="5954542">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5954575">)</span><br>
<span class="lineno"></span><span class="op" id="5954577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5954580">const</span>&nbsp;<span class="ident" id="5954586">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5954607">=</span>&nbsp;<span class="num" id="5954609">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954612">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5954685">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5954735">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5954818">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5954891">type</span>&nbsp;<span class="ident" id="5954896">Reader</span>&nbsp;<span class="keyword" id="5954903">struct</span>&nbsp;<span class="op" id="5954910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954913">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954921">io</span><span class="op" id="5954923">.</span><span class="ident" id="5954924">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954932">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5954940">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954947">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5954955">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954971">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955028">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955036">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5955052">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955086">hdrBuff</span>&nbsp;<span class="op" id="5955094">[</span><span class="ident" id="5955095">blockSize</span><span class="op" id="5955104">]</span><span class="builtintype" id="5955105">byte</span>&nbsp;<span class="comment" id="5955110">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5955141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5955144">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5955225">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5955279">type</span>&nbsp;<span class="ident" id="5955284">numBytesReader</span>&nbsp;<span class="keyword" id="5955299">interface</span>&nbsp;<span class="op" id="5955309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955312">io</span><span class="op" id="5955314">.</span><span class="ident" id="5955315">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955323">numBytes</span><span class="op" id="5955331">(</span><span class="op" id="5955332">)</span>&nbsp;<span class="builtintype" id="5955334">int64</span><br>
<span class="lineno"></span><span class="op" id="5955340">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5955343">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5955424">type</span>&nbsp;<span class="ident" id="5955429">regFileReader</span>&nbsp;<span class="keyword" id="5955443">struct</span>&nbsp;<span class="op" id="5955450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955453">r</span>&nbsp;&nbsp;<span class="ident" id="5955456">io</span><span class="op" id="5955458">.</span><span class="ident" id="5955459">Reader</span>&nbsp;<span class="comment" id="5955466">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955488">nb</span>&nbsp;<span class="builtintype" id="5955491">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955501">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5955550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5955553">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5955644">type</span>&nbsp;<span class="ident" id="5955649">sparseFileReader</span>&nbsp;<span class="keyword" id="5955666">struct</span>&nbsp;<span class="op" id="5955673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955676">rfr</span>&nbsp;<span class="op" id="5955680">*</span><span class="ident" id="5955681">regFileReader</span>&nbsp;<span class="comment" id="5955695">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955734">sp</span>&nbsp;&nbsp;<span class="op" id="5955738">[</span><span class="op" id="5955739">]</span><span class="ident" id="5955740">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5955753">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955785">pos</span>&nbsp;<span class="builtintype" id="5955789">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955804">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955837">tot</span>&nbsp;<span class="builtintype" id="5955841">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955856">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5955882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5955885">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5955943">const</span>&nbsp;<span class="op" id="5955949">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955952">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5955974">=</span>&nbsp;<span class="string" id="5955976">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956000">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956022">=</span>&nbsp;<span class="string" id="5956024">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956045">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5956067">=</span>&nbsp;<span class="string" id="5956069">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956092">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956114">=</span>&nbsp;<span class="string" id="5956116">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956134">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956156">=</span>&nbsp;<span class="string" id="5956158">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956177">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956199">=</span>&nbsp;<span class="string" id="5956201">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956221">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956243">=</span>&nbsp;<span class="string" id="5956245">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956265">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956287">=</span>&nbsp;<span class="string" id="5956289">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956308">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5956330">=</span>&nbsp;<span class="string" id="5956332">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5956354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956357">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5956396">const</span>&nbsp;<span class="op" id="5956402">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956405">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956448">=</span>&nbsp;<span class="num" id="5956450">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956455">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956498">=</span>&nbsp;<span class="num" id="5956500">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956505">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956548">=</span>&nbsp;<span class="num" id="5956550">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956553">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5956596">=</span>&nbsp;<span class="num" id="5956598">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956603">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956646">=</span>&nbsp;<span class="num" id="5956648">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956652">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956695">=</span>&nbsp;<span class="num" id="5956697">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956701">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956744">=</span>&nbsp;<span class="num" id="5956746">12</span><br>
<span class="lineno"></span><span class="op" id="5956749">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956752">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5956802">func</span>&nbsp;<span class="ident" id="5956807">NewReader</span><span class="op" id="5956816">(</span><span class="ident" id="5956817">r</span>&nbsp;<span class="ident" id="5956819">io</span><span class="op" id="5956821">.</span><span class="ident" id="5956822">Reader</span><span class="op" id="5956828">)</span>&nbsp;<span class="op" id="5956830">*</span><span class="ident" id="5956831">Reader</span>&nbsp;<span class="op" id="5956838">{</span>&nbsp;<span class="keyword" id="5956840">return</span>&nbsp;<span class="op" id="5956847">&amp;</span><span class="ident" id="5956848">Reader</span><span class="op" id="5956854">{</span><span class="ident" id="5956855">r</span><span class="op" id="5956856">:</span>&nbsp;<span class="ident" id="5956858">r</span><span class="op" id="5956859">}</span>&nbsp;<span class="op" id="5956861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956864">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5956919">func</span>&nbsp;<span class="op" id="5956924">(</span><span class="ident" id="5956925">tr</span>&nbsp;<span class="op" id="5956928">*</span><span class="ident" id="5956929">Reader</span><span class="op" id="5956935">)</span>&nbsp;<span class="ident" id="5956937">Next</span><span class="op" id="5956941">(</span><span class="op" id="5956942">)</span>&nbsp;<span class="op" id="5956944">(</span><span class="op" id="5956945">*</span><span class="ident" id="5956946">Header</span><span class="op" id="5956952">,</span>&nbsp;<span class="builtintype" id="5956954">error</span><span class="op" id="5956959">)</span>&nbsp;<span class="op" id="5956961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956964">var</span>&nbsp;<span class="ident" id="5956968">hdr</span>&nbsp;<span class="op" id="5956972">*</span><span class="ident" id="5956973">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956981">if</span>&nbsp;<span class="ident" id="5956984">tr</span><span class="op" id="5956986">.</span><span class="ident" id="5956987">err</span>&nbsp;<span class="op" id="5956991">==</span>&nbsp;<span class="builtintype" id="5956994">nil</span>&nbsp;<span class="op" id="5956998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957002">tr</span><span class="op" id="5957004">.</span><span class="ident" id="5957005">skipUnread</span><span class="op" id="5957015">(</span><span class="op" id="5957016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957022">if</span>&nbsp;<span class="ident" id="5957025">tr</span><span class="op" id="5957027">.</span><span class="ident" id="5957028">err</span>&nbsp;<span class="op" id="5957032">!=</span>&nbsp;<span class="builtintype" id="5957035">nil</span>&nbsp;<span class="op" id="5957039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957043">return</span>&nbsp;<span class="ident" id="5957050">hdr</span><span class="op" id="5957053">,</span>&nbsp;<span class="ident" id="5957055">tr</span><span class="op" id="5957057">.</span><span class="ident" id="5957058">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957066">hdr</span>&nbsp;<span class="op" id="5957070">=</span>&nbsp;<span class="ident" id="5957072">tr</span><span class="op" id="5957074">.</span><span class="ident" id="5957075">readHeader</span><span class="op" id="5957085">(</span><span class="op" id="5957086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957089">if</span>&nbsp;<span class="ident" id="5957092">hdr</span>&nbsp;<span class="op" id="5957096">==</span>&nbsp;<span class="builtintype" id="5957099">nil</span>&nbsp;<span class="op" id="5957103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957107">return</span>&nbsp;<span class="ident" id="5957114">hdr</span><span class="op" id="5957117">,</span>&nbsp;<span class="ident" id="5957119">tr</span><span class="op" id="5957121">.</span><span class="ident" id="5957122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957127">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957130">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957160">switch</span>&nbsp;<span class="ident" id="5957167">hdr</span><span class="op" id="5957170">.</span><span class="ident" id="5957171">Typeflag</span>&nbsp;<span class="op" id="5957180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957183">case</span>&nbsp;<span class="ident" id="5957188">TypeXHeader</span><span class="op" id="5957199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957203">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957229">headers</span><span class="op" id="5957236">,</span>&nbsp;<span class="ident" id="5957238">err</span>&nbsp;<span class="op" id="5957242">:=</span>&nbsp;<span class="ident" id="5957245">parsePAX</span><span class="op" id="5957253">(</span><span class="ident" id="5957254">tr</span><span class="op" id="5957256">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957260">if</span>&nbsp;<span class="ident" id="5957263">err</span>&nbsp;<span class="op" id="5957267">!=</span>&nbsp;<span class="builtintype" id="5957270">nil</span>&nbsp;<span class="op" id="5957274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957279">return</span>&nbsp;<span class="builtintype" id="5957286">nil</span><span class="op" id="5957289">,</span>&nbsp;<span class="ident" id="5957291">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957301">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957339">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957377">tr</span><span class="op" id="5957379">.</span><span class="ident" id="5957380">skipUnread</span><span class="op" id="5957390">(</span><span class="op" id="5957391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957395">hdr</span>&nbsp;<span class="op" id="5957399">=</span>&nbsp;<span class="ident" id="5957401">tr</span><span class="op" id="5957403">.</span><span class="ident" id="5957404">readHeader</span><span class="op" id="5957414">(</span><span class="op" id="5957415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957419">mergePAX</span><span class="op" id="5957427">(</span><span class="ident" id="5957428">hdr</span><span class="op" id="5957431">,</span>&nbsp;<span class="ident" id="5957433">headers</span><span class="op" id="5957440">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957445">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957485">sp</span><span class="op" id="5957487">,</span>&nbsp;<span class="ident" id="5957489">err</span>&nbsp;<span class="op" id="5957493">:=</span>&nbsp;<span class="ident" id="5957496">tr</span><span class="op" id="5957498">.</span><span class="ident" id="5957499">checkForGNUSparsePAXHeaders</span><span class="op" id="5957526">(</span><span class="ident" id="5957527">hdr</span><span class="op" id="5957530">,</span>&nbsp;<span class="ident" id="5957532">headers</span><span class="op" id="5957539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957543">if</span>&nbsp;<span class="ident" id="5957546">err</span>&nbsp;<span class="op" id="5957550">!=</span>&nbsp;<span class="builtintype" id="5957553">nil</span>&nbsp;<span class="op" id="5957557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957562">tr</span><span class="op" id="5957564">.</span><span class="ident" id="5957565">err</span>&nbsp;<span class="op" id="5957569">=</span>&nbsp;<span class="ident" id="5957571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957578">return</span>&nbsp;<span class="builtintype" id="5957585">nil</span><span class="op" id="5957588">,</span>&nbsp;<span class="ident" id="5957590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957596">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957600">if</span>&nbsp;<span class="ident" id="5957603">sp</span>&nbsp;<span class="op" id="5957606">!=</span>&nbsp;<span class="builtintype" id="5957609">nil</span>&nbsp;<span class="op" id="5957613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957618">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957670">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957729">tr</span><span class="op" id="5957731">.</span><span class="ident" id="5957732">curr</span>&nbsp;<span class="op" id="5957737">=</span>&nbsp;<span class="op" id="5957739">&amp;</span><span class="ident" id="5957740">sparseFileReader</span><span class="op" id="5957756">{</span><span class="ident" id="5957757">rfr</span><span class="op" id="5957760">:</span>&nbsp;<span class="ident" id="5957762">tr</span><span class="op" id="5957764">.</span><span class="ident" id="5957765">curr</span><span class="op" id="5957769">.</span><span class="op" id="5957770">(</span><span class="op" id="5957771">*</span><span class="ident" id="5957772">regFileReader</span><span class="op" id="5957785">)</span><span class="op" id="5957786">,</span>&nbsp;<span class="ident" id="5957788">sp</span><span class="op" id="5957790">:</span>&nbsp;<span class="ident" id="5957792">sp</span><span class="op" id="5957794">,</span>&nbsp;<span class="ident" id="5957796">tot</span><span class="op" id="5957799">:</span>&nbsp;<span class="ident" id="5957801">hdr</span><span class="op" id="5957804">.</span><span class="ident" id="5957805">Size</span><span class="op" id="5957809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957813">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957817">return</span>&nbsp;<span class="ident" id="5957824">hdr</span><span class="op" id="5957827">,</span>&nbsp;<span class="builtintype" id="5957829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957834">case</span>&nbsp;<span class="ident" id="5957839">TypeGNULongName</span><span class="op" id="5957854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957858">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957932">realname</span><span class="op" id="5957940">,</span>&nbsp;<span class="ident" id="5957942">err</span>&nbsp;<span class="op" id="5957946">:=</span>&nbsp;<span class="ident" id="5957949">ioutil</span><span class="op" id="5957955">.</span><span class="ident" id="5957956">ReadAll</span><span class="op" id="5957963">(</span><span class="ident" id="5957964">tr</span><span class="op" id="5957966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957970">if</span>&nbsp;<span class="ident" id="5957973">err</span>&nbsp;<span class="op" id="5957977">!=</span>&nbsp;<span class="builtintype" id="5957980">nil</span>&nbsp;<span class="op" id="5957984">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957989">return</span>&nbsp;<span class="builtintype" id="5957996">nil</span><span class="op" id="5957999">,</span>&nbsp;<span class="ident" id="5958001">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958011">hdr</span><span class="op" id="5958014">,</span>&nbsp;<span class="ident" id="5958016">err</span>&nbsp;<span class="op" id="5958020">:=</span>&nbsp;<span class="ident" id="5958023">tr</span><span class="op" id="5958025">.</span><span class="ident" id="5958026">Next</span><span class="op" id="5958030">(</span><span class="op" id="5958031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958035">hdr</span><span class="op" id="5958038">.</span><span class="ident" id="5958039">Name</span>&nbsp;<span class="op" id="5958044">=</span>&nbsp;<span class="ident" id="5958046">cString</span><span class="op" id="5958053">(</span><span class="ident" id="5958054">realname</span><span class="op" id="5958062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958066">return</span>&nbsp;<span class="ident" id="5958073">hdr</span><span class="op" id="5958076">,</span>&nbsp;<span class="ident" id="5958078">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958083">case</span>&nbsp;<span class="ident" id="5958088">TypeGNULongLink</span><span class="op" id="5958103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958107">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958144">realname</span><span class="op" id="5958152">,</span>&nbsp;<span class="ident" id="5958154">err</span>&nbsp;<span class="op" id="5958158">:=</span>&nbsp;<span class="ident" id="5958161">ioutil</span><span class="op" id="5958167">.</span><span class="ident" id="5958168">ReadAll</span><span class="op" id="5958175">(</span><span class="ident" id="5958176">tr</span><span class="op" id="5958178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958182">if</span>&nbsp;<span class="ident" id="5958185">err</span>&nbsp;<span class="op" id="5958189">!=</span>&nbsp;<span class="builtintype" id="5958192">nil</span>&nbsp;<span class="op" id="5958196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958201">return</span>&nbsp;<span class="builtintype" id="5958208">nil</span><span class="op" id="5958211">,</span>&nbsp;<span class="ident" id="5958213">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958223">hdr</span><span class="op" id="5958226">,</span>&nbsp;<span class="ident" id="5958228">err</span>&nbsp;<span class="op" id="5958232">:=</span>&nbsp;<span class="ident" id="5958235">tr</span><span class="op" id="5958237">.</span><span class="ident" id="5958238">Next</span><span class="op" id="5958242">(</span><span class="op" id="5958243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958247">hdr</span><span class="op" id="5958250">.</span><span class="ident" id="5958251">Linkname</span>&nbsp;<span class="op" id="5958260">=</span>&nbsp;<span class="ident" id="5958262">cString</span><span class="op" id="5958269">(</span><span class="ident" id="5958270">realname</span><span class="op" id="5958278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958282">return</span>&nbsp;<span class="ident" id="5958289">hdr</span><span class="op" id="5958292">,</span>&nbsp;<span class="ident" id="5958294">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958299">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958302">return</span>&nbsp;<span class="ident" id="5958309">hdr</span><span class="op" id="5958312">,</span>&nbsp;<span class="ident" id="5958314">tr</span><span class="op" id="5958316">.</span><span class="ident" id="5958317">err</span><br>
<span class="lineno"></span><span class="op" id="5958321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5958324">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5958426">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5958536">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5958569">func</span>&nbsp;<span class="op" id="5958574">(</span><span class="ident" id="5958575">tr</span>&nbsp;<span class="op" id="5958578">*</span><span class="ident" id="5958579">Reader</span><span class="op" id="5958585">)</span>&nbsp;<span class="ident" id="5958587">checkForGNUSparsePAXHeaders</span><span class="op" id="5958614">(</span><span class="ident" id="5958615">hdr</span>&nbsp;<span class="op" id="5958619">*</span><span class="ident" id="5958620">Header</span><span class="op" id="5958626">,</span>&nbsp;<span class="ident" id="5958628">headers</span>&nbsp;<span class="keyword" id="5958636">map</span><span class="op" id="5958639">[</span><span class="builtintype" id="5958640">string</span><span class="op" id="5958646">]</span><span class="builtintype" id="5958647">string</span><span class="op" id="5958653">)</span>&nbsp;<span class="op" id="5958655">(</span><span class="op" id="5958656">[</span><span class="op" id="5958657">]</span><span class="ident" id="5958658">sparseEntry</span><span class="op" id="5958669">,</span>&nbsp;<span class="builtintype" id="5958671">error</span><span class="op" id="5958676">)</span>&nbsp;<span class="op" id="5958678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958681">var</span>&nbsp;<span class="ident" id="5958685">sparseFormat</span>&nbsp;<span class="builtintype" id="5958698">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958707">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958746">major</span><span class="op" id="5958751">,</span>&nbsp;<span class="ident" id="5958753">majorOk</span>&nbsp;<span class="op" id="5958761">:=</span>&nbsp;<span class="ident" id="5958764">headers</span><span class="op" id="5958771">[</span><span class="ident" id="5958772">paxGNUSparseMajor</span><span class="op" id="5958789">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958792">minor</span><span class="op" id="5958797">,</span>&nbsp;<span class="ident" id="5958799">minorOk</span>&nbsp;<span class="op" id="5958807">:=</span>&nbsp;<span class="ident" id="5958810">headers</span><span class="op" id="5958817">[</span><span class="ident" id="5958818">paxGNUSparseMinor</span><span class="op" id="5958835">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958838">sparseName</span><span class="op" id="5958848">,</span>&nbsp;<span class="ident" id="5958850">sparseNameOk</span>&nbsp;<span class="op" id="5958863">:=</span>&nbsp;<span class="ident" id="5958866">headers</span><span class="op" id="5958873">[</span><span class="ident" id="5958874">paxGNUSparseName</span><span class="op" id="5958890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958893">_</span><span class="op" id="5958894">,</span>&nbsp;<span class="ident" id="5958896">sparseMapOk</span>&nbsp;<span class="op" id="5958908">:=</span>&nbsp;<span class="ident" id="5958911">headers</span><span class="op" id="5958918">[</span><span class="ident" id="5958919">paxGNUSparseMap</span><span class="op" id="5958934">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958937">sparseSize</span><span class="op" id="5958947">,</span>&nbsp;<span class="ident" id="5958949">sparseSizeOk</span>&nbsp;<span class="op" id="5958962">:=</span>&nbsp;<span class="ident" id="5958965">headers</span><span class="op" id="5958972">[</span><span class="ident" id="5958973">paxGNUSparseSize</span><span class="op" id="5958989">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958992">sparseRealSize</span><span class="op" id="5959006">,</span>&nbsp;<span class="ident" id="5959008">sparseRealSizeOk</span>&nbsp;<span class="op" id="5959025">:=</span>&nbsp;<span class="ident" id="5959028">headers</span><span class="op" id="5959035">[</span><span class="ident" id="5959036">paxGNUSparseRealSize</span><span class="op" id="5959056">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959060">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959141">if</span>&nbsp;<span class="ident" id="5959144">majorOk</span>&nbsp;<span class="op" id="5959152">&amp;&amp;</span>&nbsp;<span class="ident" id="5959155">minorOk</span>&nbsp;<span class="op" id="5959163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959167">sparseFormat</span>&nbsp;<span class="op" id="5959180">=</span>&nbsp;<span class="ident" id="5959182">major</span>&nbsp;<span class="op" id="5959188">+</span>&nbsp;<span class="string" id="5959190">&#34;.&#34;</span>&nbsp;<span class="op" id="5959194">+</span>&nbsp;<span class="ident" id="5959196">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959203">}</span>&nbsp;<span class="keyword" id="5959205">else</span>&nbsp;<span class="keyword" id="5959210">if</span>&nbsp;<span class="ident" id="5959213">sparseNameOk</span>&nbsp;<span class="op" id="5959226">&amp;&amp;</span>&nbsp;<span class="ident" id="5959229">sparseMapOk</span>&nbsp;<span class="op" id="5959241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959245">sparseFormat</span>&nbsp;<span class="op" id="5959258">=</span>&nbsp;<span class="string" id="5959260">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959267">}</span>&nbsp;<span class="keyword" id="5959269">else</span>&nbsp;<span class="keyword" id="5959274">if</span>&nbsp;<span class="ident" id="5959277">sparseSizeOk</span>&nbsp;<span class="op" id="5959290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959294">sparseFormat</span>&nbsp;<span class="op" id="5959307">=</span>&nbsp;<span class="string" id="5959309">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959316">}</span>&nbsp;<span class="keyword" id="5959318">else</span>&nbsp;<span class="op" id="5959323">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959327">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959366">return</span>&nbsp;<span class="builtintype" id="5959373">nil</span><span class="op" id="5959376">,</span>&nbsp;<span class="builtintype" id="5959378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959387">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959423">if</span>&nbsp;<span class="ident" id="5959426">sparseFormat</span>&nbsp;<span class="op" id="5959439">!=</span>&nbsp;<span class="string" id="5959442">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5959448">&amp;&amp;</span>&nbsp;<span class="ident" id="5959451">sparseFormat</span>&nbsp;<span class="op" id="5959464">!=</span>&nbsp;<span class="string" id="5959467">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5959473">&amp;&amp;</span>&nbsp;<span class="ident" id="5959476">sparseFormat</span>&nbsp;<span class="op" id="5959489">!=</span>&nbsp;<span class="string" id="5959492">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5959498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959502">return</span>&nbsp;<span class="builtintype" id="5959509">nil</span><span class="op" id="5959512">,</span>&nbsp;<span class="builtintype" id="5959514">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959523">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959566">if</span>&nbsp;<span class="ident" id="5959569">sparseNameOk</span>&nbsp;<span class="op" id="5959582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959586">hdr</span><span class="op" id="5959589">.</span><span class="ident" id="5959590">Name</span>&nbsp;<span class="op" id="5959595">=</span>&nbsp;<span class="ident" id="5959597">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959612">if</span>&nbsp;<span class="ident" id="5959615">sparseSizeOk</span>&nbsp;<span class="op" id="5959628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959632">realSize</span><span class="op" id="5959640">,</span>&nbsp;<span class="ident" id="5959642">err</span>&nbsp;<span class="op" id="5959646">:=</span>&nbsp;<span class="ident" id="5959649">strconv</span><span class="op" id="5959656">.</span><span class="ident" id="5959657">ParseInt</span><span class="op" id="5959665">(</span><span class="ident" id="5959666">sparseSize</span><span class="op" id="5959676">,</span>&nbsp;<span class="num" id="5959678">10</span><span class="op" id="5959680">,</span>&nbsp;<span class="num" id="5959682">0</span><span class="op" id="5959683">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959687">if</span>&nbsp;<span class="ident" id="5959690">err</span>&nbsp;<span class="op" id="5959694">!=</span>&nbsp;<span class="builtintype" id="5959697">nil</span>&nbsp;<span class="op" id="5959701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959706">return</span>&nbsp;<span class="builtintype" id="5959713">nil</span><span class="op" id="5959716">,</span>&nbsp;<span class="ident" id="5959718">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959734">hdr</span><span class="op" id="5959737">.</span><span class="ident" id="5959738">Size</span>&nbsp;<span class="op" id="5959743">=</span>&nbsp;<span class="ident" id="5959745">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959755">}</span>&nbsp;<span class="keyword" id="5959757">else</span>&nbsp;<span class="keyword" id="5959762">if</span>&nbsp;<span class="ident" id="5959765">sparseRealSizeOk</span>&nbsp;<span class="op" id="5959782">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959786">realSize</span><span class="op" id="5959794">,</span>&nbsp;<span class="ident" id="5959796">err</span>&nbsp;<span class="op" id="5959800">:=</span>&nbsp;<span class="ident" id="5959803">strconv</span><span class="op" id="5959810">.</span><span class="ident" id="5959811">ParseInt</span><span class="op" id="5959819">(</span><span class="ident" id="5959820">sparseRealSize</span><span class="op" id="5959834">,</span>&nbsp;<span class="num" id="5959836">10</span><span class="op" id="5959838">,</span>&nbsp;<span class="num" id="5959840">0</span><span class="op" id="5959841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959845">if</span>&nbsp;<span class="ident" id="5959848">err</span>&nbsp;<span class="op" id="5959852">!=</span>&nbsp;<span class="builtintype" id="5959855">nil</span>&nbsp;<span class="op" id="5959859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959864">return</span>&nbsp;<span class="builtintype" id="5959871">nil</span><span class="op" id="5959874">,</span>&nbsp;<span class="ident" id="5959876">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959892">hdr</span><span class="op" id="5959895">.</span><span class="ident" id="5959896">Size</span>&nbsp;<span class="op" id="5959901">=</span>&nbsp;<span class="ident" id="5959903">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959917">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959993">var</span>&nbsp;<span class="ident" id="5959997">sp</span>&nbsp;<span class="op" id="5960000">[</span><span class="op" id="5960001">]</span><span class="ident" id="5960002">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960015">var</span>&nbsp;<span class="ident" id="5960019">err</span>&nbsp;<span class="builtintype" id="5960023">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960030">switch</span>&nbsp;<span class="ident" id="5960037">sparseFormat</span>&nbsp;<span class="op" id="5960050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960053">case</span>&nbsp;<span class="string" id="5960058">&#34;0.0&#34;</span><span class="op" id="5960063">,</span>&nbsp;<span class="string" id="5960065">&#34;0.1&#34;</span><span class="op" id="5960070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960074">sp</span><span class="op" id="5960076">,</span>&nbsp;<span class="ident" id="5960078">err</span>&nbsp;<span class="op" id="5960082">=</span>&nbsp;<span class="ident" id="5960084">readGNUSparseMap0x1</span><span class="op" id="5960103">(</span><span class="ident" id="5960104">headers</span><span class="op" id="5960111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960114">case</span>&nbsp;<span class="string" id="5960119">&#34;1.0&#34;</span><span class="op" id="5960124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960128">sp</span><span class="op" id="5960130">,</span>&nbsp;<span class="ident" id="5960132">err</span>&nbsp;<span class="op" id="5960136">=</span>&nbsp;<span class="ident" id="5960138">readGNUSparseMap1x0</span><span class="op" id="5960157">(</span><span class="ident" id="5960158">tr</span><span class="op" id="5960160">.</span><span class="ident" id="5960161">curr</span><span class="op" id="5960165">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960171">return</span>&nbsp;<span class="ident" id="5960178">sp</span><span class="op" id="5960180">,</span>&nbsp;<span class="ident" id="5960182">err</span><br>
<span class="lineno"></span><span class="op" id="5960186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5960189">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5960254">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5960310">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5960370">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5960432">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5960465">func</span>&nbsp;<span class="ident" id="5960470">mergePAX</span><span class="op" id="5960478">(</span><span class="ident" id="5960479">hdr</span>&nbsp;<span class="op" id="5960483">*</span><span class="ident" id="5960484">Header</span><span class="op" id="5960490">,</span>&nbsp;<span class="ident" id="5960492">headers</span>&nbsp;<span class="keyword" id="5960500">map</span><span class="op" id="5960503">[</span><span class="builtintype" id="5960504">string</span><span class="op" id="5960510">]</span><span class="builtintype" id="5960511">string</span><span class="op" id="5960517">)</span>&nbsp;<span class="builtintype" id="5960519">error</span>&nbsp;<span class="op" id="5960525">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960528">for</span>&nbsp;<span class="ident" id="5960532">k</span><span class="op" id="5960533">,</span>&nbsp;<span class="ident" id="5960535">v</span>&nbsp;<span class="op" id="5960537">:=</span>&nbsp;<span class="keyword" id="5960540">range</span>&nbsp;<span class="ident" id="5960546">headers</span>&nbsp;<span class="op" id="5960554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960558">switch</span>&nbsp;<span class="ident" id="5960565">k</span>&nbsp;<span class="op" id="5960567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960571">case</span>&nbsp;<span class="ident" id="5960576">paxPath</span><span class="op" id="5960583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960588">hdr</span><span class="op" id="5960591">.</span><span class="ident" id="5960592">Name</span>&nbsp;<span class="op" id="5960597">=</span>&nbsp;<span class="ident" id="5960599">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960603">case</span>&nbsp;<span class="ident" id="5960608">paxLinkpath</span><span class="op" id="5960619">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960624">hdr</span><span class="op" id="5960627">.</span><span class="ident" id="5960628">Linkname</span>&nbsp;<span class="op" id="5960637">=</span>&nbsp;<span class="ident" id="5960639">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960643">case</span>&nbsp;<span class="ident" id="5960648">paxGname</span><span class="op" id="5960656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960661">hdr</span><span class="op" id="5960664">.</span><span class="ident" id="5960665">Gname</span>&nbsp;<span class="op" id="5960671">=</span>&nbsp;<span class="ident" id="5960673">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960677">case</span>&nbsp;<span class="ident" id="5960682">paxUname</span><span class="op" id="5960690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960695">hdr</span><span class="op" id="5960698">.</span><span class="ident" id="5960699">Uname</span>&nbsp;<span class="op" id="5960705">=</span>&nbsp;<span class="ident" id="5960707">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960711">case</span>&nbsp;<span class="ident" id="5960716">paxUid</span><span class="op" id="5960722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960727">uid</span><span class="op" id="5960730">,</span>&nbsp;<span class="ident" id="5960732">err</span>&nbsp;<span class="op" id="5960736">:=</span>&nbsp;<span class="ident" id="5960739">strconv</span><span class="op" id="5960746">.</span><span class="ident" id="5960747">ParseInt</span><span class="op" id="5960755">(</span><span class="ident" id="5960756">v</span><span class="op" id="5960757">,</span>&nbsp;<span class="num" id="5960759">10</span><span class="op" id="5960761">,</span>&nbsp;<span class="num" id="5960763">0</span><span class="op" id="5960764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960769">if</span>&nbsp;<span class="ident" id="5960772">err</span>&nbsp;<span class="op" id="5960776">!=</span>&nbsp;<span class="builtintype" id="5960779">nil</span>&nbsp;<span class="op" id="5960783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960789">return</span>&nbsp;<span class="ident" id="5960796">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960803">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960808">hdr</span><span class="op" id="5960811">.</span><span class="ident" id="5960812">Uid</span>&nbsp;<span class="op" id="5960816">=</span>&nbsp;<span class="builtintype" id="5960818">int</span><span class="op" id="5960821">(</span><span class="ident" id="5960822">uid</span><span class="op" id="5960825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960829">case</span>&nbsp;<span class="ident" id="5960834">paxGid</span><span class="op" id="5960840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960845">gid</span><span class="op" id="5960848">,</span>&nbsp;<span class="ident" id="5960850">err</span>&nbsp;<span class="op" id="5960854">:=</span>&nbsp;<span class="ident" id="5960857">strconv</span><span class="op" id="5960864">.</span><span class="ident" id="5960865">ParseInt</span><span class="op" id="5960873">(</span><span class="ident" id="5960874">v</span><span class="op" id="5960875">,</span>&nbsp;<span class="num" id="5960877">10</span><span class="op" id="5960879">,</span>&nbsp;<span class="num" id="5960881">0</span><span class="op" id="5960882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960887">if</span>&nbsp;<span class="ident" id="5960890">err</span>&nbsp;<span class="op" id="5960894">!=</span>&nbsp;<span class="builtintype" id="5960897">nil</span>&nbsp;<span class="op" id="5960901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960907">return</span>&nbsp;<span class="ident" id="5960914">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960926">hdr</span><span class="op" id="5960929">.</span><span class="ident" id="5960930">Gid</span>&nbsp;<span class="op" id="5960934">=</span>&nbsp;<span class="builtintype" id="5960936">int</span><span class="op" id="5960939">(</span><span class="ident" id="5960940">gid</span><span class="op" id="5960943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960947">case</span>&nbsp;<span class="ident" id="5960952">paxAtime</span><span class="op" id="5960960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960965">t</span><span class="op" id="5960966">,</span>&nbsp;<span class="ident" id="5960968">err</span>&nbsp;<span class="op" id="5960972">:=</span>&nbsp;<span class="ident" id="5960975">parsePAXTime</span><span class="op" id="5960987">(</span><span class="ident" id="5960988">v</span><span class="op" id="5960989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960994">if</span>&nbsp;<span class="ident" id="5960997">err</span>&nbsp;<span class="op" id="5961001">!=</span>&nbsp;<span class="builtintype" id="5961004">nil</span>&nbsp;<span class="op" id="5961008">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961014">return</span>&nbsp;<span class="ident" id="5961021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961033">hdr</span><span class="op" id="5961036">.</span><span class="ident" id="5961037">AccessTime</span>&nbsp;<span class="op" id="5961048">=</span>&nbsp;<span class="ident" id="5961050">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961054">case</span>&nbsp;<span class="ident" id="5961059">paxMtime</span><span class="op" id="5961067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961072">t</span><span class="op" id="5961073">,</span>&nbsp;<span class="ident" id="5961075">err</span>&nbsp;<span class="op" id="5961079">:=</span>&nbsp;<span class="ident" id="5961082">parsePAXTime</span><span class="op" id="5961094">(</span><span class="ident" id="5961095">v</span><span class="op" id="5961096">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961101">if</span>&nbsp;<span class="ident" id="5961104">err</span>&nbsp;<span class="op" id="5961108">!=</span>&nbsp;<span class="builtintype" id="5961111">nil</span>&nbsp;<span class="op" id="5961115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961121">return</span>&nbsp;<span class="ident" id="5961128">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961140">hdr</span><span class="op" id="5961143">.</span><span class="ident" id="5961144">ModTime</span>&nbsp;<span class="op" id="5961152">=</span>&nbsp;<span class="ident" id="5961154">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961158">case</span>&nbsp;<span class="ident" id="5961163">paxCtime</span><span class="op" id="5961171">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961176">t</span><span class="op" id="5961177">,</span>&nbsp;<span class="ident" id="5961179">err</span>&nbsp;<span class="op" id="5961183">:=</span>&nbsp;<span class="ident" id="5961186">parsePAXTime</span><span class="op" id="5961198">(</span><span class="ident" id="5961199">v</span><span class="op" id="5961200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961205">if</span>&nbsp;<span class="ident" id="5961208">err</span>&nbsp;<span class="op" id="5961212">!=</span>&nbsp;<span class="builtintype" id="5961215">nil</span>&nbsp;<span class="op" id="5961219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961225">return</span>&nbsp;<span class="ident" id="5961232">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961244">hdr</span><span class="op" id="5961247">.</span><span class="ident" id="5961248">ChangeTime</span>&nbsp;<span class="op" id="5961259">=</span>&nbsp;<span class="ident" id="5961261">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961265">case</span>&nbsp;<span class="ident" id="5961270">paxSize</span><span class="op" id="5961277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961282">size</span><span class="op" id="5961286">,</span>&nbsp;<span class="ident" id="5961288">err</span>&nbsp;<span class="op" id="5961292">:=</span>&nbsp;<span class="ident" id="5961295">strconv</span><span class="op" id="5961302">.</span><span class="ident" id="5961303">ParseInt</span><span class="op" id="5961311">(</span><span class="ident" id="5961312">v</span><span class="op" id="5961313">,</span>&nbsp;<span class="num" id="5961315">10</span><span class="op" id="5961317">,</span>&nbsp;<span class="num" id="5961319">0</span><span class="op" id="5961320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961325">if</span>&nbsp;<span class="ident" id="5961328">err</span>&nbsp;<span class="op" id="5961332">!=</span>&nbsp;<span class="builtintype" id="5961335">nil</span>&nbsp;<span class="op" id="5961339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961345">return</span>&nbsp;<span class="ident" id="5961352">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961359">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961364">hdr</span><span class="op" id="5961367">.</span><span class="ident" id="5961368">Size</span>&nbsp;<span class="op" id="5961373">=</span>&nbsp;<span class="builtintype" id="5961375">int64</span><span class="op" id="5961380">(</span><span class="ident" id="5961381">size</span><span class="op" id="5961385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961389">default</span><span class="op" id="5961396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961401">if</span>&nbsp;<span class="ident" id="5961404">strings</span><span class="op" id="5961411">.</span><span class="ident" id="5961412">HasPrefix</span><span class="op" id="5961421">(</span><span class="ident" id="5961422">k</span><span class="op" id="5961423">,</span>&nbsp;<span class="ident" id="5961425">paxXattr</span><span class="op" id="5961433">)</span>&nbsp;<span class="op" id="5961435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961441">if</span>&nbsp;<span class="ident" id="5961444">hdr</span><span class="op" id="5961447">.</span><span class="ident" id="5961448">Xattrs</span>&nbsp;<span class="op" id="5961455">==</span>&nbsp;<span class="builtintype" id="5961458">nil</span>&nbsp;<span class="op" id="5961462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961469">hdr</span><span class="op" id="5961472">.</span><span class="ident" id="5961473">Xattrs</span>&nbsp;<span class="op" id="5961480">=</span>&nbsp;<span class="builtinfunc" id="5961482">make</span><span class="op" id="5961486">(</span><span class="keyword" id="5961487">map</span><span class="op" id="5961490">[</span><span class="builtintype" id="5961491">string</span><span class="op" id="5961497">]</span><span class="builtintype" id="5961498">string</span><span class="op" id="5961504">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961516">hdr</span><span class="op" id="5961519">.</span><span class="ident" id="5961520">Xattrs</span><span class="op" id="5961526">[</span><span class="ident" id="5961527">k</span><span class="op" id="5961528">[</span><span class="builtinfunc" id="5961529">len</span><span class="op" id="5961532">(</span><span class="ident" id="5961533">paxXattr</span><span class="op" id="5961541">)</span><span class="op" id="5961542">:</span><span class="op" id="5961543">]</span><span class="op" id="5961544">]</span>&nbsp;<span class="op" id="5961546">=</span>&nbsp;<span class="ident" id="5961548">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961560">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961563">return</span>&nbsp;<span class="builtintype" id="5961570">nil</span><br>
<span class="lineno"></span><span class="op" id="5961574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961577">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5961642">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5961668">func</span>&nbsp;<span class="ident" id="5961673">parsePAXTime</span><span class="op" id="5961685">(</span><span class="ident" id="5961686">t</span>&nbsp;<span class="builtintype" id="5961688">string</span><span class="op" id="5961694">)</span>&nbsp;<span class="op" id="5961696">(</span><span class="ident" id="5961697">time</span><span class="op" id="5961701">.</span><span class="ident" id="5961702">Time</span><span class="op" id="5961706">,</span>&nbsp;<span class="builtintype" id="5961708">error</span><span class="op" id="5961713">)</span>&nbsp;<span class="op" id="5961715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961718">buf</span>&nbsp;<span class="op" id="5961722">:=</span>&nbsp;<span class="op" id="5961725">[</span><span class="op" id="5961726">]</span><span class="builtintype" id="5961727">byte</span><span class="op" id="5961731">(</span><span class="ident" id="5961732">t</span><span class="op" id="5961733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961736">pos</span>&nbsp;<span class="op" id="5961740">:=</span>&nbsp;<span class="ident" id="5961743">bytes</span><span class="op" id="5961748">.</span><span class="ident" id="5961749">IndexByte</span><span class="op" id="5961758">(</span><span class="ident" id="5961759">buf</span><span class="op" id="5961762">,</span>&nbsp;<span class="string" id="5961764">&#39;.&#39;</span><span class="op" id="5961767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961770">var</span>&nbsp;<span class="ident" id="5961774">seconds</span><span class="op" id="5961781">,</span>&nbsp;<span class="ident" id="5961783">nanoseconds</span>&nbsp;<span class="builtintype" id="5961795">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961802">var</span>&nbsp;<span class="ident" id="5961806">err</span>&nbsp;<span class="builtintype" id="5961810">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961817">if</span>&nbsp;<span class="ident" id="5961820">pos</span>&nbsp;<span class="op" id="5961824">==</span>&nbsp;<span class="op" id="5961827">-</span><span class="num" id="5961828">1</span>&nbsp;<span class="op" id="5961830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961834">seconds</span><span class="op" id="5961841">,</span>&nbsp;<span class="ident" id="5961843">err</span>&nbsp;<span class="op" id="5961847">=</span>&nbsp;<span class="ident" id="5961849">strconv</span><span class="op" id="5961856">.</span><span class="ident" id="5961857">ParseInt</span><span class="op" id="5961865">(</span><span class="ident" id="5961866">t</span><span class="op" id="5961867">,</span>&nbsp;<span class="num" id="5961869">10</span><span class="op" id="5961871">,</span>&nbsp;<span class="num" id="5961873">0</span><span class="op" id="5961874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961878">if</span>&nbsp;<span class="ident" id="5961881">err</span>&nbsp;<span class="op" id="5961885">!=</span>&nbsp;<span class="builtintype" id="5961888">nil</span>&nbsp;<span class="op" id="5961892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961897">return</span>&nbsp;<span class="ident" id="5961904">time</span><span class="op" id="5961908">.</span><span class="ident" id="5961909">Time</span><span class="op" id="5961913">{</span><span class="op" id="5961914">}</span><span class="op" id="5961915">,</span>&nbsp;<span class="ident" id="5961917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961923">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961926">}</span>&nbsp;<span class="keyword" id="5961928">else</span>&nbsp;<span class="op" id="5961933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961937">seconds</span><span class="op" id="5961944">,</span>&nbsp;<span class="ident" id="5961946">err</span>&nbsp;<span class="op" id="5961950">=</span>&nbsp;<span class="ident" id="5961952">strconv</span><span class="op" id="5961959">.</span><span class="ident" id="5961960">ParseInt</span><span class="op" id="5961968">(</span><span class="builtintype" id="5961969">string</span><span class="op" id="5961975">(</span><span class="ident" id="5961976">buf</span><span class="op" id="5961979">[</span><span class="op" id="5961980">:</span><span class="ident" id="5961981">pos</span><span class="op" id="5961984">]</span><span class="op" id="5961985">)</span><span class="op" id="5961986">,</span>&nbsp;<span class="num" id="5961988">10</span><span class="op" id="5961990">,</span>&nbsp;<span class="num" id="5961992">0</span><span class="op" id="5961993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961997">if</span>&nbsp;<span class="ident" id="5962000">err</span>&nbsp;<span class="op" id="5962004">!=</span>&nbsp;<span class="builtintype" id="5962007">nil</span>&nbsp;<span class="op" id="5962011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962016">return</span>&nbsp;<span class="ident" id="5962023">time</span><span class="op" id="5962027">.</span><span class="ident" id="5962028">Time</span><span class="op" id="5962032">{</span><span class="op" id="5962033">}</span><span class="op" id="5962034">,</span>&nbsp;<span class="ident" id="5962036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962042">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962046">nano_buf</span>&nbsp;<span class="op" id="5962055">:=</span>&nbsp;<span class="builtintype" id="5962058">string</span><span class="op" id="5962064">(</span><span class="ident" id="5962065">buf</span><span class="op" id="5962068">[</span><span class="ident" id="5962069">pos</span><span class="op" id="5962072">+</span><span class="num" id="5962073">1</span><span class="op" id="5962074">:</span><span class="op" id="5962075">]</span><span class="op" id="5962076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962080">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962131">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962191">if</span>&nbsp;<span class="builtinfunc" id="5962194">len</span><span class="op" id="5962197">(</span><span class="ident" id="5962198">nano_buf</span><span class="op" id="5962206">)</span>&nbsp;<span class="op" id="5962208">&lt;</span>&nbsp;<span class="ident" id="5962210">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5962231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962236">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962252">nano_buf</span>&nbsp;<span class="op" id="5962261">+=</span>&nbsp;<span class="ident" id="5962264">strings</span><span class="op" id="5962271">.</span><span class="ident" id="5962272">Repeat</span><span class="op" id="5962278">(</span><span class="string" id="5962279">&#34;0&#34;</span><span class="op" id="5962282">,</span>&nbsp;<span class="ident" id="5962284">maxNanoSecondIntSize</span><span class="op" id="5962304">-</span><span class="builtinfunc" id="5962305">len</span><span class="op" id="5962308">(</span><span class="ident" id="5962309">nano_buf</span><span class="op" id="5962317">)</span><span class="op" id="5962318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962322">}</span>&nbsp;<span class="keyword" id="5962324">else</span>&nbsp;<span class="keyword" id="5962329">if</span>&nbsp;<span class="builtinfunc" id="5962332">len</span><span class="op" id="5962335">(</span><span class="ident" id="5962336">nano_buf</span><span class="op" id="5962344">)</span>&nbsp;<span class="op" id="5962346">&gt;</span>&nbsp;<span class="ident" id="5962348">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5962369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962374">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962395">nano_buf</span>&nbsp;<span class="op" id="5962404">=</span>&nbsp;<span class="ident" id="5962406">nano_buf</span><span class="op" id="5962414">[</span><span class="op" id="5962415">:</span><span class="ident" id="5962416">maxNanoSecondIntSize</span><span class="op" id="5962436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962440">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962444">nanoseconds</span><span class="op" id="5962455">,</span>&nbsp;<span class="ident" id="5962457">err</span>&nbsp;<span class="op" id="5962461">=</span>&nbsp;<span class="ident" id="5962463">strconv</span><span class="op" id="5962470">.</span><span class="ident" id="5962471">ParseInt</span><span class="op" id="5962479">(</span><span class="builtintype" id="5962480">string</span><span class="op" id="5962486">(</span><span class="ident" id="5962487">nano_buf</span><span class="op" id="5962495">)</span><span class="op" id="5962496">,</span>&nbsp;<span class="num" id="5962498">10</span><span class="op" id="5962500">,</span>&nbsp;<span class="num" id="5962502">0</span><span class="op" id="5962503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962507">if</span>&nbsp;<span class="ident" id="5962510">err</span>&nbsp;<span class="op" id="5962514">!=</span>&nbsp;<span class="builtintype" id="5962517">nil</span>&nbsp;<span class="op" id="5962521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962526">return</span>&nbsp;<span class="ident" id="5962533">time</span><span class="op" id="5962537">.</span><span class="ident" id="5962538">Time</span><span class="op" id="5962542">{</span><span class="op" id="5962543">}</span><span class="op" id="5962544">,</span>&nbsp;<span class="ident" id="5962546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962555">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962558">ts</span>&nbsp;<span class="op" id="5962561">:=</span>&nbsp;<span class="ident" id="5962564">time</span><span class="op" id="5962568">.</span><span class="ident" id="5962569">Unix</span><span class="op" id="5962573">(</span><span class="ident" id="5962574">seconds</span><span class="op" id="5962581">,</span>&nbsp;<span class="ident" id="5962583">nanoseconds</span><span class="op" id="5962594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962597">return</span>&nbsp;<span class="ident" id="5962604">ts</span><span class="op" id="5962606">,</span>&nbsp;<span class="builtintype" id="5962608">nil</span><br>
<span class="lineno"></span><span class="op" id="5962612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5962615">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5962647">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5962717">func</span>&nbsp;<span class="ident" id="5962722">parsePAX</span><span class="op" id="5962730">(</span><span class="ident" id="5962731">r</span>&nbsp;<span class="ident" id="5962733">io</span><span class="op" id="5962735">.</span><span class="ident" id="5962736">Reader</span><span class="op" id="5962742">)</span>&nbsp;<span class="op" id="5962744">(</span><span class="keyword" id="5962745">map</span><span class="op" id="5962748">[</span><span class="builtintype" id="5962749">string</span><span class="op" id="5962755">]</span><span class="builtintype" id="5962756">string</span><span class="op" id="5962762">,</span>&nbsp;<span class="builtintype" id="5962764">error</span><span class="op" id="5962769">)</span>&nbsp;<span class="op" id="5962771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962774">buf</span><span class="op" id="5962777">,</span>&nbsp;<span class="ident" id="5962779">err</span>&nbsp;<span class="op" id="5962783">:=</span>&nbsp;<span class="ident" id="5962786">ioutil</span><span class="op" id="5962792">.</span><span class="ident" id="5962793">ReadAll</span><span class="op" id="5962800">(</span><span class="ident" id="5962801">r</span><span class="op" id="5962802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962805">if</span>&nbsp;<span class="ident" id="5962808">err</span>&nbsp;<span class="op" id="5962812">!=</span>&nbsp;<span class="builtintype" id="5962815">nil</span>&nbsp;<span class="op" id="5962819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962823">return</span>&nbsp;<span class="builtintype" id="5962830">nil</span><span class="op" id="5962833">,</span>&nbsp;<span class="ident" id="5962835">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962844">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5962887">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5962978">var</span>&nbsp;<span class="ident" id="5962982">sparseMap</span>&nbsp;<span class="ident" id="5962992">bytes</span><span class="op" id="5962997">.</span><span class="ident" id="5962998">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963007">headers</span>&nbsp;<span class="op" id="5963015">:=</span>&nbsp;<span class="builtinfunc" id="5963018">make</span><span class="op" id="5963022">(</span><span class="keyword" id="5963023">map</span><span class="op" id="5963026">[</span><span class="builtintype" id="5963027">string</span><span class="op" id="5963033">]</span><span class="builtintype" id="5963034">string</span><span class="op" id="5963040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963043">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963122">for</span>&nbsp;<span class="builtinfunc" id="5963126">len</span><span class="op" id="5963129">(</span><span class="ident" id="5963130">buf</span><span class="op" id="5963133">)</span>&nbsp;<span class="op" id="5963135">&gt;</span>&nbsp;<span class="num" id="5963137">0</span>&nbsp;<span class="op" id="5963139">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963143">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963187">var</span>&nbsp;<span class="ident" id="5963191">sp</span>&nbsp;<span class="builtintype" id="5963194">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963200">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963245">sp</span>&nbsp;<span class="op" id="5963248">=</span>&nbsp;<span class="ident" id="5963250">bytes</span><span class="op" id="5963255">.</span><span class="ident" id="5963256">IndexByte</span><span class="op" id="5963265">(</span><span class="ident" id="5963266">buf</span><span class="op" id="5963269">,</span>&nbsp;<span class="string" id="5963271">&#39;&nbsp;&#39;</span><span class="op" id="5963274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963278">if</span>&nbsp;<span class="ident" id="5963281">sp</span>&nbsp;<span class="op" id="5963284">==</span>&nbsp;<span class="op" id="5963287">-</span><span class="num" id="5963288">1</span>&nbsp;<span class="op" id="5963290">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963295">return</span>&nbsp;<span class="builtintype" id="5963302">nil</span><span class="op" id="5963305">,</span>&nbsp;<span class="ident" id="5963307">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5963319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963323">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963372">n</span><span class="op" id="5963373">,</span>&nbsp;<span class="ident" id="5963375">err</span>&nbsp;<span class="op" id="5963379">:=</span>&nbsp;<span class="ident" id="5963382">strconv</span><span class="op" id="5963389">.</span><span class="ident" id="5963390">ParseInt</span><span class="op" id="5963398">(</span><span class="builtintype" id="5963399">string</span><span class="op" id="5963405">(</span><span class="ident" id="5963406">buf</span><span class="op" id="5963409">[</span><span class="op" id="5963410">:</span><span class="ident" id="5963411">sp</span><span class="op" id="5963413">]</span><span class="op" id="5963414">)</span><span class="op" id="5963415">,</span>&nbsp;<span class="num" id="5963417">10</span><span class="op" id="5963419">,</span>&nbsp;<span class="num" id="5963421">0</span><span class="op" id="5963422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963426">if</span>&nbsp;<span class="ident" id="5963429">err</span>&nbsp;<span class="op" id="5963433">!=</span>&nbsp;<span class="builtintype" id="5963436">nil</span>&nbsp;<span class="op" id="5963440">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963445">return</span>&nbsp;<span class="builtintype" id="5963452">nil</span><span class="op" id="5963455">,</span>&nbsp;<span class="ident" id="5963457">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5963469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963473">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963537">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963603">var</span>&nbsp;<span class="ident" id="5963607">record</span>&nbsp;<span class="op" id="5963614">[</span><span class="op" id="5963615">]</span><span class="builtintype" id="5963616">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963623">record</span><span class="op" id="5963629">,</span>&nbsp;<span class="ident" id="5963631">buf</span>&nbsp;<span class="op" id="5963635">=</span>&nbsp;<span class="ident" id="5963637">buf</span><span class="op" id="5963640">[</span><span class="ident" id="5963641">sp</span><span class="op" id="5963643">+</span><span class="num" id="5963644">1</span><span class="op" id="5963645">:</span><span class="ident" id="5963646">n</span><span class="op" id="5963647">-</span><span class="num" id="5963648">1</span><span class="op" id="5963649">]</span><span class="op" id="5963650">,</span>&nbsp;<span class="ident" id="5963652">buf</span><span class="op" id="5963655">[</span><span class="ident" id="5963656">n</span><span class="op" id="5963657">:</span><span class="op" id="5963658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963662">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963726">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963757">eq</span>&nbsp;<span class="op" id="5963760">:=</span>&nbsp;<span class="ident" id="5963763">bytes</span><span class="op" id="5963768">.</span><span class="ident" id="5963769">IndexByte</span><span class="op" id="5963778">(</span><span class="ident" id="5963779">record</span><span class="op" id="5963785">,</span>&nbsp;<span class="string" id="5963787">&#39;=&#39;</span><span class="op" id="5963790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963794">if</span>&nbsp;<span class="ident" id="5963797">eq</span>&nbsp;<span class="op" id="5963800">==</span>&nbsp;<span class="op" id="5963803">-</span><span class="num" id="5963804">1</span>&nbsp;<span class="op" id="5963806">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963811">return</span>&nbsp;<span class="builtintype" id="5963818">nil</span><span class="op" id="5963821">,</span>&nbsp;<span class="ident" id="5963823">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5963835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963839">key</span><span class="op" id="5963842">,</span>&nbsp;<span class="ident" id="5963844">value</span>&nbsp;<span class="op" id="5963850">:=</span>&nbsp;<span class="ident" id="5963853">record</span><span class="op" id="5963859">[</span><span class="op" id="5963860">:</span><span class="ident" id="5963861">eq</span><span class="op" id="5963863">]</span><span class="op" id="5963864">,</span>&nbsp;<span class="ident" id="5963866">record</span><span class="op" id="5963872">[</span><span class="ident" id="5963873">eq</span><span class="op" id="5963875">+</span><span class="num" id="5963876">1</span><span class="op" id="5963877">:</span><span class="op" id="5963878">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963883">keyStr</span>&nbsp;<span class="op" id="5963890">:=</span>&nbsp;<span class="builtintype" id="5963893">string</span><span class="op" id="5963899">(</span><span class="ident" id="5963900">key</span><span class="op" id="5963903">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5963907">if</span>&nbsp;<span class="ident" id="5963910">keyStr</span>&nbsp;<span class="op" id="5963917">==</span>&nbsp;<span class="ident" id="5963920">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5963939">||</span>&nbsp;<span class="ident" id="5963942">keyStr</span>&nbsp;<span class="op" id="5963949">==</span>&nbsp;<span class="ident" id="5963952">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5963973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5963978">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964072">sparseMap</span><span class="op" id="5964081">.</span><span class="ident" id="5964082">Write</span><span class="op" id="5964087">(</span><span class="ident" id="5964088">value</span><span class="op" id="5964093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964098">sparseMap</span><span class="op" id="5964107">.</span><span class="ident" id="5964108">Write</span><span class="op" id="5964113">(</span><span class="op" id="5964114">[</span><span class="op" id="5964115">]</span><span class="builtintype" id="5964116">byte</span><span class="op" id="5964120">{</span><span class="string" id="5964121">&#39;,&#39;</span><span class="op" id="5964124">}</span><span class="op" id="5964125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964129">}</span>&nbsp;<span class="keyword" id="5964131">else</span>&nbsp;<span class="op" id="5964136">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964141">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964193">headers</span><span class="op" id="5964200">[</span><span class="ident" id="5964201">keyStr</span><span class="op" id="5964207">]</span>&nbsp;<span class="op" id="5964209">=</span>&nbsp;<span class="builtintype" id="5964211">string</span><span class="op" id="5964217">(</span><span class="ident" id="5964218">value</span><span class="op" id="5964223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964233">if</span>&nbsp;<span class="ident" id="5964236">sparseMap</span><span class="op" id="5964245">.</span><span class="ident" id="5964246">Len</span><span class="op" id="5964249">(</span><span class="op" id="5964250">)</span>&nbsp;<span class="op" id="5964252">!=</span>&nbsp;<span class="num" id="5964255">0</span>&nbsp;<span class="op" id="5964257">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964261">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964323">sparseMap</span><span class="op" id="5964332">.</span><span class="ident" id="5964333">Truncate</span><span class="op" id="5964341">(</span><span class="ident" id="5964342">sparseMap</span><span class="op" id="5964351">.</span><span class="ident" id="5964352">Len</span><span class="op" id="5964355">(</span><span class="op" id="5964356">)</span>&nbsp;<span class="op" id="5964358">-</span>&nbsp;<span class="num" id="5964360">1</span><span class="op" id="5964361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964365">headers</span><span class="op" id="5964372">[</span><span class="ident" id="5964373">paxGNUSparseMap</span><span class="op" id="5964388">]</span>&nbsp;<span class="op" id="5964390">=</span>&nbsp;<span class="ident" id="5964392">sparseMap</span><span class="op" id="5964401">.</span><span class="ident" id="5964402">String</span><span class="op" id="5964408">(</span><span class="op" id="5964409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964415">return</span>&nbsp;<span class="ident" id="5964422">headers</span><span class="op" id="5964429">,</span>&nbsp;<span class="builtintype" id="5964431">nil</span><br>
<span class="lineno">365</span><span class="op" id="5964435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964438">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5964498">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5964574">func</span>&nbsp;<span class="ident" id="5964579">cString</span><span class="op" id="5964586">(</span><span class="ident" id="5964587">b</span>&nbsp;<span class="op" id="5964589">[</span><span class="op" id="5964590">]</span><span class="builtintype" id="5964591">byte</span><span class="op" id="5964595">)</span>&nbsp;<span class="builtintype" id="5964597">string</span>&nbsp;<span class="op" id="5964604">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964607">n</span>&nbsp;<span class="op" id="5964609">:=</span>&nbsp;<span class="num" id="5964612">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964615">for</span>&nbsp;<span class="ident" id="5964619">n</span>&nbsp;<span class="op" id="5964621">&lt;</span>&nbsp;<span class="builtinfunc" id="5964623">len</span><span class="op" id="5964626">(</span><span class="ident" id="5964627">b</span><span class="op" id="5964628">)</span>&nbsp;<span class="op" id="5964630">&amp;&amp;</span>&nbsp;<span class="ident" id="5964633">b</span><span class="op" id="5964634">[</span><span class="ident" id="5964635">n</span><span class="op" id="5964636">]</span>&nbsp;<span class="op" id="5964638">!=</span>&nbsp;<span class="num" id="5964641">0</span>&nbsp;<span class="op" id="5964643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964647">n</span><span class="op" id="5964648">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964655">return</span>&nbsp;<span class="builtintype" id="5964662">string</span><span class="op" id="5964668">(</span><span class="ident" id="5964669">b</span><span class="op" id="5964670">[</span><span class="num" id="5964671">0</span><span class="op" id="5964672">:</span><span class="ident" id="5964673">n</span><span class="op" id="5964674">]</span><span class="op" id="5964675">)</span><br>
<span class="lineno">375</span><span class="op" id="5964677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5964680">func</span>&nbsp;<span class="op" id="5964685">(</span><span class="ident" id="5964686">tr</span>&nbsp;<span class="op" id="5964689">*</span><span class="ident" id="5964690">Reader</span><span class="op" id="5964696">)</span>&nbsp;<span class="ident" id="5964698">octal</span><span class="op" id="5964703">(</span><span class="ident" id="5964704">b</span>&nbsp;<span class="op" id="5964706">[</span><span class="op" id="5964707">]</span><span class="builtintype" id="5964708">byte</span><span class="op" id="5964712">)</span>&nbsp;<span class="builtintype" id="5964714">int64</span>&nbsp;<span class="op" id="5964720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964723">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964758">if</span>&nbsp;<span class="builtinfunc" id="5964761">len</span><span class="op" id="5964764">(</span><span class="ident" id="5964765">b</span><span class="op" id="5964766">)</span>&nbsp;<span class="op" id="5964768">&gt;</span>&nbsp;<span class="num" id="5964770">0</span>&nbsp;<span class="op" id="5964772">&amp;&amp;</span>&nbsp;<span class="ident" id="5964775">b</span><span class="op" id="5964776">[</span><span class="num" id="5964777">0</span><span class="op" id="5964778">]</span><span class="op" id="5964779">&amp;</span><span class="num" id="5964780">0x80</span>&nbsp;<span class="op" id="5964785">!=</span>&nbsp;<span class="num" id="5964788">0</span>&nbsp;<span class="op" id="5964790">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964794">var</span>&nbsp;<span class="ident" id="5964798">x</span>&nbsp;<span class="builtintype" id="5964800">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964808">for</span>&nbsp;<span class="ident" id="5964812">i</span><span class="op" id="5964813">,</span>&nbsp;<span class="ident" id="5964815">c</span>&nbsp;<span class="op" id="5964817">:=</span>&nbsp;<span class="keyword" id="5964820">range</span>&nbsp;<span class="ident" id="5964826">b</span>&nbsp;<span class="op" id="5964828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964833">if</span>&nbsp;<span class="ident" id="5964836">i</span>&nbsp;<span class="op" id="5964838">==</span>&nbsp;<span class="num" id="5964841">0</span>&nbsp;<span class="op" id="5964843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964849">c</span>&nbsp;<span class="op" id="5964851">&amp;=</span>&nbsp;<span class="num" id="5964854">0x7f</span>&nbsp;<span class="comment" id="5964859">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964897">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5964902">x</span>&nbsp;<span class="op" id="5964904">=</span>&nbsp;<span class="ident" id="5964906">x</span><span class="op" id="5964907">&lt;&lt;</span><span class="num" id="5964909">8</span>&nbsp;<span class="op" id="5964911">|</span>&nbsp;<span class="builtintype" id="5964913">int64</span><span class="op" id="5964918">(</span><span class="ident" id="5964919">c</span><span class="op" id="5964920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5964928">return</span>&nbsp;<span class="ident" id="5964935">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964942">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5964998">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5965055">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5965075">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5965132">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965145">b</span>&nbsp;<span class="op" id="5965147">=</span>&nbsp;<span class="ident" id="5965149">bytes</span><span class="op" id="5965154">.</span><span class="ident" id="5965155">Trim</span><span class="op" id="5965159">(</span><span class="ident" id="5965160">b</span><span class="op" id="5965161">,</span>&nbsp;<span class="string" id="5965163">&#34;&nbsp;\x00&#34;</span><span class="op" id="5965170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965174">if</span>&nbsp;<span class="builtinfunc" id="5965177">len</span><span class="op" id="5965180">(</span><span class="ident" id="5965181">b</span><span class="op" id="5965182">)</span>&nbsp;<span class="op" id="5965184">==</span>&nbsp;<span class="num" id="5965187">0</span>&nbsp;<span class="op" id="5965189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965193">return</span>&nbsp;<span class="num" id="5965200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965203">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965206">x</span><span class="op" id="5965207">,</span>&nbsp;<span class="ident" id="5965209">err</span>&nbsp;<span class="op" id="5965213">:=</span>&nbsp;<span class="ident" id="5965216">strconv</span><span class="op" id="5965223">.</span><span class="ident" id="5965224">ParseUint</span><span class="op" id="5965233">(</span><span class="ident" id="5965234">cString</span><span class="op" id="5965241">(</span><span class="ident" id="5965242">b</span><span class="op" id="5965243">)</span><span class="op" id="5965244">,</span>&nbsp;<span class="num" id="5965246">8</span><span class="op" id="5965247">,</span>&nbsp;<span class="num" id="5965249">64</span><span class="op" id="5965251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965254">if</span>&nbsp;<span class="ident" id="5965257">err</span>&nbsp;<span class="op" id="5965261">!=</span>&nbsp;<span class="builtintype" id="5965264">nil</span>&nbsp;<span class="op" id="5965268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965272">tr</span><span class="op" id="5965274">.</span><span class="ident" id="5965275">err</span>&nbsp;<span class="op" id="5965279">=</span>&nbsp;<span class="ident" id="5965281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965289">return</span>&nbsp;<span class="builtintype" id="5965296">int64</span><span class="op" id="5965301">(</span><span class="ident" id="5965302">x</span><span class="op" id="5965303">)</span><br>
<span class="lineno">405</span><span class="op" id="5965305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965308">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5965407">func</span>&nbsp;<span class="op" id="5965412">(</span><span class="ident" id="5965413">tr</span>&nbsp;<span class="op" id="5965416">*</span><span class="ident" id="5965417">Reader</span><span class="op" id="5965423">)</span>&nbsp;<span class="ident" id="5965425">skipUnread</span><span class="op" id="5965435">(</span><span class="op" id="5965436">)</span>&nbsp;<span class="op" id="5965438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965441">nr</span>&nbsp;<span class="op" id="5965444">:=</span>&nbsp;<span class="ident" id="5965447">tr</span><span class="op" id="5965449">.</span><span class="ident" id="5965450">numBytes</span><span class="op" id="5965458">(</span><span class="op" id="5965459">)</span>&nbsp;<span class="op" id="5965461">+</span>&nbsp;<span class="ident" id="5965463">tr</span><span class="op" id="5965465">.</span><span class="ident" id="5965466">pad</span>&nbsp;<span class="comment" id="5965470">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965498">tr</span><span class="op" id="5965500">.</span><span class="ident" id="5965501">curr</span><span class="op" id="5965505">,</span>&nbsp;<span class="ident" id="5965507">tr</span><span class="op" id="5965509">.</span><span class="ident" id="5965510">pad</span>&nbsp;<span class="op" id="5965514">=</span>&nbsp;<span class="builtintype" id="5965516">nil</span><span class="op" id="5965519">,</span>&nbsp;<span class="num" id="5965521">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965524">if</span>&nbsp;<span class="ident" id="5965527">sr</span><span class="op" id="5965529">,</span>&nbsp;<span class="ident" id="5965531">ok</span>&nbsp;<span class="op" id="5965534">:=</span>&nbsp;<span class="ident" id="5965537">tr</span><span class="op" id="5965539">.</span><span class="ident" id="5965540">r</span><span class="op" id="5965541">.</span><span class="op" id="5965542">(</span><span class="ident" id="5965543">io</span><span class="op" id="5965545">.</span><span class="ident" id="5965546">Seeker</span><span class="op" id="5965552">)</span><span class="op" id="5965553">;</span>&nbsp;<span class="ident" id="5965555">ok</span>&nbsp;<span class="op" id="5965558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965562">if</span>&nbsp;<span class="ident" id="5965565">_</span><span class="op" id="5965566">,</span>&nbsp;<span class="ident" id="5965568">err</span>&nbsp;<span class="op" id="5965572">:=</span>&nbsp;<span class="ident" id="5965575">sr</span><span class="op" id="5965577">.</span><span class="ident" id="5965578">Seek</span><span class="op" id="5965582">(</span><span class="ident" id="5965583">nr</span><span class="op" id="5965585">,</span>&nbsp;<span class="ident" id="5965587">os</span><span class="op" id="5965589">.</span><span class="ident" id="5965590">SEEK_CUR</span><span class="op" id="5965598">)</span><span class="op" id="5965599">;</span>&nbsp;<span class="ident" id="5965601">err</span>&nbsp;<span class="op" id="5965605">==</span>&nbsp;<span class="builtintype" id="5965608">nil</span>&nbsp;<span class="op" id="5965612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965617">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965626">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965632">_</span><span class="op" id="5965633">,</span>&nbsp;<span class="ident" id="5965635">tr</span><span class="op" id="5965637">.</span><span class="ident" id="5965638">err</span>&nbsp;<span class="op" id="5965642">=</span>&nbsp;<span class="ident" id="5965644">io</span><span class="op" id="5965646">.</span><span class="ident" id="5965647">CopyN</span><span class="op" id="5965652">(</span><span class="ident" id="5965653">ioutil</span><span class="op" id="5965659">.</span><span class="ident" id="5965660">Discard</span><span class="op" id="5965667">,</span>&nbsp;<span class="ident" id="5965669">tr</span><span class="op" id="5965671">.</span><span class="ident" id="5965672">r</span><span class="op" id="5965673">,</span>&nbsp;<span class="ident" id="5965675">nr</span><span class="op" id="5965677">)</span><br>
<span class="lineno"></span><span class="op" id="5965679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965682">func</span>&nbsp;<span class="op" id="5965687">(</span><span class="ident" id="5965688">tr</span>&nbsp;<span class="op" id="5965691">*</span><span class="ident" id="5965692">Reader</span><span class="op" id="5965698">)</span>&nbsp;<span class="ident" id="5965700">verifyChecksum</span><span class="op" id="5965714">(</span><span class="ident" id="5965715">header</span>&nbsp;<span class="op" id="5965722">[</span><span class="op" id="5965723">]</span><span class="builtintype" id="5965724">byte</span><span class="op" id="5965728">)</span>&nbsp;<span class="builtintype" id="5965730">bool</span>&nbsp;<span class="op" id="5965735">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965738">if</span>&nbsp;<span class="ident" id="5965741">tr</span><span class="op" id="5965743">.</span><span class="ident" id="5965744">err</span>&nbsp;<span class="op" id="5965748">!=</span>&nbsp;<span class="builtintype" id="5965751">nil</span>&nbsp;<span class="op" id="5965755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965759">return</span>&nbsp;<span class="builtintype" id="5965766">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965777">given</span>&nbsp;<span class="op" id="5965783">:=</span>&nbsp;<span class="ident" id="5965786">tr</span><span class="op" id="5965788">.</span><span class="ident" id="5965789">octal</span><span class="op" id="5965794">(</span><span class="ident" id="5965795">header</span><span class="op" id="5965801">[</span><span class="num" id="5965802">148</span><span class="op" id="5965805">:</span><span class="num" id="5965806">156</span><span class="op" id="5965809">]</span><span class="op" id="5965810">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965813">unsigned</span><span class="op" id="5965821">,</span>&nbsp;<span class="ident" id="5965823">signed</span>&nbsp;<span class="op" id="5965830">:=</span>&nbsp;<span class="ident" id="5965833">checksum</span><span class="op" id="5965841">(</span><span class="ident" id="5965842">header</span><span class="op" id="5965848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965851">return</span>&nbsp;<span class="ident" id="5965858">given</span>&nbsp;<span class="op" id="5965864">==</span>&nbsp;<span class="ident" id="5965867">unsigned</span>&nbsp;<span class="op" id="5965876">||</span>&nbsp;<span class="ident" id="5965879">given</span>&nbsp;<span class="op" id="5965885">==</span>&nbsp;<span class="ident" id="5965888">signed</span><br>
<span class="lineno"></span><span class="op" id="5965895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965898">func</span>&nbsp;<span class="op" id="5965903">(</span><span class="ident" id="5965904">tr</span>&nbsp;<span class="op" id="5965907">*</span><span class="ident" id="5965908">Reader</span><span class="op" id="5965914">)</span>&nbsp;<span class="ident" id="5965916">readHeader</span><span class="op" id="5965926">(</span><span class="op" id="5965927">)</span>&nbsp;<span class="op" id="5965929">*</span><span class="ident" id="5965930">Header</span>&nbsp;<span class="op" id="5965937">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5965940">header</span>&nbsp;<span class="op" id="5965947">:=</span>&nbsp;<span class="ident" id="5965950">tr</span><span class="op" id="5965952">.</span><span class="ident" id="5965953">hdrBuff</span><span class="op" id="5965960">[</span><span class="op" id="5965961">:</span><span class="op" id="5965962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5965965">copy</span><span class="op" id="5965969">(</span><span class="ident" id="5965970">header</span><span class="op" id="5965976">,</span>&nbsp;<span class="ident" id="5965978">zeroBlock</span><span class="op" id="5965987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5965991">if</span>&nbsp;<span class="ident" id="5965994">_</span><span class="op" id="5965995">,</span>&nbsp;<span class="ident" id="5965997">tr</span><span class="op" id="5965999">.</span><span class="ident" id="5966000">err</span>&nbsp;<span class="op" id="5966004">=</span>&nbsp;<span class="ident" id="5966006">io</span><span class="op" id="5966008">.</span><span class="ident" id="5966009">ReadFull</span><span class="op" id="5966017">(</span><span class="ident" id="5966018">tr</span><span class="op" id="5966020">.</span><span class="ident" id="5966021">r</span><span class="op" id="5966022">,</span>&nbsp;<span class="ident" id="5966024">header</span><span class="op" id="5966030">)</span><span class="op" id="5966031">;</span>&nbsp;<span class="ident" id="5966033">tr</span><span class="op" id="5966035">.</span><span class="ident" id="5966036">err</span>&nbsp;<span class="op" id="5966040">!=</span>&nbsp;<span class="builtintype" id="5966043">nil</span>&nbsp;<span class="op" id="5966047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966051">return</span>&nbsp;<span class="builtintype" id="5966058">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5966067">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966126">if</span>&nbsp;<span class="ident" id="5966129">bytes</span><span class="op" id="5966134">.</span><span class="ident" id="5966135">Equal</span><span class="op" id="5966140">(</span><span class="ident" id="5966141">header</span><span class="op" id="5966147">,</span>&nbsp;<span class="ident" id="5966149">zeroBlock</span><span class="op" id="5966158">[</span><span class="num" id="5966159">0</span><span class="op" id="5966160">:</span><span class="ident" id="5966161">blockSize</span><span class="op" id="5966170">]</span><span class="op" id="5966171">)</span>&nbsp;<span class="op" id="5966173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966177">if</span>&nbsp;<span class="ident" id="5966180">_</span><span class="op" id="5966181">,</span>&nbsp;<span class="ident" id="5966183">tr</span><span class="op" id="5966185">.</span><span class="ident" id="5966186">err</span>&nbsp;<span class="op" id="5966190">=</span>&nbsp;<span class="ident" id="5966192">io</span><span class="op" id="5966194">.</span><span class="ident" id="5966195">ReadFull</span><span class="op" id="5966203">(</span><span class="ident" id="5966204">tr</span><span class="op" id="5966206">.</span><span class="ident" id="5966207">r</span><span class="op" id="5966208">,</span>&nbsp;<span class="ident" id="5966210">header</span><span class="op" id="5966216">)</span><span class="op" id="5966217">;</span>&nbsp;<span class="ident" id="5966219">tr</span><span class="op" id="5966221">.</span><span class="ident" id="5966222">err</span>&nbsp;<span class="op" id="5966226">!=</span>&nbsp;<span class="builtintype" id="5966229">nil</span>&nbsp;<span class="op" id="5966233">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966238">return</span>&nbsp;<span class="builtintype" id="5966245">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966255">if</span>&nbsp;<span class="ident" id="5966258">bytes</span><span class="op" id="5966263">.</span><span class="ident" id="5966264">Equal</span><span class="op" id="5966269">(</span><span class="ident" id="5966270">header</span><span class="op" id="5966276">,</span>&nbsp;<span class="ident" id="5966278">zeroBlock</span><span class="op" id="5966287">[</span><span class="num" id="5966288">0</span><span class="op" id="5966289">:</span><span class="ident" id="5966290">blockSize</span><span class="op" id="5966299">]</span><span class="op" id="5966300">)</span>&nbsp;<span class="op" id="5966302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966307">tr</span><span class="op" id="5966309">.</span><span class="ident" id="5966310">err</span>&nbsp;<span class="op" id="5966314">=</span>&nbsp;<span class="ident" id="5966316">io</span><span class="op" id="5966318">.</span><span class="ident" id="5966319">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966325">}</span>&nbsp;<span class="keyword" id="5966327">else</span>&nbsp;<span class="op" id="5966332">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966337">tr</span><span class="op" id="5966339">.</span><span class="ident" id="5966340">err</span>&nbsp;<span class="op" id="5966344">=</span>&nbsp;<span class="ident" id="5966346">ErrHeader</span>&nbsp;<span class="comment" id="5966356">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966400">return</span>&nbsp;<span class="builtintype" id="5966407">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966416">if</span>&nbsp;<span class="op" id="5966419">!</span><span class="ident" id="5966420">tr</span><span class="op" id="5966422">.</span><span class="ident" id="5966423">verifyChecksum</span><span class="op" id="5966437">(</span><span class="ident" id="5966438">header</span><span class="op" id="5966444">)</span>&nbsp;<span class="op" id="5966446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966450">tr</span><span class="op" id="5966452">.</span><span class="ident" id="5966453">err</span>&nbsp;<span class="op" id="5966457">=</span>&nbsp;<span class="ident" id="5966459">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5966471">return</span>&nbsp;<span class="builtintype" id="5966478">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5966483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5966487">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966498">hdr</span>&nbsp;<span class="op" id="5966502">:=</span>&nbsp;<span class="builtinfunc" id="5966505">new</span><span class="op" id="5966508">(</span><span class="ident" id="5966509">Header</span><span class="op" id="5966515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966518">s</span>&nbsp;<span class="op" id="5966520">:=</span>&nbsp;<span class="ident" id="5966523">slicer</span><span class="op" id="5966529">(</span><span class="ident" id="5966530">header</span><span class="op" id="5966536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966540">hdr</span><span class="op" id="5966543">.</span><span class="ident" id="5966544">Name</span>&nbsp;<span class="op" id="5966549">=</span>&nbsp;<span class="ident" id="5966551">cString</span><span class="op" id="5966558">(</span><span class="ident" id="5966559">s</span><span class="op" id="5966560">.</span><span class="ident" id="5966561">next</span><span class="op" id="5966565">(</span><span class="num" id="5966566">100</span><span class="op" id="5966569">)</span><span class="op" id="5966570">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966573">hdr</span><span class="op" id="5966576">.</span><span class="ident" id="5966577">Mode</span>&nbsp;<span class="op" id="5966582">=</span>&nbsp;<span class="ident" id="5966584">tr</span><span class="op" id="5966586">.</span><span class="ident" id="5966587">octal</span><span class="op" id="5966592">(</span><span class="ident" id="5966593">s</span><span class="op" id="5966594">.</span><span class="ident" id="5966595">next</span><span class="op" id="5966599">(</span><span class="num" id="5966600">8</span><span class="op" id="5966601">)</span><span class="op" id="5966602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966605">hdr</span><span class="op" id="5966608">.</span><span class="ident" id="5966609">Uid</span>&nbsp;<span class="op" id="5966613">=</span>&nbsp;<span class="builtintype" id="5966615">int</span><span class="op" id="5966618">(</span><span class="ident" id="5966619">tr</span><span class="op" id="5966621">.</span><span class="ident" id="5966622">octal</span><span class="op" id="5966627">(</span><span class="ident" id="5966628">s</span><span class="op" id="5966629">.</span><span class="ident" id="5966630">next</span><span class="op" id="5966634">(</span><span class="num" id="5966635">8</span><span class="op" id="5966636">)</span><span class="op" id="5966637">)</span><span class="op" id="5966638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966641">hdr</span><span class="op" id="5966644">.</span><span class="ident" id="5966645">Gid</span>&nbsp;<span class="op" id="5966649">=</span>&nbsp;<span class="builtintype" id="5966651">int</span><span class="op" id="5966654">(</span><span class="ident" id="5966655">tr</span><span class="op" id="5966657">.</span><span class="ident" id="5966658">octal</span><span class="op" id="5966663">(</span><span class="ident" id="5966664">s</span><span class="op" id="5966665">.</span><span class="ident" id="5966666">next</span><span class="op" id="5966670">(</span><span class="num" id="5966671">8</span><span class="op" id="5966672">)</span><span class="op" id="5966673">)</span><span class="op" id="5966674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966677">hdr</span><span class="op" id="5966680">.</span><span class="ident" id="5966681">Size</span>&nbsp;<span class="op" id="5966686">=</span>&nbsp;<span class="ident" id="5966688">tr</span><span class="op" id="5966690">.</span><span class="ident" id="5966691">octal</span><span class="op" id="5966696">(</span><span class="ident" id="5966697">s</span><span class="op" id="5966698">.</span><span class="ident" id="5966699">next</span><span class="op" id="5966703">(</span><span class="num" id="5966704">12</span><span class="op" id="5966706">)</span><span class="op" id="5966707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966710">hdr</span><span class="op" id="5966713">.</span><span class="ident" id="5966714">ModTime</span>&nbsp;<span class="op" id="5966722">=</span>&nbsp;<span class="ident" id="5966724">time</span><span class="op" id="5966728">.</span><span class="ident" id="5966729">Unix</span><span class="op" id="5966733">(</span><span class="ident" id="5966734">tr</span><span class="op" id="5966736">.</span><span class="ident" id="5966737">octal</span><span class="op" id="5966742">(</span><span class="ident" id="5966743">s</span><span class="op" id="5966744">.</span><span class="ident" id="5966745">next</span><span class="op" id="5966749">(</span><span class="num" id="5966750">12</span><span class="op" id="5966752">)</span><span class="op" id="5966753">)</span><span class="op" id="5966754">,</span>&nbsp;<span class="num" id="5966756">0</span><span class="op" id="5966757">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966760">s</span><span class="op" id="5966761">.</span><span class="ident" id="5966762">next</span><span class="op" id="5966766">(</span><span class="num" id="5966767">8</span><span class="op" id="5966768">)</span>&nbsp;<span class="comment" id="5966770">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966781">hdr</span><span class="op" id="5966784">.</span><span class="ident" id="5966785">Typeflag</span>&nbsp;<span class="op" id="5966794">=</span>&nbsp;<span class="ident" id="5966796">s</span><span class="op" id="5966797">.</span><span class="ident" id="5966798">next</span><span class="op" id="5966802">(</span><span class="num" id="5966803">1</span><span class="op" id="5966804">)</span><span class="op" id="5966805">[</span><span class="num" id="5966806">0</span><span class="op" id="5966807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5966810">hdr</span><span class="op" id="5966813">.</span><span class="ident" id="5966814">Linkname</span>&nbsp;<span class="op" id="5966823">=</span>&nbsp;<span class="ident" id="5966825">cString</span><span class="op" id="5966832">(</span><span class="ident" id="5966833">s</span><span class="op" id="5966834">.</span><span class="ident" id="5966835">next</span><span class="op" id="5966839">(</span><span class="num" id="5966840">100</span><span class="op" id="5966843">)</span><span class="op" id="5966844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5966848">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5966911">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5966977">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967039">magic</span>&nbsp;<span class="op" id="5967045">:=</span>&nbsp;<span class="builtintype" id="5967048">string</span><span class="op" id="5967054">(</span><span class="ident" id="5967055">s</span><span class="op" id="5967056">.</span><span class="ident" id="5967057">next</span><span class="op" id="5967061">(</span><span class="num" id="5967062">8</span><span class="op" id="5967063">)</span><span class="op" id="5967064">)</span>&nbsp;<span class="comment" id="5967066">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967102">var</span>&nbsp;<span class="ident" id="5967106">format</span>&nbsp;<span class="builtintype" id="5967113">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967121">switch</span>&nbsp;<span class="op" id="5967128">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967131">case</span>&nbsp;<span class="ident" id="5967136">magic</span><span class="op" id="5967141">[</span><span class="op" id="5967142">:</span><span class="num" id="5967143">6</span><span class="op" id="5967144">]</span>&nbsp;<span class="op" id="5967146">==</span>&nbsp;<span class="string" id="5967149">&#34;ustar\x00&#34;</span><span class="op" id="5967160">:</span>&nbsp;<span class="comment" id="5967162">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967191">if</span>&nbsp;<span class="builtintype" id="5967194">string</span><span class="op" id="5967200">(</span><span class="ident" id="5967201">header</span><span class="op" id="5967207">[</span><span class="num" id="5967208">508</span><span class="op" id="5967211">:</span><span class="num" id="5967212">512</span><span class="op" id="5967215">]</span><span class="op" id="5967216">)</span>&nbsp;<span class="op" id="5967218">==</span>&nbsp;<span class="string" id="5967221">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5967231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967236">format</span>&nbsp;<span class="op" id="5967243">=</span>&nbsp;<span class="string" id="5967245">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967254">}</span>&nbsp;<span class="keyword" id="5967256">else</span>&nbsp;<span class="op" id="5967261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967266">format</span>&nbsp;<span class="op" id="5967273">=</span>&nbsp;<span class="string" id="5967275">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967288">case</span>&nbsp;<span class="ident" id="5967293">magic</span>&nbsp;<span class="op" id="5967299">==</span>&nbsp;<span class="string" id="5967302">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5967315">:</span>&nbsp;<span class="comment" id="5967317">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967334">format</span>&nbsp;<span class="op" id="5967341">=</span>&nbsp;<span class="string" id="5967343">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967354">switch</span>&nbsp;<span class="ident" id="5967361">format</span>&nbsp;<span class="op" id="5967368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967371">case</span>&nbsp;<span class="string" id="5967376">&#34;posix&#34;</span><span class="op" id="5967383">,</span>&nbsp;<span class="string" id="5967385">&#34;gnu&#34;</span><span class="op" id="5967390">,</span>&nbsp;<span class="string" id="5967392">&#34;star&#34;</span><span class="op" id="5967398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967402">hdr</span><span class="op" id="5967405">.</span><span class="ident" id="5967406">Uname</span>&nbsp;<span class="op" id="5967412">=</span>&nbsp;<span class="ident" id="5967414">cString</span><span class="op" id="5967421">(</span><span class="ident" id="5967422">s</span><span class="op" id="5967423">.</span><span class="ident" id="5967424">next</span><span class="op" id="5967428">(</span><span class="num" id="5967429">32</span><span class="op" id="5967431">)</span><span class="op" id="5967432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967436">hdr</span><span class="op" id="5967439">.</span><span class="ident" id="5967440">Gname</span>&nbsp;<span class="op" id="5967446">=</span>&nbsp;<span class="ident" id="5967448">cString</span><span class="op" id="5967455">(</span><span class="ident" id="5967456">s</span><span class="op" id="5967457">.</span><span class="ident" id="5967458">next</span><span class="op" id="5967462">(</span><span class="num" id="5967463">32</span><span class="op" id="5967465">)</span><span class="op" id="5967466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967470">devmajor</span>&nbsp;<span class="op" id="5967479">:=</span>&nbsp;<span class="ident" id="5967482">s</span><span class="op" id="5967483">.</span><span class="ident" id="5967484">next</span><span class="op" id="5967488">(</span><span class="num" id="5967489">8</span><span class="op" id="5967490">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967494">devminor</span>&nbsp;<span class="op" id="5967503">:=</span>&nbsp;<span class="ident" id="5967506">s</span><span class="op" id="5967507">.</span><span class="ident" id="5967508">next</span><span class="op" id="5967512">(</span><span class="num" id="5967513">8</span><span class="op" id="5967514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967518">if</span>&nbsp;<span class="ident" id="5967521">hdr</span><span class="op" id="5967524">.</span><span class="ident" id="5967525">Typeflag</span>&nbsp;<span class="op" id="5967534">==</span>&nbsp;<span class="ident" id="5967537">TypeChar</span>&nbsp;<span class="op" id="5967546">||</span>&nbsp;<span class="ident" id="5967549">hdr</span><span class="op" id="5967552">.</span><span class="ident" id="5967553">Typeflag</span>&nbsp;<span class="op" id="5967562">==</span>&nbsp;<span class="ident" id="5967565">TypeBlock</span>&nbsp;<span class="op" id="5967575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967580">hdr</span><span class="op" id="5967583">.</span><span class="ident" id="5967584">Devmajor</span>&nbsp;<span class="op" id="5967593">=</span>&nbsp;<span class="ident" id="5967595">tr</span><span class="op" id="5967597">.</span><span class="ident" id="5967598">octal</span><span class="op" id="5967603">(</span><span class="ident" id="5967604">devmajor</span><span class="op" id="5967612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967617">hdr</span><span class="op" id="5967620">.</span><span class="ident" id="5967621">Devminor</span>&nbsp;<span class="op" id="5967630">=</span>&nbsp;<span class="ident" id="5967632">tr</span><span class="op" id="5967634">.</span><span class="ident" id="5967635">octal</span><span class="op" id="5967640">(</span><span class="ident" id="5967641">devminor</span><span class="op" id="5967649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967653">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967657">var</span>&nbsp;<span class="ident" id="5967661">prefix</span>&nbsp;<span class="builtintype" id="5967668">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967677">switch</span>&nbsp;<span class="ident" id="5967684">format</span>&nbsp;<span class="op" id="5967691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967695">case</span>&nbsp;<span class="string" id="5967700">&#34;posix&#34;</span><span class="op" id="5967707">,</span>&nbsp;<span class="string" id="5967709">&#34;gnu&#34;</span><span class="op" id="5967714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967719">prefix</span>&nbsp;<span class="op" id="5967726">=</span>&nbsp;<span class="ident" id="5967728">cString</span><span class="op" id="5967735">(</span><span class="ident" id="5967736">s</span><span class="op" id="5967737">.</span><span class="ident" id="5967738">next</span><span class="op" id="5967742">(</span><span class="num" id="5967743">155</span><span class="op" id="5967746">)</span><span class="op" id="5967747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967751">case</span>&nbsp;<span class="string" id="5967756">&#34;star&#34;</span><span class="op" id="5967762">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967767">prefix</span>&nbsp;<span class="op" id="5967774">=</span>&nbsp;<span class="ident" id="5967776">cString</span><span class="op" id="5967783">(</span><span class="ident" id="5967784">s</span><span class="op" id="5967785">.</span><span class="ident" id="5967786">next</span><span class="op" id="5967790">(</span><span class="num" id="5967791">131</span><span class="op" id="5967794">)</span><span class="op" id="5967795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967800">hdr</span><span class="op" id="5967803">.</span><span class="ident" id="5967804">AccessTime</span>&nbsp;<span class="op" id="5967815">=</span>&nbsp;<span class="ident" id="5967817">time</span><span class="op" id="5967821">.</span><span class="ident" id="5967822">Unix</span><span class="op" id="5967826">(</span><span class="ident" id="5967827">tr</span><span class="op" id="5967829">.</span><span class="ident" id="5967830">octal</span><span class="op" id="5967835">(</span><span class="ident" id="5967836">s</span><span class="op" id="5967837">.</span><span class="ident" id="5967838">next</span><span class="op" id="5967842">(</span><span class="num" id="5967843">12</span><span class="op" id="5967845">)</span><span class="op" id="5967846">)</span><span class="op" id="5967847">,</span>&nbsp;<span class="num" id="5967849">0</span><span class="op" id="5967850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967855">hdr</span><span class="op" id="5967858">.</span><span class="ident" id="5967859">ChangeTime</span>&nbsp;<span class="op" id="5967870">=</span>&nbsp;<span class="ident" id="5967872">time</span><span class="op" id="5967876">.</span><span class="ident" id="5967877">Unix</span><span class="op" id="5967881">(</span><span class="ident" id="5967882">tr</span><span class="op" id="5967884">.</span><span class="ident" id="5967885">octal</span><span class="op" id="5967890">(</span><span class="ident" id="5967891">s</span><span class="op" id="5967892">.</span><span class="ident" id="5967893">next</span><span class="op" id="5967897">(</span><span class="num" id="5967898">12</span><span class="op" id="5967900">)</span><span class="op" id="5967901">)</span><span class="op" id="5967902">,</span>&nbsp;<span class="num" id="5967904">0</span><span class="op" id="5967905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967913">if</span>&nbsp;<span class="builtinfunc" id="5967916">len</span><span class="op" id="5967919">(</span><span class="ident" id="5967920">prefix</span><span class="op" id="5967926">)</span>&nbsp;<span class="op" id="5967928">&gt;</span>&nbsp;<span class="num" id="5967930">0</span>&nbsp;<span class="op" id="5967932">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5967937">hdr</span><span class="op" id="5967940">.</span><span class="ident" id="5967941">Name</span>&nbsp;<span class="op" id="5967946">=</span>&nbsp;<span class="ident" id="5967948">prefix</span>&nbsp;<span class="op" id="5967955">+</span>&nbsp;<span class="string" id="5967957">&#34;/&#34;</span>&nbsp;<span class="op" id="5967961">+</span>&nbsp;<span class="ident" id="5967963">hdr</span><span class="op" id="5967966">.</span><span class="ident" id="5967967">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5967977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5967981">if</span>&nbsp;<span class="ident" id="5967984">tr</span><span class="op" id="5967986">.</span><span class="ident" id="5967987">err</span>&nbsp;<span class="op" id="5967991">!=</span>&nbsp;<span class="builtintype" id="5967994">nil</span>&nbsp;<span class="op" id="5967998">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968002">tr</span><span class="op" id="5968004">.</span><span class="ident" id="5968005">err</span>&nbsp;<span class="op" id="5968009">=</span>&nbsp;<span class="ident" id="5968011">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5968023">return</span>&nbsp;<span class="builtintype" id="5968030">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968039">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968097">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968142">nb</span>&nbsp;<span class="op" id="5968145">:=</span>&nbsp;<span class="builtintype" id="5968148">int64</span><span class="op" id="5968153">(</span><span class="ident" id="5968154">hdr</span><span class="op" id="5968157">.</span><span class="ident" id="5968158">Size</span><span class="op" id="5968162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968165">tr</span><span class="op" id="5968167">.</span><span class="ident" id="5968168">pad</span>&nbsp;<span class="op" id="5968172">=</span>&nbsp;<span class="op" id="5968174">-</span><span class="ident" id="5968175">nb</span>&nbsp;<span class="op" id="5968178">&amp;</span>&nbsp;<span class="op" id="5968180">(</span><span class="ident" id="5968181">blockSize</span>&nbsp;<span class="op" id="5968191">-</span>&nbsp;<span class="num" id="5968193">1</span><span class="op" id="5968194">)</span>&nbsp;<span class="comment" id="5968196">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968229">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968262">tr</span><span class="op" id="5968264">.</span><span class="ident" id="5968265">curr</span>&nbsp;<span class="op" id="5968270">=</span>&nbsp;<span class="op" id="5968272">&amp;</span><span class="ident" id="5968273">regFileReader</span><span class="op" id="5968286">{</span><span class="ident" id="5968287">r</span><span class="op" id="5968288">:</span>&nbsp;<span class="ident" id="5968290">tr</span><span class="op" id="5968292">.</span><span class="ident" id="5968293">r</span><span class="op" id="5968294">,</span>&nbsp;<span class="ident" id="5968296">nb</span><span class="op" id="5968298">:</span>&nbsp;<span class="ident" id="5968300">nb</span><span class="op" id="5968302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968306">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5968349">if</span>&nbsp;<span class="ident" id="5968352">hdr</span><span class="op" id="5968355">.</span><span class="ident" id="5968356">Typeflag</span>&nbsp;<span class="op" id="5968365">==</span>&nbsp;<span class="ident" id="5968368">TypeGNUSparse</span>&nbsp;<span class="op" id="5968382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968386">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968422">hdr</span><span class="op" id="5968425">.</span><span class="ident" id="5968426">Size</span>&nbsp;<span class="op" id="5968431">=</span>&nbsp;<span class="ident" id="5968433">tr</span><span class="op" id="5968435">.</span><span class="ident" id="5968436">octal</span><span class="op" id="5968441">(</span><span class="ident" id="5968442">header</span><span class="op" id="5968448">[</span><span class="num" id="5968449">483</span><span class="op" id="5968452">:</span><span class="num" id="5968453">495</span><span class="op" id="5968456">]</span><span class="op" id="5968457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968462">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968488">sp</span>&nbsp;<span class="op" id="5968491">:=</span>&nbsp;<span class="ident" id="5968494">tr</span><span class="op" id="5968496">.</span><span class="ident" id="5968497">readOldGNUSparseMap</span><span class="op" id="5968516">(</span><span class="ident" id="5968517">header</span><span class="op" id="5968523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5968527">if</span>&nbsp;<span class="ident" id="5968530">tr</span><span class="op" id="5968532">.</span><span class="ident" id="5968533">err</span>&nbsp;<span class="op" id="5968537">!=</span>&nbsp;<span class="builtintype" id="5968540">nil</span>&nbsp;<span class="op" id="5968544">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5968549">return</span>&nbsp;<span class="builtintype" id="5968556">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968566">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968638">tr</span><span class="op" id="5968640">.</span><span class="ident" id="5968641">curr</span>&nbsp;<span class="op" id="5968646">=</span>&nbsp;<span class="op" id="5968648">&amp;</span><span class="ident" id="5968649">sparseFileReader</span><span class="op" id="5968665">{</span><span class="ident" id="5968666">rfr</span><span class="op" id="5968669">:</span>&nbsp;<span class="ident" id="5968671">tr</span><span class="op" id="5968673">.</span><span class="ident" id="5968674">curr</span><span class="op" id="5968678">.</span><span class="op" id="5968679">(</span><span class="op" id="5968680">*</span><span class="ident" id="5968681">regFileReader</span><span class="op" id="5968694">)</span><span class="op" id="5968695">,</span>&nbsp;<span class="ident" id="5968697">sp</span><span class="op" id="5968699">:</span>&nbsp;<span class="ident" id="5968701">sp</span><span class="op" id="5968703">,</span>&nbsp;<span class="ident" id="5968705">tot</span><span class="op" id="5968708">:</span>&nbsp;<span class="ident" id="5968710">hdr</span><span class="op" id="5968713">.</span><span class="ident" id="5968714">Size</span><span class="op" id="5968718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5968721">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5968725">return</span>&nbsp;<span class="ident" id="5968732">hdr</span><br>
<span class="lineno"></span><span class="op" id="5968736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5968739">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5968808">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5968878">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5968896">type</span>&nbsp;<span class="ident" id="5968901">sparseEntry</span>&nbsp;<span class="keyword" id="5968913">struct</span>&nbsp;<span class="op" id="5968920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968923">offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5968932">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5968939">numBytes</span>&nbsp;<span class="builtintype" id="5968948">int64</span><br>
<span class="lineno">545</span><span class="op" id="5968954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5968957">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5969041">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5969143">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5969227">func</span>&nbsp;<span class="op" id="5969232">(</span><span class="ident" id="5969233">tr</span>&nbsp;<span class="op" id="5969236">*</span><span class="ident" id="5969237">Reader</span><span class="op" id="5969243">)</span>&nbsp;<span class="ident" id="5969245">readOldGNUSparseMap</span><span class="op" id="5969264">(</span><span class="ident" id="5969265">header</span>&nbsp;<span class="op" id="5969272">[</span><span class="op" id="5969273">]</span><span class="builtintype" id="5969274">byte</span><span class="op" id="5969278">)</span>&nbsp;<span class="op" id="5969280">[</span><span class="op" id="5969281">]</span><span class="ident" id="5969282">sparseEntry</span>&nbsp;<span class="op" id="5969294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969297">isExtended</span>&nbsp;<span class="op" id="5969308">:=</span>&nbsp;<span class="ident" id="5969311">header</span><span class="op" id="5969317">[</span><span class="ident" id="5969318">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5969356">]</span>&nbsp;<span class="op" id="5969358">!=</span>&nbsp;<span class="num" id="5969361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969364">spCap</span>&nbsp;<span class="op" id="5969370">:=</span>&nbsp;<span class="ident" id="5969373">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969407">if</span>&nbsp;<span class="ident" id="5969410">isExtended</span>&nbsp;<span class="op" id="5969421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969425">spCap</span>&nbsp;<span class="op" id="5969431">+=</span>&nbsp;<span class="ident" id="5969434">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5969472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969475">sp</span>&nbsp;<span class="op" id="5969478">:=</span>&nbsp;<span class="builtinfunc" id="5969481">make</span><span class="op" id="5969485">(</span><span class="op" id="5969486">[</span><span class="op" id="5969487">]</span><span class="ident" id="5969488">sparseEntry</span><span class="op" id="5969499">,</span>&nbsp;<span class="num" id="5969501">0</span><span class="op" id="5969502">,</span>&nbsp;<span class="ident" id="5969504">spCap</span><span class="op" id="5969509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969512">s</span>&nbsp;<span class="op" id="5969514">:=</span>&nbsp;<span class="ident" id="5969517">slicer</span><span class="op" id="5969523">(</span><span class="ident" id="5969524">header</span><span class="op" id="5969530">[</span><span class="ident" id="5969531">oldGNUSparseMainHeaderOffset</span><span class="op" id="5969559">:</span><span class="op" id="5969560">]</span><span class="op" id="5969561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969565">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969616">for</span>&nbsp;<span class="ident" id="5969620">i</span>&nbsp;<span class="op" id="5969622">:=</span>&nbsp;<span class="num" id="5969625">0</span><span class="op" id="5969626">;</span>&nbsp;<span class="ident" id="5969628">i</span>&nbsp;<span class="op" id="5969630">&lt;</span>&nbsp;<span class="ident" id="5969632">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="5969664">;</span>&nbsp;<span class="ident" id="5969666">i</span><span class="op" id="5969667">++</span>&nbsp;<span class="op" id="5969670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969674">offset</span>&nbsp;<span class="op" id="5969681">:=</span>&nbsp;<span class="ident" id="5969684">tr</span><span class="op" id="5969686">.</span><span class="ident" id="5969687">octal</span><span class="op" id="5969692">(</span><span class="ident" id="5969693">s</span><span class="op" id="5969694">.</span><span class="ident" id="5969695">next</span><span class="op" id="5969699">(</span><span class="ident" id="5969700">oldGNUSparseOffsetSize</span><span class="op" id="5969722">)</span><span class="op" id="5969723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969727">numBytes</span>&nbsp;<span class="op" id="5969736">:=</span>&nbsp;<span class="ident" id="5969739">tr</span><span class="op" id="5969741">.</span><span class="ident" id="5969742">octal</span><span class="op" id="5969747">(</span><span class="ident" id="5969748">s</span><span class="op" id="5969749">.</span><span class="ident" id="5969750">next</span><span class="op" id="5969754">(</span><span class="ident" id="5969755">oldGNUSparseNumBytesSize</span><span class="op" id="5969779">)</span><span class="op" id="5969780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969784">if</span>&nbsp;<span class="ident" id="5969787">tr</span><span class="op" id="5969789">.</span><span class="ident" id="5969790">err</span>&nbsp;<span class="op" id="5969794">!=</span>&nbsp;<span class="builtintype" id="5969797">nil</span>&nbsp;<span class="op" id="5969801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969806">tr</span><span class="op" id="5969808">.</span><span class="ident" id="5969809">err</span>&nbsp;<span class="op" id="5969813">=</span>&nbsp;<span class="ident" id="5969815">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969828">return</span>&nbsp;<span class="builtintype" id="5969835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5969841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969845">if</span>&nbsp;<span class="ident" id="5969848">offset</span>&nbsp;<span class="op" id="5969855">==</span>&nbsp;<span class="num" id="5969858">0</span>&nbsp;<span class="op" id="5969860">&amp;&amp;</span>&nbsp;<span class="ident" id="5969863">numBytes</span>&nbsp;<span class="op" id="5969872">==</span>&nbsp;<span class="num" id="5969875">0</span>&nbsp;<span class="op" id="5969877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969882">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5969890">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5969894">sp</span>&nbsp;<span class="op" id="5969897">=</span>&nbsp;<span class="builtinfunc" id="5969899">append</span><span class="op" id="5969905">(</span><span class="ident" id="5969906">sp</span><span class="op" id="5969908">,</span>&nbsp;<span class="ident" id="5969910">sparseEntry</span><span class="op" id="5969921">{</span><span class="ident" id="5969922">offset</span><span class="op" id="5969928">:</span>&nbsp;<span class="ident" id="5969930">offset</span><span class="op" id="5969936">,</span>&nbsp;<span class="ident" id="5969938">numBytes</span><span class="op" id="5969946">:</span>&nbsp;<span class="ident" id="5969948">numBytes</span><span class="op" id="5969956">}</span><span class="op" id="5969957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5969960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5969964">for</span>&nbsp;<span class="ident" id="5969968">isExtended</span>&nbsp;<span class="op" id="5969979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969983">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970060">sparseHeader</span>&nbsp;<span class="op" id="5970073">:=</span>&nbsp;<span class="builtinfunc" id="5970076">make</span><span class="op" id="5970080">(</span><span class="op" id="5970081">[</span><span class="op" id="5970082">]</span><span class="builtintype" id="5970083">byte</span><span class="op" id="5970087">,</span>&nbsp;<span class="ident" id="5970089">blockSize</span><span class="op" id="5970098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970102">if</span>&nbsp;<span class="ident" id="5970105">_</span><span class="op" id="5970106">,</span>&nbsp;<span class="ident" id="5970108">tr</span><span class="op" id="5970110">.</span><span class="ident" id="5970111">err</span>&nbsp;<span class="op" id="5970115">=</span>&nbsp;<span class="ident" id="5970117">io</span><span class="op" id="5970119">.</span><span class="ident" id="5970120">ReadFull</span><span class="op" id="5970128">(</span><span class="ident" id="5970129">tr</span><span class="op" id="5970131">.</span><span class="ident" id="5970132">r</span><span class="op" id="5970133">,</span>&nbsp;<span class="ident" id="5970135">sparseHeader</span><span class="op" id="5970147">)</span><span class="op" id="5970148">;</span>&nbsp;<span class="ident" id="5970150">tr</span><span class="op" id="5970152">.</span><span class="ident" id="5970153">err</span>&nbsp;<span class="op" id="5970157">!=</span>&nbsp;<span class="builtintype" id="5970160">nil</span>&nbsp;<span class="op" id="5970164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970169">return</span>&nbsp;<span class="builtintype" id="5970176">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5970182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970186">isExtended</span>&nbsp;<span class="op" id="5970197">=</span>&nbsp;<span class="ident" id="5970199">sparseHeader</span><span class="op" id="5970211">[</span><span class="ident" id="5970212">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="5970254">]</span>&nbsp;<span class="op" id="5970256">!=</span>&nbsp;<span class="num" id="5970259">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970263">s</span>&nbsp;<span class="op" id="5970265">=</span>&nbsp;<span class="ident" id="5970267">slicer</span><span class="op" id="5970273">(</span><span class="ident" id="5970274">sparseHeader</span><span class="op" id="5970286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970290">for</span>&nbsp;<span class="ident" id="5970294">i</span>&nbsp;<span class="op" id="5970296">:=</span>&nbsp;<span class="num" id="5970299">0</span><span class="op" id="5970300">;</span>&nbsp;<span class="ident" id="5970302">i</span>&nbsp;<span class="op" id="5970304">&lt;</span>&nbsp;<span class="ident" id="5970306">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="5970342">;</span>&nbsp;<span class="ident" id="5970344">i</span><span class="op" id="5970345">++</span>&nbsp;<span class="op" id="5970348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970353">offset</span>&nbsp;<span class="op" id="5970360">:=</span>&nbsp;<span class="ident" id="5970363">tr</span><span class="op" id="5970365">.</span><span class="ident" id="5970366">octal</span><span class="op" id="5970371">(</span><span class="ident" id="5970372">s</span><span class="op" id="5970373">.</span><span class="ident" id="5970374">next</span><span class="op" id="5970378">(</span><span class="ident" id="5970379">oldGNUSparseOffsetSize</span><span class="op" id="5970401">)</span><span class="op" id="5970402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970407">numBytes</span>&nbsp;<span class="op" id="5970416">:=</span>&nbsp;<span class="ident" id="5970419">tr</span><span class="op" id="5970421">.</span><span class="ident" id="5970422">octal</span><span class="op" id="5970427">(</span><span class="ident" id="5970428">s</span><span class="op" id="5970429">.</span><span class="ident" id="5970430">next</span><span class="op" id="5970434">(</span><span class="ident" id="5970435">oldGNUSparseNumBytesSize</span><span class="op" id="5970459">)</span><span class="op" id="5970460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970465">if</span>&nbsp;<span class="ident" id="5970468">tr</span><span class="op" id="5970470">.</span><span class="ident" id="5970471">err</span>&nbsp;<span class="op" id="5970475">!=</span>&nbsp;<span class="builtintype" id="5970478">nil</span>&nbsp;<span class="op" id="5970482">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970488">tr</span><span class="op" id="5970490">.</span><span class="ident" id="5970491">err</span>&nbsp;<span class="op" id="5970495">=</span>&nbsp;<span class="ident" id="5970497">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970511">return</span>&nbsp;<span class="builtintype" id="5970518">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5970525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970530">if</span>&nbsp;<span class="ident" id="5970533">offset</span>&nbsp;<span class="op" id="5970540">==</span>&nbsp;<span class="num" id="5970543">0</span>&nbsp;<span class="op" id="5970545">&amp;&amp;</span>&nbsp;<span class="ident" id="5970548">numBytes</span>&nbsp;<span class="op" id="5970557">==</span>&nbsp;<span class="num" id="5970560">0</span>&nbsp;<span class="op" id="5970562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970568">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5970577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970582">sp</span>&nbsp;<span class="op" id="5970585">=</span>&nbsp;<span class="builtinfunc" id="5970587">append</span><span class="op" id="5970593">(</span><span class="ident" id="5970594">sp</span><span class="op" id="5970596">,</span>&nbsp;<span class="ident" id="5970598">sparseEntry</span><span class="op" id="5970609">{</span><span class="ident" id="5970610">offset</span><span class="op" id="5970616">:</span>&nbsp;<span class="ident" id="5970618">offset</span><span class="op" id="5970624">,</span>&nbsp;<span class="ident" id="5970626">numBytes</span><span class="op" id="5970634">:</span>&nbsp;<span class="ident" id="5970636">numBytes</span><span class="op" id="5970644">}</span><span class="op" id="5970645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5970649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5970652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5970655">return</span>&nbsp;<span class="ident" id="5970662">sp</span><br>
<span class="lineno">595</span><span class="op" id="5970665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5970668">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="5970762">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5970862">func</span>&nbsp;<span class="ident" id="5970867">readGNUSparseMap1x0</span><span class="op" id="5970886">(</span><span class="ident" id="5970887">r</span>&nbsp;<span class="ident" id="5970889">io</span><span class="op" id="5970891">.</span><span class="ident" id="5970892">Reader</span><span class="op" id="5970898">)</span>&nbsp;<span class="op" id="5970900">(</span><span class="op" id="5970901">[</span><span class="op" id="5970902">]</span><span class="ident" id="5970903">sparseEntry</span><span class="op" id="5970914">,</span>&nbsp;<span class="builtintype" id="5970916">error</span><span class="op" id="5970921">)</span>&nbsp;<span class="op" id="5970923">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970926">buf</span>&nbsp;<span class="op" id="5970930">:=</span>&nbsp;<span class="builtinfunc" id="5970933">make</span><span class="op" id="5970937">(</span><span class="op" id="5970938">[</span><span class="op" id="5970939">]</span><span class="builtintype" id="5970940">byte</span><span class="op" id="5970944">,</span>&nbsp;<span class="num" id="5970946">2</span><span class="op" id="5970947">*</span><span class="ident" id="5970948">blockSize</span><span class="op" id="5970957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5970960">sparseHeader</span>&nbsp;<span class="op" id="5970973">:=</span>&nbsp;<span class="ident" id="5970976">buf</span><span class="op" id="5970979">[</span><span class="op" id="5970980">:</span><span class="ident" id="5970981">blockSize</span><span class="op" id="5970990">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970994">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971077">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971149">readDecimal</span>&nbsp;<span class="op" id="5971161">:=</span>&nbsp;<span class="keyword" id="5971164">func</span><span class="op" id="5971168">(</span><span class="op" id="5971169">)</span>&nbsp;<span class="op" id="5971171">(</span><span class="builtintype" id="5971172">int64</span><span class="op" id="5971177">,</span>&nbsp;<span class="builtintype" id="5971179">error</span><span class="op" id="5971184">)</span>&nbsp;<span class="op" id="5971186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971190">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971212">nl</span>&nbsp;<span class="op" id="5971215">:=</span>&nbsp;<span class="ident" id="5971218">bytes</span><span class="op" id="5971223">.</span><span class="ident" id="5971224">IndexByte</span><span class="op" id="5971233">(</span><span class="ident" id="5971234">sparseHeader</span><span class="op" id="5971246">,</span>&nbsp;<span class="string" id="5971248">&#39;\n&#39;</span><span class="op" id="5971252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971256">if</span>&nbsp;<span class="ident" id="5971259">nl</span>&nbsp;<span class="op" id="5971262">==</span>&nbsp;<span class="op" id="5971265">-</span><span class="num" id="5971266">1</span>&nbsp;<span class="op" id="5971268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971273">if</span>&nbsp;<span class="builtinfunc" id="5971276">len</span><span class="op" id="5971279">(</span><span class="ident" id="5971280">sparseHeader</span><span class="op" id="5971292">)</span>&nbsp;<span class="op" id="5971294">&gt;=</span>&nbsp;<span class="ident" id="5971297">blockSize</span>&nbsp;<span class="op" id="5971307">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971313">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971337">return</span>&nbsp;<span class="num" id="5971344">0</span><span class="op" id="5971345">,</span>&nbsp;<span class="ident" id="5971347">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5971360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971365">oldLen</span>&nbsp;<span class="op" id="5971372">:=</span>&nbsp;<span class="builtinfunc" id="5971375">len</span><span class="op" id="5971378">(</span><span class="ident" id="5971379">sparseHeader</span><span class="op" id="5971391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971396">newLen</span>&nbsp;<span class="op" id="5971403">:=</span>&nbsp;<span class="ident" id="5971406">oldLen</span>&nbsp;<span class="op" id="5971413">+</span>&nbsp;<span class="ident" id="5971415">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971428">if</span>&nbsp;<span class="builtinfunc" id="5971431">cap</span><span class="op" id="5971434">(</span><span class="ident" id="5971435">sparseHeader</span><span class="op" id="5971447">)</span>&nbsp;<span class="op" id="5971449">&lt;</span>&nbsp;<span class="ident" id="5971451">newLen</span>&nbsp;<span class="op" id="5971458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971464">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5971536">copy</span><span class="op" id="5971540">(</span><span class="ident" id="5971541">buf</span><span class="op" id="5971544">,</span>&nbsp;<span class="ident" id="5971546">sparseHeader</span><span class="op" id="5971558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971564">sparseHeader</span>&nbsp;<span class="op" id="5971577">=</span>&nbsp;<span class="ident" id="5971579">buf</span><span class="op" id="5971582">[</span><span class="op" id="5971583">:</span><span class="ident" id="5971584">newLen</span><span class="op" id="5971590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5971595">}</span>&nbsp;<span class="keyword" id="5971597">else</span>&nbsp;<span class="op" id="5971602">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971608">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971660">sparseHeader</span>&nbsp;<span class="op" id="5971673">=</span>&nbsp;<span class="ident" id="5971675">sparseHeader</span><span class="op" id="5971687">[</span><span class="op" id="5971688">:</span><span class="ident" id="5971689">newLen</span><span class="op" id="5971695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5971700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971706">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971767">if</span>&nbsp;<span class="ident" id="5971770">_</span><span class="op" id="5971771">,</span>&nbsp;<span class="ident" id="5971773">err</span>&nbsp;<span class="op" id="5971777">:=</span>&nbsp;<span class="ident" id="5971780">io</span><span class="op" id="5971782">.</span><span class="ident" id="5971783">ReadFull</span><span class="op" id="5971791">(</span><span class="ident" id="5971792">r</span><span class="op" id="5971793">,</span>&nbsp;<span class="ident" id="5971795">sparseHeader</span><span class="op" id="5971807">[</span><span class="ident" id="5971808">oldLen</span><span class="op" id="5971814">:</span><span class="ident" id="5971815">newLen</span><span class="op" id="5971821">]</span><span class="op" id="5971822">)</span><span class="op" id="5971823">;</span>&nbsp;<span class="ident" id="5971825">err</span>&nbsp;<span class="op" id="5971829">!=</span>&nbsp;<span class="builtintype" id="5971832">nil</span>&nbsp;<span class="op" id="5971836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971842">return</span>&nbsp;<span class="num" id="5971849">0</span><span class="op" id="5971850">,</span>&nbsp;<span class="ident" id="5971852">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5971859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971865">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971906">nl</span>&nbsp;<span class="op" id="5971909">=</span>&nbsp;<span class="ident" id="5971911">bytes</span><span class="op" id="5971916">.</span><span class="ident" id="5971917">IndexByte</span><span class="op" id="5971926">(</span><span class="ident" id="5971927">sparseHeader</span><span class="op" id="5971939">[</span><span class="ident" id="5971940">oldLen</span><span class="op" id="5971946">:</span><span class="ident" id="5971947">newLen</span><span class="op" id="5971953">]</span><span class="op" id="5971954">,</span>&nbsp;<span class="string" id="5971956">&#39;\n&#39;</span><span class="op" id="5971960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5971965">if</span>&nbsp;<span class="ident" id="5971968">nl</span>&nbsp;<span class="op" id="5971971">==</span>&nbsp;<span class="op" id="5971974">-</span><span class="num" id="5971975">1</span>&nbsp;<span class="op" id="5971977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5971983">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972007">return</span>&nbsp;<span class="num" id="5972014">0</span><span class="op" id="5972015">,</span>&nbsp;<span class="ident" id="5972017">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972030">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972035">nl</span>&nbsp;<span class="op" id="5972038">+=</span>&nbsp;<span class="ident" id="5972041">oldLen</span>&nbsp;<span class="comment" id="5972048">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972097">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972148">n</span><span class="op" id="5972149">,</span>&nbsp;<span class="ident" id="5972151">err</span>&nbsp;<span class="op" id="5972155">:=</span>&nbsp;<span class="ident" id="5972158">strconv</span><span class="op" id="5972165">.</span><span class="ident" id="5972166">ParseInt</span><span class="op" id="5972174">(</span><span class="builtintype" id="5972175">string</span><span class="op" id="5972181">(</span><span class="ident" id="5972182">sparseHeader</span><span class="op" id="5972194">[</span><span class="op" id="5972195">:</span><span class="ident" id="5972196">nl</span><span class="op" id="5972198">]</span><span class="op" id="5972199">)</span><span class="op" id="5972200">,</span>&nbsp;<span class="num" id="5972202">10</span><span class="op" id="5972204">,</span>&nbsp;<span class="num" id="5972206">0</span><span class="op" id="5972207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972211">if</span>&nbsp;<span class="ident" id="5972214">err</span>&nbsp;<span class="op" id="5972218">!=</span>&nbsp;<span class="builtintype" id="5972221">nil</span>&nbsp;<span class="op" id="5972225">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972230">return</span>&nbsp;<span class="num" id="5972237">0</span><span class="op" id="5972238">,</span>&nbsp;<span class="ident" id="5972240">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972257">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972305">sparseHeader</span>&nbsp;<span class="op" id="5972318">=</span>&nbsp;<span class="ident" id="5972320">sparseHeader</span><span class="op" id="5972332">[</span><span class="ident" id="5972333">nl</span><span class="op" id="5972335">+</span><span class="num" id="5972336">1</span><span class="op" id="5972337">:</span><span class="op" id="5972338">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972342">return</span>&nbsp;<span class="ident" id="5972349">n</span><span class="op" id="5972350">,</span>&nbsp;<span class="builtintype" id="5972352">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972361">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972386">if</span>&nbsp;<span class="ident" id="5972389">_</span><span class="op" id="5972390">,</span>&nbsp;<span class="ident" id="5972392">err</span>&nbsp;<span class="op" id="5972396">:=</span>&nbsp;<span class="ident" id="5972399">io</span><span class="op" id="5972401">.</span><span class="ident" id="5972402">ReadFull</span><span class="op" id="5972410">(</span><span class="ident" id="5972411">r</span><span class="op" id="5972412">,</span>&nbsp;<span class="ident" id="5972414">sparseHeader</span><span class="op" id="5972426">)</span><span class="op" id="5972427">;</span>&nbsp;<span class="ident" id="5972429">err</span>&nbsp;<span class="op" id="5972433">!=</span>&nbsp;<span class="builtintype" id="5972436">nil</span>&nbsp;<span class="op" id="5972440">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972444">return</span>&nbsp;<span class="builtintype" id="5972451">nil</span><span class="op" id="5972454">,</span>&nbsp;<span class="ident" id="5972456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972465">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972515">numEntries</span><span class="op" id="5972525">,</span>&nbsp;<span class="ident" id="5972527">err</span>&nbsp;<span class="op" id="5972531">:=</span>&nbsp;<span class="ident" id="5972534">readDecimal</span><span class="op" id="5972545">(</span><span class="op" id="5972546">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972549">if</span>&nbsp;<span class="ident" id="5972552">err</span>&nbsp;<span class="op" id="5972556">!=</span>&nbsp;<span class="builtintype" id="5972559">nil</span>&nbsp;<span class="op" id="5972563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972567">return</span>&nbsp;<span class="builtintype" id="5972574">nil</span><span class="op" id="5972577">,</span>&nbsp;<span class="ident" id="5972579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972588">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972613">sp</span>&nbsp;<span class="op" id="5972616">:=</span>&nbsp;<span class="builtinfunc" id="5972619">make</span><span class="op" id="5972623">(</span><span class="op" id="5972624">[</span><span class="op" id="5972625">]</span><span class="ident" id="5972626">sparseEntry</span><span class="op" id="5972637">,</span>&nbsp;<span class="num" id="5972639">0</span><span class="op" id="5972640">,</span>&nbsp;<span class="ident" id="5972642">numEntries</span><span class="op" id="5972652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972655">for</span>&nbsp;<span class="ident" id="5972659">i</span>&nbsp;<span class="op" id="5972661">:=</span>&nbsp;<span class="builtintype" id="5972664">int64</span><span class="op" id="5972669">(</span><span class="num" id="5972670">0</span><span class="op" id="5972671">)</span><span class="op" id="5972672">;</span>&nbsp;<span class="ident" id="5972674">i</span>&nbsp;<span class="op" id="5972676">&lt;</span>&nbsp;<span class="ident" id="5972678">numEntries</span><span class="op" id="5972688">;</span>&nbsp;<span class="ident" id="5972690">i</span><span class="op" id="5972691">++</span>&nbsp;<span class="op" id="5972694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972698">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972719">offset</span><span class="op" id="5972725">,</span>&nbsp;<span class="ident" id="5972727">err</span>&nbsp;<span class="op" id="5972731">:=</span>&nbsp;<span class="ident" id="5972734">readDecimal</span><span class="op" id="5972745">(</span><span class="op" id="5972746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972750">if</span>&nbsp;<span class="ident" id="5972753">err</span>&nbsp;<span class="op" id="5972757">!=</span>&nbsp;<span class="builtintype" id="5972760">nil</span>&nbsp;<span class="op" id="5972764">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972769">return</span>&nbsp;<span class="builtintype" id="5972776">nil</span><span class="op" id="5972779">,</span>&nbsp;<span class="ident" id="5972781">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5972791">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972810">numBytes</span><span class="op" id="5972818">,</span>&nbsp;<span class="ident" id="5972820">err</span>&nbsp;<span class="op" id="5972824">:=</span>&nbsp;<span class="ident" id="5972827">readDecimal</span><span class="op" id="5972838">(</span><span class="op" id="5972839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972843">if</span>&nbsp;<span class="ident" id="5972846">err</span>&nbsp;<span class="op" id="5972850">!=</span>&nbsp;<span class="builtintype" id="5972853">nil</span>&nbsp;<span class="op" id="5972857">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972862">return</span>&nbsp;<span class="builtintype" id="5972869">nil</span><span class="op" id="5972872">,</span>&nbsp;<span class="ident" id="5972874">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972885">sp</span>&nbsp;<span class="op" id="5972888">=</span>&nbsp;<span class="builtinfunc" id="5972890">append</span><span class="op" id="5972896">(</span><span class="ident" id="5972897">sp</span><span class="op" id="5972899">,</span>&nbsp;<span class="ident" id="5972901">sparseEntry</span><span class="op" id="5972912">{</span><span class="ident" id="5972913">offset</span><span class="op" id="5972919">:</span>&nbsp;<span class="ident" id="5972921">offset</span><span class="op" id="5972927">,</span>&nbsp;<span class="ident" id="5972929">numBytes</span><span class="op" id="5972937">:</span>&nbsp;<span class="ident" id="5972939">numBytes</span><span class="op" id="5972947">}</span><span class="op" id="5972948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5972951">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5972955">return</span>&nbsp;<span class="ident" id="5972962">sp</span><span class="op" id="5972964">,</span>&nbsp;<span class="builtintype" id="5972966">nil</span><br>
<span class="lineno"></span><span class="op" id="5972970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5972973">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="5973067">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5973115">func</span>&nbsp;<span class="ident" id="5973120">readGNUSparseMap0x1</span><span class="op" id="5973139">(</span><span class="ident" id="5973140">headers</span>&nbsp;<span class="keyword" id="5973148">map</span><span class="op" id="5973151">[</span><span class="builtintype" id="5973152">string</span><span class="op" id="5973158">]</span><span class="builtintype" id="5973159">string</span><span class="op" id="5973165">)</span>&nbsp;<span class="op" id="5973167">(</span><span class="op" id="5973168">[</span><span class="op" id="5973169">]</span><span class="ident" id="5973170">sparseEntry</span><span class="op" id="5973181">,</span>&nbsp;<span class="builtintype" id="5973183">error</span><span class="op" id="5973188">)</span>&nbsp;<span class="op" id="5973190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5973193">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973219">numEntriesStr</span><span class="op" id="5973232">,</span>&nbsp;<span class="ident" id="5973234">ok</span>&nbsp;<span class="op" id="5973237">:=</span>&nbsp;<span class="ident" id="5973240">headers</span><span class="op" id="5973247">[</span><span class="ident" id="5973248">paxGNUSparseNumBlocks</span><span class="op" id="5973269">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973272">if</span>&nbsp;<span class="op" id="5973275">!</span><span class="ident" id="5973276">ok</span>&nbsp;<span class="op" id="5973279">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973283">return</span>&nbsp;<span class="builtintype" id="5973290">nil</span><span class="op" id="5973293">,</span>&nbsp;<span class="ident" id="5973295">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5973306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973309">numEntries</span><span class="op" id="5973319">,</span>&nbsp;<span class="ident" id="5973321">err</span>&nbsp;<span class="op" id="5973325">:=</span>&nbsp;<span class="ident" id="5973328">strconv</span><span class="op" id="5973335">.</span><span class="ident" id="5973336">ParseInt</span><span class="op" id="5973344">(</span><span class="ident" id="5973345">numEntriesStr</span><span class="op" id="5973358">,</span>&nbsp;<span class="num" id="5973360">10</span><span class="op" id="5973362">,</span>&nbsp;<span class="num" id="5973364">0</span><span class="op" id="5973365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973368">if</span>&nbsp;<span class="ident" id="5973371">err</span>&nbsp;<span class="op" id="5973375">!=</span>&nbsp;<span class="builtintype" id="5973378">nil</span>&nbsp;<span class="op" id="5973382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973386">return</span>&nbsp;<span class="builtintype" id="5973393">nil</span><span class="op" id="5973396">,</span>&nbsp;<span class="ident" id="5973398">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5973409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973413">sparseMap</span>&nbsp;<span class="op" id="5973423">:=</span>&nbsp;<span class="ident" id="5973426">strings</span><span class="op" id="5973433">.</span><span class="ident" id="5973434">Split</span><span class="op" id="5973439">(</span><span class="ident" id="5973440">headers</span><span class="op" id="5973447">[</span><span class="ident" id="5973448">paxGNUSparseMap</span><span class="op" id="5973463">]</span><span class="op" id="5973464">,</span>&nbsp;<span class="string" id="5973466">&#34;,&#34;</span><span class="op" id="5973469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5973473">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973533">if</span>&nbsp;<span class="builtintype" id="5973536">int64</span><span class="op" id="5973541">(</span><span class="builtinfunc" id="5973542">len</span><span class="op" id="5973545">(</span><span class="ident" id="5973546">sparseMap</span><span class="op" id="5973555">)</span><span class="op" id="5973556">)</span>&nbsp;<span class="op" id="5973558">!=</span>&nbsp;<span class="num" id="5973561">2</span><span class="op" id="5973562">*</span><span class="ident" id="5973563">numEntries</span>&nbsp;<span class="op" id="5973574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973578">return</span>&nbsp;<span class="builtintype" id="5973585">nil</span><span class="op" id="5973588">,</span>&nbsp;<span class="ident" id="5973590">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5973601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5973605">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973652">sp</span>&nbsp;<span class="op" id="5973655">:=</span>&nbsp;<span class="builtinfunc" id="5973658">make</span><span class="op" id="5973662">(</span><span class="op" id="5973663">[</span><span class="op" id="5973664">]</span><span class="ident" id="5973665">sparseEntry</span><span class="op" id="5973676">,</span>&nbsp;<span class="num" id="5973678">0</span><span class="op" id="5973679">,</span>&nbsp;<span class="ident" id="5973681">numEntries</span><span class="op" id="5973691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973694">for</span>&nbsp;<span class="ident" id="5973698">i</span>&nbsp;<span class="op" id="5973700">:=</span>&nbsp;<span class="builtintype" id="5973703">int64</span><span class="op" id="5973708">(</span><span class="num" id="5973709">0</span><span class="op" id="5973710">)</span><span class="op" id="5973711">;</span>&nbsp;<span class="ident" id="5973713">i</span>&nbsp;<span class="op" id="5973715">&lt;</span>&nbsp;<span class="ident" id="5973717">numEntries</span><span class="op" id="5973727">;</span>&nbsp;<span class="ident" id="5973729">i</span><span class="op" id="5973730">++</span>&nbsp;<span class="op" id="5973733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973737">offset</span><span class="op" id="5973743">,</span>&nbsp;<span class="ident" id="5973745">err</span>&nbsp;<span class="op" id="5973749">:=</span>&nbsp;<span class="ident" id="5973752">strconv</span><span class="op" id="5973759">.</span><span class="ident" id="5973760">ParseInt</span><span class="op" id="5973768">(</span><span class="ident" id="5973769">sparseMap</span><span class="op" id="5973778">[</span><span class="num" id="5973779">2</span><span class="op" id="5973780">*</span><span class="ident" id="5973781">i</span><span class="op" id="5973782">]</span><span class="op" id="5973783">,</span>&nbsp;<span class="num" id="5973785">10</span><span class="op" id="5973787">,</span>&nbsp;<span class="num" id="5973789">0</span><span class="op" id="5973790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973794">if</span>&nbsp;<span class="ident" id="5973797">err</span>&nbsp;<span class="op" id="5973801">!=</span>&nbsp;<span class="builtintype" id="5973804">nil</span>&nbsp;<span class="op" id="5973808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973813">return</span>&nbsp;<span class="builtintype" id="5973820">nil</span><span class="op" id="5973823">,</span>&nbsp;<span class="ident" id="5973825">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5973837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973841">numBytes</span><span class="op" id="5973849">,</span>&nbsp;<span class="ident" id="5973851">err</span>&nbsp;<span class="op" id="5973855">:=</span>&nbsp;<span class="ident" id="5973858">strconv</span><span class="op" id="5973865">.</span><span class="ident" id="5973866">ParseInt</span><span class="op" id="5973874">(</span><span class="ident" id="5973875">sparseMap</span><span class="op" id="5973884">[</span><span class="num" id="5973885">2</span><span class="op" id="5973886">*</span><span class="ident" id="5973887">i</span><span class="op" id="5973888">+</span><span class="num" id="5973889">1</span><span class="op" id="5973890">]</span><span class="op" id="5973891">,</span>&nbsp;<span class="num" id="5973893">10</span><span class="op" id="5973895">,</span>&nbsp;<span class="num" id="5973897">0</span><span class="op" id="5973898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973902">if</span>&nbsp;<span class="ident" id="5973905">err</span>&nbsp;<span class="op" id="5973909">!=</span>&nbsp;<span class="builtintype" id="5973912">nil</span>&nbsp;<span class="op" id="5973916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5973921">return</span>&nbsp;<span class="builtintype" id="5973928">nil</span><span class="op" id="5973931">,</span>&nbsp;<span class="ident" id="5973933">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5973945">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5973949">sp</span>&nbsp;<span class="op" id="5973952">=</span>&nbsp;<span class="builtinfunc" id="5973954">append</span><span class="op" id="5973960">(</span><span class="ident" id="5973961">sp</span><span class="op" id="5973963">,</span>&nbsp;<span class="ident" id="5973965">sparseEntry</span><span class="op" id="5973976">{</span><span class="ident" id="5973977">offset</span><span class="op" id="5973983">:</span>&nbsp;<span class="ident" id="5973985">offset</span><span class="op" id="5973991">,</span>&nbsp;<span class="ident" id="5973993">numBytes</span><span class="op" id="5974001">:</span>&nbsp;<span class="ident" id="5974003">numBytes</span><span class="op" id="5974011">}</span><span class="op" id="5974012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974019">return</span>&nbsp;<span class="ident" id="5974026">sp</span><span class="op" id="5974028">,</span>&nbsp;<span class="builtintype" id="5974030">nil</span><br>
<span class="lineno"></span><span class="op" id="5974034">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="5974037">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5974118">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5974175">func</span>&nbsp;<span class="op" id="5974180">(</span><span class="ident" id="5974181">tr</span>&nbsp;<span class="op" id="5974184">*</span><span class="ident" id="5974185">Reader</span><span class="op" id="5974191">)</span>&nbsp;<span class="ident" id="5974193">numBytes</span><span class="op" id="5974201">(</span><span class="op" id="5974202">)</span>&nbsp;<span class="builtintype" id="5974204">int64</span>&nbsp;<span class="op" id="5974210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974213">if</span>&nbsp;<span class="ident" id="5974216">tr</span><span class="op" id="5974218">.</span><span class="ident" id="5974219">curr</span>&nbsp;<span class="op" id="5974224">==</span>&nbsp;<span class="builtintype" id="5974227">nil</span>&nbsp;<span class="op" id="5974231">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5974235">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974269">return</span>&nbsp;<span class="num" id="5974276">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974282">return</span>&nbsp;<span class="ident" id="5974289">tr</span><span class="op" id="5974291">.</span><span class="ident" id="5974292">curr</span><span class="op" id="5974296">.</span><span class="ident" id="5974297">numBytes</span><span class="op" id="5974305">(</span><span class="op" id="5974306">)</span><br>
<span class="lineno"></span><span class="op" id="5974308">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5974311">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5974368">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="5974431">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="5974485">func</span>&nbsp;<span class="op" id="5974490">(</span><span class="ident" id="5974491">tr</span>&nbsp;<span class="op" id="5974494">*</span><span class="ident" id="5974495">Reader</span><span class="op" id="5974501">)</span>&nbsp;<span class="ident" id="5974503">Read</span><span class="op" id="5974507">(</span><span class="ident" id="5974508">b</span>&nbsp;<span class="op" id="5974510">[</span><span class="op" id="5974511">]</span><span class="builtintype" id="5974512">byte</span><span class="op" id="5974516">)</span>&nbsp;<span class="op" id="5974518">(</span><span class="ident" id="5974519">n</span>&nbsp;<span class="builtintype" id="5974521">int</span><span class="op" id="5974524">,</span>&nbsp;<span class="ident" id="5974526">err</span>&nbsp;<span class="builtintype" id="5974530">error</span><span class="op" id="5974535">)</span>&nbsp;<span class="op" id="5974537">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974540">if</span>&nbsp;<span class="ident" id="5974543">tr</span><span class="op" id="5974545">.</span><span class="ident" id="5974546">curr</span>&nbsp;<span class="op" id="5974551">==</span>&nbsp;<span class="builtintype" id="5974554">nil</span>&nbsp;<span class="op" id="5974558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974562">return</span>&nbsp;<span class="num" id="5974569">0</span><span class="op" id="5974570">,</span>&nbsp;<span class="ident" id="5974572">io</span><span class="op" id="5974574">.</span><span class="ident" id="5974575">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974583">n</span><span class="op" id="5974584">,</span>&nbsp;<span class="ident" id="5974586">err</span>&nbsp;<span class="op" id="5974590">=</span>&nbsp;<span class="ident" id="5974592">tr</span><span class="op" id="5974594">.</span><span class="ident" id="5974595">curr</span><span class="op" id="5974599">.</span><span class="ident" id="5974600">Read</span><span class="op" id="5974604">(</span><span class="ident" id="5974605">b</span><span class="op" id="5974606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974609">if</span>&nbsp;<span class="ident" id="5974612">err</span>&nbsp;<span class="op" id="5974616">!=</span>&nbsp;<span class="builtintype" id="5974619">nil</span>&nbsp;<span class="op" id="5974623">&amp;&amp;</span>&nbsp;<span class="ident" id="5974626">err</span>&nbsp;<span class="op" id="5974630">!=</span>&nbsp;<span class="ident" id="5974633">io</span><span class="op" id="5974635">.</span><span class="ident" id="5974636">EOF</span>&nbsp;<span class="op" id="5974640">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974644">tr</span><span class="op" id="5974646">.</span><span class="ident" id="5974647">err</span>&nbsp;<span class="op" id="5974651">=</span>&nbsp;<span class="ident" id="5974653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974661">return</span><br>
<span class="lineno"></span><span class="op" id="5974668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="5974671">func</span>&nbsp;<span class="op" id="5974676">(</span><span class="ident" id="5974677">rfr</span>&nbsp;<span class="op" id="5974681">*</span><span class="ident" id="5974682">regFileReader</span><span class="op" id="5974695">)</span>&nbsp;<span class="ident" id="5974697">Read</span><span class="op" id="5974701">(</span><span class="ident" id="5974702">b</span>&nbsp;<span class="op" id="5974704">[</span><span class="op" id="5974705">]</span><span class="builtintype" id="5974706">byte</span><span class="op" id="5974710">)</span>&nbsp;<span class="op" id="5974712">(</span><span class="ident" id="5974713">n</span>&nbsp;<span class="builtintype" id="5974715">int</span><span class="op" id="5974718">,</span>&nbsp;<span class="ident" id="5974720">err</span>&nbsp;<span class="builtintype" id="5974724">error</span><span class="op" id="5974729">)</span>&nbsp;<span class="op" id="5974731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974734">if</span>&nbsp;<span class="ident" id="5974737">rfr</span><span class="op" id="5974740">.</span><span class="ident" id="5974741">nb</span>&nbsp;<span class="op" id="5974744">==</span>&nbsp;<span class="num" id="5974747">0</span>&nbsp;<span class="op" id="5974749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5974753">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974772">return</span>&nbsp;<span class="num" id="5974779">0</span><span class="op" id="5974780">,</span>&nbsp;<span class="ident" id="5974782">io</span><span class="op" id="5974784">.</span><span class="ident" id="5974785">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974790">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974793">if</span>&nbsp;<span class="builtintype" id="5974796">int64</span><span class="op" id="5974801">(</span><span class="builtinfunc" id="5974802">len</span><span class="op" id="5974805">(</span><span class="ident" id="5974806">b</span><span class="op" id="5974807">)</span><span class="op" id="5974808">)</span>&nbsp;<span class="op" id="5974810">&gt;</span>&nbsp;<span class="ident" id="5974812">rfr</span><span class="op" id="5974815">.</span><span class="ident" id="5974816">nb</span>&nbsp;<span class="op" id="5974819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974823">b</span>&nbsp;<span class="op" id="5974825">=</span>&nbsp;<span class="ident" id="5974827">b</span><span class="op" id="5974828">[</span><span class="num" id="5974829">0</span><span class="op" id="5974830">:</span><span class="ident" id="5974831">rfr</span><span class="op" id="5974834">.</span><span class="ident" id="5974835">nb</span><span class="op" id="5974837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974843">n</span><span class="op" id="5974844">,</span>&nbsp;<span class="ident" id="5974846">err</span>&nbsp;<span class="op" id="5974850">=</span>&nbsp;<span class="ident" id="5974852">rfr</span><span class="op" id="5974855">.</span><span class="ident" id="5974856">r</span><span class="op" id="5974857">.</span><span class="ident" id="5974858">Read</span><span class="op" id="5974862">(</span><span class="ident" id="5974863">b</span><span class="op" id="5974864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974867">rfr</span><span class="op" id="5974870">.</span><span class="ident" id="5974871">nb</span>&nbsp;<span class="op" id="5974874">-=</span>&nbsp;<span class="builtintype" id="5974877">int64</span><span class="op" id="5974882">(</span><span class="ident" id="5974883">n</span><span class="op" id="5974884">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974888">if</span>&nbsp;<span class="ident" id="5974891">err</span>&nbsp;<span class="op" id="5974895">==</span>&nbsp;<span class="ident" id="5974898">io</span><span class="op" id="5974900">.</span><span class="ident" id="5974901">EOF</span>&nbsp;<span class="op" id="5974905">&amp;&amp;</span>&nbsp;<span class="ident" id="5974908">rfr</span><span class="op" id="5974911">.</span><span class="ident" id="5974912">nb</span>&nbsp;<span class="op" id="5974915">&gt;</span>&nbsp;<span class="num" id="5974917">0</span>&nbsp;<span class="op" id="5974919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974923">err</span>&nbsp;<span class="op" id="5974927">=</span>&nbsp;<span class="ident" id="5974929">io</span><span class="op" id="5974931">.</span><span class="ident" id="5974932">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5974950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5974953">return</span><br>
<span class="lineno">755</span><span class="op" id="5974960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974963">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5975055">func</span>&nbsp;<span class="op" id="5975060">(</span><span class="ident" id="5975061">rfr</span>&nbsp;<span class="op" id="5975065">*</span><span class="ident" id="5975066">regFileReader</span><span class="op" id="5975079">)</span>&nbsp;<span class="ident" id="5975081">numBytes</span><span class="op" id="5975089">(</span><span class="op" id="5975090">)</span>&nbsp;<span class="builtintype" id="5975092">int64</span>&nbsp;<span class="op" id="5975098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975101">return</span>&nbsp;<span class="ident" id="5975108">rfr</span><span class="op" id="5975111">.</span><span class="ident" id="5975112">nb</span><br>
<span class="lineno">760</span><span class="op" id="5975115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975118">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="5975181">func</span>&nbsp;<span class="op" id="5975186">(</span><span class="ident" id="5975187">sfr</span>&nbsp;<span class="op" id="5975191">*</span><span class="ident" id="5975192">sparseFileReader</span><span class="op" id="5975208">)</span>&nbsp;<span class="ident" id="5975210">readHole</span><span class="op" id="5975218">(</span><span class="ident" id="5975219">b</span>&nbsp;<span class="op" id="5975221">[</span><span class="op" id="5975222">]</span><span class="builtintype" id="5975223">byte</span><span class="op" id="5975227">,</span>&nbsp;<span class="ident" id="5975229">toOffset</span>&nbsp;<span class="builtintype" id="5975238">int64</span><span class="op" id="5975243">)</span>&nbsp;<span class="builtintype" id="5975245">int</span>&nbsp;<span class="op" id="5975249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975252">n64</span>&nbsp;<span class="op" id="5975256">:=</span>&nbsp;<span class="ident" id="5975259">toOffset</span>&nbsp;<span class="op" id="5975268">-</span>&nbsp;<span class="ident" id="5975270">sfr</span><span class="op" id="5975273">.</span><span class="ident" id="5975274">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975279">if</span>&nbsp;<span class="ident" id="5975282">n64</span>&nbsp;<span class="op" id="5975286">&gt;</span>&nbsp;<span class="builtintype" id="5975288">int64</span><span class="op" id="5975293">(</span><span class="builtinfunc" id="5975294">len</span><span class="op" id="5975297">(</span><span class="ident" id="5975298">b</span><span class="op" id="5975299">)</span><span class="op" id="5975300">)</span>&nbsp;<span class="op" id="5975302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975306">n64</span>&nbsp;<span class="op" id="5975310">=</span>&nbsp;<span class="builtintype" id="5975312">int64</span><span class="op" id="5975317">(</span><span class="builtinfunc" id="5975318">len</span><span class="op" id="5975321">(</span><span class="ident" id="5975322">b</span><span class="op" id="5975323">)</span><span class="op" id="5975324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5975327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975330">n</span>&nbsp;<span class="op" id="5975332">:=</span>&nbsp;<span class="builtintype" id="5975335">int</span><span class="op" id="5975338">(</span><span class="ident" id="5975339">n64</span><span class="op" id="5975342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975345">for</span>&nbsp;<span class="ident" id="5975349">i</span>&nbsp;<span class="op" id="5975351">:=</span>&nbsp;<span class="num" id="5975354">0</span><span class="op" id="5975355">;</span>&nbsp;<span class="ident" id="5975357">i</span>&nbsp;<span class="op" id="5975359">&lt;</span>&nbsp;<span class="ident" id="5975361">n</span><span class="op" id="5975362">;</span>&nbsp;<span class="ident" id="5975364">i</span><span class="op" id="5975365">++</span>&nbsp;<span class="op" id="5975368">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975372">b</span><span class="op" id="5975373">[</span><span class="ident" id="5975374">i</span><span class="op" id="5975375">]</span>&nbsp;<span class="op" id="5975377">=</span>&nbsp;<span class="num" id="5975379">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5975382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975385">sfr</span><span class="op" id="5975388">.</span><span class="ident" id="5975389">pos</span>&nbsp;<span class="op" id="5975393">+=</span>&nbsp;<span class="ident" id="5975396">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975401">return</span>&nbsp;<span class="ident" id="5975408">n</span><br>
<span class="lineno"></span><span class="op" id="5975410">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="5975413">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="5975466">func</span>&nbsp;<span class="op" id="5975471">(</span><span class="ident" id="5975472">sfr</span>&nbsp;<span class="op" id="5975476">*</span><span class="ident" id="5975477">sparseFileReader</span><span class="op" id="5975493">)</span>&nbsp;<span class="ident" id="5975495">Read</span><span class="op" id="5975499">(</span><span class="ident" id="5975500">b</span>&nbsp;<span class="op" id="5975502">[</span><span class="op" id="5975503">]</span><span class="builtintype" id="5975504">byte</span><span class="op" id="5975508">)</span>&nbsp;<span class="op" id="5975510">(</span><span class="ident" id="5975511">n</span>&nbsp;<span class="builtintype" id="5975513">int</span><span class="op" id="5975516">,</span>&nbsp;<span class="ident" id="5975518">err</span>&nbsp;<span class="builtintype" id="5975522">error</span><span class="op" id="5975527">)</span>&nbsp;<span class="op" id="5975529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975532">if</span>&nbsp;<span class="builtinfunc" id="5975535">len</span><span class="op" id="5975538">(</span><span class="ident" id="5975539">sfr</span><span class="op" id="5975542">.</span><span class="ident" id="5975543">sp</span><span class="op" id="5975545">)</span>&nbsp;<span class="op" id="5975547">==</span>&nbsp;<span class="num" id="5975550">0</span>&nbsp;<span class="op" id="5975552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5975556">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975598">if</span>&nbsp;<span class="ident" id="5975601">sfr</span><span class="op" id="5975604">.</span><span class="ident" id="5975605">pos</span>&nbsp;<span class="op" id="5975609">&lt;</span>&nbsp;<span class="ident" id="5975611">sfr</span><span class="op" id="5975614">.</span><span class="ident" id="5975615">tot</span>&nbsp;<span class="op" id="5975619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5975624">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975653">n</span>&nbsp;<span class="op" id="5975655">=</span>&nbsp;<span class="ident" id="5975657">sfr</span><span class="op" id="5975660">.</span><span class="ident" id="5975661">readHole</span><span class="op" id="5975669">(</span><span class="ident" id="5975670">b</span><span class="op" id="5975671">,</span>&nbsp;<span class="ident" id="5975673">sfr</span><span class="op" id="5975676">.</span><span class="ident" id="5975677">tot</span><span class="op" id="5975680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975685">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5975694">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5975698">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975743">return</span>&nbsp;<span class="num" id="5975750">0</span><span class="op" id="5975751">,</span>&nbsp;<span class="ident" id="5975753">io</span><span class="op" id="5975755">.</span><span class="ident" id="5975756">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5975761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975764">if</span>&nbsp;<span class="ident" id="5975767">sfr</span><span class="op" id="5975770">.</span><span class="ident" id="5975771">pos</span>&nbsp;<span class="op" id="5975775">&lt;</span>&nbsp;<span class="ident" id="5975777">sfr</span><span class="op" id="5975780">.</span><span class="ident" id="5975781">sp</span><span class="op" id="5975783">[</span><span class="num" id="5975784">0</span><span class="op" id="5975785">]</span><span class="op" id="5975786">.</span><span class="ident" id="5975787">offset</span>&nbsp;<span class="op" id="5975794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5975798">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975819">n</span>&nbsp;<span class="op" id="5975821">=</span>&nbsp;<span class="ident" id="5975823">sfr</span><span class="op" id="5975826">.</span><span class="ident" id="5975827">readHole</span><span class="op" id="5975835">(</span><span class="ident" id="5975836">b</span><span class="op" id="5975837">,</span>&nbsp;<span class="ident" id="5975839">sfr</span><span class="op" id="5975842">.</span><span class="ident" id="5975843">sp</span><span class="op" id="5975845">[</span><span class="num" id="5975846">0</span><span class="op" id="5975847">]</span><span class="op" id="5975848">.</span><span class="ident" id="5975849">offset</span><span class="op" id="5975855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5975859">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5975867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5975871">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975938">posInFragment</span>&nbsp;<span class="op" id="5975952">:=</span>&nbsp;<span class="ident" id="5975955">sfr</span><span class="op" id="5975958">.</span><span class="ident" id="5975959">pos</span>&nbsp;<span class="op" id="5975963">-</span>&nbsp;<span class="ident" id="5975965">sfr</span><span class="op" id="5975968">.</span><span class="ident" id="5975969">sp</span><span class="op" id="5975971">[</span><span class="num" id="5975972">0</span><span class="op" id="5975973">]</span><span class="op" id="5975974">.</span><span class="ident" id="5975975">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5975983">bytesLeft</span>&nbsp;<span class="op" id="5975993">:=</span>&nbsp;<span class="ident" id="5975996">sfr</span><span class="op" id="5975999">.</span><span class="ident" id="5976000">sp</span><span class="op" id="5976002">[</span><span class="num" id="5976003">0</span><span class="op" id="5976004">]</span><span class="op" id="5976005">.</span><span class="ident" id="5976006">numBytes</span>&nbsp;<span class="op" id="5976015">-</span>&nbsp;<span class="ident" id="5976017">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976032">if</span>&nbsp;<span class="builtintype" id="5976035">int64</span><span class="op" id="5976040">(</span><span class="builtinfunc" id="5976041">len</span><span class="op" id="5976044">(</span><span class="ident" id="5976045">b</span><span class="op" id="5976046">)</span><span class="op" id="5976047">)</span>&nbsp;<span class="op" id="5976049">&gt;</span>&nbsp;<span class="ident" id="5976051">bytesLeft</span>&nbsp;<span class="op" id="5976061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976065">b</span>&nbsp;<span class="op" id="5976067">=</span>&nbsp;<span class="ident" id="5976069">b</span><span class="op" id="5976070">[</span><span class="num" id="5976071">0</span><span class="op" id="5976072">:</span><span class="ident" id="5976073">bytesLeft</span><span class="op" id="5976082">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5976085">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976089">n</span><span class="op" id="5976090">,</span>&nbsp;<span class="ident" id="5976092">err</span>&nbsp;<span class="op" id="5976096">=</span>&nbsp;<span class="ident" id="5976098">sfr</span><span class="op" id="5976101">.</span><span class="ident" id="5976102">rfr</span><span class="op" id="5976105">.</span><span class="ident" id="5976106">Read</span><span class="op" id="5976110">(</span><span class="ident" id="5976111">b</span><span class="op" id="5976112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976115">sfr</span><span class="op" id="5976118">.</span><span class="ident" id="5976119">pos</span>&nbsp;<span class="op" id="5976123">+=</span>&nbsp;<span class="builtintype" id="5976126">int64</span><span class="op" id="5976131">(</span><span class="ident" id="5976132">n</span><span class="op" id="5976133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976137">if</span>&nbsp;<span class="builtintype" id="5976140">int64</span><span class="op" id="5976145">(</span><span class="ident" id="5976146">n</span><span class="op" id="5976147">)</span>&nbsp;<span class="op" id="5976149">==</span>&nbsp;<span class="ident" id="5976152">bytesLeft</span>&nbsp;<span class="op" id="5976162">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5976166">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976201">sfr</span><span class="op" id="5976204">.</span><span class="ident" id="5976205">sp</span>&nbsp;<span class="op" id="5976208">=</span>&nbsp;<span class="ident" id="5976210">sfr</span><span class="op" id="5976213">.</span><span class="ident" id="5976214">sp</span><span class="op" id="5976216">[</span><span class="num" id="5976217">1</span><span class="op" id="5976218">:</span><span class="op" id="5976219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5976222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976226">if</span>&nbsp;<span class="ident" id="5976229">err</span>&nbsp;<span class="op" id="5976233">==</span>&nbsp;<span class="ident" id="5976236">io</span><span class="op" id="5976238">.</span><span class="ident" id="5976239">EOF</span>&nbsp;<span class="op" id="5976243">&amp;&amp;</span>&nbsp;<span class="ident" id="5976246">sfr</span><span class="op" id="5976249">.</span><span class="ident" id="5976250">pos</span>&nbsp;<span class="op" id="5976254">&lt;</span>&nbsp;<span class="ident" id="5976256">sfr</span><span class="op" id="5976259">.</span><span class="ident" id="5976260">tot</span>&nbsp;<span class="op" id="5976264">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5976268">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5976346">err</span>&nbsp;<span class="op" id="5976350">=</span>&nbsp;<span class="builtintype" id="5976352">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5976357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976360">return</span><br>
<span class="lineno"></span><span class="op" id="5976367">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5976370">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5976444">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5976487">func</span>&nbsp;<span class="op" id="5976492">(</span><span class="ident" id="5976493">sfr</span>&nbsp;<span class="op" id="5976497">*</span><span class="ident" id="5976498">sparseFileReader</span><span class="op" id="5976514">)</span>&nbsp;<span class="ident" id="5976516">numBytes</span><span class="op" id="5976524">(</span><span class="op" id="5976525">)</span>&nbsp;<span class="builtintype" id="5976527">int64</span>&nbsp;<span class="op" id="5976533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5976536">return</span>&nbsp;<span class="ident" id="5976543">sfr</span><span class="op" id="5976546">.</span><span class="ident" id="5976547">rfr</span><span class="op" id="5976550">.</span><span class="ident" id="5976551">nb</span><br>
<span class="lineno">820</span><span class="op" id="5976554">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
