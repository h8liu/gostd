<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4551124">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4551179">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4551233">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4551284">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4551358">package</span>&nbsp;<span class="ident" id="4551366">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4551372">import</span>&nbsp;<span class="op" id="4551379">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551382">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551391">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551402">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4551417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4551420">type</span>&nbsp;<span class="ident" id="4551425">writer</span>&nbsp;<span class="keyword" id="4551432">interface</span>&nbsp;<span class="op" id="4551442">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551445">WriteString</span><span class="op" id="4551456">(</span><span class="builtintype" id="4551457">string</span><span class="op" id="4551463">)</span>&nbsp;<span class="op" id="4551465">(</span><span class="builtintype" id="4551466">int</span><span class="op" id="4551469">,</span>&nbsp;<span class="builtintype" id="4551471">error</span><span class="op" id="4551476">)</span><br>
<span class="lineno"></span><span class="op" id="4551478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4551481">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4551555">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="4551589">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="4551700">var</span>&nbsp;<span class="ident" id="4551704">replacementTable</span>&nbsp;<span class="op" id="4551721">=</span>&nbsp;<span class="op" id="4551723">[</span><span class="op" id="4551724">...</span><span class="op" id="4551727">]</span><span class="builtintype" id="4551728">rune</span><span class="op" id="4551732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551735">&#39;\u20AC&#39;</span><span class="op" id="4551743">,</span>&nbsp;<span class="comment" id="4551745">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551799">&#39;\u0081&#39;</span><span class="op" id="4551807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551810">&#39;\u201A&#39;</span><span class="op" id="4551818">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551821">&#39;\u0192&#39;</span><span class="op" id="4551829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551832">&#39;\u201E&#39;</span><span class="op" id="4551840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551843">&#39;\u2026&#39;</span><span class="op" id="4551851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551854">&#39;\u2020&#39;</span><span class="op" id="4551862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551865">&#39;\u2021&#39;</span><span class="op" id="4551873">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551876">&#39;\u02C6&#39;</span><span class="op" id="4551884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551887">&#39;\u2030&#39;</span><span class="op" id="4551895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551898">&#39;\u0160&#39;</span><span class="op" id="4551906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551909">&#39;\u2039&#39;</span><span class="op" id="4551917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551920">&#39;\u0152&#39;</span><span class="op" id="4551928">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551931">&#39;\u008D&#39;</span><span class="op" id="4551939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551942">&#39;\u017D&#39;</span><span class="op" id="4551950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551953">&#39;\u008F&#39;</span><span class="op" id="4551961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551964">&#39;\u0090&#39;</span><span class="op" id="4551972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551975">&#39;\u2018&#39;</span><span class="op" id="4551983">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551986">&#39;\u2019&#39;</span><span class="op" id="4551994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4551997">&#39;\u201C&#39;</span><span class="op" id="4552005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552008">&#39;\u201D&#39;</span><span class="op" id="4552016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552019">&#39;\u2022&#39;</span><span class="op" id="4552027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552030">&#39;\u2013&#39;</span><span class="op" id="4552038">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552041">&#39;\u2014&#39;</span><span class="op" id="4552049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552052">&#39;\u02DC&#39;</span><span class="op" id="4552060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552063">&#39;\u2122&#39;</span><span class="op" id="4552071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552074">&#39;\u0161&#39;</span><span class="op" id="4552082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552085">&#39;\u203A&#39;</span><span class="op" id="4552093">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552096">&#39;\u0153&#39;</span><span class="op" id="4552104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552107">&#39;\u009D&#39;</span><span class="op" id="4552115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552118">&#39;\u017E&#39;</span><span class="op" id="4552126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4552129">&#39;\u0178&#39;</span><span class="op" id="4552137">,</span>&nbsp;<span class="comment" id="4552139">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4552163">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4552211">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="4552241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4552244">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4552318">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="4552398">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4552444">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4552503">func</span>&nbsp;<span class="ident" id="4552508">unescapeEntity</span><span class="op" id="4552522">(</span><span class="ident" id="4552523">b</span>&nbsp;<span class="op" id="4552525">[</span><span class="op" id="4552526">]</span><span class="builtintype" id="4552527">byte</span><span class="op" id="4552531">,</span>&nbsp;<span class="ident" id="4552533">dst</span><span class="op" id="4552536">,</span>&nbsp;<span class="ident" id="4552538">src</span>&nbsp;<span class="builtintype" id="4552542">int</span><span class="op" id="4552545">,</span>&nbsp;<span class="ident" id="4552547">attribute</span>&nbsp;<span class="builtintype" id="4552557">bool</span><span class="op" id="4552561">)</span>&nbsp;<span class="op" id="4552563">(</span><span class="ident" id="4552564">dst1</span><span class="op" id="4552568">,</span>&nbsp;<span class="ident" id="4552570">src1</span>&nbsp;<span class="builtintype" id="4552575">int</span><span class="op" id="4552578">)</span>&nbsp;<span class="op" id="4552580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4552583">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4552696">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552756">i</span><span class="op" id="4552757">,</span>&nbsp;<span class="ident" id="4552759">s</span>&nbsp;<span class="op" id="4552761">:=</span>&nbsp;<span class="num" id="4552764">1</span><span class="op" id="4552765">,</span>&nbsp;<span class="ident" id="4552767">b</span><span class="op" id="4552768">[</span><span class="ident" id="4552769">src</span><span class="op" id="4552772">:</span><span class="op" id="4552773">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552777">if</span>&nbsp;<span class="builtinfunc" id="4552780">len</span><span class="op" id="4552783">(</span><span class="ident" id="4552784">s</span><span class="op" id="4552785">)</span>&nbsp;<span class="op" id="4552787">&lt;=</span>&nbsp;<span class="num" id="4552790">1</span>&nbsp;<span class="op" id="4552792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552796">b</span><span class="op" id="4552797">[</span><span class="ident" id="4552798">dst</span><span class="op" id="4552801">]</span>&nbsp;<span class="op" id="4552803">=</span>&nbsp;<span class="ident" id="4552805">b</span><span class="op" id="4552806">[</span><span class="ident" id="4552807">src</span><span class="op" id="4552810">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552814">return</span>&nbsp;<span class="ident" id="4552821">dst</span>&nbsp;<span class="op" id="4552825">+</span>&nbsp;<span class="num" id="4552827">1</span><span class="op" id="4552828">,</span>&nbsp;<span class="ident" id="4552830">src</span>&nbsp;<span class="op" id="4552834">+</span>&nbsp;<span class="num" id="4552836">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552843">if</span>&nbsp;<span class="ident" id="4552846">s</span><span class="op" id="4552847">[</span><span class="ident" id="4552848">i</span><span class="op" id="4552849">]</span>&nbsp;<span class="op" id="4552851">==</span>&nbsp;<span class="string" id="4552854">&#39;#&#39;</span>&nbsp;<span class="op" id="4552858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552862">if</span>&nbsp;<span class="builtinfunc" id="4552865">len</span><span class="op" id="4552868">(</span><span class="ident" id="4552869">s</span><span class="op" id="4552870">)</span>&nbsp;<span class="op" id="4552872">&lt;=</span>&nbsp;<span class="num" id="4552875">3</span>&nbsp;<span class="op" id="4552877">{</span>&nbsp;<span class="comment" id="4552879">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552917">b</span><span class="op" id="4552918">[</span><span class="ident" id="4552919">dst</span><span class="op" id="4552922">]</span>&nbsp;<span class="op" id="4552924">=</span>&nbsp;<span class="ident" id="4552926">b</span><span class="op" id="4552927">[</span><span class="ident" id="4552928">src</span><span class="op" id="4552931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552936">return</span>&nbsp;<span class="ident" id="4552943">dst</span>&nbsp;<span class="op" id="4552947">+</span>&nbsp;<span class="num" id="4552949">1</span><span class="op" id="4552950">,</span>&nbsp;<span class="ident" id="4552952">src</span>&nbsp;<span class="op" id="4552956">+</span>&nbsp;<span class="num" id="4552958">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552966">i</span><span class="op" id="4552967">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552972">c</span>&nbsp;<span class="op" id="4552974">:=</span>&nbsp;<span class="ident" id="4552977">s</span><span class="op" id="4552978">[</span><span class="ident" id="4552979">i</span><span class="op" id="4552980">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552984">hex</span>&nbsp;<span class="op" id="4552988">:=</span>&nbsp;<span class="builtintype" id="4552991">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552999">if</span>&nbsp;<span class="ident" id="4553002">c</span>&nbsp;<span class="op" id="4553004">==</span>&nbsp;<span class="string" id="4553007">&#39;x&#39;</span>&nbsp;<span class="op" id="4553011">||</span>&nbsp;<span class="ident" id="4553014">c</span>&nbsp;<span class="op" id="4553016">==</span>&nbsp;<span class="string" id="4553019">&#39;X&#39;</span>&nbsp;<span class="op" id="4553023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553028">hex</span>&nbsp;<span class="op" id="4553032">=</span>&nbsp;<span class="builtintype" id="4553034">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553042">i</span><span class="op" id="4553043">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553048">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553053">x</span>&nbsp;<span class="op" id="4553055">:=</span>&nbsp;<span class="string" id="4553058">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553067">for</span>&nbsp;<span class="ident" id="4553071">i</span>&nbsp;<span class="op" id="4553073">&lt;</span>&nbsp;<span class="builtinfunc" id="4553075">len</span><span class="op" id="4553078">(</span><span class="ident" id="4553079">s</span><span class="op" id="4553080">)</span>&nbsp;<span class="op" id="4553082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553087">c</span>&nbsp;<span class="op" id="4553089">=</span>&nbsp;<span class="ident" id="4553091">s</span><span class="op" id="4553092">[</span><span class="ident" id="4553093">i</span><span class="op" id="4553094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553099">i</span><span class="op" id="4553100">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553106">if</span>&nbsp;<span class="ident" id="4553109">hex</span>&nbsp;<span class="op" id="4553113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553119">if</span>&nbsp;<span class="string" id="4553122">&#39;0&#39;</span>&nbsp;<span class="op" id="4553126">&lt;=</span>&nbsp;<span class="ident" id="4553129">c</span>&nbsp;<span class="op" id="4553131">&amp;&amp;</span>&nbsp;<span class="ident" id="4553134">c</span>&nbsp;<span class="op" id="4553136">&lt;=</span>&nbsp;<span class="string" id="4553139">&#39;9&#39;</span>&nbsp;<span class="op" id="4553143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553150">x</span>&nbsp;<span class="op" id="4553152">=</span>&nbsp;<span class="num" id="4553154">16</span><span class="op" id="4553156">*</span><span class="ident" id="4553157">x</span>&nbsp;<span class="op" id="4553159">+</span>&nbsp;<span class="builtintype" id="4553161">rune</span><span class="op" id="4553165">(</span><span class="ident" id="4553166">c</span><span class="op" id="4553167">)</span>&nbsp;<span class="op" id="4553169">-</span>&nbsp;<span class="string" id="4553171">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553180">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553193">}</span>&nbsp;<span class="keyword" id="4553195">else</span>&nbsp;<span class="keyword" id="4553200">if</span>&nbsp;<span class="string" id="4553203">&#39;a&#39;</span>&nbsp;<span class="op" id="4553207">&lt;=</span>&nbsp;<span class="ident" id="4553210">c</span>&nbsp;<span class="op" id="4553212">&amp;&amp;</span>&nbsp;<span class="ident" id="4553215">c</span>&nbsp;<span class="op" id="4553217">&lt;=</span>&nbsp;<span class="string" id="4553220">&#39;f&#39;</span>&nbsp;<span class="op" id="4553224">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553231">x</span>&nbsp;<span class="op" id="4553233">=</span>&nbsp;<span class="num" id="4553235">16</span><span class="op" id="4553237">*</span><span class="ident" id="4553238">x</span>&nbsp;<span class="op" id="4553240">+</span>&nbsp;<span class="builtintype" id="4553242">rune</span><span class="op" id="4553246">(</span><span class="ident" id="4553247">c</span><span class="op" id="4553248">)</span>&nbsp;<span class="op" id="4553250">-</span>&nbsp;<span class="string" id="4553252">&#39;a&#39;</span>&nbsp;<span class="op" id="4553256">+</span>&nbsp;<span class="num" id="4553258">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553266">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553279">}</span>&nbsp;<span class="keyword" id="4553281">else</span>&nbsp;<span class="keyword" id="4553286">if</span>&nbsp;<span class="string" id="4553289">&#39;A&#39;</span>&nbsp;<span class="op" id="4553293">&lt;=</span>&nbsp;<span class="ident" id="4553296">c</span>&nbsp;<span class="op" id="4553298">&amp;&amp;</span>&nbsp;<span class="ident" id="4553301">c</span>&nbsp;<span class="op" id="4553303">&lt;=</span>&nbsp;<span class="string" id="4553306">&#39;F&#39;</span>&nbsp;<span class="op" id="4553310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553317">x</span>&nbsp;<span class="op" id="4553319">=</span>&nbsp;<span class="num" id="4553321">16</span><span class="op" id="4553323">*</span><span class="ident" id="4553324">x</span>&nbsp;<span class="op" id="4553326">+</span>&nbsp;<span class="builtintype" id="4553328">rune</span><span class="op" id="4553332">(</span><span class="ident" id="4553333">c</span><span class="op" id="4553334">)</span>&nbsp;<span class="op" id="4553336">-</span>&nbsp;<span class="string" id="4553338">&#39;A&#39;</span>&nbsp;<span class="op" id="4553342">+</span>&nbsp;<span class="num" id="4553344">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553352">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553370">}</span>&nbsp;<span class="keyword" id="4553372">else</span>&nbsp;<span class="keyword" id="4553377">if</span>&nbsp;<span class="string" id="4553380">&#39;0&#39;</span>&nbsp;<span class="op" id="4553384">&lt;=</span>&nbsp;<span class="ident" id="4553387">c</span>&nbsp;<span class="op" id="4553389">&amp;&amp;</span>&nbsp;<span class="ident" id="4553392">c</span>&nbsp;<span class="op" id="4553394">&lt;=</span>&nbsp;<span class="string" id="4553397">&#39;9&#39;</span>&nbsp;<span class="op" id="4553401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553407">x</span>&nbsp;<span class="op" id="4553409">=</span>&nbsp;<span class="num" id="4553411">10</span><span class="op" id="4553413">*</span><span class="ident" id="4553414">x</span>&nbsp;<span class="op" id="4553416">+</span>&nbsp;<span class="builtintype" id="4553418">rune</span><span class="op" id="4553422">(</span><span class="ident" id="4553423">c</span><span class="op" id="4553424">)</span>&nbsp;<span class="op" id="4553426">-</span>&nbsp;<span class="string" id="4553428">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553436">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553448">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553453">if</span>&nbsp;<span class="ident" id="4553456">c</span>&nbsp;<span class="op" id="4553458">!=</span>&nbsp;<span class="string" id="4553461">&#39;;&#39;</span>&nbsp;<span class="op" id="4553465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553471">i</span><span class="op" id="4553472">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553483">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553491">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553496">if</span>&nbsp;<span class="ident" id="4553499">i</span>&nbsp;<span class="op" id="4553501">&lt;=</span>&nbsp;<span class="num" id="4553504">3</span>&nbsp;<span class="op" id="4553506">{</span>&nbsp;<span class="comment" id="4553508">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553537">b</span><span class="op" id="4553538">[</span><span class="ident" id="4553539">dst</span><span class="op" id="4553542">]</span>&nbsp;<span class="op" id="4553544">=</span>&nbsp;<span class="ident" id="4553546">b</span><span class="op" id="4553547">[</span><span class="ident" id="4553548">src</span><span class="op" id="4553551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553556">return</span>&nbsp;<span class="ident" id="4553563">dst</span>&nbsp;<span class="op" id="4553567">+</span>&nbsp;<span class="num" id="4553569">1</span><span class="op" id="4553570">,</span>&nbsp;<span class="ident" id="4553572">src</span>&nbsp;<span class="op" id="4553576">+</span>&nbsp;<span class="num" id="4553578">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553582">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553587">if</span>&nbsp;<span class="num" id="4553590">0x80</span>&nbsp;<span class="op" id="4553595">&lt;=</span>&nbsp;<span class="ident" id="4553598">x</span>&nbsp;<span class="op" id="4553600">&amp;&amp;</span>&nbsp;<span class="ident" id="4553603">x</span>&nbsp;<span class="op" id="4553605">&lt;=</span>&nbsp;<span class="num" id="4553608">0x9F</span>&nbsp;<span class="op" id="4553613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553618">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553685">x</span>&nbsp;<span class="op" id="4553687">=</span>&nbsp;<span class="ident" id="4553689">replacementTable</span><span class="op" id="4553705">[</span><span class="ident" id="4553706">x</span><span class="op" id="4553707">-</span><span class="num" id="4553708">0x80</span><span class="op" id="4553712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553716">}</span>&nbsp;<span class="keyword" id="4553718">else</span>&nbsp;<span class="keyword" id="4553723">if</span>&nbsp;<span class="ident" id="4553726">x</span>&nbsp;<span class="op" id="4553728">==</span>&nbsp;<span class="num" id="4553731">0</span>&nbsp;<span class="op" id="4553733">||</span>&nbsp;<span class="op" id="4553736">(</span><span class="num" id="4553737">0xD800</span>&nbsp;<span class="op" id="4553744">&lt;=</span>&nbsp;<span class="ident" id="4553747">x</span>&nbsp;<span class="op" id="4553749">&amp;&amp;</span>&nbsp;<span class="ident" id="4553752">x</span>&nbsp;<span class="op" id="4553754">&lt;=</span>&nbsp;<span class="num" id="4553757">0xDFFF</span><span class="op" id="4553763">)</span>&nbsp;<span class="op" id="4553765">||</span>&nbsp;<span class="ident" id="4553768">x</span>&nbsp;<span class="op" id="4553770">&gt;</span>&nbsp;<span class="num" id="4553772">0x10FFFF</span>&nbsp;<span class="op" id="4553781">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553786">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553851">x</span>&nbsp;<span class="op" id="4553853">=</span>&nbsp;<span class="string" id="4553855">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553871">return</span>&nbsp;<span class="ident" id="4553878">dst</span>&nbsp;<span class="op" id="4553882">+</span>&nbsp;<span class="ident" id="4553884">utf8</span><span class="op" id="4553888">.</span><span class="ident" id="4553889">EncodeRune</span><span class="op" id="4553899">(</span><span class="ident" id="4553900">b</span><span class="op" id="4553901">[</span><span class="ident" id="4553902">dst</span><span class="op" id="4553905">:</span><span class="op" id="4553906">]</span><span class="op" id="4553907">,</span>&nbsp;<span class="ident" id="4553909">x</span><span class="op" id="4553910">)</span><span class="op" id="4553911">,</span>&nbsp;<span class="ident" id="4553913">src</span>&nbsp;<span class="op" id="4553917">+</span>&nbsp;<span class="ident" id="4553919">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553926">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4553990">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554053">for</span>&nbsp;<span class="ident" id="4554057">i</span>&nbsp;<span class="op" id="4554059">&lt;</span>&nbsp;<span class="builtinfunc" id="4554061">len</span><span class="op" id="4554064">(</span><span class="ident" id="4554065">s</span><span class="op" id="4554066">)</span>&nbsp;<span class="op" id="4554068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554072">c</span>&nbsp;<span class="op" id="4554074">:=</span>&nbsp;<span class="ident" id="4554077">s</span><span class="op" id="4554078">[</span><span class="ident" id="4554079">i</span><span class="op" id="4554080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554084">i</span><span class="op" id="4554085">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554090">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554175">if</span>&nbsp;<span class="string" id="4554178">&#39;a&#39;</span>&nbsp;<span class="op" id="4554182">&lt;=</span>&nbsp;<span class="ident" id="4554185">c</span>&nbsp;<span class="op" id="4554187">&amp;&amp;</span>&nbsp;<span class="ident" id="4554190">c</span>&nbsp;<span class="op" id="4554192">&lt;=</span>&nbsp;<span class="string" id="4554195">&#39;z&#39;</span>&nbsp;<span class="op" id="4554199">||</span>&nbsp;<span class="string" id="4554202">&#39;A&#39;</span>&nbsp;<span class="op" id="4554206">&lt;=</span>&nbsp;<span class="ident" id="4554209">c</span>&nbsp;<span class="op" id="4554211">&amp;&amp;</span>&nbsp;<span class="ident" id="4554214">c</span>&nbsp;<span class="op" id="4554216">&lt;=</span>&nbsp;<span class="string" id="4554219">&#39;Z&#39;</span>&nbsp;<span class="op" id="4554223">||</span>&nbsp;<span class="string" id="4554226">&#39;0&#39;</span>&nbsp;<span class="op" id="4554230">&lt;=</span>&nbsp;<span class="ident" id="4554233">c</span>&nbsp;<span class="op" id="4554235">&amp;&amp;</span>&nbsp;<span class="ident" id="4554238">c</span>&nbsp;<span class="op" id="4554240">&lt;=</span>&nbsp;<span class="string" id="4554243">&#39;9&#39;</span>&nbsp;<span class="op" id="4554247">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554252">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554267">if</span>&nbsp;<span class="ident" id="4554270">c</span>&nbsp;<span class="op" id="4554272">!=</span>&nbsp;<span class="string" id="4554275">&#39;;&#39;</span>&nbsp;<span class="op" id="4554279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554284">i</span><span class="op" id="4554285">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554290">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554294">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554305">entityName</span>&nbsp;<span class="op" id="4554316">:=</span>&nbsp;<span class="builtintype" id="4554319">string</span><span class="op" id="4554325">(</span><span class="ident" id="4554326">s</span><span class="op" id="4554327">[</span><span class="num" id="4554328">1</span><span class="op" id="4554329">:</span><span class="ident" id="4554330">i</span><span class="op" id="4554331">]</span><span class="op" id="4554332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554335">if</span>&nbsp;<span class="ident" id="4554338">entityName</span>&nbsp;<span class="op" id="4554349">==</span>&nbsp;<span class="string" id="4554352">&#34;&#34;</span>&nbsp;<span class="op" id="4554355">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554359">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554370">}</span>&nbsp;<span class="keyword" id="4554372">else</span>&nbsp;<span class="keyword" id="4554377">if</span>&nbsp;<span class="ident" id="4554380">attribute</span>&nbsp;<span class="op" id="4554390">&amp;&amp;</span>&nbsp;<span class="ident" id="4554393">entityName</span><span class="op" id="4554403">[</span><span class="builtinfunc" id="4554404">len</span><span class="op" id="4554407">(</span><span class="ident" id="4554408">entityName</span><span class="op" id="4554418">)</span><span class="op" id="4554419">-</span><span class="num" id="4554420">1</span><span class="op" id="4554421">]</span>&nbsp;<span class="op" id="4554423">!=</span>&nbsp;<span class="string" id="4554426">&#39;;&#39;</span>&nbsp;<span class="op" id="4554430">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4554433">len</span><span class="op" id="4554436">(</span><span class="ident" id="4554437">s</span><span class="op" id="4554438">)</span>&nbsp;<span class="op" id="4554440">&gt;</span>&nbsp;<span class="ident" id="4554442">i</span>&nbsp;<span class="op" id="4554444">&amp;&amp;</span>&nbsp;<span class="ident" id="4554447">s</span><span class="op" id="4554448">[</span><span class="ident" id="4554449">i</span><span class="op" id="4554450">]</span>&nbsp;<span class="op" id="4554452">==</span>&nbsp;<span class="string" id="4554455">&#39;=&#39;</span>&nbsp;<span class="op" id="4554459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4554463">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554474">}</span>&nbsp;<span class="keyword" id="4554476">else</span>&nbsp;<span class="keyword" id="4554481">if</span>&nbsp;<span class="ident" id="4554484">x</span>&nbsp;<span class="op" id="4554486">:=</span>&nbsp;<span class="ident" id="4554489">entity</span><span class="op" id="4554495">[</span><span class="ident" id="4554496">entityName</span><span class="op" id="4554506">]</span><span class="op" id="4554507">;</span>&nbsp;<span class="ident" id="4554509">x</span>&nbsp;<span class="op" id="4554511">!=</span>&nbsp;<span class="num" id="4554514">0</span>&nbsp;<span class="op" id="4554516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554520">return</span>&nbsp;<span class="ident" id="4554527">dst</span>&nbsp;<span class="op" id="4554531">+</span>&nbsp;<span class="ident" id="4554533">utf8</span><span class="op" id="4554537">.</span><span class="ident" id="4554538">EncodeRune</span><span class="op" id="4554548">(</span><span class="ident" id="4554549">b</span><span class="op" id="4554550">[</span><span class="ident" id="4554551">dst</span><span class="op" id="4554554">:</span><span class="op" id="4554555">]</span><span class="op" id="4554556">,</span>&nbsp;<span class="ident" id="4554558">x</span><span class="op" id="4554559">)</span><span class="op" id="4554560">,</span>&nbsp;<span class="ident" id="4554562">src</span>&nbsp;<span class="op" id="4554566">+</span>&nbsp;<span class="ident" id="4554568">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554571">}</span>&nbsp;<span class="keyword" id="4554573">else</span>&nbsp;<span class="keyword" id="4554578">if</span>&nbsp;<span class="ident" id="4554581">x</span>&nbsp;<span class="op" id="4554583">:=</span>&nbsp;<span class="ident" id="4554586">entity2</span><span class="op" id="4554593">[</span><span class="ident" id="4554594">entityName</span><span class="op" id="4554604">]</span><span class="op" id="4554605">;</span>&nbsp;<span class="ident" id="4554607">x</span><span class="op" id="4554608">[</span><span class="num" id="4554609">0</span><span class="op" id="4554610">]</span>&nbsp;<span class="op" id="4554612">!=</span>&nbsp;<span class="num" id="4554615">0</span>&nbsp;<span class="op" id="4554617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554621">dst1</span>&nbsp;<span class="op" id="4554626">:=</span>&nbsp;<span class="ident" id="4554629">dst</span>&nbsp;<span class="op" id="4554633">+</span>&nbsp;<span class="ident" id="4554635">utf8</span><span class="op" id="4554639">.</span><span class="ident" id="4554640">EncodeRune</span><span class="op" id="4554650">(</span><span class="ident" id="4554651">b</span><span class="op" id="4554652">[</span><span class="ident" id="4554653">dst</span><span class="op" id="4554656">:</span><span class="op" id="4554657">]</span><span class="op" id="4554658">,</span>&nbsp;<span class="ident" id="4554660">x</span><span class="op" id="4554661">[</span><span class="num" id="4554662">0</span><span class="op" id="4554663">]</span><span class="op" id="4554664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554668">return</span>&nbsp;<span class="ident" id="4554675">dst1</span>&nbsp;<span class="op" id="4554680">+</span>&nbsp;<span class="ident" id="4554682">utf8</span><span class="op" id="4554686">.</span><span class="ident" id="4554687">EncodeRune</span><span class="op" id="4554697">(</span><span class="ident" id="4554698">b</span><span class="op" id="4554699">[</span><span class="ident" id="4554700">dst1</span><span class="op" id="4554704">:</span><span class="op" id="4554705">]</span><span class="op" id="4554706">,</span>&nbsp;<span class="ident" id="4554708">x</span><span class="op" id="4554709">[</span><span class="num" id="4554710">1</span><span class="op" id="4554711">]</span><span class="op" id="4554712">)</span><span class="op" id="4554713">,</span>&nbsp;<span class="ident" id="4554715">src</span>&nbsp;<span class="op" id="4554719">+</span>&nbsp;<span class="ident" id="4554721">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554724">}</span>&nbsp;<span class="keyword" id="4554726">else</span>&nbsp;<span class="keyword" id="4554731">if</span>&nbsp;<span class="op" id="4554734">!</span><span class="ident" id="4554735">attribute</span>&nbsp;<span class="op" id="4554745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554749">maxLen</span>&nbsp;<span class="op" id="4554756">:=</span>&nbsp;<span class="builtinfunc" id="4554759">len</span><span class="op" id="4554762">(</span><span class="ident" id="4554763">entityName</span><span class="op" id="4554773">)</span>&nbsp;<span class="op" id="4554775">-</span>&nbsp;<span class="num" id="4554777">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554781">if</span>&nbsp;<span class="ident" id="4554784">maxLen</span>&nbsp;<span class="op" id="4554791">&gt;</span>&nbsp;<span class="ident" id="4554793">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="4554823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554828">maxLen</span>&nbsp;<span class="op" id="4554835">=</span>&nbsp;<span class="ident" id="4554837">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554873">for</span>&nbsp;<span class="ident" id="4554877">j</span>&nbsp;<span class="op" id="4554879">:=</span>&nbsp;<span class="ident" id="4554882">maxLen</span><span class="op" id="4554888">;</span>&nbsp;<span class="ident" id="4554890">j</span>&nbsp;<span class="op" id="4554892">&gt;</span>&nbsp;<span class="num" id="4554894">1</span><span class="op" id="4554895">;</span>&nbsp;<span class="ident" id="4554897">j</span><span class="op" id="4554898">--</span>&nbsp;<span class="op" id="4554901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554906">if</span>&nbsp;<span class="ident" id="4554909">x</span>&nbsp;<span class="op" id="4554911">:=</span>&nbsp;<span class="ident" id="4554914">entity</span><span class="op" id="4554920">[</span><span class="ident" id="4554921">entityName</span><span class="op" id="4554931">[</span><span class="op" id="4554932">:</span><span class="ident" id="4554933">j</span><span class="op" id="4554934">]</span><span class="op" id="4554935">]</span><span class="op" id="4554936">;</span>&nbsp;<span class="ident" id="4554938">x</span>&nbsp;<span class="op" id="4554940">!=</span>&nbsp;<span class="num" id="4554943">0</span>&nbsp;<span class="op" id="4554945">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554951">return</span>&nbsp;<span class="ident" id="4554958">dst</span>&nbsp;<span class="op" id="4554962">+</span>&nbsp;<span class="ident" id="4554964">utf8</span><span class="op" id="4554968">.</span><span class="ident" id="4554969">EncodeRune</span><span class="op" id="4554979">(</span><span class="ident" id="4554980">b</span><span class="op" id="4554981">[</span><span class="ident" id="4554982">dst</span><span class="op" id="4554985">:</span><span class="op" id="4554986">]</span><span class="op" id="4554987">,</span>&nbsp;<span class="ident" id="4554989">x</span><span class="op" id="4554990">)</span><span class="op" id="4554991">,</span>&nbsp;<span class="ident" id="4554993">src</span>&nbsp;<span class="op" id="4554997">+</span>&nbsp;<span class="ident" id="4554999">j</span>&nbsp;<span class="op" id="4555001">+</span>&nbsp;<span class="num" id="4555003">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555019">dst1</span><span class="op" id="4555023">,</span>&nbsp;<span class="ident" id="4555025">src1</span>&nbsp;<span class="op" id="4555030">=</span>&nbsp;<span class="ident" id="4555032">dst</span><span class="op" id="4555035">+</span><span class="ident" id="4555036">i</span><span class="op" id="4555037">,</span>&nbsp;<span class="ident" id="4555039">src</span><span class="op" id="4555042">+</span><span class="ident" id="4555043">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4555046">copy</span><span class="op" id="4555050">(</span><span class="ident" id="4555051">b</span><span class="op" id="4555052">[</span><span class="ident" id="4555053">dst</span><span class="op" id="4555056">:</span><span class="ident" id="4555057">dst1</span><span class="op" id="4555061">]</span><span class="op" id="4555062">,</span>&nbsp;<span class="ident" id="4555064">b</span><span class="op" id="4555065">[</span><span class="ident" id="4555066">src</span><span class="op" id="4555069">:</span><span class="ident" id="4555070">src1</span><span class="op" id="4555074">]</span><span class="op" id="4555075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555078">return</span>&nbsp;<span class="ident" id="4555085">dst1</span><span class="op" id="4555089">,</span>&nbsp;<span class="ident" id="4555091">src1</span><br>
<span class="lineno"></span><span class="op" id="4555096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4555099">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4555176">func</span>&nbsp;<span class="ident" id="4555181">unescape</span><span class="op" id="4555189">(</span><span class="ident" id="4555190">b</span>&nbsp;<span class="op" id="4555192">[</span><span class="op" id="4555193">]</span><span class="builtintype" id="4555194">byte</span><span class="op" id="4555198">)</span>&nbsp;<span class="op" id="4555200">[</span><span class="op" id="4555201">]</span><span class="builtintype" id="4555202">byte</span>&nbsp;<span class="op" id="4555207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555210">for</span>&nbsp;<span class="ident" id="4555214">i</span><span class="op" id="4555215">,</span>&nbsp;<span class="ident" id="4555217">c</span>&nbsp;<span class="op" id="4555219">:=</span>&nbsp;<span class="keyword" id="4555222">range</span>&nbsp;<span class="ident" id="4555228">b</span>&nbsp;<span class="op" id="4555230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555234">if</span>&nbsp;<span class="ident" id="4555237">c</span>&nbsp;<span class="op" id="4555239">==</span>&nbsp;<span class="string" id="4555242">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4555246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555251">dst</span><span class="op" id="4555254">,</span>&nbsp;<span class="ident" id="4555256">src</span>&nbsp;<span class="op" id="4555260">:=</span>&nbsp;<span class="ident" id="4555263">unescapeEntity</span><span class="op" id="4555277">(</span><span class="ident" id="4555278">b</span><span class="op" id="4555279">,</span>&nbsp;<span class="ident" id="4555281">i</span><span class="op" id="4555282">,</span>&nbsp;<span class="ident" id="4555284">i</span><span class="op" id="4555285">,</span>&nbsp;<span class="builtintype" id="4555287">false</span><span class="op" id="4555292">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555297">for</span>&nbsp;<span class="ident" id="4555301">src</span>&nbsp;<span class="op" id="4555305">&lt;</span>&nbsp;<span class="builtinfunc" id="4555307">len</span><span class="op" id="4555310">(</span><span class="ident" id="4555311">b</span><span class="op" id="4555312">)</span>&nbsp;<span class="op" id="4555314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555320">c</span>&nbsp;<span class="op" id="4555322">:=</span>&nbsp;<span class="ident" id="4555325">b</span><span class="op" id="4555326">[</span><span class="ident" id="4555327">src</span><span class="op" id="4555330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555336">if</span>&nbsp;<span class="ident" id="4555339">c</span>&nbsp;<span class="op" id="4555341">==</span>&nbsp;<span class="string" id="4555344">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4555348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555355">dst</span><span class="op" id="4555358">,</span>&nbsp;<span class="ident" id="4555360">src</span>&nbsp;<span class="op" id="4555364">=</span>&nbsp;<span class="ident" id="4555366">unescapeEntity</span><span class="op" id="4555380">(</span><span class="ident" id="4555381">b</span><span class="op" id="4555382">,</span>&nbsp;<span class="ident" id="4555384">dst</span><span class="op" id="4555387">,</span>&nbsp;<span class="ident" id="4555389">src</span><span class="op" id="4555392">,</span>&nbsp;<span class="builtintype" id="4555394">false</span><span class="op" id="4555399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555405">}</span>&nbsp;<span class="keyword" id="4555407">else</span>&nbsp;<span class="op" id="4555412">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555419">b</span><span class="op" id="4555420">[</span><span class="ident" id="4555421">dst</span><span class="op" id="4555424">]</span>&nbsp;<span class="op" id="4555426">=</span>&nbsp;<span class="ident" id="4555428">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555435">dst</span><span class="op" id="4555438">,</span>&nbsp;<span class="ident" id="4555440">src</span>&nbsp;<span class="op" id="4555444">=</span>&nbsp;<span class="ident" id="4555446">dst</span><span class="op" id="4555449">+</span><span class="num" id="4555450">1</span><span class="op" id="4555451">,</span>&nbsp;<span class="ident" id="4555453">src</span><span class="op" id="4555456">+</span><span class="num" id="4555457">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555473">return</span>&nbsp;<span class="ident" id="4555480">b</span><span class="op" id="4555481">[</span><span class="num" id="4555482">0</span><span class="op" id="4555483">:</span><span class="ident" id="4555484">dst</span><span class="op" id="4555487">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555497">return</span>&nbsp;<span class="ident" id="4555504">b</span><br>
<span class="lineno"></span><span class="op" id="4555506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="4555509">const</span>&nbsp;<span class="ident" id="4555515">escapedChars</span>&nbsp;<span class="op" id="4555528">=</span>&nbsp;<span class="string" id="4555530">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4555539">func</span>&nbsp;<span class="ident" id="4555544">escape</span><span class="op" id="4555550">(</span><span class="ident" id="4555551">w</span>&nbsp;<span class="ident" id="4555553">writer</span><span class="op" id="4555559">,</span>&nbsp;<span class="ident" id="4555561">s</span>&nbsp;<span class="builtintype" id="4555563">string</span><span class="op" id="4555569">)</span>&nbsp;<span class="builtintype" id="4555571">error</span>&nbsp;<span class="op" id="4555577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555580">i</span>&nbsp;<span class="op" id="4555582">:=</span>&nbsp;<span class="ident" id="4555585">strings</span><span class="op" id="4555592">.</span><span class="ident" id="4555593">IndexAny</span><span class="op" id="4555601">(</span><span class="ident" id="4555602">s</span><span class="op" id="4555603">,</span>&nbsp;<span class="ident" id="4555605">escapedChars</span><span class="op" id="4555617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555620">for</span>&nbsp;<span class="ident" id="4555624">i</span>&nbsp;<span class="op" id="4555626">!=</span>&nbsp;<span class="op" id="4555629">-</span><span class="num" id="4555630">1</span>&nbsp;<span class="op" id="4555632">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555636">if</span>&nbsp;<span class="ident" id="4555639">_</span><span class="op" id="4555640">,</span>&nbsp;<span class="ident" id="4555642">err</span>&nbsp;<span class="op" id="4555646">:=</span>&nbsp;<span class="ident" id="4555649">w</span><span class="op" id="4555650">.</span><span class="ident" id="4555651">WriteString</span><span class="op" id="4555662">(</span><span class="ident" id="4555663">s</span><span class="op" id="4555664">[</span><span class="op" id="4555665">:</span><span class="ident" id="4555666">i</span><span class="op" id="4555667">]</span><span class="op" id="4555668">)</span><span class="op" id="4555669">;</span>&nbsp;<span class="ident" id="4555671">err</span>&nbsp;<span class="op" id="4555675">!=</span>&nbsp;<span class="builtintype" id="4555678">nil</span>&nbsp;<span class="op" id="4555682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555687">return</span>&nbsp;<span class="ident" id="4555694">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555704">var</span>&nbsp;<span class="ident" id="4555708">esc</span>&nbsp;<span class="builtintype" id="4555712">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555721">switch</span>&nbsp;<span class="ident" id="4555728">s</span><span class="op" id="4555729">[</span><span class="ident" id="4555730">i</span><span class="op" id="4555731">]</span>&nbsp;<span class="op" id="4555733">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555737">case</span>&nbsp;<span class="string" id="4555742">&#39;&amp;&#39;</span><span class="op" id="4555745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555750">esc</span>&nbsp;<span class="op" id="4555754">=</span>&nbsp;<span class="string" id="4555756">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555766">case</span>&nbsp;<span class="string" id="4555771">&#39;\&#39;&#39;</span><span class="op" id="4555775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4555780">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555857">esc</span>&nbsp;<span class="op" id="4555861">=</span>&nbsp;<span class="string" id="4555863">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555873">case</span>&nbsp;<span class="string" id="4555878">&#39;&lt;&#39;</span><span class="op" id="4555881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555886">esc</span>&nbsp;<span class="op" id="4555890">=</span>&nbsp;<span class="string" id="4555892">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555901">case</span>&nbsp;<span class="string" id="4555906">&#39;&gt;&#39;</span><span class="op" id="4555909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555914">esc</span>&nbsp;<span class="op" id="4555918">=</span>&nbsp;<span class="string" id="4555920">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555929">case</span>&nbsp;<span class="string" id="4555934">&#39;&#34;&#39;</span><span class="op" id="4555937">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4555942">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555982">esc</span>&nbsp;<span class="op" id="4555986">=</span>&nbsp;<span class="string" id="4555988">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555998">default</span><span class="op" id="4556005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4556010">panic</span><span class="op" id="4556015">(</span><span class="string" id="4556016">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="4556047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556051">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556055">s</span>&nbsp;<span class="op" id="4556057">=</span>&nbsp;<span class="ident" id="4556059">s</span><span class="op" id="4556060">[</span><span class="ident" id="4556061">i</span><span class="op" id="4556062">+</span><span class="num" id="4556063">1</span><span class="op" id="4556064">:</span><span class="op" id="4556065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556069">if</span>&nbsp;<span class="ident" id="4556072">_</span><span class="op" id="4556073">,</span>&nbsp;<span class="ident" id="4556075">err</span>&nbsp;<span class="op" id="4556079">:=</span>&nbsp;<span class="ident" id="4556082">w</span><span class="op" id="4556083">.</span><span class="ident" id="4556084">WriteString</span><span class="op" id="4556095">(</span><span class="ident" id="4556096">esc</span><span class="op" id="4556099">)</span><span class="op" id="4556100">;</span>&nbsp;<span class="ident" id="4556102">err</span>&nbsp;<span class="op" id="4556106">!=</span>&nbsp;<span class="builtintype" id="4556109">nil</span>&nbsp;<span class="op" id="4556113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556118">return</span>&nbsp;<span class="ident" id="4556125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556135">i</span>&nbsp;<span class="op" id="4556137">=</span>&nbsp;<span class="ident" id="4556139">strings</span><span class="op" id="4556146">.</span><span class="ident" id="4556147">IndexAny</span><span class="op" id="4556155">(</span><span class="ident" id="4556156">s</span><span class="op" id="4556157">,</span>&nbsp;<span class="ident" id="4556159">escapedChars</span><span class="op" id="4556171">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556177">_</span><span class="op" id="4556178">,</span>&nbsp;<span class="ident" id="4556180">err</span>&nbsp;<span class="op" id="4556184">:=</span>&nbsp;<span class="ident" id="4556187">w</span><span class="op" id="4556188">.</span><span class="ident" id="4556189">WriteString</span><span class="op" id="4556200">(</span><span class="ident" id="4556201">s</span><span class="op" id="4556202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556205">return</span>&nbsp;<span class="ident" id="4556212">err</span><br>
<span class="lineno"></span><span class="op" id="4556216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="4556219">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4556292">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4556348">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4556425">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4556441">func</span>&nbsp;<span class="ident" id="4556446">EscapeString</span><span class="op" id="4556458">(</span><span class="ident" id="4556459">s</span>&nbsp;<span class="builtintype" id="4556461">string</span><span class="op" id="4556467">)</span>&nbsp;<span class="builtintype" id="4556469">string</span>&nbsp;<span class="op" id="4556476">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556479">if</span>&nbsp;<span class="ident" id="4556482">strings</span><span class="op" id="4556489">.</span><span class="ident" id="4556490">IndexAny</span><span class="op" id="4556498">(</span><span class="ident" id="4556499">s</span><span class="op" id="4556500">,</span>&nbsp;<span class="ident" id="4556502">escapedChars</span><span class="op" id="4556514">)</span>&nbsp;<span class="op" id="4556516">==</span>&nbsp;<span class="op" id="4556519">-</span><span class="num" id="4556520">1</span>&nbsp;<span class="op" id="4556522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556526">return</span>&nbsp;<span class="ident" id="4556533">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556539">var</span>&nbsp;<span class="ident" id="4556543">buf</span>&nbsp;<span class="ident" id="4556547">bytes</span><span class="op" id="4556552">.</span><span class="ident" id="4556553">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556561">escape</span><span class="op" id="4556567">(</span><span class="op" id="4556568">&amp;</span><span class="ident" id="4556569">buf</span><span class="op" id="4556572">,</span>&nbsp;<span class="ident" id="4556574">s</span><span class="op" id="4556575">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556578">return</span>&nbsp;<span class="ident" id="4556585">buf</span><span class="op" id="4556588">.</span><span class="ident" id="4556589">String</span><span class="op" id="4556595">(</span><span class="op" id="4556596">)</span><br>
<span class="lineno"></span><span class="op" id="4556598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4556601">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4556680">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="4556759">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4556811">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4556888">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4556904">func</span>&nbsp;<span class="ident" id="4556909">UnescapeString</span><span class="op" id="4556923">(</span><span class="ident" id="4556924">s</span>&nbsp;<span class="builtintype" id="4556926">string</span><span class="op" id="4556932">)</span>&nbsp;<span class="builtintype" id="4556934">string</span>&nbsp;<span class="op" id="4556941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556944">for</span>&nbsp;<span class="ident" id="4556948">_</span><span class="op" id="4556949">,</span>&nbsp;<span class="ident" id="4556951">c</span>&nbsp;<span class="op" id="4556953">:=</span>&nbsp;<span class="keyword" id="4556956">range</span>&nbsp;<span class="ident" id="4556962">s</span>&nbsp;<span class="op" id="4556964">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556968">if</span>&nbsp;<span class="ident" id="4556971">c</span>&nbsp;<span class="op" id="4556973">==</span>&nbsp;<span class="string" id="4556976">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4556980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556985">return</span>&nbsp;<span class="builtintype" id="4556992">string</span><span class="op" id="4556998">(</span><span class="ident" id="4556999">unescape</span><span class="op" id="4557007">(</span><span class="op" id="4557008">[</span><span class="op" id="4557009">]</span><span class="builtintype" id="4557010">byte</span><span class="op" id="4557014">(</span><span class="ident" id="4557015">s</span><span class="op" id="4557016">)</span><span class="op" id="4557017">)</span><span class="op" id="4557018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557028">return</span>&nbsp;<span class="ident" id="4557035">s</span><br>
<span class="lineno">250</span><span class="op" id="4557037">}</span>
</div>
</body>
</html>
