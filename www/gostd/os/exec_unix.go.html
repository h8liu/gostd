<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2154499">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2154554">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2154608">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2154659">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2154729">package</span>&nbsp;<span class="ident" id="2154737">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2154741">import</span>&nbsp;<span class="op" id="2154748">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2154751">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2154761">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2154772">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2154783">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2154790">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2154793">func</span>&nbsp;<span class="op" id="2154798">(</span><span class="ident" id="2154799">p</span>&nbsp;<span class="op" id="2154801">*</span><span class="ident" id="2154802">Process</span><span class="op" id="2154809">)</span>&nbsp;<span class="ident" id="2154811">wait</span><span class="op" id="2154815">(</span><span class="op" id="2154816">)</span>&nbsp;<span class="op" id="2154818">(</span><span class="ident" id="2154819">ps</span>&nbsp;<span class="op" id="2154822">*</span><span class="ident" id="2154823">ProcessState</span><span class="op" id="2154835">,</span>&nbsp;<span class="ident" id="2154837">err</span>&nbsp;<span class="builtintype" id="2154841">error</span><span class="op" id="2154846">)</span>&nbsp;<span class="op" id="2154848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154851">if</span>&nbsp;<span class="ident" id="2154854">p</span><span class="op" id="2154855">.</span><span class="ident" id="2154856">Pid</span>&nbsp;<span class="op" id="2154860">==</span>&nbsp;<span class="op" id="2154863">-</span><span class="num" id="2154864">1</span>&nbsp;<span class="op" id="2154866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154870">return</span>&nbsp;<span class="ident" id="2154877">nil</span><span class="op" id="2154880">,</span>&nbsp;<span class="ident" id="2154882">syscall</span><span class="op" id="2154889">.</span><span class="ident" id="2154890">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154898">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154901">var</span>&nbsp;<span class="ident" id="2154905">status</span>&nbsp;<span class="ident" id="2154912">syscall</span><span class="op" id="2154919">.</span><span class="ident" id="2154920">WaitStatus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154932">var</span>&nbsp;<span class="ident" id="2154936">rusage</span>&nbsp;<span class="ident" id="2154943">syscall</span><span class="op" id="2154950">.</span><span class="ident" id="2154951">Rusage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154959">pid1</span><span class="op" id="2154963">,</span>&nbsp;<span class="ident" id="2154965">e</span>&nbsp;<span class="op" id="2154967">:=</span>&nbsp;<span class="ident" id="2154970">syscall</span><span class="op" id="2154977">.</span><span class="ident" id="2154978">Wait4</span><span class="op" id="2154983">(</span><span class="ident" id="2154984">p</span><span class="op" id="2154985">.</span><span class="ident" id="2154986">Pid</span><span class="op" id="2154989">,</span>&nbsp;<span class="op" id="2154991">&amp;</span><span class="ident" id="2154992">status</span><span class="op" id="2154998">,</span>&nbsp;<span class="num" id="2155000">0</span><span class="op" id="2155001">,</span>&nbsp;<span class="op" id="2155003">&amp;</span><span class="ident" id="2155004">rusage</span><span class="op" id="2155010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155013">if</span>&nbsp;<span class="ident" id="2155016">e</span>&nbsp;<span class="op" id="2155018">!=</span>&nbsp;<span class="ident" id="2155021">nil</span>&nbsp;<span class="op" id="2155025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155029">return</span>&nbsp;<span class="ident" id="2155036">nil</span><span class="op" id="2155039">,</span>&nbsp;<span class="ident" id="2155041">NewSyscallError</span><span class="op" id="2155056">(</span><span class="string" id="2155057">&#34;wait&#34;</span><span class="op" id="2155063">,</span>&nbsp;<span class="ident" id="2155065">e</span><span class="op" id="2155066">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155072">if</span>&nbsp;<span class="ident" id="2155075">pid1</span>&nbsp;<span class="op" id="2155080">!=</span>&nbsp;<span class="num" id="2155083">0</span>&nbsp;<span class="op" id="2155085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155089">p</span><span class="op" id="2155090">.</span><span class="ident" id="2155091">setDone</span><span class="op" id="2155098">(</span><span class="op" id="2155099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155105">ps</span>&nbsp;<span class="op" id="2155108">=</span>&nbsp;<span class="op" id="2155110">&amp;</span><span class="ident" id="2155111">ProcessState</span><span class="op" id="2155123">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155127">pid</span><span class="op" id="2155130">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2155135">pid1</span><span class="op" id="2155139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155143">status</span><span class="op" id="2155149">:</span>&nbsp;<span class="ident" id="2155151">status</span><span class="op" id="2155157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155161">rusage</span><span class="op" id="2155167">:</span>&nbsp;<span class="op" id="2155169">&amp;</span><span class="ident" id="2155170">rusage</span><span class="op" id="2155176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155182">return</span>&nbsp;<span class="ident" id="2155189">ps</span><span class="op" id="2155191">,</span>&nbsp;<span class="ident" id="2155193">nil</span><br>
<span class="lineno">35</span><span class="op" id="2155197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2155200">var</span>&nbsp;<span class="ident" id="2155204">errFinished</span>&nbsp;<span class="op" id="2155216">=</span>&nbsp;<span class="ident" id="2155218">errors</span><span class="op" id="2155224">.</span><span class="ident" id="2155225">New</span><span class="op" id="2155228">(</span><span class="string" id="2155229">&#34;os:&nbsp;process&nbsp;already&nbsp;finished&#34;</span><span class="op" id="2155259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2155262">func</span>&nbsp;<span class="op" id="2155267">(</span><span class="ident" id="2155268">p</span>&nbsp;<span class="op" id="2155270">*</span><span class="ident" id="2155271">Process</span><span class="op" id="2155278">)</span>&nbsp;<span class="ident" id="2155280">signal</span><span class="op" id="2155286">(</span><span class="ident" id="2155287">sig</span>&nbsp;<span class="ident" id="2155291">Signal</span><span class="op" id="2155297">)</span>&nbsp;<span class="builtintype" id="2155299">error</span>&nbsp;<span class="op" id="2155305">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155308">if</span>&nbsp;<span class="ident" id="2155311">p</span><span class="op" id="2155312">.</span><span class="ident" id="2155313">Pid</span>&nbsp;<span class="op" id="2155317">==</span>&nbsp;<span class="op" id="2155320">-</span><span class="num" id="2155321">1</span>&nbsp;<span class="op" id="2155323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155327">return</span>&nbsp;<span class="ident" id="2155334">errors</span><span class="op" id="2155340">.</span><span class="ident" id="2155341">New</span><span class="op" id="2155344">(</span><span class="string" id="2155345">&#34;os:&nbsp;process&nbsp;already&nbsp;released&#34;</span><span class="op" id="2155375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155381">if</span>&nbsp;<span class="ident" id="2155384">p</span><span class="op" id="2155385">.</span><span class="ident" id="2155386">Pid</span>&nbsp;<span class="op" id="2155390">==</span>&nbsp;<span class="num" id="2155393">0</span>&nbsp;<span class="op" id="2155395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155399">return</span>&nbsp;<span class="ident" id="2155406">errors</span><span class="op" id="2155412">.</span><span class="ident" id="2155413">New</span><span class="op" id="2155416">(</span><span class="string" id="2155417">&#34;os:&nbsp;process&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="2155446">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155452">if</span>&nbsp;<span class="ident" id="2155455">p</span><span class="op" id="2155456">.</span><span class="ident" id="2155457">done</span><span class="op" id="2155461">(</span><span class="op" id="2155462">)</span>&nbsp;<span class="op" id="2155464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155468">return</span>&nbsp;<span class="ident" id="2155475">errFinished</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155491">s</span><span class="op" id="2155492">,</span>&nbsp;<span class="ident" id="2155494">ok</span>&nbsp;<span class="op" id="2155497">:=</span>&nbsp;<span class="ident" id="2155500">sig</span><span class="op" id="2155503">.</span><span class="op" id="2155504">(</span><span class="ident" id="2155505">syscall</span><span class="op" id="2155512">.</span><span class="ident" id="2155513">Signal</span><span class="op" id="2155519">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155522">if</span>&nbsp;<span class="op" id="2155525">!</span><span class="ident" id="2155526">ok</span>&nbsp;<span class="op" id="2155529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155533">return</span>&nbsp;<span class="ident" id="2155540">errors</span><span class="op" id="2155546">.</span><span class="ident" id="2155547">New</span><span class="op" id="2155550">(</span><span class="string" id="2155551">&#34;os:&nbsp;unsupported&nbsp;signal&nbsp;type&#34;</span><span class="op" id="2155580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155586">if</span>&nbsp;<span class="ident" id="2155589">e</span>&nbsp;<span class="op" id="2155591">:=</span>&nbsp;<span class="ident" id="2155594">syscall</span><span class="op" id="2155601">.</span><span class="ident" id="2155602">Kill</span><span class="op" id="2155606">(</span><span class="ident" id="2155607">p</span><span class="op" id="2155608">.</span><span class="ident" id="2155609">Pid</span><span class="op" id="2155612">,</span>&nbsp;<span class="ident" id="2155614">s</span><span class="op" id="2155615">)</span><span class="op" id="2155616">;</span>&nbsp;<span class="ident" id="2155618">e</span>&nbsp;<span class="op" id="2155620">!=</span>&nbsp;<span class="ident" id="2155623">nil</span>&nbsp;<span class="op" id="2155627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155631">if</span>&nbsp;<span class="ident" id="2155634">e</span>&nbsp;<span class="op" id="2155636">==</span>&nbsp;<span class="ident" id="2155639">syscall</span><span class="op" id="2155646">.</span><span class="ident" id="2155647">ESRCH</span>&nbsp;<span class="op" id="2155653">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155658">return</span>&nbsp;<span class="ident" id="2155665">errFinished</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155683">return</span>&nbsp;<span class="ident" id="2155690">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155696">return</span>&nbsp;<span class="ident" id="2155703">nil</span><br>
<span class="lineno">60</span><span class="op" id="2155707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2155710">func</span>&nbsp;<span class="op" id="2155715">(</span><span class="ident" id="2155716">p</span>&nbsp;<span class="op" id="2155718">*</span><span class="ident" id="2155719">Process</span><span class="op" id="2155726">)</span>&nbsp;<span class="ident" id="2155728">release</span><span class="op" id="2155735">(</span><span class="op" id="2155736">)</span>&nbsp;<span class="builtintype" id="2155738">error</span>&nbsp;<span class="op" id="2155744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155747">//&nbsp;NOOP&nbsp;for&nbsp;unix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155766">p</span><span class="op" id="2155767">.</span><span class="ident" id="2155768">Pid</span>&nbsp;<span class="op" id="2155772">=</span>&nbsp;<span class="op" id="2155774">-</span><span class="num" id="2155775">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155778">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155814">runtime</span><span class="op" id="2155821">.</span><span class="ident" id="2155822">SetFinalizer</span><span class="op" id="2155834">(</span><span class="ident" id="2155835">p</span><span class="op" id="2155836">,</span>&nbsp;<span class="ident" id="2155838">nil</span><span class="op" id="2155841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155844">return</span>&nbsp;<span class="ident" id="2155851">nil</span><br>
<span class="lineno"></span><span class="op" id="2155855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2155858">func</span>&nbsp;<span class="ident" id="2155863">findProcess</span><span class="op" id="2155874">(</span><span class="ident" id="2155875">pid</span>&nbsp;<span class="builtintype" id="2155879">int</span><span class="op" id="2155882">)</span>&nbsp;<span class="op" id="2155884">(</span><span class="ident" id="2155885">p</span>&nbsp;<span class="op" id="2155887">*</span><span class="ident" id="2155888">Process</span><span class="op" id="2155895">,</span>&nbsp;<span class="ident" id="2155897">err</span>&nbsp;<span class="builtintype" id="2155901">error</span><span class="op" id="2155906">)</span>&nbsp;<span class="op" id="2155908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2155911">//&nbsp;NOOP&nbsp;for&nbsp;unix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155930">return</span>&nbsp;<span class="ident" id="2155937">newProcess</span><span class="op" id="2155947">(</span><span class="ident" id="2155948">pid</span><span class="op" id="2155951">,</span>&nbsp;<span class="num" id="2155953">0</span><span class="op" id="2155954">)</span><span class="op" id="2155955">,</span>&nbsp;<span class="ident" id="2155957">nil</span><br>
<span class="lineno"></span><span class="op" id="2155961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2155964">func</span>&nbsp;<span class="op" id="2155969">(</span><span class="ident" id="2155970">p</span>&nbsp;<span class="op" id="2155972">*</span><span class="ident" id="2155973">ProcessState</span><span class="op" id="2155985">)</span>&nbsp;<span class="ident" id="2155987">userTime</span><span class="op" id="2155995">(</span><span class="op" id="2155996">)</span>&nbsp;<span class="ident" id="2155998">time</span><span class="op" id="2156002">.</span><span class="ident" id="2156003">Duration</span>&nbsp;<span class="op" id="2156012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156015">return</span>&nbsp;<span class="ident" id="2156022">time</span><span class="op" id="2156026">.</span><span class="ident" id="2156027">Duration</span><span class="op" id="2156035">(</span><span class="ident" id="2156036">p</span><span class="op" id="2156037">.</span><span class="ident" id="2156038">rusage</span><span class="op" id="2156044">.</span><span class="ident" id="2156045">Utime</span><span class="op" id="2156050">.</span><span class="ident" id="2156051">Nano</span><span class="op" id="2156055">(</span><span class="op" id="2156056">)</span><span class="op" id="2156057">)</span>&nbsp;<span class="op" id="2156059">*</span>&nbsp;<span class="ident" id="2156061">time</span><span class="op" id="2156065">.</span><span class="ident" id="2156066">Nanosecond</span><br>
<span class="lineno"></span><span class="op" id="2156077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2156080">func</span>&nbsp;<span class="op" id="2156085">(</span><span class="ident" id="2156086">p</span>&nbsp;<span class="op" id="2156088">*</span><span class="ident" id="2156089">ProcessState</span><span class="op" id="2156101">)</span>&nbsp;<span class="ident" id="2156103">systemTime</span><span class="op" id="2156113">(</span><span class="op" id="2156114">)</span>&nbsp;<span class="ident" id="2156116">time</span><span class="op" id="2156120">.</span><span class="ident" id="2156121">Duration</span>&nbsp;<span class="op" id="2156130">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2156133">return</span>&nbsp;<span class="ident" id="2156140">time</span><span class="op" id="2156144">.</span><span class="ident" id="2156145">Duration</span><span class="op" id="2156153">(</span><span class="ident" id="2156154">p</span><span class="op" id="2156155">.</span><span class="ident" id="2156156">rusage</span><span class="op" id="2156162">.</span><span class="ident" id="2156163">Stime</span><span class="op" id="2156168">.</span><span class="ident" id="2156169">Nano</span><span class="op" id="2156173">(</span><span class="op" id="2156174">)</span><span class="op" id="2156175">)</span>&nbsp;<span class="op" id="2156177">*</span>&nbsp;<span class="ident" id="2156179">time</span><span class="op" id="2156183">.</span><span class="ident" id="2156184">Nanosecond</span><br>
<span class="lineno"></span><span class="op" id="2156195">}</span>
</div>
</body>
</html>
