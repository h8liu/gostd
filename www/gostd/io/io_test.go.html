<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html" class="current">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="289000">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="289055">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="289109">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="289160">package</span>&nbsp;<span class="ident" id="289168">io_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="289177">import</span>&nbsp;<span class="op" id="289184">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="289187">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="289196">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="289206">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="289213">.</span>&nbsp;<span class="string" id="289215">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="289221">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="289232">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="289242">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="289245">//&nbsp;An&nbsp;version&nbsp;of&nbsp;bytes.Buffer&nbsp;without&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno"></span><span class="keyword" id="289304">type</span>&nbsp;<span class="ident" id="289309">Buffer</span>&nbsp;<span class="keyword" id="289316">struct</span>&nbsp;<span class="op" id="289323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289326">bytes</span><span class="op" id="289331">.</span><span class="ident" id="289332">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289340">ReaderFrom</span>&nbsp;<span class="comment" id="289351">//&nbsp;conflicts&nbsp;with&nbsp;and&nbsp;hides&nbsp;bytes.Buffer&#39;s&nbsp;ReaderFrom.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289407">WriterTo</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="289418">//&nbsp;conflicts&nbsp;with&nbsp;and&nbsp;hides&nbsp;bytes.Buffer&#39;s&nbsp;WriterTo.</span><br>
<span class="lineno"></span><span class="op" id="289471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="289474">//&nbsp;Simple&nbsp;tests,&nbsp;primarily&nbsp;to&nbsp;verify&nbsp;the&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;callouts&nbsp;inside&nbsp;Copy&nbsp;and&nbsp;CopyN.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="289569">func</span>&nbsp;<span class="ident" id="289574">TestCopy</span><span class="op" id="289582">(</span><span class="ident" id="289583">t</span>&nbsp;<span class="op" id="289585">*</span><span class="ident" id="289586">testing</span><span class="op" id="289593">.</span><span class="ident" id="289594">T</span><span class="op" id="289595">)</span>&nbsp;<span class="op" id="289597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289600">rb</span>&nbsp;<span class="op" id="289603">:=</span>&nbsp;<span class="builtinfunc" id="289606">new</span><span class="op" id="289609">(</span><span class="ident" id="289610">Buffer</span><span class="op" id="289616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289619">wb</span>&nbsp;<span class="op" id="289622">:=</span>&nbsp;<span class="builtinfunc" id="289625">new</span><span class="op" id="289628">(</span><span class="ident" id="289629">Buffer</span><span class="op" id="289635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289638">rb</span><span class="op" id="289640">.</span><span class="ident" id="289641">WriteString</span><span class="op" id="289652">(</span><span class="string" id="289653">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="289668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289671">Copy</span><span class="op" id="289675">(</span><span class="ident" id="289676">wb</span><span class="op" id="289678">,</span>&nbsp;<span class="ident" id="289680">rb</span><span class="op" id="289682">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="289685">if</span>&nbsp;<span class="ident" id="289688">wb</span><span class="op" id="289690">.</span><span class="ident" id="289691">String</span><span class="op" id="289697">(</span><span class="op" id="289698">)</span>&nbsp;<span class="op" id="289700">!=</span>&nbsp;<span class="string" id="289703">&#34;hello,&nbsp;world.&#34;</span>&nbsp;<span class="op" id="289719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289723">t</span><span class="op" id="289724">.</span><span class="ident" id="289725">Errorf</span><span class="op" id="289731">(</span><span class="string" id="289732">&#34;Copy&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="289760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="289763">}</span><br>
<span class="lineno"></span><span class="op" id="289765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="289768">func</span>&nbsp;<span class="ident" id="289773">TestCopyReadFrom</span><span class="op" id="289789">(</span><span class="ident" id="289790">t</span>&nbsp;<span class="op" id="289792">*</span><span class="ident" id="289793">testing</span><span class="op" id="289800">.</span><span class="ident" id="289801">T</span><span class="op" id="289802">)</span>&nbsp;<span class="op" id="289804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289807">rb</span>&nbsp;<span class="op" id="289810">:=</span>&nbsp;<span class="builtinfunc" id="289813">new</span><span class="op" id="289816">(</span><span class="ident" id="289817">Buffer</span><span class="op" id="289823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289826">wb</span>&nbsp;<span class="op" id="289829">:=</span>&nbsp;<span class="builtinfunc" id="289832">new</span><span class="op" id="289835">(</span><span class="ident" id="289836">bytes</span><span class="op" id="289841">.</span><span class="ident" id="289842">Buffer</span><span class="op" id="289848">)</span>&nbsp;<span class="comment" id="289850">//&nbsp;implements&nbsp;ReadFrom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289875">rb</span><span class="op" id="289877">.</span><span class="ident" id="289878">WriteString</span><span class="op" id="289889">(</span><span class="string" id="289890">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="289905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289908">Copy</span><span class="op" id="289912">(</span><span class="ident" id="289913">wb</span><span class="op" id="289915">,</span>&nbsp;<span class="ident" id="289917">rb</span><span class="op" id="289919">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="289922">if</span>&nbsp;<span class="ident" id="289925">wb</span><span class="op" id="289927">.</span><span class="ident" id="289928">String</span><span class="op" id="289934">(</span><span class="op" id="289935">)</span>&nbsp;<span class="op" id="289937">!=</span>&nbsp;<span class="string" id="289940">&#34;hello,&nbsp;world.&#34;</span>&nbsp;<span class="op" id="289956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="289960">t</span><span class="op" id="289961">.</span><span class="ident" id="289962">Errorf</span><span class="op" id="289968">(</span><span class="string" id="289969">&#34;Copy&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="289997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="290000">}</span><br>
<span class="lineno"></span><span class="op" id="290002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="290005">func</span>&nbsp;<span class="ident" id="290010">TestCopyWriteTo</span><span class="op" id="290025">(</span><span class="ident" id="290026">t</span>&nbsp;<span class="op" id="290028">*</span><span class="ident" id="290029">testing</span><span class="op" id="290036">.</span><span class="ident" id="290037">T</span><span class="op" id="290038">)</span>&nbsp;<span class="op" id="290040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290043">rb</span>&nbsp;<span class="op" id="290046">:=</span>&nbsp;<span class="builtinfunc" id="290049">new</span><span class="op" id="290052">(</span><span class="ident" id="290053">bytes</span><span class="op" id="290058">.</span><span class="ident" id="290059">Buffer</span><span class="op" id="290065">)</span>&nbsp;<span class="comment" id="290067">//&nbsp;implements&nbsp;WriteTo.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290091">wb</span>&nbsp;<span class="op" id="290094">:=</span>&nbsp;<span class="builtinfunc" id="290097">new</span><span class="op" id="290100">(</span><span class="ident" id="290101">Buffer</span><span class="op" id="290107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290110">rb</span><span class="op" id="290112">.</span><span class="ident" id="290113">WriteString</span><span class="op" id="290124">(</span><span class="string" id="290125">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="290140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290143">Copy</span><span class="op" id="290147">(</span><span class="ident" id="290148">wb</span><span class="op" id="290150">,</span>&nbsp;<span class="ident" id="290152">rb</span><span class="op" id="290154">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="290157">if</span>&nbsp;<span class="ident" id="290160">wb</span><span class="op" id="290162">.</span><span class="ident" id="290163">String</span><span class="op" id="290169">(</span><span class="op" id="290170">)</span>&nbsp;<span class="op" id="290172">!=</span>&nbsp;<span class="string" id="290175">&#34;hello,&nbsp;world.&#34;</span>&nbsp;<span class="op" id="290191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290195">t</span><span class="op" id="290196">.</span><span class="ident" id="290197">Errorf</span><span class="op" id="290203">(</span><span class="string" id="290204">&#34;Copy&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="290232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="290235">}</span><br>
<span class="lineno"></span><span class="op" id="290237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="290240">//&nbsp;Version&nbsp;of&nbsp;bytes.Buffer&nbsp;that&nbsp;checks&nbsp;whether&nbsp;WriteTo&nbsp;was&nbsp;called&nbsp;or&nbsp;not</span><br>
<span class="lineno"></span><span class="keyword" id="290313">type</span>&nbsp;<span class="ident" id="290318">writeToChecker</span>&nbsp;<span class="keyword" id="290333">struct</span>&nbsp;<span class="op" id="290340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290343">bytes</span><span class="op" id="290348">.</span><span class="ident" id="290349">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290357">writeToCalled</span>&nbsp;<span class="builtintype" id="290371">bool</span><br>
<span class="lineno"></span><span class="op" id="290376">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="290379">func</span>&nbsp;<span class="op" id="290384">(</span><span class="ident" id="290385">wt</span>&nbsp;<span class="op" id="290388">*</span><span class="ident" id="290389">writeToChecker</span><span class="op" id="290403">)</span>&nbsp;<span class="ident" id="290405">WriteTo</span><span class="op" id="290412">(</span><span class="ident" id="290413">w</span>&nbsp;<span class="ident" id="290415">Writer</span><span class="op" id="290421">)</span>&nbsp;<span class="op" id="290423">(</span><span class="ident" id="290424">int64</span><span class="op" id="290429">,</span>&nbsp;<span class="builtintype" id="290431">error</span><span class="op" id="290436">)</span>&nbsp;<span class="op" id="290438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290441">wt</span><span class="op" id="290443">.</span><span class="ident" id="290444">writeToCalled</span>&nbsp;<span class="op" id="290458">=</span>&nbsp;<span class="builtintype" id="290460">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="290466">return</span>&nbsp;<span class="ident" id="290473">wt</span><span class="op" id="290475">.</span><span class="ident" id="290476">Buffer</span><span class="op" id="290482">.</span><span class="ident" id="290483">WriteTo</span><span class="op" id="290490">(</span><span class="ident" id="290491">w</span><span class="op" id="290492">)</span><br>
<span class="lineno"></span><span class="op" id="290494">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="290497">//&nbsp;It&#39;s&nbsp;preferable&nbsp;to&nbsp;choose&nbsp;WriterTo&nbsp;over&nbsp;ReaderFrom,&nbsp;since&nbsp;a&nbsp;WriterTo&nbsp;can&nbsp;issue&nbsp;one&nbsp;large&nbsp;write,</span><br>
<span class="lineno"></span><span class="comment" id="290596">//&nbsp;while&nbsp;the&nbsp;ReaderFrom&nbsp;must&nbsp;read&nbsp;until&nbsp;EOF,&nbsp;potentially&nbsp;allocating&nbsp;when&nbsp;running&nbsp;out&nbsp;of&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="290692">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;we&nbsp;choose&nbsp;WriterTo&nbsp;when&nbsp;both&nbsp;are&nbsp;implemented.</span><br>
<span class="lineno"></span><span class="keyword" id="290756">func</span>&nbsp;<span class="ident" id="290761">TestCopyPriority</span><span class="op" id="290777">(</span><span class="ident" id="290778">t</span>&nbsp;<span class="op" id="290780">*</span><span class="ident" id="290781">testing</span><span class="op" id="290788">.</span><span class="ident" id="290789">T</span><span class="op" id="290790">)</span>&nbsp;<span class="op" id="290792">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290795">rb</span>&nbsp;<span class="op" id="290798">:=</span>&nbsp;<span class="builtinfunc" id="290801">new</span><span class="op" id="290804">(</span><span class="ident" id="290805">writeToChecker</span><span class="op" id="290819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290822">wb</span>&nbsp;<span class="op" id="290825">:=</span>&nbsp;<span class="builtinfunc" id="290828">new</span><span class="op" id="290831">(</span><span class="ident" id="290832">bytes</span><span class="op" id="290837">.</span><span class="ident" id="290838">Buffer</span><span class="op" id="290844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290847">rb</span><span class="op" id="290849">.</span><span class="ident" id="290850">WriteString</span><span class="op" id="290861">(</span><span class="string" id="290862">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="290877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290880">Copy</span><span class="op" id="290884">(</span><span class="ident" id="290885">wb</span><span class="op" id="290887">,</span>&nbsp;<span class="ident" id="290889">rb</span><span class="op" id="290891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="290894">if</span>&nbsp;<span class="ident" id="290897">wb</span><span class="op" id="290899">.</span><span class="ident" id="290900">String</span><span class="op" id="290906">(</span><span class="op" id="290907">)</span>&nbsp;<span class="op" id="290909">!=</span>&nbsp;<span class="string" id="290912">&#34;hello,&nbsp;world.&#34;</span>&nbsp;<span class="op" id="290928">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="290932">t</span><span class="op" id="290933">.</span><span class="ident" id="290934">Errorf</span><span class="op" id="290940">(</span><span class="string" id="290941">&#34;Copy&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="290969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="290972">}</span>&nbsp;<span class="keyword" id="290974">else</span>&nbsp;<span class="keyword" id="290979">if</span>&nbsp;<span class="op" id="290982">!</span><span class="ident" id="290983">rb</span><span class="op" id="290985">.</span><span class="ident" id="290986">writeToCalled</span>&nbsp;<span class="op" id="291000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291004">t</span><span class="op" id="291005">.</span><span class="ident" id="291006">Errorf</span><span class="op" id="291012">(</span><span class="string" id="291013">&#34;WriteTo&nbsp;was&nbsp;not&nbsp;prioritized&nbsp;over&nbsp;ReadFrom&#34;</span><span class="op" id="291056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="291059">}</span><br>
<span class="lineno"></span><span class="op" id="291061">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="291064">func</span>&nbsp;<span class="ident" id="291069">TestCopyN</span><span class="op" id="291078">(</span><span class="ident" id="291079">t</span>&nbsp;<span class="op" id="291081">*</span><span class="ident" id="291082">testing</span><span class="op" id="291089">.</span><span class="ident" id="291090">T</span><span class="op" id="291091">)</span>&nbsp;<span class="op" id="291093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291096">rb</span>&nbsp;<span class="op" id="291099">:=</span>&nbsp;<span class="builtinfunc" id="291102">new</span><span class="op" id="291105">(</span><span class="ident" id="291106">Buffer</span><span class="op" id="291112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291115">wb</span>&nbsp;<span class="op" id="291118">:=</span>&nbsp;<span class="builtinfunc" id="291121">new</span><span class="op" id="291124">(</span><span class="ident" id="291125">Buffer</span><span class="op" id="291131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291134">rb</span><span class="op" id="291136">.</span><span class="ident" id="291137">WriteString</span><span class="op" id="291148">(</span><span class="string" id="291149">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="291164">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291167">CopyN</span><span class="op" id="291172">(</span><span class="ident" id="291173">wb</span><span class="op" id="291175">,</span>&nbsp;<span class="ident" id="291177">rb</span><span class="op" id="291179">,</span>&nbsp;<span class="num" id="291181">5</span><span class="op" id="291182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="291185">if</span>&nbsp;<span class="ident" id="291188">wb</span><span class="op" id="291190">.</span><span class="ident" id="291191">String</span><span class="op" id="291197">(</span><span class="op" id="291198">)</span>&nbsp;<span class="op" id="291200">!=</span>&nbsp;<span class="string" id="291203">&#34;hello&#34;</span>&nbsp;<span class="op" id="291211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291215">t</span><span class="op" id="291216">.</span><span class="ident" id="291217">Errorf</span><span class="op" id="291223">(</span><span class="string" id="291224">&#34;CopyN&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="291253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="291256">}</span><br>
<span class="lineno"></span><span class="op" id="291258">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="291261">func</span>&nbsp;<span class="ident" id="291266">TestCopyNReadFrom</span><span class="op" id="291283">(</span><span class="ident" id="291284">t</span>&nbsp;<span class="op" id="291286">*</span><span class="ident" id="291287">testing</span><span class="op" id="291294">.</span><span class="ident" id="291295">T</span><span class="op" id="291296">)</span>&nbsp;<span class="op" id="291298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291301">rb</span>&nbsp;<span class="op" id="291304">:=</span>&nbsp;<span class="builtinfunc" id="291307">new</span><span class="op" id="291310">(</span><span class="ident" id="291311">Buffer</span><span class="op" id="291317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291320">wb</span>&nbsp;<span class="op" id="291323">:=</span>&nbsp;<span class="builtinfunc" id="291326">new</span><span class="op" id="291329">(</span><span class="ident" id="291330">bytes</span><span class="op" id="291335">.</span><span class="ident" id="291336">Buffer</span><span class="op" id="291342">)</span>&nbsp;<span class="comment" id="291344">//&nbsp;implements&nbsp;ReadFrom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291369">rb</span><span class="op" id="291371">.</span><span class="ident" id="291372">WriteString</span><span class="op" id="291383">(</span><span class="string" id="291384">&#34;hello&#34;</span><span class="op" id="291391">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291394">CopyN</span><span class="op" id="291399">(</span><span class="ident" id="291400">wb</span><span class="op" id="291402">,</span>&nbsp;<span class="ident" id="291404">rb</span><span class="op" id="291406">,</span>&nbsp;<span class="num" id="291408">5</span><span class="op" id="291409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="291412">if</span>&nbsp;<span class="ident" id="291415">wb</span><span class="op" id="291417">.</span><span class="ident" id="291418">String</span><span class="op" id="291424">(</span><span class="op" id="291425">)</span>&nbsp;<span class="op" id="291427">!=</span>&nbsp;<span class="string" id="291430">&#34;hello&#34;</span>&nbsp;<span class="op" id="291438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291442">t</span><span class="op" id="291443">.</span><span class="ident" id="291444">Errorf</span><span class="op" id="291450">(</span><span class="string" id="291451">&#34;CopyN&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="291480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="291483">}</span><br>
<span class="lineno"></span><span class="op" id="291485">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="291488">func</span>&nbsp;<span class="ident" id="291493">TestCopyNWriteTo</span><span class="op" id="291509">(</span><span class="ident" id="291510">t</span>&nbsp;<span class="op" id="291512">*</span><span class="ident" id="291513">testing</span><span class="op" id="291520">.</span><span class="ident" id="291521">T</span><span class="op" id="291522">)</span>&nbsp;<span class="op" id="291524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291527">rb</span>&nbsp;<span class="op" id="291530">:=</span>&nbsp;<span class="builtinfunc" id="291533">new</span><span class="op" id="291536">(</span><span class="ident" id="291537">bytes</span><span class="op" id="291542">.</span><span class="ident" id="291543">Buffer</span><span class="op" id="291549">)</span>&nbsp;<span class="comment" id="291551">//&nbsp;implements&nbsp;WriteTo.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291575">wb</span>&nbsp;<span class="op" id="291578">:=</span>&nbsp;<span class="builtinfunc" id="291581">new</span><span class="op" id="291584">(</span><span class="ident" id="291585">Buffer</span><span class="op" id="291591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291594">rb</span><span class="op" id="291596">.</span><span class="ident" id="291597">WriteString</span><span class="op" id="291608">(</span><span class="string" id="291609">&#34;hello,&nbsp;world.&#34;</span><span class="op" id="291624">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291627">CopyN</span><span class="op" id="291632">(</span><span class="ident" id="291633">wb</span><span class="op" id="291635">,</span>&nbsp;<span class="ident" id="291637">rb</span><span class="op" id="291639">,</span>&nbsp;<span class="num" id="291641">5</span><span class="op" id="291642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="291645">if</span>&nbsp;<span class="ident" id="291648">wb</span><span class="op" id="291650">.</span><span class="ident" id="291651">String</span><span class="op" id="291657">(</span><span class="op" id="291658">)</span>&nbsp;<span class="op" id="291660">!=</span>&nbsp;<span class="string" id="291663">&#34;hello&#34;</span>&nbsp;<span class="op" id="291671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291675">t</span><span class="op" id="291676">.</span><span class="ident" id="291677">Errorf</span><span class="op" id="291683">(</span><span class="string" id="291684">&#34;CopyN&nbsp;did&nbsp;not&nbsp;work&nbsp;properly&#34;</span><span class="op" id="291713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="291716">}</span><br>
<span class="lineno"></span><span class="op" id="291718">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="291721">type</span>&nbsp;<span class="ident" id="291726">noReadFrom</span>&nbsp;<span class="keyword" id="291737">struct</span>&nbsp;<span class="op" id="291744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="291747">w</span>&nbsp;<span class="ident" id="291749">Writer</span><br>
<span class="lineno"></span><span class="op" id="291756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="291759">func</span>&nbsp;<span class="op" id="291764">(</span><span class="ident" id="291765">w</span>&nbsp;<span class="op" id="291767">*</span><span class="ident" id="291768">noReadFrom</span><span class="op" id="291778">)</span>&nbsp;<span class="ident" id="291780">Write</span><span class="op" id="291785">(</span><span class="ident" id="291786">p</span>&nbsp;<span class="op" id="291788">[</span><span class="op" id="291789">]</span><span class="builtintype" id="291790">byte</span><span class="op" id="291794">)</span>&nbsp;<span class="op" id="291796">(</span><span class="ident" id="291797">n</span>&nbsp;<span class="builtintype" id="291799">int</span><span class="op" id="291802">,</span>&nbsp;<span class="ident" id="291804">err</span>&nbsp;<span class="builtintype" id="291808">error</span><span class="op" id="291813">)</span>&nbsp;<span class="op" id="291815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="291818">return</span>&nbsp;<span class="ident" id="291825">w</span><span class="op" id="291826">.</span><span class="ident" id="291827">w</span><span class="op" id="291828">.</span><span class="ident" id="291829">Write</span><span class="op" id="291834">(</span><span class="ident" id="291835">p</span><span class="op" id="291836">)</span><br>
<span class="lineno"></span><span class="op" id="291838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="291841">type</span>&nbsp;<span class="ident" id="291846">wantedAndErrReader</span>&nbsp;<span class="keyword" id="291865">struct</span><span class="op" id="291871">{</span><span class="op" id="291872">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="291875">func</span>&nbsp;<span class="op" id="291880">(</span><span class="ident" id="291881">wantedAndErrReader</span><span class="op" id="291899">)</span>&nbsp;<span class="ident" id="291901">Read</span><span class="op" id="291905">(</span><span class="ident" id="291906">p</span>&nbsp;<span class="op" id="291908">[</span><span class="op" id="291909">]</span><span class="builtintype" id="291910">byte</span><span class="op" id="291914">)</span>&nbsp;<span class="op" id="291916">(</span><span class="builtintype" id="291917">int</span><span class="op" id="291920">,</span>&nbsp;<span class="builtintype" id="291922">error</span><span class="op" id="291927">)</span>&nbsp;<span class="op" id="291929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="291932">return</span>&nbsp;<span class="builtinfunc" id="291939">len</span><span class="op" id="291942">(</span><span class="ident" id="291943">p</span><span class="op" id="291944">)</span><span class="op" id="291945">,</span>&nbsp;<span class="ident" id="291947">errors</span><span class="op" id="291953">.</span><span class="ident" id="291954">New</span><span class="op" id="291957">(</span><span class="string" id="291958">&#34;wantedAndErrReader&nbsp;error&#34;</span><span class="op" id="291984">)</span><br>
<span class="lineno"></span><span class="op" id="291986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="291989">func</span>&nbsp;<span class="ident" id="291994">TestCopyNEOF</span><span class="op" id="292006">(</span><span class="ident" id="292007">t</span>&nbsp;<span class="op" id="292009">*</span><span class="ident" id="292010">testing</span><span class="op" id="292017">.</span><span class="ident" id="292018">T</span><span class="op" id="292019">)</span>&nbsp;<span class="op" id="292021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="292024">//&nbsp;Test&nbsp;that&nbsp;EOF&nbsp;behavior&nbsp;is&nbsp;the&nbsp;same&nbsp;regardless&nbsp;of&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="292085">//&nbsp;argument&nbsp;to&nbsp;CopyN&nbsp;has&nbsp;ReadFrom.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292122">b</span>&nbsp;<span class="op" id="292124">:=</span>&nbsp;<span class="builtinfunc" id="292127">new</span><span class="op" id="292130">(</span><span class="ident" id="292131">bytes</span><span class="op" id="292136">.</span><span class="ident" id="292137">Buffer</span><span class="op" id="292143">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292147">n</span><span class="op" id="292148">,</span>&nbsp;<span class="ident" id="292150">err</span>&nbsp;<span class="op" id="292154">:=</span>&nbsp;<span class="ident" id="292157">CopyN</span><span class="op" id="292162">(</span><span class="op" id="292163">&amp;</span><span class="ident" id="292164">noReadFrom</span><span class="op" id="292174">{</span><span class="ident" id="292175">b</span><span class="op" id="292176">}</span><span class="op" id="292177">,</span>&nbsp;<span class="ident" id="292179">strings</span><span class="op" id="292186">.</span><span class="ident" id="292187">NewReader</span><span class="op" id="292196">(</span><span class="string" id="292197">&#34;foo&#34;</span><span class="op" id="292202">)</span><span class="op" id="292203">,</span>&nbsp;<span class="num" id="292205">3</span><span class="op" id="292206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="292209">if</span>&nbsp;<span class="ident" id="292212">n</span>&nbsp;<span class="op" id="292214">!=</span>&nbsp;<span class="num" id="292217">3</span>&nbsp;<span class="op" id="292219">||</span>&nbsp;<span class="ident" id="292222">err</span>&nbsp;<span class="op" id="292226">!=</span>&nbsp;<span class="builtintype" id="292229">nil</span>&nbsp;<span class="op" id="292233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292237">t</span><span class="op" id="292238">.</span><span class="ident" id="292239">Errorf</span><span class="op" id="292245">(</span><span class="string" id="292246">&#34;CopyN(noReadFrom,&nbsp;foo,&nbsp;3)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;nil&#34;</span><span class="op" id="292295">,</span>&nbsp;<span class="ident" id="292297">n</span><span class="op" id="292298">,</span>&nbsp;<span class="ident" id="292300">err</span><span class="op" id="292303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="292306">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292310">n</span><span class="op" id="292311">,</span>&nbsp;<span class="ident" id="292313">err</span>&nbsp;<span class="op" id="292317">=</span>&nbsp;<span class="ident" id="292319">CopyN</span><span class="op" id="292324">(</span><span class="op" id="292325">&amp;</span><span class="ident" id="292326">noReadFrom</span><span class="op" id="292336">{</span><span class="ident" id="292337">b</span><span class="op" id="292338">}</span><span class="op" id="292339">,</span>&nbsp;<span class="ident" id="292341">strings</span><span class="op" id="292348">.</span><span class="ident" id="292349">NewReader</span><span class="op" id="292358">(</span><span class="string" id="292359">&#34;foo&#34;</span><span class="op" id="292364">)</span><span class="op" id="292365">,</span>&nbsp;<span class="num" id="292367">4</span><span class="op" id="292368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="292371">if</span>&nbsp;<span class="ident" id="292374">n</span>&nbsp;<span class="op" id="292376">!=</span>&nbsp;<span class="num" id="292379">3</span>&nbsp;<span class="op" id="292381">||</span>&nbsp;<span class="ident" id="292384">err</span>&nbsp;<span class="op" id="292388">!=</span>&nbsp;<span class="ident" id="292391">EOF</span>&nbsp;<span class="op" id="292395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292399">t</span><span class="op" id="292400">.</span><span class="ident" id="292401">Errorf</span><span class="op" id="292407">(</span><span class="string" id="292408">&#34;CopyN(noReadFrom,&nbsp;foo,&nbsp;4)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="292457">,</span>&nbsp;<span class="ident" id="292459">n</span><span class="op" id="292460">,</span>&nbsp;<span class="ident" id="292462">err</span><span class="op" id="292465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="292468">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292472">n</span><span class="op" id="292473">,</span>&nbsp;<span class="ident" id="292475">err</span>&nbsp;<span class="op" id="292479">=</span>&nbsp;<span class="ident" id="292481">CopyN</span><span class="op" id="292486">(</span><span class="ident" id="292487">b</span><span class="op" id="292488">,</span>&nbsp;<span class="ident" id="292490">strings</span><span class="op" id="292497">.</span><span class="ident" id="292498">NewReader</span><span class="op" id="292507">(</span><span class="string" id="292508">&#34;foo&#34;</span><span class="op" id="292513">)</span><span class="op" id="292514">,</span>&nbsp;<span class="num" id="292516">3</span><span class="op" id="292517">)</span>&nbsp;<span class="comment" id="292519">//&nbsp;b&nbsp;has&nbsp;read&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="292539">if</span>&nbsp;<span class="ident" id="292542">n</span>&nbsp;<span class="op" id="292544">!=</span>&nbsp;<span class="num" id="292547">3</span>&nbsp;<span class="op" id="292549">||</span>&nbsp;<span class="ident" id="292552">err</span>&nbsp;<span class="op" id="292556">!=</span>&nbsp;<span class="builtintype" id="292559">nil</span>&nbsp;<span class="op" id="292563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292567">t</span><span class="op" id="292568">.</span><span class="ident" id="292569">Errorf</span><span class="op" id="292575">(</span><span class="string" id="292576">&#34;CopyN(bytes.Buffer,&nbsp;foo,&nbsp;3)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;nil&#34;</span><span class="op" id="292627">,</span>&nbsp;<span class="ident" id="292629">n</span><span class="op" id="292630">,</span>&nbsp;<span class="ident" id="292632">err</span><span class="op" id="292635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="292638">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292642">n</span><span class="op" id="292643">,</span>&nbsp;<span class="ident" id="292645">err</span>&nbsp;<span class="op" id="292649">=</span>&nbsp;<span class="ident" id="292651">CopyN</span><span class="op" id="292656">(</span><span class="ident" id="292657">b</span><span class="op" id="292658">,</span>&nbsp;<span class="ident" id="292660">strings</span><span class="op" id="292667">.</span><span class="ident" id="292668">NewReader</span><span class="op" id="292677">(</span><span class="string" id="292678">&#34;foo&#34;</span><span class="op" id="292683">)</span><span class="op" id="292684">,</span>&nbsp;<span class="num" id="292686">4</span><span class="op" id="292687">)</span>&nbsp;<span class="comment" id="292689">//&nbsp;b&nbsp;has&nbsp;read&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="292709">if</span>&nbsp;<span class="ident" id="292712">n</span>&nbsp;<span class="op" id="292714">!=</span>&nbsp;<span class="num" id="292717">3</span>&nbsp;<span class="op" id="292719">||</span>&nbsp;<span class="ident" id="292722">err</span>&nbsp;<span class="op" id="292726">!=</span>&nbsp;<span class="ident" id="292729">EOF</span>&nbsp;<span class="op" id="292733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292737">t</span><span class="op" id="292738">.</span><span class="ident" id="292739">Errorf</span><span class="op" id="292745">(</span><span class="string" id="292746">&#34;CopyN(bytes.Buffer,&nbsp;foo,&nbsp;4)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="292797">,</span>&nbsp;<span class="ident" id="292799">n</span><span class="op" id="292800">,</span>&nbsp;<span class="ident" id="292802">err</span><span class="op" id="292805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="292808">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292812">n</span><span class="op" id="292813">,</span>&nbsp;<span class="ident" id="292815">err</span>&nbsp;<span class="op" id="292819">=</span>&nbsp;<span class="ident" id="292821">CopyN</span><span class="op" id="292826">(</span><span class="ident" id="292827">b</span><span class="op" id="292828">,</span>&nbsp;<span class="ident" id="292830">wantedAndErrReader</span><span class="op" id="292848">{</span><span class="op" id="292849">}</span><span class="op" id="292850">,</span>&nbsp;<span class="num" id="292852">5</span><span class="op" id="292853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="292856">if</span>&nbsp;<span class="ident" id="292859">n</span>&nbsp;<span class="op" id="292861">!=</span>&nbsp;<span class="num" id="292864">5</span>&nbsp;<span class="op" id="292866">||</span>&nbsp;<span class="ident" id="292869">err</span>&nbsp;<span class="op" id="292873">!=</span>&nbsp;<span class="builtintype" id="292876">nil</span>&nbsp;<span class="op" id="292880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292884">t</span><span class="op" id="292885">.</span><span class="ident" id="292886">Errorf</span><span class="op" id="292892">(</span><span class="string" id="292893">&#34;CopyN(bytes.Buffer,&nbsp;wantedAndErrReader,&nbsp;5)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;5,&nbsp;nil&#34;</span><span class="op" id="292959">,</span>&nbsp;<span class="ident" id="292961">n</span><span class="op" id="292962">,</span>&nbsp;<span class="ident" id="292964">err</span><span class="op" id="292967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="292970">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="292974">n</span><span class="op" id="292975">,</span>&nbsp;<span class="ident" id="292977">err</span>&nbsp;<span class="op" id="292981">=</span>&nbsp;<span class="ident" id="292983">CopyN</span><span class="op" id="292988">(</span><span class="op" id="292989">&amp;</span><span class="ident" id="292990">noReadFrom</span><span class="op" id="293000">{</span><span class="ident" id="293001">b</span><span class="op" id="293002">}</span><span class="op" id="293003">,</span>&nbsp;<span class="ident" id="293005">wantedAndErrReader</span><span class="op" id="293023">{</span><span class="op" id="293024">}</span><span class="op" id="293025">,</span>&nbsp;<span class="num" id="293027">5</span><span class="op" id="293028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293031">if</span>&nbsp;<span class="ident" id="293034">n</span>&nbsp;<span class="op" id="293036">!=</span>&nbsp;<span class="num" id="293039">5</span>&nbsp;<span class="op" id="293041">||</span>&nbsp;<span class="ident" id="293044">err</span>&nbsp;<span class="op" id="293048">!=</span>&nbsp;<span class="builtintype" id="293051">nil</span>&nbsp;<span class="op" id="293055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293059">t</span><span class="op" id="293060">.</span><span class="ident" id="293061">Errorf</span><span class="op" id="293067">(</span><span class="string" id="293068">&#34;CopyN(noReadFrom,&nbsp;wantedAndErrReader,&nbsp;5)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;5,&nbsp;nil&#34;</span><span class="op" id="293132">,</span>&nbsp;<span class="ident" id="293134">n</span><span class="op" id="293135">,</span>&nbsp;<span class="ident" id="293137">err</span><span class="op" id="293140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="293143">}</span><br>
<span class="lineno">160</span><span class="op" id="293145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="293148">func</span>&nbsp;<span class="ident" id="293153">TestReadAtLeast</span><span class="op" id="293168">(</span><span class="ident" id="293169">t</span>&nbsp;<span class="op" id="293171">*</span><span class="ident" id="293172">testing</span><span class="op" id="293179">.</span><span class="ident" id="293180">T</span><span class="op" id="293181">)</span>&nbsp;<span class="op" id="293183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293186">var</span>&nbsp;<span class="ident" id="293190">rb</span>&nbsp;<span class="ident" id="293193">bytes</span><span class="op" id="293198">.</span><span class="ident" id="293199">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293207">testReadAtLeast</span><span class="op" id="293222">(</span><span class="ident" id="293223">t</span><span class="op" id="293224">,</span>&nbsp;<span class="op" id="293226">&amp;</span><span class="ident" id="293227">rb</span><span class="op" id="293229">)</span><br>
<span class="lineno">165</span><span class="op" id="293231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="293234">//&nbsp;A&nbsp;version&nbsp;of&nbsp;bytes.Buffer&nbsp;that&nbsp;returns&nbsp;n&nbsp;&gt;&nbsp;0,&nbsp;err&nbsp;on&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="293295">//&nbsp;when&nbsp;the&nbsp;input&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="293327">type</span>&nbsp;<span class="ident" id="293332">dataAndErrorBuffer</span>&nbsp;<span class="keyword" id="293351">struct</span>&nbsp;<span class="op" id="293358">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293361">err</span>&nbsp;<span class="builtintype" id="293365">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293372">bytes</span><span class="op" id="293377">.</span><span class="ident" id="293378">Buffer</span><br>
<span class="lineno"></span><span class="op" id="293385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="293388">func</span>&nbsp;<span class="op" id="293393">(</span><span class="ident" id="293394">r</span>&nbsp;<span class="op" id="293396">*</span><span class="ident" id="293397">dataAndErrorBuffer</span><span class="op" id="293415">)</span>&nbsp;<span class="ident" id="293417">Read</span><span class="op" id="293421">(</span><span class="ident" id="293422">p</span>&nbsp;<span class="op" id="293424">[</span><span class="op" id="293425">]</span><span class="builtintype" id="293426">byte</span><span class="op" id="293430">)</span>&nbsp;<span class="op" id="293432">(</span><span class="ident" id="293433">n</span>&nbsp;<span class="builtintype" id="293435">int</span><span class="op" id="293438">,</span>&nbsp;<span class="ident" id="293440">err</span>&nbsp;<span class="builtintype" id="293444">error</span><span class="op" id="293449">)</span>&nbsp;<span class="op" id="293451">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293454">n</span><span class="op" id="293455">,</span>&nbsp;<span class="ident" id="293457">err</span>&nbsp;<span class="op" id="293461">=</span>&nbsp;<span class="ident" id="293463">r</span><span class="op" id="293464">.</span><span class="ident" id="293465">Buffer</span><span class="op" id="293471">.</span><span class="ident" id="293472">Read</span><span class="op" id="293476">(</span><span class="ident" id="293477">p</span><span class="op" id="293478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293481">if</span>&nbsp;<span class="ident" id="293484">n</span>&nbsp;<span class="op" id="293486">&gt;</span>&nbsp;<span class="num" id="293488">0</span>&nbsp;<span class="op" id="293490">&amp;&amp;</span>&nbsp;<span class="ident" id="293493">r</span><span class="op" id="293494">.</span><span class="ident" id="293495">Buffer</span><span class="op" id="293501">.</span><span class="ident" id="293502">Len</span><span class="op" id="293505">(</span><span class="op" id="293506">)</span>&nbsp;<span class="op" id="293508">==</span>&nbsp;<span class="num" id="293511">0</span>&nbsp;<span class="op" id="293513">&amp;&amp;</span>&nbsp;<span class="ident" id="293516">err</span>&nbsp;<span class="op" id="293520">==</span>&nbsp;<span class="builtintype" id="293523">nil</span>&nbsp;<span class="op" id="293527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293531">err</span>&nbsp;<span class="op" id="293535">=</span>&nbsp;<span class="ident" id="293537">r</span><span class="op" id="293538">.</span><span class="ident" id="293539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="293544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293547">return</span><br>
<span class="lineno">180</span><span class="op" id="293554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="293557">func</span>&nbsp;<span class="ident" id="293562">TestReadAtLeastWithDataAndEOF</span><span class="op" id="293591">(</span><span class="ident" id="293592">t</span>&nbsp;<span class="op" id="293594">*</span><span class="ident" id="293595">testing</span><span class="op" id="293602">.</span><span class="ident" id="293603">T</span><span class="op" id="293604">)</span>&nbsp;<span class="op" id="293606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293609">var</span>&nbsp;<span class="ident" id="293613">rb</span>&nbsp;<span class="ident" id="293616">dataAndErrorBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293636">rb</span><span class="op" id="293638">.</span><span class="ident" id="293639">err</span>&nbsp;<span class="op" id="293643">=</span>&nbsp;<span class="ident" id="293645">EOF</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293650">testReadAtLeast</span><span class="op" id="293665">(</span><span class="ident" id="293666">t</span><span class="op" id="293667">,</span>&nbsp;<span class="op" id="293669">&amp;</span><span class="ident" id="293670">rb</span><span class="op" id="293672">)</span><br>
<span class="lineno"></span><span class="op" id="293674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="293677">func</span>&nbsp;<span class="ident" id="293682">TestReadAtLeastWithDataAndError</span><span class="op" id="293713">(</span><span class="ident" id="293714">t</span>&nbsp;<span class="op" id="293716">*</span><span class="ident" id="293717">testing</span><span class="op" id="293724">.</span><span class="ident" id="293725">T</span><span class="op" id="293726">)</span>&nbsp;<span class="op" id="293728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293731">var</span>&nbsp;<span class="ident" id="293735">rb</span>&nbsp;<span class="ident" id="293738">dataAndErrorBuffer</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293758">rb</span><span class="op" id="293760">.</span><span class="ident" id="293761">err</span>&nbsp;<span class="op" id="293765">=</span>&nbsp;<span class="ident" id="293767">fmt</span><span class="op" id="293770">.</span><span class="ident" id="293771">Errorf</span><span class="op" id="293777">(</span><span class="string" id="293778">&#34;fake&nbsp;error&#34;</span><span class="op" id="293790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293793">testReadAtLeast</span><span class="op" id="293808">(</span><span class="ident" id="293809">t</span><span class="op" id="293810">,</span>&nbsp;<span class="op" id="293812">&amp;</span><span class="ident" id="293813">rb</span><span class="op" id="293815">)</span><br>
<span class="lineno"></span><span class="op" id="293817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="293820">func</span>&nbsp;<span class="ident" id="293825">testReadAtLeast</span><span class="op" id="293840">(</span><span class="ident" id="293841">t</span>&nbsp;<span class="op" id="293843">*</span><span class="ident" id="293844">testing</span><span class="op" id="293851">.</span><span class="ident" id="293852">T</span><span class="op" id="293853">,</span>&nbsp;<span class="ident" id="293855">rb</span>&nbsp;<span class="ident" id="293858">ReadWriter</span><span class="op" id="293868">)</span>&nbsp;<span class="op" id="293870">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293873">rb</span><span class="op" id="293875">.</span><span class="ident" id="293876">Write</span><span class="op" id="293881">(</span><span class="op" id="293882">[</span><span class="op" id="293883">]</span><span class="builtintype" id="293884">byte</span><span class="op" id="293888">(</span><span class="string" id="293889">&#34;0123&#34;</span><span class="op" id="293895">)</span><span class="op" id="293896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293899">buf</span>&nbsp;<span class="op" id="293903">:=</span>&nbsp;<span class="builtinfunc" id="293906">make</span><span class="op" id="293910">(</span><span class="op" id="293911">[</span><span class="op" id="293912">]</span><span class="builtintype" id="293913">byte</span><span class="op" id="293917">,</span>&nbsp;<span class="num" id="293919">2</span><span class="op" id="293920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293923">n</span><span class="op" id="293924">,</span>&nbsp;<span class="ident" id="293926">err</span>&nbsp;<span class="op" id="293930">:=</span>&nbsp;<span class="ident" id="293933">ReadAtLeast</span><span class="op" id="293944">(</span><span class="ident" id="293945">rb</span><span class="op" id="293947">,</span>&nbsp;<span class="ident" id="293949">buf</span><span class="op" id="293952">,</span>&nbsp;<span class="num" id="293954">2</span><span class="op" id="293955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="293958">if</span>&nbsp;<span class="ident" id="293961">err</span>&nbsp;<span class="op" id="293965">!=</span>&nbsp;<span class="builtintype" id="293968">nil</span>&nbsp;<span class="op" id="293972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293976">t</span><span class="op" id="293977">.</span><span class="ident" id="293978">Error</span><span class="op" id="293983">(</span><span class="ident" id="293984">err</span><span class="op" id="293987">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="293990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="293993">n</span><span class="op" id="293994">,</span>&nbsp;<span class="ident" id="293996">err</span>&nbsp;<span class="op" id="294000">=</span>&nbsp;<span class="ident" id="294002">ReadAtLeast</span><span class="op" id="294013">(</span><span class="ident" id="294014">rb</span><span class="op" id="294016">,</span>&nbsp;<span class="ident" id="294018">buf</span><span class="op" id="294021">,</span>&nbsp;<span class="num" id="294023">4</span><span class="op" id="294024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294027">if</span>&nbsp;<span class="ident" id="294030">err</span>&nbsp;<span class="op" id="294034">!=</span>&nbsp;<span class="ident" id="294037">ErrShortBuffer</span>&nbsp;<span class="op" id="294052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294056">t</span><span class="op" id="294057">.</span><span class="ident" id="294058">Errorf</span><span class="op" id="294064">(</span><span class="string" id="294065">&#34;expected&nbsp;ErrShortBuffer&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294097">,</span>&nbsp;<span class="ident" id="294099">err</span><span class="op" id="294102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294105">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294108">if</span>&nbsp;<span class="ident" id="294111">n</span>&nbsp;<span class="op" id="294113">!=</span>&nbsp;<span class="num" id="294116">0</span>&nbsp;<span class="op" id="294118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294122">t</span><span class="op" id="294123">.</span><span class="ident" id="294124">Errorf</span><span class="op" id="294130">(</span><span class="string" id="294131">&#34;expected&nbsp;to&nbsp;have&nbsp;read&nbsp;0&nbsp;bytes,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294170">,</span>&nbsp;<span class="ident" id="294172">n</span><span class="op" id="294173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294179">n</span><span class="op" id="294180">,</span>&nbsp;<span class="ident" id="294182">err</span>&nbsp;<span class="op" id="294186">=</span>&nbsp;<span class="ident" id="294188">ReadAtLeast</span><span class="op" id="294199">(</span><span class="ident" id="294200">rb</span><span class="op" id="294202">,</span>&nbsp;<span class="ident" id="294204">buf</span><span class="op" id="294207">,</span>&nbsp;<span class="num" id="294209">1</span><span class="op" id="294210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294213">if</span>&nbsp;<span class="ident" id="294216">err</span>&nbsp;<span class="op" id="294220">!=</span>&nbsp;<span class="builtintype" id="294223">nil</span>&nbsp;<span class="op" id="294227">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294231">t</span><span class="op" id="294232">.</span><span class="ident" id="294233">Error</span><span class="op" id="294238">(</span><span class="ident" id="294239">err</span><span class="op" id="294242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294248">if</span>&nbsp;<span class="ident" id="294251">n</span>&nbsp;<span class="op" id="294253">!=</span>&nbsp;<span class="num" id="294256">2</span>&nbsp;<span class="op" id="294258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294262">t</span><span class="op" id="294263">.</span><span class="ident" id="294264">Errorf</span><span class="op" id="294270">(</span><span class="string" id="294271">&#34;expected&nbsp;to&nbsp;have&nbsp;read&nbsp;2&nbsp;bytes,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294310">,</span>&nbsp;<span class="ident" id="294312">n</span><span class="op" id="294313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294316">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294319">n</span><span class="op" id="294320">,</span>&nbsp;<span class="ident" id="294322">err</span>&nbsp;<span class="op" id="294326">=</span>&nbsp;<span class="ident" id="294328">ReadAtLeast</span><span class="op" id="294339">(</span><span class="ident" id="294340">rb</span><span class="op" id="294342">,</span>&nbsp;<span class="ident" id="294344">buf</span><span class="op" id="294347">,</span>&nbsp;<span class="num" id="294349">2</span><span class="op" id="294350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294353">if</span>&nbsp;<span class="ident" id="294356">err</span>&nbsp;<span class="op" id="294360">!=</span>&nbsp;<span class="ident" id="294363">EOF</span>&nbsp;<span class="op" id="294367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294371">t</span><span class="op" id="294372">.</span><span class="ident" id="294373">Errorf</span><span class="op" id="294379">(</span><span class="string" id="294380">&#34;expected&nbsp;EOF,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294402">,</span>&nbsp;<span class="ident" id="294404">err</span><span class="op" id="294407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294413">if</span>&nbsp;<span class="ident" id="294416">n</span>&nbsp;<span class="op" id="294418">!=</span>&nbsp;<span class="num" id="294421">0</span>&nbsp;<span class="op" id="294423">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294427">t</span><span class="op" id="294428">.</span><span class="ident" id="294429">Errorf</span><span class="op" id="294435">(</span><span class="string" id="294436">&#34;expected&nbsp;to&nbsp;have&nbsp;read&nbsp;0&nbsp;bytes,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294475">,</span>&nbsp;<span class="ident" id="294477">n</span><span class="op" id="294478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294484">rb</span><span class="op" id="294486">.</span><span class="ident" id="294487">Write</span><span class="op" id="294492">(</span><span class="op" id="294493">[</span><span class="op" id="294494">]</span><span class="builtintype" id="294495">byte</span><span class="op" id="294499">(</span><span class="string" id="294500">&#34;4&#34;</span><span class="op" id="294503">)</span><span class="op" id="294504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294507">n</span><span class="op" id="294508">,</span>&nbsp;<span class="ident" id="294510">err</span>&nbsp;<span class="op" id="294514">=</span>&nbsp;<span class="ident" id="294516">ReadAtLeast</span><span class="op" id="294527">(</span><span class="ident" id="294528">rb</span><span class="op" id="294530">,</span>&nbsp;<span class="ident" id="294532">buf</span><span class="op" id="294535">,</span>&nbsp;<span class="num" id="294537">2</span><span class="op" id="294538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294541">want</span>&nbsp;<span class="op" id="294546">:=</span>&nbsp;<span class="ident" id="294549">ErrUnexpectedEOF</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294567">if</span>&nbsp;<span class="ident" id="294570">rb</span><span class="op" id="294572">,</span>&nbsp;<span class="ident" id="294574">ok</span>&nbsp;<span class="op" id="294577">:=</span>&nbsp;<span class="ident" id="294580">rb</span><span class="op" id="294582">.</span><span class="op" id="294583">(</span><span class="op" id="294584">*</span><span class="ident" id="294585">dataAndErrorBuffer</span><span class="op" id="294603">)</span><span class="op" id="294604">;</span>&nbsp;<span class="ident" id="294606">ok</span>&nbsp;<span class="op" id="294609">&amp;&amp;</span>&nbsp;<span class="ident" id="294612">rb</span><span class="op" id="294614">.</span><span class="ident" id="294615">err</span>&nbsp;<span class="op" id="294619">!=</span>&nbsp;<span class="ident" id="294622">EOF</span>&nbsp;<span class="op" id="294626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294630">want</span>&nbsp;<span class="op" id="294635">=</span>&nbsp;<span class="ident" id="294637">rb</span><span class="op" id="294639">.</span><span class="ident" id="294640">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294648">if</span>&nbsp;<span class="ident" id="294651">err</span>&nbsp;<span class="op" id="294655">!=</span>&nbsp;<span class="ident" id="294658">want</span>&nbsp;<span class="op" id="294663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294667">t</span><span class="op" id="294668">.</span><span class="ident" id="294669">Errorf</span><span class="op" id="294675">(</span><span class="string" id="294676">&#34;expected&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294697">,</span>&nbsp;<span class="ident" id="294699">want</span><span class="op" id="294703">,</span>&nbsp;<span class="ident" id="294705">err</span><span class="op" id="294708">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294714">if</span>&nbsp;<span class="ident" id="294717">n</span>&nbsp;<span class="op" id="294719">!=</span>&nbsp;<span class="num" id="294722">1</span>&nbsp;<span class="op" id="294724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294728">t</span><span class="op" id="294729">.</span><span class="ident" id="294730">Errorf</span><span class="op" id="294736">(</span><span class="string" id="294737">&#34;expected&nbsp;to&nbsp;have&nbsp;read&nbsp;1&nbsp;bytes,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="294776">,</span>&nbsp;<span class="ident" id="294778">n</span><span class="op" id="294779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="294782">}</span><br>
<span class="lineno"></span><span class="op" id="294784">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="294787">func</span>&nbsp;<span class="ident" id="294792">TestTeeReader</span><span class="op" id="294805">(</span><span class="ident" id="294806">t</span>&nbsp;<span class="op" id="294808">*</span><span class="ident" id="294809">testing</span><span class="op" id="294816">.</span><span class="ident" id="294817">T</span><span class="op" id="294818">)</span>&nbsp;<span class="op" id="294820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294823">src</span>&nbsp;<span class="op" id="294827">:=</span>&nbsp;<span class="op" id="294830">[</span><span class="op" id="294831">]</span><span class="builtintype" id="294832">byte</span><span class="op" id="294836">(</span><span class="string" id="294837">&#34;hello,&nbsp;world&#34;</span><span class="op" id="294851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294854">dst</span>&nbsp;<span class="op" id="294858">:=</span>&nbsp;<span class="builtinfunc" id="294861">make</span><span class="op" id="294865">(</span><span class="op" id="294866">[</span><span class="op" id="294867">]</span><span class="builtintype" id="294868">byte</span><span class="op" id="294872">,</span>&nbsp;<span class="builtinfunc" id="294874">len</span><span class="op" id="294877">(</span><span class="ident" id="294878">src</span><span class="op" id="294881">)</span><span class="op" id="294882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294885">rb</span>&nbsp;<span class="op" id="294888">:=</span>&nbsp;<span class="ident" id="294891">bytes</span><span class="op" id="294896">.</span><span class="ident" id="294897">NewBuffer</span><span class="op" id="294906">(</span><span class="ident" id="294907">src</span><span class="op" id="294910">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294913">wb</span>&nbsp;<span class="op" id="294916">:=</span>&nbsp;<span class="builtinfunc" id="294919">new</span><span class="op" id="294922">(</span><span class="ident" id="294923">bytes</span><span class="op" id="294928">.</span><span class="ident" id="294929">Buffer</span><span class="op" id="294935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="294938">r</span>&nbsp;<span class="op" id="294940">:=</span>&nbsp;<span class="ident" id="294943">TeeReader</span><span class="op" id="294952">(</span><span class="ident" id="294953">rb</span><span class="op" id="294955">,</span>&nbsp;<span class="ident" id="294957">wb</span><span class="op" id="294959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="294962">if</span>&nbsp;<span class="ident" id="294965">n</span><span class="op" id="294966">,</span>&nbsp;<span class="ident" id="294968">err</span>&nbsp;<span class="op" id="294972">:=</span>&nbsp;<span class="ident" id="294975">ReadFull</span><span class="op" id="294983">(</span><span class="ident" id="294984">r</span><span class="op" id="294985">,</span>&nbsp;<span class="ident" id="294987">dst</span><span class="op" id="294990">)</span><span class="op" id="294991">;</span>&nbsp;<span class="ident" id="294993">err</span>&nbsp;<span class="op" id="294997">!=</span>&nbsp;<span class="builtintype" id="295000">nil</span>&nbsp;<span class="op" id="295004">||</span>&nbsp;<span class="ident" id="295007">n</span>&nbsp;<span class="op" id="295009">!=</span>&nbsp;<span class="builtinfunc" id="295012">len</span><span class="op" id="295015">(</span><span class="ident" id="295016">src</span><span class="op" id="295019">)</span>&nbsp;<span class="op" id="295021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295025">t</span><span class="op" id="295026">.</span><span class="ident" id="295027">Fatalf</span><span class="op" id="295033">(</span><span class="string" id="295034">&#34;ReadFull(r,&nbsp;dst)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="295075">,</span>&nbsp;<span class="ident" id="295077">n</span><span class="op" id="295078">,</span>&nbsp;<span class="ident" id="295080">err</span><span class="op" id="295083">,</span>&nbsp;<span class="builtinfunc" id="295085">len</span><span class="op" id="295088">(</span><span class="ident" id="295089">src</span><span class="op" id="295092">)</span><span class="op" id="295093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295096">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="295099">if</span>&nbsp;<span class="op" id="295102">!</span><span class="ident" id="295103">bytes</span><span class="op" id="295108">.</span><span class="ident" id="295109">Equal</span><span class="op" id="295114">(</span><span class="ident" id="295115">dst</span><span class="op" id="295118">,</span>&nbsp;<span class="ident" id="295120">src</span><span class="op" id="295123">)</span>&nbsp;<span class="op" id="295125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295129">t</span><span class="op" id="295130">.</span><span class="ident" id="295131">Errorf</span><span class="op" id="295137">(</span><span class="string" id="295138">&#34;bytes&nbsp;read&nbsp;=&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="295163">,</span>&nbsp;<span class="ident" id="295165">dst</span><span class="op" id="295168">,</span>&nbsp;<span class="ident" id="295170">src</span><span class="op" id="295173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="295179">if</span>&nbsp;<span class="op" id="295182">!</span><span class="ident" id="295183">bytes</span><span class="op" id="295188">.</span><span class="ident" id="295189">Equal</span><span class="op" id="295194">(</span><span class="ident" id="295195">wb</span><span class="op" id="295197">.</span><span class="ident" id="295198">Bytes</span><span class="op" id="295203">(</span><span class="op" id="295204">)</span><span class="op" id="295205">,</span>&nbsp;<span class="ident" id="295207">src</span><span class="op" id="295210">)</span>&nbsp;<span class="op" id="295212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295216">t</span><span class="op" id="295217">.</span><span class="ident" id="295218">Errorf</span><span class="op" id="295224">(</span><span class="string" id="295225">&#34;bytes&nbsp;written&nbsp;=&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="295253">,</span>&nbsp;<span class="ident" id="295255">wb</span><span class="op" id="295257">.</span><span class="ident" id="295258">Bytes</span><span class="op" id="295263">(</span><span class="op" id="295264">)</span><span class="op" id="295265">,</span>&nbsp;<span class="ident" id="295267">src</span><span class="op" id="295270">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="295276">if</span>&nbsp;<span class="ident" id="295279">n</span><span class="op" id="295280">,</span>&nbsp;<span class="ident" id="295282">err</span>&nbsp;<span class="op" id="295286">:=</span>&nbsp;<span class="ident" id="295289">r</span><span class="op" id="295290">.</span><span class="ident" id="295291">Read</span><span class="op" id="295295">(</span><span class="ident" id="295296">dst</span><span class="op" id="295299">)</span><span class="op" id="295300">;</span>&nbsp;<span class="ident" id="295302">n</span>&nbsp;<span class="op" id="295304">!=</span>&nbsp;<span class="num" id="295307">0</span>&nbsp;<span class="op" id="295309">||</span>&nbsp;<span class="ident" id="295312">err</span>&nbsp;<span class="op" id="295316">!=</span>&nbsp;<span class="ident" id="295319">EOF</span>&nbsp;<span class="op" id="295323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295327">t</span><span class="op" id="295328">.</span><span class="ident" id="295329">Errorf</span><span class="op" id="295335">(</span><span class="string" id="295336">&#34;r.Read&nbsp;at&nbsp;EOF&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;0,&nbsp;EOF&#34;</span><span class="op" id="295372">,</span>&nbsp;<span class="ident" id="295374">n</span><span class="op" id="295375">,</span>&nbsp;<span class="ident" id="295377">err</span><span class="op" id="295380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295386">rb</span>&nbsp;<span class="op" id="295389">=</span>&nbsp;<span class="ident" id="295391">bytes</span><span class="op" id="295396">.</span><span class="ident" id="295397">NewBuffer</span><span class="op" id="295406">(</span><span class="ident" id="295407">src</span><span class="op" id="295410">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295413">pr</span><span class="op" id="295415">,</span>&nbsp;<span class="ident" id="295417">pw</span>&nbsp;<span class="op" id="295420">:=</span>&nbsp;<span class="ident" id="295423">Pipe</span><span class="op" id="295427">(</span><span class="op" id="295428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295431">pr</span><span class="op" id="295433">.</span><span class="ident" id="295434">Close</span><span class="op" id="295439">(</span><span class="op" id="295440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295443">r</span>&nbsp;<span class="op" id="295445">=</span>&nbsp;<span class="ident" id="295447">TeeReader</span><span class="op" id="295456">(</span><span class="ident" id="295457">rb</span><span class="op" id="295459">,</span>&nbsp;<span class="ident" id="295461">pw</span><span class="op" id="295463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="295466">if</span>&nbsp;<span class="ident" id="295469">n</span><span class="op" id="295470">,</span>&nbsp;<span class="ident" id="295472">err</span>&nbsp;<span class="op" id="295476">:=</span>&nbsp;<span class="ident" id="295479">ReadFull</span><span class="op" id="295487">(</span><span class="ident" id="295488">r</span><span class="op" id="295489">,</span>&nbsp;<span class="ident" id="295491">dst</span><span class="op" id="295494">)</span><span class="op" id="295495">;</span>&nbsp;<span class="ident" id="295497">n</span>&nbsp;<span class="op" id="295499">!=</span>&nbsp;<span class="num" id="295502">0</span>&nbsp;<span class="op" id="295504">||</span>&nbsp;<span class="ident" id="295507">err</span>&nbsp;<span class="op" id="295511">!=</span>&nbsp;<span class="ident" id="295514">ErrClosedPipe</span>&nbsp;<span class="op" id="295528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295532">t</span><span class="op" id="295533">.</span><span class="ident" id="295534">Errorf</span><span class="op" id="295540">(</span><span class="string" id="295541">&#34;closed&nbsp;tee:&nbsp;ReadFull(r,&nbsp;dst)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;EPIPE&#34;</span><span class="op" id="295595">,</span>&nbsp;<span class="ident" id="295597">n</span><span class="op" id="295598">,</span>&nbsp;<span class="ident" id="295600">err</span><span class="op" id="295603">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295606">}</span><br>
<span class="lineno"></span><span class="op" id="295608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="295611">func</span>&nbsp;<span class="ident" id="295616">TestSectionReader_ReadAt</span><span class="op" id="295640">(</span><span class="ident" id="295641">t</span>&nbsp;<span class="op" id="295643">*</span><span class="ident" id="295644">testing</span><span class="op" id="295651">.</span><span class="ident" id="295652">T</span><span class="op" id="295653">)</span>&nbsp;<span class="op" id="295655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295658">dat</span>&nbsp;<span class="op" id="295662">:=</span>&nbsp;<span class="string" id="295665">&#34;a&nbsp;long&nbsp;sample&nbsp;data,&nbsp;1234567890&#34;</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295699">tests</span>&nbsp;<span class="op" id="295705">:=</span>&nbsp;<span class="op" id="295708">[</span><span class="op" id="295709">]</span><span class="keyword" id="295710">struct</span>&nbsp;<span class="op" id="295717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295721">data</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295728">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295737">off</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295744">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295750">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295757">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295763">bufLen</span>&nbsp;<span class="builtintype" id="295770">int</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295776">at</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295783">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295789">exp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295796">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="295805">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="295812">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295819">}</span><span class="op" id="295820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295824">{</span><span class="ident" id="295825">data</span><span class="op" id="295829">:</span>&nbsp;<span class="string" id="295831">&#34;&#34;</span><span class="op" id="295833">,</span>&nbsp;<span class="ident" id="295835">off</span><span class="op" id="295838">:</span>&nbsp;<span class="num" id="295840">0</span><span class="op" id="295841">,</span>&nbsp;<span class="ident" id="295843">n</span><span class="op" id="295844">:</span>&nbsp;<span class="num" id="295846">10</span><span class="op" id="295848">,</span>&nbsp;<span class="ident" id="295850">bufLen</span><span class="op" id="295856">:</span>&nbsp;<span class="num" id="295858">2</span><span class="op" id="295859">,</span>&nbsp;<span class="ident" id="295861">at</span><span class="op" id="295863">:</span>&nbsp;<span class="num" id="295865">0</span><span class="op" id="295866">,</span>&nbsp;<span class="ident" id="295868">exp</span><span class="op" id="295871">:</span>&nbsp;<span class="string" id="295873">&#34;&#34;</span><span class="op" id="295875">,</span>&nbsp;<span class="ident" id="295877">err</span><span class="op" id="295880">:</span>&nbsp;<span class="ident" id="295882">EOF</span><span class="op" id="295885">}</span><span class="op" id="295886">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295890">{</span><span class="ident" id="295891">data</span><span class="op" id="295895">:</span>&nbsp;<span class="ident" id="295897">dat</span><span class="op" id="295900">,</span>&nbsp;<span class="ident" id="295902">off</span><span class="op" id="295905">:</span>&nbsp;<span class="num" id="295907">0</span><span class="op" id="295908">,</span>&nbsp;<span class="ident" id="295910">n</span><span class="op" id="295911">:</span>&nbsp;<span class="builtinfunc" id="295913">len</span><span class="op" id="295916">(</span><span class="ident" id="295917">dat</span><span class="op" id="295920">)</span><span class="op" id="295921">,</span>&nbsp;<span class="ident" id="295923">bufLen</span><span class="op" id="295929">:</span>&nbsp;<span class="num" id="295931">0</span><span class="op" id="295932">,</span>&nbsp;<span class="ident" id="295934">at</span><span class="op" id="295936">:</span>&nbsp;<span class="num" id="295938">0</span><span class="op" id="295939">,</span>&nbsp;<span class="ident" id="295941">exp</span><span class="op" id="295944">:</span>&nbsp;<span class="string" id="295946">&#34;&#34;</span><span class="op" id="295948">,</span>&nbsp;<span class="ident" id="295950">err</span><span class="op" id="295953">:</span>&nbsp;<span class="builtintype" id="295955">nil</span><span class="op" id="295958">}</span><span class="op" id="295959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="295963">{</span><span class="ident" id="295964">data</span><span class="op" id="295968">:</span>&nbsp;<span class="ident" id="295970">dat</span><span class="op" id="295973">,</span>&nbsp;<span class="ident" id="295975">off</span><span class="op" id="295978">:</span>&nbsp;<span class="builtinfunc" id="295980">len</span><span class="op" id="295983">(</span><span class="ident" id="295984">dat</span><span class="op" id="295987">)</span><span class="op" id="295988">,</span>&nbsp;<span class="ident" id="295990">n</span><span class="op" id="295991">:</span>&nbsp;<span class="num" id="295993">1</span><span class="op" id="295994">,</span>&nbsp;<span class="ident" id="295996">bufLen</span><span class="op" id="296002">:</span>&nbsp;<span class="num" id="296004">1</span><span class="op" id="296005">,</span>&nbsp;<span class="ident" id="296007">at</span><span class="op" id="296009">:</span>&nbsp;<span class="num" id="296011">0</span><span class="op" id="296012">,</span>&nbsp;<span class="ident" id="296014">exp</span><span class="op" id="296017">:</span>&nbsp;<span class="string" id="296019">&#34;&#34;</span><span class="op" id="296021">,</span>&nbsp;<span class="ident" id="296023">err</span><span class="op" id="296026">:</span>&nbsp;<span class="ident" id="296028">EOF</span><span class="op" id="296031">}</span><span class="op" id="296032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296036">{</span><span class="ident" id="296037">data</span><span class="op" id="296041">:</span>&nbsp;<span class="ident" id="296043">dat</span><span class="op" id="296046">,</span>&nbsp;<span class="ident" id="296048">off</span><span class="op" id="296051">:</span>&nbsp;<span class="num" id="296053">0</span><span class="op" id="296054">,</span>&nbsp;<span class="ident" id="296056">n</span><span class="op" id="296057">:</span>&nbsp;<span class="builtinfunc" id="296059">len</span><span class="op" id="296062">(</span><span class="ident" id="296063">dat</span><span class="op" id="296066">)</span>&nbsp;<span class="op" id="296068">+</span>&nbsp;<span class="num" id="296070">2</span><span class="op" id="296071">,</span>&nbsp;<span class="ident" id="296073">bufLen</span><span class="op" id="296079">:</span>&nbsp;<span class="builtinfunc" id="296081">len</span><span class="op" id="296084">(</span><span class="ident" id="296085">dat</span><span class="op" id="296088">)</span><span class="op" id="296089">,</span>&nbsp;<span class="ident" id="296091">at</span><span class="op" id="296093">:</span>&nbsp;<span class="num" id="296095">0</span><span class="op" id="296096">,</span>&nbsp;<span class="ident" id="296098">exp</span><span class="op" id="296101">:</span>&nbsp;<span class="ident" id="296103">dat</span><span class="op" id="296106">,</span>&nbsp;<span class="ident" id="296108">err</span><span class="op" id="296111">:</span>&nbsp;<span class="builtintype" id="296113">nil</span><span class="op" id="296116">}</span><span class="op" id="296117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296121">{</span><span class="ident" id="296122">data</span><span class="op" id="296126">:</span>&nbsp;<span class="ident" id="296128">dat</span><span class="op" id="296131">,</span>&nbsp;<span class="ident" id="296133">off</span><span class="op" id="296136">:</span>&nbsp;<span class="num" id="296138">0</span><span class="op" id="296139">,</span>&nbsp;<span class="ident" id="296141">n</span><span class="op" id="296142">:</span>&nbsp;<span class="builtinfunc" id="296144">len</span><span class="op" id="296147">(</span><span class="ident" id="296148">dat</span><span class="op" id="296151">)</span><span class="op" id="296152">,</span>&nbsp;<span class="ident" id="296154">bufLen</span><span class="op" id="296160">:</span>&nbsp;<span class="builtinfunc" id="296162">len</span><span class="op" id="296165">(</span><span class="ident" id="296166">dat</span><span class="op" id="296169">)</span>&nbsp;<span class="op" id="296171">/</span>&nbsp;<span class="num" id="296173">2</span><span class="op" id="296174">,</span>&nbsp;<span class="ident" id="296176">at</span><span class="op" id="296178">:</span>&nbsp;<span class="num" id="296180">0</span><span class="op" id="296181">,</span>&nbsp;<span class="ident" id="296183">exp</span><span class="op" id="296186">:</span>&nbsp;<span class="ident" id="296188">dat</span><span class="op" id="296191">[</span><span class="op" id="296192">:</span><span class="builtinfunc" id="296193">len</span><span class="op" id="296196">(</span><span class="ident" id="296197">dat</span><span class="op" id="296200">)</span><span class="op" id="296201">/</span><span class="num" id="296202">2</span><span class="op" id="296203">]</span><span class="op" id="296204">,</span>&nbsp;<span class="ident" id="296206">err</span><span class="op" id="296209">:</span>&nbsp;<span class="builtintype" id="296211">nil</span><span class="op" id="296214">}</span><span class="op" id="296215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296219">{</span><span class="ident" id="296220">data</span><span class="op" id="296224">:</span>&nbsp;<span class="ident" id="296226">dat</span><span class="op" id="296229">,</span>&nbsp;<span class="ident" id="296231">off</span><span class="op" id="296234">:</span>&nbsp;<span class="num" id="296236">0</span><span class="op" id="296237">,</span>&nbsp;<span class="ident" id="296239">n</span><span class="op" id="296240">:</span>&nbsp;<span class="builtinfunc" id="296242">len</span><span class="op" id="296245">(</span><span class="ident" id="296246">dat</span><span class="op" id="296249">)</span><span class="op" id="296250">,</span>&nbsp;<span class="ident" id="296252">bufLen</span><span class="op" id="296258">:</span>&nbsp;<span class="builtinfunc" id="296260">len</span><span class="op" id="296263">(</span><span class="ident" id="296264">dat</span><span class="op" id="296267">)</span><span class="op" id="296268">,</span>&nbsp;<span class="ident" id="296270">at</span><span class="op" id="296272">:</span>&nbsp;<span class="num" id="296274">0</span><span class="op" id="296275">,</span>&nbsp;<span class="ident" id="296277">exp</span><span class="op" id="296280">:</span>&nbsp;<span class="ident" id="296282">dat</span><span class="op" id="296285">,</span>&nbsp;<span class="ident" id="296287">err</span><span class="op" id="296290">:</span>&nbsp;<span class="builtintype" id="296292">nil</span><span class="op" id="296295">}</span><span class="op" id="296296">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296300">{</span><span class="ident" id="296301">data</span><span class="op" id="296305">:</span>&nbsp;<span class="ident" id="296307">dat</span><span class="op" id="296310">,</span>&nbsp;<span class="ident" id="296312">off</span><span class="op" id="296315">:</span>&nbsp;<span class="num" id="296317">0</span><span class="op" id="296318">,</span>&nbsp;<span class="ident" id="296320">n</span><span class="op" id="296321">:</span>&nbsp;<span class="builtinfunc" id="296323">len</span><span class="op" id="296326">(</span><span class="ident" id="296327">dat</span><span class="op" id="296330">)</span><span class="op" id="296331">,</span>&nbsp;<span class="ident" id="296333">bufLen</span><span class="op" id="296339">:</span>&nbsp;<span class="builtinfunc" id="296341">len</span><span class="op" id="296344">(</span><span class="ident" id="296345">dat</span><span class="op" id="296348">)</span>&nbsp;<span class="op" id="296350">/</span>&nbsp;<span class="num" id="296352">2</span><span class="op" id="296353">,</span>&nbsp;<span class="ident" id="296355">at</span><span class="op" id="296357">:</span>&nbsp;<span class="num" id="296359">2</span><span class="op" id="296360">,</span>&nbsp;<span class="ident" id="296362">exp</span><span class="op" id="296365">:</span>&nbsp;<span class="ident" id="296367">dat</span><span class="op" id="296370">[</span><span class="num" id="296371">2</span>&nbsp;<span class="op" id="296373">:</span>&nbsp;<span class="num" id="296375">2</span><span class="op" id="296376">+</span><span class="builtinfunc" id="296377">len</span><span class="op" id="296380">(</span><span class="ident" id="296381">dat</span><span class="op" id="296384">)</span><span class="op" id="296385">/</span><span class="num" id="296386">2</span><span class="op" id="296387">]</span><span class="op" id="296388">,</span>&nbsp;<span class="ident" id="296390">err</span><span class="op" id="296393">:</span>&nbsp;<span class="builtintype" id="296395">nil</span><span class="op" id="296398">}</span><span class="op" id="296399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296403">{</span><span class="ident" id="296404">data</span><span class="op" id="296408">:</span>&nbsp;<span class="ident" id="296410">dat</span><span class="op" id="296413">,</span>&nbsp;<span class="ident" id="296415">off</span><span class="op" id="296418">:</span>&nbsp;<span class="num" id="296420">3</span><span class="op" id="296421">,</span>&nbsp;<span class="ident" id="296423">n</span><span class="op" id="296424">:</span>&nbsp;<span class="builtinfunc" id="296426">len</span><span class="op" id="296429">(</span><span class="ident" id="296430">dat</span><span class="op" id="296433">)</span><span class="op" id="296434">,</span>&nbsp;<span class="ident" id="296436">bufLen</span><span class="op" id="296442">:</span>&nbsp;<span class="builtinfunc" id="296444">len</span><span class="op" id="296447">(</span><span class="ident" id="296448">dat</span><span class="op" id="296451">)</span>&nbsp;<span class="op" id="296453">/</span>&nbsp;<span class="num" id="296455">2</span><span class="op" id="296456">,</span>&nbsp;<span class="ident" id="296458">at</span><span class="op" id="296460">:</span>&nbsp;<span class="num" id="296462">2</span><span class="op" id="296463">,</span>&nbsp;<span class="ident" id="296465">exp</span><span class="op" id="296468">:</span>&nbsp;<span class="ident" id="296470">dat</span><span class="op" id="296473">[</span><span class="num" id="296474">5</span>&nbsp;<span class="op" id="296476">:</span>&nbsp;<span class="num" id="296478">5</span><span class="op" id="296479">+</span><span class="builtinfunc" id="296480">len</span><span class="op" id="296483">(</span><span class="ident" id="296484">dat</span><span class="op" id="296487">)</span><span class="op" id="296488">/</span><span class="num" id="296489">2</span><span class="op" id="296490">]</span><span class="op" id="296491">,</span>&nbsp;<span class="ident" id="296493">err</span><span class="op" id="296496">:</span>&nbsp;<span class="builtintype" id="296498">nil</span><span class="op" id="296501">}</span><span class="op" id="296502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296506">{</span><span class="ident" id="296507">data</span><span class="op" id="296511">:</span>&nbsp;<span class="ident" id="296513">dat</span><span class="op" id="296516">,</span>&nbsp;<span class="ident" id="296518">off</span><span class="op" id="296521">:</span>&nbsp;<span class="num" id="296523">3</span><span class="op" id="296524">,</span>&nbsp;<span class="ident" id="296526">n</span><span class="op" id="296527">:</span>&nbsp;<span class="builtinfunc" id="296529">len</span><span class="op" id="296532">(</span><span class="ident" id="296533">dat</span><span class="op" id="296536">)</span>&nbsp;<span class="op" id="296538">/</span>&nbsp;<span class="num" id="296540">2</span><span class="op" id="296541">,</span>&nbsp;<span class="ident" id="296543">bufLen</span><span class="op" id="296549">:</span>&nbsp;<span class="builtinfunc" id="296551">len</span><span class="op" id="296554">(</span><span class="ident" id="296555">dat</span><span class="op" id="296558">)</span><span class="op" id="296559">/</span><span class="num" id="296560">2</span>&nbsp;<span class="op" id="296562">-</span>&nbsp;<span class="num" id="296564">2</span><span class="op" id="296565">,</span>&nbsp;<span class="ident" id="296567">at</span><span class="op" id="296569">:</span>&nbsp;<span class="num" id="296571">2</span><span class="op" id="296572">,</span>&nbsp;<span class="ident" id="296574">exp</span><span class="op" id="296577">:</span>&nbsp;<span class="ident" id="296579">dat</span><span class="op" id="296582">[</span><span class="num" id="296583">5</span>&nbsp;<span class="op" id="296585">:</span>&nbsp;<span class="num" id="296587">5</span><span class="op" id="296588">+</span><span class="builtinfunc" id="296589">len</span><span class="op" id="296592">(</span><span class="ident" id="296593">dat</span><span class="op" id="296596">)</span><span class="op" id="296597">/</span><span class="num" id="296598">2</span><span class="op" id="296599">-</span><span class="num" id="296600">2</span><span class="op" id="296601">]</span><span class="op" id="296602">,</span>&nbsp;<span class="ident" id="296604">err</span><span class="op" id="296607">:</span>&nbsp;<span class="builtintype" id="296609">nil</span><span class="op" id="296612">}</span><span class="op" id="296613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296617">{</span><span class="ident" id="296618">data</span><span class="op" id="296622">:</span>&nbsp;<span class="ident" id="296624">dat</span><span class="op" id="296627">,</span>&nbsp;<span class="ident" id="296629">off</span><span class="op" id="296632">:</span>&nbsp;<span class="num" id="296634">3</span><span class="op" id="296635">,</span>&nbsp;<span class="ident" id="296637">n</span><span class="op" id="296638">:</span>&nbsp;<span class="builtinfunc" id="296640">len</span><span class="op" id="296643">(</span><span class="ident" id="296644">dat</span><span class="op" id="296647">)</span>&nbsp;<span class="op" id="296649">/</span>&nbsp;<span class="num" id="296651">2</span><span class="op" id="296652">,</span>&nbsp;<span class="ident" id="296654">bufLen</span><span class="op" id="296660">:</span>&nbsp;<span class="builtinfunc" id="296662">len</span><span class="op" id="296665">(</span><span class="ident" id="296666">dat</span><span class="op" id="296669">)</span><span class="op" id="296670">/</span><span class="num" id="296671">2</span>&nbsp;<span class="op" id="296673">+</span>&nbsp;<span class="num" id="296675">2</span><span class="op" id="296676">,</span>&nbsp;<span class="ident" id="296678">at</span><span class="op" id="296680">:</span>&nbsp;<span class="num" id="296682">2</span><span class="op" id="296683">,</span>&nbsp;<span class="ident" id="296685">exp</span><span class="op" id="296688">:</span>&nbsp;<span class="ident" id="296690">dat</span><span class="op" id="296693">[</span><span class="num" id="296694">5</span>&nbsp;<span class="op" id="296696">:</span>&nbsp;<span class="num" id="296698">5</span><span class="op" id="296699">+</span><span class="builtinfunc" id="296700">len</span><span class="op" id="296703">(</span><span class="ident" id="296704">dat</span><span class="op" id="296707">)</span><span class="op" id="296708">/</span><span class="num" id="296709">2</span><span class="op" id="296710">-</span><span class="num" id="296711">2</span><span class="op" id="296712">]</span><span class="op" id="296713">,</span>&nbsp;<span class="ident" id="296715">err</span><span class="op" id="296718">:</span>&nbsp;<span class="ident" id="296720">EOF</span><span class="op" id="296723">}</span><span class="op" id="296724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296728">{</span><span class="ident" id="296729">data</span><span class="op" id="296733">:</span>&nbsp;<span class="ident" id="296735">dat</span><span class="op" id="296738">,</span>&nbsp;<span class="ident" id="296740">off</span><span class="op" id="296743">:</span>&nbsp;<span class="num" id="296745">0</span><span class="op" id="296746">,</span>&nbsp;<span class="ident" id="296748">n</span><span class="op" id="296749">:</span>&nbsp;<span class="num" id="296751">0</span><span class="op" id="296752">,</span>&nbsp;<span class="ident" id="296754">bufLen</span><span class="op" id="296760">:</span>&nbsp;<span class="num" id="296762">0</span><span class="op" id="296763">,</span>&nbsp;<span class="ident" id="296765">at</span><span class="op" id="296767">:</span>&nbsp;<span class="op" id="296769">-</span><span class="num" id="296770">1</span><span class="op" id="296771">,</span>&nbsp;<span class="ident" id="296773">exp</span><span class="op" id="296776">:</span>&nbsp;<span class="string" id="296778">&#34;&#34;</span><span class="op" id="296780">,</span>&nbsp;<span class="ident" id="296782">err</span><span class="op" id="296785">:</span>&nbsp;<span class="ident" id="296787">EOF</span><span class="op" id="296790">}</span><span class="op" id="296791">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296795">{</span><span class="ident" id="296796">data</span><span class="op" id="296800">:</span>&nbsp;<span class="ident" id="296802">dat</span><span class="op" id="296805">,</span>&nbsp;<span class="ident" id="296807">off</span><span class="op" id="296810">:</span>&nbsp;<span class="num" id="296812">0</span><span class="op" id="296813">,</span>&nbsp;<span class="ident" id="296815">n</span><span class="op" id="296816">:</span>&nbsp;<span class="num" id="296818">0</span><span class="op" id="296819">,</span>&nbsp;<span class="ident" id="296821">bufLen</span><span class="op" id="296827">:</span>&nbsp;<span class="num" id="296829">0</span><span class="op" id="296830">,</span>&nbsp;<span class="ident" id="296832">at</span><span class="op" id="296834">:</span>&nbsp;<span class="num" id="296836">1</span><span class="op" id="296837">,</span>&nbsp;<span class="ident" id="296839">exp</span><span class="op" id="296842">:</span>&nbsp;<span class="string" id="296844">&#34;&#34;</span><span class="op" id="296846">,</span>&nbsp;<span class="ident" id="296848">err</span><span class="op" id="296851">:</span>&nbsp;<span class="ident" id="296853">EOF</span><span class="op" id="296856">}</span><span class="op" id="296857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="296860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="296863">for</span>&nbsp;<span class="ident" id="296867">i</span><span class="op" id="296868">,</span>&nbsp;<span class="ident" id="296870">tt</span>&nbsp;<span class="op" id="296873">:=</span>&nbsp;<span class="keyword" id="296876">range</span>&nbsp;<span class="ident" id="296882">tests</span>&nbsp;<span class="op" id="296888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="296892">r</span>&nbsp;<span class="op" id="296894">:=</span>&nbsp;<span class="ident" id="296897">strings</span><span class="op" id="296904">.</span><span class="ident" id="296905">NewReader</span><span class="op" id="296914">(</span><span class="ident" id="296915">tt</span><span class="op" id="296917">.</span><span class="ident" id="296918">data</span><span class="op" id="296922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="296926">s</span>&nbsp;<span class="op" id="296928">:=</span>&nbsp;<span class="ident" id="296931">NewSectionReader</span><span class="op" id="296947">(</span><span class="ident" id="296948">r</span><span class="op" id="296949">,</span>&nbsp;<span class="ident" id="296951">int64</span><span class="op" id="296956">(</span><span class="ident" id="296957">tt</span><span class="op" id="296959">.</span><span class="ident" id="296960">off</span><span class="op" id="296963">)</span><span class="op" id="296964">,</span>&nbsp;<span class="ident" id="296966">int64</span><span class="op" id="296971">(</span><span class="ident" id="296972">tt</span><span class="op" id="296974">.</span><span class="ident" id="296975">n</span><span class="op" id="296976">)</span><span class="op" id="296977">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="296981">buf</span>&nbsp;<span class="op" id="296985">:=</span>&nbsp;<span class="builtinfunc" id="296988">make</span><span class="op" id="296992">(</span><span class="op" id="296993">[</span><span class="op" id="296994">]</span><span class="builtintype" id="296995">byte</span><span class="op" id="296999">,</span>&nbsp;<span class="ident" id="297001">tt</span><span class="op" id="297003">.</span><span class="ident" id="297004">bufLen</span><span class="op" id="297010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="297014">if</span>&nbsp;<span class="ident" id="297017">n</span><span class="op" id="297018">,</span>&nbsp;<span class="ident" id="297020">err</span>&nbsp;<span class="op" id="297024">:=</span>&nbsp;<span class="ident" id="297027">s</span><span class="op" id="297028">.</span><span class="ident" id="297029">ReadAt</span><span class="op" id="297035">(</span><span class="ident" id="297036">buf</span><span class="op" id="297039">,</span>&nbsp;<span class="ident" id="297041">int64</span><span class="op" id="297046">(</span><span class="ident" id="297047">tt</span><span class="op" id="297049">.</span><span class="ident" id="297050">at</span><span class="op" id="297052">)</span><span class="op" id="297053">)</span><span class="op" id="297054">;</span>&nbsp;<span class="ident" id="297056">n</span>&nbsp;<span class="op" id="297058">!=</span>&nbsp;<span class="builtinfunc" id="297061">len</span><span class="op" id="297064">(</span><span class="ident" id="297065">tt</span><span class="op" id="297067">.</span><span class="ident" id="297068">exp</span><span class="op" id="297071">)</span>&nbsp;<span class="op" id="297073">||</span>&nbsp;<span class="builtintype" id="297076">string</span><span class="op" id="297082">(</span><span class="ident" id="297083">buf</span><span class="op" id="297086">[</span><span class="op" id="297087">:</span><span class="ident" id="297088">n</span><span class="op" id="297089">]</span><span class="op" id="297090">)</span>&nbsp;<span class="op" id="297092">!=</span>&nbsp;<span class="ident" id="297095">tt</span><span class="op" id="297097">.</span><span class="ident" id="297098">exp</span>&nbsp;<span class="op" id="297102">||</span>&nbsp;<span class="ident" id="297105">err</span>&nbsp;<span class="op" id="297109">!=</span>&nbsp;<span class="ident" id="297112">tt</span><span class="op" id="297114">.</span><span class="ident" id="297115">err</span>&nbsp;<span class="op" id="297119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297124">t</span><span class="op" id="297125">.</span><span class="ident" id="297126">Fatalf</span><span class="op" id="297132">(</span><span class="string" id="297133">&#34;%d:&nbsp;ReadAt(%d)&nbsp;=&nbsp;%q,&nbsp;%v;&nbsp;expected&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="297175">,</span>&nbsp;<span class="ident" id="297177">i</span><span class="op" id="297178">,</span>&nbsp;<span class="ident" id="297180">tt</span><span class="op" id="297182">.</span><span class="ident" id="297183">at</span><span class="op" id="297185">,</span>&nbsp;<span class="ident" id="297187">buf</span><span class="op" id="297190">[</span><span class="op" id="297191">:</span><span class="ident" id="297192">n</span><span class="op" id="297193">]</span><span class="op" id="297194">,</span>&nbsp;<span class="ident" id="297196">err</span><span class="op" id="297199">,</span>&nbsp;<span class="ident" id="297201">tt</span><span class="op" id="297203">.</span><span class="ident" id="297204">exp</span><span class="op" id="297207">,</span>&nbsp;<span class="ident" id="297209">tt</span><span class="op" id="297211">.</span><span class="ident" id="297212">err</span><span class="op" id="297215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="297219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="297222">}</span><br>
<span class="lineno">295</span><span class="op" id="297224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="297227">func</span>&nbsp;<span class="ident" id="297232">TestSectionReader_Seek</span><span class="op" id="297254">(</span><span class="ident" id="297255">t</span>&nbsp;<span class="op" id="297257">*</span><span class="ident" id="297258">testing</span><span class="op" id="297265">.</span><span class="ident" id="297266">T</span><span class="op" id="297267">)</span>&nbsp;<span class="op" id="297269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="297272">//&nbsp;Verifies&nbsp;that&nbsp;NewSectionReader&#39;s&nbsp;Seeker&nbsp;behaves&nbsp;like&nbsp;bytes.NewReader&nbsp;(which&nbsp;is&nbsp;like&nbsp;strings.NewReader)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297379">br</span>&nbsp;<span class="op" id="297382">:=</span>&nbsp;<span class="ident" id="297385">bytes</span><span class="op" id="297390">.</span><span class="ident" id="297391">NewReader</span><span class="op" id="297400">(</span><span class="op" id="297401">[</span><span class="op" id="297402">]</span><span class="builtintype" id="297403">byte</span><span class="op" id="297407">(</span><span class="string" id="297408">&#34;foo&#34;</span><span class="op" id="297413">)</span><span class="op" id="297414">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297417">sr</span>&nbsp;<span class="op" id="297420">:=</span>&nbsp;<span class="ident" id="297423">NewSectionReader</span><span class="op" id="297439">(</span><span class="ident" id="297440">br</span><span class="op" id="297442">,</span>&nbsp;<span class="num" id="297444">0</span><span class="op" id="297445">,</span>&nbsp;<span class="ident" id="297447">int64</span><span class="op" id="297452">(</span><span class="builtinfunc" id="297453">len</span><span class="op" id="297456">(</span><span class="string" id="297457">&#34;foo&#34;</span><span class="op" id="297462">)</span><span class="op" id="297463">)</span><span class="op" id="297464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="297468">for</span>&nbsp;<span class="ident" id="297472">whence</span>&nbsp;<span class="op" id="297479">:=</span>&nbsp;<span class="num" id="297482">0</span><span class="op" id="297483">;</span>&nbsp;<span class="ident" id="297485">whence</span>&nbsp;<span class="op" id="297492">&lt;=</span>&nbsp;<span class="num" id="297495">2</span><span class="op" id="297496">;</span>&nbsp;<span class="ident" id="297498">whence</span><span class="op" id="297504">++</span>&nbsp;<span class="op" id="297507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="297511">for</span>&nbsp;<span class="ident" id="297515">offset</span>&nbsp;<span class="op" id="297522">:=</span>&nbsp;<span class="ident" id="297525">int64</span><span class="op" id="297530">(</span><span class="op" id="297531">-</span><span class="num" id="297532">3</span><span class="op" id="297533">)</span><span class="op" id="297534">;</span>&nbsp;<span class="ident" id="297536">offset</span>&nbsp;<span class="op" id="297543">&lt;=</span>&nbsp;<span class="num" id="297546">4</span><span class="op" id="297547">;</span>&nbsp;<span class="ident" id="297549">offset</span><span class="op" id="297555">++</span>&nbsp;<span class="op" id="297558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297563">brOff</span><span class="op" id="297568">,</span>&nbsp;<span class="ident" id="297570">brErr</span>&nbsp;<span class="op" id="297576">:=</span>&nbsp;<span class="ident" id="297579">br</span><span class="op" id="297581">.</span><span class="ident" id="297582">Seek</span><span class="op" id="297586">(</span><span class="ident" id="297587">offset</span><span class="op" id="297593">,</span>&nbsp;<span class="ident" id="297595">whence</span><span class="op" id="297601">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297606">srOff</span><span class="op" id="297611">,</span>&nbsp;<span class="ident" id="297613">srErr</span>&nbsp;<span class="op" id="297619">:=</span>&nbsp;<span class="ident" id="297622">sr</span><span class="op" id="297624">.</span><span class="ident" id="297625">Seek</span><span class="op" id="297629">(</span><span class="ident" id="297630">offset</span><span class="op" id="297636">,</span>&nbsp;<span class="ident" id="297638">whence</span><span class="op" id="297644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="297649">if</span>&nbsp;<span class="op" id="297652">(</span><span class="ident" id="297653">brErr</span>&nbsp;<span class="op" id="297659">!=</span>&nbsp;<span class="builtintype" id="297662">nil</span><span class="op" id="297665">)</span>&nbsp;<span class="op" id="297667">!=</span>&nbsp;<span class="op" id="297670">(</span><span class="ident" id="297671">srErr</span>&nbsp;<span class="op" id="297677">!=</span>&nbsp;<span class="builtintype" id="297680">nil</span><span class="op" id="297683">)</span>&nbsp;<span class="op" id="297685">||</span>&nbsp;<span class="ident" id="297688">brOff</span>&nbsp;<span class="op" id="297694">!=</span>&nbsp;<span class="ident" id="297697">srOff</span>&nbsp;<span class="op" id="297703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297709">t</span><span class="op" id="297710">.</span><span class="ident" id="297711">Errorf</span><span class="op" id="297717">(</span><span class="string" id="297718">&#34;For&nbsp;whence&nbsp;%d,&nbsp;offset&nbsp;%d:&nbsp;bytes.Reader.Seek&nbsp;=&nbsp;(%v,&nbsp;%v)&nbsp;!=&nbsp;SectionReader.Seek&nbsp;=&nbsp;(%v,&nbsp;%v)&#34;</span><span class="op" id="297807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297814">whence</span><span class="op" id="297820">,</span>&nbsp;<span class="ident" id="297822">offset</span><span class="op" id="297828">,</span>&nbsp;<span class="ident" id="297830">brOff</span><span class="op" id="297835">,</span>&nbsp;<span class="ident" id="297837">brErr</span><span class="op" id="297842">,</span>&nbsp;<span class="ident" id="297844">srErr</span><span class="op" id="297849">,</span>&nbsp;<span class="ident" id="297851">srOff</span><span class="op" id="297856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="297861">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="297865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="297868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="297872">//&nbsp;And&nbsp;verify&nbsp;we&nbsp;can&nbsp;just&nbsp;seek&nbsp;past&nbsp;the&nbsp;end&nbsp;and&nbsp;get&nbsp;an&nbsp;EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297932">got</span><span class="op" id="297935">,</span>&nbsp;<span class="ident" id="297937">err</span>&nbsp;<span class="op" id="297941">:=</span>&nbsp;<span class="ident" id="297944">sr</span><span class="op" id="297946">.</span><span class="ident" id="297947">Seek</span><span class="op" id="297951">(</span><span class="num" id="297952">100</span><span class="op" id="297955">,</span>&nbsp;<span class="num" id="297957">0</span><span class="op" id="297958">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="297961">if</span>&nbsp;<span class="ident" id="297964">err</span>&nbsp;<span class="op" id="297968">!=</span>&nbsp;<span class="builtintype" id="297971">nil</span>&nbsp;<span class="op" id="297975">||</span>&nbsp;<span class="ident" id="297978">got</span>&nbsp;<span class="op" id="297982">!=</span>&nbsp;<span class="num" id="297985">100</span>&nbsp;<span class="op" id="297989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="297993">t</span><span class="op" id="297994">.</span><span class="ident" id="297995">Errorf</span><span class="op" id="298001">(</span><span class="string" id="298002">&#34;Seek&nbsp;=&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;100,&nbsp;nil&#34;</span><span class="op" id="298032">,</span>&nbsp;<span class="ident" id="298034">got</span><span class="op" id="298037">,</span>&nbsp;<span class="ident" id="298039">err</span><span class="op" id="298042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298049">n</span><span class="op" id="298050">,</span>&nbsp;<span class="ident" id="298052">err</span>&nbsp;<span class="op" id="298056">:=</span>&nbsp;<span class="ident" id="298059">sr</span><span class="op" id="298061">.</span><span class="ident" id="298062">Read</span><span class="op" id="298066">(</span><span class="builtinfunc" id="298067">make</span><span class="op" id="298071">(</span><span class="op" id="298072">[</span><span class="op" id="298073">]</span><span class="builtintype" id="298074">byte</span><span class="op" id="298078">,</span>&nbsp;<span class="num" id="298080">10</span><span class="op" id="298082">)</span><span class="op" id="298083">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="298086">if</span>&nbsp;<span class="ident" id="298089">n</span>&nbsp;<span class="op" id="298091">!=</span>&nbsp;<span class="num" id="298094">0</span>&nbsp;<span class="op" id="298096">||</span>&nbsp;<span class="ident" id="298099">err</span>&nbsp;<span class="op" id="298103">!=</span>&nbsp;<span class="ident" id="298106">EOF</span>&nbsp;<span class="op" id="298110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298114">t</span><span class="op" id="298115">.</span><span class="ident" id="298116">Errorf</span><span class="op" id="298122">(</span><span class="string" id="298123">&#34;Read&nbsp;=&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;EOF&#34;</span><span class="op" id="298151">,</span>&nbsp;<span class="ident" id="298153">n</span><span class="op" id="298154">,</span>&nbsp;<span class="ident" id="298156">err</span><span class="op" id="298159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298162">}</span><br>
<span class="lineno"></span><span class="op" id="298164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="298167">func</span>&nbsp;<span class="ident" id="298172">TestSectionReader_Size</span><span class="op" id="298194">(</span><span class="ident" id="298195">t</span>&nbsp;<span class="op" id="298197">*</span><span class="ident" id="298198">testing</span><span class="op" id="298205">.</span><span class="ident" id="298206">T</span><span class="op" id="298207">)</span>&nbsp;<span class="op" id="298209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298212">tests</span>&nbsp;<span class="op" id="298218">:=</span>&nbsp;<span class="op" id="298221">[</span><span class="op" id="298222">]</span><span class="keyword" id="298223">struct</span>&nbsp;<span class="op" id="298230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298234">data</span>&nbsp;<span class="builtintype" id="298239">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298248">want</span>&nbsp;<span class="ident" id="298253">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298260">}</span><span class="op" id="298261">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298265">{</span><span class="string" id="298266">&#34;a&nbsp;long&nbsp;sample&nbsp;data,&nbsp;1234567890&#34;</span><span class="op" id="298298">,</span>&nbsp;<span class="num" id="298300">30</span><span class="op" id="298302">}</span><span class="op" id="298303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298307">{</span><span class="string" id="298308">&#34;&#34;</span><span class="op" id="298310">,</span>&nbsp;<span class="num" id="298312">0</span><span class="op" id="298313">}</span><span class="op" id="298314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="298321">for</span>&nbsp;<span class="ident" id="298325">_</span><span class="op" id="298326">,</span>&nbsp;<span class="ident" id="298328">tt</span>&nbsp;<span class="op" id="298331">:=</span>&nbsp;<span class="keyword" id="298334">range</span>&nbsp;<span class="ident" id="298340">tests</span>&nbsp;<span class="op" id="298346">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298350">r</span>&nbsp;<span class="op" id="298352">:=</span>&nbsp;<span class="ident" id="298355">strings</span><span class="op" id="298362">.</span><span class="ident" id="298363">NewReader</span><span class="op" id="298372">(</span><span class="ident" id="298373">tt</span><span class="op" id="298375">.</span><span class="ident" id="298376">data</span><span class="op" id="298380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298384">sr</span>&nbsp;<span class="op" id="298387">:=</span>&nbsp;<span class="ident" id="298390">NewSectionReader</span><span class="op" id="298406">(</span><span class="ident" id="298407">r</span><span class="op" id="298408">,</span>&nbsp;<span class="num" id="298410">0</span><span class="op" id="298411">,</span>&nbsp;<span class="ident" id="298413">int64</span><span class="op" id="298418">(</span><span class="builtinfunc" id="298419">len</span><span class="op" id="298422">(</span><span class="ident" id="298423">tt</span><span class="op" id="298425">.</span><span class="ident" id="298426">data</span><span class="op" id="298430">)</span><span class="op" id="298431">)</span><span class="op" id="298432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="298436">if</span>&nbsp;<span class="ident" id="298439">got</span>&nbsp;<span class="op" id="298443">:=</span>&nbsp;<span class="ident" id="298446">sr</span><span class="op" id="298448">.</span><span class="ident" id="298449">Size</span><span class="op" id="298453">(</span><span class="op" id="298454">)</span><span class="op" id="298455">;</span>&nbsp;<span class="ident" id="298457">got</span>&nbsp;<span class="op" id="298461">!=</span>&nbsp;<span class="ident" id="298464">tt</span><span class="op" id="298466">.</span><span class="ident" id="298467">want</span>&nbsp;<span class="op" id="298472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="298477">t</span><span class="op" id="298478">.</span><span class="ident" id="298479">Errorf</span><span class="op" id="298485">(</span><span class="string" id="298486">&#34;Size&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="298506">,</span>&nbsp;<span class="ident" id="298508">got</span><span class="op" id="298511">,</span>&nbsp;<span class="ident" id="298513">tt</span><span class="op" id="298515">.</span><span class="ident" id="298516">want</span><span class="op" id="298520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298524">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="298527">}</span><br>
<span class="lineno"></span><span class="op" id="298529">}</span>
</div>
</body>
</html>
