<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3653870">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3653925">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3653979">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3654030">package</span>&nbsp;<span class="ident" id="3654038">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3654045">type</span>&nbsp;<span class="ident" id="3654050">serializedFile</span>&nbsp;<span class="keyword" id="3654065">struct</span>&nbsp;<span class="op" id="3654072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3654075">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654147">Name</span>&nbsp;&nbsp;<span class="builtintype" id="3654153">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654161">Base</span>&nbsp;&nbsp;<span class="builtintype" id="3654167">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654172">Size</span>&nbsp;&nbsp;<span class="builtintype" id="3654178">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654183">Lines</span>&nbsp;<span class="op" id="3654189">[</span><span class="op" id="3654190">]</span><span class="builtintype" id="3654191">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654196">Infos</span>&nbsp;<span class="op" id="3654202">[</span><span class="op" id="3654203">]</span><span class="ident" id="3654204">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="3654213">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3654216">type</span>&nbsp;<span class="ident" id="3654221">serializedFileSet</span>&nbsp;<span class="keyword" id="3654239">struct</span>&nbsp;<span class="op" id="3654246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654249">Base</span>&nbsp;&nbsp;<span class="builtintype" id="3654255">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654260">Files</span>&nbsp;<span class="op" id="3654266">[</span><span class="op" id="3654267">]</span><span class="ident" id="3654268">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="3654283">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3654286">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3654360">func</span>&nbsp;<span class="op" id="3654365">(</span><span class="ident" id="3654366">s</span>&nbsp;<span class="op" id="3654368">*</span><span class="ident" id="3654369">FileSet</span><span class="op" id="3654376">)</span>&nbsp;<span class="ident" id="3654378">Read</span><span class="op" id="3654382">(</span><span class="ident" id="3654383">decode</span>&nbsp;<span class="keyword" id="3654390">func</span><span class="op" id="3654394">(</span><span class="keyword" id="3654395">interface</span><span class="op" id="3654404">{</span><span class="op" id="3654405">}</span><span class="op" id="3654406">)</span>&nbsp;<span class="builtintype" id="3654408">error</span><span class="op" id="3654413">)</span>&nbsp;<span class="builtintype" id="3654415">error</span>&nbsp;<span class="op" id="3654421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654424">var</span>&nbsp;<span class="ident" id="3654428">ss</span>&nbsp;<span class="ident" id="3654431">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654450">if</span>&nbsp;<span class="ident" id="3654453">err</span>&nbsp;<span class="op" id="3654457">:=</span>&nbsp;<span class="ident" id="3654460">decode</span><span class="op" id="3654466">(</span><span class="op" id="3654467">&amp;</span><span class="ident" id="3654468">ss</span><span class="op" id="3654470">)</span><span class="op" id="3654471">;</span>&nbsp;<span class="ident" id="3654473">err</span>&nbsp;<span class="op" id="3654477">!=</span>&nbsp;<span class="ident" id="3654480">nil</span>&nbsp;<span class="op" id="3654484">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654488">return</span>&nbsp;<span class="ident" id="3654495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3654500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654504">s</span><span class="op" id="3654505">.</span><span class="ident" id="3654506">mutex</span><span class="op" id="3654511">.</span><span class="ident" id="3654512">Lock</span><span class="op" id="3654516">(</span><span class="op" id="3654517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654520">s</span><span class="op" id="3654521">.</span><span class="ident" id="3654522">base</span>&nbsp;<span class="op" id="3654527">=</span>&nbsp;<span class="ident" id="3654529">ss</span><span class="op" id="3654531">.</span><span class="ident" id="3654532">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654538">files</span>&nbsp;<span class="op" id="3654544">:=</span>&nbsp;<span class="builtinfunc" id="3654547">make</span><span class="op" id="3654551">(</span><span class="op" id="3654552">[</span><span class="op" id="3654553">]</span><span class="op" id="3654554">*</span><span class="ident" id="3654555">File</span><span class="op" id="3654559">,</span>&nbsp;<span class="builtinfunc" id="3654561">len</span><span class="op" id="3654564">(</span><span class="ident" id="3654565">ss</span><span class="op" id="3654567">.</span><span class="ident" id="3654568">Files</span><span class="op" id="3654573">)</span><span class="op" id="3654574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654577">for</span>&nbsp;<span class="ident" id="3654581">i</span>&nbsp;<span class="op" id="3654583">:=</span>&nbsp;<span class="num" id="3654586">0</span><span class="op" id="3654587">;</span>&nbsp;<span class="ident" id="3654589">i</span>&nbsp;<span class="op" id="3654591">&lt;</span>&nbsp;<span class="builtinfunc" id="3654593">len</span><span class="op" id="3654596">(</span><span class="ident" id="3654597">ss</span><span class="op" id="3654599">.</span><span class="ident" id="3654600">Files</span><span class="op" id="3654605">)</span><span class="op" id="3654606">;</span>&nbsp;<span class="ident" id="3654608">i</span><span class="op" id="3654609">++</span>&nbsp;<span class="op" id="3654612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654616">f</span>&nbsp;<span class="op" id="3654618">:=</span>&nbsp;<span class="op" id="3654621">&amp;</span><span class="ident" id="3654622">ss</span><span class="op" id="3654624">.</span><span class="ident" id="3654625">Files</span><span class="op" id="3654630">[</span><span class="ident" id="3654631">i</span><span class="op" id="3654632">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654636">files</span><span class="op" id="3654641">[</span><span class="ident" id="3654642">i</span><span class="op" id="3654643">]</span>&nbsp;<span class="op" id="3654645">=</span>&nbsp;<span class="op" id="3654647">&amp;</span><span class="ident" id="3654648">File</span><span class="op" id="3654652">{</span><span class="ident" id="3654653">s</span><span class="op" id="3654654">,</span>&nbsp;<span class="ident" id="3654656">f</span><span class="op" id="3654657">.</span><span class="ident" id="3654658">Name</span><span class="op" id="3654662">,</span>&nbsp;<span class="ident" id="3654664">f</span><span class="op" id="3654665">.</span><span class="ident" id="3654666">Base</span><span class="op" id="3654670">,</span>&nbsp;<span class="ident" id="3654672">f</span><span class="op" id="3654673">.</span><span class="ident" id="3654674">Size</span><span class="op" id="3654678">,</span>&nbsp;<span class="ident" id="3654680">f</span><span class="op" id="3654681">.</span><span class="ident" id="3654682">Lines</span><span class="op" id="3654687">,</span>&nbsp;<span class="ident" id="3654689">f</span><span class="op" id="3654690">.</span><span class="ident" id="3654691">Infos</span><span class="op" id="3654696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3654699">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654702">s</span><span class="op" id="3654703">.</span><span class="ident" id="3654704">files</span>&nbsp;<span class="op" id="3654710">=</span>&nbsp;<span class="ident" id="3654712">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654719">s</span><span class="op" id="3654720">.</span><span class="ident" id="3654721">last</span>&nbsp;<span class="op" id="3654726">=</span>&nbsp;<span class="ident" id="3654728">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654733">s</span><span class="op" id="3654734">.</span><span class="ident" id="3654735">mutex</span><span class="op" id="3654740">.</span><span class="ident" id="3654741">Unlock</span><span class="op" id="3654747">(</span><span class="op" id="3654748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654752">return</span>&nbsp;<span class="ident" id="3654759">nil</span><br>
<span class="lineno">40</span><span class="op" id="3654763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3654766">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3654817">func</span>&nbsp;<span class="op" id="3654822">(</span><span class="ident" id="3654823">s</span>&nbsp;<span class="op" id="3654825">*</span><span class="ident" id="3654826">FileSet</span><span class="op" id="3654833">)</span>&nbsp;<span class="ident" id="3654835">Write</span><span class="op" id="3654840">(</span><span class="ident" id="3654841">encode</span>&nbsp;<span class="keyword" id="3654848">func</span><span class="op" id="3654852">(</span><span class="keyword" id="3654853">interface</span><span class="op" id="3654862">{</span><span class="op" id="3654863">}</span><span class="op" id="3654864">)</span>&nbsp;<span class="builtintype" id="3654866">error</span><span class="op" id="3654871">)</span>&nbsp;<span class="builtintype" id="3654873">error</span>&nbsp;<span class="op" id="3654879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654882">var</span>&nbsp;<span class="ident" id="3654886">ss</span>&nbsp;<span class="ident" id="3654889">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654909">s</span><span class="op" id="3654910">.</span><span class="ident" id="3654911">mutex</span><span class="op" id="3654916">.</span><span class="ident" id="3654917">Lock</span><span class="op" id="3654921">(</span><span class="op" id="3654922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654925">ss</span><span class="op" id="3654927">.</span><span class="ident" id="3654928">Base</span>&nbsp;<span class="op" id="3654933">=</span>&nbsp;<span class="ident" id="3654935">s</span><span class="op" id="3654936">.</span><span class="ident" id="3654937">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3654943">files</span>&nbsp;<span class="op" id="3654949">:=</span>&nbsp;<span class="builtinfunc" id="3654952">make</span><span class="op" id="3654956">(</span><span class="op" id="3654957">[</span><span class="op" id="3654958">]</span><span class="ident" id="3654959">serializedFile</span><span class="op" id="3654973">,</span>&nbsp;<span class="builtinfunc" id="3654975">len</span><span class="op" id="3654978">(</span><span class="ident" id="3654979">s</span><span class="op" id="3654980">.</span><span class="ident" id="3654981">files</span><span class="op" id="3654986">)</span><span class="op" id="3654987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3654990">for</span>&nbsp;<span class="ident" id="3654994">i</span><span class="op" id="3654995">,</span>&nbsp;<span class="ident" id="3654997">f</span>&nbsp;<span class="op" id="3654999">:=</span>&nbsp;<span class="keyword" id="3655002">range</span>&nbsp;<span class="ident" id="3655008">s</span><span class="op" id="3655009">.</span><span class="ident" id="3655010">files</span>&nbsp;<span class="op" id="3655016">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3655020">files</span><span class="op" id="3655025">[</span><span class="ident" id="3655026">i</span><span class="op" id="3655027">]</span>&nbsp;<span class="op" id="3655029">=</span>&nbsp;<span class="ident" id="3655031">serializedFile</span><span class="op" id="3655045">{</span><span class="ident" id="3655046">f</span><span class="op" id="3655047">.</span><span class="ident" id="3655048">name</span><span class="op" id="3655052">,</span>&nbsp;<span class="ident" id="3655054">f</span><span class="op" id="3655055">.</span><span class="ident" id="3655056">base</span><span class="op" id="3655060">,</span>&nbsp;<span class="ident" id="3655062">f</span><span class="op" id="3655063">.</span><span class="ident" id="3655064">size</span><span class="op" id="3655068">,</span>&nbsp;<span class="ident" id="3655070">f</span><span class="op" id="3655071">.</span><span class="ident" id="3655072">lines</span><span class="op" id="3655077">,</span>&nbsp;<span class="ident" id="3655079">f</span><span class="op" id="3655080">.</span><span class="ident" id="3655081">infos</span><span class="op" id="3655086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3655089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3655092">ss</span><span class="op" id="3655094">.</span><span class="ident" id="3655095">Files</span>&nbsp;<span class="op" id="3655101">=</span>&nbsp;<span class="ident" id="3655103">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3655110">s</span><span class="op" id="3655111">.</span><span class="ident" id="3655112">mutex</span><span class="op" id="3655117">.</span><span class="ident" id="3655118">Unlock</span><span class="op" id="3655124">(</span><span class="op" id="3655125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3655129">return</span>&nbsp;<span class="ident" id="3655136">encode</span><span class="op" id="3655142">(</span><span class="ident" id="3655143">ss</span><span class="op" id="3655145">)</span><br>
<span class="lineno"></span><span class="op" id="3655147">}</span>
</div>
</body>
</html>
