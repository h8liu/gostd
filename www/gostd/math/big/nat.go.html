<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3786964">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3787019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3787073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3787124">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3787192">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3787238">//</span><br>
<span class="lineno"></span><span class="comment" id="3787241">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;signed&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3787266">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsp;rational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3787292">//</span><br>
<span class="lineno"></span><span class="comment" id="3787295">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3787333">//</span><br>
<span class="lineno"></span><span class="comment" id="3787336">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp;(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3787391">//</span><br>
<span class="lineno">15</span><span class="comment" id="3787394">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3787468">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3787541">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3787615">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3787689">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3787706">//</span><br>
<span class="lineno"></span><span class="keyword" id="3787709">package</span>&nbsp;<span class="ident" id="3787717">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787722">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3787793">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3787864">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3787883">import</span>&nbsp;<span class="op" id="3787890">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3787893">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3787903">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3787909">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3787917">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3787930">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3787937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3787940">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3787977">//</span><br>
<span class="lineno"></span><span class="comment" id="3787980">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3788046">//</span><br>
<span class="lineno"></span><span class="comment" id="3788049">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3788121">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3788168">//</span><br>
<span class="lineno"></span><span class="comment" id="3788171">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3788240">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3788311">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3788382">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3788445">//</span><br>
<span class="lineno"></span><span class="keyword" id="3788448">type</span>&nbsp;<span class="ident" id="3788453">nat</span>&nbsp;<span class="op" id="3788457">[</span><span class="op" id="3788458">]</span><span class="ident" id="3788459">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788465">var</span>&nbsp;<span class="op" id="3788469">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788472">natOne</span>&nbsp;<span class="op" id="3788479">=</span>&nbsp;<span class="ident" id="3788481">nat</span><span class="op" id="3788484">{</span><span class="num" id="3788485">1</span><span class="op" id="3788486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788489">natTwo</span>&nbsp;<span class="op" id="3788496">=</span>&nbsp;<span class="ident" id="3788498">nat</span><span class="op" id="3788501">{</span><span class="num" id="3788502">2</span><span class="op" id="3788503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788506">natTen</span>&nbsp;<span class="op" id="3788513">=</span>&nbsp;<span class="ident" id="3788515">nat</span><span class="op" id="3788518">{</span><span class="num" id="3788519">10</span><span class="op" id="3788521">}</span><br>
<span class="lineno"></span><span class="op" id="3788523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3788526">func</span>&nbsp;<span class="op" id="3788531">(</span><span class="ident" id="3788532">z</span>&nbsp;<span class="ident" id="3788534">nat</span><span class="op" id="3788537">)</span>&nbsp;<span class="ident" id="3788539">clear</span><span class="op" id="3788544">(</span><span class="op" id="3788545">)</span>&nbsp;<span class="op" id="3788547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788550">for</span>&nbsp;<span class="ident" id="3788554">i</span>&nbsp;<span class="op" id="3788556">:=</span>&nbsp;<span class="keyword" id="3788559">range</span>&nbsp;<span class="ident" id="3788565">z</span>&nbsp;<span class="op" id="3788567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788571">z</span><span class="op" id="3788572">[</span><span class="ident" id="3788573">i</span><span class="op" id="3788574">]</span>&nbsp;<span class="op" id="3788576">=</span>&nbsp;<span class="num" id="3788578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788581">}</span><br>
<span class="lineno"></span><span class="op" id="3788583">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3788586">func</span>&nbsp;<span class="op" id="3788591">(</span><span class="ident" id="3788592">z</span>&nbsp;<span class="ident" id="3788594">nat</span><span class="op" id="3788597">)</span>&nbsp;<span class="ident" id="3788599">norm</span><span class="op" id="3788603">(</span><span class="op" id="3788604">)</span>&nbsp;<span class="ident" id="3788606">nat</span>&nbsp;<span class="op" id="3788610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788613">i</span>&nbsp;<span class="op" id="3788615">:=</span>&nbsp;<span class="builtinfunc" id="3788618">len</span><span class="op" id="3788621">(</span><span class="ident" id="3788622">z</span><span class="op" id="3788623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788626">for</span>&nbsp;<span class="ident" id="3788630">i</span>&nbsp;<span class="op" id="3788632">&gt;</span>&nbsp;<span class="num" id="3788634">0</span>&nbsp;<span class="op" id="3788636">&amp;&amp;</span>&nbsp;<span class="ident" id="3788639">z</span><span class="op" id="3788640">[</span><span class="ident" id="3788641">i</span><span class="op" id="3788642">-</span><span class="num" id="3788643">1</span><span class="op" id="3788644">]</span>&nbsp;<span class="op" id="3788646">==</span>&nbsp;<span class="num" id="3788649">0</span>&nbsp;<span class="op" id="3788651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788655">i</span><span class="op" id="3788656">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788663">return</span>&nbsp;<span class="ident" id="3788670">z</span><span class="op" id="3788671">[</span><span class="num" id="3788672">0</span><span class="op" id="3788673">:</span><span class="ident" id="3788674">i</span><span class="op" id="3788675">]</span><br>
<span class="lineno"></span><span class="op" id="3788677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788680">func</span>&nbsp;<span class="op" id="3788685">(</span><span class="ident" id="3788686">z</span>&nbsp;<span class="ident" id="3788688">nat</span><span class="op" id="3788691">)</span>&nbsp;<span class="builtinfunc" id="3788693">make</span><span class="op" id="3788697">(</span><span class="ident" id="3788698">n</span>&nbsp;<span class="builtintype" id="3788700">int</span><span class="op" id="3788703">)</span>&nbsp;<span class="ident" id="3788705">nat</span>&nbsp;<span class="op" id="3788709">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788712">if</span>&nbsp;<span class="ident" id="3788715">n</span>&nbsp;<span class="op" id="3788717">&lt;=</span>&nbsp;<span class="builtinfunc" id="3788720">cap</span><span class="op" id="3788723">(</span><span class="ident" id="3788724">z</span><span class="op" id="3788725">)</span>&nbsp;<span class="op" id="3788727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788731">return</span>&nbsp;<span class="ident" id="3788738">z</span><span class="op" id="3788739">[</span><span class="num" id="3788740">0</span><span class="op" id="3788741">:</span><span class="ident" id="3788742">n</span><span class="op" id="3788743">]</span>&nbsp;<span class="comment" id="3788745">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3788760">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3788827">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788891">const</span>&nbsp;<span class="ident" id="3788897">e</span>&nbsp;<span class="op" id="3788899">=</span>&nbsp;<span class="num" id="3788901">4</span>&nbsp;<span class="comment" id="3788903">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788922">return</span>&nbsp;<span class="builtinfunc" id="3788929">make</span><span class="op" id="3788933">(</span><span class="ident" id="3788934">nat</span><span class="op" id="3788937">,</span>&nbsp;<span class="ident" id="3788939">n</span><span class="op" id="3788940">,</span>&nbsp;<span class="ident" id="3788942">n</span><span class="op" id="3788943">+</span><span class="ident" id="3788944">e</span><span class="op" id="3788945">)</span><br>
<span class="lineno"></span><span class="op" id="3788947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788950">func</span>&nbsp;<span class="op" id="3788955">(</span><span class="ident" id="3788956">z</span>&nbsp;<span class="ident" id="3788958">nat</span><span class="op" id="3788961">)</span>&nbsp;<span class="ident" id="3788963">setWord</span><span class="op" id="3788970">(</span><span class="ident" id="3788971">x</span>&nbsp;<span class="ident" id="3788973">Word</span><span class="op" id="3788977">)</span>&nbsp;<span class="ident" id="3788979">nat</span>&nbsp;<span class="op" id="3788983">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788986">if</span>&nbsp;<span class="ident" id="3788989">x</span>&nbsp;<span class="op" id="3788991">==</span>&nbsp;<span class="num" id="3788994">0</span>&nbsp;<span class="op" id="3788996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789000">return</span>&nbsp;<span class="ident" id="3789007">z</span><span class="op" id="3789008">.</span><span class="builtinfunc" id="3789009">make</span><span class="op" id="3789013">(</span><span class="num" id="3789014">0</span><span class="op" id="3789015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789021">z</span>&nbsp;<span class="op" id="3789023">=</span>&nbsp;<span class="ident" id="3789025">z</span><span class="op" id="3789026">.</span><span class="builtinfunc" id="3789027">make</span><span class="op" id="3789031">(</span><span class="num" id="3789032">1</span><span class="op" id="3789033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789036">z</span><span class="op" id="3789037">[</span><span class="num" id="3789038">0</span><span class="op" id="3789039">]</span>&nbsp;<span class="op" id="3789041">=</span>&nbsp;<span class="ident" id="3789043">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789046">return</span>&nbsp;<span class="ident" id="3789053">z</span><br>
<span class="lineno"></span><span class="op" id="3789055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789058">func</span>&nbsp;<span class="op" id="3789063">(</span><span class="ident" id="3789064">z</span>&nbsp;<span class="ident" id="3789066">nat</span><span class="op" id="3789069">)</span>&nbsp;<span class="ident" id="3789071">setUint64</span><span class="op" id="3789080">(</span><span class="ident" id="3789081">x</span>&nbsp;<span class="ident" id="3789083">uint64</span><span class="op" id="3789089">)</span>&nbsp;<span class="ident" id="3789091">nat</span>&nbsp;<span class="op" id="3789095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789098">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789122">if</span>&nbsp;<span class="ident" id="3789125">w</span>&nbsp;<span class="op" id="3789127">:=</span>&nbsp;<span class="ident" id="3789130">Word</span><span class="op" id="3789134">(</span><span class="ident" id="3789135">x</span><span class="op" id="3789136">)</span><span class="op" id="3789137">;</span>&nbsp;<span class="ident" id="3789139">uint64</span><span class="op" id="3789145">(</span><span class="ident" id="3789146">w</span><span class="op" id="3789147">)</span>&nbsp;<span class="op" id="3789149">==</span>&nbsp;<span class="ident" id="3789152">x</span>&nbsp;<span class="op" id="3789154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789158">return</span>&nbsp;<span class="ident" id="3789165">z</span><span class="op" id="3789166">.</span><span class="ident" id="3789167">setWord</span><span class="op" id="3789174">(</span><span class="ident" id="3789175">w</span><span class="op" id="3789176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789183">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789237">n</span>&nbsp;<span class="op" id="3789239">:=</span>&nbsp;<span class="num" id="3789242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789245">for</span>&nbsp;<span class="ident" id="3789249">t</span>&nbsp;<span class="op" id="3789251">:=</span>&nbsp;<span class="ident" id="3789254">x</span><span class="op" id="3789255">;</span>&nbsp;<span class="ident" id="3789257">t</span>&nbsp;<span class="op" id="3789259">&gt;</span>&nbsp;<span class="num" id="3789261">0</span><span class="op" id="3789262">;</span>&nbsp;<span class="ident" id="3789264">t</span>&nbsp;<span class="op" id="3789266">&gt;&gt;=</span>&nbsp;<span class="ident" id="3789270">_W</span>&nbsp;<span class="op" id="3789273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789277">n</span><span class="op" id="3789278">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789286">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789311">z</span>&nbsp;<span class="op" id="3789313">=</span>&nbsp;<span class="ident" id="3789315">z</span><span class="op" id="3789316">.</span><span class="builtinfunc" id="3789317">make</span><span class="op" id="3789321">(</span><span class="ident" id="3789322">n</span><span class="op" id="3789323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789326">for</span>&nbsp;<span class="ident" id="3789330">i</span>&nbsp;<span class="op" id="3789332">:=</span>&nbsp;<span class="keyword" id="3789335">range</span>&nbsp;<span class="ident" id="3789341">z</span>&nbsp;<span class="op" id="3789343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789347">z</span><span class="op" id="3789348">[</span><span class="ident" id="3789349">i</span><span class="op" id="3789350">]</span>&nbsp;<span class="op" id="3789352">=</span>&nbsp;<span class="ident" id="3789354">Word</span><span class="op" id="3789358">(</span><span class="ident" id="3789359">x</span>&nbsp;<span class="op" id="3789361">&amp;</span>&nbsp;<span class="ident" id="3789363">_M</span><span class="op" id="3789365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789369">x</span>&nbsp;<span class="op" id="3789371">&gt;&gt;=</span>&nbsp;<span class="ident" id="3789375">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789383">return</span>&nbsp;<span class="ident" id="3789390">z</span><br>
<span class="lineno"></span><span class="op" id="3789392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3789395">func</span>&nbsp;<span class="op" id="3789400">(</span><span class="ident" id="3789401">z</span>&nbsp;<span class="ident" id="3789403">nat</span><span class="op" id="3789406">)</span>&nbsp;<span class="ident" id="3789408">set</span><span class="op" id="3789411">(</span><span class="ident" id="3789412">x</span>&nbsp;<span class="ident" id="3789414">nat</span><span class="op" id="3789417">)</span>&nbsp;<span class="ident" id="3789419">nat</span>&nbsp;<span class="op" id="3789423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789426">z</span>&nbsp;<span class="op" id="3789428">=</span>&nbsp;<span class="ident" id="3789430">z</span><span class="op" id="3789431">.</span><span class="builtinfunc" id="3789432">make</span><span class="op" id="3789436">(</span><span class="builtinfunc" id="3789437">len</span><span class="op" id="3789440">(</span><span class="ident" id="3789441">x</span><span class="op" id="3789442">)</span><span class="op" id="3789443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3789446">copy</span><span class="op" id="3789450">(</span><span class="ident" id="3789451">z</span><span class="op" id="3789452">,</span>&nbsp;<span class="ident" id="3789454">x</span><span class="op" id="3789455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789458">return</span>&nbsp;<span class="ident" id="3789465">z</span><br>
<span class="lineno"></span><span class="op" id="3789467">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3789470">func</span>&nbsp;<span class="op" id="3789475">(</span><span class="ident" id="3789476">z</span>&nbsp;<span class="ident" id="3789478">nat</span><span class="op" id="3789481">)</span>&nbsp;<span class="ident" id="3789483">add</span><span class="op" id="3789486">(</span><span class="ident" id="3789487">x</span><span class="op" id="3789488">,</span>&nbsp;<span class="ident" id="3789490">y</span>&nbsp;<span class="ident" id="3789492">nat</span><span class="op" id="3789495">)</span>&nbsp;<span class="ident" id="3789497">nat</span>&nbsp;<span class="op" id="3789501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789504">m</span>&nbsp;<span class="op" id="3789506">:=</span>&nbsp;<span class="builtinfunc" id="3789509">len</span><span class="op" id="3789512">(</span><span class="ident" id="3789513">x</span><span class="op" id="3789514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789517">n</span>&nbsp;<span class="op" id="3789519">:=</span>&nbsp;<span class="builtinfunc" id="3789522">len</span><span class="op" id="3789525">(</span><span class="ident" id="3789526">y</span><span class="op" id="3789527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789531">switch</span>&nbsp;<span class="op" id="3789538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789541">case</span>&nbsp;<span class="ident" id="3789546">m</span>&nbsp;<span class="op" id="3789548">&lt;</span>&nbsp;<span class="ident" id="3789550">n</span><span class="op" id="3789551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789555">return</span>&nbsp;<span class="ident" id="3789562">z</span><span class="op" id="3789563">.</span><span class="ident" id="3789564">add</span><span class="op" id="3789567">(</span><span class="ident" id="3789568">y</span><span class="op" id="3789569">,</span>&nbsp;<span class="ident" id="3789571">x</span><span class="op" id="3789572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789575">case</span>&nbsp;<span class="ident" id="3789580">m</span>&nbsp;<span class="op" id="3789582">==</span>&nbsp;<span class="num" id="3789585">0</span><span class="op" id="3789586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789590">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789630">return</span>&nbsp;<span class="ident" id="3789637">z</span><span class="op" id="3789638">.</span><span class="builtinfunc" id="3789639">make</span><span class="op" id="3789643">(</span><span class="num" id="3789644">0</span><span class="op" id="3789645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789648">case</span>&nbsp;<span class="ident" id="3789653">n</span>&nbsp;<span class="op" id="3789655">==</span>&nbsp;<span class="num" id="3789658">0</span><span class="op" id="3789659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789663">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789680">return</span>&nbsp;<span class="ident" id="3789687">z</span><span class="op" id="3789688">.</span><span class="ident" id="3789689">set</span><span class="op" id="3789692">(</span><span class="ident" id="3789693">x</span><span class="op" id="3789694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789697">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789700">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789711">z</span>&nbsp;<span class="op" id="3789713">=</span>&nbsp;<span class="ident" id="3789715">z</span><span class="op" id="3789716">.</span><span class="builtinfunc" id="3789717">make</span><span class="op" id="3789721">(</span><span class="ident" id="3789722">m</span>&nbsp;<span class="op" id="3789724">+</span>&nbsp;<span class="num" id="3789726">1</span><span class="op" id="3789727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789730">c</span>&nbsp;<span class="op" id="3789732">:=</span>&nbsp;<span class="ident" id="3789735">addVV</span><span class="op" id="3789740">(</span><span class="ident" id="3789741">z</span><span class="op" id="3789742">[</span><span class="num" id="3789743">0</span><span class="op" id="3789744">:</span><span class="ident" id="3789745">n</span><span class="op" id="3789746">]</span><span class="op" id="3789747">,</span>&nbsp;<span class="ident" id="3789749">x</span><span class="op" id="3789750">,</span>&nbsp;<span class="ident" id="3789752">y</span><span class="op" id="3789753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789756">if</span>&nbsp;<span class="ident" id="3789759">m</span>&nbsp;<span class="op" id="3789761">&gt;</span>&nbsp;<span class="ident" id="3789763">n</span>&nbsp;<span class="op" id="3789765">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789769">c</span>&nbsp;<span class="op" id="3789771">=</span>&nbsp;<span class="ident" id="3789773">addVW</span><span class="op" id="3789778">(</span><span class="ident" id="3789779">z</span><span class="op" id="3789780">[</span><span class="ident" id="3789781">n</span><span class="op" id="3789782">:</span><span class="ident" id="3789783">m</span><span class="op" id="3789784">]</span><span class="op" id="3789785">,</span>&nbsp;<span class="ident" id="3789787">x</span><span class="op" id="3789788">[</span><span class="ident" id="3789789">n</span><span class="op" id="3789790">:</span><span class="op" id="3789791">]</span><span class="op" id="3789792">,</span>&nbsp;<span class="ident" id="3789794">c</span><span class="op" id="3789795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789801">z</span><span class="op" id="3789802">[</span><span class="ident" id="3789803">m</span><span class="op" id="3789804">]</span>&nbsp;<span class="op" id="3789806">=</span>&nbsp;<span class="ident" id="3789808">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789812">return</span>&nbsp;<span class="ident" id="3789819">z</span><span class="op" id="3789820">.</span><span class="ident" id="3789821">norm</span><span class="op" id="3789825">(</span><span class="op" id="3789826">)</span><br>
<span class="lineno">140</span><span class="op" id="3789828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789831">func</span>&nbsp;<span class="op" id="3789836">(</span><span class="ident" id="3789837">z</span>&nbsp;<span class="ident" id="3789839">nat</span><span class="op" id="3789842">)</span>&nbsp;<span class="ident" id="3789844">sub</span><span class="op" id="3789847">(</span><span class="ident" id="3789848">x</span><span class="op" id="3789849">,</span>&nbsp;<span class="ident" id="3789851">y</span>&nbsp;<span class="ident" id="3789853">nat</span><span class="op" id="3789856">)</span>&nbsp;<span class="ident" id="3789858">nat</span>&nbsp;<span class="op" id="3789862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789865">m</span>&nbsp;<span class="op" id="3789867">:=</span>&nbsp;<span class="builtinfunc" id="3789870">len</span><span class="op" id="3789873">(</span><span class="ident" id="3789874">x</span><span class="op" id="3789875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789878">n</span>&nbsp;<span class="op" id="3789880">:=</span>&nbsp;<span class="builtinfunc" id="3789883">len</span><span class="op" id="3789886">(</span><span class="ident" id="3789887">y</span><span class="op" id="3789888">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789892">switch</span>&nbsp;<span class="op" id="3789899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789902">case</span>&nbsp;<span class="ident" id="3789907">m</span>&nbsp;<span class="op" id="3789909">&lt;</span>&nbsp;<span class="ident" id="3789911">n</span><span class="op" id="3789912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3789916">panic</span><span class="op" id="3789921">(</span><span class="string" id="3789922">&#34;underflow&#34;</span><span class="op" id="3789933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789936">case</span>&nbsp;<span class="ident" id="3789941">m</span>&nbsp;<span class="op" id="3789943">==</span>&nbsp;<span class="num" id="3789946">0</span><span class="op" id="3789947">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789951">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789991">return</span>&nbsp;<span class="ident" id="3789998">z</span><span class="op" id="3789999">.</span><span class="builtinfunc" id="3790000">make</span><span class="op" id="3790004">(</span><span class="num" id="3790005">0</span><span class="op" id="3790006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790009">case</span>&nbsp;<span class="ident" id="3790014">n</span>&nbsp;<span class="op" id="3790016">==</span>&nbsp;<span class="num" id="3790019">0</span><span class="op" id="3790020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790024">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790041">return</span>&nbsp;<span class="ident" id="3790048">z</span><span class="op" id="3790049">.</span><span class="ident" id="3790050">set</span><span class="op" id="3790053">(</span><span class="ident" id="3790054">x</span><span class="op" id="3790055">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790061">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790072">z</span>&nbsp;<span class="op" id="3790074">=</span>&nbsp;<span class="ident" id="3790076">z</span><span class="op" id="3790077">.</span><span class="builtinfunc" id="3790078">make</span><span class="op" id="3790082">(</span><span class="ident" id="3790083">m</span><span class="op" id="3790084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790087">c</span>&nbsp;<span class="op" id="3790089">:=</span>&nbsp;<span class="ident" id="3790092">subVV</span><span class="op" id="3790097">(</span><span class="ident" id="3790098">z</span><span class="op" id="3790099">[</span><span class="num" id="3790100">0</span><span class="op" id="3790101">:</span><span class="ident" id="3790102">n</span><span class="op" id="3790103">]</span><span class="op" id="3790104">,</span>&nbsp;<span class="ident" id="3790106">x</span><span class="op" id="3790107">,</span>&nbsp;<span class="ident" id="3790109">y</span><span class="op" id="3790110">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790113">if</span>&nbsp;<span class="ident" id="3790116">m</span>&nbsp;<span class="op" id="3790118">&gt;</span>&nbsp;<span class="ident" id="3790120">n</span>&nbsp;<span class="op" id="3790122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790126">c</span>&nbsp;<span class="op" id="3790128">=</span>&nbsp;<span class="ident" id="3790130">subVW</span><span class="op" id="3790135">(</span><span class="ident" id="3790136">z</span><span class="op" id="3790137">[</span><span class="ident" id="3790138">n</span><span class="op" id="3790139">:</span><span class="op" id="3790140">]</span><span class="op" id="3790141">,</span>&nbsp;<span class="ident" id="3790143">x</span><span class="op" id="3790144">[</span><span class="ident" id="3790145">n</span><span class="op" id="3790146">:</span><span class="op" id="3790147">]</span><span class="op" id="3790148">,</span>&nbsp;<span class="ident" id="3790150">c</span><span class="op" id="3790151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790157">if</span>&nbsp;<span class="ident" id="3790160">c</span>&nbsp;<span class="op" id="3790162">!=</span>&nbsp;<span class="num" id="3790165">0</span>&nbsp;<span class="op" id="3790167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3790171">panic</span><span class="op" id="3790176">(</span><span class="string" id="3790177">&#34;underflow&#34;</span><span class="op" id="3790188">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790195">return</span>&nbsp;<span class="ident" id="3790202">z</span><span class="op" id="3790203">.</span><span class="ident" id="3790204">norm</span><span class="op" id="3790208">(</span><span class="op" id="3790209">)</span><br>
<span class="lineno"></span><span class="op" id="3790211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3790214">func</span>&nbsp;<span class="op" id="3790219">(</span><span class="ident" id="3790220">x</span>&nbsp;<span class="ident" id="3790222">nat</span><span class="op" id="3790225">)</span>&nbsp;<span class="ident" id="3790227">cmp</span><span class="op" id="3790230">(</span><span class="ident" id="3790231">y</span>&nbsp;<span class="ident" id="3790233">nat</span><span class="op" id="3790236">)</span>&nbsp;<span class="op" id="3790238">(</span><span class="ident" id="3790239">r</span>&nbsp;<span class="builtintype" id="3790241">int</span><span class="op" id="3790244">)</span>&nbsp;<span class="op" id="3790246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790249">m</span>&nbsp;<span class="op" id="3790251">:=</span>&nbsp;<span class="builtinfunc" id="3790254">len</span><span class="op" id="3790257">(</span><span class="ident" id="3790258">x</span><span class="op" id="3790259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790262">n</span>&nbsp;<span class="op" id="3790264">:=</span>&nbsp;<span class="builtinfunc" id="3790267">len</span><span class="op" id="3790270">(</span><span class="ident" id="3790271">y</span><span class="op" id="3790272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790275">if</span>&nbsp;<span class="ident" id="3790278">m</span>&nbsp;<span class="op" id="3790280">!=</span>&nbsp;<span class="ident" id="3790283">n</span>&nbsp;<span class="op" id="3790285">||</span>&nbsp;<span class="ident" id="3790288">m</span>&nbsp;<span class="op" id="3790290">==</span>&nbsp;<span class="num" id="3790293">0</span>&nbsp;<span class="op" id="3790295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790299">switch</span>&nbsp;<span class="op" id="3790306">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790310">case</span>&nbsp;<span class="ident" id="3790315">m</span>&nbsp;<span class="op" id="3790317">&lt;</span>&nbsp;<span class="ident" id="3790319">n</span><span class="op" id="3790320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790325">r</span>&nbsp;<span class="op" id="3790327">=</span>&nbsp;<span class="op" id="3790329">-</span><span class="num" id="3790330">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790334">case</span>&nbsp;<span class="ident" id="3790339">m</span>&nbsp;<span class="op" id="3790341">&gt;</span>&nbsp;<span class="ident" id="3790343">n</span><span class="op" id="3790344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790349">r</span>&nbsp;<span class="op" id="3790351">=</span>&nbsp;<span class="num" id="3790353">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790357">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790373">i</span>&nbsp;<span class="op" id="3790375">:=</span>&nbsp;<span class="ident" id="3790378">m</span>&nbsp;<span class="op" id="3790380">-</span>&nbsp;<span class="num" id="3790382">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790385">for</span>&nbsp;<span class="ident" id="3790389">i</span>&nbsp;<span class="op" id="3790391">&gt;</span>&nbsp;<span class="num" id="3790393">0</span>&nbsp;<span class="op" id="3790395">&amp;&amp;</span>&nbsp;<span class="ident" id="3790398">x</span><span class="op" id="3790399">[</span><span class="ident" id="3790400">i</span><span class="op" id="3790401">]</span>&nbsp;<span class="op" id="3790403">==</span>&nbsp;<span class="ident" id="3790406">y</span><span class="op" id="3790407">[</span><span class="ident" id="3790408">i</span><span class="op" id="3790409">]</span>&nbsp;<span class="op" id="3790411">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790415">i</span><span class="op" id="3790416">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790424">switch</span>&nbsp;<span class="op" id="3790431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790434">case</span>&nbsp;<span class="ident" id="3790439">x</span><span class="op" id="3790440">[</span><span class="ident" id="3790441">i</span><span class="op" id="3790442">]</span>&nbsp;<span class="op" id="3790444">&lt;</span>&nbsp;<span class="ident" id="3790446">y</span><span class="op" id="3790447">[</span><span class="ident" id="3790448">i</span><span class="op" id="3790449">]</span><span class="op" id="3790450">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790454">r</span>&nbsp;<span class="op" id="3790456">=</span>&nbsp;<span class="op" id="3790458">-</span><span class="num" id="3790459">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790462">case</span>&nbsp;<span class="ident" id="3790467">x</span><span class="op" id="3790468">[</span><span class="ident" id="3790469">i</span><span class="op" id="3790470">]</span>&nbsp;<span class="op" id="3790472">&gt;</span>&nbsp;<span class="ident" id="3790474">y</span><span class="op" id="3790475">[</span><span class="ident" id="3790476">i</span><span class="op" id="3790477">]</span><span class="op" id="3790478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790482">r</span>&nbsp;<span class="op" id="3790484">=</span>&nbsp;<span class="num" id="3790486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790492">return</span><br>
<span class="lineno">195</span><span class="op" id="3790499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3790502">func</span>&nbsp;<span class="op" id="3790507">(</span><span class="ident" id="3790508">z</span>&nbsp;<span class="ident" id="3790510">nat</span><span class="op" id="3790513">)</span>&nbsp;<span class="ident" id="3790515">mulAddWW</span><span class="op" id="3790523">(</span><span class="ident" id="3790524">x</span>&nbsp;<span class="ident" id="3790526">nat</span><span class="op" id="3790529">,</span>&nbsp;<span class="ident" id="3790531">y</span><span class="op" id="3790532">,</span>&nbsp;<span class="ident" id="3790534">r</span>&nbsp;<span class="ident" id="3790536">Word</span><span class="op" id="3790540">)</span>&nbsp;<span class="ident" id="3790542">nat</span>&nbsp;<span class="op" id="3790546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790549">m</span>&nbsp;<span class="op" id="3790551">:=</span>&nbsp;<span class="builtinfunc" id="3790554">len</span><span class="op" id="3790557">(</span><span class="ident" id="3790558">x</span><span class="op" id="3790559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790562">if</span>&nbsp;<span class="ident" id="3790565">m</span>&nbsp;<span class="op" id="3790567">==</span>&nbsp;<span class="num" id="3790570">0</span>&nbsp;<span class="op" id="3790572">||</span>&nbsp;<span class="ident" id="3790575">y</span>&nbsp;<span class="op" id="3790577">==</span>&nbsp;<span class="num" id="3790580">0</span>&nbsp;<span class="op" id="3790582">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790586">return</span>&nbsp;<span class="ident" id="3790593">z</span><span class="op" id="3790594">.</span><span class="ident" id="3790595">setWord</span><span class="op" id="3790602">(</span><span class="ident" id="3790603">r</span><span class="op" id="3790604">)</span>&nbsp;<span class="comment" id="3790606">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790625">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790636">z</span>&nbsp;<span class="op" id="3790638">=</span>&nbsp;<span class="ident" id="3790640">z</span><span class="op" id="3790641">.</span><span class="builtinfunc" id="3790642">make</span><span class="op" id="3790646">(</span><span class="ident" id="3790647">m</span>&nbsp;<span class="op" id="3790649">+</span>&nbsp;<span class="num" id="3790651">1</span><span class="op" id="3790652">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790655">z</span><span class="op" id="3790656">[</span><span class="ident" id="3790657">m</span><span class="op" id="3790658">]</span>&nbsp;<span class="op" id="3790660">=</span>&nbsp;<span class="ident" id="3790662">mulAddVWW</span><span class="op" id="3790671">(</span><span class="ident" id="3790672">z</span><span class="op" id="3790673">[</span><span class="num" id="3790674">0</span><span class="op" id="3790675">:</span><span class="ident" id="3790676">m</span><span class="op" id="3790677">]</span><span class="op" id="3790678">,</span>&nbsp;<span class="ident" id="3790680">x</span><span class="op" id="3790681">,</span>&nbsp;<span class="ident" id="3790683">y</span><span class="op" id="3790684">,</span>&nbsp;<span class="ident" id="3790686">r</span><span class="op" id="3790687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790691">return</span>&nbsp;<span class="ident" id="3790698">z</span><span class="op" id="3790699">.</span><span class="ident" id="3790700">norm</span><span class="op" id="3790704">(</span><span class="op" id="3790705">)</span><br>
<span class="lineno"></span><span class="op" id="3790707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3790710">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3790769">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3790837">func</span>&nbsp;<span class="ident" id="3790842">basicMul</span><span class="op" id="3790850">(</span><span class="ident" id="3790851">z</span><span class="op" id="3790852">,</span>&nbsp;<span class="ident" id="3790854">x</span><span class="op" id="3790855">,</span>&nbsp;<span class="ident" id="3790857">y</span>&nbsp;<span class="ident" id="3790859">nat</span><span class="op" id="3790862">)</span>&nbsp;<span class="op" id="3790864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790867">z</span><span class="op" id="3790868">[</span><span class="num" id="3790869">0</span>&nbsp;<span class="op" id="3790871">:</span>&nbsp;<span class="builtinfunc" id="3790873">len</span><span class="op" id="3790876">(</span><span class="ident" id="3790877">x</span><span class="op" id="3790878">)</span><span class="op" id="3790879">+</span><span class="builtinfunc" id="3790880">len</span><span class="op" id="3790883">(</span><span class="ident" id="3790884">y</span><span class="op" id="3790885">)</span><span class="op" id="3790886">]</span><span class="op" id="3790887">.</span><span class="ident" id="3790888">clear</span><span class="op" id="3790893">(</span><span class="op" id="3790894">)</span>&nbsp;<span class="comment" id="3790896">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790913">for</span>&nbsp;<span class="ident" id="3790917">i</span><span class="op" id="3790918">,</span>&nbsp;<span class="ident" id="3790920">d</span>&nbsp;<span class="op" id="3790922">:=</span>&nbsp;<span class="keyword" id="3790925">range</span>&nbsp;<span class="ident" id="3790931">y</span>&nbsp;<span class="op" id="3790933">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790937">if</span>&nbsp;<span class="ident" id="3790940">d</span>&nbsp;<span class="op" id="3790942">!=</span>&nbsp;<span class="num" id="3790945">0</span>&nbsp;<span class="op" id="3790947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790952">z</span><span class="op" id="3790953">[</span><span class="builtinfunc" id="3790954">len</span><span class="op" id="3790957">(</span><span class="ident" id="3790958">x</span><span class="op" id="3790959">)</span><span class="op" id="3790960">+</span><span class="ident" id="3790961">i</span><span class="op" id="3790962">]</span>&nbsp;<span class="op" id="3790964">=</span>&nbsp;<span class="ident" id="3790966">addMulVVW</span><span class="op" id="3790975">(</span><span class="ident" id="3790976">z</span><span class="op" id="3790977">[</span><span class="ident" id="3790978">i</span><span class="op" id="3790979">:</span><span class="ident" id="3790980">i</span><span class="op" id="3790981">+</span><span class="builtinfunc" id="3790982">len</span><span class="op" id="3790985">(</span><span class="ident" id="3790986">x</span><span class="op" id="3790987">)</span><span class="op" id="3790988">]</span><span class="op" id="3790989">,</span>&nbsp;<span class="ident" id="3790991">x</span><span class="op" id="3790992">,</span>&nbsp;<span class="ident" id="3790994">d</span><span class="op" id="3790995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791002">}</span><br>
<span class="lineno"></span><span class="op" id="3791004">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3791007">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3791082">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3791146">func</span>&nbsp;<span class="ident" id="3791151">karatsubaAdd</span><span class="op" id="3791163">(</span><span class="ident" id="3791164">z</span><span class="op" id="3791165">,</span>&nbsp;<span class="ident" id="3791167">x</span>&nbsp;<span class="ident" id="3791169">nat</span><span class="op" id="3791172">,</span>&nbsp;<span class="ident" id="3791174">n</span>&nbsp;<span class="builtintype" id="3791176">int</span><span class="op" id="3791179">)</span>&nbsp;<span class="op" id="3791181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791184">if</span>&nbsp;<span class="ident" id="3791187">c</span>&nbsp;<span class="op" id="3791189">:=</span>&nbsp;<span class="ident" id="3791192">addVV</span><span class="op" id="3791197">(</span><span class="ident" id="3791198">z</span><span class="op" id="3791199">[</span><span class="num" id="3791200">0</span><span class="op" id="3791201">:</span><span class="ident" id="3791202">n</span><span class="op" id="3791203">]</span><span class="op" id="3791204">,</span>&nbsp;<span class="ident" id="3791206">z</span><span class="op" id="3791207">,</span>&nbsp;<span class="ident" id="3791209">x</span><span class="op" id="3791210">)</span><span class="op" id="3791211">;</span>&nbsp;<span class="ident" id="3791213">c</span>&nbsp;<span class="op" id="3791215">!=</span>&nbsp;<span class="num" id="3791218">0</span>&nbsp;<span class="op" id="3791220">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3791224">addVW</span><span class="op" id="3791229">(</span><span class="ident" id="3791230">z</span><span class="op" id="3791231">[</span><span class="ident" id="3791232">n</span><span class="op" id="3791233">:</span><span class="ident" id="3791234">n</span><span class="op" id="3791235">+</span><span class="ident" id="3791236">n</span><span class="op" id="3791237">&gt;&gt;</span><span class="num" id="3791239">1</span><span class="op" id="3791240">]</span><span class="op" id="3791241">,</span>&nbsp;<span class="ident" id="3791243">z</span><span class="op" id="3791244">[</span><span class="ident" id="3791245">n</span><span class="op" id="3791246">:</span><span class="op" id="3791247">]</span><span class="op" id="3791248">,</span>&nbsp;<span class="ident" id="3791250">c</span><span class="op" id="3791251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791254">}</span><br>
<span class="lineno"></span><span class="op" id="3791256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3791259">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3791300">func</span>&nbsp;<span class="ident" id="3791305">karatsubaSub</span><span class="op" id="3791317">(</span><span class="ident" id="3791318">z</span><span class="op" id="3791319">,</span>&nbsp;<span class="ident" id="3791321">x</span>&nbsp;<span class="ident" id="3791323">nat</span><span class="op" id="3791326">,</span>&nbsp;<span class="ident" id="3791328">n</span>&nbsp;<span class="builtintype" id="3791330">int</span><span class="op" id="3791333">)</span>&nbsp;<span class="op" id="3791335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791338">if</span>&nbsp;<span class="ident" id="3791341">c</span>&nbsp;<span class="op" id="3791343">:=</span>&nbsp;<span class="ident" id="3791346">subVV</span><span class="op" id="3791351">(</span><span class="ident" id="3791352">z</span><span class="op" id="3791353">[</span><span class="num" id="3791354">0</span><span class="op" id="3791355">:</span><span class="ident" id="3791356">n</span><span class="op" id="3791357">]</span><span class="op" id="3791358">,</span>&nbsp;<span class="ident" id="3791360">z</span><span class="op" id="3791361">,</span>&nbsp;<span class="ident" id="3791363">x</span><span class="op" id="3791364">)</span><span class="op" id="3791365">;</span>&nbsp;<span class="ident" id="3791367">c</span>&nbsp;<span class="op" id="3791369">!=</span>&nbsp;<span class="num" id="3791372">0</span>&nbsp;<span class="op" id="3791374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3791378">subVW</span><span class="op" id="3791383">(</span><span class="ident" id="3791384">z</span><span class="op" id="3791385">[</span><span class="ident" id="3791386">n</span><span class="op" id="3791387">:</span><span class="ident" id="3791388">n</span><span class="op" id="3791389">+</span><span class="ident" id="3791390">n</span><span class="op" id="3791391">&gt;&gt;</span><span class="num" id="3791393">1</span><span class="op" id="3791394">]</span><span class="op" id="3791395">,</span>&nbsp;<span class="ident" id="3791397">z</span><span class="op" id="3791398">[</span><span class="ident" id="3791399">n</span><span class="op" id="3791400">:</span><span class="op" id="3791401">]</span><span class="op" id="3791402">,</span>&nbsp;<span class="ident" id="3791404">c</span><span class="op" id="3791405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791408">}</span><br>
<span class="lineno"></span><span class="op" id="3791410">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3791413">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3791487">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3791565">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3791577">var</span>&nbsp;<span class="ident" id="3791581">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3791600">int</span>&nbsp;<span class="op" id="3791604">=</span>&nbsp;<span class="num" id="3791606">40</span>&nbsp;<span class="comment" id="3791609">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3791638">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3791698">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3791758">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3791818">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3791874">func</span>&nbsp;<span class="ident" id="3791879">karatsuba</span><span class="op" id="3791888">(</span><span class="ident" id="3791889">z</span><span class="op" id="3791890">,</span>&nbsp;<span class="ident" id="3791892">x</span><span class="op" id="3791893">,</span>&nbsp;<span class="ident" id="3791895">y</span>&nbsp;<span class="ident" id="3791897">nat</span><span class="op" id="3791900">)</span>&nbsp;<span class="op" id="3791902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3791905">n</span>&nbsp;<span class="op" id="3791907">:=</span>&nbsp;<span class="builtinfunc" id="3791910">len</span><span class="op" id="3791913">(</span><span class="ident" id="3791914">y</span><span class="op" id="3791915">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3791919">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3791983">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792043">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792061">if</span>&nbsp;<span class="ident" id="3792064">n</span><span class="op" id="3792065">&amp;</span><span class="num" id="3792066">1</span>&nbsp;<span class="op" id="3792068">!=</span>&nbsp;<span class="num" id="3792071">0</span>&nbsp;<span class="op" id="3792073">||</span>&nbsp;<span class="ident" id="3792076">n</span>&nbsp;<span class="op" id="3792078">&lt;</span>&nbsp;<span class="ident" id="3792080">karatsubaThreshold</span>&nbsp;<span class="op" id="3792099">||</span>&nbsp;<span class="ident" id="3792102">n</span>&nbsp;<span class="op" id="3792104">&lt;</span>&nbsp;<span class="num" id="3792106">2</span>&nbsp;<span class="op" id="3792108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792112">basicMul</span><span class="op" id="3792120">(</span><span class="ident" id="3792121">z</span><span class="op" id="3792122">,</span>&nbsp;<span class="ident" id="3792124">x</span><span class="op" id="3792125">,</span>&nbsp;<span class="ident" id="3792127">y</span><span class="op" id="3792128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792132">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792140">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792143">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792194">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792256">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792290">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792294">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792314">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792334">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792338">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792401">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792419">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792423">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792473">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792523">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792527">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792537">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792541">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792560">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792579">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792583">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792634">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792685">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792736">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792787">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792829">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792858">n2</span>&nbsp;<span class="op" id="3792861">:=</span>&nbsp;<span class="ident" id="3792864">n</span>&nbsp;<span class="op" id="3792866">&gt;&gt;</span>&nbsp;<span class="num" id="3792869">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792884">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792896">x1</span><span class="op" id="3792898">,</span>&nbsp;<span class="ident" id="3792900">x0</span>&nbsp;<span class="op" id="3792903">:=</span>&nbsp;<span class="ident" id="3792906">x</span><span class="op" id="3792907">[</span><span class="ident" id="3792908">n2</span><span class="op" id="3792910">:</span><span class="op" id="3792911">]</span><span class="op" id="3792912">,</span>&nbsp;<span class="ident" id="3792914">x</span><span class="op" id="3792915">[</span><span class="num" id="3792916">0</span><span class="op" id="3792917">:</span><span class="ident" id="3792918">n2</span><span class="op" id="3792920">]</span>&nbsp;<span class="comment" id="3792922">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792940">y1</span><span class="op" id="3792942">,</span>&nbsp;<span class="ident" id="3792944">y0</span>&nbsp;<span class="op" id="3792947">:=</span>&nbsp;<span class="ident" id="3792950">y</span><span class="op" id="3792951">[</span><span class="ident" id="3792952">n2</span><span class="op" id="3792954">:</span><span class="op" id="3792955">]</span><span class="op" id="3792956">,</span>&nbsp;<span class="ident" id="3792958">y</span><span class="op" id="3792959">[</span><span class="num" id="3792960">0</span><span class="op" id="3792961">:</span><span class="ident" id="3792962">n2</span><span class="op" id="3792964">]</span>&nbsp;<span class="comment" id="3792966">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792985">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793037">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793041">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793099">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793157">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793161">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793222">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793284">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793301">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793355">karatsuba</span><span class="op" id="3793364">(</span><span class="ident" id="3793365">z</span><span class="op" id="3793366">,</span>&nbsp;<span class="ident" id="3793368">x0</span><span class="op" id="3793370">,</span>&nbsp;<span class="ident" id="3793372">y0</span><span class="op" id="3793374">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793380">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793395">karatsuba</span><span class="op" id="3793404">(</span><span class="ident" id="3793405">z</span><span class="op" id="3793406">[</span><span class="ident" id="3793407">n</span><span class="op" id="3793408">:</span><span class="op" id="3793409">]</span><span class="op" id="3793410">,</span>&nbsp;<span class="ident" id="3793412">x1</span><span class="op" id="3793414">,</span>&nbsp;<span class="ident" id="3793416">y1</span><span class="op" id="3793418">)</span>&nbsp;<span class="comment" id="3793420">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793436">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793495">s</span>&nbsp;<span class="op" id="3793497">:=</span>&nbsp;<span class="num" id="3793500">1</span>&nbsp;<span class="comment" id="3793502">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793528">xd</span>&nbsp;<span class="op" id="3793531">:=</span>&nbsp;<span class="ident" id="3793534">z</span><span class="op" id="3793535">[</span><span class="num" id="3793536">2</span><span class="op" id="3793537">*</span><span class="ident" id="3793538">n</span>&nbsp;<span class="op" id="3793540">:</span>&nbsp;<span class="num" id="3793542">2</span><span class="op" id="3793543">*</span><span class="ident" id="3793544">n</span><span class="op" id="3793545">+</span><span class="ident" id="3793546">n2</span><span class="op" id="3793548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793551">if</span>&nbsp;<span class="ident" id="3793554">subVV</span><span class="op" id="3793559">(</span><span class="ident" id="3793560">xd</span><span class="op" id="3793562">,</span>&nbsp;<span class="ident" id="3793564">x1</span><span class="op" id="3793566">,</span>&nbsp;<span class="ident" id="3793568">x0</span><span class="op" id="3793570">)</span>&nbsp;<span class="op" id="3793572">!=</span>&nbsp;<span class="num" id="3793575">0</span>&nbsp;<span class="op" id="3793577">{</span>&nbsp;<span class="comment" id="3793579">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793590">s</span>&nbsp;<span class="op" id="3793592">=</span>&nbsp;<span class="op" id="3793594">-</span><span class="ident" id="3793595">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793599">subVV</span><span class="op" id="3793604">(</span><span class="ident" id="3793605">xd</span><span class="op" id="3793607">,</span>&nbsp;<span class="ident" id="3793609">x0</span><span class="op" id="3793611">,</span>&nbsp;<span class="ident" id="3793613">x1</span><span class="op" id="3793615">)</span>&nbsp;<span class="comment" id="3793617">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793627">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793631">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793690">yd</span>&nbsp;<span class="op" id="3793693">:=</span>&nbsp;<span class="ident" id="3793696">z</span><span class="op" id="3793697">[</span><span class="num" id="3793698">2</span><span class="op" id="3793699">*</span><span class="ident" id="3793700">n</span><span class="op" id="3793701">+</span><span class="ident" id="3793702">n2</span>&nbsp;<span class="op" id="3793705">:</span>&nbsp;<span class="num" id="3793707">3</span><span class="op" id="3793708">*</span><span class="ident" id="3793709">n</span><span class="op" id="3793710">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793713">if</span>&nbsp;<span class="ident" id="3793716">subVV</span><span class="op" id="3793721">(</span><span class="ident" id="3793722">yd</span><span class="op" id="3793724">,</span>&nbsp;<span class="ident" id="3793726">y0</span><span class="op" id="3793728">,</span>&nbsp;<span class="ident" id="3793730">y1</span><span class="op" id="3793732">)</span>&nbsp;<span class="op" id="3793734">!=</span>&nbsp;<span class="num" id="3793737">0</span>&nbsp;<span class="op" id="3793739">{</span>&nbsp;<span class="comment" id="3793741">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793752">s</span>&nbsp;<span class="op" id="3793754">=</span>&nbsp;<span class="op" id="3793756">-</span><span class="ident" id="3793757">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793761">subVV</span><span class="op" id="3793766">(</span><span class="ident" id="3793767">yd</span><span class="op" id="3793769">,</span>&nbsp;<span class="ident" id="3793771">y1</span><span class="op" id="3793773">,</span>&nbsp;<span class="ident" id="3793775">y0</span><span class="op" id="3793777">)</span>&nbsp;<span class="comment" id="3793779">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793793">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793860">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793927">p</span>&nbsp;<span class="op" id="3793929">:=</span>&nbsp;<span class="ident" id="3793932">z</span><span class="op" id="3793933">[</span><span class="ident" id="3793934">n</span><span class="op" id="3793935">*</span><span class="num" id="3793936">3</span><span class="op" id="3793937">:</span><span class="op" id="3793938">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793941">karatsuba</span><span class="op" id="3793950">(</span><span class="ident" id="3793951">p</span><span class="op" id="3793952">,</span>&nbsp;<span class="ident" id="3793954">xd</span><span class="op" id="3793956">,</span>&nbsp;<span class="ident" id="3793958">yd</span><span class="op" id="3793960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793964">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793988">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794047">r</span>&nbsp;<span class="op" id="3794049">:=</span>&nbsp;<span class="ident" id="3794052">z</span><span class="op" id="3794053">[</span><span class="ident" id="3794054">n</span><span class="op" id="3794055">*</span><span class="num" id="3794056">4</span><span class="op" id="3794057">:</span><span class="op" id="3794058">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3794061">copy</span><span class="op" id="3794065">(</span><span class="ident" id="3794066">r</span><span class="op" id="3794067">,</span>&nbsp;<span class="ident" id="3794069">z</span><span class="op" id="3794070">[</span><span class="op" id="3794071">:</span><span class="ident" id="3794072">n</span><span class="op" id="3794073">*</span><span class="num" id="3794074">2</span><span class="op" id="3794075">]</span><span class="op" id="3794076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794080">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794112">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794116">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794138">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794160">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794179">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794198">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3794217">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794221">karatsubaAdd</span><span class="op" id="3794233">(</span><span class="ident" id="3794234">z</span><span class="op" id="3794235">[</span><span class="ident" id="3794236">n2</span><span class="op" id="3794238">:</span><span class="op" id="3794239">]</span><span class="op" id="3794240">,</span>&nbsp;<span class="ident" id="3794242">r</span><span class="op" id="3794243">,</span>&nbsp;<span class="ident" id="3794245">n</span><span class="op" id="3794246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794249">karatsubaAdd</span><span class="op" id="3794261">(</span><span class="ident" id="3794262">z</span><span class="op" id="3794263">[</span><span class="ident" id="3794264">n2</span><span class="op" id="3794266">:</span><span class="op" id="3794267">]</span><span class="op" id="3794268">,</span>&nbsp;<span class="ident" id="3794270">r</span><span class="op" id="3794271">[</span><span class="ident" id="3794272">n</span><span class="op" id="3794273">:</span><span class="op" id="3794274">]</span><span class="op" id="3794275">,</span>&nbsp;<span class="ident" id="3794277">n</span><span class="op" id="3794278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794281">if</span>&nbsp;<span class="ident" id="3794284">s</span>&nbsp;<span class="op" id="3794286">&gt;</span>&nbsp;<span class="num" id="3794288">0</span>&nbsp;<span class="op" id="3794290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794294">karatsubaAdd</span><span class="op" id="3794306">(</span><span class="ident" id="3794307">z</span><span class="op" id="3794308">[</span><span class="ident" id="3794309">n2</span><span class="op" id="3794311">:</span><span class="op" id="3794312">]</span><span class="op" id="3794313">,</span>&nbsp;<span class="ident" id="3794315">p</span><span class="op" id="3794316">,</span>&nbsp;<span class="ident" id="3794318">n</span><span class="op" id="3794319">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794322">}</span>&nbsp;<span class="keyword" id="3794324">else</span>&nbsp;<span class="op" id="3794329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794333">karatsubaSub</span><span class="op" id="3794345">(</span><span class="ident" id="3794346">z</span><span class="op" id="3794347">[</span><span class="ident" id="3794348">n2</span><span class="op" id="3794350">:</span><span class="op" id="3794351">]</span><span class="op" id="3794352">,</span>&nbsp;<span class="ident" id="3794354">p</span><span class="op" id="3794355">,</span>&nbsp;<span class="ident" id="3794357">n</span><span class="op" id="3794358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794361">}</span><br>
<span class="lineno"></span><span class="op" id="3794363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3794366">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3794426">func</span>&nbsp;<span class="ident" id="3794431">alias</span><span class="op" id="3794436">(</span><span class="ident" id="3794437">x</span><span class="op" id="3794438">,</span>&nbsp;<span class="ident" id="3794440">y</span>&nbsp;<span class="ident" id="3794442">nat</span><span class="op" id="3794445">)</span>&nbsp;<span class="builtintype" id="3794447">bool</span>&nbsp;<span class="op" id="3794452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794455">return</span>&nbsp;<span class="builtinfunc" id="3794462">cap</span><span class="op" id="3794465">(</span><span class="ident" id="3794466">x</span><span class="op" id="3794467">)</span>&nbsp;<span class="op" id="3794469">&gt;</span>&nbsp;<span class="num" id="3794471">0</span>&nbsp;<span class="op" id="3794473">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3794476">cap</span><span class="op" id="3794479">(</span><span class="ident" id="3794480">y</span><span class="op" id="3794481">)</span>&nbsp;<span class="op" id="3794483">&gt;</span>&nbsp;<span class="num" id="3794485">0</span>&nbsp;<span class="op" id="3794487">&amp;&amp;</span>&nbsp;<span class="op" id="3794490">&amp;</span><span class="ident" id="3794491">x</span><span class="op" id="3794492">[</span><span class="num" id="3794493">0</span><span class="op" id="3794494">:</span><span class="builtinfunc" id="3794495">cap</span><span class="op" id="3794498">(</span><span class="ident" id="3794499">x</span><span class="op" id="3794500">)</span><span class="op" id="3794501">]</span><span class="op" id="3794502">[</span><span class="builtinfunc" id="3794503">cap</span><span class="op" id="3794506">(</span><span class="ident" id="3794507">x</span><span class="op" id="3794508">)</span><span class="op" id="3794509">-</span><span class="num" id="3794510">1</span><span class="op" id="3794511">]</span>&nbsp;<span class="op" id="3794513">==</span>&nbsp;<span class="op" id="3794516">&amp;</span><span class="ident" id="3794517">y</span><span class="op" id="3794518">[</span><span class="num" id="3794519">0</span><span class="op" id="3794520">:</span><span class="builtinfunc" id="3794521">cap</span><span class="op" id="3794524">(</span><span class="ident" id="3794525">y</span><span class="op" id="3794526">)</span><span class="op" id="3794527">]</span><span class="op" id="3794528">[</span><span class="builtinfunc" id="3794529">cap</span><span class="op" id="3794532">(</span><span class="ident" id="3794533">y</span><span class="op" id="3794534">)</span><span class="op" id="3794535">-</span><span class="num" id="3794536">1</span><span class="op" id="3794537">]</span><br>
<span class="lineno"></span><span class="op" id="3794539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3794542">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3794601">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3794661">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3794725">func</span>&nbsp;<span class="ident" id="3794730">addAt</span><span class="op" id="3794735">(</span><span class="ident" id="3794736">z</span><span class="op" id="3794737">,</span>&nbsp;<span class="ident" id="3794739">x</span>&nbsp;<span class="ident" id="3794741">nat</span><span class="op" id="3794744">,</span>&nbsp;<span class="ident" id="3794746">i</span>&nbsp;<span class="builtintype" id="3794748">int</span><span class="op" id="3794751">)</span>&nbsp;<span class="op" id="3794753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794756">if</span>&nbsp;<span class="ident" id="3794759">n</span>&nbsp;<span class="op" id="3794761">:=</span>&nbsp;<span class="builtinfunc" id="3794764">len</span><span class="op" id="3794767">(</span><span class="ident" id="3794768">x</span><span class="op" id="3794769">)</span><span class="op" id="3794770">;</span>&nbsp;<span class="ident" id="3794772">n</span>&nbsp;<span class="op" id="3794774">&gt;</span>&nbsp;<span class="num" id="3794776">0</span>&nbsp;<span class="op" id="3794778">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794782">if</span>&nbsp;<span class="ident" id="3794785">c</span>&nbsp;<span class="op" id="3794787">:=</span>&nbsp;<span class="ident" id="3794790">addVV</span><span class="op" id="3794795">(</span><span class="ident" id="3794796">z</span><span class="op" id="3794797">[</span><span class="ident" id="3794798">i</span><span class="op" id="3794799">:</span><span class="ident" id="3794800">i</span><span class="op" id="3794801">+</span><span class="ident" id="3794802">n</span><span class="op" id="3794803">]</span><span class="op" id="3794804">,</span>&nbsp;<span class="ident" id="3794806">z</span><span class="op" id="3794807">[</span><span class="ident" id="3794808">i</span><span class="op" id="3794809">:</span><span class="op" id="3794810">]</span><span class="op" id="3794811">,</span>&nbsp;<span class="ident" id="3794813">x</span><span class="op" id="3794814">)</span><span class="op" id="3794815">;</span>&nbsp;<span class="ident" id="3794817">c</span>&nbsp;<span class="op" id="3794819">!=</span>&nbsp;<span class="num" id="3794822">0</span>&nbsp;<span class="op" id="3794824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794829">j</span>&nbsp;<span class="op" id="3794831">:=</span>&nbsp;<span class="ident" id="3794834">i</span>&nbsp;<span class="op" id="3794836">+</span>&nbsp;<span class="ident" id="3794838">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794843">if</span>&nbsp;<span class="ident" id="3794846">j</span>&nbsp;<span class="op" id="3794848">&lt;</span>&nbsp;<span class="builtinfunc" id="3794850">len</span><span class="op" id="3794853">(</span><span class="ident" id="3794854">z</span><span class="op" id="3794855">)</span>&nbsp;<span class="op" id="3794857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3794863">addVW</span><span class="op" id="3794868">(</span><span class="ident" id="3794869">z</span><span class="op" id="3794870">[</span><span class="ident" id="3794871">j</span><span class="op" id="3794872">:</span><span class="op" id="3794873">]</span><span class="op" id="3794874">,</span>&nbsp;<span class="ident" id="3794876">z</span><span class="op" id="3794877">[</span><span class="ident" id="3794878">j</span><span class="op" id="3794879">:</span><span class="op" id="3794880">]</span><span class="op" id="3794881">,</span>&nbsp;<span class="ident" id="3794883">c</span><span class="op" id="3794884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794889">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794896">}</span><br>
<span class="lineno"></span><span class="op" id="3794898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3794901">func</span>&nbsp;<span class="ident" id="3794906">max</span><span class="op" id="3794909">(</span><span class="ident" id="3794910">x</span><span class="op" id="3794911">,</span>&nbsp;<span class="ident" id="3794913">y</span>&nbsp;<span class="builtintype" id="3794915">int</span><span class="op" id="3794918">)</span>&nbsp;<span class="builtintype" id="3794920">int</span>&nbsp;<span class="op" id="3794924">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794927">if</span>&nbsp;<span class="ident" id="3794930">x</span>&nbsp;<span class="op" id="3794932">&gt;</span>&nbsp;<span class="ident" id="3794934">y</span>&nbsp;<span class="op" id="3794936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794940">return</span>&nbsp;<span class="ident" id="3794947">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3794950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3794953">return</span>&nbsp;<span class="ident" id="3794960">y</span><br>
<span class="lineno"></span><span class="op" id="3794962">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3794965">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3795039">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3795113">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3795188">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3795239">func</span>&nbsp;<span class="ident" id="3795244">karatsubaLen</span><span class="op" id="3795256">(</span><span class="ident" id="3795257">n</span>&nbsp;<span class="builtintype" id="3795259">int</span><span class="op" id="3795262">)</span>&nbsp;<span class="builtintype" id="3795264">int</span>&nbsp;<span class="op" id="3795268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795271">i</span>&nbsp;<span class="op" id="3795273">:=</span>&nbsp;<span class="builtintype" id="3795276">uint</span><span class="op" id="3795280">(</span><span class="num" id="3795281">0</span><span class="op" id="3795282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795285">for</span>&nbsp;<span class="ident" id="3795289">n</span>&nbsp;<span class="op" id="3795291">&gt;</span>&nbsp;<span class="ident" id="3795293">karatsubaThreshold</span>&nbsp;<span class="op" id="3795312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795316">n</span>&nbsp;<span class="op" id="3795318">&gt;&gt;=</span>&nbsp;<span class="num" id="3795322">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795326">i</span><span class="op" id="3795327">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3795331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795334">return</span>&nbsp;<span class="ident" id="3795341">n</span>&nbsp;<span class="op" id="3795343">&lt;&lt;</span>&nbsp;<span class="ident" id="3795346">i</span><br>
<span class="lineno"></span><span class="op" id="3795348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795351">func</span>&nbsp;<span class="op" id="3795356">(</span><span class="ident" id="3795357">z</span>&nbsp;<span class="ident" id="3795359">nat</span><span class="op" id="3795362">)</span>&nbsp;<span class="ident" id="3795364">mul</span><span class="op" id="3795367">(</span><span class="ident" id="3795368">x</span><span class="op" id="3795369">,</span>&nbsp;<span class="ident" id="3795371">y</span>&nbsp;<span class="ident" id="3795373">nat</span><span class="op" id="3795376">)</span>&nbsp;<span class="ident" id="3795378">nat</span>&nbsp;<span class="op" id="3795382">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795385">m</span>&nbsp;<span class="op" id="3795387">:=</span>&nbsp;<span class="builtinfunc" id="3795390">len</span><span class="op" id="3795393">(</span><span class="ident" id="3795394">x</span><span class="op" id="3795395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795398">n</span>&nbsp;<span class="op" id="3795400">:=</span>&nbsp;<span class="builtinfunc" id="3795403">len</span><span class="op" id="3795406">(</span><span class="ident" id="3795407">y</span><span class="op" id="3795408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795412">switch</span>&nbsp;<span class="op" id="3795419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795422">case</span>&nbsp;<span class="ident" id="3795427">m</span>&nbsp;<span class="op" id="3795429">&lt;</span>&nbsp;<span class="ident" id="3795431">n</span><span class="op" id="3795432">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795436">return</span>&nbsp;<span class="ident" id="3795443">z</span><span class="op" id="3795444">.</span><span class="ident" id="3795445">mul</span><span class="op" id="3795448">(</span><span class="ident" id="3795449">y</span><span class="op" id="3795450">,</span>&nbsp;<span class="ident" id="3795452">x</span><span class="op" id="3795453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795456">case</span>&nbsp;<span class="ident" id="3795461">m</span>&nbsp;<span class="op" id="3795463">==</span>&nbsp;<span class="num" id="3795466">0</span>&nbsp;<span class="op" id="3795468">||</span>&nbsp;<span class="ident" id="3795471">n</span>&nbsp;<span class="op" id="3795473">==</span>&nbsp;<span class="num" id="3795476">0</span><span class="op" id="3795477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795481">return</span>&nbsp;<span class="ident" id="3795488">z</span><span class="op" id="3795489">.</span><span class="builtinfunc" id="3795490">make</span><span class="op" id="3795494">(</span><span class="num" id="3795495">0</span><span class="op" id="3795496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795499">case</span>&nbsp;<span class="ident" id="3795504">n</span>&nbsp;<span class="op" id="3795506">==</span>&nbsp;<span class="num" id="3795509">1</span><span class="op" id="3795510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795514">return</span>&nbsp;<span class="ident" id="3795521">z</span><span class="op" id="3795522">.</span><span class="ident" id="3795523">mulAddWW</span><span class="op" id="3795531">(</span><span class="ident" id="3795532">x</span><span class="op" id="3795533">,</span>&nbsp;<span class="ident" id="3795535">y</span><span class="op" id="3795536">[</span><span class="num" id="3795537">0</span><span class="op" id="3795538">]</span><span class="op" id="3795539">,</span>&nbsp;<span class="num" id="3795541">0</span><span class="op" id="3795542">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3795545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795548">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795564">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795597">if</span>&nbsp;<span class="ident" id="3795600">alias</span><span class="op" id="3795605">(</span><span class="ident" id="3795606">z</span><span class="op" id="3795607">,</span>&nbsp;<span class="ident" id="3795609">x</span><span class="op" id="3795610">)</span>&nbsp;<span class="op" id="3795612">||</span>&nbsp;<span class="ident" id="3795615">alias</span><span class="op" id="3795620">(</span><span class="ident" id="3795621">z</span><span class="op" id="3795622">,</span>&nbsp;<span class="ident" id="3795624">y</span><span class="op" id="3795625">)</span>&nbsp;<span class="op" id="3795627">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795631">z</span>&nbsp;<span class="op" id="3795633">=</span>&nbsp;<span class="ident" id="3795635">nil</span>&nbsp;<span class="comment" id="3795639">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3795683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795687">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795741">if</span>&nbsp;<span class="ident" id="3795744">n</span>&nbsp;<span class="op" id="3795746">&lt;</span>&nbsp;<span class="ident" id="3795748">karatsubaThreshold</span>&nbsp;<span class="op" id="3795767">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795771">z</span>&nbsp;<span class="op" id="3795773">=</span>&nbsp;<span class="ident" id="3795775">z</span><span class="op" id="3795776">.</span><span class="builtinfunc" id="3795777">make</span><span class="op" id="3795781">(</span><span class="ident" id="3795782">m</span>&nbsp;<span class="op" id="3795784">+</span>&nbsp;<span class="ident" id="3795786">n</span><span class="op" id="3795787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795791">basicMul</span><span class="op" id="3795799">(</span><span class="ident" id="3795800">z</span><span class="op" id="3795801">,</span>&nbsp;<span class="ident" id="3795803">x</span><span class="op" id="3795804">,</span>&nbsp;<span class="ident" id="3795806">y</span><span class="op" id="3795807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795811">return</span>&nbsp;<span class="ident" id="3795818">z</span><span class="op" id="3795819">.</span><span class="ident" id="3795820">norm</span><span class="op" id="3795824">(</span><span class="op" id="3795825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3795828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795831">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795880">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795923">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795927">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795962">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795997">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796044">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796048">k</span>&nbsp;<span class="op" id="3796050">:=</span>&nbsp;<span class="ident" id="3796053">karatsubaLen</span><span class="op" id="3796065">(</span><span class="ident" id="3796066">n</span><span class="op" id="3796067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796070">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796082">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796119">x0</span>&nbsp;<span class="op" id="3796122">:=</span>&nbsp;<span class="ident" id="3796125">x</span><span class="op" id="3796126">[</span><span class="num" id="3796127">0</span><span class="op" id="3796128">:</span><span class="ident" id="3796129">k</span><span class="op" id="3796130">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796145">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796170">y0</span>&nbsp;<span class="op" id="3796173">:=</span>&nbsp;<span class="ident" id="3796176">y</span><span class="op" id="3796177">[</span><span class="num" id="3796178">0</span><span class="op" id="3796179">:</span><span class="ident" id="3796180">k</span><span class="op" id="3796181">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796196">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796221">z</span>&nbsp;<span class="op" id="3796223">=</span>&nbsp;<span class="ident" id="3796225">z</span><span class="op" id="3796226">.</span><span class="builtinfunc" id="3796227">make</span><span class="op" id="3796231">(</span><span class="ident" id="3796232">max</span><span class="op" id="3796235">(</span><span class="num" id="3796236">6</span><span class="op" id="3796237">*</span><span class="ident" id="3796238">k</span><span class="op" id="3796239">,</span>&nbsp;<span class="ident" id="3796241">m</span><span class="op" id="3796242">+</span><span class="ident" id="3796243">n</span><span class="op" id="3796244">)</span><span class="op" id="3796245">)</span>&nbsp;<span class="comment" id="3796247">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796310">karatsuba</span><span class="op" id="3796319">(</span><span class="ident" id="3796320">z</span><span class="op" id="3796321">,</span>&nbsp;<span class="ident" id="3796323">x0</span><span class="op" id="3796325">,</span>&nbsp;<span class="ident" id="3796327">y0</span><span class="op" id="3796329">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796332">z</span>&nbsp;<span class="op" id="3796334">=</span>&nbsp;<span class="ident" id="3796336">z</span><span class="op" id="3796337">[</span><span class="num" id="3796338">0</span>&nbsp;<span class="op" id="3796340">:</span>&nbsp;<span class="ident" id="3796342">m</span><span class="op" id="3796343">+</span><span class="ident" id="3796344">n</span><span class="op" id="3796345">]</span>&nbsp;&nbsp;<span class="comment" id="3796348">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796393">z</span><span class="op" id="3796394">[</span><span class="num" id="3796395">2</span><span class="op" id="3796396">*</span><span class="ident" id="3796397">k</span><span class="op" id="3796398">:</span><span class="op" id="3796399">]</span><span class="op" id="3796400">.</span><span class="ident" id="3796401">clear</span><span class="op" id="3796406">(</span><span class="op" id="3796407">)</span>&nbsp;<span class="comment" id="3796409">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796479">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796538">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796542">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796596">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796650">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796654">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796680">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796684">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796737">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796741">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796809">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796877">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796947">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796951">if</span>&nbsp;<span class="ident" id="3796954">k</span>&nbsp;<span class="op" id="3796956">&lt;</span>&nbsp;<span class="ident" id="3796958">n</span>&nbsp;<span class="op" id="3796960">||</span>&nbsp;<span class="ident" id="3796963">m</span>&nbsp;<span class="op" id="3796965">!=</span>&nbsp;<span class="ident" id="3796968">n</span>&nbsp;<span class="op" id="3796970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796974">var</span>&nbsp;<span class="ident" id="3796978">t</span>&nbsp;<span class="ident" id="3796980">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796987">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797004">x0</span>&nbsp;<span class="op" id="3797007">:=</span>&nbsp;<span class="ident" id="3797010">x0</span><span class="op" id="3797012">.</span><span class="ident" id="3797013">norm</span><span class="op" id="3797017">(</span><span class="op" id="3797018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797022">y1</span>&nbsp;<span class="op" id="3797025">:=</span>&nbsp;<span class="ident" id="3797028">y</span><span class="op" id="3797029">[</span><span class="ident" id="3797030">k</span><span class="op" id="3797031">:</span><span class="op" id="3797032">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797040">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797075">t</span>&nbsp;<span class="op" id="3797077">=</span>&nbsp;<span class="ident" id="3797079">t</span><span class="op" id="3797080">.</span><span class="ident" id="3797081">mul</span><span class="op" id="3797084">(</span><span class="ident" id="3797085">x0</span><span class="op" id="3797087">,</span>&nbsp;<span class="ident" id="3797089">y1</span><span class="op" id="3797091">)</span>&nbsp;<span class="comment" id="3797093">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797145">addAt</span><span class="op" id="3797150">(</span><span class="ident" id="3797151">z</span><span class="op" id="3797152">,</span>&nbsp;<span class="ident" id="3797154">t</span><span class="op" id="3797155">,</span>&nbsp;<span class="ident" id="3797157">k</span><span class="op" id="3797158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797163">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797197">y0</span>&nbsp;<span class="op" id="3797200">:=</span>&nbsp;<span class="ident" id="3797203">y0</span><span class="op" id="3797205">.</span><span class="ident" id="3797206">norm</span><span class="op" id="3797210">(</span><span class="op" id="3797211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797215">for</span>&nbsp;<span class="ident" id="3797219">i</span>&nbsp;<span class="op" id="3797221">:=</span>&nbsp;<span class="ident" id="3797224">k</span><span class="op" id="3797225">;</span>&nbsp;<span class="ident" id="3797227">i</span>&nbsp;<span class="op" id="3797229">&lt;</span>&nbsp;<span class="builtinfunc" id="3797231">len</span><span class="op" id="3797234">(</span><span class="ident" id="3797235">x</span><span class="op" id="3797236">)</span><span class="op" id="3797237">;</span>&nbsp;<span class="ident" id="3797239">i</span>&nbsp;<span class="op" id="3797241">+=</span>&nbsp;<span class="ident" id="3797244">k</span>&nbsp;<span class="op" id="3797246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797251">xi</span>&nbsp;<span class="op" id="3797254">:=</span>&nbsp;<span class="ident" id="3797257">x</span><span class="op" id="3797258">[</span><span class="ident" id="3797259">i</span><span class="op" id="3797260">:</span><span class="op" id="3797261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797266">if</span>&nbsp;<span class="builtinfunc" id="3797269">len</span><span class="op" id="3797272">(</span><span class="ident" id="3797273">xi</span><span class="op" id="3797275">)</span>&nbsp;<span class="op" id="3797277">&gt;</span>&nbsp;<span class="ident" id="3797279">k</span>&nbsp;<span class="op" id="3797281">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797287">xi</span>&nbsp;<span class="op" id="3797290">=</span>&nbsp;<span class="ident" id="3797292">xi</span><span class="op" id="3797294">[</span><span class="op" id="3797295">:</span><span class="ident" id="3797296">k</span><span class="op" id="3797297">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797307">xi</span>&nbsp;<span class="op" id="3797310">=</span>&nbsp;<span class="ident" id="3797312">xi</span><span class="op" id="3797314">.</span><span class="ident" id="3797315">norm</span><span class="op" id="3797319">(</span><span class="op" id="3797320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797325">t</span>&nbsp;<span class="op" id="3797327">=</span>&nbsp;<span class="ident" id="3797329">t</span><span class="op" id="3797330">.</span><span class="ident" id="3797331">mul</span><span class="op" id="3797334">(</span><span class="ident" id="3797335">xi</span><span class="op" id="3797337">,</span>&nbsp;<span class="ident" id="3797339">y0</span><span class="op" id="3797341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797346">addAt</span><span class="op" id="3797351">(</span><span class="ident" id="3797352">z</span><span class="op" id="3797353">,</span>&nbsp;<span class="ident" id="3797355">t</span><span class="op" id="3797356">,</span>&nbsp;<span class="ident" id="3797358">i</span><span class="op" id="3797359">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797364">t</span>&nbsp;<span class="op" id="3797366">=</span>&nbsp;<span class="ident" id="3797368">t</span><span class="op" id="3797369">.</span><span class="ident" id="3797370">mul</span><span class="op" id="3797373">(</span><span class="ident" id="3797374">xi</span><span class="op" id="3797376">,</span>&nbsp;<span class="ident" id="3797378">y1</span><span class="op" id="3797380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797385">addAt</span><span class="op" id="3797390">(</span><span class="ident" id="3797391">z</span><span class="op" id="3797392">,</span>&nbsp;<span class="ident" id="3797394">t</span><span class="op" id="3797395">,</span>&nbsp;<span class="ident" id="3797397">i</span><span class="op" id="3797398">+</span><span class="ident" id="3797399">k</span><span class="op" id="3797400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797411">return</span>&nbsp;<span class="ident" id="3797418">z</span><span class="op" id="3797419">.</span><span class="ident" id="3797420">norm</span><span class="op" id="3797424">(</span><span class="op" id="3797425">)</span><br>
<span class="lineno"></span><span class="op" id="3797427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3797430">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3797499">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3797569">func</span>&nbsp;<span class="op" id="3797574">(</span><span class="ident" id="3797575">z</span>&nbsp;<span class="ident" id="3797577">nat</span><span class="op" id="3797580">)</span>&nbsp;<span class="ident" id="3797582">mulRange</span><span class="op" id="3797590">(</span><span class="ident" id="3797591">a</span><span class="op" id="3797592">,</span>&nbsp;<span class="ident" id="3797594">b</span>&nbsp;<span class="ident" id="3797596">uint64</span><span class="op" id="3797602">)</span>&nbsp;<span class="ident" id="3797604">nat</span>&nbsp;<span class="op" id="3797608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797611">switch</span>&nbsp;<span class="op" id="3797618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797621">case</span>&nbsp;<span class="ident" id="3797626">a</span>&nbsp;<span class="op" id="3797628">==</span>&nbsp;<span class="num" id="3797631">0</span><span class="op" id="3797632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797636">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797678">return</span>&nbsp;<span class="ident" id="3797685">z</span><span class="op" id="3797686">.</span><span class="ident" id="3797687">setUint64</span><span class="op" id="3797696">(</span><span class="num" id="3797697">0</span><span class="op" id="3797698">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797701">case</span>&nbsp;<span class="ident" id="3797706">a</span>&nbsp;<span class="op" id="3797708">&gt;</span>&nbsp;<span class="ident" id="3797710">b</span><span class="op" id="3797711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797715">return</span>&nbsp;<span class="ident" id="3797722">z</span><span class="op" id="3797723">.</span><span class="ident" id="3797724">setUint64</span><span class="op" id="3797733">(</span><span class="num" id="3797734">1</span><span class="op" id="3797735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797738">case</span>&nbsp;<span class="ident" id="3797743">a</span>&nbsp;<span class="op" id="3797745">==</span>&nbsp;<span class="ident" id="3797748">b</span><span class="op" id="3797749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797753">return</span>&nbsp;<span class="ident" id="3797760">z</span><span class="op" id="3797761">.</span><span class="ident" id="3797762">setUint64</span><span class="op" id="3797771">(</span><span class="ident" id="3797772">a</span><span class="op" id="3797773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797776">case</span>&nbsp;<span class="ident" id="3797781">a</span><span class="op" id="3797782">+</span><span class="num" id="3797783">1</span>&nbsp;<span class="op" id="3797785">==</span>&nbsp;<span class="ident" id="3797788">b</span><span class="op" id="3797789">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797793">return</span>&nbsp;<span class="ident" id="3797800">z</span><span class="op" id="3797801">.</span><span class="ident" id="3797802">mul</span><span class="op" id="3797805">(</span><span class="ident" id="3797806">nat</span><span class="op" id="3797809">(</span><span class="ident" id="3797810">nil</span><span class="op" id="3797813">)</span><span class="op" id="3797814">.</span><span class="ident" id="3797815">setUint64</span><span class="op" id="3797824">(</span><span class="ident" id="3797825">a</span><span class="op" id="3797826">)</span><span class="op" id="3797827">,</span>&nbsp;<span class="ident" id="3797829">nat</span><span class="op" id="3797832">(</span><span class="ident" id="3797833">nil</span><span class="op" id="3797836">)</span><span class="op" id="3797837">.</span><span class="ident" id="3797838">setUint64</span><span class="op" id="3797847">(</span><span class="ident" id="3797848">b</span><span class="op" id="3797849">)</span><span class="op" id="3797850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797856">m</span>&nbsp;<span class="op" id="3797858">:=</span>&nbsp;<span class="op" id="3797861">(</span><span class="ident" id="3797862">a</span>&nbsp;<span class="op" id="3797864">+</span>&nbsp;<span class="ident" id="3797866">b</span><span class="op" id="3797867">)</span>&nbsp;<span class="op" id="3797869">/</span>&nbsp;<span class="num" id="3797871">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797874">return</span>&nbsp;<span class="ident" id="3797881">z</span><span class="op" id="3797882">.</span><span class="ident" id="3797883">mul</span><span class="op" id="3797886">(</span><span class="ident" id="3797887">nat</span><span class="op" id="3797890">(</span><span class="ident" id="3797891">nil</span><span class="op" id="3797894">)</span><span class="op" id="3797895">.</span><span class="ident" id="3797896">mulRange</span><span class="op" id="3797904">(</span><span class="ident" id="3797905">a</span><span class="op" id="3797906">,</span>&nbsp;<span class="ident" id="3797908">m</span><span class="op" id="3797909">)</span><span class="op" id="3797910">,</span>&nbsp;<span class="ident" id="3797912">nat</span><span class="op" id="3797915">(</span><span class="ident" id="3797916">nil</span><span class="op" id="3797919">)</span><span class="op" id="3797920">.</span><span class="ident" id="3797921">mulRange</span><span class="op" id="3797929">(</span><span class="ident" id="3797930">m</span><span class="op" id="3797931">+</span><span class="num" id="3797932">1</span><span class="op" id="3797933">,</span>&nbsp;<span class="ident" id="3797935">b</span><span class="op" id="3797936">)</span><span class="op" id="3797937">)</span><br>
<span class="lineno"></span><span class="op" id="3797939">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3797942">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3797974">func</span>&nbsp;<span class="op" id="3797979">(</span><span class="ident" id="3797980">z</span>&nbsp;<span class="ident" id="3797982">nat</span><span class="op" id="3797985">)</span>&nbsp;<span class="ident" id="3797987">divW</span><span class="op" id="3797991">(</span><span class="ident" id="3797992">x</span>&nbsp;<span class="ident" id="3797994">nat</span><span class="op" id="3797997">,</span>&nbsp;<span class="ident" id="3797999">y</span>&nbsp;<span class="ident" id="3798001">Word</span><span class="op" id="3798005">)</span>&nbsp;<span class="op" id="3798007">(</span><span class="ident" id="3798008">q</span>&nbsp;<span class="ident" id="3798010">nat</span><span class="op" id="3798013">,</span>&nbsp;<span class="ident" id="3798015">r</span>&nbsp;<span class="ident" id="3798017">Word</span><span class="op" id="3798021">)</span>&nbsp;<span class="op" id="3798023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798026">m</span>&nbsp;<span class="op" id="3798028">:=</span>&nbsp;<span class="builtinfunc" id="3798031">len</span><span class="op" id="3798034">(</span><span class="ident" id="3798035">x</span><span class="op" id="3798036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798039">switch</span>&nbsp;<span class="op" id="3798046">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798049">case</span>&nbsp;<span class="ident" id="3798054">y</span>&nbsp;<span class="op" id="3798056">==</span>&nbsp;<span class="num" id="3798059">0</span><span class="op" id="3798060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3798064">panic</span><span class="op" id="3798069">(</span><span class="string" id="3798070">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3798088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798091">case</span>&nbsp;<span class="ident" id="3798096">y</span>&nbsp;<span class="op" id="3798098">==</span>&nbsp;<span class="num" id="3798101">1</span><span class="op" id="3798102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798106">q</span>&nbsp;<span class="op" id="3798108">=</span>&nbsp;<span class="ident" id="3798110">z</span><span class="op" id="3798111">.</span><span class="ident" id="3798112">set</span><span class="op" id="3798115">(</span><span class="ident" id="3798116">x</span><span class="op" id="3798117">)</span>&nbsp;<span class="comment" id="3798119">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798136">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798144">case</span>&nbsp;<span class="ident" id="3798149">m</span>&nbsp;<span class="op" id="3798151">==</span>&nbsp;<span class="num" id="3798154">0</span><span class="op" id="3798155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798159">q</span>&nbsp;<span class="op" id="3798161">=</span>&nbsp;<span class="ident" id="3798163">z</span><span class="op" id="3798164">.</span><span class="builtinfunc" id="3798165">make</span><span class="op" id="3798169">(</span><span class="num" id="3798170">0</span><span class="op" id="3798171">)</span>&nbsp;<span class="comment" id="3798173">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798190">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798201">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798211">z</span>&nbsp;<span class="op" id="3798213">=</span>&nbsp;<span class="ident" id="3798215">z</span><span class="op" id="3798216">.</span><span class="builtinfunc" id="3798217">make</span><span class="op" id="3798221">(</span><span class="ident" id="3798222">m</span><span class="op" id="3798223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798226">r</span>&nbsp;<span class="op" id="3798228">=</span>&nbsp;<span class="ident" id="3798230">divWVW</span><span class="op" id="3798236">(</span><span class="ident" id="3798237">z</span><span class="op" id="3798238">,</span>&nbsp;<span class="num" id="3798240">0</span><span class="op" id="3798241">,</span>&nbsp;<span class="ident" id="3798243">x</span><span class="op" id="3798244">,</span>&nbsp;<span class="ident" id="3798246">y</span><span class="op" id="3798247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798250">q</span>&nbsp;<span class="op" id="3798252">=</span>&nbsp;<span class="ident" id="3798254">z</span><span class="op" id="3798255">.</span><span class="ident" id="3798256">norm</span><span class="op" id="3798260">(</span><span class="op" id="3798261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798264">return</span><br>
<span class="lineno"></span><span class="op" id="3798271">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3798274">func</span>&nbsp;<span class="op" id="3798279">(</span><span class="ident" id="3798280">z</span>&nbsp;<span class="ident" id="3798282">nat</span><span class="op" id="3798285">)</span>&nbsp;<span class="ident" id="3798287">div</span><span class="op" id="3798290">(</span><span class="ident" id="3798291">z2</span><span class="op" id="3798293">,</span>&nbsp;<span class="ident" id="3798295">u</span><span class="op" id="3798296">,</span>&nbsp;<span class="ident" id="3798298">v</span>&nbsp;<span class="ident" id="3798300">nat</span><span class="op" id="3798303">)</span>&nbsp;<span class="op" id="3798305">(</span><span class="ident" id="3798306">q</span><span class="op" id="3798307">,</span>&nbsp;<span class="ident" id="3798309">r</span>&nbsp;<span class="ident" id="3798311">nat</span><span class="op" id="3798314">)</span>&nbsp;<span class="op" id="3798316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798319">if</span>&nbsp;<span class="builtinfunc" id="3798322">len</span><span class="op" id="3798325">(</span><span class="ident" id="3798326">v</span><span class="op" id="3798327">)</span>&nbsp;<span class="op" id="3798329">==</span>&nbsp;<span class="num" id="3798332">0</span>&nbsp;<span class="op" id="3798334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3798338">panic</span><span class="op" id="3798343">(</span><span class="string" id="3798344">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3798362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798365">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798369">if</span>&nbsp;<span class="ident" id="3798372">u</span><span class="op" id="3798373">.</span><span class="ident" id="3798374">cmp</span><span class="op" id="3798377">(</span><span class="ident" id="3798378">v</span><span class="op" id="3798379">)</span>&nbsp;<span class="op" id="3798381">&lt;</span>&nbsp;<span class="num" id="3798383">0</span>&nbsp;<span class="op" id="3798385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798389">q</span>&nbsp;<span class="op" id="3798391">=</span>&nbsp;<span class="ident" id="3798393">z</span><span class="op" id="3798394">.</span><span class="builtinfunc" id="3798395">make</span><span class="op" id="3798399">(</span><span class="num" id="3798400">0</span><span class="op" id="3798401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798405">r</span>&nbsp;<span class="op" id="3798407">=</span>&nbsp;<span class="ident" id="3798409">z2</span><span class="op" id="3798411">.</span><span class="ident" id="3798412">set</span><span class="op" id="3798415">(</span><span class="ident" id="3798416">u</span><span class="op" id="3798417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798421">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798433">if</span>&nbsp;<span class="builtinfunc" id="3798436">len</span><span class="op" id="3798439">(</span><span class="ident" id="3798440">v</span><span class="op" id="3798441">)</span>&nbsp;<span class="op" id="3798443">==</span>&nbsp;<span class="num" id="3798446">1</span>&nbsp;<span class="op" id="3798448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798452">var</span>&nbsp;<span class="ident" id="3798456">r2</span>&nbsp;<span class="ident" id="3798459">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798466">q</span><span class="op" id="3798467">,</span>&nbsp;<span class="ident" id="3798469">r2</span>&nbsp;<span class="op" id="3798472">=</span>&nbsp;<span class="ident" id="3798474">z</span><span class="op" id="3798475">.</span><span class="ident" id="3798476">divW</span><span class="op" id="3798480">(</span><span class="ident" id="3798481">u</span><span class="op" id="3798482">,</span>&nbsp;<span class="ident" id="3798484">v</span><span class="op" id="3798485">[</span><span class="num" id="3798486">0</span><span class="op" id="3798487">]</span><span class="op" id="3798488">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798492">r</span>&nbsp;<span class="op" id="3798494">=</span>&nbsp;<span class="ident" id="3798496">z2</span><span class="op" id="3798498">.</span><span class="ident" id="3798499">setWord</span><span class="op" id="3798506">(</span><span class="ident" id="3798507">r2</span><span class="op" id="3798509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798513">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798525">q</span><span class="op" id="3798526">,</span>&nbsp;<span class="ident" id="3798528">r</span>&nbsp;<span class="op" id="3798530">=</span>&nbsp;<span class="ident" id="3798532">z</span><span class="op" id="3798533">.</span><span class="ident" id="3798534">divLarge</span><span class="op" id="3798542">(</span><span class="ident" id="3798543">z2</span><span class="op" id="3798545">,</span>&nbsp;<span class="ident" id="3798547">u</span><span class="op" id="3798548">,</span>&nbsp;<span class="ident" id="3798550">v</span><span class="op" id="3798551">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798554">return</span><br>
<span class="lineno"></span><span class="op" id="3798561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3798564">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3798598">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3798662">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3798714">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3798732">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3798750">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3798775">func</span>&nbsp;<span class="op" id="3798780">(</span><span class="ident" id="3798781">z</span>&nbsp;<span class="ident" id="3798783">nat</span><span class="op" id="3798786">)</span>&nbsp;<span class="ident" id="3798788">divLarge</span><span class="op" id="3798796">(</span><span class="ident" id="3798797">u</span><span class="op" id="3798798">,</span>&nbsp;<span class="ident" id="3798800">uIn</span><span class="op" id="3798803">,</span>&nbsp;<span class="ident" id="3798805">v</span>&nbsp;<span class="ident" id="3798807">nat</span><span class="op" id="3798810">)</span>&nbsp;<span class="op" id="3798812">(</span><span class="ident" id="3798813">q</span><span class="op" id="3798814">,</span>&nbsp;<span class="ident" id="3798816">r</span>&nbsp;<span class="ident" id="3798818">nat</span><span class="op" id="3798821">)</span>&nbsp;<span class="op" id="3798823">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798826">n</span>&nbsp;<span class="op" id="3798828">:=</span>&nbsp;<span class="builtinfunc" id="3798831">len</span><span class="op" id="3798834">(</span><span class="ident" id="3798835">v</span><span class="op" id="3798836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798839">m</span>&nbsp;<span class="op" id="3798841">:=</span>&nbsp;<span class="builtinfunc" id="3798844">len</span><span class="op" id="3798847">(</span><span class="ident" id="3798848">uIn</span><span class="op" id="3798851">)</span>&nbsp;<span class="op" id="3798853">-</span>&nbsp;<span class="ident" id="3798855">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798859">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798892">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799022">if</span>&nbsp;<span class="ident" id="3799025">alias</span><span class="op" id="3799030">(</span><span class="ident" id="3799031">z</span><span class="op" id="3799032">,</span>&nbsp;<span class="ident" id="3799034">uIn</span><span class="op" id="3799037">)</span>&nbsp;<span class="op" id="3799039">||</span>&nbsp;<span class="ident" id="3799042">alias</span><span class="op" id="3799047">(</span><span class="ident" id="3799048">z</span><span class="op" id="3799049">,</span>&nbsp;<span class="ident" id="3799051">v</span><span class="op" id="3799052">)</span>&nbsp;<span class="op" id="3799054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799058">z</span>&nbsp;<span class="op" id="3799060">=</span>&nbsp;<span class="ident" id="3799062">nil</span>&nbsp;<span class="comment" id="3799066">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799115">q</span>&nbsp;<span class="op" id="3799117">=</span>&nbsp;<span class="ident" id="3799119">z</span><span class="op" id="3799120">.</span><span class="builtinfunc" id="3799121">make</span><span class="op" id="3799125">(</span><span class="ident" id="3799126">m</span>&nbsp;<span class="op" id="3799128">+</span>&nbsp;<span class="num" id="3799130">1</span><span class="op" id="3799131">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799135">qhatv</span>&nbsp;<span class="op" id="3799141">:=</span>&nbsp;<span class="builtinfunc" id="3799144">make</span><span class="op" id="3799148">(</span><span class="ident" id="3799149">nat</span><span class="op" id="3799152">,</span>&nbsp;<span class="ident" id="3799154">n</span><span class="op" id="3799155">+</span><span class="num" id="3799156">1</span><span class="op" id="3799157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799160">if</span>&nbsp;<span class="ident" id="3799163">alias</span><span class="op" id="3799168">(</span><span class="ident" id="3799169">u</span><span class="op" id="3799170">,</span>&nbsp;<span class="ident" id="3799172">uIn</span><span class="op" id="3799175">)</span>&nbsp;<span class="op" id="3799177">||</span>&nbsp;<span class="ident" id="3799180">alias</span><span class="op" id="3799185">(</span><span class="ident" id="3799186">u</span><span class="op" id="3799187">,</span>&nbsp;<span class="ident" id="3799189">v</span><span class="op" id="3799190">)</span>&nbsp;<span class="op" id="3799192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799196">u</span>&nbsp;<span class="op" id="3799198">=</span>&nbsp;<span class="ident" id="3799200">nil</span>&nbsp;<span class="comment" id="3799204">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799250">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799253">u</span>&nbsp;<span class="op" id="3799255">=</span>&nbsp;<span class="ident" id="3799257">u</span><span class="op" id="3799258">.</span><span class="builtinfunc" id="3799259">make</span><span class="op" id="3799263">(</span><span class="builtinfunc" id="3799264">len</span><span class="op" id="3799267">(</span><span class="ident" id="3799268">uIn</span><span class="op" id="3799271">)</span>&nbsp;<span class="op" id="3799273">+</span>&nbsp;<span class="num" id="3799275">1</span><span class="op" id="3799276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799279">u</span><span class="op" id="3799280">.</span><span class="ident" id="3799281">clear</span><span class="op" id="3799286">(</span><span class="op" id="3799287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799291">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799299">shift</span>&nbsp;<span class="op" id="3799305">:=</span>&nbsp;<span class="ident" id="3799308">leadingZeros</span><span class="op" id="3799320">(</span><span class="ident" id="3799321">v</span><span class="op" id="3799322">[</span><span class="ident" id="3799323">n</span><span class="op" id="3799324">-</span><span class="num" id="3799325">1</span><span class="op" id="3799326">]</span><span class="op" id="3799327">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799330">if</span>&nbsp;<span class="ident" id="3799333">shift</span>&nbsp;<span class="op" id="3799339">&gt;</span>&nbsp;<span class="num" id="3799341">0</span>&nbsp;<span class="op" id="3799343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799347">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799420">v1</span>&nbsp;<span class="op" id="3799423">:=</span>&nbsp;<span class="builtinfunc" id="3799426">make</span><span class="op" id="3799430">(</span><span class="ident" id="3799431">nat</span><span class="op" id="3799434">,</span>&nbsp;<span class="ident" id="3799436">n</span><span class="op" id="3799437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799441">shlVU</span><span class="op" id="3799446">(</span><span class="ident" id="3799447">v1</span><span class="op" id="3799449">,</span>&nbsp;<span class="ident" id="3799451">v</span><span class="op" id="3799452">,</span>&nbsp;<span class="ident" id="3799454">shift</span><span class="op" id="3799459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799463">v</span>&nbsp;<span class="op" id="3799465">=</span>&nbsp;<span class="ident" id="3799467">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799474">u</span><span class="op" id="3799475">[</span><span class="builtinfunc" id="3799476">len</span><span class="op" id="3799479">(</span><span class="ident" id="3799480">uIn</span><span class="op" id="3799483">)</span><span class="op" id="3799484">]</span>&nbsp;<span class="op" id="3799486">=</span>&nbsp;<span class="ident" id="3799488">shlVU</span><span class="op" id="3799493">(</span><span class="ident" id="3799494">u</span><span class="op" id="3799495">[</span><span class="num" id="3799496">0</span><span class="op" id="3799497">:</span><span class="builtinfunc" id="3799498">len</span><span class="op" id="3799501">(</span><span class="ident" id="3799502">uIn</span><span class="op" id="3799505">)</span><span class="op" id="3799506">]</span><span class="op" id="3799507">,</span>&nbsp;<span class="ident" id="3799509">uIn</span><span class="op" id="3799512">,</span>&nbsp;<span class="ident" id="3799514">shift</span><span class="op" id="3799519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799523">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799531">for</span>&nbsp;<span class="ident" id="3799535">j</span>&nbsp;<span class="op" id="3799537">:=</span>&nbsp;<span class="ident" id="3799540">m</span><span class="op" id="3799541">;</span>&nbsp;<span class="ident" id="3799543">j</span>&nbsp;<span class="op" id="3799545">&gt;=</span>&nbsp;<span class="num" id="3799548">0</span><span class="op" id="3799549">;</span>&nbsp;<span class="ident" id="3799551">j</span><span class="op" id="3799552">--</span>&nbsp;<span class="op" id="3799555">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799559">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799568">qhat</span>&nbsp;<span class="op" id="3799573">:=</span>&nbsp;<span class="ident" id="3799576">Word</span><span class="op" id="3799580">(</span><span class="ident" id="3799581">_M</span><span class="op" id="3799583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799587">if</span>&nbsp;<span class="ident" id="3799590">u</span><span class="op" id="3799591">[</span><span class="ident" id="3799592">j</span><span class="op" id="3799593">+</span><span class="ident" id="3799594">n</span><span class="op" id="3799595">]</span>&nbsp;<span class="op" id="3799597">!=</span>&nbsp;<span class="ident" id="3799600">v</span><span class="op" id="3799601">[</span><span class="ident" id="3799602">n</span><span class="op" id="3799603">-</span><span class="num" id="3799604">1</span><span class="op" id="3799605">]</span>&nbsp;<span class="op" id="3799607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799612">var</span>&nbsp;<span class="ident" id="3799616">rhat</span>&nbsp;<span class="ident" id="3799621">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799629">qhat</span><span class="op" id="3799633">,</span>&nbsp;<span class="ident" id="3799635">rhat</span>&nbsp;<span class="op" id="3799640">=</span>&nbsp;<span class="ident" id="3799642">divWW</span><span class="op" id="3799647">(</span><span class="ident" id="3799648">u</span><span class="op" id="3799649">[</span><span class="ident" id="3799650">j</span><span class="op" id="3799651">+</span><span class="ident" id="3799652">n</span><span class="op" id="3799653">]</span><span class="op" id="3799654">,</span>&nbsp;<span class="ident" id="3799656">u</span><span class="op" id="3799657">[</span><span class="ident" id="3799658">j</span><span class="op" id="3799659">+</span><span class="ident" id="3799660">n</span><span class="op" id="3799661">-</span><span class="num" id="3799662">1</span><span class="op" id="3799663">]</span><span class="op" id="3799664">,</span>&nbsp;<span class="ident" id="3799666">v</span><span class="op" id="3799667">[</span><span class="ident" id="3799668">n</span><span class="op" id="3799669">-</span><span class="num" id="3799670">1</span><span class="op" id="3799671">]</span><span class="op" id="3799672">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799678">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799705">x1</span><span class="op" id="3799707">,</span>&nbsp;<span class="ident" id="3799709">x2</span>&nbsp;<span class="op" id="3799712">:=</span>&nbsp;<span class="ident" id="3799715">mulWW</span><span class="op" id="3799720">(</span><span class="ident" id="3799721">qhat</span><span class="op" id="3799725">,</span>&nbsp;<span class="ident" id="3799727">v</span><span class="op" id="3799728">[</span><span class="ident" id="3799729">n</span><span class="op" id="3799730">-</span><span class="num" id="3799731">2</span><span class="op" id="3799732">]</span><span class="op" id="3799733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799738">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799782">for</span>&nbsp;<span class="ident" id="3799786">greaterThan</span><span class="op" id="3799797">(</span><span class="ident" id="3799798">x1</span><span class="op" id="3799800">,</span>&nbsp;<span class="ident" id="3799802">x2</span><span class="op" id="3799804">,</span>&nbsp;<span class="ident" id="3799806">rhat</span><span class="op" id="3799810">,</span>&nbsp;<span class="ident" id="3799812">u</span><span class="op" id="3799813">[</span><span class="ident" id="3799814">j</span><span class="op" id="3799815">+</span><span class="ident" id="3799816">n</span><span class="op" id="3799817">-</span><span class="num" id="3799818">2</span><span class="op" id="3799819">]</span><span class="op" id="3799820">)</span>&nbsp;<span class="op" id="3799822">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799828">qhat</span><span class="op" id="3799832">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799839">prevRhat</span>&nbsp;<span class="op" id="3799848">:=</span>&nbsp;<span class="ident" id="3799851">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799860">rhat</span>&nbsp;<span class="op" id="3799865">+=</span>&nbsp;<span class="ident" id="3799868">v</span><span class="op" id="3799869">[</span><span class="ident" id="3799870">n</span><span class="op" id="3799871">-</span><span class="num" id="3799872">1</span><span class="op" id="3799873">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799879">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799927">if</span>&nbsp;<span class="ident" id="3799930">rhat</span>&nbsp;<span class="op" id="3799935">&lt;</span>&nbsp;<span class="ident" id="3799937">prevRhat</span>&nbsp;<span class="op" id="3799946">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799953">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799969">x1</span><span class="op" id="3799971">,</span>&nbsp;<span class="ident" id="3799973">x2</span>&nbsp;<span class="op" id="3799976">=</span>&nbsp;<span class="ident" id="3799978">mulWW</span><span class="op" id="3799983">(</span><span class="ident" id="3799984">qhat</span><span class="op" id="3799988">,</span>&nbsp;<span class="ident" id="3799990">v</span><span class="op" id="3799991">[</span><span class="ident" id="3799992">n</span><span class="op" id="3799993">-</span><span class="num" id="3799994">2</span><span class="op" id="3799995">]</span><span class="op" id="3799996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800005">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3800010">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800019">qhatv</span><span class="op" id="3800024">[</span><span class="ident" id="3800025">n</span><span class="op" id="3800026">]</span>&nbsp;<span class="op" id="3800028">=</span>&nbsp;<span class="ident" id="3800030">mulAddVWW</span><span class="op" id="3800039">(</span><span class="ident" id="3800040">qhatv</span><span class="op" id="3800045">[</span><span class="num" id="3800046">0</span><span class="op" id="3800047">:</span><span class="ident" id="3800048">n</span><span class="op" id="3800049">]</span><span class="op" id="3800050">,</span>&nbsp;<span class="ident" id="3800052">v</span><span class="op" id="3800053">,</span>&nbsp;<span class="ident" id="3800055">qhat</span><span class="op" id="3800059">,</span>&nbsp;<span class="num" id="3800061">0</span><span class="op" id="3800062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800067">c</span>&nbsp;<span class="op" id="3800069">:=</span>&nbsp;<span class="ident" id="3800072">subVV</span><span class="op" id="3800077">(</span><span class="ident" id="3800078">u</span><span class="op" id="3800079">[</span><span class="ident" id="3800080">j</span><span class="op" id="3800081">:</span><span class="ident" id="3800082">j</span><span class="op" id="3800083">+</span><span class="builtinfunc" id="3800084">len</span><span class="op" id="3800087">(</span><span class="ident" id="3800088">qhatv</span><span class="op" id="3800093">)</span><span class="op" id="3800094">]</span><span class="op" id="3800095">,</span>&nbsp;<span class="ident" id="3800097">u</span><span class="op" id="3800098">[</span><span class="ident" id="3800099">j</span><span class="op" id="3800100">:</span><span class="op" id="3800101">]</span><span class="op" id="3800102">,</span>&nbsp;<span class="ident" id="3800104">qhatv</span><span class="op" id="3800109">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800113">if</span>&nbsp;<span class="ident" id="3800116">c</span>&nbsp;<span class="op" id="3800118">!=</span>&nbsp;<span class="num" id="3800121">0</span>&nbsp;<span class="op" id="3800123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800128">c</span>&nbsp;<span class="op" id="3800130">:=</span>&nbsp;<span class="ident" id="3800133">addVV</span><span class="op" id="3800138">(</span><span class="ident" id="3800139">u</span><span class="op" id="3800140">[</span><span class="ident" id="3800141">j</span><span class="op" id="3800142">:</span><span class="ident" id="3800143">j</span><span class="op" id="3800144">+</span><span class="ident" id="3800145">n</span><span class="op" id="3800146">]</span><span class="op" id="3800147">,</span>&nbsp;<span class="ident" id="3800149">u</span><span class="op" id="3800150">[</span><span class="ident" id="3800151">j</span><span class="op" id="3800152">:</span><span class="op" id="3800153">]</span><span class="op" id="3800154">,</span>&nbsp;<span class="ident" id="3800156">v</span><span class="op" id="3800157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800162">u</span><span class="op" id="3800163">[</span><span class="ident" id="3800164">j</span><span class="op" id="3800165">+</span><span class="ident" id="3800166">n</span><span class="op" id="3800167">]</span>&nbsp;<span class="op" id="3800169">+=</span>&nbsp;<span class="ident" id="3800172">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800177">qhat</span><span class="op" id="3800181">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800186">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800191">q</span><span class="op" id="3800192">[</span><span class="ident" id="3800193">j</span><span class="op" id="3800194">]</span>&nbsp;<span class="op" id="3800196">=</span>&nbsp;<span class="ident" id="3800198">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800208">q</span>&nbsp;<span class="op" id="3800210">=</span>&nbsp;<span class="ident" id="3800212">q</span><span class="op" id="3800213">.</span><span class="ident" id="3800214">norm</span><span class="op" id="3800218">(</span><span class="op" id="3800219">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800222">shrVU</span><span class="op" id="3800227">(</span><span class="ident" id="3800228">u</span><span class="op" id="3800229">,</span>&nbsp;<span class="ident" id="3800231">u</span><span class="op" id="3800232">,</span>&nbsp;<span class="ident" id="3800234">shift</span><span class="op" id="3800239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800242">r</span>&nbsp;<span class="op" id="3800244">=</span>&nbsp;<span class="ident" id="3800246">u</span><span class="op" id="3800247">.</span><span class="ident" id="3800248">norm</span><span class="op" id="3800252">(</span><span class="op" id="3800253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800257">return</span>&nbsp;<span class="ident" id="3800264">q</span><span class="op" id="3800265">,</span>&nbsp;<span class="ident" id="3800267">r</span><br>
<span class="lineno"></span><span class="op" id="3800269">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3800272">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3800318">func</span>&nbsp;<span class="op" id="3800323">(</span><span class="ident" id="3800324">x</span>&nbsp;<span class="ident" id="3800326">nat</span><span class="op" id="3800329">)</span>&nbsp;<span class="ident" id="3800331">bitLen</span><span class="op" id="3800337">(</span><span class="op" id="3800338">)</span>&nbsp;<span class="builtintype" id="3800340">int</span>&nbsp;<span class="op" id="3800344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800347">if</span>&nbsp;<span class="ident" id="3800350">i</span>&nbsp;<span class="op" id="3800352">:=</span>&nbsp;<span class="builtinfunc" id="3800355">len</span><span class="op" id="3800358">(</span><span class="ident" id="3800359">x</span><span class="op" id="3800360">)</span>&nbsp;<span class="op" id="3800362">-</span>&nbsp;<span class="num" id="3800364">1</span><span class="op" id="3800365">;</span>&nbsp;<span class="ident" id="3800367">i</span>&nbsp;<span class="op" id="3800369">&gt;=</span>&nbsp;<span class="num" id="3800372">0</span>&nbsp;<span class="op" id="3800374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800378">return</span>&nbsp;<span class="ident" id="3800385">i</span><span class="op" id="3800386">*</span><span class="ident" id="3800387">_W</span>&nbsp;<span class="op" id="3800390">+</span>&nbsp;<span class="ident" id="3800392">bitLen</span><span class="op" id="3800398">(</span><span class="ident" id="3800399">x</span><span class="op" id="3800400">[</span><span class="ident" id="3800401">i</span><span class="op" id="3800402">]</span><span class="op" id="3800403">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800409">return</span>&nbsp;<span class="num" id="3800416">0</span><br>
<span class="lineno"></span><span class="op" id="3800418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800421">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3800492">const</span>&nbsp;<span class="ident" id="3800498">MaxBase</span>&nbsp;<span class="op" id="3800506">=</span>&nbsp;<span class="string" id="3800508">&#39;z&#39;</span>&nbsp;<span class="op" id="3800512">-</span>&nbsp;<span class="string" id="3800514">&#39;a&#39;</span>&nbsp;<span class="op" id="3800518">+</span>&nbsp;<span class="num" id="3800520">10</span>&nbsp;<span class="op" id="3800523">+</span>&nbsp;<span class="num" id="3800525">1</span>&nbsp;<span class="comment" id="3800527">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3800551">func</span>&nbsp;<span class="ident" id="3800556">hexValue</span><span class="op" id="3800564">(</span><span class="ident" id="3800565">ch</span>&nbsp;<span class="builtintype" id="3800568">rune</span><span class="op" id="3800572">)</span>&nbsp;<span class="ident" id="3800574">Word</span>&nbsp;<span class="op" id="3800579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800582">d</span>&nbsp;<span class="op" id="3800584">:=</span>&nbsp;<span class="builtintype" id="3800587">int</span><span class="op" id="3800590">(</span><span class="ident" id="3800591">MaxBase</span>&nbsp;<span class="op" id="3800599">+</span>&nbsp;<span class="num" id="3800601">1</span><span class="op" id="3800602">)</span>&nbsp;<span class="comment" id="3800604">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800621">switch</span>&nbsp;<span class="op" id="3800628">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800631">case</span>&nbsp;<span class="string" id="3800636">&#39;0&#39;</span>&nbsp;<span class="op" id="3800640">&lt;=</span>&nbsp;<span class="ident" id="3800643">ch</span>&nbsp;<span class="op" id="3800646">&amp;&amp;</span>&nbsp;<span class="ident" id="3800649">ch</span>&nbsp;<span class="op" id="3800652">&lt;=</span>&nbsp;<span class="string" id="3800655">&#39;9&#39;</span><span class="op" id="3800658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800662">d</span>&nbsp;<span class="op" id="3800664">=</span>&nbsp;<span class="builtintype" id="3800666">int</span><span class="op" id="3800669">(</span><span class="ident" id="3800670">ch</span>&nbsp;<span class="op" id="3800673">-</span>&nbsp;<span class="string" id="3800675">&#39;0&#39;</span><span class="op" id="3800678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800681">case</span>&nbsp;<span class="string" id="3800686">&#39;a&#39;</span>&nbsp;<span class="op" id="3800690">&lt;=</span>&nbsp;<span class="ident" id="3800693">ch</span>&nbsp;<span class="op" id="3800696">&amp;&amp;</span>&nbsp;<span class="ident" id="3800699">ch</span>&nbsp;<span class="op" id="3800702">&lt;=</span>&nbsp;<span class="string" id="3800705">&#39;z&#39;</span><span class="op" id="3800708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800712">d</span>&nbsp;<span class="op" id="3800714">=</span>&nbsp;<span class="builtintype" id="3800716">int</span><span class="op" id="3800719">(</span><span class="ident" id="3800720">ch</span>&nbsp;<span class="op" id="3800723">-</span>&nbsp;<span class="string" id="3800725">&#39;a&#39;</span>&nbsp;<span class="op" id="3800729">+</span>&nbsp;<span class="num" id="3800731">10</span><span class="op" id="3800733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800736">case</span>&nbsp;<span class="string" id="3800741">&#39;A&#39;</span>&nbsp;<span class="op" id="3800745">&lt;=</span>&nbsp;<span class="ident" id="3800748">ch</span>&nbsp;<span class="op" id="3800751">&amp;&amp;</span>&nbsp;<span class="ident" id="3800754">ch</span>&nbsp;<span class="op" id="3800757">&lt;=</span>&nbsp;<span class="string" id="3800760">&#39;Z&#39;</span><span class="op" id="3800763">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3800767">d</span>&nbsp;<span class="op" id="3800769">=</span>&nbsp;<span class="builtintype" id="3800771">int</span><span class="op" id="3800774">(</span><span class="ident" id="3800775">ch</span>&nbsp;<span class="op" id="3800778">-</span>&nbsp;<span class="string" id="3800780">&#39;A&#39;</span>&nbsp;<span class="op" id="3800784">+</span>&nbsp;<span class="num" id="3800786">10</span><span class="op" id="3800788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3800791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3800794">return</span>&nbsp;<span class="ident" id="3800801">Word</span><span class="op" id="3800805">(</span><span class="ident" id="3800806">d</span><span class="op" id="3800807">)</span><br>
<span class="lineno"></span><span class="op" id="3800809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3800812">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3800894">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3800970">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3801049">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3801126">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3801162">//</span><br>
<span class="lineno"></span><span class="comment" id="3801165">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3801243">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3801321">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3801397">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3801475">//</span><br>
<span class="lineno"></span><span class="keyword" id="3801478">func</span>&nbsp;<span class="op" id="3801483">(</span><span class="ident" id="3801484">z</span>&nbsp;<span class="ident" id="3801486">nat</span><span class="op" id="3801489">)</span>&nbsp;<span class="ident" id="3801491">scan</span><span class="op" id="3801495">(</span><span class="ident" id="3801496">r</span>&nbsp;<span class="ident" id="3801498">io</span><span class="op" id="3801500">.</span><span class="ident" id="3801501">RuneScanner</span><span class="op" id="3801512">,</span>&nbsp;<span class="ident" id="3801514">base</span>&nbsp;<span class="builtintype" id="3801519">int</span><span class="op" id="3801522">)</span>&nbsp;<span class="op" id="3801524">(</span><span class="ident" id="3801525">nat</span><span class="op" id="3801528">,</span>&nbsp;<span class="builtintype" id="3801530">int</span><span class="op" id="3801533">,</span>&nbsp;<span class="builtintype" id="3801535">error</span><span class="op" id="3801540">)</span>&nbsp;<span class="op" id="3801542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801545">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801570">if</span>&nbsp;<span class="ident" id="3801573">base</span>&nbsp;<span class="op" id="3801578">&lt;</span>&nbsp;<span class="num" id="3801580">0</span>&nbsp;<span class="op" id="3801582">||</span>&nbsp;<span class="ident" id="3801585">base</span>&nbsp;<span class="op" id="3801590">==</span>&nbsp;<span class="num" id="3801593">1</span>&nbsp;<span class="op" id="3801595">||</span>&nbsp;<span class="ident" id="3801598">MaxBase</span>&nbsp;<span class="op" id="3801606">&lt;</span>&nbsp;<span class="ident" id="3801608">base</span>&nbsp;<span class="op" id="3801613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801617">return</span>&nbsp;<span class="ident" id="3801624">z</span><span class="op" id="3801625">,</span>&nbsp;<span class="num" id="3801627">0</span><span class="op" id="3801628">,</span>&nbsp;<span class="ident" id="3801630">errors</span><span class="op" id="3801636">.</span><span class="ident" id="3801637">New</span><span class="op" id="3801640">(</span><span class="string" id="3801641">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3801662">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801669">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801693">ch</span><span class="op" id="3801695">,</span>&nbsp;<span class="ident" id="3801697">_</span><span class="op" id="3801698">,</span>&nbsp;<span class="ident" id="3801700">err</span>&nbsp;<span class="op" id="3801704">:=</span>&nbsp;<span class="ident" id="3801707">r</span><span class="op" id="3801708">.</span><span class="ident" id="3801709">ReadRune</span><span class="op" id="3801717">(</span><span class="op" id="3801718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801721">if</span>&nbsp;<span class="ident" id="3801724">err</span>&nbsp;<span class="op" id="3801728">!=</span>&nbsp;<span class="ident" id="3801731">nil</span>&nbsp;<span class="op" id="3801735">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801739">return</span>&nbsp;<span class="ident" id="3801746">z</span><span class="op" id="3801747">,</span>&nbsp;<span class="num" id="3801749">0</span><span class="op" id="3801750">,</span>&nbsp;<span class="ident" id="3801752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3801761">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801793">b</span>&nbsp;<span class="op" id="3801795">:=</span>&nbsp;<span class="ident" id="3801798">Word</span><span class="op" id="3801802">(</span><span class="ident" id="3801803">base</span><span class="op" id="3801807">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801810">if</span>&nbsp;<span class="ident" id="3801813">base</span>&nbsp;<span class="op" id="3801818">==</span>&nbsp;<span class="num" id="3801821">0</span>&nbsp;<span class="op" id="3801823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801827">b</span>&nbsp;<span class="op" id="3801829">=</span>&nbsp;<span class="num" id="3801831">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801836">if</span>&nbsp;<span class="ident" id="3801839">ch</span>&nbsp;<span class="op" id="3801842">==</span>&nbsp;<span class="string" id="3801845">&#39;0&#39;</span>&nbsp;<span class="op" id="3801849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801854">switch</span>&nbsp;<span class="ident" id="3801861">ch</span><span class="op" id="3801863">,</span>&nbsp;<span class="ident" id="3801865">_</span><span class="op" id="3801866">,</span>&nbsp;<span class="ident" id="3801868">err</span>&nbsp;<span class="op" id="3801872">=</span>&nbsp;<span class="ident" id="3801874">r</span><span class="op" id="3801875">.</span><span class="ident" id="3801876">ReadRune</span><span class="op" id="3801884">(</span><span class="op" id="3801885">)</span><span class="op" id="3801886">;</span>&nbsp;<span class="ident" id="3801888">err</span>&nbsp;<span class="op" id="3801892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801897">case</span>&nbsp;<span class="ident" id="3801902">nil</span><span class="op" id="3801905">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801911">b</span>&nbsp;<span class="op" id="3801913">=</span>&nbsp;<span class="num" id="3801915">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801921">switch</span>&nbsp;<span class="ident" id="3801928">ch</span>&nbsp;<span class="op" id="3801931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801937">case</span>&nbsp;<span class="string" id="3801942">&#39;x&#39;</span><span class="op" id="3801945">,</span>&nbsp;<span class="string" id="3801947">&#39;X&#39;</span><span class="op" id="3801950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801957">b</span>&nbsp;<span class="op" id="3801959">=</span>&nbsp;<span class="num" id="3801961">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3801968">case</span>&nbsp;<span class="string" id="3801973">&#39;b&#39;</span><span class="op" id="3801976">,</span>&nbsp;<span class="string" id="3801978">&#39;B&#39;</span><span class="op" id="3801981">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3801988">b</span>&nbsp;<span class="op" id="3801990">=</span>&nbsp;<span class="num" id="3801992">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3801998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802004">if</span>&nbsp;<span class="ident" id="3802007">b</span>&nbsp;<span class="op" id="3802009">==</span>&nbsp;<span class="num" id="3802012">2</span>&nbsp;<span class="op" id="3802014">||</span>&nbsp;<span class="ident" id="3802017">b</span>&nbsp;<span class="op" id="3802019">==</span>&nbsp;<span class="num" id="3802022">16</span>&nbsp;<span class="op" id="3802025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802032">if</span>&nbsp;<span class="ident" id="3802035">ch</span><span class="op" id="3802037">,</span>&nbsp;<span class="ident" id="3802039">_</span><span class="op" id="3802040">,</span>&nbsp;<span class="ident" id="3802042">err</span>&nbsp;<span class="op" id="3802046">=</span>&nbsp;<span class="ident" id="3802048">r</span><span class="op" id="3802049">.</span><span class="ident" id="3802050">ReadRune</span><span class="op" id="3802058">(</span><span class="op" id="3802059">)</span><span class="op" id="3802060">;</span>&nbsp;<span class="ident" id="3802062">err</span>&nbsp;<span class="op" id="3802066">!=</span>&nbsp;<span class="ident" id="3802069">nil</span>&nbsp;<span class="op" id="3802073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802081">return</span>&nbsp;<span class="ident" id="3802088">z</span><span class="op" id="3802089">,</span>&nbsp;<span class="num" id="3802091">0</span><span class="op" id="3802092">,</span>&nbsp;<span class="ident" id="3802094">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802114">case</span>&nbsp;<span class="ident" id="3802119">io</span><span class="op" id="3802121">.</span><span class="ident" id="3802122">EOF</span><span class="op" id="3802125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802131">return</span>&nbsp;<span class="ident" id="3802138">z</span><span class="op" id="3802139">.</span><span class="builtinfunc" id="3802140">make</span><span class="op" id="3802144">(</span><span class="num" id="3802145">0</span><span class="op" id="3802146">)</span><span class="op" id="3802147">,</span>&nbsp;<span class="num" id="3802149">10</span><span class="op" id="3802151">,</span>&nbsp;<span class="ident" id="3802153">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802160">default</span><span class="op" id="3802167">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802173">return</span>&nbsp;<span class="ident" id="3802180">z</span><span class="op" id="3802181">,</span>&nbsp;<span class="num" id="3802183">10</span><span class="op" id="3802185">,</span>&nbsp;<span class="ident" id="3802187">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802205">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802224">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802319">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802414">z</span>&nbsp;<span class="op" id="3802416">=</span>&nbsp;<span class="ident" id="3802418">z</span><span class="op" id="3802419">.</span><span class="builtinfunc" id="3802420">make</span><span class="op" id="3802424">(</span><span class="num" id="3802425">0</span><span class="op" id="3802426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802429">bb</span>&nbsp;<span class="op" id="3802432">:=</span>&nbsp;<span class="ident" id="3802435">Word</span><span class="op" id="3802439">(</span><span class="num" id="3802440">1</span><span class="op" id="3802441">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802444">dd</span>&nbsp;<span class="op" id="3802447">:=</span>&nbsp;<span class="ident" id="3802450">Word</span><span class="op" id="3802454">(</span><span class="num" id="3802455">0</span><span class="op" id="3802456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802459">for</span>&nbsp;<span class="ident" id="3802463">max</span>&nbsp;<span class="op" id="3802467">:=</span>&nbsp;<span class="ident" id="3802470">_M</span>&nbsp;<span class="op" id="3802473">/</span>&nbsp;<span class="ident" id="3802475">b</span><span class="op" id="3802476">;</span>&nbsp;<span class="op" id="3802478">;</span>&nbsp;<span class="op" id="3802480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802484">d</span>&nbsp;<span class="op" id="3802486">:=</span>&nbsp;<span class="ident" id="3802489">hexValue</span><span class="op" id="3802497">(</span><span class="ident" id="3802498">ch</span><span class="op" id="3802500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802504">if</span>&nbsp;<span class="ident" id="3802507">d</span>&nbsp;<span class="op" id="3802509">&gt;=</span>&nbsp;<span class="ident" id="3802512">b</span>&nbsp;<span class="op" id="3802514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802519">r</span><span class="op" id="3802520">.</span><span class="ident" id="3802521">UnreadRune</span><span class="op" id="3802531">(</span><span class="op" id="3802532">)</span>&nbsp;<span class="comment" id="3802534">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802577">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802590">if</span>&nbsp;<span class="ident" id="3802593">bb</span>&nbsp;<span class="op" id="3802596">&lt;=</span>&nbsp;<span class="ident" id="3802599">max</span>&nbsp;<span class="op" id="3802603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802608">bb</span>&nbsp;<span class="op" id="3802611">*=</span>&nbsp;<span class="ident" id="3802614">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802619">dd</span>&nbsp;<span class="op" id="3802622">=</span>&nbsp;<span class="ident" id="3802624">dd</span><span class="op" id="3802626">*</span><span class="ident" id="3802627">b</span>&nbsp;<span class="op" id="3802629">+</span>&nbsp;<span class="ident" id="3802631">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802635">}</span>&nbsp;<span class="keyword" id="3802637">else</span>&nbsp;<span class="op" id="3802642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802647">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802675">z</span>&nbsp;<span class="op" id="3802677">=</span>&nbsp;<span class="ident" id="3802679">z</span><span class="op" id="3802680">.</span><span class="ident" id="3802681">mulAddWW</span><span class="op" id="3802689">(</span><span class="ident" id="3802690">z</span><span class="op" id="3802691">,</span>&nbsp;<span class="ident" id="3802693">bb</span><span class="op" id="3802695">,</span>&nbsp;<span class="ident" id="3802697">dd</span><span class="op" id="3802699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802704">bb</span>&nbsp;<span class="op" id="3802707">=</span>&nbsp;<span class="ident" id="3802709">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802714">dd</span>&nbsp;<span class="op" id="3802717">=</span>&nbsp;<span class="ident" id="3802719">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802728">if</span>&nbsp;<span class="ident" id="3802731">ch</span><span class="op" id="3802733">,</span>&nbsp;<span class="ident" id="3802735">_</span><span class="op" id="3802736">,</span>&nbsp;<span class="ident" id="3802738">err</span>&nbsp;<span class="op" id="3802742">=</span>&nbsp;<span class="ident" id="3802744">r</span><span class="op" id="3802745">.</span><span class="ident" id="3802746">ReadRune</span><span class="op" id="3802754">(</span><span class="op" id="3802755">)</span><span class="op" id="3802756">;</span>&nbsp;<span class="ident" id="3802758">err</span>&nbsp;<span class="op" id="3802762">!=</span>&nbsp;<span class="ident" id="3802765">nil</span>&nbsp;<span class="op" id="3802769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802774">if</span>&nbsp;<span class="ident" id="3802777">err</span>&nbsp;<span class="op" id="3802781">!=</span>&nbsp;<span class="ident" id="3802784">io</span><span class="op" id="3802786">.</span><span class="ident" id="3802787">EOF</span>&nbsp;<span class="op" id="3802791">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802797">return</span>&nbsp;<span class="ident" id="3802804">z</span><span class="op" id="3802805">,</span>&nbsp;<span class="builtintype" id="3802807">int</span><span class="op" id="3802810">(</span><span class="ident" id="3802811">b</span><span class="op" id="3802812">)</span><span class="op" id="3802813">,</span>&nbsp;<span class="ident" id="3802815">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802827">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3802838">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802842">switch</span>&nbsp;<span class="op" id="3802849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802852">case</span>&nbsp;<span class="ident" id="3802857">bb</span>&nbsp;<span class="op" id="3802860">&gt;</span>&nbsp;<span class="num" id="3802862">1</span><span class="op" id="3802863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802867">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3802910">z</span>&nbsp;<span class="op" id="3802912">=</span>&nbsp;<span class="ident" id="3802914">z</span><span class="op" id="3802915">.</span><span class="ident" id="3802916">mulAddWW</span><span class="op" id="3802924">(</span><span class="ident" id="3802925">z</span><span class="op" id="3802926">,</span>&nbsp;<span class="ident" id="3802928">bb</span><span class="op" id="3802930">,</span>&nbsp;<span class="ident" id="3802932">dd</span><span class="op" id="3802934">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3802937">case</span>&nbsp;<span class="ident" id="3802942">base</span>&nbsp;<span class="op" id="3802947">==</span>&nbsp;<span class="num" id="3802950">0</span>&nbsp;<span class="op" id="3802952">&amp;&amp;</span>&nbsp;<span class="ident" id="3802955">b</span>&nbsp;<span class="op" id="3802957">==</span>&nbsp;<span class="num" id="3802960">8</span><span class="op" id="3802961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3802965">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803039">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803066">return</span>&nbsp;<span class="ident" id="3803073">z</span><span class="op" id="3803074">,</span>&nbsp;<span class="num" id="3803076">10</span><span class="op" id="3803078">,</span>&nbsp;<span class="ident" id="3803080">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803085">case</span>&nbsp;<span class="ident" id="3803090">base</span>&nbsp;<span class="op" id="3803095">!=</span>&nbsp;<span class="num" id="3803098">0</span>&nbsp;<span class="op" id="3803100">||</span>&nbsp;<span class="ident" id="3803103">b</span>&nbsp;<span class="op" id="3803105">!=</span>&nbsp;<span class="num" id="3803108">8</span><span class="op" id="3803109">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803113">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803176">return</span>&nbsp;<span class="ident" id="3803183">z</span><span class="op" id="3803184">,</span>&nbsp;<span class="builtintype" id="3803186">int</span><span class="op" id="3803189">(</span><span class="ident" id="3803190">b</span><span class="op" id="3803191">)</span><span class="op" id="3803192">,</span>&nbsp;<span class="ident" id="3803194">errors</span><span class="op" id="3803200">.</span><span class="ident" id="3803201">New</span><span class="op" id="3803204">(</span><span class="string" id="3803205">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3803235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3803238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803242">return</span>&nbsp;<span class="ident" id="3803249">z</span><span class="op" id="3803250">.</span><span class="ident" id="3803251">norm</span><span class="op" id="3803255">(</span><span class="op" id="3803256">)</span><span class="op" id="3803257">,</span>&nbsp;<span class="builtintype" id="3803259">int</span><span class="op" id="3803262">(</span><span class="ident" id="3803263">b</span><span class="op" id="3803264">)</span><span class="op" id="3803265">,</span>&nbsp;<span class="ident" id="3803267">nil</span><br>
<span class="lineno">720</span><span class="op" id="3803271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803274">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3803315">const</span>&nbsp;<span class="op" id="3803321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803324">lowercaseDigits</span>&nbsp;<span class="op" id="3803340">=</span>&nbsp;<span class="string" id="3803342">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803382">uppercaseDigits</span>&nbsp;<span class="op" id="3803398">=</span>&nbsp;<span class="string" id="3803400">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3803439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803442">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3803498">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3803550">func</span>&nbsp;<span class="op" id="3803555">(</span><span class="ident" id="3803556">x</span>&nbsp;<span class="ident" id="3803558">nat</span><span class="op" id="3803561">)</span>&nbsp;<span class="ident" id="3803563">decimalString</span><span class="op" id="3803576">(</span><span class="op" id="3803577">)</span>&nbsp;<span class="builtintype" id="3803579">string</span>&nbsp;<span class="op" id="3803586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803589">return</span>&nbsp;<span class="ident" id="3803596">x</span><span class="op" id="3803597">.</span><span class="builtintype" id="3803598">string</span><span class="op" id="3803604">(</span><span class="ident" id="3803605">lowercaseDigits</span><span class="op" id="3803620">[</span><span class="num" id="3803621">0</span><span class="op" id="3803622">:</span><span class="num" id="3803623">10</span><span class="op" id="3803625">]</span><span class="op" id="3803626">)</span><br>
<span class="lineno"></span><span class="op" id="3803628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803631">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3803706">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3803781">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3803832">func</span>&nbsp;<span class="op" id="3803837">(</span><span class="ident" id="3803838">x</span>&nbsp;<span class="ident" id="3803840">nat</span><span class="op" id="3803843">)</span>&nbsp;<span class="builtintype" id="3803845">string</span><span class="op" id="3803851">(</span><span class="ident" id="3803852">charset</span>&nbsp;<span class="builtintype" id="3803860">string</span><span class="op" id="3803866">)</span>&nbsp;<span class="builtintype" id="3803868">string</span>&nbsp;<span class="op" id="3803875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3803878">b</span>&nbsp;<span class="op" id="3803880">:=</span>&nbsp;<span class="ident" id="3803883">Word</span><span class="op" id="3803887">(</span><span class="builtinfunc" id="3803888">len</span><span class="op" id="3803891">(</span><span class="ident" id="3803892">charset</span><span class="op" id="3803899">)</span><span class="op" id="3803900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3803904">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803922">switch</span>&nbsp;<span class="op" id="3803929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803932">case</span>&nbsp;<span class="ident" id="3803937">b</span>&nbsp;<span class="op" id="3803939">&lt;</span>&nbsp;<span class="num" id="3803941">2</span>&nbsp;<span class="op" id="3803943">||</span>&nbsp;<span class="ident" id="3803946">MaxBase</span>&nbsp;<span class="op" id="3803954">&gt;</span>&nbsp;<span class="num" id="3803956">256</span><span class="op" id="3803959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3803963">panic</span><span class="op" id="3803968">(</span><span class="string" id="3803969">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3803983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3803986">case</span>&nbsp;<span class="builtinfunc" id="3803991">len</span><span class="op" id="3803994">(</span><span class="ident" id="3803995">x</span><span class="op" id="3803996">)</span>&nbsp;<span class="op" id="3803998">==</span>&nbsp;<span class="num" id="3804001">0</span><span class="op" id="3804002">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804006">return</span>&nbsp;<span class="builtintype" id="3804013">string</span><span class="op" id="3804019">(</span><span class="ident" id="3804020">charset</span><span class="op" id="3804027">[</span><span class="num" id="3804028">0</span><span class="op" id="3804029">]</span><span class="op" id="3804030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804037">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804072">i</span>&nbsp;<span class="op" id="3804074">:=</span>&nbsp;<span class="builtintype" id="3804077">int</span><span class="op" id="3804080">(</span><span class="builtintype" id="3804081">float64</span><span class="op" id="3804088">(</span><span class="ident" id="3804089">x</span><span class="op" id="3804090">.</span><span class="ident" id="3804091">bitLen</span><span class="op" id="3804097">(</span><span class="op" id="3804098">)</span><span class="op" id="3804099">)</span><span class="op" id="3804100">/</span><span class="ident" id="3804101">math</span><span class="op" id="3804105">.</span><span class="ident" id="3804106">Log2</span><span class="op" id="3804110">(</span><span class="builtintype" id="3804111">float64</span><span class="op" id="3804118">(</span><span class="ident" id="3804119">b</span><span class="op" id="3804120">)</span><span class="op" id="3804121">)</span><span class="op" id="3804122">)</span>&nbsp;<span class="op" id="3804124">+</span>&nbsp;<span class="num" id="3804126">1</span>&nbsp;<span class="comment" id="3804128">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804151">s</span>&nbsp;<span class="op" id="3804153">:=</span>&nbsp;<span class="builtinfunc" id="3804156">make</span><span class="op" id="3804160">(</span><span class="op" id="3804161">[</span><span class="op" id="3804162">]</span><span class="builtintype" id="3804163">byte</span><span class="op" id="3804167">,</span>&nbsp;<span class="ident" id="3804169">i</span><span class="op" id="3804170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804174">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804237">if</span>&nbsp;<span class="ident" id="3804240">b</span>&nbsp;<span class="op" id="3804242">==</span>&nbsp;<span class="ident" id="3804245">b</span><span class="op" id="3804246">&amp;</span><span class="op" id="3804247">-</span><span class="ident" id="3804248">b</span>&nbsp;<span class="op" id="3804250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804254">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804294">shift</span>&nbsp;<span class="op" id="3804300">:=</span>&nbsp;<span class="ident" id="3804303">trailingZeroBits</span><span class="op" id="3804319">(</span><span class="ident" id="3804320">b</span><span class="op" id="3804321">)</span>&nbsp;<span class="comment" id="3804323">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804353">mask</span>&nbsp;<span class="op" id="3804358">:=</span>&nbsp;<span class="ident" id="3804361">Word</span><span class="op" id="3804365">(</span><span class="num" id="3804366">1</span><span class="op" id="3804367">)</span><span class="op" id="3804368">&lt;&lt;</span><span class="ident" id="3804370">shift</span>&nbsp;<span class="op" id="3804376">-</span>&nbsp;<span class="num" id="3804378">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804382">w</span>&nbsp;<span class="op" id="3804384">:=</span>&nbsp;<span class="ident" id="3804387">x</span><span class="op" id="3804388">[</span><span class="num" id="3804389">0</span><span class="op" id="3804390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804394">nbits</span>&nbsp;<span class="op" id="3804400">:=</span>&nbsp;<span class="builtintype" id="3804403">uint</span><span class="op" id="3804407">(</span><span class="ident" id="3804408">_W</span><span class="op" id="3804410">)</span>&nbsp;<span class="comment" id="3804412">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804450">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804486">for</span>&nbsp;<span class="ident" id="3804490">k</span>&nbsp;<span class="op" id="3804492">:=</span>&nbsp;<span class="num" id="3804495">1</span><span class="op" id="3804496">;</span>&nbsp;<span class="ident" id="3804498">k</span>&nbsp;<span class="op" id="3804500">&lt;</span>&nbsp;<span class="builtinfunc" id="3804502">len</span><span class="op" id="3804505">(</span><span class="ident" id="3804506">x</span><span class="op" id="3804507">)</span><span class="op" id="3804508">;</span>&nbsp;<span class="ident" id="3804510">k</span><span class="op" id="3804511">++</span>&nbsp;<span class="op" id="3804514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804519">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804545">for</span>&nbsp;<span class="ident" id="3804549">nbits</span>&nbsp;<span class="op" id="3804555">&gt;=</span>&nbsp;<span class="ident" id="3804558">shift</span>&nbsp;<span class="op" id="3804564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804570">i</span><span class="op" id="3804571">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804578">s</span><span class="op" id="3804579">[</span><span class="ident" id="3804580">i</span><span class="op" id="3804581">]</span>&nbsp;<span class="op" id="3804583">=</span>&nbsp;<span class="ident" id="3804585">charset</span><span class="op" id="3804592">[</span><span class="ident" id="3804593">w</span><span class="op" id="3804594">&amp;</span><span class="ident" id="3804595">mask</span><span class="op" id="3804599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804605">w</span>&nbsp;<span class="op" id="3804607">&gt;&gt;=</span>&nbsp;<span class="ident" id="3804611">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804621">nbits</span>&nbsp;<span class="op" id="3804627">-=</span>&nbsp;<span class="ident" id="3804630">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804645">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3804710">if</span>&nbsp;<span class="ident" id="3804713">nbits</span>&nbsp;<span class="op" id="3804719">==</span>&nbsp;<span class="num" id="3804722">0</span>&nbsp;<span class="op" id="3804724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804730">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804778">w</span>&nbsp;<span class="op" id="3804780">=</span>&nbsp;<span class="ident" id="3804782">x</span><span class="op" id="3804783">[</span><span class="ident" id="3804784">k</span><span class="op" id="3804785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804791">nbits</span>&nbsp;<span class="op" id="3804797">=</span>&nbsp;<span class="ident" id="3804799">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3804805">}</span>&nbsp;<span class="keyword" id="3804807">else</span>&nbsp;<span class="op" id="3804812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804818">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804874">w</span>&nbsp;<span class="op" id="3804876">|=</span>&nbsp;<span class="ident" id="3804879">x</span><span class="op" id="3804880">[</span><span class="ident" id="3804881">k</span><span class="op" id="3804882">]</span>&nbsp;<span class="op" id="3804884">&lt;&lt;</span>&nbsp;<span class="ident" id="3804887">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804897">i</span><span class="op" id="3804898">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804905">s</span><span class="op" id="3804906">[</span><span class="ident" id="3804907">i</span><span class="op" id="3804908">]</span>&nbsp;<span class="op" id="3804910">=</span>&nbsp;<span class="ident" id="3804912">charset</span><span class="op" id="3804919">[</span><span class="ident" id="3804920">w</span><span class="op" id="3804921">&amp;</span><span class="ident" id="3804922">mask</span><span class="op" id="3804926">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3804933">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804948">w</span>&nbsp;<span class="op" id="3804950">=</span>&nbsp;<span class="ident" id="3804952">x</span><span class="op" id="3804953">[</span><span class="ident" id="3804954">k</span><span class="op" id="3804955">]</span>&nbsp;<span class="op" id="3804957">&gt;&gt;</span>&nbsp;<span class="op" id="3804960">(</span><span class="ident" id="3804961">shift</span>&nbsp;<span class="op" id="3804967">-</span>&nbsp;<span class="ident" id="3804969">nbits</span><span class="op" id="3804974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3804980">nbits</span>&nbsp;<span class="op" id="3804986">=</span>&nbsp;<span class="ident" id="3804988">_W</span>&nbsp;<span class="op" id="3804991">-</span>&nbsp;<span class="op" id="3804993">(</span><span class="ident" id="3804994">shift</span>&nbsp;<span class="op" id="3805000">-</span>&nbsp;<span class="ident" id="3805002">nbits</span><span class="op" id="3805007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805012">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805021">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805087">for</span>&nbsp;<span class="ident" id="3805091">nbits</span>&nbsp;<span class="op" id="3805097">&gt;=</span>&nbsp;<span class="num" id="3805100">0</span>&nbsp;<span class="op" id="3805102">&amp;&amp;</span>&nbsp;<span class="ident" id="3805105">w</span>&nbsp;<span class="op" id="3805107">!=</span>&nbsp;<span class="num" id="3805110">0</span>&nbsp;<span class="op" id="3805112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805117">i</span><span class="op" id="3805118">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805124">s</span><span class="op" id="3805125">[</span><span class="ident" id="3805126">i</span><span class="op" id="3805127">]</span>&nbsp;<span class="op" id="3805129">=</span>&nbsp;<span class="ident" id="3805131">charset</span><span class="op" id="3805138">[</span><span class="ident" id="3805139">w</span><span class="op" id="3805140">&amp;</span><span class="ident" id="3805141">mask</span><span class="op" id="3805145">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805150">w</span>&nbsp;<span class="op" id="3805152">&gt;&gt;=</span>&nbsp;<span class="ident" id="3805156">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805165">nbits</span>&nbsp;<span class="op" id="3805171">-=</span>&nbsp;<span class="ident" id="3805174">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805186">}</span>&nbsp;<span class="keyword" id="3805188">else</span>&nbsp;<span class="op" id="3805193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805197">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805260">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805318">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805375">bb</span>&nbsp;<span class="op" id="3805378">:=</span>&nbsp;<span class="ident" id="3805381">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805388">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805416">ndigits</span>&nbsp;<span class="op" id="3805424">:=</span>&nbsp;<span class="num" id="3805427">1</span>&nbsp;<span class="comment" id="3805429">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3805458">for</span>&nbsp;<span class="ident" id="3805462">max</span>&nbsp;<span class="op" id="3805466">:=</span>&nbsp;<span class="ident" id="3805469">Word</span><span class="op" id="3805473">(</span><span class="ident" id="3805474">_M</span>&nbsp;<span class="op" id="3805477">/</span>&nbsp;<span class="ident" id="3805479">b</span><span class="op" id="3805480">)</span><span class="op" id="3805481">;</span>&nbsp;<span class="ident" id="3805483">bb</span>&nbsp;<span class="op" id="3805486">&lt;=</span>&nbsp;<span class="ident" id="3805489">max</span><span class="op" id="3805492">;</span>&nbsp;<span class="ident" id="3805494">bb</span>&nbsp;<span class="op" id="3805497">*=</span>&nbsp;<span class="ident" id="3805500">b</span>&nbsp;<span class="op" id="3805502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805507">ndigits</span><span class="op" id="3805514">++</span>&nbsp;<span class="comment" id="3805517">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3805571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805576">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805657">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805712">table</span>&nbsp;<span class="op" id="3805718">:=</span>&nbsp;<span class="ident" id="3805721">divisors</span><span class="op" id="3805729">(</span><span class="builtinfunc" id="3805730">len</span><span class="op" id="3805733">(</span><span class="ident" id="3805734">x</span><span class="op" id="3805735">)</span><span class="op" id="3805736">,</span>&nbsp;<span class="ident" id="3805738">b</span><span class="op" id="3805739">,</span>&nbsp;<span class="ident" id="3805741">ndigits</span><span class="op" id="3805748">,</span>&nbsp;<span class="ident" id="3805750">bb</span><span class="op" id="3805752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805757">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805816">q</span>&nbsp;<span class="op" id="3805818">:=</span>&nbsp;<span class="ident" id="3805821">nat</span><span class="op" id="3805824">(</span><span class="ident" id="3805825">nil</span><span class="op" id="3805828">)</span><span class="op" id="3805829">.</span><span class="ident" id="3805830">set</span><span class="op" id="3805833">(</span><span class="ident" id="3805834">x</span><span class="op" id="3805835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805840">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3805877">q</span><span class="op" id="3805878">.</span><span class="ident" id="3805879">convertWords</span><span class="op" id="3805891">(</span><span class="ident" id="3805892">s</span><span class="op" id="3805893">,</span>&nbsp;<span class="ident" id="3805895">charset</span><span class="op" id="3805902">,</span>&nbsp;<span class="ident" id="3805904">b</span><span class="op" id="3805905">,</span>&nbsp;<span class="ident" id="3805907">ndigits</span><span class="op" id="3805914">,</span>&nbsp;<span class="ident" id="3805916">bb</span><span class="op" id="3805918">,</span>&nbsp;<span class="ident" id="3805920">table</span><span class="op" id="3805925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805930">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3805955">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3806017">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806051">i</span>&nbsp;<span class="op" id="3806053">=</span>&nbsp;<span class="num" id="3806055">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806059">for</span>&nbsp;<span class="ident" id="3806063">zero</span>&nbsp;<span class="op" id="3806068">:=</span>&nbsp;<span class="ident" id="3806071">charset</span><span class="op" id="3806078">[</span><span class="num" id="3806079">0</span><span class="op" id="3806080">]</span><span class="op" id="3806081">;</span>&nbsp;<span class="ident" id="3806083">s</span><span class="op" id="3806084">[</span><span class="ident" id="3806085">i</span><span class="op" id="3806086">]</span>&nbsp;<span class="op" id="3806088">==</span>&nbsp;<span class="ident" id="3806091">zero</span><span class="op" id="3806095">;</span>&nbsp;<span class="op" id="3806097">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3806102">i</span><span class="op" id="3806103">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3806111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3806115">return</span>&nbsp;<span class="builtintype" id="3806122">string</span><span class="op" id="3806128">(</span><span class="ident" id="3806129">s</span><span class="op" id="3806130">[</span><span class="ident" id="3806131">i</span><span class="op" id="3806132">:</span><span class="op" id="3806133">]</span><span class="op" id="3806134">)</span><br>
<span class="lineno">825</span><span class="op" id="3806136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3806139">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3806233">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3806327">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3806358">//</span><br>
<span class="lineno"></span><span class="comment" id="3806361">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3806461">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3806558">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3806654">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3806750">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3806848">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3806945">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3807042">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3807140">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3807236">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3807329">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3807351">//</span><br>
<span class="lineno"></span><span class="keyword" id="3807354">func</span>&nbsp;<span class="op" id="3807359">(</span><span class="ident" id="3807360">q</span>&nbsp;<span class="ident" id="3807362">nat</span><span class="op" id="3807365">)</span>&nbsp;<span class="ident" id="3807367">convertWords</span><span class="op" id="3807379">(</span><span class="ident" id="3807380">s</span>&nbsp;<span class="op" id="3807382">[</span><span class="op" id="3807383">]</span><span class="builtintype" id="3807384">byte</span><span class="op" id="3807388">,</span>&nbsp;<span class="ident" id="3807390">charset</span>&nbsp;<span class="builtintype" id="3807398">string</span><span class="op" id="3807404">,</span>&nbsp;<span class="ident" id="3807406">b</span>&nbsp;<span class="ident" id="3807408">Word</span><span class="op" id="3807412">,</span>&nbsp;<span class="ident" id="3807414">ndigits</span>&nbsp;<span class="builtintype" id="3807422">int</span><span class="op" id="3807425">,</span>&nbsp;<span class="ident" id="3807427">bb</span>&nbsp;<span class="ident" id="3807430">Word</span><span class="op" id="3807434">,</span>&nbsp;<span class="ident" id="3807436">table</span>&nbsp;<span class="op" id="3807442">[</span><span class="op" id="3807443">]</span><span class="ident" id="3807444">divisor</span><span class="op" id="3807451">)</span>&nbsp;<span class="op" id="3807453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807456">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807492">if</span>&nbsp;<span class="ident" id="3807495">table</span>&nbsp;<span class="op" id="3807501">!=</span>&nbsp;<span class="ident" id="3807504">nil</span>&nbsp;<span class="op" id="3807508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807512">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807539">var</span>&nbsp;<span class="ident" id="3807543">r</span>&nbsp;<span class="ident" id="3807545">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807551">index</span>&nbsp;<span class="op" id="3807557">:=</span>&nbsp;<span class="builtinfunc" id="3807560">len</span><span class="op" id="3807563">(</span><span class="ident" id="3807564">table</span><span class="op" id="3807569">)</span>&nbsp;<span class="op" id="3807571">-</span>&nbsp;<span class="num" id="3807573">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807577">for</span>&nbsp;<span class="builtinfunc" id="3807581">len</span><span class="op" id="3807584">(</span><span class="ident" id="3807585">q</span><span class="op" id="3807586">)</span>&nbsp;<span class="op" id="3807588">&gt;</span>&nbsp;<span class="ident" id="3807590">leafSize</span>&nbsp;<span class="op" id="3807599">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807604">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807673">maxLength</span>&nbsp;<span class="op" id="3807683">:=</span>&nbsp;<span class="ident" id="3807686">q</span><span class="op" id="3807687">.</span><span class="ident" id="3807688">bitLen</span><span class="op" id="3807694">(</span><span class="op" id="3807695">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3807701">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807771">minLength</span>&nbsp;<span class="op" id="3807781">:=</span>&nbsp;<span class="ident" id="3807784">maxLength</span>&nbsp;<span class="op" id="3807794">&gt;&gt;</span>&nbsp;<span class="num" id="3807797">1</span>&nbsp;<span class="comment" id="3807799">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807821">for</span>&nbsp;<span class="ident" id="3807825">index</span>&nbsp;<span class="op" id="3807831">&gt;</span>&nbsp;<span class="num" id="3807833">0</span>&nbsp;<span class="op" id="3807835">&amp;&amp;</span>&nbsp;<span class="ident" id="3807838">table</span><span class="op" id="3807843">[</span><span class="ident" id="3807844">index</span><span class="op" id="3807849">-</span><span class="num" id="3807850">1</span><span class="op" id="3807851">]</span><span class="op" id="3807852">.</span><span class="ident" id="3807853">nbits</span>&nbsp;<span class="op" id="3807859">&gt;</span>&nbsp;<span class="ident" id="3807861">minLength</span>&nbsp;<span class="op" id="3807871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807877">index</span><span class="op" id="3807882">--</span>&nbsp;<span class="comment" id="3807885">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3807899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807904">if</span>&nbsp;<span class="ident" id="3807907">table</span><span class="op" id="3807912">[</span><span class="ident" id="3807913">index</span><span class="op" id="3807918">]</span><span class="op" id="3807919">.</span><span class="ident" id="3807920">nbits</span>&nbsp;<span class="op" id="3807926">&gt;=</span>&nbsp;<span class="ident" id="3807929">maxLength</span>&nbsp;<span class="op" id="3807939">&amp;&amp;</span>&nbsp;<span class="ident" id="3807942">table</span><span class="op" id="3807947">[</span><span class="ident" id="3807948">index</span><span class="op" id="3807953">]</span><span class="op" id="3807954">.</span><span class="ident" id="3807955">bbb</span><span class="op" id="3807958">.</span><span class="ident" id="3807959">cmp</span><span class="op" id="3807962">(</span><span class="ident" id="3807963">q</span><span class="op" id="3807964">)</span>&nbsp;<span class="op" id="3807966">&gt;=</span>&nbsp;<span class="num" id="3807969">0</span>&nbsp;<span class="op" id="3807971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3807977">index</span><span class="op" id="3807982">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3807989">if</span>&nbsp;<span class="ident" id="3807992">index</span>&nbsp;<span class="op" id="3807998">&lt;</span>&nbsp;<span class="num" id="3808000">0</span>&nbsp;<span class="op" id="3808002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3808009">panic</span><span class="op" id="3808014">(</span><span class="string" id="3808015">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3808039">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3808045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3808050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808056">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808139">q</span><span class="op" id="3808140">,</span>&nbsp;<span class="ident" id="3808142">r</span>&nbsp;<span class="op" id="3808144">=</span>&nbsp;<span class="ident" id="3808146">q</span><span class="op" id="3808147">.</span><span class="ident" id="3808148">div</span><span class="op" id="3808151">(</span><span class="ident" id="3808152">r</span><span class="op" id="3808153">,</span>&nbsp;<span class="ident" id="3808155">q</span><span class="op" id="3808156">,</span>&nbsp;<span class="ident" id="3808158">table</span><span class="op" id="3808163">[</span><span class="ident" id="3808164">index</span><span class="op" id="3808169">]</span><span class="op" id="3808170">.</span><span class="ident" id="3808171">bbb</span><span class="op" id="3808174">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808180">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808243">h</span>&nbsp;<span class="op" id="3808245">:=</span>&nbsp;<span class="builtinfunc" id="3808248">len</span><span class="op" id="3808251">(</span><span class="ident" id="3808252">s</span><span class="op" id="3808253">)</span>&nbsp;<span class="op" id="3808255">-</span>&nbsp;<span class="ident" id="3808257">table</span><span class="op" id="3808262">[</span><span class="ident" id="3808263">index</span><span class="op" id="3808268">]</span><span class="op" id="3808269">.</span><span class="ident" id="3808270">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808281">r</span><span class="op" id="3808282">.</span><span class="ident" id="3808283">convertWords</span><span class="op" id="3808295">(</span><span class="ident" id="3808296">s</span><span class="op" id="3808297">[</span><span class="ident" id="3808298">h</span><span class="op" id="3808299">:</span><span class="op" id="3808300">]</span><span class="op" id="3808301">,</span>&nbsp;<span class="ident" id="3808303">charset</span><span class="op" id="3808310">,</span>&nbsp;<span class="ident" id="3808312">b</span><span class="op" id="3808313">,</span>&nbsp;<span class="ident" id="3808315">ndigits</span><span class="op" id="3808322">,</span>&nbsp;<span class="ident" id="3808324">bb</span><span class="op" id="3808326">,</span>&nbsp;<span class="ident" id="3808328">table</span><span class="op" id="3808333">[</span><span class="num" id="3808334">0</span><span class="op" id="3808335">:</span><span class="ident" id="3808336">index</span><span class="op" id="3808341">]</span><span class="op" id="3808342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808347">s</span>&nbsp;<span class="op" id="3808349">=</span>&nbsp;<span class="ident" id="3808351">s</span><span class="op" id="3808352">[</span><span class="op" id="3808353">:</span><span class="ident" id="3808354">h</span><span class="op" id="3808355">]</span>&nbsp;<span class="comment" id="3808357">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3808426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3808429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808433">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808519">i</span>&nbsp;<span class="op" id="3808521">:=</span>&nbsp;<span class="builtinfunc" id="3808524">len</span><span class="op" id="3808527">(</span><span class="ident" id="3808528">s</span><span class="op" id="3808529">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3808532">var</span>&nbsp;<span class="ident" id="3808536">r</span>&nbsp;<span class="ident" id="3808538">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3808544">if</span>&nbsp;<span class="ident" id="3808547">b</span>&nbsp;<span class="op" id="3808549">==</span>&nbsp;<span class="num" id="3808552">10</span>&nbsp;<span class="op" id="3808555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808559">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3808646">for</span>&nbsp;<span class="builtinfunc" id="3808650">len</span><span class="op" id="3808653">(</span><span class="ident" id="3808654">q</span><span class="op" id="3808655">)</span>&nbsp;<span class="op" id="3808657">&gt;</span>&nbsp;<span class="num" id="3808659">0</span>&nbsp;<span class="op" id="3808661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808666">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808715">q</span><span class="op" id="3808716">,</span>&nbsp;<span class="ident" id="3808718">r</span>&nbsp;<span class="op" id="3808720">=</span>&nbsp;<span class="ident" id="3808722">q</span><span class="op" id="3808723">.</span><span class="ident" id="3808724">divW</span><span class="op" id="3808728">(</span><span class="ident" id="3808729">q</span><span class="op" id="3808730">,</span>&nbsp;<span class="ident" id="3808732">bb</span><span class="op" id="3808734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3808739">for</span>&nbsp;<span class="ident" id="3808743">j</span>&nbsp;<span class="op" id="3808745">:=</span>&nbsp;<span class="num" id="3808748">0</span><span class="op" id="3808749">;</span>&nbsp;<span class="ident" id="3808751">j</span>&nbsp;<span class="op" id="3808753">&lt;</span>&nbsp;<span class="ident" id="3808755">ndigits</span>&nbsp;<span class="op" id="3808763">&amp;&amp;</span>&nbsp;<span class="ident" id="3808766">i</span>&nbsp;<span class="op" id="3808768">&gt;</span>&nbsp;<span class="num" id="3808770">0</span><span class="op" id="3808771">;</span>&nbsp;<span class="ident" id="3808773">j</span><span class="op" id="3808774">++</span>&nbsp;<span class="op" id="3808777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808783">i</span><span class="op" id="3808784">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808791">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808850">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3808914">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808976">t</span>&nbsp;<span class="op" id="3808978">:=</span>&nbsp;<span class="ident" id="3808981">r</span>&nbsp;<span class="op" id="3808983">/</span>&nbsp;<span class="num" id="3808985">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3808992">s</span><span class="op" id="3808993">[</span><span class="ident" id="3808994">i</span><span class="op" id="3808995">]</span>&nbsp;<span class="op" id="3808997">=</span>&nbsp;<span class="ident" id="3808999">charset</span><span class="op" id="3809006">[</span><span class="ident" id="3809007">r</span><span class="op" id="3809008">-</span><span class="ident" id="3809009">t</span><span class="op" id="3809010">&lt;&lt;</span><span class="num" id="3809012">3</span><span class="op" id="3809013">-</span><span class="ident" id="3809014">t</span><span class="op" id="3809015">-</span><span class="ident" id="3809016">t</span><span class="op" id="3809017">]</span>&nbsp;<span class="comment" id="3809019">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809087">r</span>&nbsp;<span class="op" id="3809089">=</span>&nbsp;<span class="ident" id="3809091">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809096">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809103">}</span>&nbsp;<span class="keyword" id="3809105">else</span>&nbsp;<span class="op" id="3809110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3809114">for</span>&nbsp;<span class="builtinfunc" id="3809118">len</span><span class="op" id="3809121">(</span><span class="ident" id="3809122">q</span><span class="op" id="3809123">)</span>&nbsp;<span class="op" id="3809125">&gt;</span>&nbsp;<span class="num" id="3809127">0</span>&nbsp;<span class="op" id="3809129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3809134">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809183">q</span><span class="op" id="3809184">,</span>&nbsp;<span class="ident" id="3809186">r</span>&nbsp;<span class="op" id="3809188">=</span>&nbsp;<span class="ident" id="3809190">q</span><span class="op" id="3809191">.</span><span class="ident" id="3809192">divW</span><span class="op" id="3809196">(</span><span class="ident" id="3809197">q</span><span class="op" id="3809198">,</span>&nbsp;<span class="ident" id="3809200">bb</span><span class="op" id="3809202">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3809207">for</span>&nbsp;<span class="ident" id="3809211">j</span>&nbsp;<span class="op" id="3809213">:=</span>&nbsp;<span class="num" id="3809216">0</span><span class="op" id="3809217">;</span>&nbsp;<span class="ident" id="3809219">j</span>&nbsp;<span class="op" id="3809221">&lt;</span>&nbsp;<span class="ident" id="3809223">ndigits</span>&nbsp;<span class="op" id="3809231">&amp;&amp;</span>&nbsp;<span class="ident" id="3809234">i</span>&nbsp;<span class="op" id="3809236">&gt;</span>&nbsp;<span class="num" id="3809238">0</span><span class="op" id="3809239">;</span>&nbsp;<span class="ident" id="3809241">j</span><span class="op" id="3809242">++</span>&nbsp;<span class="op" id="3809245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809251">i</span><span class="op" id="3809252">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809259">s</span><span class="op" id="3809260">[</span><span class="ident" id="3809261">i</span><span class="op" id="3809262">]</span>&nbsp;<span class="op" id="3809264">=</span>&nbsp;<span class="ident" id="3809266">charset</span><span class="op" id="3809273">[</span><span class="ident" id="3809274">r</span><span class="op" id="3809275">%</span><span class="ident" id="3809276">b</span><span class="op" id="3809277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809283">r</span>&nbsp;<span class="op" id="3809285">/=</span>&nbsp;<span class="ident" id="3809288">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809293">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3809304">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809334">zero</span>&nbsp;<span class="op" id="3809339">:=</span>&nbsp;<span class="ident" id="3809342">charset</span><span class="op" id="3809349">[</span><span class="num" id="3809350">0</span><span class="op" id="3809351">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3809354">for</span>&nbsp;<span class="ident" id="3809358">i</span>&nbsp;<span class="op" id="3809360">&gt;</span>&nbsp;<span class="num" id="3809362">0</span>&nbsp;<span class="op" id="3809364">{</span>&nbsp;<span class="comment" id="3809366">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809402">i</span><span class="op" id="3809403">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809408">s</span><span class="op" id="3809409">[</span><span class="ident" id="3809410">i</span><span class="op" id="3809411">]</span>&nbsp;<span class="op" id="3809413">=</span>&nbsp;<span class="ident" id="3809415">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3809421">}</span><br>
<span class="lineno"></span><span class="op" id="3809423">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3809426">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3809516">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3809581">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3809661">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3809721">var</span>&nbsp;<span class="ident" id="3809725">leafSize</span>&nbsp;<span class="builtintype" id="3809734">int</span>&nbsp;<span class="op" id="3809738">=</span>&nbsp;<span class="num" id="3809740">8</span>&nbsp;<span class="comment" id="3809742">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3809808">type</span>&nbsp;<span class="ident" id="3809813">divisor</span>&nbsp;<span class="keyword" id="3809821">struct</span>&nbsp;<span class="op" id="3809828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809831">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809839">nat</span>&nbsp;<span class="comment" id="3809843">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809855">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3809863">int</span>&nbsp;<span class="comment" id="3809867">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3809935">ndigits</span>&nbsp;<span class="builtintype" id="3809943">int</span>&nbsp;<span class="comment" id="3809947">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3810005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3810008">var</span>&nbsp;<span class="ident" id="3810012">cacheBase10</span>&nbsp;<span class="keyword" id="3810024">struct</span>&nbsp;<span class="op" id="3810031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810034">sync</span><span class="op" id="3810038">.</span><span class="ident" id="3810039">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810046">table</span>&nbsp;<span class="op" id="3810052">[</span><span class="num" id="3810053">64</span><span class="op" id="3810055">]</span><span class="ident" id="3810056">divisor</span>&nbsp;<span class="comment" id="3810064">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3810095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3810098">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3810121">func</span>&nbsp;<span class="op" id="3810126">(</span><span class="ident" id="3810127">z</span>&nbsp;<span class="ident" id="3810129">nat</span><span class="op" id="3810132">)</span>&nbsp;<span class="ident" id="3810134">expWW</span><span class="op" id="3810139">(</span><span class="ident" id="3810140">x</span><span class="op" id="3810141">,</span>&nbsp;<span class="ident" id="3810143">y</span>&nbsp;<span class="ident" id="3810145">Word</span><span class="op" id="3810149">)</span>&nbsp;<span class="ident" id="3810151">nat</span>&nbsp;<span class="op" id="3810155">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810158">return</span>&nbsp;<span class="ident" id="3810165">z</span><span class="op" id="3810166">.</span><span class="ident" id="3810167">expNN</span><span class="op" id="3810172">(</span><span class="ident" id="3810173">nat</span><span class="op" id="3810176">(</span><span class="ident" id="3810177">nil</span><span class="op" id="3810180">)</span><span class="op" id="3810181">.</span><span class="ident" id="3810182">setWord</span><span class="op" id="3810189">(</span><span class="ident" id="3810190">x</span><span class="op" id="3810191">)</span><span class="op" id="3810192">,</span>&nbsp;<span class="ident" id="3810194">nat</span><span class="op" id="3810197">(</span><span class="ident" id="3810198">nil</span><span class="op" id="3810201">)</span><span class="op" id="3810202">.</span><span class="ident" id="3810203">setWord</span><span class="op" id="3810210">(</span><span class="ident" id="3810211">y</span><span class="op" id="3810212">)</span><span class="op" id="3810213">,</span>&nbsp;<span class="ident" id="3810215">nil</span><span class="op" id="3810218">)</span><br>
<span class="lineno"></span><span class="op" id="3810220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3810223">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3810290">func</span>&nbsp;<span class="ident" id="3810295">divisors</span><span class="op" id="3810303">(</span><span class="ident" id="3810304">m</span>&nbsp;<span class="builtintype" id="3810306">int</span><span class="op" id="3810309">,</span>&nbsp;<span class="ident" id="3810311">b</span>&nbsp;<span class="ident" id="3810313">Word</span><span class="op" id="3810317">,</span>&nbsp;<span class="ident" id="3810319">ndigits</span>&nbsp;<span class="builtintype" id="3810327">int</span><span class="op" id="3810330">,</span>&nbsp;<span class="ident" id="3810332">bb</span>&nbsp;<span class="ident" id="3810335">Word</span><span class="op" id="3810339">)</span>&nbsp;<span class="op" id="3810341">[</span><span class="op" id="3810342">]</span><span class="ident" id="3810343">divisor</span>&nbsp;<span class="op" id="3810351">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3810354">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810429">if</span>&nbsp;<span class="ident" id="3810432">leafSize</span>&nbsp;<span class="op" id="3810441">==</span>&nbsp;<span class="num" id="3810444">0</span>&nbsp;<span class="op" id="3810446">||</span>&nbsp;<span class="ident" id="3810449">m</span>&nbsp;<span class="op" id="3810451">&lt;=</span>&nbsp;<span class="ident" id="3810454">leafSize</span>&nbsp;<span class="op" id="3810463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810467">return</span>&nbsp;<span class="ident" id="3810474">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3810479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3810483">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810539">k</span>&nbsp;<span class="op" id="3810541">:=</span>&nbsp;<span class="num" id="3810544">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810547">for</span>&nbsp;<span class="ident" id="3810551">words</span>&nbsp;<span class="op" id="3810557">:=</span>&nbsp;<span class="ident" id="3810560">leafSize</span><span class="op" id="3810568">;</span>&nbsp;<span class="ident" id="3810570">words</span>&nbsp;<span class="op" id="3810576">&lt;</span>&nbsp;<span class="ident" id="3810578">m</span><span class="op" id="3810579">&gt;&gt;</span><span class="num" id="3810581">1</span>&nbsp;<span class="op" id="3810583">&amp;&amp;</span>&nbsp;<span class="ident" id="3810586">k</span>&nbsp;<span class="op" id="3810588">&lt;</span>&nbsp;<span class="builtinfunc" id="3810590">len</span><span class="op" id="3810593">(</span><span class="ident" id="3810594">cacheBase10</span><span class="op" id="3810605">.</span><span class="ident" id="3810606">table</span><span class="op" id="3810611">)</span><span class="op" id="3810612">;</span>&nbsp;<span class="ident" id="3810614">words</span>&nbsp;<span class="op" id="3810620">&lt;&lt;=</span>&nbsp;<span class="num" id="3810624">1</span>&nbsp;<span class="op" id="3810626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810630">k</span><span class="op" id="3810631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3810635">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3810639">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810722">var</span>&nbsp;<span class="ident" id="3810726">table</span>&nbsp;<span class="op" id="3810732">[</span><span class="op" id="3810733">]</span><span class="ident" id="3810734">divisor</span>&nbsp;<span class="comment" id="3810742">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3810797">if</span>&nbsp;<span class="ident" id="3810800">b</span>&nbsp;<span class="op" id="3810802">==</span>&nbsp;<span class="num" id="3810805">10</span>&nbsp;<span class="op" id="3810808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810812">cacheBase10</span><span class="op" id="3810823">.</span><span class="ident" id="3810824">Lock</span><span class="op" id="3810828">(</span><span class="op" id="3810829">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810833">table</span>&nbsp;<span class="op" id="3810839">=</span>&nbsp;<span class="ident" id="3810841">cacheBase10</span><span class="op" id="3810852">.</span><span class="ident" id="3810853">table</span><span class="op" id="3810858">[</span><span class="num" id="3810859">0</span><span class="op" id="3810860">:</span><span class="ident" id="3810861">k</span><span class="op" id="3810862">]</span>&nbsp;<span class="comment" id="3810864">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3810904">}</span>&nbsp;<span class="keyword" id="3810906">else</span>&nbsp;<span class="op" id="3810911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3810915">table</span>&nbsp;<span class="op" id="3810921">=</span>&nbsp;<span class="builtinfunc" id="3810923">make</span><span class="op" id="3810927">(</span><span class="op" id="3810928">[</span><span class="op" id="3810929">]</span><span class="ident" id="3810930">divisor</span><span class="op" id="3810937">,</span>&nbsp;<span class="ident" id="3810939">k</span><span class="op" id="3810940">)</span>&nbsp;<span class="comment" id="3810942">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3810983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3810987">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811004">if</span>&nbsp;<span class="ident" id="3811007">table</span><span class="op" id="3811012">[</span><span class="ident" id="3811013">k</span><span class="op" id="3811014">-</span><span class="num" id="3811015">1</span><span class="op" id="3811016">]</span><span class="op" id="3811017">.</span><span class="ident" id="3811018">ndigits</span>&nbsp;<span class="op" id="3811026">==</span>&nbsp;<span class="num" id="3811029">0</span>&nbsp;<span class="op" id="3811031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3811035">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811066">var</span>&nbsp;<span class="ident" id="3811070">larger</span>&nbsp;<span class="ident" id="3811077">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811083">for</span>&nbsp;<span class="ident" id="3811087">i</span>&nbsp;<span class="op" id="3811089">:=</span>&nbsp;<span class="num" id="3811092">0</span><span class="op" id="3811093">;</span>&nbsp;<span class="ident" id="3811095">i</span>&nbsp;<span class="op" id="3811097">&lt;</span>&nbsp;<span class="ident" id="3811099">k</span><span class="op" id="3811100">;</span>&nbsp;<span class="ident" id="3811102">i</span><span class="op" id="3811103">++</span>&nbsp;<span class="op" id="3811106">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811111">if</span>&nbsp;<span class="ident" id="3811114">table</span><span class="op" id="3811119">[</span><span class="ident" id="3811120">i</span><span class="op" id="3811121">]</span><span class="op" id="3811122">.</span><span class="ident" id="3811123">ndigits</span>&nbsp;<span class="op" id="3811131">==</span>&nbsp;<span class="num" id="3811134">0</span>&nbsp;<span class="op" id="3811136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811142">if</span>&nbsp;<span class="ident" id="3811145">i</span>&nbsp;<span class="op" id="3811147">==</span>&nbsp;<span class="num" id="3811150">0</span>&nbsp;<span class="op" id="3811152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811159">table</span><span class="op" id="3811164">[</span><span class="num" id="3811165">0</span><span class="op" id="3811166">]</span><span class="op" id="3811167">.</span><span class="ident" id="3811168">bbb</span>&nbsp;<span class="op" id="3811172">=</span>&nbsp;<span class="ident" id="3811174">nat</span><span class="op" id="3811177">(</span><span class="ident" id="3811178">nil</span><span class="op" id="3811181">)</span><span class="op" id="3811182">.</span><span class="ident" id="3811183">expWW</span><span class="op" id="3811188">(</span><span class="ident" id="3811189">bb</span><span class="op" id="3811191">,</span>&nbsp;<span class="ident" id="3811193">Word</span><span class="op" id="3811197">(</span><span class="ident" id="3811198">leafSize</span><span class="op" id="3811206">)</span><span class="op" id="3811207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811214">table</span><span class="op" id="3811219">[</span><span class="num" id="3811220">0</span><span class="op" id="3811221">]</span><span class="op" id="3811222">.</span><span class="ident" id="3811223">ndigits</span>&nbsp;<span class="op" id="3811231">=</span>&nbsp;<span class="ident" id="3811233">ndigits</span>&nbsp;<span class="op" id="3811241">*</span>&nbsp;<span class="ident" id="3811243">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811256">}</span>&nbsp;<span class="keyword" id="3811258">else</span>&nbsp;<span class="op" id="3811263">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811270">table</span><span class="op" id="3811275">[</span><span class="ident" id="3811276">i</span><span class="op" id="3811277">]</span><span class="op" id="3811278">.</span><span class="ident" id="3811279">bbb</span>&nbsp;<span class="op" id="3811283">=</span>&nbsp;<span class="ident" id="3811285">nat</span><span class="op" id="3811288">(</span><span class="ident" id="3811289">nil</span><span class="op" id="3811292">)</span><span class="op" id="3811293">.</span><span class="ident" id="3811294">mul</span><span class="op" id="3811297">(</span><span class="ident" id="3811298">table</span><span class="op" id="3811303">[</span><span class="ident" id="3811304">i</span><span class="op" id="3811305">-</span><span class="num" id="3811306">1</span><span class="op" id="3811307">]</span><span class="op" id="3811308">.</span><span class="ident" id="3811309">bbb</span><span class="op" id="3811312">,</span>&nbsp;<span class="ident" id="3811314">table</span><span class="op" id="3811319">[</span><span class="ident" id="3811320">i</span><span class="op" id="3811321">-</span><span class="num" id="3811322">1</span><span class="op" id="3811323">]</span><span class="op" id="3811324">.</span><span class="ident" id="3811325">bbb</span><span class="op" id="3811328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811335">table</span><span class="op" id="3811340">[</span><span class="ident" id="3811341">i</span><span class="op" id="3811342">]</span><span class="op" id="3811343">.</span><span class="ident" id="3811344">ndigits</span>&nbsp;<span class="op" id="3811352">=</span>&nbsp;<span class="num" id="3811354">2</span>&nbsp;<span class="op" id="3811356">*</span>&nbsp;<span class="ident" id="3811358">table</span><span class="op" id="3811363">[</span><span class="ident" id="3811364">i</span><span class="op" id="3811365">-</span><span class="num" id="3811366">1</span><span class="op" id="3811367">]</span><span class="op" id="3811368">.</span><span class="ident" id="3811369">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3811388">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811455">larger</span>&nbsp;<span class="op" id="3811462">=</span>&nbsp;<span class="ident" id="3811464">nat</span><span class="op" id="3811467">(</span><span class="ident" id="3811468">nil</span><span class="op" id="3811471">)</span><span class="op" id="3811472">.</span><span class="ident" id="3811473">set</span><span class="op" id="3811476">(</span><span class="ident" id="3811477">table</span><span class="op" id="3811482">[</span><span class="ident" id="3811483">i</span><span class="op" id="3811484">]</span><span class="op" id="3811485">.</span><span class="ident" id="3811486">bbb</span><span class="op" id="3811489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811495">for</span>&nbsp;<span class="ident" id="3811499">mulAddVWW</span><span class="op" id="3811508">(</span><span class="ident" id="3811509">larger</span><span class="op" id="3811515">,</span>&nbsp;<span class="ident" id="3811517">larger</span><span class="op" id="3811523">,</span>&nbsp;<span class="ident" id="3811525">b</span><span class="op" id="3811526">,</span>&nbsp;<span class="num" id="3811528">0</span><span class="op" id="3811529">)</span>&nbsp;<span class="op" id="3811531">==</span>&nbsp;<span class="num" id="3811534">0</span>&nbsp;<span class="op" id="3811536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811543">table</span><span class="op" id="3811548">[</span><span class="ident" id="3811549">i</span><span class="op" id="3811550">]</span><span class="op" id="3811551">.</span><span class="ident" id="3811552">bbb</span>&nbsp;<span class="op" id="3811556">=</span>&nbsp;<span class="ident" id="3811558">table</span><span class="op" id="3811563">[</span><span class="ident" id="3811564">i</span><span class="op" id="3811565">]</span><span class="op" id="3811566">.</span><span class="ident" id="3811567">bbb</span><span class="op" id="3811570">.</span><span class="ident" id="3811571">set</span><span class="op" id="3811574">(</span><span class="ident" id="3811575">larger</span><span class="op" id="3811581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811588">table</span><span class="op" id="3811593">[</span><span class="ident" id="3811594">i</span><span class="op" id="3811595">]</span><span class="op" id="3811596">.</span><span class="ident" id="3811597">ndigits</span><span class="op" id="3811604">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811611">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811618">table</span><span class="op" id="3811623">[</span><span class="ident" id="3811624">i</span><span class="op" id="3811625">]</span><span class="op" id="3811626">.</span><span class="ident" id="3811627">nbits</span>&nbsp;<span class="op" id="3811633">=</span>&nbsp;<span class="ident" id="3811635">table</span><span class="op" id="3811640">[</span><span class="ident" id="3811641">i</span><span class="op" id="3811642">]</span><span class="op" id="3811643">.</span><span class="ident" id="3811644">bbb</span><span class="op" id="3811647">.</span><span class="ident" id="3811648">bitLen</span><span class="op" id="3811654">(</span><span class="op" id="3811655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811667">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811671">if</span>&nbsp;<span class="ident" id="3811674">b</span>&nbsp;<span class="op" id="3811676">==</span>&nbsp;<span class="num" id="3811679">10</span>&nbsp;<span class="op" id="3811682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3811686">cacheBase10</span><span class="op" id="3811697">.</span><span class="ident" id="3811698">Unlock</span><span class="op" id="3811704">(</span><span class="op" id="3811705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3811708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3811712">return</span>&nbsp;<span class="ident" id="3811719">table</span><br>
<span class="lineno"></span><span class="op" id="3811725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3811728">const</span>&nbsp;<span class="ident" id="3811734">deBruijn32</span>&nbsp;<span class="op" id="3811745">=</span>&nbsp;<span class="num" id="3811747">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3811759">var</span>&nbsp;<span class="ident" id="3811763">deBruijn32Lookup</span>&nbsp;<span class="op" id="3811780">=</span>&nbsp;<span class="op" id="3811782">[</span><span class="op" id="3811783">]</span><span class="builtintype" id="3811784">byte</span><span class="op" id="3811788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3811791">0</span><span class="op" id="3811792">,</span>&nbsp;<span class="num" id="3811794">1</span><span class="op" id="3811795">,</span>&nbsp;<span class="num" id="3811797">28</span><span class="op" id="3811799">,</span>&nbsp;<span class="num" id="3811801">2</span><span class="op" id="3811802">,</span>&nbsp;<span class="num" id="3811804">29</span><span class="op" id="3811806">,</span>&nbsp;<span class="num" id="3811808">14</span><span class="op" id="3811810">,</span>&nbsp;<span class="num" id="3811812">24</span><span class="op" id="3811814">,</span>&nbsp;<span class="num" id="3811816">3</span><span class="op" id="3811817">,</span>&nbsp;<span class="num" id="3811819">30</span><span class="op" id="3811821">,</span>&nbsp;<span class="num" id="3811823">22</span><span class="op" id="3811825">,</span>&nbsp;<span class="num" id="3811827">20</span><span class="op" id="3811829">,</span>&nbsp;<span class="num" id="3811831">15</span><span class="op" id="3811833">,</span>&nbsp;<span class="num" id="3811835">25</span><span class="op" id="3811837">,</span>&nbsp;<span class="num" id="3811839">17</span><span class="op" id="3811841">,</span>&nbsp;<span class="num" id="3811843">4</span><span class="op" id="3811844">,</span>&nbsp;<span class="num" id="3811846">8</span><span class="op" id="3811847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3811850">31</span><span class="op" id="3811852">,</span>&nbsp;<span class="num" id="3811854">27</span><span class="op" id="3811856">,</span>&nbsp;<span class="num" id="3811858">13</span><span class="op" id="3811860">,</span>&nbsp;<span class="num" id="3811862">23</span><span class="op" id="3811864">,</span>&nbsp;<span class="num" id="3811866">21</span><span class="op" id="3811868">,</span>&nbsp;<span class="num" id="3811870">19</span><span class="op" id="3811872">,</span>&nbsp;<span class="num" id="3811874">16</span><span class="op" id="3811876">,</span>&nbsp;<span class="num" id="3811878">7</span><span class="op" id="3811879">,</span>&nbsp;<span class="num" id="3811881">26</span><span class="op" id="3811883">,</span>&nbsp;<span class="num" id="3811885">12</span><span class="op" id="3811887">,</span>&nbsp;<span class="num" id="3811889">18</span><span class="op" id="3811891">,</span>&nbsp;<span class="num" id="3811893">6</span><span class="op" id="3811894">,</span>&nbsp;<span class="num" id="3811896">11</span><span class="op" id="3811898">,</span>&nbsp;<span class="num" id="3811900">5</span><span class="op" id="3811901">,</span>&nbsp;<span class="num" id="3811903">10</span><span class="op" id="3811905">,</span>&nbsp;<span class="num" id="3811907">9</span><span class="op" id="3811908">,</span><br>
<span class="lineno"></span><span class="op" id="3811910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3811913">const</span>&nbsp;<span class="ident" id="3811919">deBruijn64</span>&nbsp;<span class="op" id="3811930">=</span>&nbsp;<span class="num" id="3811932">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3811952">var</span>&nbsp;<span class="ident" id="3811956">deBruijn64Lookup</span>&nbsp;<span class="op" id="3811973">=</span>&nbsp;<span class="op" id="3811975">[</span><span class="op" id="3811976">]</span><span class="builtintype" id="3811977">byte</span><span class="op" id="3811981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3811984">0</span><span class="op" id="3811985">,</span>&nbsp;<span class="num" id="3811987">1</span><span class="op" id="3811988">,</span>&nbsp;<span class="num" id="3811990">56</span><span class="op" id="3811992">,</span>&nbsp;<span class="num" id="3811994">2</span><span class="op" id="3811995">,</span>&nbsp;<span class="num" id="3811997">57</span><span class="op" id="3811999">,</span>&nbsp;<span class="num" id="3812001">49</span><span class="op" id="3812003">,</span>&nbsp;<span class="num" id="3812005">28</span><span class="op" id="3812007">,</span>&nbsp;<span class="num" id="3812009">3</span><span class="op" id="3812010">,</span>&nbsp;<span class="num" id="3812012">61</span><span class="op" id="3812014">,</span>&nbsp;<span class="num" id="3812016">58</span><span class="op" id="3812018">,</span>&nbsp;<span class="num" id="3812020">42</span><span class="op" id="3812022">,</span>&nbsp;<span class="num" id="3812024">50</span><span class="op" id="3812026">,</span>&nbsp;<span class="num" id="3812028">38</span><span class="op" id="3812030">,</span>&nbsp;<span class="num" id="3812032">29</span><span class="op" id="3812034">,</span>&nbsp;<span class="num" id="3812036">17</span><span class="op" id="3812038">,</span>&nbsp;<span class="num" id="3812040">4</span><span class="op" id="3812041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3812044">62</span><span class="op" id="3812046">,</span>&nbsp;<span class="num" id="3812048">47</span><span class="op" id="3812050">,</span>&nbsp;<span class="num" id="3812052">59</span><span class="op" id="3812054">,</span>&nbsp;<span class="num" id="3812056">36</span><span class="op" id="3812058">,</span>&nbsp;<span class="num" id="3812060">45</span><span class="op" id="3812062">,</span>&nbsp;<span class="num" id="3812064">43</span><span class="op" id="3812066">,</span>&nbsp;<span class="num" id="3812068">51</span><span class="op" id="3812070">,</span>&nbsp;<span class="num" id="3812072">22</span><span class="op" id="3812074">,</span>&nbsp;<span class="num" id="3812076">53</span><span class="op" id="3812078">,</span>&nbsp;<span class="num" id="3812080">39</span><span class="op" id="3812082">,</span>&nbsp;<span class="num" id="3812084">33</span><span class="op" id="3812086">,</span>&nbsp;<span class="num" id="3812088">30</span><span class="op" id="3812090">,</span>&nbsp;<span class="num" id="3812092">24</span><span class="op" id="3812094">,</span>&nbsp;<span class="num" id="3812096">18</span><span class="op" id="3812098">,</span>&nbsp;<span class="num" id="3812100">12</span><span class="op" id="3812102">,</span>&nbsp;<span class="num" id="3812104">5</span><span class="op" id="3812105">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3812108">63</span><span class="op" id="3812110">,</span>&nbsp;<span class="num" id="3812112">55</span><span class="op" id="3812114">,</span>&nbsp;<span class="num" id="3812116">48</span><span class="op" id="3812118">,</span>&nbsp;<span class="num" id="3812120">27</span><span class="op" id="3812122">,</span>&nbsp;<span class="num" id="3812124">60</span><span class="op" id="3812126">,</span>&nbsp;<span class="num" id="3812128">41</span><span class="op" id="3812130">,</span>&nbsp;<span class="num" id="3812132">37</span><span class="op" id="3812134">,</span>&nbsp;<span class="num" id="3812136">16</span><span class="op" id="3812138">,</span>&nbsp;<span class="num" id="3812140">46</span><span class="op" id="3812142">,</span>&nbsp;<span class="num" id="3812144">35</span><span class="op" id="3812146">,</span>&nbsp;<span class="num" id="3812148">44</span><span class="op" id="3812150">,</span>&nbsp;<span class="num" id="3812152">21</span><span class="op" id="3812154">,</span>&nbsp;<span class="num" id="3812156">52</span><span class="op" id="3812158">,</span>&nbsp;<span class="num" id="3812160">32</span><span class="op" id="3812162">,</span>&nbsp;<span class="num" id="3812164">23</span><span class="op" id="3812166">,</span>&nbsp;<span class="num" id="3812168">11</span><span class="op" id="3812170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3812173">54</span><span class="op" id="3812175">,</span>&nbsp;<span class="num" id="3812177">26</span><span class="op" id="3812179">,</span>&nbsp;<span class="num" id="3812181">40</span><span class="op" id="3812183">,</span>&nbsp;<span class="num" id="3812185">15</span><span class="op" id="3812187">,</span>&nbsp;<span class="num" id="3812189">34</span><span class="op" id="3812191">,</span>&nbsp;<span class="num" id="3812193">20</span><span class="op" id="3812195">,</span>&nbsp;<span class="num" id="3812197">31</span><span class="op" id="3812199">,</span>&nbsp;<span class="num" id="3812201">10</span><span class="op" id="3812203">,</span>&nbsp;<span class="num" id="3812205">25</span><span class="op" id="3812207">,</span>&nbsp;<span class="num" id="3812209">14</span><span class="op" id="3812211">,</span>&nbsp;<span class="num" id="3812213">19</span><span class="op" id="3812215">,</span>&nbsp;<span class="num" id="3812217">9</span><span class="op" id="3812218">,</span>&nbsp;<span class="num" id="3812220">13</span><span class="op" id="3812222">,</span>&nbsp;<span class="num" id="3812224">8</span><span class="op" id="3812225">,</span>&nbsp;<span class="num" id="3812227">7</span><span class="op" id="3812228">,</span>&nbsp;<span class="num" id="3812230">6</span><span class="op" id="3812231">,</span><br>
<span class="lineno"></span><span class="op" id="3812233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3812236">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3812313">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3812327">func</span>&nbsp;<span class="ident" id="3812332">trailingZeroBits</span><span class="op" id="3812348">(</span><span class="ident" id="3812349">x</span>&nbsp;<span class="ident" id="3812351">Word</span><span class="op" id="3812355">)</span>&nbsp;<span class="builtintype" id="3812357">uint</span>&nbsp;<span class="op" id="3812362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812365">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812437">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812509">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812579">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812649">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812713">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812786">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812855">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3812902">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3812939">switch</span>&nbsp;<span class="ident" id="3812946">_W</span>&nbsp;<span class="op" id="3812949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3812952">case</span>&nbsp;<span class="num" id="3812957">32</span><span class="op" id="3812959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3812963">return</span>&nbsp;<span class="builtintype" id="3812970">uint</span><span class="op" id="3812974">(</span><span class="ident" id="3812975">deBruijn32Lookup</span><span class="op" id="3812991">[</span><span class="op" id="3812992">(</span><span class="op" id="3812993">(</span><span class="ident" id="3812994">x</span><span class="op" id="3812995">&amp;</span><span class="op" id="3812996">-</span><span class="ident" id="3812997">x</span><span class="op" id="3812998">)</span><span class="op" id="3812999">*</span><span class="ident" id="3813000">deBruijn32</span><span class="op" id="3813010">)</span><span class="op" id="3813011">&gt;&gt;</span><span class="num" id="3813013">27</span><span class="op" id="3813015">]</span><span class="op" id="3813016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813019">case</span>&nbsp;<span class="num" id="3813024">64</span><span class="op" id="3813026">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813030">return</span>&nbsp;<span class="builtintype" id="3813037">uint</span><span class="op" id="3813041">(</span><span class="ident" id="3813042">deBruijn64Lookup</span><span class="op" id="3813058">[</span><span class="op" id="3813059">(</span><span class="op" id="3813060">(</span><span class="ident" id="3813061">x</span><span class="op" id="3813062">&amp;</span><span class="op" id="3813063">-</span><span class="ident" id="3813064">x</span><span class="op" id="3813065">)</span><span class="op" id="3813066">*</span><span class="op" id="3813067">(</span><span class="ident" id="3813068">deBruijn64</span><span class="op" id="3813078">&amp;</span><span class="ident" id="3813079">_M</span><span class="op" id="3813081">)</span><span class="op" id="3813082">)</span><span class="op" id="3813083">&gt;&gt;</span><span class="num" id="3813085">58</span><span class="op" id="3813087">]</span><span class="op" id="3813088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813091">default</span><span class="op" id="3813098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3813102">panic</span><span class="op" id="3813107">(</span><span class="string" id="3813108">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3813127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3813130">}</span><br>
<span class="lineno"></span><span class="op" id="3813132">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3813135">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3813212">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3813226">func</span>&nbsp;<span class="op" id="3813231">(</span><span class="ident" id="3813232">x</span>&nbsp;<span class="ident" id="3813234">nat</span><span class="op" id="3813237">)</span>&nbsp;<span class="ident" id="3813239">trailingZeroBits</span><span class="op" id="3813255">(</span><span class="op" id="3813256">)</span>&nbsp;<span class="builtintype" id="3813258">uint</span>&nbsp;<span class="op" id="3813263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813266">if</span>&nbsp;<span class="builtinfunc" id="3813269">len</span><span class="op" id="3813272">(</span><span class="ident" id="3813273">x</span><span class="op" id="3813274">)</span>&nbsp;<span class="op" id="3813276">==</span>&nbsp;<span class="num" id="3813279">0</span>&nbsp;<span class="op" id="3813281">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813285">return</span>&nbsp;<span class="num" id="3813292">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3813295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813298">var</span>&nbsp;<span class="ident" id="3813302">i</span>&nbsp;<span class="builtintype" id="3813304">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813310">for</span>&nbsp;<span class="ident" id="3813314">x</span><span class="op" id="3813315">[</span><span class="ident" id="3813316">i</span><span class="op" id="3813317">]</span>&nbsp;<span class="op" id="3813319">==</span>&nbsp;<span class="num" id="3813322">0</span>&nbsp;<span class="op" id="3813324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813328">i</span><span class="op" id="3813329">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3813333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3813336">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813350">return</span>&nbsp;<span class="ident" id="3813357">i</span><span class="op" id="3813358">*</span><span class="ident" id="3813359">_W</span>&nbsp;<span class="op" id="3813362">+</span>&nbsp;<span class="ident" id="3813364">trailingZeroBits</span><span class="op" id="3813380">(</span><span class="ident" id="3813381">x</span><span class="op" id="3813382">[</span><span class="ident" id="3813383">i</span><span class="op" id="3813384">]</span><span class="op" id="3813385">)</span><br>
<span class="lineno"></span><span class="op" id="3813387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3813390">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3813404">func</span>&nbsp;<span class="op" id="3813409">(</span><span class="ident" id="3813410">z</span>&nbsp;<span class="ident" id="3813412">nat</span><span class="op" id="3813415">)</span>&nbsp;<span class="ident" id="3813417">shl</span><span class="op" id="3813420">(</span><span class="ident" id="3813421">x</span>&nbsp;<span class="ident" id="3813423">nat</span><span class="op" id="3813426">,</span>&nbsp;<span class="ident" id="3813428">s</span>&nbsp;<span class="builtintype" id="3813430">uint</span><span class="op" id="3813434">)</span>&nbsp;<span class="ident" id="3813436">nat</span>&nbsp;<span class="op" id="3813440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813443">m</span>&nbsp;<span class="op" id="3813445">:=</span>&nbsp;<span class="builtinfunc" id="3813448">len</span><span class="op" id="3813451">(</span><span class="ident" id="3813452">x</span><span class="op" id="3813453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813456">if</span>&nbsp;<span class="ident" id="3813459">m</span>&nbsp;<span class="op" id="3813461">==</span>&nbsp;<span class="num" id="3813464">0</span>&nbsp;<span class="op" id="3813466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813470">return</span>&nbsp;<span class="ident" id="3813477">z</span><span class="op" id="3813478">.</span><span class="builtinfunc" id="3813479">make</span><span class="op" id="3813483">(</span><span class="num" id="3813484">0</span><span class="op" id="3813485">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3813488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3813491">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813502">n</span>&nbsp;<span class="op" id="3813504">:=</span>&nbsp;<span class="ident" id="3813507">m</span>&nbsp;<span class="op" id="3813509">+</span>&nbsp;<span class="builtintype" id="3813511">int</span><span class="op" id="3813514">(</span><span class="ident" id="3813515">s</span><span class="op" id="3813516">/</span><span class="ident" id="3813517">_W</span><span class="op" id="3813519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813522">z</span>&nbsp;<span class="op" id="3813524">=</span>&nbsp;<span class="ident" id="3813526">z</span><span class="op" id="3813527">.</span><span class="builtinfunc" id="3813528">make</span><span class="op" id="3813532">(</span><span class="ident" id="3813533">n</span>&nbsp;<span class="op" id="3813535">+</span>&nbsp;<span class="num" id="3813537">1</span><span class="op" id="3813538">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813541">z</span><span class="op" id="3813542">[</span><span class="ident" id="3813543">n</span><span class="op" id="3813544">]</span>&nbsp;<span class="op" id="3813546">=</span>&nbsp;<span class="ident" id="3813548">shlVU</span><span class="op" id="3813553">(</span><span class="ident" id="3813554">z</span><span class="op" id="3813555">[</span><span class="ident" id="3813556">n</span><span class="op" id="3813557">-</span><span class="ident" id="3813558">m</span><span class="op" id="3813559">:</span><span class="ident" id="3813560">n</span><span class="op" id="3813561">]</span><span class="op" id="3813562">,</span>&nbsp;<span class="ident" id="3813564">x</span><span class="op" id="3813565">,</span>&nbsp;<span class="ident" id="3813567">s</span><span class="op" id="3813568">%</span><span class="ident" id="3813569">_W</span><span class="op" id="3813571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813574">z</span><span class="op" id="3813575">[</span><span class="num" id="3813576">0</span>&nbsp;<span class="op" id="3813578">:</span>&nbsp;<span class="ident" id="3813580">n</span><span class="op" id="3813581">-</span><span class="ident" id="3813582">m</span><span class="op" id="3813583">]</span><span class="op" id="3813584">.</span><span class="ident" id="3813585">clear</span><span class="op" id="3813590">(</span><span class="op" id="3813591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813595">return</span>&nbsp;<span class="ident" id="3813602">z</span><span class="op" id="3813603">.</span><span class="ident" id="3813604">norm</span><span class="op" id="3813608">(</span><span class="op" id="3813609">)</span><br>
<span class="lineno"></span><span class="op" id="3813611">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3813614">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3813628">func</span>&nbsp;<span class="op" id="3813633">(</span><span class="ident" id="3813634">z</span>&nbsp;<span class="ident" id="3813636">nat</span><span class="op" id="3813639">)</span>&nbsp;<span class="ident" id="3813641">shr</span><span class="op" id="3813644">(</span><span class="ident" id="3813645">x</span>&nbsp;<span class="ident" id="3813647">nat</span><span class="op" id="3813650">,</span>&nbsp;<span class="ident" id="3813652">s</span>&nbsp;<span class="builtintype" id="3813654">uint</span><span class="op" id="3813658">)</span>&nbsp;<span class="ident" id="3813660">nat</span>&nbsp;<span class="op" id="3813664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813667">m</span>&nbsp;<span class="op" id="3813669">:=</span>&nbsp;<span class="builtinfunc" id="3813672">len</span><span class="op" id="3813675">(</span><span class="ident" id="3813676">x</span><span class="op" id="3813677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813680">n</span>&nbsp;<span class="op" id="3813682">:=</span>&nbsp;<span class="ident" id="3813685">m</span>&nbsp;<span class="op" id="3813687">-</span>&nbsp;<span class="builtintype" id="3813689">int</span><span class="op" id="3813692">(</span><span class="ident" id="3813693">s</span><span class="op" id="3813694">/</span><span class="ident" id="3813695">_W</span><span class="op" id="3813697">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813700">if</span>&nbsp;<span class="ident" id="3813703">n</span>&nbsp;<span class="op" id="3813705">&lt;=</span>&nbsp;<span class="num" id="3813708">0</span>&nbsp;<span class="op" id="3813710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813714">return</span>&nbsp;<span class="ident" id="3813721">z</span><span class="op" id="3813722">.</span><span class="builtinfunc" id="3813723">make</span><span class="op" id="3813727">(</span><span class="num" id="3813728">0</span><span class="op" id="3813729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3813732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3813735">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813746">z</span>&nbsp;<span class="op" id="3813748">=</span>&nbsp;<span class="ident" id="3813750">z</span><span class="op" id="3813751">.</span><span class="builtinfunc" id="3813752">make</span><span class="op" id="3813756">(</span><span class="ident" id="3813757">n</span><span class="op" id="3813758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813761">shrVU</span><span class="op" id="3813766">(</span><span class="ident" id="3813767">z</span><span class="op" id="3813768">,</span>&nbsp;<span class="ident" id="3813770">x</span><span class="op" id="3813771">[</span><span class="ident" id="3813772">m</span><span class="op" id="3813773">-</span><span class="ident" id="3813774">n</span><span class="op" id="3813775">:</span><span class="op" id="3813776">]</span><span class="op" id="3813777">,</span>&nbsp;<span class="ident" id="3813779">s</span><span class="op" id="3813780">%</span><span class="ident" id="3813781">_W</span><span class="op" id="3813783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813787">return</span>&nbsp;<span class="ident" id="3813794">z</span><span class="op" id="3813795">.</span><span class="ident" id="3813796">norm</span><span class="op" id="3813800">(</span><span class="op" id="3813801">)</span><br>
<span class="lineno"></span><span class="op" id="3813803">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3813806">func</span>&nbsp;<span class="op" id="3813811">(</span><span class="ident" id="3813812">z</span>&nbsp;<span class="ident" id="3813814">nat</span><span class="op" id="3813817">)</span>&nbsp;<span class="ident" id="3813819">setBit</span><span class="op" id="3813825">(</span><span class="ident" id="3813826">x</span>&nbsp;<span class="ident" id="3813828">nat</span><span class="op" id="3813831">,</span>&nbsp;<span class="ident" id="3813833">i</span>&nbsp;<span class="builtintype" id="3813835">uint</span><span class="op" id="3813839">,</span>&nbsp;<span class="ident" id="3813841">b</span>&nbsp;<span class="builtintype" id="3813843">uint</span><span class="op" id="3813847">)</span>&nbsp;<span class="ident" id="3813849">nat</span>&nbsp;<span class="op" id="3813853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813856">j</span>&nbsp;<span class="op" id="3813858">:=</span>&nbsp;<span class="builtintype" id="3813861">int</span><span class="op" id="3813864">(</span><span class="ident" id="3813865">i</span>&nbsp;<span class="op" id="3813867">/</span>&nbsp;<span class="ident" id="3813869">_W</span><span class="op" id="3813871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813874">m</span>&nbsp;<span class="op" id="3813876">:=</span>&nbsp;<span class="ident" id="3813879">Word</span><span class="op" id="3813883">(</span><span class="num" id="3813884">1</span><span class="op" id="3813885">)</span>&nbsp;<span class="op" id="3813887">&lt;&lt;</span>&nbsp;<span class="op" id="3813890">(</span><span class="ident" id="3813891">i</span>&nbsp;<span class="op" id="3813893">%</span>&nbsp;<span class="ident" id="3813895">_W</span><span class="op" id="3813897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813900">n</span>&nbsp;<span class="op" id="3813902">:=</span>&nbsp;<span class="builtinfunc" id="3813905">len</span><span class="op" id="3813908">(</span><span class="ident" id="3813909">x</span><span class="op" id="3813910">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813913">switch</span>&nbsp;<span class="ident" id="3813920">b</span>&nbsp;<span class="op" id="3813922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813925">case</span>&nbsp;<span class="num" id="3813930">0</span><span class="op" id="3813931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3813935">z</span>&nbsp;<span class="op" id="3813937">=</span>&nbsp;<span class="ident" id="3813939">z</span><span class="op" id="3813940">.</span><span class="builtinfunc" id="3813941">make</span><span class="op" id="3813945">(</span><span class="ident" id="3813946">n</span><span class="op" id="3813947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3813951">copy</span><span class="op" id="3813955">(</span><span class="ident" id="3813956">z</span><span class="op" id="3813957">,</span>&nbsp;<span class="ident" id="3813959">x</span><span class="op" id="3813960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3813964">if</span>&nbsp;<span class="ident" id="3813967">j</span>&nbsp;<span class="op" id="3813969">&gt;=</span>&nbsp;<span class="ident" id="3813972">n</span>&nbsp;<span class="op" id="3813974">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3813979">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814001">return</span>&nbsp;<span class="ident" id="3814008">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814016">z</span><span class="op" id="3814017">[</span><span class="ident" id="3814018">j</span><span class="op" id="3814019">]</span>&nbsp;<span class="op" id="3814021">&amp;^=</span>&nbsp;<span class="ident" id="3814025">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814029">return</span>&nbsp;<span class="ident" id="3814036">z</span><span class="op" id="3814037">.</span><span class="ident" id="3814038">norm</span><span class="op" id="3814042">(</span><span class="op" id="3814043">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814046">case</span>&nbsp;<span class="num" id="3814051">1</span><span class="op" id="3814052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814056">if</span>&nbsp;<span class="ident" id="3814059">j</span>&nbsp;<span class="op" id="3814061">&gt;=</span>&nbsp;<span class="ident" id="3814064">n</span>&nbsp;<span class="op" id="3814066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814071">z</span>&nbsp;<span class="op" id="3814073">=</span>&nbsp;<span class="ident" id="3814075">z</span><span class="op" id="3814076">.</span><span class="builtinfunc" id="3814077">make</span><span class="op" id="3814081">(</span><span class="ident" id="3814082">j</span>&nbsp;<span class="op" id="3814084">+</span>&nbsp;<span class="num" id="3814086">1</span><span class="op" id="3814087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814092">z</span><span class="op" id="3814093">[</span><span class="ident" id="3814094">n</span><span class="op" id="3814095">:</span><span class="op" id="3814096">]</span><span class="op" id="3814097">.</span><span class="ident" id="3814098">clear</span><span class="op" id="3814103">(</span><span class="op" id="3814104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814108">}</span>&nbsp;<span class="keyword" id="3814110">else</span>&nbsp;<span class="op" id="3814115">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814120">z</span>&nbsp;<span class="op" id="3814122">=</span>&nbsp;<span class="ident" id="3814124">z</span><span class="op" id="3814125">.</span><span class="builtinfunc" id="3814126">make</span><span class="op" id="3814130">(</span><span class="ident" id="3814131">n</span><span class="op" id="3814132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3814140">copy</span><span class="op" id="3814144">(</span><span class="ident" id="3814145">z</span><span class="op" id="3814146">,</span>&nbsp;<span class="ident" id="3814148">x</span><span class="op" id="3814149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814153">z</span><span class="op" id="3814154">[</span><span class="ident" id="3814155">j</span><span class="op" id="3814156">]</span>&nbsp;<span class="op" id="3814158">|=</span>&nbsp;<span class="ident" id="3814161">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3814165">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814191">return</span>&nbsp;<span class="ident" id="3814198">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3814204">panic</span><span class="op" id="3814209">(</span><span class="string" id="3814210">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3814233">)</span><br>
<span class="lineno"></span><span class="op" id="3814235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3814238">func</span>&nbsp;<span class="op" id="3814243">(</span><span class="ident" id="3814244">z</span>&nbsp;<span class="ident" id="3814246">nat</span><span class="op" id="3814249">)</span>&nbsp;<span class="ident" id="3814251">bit</span><span class="op" id="3814254">(</span><span class="ident" id="3814255">i</span>&nbsp;<span class="builtintype" id="3814257">uint</span><span class="op" id="3814261">)</span>&nbsp;<span class="builtintype" id="3814263">uint</span>&nbsp;<span class="op" id="3814268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814271">j</span>&nbsp;<span class="op" id="3814273">:=</span>&nbsp;<span class="builtintype" id="3814276">int</span><span class="op" id="3814279">(</span><span class="ident" id="3814280">i</span>&nbsp;<span class="op" id="3814282">/</span>&nbsp;<span class="ident" id="3814284">_W</span><span class="op" id="3814286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814289">if</span>&nbsp;<span class="ident" id="3814292">j</span>&nbsp;<span class="op" id="3814294">&gt;=</span>&nbsp;<span class="builtinfunc" id="3814297">len</span><span class="op" id="3814300">(</span><span class="ident" id="3814301">z</span><span class="op" id="3814302">)</span>&nbsp;<span class="op" id="3814304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814308">return</span>&nbsp;<span class="num" id="3814315">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814318">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814321">return</span>&nbsp;<span class="builtintype" id="3814328">uint</span><span class="op" id="3814332">(</span><span class="ident" id="3814333">z</span><span class="op" id="3814334">[</span><span class="ident" id="3814335">j</span><span class="op" id="3814336">]</span>&nbsp;<span class="op" id="3814338">&gt;&gt;</span>&nbsp;<span class="op" id="3814341">(</span><span class="ident" id="3814342">i</span>&nbsp;<span class="op" id="3814344">%</span>&nbsp;<span class="ident" id="3814346">_W</span><span class="op" id="3814348">)</span>&nbsp;<span class="op" id="3814350">&amp;</span>&nbsp;<span class="num" id="3814352">1</span><span class="op" id="3814353">)</span><br>
<span class="lineno"></span><span class="op" id="3814355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3814358">func</span>&nbsp;<span class="op" id="3814363">(</span><span class="ident" id="3814364">z</span>&nbsp;<span class="ident" id="3814366">nat</span><span class="op" id="3814369">)</span>&nbsp;<span class="ident" id="3814371">and</span><span class="op" id="3814374">(</span><span class="ident" id="3814375">x</span><span class="op" id="3814376">,</span>&nbsp;<span class="ident" id="3814378">y</span>&nbsp;<span class="ident" id="3814380">nat</span><span class="op" id="3814383">)</span>&nbsp;<span class="ident" id="3814385">nat</span>&nbsp;<span class="op" id="3814389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814392">m</span>&nbsp;<span class="op" id="3814394">:=</span>&nbsp;<span class="builtinfunc" id="3814397">len</span><span class="op" id="3814400">(</span><span class="ident" id="3814401">x</span><span class="op" id="3814402">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814405">n</span>&nbsp;<span class="op" id="3814407">:=</span>&nbsp;<span class="builtinfunc" id="3814410">len</span><span class="op" id="3814413">(</span><span class="ident" id="3814414">y</span><span class="op" id="3814415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814418">if</span>&nbsp;<span class="ident" id="3814421">m</span>&nbsp;<span class="op" id="3814423">&gt;</span>&nbsp;<span class="ident" id="3814425">n</span>&nbsp;<span class="op" id="3814427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814431">m</span>&nbsp;<span class="op" id="3814433">=</span>&nbsp;<span class="ident" id="3814435">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3814441">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814453">z</span>&nbsp;<span class="op" id="3814455">=</span>&nbsp;<span class="ident" id="3814457">z</span><span class="op" id="3814458">.</span><span class="builtinfunc" id="3814459">make</span><span class="op" id="3814463">(</span><span class="ident" id="3814464">m</span><span class="op" id="3814465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814468">for</span>&nbsp;<span class="ident" id="3814472">i</span>&nbsp;<span class="op" id="3814474">:=</span>&nbsp;<span class="num" id="3814477">0</span><span class="op" id="3814478">;</span>&nbsp;<span class="ident" id="3814480">i</span>&nbsp;<span class="op" id="3814482">&lt;</span>&nbsp;<span class="ident" id="3814484">m</span><span class="op" id="3814485">;</span>&nbsp;<span class="ident" id="3814487">i</span><span class="op" id="3814488">++</span>&nbsp;<span class="op" id="3814491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814495">z</span><span class="op" id="3814496">[</span><span class="ident" id="3814497">i</span><span class="op" id="3814498">]</span>&nbsp;<span class="op" id="3814500">=</span>&nbsp;<span class="ident" id="3814502">x</span><span class="op" id="3814503">[</span><span class="ident" id="3814504">i</span><span class="op" id="3814505">]</span>&nbsp;<span class="op" id="3814507">&amp;</span>&nbsp;<span class="ident" id="3814509">y</span><span class="op" id="3814510">[</span><span class="ident" id="3814511">i</span><span class="op" id="3814512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814515">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814519">return</span>&nbsp;<span class="ident" id="3814526">z</span><span class="op" id="3814527">.</span><span class="ident" id="3814528">norm</span><span class="op" id="3814532">(</span><span class="op" id="3814533">)</span><br>
<span class="lineno"></span><span class="op" id="3814535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3814538">func</span>&nbsp;<span class="op" id="3814543">(</span><span class="ident" id="3814544">z</span>&nbsp;<span class="ident" id="3814546">nat</span><span class="op" id="3814549">)</span>&nbsp;<span class="ident" id="3814551">andNot</span><span class="op" id="3814557">(</span><span class="ident" id="3814558">x</span><span class="op" id="3814559">,</span>&nbsp;<span class="ident" id="3814561">y</span>&nbsp;<span class="ident" id="3814563">nat</span><span class="op" id="3814566">)</span>&nbsp;<span class="ident" id="3814568">nat</span>&nbsp;<span class="op" id="3814572">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814575">m</span>&nbsp;<span class="op" id="3814577">:=</span>&nbsp;<span class="builtinfunc" id="3814580">len</span><span class="op" id="3814583">(</span><span class="ident" id="3814584">x</span><span class="op" id="3814585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814588">n</span>&nbsp;<span class="op" id="3814590">:=</span>&nbsp;<span class="builtinfunc" id="3814593">len</span><span class="op" id="3814596">(</span><span class="ident" id="3814597">y</span><span class="op" id="3814598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814601">if</span>&nbsp;<span class="ident" id="3814604">n</span>&nbsp;<span class="op" id="3814606">&gt;</span>&nbsp;<span class="ident" id="3814608">m</span>&nbsp;<span class="op" id="3814610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814614">n</span>&nbsp;<span class="op" id="3814616">=</span>&nbsp;<span class="ident" id="3814618">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814621">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3814624">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814636">z</span>&nbsp;<span class="op" id="3814638">=</span>&nbsp;<span class="ident" id="3814640">z</span><span class="op" id="3814641">.</span><span class="builtinfunc" id="3814642">make</span><span class="op" id="3814646">(</span><span class="ident" id="3814647">m</span><span class="op" id="3814648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814651">for</span>&nbsp;<span class="ident" id="3814655">i</span>&nbsp;<span class="op" id="3814657">:=</span>&nbsp;<span class="num" id="3814660">0</span><span class="op" id="3814661">;</span>&nbsp;<span class="ident" id="3814663">i</span>&nbsp;<span class="op" id="3814665">&lt;</span>&nbsp;<span class="ident" id="3814667">n</span><span class="op" id="3814668">;</span>&nbsp;<span class="ident" id="3814670">i</span><span class="op" id="3814671">++</span>&nbsp;<span class="op" id="3814674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814678">z</span><span class="op" id="3814679">[</span><span class="ident" id="3814680">i</span><span class="op" id="3814681">]</span>&nbsp;<span class="op" id="3814683">=</span>&nbsp;<span class="ident" id="3814685">x</span><span class="op" id="3814686">[</span><span class="ident" id="3814687">i</span><span class="op" id="3814688">]</span>&nbsp;<span class="op" id="3814690">&amp;^</span>&nbsp;<span class="ident" id="3814693">y</span><span class="op" id="3814694">[</span><span class="ident" id="3814695">i</span><span class="op" id="3814696">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3814702">copy</span><span class="op" id="3814706">(</span><span class="ident" id="3814707">z</span><span class="op" id="3814708">[</span><span class="ident" id="3814709">n</span><span class="op" id="3814710">:</span><span class="ident" id="3814711">m</span><span class="op" id="3814712">]</span><span class="op" id="3814713">,</span>&nbsp;<span class="ident" id="3814715">x</span><span class="op" id="3814716">[</span><span class="ident" id="3814717">n</span><span class="op" id="3814718">:</span><span class="ident" id="3814719">m</span><span class="op" id="3814720">]</span><span class="op" id="3814721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814725">return</span>&nbsp;<span class="ident" id="3814732">z</span><span class="op" id="3814733">.</span><span class="ident" id="3814734">norm</span><span class="op" id="3814738">(</span><span class="op" id="3814739">)</span><br>
<span class="lineno"></span><span class="op" id="3814741">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3814744">func</span>&nbsp;<span class="op" id="3814749">(</span><span class="ident" id="3814750">z</span>&nbsp;<span class="ident" id="3814752">nat</span><span class="op" id="3814755">)</span>&nbsp;<span class="ident" id="3814757">or</span><span class="op" id="3814759">(</span><span class="ident" id="3814760">x</span><span class="op" id="3814761">,</span>&nbsp;<span class="ident" id="3814763">y</span>&nbsp;<span class="ident" id="3814765">nat</span><span class="op" id="3814768">)</span>&nbsp;<span class="ident" id="3814770">nat</span>&nbsp;<span class="op" id="3814774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814777">m</span>&nbsp;<span class="op" id="3814779">:=</span>&nbsp;<span class="builtinfunc" id="3814782">len</span><span class="op" id="3814785">(</span><span class="ident" id="3814786">x</span><span class="op" id="3814787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814790">n</span>&nbsp;<span class="op" id="3814792">:=</span>&nbsp;<span class="builtinfunc" id="3814795">len</span><span class="op" id="3814798">(</span><span class="ident" id="3814799">y</span><span class="op" id="3814800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814803">s</span>&nbsp;<span class="op" id="3814805">:=</span>&nbsp;<span class="ident" id="3814808">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814811">if</span>&nbsp;<span class="ident" id="3814814">m</span>&nbsp;<span class="op" id="3814816">&lt;</span>&nbsp;<span class="ident" id="3814818">n</span>&nbsp;<span class="op" id="3814820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814824">n</span><span class="op" id="3814825">,</span>&nbsp;<span class="ident" id="3814827">m</span>&nbsp;<span class="op" id="3814829">=</span>&nbsp;<span class="ident" id="3814831">m</span><span class="op" id="3814832">,</span>&nbsp;<span class="ident" id="3814834">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814838">s</span>&nbsp;<span class="op" id="3814840">=</span>&nbsp;<span class="ident" id="3814842">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3814848">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814860">z</span>&nbsp;<span class="op" id="3814862">=</span>&nbsp;<span class="ident" id="3814864">z</span><span class="op" id="3814865">.</span><span class="builtinfunc" id="3814866">make</span><span class="op" id="3814870">(</span><span class="ident" id="3814871">m</span><span class="op" id="3814872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814875">for</span>&nbsp;<span class="ident" id="3814879">i</span>&nbsp;<span class="op" id="3814881">:=</span>&nbsp;<span class="num" id="3814884">0</span><span class="op" id="3814885">;</span>&nbsp;<span class="ident" id="3814887">i</span>&nbsp;<span class="op" id="3814889">&lt;</span>&nbsp;<span class="ident" id="3814891">n</span><span class="op" id="3814892">;</span>&nbsp;<span class="ident" id="3814894">i</span><span class="op" id="3814895">++</span>&nbsp;<span class="op" id="3814898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3814902">z</span><span class="op" id="3814903">[</span><span class="ident" id="3814904">i</span><span class="op" id="3814905">]</span>&nbsp;<span class="op" id="3814907">=</span>&nbsp;<span class="ident" id="3814909">x</span><span class="op" id="3814910">[</span><span class="ident" id="3814911">i</span><span class="op" id="3814912">]</span>&nbsp;<span class="op" id="3814914">|</span>&nbsp;<span class="ident" id="3814916">y</span><span class="op" id="3814917">[</span><span class="ident" id="3814918">i</span><span class="op" id="3814919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3814922">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3814925">copy</span><span class="op" id="3814929">(</span><span class="ident" id="3814930">z</span><span class="op" id="3814931">[</span><span class="ident" id="3814932">n</span><span class="op" id="3814933">:</span><span class="ident" id="3814934">m</span><span class="op" id="3814935">]</span><span class="op" id="3814936">,</span>&nbsp;<span class="ident" id="3814938">s</span><span class="op" id="3814939">[</span><span class="ident" id="3814940">n</span><span class="op" id="3814941">:</span><span class="ident" id="3814942">m</span><span class="op" id="3814943">]</span><span class="op" id="3814944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3814948">return</span>&nbsp;<span class="ident" id="3814955">z</span><span class="op" id="3814956">.</span><span class="ident" id="3814957">norm</span><span class="op" id="3814961">(</span><span class="op" id="3814962">)</span><br>
<span class="lineno"></span><span class="op" id="3814964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3814967">func</span>&nbsp;<span class="op" id="3814972">(</span><span class="ident" id="3814973">z</span>&nbsp;<span class="ident" id="3814975">nat</span><span class="op" id="3814978">)</span>&nbsp;<span class="ident" id="3814980">xor</span><span class="op" id="3814983">(</span><span class="ident" id="3814984">x</span><span class="op" id="3814985">,</span>&nbsp;<span class="ident" id="3814987">y</span>&nbsp;<span class="ident" id="3814989">nat</span><span class="op" id="3814992">)</span>&nbsp;<span class="ident" id="3814994">nat</span>&nbsp;<span class="op" id="3814998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815001">m</span>&nbsp;<span class="op" id="3815003">:=</span>&nbsp;<span class="builtinfunc" id="3815006">len</span><span class="op" id="3815009">(</span><span class="ident" id="3815010">x</span><span class="op" id="3815011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815014">n</span>&nbsp;<span class="op" id="3815016">:=</span>&nbsp;<span class="builtinfunc" id="3815019">len</span><span class="op" id="3815022">(</span><span class="ident" id="3815023">y</span><span class="op" id="3815024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815027">s</span>&nbsp;<span class="op" id="3815029">:=</span>&nbsp;<span class="ident" id="3815032">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815035">if</span>&nbsp;<span class="ident" id="3815038">m</span>&nbsp;<span class="op" id="3815040">&lt;</span>&nbsp;<span class="ident" id="3815042">n</span>&nbsp;<span class="op" id="3815044">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815048">n</span><span class="op" id="3815049">,</span>&nbsp;<span class="ident" id="3815051">m</span>&nbsp;<span class="op" id="3815053">=</span>&nbsp;<span class="ident" id="3815055">m</span><span class="op" id="3815056">,</span>&nbsp;<span class="ident" id="3815058">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815062">s</span>&nbsp;<span class="op" id="3815064">=</span>&nbsp;<span class="ident" id="3815066">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3815069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3815072">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815084">z</span>&nbsp;<span class="op" id="3815086">=</span>&nbsp;<span class="ident" id="3815088">z</span><span class="op" id="3815089">.</span><span class="builtinfunc" id="3815090">make</span><span class="op" id="3815094">(</span><span class="ident" id="3815095">m</span><span class="op" id="3815096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815099">for</span>&nbsp;<span class="ident" id="3815103">i</span>&nbsp;<span class="op" id="3815105">:=</span>&nbsp;<span class="num" id="3815108">0</span><span class="op" id="3815109">;</span>&nbsp;<span class="ident" id="3815111">i</span>&nbsp;<span class="op" id="3815113">&lt;</span>&nbsp;<span class="ident" id="3815115">n</span><span class="op" id="3815116">;</span>&nbsp;<span class="ident" id="3815118">i</span><span class="op" id="3815119">++</span>&nbsp;<span class="op" id="3815122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815126">z</span><span class="op" id="3815127">[</span><span class="ident" id="3815128">i</span><span class="op" id="3815129">]</span>&nbsp;<span class="op" id="3815131">=</span>&nbsp;<span class="ident" id="3815133">x</span><span class="op" id="3815134">[</span><span class="ident" id="3815135">i</span><span class="op" id="3815136">]</span>&nbsp;<span class="op" id="3815138">^</span>&nbsp;<span class="ident" id="3815140">y</span><span class="op" id="3815141">[</span><span class="ident" id="3815142">i</span><span class="op" id="3815143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3815146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3815149">copy</span><span class="op" id="3815153">(</span><span class="ident" id="3815154">z</span><span class="op" id="3815155">[</span><span class="ident" id="3815156">n</span><span class="op" id="3815157">:</span><span class="ident" id="3815158">m</span><span class="op" id="3815159">]</span><span class="op" id="3815160">,</span>&nbsp;<span class="ident" id="3815162">s</span><span class="op" id="3815163">[</span><span class="ident" id="3815164">n</span><span class="op" id="3815165">:</span><span class="ident" id="3815166">m</span><span class="op" id="3815167">]</span><span class="op" id="3815168">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815172">return</span>&nbsp;<span class="ident" id="3815179">z</span><span class="op" id="3815180">.</span><span class="ident" id="3815181">norm</span><span class="op" id="3815185">(</span><span class="op" id="3815186">)</span><br>
<span class="lineno"></span><span class="op" id="3815188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3815191">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3815253">func</span>&nbsp;<span class="ident" id="3815258">greaterThan</span><span class="op" id="3815269">(</span><span class="ident" id="3815270">x1</span><span class="op" id="3815272">,</span>&nbsp;<span class="ident" id="3815274">x2</span><span class="op" id="3815276">,</span>&nbsp;<span class="ident" id="3815278">y1</span><span class="op" id="3815280">,</span>&nbsp;<span class="ident" id="3815282">y2</span>&nbsp;<span class="ident" id="3815285">Word</span><span class="op" id="3815289">)</span>&nbsp;<span class="builtintype" id="3815291">bool</span>&nbsp;<span class="op" id="3815296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815299">return</span>&nbsp;<span class="ident" id="3815306">x1</span>&nbsp;<span class="op" id="3815309">&gt;</span>&nbsp;<span class="ident" id="3815311">y1</span>&nbsp;<span class="op" id="3815314">||</span>&nbsp;<span class="ident" id="3815317">x1</span>&nbsp;<span class="op" id="3815320">==</span>&nbsp;<span class="ident" id="3815323">y1</span>&nbsp;<span class="op" id="3815326">&amp;&amp;</span>&nbsp;<span class="ident" id="3815329">x2</span>&nbsp;<span class="op" id="3815332">&gt;</span>&nbsp;<span class="ident" id="3815334">y2</span><br>
<span class="lineno"></span><span class="op" id="3815337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3815340">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3815363">func</span>&nbsp;<span class="op" id="3815368">(</span><span class="ident" id="3815369">x</span>&nbsp;<span class="ident" id="3815371">nat</span><span class="op" id="3815374">)</span>&nbsp;<span class="ident" id="3815376">modW</span><span class="op" id="3815380">(</span><span class="ident" id="3815381">d</span>&nbsp;<span class="ident" id="3815383">Word</span><span class="op" id="3815387">)</span>&nbsp;<span class="op" id="3815389">(</span><span class="ident" id="3815390">r</span>&nbsp;<span class="ident" id="3815392">Word</span><span class="op" id="3815396">)</span>&nbsp;<span class="op" id="3815398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3815401">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815461">var</span>&nbsp;<span class="ident" id="3815465">q</span>&nbsp;<span class="ident" id="3815467">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815472">q</span>&nbsp;<span class="op" id="3815474">=</span>&nbsp;<span class="ident" id="3815476">q</span><span class="op" id="3815477">.</span><span class="builtinfunc" id="3815478">make</span><span class="op" id="3815482">(</span><span class="builtinfunc" id="3815483">len</span><span class="op" id="3815486">(</span><span class="ident" id="3815487">x</span><span class="op" id="3815488">)</span><span class="op" id="3815489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815492">return</span>&nbsp;<span class="ident" id="3815499">divWVW</span><span class="op" id="3815505">(</span><span class="ident" id="3815506">q</span><span class="op" id="3815507">,</span>&nbsp;<span class="num" id="3815509">0</span><span class="op" id="3815510">,</span>&nbsp;<span class="ident" id="3815512">x</span><span class="op" id="3815513">,</span>&nbsp;<span class="ident" id="3815515">d</span><span class="op" id="3815516">)</span><br>
<span class="lineno">1190</span><span class="op" id="3815518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3815521">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3815595">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3815638">func</span>&nbsp;<span class="op" id="3815643">(</span><span class="ident" id="3815644">z</span>&nbsp;<span class="ident" id="3815646">nat</span><span class="op" id="3815649">)</span>&nbsp;<span class="ident" id="3815651">random</span><span class="op" id="3815657">(</span><span class="ident" id="3815658">rand</span>&nbsp;<span class="op" id="3815663">*</span><span class="ident" id="3815664">rand</span><span class="op" id="3815668">.</span><span class="ident" id="3815669">Rand</span><span class="op" id="3815673">,</span>&nbsp;<span class="ident" id="3815675">limit</span>&nbsp;<span class="ident" id="3815681">nat</span><span class="op" id="3815684">,</span>&nbsp;<span class="ident" id="3815686">n</span>&nbsp;<span class="builtintype" id="3815688">int</span><span class="op" id="3815691">)</span>&nbsp;<span class="ident" id="3815693">nat</span>&nbsp;<span class="op" id="3815697">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815700">if</span>&nbsp;<span class="ident" id="3815703">alias</span><span class="op" id="3815708">(</span><span class="ident" id="3815709">z</span><span class="op" id="3815710">,</span>&nbsp;<span class="ident" id="3815712">limit</span><span class="op" id="3815717">)</span>&nbsp;<span class="op" id="3815719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815723">z</span>&nbsp;<span class="op" id="3815725">=</span>&nbsp;<span class="ident" id="3815727">nil</span>&nbsp;<span class="comment" id="3815731">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3815774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815777">z</span>&nbsp;<span class="op" id="3815779">=</span>&nbsp;<span class="ident" id="3815781">z</span><span class="op" id="3815782">.</span><span class="builtinfunc" id="3815783">make</span><span class="op" id="3815787">(</span><span class="builtinfunc" id="3815788">len</span><span class="op" id="3815791">(</span><span class="ident" id="3815792">limit</span><span class="op" id="3815797">)</span><span class="op" id="3815798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815802">bitLengthOfMSW</span>&nbsp;<span class="op" id="3815817">:=</span>&nbsp;<span class="builtintype" id="3815820">uint</span><span class="op" id="3815824">(</span><span class="ident" id="3815825">n</span>&nbsp;<span class="op" id="3815827">%</span>&nbsp;<span class="ident" id="3815829">_W</span><span class="op" id="3815831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815834">if</span>&nbsp;<span class="ident" id="3815837">bitLengthOfMSW</span>&nbsp;<span class="op" id="3815852">==</span>&nbsp;<span class="num" id="3815855">0</span>&nbsp;<span class="op" id="3815857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815861">bitLengthOfMSW</span>&nbsp;<span class="op" id="3815876">=</span>&nbsp;<span class="ident" id="3815878">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3815882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815885">mask</span>&nbsp;<span class="op" id="3815890">:=</span>&nbsp;<span class="ident" id="3815893">Word</span><span class="op" id="3815897">(</span><span class="op" id="3815898">(</span><span class="num" id="3815899">1</span>&nbsp;<span class="op" id="3815901">&lt;&lt;</span>&nbsp;<span class="ident" id="3815904">bitLengthOfMSW</span><span class="op" id="3815918">)</span>&nbsp;<span class="op" id="3815920">-</span>&nbsp;<span class="num" id="3815922">1</span><span class="op" id="3815923">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815927">for</span>&nbsp;<span class="op" id="3815931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815935">switch</span>&nbsp;<span class="ident" id="3815942">_W</span>&nbsp;<span class="op" id="3815945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815949">case</span>&nbsp;<span class="num" id="3815954">32</span><span class="op" id="3815956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3815961">for</span>&nbsp;<span class="ident" id="3815965">i</span>&nbsp;<span class="op" id="3815967">:=</span>&nbsp;<span class="keyword" id="3815970">range</span>&nbsp;<span class="ident" id="3815976">z</span>&nbsp;<span class="op" id="3815978">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3815984">z</span><span class="op" id="3815985">[</span><span class="ident" id="3815986">i</span><span class="op" id="3815987">]</span>&nbsp;<span class="op" id="3815989">=</span>&nbsp;<span class="ident" id="3815991">Word</span><span class="op" id="3815995">(</span><span class="ident" id="3815996">rand</span><span class="op" id="3816000">.</span><span class="ident" id="3816001">Uint32</span><span class="op" id="3816007">(</span><span class="op" id="3816008">)</span><span class="op" id="3816009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816018">case</span>&nbsp;<span class="num" id="3816023">64</span><span class="op" id="3816025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816030">for</span>&nbsp;<span class="ident" id="3816034">i</span>&nbsp;<span class="op" id="3816036">:=</span>&nbsp;<span class="keyword" id="3816039">range</span>&nbsp;<span class="ident" id="3816045">z</span>&nbsp;<span class="op" id="3816047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816053">z</span><span class="op" id="3816054">[</span><span class="ident" id="3816055">i</span><span class="op" id="3816056">]</span>&nbsp;<span class="op" id="3816058">=</span>&nbsp;<span class="ident" id="3816060">Word</span><span class="op" id="3816064">(</span><span class="ident" id="3816065">rand</span><span class="op" id="3816069">.</span><span class="ident" id="3816070">Uint32</span><span class="op" id="3816076">(</span><span class="op" id="3816077">)</span><span class="op" id="3816078">)</span>&nbsp;<span class="op" id="3816080">|</span>&nbsp;<span class="ident" id="3816082">Word</span><span class="op" id="3816086">(</span><span class="ident" id="3816087">rand</span><span class="op" id="3816091">.</span><span class="ident" id="3816092">Uint32</span><span class="op" id="3816098">(</span><span class="op" id="3816099">)</span><span class="op" id="3816100">)</span><span class="op" id="3816101">&lt;&lt;</span><span class="num" id="3816103">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816113">default</span><span class="op" id="3816120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3816125">panic</span><span class="op" id="3816130">(</span><span class="string" id="3816131">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3816150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816158">z</span><span class="op" id="3816159">[</span><span class="builtinfunc" id="3816160">len</span><span class="op" id="3816163">(</span><span class="ident" id="3816164">limit</span><span class="op" id="3816169">)</span><span class="op" id="3816170">-</span><span class="num" id="3816171">1</span><span class="op" id="3816172">]</span>&nbsp;<span class="op" id="3816174">&amp;=</span>&nbsp;<span class="ident" id="3816177">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816184">if</span>&nbsp;<span class="ident" id="3816187">z</span><span class="op" id="3816188">.</span><span class="ident" id="3816189">cmp</span><span class="op" id="3816192">(</span><span class="ident" id="3816193">limit</span><span class="op" id="3816198">)</span>&nbsp;<span class="op" id="3816200">&lt;</span>&nbsp;<span class="num" id="3816202">0</span>&nbsp;<span class="op" id="3816204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816209">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816224">return</span>&nbsp;<span class="ident" id="3816231">z</span><span class="op" id="3816232">.</span><span class="ident" id="3816233">norm</span><span class="op" id="3816237">(</span><span class="op" id="3816238">)</span><br>
<span class="lineno"></span><span class="op" id="3816240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3816243">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3816305">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3816367">func</span>&nbsp;<span class="op" id="3816372">(</span><span class="ident" id="3816373">z</span>&nbsp;<span class="ident" id="3816375">nat</span><span class="op" id="3816378">)</span>&nbsp;<span class="ident" id="3816380">expNN</span><span class="op" id="3816385">(</span><span class="ident" id="3816386">x</span><span class="op" id="3816387">,</span>&nbsp;<span class="ident" id="3816389">y</span><span class="op" id="3816390">,</span>&nbsp;<span class="ident" id="3816392">m</span>&nbsp;<span class="ident" id="3816394">nat</span><span class="op" id="3816397">)</span>&nbsp;<span class="ident" id="3816399">nat</span>&nbsp;<span class="op" id="3816403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816406">if</span>&nbsp;<span class="ident" id="3816409">alias</span><span class="op" id="3816414">(</span><span class="ident" id="3816415">z</span><span class="op" id="3816416">,</span>&nbsp;<span class="ident" id="3816418">x</span><span class="op" id="3816419">)</span>&nbsp;<span class="op" id="3816421">||</span>&nbsp;<span class="ident" id="3816424">alias</span><span class="op" id="3816429">(</span><span class="ident" id="3816430">z</span><span class="op" id="3816431">,</span>&nbsp;<span class="ident" id="3816433">y</span><span class="op" id="3816434">)</span>&nbsp;<span class="op" id="3816436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816440">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816494">z</span>&nbsp;<span class="op" id="3816496">=</span>&nbsp;<span class="ident" id="3816498">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816503">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816507">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816527">if</span>&nbsp;<span class="builtinfunc" id="3816530">len</span><span class="op" id="3816533">(</span><span class="ident" id="3816534">m</span><span class="op" id="3816535">)</span>&nbsp;<span class="op" id="3816537">==</span>&nbsp;<span class="num" id="3816540">1</span>&nbsp;<span class="op" id="3816542">&amp;&amp;</span>&nbsp;<span class="ident" id="3816545">m</span><span class="op" id="3816546">[</span><span class="num" id="3816547">0</span><span class="op" id="3816548">]</span>&nbsp;<span class="op" id="3816550">==</span>&nbsp;<span class="num" id="3816553">1</span>&nbsp;<span class="op" id="3816555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816559">return</span>&nbsp;<span class="ident" id="3816566">z</span><span class="op" id="3816567">.</span><span class="ident" id="3816568">setWord</span><span class="op" id="3816575">(</span><span class="num" id="3816576">0</span><span class="op" id="3816577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816580">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816583">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816604">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816618">if</span>&nbsp;<span class="builtinfunc" id="3816621">len</span><span class="op" id="3816624">(</span><span class="ident" id="3816625">y</span><span class="op" id="3816626">)</span>&nbsp;<span class="op" id="3816628">==</span>&nbsp;<span class="num" id="3816631">0</span>&nbsp;<span class="op" id="3816633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816637">return</span>&nbsp;<span class="ident" id="3816644">z</span><span class="op" id="3816645">.</span><span class="ident" id="3816646">setWord</span><span class="op" id="3816653">(</span><span class="num" id="3816654">1</span><span class="op" id="3816655">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816661">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3816672">if</span>&nbsp;<span class="builtinfunc" id="3816675">len</span><span class="op" id="3816678">(</span><span class="ident" id="3816679">m</span><span class="op" id="3816680">)</span>&nbsp;<span class="op" id="3816682">!=</span>&nbsp;<span class="num" id="3816685">0</span>&nbsp;<span class="op" id="3816687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816691">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816743">z</span>&nbsp;<span class="op" id="3816745">=</span>&nbsp;<span class="ident" id="3816747">z</span><span class="op" id="3816748">.</span><span class="builtinfunc" id="3816749">make</span><span class="op" id="3816753">(</span><span class="builtinfunc" id="3816754">len</span><span class="op" id="3816757">(</span><span class="ident" id="3816758">m</span><span class="op" id="3816759">)</span><span class="op" id="3816760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3816763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816766">z</span>&nbsp;<span class="op" id="3816768">=</span>&nbsp;<span class="ident" id="3816770">z</span><span class="op" id="3816771">.</span><span class="ident" id="3816772">set</span><span class="op" id="3816775">(</span><span class="ident" id="3816776">x</span><span class="op" id="3816777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816781">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816846">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816919">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3816989">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817055">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817071">if</span>&nbsp;<span class="builtinfunc" id="3817074">len</span><span class="op" id="3817077">(</span><span class="ident" id="3817078">x</span><span class="op" id="3817079">)</span>&nbsp;<span class="op" id="3817081">&gt;</span>&nbsp;<span class="num" id="3817083">1</span>&nbsp;<span class="op" id="3817085">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3817088">len</span><span class="op" id="3817091">(</span><span class="ident" id="3817092">y</span><span class="op" id="3817093">)</span>&nbsp;<span class="op" id="3817095">&gt;</span>&nbsp;<span class="num" id="3817097">1</span>&nbsp;<span class="op" id="3817099">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3817102">len</span><span class="op" id="3817105">(</span><span class="ident" id="3817106">m</span><span class="op" id="3817107">)</span>&nbsp;<span class="op" id="3817109">&gt;</span>&nbsp;<span class="num" id="3817111">0</span>&nbsp;<span class="op" id="3817113">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817117">return</span>&nbsp;<span class="ident" id="3817124">z</span><span class="op" id="3817125">.</span><span class="ident" id="3817126">expNNWindowed</span><span class="op" id="3817139">(</span><span class="ident" id="3817140">x</span><span class="op" id="3817141">,</span>&nbsp;<span class="ident" id="3817143">y</span><span class="op" id="3817144">,</span>&nbsp;<span class="ident" id="3817146">m</span><span class="op" id="3817147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3817150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817154">v</span>&nbsp;<span class="op" id="3817156">:=</span>&nbsp;<span class="ident" id="3817159">y</span><span class="op" id="3817160">[</span><span class="builtinfunc" id="3817161">len</span><span class="op" id="3817164">(</span><span class="ident" id="3817165">y</span><span class="op" id="3817166">)</span><span class="op" id="3817167">-</span><span class="num" id="3817168">1</span><span class="op" id="3817169">]</span>&nbsp;<span class="comment" id="3817171">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817215">shift</span>&nbsp;<span class="op" id="3817221">:=</span>&nbsp;<span class="ident" id="3817224">leadingZeros</span><span class="op" id="3817236">(</span><span class="ident" id="3817237">v</span><span class="op" id="3817238">)</span>&nbsp;<span class="op" id="3817240">+</span>&nbsp;<span class="num" id="3817242">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817245">v</span>&nbsp;<span class="op" id="3817247">&lt;&lt;=</span>&nbsp;<span class="ident" id="3817251">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817258">var</span>&nbsp;<span class="ident" id="3817262">q</span>&nbsp;<span class="ident" id="3817264">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817270">const</span>&nbsp;<span class="ident" id="3817276">mask</span>&nbsp;<span class="op" id="3817281">=</span>&nbsp;<span class="num" id="3817283">1</span>&nbsp;<span class="op" id="3817285">&lt;&lt;</span>&nbsp;<span class="op" id="3817288">(</span><span class="ident" id="3817289">_W</span>&nbsp;<span class="op" id="3817292">-</span>&nbsp;<span class="num" id="3817294">1</span><span class="op" id="3817295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817299">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817369">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817441">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817499">w</span>&nbsp;<span class="op" id="3817501">:=</span>&nbsp;<span class="ident" id="3817504">_W</span>&nbsp;<span class="op" id="3817507">-</span>&nbsp;<span class="builtintype" id="3817509">int</span><span class="op" id="3817512">(</span><span class="ident" id="3817513">shift</span><span class="op" id="3817518">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817521">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817581">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817622">var</span>&nbsp;<span class="ident" id="3817626">zz</span><span class="op" id="3817628">,</span>&nbsp;<span class="ident" id="3817630">r</span>&nbsp;<span class="ident" id="3817632">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817637">for</span>&nbsp;<span class="ident" id="3817641">j</span>&nbsp;<span class="op" id="3817643">:=</span>&nbsp;<span class="num" id="3817646">0</span><span class="op" id="3817647">;</span>&nbsp;<span class="ident" id="3817649">j</span>&nbsp;<span class="op" id="3817651">&lt;</span>&nbsp;<span class="ident" id="3817653">w</span><span class="op" id="3817654">;</span>&nbsp;<span class="ident" id="3817656">j</span><span class="op" id="3817657">++</span>&nbsp;<span class="op" id="3817660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817664">zz</span>&nbsp;<span class="op" id="3817667">=</span>&nbsp;<span class="ident" id="3817669">zz</span><span class="op" id="3817671">.</span><span class="ident" id="3817672">mul</span><span class="op" id="3817675">(</span><span class="ident" id="3817676">z</span><span class="op" id="3817677">,</span>&nbsp;<span class="ident" id="3817679">z</span><span class="op" id="3817680">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817684">zz</span><span class="op" id="3817686">,</span>&nbsp;<span class="ident" id="3817688">z</span>&nbsp;<span class="op" id="3817690">=</span>&nbsp;<span class="ident" id="3817692">z</span><span class="op" id="3817693">,</span>&nbsp;<span class="ident" id="3817695">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817701">if</span>&nbsp;<span class="ident" id="3817704">v</span><span class="op" id="3817705">&amp;</span><span class="ident" id="3817706">mask</span>&nbsp;<span class="op" id="3817711">!=</span>&nbsp;<span class="num" id="3817714">0</span>&nbsp;<span class="op" id="3817716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817721">zz</span>&nbsp;<span class="op" id="3817724">=</span>&nbsp;<span class="ident" id="3817726">zz</span><span class="op" id="3817728">.</span><span class="ident" id="3817729">mul</span><span class="op" id="3817732">(</span><span class="ident" id="3817733">z</span><span class="op" id="3817734">,</span>&nbsp;<span class="ident" id="3817736">x</span><span class="op" id="3817737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817742">zz</span><span class="op" id="3817744">,</span>&nbsp;<span class="ident" id="3817746">z</span>&nbsp;<span class="op" id="3817748">=</span>&nbsp;<span class="ident" id="3817750">z</span><span class="op" id="3817751">,</span>&nbsp;<span class="ident" id="3817753">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3817758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817763">if</span>&nbsp;<span class="builtinfunc" id="3817766">len</span><span class="op" id="3817769">(</span><span class="ident" id="3817770">m</span><span class="op" id="3817771">)</span>&nbsp;<span class="op" id="3817773">!=</span>&nbsp;<span class="num" id="3817776">0</span>&nbsp;<span class="op" id="3817778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817783">zz</span><span class="op" id="3817785">,</span>&nbsp;<span class="ident" id="3817787">r</span>&nbsp;<span class="op" id="3817789">=</span>&nbsp;<span class="ident" id="3817791">zz</span><span class="op" id="3817793">.</span><span class="ident" id="3817794">div</span><span class="op" id="3817797">(</span><span class="ident" id="3817798">r</span><span class="op" id="3817799">,</span>&nbsp;<span class="ident" id="3817801">z</span><span class="op" id="3817802">,</span>&nbsp;<span class="ident" id="3817804">m</span><span class="op" id="3817805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817810">zz</span><span class="op" id="3817812">,</span>&nbsp;<span class="ident" id="3817814">r</span><span class="op" id="3817815">,</span>&nbsp;<span class="ident" id="3817817">q</span><span class="op" id="3817818">,</span>&nbsp;<span class="ident" id="3817820">z</span>&nbsp;<span class="op" id="3817822">=</span>&nbsp;<span class="ident" id="3817824">q</span><span class="op" id="3817825">,</span>&nbsp;<span class="ident" id="3817827">z</span><span class="op" id="3817828">,</span>&nbsp;<span class="ident" id="3817830">zz</span><span class="op" id="3817832">,</span>&nbsp;<span class="ident" id="3817834">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3817838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817843">v</span>&nbsp;<span class="op" id="3817845">&lt;&lt;=</span>&nbsp;<span class="num" id="3817849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3817852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817856">for</span>&nbsp;<span class="ident" id="3817860">i</span>&nbsp;<span class="op" id="3817862">:=</span>&nbsp;<span class="builtinfunc" id="3817865">len</span><span class="op" id="3817868">(</span><span class="ident" id="3817869">y</span><span class="op" id="3817870">)</span>&nbsp;<span class="op" id="3817872">-</span>&nbsp;<span class="num" id="3817874">2</span><span class="op" id="3817875">;</span>&nbsp;<span class="ident" id="3817877">i</span>&nbsp;<span class="op" id="3817879">&gt;=</span>&nbsp;<span class="num" id="3817882">0</span><span class="op" id="3817883">;</span>&nbsp;<span class="ident" id="3817885">i</span><span class="op" id="3817886">--</span>&nbsp;<span class="op" id="3817889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817893">v</span>&nbsp;<span class="op" id="3817895">=</span>&nbsp;<span class="ident" id="3817897">y</span><span class="op" id="3817898">[</span><span class="ident" id="3817899">i</span><span class="op" id="3817900">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817905">for</span>&nbsp;<span class="ident" id="3817909">j</span>&nbsp;<span class="op" id="3817911">:=</span>&nbsp;<span class="num" id="3817914">0</span><span class="op" id="3817915">;</span>&nbsp;<span class="ident" id="3817917">j</span>&nbsp;<span class="op" id="3817919">&lt;</span>&nbsp;<span class="ident" id="3817921">_W</span><span class="op" id="3817923">;</span>&nbsp;<span class="ident" id="3817925">j</span><span class="op" id="3817926">++</span>&nbsp;<span class="op" id="3817929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817934">zz</span>&nbsp;<span class="op" id="3817937">=</span>&nbsp;<span class="ident" id="3817939">zz</span><span class="op" id="3817941">.</span><span class="ident" id="3817942">mul</span><span class="op" id="3817945">(</span><span class="ident" id="3817946">z</span><span class="op" id="3817947">,</span>&nbsp;<span class="ident" id="3817949">z</span><span class="op" id="3817950">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817955">zz</span><span class="op" id="3817957">,</span>&nbsp;<span class="ident" id="3817959">z</span>&nbsp;<span class="op" id="3817961">=</span>&nbsp;<span class="ident" id="3817963">z</span><span class="op" id="3817964">,</span>&nbsp;<span class="ident" id="3817966">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3817973">if</span>&nbsp;<span class="ident" id="3817976">v</span><span class="op" id="3817977">&amp;</span><span class="ident" id="3817978">mask</span>&nbsp;<span class="op" id="3817983">!=</span>&nbsp;<span class="num" id="3817986">0</span>&nbsp;<span class="op" id="3817988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3817994">zz</span>&nbsp;<span class="op" id="3817997">=</span>&nbsp;<span class="ident" id="3817999">zz</span><span class="op" id="3818001">.</span><span class="ident" id="3818002">mul</span><span class="op" id="3818005">(</span><span class="ident" id="3818006">z</span><span class="op" id="3818007">,</span>&nbsp;<span class="ident" id="3818009">x</span><span class="op" id="3818010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818016">zz</span><span class="op" id="3818018">,</span>&nbsp;<span class="ident" id="3818020">z</span>&nbsp;<span class="op" id="3818022">=</span>&nbsp;<span class="ident" id="3818024">z</span><span class="op" id="3818025">,</span>&nbsp;<span class="ident" id="3818027">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818039">if</span>&nbsp;<span class="builtinfunc" id="3818042">len</span><span class="op" id="3818045">(</span><span class="ident" id="3818046">m</span><span class="op" id="3818047">)</span>&nbsp;<span class="op" id="3818049">!=</span>&nbsp;<span class="num" id="3818052">0</span>&nbsp;<span class="op" id="3818054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818060">zz</span><span class="op" id="3818062">,</span>&nbsp;<span class="ident" id="3818064">r</span>&nbsp;<span class="op" id="3818066">=</span>&nbsp;<span class="ident" id="3818068">zz</span><span class="op" id="3818070">.</span><span class="ident" id="3818071">div</span><span class="op" id="3818074">(</span><span class="ident" id="3818075">r</span><span class="op" id="3818076">,</span>&nbsp;<span class="ident" id="3818078">z</span><span class="op" id="3818079">,</span>&nbsp;<span class="ident" id="3818081">m</span><span class="op" id="3818082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818088">zz</span><span class="op" id="3818090">,</span>&nbsp;<span class="ident" id="3818092">r</span><span class="op" id="3818093">,</span>&nbsp;<span class="ident" id="3818095">q</span><span class="op" id="3818096">,</span>&nbsp;<span class="ident" id="3818098">z</span>&nbsp;<span class="op" id="3818100">=</span>&nbsp;<span class="ident" id="3818102">q</span><span class="op" id="3818103">,</span>&nbsp;<span class="ident" id="3818105">z</span><span class="op" id="3818106">,</span>&nbsp;<span class="ident" id="3818108">zz</span><span class="op" id="3818110">,</span>&nbsp;<span class="ident" id="3818112">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818123">v</span>&nbsp;<span class="op" id="3818125">&lt;&lt;=</span>&nbsp;<span class="num" id="3818129">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818136">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818140">return</span>&nbsp;<span class="ident" id="3818147">z</span><span class="op" id="3818148">.</span><span class="ident" id="3818149">norm</span><span class="op" id="3818153">(</span><span class="op" id="3818154">)</span><br>
<span class="lineno"></span><span class="op" id="3818156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3818159">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3818227">func</span>&nbsp;<span class="op" id="3818232">(</span><span class="ident" id="3818233">z</span>&nbsp;<span class="ident" id="3818235">nat</span><span class="op" id="3818238">)</span>&nbsp;<span class="ident" id="3818240">expNNWindowed</span><span class="op" id="3818253">(</span><span class="ident" id="3818254">x</span><span class="op" id="3818255">,</span>&nbsp;<span class="ident" id="3818257">y</span><span class="op" id="3818258">,</span>&nbsp;<span class="ident" id="3818260">m</span>&nbsp;<span class="ident" id="3818262">nat</span><span class="op" id="3818265">)</span>&nbsp;<span class="ident" id="3818267">nat</span>&nbsp;<span class="op" id="3818271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818274">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818344">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818375">var</span>&nbsp;<span class="ident" id="3818379">zz</span><span class="op" id="3818381">,</span>&nbsp;<span class="ident" id="3818383">r</span>&nbsp;<span class="ident" id="3818385">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818391">const</span>&nbsp;<span class="ident" id="3818397">n</span>&nbsp;<span class="op" id="3818399">=</span>&nbsp;<span class="num" id="3818401">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818404">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818432">var</span>&nbsp;<span class="ident" id="3818436">powers</span>&nbsp;<span class="op" id="3818443">[</span><span class="num" id="3818444">1</span>&nbsp;<span class="op" id="3818446">&lt;&lt;</span>&nbsp;<span class="ident" id="3818449">n</span><span class="op" id="3818450">]</span><span class="ident" id="3818451">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818456">powers</span><span class="op" id="3818462">[</span><span class="num" id="3818463">0</span><span class="op" id="3818464">]</span>&nbsp;<span class="op" id="3818466">=</span>&nbsp;<span class="ident" id="3818468">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818476">powers</span><span class="op" id="3818482">[</span><span class="num" id="3818483">1</span><span class="op" id="3818484">]</span>&nbsp;<span class="op" id="3818486">=</span>&nbsp;<span class="ident" id="3818488">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818491">for</span>&nbsp;<span class="ident" id="3818495">i</span>&nbsp;<span class="op" id="3818497">:=</span>&nbsp;<span class="num" id="3818500">2</span><span class="op" id="3818501">;</span>&nbsp;<span class="ident" id="3818503">i</span>&nbsp;<span class="op" id="3818505">&lt;</span>&nbsp;<span class="num" id="3818507">1</span><span class="op" id="3818508">&lt;&lt;</span><span class="ident" id="3818510">n</span><span class="op" id="3818511">;</span>&nbsp;<span class="ident" id="3818513">i</span>&nbsp;<span class="op" id="3818515">+=</span>&nbsp;<span class="num" id="3818518">2</span>&nbsp;<span class="op" id="3818520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818524">p2</span><span class="op" id="3818526">,</span>&nbsp;<span class="ident" id="3818528">p</span><span class="op" id="3818529">,</span>&nbsp;<span class="ident" id="3818531">p1</span>&nbsp;<span class="op" id="3818534">:=</span>&nbsp;<span class="op" id="3818537">&amp;</span><span class="ident" id="3818538">powers</span><span class="op" id="3818544">[</span><span class="ident" id="3818545">i</span><span class="op" id="3818546">/</span><span class="num" id="3818547">2</span><span class="op" id="3818548">]</span><span class="op" id="3818549">,</span>&nbsp;<span class="op" id="3818551">&amp;</span><span class="ident" id="3818552">powers</span><span class="op" id="3818558">[</span><span class="ident" id="3818559">i</span><span class="op" id="3818560">]</span><span class="op" id="3818561">,</span>&nbsp;<span class="op" id="3818563">&amp;</span><span class="ident" id="3818564">powers</span><span class="op" id="3818570">[</span><span class="ident" id="3818571">i</span><span class="op" id="3818572">+</span><span class="num" id="3818573">1</span><span class="op" id="3818574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818578">*</span><span class="ident" id="3818579">p</span>&nbsp;<span class="op" id="3818581">=</span>&nbsp;<span class="ident" id="3818583">p</span><span class="op" id="3818584">.</span><span class="ident" id="3818585">mul</span><span class="op" id="3818588">(</span><span class="op" id="3818589">*</span><span class="ident" id="3818590">p2</span><span class="op" id="3818592">,</span>&nbsp;<span class="op" id="3818594">*</span><span class="ident" id="3818595">p2</span><span class="op" id="3818597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818601">zz</span><span class="op" id="3818603">,</span>&nbsp;<span class="ident" id="3818605">r</span>&nbsp;<span class="op" id="3818607">=</span>&nbsp;<span class="ident" id="3818609">zz</span><span class="op" id="3818611">.</span><span class="ident" id="3818612">div</span><span class="op" id="3818615">(</span><span class="ident" id="3818616">r</span><span class="op" id="3818617">,</span>&nbsp;<span class="op" id="3818619">*</span><span class="ident" id="3818620">p</span><span class="op" id="3818621">,</span>&nbsp;<span class="ident" id="3818623">m</span><span class="op" id="3818624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818628">*</span><span class="ident" id="3818629">p</span><span class="op" id="3818630">,</span>&nbsp;<span class="ident" id="3818632">r</span>&nbsp;<span class="op" id="3818634">=</span>&nbsp;<span class="ident" id="3818636">r</span><span class="op" id="3818637">,</span>&nbsp;<span class="op" id="3818639">*</span><span class="ident" id="3818640">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818644">*</span><span class="ident" id="3818645">p1</span>&nbsp;<span class="op" id="3818648">=</span>&nbsp;<span class="ident" id="3818650">p1</span><span class="op" id="3818652">.</span><span class="ident" id="3818653">mul</span><span class="op" id="3818656">(</span><span class="op" id="3818657">*</span><span class="ident" id="3818658">p</span><span class="op" id="3818659">,</span>&nbsp;<span class="ident" id="3818661">x</span><span class="op" id="3818662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818666">zz</span><span class="op" id="3818668">,</span>&nbsp;<span class="ident" id="3818670">r</span>&nbsp;<span class="op" id="3818672">=</span>&nbsp;<span class="ident" id="3818674">zz</span><span class="op" id="3818676">.</span><span class="ident" id="3818677">div</span><span class="op" id="3818680">(</span><span class="ident" id="3818681">r</span><span class="op" id="3818682">,</span>&nbsp;<span class="op" id="3818684">*</span><span class="ident" id="3818685">p1</span><span class="op" id="3818687">,</span>&nbsp;<span class="ident" id="3818689">m</span><span class="op" id="3818690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818694">*</span><span class="ident" id="3818695">p1</span><span class="op" id="3818697">,</span>&nbsp;<span class="ident" id="3818699">r</span>&nbsp;<span class="op" id="3818701">=</span>&nbsp;<span class="ident" id="3818703">r</span><span class="op" id="3818704">,</span>&nbsp;<span class="op" id="3818706">*</span><span class="ident" id="3818707">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3818711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818715">z</span>&nbsp;<span class="op" id="3818717">=</span>&nbsp;<span class="ident" id="3818719">z</span><span class="op" id="3818720">.</span><span class="ident" id="3818721">setWord</span><span class="op" id="3818728">(</span><span class="num" id="3818729">1</span><span class="op" id="3818730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818734">for</span>&nbsp;<span class="ident" id="3818738">i</span>&nbsp;<span class="op" id="3818740">:=</span>&nbsp;<span class="builtinfunc" id="3818743">len</span><span class="op" id="3818746">(</span><span class="ident" id="3818747">y</span><span class="op" id="3818748">)</span>&nbsp;<span class="op" id="3818750">-</span>&nbsp;<span class="num" id="3818752">1</span><span class="op" id="3818753">;</span>&nbsp;<span class="ident" id="3818755">i</span>&nbsp;<span class="op" id="3818757">&gt;=</span>&nbsp;<span class="num" id="3818760">0</span><span class="op" id="3818761">;</span>&nbsp;<span class="ident" id="3818763">i</span><span class="op" id="3818764">--</span>&nbsp;<span class="op" id="3818767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818771">yi</span>&nbsp;<span class="op" id="3818774">:=</span>&nbsp;<span class="ident" id="3818777">y</span><span class="op" id="3818778">[</span><span class="ident" id="3818779">i</span><span class="op" id="3818780">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818784">for</span>&nbsp;<span class="ident" id="3818788">j</span>&nbsp;<span class="op" id="3818790">:=</span>&nbsp;<span class="num" id="3818793">0</span><span class="op" id="3818794">;</span>&nbsp;<span class="ident" id="3818796">j</span>&nbsp;<span class="op" id="3818798">&lt;</span>&nbsp;<span class="ident" id="3818800">_W</span><span class="op" id="3818802">;</span>&nbsp;<span class="ident" id="3818804">j</span>&nbsp;<span class="op" id="3818806">+=</span>&nbsp;<span class="ident" id="3818809">n</span>&nbsp;<span class="op" id="3818811">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3818816">if</span>&nbsp;<span class="ident" id="3818819">i</span>&nbsp;<span class="op" id="3818821">!=</span>&nbsp;<span class="builtinfunc" id="3818824">len</span><span class="op" id="3818827">(</span><span class="ident" id="3818828">y</span><span class="op" id="3818829">)</span><span class="op" id="3818830">-</span><span class="num" id="3818831">1</span>&nbsp;<span class="op" id="3818833">||</span>&nbsp;<span class="ident" id="3818836">j</span>&nbsp;<span class="op" id="3818838">!=</span>&nbsp;<span class="num" id="3818841">0</span>&nbsp;<span class="op" id="3818843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818849">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818898">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3818950">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819001">zz</span>&nbsp;<span class="op" id="3819004">=</span>&nbsp;<span class="ident" id="3819006">zz</span><span class="op" id="3819008">.</span><span class="ident" id="3819009">mul</span><span class="op" id="3819012">(</span><span class="ident" id="3819013">z</span><span class="op" id="3819014">,</span>&nbsp;<span class="ident" id="3819016">z</span><span class="op" id="3819017">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819023">zz</span><span class="op" id="3819025">,</span>&nbsp;<span class="ident" id="3819027">z</span>&nbsp;<span class="op" id="3819029">=</span>&nbsp;<span class="ident" id="3819031">z</span><span class="op" id="3819032">,</span>&nbsp;<span class="ident" id="3819034">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819041">zz</span><span class="op" id="3819043">,</span>&nbsp;<span class="ident" id="3819045">r</span>&nbsp;<span class="op" id="3819047">=</span>&nbsp;<span class="ident" id="3819049">zz</span><span class="op" id="3819051">.</span><span class="ident" id="3819052">div</span><span class="op" id="3819055">(</span><span class="ident" id="3819056">r</span><span class="op" id="3819057">,</span>&nbsp;<span class="ident" id="3819059">z</span><span class="op" id="3819060">,</span>&nbsp;<span class="ident" id="3819062">m</span><span class="op" id="3819063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819069">z</span><span class="op" id="3819070">,</span>&nbsp;<span class="ident" id="3819072">r</span>&nbsp;<span class="op" id="3819074">=</span>&nbsp;<span class="ident" id="3819076">r</span><span class="op" id="3819077">,</span>&nbsp;<span class="ident" id="3819079">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819086">zz</span>&nbsp;<span class="op" id="3819089">=</span>&nbsp;<span class="ident" id="3819091">zz</span><span class="op" id="3819093">.</span><span class="ident" id="3819094">mul</span><span class="op" id="3819097">(</span><span class="ident" id="3819098">z</span><span class="op" id="3819099">,</span>&nbsp;<span class="ident" id="3819101">z</span><span class="op" id="3819102">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819108">zz</span><span class="op" id="3819110">,</span>&nbsp;<span class="ident" id="3819112">z</span>&nbsp;<span class="op" id="3819114">=</span>&nbsp;<span class="ident" id="3819116">z</span><span class="op" id="3819117">,</span>&nbsp;<span class="ident" id="3819119">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819126">zz</span><span class="op" id="3819128">,</span>&nbsp;<span class="ident" id="3819130">r</span>&nbsp;<span class="op" id="3819132">=</span>&nbsp;<span class="ident" id="3819134">zz</span><span class="op" id="3819136">.</span><span class="ident" id="3819137">div</span><span class="op" id="3819140">(</span><span class="ident" id="3819141">r</span><span class="op" id="3819142">,</span>&nbsp;<span class="ident" id="3819144">z</span><span class="op" id="3819145">,</span>&nbsp;<span class="ident" id="3819147">m</span><span class="op" id="3819148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819154">z</span><span class="op" id="3819155">,</span>&nbsp;<span class="ident" id="3819157">r</span>&nbsp;<span class="op" id="3819159">=</span>&nbsp;<span class="ident" id="3819161">r</span><span class="op" id="3819162">,</span>&nbsp;<span class="ident" id="3819164">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819171">zz</span>&nbsp;<span class="op" id="3819174">=</span>&nbsp;<span class="ident" id="3819176">zz</span><span class="op" id="3819178">.</span><span class="ident" id="3819179">mul</span><span class="op" id="3819182">(</span><span class="ident" id="3819183">z</span><span class="op" id="3819184">,</span>&nbsp;<span class="ident" id="3819186">z</span><span class="op" id="3819187">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819193">zz</span><span class="op" id="3819195">,</span>&nbsp;<span class="ident" id="3819197">z</span>&nbsp;<span class="op" id="3819199">=</span>&nbsp;<span class="ident" id="3819201">z</span><span class="op" id="3819202">,</span>&nbsp;<span class="ident" id="3819204">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819211">zz</span><span class="op" id="3819213">,</span>&nbsp;<span class="ident" id="3819215">r</span>&nbsp;<span class="op" id="3819217">=</span>&nbsp;<span class="ident" id="3819219">zz</span><span class="op" id="3819221">.</span><span class="ident" id="3819222">div</span><span class="op" id="3819225">(</span><span class="ident" id="3819226">r</span><span class="op" id="3819227">,</span>&nbsp;<span class="ident" id="3819229">z</span><span class="op" id="3819230">,</span>&nbsp;<span class="ident" id="3819232">m</span><span class="op" id="3819233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819239">z</span><span class="op" id="3819240">,</span>&nbsp;<span class="ident" id="3819242">r</span>&nbsp;<span class="op" id="3819244">=</span>&nbsp;<span class="ident" id="3819246">r</span><span class="op" id="3819247">,</span>&nbsp;<span class="ident" id="3819249">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819256">zz</span>&nbsp;<span class="op" id="3819259">=</span>&nbsp;<span class="ident" id="3819261">zz</span><span class="op" id="3819263">.</span><span class="ident" id="3819264">mul</span><span class="op" id="3819267">(</span><span class="ident" id="3819268">z</span><span class="op" id="3819269">,</span>&nbsp;<span class="ident" id="3819271">z</span><span class="op" id="3819272">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819278">zz</span><span class="op" id="3819280">,</span>&nbsp;<span class="ident" id="3819282">z</span>&nbsp;<span class="op" id="3819284">=</span>&nbsp;<span class="ident" id="3819286">z</span><span class="op" id="3819287">,</span>&nbsp;<span class="ident" id="3819289">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819296">zz</span><span class="op" id="3819298">,</span>&nbsp;<span class="ident" id="3819300">r</span>&nbsp;<span class="op" id="3819302">=</span>&nbsp;<span class="ident" id="3819304">zz</span><span class="op" id="3819306">.</span><span class="ident" id="3819307">div</span><span class="op" id="3819310">(</span><span class="ident" id="3819311">r</span><span class="op" id="3819312">,</span>&nbsp;<span class="ident" id="3819314">z</span><span class="op" id="3819315">,</span>&nbsp;<span class="ident" id="3819317">m</span><span class="op" id="3819318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819324">z</span><span class="op" id="3819325">,</span>&nbsp;<span class="ident" id="3819327">r</span>&nbsp;<span class="op" id="3819329">=</span>&nbsp;<span class="ident" id="3819331">r</span><span class="op" id="3819332">,</span>&nbsp;<span class="ident" id="3819334">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819345">zz</span>&nbsp;<span class="op" id="3819348">=</span>&nbsp;<span class="ident" id="3819350">zz</span><span class="op" id="3819352">.</span><span class="ident" id="3819353">mul</span><span class="op" id="3819356">(</span><span class="ident" id="3819357">z</span><span class="op" id="3819358">,</span>&nbsp;<span class="ident" id="3819360">powers</span><span class="op" id="3819366">[</span><span class="ident" id="3819367">yi</span><span class="op" id="3819369">&gt;&gt;</span><span class="op" id="3819371">(</span><span class="ident" id="3819372">_W</span><span class="op" id="3819374">-</span><span class="ident" id="3819375">n</span><span class="op" id="3819376">)</span><span class="op" id="3819377">]</span><span class="op" id="3819378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819383">zz</span><span class="op" id="3819385">,</span>&nbsp;<span class="ident" id="3819387">z</span>&nbsp;<span class="op" id="3819389">=</span>&nbsp;<span class="ident" id="3819391">z</span><span class="op" id="3819392">,</span>&nbsp;<span class="ident" id="3819394">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819400">zz</span><span class="op" id="3819402">,</span>&nbsp;<span class="ident" id="3819404">r</span>&nbsp;<span class="op" id="3819406">=</span>&nbsp;<span class="ident" id="3819408">zz</span><span class="op" id="3819410">.</span><span class="ident" id="3819411">div</span><span class="op" id="3819414">(</span><span class="ident" id="3819415">r</span><span class="op" id="3819416">,</span>&nbsp;<span class="ident" id="3819418">z</span><span class="op" id="3819419">,</span>&nbsp;<span class="ident" id="3819421">m</span><span class="op" id="3819422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819427">z</span><span class="op" id="3819428">,</span>&nbsp;<span class="ident" id="3819430">r</span>&nbsp;<span class="op" id="3819432">=</span>&nbsp;<span class="ident" id="3819434">r</span><span class="op" id="3819435">,</span>&nbsp;<span class="ident" id="3819437">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3819443">yi</span>&nbsp;<span class="op" id="3819446">&lt;&lt;=</span>&nbsp;<span class="ident" id="3819450">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819461">return</span>&nbsp;<span class="ident" id="3819468">z</span><span class="op" id="3819469">.</span><span class="ident" id="3819470">norm</span><span class="op" id="3819474">(</span><span class="op" id="3819475">)</span><br>
<span class="lineno">1380</span><span class="op" id="3819477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3819480">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3819559">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3819624">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3819664">func</span>&nbsp;<span class="op" id="3819669">(</span><span class="ident" id="3819670">n</span>&nbsp;<span class="ident" id="3819672">nat</span><span class="op" id="3819675">)</span>&nbsp;<span class="ident" id="3819677">probablyPrime</span><span class="op" id="3819690">(</span><span class="ident" id="3819691">reps</span>&nbsp;<span class="builtintype" id="3819696">int</span><span class="op" id="3819699">)</span>&nbsp;<span class="builtintype" id="3819701">bool</span>&nbsp;<span class="op" id="3819706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819709">if</span>&nbsp;<span class="builtinfunc" id="3819712">len</span><span class="op" id="3819715">(</span><span class="ident" id="3819716">n</span><span class="op" id="3819717">)</span>&nbsp;<span class="op" id="3819719">==</span>&nbsp;<span class="num" id="3819722">0</span>&nbsp;<span class="op" id="3819724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819728">return</span>&nbsp;<span class="builtintype" id="3819735">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819746">if</span>&nbsp;<span class="builtinfunc" id="3819749">len</span><span class="op" id="3819752">(</span><span class="ident" id="3819753">n</span><span class="op" id="3819754">)</span>&nbsp;<span class="op" id="3819756">==</span>&nbsp;<span class="num" id="3819759">1</span>&nbsp;<span class="op" id="3819761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819765">if</span>&nbsp;<span class="ident" id="3819768">n</span><span class="op" id="3819769">[</span><span class="num" id="3819770">0</span><span class="op" id="3819771">]</span>&nbsp;<span class="op" id="3819773">&lt;</span>&nbsp;<span class="num" id="3819775">2</span>&nbsp;<span class="op" id="3819777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819782">return</span>&nbsp;<span class="builtintype" id="3819789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819802">if</span>&nbsp;<span class="ident" id="3819805">n</span><span class="op" id="3819806">[</span><span class="num" id="3819807">0</span><span class="op" id="3819808">]</span><span class="op" id="3819809">%</span><span class="num" id="3819810">2</span>&nbsp;<span class="op" id="3819812">==</span>&nbsp;<span class="num" id="3819815">0</span>&nbsp;<span class="op" id="3819817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819822">return</span>&nbsp;<span class="ident" id="3819829">n</span><span class="op" id="3819830">[</span><span class="num" id="3819831">0</span><span class="op" id="3819832">]</span>&nbsp;<span class="op" id="3819834">==</span>&nbsp;<span class="num" id="3819837">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3819841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3819846">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3819904">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819943">switch</span>&nbsp;<span class="ident" id="3819950">n</span><span class="op" id="3819951">[</span><span class="num" id="3819952">0</span><span class="op" id="3819953">]</span>&nbsp;<span class="op" id="3819955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3819959">case</span>&nbsp;<span class="num" id="3819964">3</span><span class="op" id="3819965">,</span>&nbsp;<span class="num" id="3819967">5</span><span class="op" id="3819968">,</span>&nbsp;<span class="num" id="3819970">7</span><span class="op" id="3819971">,</span>&nbsp;<span class="num" id="3819973">11</span><span class="op" id="3819975">,</span>&nbsp;<span class="num" id="3819977">13</span><span class="op" id="3819979">,</span>&nbsp;<span class="num" id="3819981">17</span><span class="op" id="3819983">,</span>&nbsp;<span class="num" id="3819985">19</span><span class="op" id="3819987">,</span>&nbsp;<span class="num" id="3819989">23</span><span class="op" id="3819991">,</span>&nbsp;<span class="num" id="3819993">29</span><span class="op" id="3819995">,</span>&nbsp;<span class="num" id="3819997">31</span><span class="op" id="3819999">,</span>&nbsp;<span class="num" id="3820001">37</span><span class="op" id="3820003">,</span>&nbsp;<span class="num" id="3820005">41</span><span class="op" id="3820007">,</span>&nbsp;<span class="num" id="3820009">43</span><span class="op" id="3820011">,</span>&nbsp;<span class="num" id="3820013">47</span><span class="op" id="3820015">,</span>&nbsp;<span class="num" id="3820017">53</span><span class="op" id="3820019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820024">return</span>&nbsp;<span class="builtintype" id="3820031">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820038">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820045">const</span>&nbsp;<span class="ident" id="3820051">primesProduct32</span>&nbsp;<span class="op" id="3820067">=</span>&nbsp;<span class="num" id="3820069">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3820088">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820123">const</span>&nbsp;<span class="ident" id="3820129">primesProduct64</span>&nbsp;<span class="op" id="3820145">=</span>&nbsp;<span class="num" id="3820147">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3820166">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820202">var</span>&nbsp;<span class="ident" id="3820206">r</span>&nbsp;<span class="ident" id="3820208">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820214">switch</span>&nbsp;<span class="ident" id="3820221">_W</span>&nbsp;<span class="op" id="3820224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820227">case</span>&nbsp;<span class="num" id="3820232">32</span><span class="op" id="3820234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820238">r</span>&nbsp;<span class="op" id="3820240">=</span>&nbsp;<span class="ident" id="3820242">n</span><span class="op" id="3820243">.</span><span class="ident" id="3820244">modW</span><span class="op" id="3820248">(</span><span class="ident" id="3820249">primesProduct32</span><span class="op" id="3820264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820267">case</span>&nbsp;<span class="num" id="3820272">64</span><span class="op" id="3820274">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820278">r</span>&nbsp;<span class="op" id="3820280">=</span>&nbsp;<span class="ident" id="3820282">n</span><span class="op" id="3820283">.</span><span class="ident" id="3820284">modW</span><span class="op" id="3820288">(</span><span class="ident" id="3820289">primesProduct64</span>&nbsp;<span class="op" id="3820305">&amp;</span>&nbsp;<span class="ident" id="3820307">_M</span><span class="op" id="3820309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820312">default</span><span class="op" id="3820319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3820323">panic</span><span class="op" id="3820328">(</span><span class="string" id="3820329">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3820348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820355">if</span>&nbsp;<span class="ident" id="3820358">r</span><span class="op" id="3820359">%</span><span class="num" id="3820360">3</span>&nbsp;<span class="op" id="3820362">==</span>&nbsp;<span class="num" id="3820365">0</span>&nbsp;<span class="op" id="3820367">||</span>&nbsp;<span class="ident" id="3820370">r</span><span class="op" id="3820371">%</span><span class="num" id="3820372">5</span>&nbsp;<span class="op" id="3820374">==</span>&nbsp;<span class="num" id="3820377">0</span>&nbsp;<span class="op" id="3820379">||</span>&nbsp;<span class="ident" id="3820382">r</span><span class="op" id="3820383">%</span><span class="num" id="3820384">7</span>&nbsp;<span class="op" id="3820386">==</span>&nbsp;<span class="num" id="3820389">0</span>&nbsp;<span class="op" id="3820391">||</span>&nbsp;<span class="ident" id="3820394">r</span><span class="op" id="3820395">%</span><span class="num" id="3820396">11</span>&nbsp;<span class="op" id="3820399">==</span>&nbsp;<span class="num" id="3820402">0</span>&nbsp;<span class="op" id="3820404">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820409">r</span><span class="op" id="3820410">%</span><span class="num" id="3820411">13</span>&nbsp;<span class="op" id="3820414">==</span>&nbsp;<span class="num" id="3820417">0</span>&nbsp;<span class="op" id="3820419">||</span>&nbsp;<span class="ident" id="3820422">r</span><span class="op" id="3820423">%</span><span class="num" id="3820424">17</span>&nbsp;<span class="op" id="3820427">==</span>&nbsp;<span class="num" id="3820430">0</span>&nbsp;<span class="op" id="3820432">||</span>&nbsp;<span class="ident" id="3820435">r</span><span class="op" id="3820436">%</span><span class="num" id="3820437">19</span>&nbsp;<span class="op" id="3820440">==</span>&nbsp;<span class="num" id="3820443">0</span>&nbsp;<span class="op" id="3820445">||</span>&nbsp;<span class="ident" id="3820448">r</span><span class="op" id="3820449">%</span><span class="num" id="3820450">23</span>&nbsp;<span class="op" id="3820453">==</span>&nbsp;<span class="num" id="3820456">0</span>&nbsp;<span class="op" id="3820458">||</span>&nbsp;<span class="ident" id="3820461">r</span><span class="op" id="3820462">%</span><span class="num" id="3820463">29</span>&nbsp;<span class="op" id="3820466">==</span>&nbsp;<span class="num" id="3820469">0</span>&nbsp;<span class="op" id="3820471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820475">return</span>&nbsp;<span class="builtintype" id="3820482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820493">if</span>&nbsp;<span class="ident" id="3820496">_W</span>&nbsp;<span class="op" id="3820499">==</span>&nbsp;<span class="num" id="3820502">64</span>&nbsp;<span class="op" id="3820505">&amp;&amp;</span>&nbsp;<span class="op" id="3820508">(</span><span class="ident" id="3820509">r</span><span class="op" id="3820510">%</span><span class="num" id="3820511">31</span>&nbsp;<span class="op" id="3820514">==</span>&nbsp;<span class="num" id="3820517">0</span>&nbsp;<span class="op" id="3820519">||</span>&nbsp;<span class="ident" id="3820522">r</span><span class="op" id="3820523">%</span><span class="num" id="3820524">37</span>&nbsp;<span class="op" id="3820527">==</span>&nbsp;<span class="num" id="3820530">0</span>&nbsp;<span class="op" id="3820532">||</span>&nbsp;<span class="ident" id="3820535">r</span><span class="op" id="3820536">%</span><span class="num" id="3820537">41</span>&nbsp;<span class="op" id="3820540">==</span>&nbsp;<span class="num" id="3820543">0</span>&nbsp;<span class="op" id="3820545">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820550">r</span><span class="op" id="3820551">%</span><span class="num" id="3820552">43</span>&nbsp;<span class="op" id="3820555">==</span>&nbsp;<span class="num" id="3820558">0</span>&nbsp;<span class="op" id="3820560">||</span>&nbsp;<span class="ident" id="3820563">r</span><span class="op" id="3820564">%</span><span class="num" id="3820565">47</span>&nbsp;<span class="op" id="3820568">==</span>&nbsp;<span class="num" id="3820571">0</span>&nbsp;<span class="op" id="3820573">||</span>&nbsp;<span class="ident" id="3820576">r</span><span class="op" id="3820577">%</span><span class="num" id="3820578">53</span>&nbsp;<span class="op" id="3820581">==</span>&nbsp;<span class="num" id="3820584">0</span><span class="op" id="3820585">)</span>&nbsp;<span class="op" id="3820587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820591">return</span>&nbsp;<span class="builtintype" id="3820598">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820609">nm1</span>&nbsp;<span class="op" id="3820613">:=</span>&nbsp;<span class="ident" id="3820616">nat</span><span class="op" id="3820619">(</span><span class="ident" id="3820620">nil</span><span class="op" id="3820623">)</span><span class="op" id="3820624">.</span><span class="ident" id="3820625">sub</span><span class="op" id="3820628">(</span><span class="ident" id="3820629">n</span><span class="op" id="3820630">,</span>&nbsp;<span class="ident" id="3820632">natOne</span><span class="op" id="3820638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3820641">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820683">k</span>&nbsp;<span class="op" id="3820685">:=</span>&nbsp;<span class="ident" id="3820688">nm1</span><span class="op" id="3820691">.</span><span class="ident" id="3820692">trailingZeroBits</span><span class="op" id="3820708">(</span><span class="op" id="3820709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820712">q</span>&nbsp;<span class="op" id="3820714">:=</span>&nbsp;<span class="ident" id="3820717">nat</span><span class="op" id="3820720">(</span><span class="ident" id="3820721">nil</span><span class="op" id="3820724">)</span><span class="op" id="3820725">.</span><span class="ident" id="3820726">shr</span><span class="op" id="3820729">(</span><span class="ident" id="3820730">nm1</span><span class="op" id="3820733">,</span>&nbsp;<span class="ident" id="3820735">k</span><span class="op" id="3820736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820740">nm3</span>&nbsp;<span class="op" id="3820744">:=</span>&nbsp;<span class="ident" id="3820747">nat</span><span class="op" id="3820750">(</span><span class="ident" id="3820751">nil</span><span class="op" id="3820754">)</span><span class="op" id="3820755">.</span><span class="ident" id="3820756">sub</span><span class="op" id="3820759">(</span><span class="ident" id="3820760">nm1</span><span class="op" id="3820763">,</span>&nbsp;<span class="ident" id="3820765">natTwo</span><span class="op" id="3820771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820774">rand</span>&nbsp;<span class="op" id="3820779">:=</span>&nbsp;<span class="ident" id="3820782">rand</span><span class="op" id="3820786">.</span><span class="ident" id="3820787">New</span><span class="op" id="3820790">(</span><span class="ident" id="3820791">rand</span><span class="op" id="3820795">.</span><span class="ident" id="3820796">NewSource</span><span class="op" id="3820805">(</span><span class="ident" id="3820806">int64</span><span class="op" id="3820811">(</span><span class="ident" id="3820812">n</span><span class="op" id="3820813">[</span><span class="num" id="3820814">0</span><span class="op" id="3820815">]</span><span class="op" id="3820816">)</span><span class="op" id="3820817">)</span><span class="op" id="3820818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820822">var</span>&nbsp;<span class="ident" id="3820826">x</span><span class="op" id="3820827">,</span>&nbsp;<span class="ident" id="3820829">y</span><span class="op" id="3820830">,</span>&nbsp;<span class="ident" id="3820832">quotient</span>&nbsp;<span class="ident" id="3820841">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820846">nm3Len</span>&nbsp;<span class="op" id="3820853">:=</span>&nbsp;<span class="ident" id="3820856">nm3</span><span class="op" id="3820859">.</span><span class="ident" id="3820860">bitLen</span><span class="op" id="3820866">(</span><span class="op" id="3820867">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3820870">NextRandom</span><span class="op" id="3820880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820883">for</span>&nbsp;<span class="ident" id="3820887">i</span>&nbsp;<span class="op" id="3820889">:=</span>&nbsp;<span class="num" id="3820892">0</span><span class="op" id="3820893">;</span>&nbsp;<span class="ident" id="3820895">i</span>&nbsp;<span class="op" id="3820897">&lt;</span>&nbsp;<span class="ident" id="3820899">reps</span><span class="op" id="3820903">;</span>&nbsp;<span class="ident" id="3820905">i</span><span class="op" id="3820906">++</span>&nbsp;<span class="op" id="3820909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820913">x</span>&nbsp;<span class="op" id="3820915">=</span>&nbsp;<span class="ident" id="3820917">x</span><span class="op" id="3820918">.</span><span class="ident" id="3820919">random</span><span class="op" id="3820925">(</span><span class="ident" id="3820926">rand</span><span class="op" id="3820930">,</span>&nbsp;<span class="ident" id="3820932">nm3</span><span class="op" id="3820935">,</span>&nbsp;<span class="ident" id="3820937">nm3Len</span><span class="op" id="3820943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820947">x</span>&nbsp;<span class="op" id="3820949">=</span>&nbsp;<span class="ident" id="3820951">x</span><span class="op" id="3820952">.</span><span class="ident" id="3820953">add</span><span class="op" id="3820956">(</span><span class="ident" id="3820957">x</span><span class="op" id="3820958">,</span>&nbsp;<span class="ident" id="3820960">natTwo</span><span class="op" id="3820966">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3820970">y</span>&nbsp;<span class="op" id="3820972">=</span>&nbsp;<span class="ident" id="3820974">y</span><span class="op" id="3820975">.</span><span class="ident" id="3820976">expNN</span><span class="op" id="3820981">(</span><span class="ident" id="3820982">x</span><span class="op" id="3820983">,</span>&nbsp;<span class="ident" id="3820985">q</span><span class="op" id="3820986">,</span>&nbsp;<span class="ident" id="3820988">n</span><span class="op" id="3820989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3820993">if</span>&nbsp;<span class="ident" id="3820996">y</span><span class="op" id="3820997">.</span><span class="ident" id="3820998">cmp</span><span class="op" id="3821001">(</span><span class="ident" id="3821002">natOne</span><span class="op" id="3821008">)</span>&nbsp;<span class="op" id="3821010">==</span>&nbsp;<span class="num" id="3821013">0</span>&nbsp;<span class="op" id="3821015">||</span>&nbsp;<span class="ident" id="3821018">y</span><span class="op" id="3821019">.</span><span class="ident" id="3821020">cmp</span><span class="op" id="3821023">(</span><span class="ident" id="3821024">nm1</span><span class="op" id="3821027">)</span>&nbsp;<span class="op" id="3821029">==</span>&nbsp;<span class="num" id="3821032">0</span>&nbsp;<span class="op" id="3821034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821039">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821054">for</span>&nbsp;<span class="ident" id="3821058">j</span>&nbsp;<span class="op" id="3821060">:=</span>&nbsp;<span class="builtintype" id="3821063">uint</span><span class="op" id="3821067">(</span><span class="num" id="3821068">1</span><span class="op" id="3821069">)</span><span class="op" id="3821070">;</span>&nbsp;<span class="ident" id="3821072">j</span>&nbsp;<span class="op" id="3821074">&lt;</span>&nbsp;<span class="ident" id="3821076">k</span><span class="op" id="3821077">;</span>&nbsp;<span class="ident" id="3821079">j</span><span class="op" id="3821080">++</span>&nbsp;<span class="op" id="3821083">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821088">y</span>&nbsp;<span class="op" id="3821090">=</span>&nbsp;<span class="ident" id="3821092">y</span><span class="op" id="3821093">.</span><span class="ident" id="3821094">mul</span><span class="op" id="3821097">(</span><span class="ident" id="3821098">y</span><span class="op" id="3821099">,</span>&nbsp;<span class="ident" id="3821101">y</span><span class="op" id="3821102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821107">quotient</span><span class="op" id="3821115">,</span>&nbsp;<span class="ident" id="3821117">y</span>&nbsp;<span class="op" id="3821119">=</span>&nbsp;<span class="ident" id="3821121">quotient</span><span class="op" id="3821129">.</span><span class="ident" id="3821130">div</span><span class="op" id="3821133">(</span><span class="ident" id="3821134">y</span><span class="op" id="3821135">,</span>&nbsp;<span class="ident" id="3821137">y</span><span class="op" id="3821138">,</span>&nbsp;<span class="ident" id="3821140">n</span><span class="op" id="3821141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821146">if</span>&nbsp;<span class="ident" id="3821149">y</span><span class="op" id="3821150">.</span><span class="ident" id="3821151">cmp</span><span class="op" id="3821154">(</span><span class="ident" id="3821155">nm1</span><span class="op" id="3821158">)</span>&nbsp;<span class="op" id="3821160">==</span>&nbsp;<span class="num" id="3821163">0</span>&nbsp;<span class="op" id="3821165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821171">continue</span>&nbsp;<span class="ident" id="3821180">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821194">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821199">if</span>&nbsp;<span class="ident" id="3821202">y</span><span class="op" id="3821203">.</span><span class="ident" id="3821204">cmp</span><span class="op" id="3821207">(</span><span class="ident" id="3821208">natOne</span><span class="op" id="3821214">)</span>&nbsp;<span class="op" id="3821216">==</span>&nbsp;<span class="num" id="3821219">0</span>&nbsp;<span class="op" id="3821221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821227">return</span>&nbsp;<span class="builtintype" id="3821234">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821251">return</span>&nbsp;<span class="builtintype" id="3821258">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821269">return</span>&nbsp;<span class="builtintype" id="3821276">true</span><br>
<span class="lineno"></span><span class="op" id="3821281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3821284">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3821351">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3821418">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3821485">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3821515">func</span>&nbsp;<span class="op" id="3821520">(</span><span class="ident" id="3821521">z</span>&nbsp;<span class="ident" id="3821523">nat</span><span class="op" id="3821526">)</span>&nbsp;<span class="ident" id="3821528">bytes</span><span class="op" id="3821533">(</span><span class="ident" id="3821534">buf</span>&nbsp;<span class="op" id="3821538">[</span><span class="op" id="3821539">]</span><span class="builtintype" id="3821540">byte</span><span class="op" id="3821544">)</span>&nbsp;<span class="op" id="3821546">(</span><span class="ident" id="3821547">i</span>&nbsp;<span class="builtintype" id="3821549">int</span><span class="op" id="3821552">)</span>&nbsp;<span class="op" id="3821554">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821557">i</span>&nbsp;<span class="op" id="3821559">=</span>&nbsp;<span class="builtinfunc" id="3821561">len</span><span class="op" id="3821564">(</span><span class="ident" id="3821565">buf</span><span class="op" id="3821568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821571">for</span>&nbsp;<span class="ident" id="3821575">_</span><span class="op" id="3821576">,</span>&nbsp;<span class="ident" id="3821578">d</span>&nbsp;<span class="op" id="3821580">:=</span>&nbsp;<span class="keyword" id="3821583">range</span>&nbsp;<span class="ident" id="3821589">z</span>&nbsp;<span class="op" id="3821591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821595">for</span>&nbsp;<span class="ident" id="3821599">j</span>&nbsp;<span class="op" id="3821601">:=</span>&nbsp;<span class="num" id="3821604">0</span><span class="op" id="3821605">;</span>&nbsp;<span class="ident" id="3821607">j</span>&nbsp;<span class="op" id="3821609">&lt;</span>&nbsp;<span class="ident" id="3821611">_S</span><span class="op" id="3821613">;</span>&nbsp;<span class="ident" id="3821615">j</span><span class="op" id="3821616">++</span>&nbsp;<span class="op" id="3821619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821624">i</span><span class="op" id="3821625">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821631">buf</span><span class="op" id="3821634">[</span><span class="ident" id="3821635">i</span><span class="op" id="3821636">]</span>&nbsp;<span class="op" id="3821638">=</span>&nbsp;<span class="builtintype" id="3821640">byte</span><span class="op" id="3821644">(</span><span class="ident" id="3821645">d</span><span class="op" id="3821646">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821651">d</span>&nbsp;<span class="op" id="3821653">&gt;&gt;=</span>&nbsp;<span class="num" id="3821657">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821668">for</span>&nbsp;<span class="ident" id="3821672">i</span>&nbsp;<span class="op" id="3821674">&lt;</span>&nbsp;<span class="builtinfunc" id="3821676">len</span><span class="op" id="3821679">(</span><span class="ident" id="3821680">buf</span><span class="op" id="3821683">)</span>&nbsp;<span class="op" id="3821685">&amp;&amp;</span>&nbsp;<span class="ident" id="3821688">buf</span><span class="op" id="3821691">[</span><span class="ident" id="3821692">i</span><span class="op" id="3821693">]</span>&nbsp;<span class="op" id="3821695">==</span>&nbsp;<span class="num" id="3821698">0</span>&nbsp;<span class="op" id="3821700">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821704">i</span><span class="op" id="3821705">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3821709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821713">return</span><br>
<span class="lineno"></span><span class="op" id="3821720">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3821723">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3821788">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3821837">func</span>&nbsp;<span class="op" id="3821842">(</span><span class="ident" id="3821843">z</span>&nbsp;<span class="ident" id="3821845">nat</span><span class="op" id="3821848">)</span>&nbsp;<span class="ident" id="3821850">setBytes</span><span class="op" id="3821858">(</span><span class="ident" id="3821859">buf</span>&nbsp;<span class="op" id="3821863">[</span><span class="op" id="3821864">]</span><span class="builtintype" id="3821865">byte</span><span class="op" id="3821869">)</span>&nbsp;<span class="ident" id="3821871">nat</span>&nbsp;<span class="op" id="3821875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821878">z</span>&nbsp;<span class="op" id="3821880">=</span>&nbsp;<span class="ident" id="3821882">z</span><span class="op" id="3821883">.</span><span class="builtinfunc" id="3821884">make</span><span class="op" id="3821888">(</span><span class="op" id="3821889">(</span><span class="builtinfunc" id="3821890">len</span><span class="op" id="3821893">(</span><span class="ident" id="3821894">buf</span><span class="op" id="3821897">)</span>&nbsp;<span class="op" id="3821899">+</span>&nbsp;<span class="ident" id="3821901">_S</span>&nbsp;<span class="op" id="3821904">-</span>&nbsp;<span class="num" id="3821906">1</span><span class="op" id="3821907">)</span>&nbsp;<span class="op" id="3821909">/</span>&nbsp;<span class="ident" id="3821911">_S</span><span class="op" id="3821913">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821917">k</span>&nbsp;<span class="op" id="3821919">:=</span>&nbsp;<span class="num" id="3821922">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821925">s</span>&nbsp;<span class="op" id="3821927">:=</span>&nbsp;<span class="builtintype" id="3821930">uint</span><span class="op" id="3821934">(</span><span class="num" id="3821935">0</span><span class="op" id="3821936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821939">var</span>&nbsp;<span class="ident" id="3821943">d</span>&nbsp;<span class="ident" id="3821945">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3821951">for</span>&nbsp;<span class="ident" id="3821955">i</span>&nbsp;<span class="op" id="3821957">:=</span>&nbsp;<span class="builtinfunc" id="3821960">len</span><span class="op" id="3821963">(</span><span class="ident" id="3821964">buf</span><span class="op" id="3821967">)</span><span class="op" id="3821968">;</span>&nbsp;<span class="ident" id="3821970">i</span>&nbsp;<span class="op" id="3821972">&gt;</span>&nbsp;<span class="num" id="3821974">0</span><span class="op" id="3821975">;</span>&nbsp;<span class="ident" id="3821977">i</span><span class="op" id="3821978">--</span>&nbsp;<span class="op" id="3821981">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3821985">d</span>&nbsp;<span class="op" id="3821987">|=</span>&nbsp;<span class="ident" id="3821990">Word</span><span class="op" id="3821994">(</span><span class="ident" id="3821995">buf</span><span class="op" id="3821998">[</span><span class="ident" id="3821999">i</span><span class="op" id="3822000">-</span><span class="num" id="3822001">1</span><span class="op" id="3822002">]</span><span class="op" id="3822003">)</span>&nbsp;<span class="op" id="3822005">&lt;&lt;</span>&nbsp;<span class="ident" id="3822008">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3822012">if</span>&nbsp;<span class="ident" id="3822015">s</span>&nbsp;<span class="op" id="3822017">+=</span>&nbsp;<span class="num" id="3822020">8</span><span class="op" id="3822021">;</span>&nbsp;<span class="ident" id="3822023">s</span>&nbsp;<span class="op" id="3822025">==</span>&nbsp;<span class="ident" id="3822028">_S</span><span class="op" id="3822030">*</span><span class="num" id="3822031">8</span>&nbsp;<span class="op" id="3822033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822038">z</span><span class="op" id="3822039">[</span><span class="ident" id="3822040">k</span><span class="op" id="3822041">]</span>&nbsp;<span class="op" id="3822043">=</span>&nbsp;<span class="ident" id="3822045">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822050">k</span><span class="op" id="3822051">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822057">s</span>&nbsp;<span class="op" id="3822059">=</span>&nbsp;<span class="num" id="3822061">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822066">d</span>&nbsp;<span class="op" id="3822068">=</span>&nbsp;<span class="num" id="3822070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3822074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3822077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3822080">if</span>&nbsp;<span class="ident" id="3822083">k</span>&nbsp;<span class="op" id="3822085">&lt;</span>&nbsp;<span class="builtinfunc" id="3822087">len</span><span class="op" id="3822090">(</span><span class="ident" id="3822091">z</span><span class="op" id="3822092">)</span>&nbsp;<span class="op" id="3822094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822098">z</span><span class="op" id="3822099">[</span><span class="ident" id="3822100">k</span><span class="op" id="3822101">]</span>&nbsp;<span class="op" id="3822103">=</span>&nbsp;<span class="ident" id="3822105">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3822108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3822112">return</span>&nbsp;<span class="ident" id="3822119">z</span><span class="op" id="3822120">.</span><span class="ident" id="3822121">norm</span><span class="op" id="3822125">(</span><span class="op" id="3822126">)</span><br>
<span class="lineno"></span><span class="op" id="3822128">}</span>
</div>
</body>
</html>
