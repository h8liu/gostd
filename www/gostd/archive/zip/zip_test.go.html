<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7155743">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7155798">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7155852">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7155903">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155952">package</span>&nbsp;<span class="ident" id="7155960">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155965">import</span>&nbsp;<span class="op" id="7155972">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7155975">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7155984">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7155991">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7155999">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7156005">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7156018">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7156026">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7156037">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7156048">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7156055">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7156058">func</span>&nbsp;<span class="ident" id="7156063">TestOver65kFiles</span><span class="op" id="7156079">(</span><span class="ident" id="7156080">t</span>&nbsp;<span class="op" id="7156082">*</span><span class="ident" id="7156083">testing</span><span class="op" id="7156090">.</span><span class="ident" id="7156091">T</span><span class="op" id="7156092">)</span>&nbsp;<span class="op" id="7156094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156097">buf</span>&nbsp;<span class="op" id="7156101">:=</span>&nbsp;<span class="builtinfunc" id="7156104">new</span><span class="op" id="7156107">(</span><span class="ident" id="7156108">bytes</span><span class="op" id="7156113">.</span><span class="ident" id="7156114">Buffer</span><span class="op" id="7156120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156123">w</span>&nbsp;<span class="op" id="7156125">:=</span>&nbsp;<span class="ident" id="7156128">NewWriter</span><span class="op" id="7156137">(</span><span class="ident" id="7156138">buf</span><span class="op" id="7156141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156144">const</span>&nbsp;<span class="ident" id="7156150">nFiles</span>&nbsp;<span class="op" id="7156157">=</span>&nbsp;<span class="op" id="7156159">(</span><span class="num" id="7156160">1</span>&nbsp;<span class="op" id="7156162">&lt;&lt;</span>&nbsp;<span class="num" id="7156165">16</span><span class="op" id="7156167">)</span>&nbsp;<span class="op" id="7156169">+</span>&nbsp;<span class="num" id="7156171">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156175">for</span>&nbsp;<span class="ident" id="7156179">i</span>&nbsp;<span class="op" id="7156181">:=</span>&nbsp;<span class="num" id="7156184">0</span><span class="op" id="7156185">;</span>&nbsp;<span class="ident" id="7156187">i</span>&nbsp;<span class="op" id="7156189">&lt;</span>&nbsp;<span class="ident" id="7156191">nFiles</span><span class="op" id="7156197">;</span>&nbsp;<span class="ident" id="7156199">i</span><span class="op" id="7156200">++</span>&nbsp;<span class="op" id="7156203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156207">_</span><span class="op" id="7156208">,</span>&nbsp;<span class="ident" id="7156210">err</span>&nbsp;<span class="op" id="7156214">:=</span>&nbsp;<span class="ident" id="7156217">w</span><span class="op" id="7156218">.</span><span class="ident" id="7156219">CreateHeader</span><span class="op" id="7156231">(</span><span class="op" id="7156232">&amp;</span><span class="ident" id="7156233">FileHeader</span><span class="op" id="7156243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156248">Name</span><span class="op" id="7156252">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7156256">fmt</span><span class="op" id="7156259">.</span><span class="ident" id="7156260">Sprintf</span><span class="op" id="7156267">(</span><span class="string" id="7156268">&#34;%d.dat&#34;</span><span class="op" id="7156276">,</span>&nbsp;<span class="ident" id="7156278">i</span><span class="op" id="7156279">)</span><span class="op" id="7156280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156285">Method</span><span class="op" id="7156291">:</span>&nbsp;<span class="ident" id="7156293">Store</span><span class="op" id="7156298">,</span>&nbsp;<span class="comment" id="7156300">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156337">}</span><span class="op" id="7156338">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156342">if</span>&nbsp;<span class="ident" id="7156345">err</span>&nbsp;<span class="op" id="7156349">!=</span>&nbsp;<span class="ident" id="7156352">nil</span>&nbsp;<span class="op" id="7156356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156361">t</span><span class="op" id="7156362">.</span><span class="ident" id="7156363">Fatalf</span><span class="op" id="7156369">(</span><span class="string" id="7156370">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7156392">,</span>&nbsp;<span class="ident" id="7156394">i</span><span class="op" id="7156395">,</span>&nbsp;<span class="ident" id="7156397">err</span><span class="op" id="7156400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156410">if</span>&nbsp;<span class="ident" id="7156413">err</span>&nbsp;<span class="op" id="7156417">:=</span>&nbsp;<span class="ident" id="7156420">w</span><span class="op" id="7156421">.</span><span class="ident" id="7156422">Close</span><span class="op" id="7156427">(</span><span class="op" id="7156428">)</span><span class="op" id="7156429">;</span>&nbsp;<span class="ident" id="7156431">err</span>&nbsp;<span class="op" id="7156435">!=</span>&nbsp;<span class="ident" id="7156438">nil</span>&nbsp;<span class="op" id="7156442">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156446">t</span><span class="op" id="7156447">.</span><span class="ident" id="7156448">Fatalf</span><span class="op" id="7156454">(</span><span class="string" id="7156455">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7156473">,</span>&nbsp;<span class="ident" id="7156475">err</span><span class="op" id="7156478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156484">s</span>&nbsp;<span class="op" id="7156486">:=</span>&nbsp;<span class="ident" id="7156489">buf</span><span class="op" id="7156492">.</span><span class="ident" id="7156493">String</span><span class="op" id="7156499">(</span><span class="op" id="7156500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156503">zr</span><span class="op" id="7156505">,</span>&nbsp;<span class="ident" id="7156507">err</span>&nbsp;<span class="op" id="7156511">:=</span>&nbsp;<span class="ident" id="7156514">NewReader</span><span class="op" id="7156523">(</span><span class="ident" id="7156524">strings</span><span class="op" id="7156531">.</span><span class="ident" id="7156532">NewReader</span><span class="op" id="7156541">(</span><span class="ident" id="7156542">s</span><span class="op" id="7156543">)</span><span class="op" id="7156544">,</span>&nbsp;<span class="ident" id="7156546">int64</span><span class="op" id="7156551">(</span><span class="builtinfunc" id="7156552">len</span><span class="op" id="7156555">(</span><span class="ident" id="7156556">s</span><span class="op" id="7156557">)</span><span class="op" id="7156558">)</span><span class="op" id="7156559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156562">if</span>&nbsp;<span class="ident" id="7156565">err</span>&nbsp;<span class="op" id="7156569">!=</span>&nbsp;<span class="ident" id="7156572">nil</span>&nbsp;<span class="op" id="7156576">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156580">t</span><span class="op" id="7156581">.</span><span class="ident" id="7156582">Fatalf</span><span class="op" id="7156588">(</span><span class="string" id="7156589">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7156604">,</span>&nbsp;<span class="ident" id="7156606">err</span><span class="op" id="7156609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156615">if</span>&nbsp;<span class="ident" id="7156618">got</span>&nbsp;<span class="op" id="7156622">:=</span>&nbsp;<span class="builtinfunc" id="7156625">len</span><span class="op" id="7156628">(</span><span class="ident" id="7156629">zr</span><span class="op" id="7156631">.</span><span class="ident" id="7156632">File</span><span class="op" id="7156636">)</span><span class="op" id="7156637">;</span>&nbsp;<span class="ident" id="7156639">got</span>&nbsp;<span class="op" id="7156643">!=</span>&nbsp;<span class="ident" id="7156646">nFiles</span>&nbsp;<span class="op" id="7156653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156657">t</span><span class="op" id="7156658">.</span><span class="ident" id="7156659">Fatalf</span><span class="op" id="7156665">(</span><span class="string" id="7156666">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7156699">,</span>&nbsp;<span class="ident" id="7156701">got</span><span class="op" id="7156704">,</span>&nbsp;<span class="ident" id="7156706">nFiles</span><span class="op" id="7156712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156715">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156718">for</span>&nbsp;<span class="ident" id="7156722">i</span>&nbsp;<span class="op" id="7156724">:=</span>&nbsp;<span class="num" id="7156727">0</span><span class="op" id="7156728">;</span>&nbsp;<span class="ident" id="7156730">i</span>&nbsp;<span class="op" id="7156732">&lt;</span>&nbsp;<span class="ident" id="7156734">nFiles</span><span class="op" id="7156740">;</span>&nbsp;<span class="ident" id="7156742">i</span><span class="op" id="7156743">++</span>&nbsp;<span class="op" id="7156746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156750">want</span>&nbsp;<span class="op" id="7156755">:=</span>&nbsp;<span class="ident" id="7156758">fmt</span><span class="op" id="7156761">.</span><span class="ident" id="7156762">Sprintf</span><span class="op" id="7156769">(</span><span class="string" id="7156770">&#34;%d.dat&#34;</span><span class="op" id="7156778">,</span>&nbsp;<span class="ident" id="7156780">i</span><span class="op" id="7156781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156785">if</span>&nbsp;<span class="ident" id="7156788">zr</span><span class="op" id="7156790">.</span><span class="ident" id="7156791">File</span><span class="op" id="7156795">[</span><span class="ident" id="7156796">i</span><span class="op" id="7156797">]</span><span class="op" id="7156798">.</span><span class="ident" id="7156799">Name</span>&nbsp;<span class="op" id="7156804">!=</span>&nbsp;<span class="ident" id="7156807">want</span>&nbsp;<span class="op" id="7156812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156817">t</span><span class="op" id="7156818">.</span><span class="ident" id="7156819">Fatalf</span><span class="op" id="7156825">(</span><span class="string" id="7156826">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7156850">,</span>&nbsp;<span class="ident" id="7156852">i</span><span class="op" id="7156853">,</span>&nbsp;<span class="ident" id="7156855">zr</span><span class="op" id="7156857">.</span><span class="ident" id="7156858">File</span><span class="op" id="7156862">[</span><span class="ident" id="7156863">i</span><span class="op" id="7156864">]</span><span class="op" id="7156865">.</span><span class="ident" id="7156866">Name</span><span class="op" id="7156870">,</span>&nbsp;<span class="ident" id="7156872">want</span><span class="op" id="7156876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156880">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7156883">}</span><br>
<span class="lineno"></span><span class="op" id="7156885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7156888">func</span>&nbsp;<span class="ident" id="7156893">TestModTime</span><span class="op" id="7156904">(</span><span class="ident" id="7156905">t</span>&nbsp;<span class="op" id="7156907">*</span><span class="ident" id="7156908">testing</span><span class="op" id="7156915">.</span><span class="ident" id="7156916">T</span><span class="op" id="7156917">)</span>&nbsp;<span class="op" id="7156919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7156922">var</span>&nbsp;<span class="ident" id="7156926">testTime</span>&nbsp;<span class="op" id="7156935">=</span>&nbsp;<span class="ident" id="7156937">time</span><span class="op" id="7156941">.</span><span class="ident" id="7156942">Date</span><span class="op" id="7156946">(</span><span class="num" id="7156947">2009</span><span class="op" id="7156951">,</span>&nbsp;<span class="ident" id="7156953">time</span><span class="op" id="7156957">.</span><span class="ident" id="7156958">November</span><span class="op" id="7156966">,</span>&nbsp;<span class="num" id="7156968">10</span><span class="op" id="7156970">,</span>&nbsp;<span class="num" id="7156972">23</span><span class="op" id="7156974">,</span>&nbsp;<span class="num" id="7156976">45</span><span class="op" id="7156978">,</span>&nbsp;<span class="num" id="7156980">58</span><span class="op" id="7156982">,</span>&nbsp;<span class="num" id="7156984">0</span><span class="op" id="7156985">,</span>&nbsp;<span class="ident" id="7156987">time</span><span class="op" id="7156991">.</span><span class="ident" id="7156992">UTC</span><span class="op" id="7156995">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7156998">fh</span>&nbsp;<span class="op" id="7157001">:=</span>&nbsp;<span class="builtinfunc" id="7157004">new</span><span class="op" id="7157007">(</span><span class="ident" id="7157008">FileHeader</span><span class="op" id="7157018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157021">fh</span><span class="op" id="7157023">.</span><span class="ident" id="7157024">SetModTime</span><span class="op" id="7157034">(</span><span class="ident" id="7157035">testTime</span><span class="op" id="7157043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157046">outTime</span>&nbsp;<span class="op" id="7157054">:=</span>&nbsp;<span class="ident" id="7157057">fh</span><span class="op" id="7157059">.</span><span class="ident" id="7157060">ModTime</span><span class="op" id="7157067">(</span><span class="op" id="7157068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157071">if</span>&nbsp;<span class="op" id="7157074">!</span><span class="ident" id="7157075">outTime</span><span class="op" id="7157082">.</span><span class="ident" id="7157083">Equal</span><span class="op" id="7157088">(</span><span class="ident" id="7157089">testTime</span><span class="op" id="7157097">)</span>&nbsp;<span class="op" id="7157099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157103">t</span><span class="op" id="7157104">.</span><span class="ident" id="7157105">Errorf</span><span class="op" id="7157111">(</span><span class="string" id="7157112">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7157148">,</span>&nbsp;<span class="ident" id="7157150">outTime</span><span class="op" id="7157157">,</span>&nbsp;<span class="ident" id="7157159">testTime</span><span class="op" id="7157167">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157170">}</span><br>
<span class="lineno"></span><span class="op" id="7157172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7157175">func</span>&nbsp;<span class="ident" id="7157180">testHeaderRoundTrip</span><span class="op" id="7157199">(</span><span class="ident" id="7157200">fh</span>&nbsp;<span class="op" id="7157203">*</span><span class="ident" id="7157204">FileHeader</span><span class="op" id="7157214">,</span>&nbsp;<span class="ident" id="7157216">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7157237">uint32</span><span class="op" id="7157243">,</span>&nbsp;<span class="ident" id="7157245">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7157268">uint64</span><span class="op" id="7157274">,</span>&nbsp;<span class="ident" id="7157276">t</span>&nbsp;<span class="op" id="7157278">*</span><span class="ident" id="7157279">testing</span><span class="op" id="7157286">.</span><span class="ident" id="7157287">T</span><span class="op" id="7157288">)</span>&nbsp;<span class="op" id="7157290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157293">fi</span>&nbsp;<span class="op" id="7157296">:=</span>&nbsp;<span class="ident" id="7157299">fh</span><span class="op" id="7157301">.</span><span class="ident" id="7157302">FileInfo</span><span class="op" id="7157310">(</span><span class="op" id="7157311">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157314">fh2</span><span class="op" id="7157317">,</span>&nbsp;<span class="ident" id="7157319">err</span>&nbsp;<span class="op" id="7157323">:=</span>&nbsp;<span class="ident" id="7157326">FileInfoHeader</span><span class="op" id="7157340">(</span><span class="ident" id="7157341">fi</span><span class="op" id="7157343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157346">if</span>&nbsp;<span class="ident" id="7157349">err</span>&nbsp;<span class="op" id="7157353">!=</span>&nbsp;<span class="ident" id="7157356">nil</span>&nbsp;<span class="op" id="7157360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157364">t</span><span class="op" id="7157365">.</span><span class="ident" id="7157366">Fatal</span><span class="op" id="7157371">(</span><span class="ident" id="7157372">err</span><span class="op" id="7157375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157381">if</span>&nbsp;<span class="ident" id="7157384">got</span><span class="op" id="7157387">,</span>&nbsp;<span class="ident" id="7157389">want</span>&nbsp;<span class="op" id="7157394">:=</span>&nbsp;<span class="ident" id="7157397">fh2</span><span class="op" id="7157400">.</span><span class="ident" id="7157401">Name</span><span class="op" id="7157405">,</span>&nbsp;<span class="ident" id="7157407">fh</span><span class="op" id="7157409">.</span><span class="ident" id="7157410">Name</span><span class="op" id="7157414">;</span>&nbsp;<span class="ident" id="7157416">got</span>&nbsp;<span class="op" id="7157420">!=</span>&nbsp;<span class="ident" id="7157423">want</span>&nbsp;<span class="op" id="7157428">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157432">t</span><span class="op" id="7157433">.</span><span class="ident" id="7157434">Errorf</span><span class="op" id="7157440">(</span><span class="string" id="7157441">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7157466">,</span>&nbsp;<span class="ident" id="7157468">got</span><span class="op" id="7157471">,</span>&nbsp;<span class="ident" id="7157473">want</span><span class="op" id="7157477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157483">if</span>&nbsp;<span class="ident" id="7157486">got</span><span class="op" id="7157489">,</span>&nbsp;<span class="ident" id="7157491">want</span>&nbsp;<span class="op" id="7157496">:=</span>&nbsp;<span class="ident" id="7157499">fh2</span><span class="op" id="7157502">.</span><span class="ident" id="7157503">UncompressedSize</span><span class="op" id="7157519">,</span>&nbsp;<span class="ident" id="7157521">wantUncompressedSize</span><span class="op" id="7157541">;</span>&nbsp;<span class="ident" id="7157543">got</span>&nbsp;<span class="op" id="7157547">!=</span>&nbsp;<span class="ident" id="7157550">want</span>&nbsp;<span class="op" id="7157555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157559">t</span><span class="op" id="7157560">.</span><span class="ident" id="7157561">Errorf</span><span class="op" id="7157567">(</span><span class="string" id="7157568">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7157605">,</span>&nbsp;<span class="ident" id="7157607">got</span><span class="op" id="7157610">,</span>&nbsp;<span class="ident" id="7157612">want</span><span class="op" id="7157616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157619">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157622">if</span>&nbsp;<span class="ident" id="7157625">got</span><span class="op" id="7157628">,</span>&nbsp;<span class="ident" id="7157630">want</span>&nbsp;<span class="op" id="7157635">:=</span>&nbsp;<span class="ident" id="7157638">fh2</span><span class="op" id="7157641">.</span><span class="ident" id="7157642">UncompressedSize64</span><span class="op" id="7157660">,</span>&nbsp;<span class="ident" id="7157662">wantUncompressedSize64</span><span class="op" id="7157684">;</span>&nbsp;<span class="ident" id="7157686">got</span>&nbsp;<span class="op" id="7157690">!=</span>&nbsp;<span class="ident" id="7157693">want</span>&nbsp;<span class="op" id="7157698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157702">t</span><span class="op" id="7157703">.</span><span class="ident" id="7157704">Errorf</span><span class="op" id="7157710">(</span><span class="string" id="7157711">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7157750">,</span>&nbsp;<span class="ident" id="7157752">got</span><span class="op" id="7157755">,</span>&nbsp;<span class="ident" id="7157757">want</span><span class="op" id="7157761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157767">if</span>&nbsp;<span class="ident" id="7157770">got</span><span class="op" id="7157773">,</span>&nbsp;<span class="ident" id="7157775">want</span>&nbsp;<span class="op" id="7157780">:=</span>&nbsp;<span class="ident" id="7157783">fh2</span><span class="op" id="7157786">.</span><span class="ident" id="7157787">ModifiedTime</span><span class="op" id="7157799">,</span>&nbsp;<span class="ident" id="7157801">fh</span><span class="op" id="7157803">.</span><span class="ident" id="7157804">ModifiedTime</span><span class="op" id="7157816">;</span>&nbsp;<span class="ident" id="7157818">got</span>&nbsp;<span class="op" id="7157822">!=</span>&nbsp;<span class="ident" id="7157825">want</span>&nbsp;<span class="op" id="7157830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157834">t</span><span class="op" id="7157835">.</span><span class="ident" id="7157836">Errorf</span><span class="op" id="7157842">(</span><span class="string" id="7157843">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7157876">,</span>&nbsp;<span class="ident" id="7157878">got</span><span class="op" id="7157881">,</span>&nbsp;<span class="ident" id="7157883">want</span><span class="op" id="7157887">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7157890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7157893">if</span>&nbsp;<span class="ident" id="7157896">got</span><span class="op" id="7157899">,</span>&nbsp;<span class="ident" id="7157901">want</span>&nbsp;<span class="op" id="7157906">:=</span>&nbsp;<span class="ident" id="7157909">fh2</span><span class="op" id="7157912">.</span><span class="ident" id="7157913">ModifiedDate</span><span class="op" id="7157925">,</span>&nbsp;<span class="ident" id="7157927">fh</span><span class="op" id="7157929">.</span><span class="ident" id="7157930">ModifiedDate</span><span class="op" id="7157942">;</span>&nbsp;<span class="ident" id="7157944">got</span>&nbsp;<span class="op" id="7157948">!=</span>&nbsp;<span class="ident" id="7157951">want</span>&nbsp;<span class="op" id="7157956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7157960">t</span><span class="op" id="7157961">.</span><span class="ident" id="7157962">Errorf</span><span class="op" id="7157968">(</span><span class="string" id="7157969">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7158002">,</span>&nbsp;<span class="ident" id="7158004">got</span><span class="op" id="7158007">,</span>&nbsp;<span class="ident" id="7158009">want</span><span class="op" id="7158013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158020">if</span>&nbsp;<span class="ident" id="7158023">sysfh</span><span class="op" id="7158028">,</span>&nbsp;<span class="ident" id="7158030">ok</span>&nbsp;<span class="op" id="7158033">:=</span>&nbsp;<span class="ident" id="7158036">fi</span><span class="op" id="7158038">.</span><span class="ident" id="7158039">Sys</span><span class="op" id="7158042">(</span><span class="op" id="7158043">)</span><span class="op" id="7158044">.</span><span class="op" id="7158045">(</span><span class="op" id="7158046">*</span><span class="ident" id="7158047">FileHeader</span><span class="op" id="7158057">)</span><span class="op" id="7158058">;</span>&nbsp;<span class="op" id="7158060">!</span><span class="ident" id="7158061">ok</span>&nbsp;<span class="op" id="7158064">&amp;&amp;</span>&nbsp;<span class="ident" id="7158067">sysfh</span>&nbsp;<span class="op" id="7158073">!=</span>&nbsp;<span class="ident" id="7158076">fh</span>&nbsp;<span class="op" id="7158079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158083">t</span><span class="op" id="7158084">.</span><span class="ident" id="7158085">Errorf</span><span class="op" id="7158091">(</span><span class="string" id="7158092">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7158132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158135">}</span><br>
<span class="lineno"></span><span class="op" id="7158137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7158140">func</span>&nbsp;<span class="ident" id="7158145">TestFileHeaderRoundTrip</span><span class="op" id="7158168">(</span><span class="ident" id="7158169">t</span>&nbsp;<span class="op" id="7158171">*</span><span class="ident" id="7158172">testing</span><span class="op" id="7158179">.</span><span class="ident" id="7158180">T</span><span class="op" id="7158181">)</span>&nbsp;<span class="op" id="7158183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158186">fh</span>&nbsp;<span class="op" id="7158189">:=</span>&nbsp;<span class="op" id="7158192">&amp;</span><span class="ident" id="7158193">FileHeader</span><span class="op" id="7158203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158207">Name</span><span class="op" id="7158211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7158225">&#34;foo.txt&#34;</span><span class="op" id="7158234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158238">UncompressedSize</span><span class="op" id="7158254">:</span>&nbsp;<span class="num" id="7158256">987654321</span><span class="op" id="7158265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158269">ModifiedTime</span><span class="op" id="7158281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7158287">1234</span><span class="op" id="7158291">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158295">ModifiedDate</span><span class="op" id="7158307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7158313">5678</span><span class="op" id="7158317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158323">testHeaderRoundTrip</span><span class="op" id="7158342">(</span><span class="ident" id="7158343">fh</span><span class="op" id="7158345">,</span>&nbsp;<span class="ident" id="7158347">fh</span><span class="op" id="7158349">.</span><span class="ident" id="7158350">UncompressedSize</span><span class="op" id="7158366">,</span>&nbsp;<span class="ident" id="7158368">uint64</span><span class="op" id="7158374">(</span><span class="ident" id="7158375">fh</span><span class="op" id="7158377">.</span><span class="ident" id="7158378">UncompressedSize</span><span class="op" id="7158394">)</span><span class="op" id="7158395">,</span>&nbsp;<span class="ident" id="7158397">t</span><span class="op" id="7158398">)</span><br>
<span class="lineno"></span><span class="op" id="7158400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7158403">func</span>&nbsp;<span class="ident" id="7158408">TestFileHeaderRoundTrip64</span><span class="op" id="7158433">(</span><span class="ident" id="7158434">t</span>&nbsp;<span class="op" id="7158436">*</span><span class="ident" id="7158437">testing</span><span class="op" id="7158444">.</span><span class="ident" id="7158445">T</span><span class="op" id="7158446">)</span>&nbsp;<span class="op" id="7158448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158451">fh</span>&nbsp;<span class="op" id="7158454">:=</span>&nbsp;<span class="op" id="7158457">&amp;</span><span class="ident" id="7158458">FileHeader</span><span class="op" id="7158468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158472">Name</span><span class="op" id="7158476">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7158492">&#34;foo.txt&#34;</span><span class="op" id="7158501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158505">UncompressedSize64</span><span class="op" id="7158523">:</span>&nbsp;<span class="num" id="7158525">9876543210</span><span class="op" id="7158535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158539">ModifiedTime</span><span class="op" id="7158551">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7158559">1234</span><span class="op" id="7158563">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158567">ModifiedDate</span><span class="op" id="7158579">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7158587">5678</span><span class="op" id="7158591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158597">testHeaderRoundTrip</span><span class="op" id="7158616">(</span><span class="ident" id="7158617">fh</span><span class="op" id="7158619">,</span>&nbsp;<span class="ident" id="7158621">uint32max</span><span class="op" id="7158630">,</span>&nbsp;<span class="ident" id="7158632">fh</span><span class="op" id="7158634">.</span><span class="ident" id="7158635">UncompressedSize64</span><span class="op" id="7158653">,</span>&nbsp;<span class="ident" id="7158655">t</span><span class="op" id="7158656">)</span><br>
<span class="lineno"></span><span class="op" id="7158658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7158661">type</span>&nbsp;<span class="ident" id="7158666">repeatedByte</span>&nbsp;<span class="keyword" id="7158679">struct</span>&nbsp;<span class="op" id="7158686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158689">off</span>&nbsp;<span class="ident" id="7158693">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158700">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7158704">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158710">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7158714">int64</span><br>
<span class="lineno"></span><span class="op" id="7158720">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7158723">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7158773">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7158841">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7158874">type</span>&nbsp;<span class="ident" id="7158879">rleBuffer</span>&nbsp;<span class="keyword" id="7158889">struct</span>&nbsp;<span class="op" id="7158896">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158899">buf</span>&nbsp;<span class="op" id="7158903">[</span><span class="op" id="7158904">]</span><span class="ident" id="7158905">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7158918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7158921">func</span>&nbsp;<span class="op" id="7158926">(</span><span class="ident" id="7158927">r</span>&nbsp;<span class="op" id="7158929">*</span><span class="ident" id="7158930">rleBuffer</span><span class="op" id="7158939">)</span>&nbsp;<span class="ident" id="7158941">Size</span><span class="op" id="7158945">(</span><span class="op" id="7158946">)</span>&nbsp;<span class="ident" id="7158948">int64</span>&nbsp;<span class="op" id="7158954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158957">if</span>&nbsp;<span class="builtinfunc" id="7158960">len</span><span class="op" id="7158963">(</span><span class="ident" id="7158964">r</span><span class="op" id="7158965">.</span><span class="ident" id="7158966">buf</span><span class="op" id="7158969">)</span>&nbsp;<span class="op" id="7158971">==</span>&nbsp;<span class="num" id="7158974">0</span>&nbsp;<span class="op" id="7158976">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7158980">return</span>&nbsp;<span class="num" id="7158987">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7158990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7158993">last</span>&nbsp;<span class="op" id="7158998">:=</span>&nbsp;<span class="op" id="7159001">&amp;</span><span class="ident" id="7159002">r</span><span class="op" id="7159003">.</span><span class="ident" id="7159004">buf</span><span class="op" id="7159007">[</span><span class="builtinfunc" id="7159008">len</span><span class="op" id="7159011">(</span><span class="ident" id="7159012">r</span><span class="op" id="7159013">.</span><span class="ident" id="7159014">buf</span><span class="op" id="7159017">)</span><span class="op" id="7159018">-</span><span class="num" id="7159019">1</span><span class="op" id="7159020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159023">return</span>&nbsp;<span class="ident" id="7159030">last</span><span class="op" id="7159034">.</span><span class="ident" id="7159035">off</span>&nbsp;<span class="op" id="7159039">+</span>&nbsp;<span class="ident" id="7159041">last</span><span class="op" id="7159045">.</span><span class="ident" id="7159046">n</span><br>
<span class="lineno"></span><span class="op" id="7159048">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7159051">func</span>&nbsp;<span class="op" id="7159056">(</span><span class="ident" id="7159057">r</span>&nbsp;<span class="op" id="7159059">*</span><span class="ident" id="7159060">rleBuffer</span><span class="op" id="7159069">)</span>&nbsp;<span class="ident" id="7159071">Write</span><span class="op" id="7159076">(</span><span class="ident" id="7159077">p</span>&nbsp;<span class="op" id="7159079">[</span><span class="op" id="7159080">]</span><span class="builtintype" id="7159081">byte</span><span class="op" id="7159085">)</span>&nbsp;<span class="op" id="7159087">(</span><span class="ident" id="7159088">n</span>&nbsp;<span class="builtintype" id="7159090">int</span><span class="op" id="7159093">,</span>&nbsp;<span class="ident" id="7159095">err</span>&nbsp;<span class="builtintype" id="7159099">error</span><span class="op" id="7159104">)</span>&nbsp;<span class="op" id="7159106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159109">var</span>&nbsp;<span class="ident" id="7159113">rp</span>&nbsp;<span class="op" id="7159116">*</span><span class="ident" id="7159117">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159131">if</span>&nbsp;<span class="builtinfunc" id="7159134">len</span><span class="op" id="7159137">(</span><span class="ident" id="7159138">r</span><span class="op" id="7159139">.</span><span class="ident" id="7159140">buf</span><span class="op" id="7159143">)</span>&nbsp;<span class="op" id="7159145">&gt;</span>&nbsp;<span class="num" id="7159147">0</span>&nbsp;<span class="op" id="7159149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159153">rp</span>&nbsp;<span class="op" id="7159156">=</span>&nbsp;<span class="op" id="7159158">&amp;</span><span class="ident" id="7159159">r</span><span class="op" id="7159160">.</span><span class="ident" id="7159161">buf</span><span class="op" id="7159164">[</span><span class="builtinfunc" id="7159165">len</span><span class="op" id="7159168">(</span><span class="ident" id="7159169">r</span><span class="op" id="7159170">.</span><span class="ident" id="7159171">buf</span><span class="op" id="7159174">)</span><span class="op" id="7159175">-</span><span class="num" id="7159176">1</span><span class="op" id="7159177">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7159181">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159238">if</span>&nbsp;<span class="ident" id="7159241">lastByte</span>&nbsp;<span class="op" id="7159250">:=</span>&nbsp;<span class="ident" id="7159253">rp</span><span class="op" id="7159255">.</span><span class="ident" id="7159256">b</span><span class="op" id="7159257">;</span>&nbsp;<span class="builtinfunc" id="7159259">len</span><span class="op" id="7159262">(</span><span class="ident" id="7159263">p</span><span class="op" id="7159264">)</span>&nbsp;<span class="op" id="7159266">&gt;</span>&nbsp;<span class="num" id="7159268">0</span>&nbsp;<span class="op" id="7159270">&amp;&amp;</span>&nbsp;<span class="ident" id="7159273">p</span><span class="op" id="7159274">[</span><span class="num" id="7159275">0</span><span class="op" id="7159276">]</span>&nbsp;<span class="op" id="7159278">==</span>&nbsp;<span class="ident" id="7159281">lastByte</span>&nbsp;<span class="op" id="7159290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159295">all</span>&nbsp;<span class="op" id="7159299">:=</span>&nbsp;<span class="builtintype" id="7159302">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159310">for</span>&nbsp;<span class="ident" id="7159314">_</span><span class="op" id="7159315">,</span>&nbsp;<span class="ident" id="7159317">b</span>&nbsp;<span class="op" id="7159319">:=</span>&nbsp;<span class="keyword" id="7159322">range</span>&nbsp;<span class="ident" id="7159328">p</span>&nbsp;<span class="op" id="7159330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159336">if</span>&nbsp;<span class="ident" id="7159339">b</span>&nbsp;<span class="op" id="7159341">!=</span>&nbsp;<span class="ident" id="7159344">lastByte</span>&nbsp;<span class="op" id="7159353">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159360">all</span>&nbsp;<span class="op" id="7159364">=</span>&nbsp;<span class="builtintype" id="7159366">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159377">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159397">if</span>&nbsp;<span class="ident" id="7159400">all</span>&nbsp;<span class="op" id="7159404">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159410">rp</span><span class="op" id="7159412">.</span><span class="ident" id="7159413">n</span>&nbsp;<span class="op" id="7159415">+=</span>&nbsp;<span class="ident" id="7159418">int64</span><span class="op" id="7159423">(</span><span class="builtinfunc" id="7159424">len</span><span class="op" id="7159427">(</span><span class="ident" id="7159428">p</span><span class="op" id="7159429">)</span><span class="op" id="7159430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159436">return</span>&nbsp;<span class="builtinfunc" id="7159443">len</span><span class="op" id="7159446">(</span><span class="ident" id="7159447">p</span><span class="op" id="7159448">)</span><span class="op" id="7159449">,</span>&nbsp;<span class="ident" id="7159451">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159465">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159469">for</span>&nbsp;<span class="ident" id="7159473">_</span><span class="op" id="7159474">,</span>&nbsp;<span class="ident" id="7159476">b</span>&nbsp;<span class="op" id="7159478">:=</span>&nbsp;<span class="keyword" id="7159481">range</span>&nbsp;<span class="ident" id="7159487">p</span>&nbsp;<span class="op" id="7159489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159493">if</span>&nbsp;<span class="ident" id="7159496">rp</span>&nbsp;<span class="op" id="7159499">==</span>&nbsp;<span class="ident" id="7159502">nil</span>&nbsp;<span class="op" id="7159506">||</span>&nbsp;<span class="ident" id="7159509">rp</span><span class="op" id="7159511">.</span><span class="ident" id="7159512">b</span>&nbsp;<span class="op" id="7159514">!=</span>&nbsp;<span class="ident" id="7159517">b</span>&nbsp;<span class="op" id="7159519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159524">r</span><span class="op" id="7159525">.</span><span class="ident" id="7159526">buf</span>&nbsp;<span class="op" id="7159530">=</span>&nbsp;<span class="builtinfunc" id="7159532">append</span><span class="op" id="7159538">(</span><span class="ident" id="7159539">r</span><span class="op" id="7159540">.</span><span class="ident" id="7159541">buf</span><span class="op" id="7159544">,</span>&nbsp;<span class="ident" id="7159546">repeatedByte</span><span class="op" id="7159558">{</span><span class="ident" id="7159559">r</span><span class="op" id="7159560">.</span><span class="ident" id="7159561">Size</span><span class="op" id="7159565">(</span><span class="op" id="7159566">)</span><span class="op" id="7159567">,</span>&nbsp;<span class="ident" id="7159569">b</span><span class="op" id="7159570">,</span>&nbsp;<span class="num" id="7159572">1</span><span class="op" id="7159573">}</span><span class="op" id="7159574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159579">rp</span>&nbsp;<span class="op" id="7159582">=</span>&nbsp;<span class="op" id="7159584">&amp;</span><span class="ident" id="7159585">r</span><span class="op" id="7159586">.</span><span class="ident" id="7159587">buf</span><span class="op" id="7159590">[</span><span class="builtinfunc" id="7159591">len</span><span class="op" id="7159594">(</span><span class="ident" id="7159595">r</span><span class="op" id="7159596">.</span><span class="ident" id="7159597">buf</span><span class="op" id="7159600">)</span><span class="op" id="7159601">-</span><span class="num" id="7159602">1</span><span class="op" id="7159603">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159607">}</span>&nbsp;<span class="keyword" id="7159609">else</span>&nbsp;<span class="op" id="7159614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159619">rp</span><span class="op" id="7159621">.</span><span class="ident" id="7159622">n</span><span class="op" id="7159623">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159634">return</span>&nbsp;<span class="builtinfunc" id="7159641">len</span><span class="op" id="7159644">(</span><span class="ident" id="7159645">p</span><span class="op" id="7159646">)</span><span class="op" id="7159647">,</span>&nbsp;<span class="ident" id="7159649">nil</span><br>
<span class="lineno">160</span><span class="op" id="7159653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7159656">func</span>&nbsp;<span class="op" id="7159661">(</span><span class="ident" id="7159662">r</span>&nbsp;<span class="op" id="7159664">*</span><span class="ident" id="7159665">rleBuffer</span><span class="op" id="7159674">)</span>&nbsp;<span class="ident" id="7159676">ReadAt</span><span class="op" id="7159682">(</span><span class="ident" id="7159683">p</span>&nbsp;<span class="op" id="7159685">[</span><span class="op" id="7159686">]</span><span class="builtintype" id="7159687">byte</span><span class="op" id="7159691">,</span>&nbsp;<span class="ident" id="7159693">off</span>&nbsp;<span class="ident" id="7159697">int64</span><span class="op" id="7159702">)</span>&nbsp;<span class="op" id="7159704">(</span><span class="ident" id="7159705">n</span>&nbsp;<span class="builtintype" id="7159707">int</span><span class="op" id="7159710">,</span>&nbsp;<span class="ident" id="7159712">err</span>&nbsp;<span class="builtintype" id="7159716">error</span><span class="op" id="7159721">)</span>&nbsp;<span class="op" id="7159723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159726">if</span>&nbsp;<span class="builtinfunc" id="7159729">len</span><span class="op" id="7159732">(</span><span class="ident" id="7159733">p</span><span class="op" id="7159734">)</span>&nbsp;<span class="op" id="7159736">==</span>&nbsp;<span class="num" id="7159739">0</span>&nbsp;<span class="op" id="7159741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159745">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159756">skipParts</span>&nbsp;<span class="op" id="7159766">:=</span>&nbsp;<span class="ident" id="7159769">sort</span><span class="op" id="7159773">.</span><span class="ident" id="7159774">Search</span><span class="op" id="7159780">(</span><span class="builtinfunc" id="7159781">len</span><span class="op" id="7159784">(</span><span class="ident" id="7159785">r</span><span class="op" id="7159786">.</span><span class="ident" id="7159787">buf</span><span class="op" id="7159790">)</span><span class="op" id="7159791">,</span>&nbsp;<span class="keyword" id="7159793">func</span><span class="op" id="7159797">(</span><span class="ident" id="7159798">i</span>&nbsp;<span class="builtintype" id="7159800">int</span><span class="op" id="7159803">)</span>&nbsp;<span class="builtintype" id="7159805">bool</span>&nbsp;<span class="op" id="7159810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159814">part</span>&nbsp;<span class="op" id="7159819">:=</span>&nbsp;<span class="op" id="7159822">&amp;</span><span class="ident" id="7159823">r</span><span class="op" id="7159824">.</span><span class="ident" id="7159825">buf</span><span class="op" id="7159828">[</span><span class="ident" id="7159829">i</span><span class="op" id="7159830">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159834">return</span>&nbsp;<span class="ident" id="7159841">part</span><span class="op" id="7159845">.</span><span class="ident" id="7159846">off</span><span class="op" id="7159849">+</span><span class="ident" id="7159850">part</span><span class="op" id="7159854">.</span><span class="ident" id="7159855">n</span>&nbsp;<span class="op" id="7159857">&gt;</span>&nbsp;<span class="ident" id="7159859">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7159864">}</span><span class="op" id="7159865">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159868">parts</span>&nbsp;<span class="op" id="7159874">:=</span>&nbsp;<span class="ident" id="7159877">r</span><span class="op" id="7159878">.</span><span class="ident" id="7159879">buf</span><span class="op" id="7159882">[</span><span class="ident" id="7159883">skipParts</span><span class="op" id="7159892">:</span><span class="op" id="7159893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159896">if</span>&nbsp;<span class="builtinfunc" id="7159899">len</span><span class="op" id="7159902">(</span><span class="ident" id="7159903">parts</span><span class="op" id="7159908">)</span>&nbsp;<span class="op" id="7159910">&gt;</span>&nbsp;<span class="num" id="7159912">0</span>&nbsp;<span class="op" id="7159914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159918">skipBytes</span>&nbsp;<span class="op" id="7159928">:=</span>&nbsp;<span class="ident" id="7159931">off</span>&nbsp;<span class="op" id="7159935">-</span>&nbsp;<span class="ident" id="7159937">parts</span><span class="op" id="7159942">[</span><span class="num" id="7159943">0</span><span class="op" id="7159944">]</span><span class="op" id="7159945">.</span><span class="ident" id="7159946">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159952">for</span>&nbsp;<span class="builtinfunc" id="7159956">len</span><span class="op" id="7159959">(</span><span class="ident" id="7159960">parts</span><span class="op" id="7159965">)</span>&nbsp;<span class="op" id="7159967">&gt;</span>&nbsp;<span class="num" id="7159969">0</span>&nbsp;<span class="op" id="7159971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7159976">part</span>&nbsp;<span class="op" id="7159981">:=</span>&nbsp;<span class="ident" id="7159984">parts</span><span class="op" id="7159989">[</span><span class="num" id="7159990">0</span><span class="op" id="7159991">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7159996">for</span>&nbsp;<span class="ident" id="7160000">i</span>&nbsp;<span class="op" id="7160002">:=</span>&nbsp;<span class="ident" id="7160005">skipBytes</span><span class="op" id="7160014">;</span>&nbsp;<span class="ident" id="7160016">i</span>&nbsp;<span class="op" id="7160018">&lt;</span>&nbsp;<span class="ident" id="7160020">part</span><span class="op" id="7160024">.</span><span class="ident" id="7160025">n</span><span class="op" id="7160026">;</span>&nbsp;<span class="ident" id="7160028">i</span><span class="op" id="7160029">++</span>&nbsp;<span class="op" id="7160032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160038">if</span>&nbsp;<span class="ident" id="7160041">n</span>&nbsp;<span class="op" id="7160043">==</span>&nbsp;<span class="builtinfunc" id="7160046">len</span><span class="op" id="7160049">(</span><span class="ident" id="7160050">p</span><span class="op" id="7160051">)</span>&nbsp;<span class="op" id="7160053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160060">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160077">p</span><span class="op" id="7160078">[</span><span class="ident" id="7160079">n</span><span class="op" id="7160080">]</span>&nbsp;<span class="op" id="7160082">=</span>&nbsp;<span class="ident" id="7160084">part</span><span class="op" id="7160088">.</span><span class="ident" id="7160089">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160095">n</span><span class="op" id="7160096">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160107">parts</span>&nbsp;<span class="op" id="7160113">=</span>&nbsp;<span class="ident" id="7160115">parts</span><span class="op" id="7160120">[</span><span class="num" id="7160121">1</span><span class="op" id="7160122">:</span><span class="op" id="7160123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160128">skipBytes</span>&nbsp;<span class="op" id="7160138">=</span>&nbsp;<span class="num" id="7160140">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160144">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160150">if</span>&nbsp;<span class="ident" id="7160153">n</span>&nbsp;<span class="op" id="7160155">!=</span>&nbsp;<span class="builtinfunc" id="7160158">len</span><span class="op" id="7160161">(</span><span class="ident" id="7160162">p</span><span class="op" id="7160163">)</span>&nbsp;<span class="op" id="7160165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160169">err</span>&nbsp;<span class="op" id="7160173">=</span>&nbsp;<span class="ident" id="7160175">io</span><span class="op" id="7160177">.</span><span class="ident" id="7160178">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160199">return</span><br>
<span class="lineno">190</span><span class="op" id="7160206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7160209">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7160295">func</span>&nbsp;<span class="ident" id="7160300">TestRLEBuffer</span><span class="op" id="7160313">(</span><span class="ident" id="7160314">t</span>&nbsp;<span class="op" id="7160316">*</span><span class="ident" id="7160317">testing</span><span class="op" id="7160324">.</span><span class="ident" id="7160325">T</span><span class="op" id="7160326">)</span>&nbsp;<span class="op" id="7160328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160331">b</span>&nbsp;<span class="op" id="7160333">:=</span>&nbsp;<span class="builtinfunc" id="7160336">new</span><span class="op" id="7160339">(</span><span class="ident" id="7160340">rleBuffer</span><span class="op" id="7160349">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160352">var</span>&nbsp;<span class="ident" id="7160356">all</span>&nbsp;<span class="op" id="7160360">[</span><span class="op" id="7160361">]</span><span class="builtintype" id="7160362">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160368">writes</span>&nbsp;<span class="op" id="7160375">:=</span>&nbsp;<span class="op" id="7160378">[</span><span class="op" id="7160379">]</span><span class="builtintype" id="7160380">string</span><span class="op" id="7160386">{</span><span class="string" id="7160387">&#34;abcdeee&#34;</span><span class="op" id="7160396">,</span>&nbsp;<span class="string" id="7160398">&#34;eeeeeee&#34;</span><span class="op" id="7160407">,</span>&nbsp;<span class="string" id="7160409">&#34;eeeefghaaiii&#34;</span><span class="op" id="7160423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160426">for</span>&nbsp;<span class="ident" id="7160430">_</span><span class="op" id="7160431">,</span>&nbsp;<span class="ident" id="7160433">w</span>&nbsp;<span class="op" id="7160435">:=</span>&nbsp;<span class="keyword" id="7160438">range</span>&nbsp;<span class="ident" id="7160444">writes</span>&nbsp;<span class="op" id="7160451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160455">b</span><span class="op" id="7160456">.</span><span class="ident" id="7160457">Write</span><span class="op" id="7160462">(</span><span class="op" id="7160463">[</span><span class="op" id="7160464">]</span><span class="builtintype" id="7160465">byte</span><span class="op" id="7160469">(</span><span class="ident" id="7160470">w</span><span class="op" id="7160471">)</span><span class="op" id="7160472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160476">all</span>&nbsp;<span class="op" id="7160480">=</span>&nbsp;<span class="builtinfunc" id="7160482">append</span><span class="op" id="7160488">(</span><span class="ident" id="7160489">all</span><span class="op" id="7160492">,</span>&nbsp;<span class="ident" id="7160494">w</span><span class="op" id="7160495">...</span><span class="op" id="7160498">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160504">if</span>&nbsp;<span class="builtinfunc" id="7160507">len</span><span class="op" id="7160510">(</span><span class="ident" id="7160511">b</span><span class="op" id="7160512">.</span><span class="ident" id="7160513">buf</span><span class="op" id="7160516">)</span>&nbsp;<span class="op" id="7160518">!=</span>&nbsp;<span class="num" id="7160521">10</span>&nbsp;<span class="op" id="7160524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160528">t</span><span class="op" id="7160529">.</span><span class="ident" id="7160530">Fatalf</span><span class="op" id="7160536">(</span><span class="string" id="7160537">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7160563">,</span>&nbsp;<span class="builtinfunc" id="7160565">len</span><span class="op" id="7160568">(</span><span class="ident" id="7160569">b</span><span class="op" id="7160570">.</span><span class="ident" id="7160571">buf</span><span class="op" id="7160574">)</span><span class="op" id="7160575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160582">for</span>&nbsp;<span class="ident" id="7160586">i</span>&nbsp;<span class="op" id="7160588">:=</span>&nbsp;<span class="num" id="7160591">0</span><span class="op" id="7160592">;</span>&nbsp;<span class="ident" id="7160594">i</span>&nbsp;<span class="op" id="7160596">&lt;</span>&nbsp;<span class="builtinfunc" id="7160598">len</span><span class="op" id="7160601">(</span><span class="ident" id="7160602">all</span><span class="op" id="7160605">)</span><span class="op" id="7160606">;</span>&nbsp;<span class="ident" id="7160608">i</span><span class="op" id="7160609">++</span>&nbsp;<span class="op" id="7160612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160616">for</span>&nbsp;<span class="ident" id="7160620">j</span>&nbsp;<span class="op" id="7160622">:=</span>&nbsp;<span class="num" id="7160625">0</span><span class="op" id="7160626">;</span>&nbsp;<span class="ident" id="7160628">j</span>&nbsp;<span class="op" id="7160630">&lt;</span>&nbsp;<span class="builtinfunc" id="7160632">len</span><span class="op" id="7160635">(</span><span class="ident" id="7160636">all</span><span class="op" id="7160639">)</span><span class="op" id="7160640">-</span><span class="ident" id="7160641">i</span><span class="op" id="7160642">;</span>&nbsp;<span class="ident" id="7160644">j</span><span class="op" id="7160645">++</span>&nbsp;<span class="op" id="7160648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160653">buf</span>&nbsp;<span class="op" id="7160657">:=</span>&nbsp;<span class="builtinfunc" id="7160660">make</span><span class="op" id="7160664">(</span><span class="op" id="7160665">[</span><span class="op" id="7160666">]</span><span class="builtintype" id="7160667">byte</span><span class="op" id="7160671">,</span>&nbsp;<span class="ident" id="7160673">j</span><span class="op" id="7160674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160679">n</span><span class="op" id="7160680">,</span>&nbsp;<span class="ident" id="7160682">err</span>&nbsp;<span class="op" id="7160686">:=</span>&nbsp;<span class="ident" id="7160689">b</span><span class="op" id="7160690">.</span><span class="ident" id="7160691">ReadAt</span><span class="op" id="7160697">(</span><span class="ident" id="7160698">buf</span><span class="op" id="7160701">,</span>&nbsp;<span class="ident" id="7160703">int64</span><span class="op" id="7160708">(</span><span class="ident" id="7160709">i</span><span class="op" id="7160710">)</span><span class="op" id="7160711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160716">if</span>&nbsp;<span class="ident" id="7160719">err</span>&nbsp;<span class="op" id="7160723">!=</span>&nbsp;<span class="ident" id="7160726">nil</span>&nbsp;<span class="op" id="7160730">||</span>&nbsp;<span class="ident" id="7160733">n</span>&nbsp;<span class="op" id="7160735">!=</span>&nbsp;<span class="builtinfunc" id="7160738">len</span><span class="op" id="7160741">(</span><span class="ident" id="7160742">buf</span><span class="op" id="7160745">)</span>&nbsp;<span class="op" id="7160747">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160753">t</span><span class="op" id="7160754">.</span><span class="ident" id="7160755">Errorf</span><span class="op" id="7160761">(</span><span class="string" id="7160762">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7160801">,</span>&nbsp;<span class="ident" id="7160803">i</span><span class="op" id="7160804">,</span>&nbsp;<span class="ident" id="7160806">j</span><span class="op" id="7160807">,</span>&nbsp;<span class="ident" id="7160809">n</span><span class="op" id="7160810">,</span>&nbsp;<span class="ident" id="7160812">err</span><span class="op" id="7160815">,</span>&nbsp;<span class="builtinfunc" id="7160817">len</span><span class="op" id="7160820">(</span><span class="ident" id="7160821">buf</span><span class="op" id="7160824">)</span><span class="op" id="7160825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7160835">if</span>&nbsp;<span class="op" id="7160838">!</span><span class="ident" id="7160839">bytes</span><span class="op" id="7160844">.</span><span class="ident" id="7160845">Equal</span><span class="op" id="7160850">(</span><span class="ident" id="7160851">buf</span><span class="op" id="7160854">,</span>&nbsp;<span class="ident" id="7160856">all</span><span class="op" id="7160859">[</span><span class="ident" id="7160860">i</span><span class="op" id="7160861">:</span><span class="ident" id="7160862">i</span><span class="op" id="7160863">+</span><span class="ident" id="7160864">j</span><span class="op" id="7160865">]</span><span class="op" id="7160866">)</span>&nbsp;<span class="op" id="7160868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7160874">t</span><span class="op" id="7160875">.</span><span class="ident" id="7160876">Errorf</span><span class="op" id="7160882">(</span><span class="string" id="7160883">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7160913">,</span>&nbsp;<span class="ident" id="7160915">i</span><span class="op" id="7160916">,</span>&nbsp;<span class="ident" id="7160918">j</span><span class="op" id="7160919">,</span>&nbsp;<span class="ident" id="7160921">buf</span><span class="op" id="7160924">,</span>&nbsp;<span class="ident" id="7160926">all</span><span class="op" id="7160929">[</span><span class="ident" id="7160930">i</span><span class="op" id="7160931">:</span><span class="ident" id="7160932">i</span><span class="op" id="7160933">+</span><span class="ident" id="7160934">j</span><span class="op" id="7160935">]</span><span class="op" id="7160936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160941">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7160948">}</span><br>
<span class="lineno"></span><span class="op" id="7160950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7160953">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7161008">type</span>&nbsp;<span class="ident" id="7161013">fakeHash32</span>&nbsp;<span class="keyword" id="7161024">struct</span>&nbsp;<span class="op" id="7161031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161034">hash</span><span class="op" id="7161038">.</span><span class="ident" id="7161039">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7161046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161049">func</span>&nbsp;<span class="op" id="7161054">(</span><span class="ident" id="7161055">fakeHash32</span><span class="op" id="7161065">)</span>&nbsp;<span class="ident" id="7161067">Write</span><span class="op" id="7161072">(</span><span class="ident" id="7161073">p</span>&nbsp;<span class="op" id="7161075">[</span><span class="op" id="7161076">]</span><span class="builtintype" id="7161077">byte</span><span class="op" id="7161081">)</span>&nbsp;<span class="op" id="7161083">(</span><span class="builtintype" id="7161084">int</span><span class="op" id="7161087">,</span>&nbsp;<span class="builtintype" id="7161089">error</span><span class="op" id="7161094">)</span>&nbsp;<span class="op" id="7161096">{</span>&nbsp;<span class="keyword" id="7161098">return</span>&nbsp;<span class="builtinfunc" id="7161105">len</span><span class="op" id="7161108">(</span><span class="ident" id="7161109">p</span><span class="op" id="7161110">)</span><span class="op" id="7161111">,</span>&nbsp;<span class="ident" id="7161113">nil</span>&nbsp;<span class="op" id="7161117">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7161119">func</span>&nbsp;<span class="op" id="7161124">(</span><span class="ident" id="7161125">fakeHash32</span><span class="op" id="7161135">)</span>&nbsp;<span class="ident" id="7161137">Sum32</span><span class="op" id="7161142">(</span><span class="op" id="7161143">)</span>&nbsp;<span class="builtintype" id="7161145">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161166">{</span>&nbsp;<span class="keyword" id="7161168">return</span>&nbsp;<span class="num" id="7161175">0</span>&nbsp;<span class="op" id="7161177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161180">func</span>&nbsp;<span class="ident" id="7161185">TestZip64</span><span class="op" id="7161194">(</span><span class="ident" id="7161195">t</span>&nbsp;<span class="op" id="7161197">*</span><span class="ident" id="7161198">testing</span><span class="op" id="7161205">.</span><span class="ident" id="7161206">T</span><span class="op" id="7161207">)</span>&nbsp;<span class="op" id="7161209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161212">if</span>&nbsp;<span class="ident" id="7161215">testing</span><span class="op" id="7161222">.</span><span class="ident" id="7161223">Short</span><span class="op" id="7161228">(</span><span class="op" id="7161229">)</span>&nbsp;<span class="op" id="7161231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161235">t</span><span class="op" id="7161236">.</span><span class="ident" id="7161237">Skip</span><span class="op" id="7161241">(</span><span class="string" id="7161242">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7161263">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161269">const</span>&nbsp;<span class="ident" id="7161275">size</span>&nbsp;<span class="op" id="7161280">=</span>&nbsp;<span class="num" id="7161282">1</span>&nbsp;<span class="op" id="7161284">&lt;&lt;</span>&nbsp;<span class="num" id="7161287">32</span>&nbsp;<span class="comment" id="7161290">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161318">testZip64</span><span class="op" id="7161327">(</span><span class="ident" id="7161328">t</span><span class="op" id="7161329">,</span>&nbsp;<span class="ident" id="7161331">size</span><span class="op" id="7161335">)</span><br>
<span class="lineno"></span><span class="op" id="7161337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7161340">func</span>&nbsp;<span class="ident" id="7161345">testZip64</span><span class="op" id="7161354">(</span><span class="ident" id="7161355">t</span>&nbsp;<span class="ident" id="7161357">testing</span><span class="op" id="7161364">.</span><span class="ident" id="7161365">TB</span><span class="op" id="7161367">,</span>&nbsp;<span class="ident" id="7161369">size</span>&nbsp;<span class="ident" id="7161374">int64</span><span class="op" id="7161379">)</span>&nbsp;<span class="op" id="7161381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161384">const</span>&nbsp;<span class="ident" id="7161390">chunkSize</span>&nbsp;<span class="op" id="7161400">=</span>&nbsp;<span class="num" id="7161402">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161408">chunks</span>&nbsp;<span class="op" id="7161415">:=</span>&nbsp;<span class="builtintype" id="7161418">int</span><span class="op" id="7161421">(</span><span class="ident" id="7161422">size</span>&nbsp;<span class="op" id="7161427">/</span>&nbsp;<span class="ident" id="7161429">chunkSize</span><span class="op" id="7161438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7161441">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161489">buf</span>&nbsp;<span class="op" id="7161493">:=</span>&nbsp;<span class="builtinfunc" id="7161496">new</span><span class="op" id="7161499">(</span><span class="ident" id="7161500">rleBuffer</span><span class="op" id="7161509">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161512">w</span>&nbsp;<span class="op" id="7161514">:=</span>&nbsp;<span class="ident" id="7161517">NewWriter</span><span class="op" id="7161526">(</span><span class="ident" id="7161527">buf</span><span class="op" id="7161530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161533">f</span><span class="op" id="7161534">,</span>&nbsp;<span class="ident" id="7161536">err</span>&nbsp;<span class="op" id="7161540">:=</span>&nbsp;<span class="ident" id="7161543">w</span><span class="op" id="7161544">.</span><span class="ident" id="7161545">CreateHeader</span><span class="op" id="7161557">(</span><span class="op" id="7161558">&amp;</span><span class="ident" id="7161559">FileHeader</span><span class="op" id="7161569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161573">Name</span><span class="op" id="7161577">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7161581">&#34;huge.txt&#34;</span><span class="op" id="7161591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161595">Method</span><span class="op" id="7161601">:</span>&nbsp;<span class="ident" id="7161603">Store</span><span class="op" id="7161608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161611">}</span><span class="op" id="7161612">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161615">if</span>&nbsp;<span class="ident" id="7161618">err</span>&nbsp;<span class="op" id="7161622">!=</span>&nbsp;<span class="ident" id="7161625">nil</span>&nbsp;<span class="op" id="7161629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161633">t</span><span class="op" id="7161634">.</span><span class="ident" id="7161635">Fatal</span><span class="op" id="7161640">(</span><span class="ident" id="7161641">err</span><span class="op" id="7161644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161650">f</span><span class="op" id="7161651">.</span><span class="op" id="7161652">(</span><span class="op" id="7161653">*</span><span class="ident" id="7161654">fileWriter</span><span class="op" id="7161664">)</span><span class="op" id="7161665">.</span><span class="ident" id="7161666">crc32</span>&nbsp;<span class="op" id="7161672">=</span>&nbsp;<span class="ident" id="7161674">fakeHash32</span><span class="op" id="7161684">{</span><span class="op" id="7161685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161688">chunk</span>&nbsp;<span class="op" id="7161694">:=</span>&nbsp;<span class="builtinfunc" id="7161697">make</span><span class="op" id="7161701">(</span><span class="op" id="7161702">[</span><span class="op" id="7161703">]</span><span class="builtintype" id="7161704">byte</span><span class="op" id="7161708">,</span>&nbsp;<span class="ident" id="7161710">chunkSize</span><span class="op" id="7161719">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161722">for</span>&nbsp;<span class="ident" id="7161726">i</span>&nbsp;<span class="op" id="7161728">:=</span>&nbsp;<span class="keyword" id="7161731">range</span>&nbsp;<span class="ident" id="7161737">chunk</span>&nbsp;<span class="op" id="7161743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161747">chunk</span><span class="op" id="7161752">[</span><span class="ident" id="7161753">i</span><span class="op" id="7161754">]</span>&nbsp;<span class="op" id="7161756">=</span>&nbsp;<span class="string" id="7161758">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161766">for</span>&nbsp;<span class="ident" id="7161770">i</span>&nbsp;<span class="op" id="7161772">:=</span>&nbsp;<span class="num" id="7161775">0</span><span class="op" id="7161776">;</span>&nbsp;<span class="ident" id="7161778">i</span>&nbsp;<span class="op" id="7161780">&lt;</span>&nbsp;<span class="ident" id="7161782">chunks</span><span class="op" id="7161788">;</span>&nbsp;<span class="ident" id="7161790">i</span><span class="op" id="7161791">++</span>&nbsp;<span class="op" id="7161794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161798">_</span><span class="op" id="7161799">,</span>&nbsp;<span class="ident" id="7161801">err</span>&nbsp;<span class="op" id="7161805">:=</span>&nbsp;<span class="ident" id="7161808">f</span><span class="op" id="7161809">.</span><span class="ident" id="7161810">Write</span><span class="op" id="7161815">(</span><span class="ident" id="7161816">chunk</span><span class="op" id="7161821">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161825">if</span>&nbsp;<span class="ident" id="7161828">err</span>&nbsp;<span class="op" id="7161832">!=</span>&nbsp;<span class="ident" id="7161835">nil</span>&nbsp;<span class="op" id="7161839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161844">t</span><span class="op" id="7161845">.</span><span class="ident" id="7161846">Fatal</span><span class="op" id="7161851">(</span><span class="string" id="7161852">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7161866">,</span>&nbsp;<span class="ident" id="7161868">err</span><span class="op" id="7161871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161881">end</span>&nbsp;<span class="op" id="7161885">:=</span>&nbsp;<span class="op" id="7161888">[</span><span class="op" id="7161889">]</span><span class="builtintype" id="7161890">byte</span><span class="op" id="7161894">(</span><span class="string" id="7161895">&#34;END\n&#34;</span><span class="op" id="7161902">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161905">_</span><span class="op" id="7161906">,</span>&nbsp;<span class="ident" id="7161908">err</span>&nbsp;<span class="op" id="7161912">=</span>&nbsp;<span class="ident" id="7161914">f</span><span class="op" id="7161915">.</span><span class="ident" id="7161916">Write</span><span class="op" id="7161921">(</span><span class="ident" id="7161922">end</span><span class="op" id="7161925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161928">if</span>&nbsp;<span class="ident" id="7161931">err</span>&nbsp;<span class="op" id="7161935">!=</span>&nbsp;<span class="ident" id="7161938">nil</span>&nbsp;<span class="op" id="7161942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7161946">t</span><span class="op" id="7161947">.</span><span class="ident" id="7161948">Fatal</span><span class="op" id="7161953">(</span><span class="string" id="7161954">&#34;write&nbsp;end:&#34;</span><span class="op" id="7161966">,</span>&nbsp;<span class="ident" id="7161968">err</span><span class="op" id="7161971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7161974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7161977">if</span>&nbsp;<span class="ident" id="7161980">err</span>&nbsp;<span class="op" id="7161984">:=</span>&nbsp;<span class="ident" id="7161987">w</span><span class="op" id="7161988">.</span><span class="ident" id="7161989">Close</span><span class="op" id="7161994">(</span><span class="op" id="7161995">)</span><span class="op" id="7161996">;</span>&nbsp;<span class="ident" id="7161998">err</span>&nbsp;<span class="op" id="7162002">!=</span>&nbsp;<span class="ident" id="7162005">nil</span>&nbsp;<span class="op" id="7162009">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162013">t</span><span class="op" id="7162014">.</span><span class="ident" id="7162015">Fatal</span><span class="op" id="7162020">(</span><span class="ident" id="7162021">err</span><span class="op" id="7162024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7162031">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162093">r</span><span class="op" id="7162094">,</span>&nbsp;<span class="ident" id="7162096">err</span>&nbsp;<span class="op" id="7162100">:=</span>&nbsp;<span class="ident" id="7162103">NewReader</span><span class="op" id="7162112">(</span><span class="ident" id="7162113">buf</span><span class="op" id="7162116">,</span>&nbsp;<span class="ident" id="7162118">int64</span><span class="op" id="7162123">(</span><span class="ident" id="7162124">buf</span><span class="op" id="7162127">.</span><span class="ident" id="7162128">Size</span><span class="op" id="7162132">(</span><span class="op" id="7162133">)</span><span class="op" id="7162134">)</span><span class="op" id="7162135">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162138">if</span>&nbsp;<span class="ident" id="7162141">err</span>&nbsp;<span class="op" id="7162145">!=</span>&nbsp;<span class="ident" id="7162148">nil</span>&nbsp;<span class="op" id="7162152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162156">t</span><span class="op" id="7162157">.</span><span class="ident" id="7162158">Fatal</span><span class="op" id="7162163">(</span><span class="string" id="7162164">&#34;reader:&#34;</span><span class="op" id="7162173">,</span>&nbsp;<span class="ident" id="7162175">err</span><span class="op" id="7162178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162184">f0</span>&nbsp;<span class="op" id="7162187">:=</span>&nbsp;<span class="ident" id="7162190">r</span><span class="op" id="7162191">.</span><span class="ident" id="7162192">File</span><span class="op" id="7162196">[</span><span class="num" id="7162197">0</span><span class="op" id="7162198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162201">rc</span><span class="op" id="7162203">,</span>&nbsp;<span class="ident" id="7162205">err</span>&nbsp;<span class="op" id="7162209">:=</span>&nbsp;<span class="ident" id="7162212">f0</span><span class="op" id="7162214">.</span><span class="ident" id="7162215">Open</span><span class="op" id="7162219">(</span><span class="op" id="7162220">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162223">if</span>&nbsp;<span class="ident" id="7162226">err</span>&nbsp;<span class="op" id="7162230">!=</span>&nbsp;<span class="ident" id="7162233">nil</span>&nbsp;<span class="op" id="7162237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162241">t</span><span class="op" id="7162242">.</span><span class="ident" id="7162243">Fatal</span><span class="op" id="7162248">(</span><span class="string" id="7162249">&#34;opening:&#34;</span><span class="op" id="7162259">,</span>&nbsp;<span class="ident" id="7162261">err</span><span class="op" id="7162264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162270">rc</span><span class="op" id="7162272">.</span><span class="op" id="7162273">(</span><span class="op" id="7162274">*</span><span class="ident" id="7162275">checksumReader</span><span class="op" id="7162289">)</span><span class="op" id="7162290">.</span><span class="ident" id="7162291">hash</span>&nbsp;<span class="op" id="7162296">=</span>&nbsp;<span class="ident" id="7162298">fakeHash32</span><span class="op" id="7162308">{</span><span class="op" id="7162309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162312">for</span>&nbsp;<span class="ident" id="7162316">i</span>&nbsp;<span class="op" id="7162318">:=</span>&nbsp;<span class="num" id="7162321">0</span><span class="op" id="7162322">;</span>&nbsp;<span class="ident" id="7162324">i</span>&nbsp;<span class="op" id="7162326">&lt;</span>&nbsp;<span class="ident" id="7162328">chunks</span><span class="op" id="7162334">;</span>&nbsp;<span class="ident" id="7162336">i</span><span class="op" id="7162337">++</span>&nbsp;<span class="op" id="7162340">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162344">_</span><span class="op" id="7162345">,</span>&nbsp;<span class="ident" id="7162347">err</span>&nbsp;<span class="op" id="7162351">:=</span>&nbsp;<span class="ident" id="7162354">io</span><span class="op" id="7162356">.</span><span class="ident" id="7162357">ReadFull</span><span class="op" id="7162365">(</span><span class="ident" id="7162366">rc</span><span class="op" id="7162368">,</span>&nbsp;<span class="ident" id="7162370">chunk</span><span class="op" id="7162375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162379">if</span>&nbsp;<span class="ident" id="7162382">err</span>&nbsp;<span class="op" id="7162386">!=</span>&nbsp;<span class="ident" id="7162389">nil</span>&nbsp;<span class="op" id="7162393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162398">t</span><span class="op" id="7162399">.</span><span class="ident" id="7162400">Fatal</span><span class="op" id="7162405">(</span><span class="string" id="7162406">&#34;read:&#34;</span><span class="op" id="7162413">,</span>&nbsp;<span class="ident" id="7162415">err</span><span class="op" id="7162418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162425">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162428">gotEnd</span><span class="op" id="7162434">,</span>&nbsp;<span class="ident" id="7162436">err</span>&nbsp;<span class="op" id="7162440">:=</span>&nbsp;<span class="ident" id="7162443">ioutil</span><span class="op" id="7162449">.</span><span class="ident" id="7162450">ReadAll</span><span class="op" id="7162457">(</span><span class="ident" id="7162458">rc</span><span class="op" id="7162460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162463">if</span>&nbsp;<span class="ident" id="7162466">err</span>&nbsp;<span class="op" id="7162470">!=</span>&nbsp;<span class="ident" id="7162473">nil</span>&nbsp;<span class="op" id="7162477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162481">t</span><span class="op" id="7162482">.</span><span class="ident" id="7162483">Fatal</span><span class="op" id="7162488">(</span><span class="string" id="7162489">&#34;read&nbsp;end:&#34;</span><span class="op" id="7162500">,</span>&nbsp;<span class="ident" id="7162502">err</span><span class="op" id="7162505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162511">if</span>&nbsp;<span class="op" id="7162514">!</span><span class="ident" id="7162515">bytes</span><span class="op" id="7162520">.</span><span class="ident" id="7162521">Equal</span><span class="op" id="7162526">(</span><span class="ident" id="7162527">gotEnd</span><span class="op" id="7162533">,</span>&nbsp;<span class="ident" id="7162535">end</span><span class="op" id="7162538">)</span>&nbsp;<span class="op" id="7162540">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162544">t</span><span class="op" id="7162545">.</span><span class="ident" id="7162546">Errorf</span><span class="op" id="7162552">(</span><span class="string" id="7162553">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7162587">,</span>&nbsp;<span class="ident" id="7162589">gotEnd</span><span class="op" id="7162595">,</span>&nbsp;<span class="ident" id="7162597">end</span><span class="op" id="7162600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162606">err</span>&nbsp;<span class="op" id="7162610">=</span>&nbsp;<span class="ident" id="7162612">rc</span><span class="op" id="7162614">.</span><span class="ident" id="7162615">Close</span><span class="op" id="7162620">(</span><span class="op" id="7162621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162624">if</span>&nbsp;<span class="ident" id="7162627">err</span>&nbsp;<span class="op" id="7162631">!=</span>&nbsp;<span class="ident" id="7162634">nil</span>&nbsp;<span class="op" id="7162638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162642">t</span><span class="op" id="7162643">.</span><span class="ident" id="7162644">Fatal</span><span class="op" id="7162649">(</span><span class="string" id="7162650">&#34;closing:&#34;</span><span class="op" id="7162660">,</span>&nbsp;<span class="ident" id="7162662">err</span><span class="op" id="7162665">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162671">if</span>&nbsp;<span class="ident" id="7162674">size</span>&nbsp;<span class="op" id="7162679">==</span>&nbsp;<span class="num" id="7162682">1</span><span class="op" id="7162683">&lt;&lt;</span><span class="num" id="7162685">32</span>&nbsp;<span class="op" id="7162688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162692">if</span>&nbsp;<span class="ident" id="7162695">got</span><span class="op" id="7162698">,</span>&nbsp;<span class="ident" id="7162700">want</span>&nbsp;<span class="op" id="7162705">:=</span>&nbsp;<span class="ident" id="7162708">f0</span><span class="op" id="7162710">.</span><span class="ident" id="7162711">UncompressedSize</span><span class="op" id="7162727">,</span>&nbsp;<span class="builtintype" id="7162729">uint32</span><span class="op" id="7162735">(</span><span class="ident" id="7162736">uint32max</span><span class="op" id="7162745">)</span><span class="op" id="7162746">;</span>&nbsp;<span class="ident" id="7162748">got</span>&nbsp;<span class="op" id="7162752">!=</span>&nbsp;<span class="ident" id="7162755">want</span>&nbsp;<span class="op" id="7162760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162765">t</span><span class="op" id="7162766">.</span><span class="ident" id="7162767">Errorf</span><span class="op" id="7162773">(</span><span class="string" id="7162774">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7162804">,</span>&nbsp;<span class="ident" id="7162806">got</span><span class="op" id="7162809">,</span>&nbsp;<span class="ident" id="7162811">want</span><span class="op" id="7162815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162819">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7162826">if</span>&nbsp;<span class="ident" id="7162829">got</span><span class="op" id="7162832">,</span>&nbsp;<span class="ident" id="7162834">want</span>&nbsp;<span class="op" id="7162839">:=</span>&nbsp;<span class="ident" id="7162842">f0</span><span class="op" id="7162844">.</span><span class="ident" id="7162845">UncompressedSize64</span><span class="op" id="7162863">,</span>&nbsp;<span class="ident" id="7162865">uint64</span><span class="op" id="7162871">(</span><span class="ident" id="7162872">size</span><span class="op" id="7162876">)</span><span class="op" id="7162877">+</span><span class="ident" id="7162878">uint64</span><span class="op" id="7162884">(</span><span class="builtinfunc" id="7162885">len</span><span class="op" id="7162888">(</span><span class="ident" id="7162889">end</span><span class="op" id="7162892">)</span><span class="op" id="7162893">)</span><span class="op" id="7162894">;</span>&nbsp;<span class="ident" id="7162896">got</span>&nbsp;<span class="op" id="7162900">!=</span>&nbsp;<span class="ident" id="7162903">want</span>&nbsp;<span class="op" id="7162908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7162912">t</span><span class="op" id="7162913">.</span><span class="ident" id="7162914">Errorf</span><span class="op" id="7162920">(</span><span class="string" id="7162921">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7162953">,</span>&nbsp;<span class="ident" id="7162955">got</span><span class="op" id="7162958">,</span>&nbsp;<span class="ident" id="7162960">want</span><span class="op" id="7162964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7162967">}</span><br>
<span class="lineno">305</span><span class="op" id="7162969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7162972">func</span>&nbsp;<span class="ident" id="7162977">testInvalidHeader</span><span class="op" id="7162994">(</span><span class="ident" id="7162995">h</span>&nbsp;<span class="op" id="7162997">*</span><span class="ident" id="7162998">FileHeader</span><span class="op" id="7163008">,</span>&nbsp;<span class="ident" id="7163010">t</span>&nbsp;<span class="op" id="7163012">*</span><span class="ident" id="7163013">testing</span><span class="op" id="7163020">.</span><span class="ident" id="7163021">T</span><span class="op" id="7163022">)</span>&nbsp;<span class="op" id="7163024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163027">var</span>&nbsp;<span class="ident" id="7163031">buf</span>&nbsp;<span class="ident" id="7163035">bytes</span><span class="op" id="7163040">.</span><span class="ident" id="7163041">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163049">z</span>&nbsp;<span class="op" id="7163051">:=</span>&nbsp;<span class="ident" id="7163054">NewWriter</span><span class="op" id="7163063">(</span><span class="op" id="7163064">&amp;</span><span class="ident" id="7163065">buf</span><span class="op" id="7163068">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163072">f</span><span class="op" id="7163073">,</span>&nbsp;<span class="ident" id="7163075">err</span>&nbsp;<span class="op" id="7163079">:=</span>&nbsp;<span class="ident" id="7163082">z</span><span class="op" id="7163083">.</span><span class="ident" id="7163084">CreateHeader</span><span class="op" id="7163096">(</span><span class="ident" id="7163097">h</span><span class="op" id="7163098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163101">if</span>&nbsp;<span class="ident" id="7163104">err</span>&nbsp;<span class="op" id="7163108">!=</span>&nbsp;<span class="ident" id="7163111">nil</span>&nbsp;<span class="op" id="7163115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163119">t</span><span class="op" id="7163120">.</span><span class="ident" id="7163121">Fatalf</span><span class="op" id="7163127">(</span><span class="string" id="7163128">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7163155">,</span>&nbsp;<span class="ident" id="7163157">err</span><span class="op" id="7163160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163163">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163166">if</span>&nbsp;<span class="ident" id="7163169">_</span><span class="op" id="7163170">,</span>&nbsp;<span class="ident" id="7163172">err</span>&nbsp;<span class="op" id="7163176">:=</span>&nbsp;<span class="ident" id="7163179">f</span><span class="op" id="7163180">.</span><span class="ident" id="7163181">Write</span><span class="op" id="7163186">(</span><span class="op" id="7163187">[</span><span class="op" id="7163188">]</span><span class="builtintype" id="7163189">byte</span><span class="op" id="7163193">(</span><span class="string" id="7163194">&#34;hi&#34;</span><span class="op" id="7163198">)</span><span class="op" id="7163199">)</span><span class="op" id="7163200">;</span>&nbsp;<span class="ident" id="7163202">err</span>&nbsp;<span class="op" id="7163206">!=</span>&nbsp;<span class="ident" id="7163209">nil</span>&nbsp;<span class="op" id="7163213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163217">t</span><span class="op" id="7163218">.</span><span class="ident" id="7163219">Fatalf</span><span class="op" id="7163225">(</span><span class="string" id="7163226">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7163253">,</span>&nbsp;<span class="ident" id="7163255">err</span><span class="op" id="7163258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163264">if</span>&nbsp;<span class="ident" id="7163267">err</span>&nbsp;<span class="op" id="7163271">:=</span>&nbsp;<span class="ident" id="7163274">z</span><span class="op" id="7163275">.</span><span class="ident" id="7163276">Close</span><span class="op" id="7163281">(</span><span class="op" id="7163282">)</span><span class="op" id="7163283">;</span>&nbsp;<span class="ident" id="7163285">err</span>&nbsp;<span class="op" id="7163289">!=</span>&nbsp;<span class="ident" id="7163292">nil</span>&nbsp;<span class="op" id="7163296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163300">t</span><span class="op" id="7163301">.</span><span class="ident" id="7163302">Fatalf</span><span class="op" id="7163308">(</span><span class="string" id="7163309">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7163339">,</span>&nbsp;<span class="ident" id="7163341">err</span><span class="op" id="7163344">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163351">b</span>&nbsp;<span class="op" id="7163353">:=</span>&nbsp;<span class="ident" id="7163356">buf</span><span class="op" id="7163359">.</span><span class="ident" id="7163360">Bytes</span><span class="op" id="7163365">(</span><span class="op" id="7163366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163369">if</span>&nbsp;<span class="ident" id="7163372">_</span><span class="op" id="7163373">,</span>&nbsp;<span class="ident" id="7163375">err</span>&nbsp;<span class="op" id="7163379">=</span>&nbsp;<span class="ident" id="7163381">NewReader</span><span class="op" id="7163390">(</span><span class="ident" id="7163391">bytes</span><span class="op" id="7163396">.</span><span class="ident" id="7163397">NewReader</span><span class="op" id="7163406">(</span><span class="ident" id="7163407">b</span><span class="op" id="7163408">)</span><span class="op" id="7163409">,</span>&nbsp;<span class="ident" id="7163411">int64</span><span class="op" id="7163416">(</span><span class="builtinfunc" id="7163417">len</span><span class="op" id="7163420">(</span><span class="ident" id="7163421">b</span><span class="op" id="7163422">)</span><span class="op" id="7163423">)</span><span class="op" id="7163424">)</span><span class="op" id="7163425">;</span>&nbsp;<span class="ident" id="7163427">err</span>&nbsp;<span class="op" id="7163431">!=</span>&nbsp;<span class="ident" id="7163434">ErrFormat</span>&nbsp;<span class="op" id="7163444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163448">t</span><span class="op" id="7163449">.</span><span class="ident" id="7163450">Fatalf</span><span class="op" id="7163456">(</span><span class="string" id="7163457">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7163485">,</span>&nbsp;<span class="ident" id="7163487">err</span><span class="op" id="7163490">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163493">}</span><br>
<span class="lineno"></span><span class="op" id="7163495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7163498">func</span>&nbsp;<span class="ident" id="7163503">testValidHeader</span><span class="op" id="7163518">(</span><span class="ident" id="7163519">h</span>&nbsp;<span class="op" id="7163521">*</span><span class="ident" id="7163522">FileHeader</span><span class="op" id="7163532">,</span>&nbsp;<span class="ident" id="7163534">t</span>&nbsp;<span class="op" id="7163536">*</span><span class="ident" id="7163537">testing</span><span class="op" id="7163544">.</span><span class="ident" id="7163545">T</span><span class="op" id="7163546">)</span>&nbsp;<span class="op" id="7163548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163551">var</span>&nbsp;<span class="ident" id="7163555">buf</span>&nbsp;<span class="ident" id="7163559">bytes</span><span class="op" id="7163564">.</span><span class="ident" id="7163565">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163573">z</span>&nbsp;<span class="op" id="7163575">:=</span>&nbsp;<span class="ident" id="7163578">NewWriter</span><span class="op" id="7163587">(</span><span class="op" id="7163588">&amp;</span><span class="ident" id="7163589">buf</span><span class="op" id="7163592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163596">f</span><span class="op" id="7163597">,</span>&nbsp;<span class="ident" id="7163599">err</span>&nbsp;<span class="op" id="7163603">:=</span>&nbsp;<span class="ident" id="7163606">z</span><span class="op" id="7163607">.</span><span class="ident" id="7163608">CreateHeader</span><span class="op" id="7163620">(</span><span class="ident" id="7163621">h</span><span class="op" id="7163622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163625">if</span>&nbsp;<span class="ident" id="7163628">err</span>&nbsp;<span class="op" id="7163632">!=</span>&nbsp;<span class="ident" id="7163635">nil</span>&nbsp;<span class="op" id="7163639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163643">t</span><span class="op" id="7163644">.</span><span class="ident" id="7163645">Fatalf</span><span class="op" id="7163651">(</span><span class="string" id="7163652">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7163679">,</span>&nbsp;<span class="ident" id="7163681">err</span><span class="op" id="7163684">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163690">if</span>&nbsp;<span class="ident" id="7163693">_</span><span class="op" id="7163694">,</span>&nbsp;<span class="ident" id="7163696">err</span>&nbsp;<span class="op" id="7163700">:=</span>&nbsp;<span class="ident" id="7163703">f</span><span class="op" id="7163704">.</span><span class="ident" id="7163705">Write</span><span class="op" id="7163710">(</span><span class="op" id="7163711">[</span><span class="op" id="7163712">]</span><span class="builtintype" id="7163713">byte</span><span class="op" id="7163717">(</span><span class="string" id="7163718">&#34;hi&#34;</span><span class="op" id="7163722">)</span><span class="op" id="7163723">)</span><span class="op" id="7163724">;</span>&nbsp;<span class="ident" id="7163726">err</span>&nbsp;<span class="op" id="7163730">!=</span>&nbsp;<span class="ident" id="7163733">nil</span>&nbsp;<span class="op" id="7163737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163741">t</span><span class="op" id="7163742">.</span><span class="ident" id="7163743">Fatalf</span><span class="op" id="7163749">(</span><span class="string" id="7163750">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7163777">,</span>&nbsp;<span class="ident" id="7163779">err</span><span class="op" id="7163782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163788">if</span>&nbsp;<span class="ident" id="7163791">err</span>&nbsp;<span class="op" id="7163795">:=</span>&nbsp;<span class="ident" id="7163798">z</span><span class="op" id="7163799">.</span><span class="ident" id="7163800">Close</span><span class="op" id="7163805">(</span><span class="op" id="7163806">)</span><span class="op" id="7163807">;</span>&nbsp;<span class="ident" id="7163809">err</span>&nbsp;<span class="op" id="7163813">!=</span>&nbsp;<span class="ident" id="7163816">nil</span>&nbsp;<span class="op" id="7163820">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163824">t</span><span class="op" id="7163825">.</span><span class="ident" id="7163826">Fatalf</span><span class="op" id="7163832">(</span><span class="string" id="7163833">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7163863">,</span>&nbsp;<span class="ident" id="7163865">err</span><span class="op" id="7163868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7163871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163875">b</span>&nbsp;<span class="op" id="7163877">:=</span>&nbsp;<span class="ident" id="7163880">buf</span><span class="op" id="7163883">.</span><span class="ident" id="7163884">Bytes</span><span class="op" id="7163889">(</span><span class="op" id="7163890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7163893">if</span>&nbsp;<span class="ident" id="7163896">_</span><span class="op" id="7163897">,</span>&nbsp;<span class="ident" id="7163899">err</span>&nbsp;<span class="op" id="7163903">=</span>&nbsp;<span class="ident" id="7163905">NewReader</span><span class="op" id="7163914">(</span><span class="ident" id="7163915">bytes</span><span class="op" id="7163920">.</span><span class="ident" id="7163921">NewReader</span><span class="op" id="7163930">(</span><span class="ident" id="7163931">b</span><span class="op" id="7163932">)</span><span class="op" id="7163933">,</span>&nbsp;<span class="ident" id="7163935">int64</span><span class="op" id="7163940">(</span><span class="builtinfunc" id="7163941">len</span><span class="op" id="7163944">(</span><span class="ident" id="7163945">b</span><span class="op" id="7163946">)</span><span class="op" id="7163947">)</span><span class="op" id="7163948">)</span><span class="op" id="7163949">;</span>&nbsp;<span class="ident" id="7163951">err</span>&nbsp;<span class="op" id="7163955">!=</span>&nbsp;<span class="ident" id="7163958">nil</span>&nbsp;<span class="op" id="7163962">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7163966">t</span><span class="op" id="7163967">.</span><span class="ident" id="7163968">Fatalf</span><span class="op" id="7163974">(</span><span class="string" id="7163975">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7163997">,</span>&nbsp;<span class="ident" id="7163999">err</span><span class="op" id="7164002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7164005">}</span><br>
<span class="lineno"></span><span class="op" id="7164007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7164010">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7164025">func</span>&nbsp;<span class="ident" id="7164030">TestHeaderInvalidTagAndSize</span><span class="op" id="7164057">(</span><span class="ident" id="7164058">t</span>&nbsp;<span class="op" id="7164060">*</span><span class="ident" id="7164061">testing</span><span class="op" id="7164068">.</span><span class="ident" id="7164069">T</span><span class="op" id="7164070">)</span>&nbsp;<span class="op" id="7164072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7164075">const</span>&nbsp;<span class="ident" id="7164081">timeFormat</span>&nbsp;<span class="op" id="7164092">=</span>&nbsp;<span class="string" id="7164094">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164122">ts</span>&nbsp;<span class="op" id="7164125">:=</span>&nbsp;<span class="ident" id="7164128">time</span><span class="op" id="7164132">.</span><span class="ident" id="7164133">Now</span><span class="op" id="7164136">(</span><span class="op" id="7164137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164140">filename</span>&nbsp;<span class="op" id="7164149">:=</span>&nbsp;<span class="ident" id="7164152">ts</span><span class="op" id="7164154">.</span><span class="ident" id="7164155">Format</span><span class="op" id="7164161">(</span><span class="ident" id="7164162">timeFormat</span><span class="op" id="7164172">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164176">h</span>&nbsp;<span class="op" id="7164178">:=</span>&nbsp;<span class="ident" id="7164181">FileHeader</span><span class="op" id="7164191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164195">Name</span><span class="op" id="7164199">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7164203">filename</span><span class="op" id="7164211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164215">Method</span><span class="op" id="7164221">:</span>&nbsp;<span class="ident" id="7164223">Deflate</span><span class="op" id="7164230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164234">Extra</span><span class="op" id="7164239">:</span>&nbsp;&nbsp;<span class="op" id="7164242">[</span><span class="op" id="7164243">]</span><span class="builtintype" id="7164244">byte</span><span class="op" id="7164248">(</span><span class="ident" id="7164249">ts</span><span class="op" id="7164251">.</span><span class="ident" id="7164252">Format</span><span class="op" id="7164258">(</span><span class="ident" id="7164259">time</span><span class="op" id="7164263">.</span><span class="ident" id="7164264">RFC3339Nano</span><span class="op" id="7164275">)</span><span class="op" id="7164276">)</span><span class="op" id="7164277">,</span>&nbsp;<span class="comment" id="7164279">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7164303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164306">h</span><span class="op" id="7164307">.</span><span class="ident" id="7164308">SetModTime</span><span class="op" id="7164318">(</span><span class="ident" id="7164319">ts</span><span class="op" id="7164321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164325">testInvalidHeader</span><span class="op" id="7164342">(</span><span class="op" id="7164343">&amp;</span><span class="ident" id="7164344">h</span><span class="op" id="7164345">,</span>&nbsp;<span class="ident" id="7164347">t</span><span class="op" id="7164348">)</span><br>
<span class="lineno"></span><span class="op" id="7164350">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7164353">func</span>&nbsp;<span class="ident" id="7164358">TestHeaderTooShort</span><span class="op" id="7164376">(</span><span class="ident" id="7164377">t</span>&nbsp;<span class="op" id="7164379">*</span><span class="ident" id="7164380">testing</span><span class="op" id="7164387">.</span><span class="ident" id="7164388">T</span><span class="op" id="7164389">)</span>&nbsp;<span class="op" id="7164391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164394">h</span>&nbsp;<span class="op" id="7164396">:=</span>&nbsp;<span class="ident" id="7164399">FileHeader</span><span class="op" id="7164409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164413">Name</span><span class="op" id="7164417">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7164421">&#34;foo.txt&#34;</span><span class="op" id="7164430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164434">Method</span><span class="op" id="7164440">:</span>&nbsp;<span class="ident" id="7164442">Deflate</span><span class="op" id="7164449">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164453">Extra</span><span class="op" id="7164458">:</span>&nbsp;&nbsp;<span class="op" id="7164461">[</span><span class="op" id="7164462">]</span><span class="builtintype" id="7164463">byte</span><span class="op" id="7164467">{</span><span class="ident" id="7164468">zip64ExtraId</span><span class="op" id="7164480">}</span><span class="op" id="7164481">,</span>&nbsp;<span class="comment" id="7164483">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7164500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164503">testInvalidHeader</span><span class="op" id="7164520">(</span><span class="op" id="7164521">&amp;</span><span class="ident" id="7164522">h</span><span class="op" id="7164523">,</span>&nbsp;<span class="ident" id="7164525">t</span><span class="op" id="7164526">)</span><br>
<span class="lineno"></span><span class="op" id="7164528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7164531">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7164587">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7164614">func</span>&nbsp;<span class="ident" id="7164619">TestZeroLengthHeader</span><span class="op" id="7164639">(</span><span class="ident" id="7164640">t</span>&nbsp;<span class="op" id="7164642">*</span><span class="ident" id="7164643">testing</span><span class="op" id="7164650">.</span><span class="ident" id="7164651">T</span><span class="op" id="7164652">)</span>&nbsp;<span class="op" id="7164654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164657">h</span>&nbsp;<span class="op" id="7164659">:=</span>&nbsp;<span class="ident" id="7164662">FileHeader</span><span class="op" id="7164672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164676">Name</span><span class="op" id="7164680">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7164684">&#34;extadata.txt&#34;</span><span class="op" id="7164698">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164702">Method</span><span class="op" id="7164708">:</span>&nbsp;<span class="ident" id="7164710">Deflate</span><span class="op" id="7164717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164721">Extra</span><span class="op" id="7164726">:</span>&nbsp;<span class="op" id="7164728">[</span><span class="op" id="7164729">]</span><span class="builtintype" id="7164730">byte</span><span class="op" id="7164734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7164739">85</span><span class="op" id="7164741">,</span>&nbsp;<span class="num" id="7164743">84</span><span class="op" id="7164745">,</span>&nbsp;<span class="num" id="7164747">5</span><span class="op" id="7164748">,</span>&nbsp;<span class="num" id="7164750">0</span><span class="op" id="7164751">,</span>&nbsp;<span class="num" id="7164753">3</span><span class="op" id="7164754">,</span>&nbsp;<span class="num" id="7164756">154</span><span class="op" id="7164759">,</span>&nbsp;<span class="num" id="7164761">144</span><span class="op" id="7164764">,</span>&nbsp;<span class="num" id="7164766">195</span><span class="op" id="7164769">,</span>&nbsp;<span class="num" id="7164771">77</span><span class="op" id="7164773">,</span>&nbsp;<span class="comment" id="7164775">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7164798">85</span><span class="op" id="7164800">,</span>&nbsp;<span class="num" id="7164802">120</span><span class="op" id="7164805">,</span>&nbsp;<span class="num" id="7164807">0</span><span class="op" id="7164808">,</span>&nbsp;<span class="num" id="7164810">0</span><span class="op" id="7164811">,</span>&nbsp;<span class="comment" id="7164813">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7164835">}</span><span class="op" id="7164836">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7164839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7164842">testValidHeader</span><span class="op" id="7164857">(</span><span class="op" id="7164858">&amp;</span><span class="ident" id="7164859">h</span><span class="op" id="7164860">,</span>&nbsp;<span class="ident" id="7164862">t</span><span class="op" id="7164863">)</span><br>
<span class="lineno"></span><span class="op" id="7164865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7164868">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7164938">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7165009">func</span>&nbsp;<span class="ident" id="7165014">BenchmarkZip64Test</span><span class="op" id="7165032">(</span><span class="ident" id="7165033">b</span>&nbsp;<span class="op" id="7165035">*</span><span class="ident" id="7165036">testing</span><span class="op" id="7165043">.</span><span class="ident" id="7165044">B</span><span class="op" id="7165045">)</span>&nbsp;<span class="op" id="7165047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7165050">for</span>&nbsp;<span class="ident" id="7165054">i</span>&nbsp;<span class="op" id="7165056">:=</span>&nbsp;<span class="num" id="7165059">0</span><span class="op" id="7165060">;</span>&nbsp;<span class="ident" id="7165062">i</span>&nbsp;<span class="op" id="7165064">&lt;</span>&nbsp;<span class="ident" id="7165066">b</span><span class="op" id="7165067">.</span><span class="ident" id="7165068">N</span><span class="op" id="7165069">;</span>&nbsp;<span class="ident" id="7165071">i</span><span class="op" id="7165072">++</span>&nbsp;<span class="op" id="7165075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7165079">testZip64</span><span class="op" id="7165088">(</span><span class="ident" id="7165089">b</span><span class="op" id="7165090">,</span>&nbsp;<span class="num" id="7165092">1</span><span class="op" id="7165093">&lt;&lt;</span><span class="num" id="7165095">26</span><span class="op" id="7165097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7165100">}</span><br>
<span class="lineno">395</span><span class="op" id="7165102">}</span>
</div>
</body>
</html>
