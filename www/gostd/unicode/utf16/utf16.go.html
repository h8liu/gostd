<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf16</h2>
<ul>
<li><a href="/gostd/unicode/utf16/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/unicode/utf16/utf16.go.html" class="current">utf16.go</a></li>
<li><a href="/gostd/unicode/utf16/utf16_test.go.html">utf16_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2894154">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2894210">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2894264">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2894315">//&nbsp;Package&nbsp;utf16&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;UTF-16&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="2894386">package</span>&nbsp;<span class="ident" id="2894394">utf16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2894401">//&nbsp;The&nbsp;conditions&nbsp;replacementChar==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2894464">//&nbsp;maxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno">10</span><span class="comment" id="2894519">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2894595">const</span>&nbsp;<span class="op" id="2894601">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894604">replacementChar</span>&nbsp;<span class="op" id="2894620">=</span>&nbsp;<span class="string" id="2894622">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2894635">//&nbsp;Unicode&nbsp;replacement&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894669">maxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2894685">=</span>&nbsp;<span class="string" id="2894687">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="2894700">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno">15</span><span class="op" id="2894737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2894740">const</span>&nbsp;<span class="op" id="2894746">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2894749">//&nbsp;0xd800-0xdc00&nbsp;encodes&nbsp;the&nbsp;high&nbsp;10&nbsp;bits&nbsp;of&nbsp;a&nbsp;pair.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2894803">//&nbsp;0xdc00-0xe000&nbsp;encodes&nbsp;the&nbsp;low&nbsp;10&nbsp;bits&nbsp;of&nbsp;a&nbsp;pair.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2894856">//&nbsp;the&nbsp;value&nbsp;is&nbsp;those&nbsp;20&nbsp;bits&nbsp;plus&nbsp;0x10000.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894901">surr1</span>&nbsp;<span class="op" id="2894907">=</span>&nbsp;<span class="num" id="2894909">0xd800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894917">surr2</span>&nbsp;<span class="op" id="2894923">=</span>&nbsp;<span class="num" id="2894925">0xdc00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894933">surr3</span>&nbsp;<span class="op" id="2894939">=</span>&nbsp;<span class="num" id="2894941">0xe000</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2894950">surrSelf</span>&nbsp;<span class="op" id="2894959">=</span>&nbsp;<span class="num" id="2894961">0x10000</span><br>
<span class="lineno"></span><span class="op" id="2894969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2894972">//&nbsp;IsSurrogate&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2895036">//&nbsp;can&nbsp;appear&nbsp;in&nbsp;a&nbsp;surrogate&nbsp;pair.</span><br>
<span class="lineno">30</span><span class="keyword" id="2895071">func</span>&nbsp;<span class="ident" id="2895076">IsSurrogate</span><span class="op" id="2895087">(</span><span class="ident" id="2895088">r</span>&nbsp;<span class="builtintype" id="2895090">rune</span><span class="op" id="2895094">)</span>&nbsp;<span class="builtintype" id="2895096">bool</span>&nbsp;<span class="op" id="2895101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895104">return</span>&nbsp;<span class="ident" id="2895111">surr1</span>&nbsp;<span class="op" id="2895117">&lt;=</span>&nbsp;<span class="ident" id="2895120">r</span>&nbsp;<span class="op" id="2895122">&amp;&amp;</span>&nbsp;<span class="ident" id="2895125">r</span>&nbsp;<span class="op" id="2895127">&lt;</span>&nbsp;<span class="ident" id="2895129">surr3</span><br>
<span class="lineno"></span><span class="op" id="2895135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2895138">//&nbsp;DecodeRune&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;decoding&nbsp;of&nbsp;a&nbsp;surrogate&nbsp;pair.</span><br>
<span class="lineno">35</span><span class="comment" id="2895201">//&nbsp;If&nbsp;the&nbsp;pair&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;UTF-16&nbsp;surrogate&nbsp;pair,&nbsp;DecodeRune&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2895273">//&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;code&nbsp;point&nbsp;U+FFFD.</span><br>
<span class="lineno"></span><span class="keyword" id="2895319">func</span>&nbsp;<span class="ident" id="2895324">DecodeRune</span><span class="op" id="2895334">(</span><span class="ident" id="2895335">r1</span><span class="op" id="2895337">,</span>&nbsp;<span class="ident" id="2895339">r2</span>&nbsp;<span class="builtintype" id="2895342">rune</span><span class="op" id="2895346">)</span>&nbsp;<span class="builtintype" id="2895348">rune</span>&nbsp;<span class="op" id="2895353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895356">if</span>&nbsp;<span class="ident" id="2895359">surr1</span>&nbsp;<span class="op" id="2895365">&lt;=</span>&nbsp;<span class="ident" id="2895368">r1</span>&nbsp;<span class="op" id="2895371">&amp;&amp;</span>&nbsp;<span class="ident" id="2895374">r1</span>&nbsp;<span class="op" id="2895377">&lt;</span>&nbsp;<span class="ident" id="2895379">surr2</span>&nbsp;<span class="op" id="2895385">&amp;&amp;</span>&nbsp;<span class="ident" id="2895388">surr2</span>&nbsp;<span class="op" id="2895394">&lt;=</span>&nbsp;<span class="ident" id="2895397">r2</span>&nbsp;<span class="op" id="2895400">&amp;&amp;</span>&nbsp;<span class="ident" id="2895403">r2</span>&nbsp;<span class="op" id="2895406">&lt;</span>&nbsp;<span class="ident" id="2895408">surr3</span>&nbsp;<span class="op" id="2895414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895418">return</span>&nbsp;<span class="op" id="2895425">(</span><span class="ident" id="2895426">r1</span><span class="op" id="2895428">-</span><span class="ident" id="2895429">surr1</span><span class="op" id="2895434">)</span><span class="op" id="2895435">&lt;&lt;</span><span class="num" id="2895437">10</span>&nbsp;<span class="op" id="2895440">|</span>&nbsp;<span class="op" id="2895442">(</span><span class="ident" id="2895443">r2</span>&nbsp;<span class="op" id="2895446">-</span>&nbsp;<span class="ident" id="2895448">surr2</span><span class="op" id="2895453">)</span>&nbsp;<span class="op" id="2895455">+</span>&nbsp;<span class="num" id="2895457">0x10000</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2895466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895469">return</span>&nbsp;<span class="ident" id="2895476">replacementChar</span><br>
<span class="lineno"></span><span class="op" id="2895492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2895495">//&nbsp;EncodeRune&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;surrogate&nbsp;pair&nbsp;r1,&nbsp;r2&nbsp;for&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="2895570">//&nbsp;If&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;or&nbsp;does&nbsp;not&nbsp;need&nbsp;encoding,</span><br>
<span class="lineno"></span><span class="comment" id="2895646">//&nbsp;EncodeRune&nbsp;returns&nbsp;U+FFFD,&nbsp;U+FFFD.</span><br>
<span class="lineno"></span><span class="keyword" id="2895684">func</span>&nbsp;<span class="ident" id="2895689">EncodeRune</span><span class="op" id="2895699">(</span><span class="ident" id="2895700">r</span>&nbsp;<span class="builtintype" id="2895702">rune</span><span class="op" id="2895706">)</span>&nbsp;<span class="op" id="2895708">(</span><span class="ident" id="2895709">r1</span><span class="op" id="2895711">,</span>&nbsp;<span class="ident" id="2895713">r2</span>&nbsp;<span class="builtintype" id="2895716">rune</span><span class="op" id="2895720">)</span>&nbsp;<span class="op" id="2895722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895725">if</span>&nbsp;<span class="ident" id="2895728">r</span>&nbsp;<span class="op" id="2895730">&lt;</span>&nbsp;<span class="ident" id="2895732">surrSelf</span>&nbsp;<span class="op" id="2895741">||</span>&nbsp;<span class="ident" id="2895744">r</span>&nbsp;<span class="op" id="2895746">&gt;</span>&nbsp;<span class="ident" id="2895748">maxRune</span>&nbsp;<span class="op" id="2895756">||</span>&nbsp;<span class="ident" id="2895759">IsSurrogate</span><span class="op" id="2895770">(</span><span class="ident" id="2895771">r</span><span class="op" id="2895772">)</span>&nbsp;<span class="op" id="2895774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895778">return</span>&nbsp;<span class="ident" id="2895785">replacementChar</span><span class="op" id="2895800">,</span>&nbsp;<span class="ident" id="2895802">replacementChar</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2895819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2895822">r</span>&nbsp;<span class="op" id="2895824">-=</span>&nbsp;<span class="ident" id="2895827">surrSelf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2895837">return</span>&nbsp;<span class="ident" id="2895844">surr1</span>&nbsp;<span class="op" id="2895850">+</span>&nbsp;<span class="op" id="2895852">(</span><span class="ident" id="2895853">r</span><span class="op" id="2895854">&gt;&gt;</span><span class="num" id="2895856">10</span><span class="op" id="2895858">)</span><span class="op" id="2895859">&amp;</span><span class="num" id="2895860">0x3ff</span><span class="op" id="2895865">,</span>&nbsp;<span class="ident" id="2895867">surr2</span>&nbsp;<span class="op" id="2895873">+</span>&nbsp;<span class="ident" id="2895875">r</span><span class="op" id="2895876">&amp;</span><span class="num" id="2895877">0x3ff</span><br>
<span class="lineno"></span><span class="op" id="2895883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2895886">//&nbsp;Encode&nbsp;returns&nbsp;the&nbsp;UTF-16&nbsp;encoding&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;sequence&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2895962">func</span>&nbsp;<span class="ident" id="2895967">Encode</span><span class="op" id="2895973">(</span><span class="ident" id="2895974">s</span>&nbsp;<span class="op" id="2895976">[</span><span class="op" id="2895977">]</span><span class="builtintype" id="2895978">rune</span><span class="op" id="2895982">)</span>&nbsp;<span class="op" id="2895984">[</span><span class="op" id="2895985">]</span><span class="builtintype" id="2895986">uint16</span>&nbsp;<span class="op" id="2895993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2895996">n</span>&nbsp;<span class="op" id="2895998">:=</span>&nbsp;<span class="builtinfunc" id="2896001">len</span><span class="op" id="2896004">(</span><span class="ident" id="2896005">s</span><span class="op" id="2896006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896009">for</span>&nbsp;<span class="ident" id="2896013">_</span><span class="op" id="2896014">,</span>&nbsp;<span class="ident" id="2896016">v</span>&nbsp;<span class="op" id="2896018">:=</span>&nbsp;<span class="keyword" id="2896021">range</span>&nbsp;<span class="ident" id="2896027">s</span>&nbsp;<span class="op" id="2896029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896033">if</span>&nbsp;<span class="ident" id="2896036">v</span>&nbsp;<span class="op" id="2896038">&gt;=</span>&nbsp;<span class="ident" id="2896041">surrSelf</span>&nbsp;<span class="op" id="2896050">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896055">n</span><span class="op" id="2896056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896068">a</span>&nbsp;<span class="op" id="2896070">:=</span>&nbsp;<span class="builtinfunc" id="2896073">make</span><span class="op" id="2896077">(</span><span class="op" id="2896078">[</span><span class="op" id="2896079">]</span><span class="builtintype" id="2896080">uint16</span><span class="op" id="2896086">,</span>&nbsp;<span class="ident" id="2896088">n</span><span class="op" id="2896089">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896092">n</span>&nbsp;<span class="op" id="2896094">=</span>&nbsp;<span class="num" id="2896096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896099">for</span>&nbsp;<span class="ident" id="2896103">_</span><span class="op" id="2896104">,</span>&nbsp;<span class="ident" id="2896106">v</span>&nbsp;<span class="op" id="2896108">:=</span>&nbsp;<span class="keyword" id="2896111">range</span>&nbsp;<span class="ident" id="2896117">s</span>&nbsp;<span class="op" id="2896119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896123">switch</span>&nbsp;<span class="op" id="2896130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896134">case</span>&nbsp;<span class="ident" id="2896139">v</span>&nbsp;<span class="op" id="2896141">&lt;</span>&nbsp;<span class="num" id="2896143">0</span><span class="op" id="2896144">,</span>&nbsp;<span class="ident" id="2896146">surr1</span>&nbsp;<span class="op" id="2896152">&lt;=</span>&nbsp;<span class="ident" id="2896155">v</span>&nbsp;<span class="op" id="2896157">&amp;&amp;</span>&nbsp;<span class="ident" id="2896160">v</span>&nbsp;<span class="op" id="2896162">&lt;</span>&nbsp;<span class="ident" id="2896164">surr3</span><span class="op" id="2896169">,</span>&nbsp;<span class="ident" id="2896171">v</span>&nbsp;<span class="op" id="2896173">&gt;</span>&nbsp;<span class="ident" id="2896175">maxRune</span><span class="op" id="2896182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896187">v</span>&nbsp;<span class="op" id="2896189">=</span>&nbsp;<span class="ident" id="2896191">replacementChar</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896210">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896224">case</span>&nbsp;<span class="ident" id="2896229">v</span>&nbsp;<span class="op" id="2896231">&lt;</span>&nbsp;<span class="ident" id="2896233">surrSelf</span><span class="op" id="2896241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896246">a</span><span class="op" id="2896247">[</span><span class="ident" id="2896248">n</span><span class="op" id="2896249">]</span>&nbsp;<span class="op" id="2896251">=</span>&nbsp;<span class="builtintype" id="2896253">uint16</span><span class="op" id="2896259">(</span><span class="ident" id="2896260">v</span><span class="op" id="2896261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896266">n</span><span class="op" id="2896267">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896272">default</span><span class="op" id="2896279">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896284">r1</span><span class="op" id="2896286">,</span>&nbsp;<span class="ident" id="2896288">r2</span>&nbsp;<span class="op" id="2896291">:=</span>&nbsp;<span class="ident" id="2896294">EncodeRune</span><span class="op" id="2896304">(</span><span class="ident" id="2896305">v</span><span class="op" id="2896306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896311">a</span><span class="op" id="2896312">[</span><span class="ident" id="2896313">n</span><span class="op" id="2896314">]</span>&nbsp;<span class="op" id="2896316">=</span>&nbsp;<span class="builtintype" id="2896318">uint16</span><span class="op" id="2896324">(</span><span class="ident" id="2896325">r1</span><span class="op" id="2896327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896332">a</span><span class="op" id="2896333">[</span><span class="ident" id="2896334">n</span><span class="op" id="2896335">+</span><span class="num" id="2896336">1</span><span class="op" id="2896337">]</span>&nbsp;<span class="op" id="2896339">=</span>&nbsp;<span class="builtintype" id="2896341">uint16</span><span class="op" id="2896347">(</span><span class="ident" id="2896348">r2</span><span class="op" id="2896350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896355">n</span>&nbsp;<span class="op" id="2896357">+=</span>&nbsp;<span class="num" id="2896360">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896364">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896370">return</span>&nbsp;<span class="ident" id="2896377">a</span><span class="op" id="2896378">[</span><span class="num" id="2896379">0</span><span class="op" id="2896380">:</span><span class="ident" id="2896381">n</span><span class="op" id="2896382">]</span><br>
<span class="lineno"></span><span class="op" id="2896384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2896387">//&nbsp;Decode&nbsp;returns&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;sequence&nbsp;represented</span><br>
<span class="lineno">85</span><span class="comment" id="2896449">//&nbsp;by&nbsp;the&nbsp;UTF-16&nbsp;encoding&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2896478">func</span>&nbsp;<span class="ident" id="2896483">Decode</span><span class="op" id="2896489">(</span><span class="ident" id="2896490">s</span>&nbsp;<span class="op" id="2896492">[</span><span class="op" id="2896493">]</span><span class="builtintype" id="2896494">uint16</span><span class="op" id="2896500">)</span>&nbsp;<span class="op" id="2896502">[</span><span class="op" id="2896503">]</span><span class="builtintype" id="2896504">rune</span>&nbsp;<span class="op" id="2896509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896512">a</span>&nbsp;<span class="op" id="2896514">:=</span>&nbsp;<span class="builtinfunc" id="2896517">make</span><span class="op" id="2896521">(</span><span class="op" id="2896522">[</span><span class="op" id="2896523">]</span><span class="builtintype" id="2896524">rune</span><span class="op" id="2896528">,</span>&nbsp;<span class="builtinfunc" id="2896530">len</span><span class="op" id="2896533">(</span><span class="ident" id="2896534">s</span><span class="op" id="2896535">)</span><span class="op" id="2896536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896539">n</span>&nbsp;<span class="op" id="2896541">:=</span>&nbsp;<span class="num" id="2896544">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896547">for</span>&nbsp;<span class="ident" id="2896551">i</span>&nbsp;<span class="op" id="2896553">:=</span>&nbsp;<span class="num" id="2896556">0</span><span class="op" id="2896557">;</span>&nbsp;<span class="ident" id="2896559">i</span>&nbsp;<span class="op" id="2896561">&lt;</span>&nbsp;<span class="builtinfunc" id="2896563">len</span><span class="op" id="2896566">(</span><span class="ident" id="2896567">s</span><span class="op" id="2896568">)</span><span class="op" id="2896569">;</span>&nbsp;<span class="ident" id="2896571">i</span><span class="op" id="2896572">++</span>&nbsp;<span class="op" id="2896575">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896579">switch</span>&nbsp;<span class="ident" id="2896586">r</span>&nbsp;<span class="op" id="2896588">:=</span>&nbsp;<span class="ident" id="2896591">s</span><span class="op" id="2896592">[</span><span class="ident" id="2896593">i</span><span class="op" id="2896594">]</span><span class="op" id="2896595">;</span>&nbsp;<span class="op" id="2896597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896601">case</span>&nbsp;<span class="ident" id="2896606">surr1</span>&nbsp;<span class="op" id="2896612">&lt;=</span>&nbsp;<span class="ident" id="2896615">r</span>&nbsp;<span class="op" id="2896617">&amp;&amp;</span>&nbsp;<span class="ident" id="2896620">r</span>&nbsp;<span class="op" id="2896622">&lt;</span>&nbsp;<span class="ident" id="2896624">surr2</span>&nbsp;<span class="op" id="2896630">&amp;&amp;</span>&nbsp;<span class="ident" id="2896633">i</span><span class="op" id="2896634">+</span><span class="num" id="2896635">1</span>&nbsp;<span class="op" id="2896637">&lt;</span>&nbsp;<span class="builtinfunc" id="2896639">len</span><span class="op" id="2896642">(</span><span class="ident" id="2896643">s</span><span class="op" id="2896644">)</span>&nbsp;<span class="op" id="2896646">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896652">surr2</span>&nbsp;<span class="op" id="2896658">&lt;=</span>&nbsp;<span class="ident" id="2896661">s</span><span class="op" id="2896662">[</span><span class="ident" id="2896663">i</span><span class="op" id="2896664">+</span><span class="num" id="2896665">1</span><span class="op" id="2896666">]</span>&nbsp;<span class="op" id="2896668">&amp;&amp;</span>&nbsp;<span class="ident" id="2896671">s</span><span class="op" id="2896672">[</span><span class="ident" id="2896673">i</span><span class="op" id="2896674">+</span><span class="num" id="2896675">1</span><span class="op" id="2896676">]</span>&nbsp;<span class="op" id="2896678">&lt;</span>&nbsp;<span class="ident" id="2896680">surr3</span><span class="op" id="2896685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2896690">//&nbsp;valid&nbsp;surrogate&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896721">a</span><span class="op" id="2896722">[</span><span class="ident" id="2896723">n</span><span class="op" id="2896724">]</span>&nbsp;<span class="op" id="2896726">=</span>&nbsp;<span class="ident" id="2896728">DecodeRune</span><span class="op" id="2896738">(</span><span class="builtintype" id="2896739">rune</span><span class="op" id="2896743">(</span><span class="ident" id="2896744">r</span><span class="op" id="2896745">)</span><span class="op" id="2896746">,</span>&nbsp;<span class="builtintype" id="2896748">rune</span><span class="op" id="2896752">(</span><span class="ident" id="2896753">s</span><span class="op" id="2896754">[</span><span class="ident" id="2896755">i</span><span class="op" id="2896756">+</span><span class="num" id="2896757">1</span><span class="op" id="2896758">]</span><span class="op" id="2896759">)</span><span class="op" id="2896760">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896765">i</span><span class="op" id="2896766">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896772">n</span><span class="op" id="2896773">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896778">case</span>&nbsp;<span class="ident" id="2896783">surr1</span>&nbsp;<span class="op" id="2896789">&lt;=</span>&nbsp;<span class="ident" id="2896792">r</span>&nbsp;<span class="op" id="2896794">&amp;&amp;</span>&nbsp;<span class="ident" id="2896797">r</span>&nbsp;<span class="op" id="2896799">&lt;</span>&nbsp;<span class="ident" id="2896801">surr3</span><span class="op" id="2896806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2896811">//&nbsp;invalid&nbsp;surrogate&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896844">a</span><span class="op" id="2896845">[</span><span class="ident" id="2896846">n</span><span class="op" id="2896847">]</span>&nbsp;<span class="op" id="2896849">=</span>&nbsp;<span class="ident" id="2896851">replacementChar</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896870">n</span><span class="op" id="2896871">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896876">default</span><span class="op" id="2896883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2896888">//&nbsp;normal&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896906">a</span><span class="op" id="2896907">[</span><span class="ident" id="2896908">n</span><span class="op" id="2896909">]</span>&nbsp;<span class="op" id="2896911">=</span>&nbsp;<span class="builtintype" id="2896913">rune</span><span class="op" id="2896917">(</span><span class="ident" id="2896918">r</span><span class="op" id="2896919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2896924">n</span><span class="op" id="2896925">++</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2896933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2896936">return</span>&nbsp;<span class="ident" id="2896943">a</span><span class="op" id="2896944">[</span><span class="num" id="2896945">0</span><span class="op" id="2896946">:</span><span class="ident" id="2896947">n</span><span class="op" id="2896948">]</span><br>
<span class="lineno"></span><span class="op" id="2896950">}</span>
</div>
</body>
</html>
