<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5598386">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5598441">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5598495">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5598546">package</span>&nbsp;<span class="ident" id="5598554">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598559">import</span>&nbsp;<span class="op" id="5598566">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598569">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598578">&#34;compress/zlib&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598595">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598609">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598618">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598633">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5598639">&#34;strconv&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5598649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598652">//&nbsp;Encoder&nbsp;configures&nbsp;encoding&nbsp;PNG&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5598695">type</span>&nbsp;<span class="ident" id="5598700">Encoder</span>&nbsp;<span class="keyword" id="5598708">struct</span>&nbsp;<span class="op" id="5598715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598718">CompressionLevel</span>&nbsp;<span class="ident" id="5598735"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span><br>
<span class="lineno">20</span><span class="op" id="5598752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598755">type</span>&nbsp;<span class="ident" id="5598760">encoder</span>&nbsp;<span class="keyword" id="5598768">struct</span>&nbsp;<span class="op" id="5598775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598778">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598785">*</span><span class="ident" id="5598786"><a href="/image/png/writer.go.html#5598700">Encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598795">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598802"><a href="/image/png/writer.go.html#5598633">io</a></span><span class="op" id="5598804">.</span><span class="ident" id="5598805">Writer</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598813">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598820"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5598825">.</span><span class="ident" id="5598826">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598833">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5598840">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598845">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5598852">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598859">header</span>&nbsp;<span class="op" id="5598866">[</span><span class="num" id="5598867">8</span><span class="op" id="5598868">]</span><span class="builtintype" id="5598869">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598875">footer</span>&nbsp;<span class="op" id="5598882">[</span><span class="num" id="5598883">4</span><span class="op" id="5598884">]</span><span class="builtintype" id="5598885">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598891">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5598898">[</span><span class="num" id="5598899">4</span>&nbsp;<span class="op" id="5598901">*</span>&nbsp;<span class="num" id="5598903">256</span><span class="op" id="5598906">]</span><span class="builtintype" id="5598907">byte</span><br>
<span class="lineno"></span><span class="op" id="5598912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598915">type</span>&nbsp;<span class="ident" id="5598920">CompressionLevel</span>&nbsp;<span class="builtintype" id="5598937">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="5598942">const</span>&nbsp;<span class="op" id="5598948">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598951">DefaultCompression</span>&nbsp;<span class="ident" id="5598970"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span>&nbsp;<span class="op" id="5598987">=</span>&nbsp;<span class="num" id="5598989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598992">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599011"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span>&nbsp;<span class="op" id="5599028">=</span>&nbsp;<span class="op" id="5599030">-</span><span class="num" id="5599031">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599034">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599053"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span>&nbsp;<span class="op" id="5599070">=</span>&nbsp;<span class="op" id="5599072">-</span><span class="num" id="5599073">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599076">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599095"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span>&nbsp;<span class="op" id="5599112">=</span>&nbsp;<span class="op" id="5599114">-</span><span class="num" id="5599115">3</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599119">//&nbsp;Positive&nbsp;CompressionLevel&nbsp;values&nbsp;are&nbsp;reserved&nbsp;to&nbsp;mean&nbsp;a&nbsp;numeric&nbsp;zlib</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599192">//&nbsp;compression&nbsp;level,&nbsp;although&nbsp;that&nbsp;is&nbsp;not&nbsp;implemented&nbsp;yet.</span><br>
<span class="lineno"></span><span class="op" id="5599252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5599255">//&nbsp;Big-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="5599270">func</span>&nbsp;<span class="ident" id="5599275">writeUint32</span><span class="op" id="5599286">(</span><span class="ident" id="5599287">b</span>&nbsp;<span class="op" id="5599289">[</span><span class="op" id="5599290">]</span><span class="builtintype" id="5599291">uint8</span><span class="op" id="5599296">,</span>&nbsp;<span class="ident" id="5599298">u</span>&nbsp;<span class="builtintype" id="5599300">uint32</span><span class="op" id="5599306">)</span>&nbsp;<span class="op" id="5599308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599311"><a href="/image/png/writer.go.html#5599287">b</a></span><span class="op" id="5599312">[</span><span class="num" id="5599313">0</span><span class="op" id="5599314">]</span>&nbsp;<span class="op" id="5599316">=</span>&nbsp;<span class="builtintype" id="5599318">uint8</span><span class="op" id="5599323">(</span><span class="ident" id="5599324"><a href="/image/png/writer.go.html#5599298">u</a></span>&nbsp;<span class="op" id="5599326">&gt;&gt;</span>&nbsp;<span class="num" id="5599329">24</span><span class="op" id="5599331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599334"><a href="/image/png/writer.go.html#5599287">b</a></span><span class="op" id="5599335">[</span><span class="num" id="5599336">1</span><span class="op" id="5599337">]</span>&nbsp;<span class="op" id="5599339">=</span>&nbsp;<span class="builtintype" id="5599341">uint8</span><span class="op" id="5599346">(</span><span class="ident" id="5599347"><a href="/image/png/writer.go.html#5599298">u</a></span>&nbsp;<span class="op" id="5599349">&gt;&gt;</span>&nbsp;<span class="num" id="5599352">16</span><span class="op" id="5599354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599357"><a href="/image/png/writer.go.html#5599287">b</a></span><span class="op" id="5599358">[</span><span class="num" id="5599359">2</span><span class="op" id="5599360">]</span>&nbsp;<span class="op" id="5599362">=</span>&nbsp;<span class="builtintype" id="5599364">uint8</span><span class="op" id="5599369">(</span><span class="ident" id="5599370"><a href="/image/png/writer.go.html#5599298">u</a></span>&nbsp;<span class="op" id="5599372">&gt;&gt;</span>&nbsp;<span class="num" id="5599375">8</span><span class="op" id="5599376">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599379"><a href="/image/png/writer.go.html#5599287">b</a></span><span class="op" id="5599380">[</span><span class="num" id="5599381">3</span><span class="op" id="5599382">]</span>&nbsp;<span class="op" id="5599384">=</span>&nbsp;<span class="builtintype" id="5599386">uint8</span><span class="op" id="5599391">(</span><span class="ident" id="5599392"><a href="/image/png/writer.go.html#5599298">u</a></span>&nbsp;<span class="op" id="5599394">&gt;&gt;</span>&nbsp;<span class="num" id="5599397">0</span><span class="op" id="5599398">)</span><br>
<span class="lineno"></span><span class="op" id="5599400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5599403">type</span>&nbsp;<span class="ident" id="5599408">opaquer</span>&nbsp;<span class="keyword" id="5599416">interface</span>&nbsp;<span class="op" id="5599426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599429">Opaque</span><span class="op" id="5599435">(</span><span class="op" id="5599436">)</span>&nbsp;<span class="builtintype" id="5599438">bool</span><br>
<span class="lineno">55</span><span class="op" id="5599443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5599446">//&nbsp;Returns&nbsp;whether&nbsp;or&nbsp;not&nbsp;the&nbsp;image&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5599499">func</span>&nbsp;<span class="ident" id="5599504">opaque</span><span class="op" id="5599510">(</span><span class="ident" id="5599511">m</span>&nbsp;<span class="ident" id="5599513"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5599518">.</span><span class="ident" id="5599519">Image</span><span class="op" id="5599524">)</span>&nbsp;<span class="builtintype" id="5599526">bool</span>&nbsp;<span class="op" id="5599531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599534">if</span>&nbsp;<span class="ident" id="5599537">o</span><span class="op" id="5599538">,</span>&nbsp;<span class="ident" id="5599540">ok</span>&nbsp;<span class="op" id="5599543">:=</span>&nbsp;<span class="ident" id="5599546"><a href="/image/png/writer.go.html#5599511">m</a></span><span class="op" id="5599547">.</span><span class="op" id="5599548">(</span><span class="ident" id="5599549"><a href="/image/png/writer.go.html#5599408">opaquer</a></span><span class="op" id="5599556">)</span><span class="op" id="5599557">;</span>&nbsp;<span class="ident" id="5599559"><a href="/image/png/writer.go.html#5599540">ok</a></span>&nbsp;<span class="op" id="5599562">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599566">return</span>&nbsp;<span class="ident" id="5599573"><a href="/image/png/writer.go.html#5599537">o</a></span><span class="op" id="5599574">.</span><span class="ident" id="5599575">Opaque</span><span class="op" id="5599581">(</span><span class="op" id="5599582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599588">b</span>&nbsp;<span class="op" id="5599590">:=</span>&nbsp;<span class="ident" id="5599593"><a href="/image/png/writer.go.html#5599511">m</a></span><span class="op" id="5599594">.</span><span class="ident" id="5599595">Bounds</span><span class="op" id="5599601">(</span><span class="op" id="5599602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599605">for</span>&nbsp;<span class="ident" id="5599609">y</span>&nbsp;<span class="op" id="5599611">:=</span>&nbsp;<span class="ident" id="5599614"><a href="/image/png/writer.go.html#5599588">b</a></span><span class="op" id="5599615">.</span><span class="ident" id="5599616">Min</span><span class="op" id="5599619">.</span><span class="ident" id="5599620">Y</span><span class="op" id="5599621">;</span>&nbsp;<span class="ident" id="5599623"><a href="/image/png/writer.go.html#5599609">y</a></span>&nbsp;<span class="op" id="5599625">&lt;</span>&nbsp;<span class="ident" id="5599627"><a href="/image/png/writer.go.html#5599588">b</a></span><span class="op" id="5599628">.</span><span class="ident" id="5599629">Max</span><span class="op" id="5599632">.</span><span class="ident" id="5599633">Y</span><span class="op" id="5599634">;</span>&nbsp;<span class="ident" id="5599636"><a href="/image/png/writer.go.html#5599609">y</a></span><span class="op" id="5599637">++</span>&nbsp;<span class="op" id="5599640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599644">for</span>&nbsp;<span class="ident" id="5599648">x</span>&nbsp;<span class="op" id="5599650">:=</span>&nbsp;<span class="ident" id="5599653"><a href="/image/png/writer.go.html#5599588">b</a></span><span class="op" id="5599654">.</span><span class="ident" id="5599655">Min</span><span class="op" id="5599658">.</span><span class="ident" id="5599659">X</span><span class="op" id="5599660">;</span>&nbsp;<span class="ident" id="5599662"><a href="/image/png/writer.go.html#5599648">x</a></span>&nbsp;<span class="op" id="5599664">&lt;</span>&nbsp;<span class="ident" id="5599666"><a href="/image/png/writer.go.html#5599588">b</a></span><span class="op" id="5599667">.</span><span class="ident" id="5599668">Max</span><span class="op" id="5599671">.</span><span class="ident" id="5599672">X</span><span class="op" id="5599673">;</span>&nbsp;<span class="ident" id="5599675"><a href="/image/png/writer.go.html#5599648">x</a></span><span class="op" id="5599676">++</span>&nbsp;<span class="op" id="5599679">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599684">_</span><span class="op" id="5599685">,</span>&nbsp;<span class="ident" id="5599687">_</span><span class="op" id="5599688">,</span>&nbsp;<span class="ident" id="5599690">_</span><span class="op" id="5599691">,</span>&nbsp;<span class="ident" id="5599693">a</span>&nbsp;<span class="op" id="5599695">:=</span>&nbsp;<span class="ident" id="5599698"><a href="/image/png/writer.go.html#5599511">m</a></span><span class="op" id="5599699">.</span><span class="ident" id="5599700">At</span><span class="op" id="5599702">(</span><span class="ident" id="5599703"><a href="/image/png/writer.go.html#5599648">x</a></span><span class="op" id="5599704">,</span>&nbsp;<span class="ident" id="5599706"><a href="/image/png/writer.go.html#5599609">y</a></span><span class="op" id="5599707">)</span><span class="op" id="5599708">.</span><span class="ident" id="5599709">RGBA</span><span class="op" id="5599713">(</span><span class="op" id="5599714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599719">if</span>&nbsp;<span class="ident" id="5599722"><a href="/image/png/writer.go.html#5599693">a</a></span>&nbsp;<span class="op" id="5599724">!=</span>&nbsp;<span class="num" id="5599727">0xffff</span>&nbsp;<span class="op" id="5599734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599740">return</span>&nbsp;<span class="ident" id="5599747">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599760">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599766">return</span>&nbsp;<span class="ident" id="5599773">true</span><br>
<span class="lineno"></span><span class="op" id="5599778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5599781">//&nbsp;The&nbsp;absolute&nbsp;value&nbsp;of&nbsp;a&nbsp;byte&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;signed&nbsp;int8.</span><br>
<span class="lineno">75</span><span class="keyword" id="5599843">func</span>&nbsp;<span class="ident" id="5599848">abs8</span><span class="op" id="5599852">(</span><span class="ident" id="5599853">d</span>&nbsp;<span class="builtintype" id="5599855">uint8</span><span class="op" id="5599860">)</span>&nbsp;<span class="builtintype" id="5599862">int</span>&nbsp;<span class="op" id="5599866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599869">if</span>&nbsp;<span class="ident" id="5599872"><a href="/image/png/writer.go.html#5599853">d</a></span>&nbsp;<span class="op" id="5599874">&lt;</span>&nbsp;<span class="num" id="5599876">128</span>&nbsp;<span class="op" id="5599880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599884">return</span>&nbsp;<span class="builtintype" id="5599891">int</span><span class="op" id="5599894">(</span><span class="ident" id="5599895"><a href="/image/png/writer.go.html#5599853">d</a></span><span class="op" id="5599896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599902">return</span>&nbsp;<span class="num" id="5599909">256</span>&nbsp;<span class="op" id="5599913">-</span>&nbsp;<span class="builtintype" id="5599915">int</span><span class="op" id="5599918">(</span><span class="ident" id="5599919"><a href="/image/png/writer.go.html#5599853">d</a></span><span class="op" id="5599920">)</span><br>
<span class="lineno">80</span><span class="op" id="5599922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5599925">func</span>&nbsp;<span class="op" id="5599930">(</span><span class="ident" id="5599931">e</span>&nbsp;<span class="op" id="5599933">*</span><span class="ident" id="5599934"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5599941">)</span>&nbsp;<span class="ident" id="5599943">writeChunk</span><span class="op" id="5599953">(</span><span class="ident" id="5599954">b</span>&nbsp;<span class="op" id="5599956">[</span><span class="op" id="5599957">]</span><span class="builtintype" id="5599958">byte</span><span class="op" id="5599962">,</span>&nbsp;<span class="ident" id="5599964">name</span>&nbsp;<span class="builtintype" id="5599969">string</span><span class="op" id="5599975">)</span>&nbsp;<span class="op" id="5599977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599980">if</span>&nbsp;<span class="ident" id="5599983"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5599984">.</span><span class="ident" id="5599985">err</span>&nbsp;<span class="op" id="5599989">!=</span>&nbsp;<span class="ident" id="5599992">nil</span>&nbsp;<span class="op" id="5599996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600000">return</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600011">n</span>&nbsp;<span class="op" id="5600013">:=</span>&nbsp;<span class="builtintype" id="5600016">uint32</span><span class="op" id="5600022">(</span><span class="builtinfunc" id="5600023">len</span><span class="op" id="5600026">(</span><span class="ident" id="5600027"><a href="/image/png/writer.go.html#5599954">b</a></span><span class="op" id="5600028">)</span><span class="op" id="5600029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600032">if</span>&nbsp;<span class="builtintype" id="5600035">int</span><span class="op" id="5600038">(</span><span class="ident" id="5600039"><a href="/image/png/writer.go.html#5600011">n</a></span><span class="op" id="5600040">)</span>&nbsp;<span class="op" id="5600042">!=</span>&nbsp;<span class="builtinfunc" id="5600045">len</span><span class="op" id="5600048">(</span><span class="ident" id="5600049"><a href="/image/png/writer.go.html#5599954">b</a></span><span class="op" id="5600050">)</span>&nbsp;<span class="op" id="5600052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600056"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600057">.</span><span class="ident" id="5600058">err</span>&nbsp;<span class="op" id="5600062">=</span>&nbsp;<span class="ident" id="5600064"><a href="/image/png/reader.go.html#5580197">UnsupportedError</a></span><span class="op" id="5600080">(</span><span class="ident" id="5600081"><a href="/image/png/writer.go.html#5599964">name</a></span>&nbsp;<span class="op" id="5600086">+</span>&nbsp;<span class="string" id="5600088">&#34;&nbsp;chunk&nbsp;is&nbsp;too&nbsp;large:&nbsp;&#34;</span>&nbsp;<span class="op" id="5600112">+</span>&nbsp;<span class="ident" id="5600114"><a href="/image/png/writer.go.html#5598639">strconv</a></span><span class="op" id="5600121">.</span><span class="ident" id="5600122">Itoa</span><span class="op" id="5600126">(</span><span class="builtinfunc" id="5600127">len</span><span class="op" id="5600130">(</span><span class="ident" id="5600131"><a href="/image/png/writer.go.html#5599954">b</a></span><span class="op" id="5600132">)</span><span class="op" id="5600133">)</span><span class="op" id="5600134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600138">return</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600149"><a href="/image/png/writer.go.html#5599275">writeUint32</a></span><span class="op" id="5600160">(</span><span class="ident" id="5600161"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600162">.</span><span class="ident" id="5600163">header</span><span class="op" id="5600169">[</span><span class="op" id="5600170">:</span><span class="num" id="5600171">4</span><span class="op" id="5600172">]</span><span class="op" id="5600173">,</span>&nbsp;<span class="ident" id="5600175"><a href="/image/png/writer.go.html#5600011">n</a></span><span class="op" id="5600176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600179"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600180">.</span><span class="ident" id="5600181">header</span><span class="op" id="5600187">[</span><span class="num" id="5600188">4</span><span class="op" id="5600189">]</span>&nbsp;<span class="op" id="5600191">=</span>&nbsp;<span class="ident" id="5600193"><a href="/image/png/writer.go.html#5599964">name</a></span><span class="op" id="5600197">[</span><span class="num" id="5600198">0</span><span class="op" id="5600199">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600202"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600203">.</span><span class="ident" id="5600204">header</span><span class="op" id="5600210">[</span><span class="num" id="5600211">5</span><span class="op" id="5600212">]</span>&nbsp;<span class="op" id="5600214">=</span>&nbsp;<span class="ident" id="5600216"><a href="/image/png/writer.go.html#5599964">name</a></span><span class="op" id="5600220">[</span><span class="num" id="5600221">1</span><span class="op" id="5600222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600225"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600226">.</span><span class="ident" id="5600227">header</span><span class="op" id="5600233">[</span><span class="num" id="5600234">6</span><span class="op" id="5600235">]</span>&nbsp;<span class="op" id="5600237">=</span>&nbsp;<span class="ident" id="5600239"><a href="/image/png/writer.go.html#5599964">name</a></span><span class="op" id="5600243">[</span><span class="num" id="5600244">2</span><span class="op" id="5600245">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600248"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600249">.</span><span class="ident" id="5600250">header</span><span class="op" id="5600256">[</span><span class="num" id="5600257">7</span><span class="op" id="5600258">]</span>&nbsp;<span class="op" id="5600260">=</span>&nbsp;<span class="ident" id="5600262"><a href="/image/png/writer.go.html#5599964">name</a></span><span class="op" id="5600266">[</span><span class="num" id="5600267">3</span><span class="op" id="5600268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600271">crc</span>&nbsp;<span class="op" id="5600275">:=</span>&nbsp;<span class="ident" id="5600278"><a href="/image/png/writer.go.html#5598595">crc32</a></span><span class="op" id="5600283">.</span><span class="ident" id="5600284">NewIEEE</span><span class="op" id="5600291">(</span><span class="op" id="5600292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600295"><a href="/image/png/writer.go.html#5600271">crc</a></span><span class="op" id="5600298">.</span><span class="ident" id="5600299">Write</span><span class="op" id="5600304">(</span><span class="ident" id="5600305"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600306">.</span><span class="ident" id="5600307">header</span><span class="op" id="5600313">[</span><span class="num" id="5600314">4</span><span class="op" id="5600315">:</span><span class="num" id="5600316">8</span><span class="op" id="5600317">]</span><span class="op" id="5600318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600321"><a href="/image/png/writer.go.html#5600271">crc</a></span><span class="op" id="5600324">.</span><span class="ident" id="5600325">Write</span><span class="op" id="5600330">(</span><span class="ident" id="5600331"><a href="/image/png/writer.go.html#5599954">b</a></span><span class="op" id="5600332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600335"><a href="/image/png/writer.go.html#5599275">writeUint32</a></span><span class="op" id="5600346">(</span><span class="ident" id="5600347"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600348">.</span><span class="ident" id="5600349">footer</span><span class="op" id="5600355">[</span><span class="op" id="5600356">:</span><span class="num" id="5600357">4</span><span class="op" id="5600358">]</span><span class="op" id="5600359">,</span>&nbsp;<span class="ident" id="5600361"><a href="/image/png/writer.go.html#5600271">crc</a></span><span class="op" id="5600364">.</span><span class="ident" id="5600365">Sum32</span><span class="op" id="5600370">(</span><span class="op" id="5600371">)</span><span class="op" id="5600372">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600376">_</span><span class="op" id="5600377">,</span>&nbsp;<span class="ident" id="5600379"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600380">.</span><span class="ident" id="5600381">err</span>&nbsp;<span class="op" id="5600385">=</span>&nbsp;<span class="ident" id="5600387"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600388">.</span><span class="ident" id="5600389">w</span><span class="op" id="5600390">.</span><span class="ident" id="5600391">Write</span><span class="op" id="5600396">(</span><span class="ident" id="5600397"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600398">.</span><span class="ident" id="5600399">header</span><span class="op" id="5600405">[</span><span class="op" id="5600406">:</span><span class="num" id="5600407">8</span><span class="op" id="5600408">]</span><span class="op" id="5600409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600412">if</span>&nbsp;<span class="ident" id="5600415"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600416">.</span><span class="ident" id="5600417">err</span>&nbsp;<span class="op" id="5600421">!=</span>&nbsp;<span class="ident" id="5600424">nil</span>&nbsp;<span class="op" id="5600428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600440">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600443">_</span><span class="op" id="5600444">,</span>&nbsp;<span class="ident" id="5600446"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600447">.</span><span class="ident" id="5600448">err</span>&nbsp;<span class="op" id="5600452">=</span>&nbsp;<span class="ident" id="5600454"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600455">.</span><span class="ident" id="5600456">w</span><span class="op" id="5600457">.</span><span class="ident" id="5600458">Write</span><span class="op" id="5600463">(</span><span class="ident" id="5600464"><a href="/image/png/writer.go.html#5599954">b</a></span><span class="op" id="5600465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600468">if</span>&nbsp;<span class="ident" id="5600471"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600472">.</span><span class="ident" id="5600473">err</span>&nbsp;<span class="op" id="5600477">!=</span>&nbsp;<span class="ident" id="5600480">nil</span>&nbsp;<span class="op" id="5600484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600488">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600499">_</span><span class="op" id="5600500">,</span>&nbsp;<span class="ident" id="5600502"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600503">.</span><span class="ident" id="5600504">err</span>&nbsp;<span class="op" id="5600508">=</span>&nbsp;<span class="ident" id="5600510"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600511">.</span><span class="ident" id="5600512">w</span><span class="op" id="5600513">.</span><span class="ident" id="5600514">Write</span><span class="op" id="5600519">(</span><span class="ident" id="5600520"><a href="/image/png/writer.go.html#5599931">e</a></span><span class="op" id="5600521">.</span><span class="ident" id="5600522">footer</span><span class="op" id="5600528">[</span><span class="op" id="5600529">:</span><span class="num" id="5600530">4</span><span class="op" id="5600531">]</span><span class="op" id="5600532">)</span><br>
<span class="lineno">110</span><span class="op" id="5600534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600537">func</span>&nbsp;<span class="op" id="5600542">(</span><span class="ident" id="5600543">e</span>&nbsp;<span class="op" id="5600545">*</span><span class="ident" id="5600546"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5600553">)</span>&nbsp;<span class="ident" id="5600555">writeIHDR</span><span class="op" id="5600564">(</span><span class="op" id="5600565">)</span>&nbsp;<span class="op" id="5600567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600570">b</span>&nbsp;<span class="op" id="5600572">:=</span>&nbsp;<span class="ident" id="5600575"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600576">.</span><span class="ident" id="5600577">m</span><span class="op" id="5600578">.</span><span class="ident" id="5600579">Bounds</span><span class="op" id="5600585">(</span><span class="op" id="5600586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600589"><a href="/image/png/writer.go.html#5599275">writeUint32</a></span><span class="op" id="5600600">(</span><span class="ident" id="5600601"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600602">.</span><span class="ident" id="5600603">tmp</span><span class="op" id="5600606">[</span><span class="num" id="5600607">0</span><span class="op" id="5600608">:</span><span class="num" id="5600609">4</span><span class="op" id="5600610">]</span><span class="op" id="5600611">,</span>&nbsp;<span class="builtintype" id="5600613">uint32</span><span class="op" id="5600619">(</span><span class="ident" id="5600620"><a href="/image/png/writer.go.html#5600570">b</a></span><span class="op" id="5600621">.</span><span class="ident" id="5600622">Dx</span><span class="op" id="5600624">(</span><span class="op" id="5600625">)</span><span class="op" id="5600626">)</span><span class="op" id="5600627">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600630"><a href="/image/png/writer.go.html#5599275">writeUint32</a></span><span class="op" id="5600641">(</span><span class="ident" id="5600642"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600643">.</span><span class="ident" id="5600644">tmp</span><span class="op" id="5600647">[</span><span class="num" id="5600648">4</span><span class="op" id="5600649">:</span><span class="num" id="5600650">8</span><span class="op" id="5600651">]</span><span class="op" id="5600652">,</span>&nbsp;<span class="builtintype" id="5600654">uint32</span><span class="op" id="5600660">(</span><span class="ident" id="5600661"><a href="/image/png/writer.go.html#5600570">b</a></span><span class="op" id="5600662">.</span><span class="ident" id="5600663">Dy</span><span class="op" id="5600665">(</span><span class="op" id="5600666">)</span><span class="op" id="5600667">)</span><span class="op" id="5600668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600671">//&nbsp;Set&nbsp;bit&nbsp;depth&nbsp;and&nbsp;color&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600705">switch</span>&nbsp;<span class="ident" id="5600712"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600713">.</span><span class="ident" id="5600714">cb</span>&nbsp;<span class="op" id="5600717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600720">case</span>&nbsp;<span class="ident" id="5600725"><a href="/image/png/reader.go.html#5578479">cbG8</a></span><span class="op" id="5600729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600733"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600734">.</span><span class="ident" id="5600735">tmp</span><span class="op" id="5600738">[</span><span class="num" id="5600739">8</span><span class="op" id="5600740">]</span>&nbsp;<span class="op" id="5600742">=</span>&nbsp;<span class="num" id="5600744">8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600748"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600749">.</span><span class="ident" id="5600750">tmp</span><span class="op" id="5600753">[</span><span class="num" id="5600754">9</span><span class="op" id="5600755">]</span>&nbsp;<span class="op" id="5600757">=</span>&nbsp;<span class="ident" id="5600759"><a href="/image/png/reader.go.html#5578268">ctGrayscale</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600772">case</span>&nbsp;<span class="ident" id="5600777"><a href="/image/png/reader.go.html#5578492">cbTC8</a></span><span class="op" id="5600782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600786"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600787">.</span><span class="ident" id="5600788">tmp</span><span class="op" id="5600791">[</span><span class="num" id="5600792">8</span><span class="op" id="5600793">]</span>&nbsp;<span class="op" id="5600795">=</span>&nbsp;<span class="num" id="5600797">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600801"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600802">.</span><span class="ident" id="5600803">tmp</span><span class="op" id="5600806">[</span><span class="num" id="5600807">9</span><span class="op" id="5600808">]</span>&nbsp;<span class="op" id="5600810">=</span>&nbsp;<span class="ident" id="5600812"><a href="/image/png/reader.go.html#5578290">ctTrueColor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600825">case</span>&nbsp;<span class="ident" id="5600830"><a href="/image/png/reader.go.html#5578517">cbP8</a></span><span class="op" id="5600834">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600838"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600839">.</span><span class="ident" id="5600840">tmp</span><span class="op" id="5600843">[</span><span class="num" id="5600844">8</span><span class="op" id="5600845">]</span>&nbsp;<span class="op" id="5600847">=</span>&nbsp;<span class="num" id="5600849">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600853"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600854">.</span><span class="ident" id="5600855">tmp</span><span class="op" id="5600858">[</span><span class="num" id="5600859">9</span><span class="op" id="5600860">]</span>&nbsp;<span class="op" id="5600862">=</span>&nbsp;<span class="ident" id="5600864"><a href="/image/png/reader.go.html#5578312">ctPaletted</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600876">case</span>&nbsp;<span class="ident" id="5600881"><a href="/image/png/reader.go.html#5578523">cbTCA8</a></span><span class="op" id="5600887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600891"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600892">.</span><span class="ident" id="5600893">tmp</span><span class="op" id="5600896">[</span><span class="num" id="5600897">8</span><span class="op" id="5600898">]</span>&nbsp;<span class="op" id="5600900">=</span>&nbsp;<span class="num" id="5600902">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600906"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600907">.</span><span class="ident" id="5600908">tmp</span><span class="op" id="5600911">[</span><span class="num" id="5600912">9</span><span class="op" id="5600913">]</span>&nbsp;<span class="op" id="5600915">=</span>&nbsp;<span class="ident" id="5600917"><a href="/image/png/reader.go.html#5578356">ctTrueColorAlpha</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600935">case</span>&nbsp;<span class="ident" id="5600940"><a href="/image/png/reader.go.html#5578531">cbG16</a></span><span class="op" id="5600945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600949"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600950">.</span><span class="ident" id="5600951">tmp</span><span class="op" id="5600954">[</span><span class="num" id="5600955">8</span><span class="op" id="5600956">]</span>&nbsp;<span class="op" id="5600958">=</span>&nbsp;<span class="num" id="5600960">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600965"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5600966">.</span><span class="ident" id="5600967">tmp</span><span class="op" id="5600970">[</span><span class="num" id="5600971">9</span><span class="op" id="5600972">]</span>&nbsp;<span class="op" id="5600974">=</span>&nbsp;<span class="ident" id="5600976"><a href="/image/png/reader.go.html#5578268">ctGrayscale</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600989">case</span>&nbsp;<span class="ident" id="5600994"><a href="/image/png/reader.go.html#5578546">cbTC16</a></span><span class="op" id="5601000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601004"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601005">.</span><span class="ident" id="5601006">tmp</span><span class="op" id="5601009">[</span><span class="num" id="5601010">8</span><span class="op" id="5601011">]</span>&nbsp;<span class="op" id="5601013">=</span>&nbsp;<span class="num" id="5601015">16</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601020"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601021">.</span><span class="ident" id="5601022">tmp</span><span class="op" id="5601025">[</span><span class="num" id="5601026">9</span><span class="op" id="5601027">]</span>&nbsp;<span class="op" id="5601029">=</span>&nbsp;<span class="ident" id="5601031"><a href="/image/png/reader.go.html#5578290">ctTrueColor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601044">case</span>&nbsp;<span class="ident" id="5601049"><a href="/image/png/reader.go.html#5578554">cbTCA16</a></span><span class="op" id="5601056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601060"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601061">.</span><span class="ident" id="5601062">tmp</span><span class="op" id="5601065">[</span><span class="num" id="5601066">8</span><span class="op" id="5601067">]</span>&nbsp;<span class="op" id="5601069">=</span>&nbsp;<span class="num" id="5601071">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601076"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601077">.</span><span class="ident" id="5601078">tmp</span><span class="op" id="5601081">[</span><span class="num" id="5601082">9</span><span class="op" id="5601083">]</span>&nbsp;<span class="op" id="5601085">=</span>&nbsp;<span class="ident" id="5601087"><a href="/image/png/reader.go.html#5578356">ctTrueColorAlpha</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601105">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601108"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601109">.</span><span class="ident" id="5601110">tmp</span><span class="op" id="5601113">[</span><span class="num" id="5601114">10</span><span class="op" id="5601116">]</span>&nbsp;<span class="op" id="5601118">=</span>&nbsp;<span class="num" id="5601120">0</span>&nbsp;<span class="comment" id="5601122">//&nbsp;default&nbsp;compression&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601153"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601154">.</span><span class="ident" id="5601155">tmp</span><span class="op" id="5601158">[</span><span class="num" id="5601159">11</span><span class="op" id="5601161">]</span>&nbsp;<span class="op" id="5601163">=</span>&nbsp;<span class="num" id="5601165">0</span>&nbsp;<span class="comment" id="5601167">//&nbsp;default&nbsp;filter&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601193"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601194">.</span><span class="ident" id="5601195">tmp</span><span class="op" id="5601198">[</span><span class="num" id="5601199">12</span><span class="op" id="5601201">]</span>&nbsp;<span class="op" id="5601203">=</span>&nbsp;<span class="num" id="5601205">0</span>&nbsp;<span class="comment" id="5601207">//&nbsp;non-interlaced</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601226"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601227">.</span><span class="ident" id="5601228">writeChunk</span><span class="op" id="5601238">(</span><span class="ident" id="5601239"><a href="/image/png/writer.go.html#5600543">e</a></span><span class="op" id="5601240">.</span><span class="ident" id="5601241">tmp</span><span class="op" id="5601244">[</span><span class="op" id="5601245">:</span><span class="num" id="5601246">13</span><span class="op" id="5601248">]</span><span class="op" id="5601249">,</span>&nbsp;<span class="string" id="5601251">&#34;IHDR&#34;</span><span class="op" id="5601257">)</span><br>
<span class="lineno"></span><span class="op" id="5601259">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="5601262">func</span>&nbsp;<span class="op" id="5601267">(</span><span class="ident" id="5601268">e</span>&nbsp;<span class="op" id="5601270">*</span><span class="ident" id="5601271"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5601278">)</span>&nbsp;<span class="ident" id="5601280">writePLTEAndTRNS</span><span class="op" id="5601296">(</span><span class="ident" id="5601297">p</span>&nbsp;<span class="ident" id="5601299"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5601304">.</span><span class="ident" id="5601305">Palette</span><span class="op" id="5601312">)</span>&nbsp;<span class="op" id="5601314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601317">if</span>&nbsp;<span class="builtinfunc" id="5601320">len</span><span class="op" id="5601323">(</span><span class="ident" id="5601324"><a href="/image/png/writer.go.html#5601297">p</a></span><span class="op" id="5601325">)</span>&nbsp;<span class="op" id="5601327">&lt;</span>&nbsp;<span class="num" id="5601329">1</span>&nbsp;<span class="op" id="5601331">||</span>&nbsp;<span class="builtinfunc" id="5601334">len</span><span class="op" id="5601337">(</span><span class="ident" id="5601338"><a href="/image/png/writer.go.html#5601297">p</a></span><span class="op" id="5601339">)</span>&nbsp;<span class="op" id="5601341">&gt;</span>&nbsp;<span class="num" id="5601343">256</span>&nbsp;<span class="op" id="5601347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601351"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601352">.</span><span class="ident" id="5601353">err</span>&nbsp;<span class="op" id="5601357">=</span>&nbsp;<span class="ident" id="5601359"><a href="/image/png/reader.go.html#5579941">FormatError</a></span><span class="op" id="5601370">(</span><span class="string" id="5601371">&#34;bad&nbsp;palette&nbsp;length:&nbsp;&#34;</span>&nbsp;<span class="op" id="5601394">+</span>&nbsp;<span class="ident" id="5601396"><a href="/image/png/writer.go.html#5598639">strconv</a></span><span class="op" id="5601403">.</span><span class="ident" id="5601404">Itoa</span><span class="op" id="5601408">(</span><span class="builtinfunc" id="5601409">len</span><span class="op" id="5601412">(</span><span class="ident" id="5601413"><a href="/image/png/writer.go.html#5601297">p</a></span><span class="op" id="5601414">)</span><span class="op" id="5601415">)</span><span class="op" id="5601416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601420">return</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601431">last</span>&nbsp;<span class="op" id="5601436">:=</span>&nbsp;<span class="op" id="5601439">-</span><span class="num" id="5601440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601443">for</span>&nbsp;<span class="ident" id="5601447">i</span><span class="op" id="5601448">,</span>&nbsp;<span class="ident" id="5601450">c</span>&nbsp;<span class="op" id="5601452">:=</span>&nbsp;<span class="keyword" id="5601455">range</span>&nbsp;<span class="ident" id="5601461"><a href="/image/png/writer.go.html#5601297">p</a></span>&nbsp;<span class="op" id="5601463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601467">c1</span>&nbsp;<span class="op" id="5601470">:=</span>&nbsp;<span class="ident" id="5601473"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5601478">.</span><span class="ident" id="5601479">NRGBAModel</span><span class="op" id="5601489">.</span><span class="ident" id="5601490">Convert</span><span class="op" id="5601497">(</span><span class="ident" id="5601498"><a href="/image/png/writer.go.html#5601450">c</a></span><span class="op" id="5601499">)</span><span class="op" id="5601500">.</span><span class="op" id="5601501">(</span><span class="ident" id="5601502"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5601507">.</span><span class="ident" id="5601508">NRGBA</span><span class="op" id="5601513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601517"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601518">.</span><span class="ident" id="5601519">tmp</span><span class="op" id="5601522">[</span><span class="num" id="5601523">3</span><span class="op" id="5601524">*</span><span class="ident" id="5601525"><a href="/image/png/writer.go.html#5601447">i</a></span><span class="op" id="5601526">+</span><span class="num" id="5601527">0</span><span class="op" id="5601528">]</span>&nbsp;<span class="op" id="5601530">=</span>&nbsp;<span class="ident" id="5601532"><a href="/image/png/writer.go.html#5601467">c1</a></span><span class="op" id="5601534">.</span><span class="ident" id="5601535">R</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601539"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601540">.</span><span class="ident" id="5601541">tmp</span><span class="op" id="5601544">[</span><span class="num" id="5601545">3</span><span class="op" id="5601546">*</span><span class="ident" id="5601547"><a href="/image/png/writer.go.html#5601447">i</a></span><span class="op" id="5601548">+</span><span class="num" id="5601549">1</span><span class="op" id="5601550">]</span>&nbsp;<span class="op" id="5601552">=</span>&nbsp;<span class="ident" id="5601554"><a href="/image/png/writer.go.html#5601467">c1</a></span><span class="op" id="5601556">.</span><span class="ident" id="5601557">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601561"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601562">.</span><span class="ident" id="5601563">tmp</span><span class="op" id="5601566">[</span><span class="num" id="5601567">3</span><span class="op" id="5601568">*</span><span class="ident" id="5601569"><a href="/image/png/writer.go.html#5601447">i</a></span><span class="op" id="5601570">+</span><span class="num" id="5601571">2</span><span class="op" id="5601572">]</span>&nbsp;<span class="op" id="5601574">=</span>&nbsp;<span class="ident" id="5601576"><a href="/image/png/writer.go.html#5601467">c1</a></span><span class="op" id="5601578">.</span><span class="ident" id="5601579">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601583">if</span>&nbsp;<span class="ident" id="5601586"><a href="/image/png/writer.go.html#5601467">c1</a></span><span class="op" id="5601588">.</span><span class="ident" id="5601589">A</span>&nbsp;<span class="op" id="5601591">!=</span>&nbsp;<span class="num" id="5601594">0xff</span>&nbsp;<span class="op" id="5601599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601604"><a href="/image/png/writer.go.html#5601431">last</a></span>&nbsp;<span class="op" id="5601609">=</span>&nbsp;<span class="ident" id="5601611"><a href="/image/png/writer.go.html#5601447">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601615">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601619"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601620">.</span><span class="ident" id="5601621">tmp</span><span class="op" id="5601624">[</span><span class="num" id="5601625">3</span><span class="op" id="5601626">*</span><span class="num" id="5601627">256</span><span class="op" id="5601630">+</span><span class="ident" id="5601631"><a href="/image/png/writer.go.html#5601447">i</a></span><span class="op" id="5601632">]</span>&nbsp;<span class="op" id="5601634">=</span>&nbsp;<span class="ident" id="5601636"><a href="/image/png/writer.go.html#5601467">c1</a></span><span class="op" id="5601638">.</span><span class="ident" id="5601639">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601645"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601646">.</span><span class="ident" id="5601647">writeChunk</span><span class="op" id="5601657">(</span><span class="ident" id="5601658"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601659">.</span><span class="ident" id="5601660">tmp</span><span class="op" id="5601663">[</span><span class="op" id="5601664">:</span><span class="num" id="5601665">3</span><span class="op" id="5601666">*</span><span class="builtinfunc" id="5601667">len</span><span class="op" id="5601670">(</span><span class="ident" id="5601671"><a href="/image/png/writer.go.html#5601297">p</a></span><span class="op" id="5601672">)</span><span class="op" id="5601673">]</span><span class="op" id="5601674">,</span>&nbsp;<span class="string" id="5601676">&#34;PLTE&#34;</span><span class="op" id="5601682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601685">if</span>&nbsp;<span class="ident" id="5601688"><a href="/image/png/writer.go.html#5601431">last</a></span>&nbsp;<span class="op" id="5601693">!=</span>&nbsp;<span class="op" id="5601696">-</span><span class="num" id="5601697">1</span>&nbsp;<span class="op" id="5601699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601703"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601704">.</span><span class="ident" id="5601705">writeChunk</span><span class="op" id="5601715">(</span><span class="ident" id="5601716"><a href="/image/png/writer.go.html#5601268">e</a></span><span class="op" id="5601717">.</span><span class="ident" id="5601718">tmp</span><span class="op" id="5601721">[</span><span class="num" id="5601722">3</span><span class="op" id="5601723">*</span><span class="num" id="5601724">256</span><span class="op" id="5601727">:</span><span class="num" id="5601728">3</span><span class="op" id="5601729">*</span><span class="num" id="5601730">256</span><span class="op" id="5601733">+</span><span class="num" id="5601734">1</span><span class="op" id="5601735">+</span><span class="ident" id="5601736"><a href="/image/png/writer.go.html#5601431">last</a></span><span class="op" id="5601740">]</span><span class="op" id="5601741">,</span>&nbsp;<span class="string" id="5601743">&#34;tRNS&#34;</span><span class="op" id="5601749">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601752">}</span><br>
<span class="lineno"></span><span class="op" id="5601754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601757">//&nbsp;An&nbsp;encoder&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;that&nbsp;satisfies&nbsp;writes&nbsp;by&nbsp;writing&nbsp;PNG&nbsp;IDAT&nbsp;chunks,</span><br>
<span class="lineno"></span><span class="comment" id="5601837">//&nbsp;including&nbsp;an&nbsp;8-byte&nbsp;header&nbsp;and&nbsp;4-byte&nbsp;CRC&nbsp;checksum&nbsp;per&nbsp;Write&nbsp;call.&nbsp;Such&nbsp;calls</span><br>
<span class="lineno">170</span><span class="comment" id="5601918">//&nbsp;should&nbsp;be&nbsp;relatively&nbsp;infrequent,&nbsp;since&nbsp;writeIDATs&nbsp;uses&nbsp;a&nbsp;bufio.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5601992">//</span><br>
<span class="lineno"></span><span class="comment" id="5601995">//&nbsp;This&nbsp;method&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;writeIDATs&nbsp;(via&nbsp;writeImage).</span><br>
<span class="lineno"></span><span class="comment" id="5602066">//&nbsp;No&nbsp;other&nbsp;code&nbsp;should&nbsp;treat&nbsp;an&nbsp;encoder&nbsp;as&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5602124">func</span>&nbsp;<span class="op" id="5602129">(</span><span class="ident" id="5602130">e</span>&nbsp;<span class="op" id="5602132">*</span><span class="ident" id="5602133"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5602140">)</span>&nbsp;<span class="ident" id="5602142">Write</span><span class="op" id="5602147">(</span><span class="ident" id="5602148">b</span>&nbsp;<span class="op" id="5602150">[</span><span class="op" id="5602151">]</span><span class="builtintype" id="5602152">byte</span><span class="op" id="5602156">)</span>&nbsp;<span class="op" id="5602158">(</span><span class="builtintype" id="5602159">int</span><span class="op" id="5602162">,</span>&nbsp;<span class="builtintype" id="5602164">error</span><span class="op" id="5602169">)</span>&nbsp;<span class="op" id="5602171">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602174"><a href="/image/png/writer.go.html#5602130">e</a></span><span class="op" id="5602175">.</span><span class="ident" id="5602176">writeChunk</span><span class="op" id="5602186">(</span><span class="ident" id="5602187"><a href="/image/png/writer.go.html#5602148">b</a></span><span class="op" id="5602188">,</span>&nbsp;<span class="string" id="5602190">&#34;IDAT&#34;</span><span class="op" id="5602196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602199">if</span>&nbsp;<span class="ident" id="5602202"><a href="/image/png/writer.go.html#5602130">e</a></span><span class="op" id="5602203">.</span><span class="ident" id="5602204">err</span>&nbsp;<span class="op" id="5602208">!=</span>&nbsp;<span class="ident" id="5602211">nil</span>&nbsp;<span class="op" id="5602215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602219">return</span>&nbsp;<span class="num" id="5602226">0</span><span class="op" id="5602227">,</span>&nbsp;<span class="ident" id="5602229"><a href="/image/png/writer.go.html#5602130">e</a></span><span class="op" id="5602230">.</span><span class="ident" id="5602231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602239">return</span>&nbsp;<span class="builtinfunc" id="5602246">len</span><span class="op" id="5602249">(</span><span class="ident" id="5602250"><a href="/image/png/writer.go.html#5602148">b</a></span><span class="op" id="5602251">)</span><span class="op" id="5602252">,</span>&nbsp;<span class="ident" id="5602254">nil</span><br>
<span class="lineno">180</span><span class="op" id="5602258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5602261">//&nbsp;Chooses&nbsp;the&nbsp;filter&nbsp;to&nbsp;use&nbsp;for&nbsp;encoding&nbsp;the&nbsp;current&nbsp;row,&nbsp;and&nbsp;applies&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5602336">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;filter&nbsp;and&nbsp;also&nbsp;of&nbsp;the&nbsp;row&nbsp;in&nbsp;cr&nbsp;that&nbsp;has&nbsp;had&nbsp;it&nbsp;applied.</span><br>
<span class="lineno"></span><span class="keyword" id="5602434">func</span>&nbsp;<span class="ident" id="5602439">filter</span><span class="op" id="5602445">(</span><span class="ident" id="5602446">cr</span>&nbsp;<span class="op" id="5602449">*</span><span class="op" id="5602450">[</span><span class="ident" id="5602451"><a href="/image/png/reader.go.html#5578686">nFilter</a></span><span class="op" id="5602458">]</span><span class="op" id="5602459">[</span><span class="op" id="5602460">]</span><span class="builtintype" id="5602461">byte</span><span class="op" id="5602465">,</span>&nbsp;<span class="ident" id="5602467">pr</span>&nbsp;<span class="op" id="5602470">[</span><span class="op" id="5602471">]</span><span class="builtintype" id="5602472">byte</span><span class="op" id="5602476">,</span>&nbsp;<span class="ident" id="5602478">bpp</span>&nbsp;<span class="builtintype" id="5602482">int</span><span class="op" id="5602485">)</span>&nbsp;<span class="builtintype" id="5602487">int</span>&nbsp;<span class="op" id="5602491">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5602494">//&nbsp;We&nbsp;try&nbsp;all&nbsp;five&nbsp;filter&nbsp;types,&nbsp;and&nbsp;pick&nbsp;the&nbsp;one&nbsp;that&nbsp;minimizes&nbsp;the&nbsp;sum&nbsp;of&nbsp;absolute&nbsp;differences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5602593">//&nbsp;This&nbsp;is&nbsp;the&nbsp;same&nbsp;heuristic&nbsp;that&nbsp;libpng&nbsp;uses,&nbsp;although&nbsp;the&nbsp;filters&nbsp;are&nbsp;attempted&nbsp;in&nbsp;order&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5602689">//&nbsp;estimated&nbsp;most&nbsp;likely&nbsp;to&nbsp;be&nbsp;minimal&nbsp;(ftUp,&nbsp;ftPaeth,&nbsp;ftNone,&nbsp;ftSub,&nbsp;ftAverage),&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5602784">//&nbsp;in&nbsp;their&nbsp;enumeration&nbsp;order&nbsp;(ftNone,&nbsp;ftSub,&nbsp;ftUp,&nbsp;ftAverage,&nbsp;ftPaeth).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602858">cdat0</span>&nbsp;<span class="op" id="5602864">:=</span>&nbsp;<span class="ident" id="5602867"><a href="/image/png/writer.go.html#5602446">cr</a></span><span class="op" id="5602869">[</span><span class="num" id="5602870">0</span><span class="op" id="5602871">]</span><span class="op" id="5602872">[</span><span class="num" id="5602873">1</span><span class="op" id="5602874">:</span><span class="op" id="5602875">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602878">cdat1</span>&nbsp;<span class="op" id="5602884">:=</span>&nbsp;<span class="ident" id="5602887"><a href="/image/png/writer.go.html#5602446">cr</a></span><span class="op" id="5602889">[</span><span class="num" id="5602890">1</span><span class="op" id="5602891">]</span><span class="op" id="5602892">[</span><span class="num" id="5602893">1</span><span class="op" id="5602894">:</span><span class="op" id="5602895">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602898">cdat2</span>&nbsp;<span class="op" id="5602904">:=</span>&nbsp;<span class="ident" id="5602907"><a href="/image/png/writer.go.html#5602446">cr</a></span><span class="op" id="5602909">[</span><span class="num" id="5602910">2</span><span class="op" id="5602911">]</span><span class="op" id="5602912">[</span><span class="num" id="5602913">1</span><span class="op" id="5602914">:</span><span class="op" id="5602915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602918">cdat3</span>&nbsp;<span class="op" id="5602924">:=</span>&nbsp;<span class="ident" id="5602927"><a href="/image/png/writer.go.html#5602446">cr</a></span><span class="op" id="5602929">[</span><span class="num" id="5602930">3</span><span class="op" id="5602931">]</span><span class="op" id="5602932">[</span><span class="num" id="5602933">1</span><span class="op" id="5602934">:</span><span class="op" id="5602935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602938">cdat4</span>&nbsp;<span class="op" id="5602944">:=</span>&nbsp;<span class="ident" id="5602947"><a href="/image/png/writer.go.html#5602446">cr</a></span><span class="op" id="5602949">[</span><span class="num" id="5602950">4</span><span class="op" id="5602951">]</span><span class="op" id="5602952">[</span><span class="num" id="5602953">1</span><span class="op" id="5602954">:</span><span class="op" id="5602955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602958">pdat</span>&nbsp;<span class="op" id="5602963">:=</span>&nbsp;<span class="ident" id="5602966"><a href="/image/png/writer.go.html#5602467">pr</a></span><span class="op" id="5602968">[</span><span class="num" id="5602969">1</span><span class="op" id="5602970">:</span><span class="op" id="5602971">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602974">n</span>&nbsp;<span class="op" id="5602976">:=</span>&nbsp;<span class="builtinfunc" id="5602979">len</span><span class="op" id="5602982">(</span><span class="ident" id="5602983"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5602988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5602992">//&nbsp;The&nbsp;up&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603011">sum</span>&nbsp;<span class="op" id="5603015">:=</span>&nbsp;<span class="num" id="5603018">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603021">for</span>&nbsp;<span class="ident" id="5603025">i</span>&nbsp;<span class="op" id="5603027">:=</span>&nbsp;<span class="num" id="5603030">0</span><span class="op" id="5603031">;</span>&nbsp;<span class="ident" id="5603033"><a href="/image/png/writer.go.html#5603025">i</a></span>&nbsp;<span class="op" id="5603035">&lt;</span>&nbsp;<span class="ident" id="5603037"><a href="/image/png/writer.go.html#5602974">n</a></span><span class="op" id="5603038">;</span>&nbsp;<span class="ident" id="5603040"><a href="/image/png/writer.go.html#5603025">i</a></span><span class="op" id="5603041">++</span>&nbsp;<span class="op" id="5603044">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603048"><a href="/image/png/writer.go.html#5602898">cdat2</a></span><span class="op" id="5603053">[</span><span class="ident" id="5603054"><a href="/image/png/writer.go.html#5603025">i</a></span><span class="op" id="5603055">]</span>&nbsp;<span class="op" id="5603057">=</span>&nbsp;<span class="ident" id="5603059"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603064">[</span><span class="ident" id="5603065"><a href="/image/png/writer.go.html#5603025">i</a></span><span class="op" id="5603066">]</span>&nbsp;<span class="op" id="5603068">-</span>&nbsp;<span class="ident" id="5603070"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5603074">[</span><span class="ident" id="5603075"><a href="/image/png/writer.go.html#5603025">i</a></span><span class="op" id="5603076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603080"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603084">+=</span>&nbsp;<span class="ident" id="5603087"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603091">(</span><span class="ident" id="5603092"><a href="/image/png/writer.go.html#5602898">cdat2</a></span><span class="op" id="5603097">[</span><span class="ident" id="5603098"><a href="/image/png/writer.go.html#5603025">i</a></span><span class="op" id="5603099">]</span><span class="op" id="5603100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603106">best</span>&nbsp;<span class="op" id="5603111">:=</span>&nbsp;<span class="ident" id="5603114"><a href="/image/png/writer.go.html#5603011">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603119">filter</span>&nbsp;<span class="op" id="5603126">:=</span>&nbsp;<span class="ident" id="5603129"><a href="/image/png/reader.go.html#5578641">ftUp</a></span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603136">//&nbsp;The&nbsp;Paeth&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603158"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603162">=</span>&nbsp;<span class="num" id="5603164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603167">for</span>&nbsp;<span class="ident" id="5603171">i</span>&nbsp;<span class="op" id="5603173">:=</span>&nbsp;<span class="num" id="5603176">0</span><span class="op" id="5603177">;</span>&nbsp;<span class="ident" id="5603179"><a href="/image/png/writer.go.html#5603171">i</a></span>&nbsp;<span class="op" id="5603181">&lt;</span>&nbsp;<span class="ident" id="5603183"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603186">;</span>&nbsp;<span class="ident" id="5603188"><a href="/image/png/writer.go.html#5603171">i</a></span><span class="op" id="5603189">++</span>&nbsp;<span class="op" id="5603192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603196"><a href="/image/png/writer.go.html#5602938">cdat4</a></span><span class="op" id="5603201">[</span><span class="ident" id="5603202"><a href="/image/png/writer.go.html#5603171">i</a></span><span class="op" id="5603203">]</span>&nbsp;<span class="op" id="5603205">=</span>&nbsp;<span class="ident" id="5603207"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603212">[</span><span class="ident" id="5603213"><a href="/image/png/writer.go.html#5603171">i</a></span><span class="op" id="5603214">]</span>&nbsp;<span class="op" id="5603216">-</span>&nbsp;<span class="ident" id="5603218"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5603222">[</span><span class="ident" id="5603223"><a href="/image/png/writer.go.html#5603171">i</a></span><span class="op" id="5603224">]</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603228"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603232">+=</span>&nbsp;<span class="ident" id="5603235"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603239">(</span><span class="ident" id="5603240"><a href="/image/png/writer.go.html#5602938">cdat4</a></span><span class="op" id="5603245">[</span><span class="ident" id="5603246"><a href="/image/png/writer.go.html#5603171">i</a></span><span class="op" id="5603247">]</span><span class="op" id="5603248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603254">for</span>&nbsp;<span class="ident" id="5603258">i</span>&nbsp;<span class="op" id="5603260">:=</span>&nbsp;<span class="ident" id="5603263"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603266">;</span>&nbsp;<span class="ident" id="5603268"><a href="/image/png/writer.go.html#5603258">i</a></span>&nbsp;<span class="op" id="5603270">&lt;</span>&nbsp;<span class="ident" id="5603272"><a href="/image/png/writer.go.html#5602974">n</a></span><span class="op" id="5603273">;</span>&nbsp;<span class="ident" id="5603275"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603276">++</span>&nbsp;<span class="op" id="5603279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603283"><a href="/image/png/writer.go.html#5602938">cdat4</a></span><span class="op" id="5603288">[</span><span class="ident" id="5603289"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603290">]</span>&nbsp;<span class="op" id="5603292">=</span>&nbsp;<span class="ident" id="5603294"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603299">[</span><span class="ident" id="5603300"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603301">]</span>&nbsp;<span class="op" id="5603303">-</span>&nbsp;<span class="ident" id="5603305"><a href="/image/png/paeth.go.html#5576734">paeth</a></span><span class="op" id="5603310">(</span><span class="ident" id="5603311"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603316">[</span><span class="ident" id="5603317"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603318">-</span><span class="ident" id="5603319"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603322">]</span><span class="op" id="5603323">,</span>&nbsp;<span class="ident" id="5603325"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5603329">[</span><span class="ident" id="5603330"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603331">]</span><span class="op" id="5603332">,</span>&nbsp;<span class="ident" id="5603334"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5603338">[</span><span class="ident" id="5603339"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603340">-</span><span class="ident" id="5603341"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603344">]</span><span class="op" id="5603345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603349"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603353">+=</span>&nbsp;<span class="ident" id="5603356"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603360">(</span><span class="ident" id="5603361"><a href="/image/png/writer.go.html#5602938">cdat4</a></span><span class="op" id="5603366">[</span><span class="ident" id="5603367"><a href="/image/png/writer.go.html#5603258">i</a></span><span class="op" id="5603368">]</span><span class="op" id="5603369">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603373">if</span>&nbsp;<span class="ident" id="5603376"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603380">&gt;=</span>&nbsp;<span class="ident" id="5603383"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603393">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603407">if</span>&nbsp;<span class="ident" id="5603410"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603414">&lt;</span>&nbsp;<span class="ident" id="5603416"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603421">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603425"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603430">=</span>&nbsp;<span class="ident" id="5603432"><a href="/image/png/writer.go.html#5603011">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603438"><a href="/image/png/writer.go.html#5603119">filter</a></span>&nbsp;<span class="op" id="5603445">=</span>&nbsp;<span class="ident" id="5603447"><a href="/image/png/reader.go.html#5578671">ftPaeth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603460">//&nbsp;The&nbsp;none&nbsp;filter.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603481"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603485">=</span>&nbsp;<span class="num" id="5603487">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603490">for</span>&nbsp;<span class="ident" id="5603494">i</span>&nbsp;<span class="op" id="5603496">:=</span>&nbsp;<span class="num" id="5603499">0</span><span class="op" id="5603500">;</span>&nbsp;<span class="ident" id="5603502"><a href="/image/png/writer.go.html#5603494">i</a></span>&nbsp;<span class="op" id="5603504">&lt;</span>&nbsp;<span class="ident" id="5603506"><a href="/image/png/writer.go.html#5602974">n</a></span><span class="op" id="5603507">;</span>&nbsp;<span class="ident" id="5603509"><a href="/image/png/writer.go.html#5603494">i</a></span><span class="op" id="5603510">++</span>&nbsp;<span class="op" id="5603513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603517"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603521">+=</span>&nbsp;<span class="ident" id="5603524"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603528">(</span><span class="ident" id="5603529"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603534">[</span><span class="ident" id="5603535"><a href="/image/png/writer.go.html#5603494">i</a></span><span class="op" id="5603536">]</span><span class="op" id="5603537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603541">if</span>&nbsp;<span class="ident" id="5603544"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603548">&gt;=</span>&nbsp;<span class="ident" id="5603551"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603561">break</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603575">if</span>&nbsp;<span class="ident" id="5603578"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603582">&lt;</span>&nbsp;<span class="ident" id="5603584"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603593"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603598">=</span>&nbsp;<span class="ident" id="5603600"><a href="/image/png/writer.go.html#5603011">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603606"><a href="/image/png/writer.go.html#5603119">filter</a></span>&nbsp;<span class="op" id="5603613">=</span>&nbsp;<span class="ident" id="5603615"><a href="/image/png/reader.go.html#5578611">ftNone</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603627">//&nbsp;The&nbsp;sub&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603647"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603651">=</span>&nbsp;<span class="num" id="5603653">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603656">for</span>&nbsp;<span class="ident" id="5603660">i</span>&nbsp;<span class="op" id="5603662">:=</span>&nbsp;<span class="num" id="5603665">0</span><span class="op" id="5603666">;</span>&nbsp;<span class="ident" id="5603668"><a href="/image/png/writer.go.html#5603660">i</a></span>&nbsp;<span class="op" id="5603670">&lt;</span>&nbsp;<span class="ident" id="5603672"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603675">;</span>&nbsp;<span class="ident" id="5603677"><a href="/image/png/writer.go.html#5603660">i</a></span><span class="op" id="5603678">++</span>&nbsp;<span class="op" id="5603681">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603685"><a href="/image/png/writer.go.html#5602878">cdat1</a></span><span class="op" id="5603690">[</span><span class="ident" id="5603691"><a href="/image/png/writer.go.html#5603660">i</a></span><span class="op" id="5603692">]</span>&nbsp;<span class="op" id="5603694">=</span>&nbsp;<span class="ident" id="5603696"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603701">[</span><span class="ident" id="5603702"><a href="/image/png/writer.go.html#5603660">i</a></span><span class="op" id="5603703">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603707"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603711">+=</span>&nbsp;<span class="ident" id="5603714"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603718">(</span><span class="ident" id="5603719"><a href="/image/png/writer.go.html#5602878">cdat1</a></span><span class="op" id="5603724">[</span><span class="ident" id="5603725"><a href="/image/png/writer.go.html#5603660">i</a></span><span class="op" id="5603726">]</span><span class="op" id="5603727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603733">for</span>&nbsp;<span class="ident" id="5603737">i</span>&nbsp;<span class="op" id="5603739">:=</span>&nbsp;<span class="ident" id="5603742"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603745">;</span>&nbsp;<span class="ident" id="5603747"><a href="/image/png/writer.go.html#5603737">i</a></span>&nbsp;<span class="op" id="5603749">&lt;</span>&nbsp;<span class="ident" id="5603751"><a href="/image/png/writer.go.html#5602974">n</a></span><span class="op" id="5603752">;</span>&nbsp;<span class="ident" id="5603754"><a href="/image/png/writer.go.html#5603737">i</a></span><span class="op" id="5603755">++</span>&nbsp;<span class="op" id="5603758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603762"><a href="/image/png/writer.go.html#5602878">cdat1</a></span><span class="op" id="5603767">[</span><span class="ident" id="5603768"><a href="/image/png/writer.go.html#5603737">i</a></span><span class="op" id="5603769">]</span>&nbsp;<span class="op" id="5603771">=</span>&nbsp;<span class="ident" id="5603773"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603778">[</span><span class="ident" id="5603779"><a href="/image/png/writer.go.html#5603737">i</a></span><span class="op" id="5603780">]</span>&nbsp;<span class="op" id="5603782">-</span>&nbsp;<span class="ident" id="5603784"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603789">[</span><span class="ident" id="5603790"><a href="/image/png/writer.go.html#5603737">i</a></span><span class="op" id="5603791">-</span><span class="ident" id="5603792"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603795">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603799"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603803">+=</span>&nbsp;<span class="ident" id="5603806"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5603810">(</span><span class="ident" id="5603811"><a href="/image/png/writer.go.html#5602878">cdat1</a></span><span class="op" id="5603816">[</span><span class="ident" id="5603817"><a href="/image/png/writer.go.html#5603737">i</a></span><span class="op" id="5603818">]</span><span class="op" id="5603819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603823">if</span>&nbsp;<span class="ident" id="5603826"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603830">&gt;=</span>&nbsp;<span class="ident" id="5603833"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603843">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603854">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603857">if</span>&nbsp;<span class="ident" id="5603860"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603864">&lt;</span>&nbsp;<span class="ident" id="5603866"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603875"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5603880">=</span>&nbsp;<span class="ident" id="5603882"><a href="/image/png/writer.go.html#5603011">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603888"><a href="/image/png/writer.go.html#5603119">filter</a></span>&nbsp;<span class="op" id="5603895">=</span>&nbsp;<span class="ident" id="5603897"><a href="/image/png/reader.go.html#5578626">ftSub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603908">//&nbsp;The&nbsp;average&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603932"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5603936">=</span>&nbsp;<span class="num" id="5603938">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603941">for</span>&nbsp;<span class="ident" id="5603945">i</span>&nbsp;<span class="op" id="5603947">:=</span>&nbsp;<span class="num" id="5603950">0</span><span class="op" id="5603951">;</span>&nbsp;<span class="ident" id="5603953"><a href="/image/png/writer.go.html#5603945">i</a></span>&nbsp;<span class="op" id="5603955">&lt;</span>&nbsp;<span class="ident" id="5603957"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5603960">;</span>&nbsp;<span class="ident" id="5603962"><a href="/image/png/writer.go.html#5603945">i</a></span><span class="op" id="5603963">++</span>&nbsp;<span class="op" id="5603966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603970"><a href="/image/png/writer.go.html#5602918">cdat3</a></span><span class="op" id="5603975">[</span><span class="ident" id="5603976"><a href="/image/png/writer.go.html#5603945">i</a></span><span class="op" id="5603977">]</span>&nbsp;<span class="op" id="5603979">=</span>&nbsp;<span class="ident" id="5603981"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5603986">[</span><span class="ident" id="5603987"><a href="/image/png/writer.go.html#5603945">i</a></span><span class="op" id="5603988">]</span>&nbsp;<span class="op" id="5603990">-</span>&nbsp;<span class="ident" id="5603992"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5603996">[</span><span class="ident" id="5603997"><a href="/image/png/writer.go.html#5603945">i</a></span><span class="op" id="5603998">]</span><span class="op" id="5603999">/</span><span class="num" id="5604000">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604004"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5604008">+=</span>&nbsp;<span class="ident" id="5604011"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5604015">(</span><span class="ident" id="5604016"><a href="/image/png/writer.go.html#5602918">cdat3</a></span><span class="op" id="5604021">[</span><span class="ident" id="5604022"><a href="/image/png/writer.go.html#5603945">i</a></span><span class="op" id="5604023">]</span><span class="op" id="5604024">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604030">for</span>&nbsp;<span class="ident" id="5604034">i</span>&nbsp;<span class="op" id="5604036">:=</span>&nbsp;<span class="ident" id="5604039"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5604042">;</span>&nbsp;<span class="ident" id="5604044"><a href="/image/png/writer.go.html#5604034">i</a></span>&nbsp;<span class="op" id="5604046">&lt;</span>&nbsp;<span class="ident" id="5604048"><a href="/image/png/writer.go.html#5602974">n</a></span><span class="op" id="5604049">;</span>&nbsp;<span class="ident" id="5604051"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604052">++</span>&nbsp;<span class="op" id="5604055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604059"><a href="/image/png/writer.go.html#5602918">cdat3</a></span><span class="op" id="5604064">[</span><span class="ident" id="5604065"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604066">]</span>&nbsp;<span class="op" id="5604068">=</span>&nbsp;<span class="ident" id="5604070"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5604075">[</span><span class="ident" id="5604076"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604077">]</span>&nbsp;<span class="op" id="5604079">-</span>&nbsp;<span class="builtintype" id="5604081">uint8</span><span class="op" id="5604086">(</span><span class="op" id="5604087">(</span><span class="builtintype" id="5604088">int</span><span class="op" id="5604091">(</span><span class="ident" id="5604092"><a href="/image/png/writer.go.html#5602858">cdat0</a></span><span class="op" id="5604097">[</span><span class="ident" id="5604098"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604099">-</span><span class="ident" id="5604100"><a href="/image/png/writer.go.html#5602478">bpp</a></span><span class="op" id="5604103">]</span><span class="op" id="5604104">)</span><span class="op" id="5604105">+</span><span class="builtintype" id="5604106">int</span><span class="op" id="5604109">(</span><span class="ident" id="5604110"><a href="/image/png/writer.go.html#5602958">pdat</a></span><span class="op" id="5604114">[</span><span class="ident" id="5604115"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604116">]</span><span class="op" id="5604117">)</span><span class="op" id="5604118">)</span><span class="op" id="5604119">/</span><span class="num" id="5604120">2</span><span class="op" id="5604121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604125"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5604129">+=</span>&nbsp;<span class="ident" id="5604132"><a href="/image/png/writer.go.html#5599848">abs8</a></span><span class="op" id="5604136">(</span><span class="ident" id="5604137"><a href="/image/png/writer.go.html#5602918">cdat3</a></span><span class="op" id="5604142">[</span><span class="ident" id="5604143"><a href="/image/png/writer.go.html#5604034">i</a></span><span class="op" id="5604144">]</span><span class="op" id="5604145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604149">if</span>&nbsp;<span class="ident" id="5604152"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5604156">&gt;=</span>&nbsp;<span class="ident" id="5604159"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5604164">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604169">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604183">if</span>&nbsp;<span class="ident" id="5604186"><a href="/image/png/writer.go.html#5603011">sum</a></span>&nbsp;<span class="op" id="5604190">&lt;</span>&nbsp;<span class="ident" id="5604192"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5604197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604201"><a href="/image/png/writer.go.html#5603106">best</a></span>&nbsp;<span class="op" id="5604206">=</span>&nbsp;<span class="ident" id="5604208"><a href="/image/png/writer.go.html#5603011">sum</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604214"><a href="/image/png/writer.go.html#5603119">filter</a></span>&nbsp;<span class="op" id="5604221">=</span>&nbsp;<span class="ident" id="5604223"><a href="/image/png/reader.go.html#5578656">ftAverage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604238">return</span>&nbsp;<span class="ident" id="5604245"><a href="/image/png/writer.go.html#5603119">filter</a></span><br>
<span class="lineno"></span><span class="op" id="5604252">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="5604255">func</span>&nbsp;<span class="ident" id="5604260">writeImage</span><span class="op" id="5604270">(</span><span class="ident" id="5604271">w</span>&nbsp;<span class="ident" id="5604273"><a href="/image/png/writer.go.html#5598633">io</a></span><span class="op" id="5604275">.</span><span class="ident" id="5604276">Writer</span><span class="op" id="5604282">,</span>&nbsp;<span class="ident" id="5604284">m</span>&nbsp;<span class="ident" id="5604286"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5604291">.</span><span class="ident" id="5604292">Image</span><span class="op" id="5604297">,</span>&nbsp;<span class="ident" id="5604299">cb</span>&nbsp;<span class="builtintype" id="5604302">int</span><span class="op" id="5604305">,</span>&nbsp;<span class="ident" id="5604307">level</span>&nbsp;<span class="builtintype" id="5604313">int</span><span class="op" id="5604316">)</span>&nbsp;<span class="builtintype" id="5604318">error</span>&nbsp;<span class="op" id="5604324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604327">zw</span><span class="op" id="5604329">,</span>&nbsp;<span class="ident" id="5604331">err</span>&nbsp;<span class="op" id="5604335">:=</span>&nbsp;<span class="ident" id="5604338"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5604342">.</span><span class="ident" id="5604343">NewWriterLevel</span><span class="op" id="5604357">(</span><span class="ident" id="5604358"><a href="/image/png/writer.go.html#5604271">w</a></span><span class="op" id="5604359">,</span>&nbsp;<span class="ident" id="5604361"><a href="/image/png/writer.go.html#5604307">level</a></span><span class="op" id="5604366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604369">if</span>&nbsp;<span class="ident" id="5604372"><a href="/image/png/writer.go.html#5604331">err</a></span>&nbsp;<span class="op" id="5604376">!=</span>&nbsp;<span class="ident" id="5604379">nil</span>&nbsp;<span class="op" id="5604383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604387">return</span>&nbsp;<span class="ident" id="5604394"><a href="/image/png/writer.go.html#5604331">err</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604402">defer</span>&nbsp;<span class="ident" id="5604408"><a href="/image/png/writer.go.html#5604327">zw</a></span><span class="op" id="5604410">.</span><span class="ident" id="5604411">Close</span><span class="op" id="5604416">(</span><span class="op" id="5604417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604421">bpp</span>&nbsp;<span class="op" id="5604425">:=</span>&nbsp;<span class="num" id="5604428">0</span>&nbsp;<span class="comment" id="5604430">//&nbsp;Bytes&nbsp;per&nbsp;pixel.</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604452">switch</span>&nbsp;<span class="ident" id="5604459"><a href="/image/png/writer.go.html#5604299">cb</a></span>&nbsp;<span class="op" id="5604462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604465">case</span>&nbsp;<span class="ident" id="5604470"><a href="/image/png/reader.go.html#5578479">cbG8</a></span><span class="op" id="5604474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604478"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604482">=</span>&nbsp;<span class="num" id="5604484">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604487">case</span>&nbsp;<span class="ident" id="5604492"><a href="/image/png/reader.go.html#5578492">cbTC8</a></span><span class="op" id="5604497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604501"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604505">=</span>&nbsp;<span class="num" id="5604507">3</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604510">case</span>&nbsp;<span class="ident" id="5604515"><a href="/image/png/reader.go.html#5578517">cbP8</a></span><span class="op" id="5604519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604523"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604527">=</span>&nbsp;<span class="num" id="5604529">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604532">case</span>&nbsp;<span class="ident" id="5604537"><a href="/image/png/reader.go.html#5578523">cbTCA8</a></span><span class="op" id="5604543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604547"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604551">=</span>&nbsp;<span class="num" id="5604553">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604556">case</span>&nbsp;<span class="ident" id="5604561"><a href="/image/png/reader.go.html#5578546">cbTC16</a></span><span class="op" id="5604567">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604571"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604575">=</span>&nbsp;<span class="num" id="5604577">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604580">case</span>&nbsp;<span class="ident" id="5604585"><a href="/image/png/reader.go.html#5578554">cbTCA16</a></span><span class="op" id="5604592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604596"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604600">=</span>&nbsp;<span class="num" id="5604602">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604605">case</span>&nbsp;<span class="ident" id="5604610"><a href="/image/png/reader.go.html#5578531">cbG16</a></span><span class="op" id="5604615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604619"><a href="/image/png/writer.go.html#5604421">bpp</a></span>&nbsp;<span class="op" id="5604623">=</span>&nbsp;<span class="num" id="5604625">2</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604631">//&nbsp;cr[*]&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604696">//&nbsp;cr[0]&nbsp;is&nbsp;unfiltered&nbsp;(or&nbsp;equivalently,&nbsp;filtered&nbsp;with&nbsp;the&nbsp;ftNone&nbsp;filter).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604772">//&nbsp;cr[ft],&nbsp;for&nbsp;non-zero&nbsp;filter&nbsp;types&nbsp;ft,&nbsp;are&nbsp;buffers&nbsp;for&nbsp;transforming&nbsp;cr[0]&nbsp;under&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604859">//&nbsp;other&nbsp;PNG&nbsp;filter&nbsp;types.&nbsp;These&nbsp;buffers&nbsp;are&nbsp;allocated&nbsp;once&nbsp;and&nbsp;re-used&nbsp;for&nbsp;each&nbsp;row.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604946">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[*][0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605011">b</span>&nbsp;<span class="op" id="5605013">:=</span>&nbsp;<span class="ident" id="5605016"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605017">.</span><span class="ident" id="5605018">Bounds</span><span class="op" id="5605024">(</span><span class="op" id="5605025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605028">var</span>&nbsp;<span class="ident" id="5605032">cr</span>&nbsp;<span class="op" id="5605035">[</span><span class="ident" id="5605036"><a href="/image/png/reader.go.html#5578686">nFilter</a></span><span class="op" id="5605043">]</span><span class="op" id="5605044">[</span><span class="op" id="5605045">]</span><span class="builtintype" id="5605046">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605053">for</span>&nbsp;<span class="ident" id="5605057">i</span>&nbsp;<span class="op" id="5605059">:=</span>&nbsp;<span class="keyword" id="5605062">range</span>&nbsp;<span class="ident" id="5605068"><a href="/image/png/writer.go.html#5605032">cr</a></span>&nbsp;<span class="op" id="5605071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605075"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5605077">[</span><span class="ident" id="5605078"><a href="/image/png/writer.go.html#5605057">i</a></span><span class="op" id="5605079">]</span>&nbsp;<span class="op" id="5605081">=</span>&nbsp;<span class="builtinfunc" id="5605083">make</span><span class="op" id="5605087">(</span><span class="op" id="5605088">[</span><span class="op" id="5605089">]</span><span class="builtintype" id="5605090">uint8</span><span class="op" id="5605095">,</span>&nbsp;<span class="num" id="5605097">1</span><span class="op" id="5605098">+</span><span class="ident" id="5605099"><a href="/image/png/writer.go.html#5604421">bpp</a></span><span class="op" id="5605102">*</span><span class="ident" id="5605103"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605104">.</span><span class="ident" id="5605105">Dx</span><span class="op" id="5605107">(</span><span class="op" id="5605108">)</span><span class="op" id="5605109">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605113"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5605115">[</span><span class="ident" id="5605116"><a href="/image/png/writer.go.html#5605057">i</a></span><span class="op" id="5605117">]</span><span class="op" id="5605118">[</span><span class="num" id="5605119">0</span><span class="op" id="5605120">]</span>&nbsp;<span class="op" id="5605122">=</span>&nbsp;<span class="builtintype" id="5605124">uint8</span><span class="op" id="5605129">(</span><span class="ident" id="5605130"><a href="/image/png/writer.go.html#5605057">i</a></span><span class="op" id="5605131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605137">pr</span>&nbsp;<span class="op" id="5605140">:=</span>&nbsp;<span class="builtinfunc" id="5605143">make</span><span class="op" id="5605147">(</span><span class="op" id="5605148">[</span><span class="op" id="5605149">]</span><span class="builtintype" id="5605150">uint8</span><span class="op" id="5605155">,</span>&nbsp;<span class="num" id="5605157">1</span><span class="op" id="5605158">+</span><span class="ident" id="5605159"><a href="/image/png/writer.go.html#5604421">bpp</a></span><span class="op" id="5605162">*</span><span class="ident" id="5605163"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605164">.</span><span class="ident" id="5605165">Dx</span><span class="op" id="5605167">(</span><span class="op" id="5605168">)</span><span class="op" id="5605169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605173">gray</span><span class="op" id="5605177">,</span>&nbsp;<span class="ident" id="5605179">_</span>&nbsp;<span class="op" id="5605181">:=</span>&nbsp;<span class="ident" id="5605184"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605185">.</span><span class="op" id="5605186">(</span><span class="op" id="5605187">*</span><span class="ident" id="5605188"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5605193">.</span><span class="ident" id="5605194">Gray</span><span class="op" id="5605198">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605201">rgba</span><span class="op" id="5605205">,</span>&nbsp;<span class="ident" id="5605207">_</span>&nbsp;<span class="op" id="5605209">:=</span>&nbsp;<span class="ident" id="5605212"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605213">.</span><span class="op" id="5605214">(</span><span class="op" id="5605215">*</span><span class="ident" id="5605216"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5605221">.</span><span class="ident" id="5605222">RGBA</span><span class="op" id="5605226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605229">paletted</span><span class="op" id="5605237">,</span>&nbsp;<span class="ident" id="5605239">_</span>&nbsp;<span class="op" id="5605241">:=</span>&nbsp;<span class="ident" id="5605244"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605245">.</span><span class="op" id="5605246">(</span><span class="op" id="5605247">*</span><span class="ident" id="5605248"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5605253">.</span><span class="ident" id="5605254">Paletted</span><span class="op" id="5605262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605265">nrgba</span><span class="op" id="5605270">,</span>&nbsp;<span class="ident" id="5605272">_</span>&nbsp;<span class="op" id="5605274">:=</span>&nbsp;<span class="ident" id="5605277"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605278">.</span><span class="op" id="5605279">(</span><span class="op" id="5605280">*</span><span class="ident" id="5605281"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5605286">.</span><span class="ident" id="5605287">NRGBA</span><span class="op" id="5605292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605296">for</span>&nbsp;<span class="ident" id="5605300">y</span>&nbsp;<span class="op" id="5605302">:=</span>&nbsp;<span class="ident" id="5605305"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605306">.</span><span class="ident" id="5605307">Min</span><span class="op" id="5605310">.</span><span class="ident" id="5605311">Y</span><span class="op" id="5605312">;</span>&nbsp;<span class="ident" id="5605314"><a href="/image/png/writer.go.html#5605300">y</a></span>&nbsp;<span class="op" id="5605316">&lt;</span>&nbsp;<span class="ident" id="5605318"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605319">.</span><span class="ident" id="5605320">Max</span><span class="op" id="5605323">.</span><span class="ident" id="5605324">Y</span><span class="op" id="5605325">;</span>&nbsp;<span class="ident" id="5605327"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5605328">++</span>&nbsp;<span class="op" id="5605331">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5605335">//&nbsp;Convert&nbsp;from&nbsp;colors&nbsp;to&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605370">i</span>&nbsp;<span class="op" id="5605372">:=</span>&nbsp;<span class="num" id="5605375">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605379">switch</span>&nbsp;<span class="ident" id="5605386"><a href="/image/png/writer.go.html#5604299">cb</a></span>&nbsp;<span class="op" id="5605389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605393">case</span>&nbsp;<span class="ident" id="5605398"><a href="/image/png/reader.go.html#5578479">cbG8</a></span><span class="op" id="5605402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605407">if</span>&nbsp;<span class="ident" id="5605410"><a href="/image/png/writer.go.html#5605173">gray</a></span>&nbsp;<span class="op" id="5605415">!=</span>&nbsp;<span class="ident" id="5605418">nil</span>&nbsp;<span class="op" id="5605422">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605428">offset</span>&nbsp;<span class="op" id="5605435">:=</span>&nbsp;<span class="op" id="5605438">(</span><span class="ident" id="5605439"><a href="/image/png/writer.go.html#5605300">y</a></span>&nbsp;<span class="op" id="5605441">-</span>&nbsp;<span class="ident" id="5605443"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605444">.</span><span class="ident" id="5605445">Min</span><span class="op" id="5605448">.</span><span class="ident" id="5605449">Y</span><span class="op" id="5605450">)</span>&nbsp;<span class="op" id="5605452">*</span>&nbsp;<span class="ident" id="5605454"><a href="/image/png/writer.go.html#5605173">gray</a></span><span class="op" id="5605458">.</span><span class="ident" id="5605459">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5605470">copy</span><span class="op" id="5605474">(</span><span class="ident" id="5605475"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5605477">[</span><span class="num" id="5605478">0</span><span class="op" id="5605479">]</span><span class="op" id="5605480">[</span><span class="num" id="5605481">1</span><span class="op" id="5605482">:</span><span class="op" id="5605483">]</span><span class="op" id="5605484">,</span>&nbsp;<span class="ident" id="5605486"><a href="/image/png/writer.go.html#5605173">gray</a></span><span class="op" id="5605490">.</span><span class="ident" id="5605491">Pix</span><span class="op" id="5605494">[</span><span class="ident" id="5605495"><a href="/image/png/writer.go.html#5605428">offset</a></span><span class="op" id="5605501">:</span><span class="ident" id="5605502"><a href="/image/png/writer.go.html#5605428">offset</a></span><span class="op" id="5605508">+</span><span class="ident" id="5605509"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605510">.</span><span class="ident" id="5605511">Dx</span><span class="op" id="5605513">(</span><span class="op" id="5605514">)</span><span class="op" id="5605515">]</span><span class="op" id="5605516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605521">}</span>&nbsp;<span class="keyword" id="5605523">else</span>&nbsp;<span class="op" id="5605528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605534">for</span>&nbsp;<span class="ident" id="5605538">x</span>&nbsp;<span class="op" id="5605540">:=</span>&nbsp;<span class="ident" id="5605543"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605544">.</span><span class="ident" id="5605545">Min</span><span class="op" id="5605548">.</span><span class="ident" id="5605549">X</span><span class="op" id="5605550">;</span>&nbsp;<span class="ident" id="5605552"><a href="/image/png/writer.go.html#5605538">x</a></span>&nbsp;<span class="op" id="5605554">&lt;</span>&nbsp;<span class="ident" id="5605556"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605557">.</span><span class="ident" id="5605558">Max</span><span class="op" id="5605561">.</span><span class="ident" id="5605562">X</span><span class="op" id="5605563">;</span>&nbsp;<span class="ident" id="5605565"><a href="/image/png/writer.go.html#5605538">x</a></span><span class="op" id="5605566">++</span>&nbsp;<span class="op" id="5605569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605576">c</span>&nbsp;<span class="op" id="5605578">:=</span>&nbsp;<span class="ident" id="5605581"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5605586">.</span><span class="ident" id="5605587">GrayModel</span><span class="op" id="5605596">.</span><span class="ident" id="5605597">Convert</span><span class="op" id="5605604">(</span><span class="ident" id="5605605"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5605606">.</span><span class="ident" id="5605607">At</span><span class="op" id="5605609">(</span><span class="ident" id="5605610"><a href="/image/png/writer.go.html#5605538">x</a></span><span class="op" id="5605611">,</span>&nbsp;<span class="ident" id="5605613"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5605614">)</span><span class="op" id="5605615">)</span><span class="op" id="5605616">.</span><span class="op" id="5605617">(</span><span class="ident" id="5605618"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5605623">.</span><span class="ident" id="5605624">Gray</span><span class="op" id="5605628">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605635"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5605637">[</span><span class="num" id="5605638">0</span><span class="op" id="5605639">]</span><span class="op" id="5605640">[</span><span class="ident" id="5605641"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5605642">]</span>&nbsp;<span class="op" id="5605644">=</span>&nbsp;<span class="ident" id="5605646"><a href="/image/png/writer.go.html#5605576">c</a></span><span class="op" id="5605647">.</span><span class="ident" id="5605648">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605655"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5605656">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605672">case</span>&nbsp;<span class="ident" id="5605677"><a href="/image/png/reader.go.html#5578492">cbTC8</a></span><span class="op" id="5605682">:</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5605687">//&nbsp;We&nbsp;have&nbsp;previously&nbsp;verified&nbsp;that&nbsp;the&nbsp;alpha&nbsp;value&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605759">cr0</span>&nbsp;<span class="op" id="5605763">:=</span>&nbsp;<span class="ident" id="5605766"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5605768">[</span><span class="num" id="5605769">0</span><span class="op" id="5605770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605775">stride</span><span class="op" id="5605781">,</span>&nbsp;<span class="ident" id="5605783">pix</span>&nbsp;<span class="op" id="5605787">:=</span>&nbsp;<span class="num" id="5605790">0</span><span class="op" id="5605791">,</span>&nbsp;<span class="op" id="5605793">[</span><span class="op" id="5605794">]</span><span class="builtintype" id="5605795">byte</span><span class="op" id="5605799">(</span><span class="ident" id="5605800">nil</span><span class="op" id="5605803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605808">if</span>&nbsp;<span class="ident" id="5605811"><a href="/image/png/writer.go.html#5605201">rgba</a></span>&nbsp;<span class="op" id="5605816">!=</span>&nbsp;<span class="ident" id="5605819">nil</span>&nbsp;<span class="op" id="5605823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605829"><a href="/image/png/writer.go.html#5605775">stride</a></span><span class="op" id="5605835">,</span>&nbsp;<span class="ident" id="5605837"><a href="/image/png/writer.go.html#5605783">pix</a></span>&nbsp;<span class="op" id="5605841">=</span>&nbsp;<span class="ident" id="5605843"><a href="/image/png/writer.go.html#5605201">rgba</a></span><span class="op" id="5605847">.</span><span class="ident" id="5605848">Stride</span><span class="op" id="5605854">,</span>&nbsp;<span class="ident" id="5605856"><a href="/image/png/writer.go.html#5605201">rgba</a></span><span class="op" id="5605860">.</span><span class="ident" id="5605861">Pix</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605868">}</span>&nbsp;<span class="keyword" id="5605870">else</span>&nbsp;<span class="keyword" id="5605875">if</span>&nbsp;<span class="ident" id="5605878"><a href="/image/png/writer.go.html#5605265">nrgba</a></span>&nbsp;<span class="op" id="5605884">!=</span>&nbsp;<span class="ident" id="5605887">nil</span>&nbsp;<span class="op" id="5605891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605897"><a href="/image/png/writer.go.html#5605775">stride</a></span><span class="op" id="5605903">,</span>&nbsp;<span class="ident" id="5605905"><a href="/image/png/writer.go.html#5605783">pix</a></span>&nbsp;<span class="op" id="5605909">=</span>&nbsp;<span class="ident" id="5605911"><a href="/image/png/writer.go.html#5605265">nrgba</a></span><span class="op" id="5605916">.</span><span class="ident" id="5605917">Stride</span><span class="op" id="5605923">,</span>&nbsp;<span class="ident" id="5605925"><a href="/image/png/writer.go.html#5605265">nrgba</a></span><span class="op" id="5605930">.</span><span class="ident" id="5605931">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605943">if</span>&nbsp;<span class="ident" id="5605946"><a href="/image/png/writer.go.html#5605775">stride</a></span>&nbsp;<span class="op" id="5605953">!=</span>&nbsp;<span class="num" id="5605956">0</span>&nbsp;<span class="op" id="5605958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605964">j0</span>&nbsp;<span class="op" id="5605967">:=</span>&nbsp;<span class="op" id="5605970">(</span><span class="ident" id="5605971"><a href="/image/png/writer.go.html#5605300">y</a></span>&nbsp;<span class="op" id="5605973">-</span>&nbsp;<span class="ident" id="5605975"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5605976">.</span><span class="ident" id="5605977">Min</span><span class="op" id="5605980">.</span><span class="ident" id="5605981">Y</span><span class="op" id="5605982">)</span>&nbsp;<span class="op" id="5605984">*</span>&nbsp;<span class="ident" id="5605986"><a href="/image/png/writer.go.html#5605775">stride</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605997">j1</span>&nbsp;<span class="op" id="5606000">:=</span>&nbsp;<span class="ident" id="5606003"><a href="/image/png/writer.go.html#5605964">j0</a></span>&nbsp;<span class="op" id="5606006">+</span>&nbsp;<span class="ident" id="5606008"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606009">.</span><span class="ident" id="5606010">Dx</span><span class="op" id="5606012">(</span><span class="op" id="5606013">)</span><span class="op" id="5606014">*</span><span class="num" id="5606015">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606021">for</span>&nbsp;<span class="ident" id="5606025">j</span>&nbsp;<span class="op" id="5606027">:=</span>&nbsp;<span class="ident" id="5606030"><a href="/image/png/writer.go.html#5605964">j0</a></span><span class="op" id="5606032">;</span>&nbsp;<span class="ident" id="5606034"><a href="/image/png/writer.go.html#5606025">j</a></span>&nbsp;<span class="op" id="5606036">&lt;</span>&nbsp;<span class="ident" id="5606038"><a href="/image/png/writer.go.html#5605997">j1</a></span><span class="op" id="5606040">;</span>&nbsp;<span class="ident" id="5606042"><a href="/image/png/writer.go.html#5606025">j</a></span>&nbsp;<span class="op" id="5606044">+=</span>&nbsp;<span class="num" id="5606047">4</span>&nbsp;<span class="op" id="5606049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606056"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606059">[</span><span class="ident" id="5606060"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606061">+</span><span class="num" id="5606062">0</span><span class="op" id="5606063">]</span>&nbsp;<span class="op" id="5606065">=</span>&nbsp;<span class="ident" id="5606067"><a href="/image/png/writer.go.html#5605783">pix</a></span><span class="op" id="5606070">[</span><span class="ident" id="5606071"><a href="/image/png/writer.go.html#5606025">j</a></span><span class="op" id="5606072">+</span><span class="num" id="5606073">0</span><span class="op" id="5606074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606081"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606084">[</span><span class="ident" id="5606085"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606086">+</span><span class="num" id="5606087">1</span><span class="op" id="5606088">]</span>&nbsp;<span class="op" id="5606090">=</span>&nbsp;<span class="ident" id="5606092"><a href="/image/png/writer.go.html#5605783">pix</a></span><span class="op" id="5606095">[</span><span class="ident" id="5606096"><a href="/image/png/writer.go.html#5606025">j</a></span><span class="op" id="5606097">+</span><span class="num" id="5606098">1</span><span class="op" id="5606099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606106"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606109">[</span><span class="ident" id="5606110"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606111">+</span><span class="num" id="5606112">2</span><span class="op" id="5606113">]</span>&nbsp;<span class="op" id="5606115">=</span>&nbsp;<span class="ident" id="5606117"><a href="/image/png/writer.go.html#5605783">pix</a></span><span class="op" id="5606120">[</span><span class="ident" id="5606121"><a href="/image/png/writer.go.html#5606025">j</a></span><span class="op" id="5606122">+</span><span class="num" id="5606123">2</span><span class="op" id="5606124">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606131"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5606133">+=</span>&nbsp;<span class="num" id="5606136">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606147">}</span>&nbsp;<span class="keyword" id="5606149">else</span>&nbsp;<span class="op" id="5606154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606160">for</span>&nbsp;<span class="ident" id="5606164">x</span>&nbsp;<span class="op" id="5606166">:=</span>&nbsp;<span class="ident" id="5606169"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606170">.</span><span class="ident" id="5606171">Min</span><span class="op" id="5606174">.</span><span class="ident" id="5606175">X</span><span class="op" id="5606176">;</span>&nbsp;<span class="ident" id="5606178"><a href="/image/png/writer.go.html#5606164">x</a></span>&nbsp;<span class="op" id="5606180">&lt;</span>&nbsp;<span class="ident" id="5606182"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606183">.</span><span class="ident" id="5606184">Max</span><span class="op" id="5606187">.</span><span class="ident" id="5606188">X</span><span class="op" id="5606189">;</span>&nbsp;<span class="ident" id="5606191"><a href="/image/png/writer.go.html#5606164">x</a></span><span class="op" id="5606192">++</span>&nbsp;<span class="op" id="5606195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606202">r</span><span class="op" id="5606203">,</span>&nbsp;<span class="ident" id="5606205">g</span><span class="op" id="5606206">,</span>&nbsp;<span class="ident" id="5606208">b</span><span class="op" id="5606209">,</span>&nbsp;<span class="ident" id="5606211">_</span>&nbsp;<span class="op" id="5606213">:=</span>&nbsp;<span class="ident" id="5606216"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5606217">.</span><span class="ident" id="5606218">At</span><span class="op" id="5606220">(</span><span class="ident" id="5606221"><a href="/image/png/writer.go.html#5606164">x</a></span><span class="op" id="5606222">,</span>&nbsp;<span class="ident" id="5606224"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5606225">)</span><span class="op" id="5606226">.</span><span class="ident" id="5606227">RGBA</span><span class="op" id="5606231">(</span><span class="op" id="5606232">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606239"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606242">[</span><span class="ident" id="5606243"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606244">+</span><span class="num" id="5606245">0</span><span class="op" id="5606246">]</span>&nbsp;<span class="op" id="5606248">=</span>&nbsp;<span class="builtintype" id="5606250">uint8</span><span class="op" id="5606255">(</span><span class="ident" id="5606256"><a href="/image/png/writer.go.html#5606202">r</a></span>&nbsp;<span class="op" id="5606258">&gt;&gt;</span>&nbsp;<span class="num" id="5606261">8</span><span class="op" id="5606262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606269"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606272">[</span><span class="ident" id="5606273"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606274">+</span><span class="num" id="5606275">1</span><span class="op" id="5606276">]</span>&nbsp;<span class="op" id="5606278">=</span>&nbsp;<span class="builtintype" id="5606280">uint8</span><span class="op" id="5606285">(</span><span class="ident" id="5606286"><a href="/image/png/writer.go.html#5606205">g</a></span>&nbsp;<span class="op" id="5606288">&gt;&gt;</span>&nbsp;<span class="num" id="5606291">8</span><span class="op" id="5606292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606299"><a href="/image/png/writer.go.html#5605759">cr0</a></span><span class="op" id="5606302">[</span><span class="ident" id="5606303"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606304">+</span><span class="num" id="5606305">2</span><span class="op" id="5606306">]</span>&nbsp;<span class="op" id="5606308">=</span>&nbsp;<span class="builtintype" id="5606310">uint8</span><span class="op" id="5606315">(</span><span class="ident" id="5606316"><a href="/image/png/writer.go.html#5606208">b</a></span>&nbsp;<span class="op" id="5606318">&gt;&gt;</span>&nbsp;<span class="num" id="5606321">8</span><span class="op" id="5606322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606329"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5606331">+=</span>&nbsp;<span class="num" id="5606334">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606340">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606349">case</span>&nbsp;<span class="ident" id="5606354"><a href="/image/png/reader.go.html#5578517">cbP8</a></span><span class="op" id="5606358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606363">if</span>&nbsp;<span class="ident" id="5606366"><a href="/image/png/writer.go.html#5605229">paletted</a></span>&nbsp;<span class="op" id="5606375">!=</span>&nbsp;<span class="ident" id="5606378">nil</span>&nbsp;<span class="op" id="5606382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606388">offset</span>&nbsp;<span class="op" id="5606395">:=</span>&nbsp;<span class="op" id="5606398">(</span><span class="ident" id="5606399"><a href="/image/png/writer.go.html#5605300">y</a></span>&nbsp;<span class="op" id="5606401">-</span>&nbsp;<span class="ident" id="5606403"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606404">.</span><span class="ident" id="5606405">Min</span><span class="op" id="5606408">.</span><span class="ident" id="5606409">Y</span><span class="op" id="5606410">)</span>&nbsp;<span class="op" id="5606412">*</span>&nbsp;<span class="ident" id="5606414"><a href="/image/png/writer.go.html#5605229">paletted</a></span><span class="op" id="5606422">.</span><span class="ident" id="5606423">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5606434">copy</span><span class="op" id="5606438">(</span><span class="ident" id="5606439"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5606441">[</span><span class="num" id="5606442">0</span><span class="op" id="5606443">]</span><span class="op" id="5606444">[</span><span class="num" id="5606445">1</span><span class="op" id="5606446">:</span><span class="op" id="5606447">]</span><span class="op" id="5606448">,</span>&nbsp;<span class="ident" id="5606450"><a href="/image/png/writer.go.html#5605229">paletted</a></span><span class="op" id="5606458">.</span><span class="ident" id="5606459">Pix</span><span class="op" id="5606462">[</span><span class="ident" id="5606463"><a href="/image/png/writer.go.html#5606388">offset</a></span><span class="op" id="5606469">:</span><span class="ident" id="5606470"><a href="/image/png/writer.go.html#5606388">offset</a></span><span class="op" id="5606476">+</span><span class="ident" id="5606477"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606478">.</span><span class="ident" id="5606479">Dx</span><span class="op" id="5606481">(</span><span class="op" id="5606482">)</span><span class="op" id="5606483">]</span><span class="op" id="5606484">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606489">}</span>&nbsp;<span class="keyword" id="5606491">else</span>&nbsp;<span class="op" id="5606496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606502">pi</span>&nbsp;<span class="op" id="5606505">:=</span>&nbsp;<span class="ident" id="5606508"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5606509">.</span><span class="op" id="5606510">(</span><span class="ident" id="5606511"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5606516">.</span><span class="ident" id="5606517">PalettedImage</span><span class="op" id="5606530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606536">for</span>&nbsp;<span class="ident" id="5606540">x</span>&nbsp;<span class="op" id="5606542">:=</span>&nbsp;<span class="ident" id="5606545"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606546">.</span><span class="ident" id="5606547">Min</span><span class="op" id="5606550">.</span><span class="ident" id="5606551">X</span><span class="op" id="5606552">;</span>&nbsp;<span class="ident" id="5606554"><a href="/image/png/writer.go.html#5606540">x</a></span>&nbsp;<span class="op" id="5606556">&lt;</span>&nbsp;<span class="ident" id="5606558"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606559">.</span><span class="ident" id="5606560">Max</span><span class="op" id="5606563">.</span><span class="ident" id="5606564">X</span><span class="op" id="5606565">;</span>&nbsp;<span class="ident" id="5606567"><a href="/image/png/writer.go.html#5606540">x</a></span><span class="op" id="5606568">++</span>&nbsp;<span class="op" id="5606571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606578"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5606580">[</span><span class="num" id="5606581">0</span><span class="op" id="5606582">]</span><span class="op" id="5606583">[</span><span class="ident" id="5606584"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606585">]</span>&nbsp;<span class="op" id="5606587">=</span>&nbsp;<span class="ident" id="5606589"><a href="/image/png/writer.go.html#5606502">pi</a></span><span class="op" id="5606591">.</span><span class="ident" id="5606592">ColorIndexAt</span><span class="op" id="5606604">(</span><span class="ident" id="5606605"><a href="/image/png/writer.go.html#5606540">x</a></span><span class="op" id="5606606">,</span>&nbsp;<span class="ident" id="5606608"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5606609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606616"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5606618">+=</span>&nbsp;<span class="num" id="5606621">1</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606636">case</span>&nbsp;<span class="ident" id="5606641"><a href="/image/png/reader.go.html#5578523">cbTCA8</a></span><span class="op" id="5606647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606652">if</span>&nbsp;<span class="ident" id="5606655"><a href="/image/png/writer.go.html#5605265">nrgba</a></span>&nbsp;<span class="op" id="5606661">!=</span>&nbsp;<span class="ident" id="5606664">nil</span>&nbsp;<span class="op" id="5606668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606674">offset</span>&nbsp;<span class="op" id="5606681">:=</span>&nbsp;<span class="op" id="5606684">(</span><span class="ident" id="5606685"><a href="/image/png/writer.go.html#5605300">y</a></span>&nbsp;<span class="op" id="5606687">-</span>&nbsp;<span class="ident" id="5606689"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606690">.</span><span class="ident" id="5606691">Min</span><span class="op" id="5606694">.</span><span class="ident" id="5606695">Y</span><span class="op" id="5606696">)</span>&nbsp;<span class="op" id="5606698">*</span>&nbsp;<span class="ident" id="5606700"><a href="/image/png/writer.go.html#5605265">nrgba</a></span><span class="op" id="5606705">.</span><span class="ident" id="5606706">Stride</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5606717">copy</span><span class="op" id="5606721">(</span><span class="ident" id="5606722"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5606724">[</span><span class="num" id="5606725">0</span><span class="op" id="5606726">]</span><span class="op" id="5606727">[</span><span class="num" id="5606728">1</span><span class="op" id="5606729">:</span><span class="op" id="5606730">]</span><span class="op" id="5606731">,</span>&nbsp;<span class="ident" id="5606733"><a href="/image/png/writer.go.html#5605265">nrgba</a></span><span class="op" id="5606738">.</span><span class="ident" id="5606739">Pix</span><span class="op" id="5606742">[</span><span class="ident" id="5606743"><a href="/image/png/writer.go.html#5606674">offset</a></span><span class="op" id="5606749">:</span><span class="ident" id="5606750"><a href="/image/png/writer.go.html#5606674">offset</a></span><span class="op" id="5606756">+</span><span class="ident" id="5606757"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606758">.</span><span class="ident" id="5606759">Dx</span><span class="op" id="5606761">(</span><span class="op" id="5606762">)</span><span class="op" id="5606763">*</span><span class="num" id="5606764">4</span><span class="op" id="5606765">]</span><span class="op" id="5606766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606771">}</span>&nbsp;<span class="keyword" id="5606773">else</span>&nbsp;<span class="op" id="5606778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606784">//&nbsp;Convert&nbsp;from&nbsp;image.Image&nbsp;(which&nbsp;is&nbsp;alpha-premultiplied)&nbsp;to&nbsp;PNG&#39;s&nbsp;non-alpha-premultiplied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606881">for</span>&nbsp;<span class="ident" id="5606885">x</span>&nbsp;<span class="op" id="5606887">:=</span>&nbsp;<span class="ident" id="5606890"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606891">.</span><span class="ident" id="5606892">Min</span><span class="op" id="5606895">.</span><span class="ident" id="5606896">X</span><span class="op" id="5606897">;</span>&nbsp;<span class="ident" id="5606899"><a href="/image/png/writer.go.html#5606885">x</a></span>&nbsp;<span class="op" id="5606901">&lt;</span>&nbsp;<span class="ident" id="5606903"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5606904">.</span><span class="ident" id="5606905">Max</span><span class="op" id="5606908">.</span><span class="ident" id="5606909">X</span><span class="op" id="5606910">;</span>&nbsp;<span class="ident" id="5606912"><a href="/image/png/writer.go.html#5606885">x</a></span><span class="op" id="5606913">++</span>&nbsp;<span class="op" id="5606916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606923">c</span>&nbsp;<span class="op" id="5606925">:=</span>&nbsp;<span class="ident" id="5606928"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5606933">.</span><span class="ident" id="5606934">NRGBAModel</span><span class="op" id="5606944">.</span><span class="ident" id="5606945">Convert</span><span class="op" id="5606952">(</span><span class="ident" id="5606953"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5606954">.</span><span class="ident" id="5606955">At</span><span class="op" id="5606957">(</span><span class="ident" id="5606958"><a href="/image/png/writer.go.html#5606885">x</a></span><span class="op" id="5606959">,</span>&nbsp;<span class="ident" id="5606961"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5606962">)</span><span class="op" id="5606963">)</span><span class="op" id="5606964">.</span><span class="op" id="5606965">(</span><span class="ident" id="5606966"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5606971">.</span><span class="ident" id="5606972">NRGBA</span><span class="op" id="5606977">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606984"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5606986">[</span><span class="num" id="5606987">0</span><span class="op" id="5606988">]</span><span class="op" id="5606989">[</span><span class="ident" id="5606990"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5606991">+</span><span class="num" id="5606992">0</span><span class="op" id="5606993">]</span>&nbsp;<span class="op" id="5606995">=</span>&nbsp;<span class="ident" id="5606997"><a href="/image/png/writer.go.html#5606923">c</a></span><span class="op" id="5606998">.</span><span class="ident" id="5606999">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607006"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607008">[</span><span class="num" id="5607009">0</span><span class="op" id="5607010">]</span><span class="op" id="5607011">[</span><span class="ident" id="5607012"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607013">+</span><span class="num" id="5607014">1</span><span class="op" id="5607015">]</span>&nbsp;<span class="op" id="5607017">=</span>&nbsp;<span class="ident" id="5607019"><a href="/image/png/writer.go.html#5606923">c</a></span><span class="op" id="5607020">.</span><span class="ident" id="5607021">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607028"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607030">[</span><span class="num" id="5607031">0</span><span class="op" id="5607032">]</span><span class="op" id="5607033">[</span><span class="ident" id="5607034"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607035">+</span><span class="num" id="5607036">2</span><span class="op" id="5607037">]</span>&nbsp;<span class="op" id="5607039">=</span>&nbsp;<span class="ident" id="5607041"><a href="/image/png/writer.go.html#5606923">c</a></span><span class="op" id="5607042">.</span><span class="ident" id="5607043">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607050"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607052">[</span><span class="num" id="5607053">0</span><span class="op" id="5607054">]</span><span class="op" id="5607055">[</span><span class="ident" id="5607056"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607057">+</span><span class="num" id="5607058">3</span><span class="op" id="5607059">]</span>&nbsp;<span class="op" id="5607061">=</span>&nbsp;<span class="ident" id="5607063"><a href="/image/png/writer.go.html#5606923">c</a></span><span class="op" id="5607064">.</span><span class="ident" id="5607065">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607072"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5607074">+=</span>&nbsp;<span class="num" id="5607077">4</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607092">case</span>&nbsp;<span class="ident" id="5607097"><a href="/image/png/reader.go.html#5578531">cbG16</a></span><span class="op" id="5607102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607107">for</span>&nbsp;<span class="ident" id="5607111">x</span>&nbsp;<span class="op" id="5607113">:=</span>&nbsp;<span class="ident" id="5607116"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607117">.</span><span class="ident" id="5607118">Min</span><span class="op" id="5607121">.</span><span class="ident" id="5607122">X</span><span class="op" id="5607123">;</span>&nbsp;<span class="ident" id="5607125"><a href="/image/png/writer.go.html#5607111">x</a></span>&nbsp;<span class="op" id="5607127">&lt;</span>&nbsp;<span class="ident" id="5607129"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607130">.</span><span class="ident" id="5607131">Max</span><span class="op" id="5607134">.</span><span class="ident" id="5607135">X</span><span class="op" id="5607136">;</span>&nbsp;<span class="ident" id="5607138"><a href="/image/png/writer.go.html#5607111">x</a></span><span class="op" id="5607139">++</span>&nbsp;<span class="op" id="5607142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607148">c</span>&nbsp;<span class="op" id="5607150">:=</span>&nbsp;<span class="ident" id="5607153"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5607158">.</span><span class="ident" id="5607159">Gray16Model</span><span class="op" id="5607170">.</span><span class="ident" id="5607171">Convert</span><span class="op" id="5607178">(</span><span class="ident" id="5607179"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5607180">.</span><span class="ident" id="5607181">At</span><span class="op" id="5607183">(</span><span class="ident" id="5607184"><a href="/image/png/writer.go.html#5607111">x</a></span><span class="op" id="5607185">,</span>&nbsp;<span class="ident" id="5607187"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5607188">)</span><span class="op" id="5607189">)</span><span class="op" id="5607190">.</span><span class="op" id="5607191">(</span><span class="ident" id="5607192"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5607197">.</span><span class="ident" id="5607198">Gray16</span><span class="op" id="5607204">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607210"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607212">[</span><span class="num" id="5607213">0</span><span class="op" id="5607214">]</span><span class="op" id="5607215">[</span><span class="ident" id="5607216"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607217">+</span><span class="num" id="5607218">0</span><span class="op" id="5607219">]</span>&nbsp;<span class="op" id="5607221">=</span>&nbsp;<span class="builtintype" id="5607223">uint8</span><span class="op" id="5607228">(</span><span class="ident" id="5607229"><a href="/image/png/writer.go.html#5607148">c</a></span><span class="op" id="5607230">.</span><span class="ident" id="5607231">Y</span>&nbsp;<span class="op" id="5607233">&gt;&gt;</span>&nbsp;<span class="num" id="5607236">8</span><span class="op" id="5607237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607243"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607245">[</span><span class="num" id="5607246">0</span><span class="op" id="5607247">]</span><span class="op" id="5607248">[</span><span class="ident" id="5607249"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607250">+</span><span class="num" id="5607251">1</span><span class="op" id="5607252">]</span>&nbsp;<span class="op" id="5607254">=</span>&nbsp;<span class="builtintype" id="5607256">uint8</span><span class="op" id="5607261">(</span><span class="ident" id="5607262"><a href="/image/png/writer.go.html#5607148">c</a></span><span class="op" id="5607263">.</span><span class="ident" id="5607264">Y</span><span class="op" id="5607265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607271"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5607273">+=</span>&nbsp;<span class="num" id="5607276">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607285">case</span>&nbsp;<span class="ident" id="5607290"><a href="/image/png/reader.go.html#5578546">cbTC16</a></span><span class="op" id="5607296">:</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607301">//&nbsp;We&nbsp;have&nbsp;previously&nbsp;verified&nbsp;that&nbsp;the&nbsp;alpha&nbsp;value&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607373">for</span>&nbsp;<span class="ident" id="5607377">x</span>&nbsp;<span class="op" id="5607379">:=</span>&nbsp;<span class="ident" id="5607382"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607383">.</span><span class="ident" id="5607384">Min</span><span class="op" id="5607387">.</span><span class="ident" id="5607388">X</span><span class="op" id="5607389">;</span>&nbsp;<span class="ident" id="5607391"><a href="/image/png/writer.go.html#5607377">x</a></span>&nbsp;<span class="op" id="5607393">&lt;</span>&nbsp;<span class="ident" id="5607395"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607396">.</span><span class="ident" id="5607397">Max</span><span class="op" id="5607400">.</span><span class="ident" id="5607401">X</span><span class="op" id="5607402">;</span>&nbsp;<span class="ident" id="5607404"><a href="/image/png/writer.go.html#5607377">x</a></span><span class="op" id="5607405">++</span>&nbsp;<span class="op" id="5607408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607414">r</span><span class="op" id="5607415">,</span>&nbsp;<span class="ident" id="5607417">g</span><span class="op" id="5607418">,</span>&nbsp;<span class="ident" id="5607420">b</span><span class="op" id="5607421">,</span>&nbsp;<span class="ident" id="5607423">_</span>&nbsp;<span class="op" id="5607425">:=</span>&nbsp;<span class="ident" id="5607428"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5607429">.</span><span class="ident" id="5607430">At</span><span class="op" id="5607432">(</span><span class="ident" id="5607433"><a href="/image/png/writer.go.html#5607377">x</a></span><span class="op" id="5607434">,</span>&nbsp;<span class="ident" id="5607436"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5607437">)</span><span class="op" id="5607438">.</span><span class="ident" id="5607439">RGBA</span><span class="op" id="5607443">(</span><span class="op" id="5607444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607450"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607452">[</span><span class="num" id="5607453">0</span><span class="op" id="5607454">]</span><span class="op" id="5607455">[</span><span class="ident" id="5607456"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607457">+</span><span class="num" id="5607458">0</span><span class="op" id="5607459">]</span>&nbsp;<span class="op" id="5607461">=</span>&nbsp;<span class="builtintype" id="5607463">uint8</span><span class="op" id="5607468">(</span><span class="ident" id="5607469"><a href="/image/png/writer.go.html#5607414">r</a></span>&nbsp;<span class="op" id="5607471">&gt;&gt;</span>&nbsp;<span class="num" id="5607474">8</span><span class="op" id="5607475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607481"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607483">[</span><span class="num" id="5607484">0</span><span class="op" id="5607485">]</span><span class="op" id="5607486">[</span><span class="ident" id="5607487"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607488">+</span><span class="num" id="5607489">1</span><span class="op" id="5607490">]</span>&nbsp;<span class="op" id="5607492">=</span>&nbsp;<span class="builtintype" id="5607494">uint8</span><span class="op" id="5607499">(</span><span class="ident" id="5607500"><a href="/image/png/writer.go.html#5607414">r</a></span><span class="op" id="5607501">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607507"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607509">[</span><span class="num" id="5607510">0</span><span class="op" id="5607511">]</span><span class="op" id="5607512">[</span><span class="ident" id="5607513"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607514">+</span><span class="num" id="5607515">2</span><span class="op" id="5607516">]</span>&nbsp;<span class="op" id="5607518">=</span>&nbsp;<span class="builtintype" id="5607520">uint8</span><span class="op" id="5607525">(</span><span class="ident" id="5607526"><a href="/image/png/writer.go.html#5607417">g</a></span>&nbsp;<span class="op" id="5607528">&gt;&gt;</span>&nbsp;<span class="num" id="5607531">8</span><span class="op" id="5607532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607538"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607540">[</span><span class="num" id="5607541">0</span><span class="op" id="5607542">]</span><span class="op" id="5607543">[</span><span class="ident" id="5607544"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607545">+</span><span class="num" id="5607546">3</span><span class="op" id="5607547">]</span>&nbsp;<span class="op" id="5607549">=</span>&nbsp;<span class="builtintype" id="5607551">uint8</span><span class="op" id="5607556">(</span><span class="ident" id="5607557"><a href="/image/png/writer.go.html#5607417">g</a></span><span class="op" id="5607558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607564"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607566">[</span><span class="num" id="5607567">0</span><span class="op" id="5607568">]</span><span class="op" id="5607569">[</span><span class="ident" id="5607570"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607571">+</span><span class="num" id="5607572">4</span><span class="op" id="5607573">]</span>&nbsp;<span class="op" id="5607575">=</span>&nbsp;<span class="builtintype" id="5607577">uint8</span><span class="op" id="5607582">(</span><span class="ident" id="5607583"><a href="/image/png/writer.go.html#5607420">b</a></span>&nbsp;<span class="op" id="5607585">&gt;&gt;</span>&nbsp;<span class="num" id="5607588">8</span><span class="op" id="5607589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607595"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607597">[</span><span class="num" id="5607598">0</span><span class="op" id="5607599">]</span><span class="op" id="5607600">[</span><span class="ident" id="5607601"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607602">+</span><span class="num" id="5607603">5</span><span class="op" id="5607604">]</span>&nbsp;<span class="op" id="5607606">=</span>&nbsp;<span class="builtintype" id="5607608">uint8</span><span class="op" id="5607613">(</span><span class="ident" id="5607614"><a href="/image/png/writer.go.html#5607420">b</a></span><span class="op" id="5607615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607621"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5607623">+=</span>&nbsp;<span class="num" id="5607626">6</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607635">case</span>&nbsp;<span class="ident" id="5607640"><a href="/image/png/reader.go.html#5578554">cbTCA16</a></span><span class="op" id="5607647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607652">//&nbsp;Convert&nbsp;from&nbsp;image.Image&nbsp;(which&nbsp;is&nbsp;alpha-premultiplied)&nbsp;to&nbsp;PNG&#39;s&nbsp;non-alpha-premultiplied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607748">for</span>&nbsp;<span class="ident" id="5607752">x</span>&nbsp;<span class="op" id="5607754">:=</span>&nbsp;<span class="ident" id="5607757"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607758">.</span><span class="ident" id="5607759">Min</span><span class="op" id="5607762">.</span><span class="ident" id="5607763">X</span><span class="op" id="5607764">;</span>&nbsp;<span class="ident" id="5607766"><a href="/image/png/writer.go.html#5607752">x</a></span>&nbsp;<span class="op" id="5607768">&lt;</span>&nbsp;<span class="ident" id="5607770"><a href="/image/png/writer.go.html#5605011">b</a></span><span class="op" id="5607771">.</span><span class="ident" id="5607772">Max</span><span class="op" id="5607775">.</span><span class="ident" id="5607776">X</span><span class="op" id="5607777">;</span>&nbsp;<span class="ident" id="5607779"><a href="/image/png/writer.go.html#5607752">x</a></span><span class="op" id="5607780">++</span>&nbsp;<span class="op" id="5607783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607789">c</span>&nbsp;<span class="op" id="5607791">:=</span>&nbsp;<span class="ident" id="5607794"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5607799">.</span><span class="ident" id="5607800">NRGBA64Model</span><span class="op" id="5607812">.</span><span class="ident" id="5607813">Convert</span><span class="op" id="5607820">(</span><span class="ident" id="5607821"><a href="/image/png/writer.go.html#5604284">m</a></span><span class="op" id="5607822">.</span><span class="ident" id="5607823">At</span><span class="op" id="5607825">(</span><span class="ident" id="5607826"><a href="/image/png/writer.go.html#5607752">x</a></span><span class="op" id="5607827">,</span>&nbsp;<span class="ident" id="5607829"><a href="/image/png/writer.go.html#5605300">y</a></span><span class="op" id="5607830">)</span><span class="op" id="5607831">)</span><span class="op" id="5607832">.</span><span class="op" id="5607833">(</span><span class="ident" id="5607834"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5607839">.</span><span class="ident" id="5607840">NRGBA64</span><span class="op" id="5607847">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607853"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607855">[</span><span class="num" id="5607856">0</span><span class="op" id="5607857">]</span><span class="op" id="5607858">[</span><span class="ident" id="5607859"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607860">+</span><span class="num" id="5607861">0</span><span class="op" id="5607862">]</span>&nbsp;<span class="op" id="5607864">=</span>&nbsp;<span class="builtintype" id="5607866">uint8</span><span class="op" id="5607871">(</span><span class="ident" id="5607872"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5607873">.</span><span class="ident" id="5607874">R</span>&nbsp;<span class="op" id="5607876">&gt;&gt;</span>&nbsp;<span class="num" id="5607879">8</span><span class="op" id="5607880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607886"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607888">[</span><span class="num" id="5607889">0</span><span class="op" id="5607890">]</span><span class="op" id="5607891">[</span><span class="ident" id="5607892"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607893">+</span><span class="num" id="5607894">1</span><span class="op" id="5607895">]</span>&nbsp;<span class="op" id="5607897">=</span>&nbsp;<span class="builtintype" id="5607899">uint8</span><span class="op" id="5607904">(</span><span class="ident" id="5607905"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5607906">.</span><span class="ident" id="5607907">R</span><span class="op" id="5607908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607914"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607916">[</span><span class="num" id="5607917">0</span><span class="op" id="5607918">]</span><span class="op" id="5607919">[</span><span class="ident" id="5607920"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607921">+</span><span class="num" id="5607922">2</span><span class="op" id="5607923">]</span>&nbsp;<span class="op" id="5607925">=</span>&nbsp;<span class="builtintype" id="5607927">uint8</span><span class="op" id="5607932">(</span><span class="ident" id="5607933"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5607934">.</span><span class="ident" id="5607935">G</span>&nbsp;<span class="op" id="5607937">&gt;&gt;</span>&nbsp;<span class="num" id="5607940">8</span><span class="op" id="5607941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607947"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607949">[</span><span class="num" id="5607950">0</span><span class="op" id="5607951">]</span><span class="op" id="5607952">[</span><span class="ident" id="5607953"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607954">+</span><span class="num" id="5607955">3</span><span class="op" id="5607956">]</span>&nbsp;<span class="op" id="5607958">=</span>&nbsp;<span class="builtintype" id="5607960">uint8</span><span class="op" id="5607965">(</span><span class="ident" id="5607966"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5607967">.</span><span class="ident" id="5607968">G</span><span class="op" id="5607969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607975"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5607977">[</span><span class="num" id="5607978">0</span><span class="op" id="5607979">]</span><span class="op" id="5607980">[</span><span class="ident" id="5607981"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5607982">+</span><span class="num" id="5607983">4</span><span class="op" id="5607984">]</span>&nbsp;<span class="op" id="5607986">=</span>&nbsp;<span class="builtintype" id="5607988">uint8</span><span class="op" id="5607993">(</span><span class="ident" id="5607994"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5607995">.</span><span class="ident" id="5607996">B</span>&nbsp;<span class="op" id="5607998">&gt;&gt;</span>&nbsp;<span class="num" id="5608001">8</span><span class="op" id="5608002">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608008"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608010">[</span><span class="num" id="5608011">0</span><span class="op" id="5608012">]</span><span class="op" id="5608013">[</span><span class="ident" id="5608014"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5608015">+</span><span class="num" id="5608016">5</span><span class="op" id="5608017">]</span>&nbsp;<span class="op" id="5608019">=</span>&nbsp;<span class="builtintype" id="5608021">uint8</span><span class="op" id="5608026">(</span><span class="ident" id="5608027"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5608028">.</span><span class="ident" id="5608029">B</span><span class="op" id="5608030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608036"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608038">[</span><span class="num" id="5608039">0</span><span class="op" id="5608040">]</span><span class="op" id="5608041">[</span><span class="ident" id="5608042"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5608043">+</span><span class="num" id="5608044">6</span><span class="op" id="5608045">]</span>&nbsp;<span class="op" id="5608047">=</span>&nbsp;<span class="builtintype" id="5608049">uint8</span><span class="op" id="5608054">(</span><span class="ident" id="5608055"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5608056">.</span><span class="ident" id="5608057">A</span>&nbsp;<span class="op" id="5608059">&gt;&gt;</span>&nbsp;<span class="num" id="5608062">8</span><span class="op" id="5608063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608069"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608071">[</span><span class="num" id="5608072">0</span><span class="op" id="5608073">]</span><span class="op" id="5608074">[</span><span class="ident" id="5608075"><a href="/image/png/writer.go.html#5605370">i</a></span><span class="op" id="5608076">+</span><span class="num" id="5608077">7</span><span class="op" id="5608078">]</span>&nbsp;<span class="op" id="5608080">=</span>&nbsp;<span class="builtintype" id="5608082">uint8</span><span class="op" id="5608087">(</span><span class="ident" id="5608088"><a href="/image/png/writer.go.html#5607789">c</a></span><span class="op" id="5608089">.</span><span class="ident" id="5608090">A</span><span class="op" id="5608091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608097"><a href="/image/png/writer.go.html#5605370">i</a></span>&nbsp;<span class="op" id="5608099">+=</span>&nbsp;<span class="num" id="5608102">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608107">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608116">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608139">f</span>&nbsp;<span class="op" id="5608141">:=</span>&nbsp;<span class="ident" id="5608144"><a href="/image/png/reader.go.html#5578611">ftNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608153">if</span>&nbsp;<span class="ident" id="5608156"><a href="/image/png/writer.go.html#5604307">level</a></span>&nbsp;<span class="op" id="5608162">!=</span>&nbsp;<span class="ident" id="5608165"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5608169">.</span><span class="ident" id="5608170">NoCompression</span>&nbsp;<span class="op" id="5608184">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608189"><a href="/image/png/writer.go.html#5608139">f</a></span>&nbsp;<span class="op" id="5608191">=</span>&nbsp;<span class="ident" id="5608193"><a href="/image/png/writer.go.html#5602439">filter</a></span><span class="op" id="5608199">(</span><span class="op" id="5608200">&amp;</span><span class="ident" id="5608201"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608203">,</span>&nbsp;<span class="ident" id="5608205"><a href="/image/png/writer.go.html#5605137">pr</a></span><span class="op" id="5608207">,</span>&nbsp;<span class="ident" id="5608209"><a href="/image/png/writer.go.html#5604421">bpp</a></span><span class="op" id="5608212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608221">//&nbsp;Write&nbsp;the&nbsp;compressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608254">if</span>&nbsp;<span class="ident" id="5608257">_</span><span class="op" id="5608258">,</span>&nbsp;<span class="ident" id="5608260">err</span>&nbsp;<span class="op" id="5608264">:=</span>&nbsp;<span class="ident" id="5608267"><a href="/image/png/writer.go.html#5604327">zw</a></span><span class="op" id="5608269">.</span><span class="ident" id="5608270">Write</span><span class="op" id="5608275">(</span><span class="ident" id="5608276"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608278">[</span><span class="ident" id="5608279"><a href="/image/png/writer.go.html#5608139">f</a></span><span class="op" id="5608280">]</span><span class="op" id="5608281">)</span><span class="op" id="5608282">;</span>&nbsp;<span class="ident" id="5608284"><a href="/image/png/writer.go.html#5608260">err</a></span>&nbsp;<span class="op" id="5608288">!=</span>&nbsp;<span class="ident" id="5608291">nil</span>&nbsp;<span class="op" id="5608295">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608300">return</span>&nbsp;<span class="ident" id="5608307"><a href="/image/png/writer.go.html#5608260">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608318">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608374"><a href="/image/png/writer.go.html#5605137">pr</a></span><span class="op" id="5608376">,</span>&nbsp;<span class="ident" id="5608378"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608380">[</span><span class="num" id="5608381">0</span><span class="op" id="5608382">]</span>&nbsp;<span class="op" id="5608384">=</span>&nbsp;<span class="ident" id="5608386"><a href="/image/png/writer.go.html#5605032">cr</a></span><span class="op" id="5608388">[</span><span class="num" id="5608389">0</span><span class="op" id="5608390">]</span><span class="op" id="5608391">,</span>&nbsp;<span class="ident" id="5608393"><a href="/image/png/writer.go.html#5605137">pr</a></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608400">return</span>&nbsp;<span class="ident" id="5608407">nil</span><br>
<span class="lineno"></span><span class="op" id="5608411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5608414">//&nbsp;Write&nbsp;the&nbsp;actual&nbsp;image&nbsp;data&nbsp;to&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks.</span><br>
<span class="lineno">440</span><span class="keyword" id="5608473">func</span>&nbsp;<span class="op" id="5608478">(</span><span class="ident" id="5608479">e</span>&nbsp;<span class="op" id="5608481">*</span><span class="ident" id="5608482"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5608489">)</span>&nbsp;<span class="ident" id="5608491">writeIDATs</span><span class="op" id="5608501">(</span><span class="op" id="5608502">)</span>&nbsp;<span class="op" id="5608504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608507">if</span>&nbsp;<span class="ident" id="5608510"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608511">.</span><span class="ident" id="5608512">err</span>&nbsp;<span class="op" id="5608516">!=</span>&nbsp;<span class="ident" id="5608519">nil</span>&nbsp;<span class="op" id="5608523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608527">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608538">var</span>&nbsp;<span class="ident" id="5608542">bw</span>&nbsp;<span class="op" id="5608545">*</span><span class="ident" id="5608546"><a href="/image/png/writer.go.html#5598569">bufio</a></span><span class="op" id="5608551">.</span><span class="ident" id="5608552">Writer</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608560"><a href="/image/png/writer.go.html#5608542">bw</a></span>&nbsp;<span class="op" id="5608563">=</span>&nbsp;<span class="ident" id="5608565"><a href="/image/png/writer.go.html#5598569">bufio</a></span><span class="op" id="5608570">.</span><span class="ident" id="5608571">NewWriterSize</span><span class="op" id="5608584">(</span><span class="ident" id="5608585"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608586">,</span>&nbsp;<span class="num" id="5608588">1</span><span class="op" id="5608589">&lt;&lt;</span><span class="num" id="5608591">15</span><span class="op" id="5608593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608596"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608597">.</span><span class="ident" id="5608598">err</span>&nbsp;<span class="op" id="5608602">=</span>&nbsp;<span class="ident" id="5608604"><a href="/image/png/writer.go.html#5604260">writeImage</a></span><span class="op" id="5608614">(</span><span class="ident" id="5608615"><a href="/image/png/writer.go.html#5608542">bw</a></span><span class="op" id="5608617">,</span>&nbsp;<span class="ident" id="5608619"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608620">.</span><span class="ident" id="5608621">m</span><span class="op" id="5608622">,</span>&nbsp;<span class="ident" id="5608624"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608625">.</span><span class="ident" id="5608626">cb</span><span class="op" id="5608628">,</span>&nbsp;<span class="ident" id="5608630"><a href="/image/png/writer.go.html#5608852">levelToZlib</a></span><span class="op" id="5608641">(</span><span class="ident" id="5608642"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608643">.</span><span class="ident" id="5608644">enc</span><span class="op" id="5608647">.</span><span class="ident" id="5608648">CompressionLevel</span><span class="op" id="5608664">)</span><span class="op" id="5608665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608668">if</span>&nbsp;<span class="ident" id="5608671"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608672">.</span><span class="ident" id="5608673">err</span>&nbsp;<span class="op" id="5608677">!=</span>&nbsp;<span class="ident" id="5608680">nil</span>&nbsp;<span class="op" id="5608684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608688">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608696">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608699"><a href="/image/png/writer.go.html#5608479">e</a></span><span class="op" id="5608700">.</span><span class="ident" id="5608701">err</span>&nbsp;<span class="op" id="5608705">=</span>&nbsp;<span class="ident" id="5608707"><a href="/image/png/writer.go.html#5608542">bw</a></span><span class="op" id="5608709">.</span><span class="ident" id="5608710">Flush</span><span class="op" id="5608715">(</span><span class="op" id="5608716">)</span><br>
<span class="lineno"></span><span class="op" id="5608718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5608721">//&nbsp;This&nbsp;function&nbsp;is&nbsp;required&nbsp;because&nbsp;we&nbsp;want&nbsp;the&nbsp;zero&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5608784">//&nbsp;Encoder.CompressionLevel&nbsp;to&nbsp;map&nbsp;to&nbsp;zlib.DefaultCompression.</span><br>
<span class="lineno">455</span><span class="keyword" id="5608847">func</span>&nbsp;<span class="ident" id="5608852">levelToZlib</span><span class="op" id="5608863">(</span><span class="ident" id="5608864">l</span>&nbsp;<span class="ident" id="5608866"><a href="/image/png/writer.go.html#5598920">CompressionLevel</a></span><span class="op" id="5608882">)</span>&nbsp;<span class="builtintype" id="5608884">int</span>&nbsp;<span class="op" id="5608888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608891">switch</span>&nbsp;<span class="ident" id="5608898"><a href="/image/png/writer.go.html#5608864">l</a></span>&nbsp;<span class="op" id="5608900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608903">case</span>&nbsp;<span class="ident" id="5608908"><a href="/image/png/writer.go.html#5598951">DefaultCompression</a></span><span class="op" id="5608926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608930">return</span>&nbsp;<span class="ident" id="5608937"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5608941">.</span><span class="ident" id="5608942">DefaultCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608962">case</span>&nbsp;<span class="ident" id="5608967"><a href="/image/png/writer.go.html#5598992">NoCompression</a></span><span class="op" id="5608980">:</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608984">return</span>&nbsp;<span class="ident" id="5608991"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5608995">.</span><span class="ident" id="5608996">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609011">case</span>&nbsp;<span class="ident" id="5609016"><a href="/image/png/writer.go.html#5599034">BestSpeed</a></span><span class="op" id="5609025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609029">return</span>&nbsp;<span class="ident" id="5609036"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5609040">.</span><span class="ident" id="5609041">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609052">case</span>&nbsp;<span class="ident" id="5609057"><a href="/image/png/writer.go.html#5599076">BestCompression</a></span><span class="op" id="5609072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609076">return</span>&nbsp;<span class="ident" id="5609083"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5609087">.</span><span class="ident" id="5609088">BestCompression</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609105">default</span><span class="op" id="5609112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609116">return</span>&nbsp;<span class="ident" id="5609123"><a href="/image/png/writer.go.html#5598578">zlib</a></span><span class="op" id="5609127">.</span><span class="ident" id="5609128">DefaultCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609148">}</span><br>
<span class="lineno"></span><span class="op" id="5609150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="5609153">func</span>&nbsp;<span class="op" id="5609158">(</span><span class="ident" id="5609159">e</span>&nbsp;<span class="op" id="5609161">*</span><span class="ident" id="5609162"><a href="/image/png/writer.go.html#5598760">encoder</a></span><span class="op" id="5609169">)</span>&nbsp;<span class="ident" id="5609171">writeIEND</span><span class="op" id="5609180">(</span><span class="op" id="5609181">)</span>&nbsp;<span class="op" id="5609183">{</span>&nbsp;<span class="ident" id="5609185"><a href="/image/png/writer.go.html#5609159">e</a></span><span class="op" id="5609186">.</span><span class="ident" id="5609187">writeChunk</span><span class="op" id="5609197">(</span><span class="ident" id="5609198">nil</span><span class="op" id="5609201">,</span>&nbsp;<span class="string" id="5609203">&#34;IEND&#34;</span><span class="op" id="5609209">)</span>&nbsp;<span class="op" id="5609211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609214">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;PNG&nbsp;format.&nbsp;Any&nbsp;Image&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5609280">//&nbsp;encoded,&nbsp;but&nbsp;images&nbsp;that&nbsp;are&nbsp;not&nbsp;image.NRGBA&nbsp;might&nbsp;be&nbsp;encoded&nbsp;lossily.</span><br>
<span class="lineno"></span><span class="keyword" id="5609354">func</span>&nbsp;<span class="ident" id="5609359">Encode</span><span class="op" id="5609365">(</span><span class="ident" id="5609366">w</span>&nbsp;<span class="ident" id="5609368"><a href="/image/png/writer.go.html#5598633">io</a></span><span class="op" id="5609370">.</span><span class="ident" id="5609371">Writer</span><span class="op" id="5609377">,</span>&nbsp;<span class="ident" id="5609379">m</span>&nbsp;<span class="ident" id="5609381"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5609386">.</span><span class="ident" id="5609387">Image</span><span class="op" id="5609392">)</span>&nbsp;<span class="builtintype" id="5609394">error</span>&nbsp;<span class="op" id="5609400">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609403">var</span>&nbsp;<span class="ident" id="5609407">e</span>&nbsp;<span class="ident" id="5609409"><a href="/image/png/writer.go.html#5598700">Encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609418">return</span>&nbsp;<span class="ident" id="5609425"><a href="/image/png/writer.go.html#5609407">e</a></span><span class="op" id="5609426">.</span><span class="ident" id="5609427">Encode</span><span class="op" id="5609433">(</span><span class="ident" id="5609434"><a href="/image/png/writer.go.html#5609366">w</a></span><span class="op" id="5609435">,</span>&nbsp;<span class="ident" id="5609437"><a href="/image/png/writer.go.html#5609379">m</a></span><span class="op" id="5609438">)</span><br>
<span class="lineno"></span><span class="op" id="5609440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609443">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;PNG&nbsp;format.</span><br>
<span class="lineno">480</span><span class="keyword" id="5609492">func</span>&nbsp;<span class="op" id="5609497">(</span><span class="ident" id="5609498">enc</span>&nbsp;<span class="op" id="5609502">*</span><span class="ident" id="5609503"><a href="/image/png/writer.go.html#5598700">Encoder</a></span><span class="op" id="5609510">)</span>&nbsp;<span class="ident" id="5609512">Encode</span><span class="op" id="5609518">(</span><span class="ident" id="5609519">w</span>&nbsp;<span class="ident" id="5609521"><a href="/image/png/writer.go.html#5598633">io</a></span><span class="op" id="5609523">.</span><span class="ident" id="5609524">Writer</span><span class="op" id="5609530">,</span>&nbsp;<span class="ident" id="5609532">m</span>&nbsp;<span class="ident" id="5609534"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5609539">.</span><span class="ident" id="5609540">Image</span><span class="op" id="5609545">)</span>&nbsp;<span class="builtintype" id="5609547">error</span>&nbsp;<span class="op" id="5609553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609556">//&nbsp;Obviously,&nbsp;negative&nbsp;widths&nbsp;and&nbsp;heights&nbsp;are&nbsp;invalid.&nbsp;Furthermore,&nbsp;the&nbsp;PNG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609633">//&nbsp;spec&nbsp;section&nbsp;11.2.2&nbsp;says&nbsp;that&nbsp;zero&nbsp;is&nbsp;invalid.&nbsp;Excessively&nbsp;large&nbsp;images&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609713">//&nbsp;also&nbsp;rejected.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609732">mw</span><span class="op" id="5609734">,</span>&nbsp;<span class="ident" id="5609736">mh</span>&nbsp;<span class="op" id="5609739">:=</span>&nbsp;<span class="ident" id="5609742">int64</span><span class="op" id="5609747">(</span><span class="ident" id="5609748"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5609749">.</span><span class="ident" id="5609750">Bounds</span><span class="op" id="5609756">(</span><span class="op" id="5609757">)</span><span class="op" id="5609758">.</span><span class="ident" id="5609759">Dx</span><span class="op" id="5609761">(</span><span class="op" id="5609762">)</span><span class="op" id="5609763">)</span><span class="op" id="5609764">,</span>&nbsp;<span class="ident" id="5609766">int64</span><span class="op" id="5609771">(</span><span class="ident" id="5609772"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5609773">.</span><span class="ident" id="5609774">Bounds</span><span class="op" id="5609780">(</span><span class="op" id="5609781">)</span><span class="op" id="5609782">.</span><span class="ident" id="5609783">Dy</span><span class="op" id="5609785">(</span><span class="op" id="5609786">)</span><span class="op" id="5609787">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609790">if</span>&nbsp;<span class="ident" id="5609793"><a href="/image/png/writer.go.html#5609732">mw</a></span>&nbsp;<span class="op" id="5609796">&lt;=</span>&nbsp;<span class="num" id="5609799">0</span>&nbsp;<span class="op" id="5609801">||</span>&nbsp;<span class="ident" id="5609804"><a href="/image/png/writer.go.html#5609736">mh</a></span>&nbsp;<span class="op" id="5609807">&lt;=</span>&nbsp;<span class="num" id="5609810">0</span>&nbsp;<span class="op" id="5609812">||</span>&nbsp;<span class="ident" id="5609815"><a href="/image/png/writer.go.html#5609732">mw</a></span>&nbsp;<span class="op" id="5609818">&gt;=</span>&nbsp;<span class="num" id="5609821">1</span><span class="op" id="5609822">&lt;&lt;</span><span class="num" id="5609824">32</span>&nbsp;<span class="op" id="5609827">||</span>&nbsp;<span class="ident" id="5609830"><a href="/image/png/writer.go.html#5609736">mh</a></span>&nbsp;<span class="op" id="5609833">&gt;=</span>&nbsp;<span class="num" id="5609836">1</span><span class="op" id="5609837">&lt;&lt;</span><span class="num" id="5609839">32</span>&nbsp;<span class="op" id="5609842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609846">return</span>&nbsp;<span class="ident" id="5609853"><a href="/image/png/reader.go.html#5579941">FormatError</a></span><span class="op" id="5609864">(</span><span class="string" id="5609865">&#34;invalid&nbsp;image&nbsp;size:&nbsp;&#34;</span>&nbsp;<span class="op" id="5609888">+</span>&nbsp;<span class="ident" id="5609890"><a href="/image/png/writer.go.html#5598639">strconv</a></span><span class="op" id="5609897">.</span><span class="ident" id="5609898">FormatInt</span><span class="op" id="5609907">(</span><span class="ident" id="5609908"><a href="/image/png/writer.go.html#5609732">mw</a></span><span class="op" id="5609910">,</span>&nbsp;<span class="num" id="5609912">10</span><span class="op" id="5609914">)</span>&nbsp;<span class="op" id="5609916">+</span>&nbsp;<span class="string" id="5609918">&#34;x&#34;</span>&nbsp;<span class="op" id="5609922">+</span>&nbsp;<span class="ident" id="5609924"><a href="/image/png/writer.go.html#5598639">strconv</a></span><span class="op" id="5609931">.</span><span class="ident" id="5609932">FormatInt</span><span class="op" id="5609941">(</span><span class="ident" id="5609942"><a href="/image/png/writer.go.html#5609736">mh</a></span><span class="op" id="5609944">,</span>&nbsp;<span class="num" id="5609946">10</span><span class="op" id="5609948">)</span><span class="op" id="5609949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609956">var</span>&nbsp;<span class="ident" id="5609960">e</span>&nbsp;<span class="ident" id="5609962"><a href="/image/png/writer.go.html#5598760">encoder</a></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609971"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5609972">.</span><span class="ident" id="5609973">enc</span>&nbsp;<span class="op" id="5609977">=</span>&nbsp;<span class="ident" id="5609979"><a href="/image/png/writer.go.html#5609498">enc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609984"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5609985">.</span><span class="ident" id="5609986">w</span>&nbsp;<span class="op" id="5609988">=</span>&nbsp;<span class="ident" id="5609990"><a href="/image/png/writer.go.html#5609519">w</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609993"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5609994">.</span><span class="ident" id="5609995">m</span>&nbsp;<span class="op" id="5609997">=</span>&nbsp;<span class="ident" id="5609999"><a href="/image/png/writer.go.html#5609532">m</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610003">var</span>&nbsp;<span class="ident" id="5610007">pal</span>&nbsp;<span class="ident" id="5610011"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610016">.</span><span class="ident" id="5610017">Palette</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610026">//&nbsp;cbP8&nbsp;encoding&nbsp;needs&nbsp;PalettedImage&#39;s&nbsp;ColorIndexAt&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610087">if</span>&nbsp;<span class="ident" id="5610090">_</span><span class="op" id="5610091">,</span>&nbsp;<span class="ident" id="5610093">ok</span>&nbsp;<span class="op" id="5610096">:=</span>&nbsp;<span class="ident" id="5610099"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5610100">.</span><span class="op" id="5610101">(</span><span class="ident" id="5610102"><a href="/image/png/writer.go.html#5598609">image</a></span><span class="op" id="5610107">.</span><span class="ident" id="5610108">PalettedImage</span><span class="op" id="5610121">)</span><span class="op" id="5610122">;</span>&nbsp;<span class="ident" id="5610124"><a href="/image/png/writer.go.html#5610093">ok</a></span>&nbsp;<span class="op" id="5610127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610131"><a href="/image/png/writer.go.html#5610007">pal</a></span><span class="op" id="5610134">,</span>&nbsp;<span class="ident" id="5610136">_</span>&nbsp;<span class="op" id="5610138">=</span>&nbsp;<span class="ident" id="5610140"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5610141">.</span><span class="ident" id="5610142">ColorModel</span><span class="op" id="5610152">(</span><span class="op" id="5610153">)</span><span class="op" id="5610154">.</span><span class="op" id="5610155">(</span><span class="ident" id="5610156"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610161">.</span><span class="ident" id="5610162">Palette</span><span class="op" id="5610169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610175">if</span>&nbsp;<span class="ident" id="5610178"><a href="/image/png/writer.go.html#5610007">pal</a></span>&nbsp;<span class="op" id="5610182">!=</span>&nbsp;<span class="ident" id="5610185">nil</span>&nbsp;<span class="op" id="5610189">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610193"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610194">.</span><span class="ident" id="5610195">cb</span>&nbsp;<span class="op" id="5610198">=</span>&nbsp;<span class="ident" id="5610200"><a href="/image/png/reader.go.html#5578517">cbP8</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610206">}</span>&nbsp;<span class="keyword" id="5610208">else</span>&nbsp;<span class="op" id="5610213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610217">switch</span>&nbsp;<span class="ident" id="5610224"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5610225">.</span><span class="ident" id="5610226">ColorModel</span><span class="op" id="5610236">(</span><span class="op" id="5610237">)</span>&nbsp;<span class="op" id="5610239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610243">case</span>&nbsp;<span class="ident" id="5610248"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610253">.</span><span class="ident" id="5610254">GrayModel</span><span class="op" id="5610263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610268"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610269">.</span><span class="ident" id="5610270">cb</span>&nbsp;<span class="op" id="5610273">=</span>&nbsp;<span class="ident" id="5610275"><a href="/image/png/reader.go.html#5578479">cbG8</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610282">case</span>&nbsp;<span class="ident" id="5610287"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610292">.</span><span class="ident" id="5610293">Gray16Model</span><span class="op" id="5610304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610309"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610310">.</span><span class="ident" id="5610311">cb</span>&nbsp;<span class="op" id="5610314">=</span>&nbsp;<span class="ident" id="5610316"><a href="/image/png/reader.go.html#5578531">cbG16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610324">case</span>&nbsp;<span class="ident" id="5610329"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610334">.</span><span class="ident" id="5610335">RGBAModel</span><span class="op" id="5610344">,</span>&nbsp;<span class="ident" id="5610346"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610351">.</span><span class="ident" id="5610352">NRGBAModel</span><span class="op" id="5610362">,</span>&nbsp;<span class="ident" id="5610364"><a href="/image/png/writer.go.html#5598618">color</a></span><span class="op" id="5610369">.</span><span class="ident" id="5610370">AlphaModel</span><span class="op" id="5610380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610385">if</span>&nbsp;<span class="ident" id="5610388"><a href="/image/png/writer.go.html#5599504">opaque</a></span><span class="op" id="5610394">(</span><span class="ident" id="5610395"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5610396">)</span>&nbsp;<span class="op" id="5610398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610404"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610405">.</span><span class="ident" id="5610406">cb</span>&nbsp;<span class="op" id="5610409">=</span>&nbsp;<span class="ident" id="5610411"><a href="/image/png/reader.go.html#5578492">cbTC8</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610420">}</span>&nbsp;<span class="keyword" id="5610422">else</span>&nbsp;<span class="op" id="5610427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610433"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610434">.</span><span class="ident" id="5610435">cb</span>&nbsp;<span class="op" id="5610438">=</span>&nbsp;<span class="ident" id="5610440"><a href="/image/png/reader.go.html#5578523">cbTCA8</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610454">default</span><span class="op" id="5610461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610466">if</span>&nbsp;<span class="ident" id="5610469"><a href="/image/png/writer.go.html#5599504">opaque</a></span><span class="op" id="5610475">(</span><span class="ident" id="5610476"><a href="/image/png/writer.go.html#5609532">m</a></span><span class="op" id="5610477">)</span>&nbsp;<span class="op" id="5610479">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610485"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610486">.</span><span class="ident" id="5610487">cb</span>&nbsp;<span class="op" id="5610490">=</span>&nbsp;<span class="ident" id="5610492"><a href="/image/png/reader.go.html#5578546">cbTC16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610502">}</span>&nbsp;<span class="keyword" id="5610504">else</span>&nbsp;<span class="op" id="5610509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610515"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610516">.</span><span class="ident" id="5610517">cb</span>&nbsp;<span class="op" id="5610520">=</span>&nbsp;<span class="ident" id="5610522"><a href="/image/png/reader.go.html#5578554">cbTCA16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610537">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610544">_</span><span class="op" id="5610545">,</span>&nbsp;<span class="ident" id="5610547"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610548">.</span><span class="ident" id="5610549">err</span>&nbsp;<span class="op" id="5610553">=</span>&nbsp;<span class="ident" id="5610555"><a href="/image/png/writer.go.html#5598633">io</a></span><span class="op" id="5610557">.</span><span class="ident" id="5610558">WriteString</span><span class="op" id="5610569">(</span><span class="ident" id="5610570"><a href="/image/png/writer.go.html#5609519">w</a></span><span class="op" id="5610571">,</span>&nbsp;<span class="ident" id="5610573"><a href="/image/png/reader.go.html#5579564">pngHeader</a></span><span class="op" id="5610582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610585"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610586">.</span><span class="ident" id="5610587">writeIHDR</span><span class="op" id="5610596">(</span><span class="op" id="5610597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610600">if</span>&nbsp;<span class="ident" id="5610603"><a href="/image/png/writer.go.html#5610007">pal</a></span>&nbsp;<span class="op" id="5610607">!=</span>&nbsp;<span class="ident" id="5610610">nil</span>&nbsp;<span class="op" id="5610614">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610618"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610619">.</span><span class="ident" id="5610620">writePLTEAndTRNS</span><span class="op" id="5610636">(</span><span class="ident" id="5610637"><a href="/image/png/writer.go.html#5610007">pal</a></span><span class="op" id="5610640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610646"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610647">.</span><span class="ident" id="5610648">writeIDATs</span><span class="op" id="5610658">(</span><span class="op" id="5610659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610662"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610663">.</span><span class="ident" id="5610664">writeIEND</span><span class="op" id="5610673">(</span><span class="op" id="5610674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610677">return</span>&nbsp;<span class="ident" id="5610684"><a href="/image/png/writer.go.html#5609960">e</a></span><span class="op" id="5610685">.</span><span class="ident" id="5610686">err</span><br>
<span class="lineno">530</span><span class="op" id="5610690">}</span>
</div>
</body>
</html>
