<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html" class="current">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3336488">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3336543">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3336597">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3336648">package</span>&nbsp;<span class="ident" id="3336656">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3336663">import</span>&nbsp;<span class="op" id="3336670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3336673">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3336680">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3336688">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3336695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3336698">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3336779">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3336793">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3336844">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="3336894">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3336944">//</span><br>
<span class="lineno">20</span><span class="keyword" id="3336947">type</span>&nbsp;<span class="ident" id="3336952">Position</span>&nbsp;<span class="keyword" id="3336961">struct</span>&nbsp;<span class="op" id="3336968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3336971">Filename</span>&nbsp;<span class="builtintype" id="3336980">string</span>&nbsp;<span class="comment" id="3336987">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337008">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3337017">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337024">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337050">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3337059">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337066">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337097">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3337106">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3337113">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="3337163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337166">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3337216">func</span>&nbsp;<span class="op" id="3337221">(</span><span class="ident" id="3337222">pos</span>&nbsp;<span class="op" id="3337226">*</span><span class="ident" id="3337227">Position</span><span class="op" id="3337235">)</span>&nbsp;<span class="ident" id="3337237">IsValid</span><span class="op" id="3337244">(</span><span class="op" id="3337245">)</span>&nbsp;<span class="builtintype" id="3337247">bool</span>&nbsp;<span class="op" id="3337252">{</span>&nbsp;<span class="keyword" id="3337254">return</span>&nbsp;<span class="ident" id="3337261">pos</span><span class="op" id="3337264">.</span><span class="ident" id="3337265">Line</span>&nbsp;<span class="op" id="3337270">&gt;</span>&nbsp;<span class="num" id="3337272">0</span>&nbsp;<span class="op" id="3337274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3337277">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="3337329">//</span><br>
<span class="lineno"></span><span class="comment" id="3337332">//&nbsp;&nbsp;&nbsp;&nbsp;file:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3337385">//&nbsp;&nbsp;&nbsp;&nbsp;line:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3337441">//&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3337496">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3337554">//</span><br>
<span class="lineno"></span><span class="keyword" id="3337557">func</span>&nbsp;<span class="op" id="3337562">(</span><span class="ident" id="3337563">pos</span>&nbsp;<span class="ident" id="3337567">Position</span><span class="op" id="3337575">)</span>&nbsp;<span class="ident" id="3337577">String</span><span class="op" id="3337583">(</span><span class="op" id="3337584">)</span>&nbsp;<span class="builtintype" id="3337586">string</span>&nbsp;<span class="op" id="3337593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337596">s</span>&nbsp;<span class="op" id="3337598">:=</span>&nbsp;<span class="ident" id="3337601">pos</span><span class="op" id="3337604">.</span><span class="ident" id="3337605">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337615">if</span>&nbsp;<span class="ident" id="3337618">pos</span><span class="op" id="3337621">.</span><span class="ident" id="3337622">IsValid</span><span class="op" id="3337629">(</span><span class="op" id="3337630">)</span>&nbsp;<span class="op" id="3337632">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337636">if</span>&nbsp;<span class="ident" id="3337639">s</span>&nbsp;<span class="op" id="3337641">!=</span>&nbsp;<span class="string" id="3337644">&#34;&#34;</span>&nbsp;<span class="op" id="3337647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337652">s</span>&nbsp;<span class="op" id="3337654">+=</span>&nbsp;<span class="string" id="3337657">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337667">s</span>&nbsp;<span class="op" id="3337669">+=</span>&nbsp;<span class="ident" id="3337672">fmt</span><span class="op" id="3337675">.</span><span class="ident" id="3337676">Sprintf</span><span class="op" id="3337683">(</span><span class="string" id="3337684">&#34;%d:%d&#34;</span><span class="op" id="3337691">,</span>&nbsp;<span class="ident" id="3337693">pos</span><span class="op" id="3337696">.</span><span class="ident" id="3337697">Line</span><span class="op" id="3337701">,</span>&nbsp;<span class="ident" id="3337703">pos</span><span class="op" id="3337706">.</span><span class="ident" id="3337707">Column</span><span class="op" id="3337713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337716">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337719">if</span>&nbsp;<span class="ident" id="3337722">s</span>&nbsp;<span class="op" id="3337724">==</span>&nbsp;<span class="string" id="3337727">&#34;&#34;</span>&nbsp;<span class="op" id="3337730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3337734">s</span>&nbsp;<span class="op" id="3337736">=</span>&nbsp;<span class="string" id="3337738">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3337743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3337746">return</span>&nbsp;<span class="ident" id="3337753">s</span><br>
<span class="lineno"></span><span class="op" id="3337755">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3337758">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="3337827">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="3337898">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3337925">//</span><br>
<span class="lineno">55</span><span class="comment" id="3337928">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="3338006">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="3338084">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="3338096">//</span><br>
<span class="lineno"></span><span class="comment" id="3338099">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="3338166">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="3338235">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="3338304">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3338373">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="3338414">//</span><br>
<span class="lineno">65</span><span class="comment" id="3338417">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="3338493">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3338565">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="3338639">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3338715">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="3338775">//</span><br>
<span class="lineno"></span><span class="keyword" id="3338778">type</span>&nbsp;<span class="ident" id="3338783">Pos</span>&nbsp;<span class="builtintype" id="3338787">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3338792">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3338866">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="3338937">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3339007">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="3339052">//</span><br>
<span class="lineno"></span><span class="keyword" id="3339055">const</span>&nbsp;<span class="ident" id="3339061">NoPos</span>&nbsp;<span class="ident" id="3339067">Pos</span>&nbsp;<span class="op" id="3339071">=</span>&nbsp;<span class="num" id="3339073">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3339076">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3339126">func</span>&nbsp;<span class="op" id="3339131">(</span><span class="ident" id="3339132">p</span>&nbsp;<span class="ident" id="3339134">Pos</span><span class="op" id="3339137">)</span>&nbsp;<span class="ident" id="3339139">IsValid</span><span class="op" id="3339146">(</span><span class="op" id="3339147">)</span>&nbsp;<span class="builtintype" id="3339149">bool</span>&nbsp;<span class="op" id="3339154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339157">return</span>&nbsp;<span class="ident" id="3339164">p</span>&nbsp;<span class="op" id="3339166">!=</span>&nbsp;<span class="ident" id="3339169">NoPos</span><br>
<span class="lineno"></span><span class="op" id="3339175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="3339178">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3339259">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339268">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="3339325">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="3339376">//</span><br>
<span class="lineno"></span><span class="keyword" id="3339379">type</span>&nbsp;<span class="ident" id="3339384">File</span>&nbsp;<span class="keyword" id="3339389">struct</span>&nbsp;<span class="op" id="3339396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339399">set</span>&nbsp;&nbsp;<span class="op" id="3339404">*</span><span class="ident" id="3339405">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339414">name</span>&nbsp;<span class="builtintype" id="3339419">string</span>&nbsp;<span class="comment" id="3339426">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339463">base</span>&nbsp;<span class="builtintype" id="3339468">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339475">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339531">size</span>&nbsp;<span class="builtintype" id="3339536">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339543">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3339581">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339628">lines</span>&nbsp;<span class="op" id="3339634">[</span><span class="op" id="3339635">]</span><span class="builtintype" id="3339636">int</span>&nbsp;<span class="comment" id="3339640">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3339737">infos</span>&nbsp;<span class="op" id="3339743">[</span><span class="op" id="3339744">]</span><span class="ident" id="3339745">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="3339754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339757">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3339825">func</span>&nbsp;<span class="op" id="3339830">(</span><span class="ident" id="3339831">f</span>&nbsp;<span class="op" id="3339833">*</span><span class="ident" id="3339834">File</span><span class="op" id="3339838">)</span>&nbsp;<span class="ident" id="3339840">Name</span><span class="op" id="3339844">(</span><span class="op" id="3339845">)</span>&nbsp;<span class="builtintype" id="3339847">string</span>&nbsp;<span class="op" id="3339854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339857">return</span>&nbsp;<span class="ident" id="3339864">f</span><span class="op" id="3339865">.</span><span class="ident" id="3339866">name</span><br>
<span class="lineno">105</span><span class="op" id="3339871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339874">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3339944">func</span>&nbsp;<span class="op" id="3339949">(</span><span class="ident" id="3339950">f</span>&nbsp;<span class="op" id="3339952">*</span><span class="ident" id="3339953">File</span><span class="op" id="3339957">)</span>&nbsp;<span class="ident" id="3339959">Base</span><span class="op" id="3339963">(</span><span class="op" id="3339964">)</span>&nbsp;<span class="builtintype" id="3339966">int</span>&nbsp;<span class="op" id="3339970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339973">return</span>&nbsp;<span class="ident" id="3339980">f</span><span class="op" id="3339981">.</span><span class="ident" id="3339982">base</span><br>
<span class="lineno">110</span><span class="op" id="3339987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3339990">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3340053">func</span>&nbsp;<span class="op" id="3340058">(</span><span class="ident" id="3340059">f</span>&nbsp;<span class="op" id="3340061">*</span><span class="ident" id="3340062">File</span><span class="op" id="3340066">)</span>&nbsp;<span class="ident" id="3340068">Size</span><span class="op" id="3340072">(</span><span class="op" id="3340073">)</span>&nbsp;<span class="builtintype" id="3340075">int</span>&nbsp;<span class="op" id="3340079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3340082">return</span>&nbsp;<span class="ident" id="3340089">f</span><span class="op" id="3340090">.</span><span class="ident" id="3340091">size</span><br>
<span class="lineno">115</span><span class="op" id="3340096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3340099">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="3340151">func</span>&nbsp;<span class="op" id="3340156">(</span><span class="ident" id="3340157">f</span>&nbsp;<span class="op" id="3340159">*</span><span class="ident" id="3340160">File</span><span class="op" id="3340164">)</span>&nbsp;<span class="ident" id="3340166">LineCount</span><span class="op" id="3340175">(</span><span class="op" id="3340176">)</span>&nbsp;<span class="builtintype" id="3340178">int</span>&nbsp;<span class="op" id="3340182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340185">f</span><span class="op" id="3340186">.</span><span class="ident" id="3340187">set</span><span class="op" id="3340190">.</span><span class="ident" id="3340191">mutex</span><span class="op" id="3340196">.</span><span class="ident" id="3340197">RLock</span><span class="op" id="3340202">(</span><span class="op" id="3340203">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340206">n</span>&nbsp;<span class="op" id="3340208">:=</span>&nbsp;<span class="builtinfunc" id="3340211">len</span><span class="op" id="3340214">(</span><span class="ident" id="3340215">f</span><span class="op" id="3340216">.</span><span class="ident" id="3340217">lines</span><span class="op" id="3340222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340225">f</span><span class="op" id="3340226">.</span><span class="ident" id="3340227">set</span><span class="op" id="3340230">.</span><span class="ident" id="3340231">mutex</span><span class="op" id="3340236">.</span><span class="ident" id="3340237">RUnlock</span><span class="op" id="3340244">(</span><span class="op" id="3340245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3340248">return</span>&nbsp;<span class="ident" id="3340255">n</span><br>
<span class="lineno"></span><span class="op" id="3340257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3340260">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3340308">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3340380">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3340453">//</span><br>
<span class="lineno"></span><span class="keyword" id="3340456">func</span>&nbsp;<span class="op" id="3340461">(</span><span class="ident" id="3340462">f</span>&nbsp;<span class="op" id="3340464">*</span><span class="ident" id="3340465">File</span><span class="op" id="3340469">)</span>&nbsp;<span class="ident" id="3340471">AddLine</span><span class="op" id="3340478">(</span><span class="ident" id="3340479">offset</span>&nbsp;<span class="builtintype" id="3340486">int</span><span class="op" id="3340489">)</span>&nbsp;<span class="op" id="3340491">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340494">f</span><span class="op" id="3340495">.</span><span class="ident" id="3340496">set</span><span class="op" id="3340499">.</span><span class="ident" id="3340500">mutex</span><span class="op" id="3340505">.</span><span class="ident" id="3340506">Lock</span><span class="op" id="3340510">(</span><span class="op" id="3340511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3340514">if</span>&nbsp;<span class="ident" id="3340517">i</span>&nbsp;<span class="op" id="3340519">:=</span>&nbsp;<span class="builtinfunc" id="3340522">len</span><span class="op" id="3340525">(</span><span class="ident" id="3340526">f</span><span class="op" id="3340527">.</span><span class="ident" id="3340528">lines</span><span class="op" id="3340533">)</span><span class="op" id="3340534">;</span>&nbsp;<span class="op" id="3340536">(</span><span class="ident" id="3340537">i</span>&nbsp;<span class="op" id="3340539">==</span>&nbsp;<span class="num" id="3340542">0</span>&nbsp;<span class="op" id="3340544">||</span>&nbsp;<span class="ident" id="3340547">f</span><span class="op" id="3340548">.</span><span class="ident" id="3340549">lines</span><span class="op" id="3340554">[</span><span class="ident" id="3340555">i</span><span class="op" id="3340556">-</span><span class="num" id="3340557">1</span><span class="op" id="3340558">]</span>&nbsp;<span class="op" id="3340560">&lt;</span>&nbsp;<span class="ident" id="3340562">offset</span><span class="op" id="3340568">)</span>&nbsp;<span class="op" id="3340570">&amp;&amp;</span>&nbsp;<span class="ident" id="3340573">offset</span>&nbsp;<span class="op" id="3340580">&lt;</span>&nbsp;<span class="ident" id="3340582">f</span><span class="op" id="3340583">.</span><span class="ident" id="3340584">size</span>&nbsp;<span class="op" id="3340589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340593">f</span><span class="op" id="3340594">.</span><span class="ident" id="3340595">lines</span>&nbsp;<span class="op" id="3340601">=</span>&nbsp;<span class="builtinfunc" id="3340603">append</span><span class="op" id="3340609">(</span><span class="ident" id="3340610">f</span><span class="op" id="3340611">.</span><span class="ident" id="3340612">lines</span><span class="op" id="3340617">,</span>&nbsp;<span class="ident" id="3340619">offset</span><span class="op" id="3340625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3340628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3340631">f</span><span class="op" id="3340632">.</span><span class="ident" id="3340633">set</span><span class="op" id="3340636">.</span><span class="ident" id="3340637">mutex</span><span class="op" id="3340642">.</span><span class="ident" id="3340643">Unlock</span><span class="op" id="3340649">(</span><span class="op" id="3340650">)</span><br>
<span class="lineno">135</span><span class="op" id="3340652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3340655">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="3340731">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3340811">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="3340889">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="3340946">//</span><br>
<span class="lineno"></span><span class="keyword" id="3340949">func</span>&nbsp;<span class="op" id="3340954">(</span><span class="ident" id="3340955">f</span>&nbsp;<span class="op" id="3340957">*</span><span class="ident" id="3340958">File</span><span class="op" id="3340962">)</span>&nbsp;<span class="ident" id="3340964">MergeLine</span><span class="op" id="3340973">(</span><span class="ident" id="3340974">line</span>&nbsp;<span class="builtintype" id="3340979">int</span><span class="op" id="3340982">)</span>&nbsp;<span class="op" id="3340984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3340987">if</span>&nbsp;<span class="ident" id="3340990">line</span>&nbsp;<span class="op" id="3340995">&lt;=</span>&nbsp;<span class="num" id="3340998">0</span>&nbsp;<span class="op" id="3341000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3341004">panic</span><span class="op" id="3341009">(</span><span class="string" id="3341010">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="3341060">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341066">f</span><span class="op" id="3341067">.</span><span class="ident" id="3341068">set</span><span class="op" id="3341071">.</span><span class="ident" id="3341072">mutex</span><span class="op" id="3341077">.</span><span class="ident" id="3341078">Lock</span><span class="op" id="3341082">(</span><span class="op" id="3341083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341086">defer</span>&nbsp;<span class="ident" id="3341092">f</span><span class="op" id="3341093">.</span><span class="ident" id="3341094">set</span><span class="op" id="3341097">.</span><span class="ident" id="3341098">mutex</span><span class="op" id="3341103">.</span><span class="ident" id="3341104">Unlock</span><span class="op" id="3341110">(</span><span class="op" id="3341111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3341114">if</span>&nbsp;<span class="ident" id="3341117">line</span>&nbsp;<span class="op" id="3341122">&gt;=</span>&nbsp;<span class="builtinfunc" id="3341125">len</span><span class="op" id="3341128">(</span><span class="ident" id="3341129">f</span><span class="op" id="3341130">.</span><span class="ident" id="3341131">lines</span><span class="op" id="3341136">)</span>&nbsp;<span class="op" id="3341138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3341142">panic</span><span class="op" id="3341147">(</span><span class="string" id="3341148">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="3341169">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3341172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3341175">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3341246">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3341313">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3341381">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3341454">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3341500">copy</span><span class="op" id="3341504">(</span><span class="ident" id="3341505">f</span><span class="op" id="3341506">.</span><span class="ident" id="3341507">lines</span><span class="op" id="3341512">[</span><span class="ident" id="3341513">line</span><span class="op" id="3341517">:</span><span class="op" id="3341518">]</span><span class="op" id="3341519">,</span>&nbsp;<span class="ident" id="3341521">f</span><span class="op" id="3341522">.</span><span class="ident" id="3341523">lines</span><span class="op" id="3341528">[</span><span class="ident" id="3341529">line</span><span class="op" id="3341533">+</span><span class="num" id="3341534">1</span><span class="op" id="3341535">:</span><span class="op" id="3341536">]</span><span class="op" id="3341537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3341540">f</span><span class="op" id="3341541">.</span><span class="ident" id="3341542">lines</span>&nbsp;<span class="op" id="3341548">=</span>&nbsp;<span class="ident" id="3341550">f</span><span class="op" id="3341551">.</span><span class="ident" id="3341552">lines</span><span class="op" id="3341557">[</span><span class="op" id="3341558">:</span><span class="builtinfunc" id="3341559">len</span><span class="op" id="3341562">(</span><span class="ident" id="3341563">f</span><span class="op" id="3341564">.</span><span class="ident" id="3341565">lines</span><span class="op" id="3341570">)</span><span class="op" id="3341571">-</span><span class="num" id="3341572">1</span><span class="op" id="3341573">]</span><br>
<span class="lineno"></span><span class="op" id="3341575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3341578">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="3341655">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="3341728">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="3341799">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="3341848">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="3341921">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3341993">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3342003">//</span><br>
<span class="lineno"></span><span class="keyword" id="3342006">func</span>&nbsp;<span class="op" id="3342011">(</span><span class="ident" id="3342012">f</span>&nbsp;<span class="op" id="3342014">*</span><span class="ident" id="3342015">File</span><span class="op" id="3342019">)</span>&nbsp;<span class="ident" id="3342021">SetLines</span><span class="op" id="3342029">(</span><span class="ident" id="3342030">lines</span>&nbsp;<span class="op" id="3342036">[</span><span class="op" id="3342037">]</span><span class="builtintype" id="3342038">int</span><span class="op" id="3342041">)</span>&nbsp;<span class="builtintype" id="3342043">bool</span>&nbsp;<span class="op" id="3342048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342051">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342086">size</span>&nbsp;<span class="op" id="3342091">:=</span>&nbsp;<span class="ident" id="3342094">f</span><span class="op" id="3342095">.</span><span class="ident" id="3342096">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342102">for</span>&nbsp;<span class="ident" id="3342106">i</span><span class="op" id="3342107">,</span>&nbsp;<span class="ident" id="3342109">offset</span>&nbsp;<span class="op" id="3342116">:=</span>&nbsp;<span class="keyword" id="3342119">range</span>&nbsp;<span class="ident" id="3342125">lines</span>&nbsp;<span class="op" id="3342131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342135">if</span>&nbsp;<span class="ident" id="3342138">i</span>&nbsp;<span class="op" id="3342140">&gt;</span>&nbsp;<span class="num" id="3342142">0</span>&nbsp;<span class="op" id="3342144">&amp;&amp;</span>&nbsp;<span class="ident" id="3342147">offset</span>&nbsp;<span class="op" id="3342154">&lt;=</span>&nbsp;<span class="ident" id="3342157">lines</span><span class="op" id="3342162">[</span><span class="ident" id="3342163">i</span><span class="op" id="3342164">-</span><span class="num" id="3342165">1</span><span class="op" id="3342166">]</span>&nbsp;<span class="op" id="3342168">||</span>&nbsp;<span class="ident" id="3342171">size</span>&nbsp;<span class="op" id="3342176">&lt;=</span>&nbsp;<span class="ident" id="3342179">offset</span>&nbsp;<span class="op" id="3342186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342191">return</span>&nbsp;<span class="builtintype" id="3342198">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342206">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342213">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342233">f</span><span class="op" id="3342234">.</span><span class="ident" id="3342235">set</span><span class="op" id="3342238">.</span><span class="ident" id="3342239">mutex</span><span class="op" id="3342244">.</span><span class="ident" id="3342245">Lock</span><span class="op" id="3342249">(</span><span class="op" id="3342250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342253">f</span><span class="op" id="3342254">.</span><span class="ident" id="3342255">lines</span>&nbsp;<span class="op" id="3342261">=</span>&nbsp;<span class="ident" id="3342263">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342270">f</span><span class="op" id="3342271">.</span><span class="ident" id="3342272">set</span><span class="op" id="3342275">.</span><span class="ident" id="3342276">mutex</span><span class="op" id="3342281">.</span><span class="ident" id="3342282">Unlock</span><span class="op" id="3342288">(</span><span class="op" id="3342289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342292">return</span>&nbsp;<span class="builtintype" id="3342299">true</span><br>
<span class="lineno"></span><span class="op" id="3342304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3342307">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="3342379">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="3342428">func</span>&nbsp;<span class="op" id="3342433">(</span><span class="ident" id="3342434">f</span>&nbsp;<span class="op" id="3342436">*</span><span class="ident" id="3342437">File</span><span class="op" id="3342441">)</span>&nbsp;<span class="ident" id="3342443">SetLinesForContent</span><span class="op" id="3342461">(</span><span class="ident" id="3342462">content</span>&nbsp;<span class="op" id="3342470">[</span><span class="op" id="3342471">]</span><span class="builtintype" id="3342472">byte</span><span class="op" id="3342476">)</span>&nbsp;<span class="op" id="3342478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342481">var</span>&nbsp;<span class="ident" id="3342485">lines</span>&nbsp;<span class="op" id="3342491">[</span><span class="op" id="3342492">]</span><span class="builtintype" id="3342493">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342498">line</span>&nbsp;<span class="op" id="3342503">:=</span>&nbsp;<span class="num" id="3342506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342509">for</span>&nbsp;<span class="ident" id="3342513">offset</span><span class="op" id="3342519">,</span>&nbsp;<span class="ident" id="3342521">b</span>&nbsp;<span class="op" id="3342523">:=</span>&nbsp;<span class="keyword" id="3342526">range</span>&nbsp;<span class="ident" id="3342532">content</span>&nbsp;<span class="op" id="3342540">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342544">if</span>&nbsp;<span class="ident" id="3342547">line</span>&nbsp;<span class="op" id="3342552">&gt;=</span>&nbsp;<span class="num" id="3342555">0</span>&nbsp;<span class="op" id="3342557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342562">lines</span>&nbsp;<span class="op" id="3342568">=</span>&nbsp;<span class="builtinfunc" id="3342570">append</span><span class="op" id="3342576">(</span><span class="ident" id="3342577">lines</span><span class="op" id="3342582">,</span>&nbsp;<span class="ident" id="3342584">line</span><span class="op" id="3342588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342596">line</span>&nbsp;<span class="op" id="3342601">=</span>&nbsp;<span class="op" id="3342603">-</span><span class="num" id="3342604">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3342608">if</span>&nbsp;<span class="ident" id="3342611">b</span>&nbsp;<span class="op" id="3342613">==</span>&nbsp;<span class="string" id="3342616">&#39;\n&#39;</span>&nbsp;<span class="op" id="3342621">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342626">line</span>&nbsp;<span class="op" id="3342631">=</span>&nbsp;<span class="ident" id="3342633">offset</span>&nbsp;<span class="op" id="3342640">+</span>&nbsp;<span class="num" id="3342642">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3342649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342653">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342673">f</span><span class="op" id="3342674">.</span><span class="ident" id="3342675">set</span><span class="op" id="3342678">.</span><span class="ident" id="3342679">mutex</span><span class="op" id="3342684">.</span><span class="ident" id="3342685">Lock</span><span class="op" id="3342689">(</span><span class="op" id="3342690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342693">f</span><span class="op" id="3342694">.</span><span class="ident" id="3342695">lines</span>&nbsp;<span class="op" id="3342701">=</span>&nbsp;<span class="ident" id="3342703">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342710">f</span><span class="op" id="3342711">.</span><span class="ident" id="3342712">set</span><span class="op" id="3342715">.</span><span class="ident" id="3342716">mutex</span><span class="op" id="3342721">.</span><span class="ident" id="3342722">Unlock</span><span class="op" id="3342728">(</span><span class="op" id="3342729">)</span><br>
<span class="lineno"></span><span class="op" id="3342731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3342734">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3342798">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="3342861">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="3342895">type</span>&nbsp;<span class="ident" id="3342900">lineInfo</span>&nbsp;<span class="keyword" id="3342909">struct</span>&nbsp;<span class="op" id="3342916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3342919">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342974">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3342983">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3342988">Filename</span>&nbsp;<span class="builtintype" id="3342997">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343005">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3343014">int</span><br>
<span class="lineno"></span><span class="op" id="3343018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3343021">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3343090">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3343160">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3343227">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3343279">//</span><br>
<span class="lineno">220</span><span class="comment" id="3343282">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3343348">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3343414">//</span><br>
<span class="lineno"></span><span class="keyword" id="3343417">func</span>&nbsp;<span class="op" id="3343422">(</span><span class="ident" id="3343423">f</span>&nbsp;<span class="op" id="3343425">*</span><span class="ident" id="3343426">File</span><span class="op" id="3343430">)</span>&nbsp;<span class="ident" id="3343432">AddLineInfo</span><span class="op" id="3343443">(</span><span class="ident" id="3343444">offset</span>&nbsp;<span class="builtintype" id="3343451">int</span><span class="op" id="3343454">,</span>&nbsp;<span class="ident" id="3343456">filename</span>&nbsp;<span class="builtintype" id="3343465">string</span><span class="op" id="3343471">,</span>&nbsp;<span class="ident" id="3343473">line</span>&nbsp;<span class="builtintype" id="3343478">int</span><span class="op" id="3343481">)</span>&nbsp;<span class="op" id="3343483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343486">f</span><span class="op" id="3343487">.</span><span class="ident" id="3343488">set</span><span class="op" id="3343491">.</span><span class="ident" id="3343492">mutex</span><span class="op" id="3343497">.</span><span class="ident" id="3343498">Lock</span><span class="op" id="3343502">(</span><span class="op" id="3343503">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343506">if</span>&nbsp;<span class="ident" id="3343509">i</span>&nbsp;<span class="op" id="3343511">:=</span>&nbsp;<span class="builtinfunc" id="3343514">len</span><span class="op" id="3343517">(</span><span class="ident" id="3343518">f</span><span class="op" id="3343519">.</span><span class="ident" id="3343520">infos</span><span class="op" id="3343525">)</span><span class="op" id="3343526">;</span>&nbsp;<span class="ident" id="3343528">i</span>&nbsp;<span class="op" id="3343530">==</span>&nbsp;<span class="num" id="3343533">0</span>&nbsp;<span class="op" id="3343535">||</span>&nbsp;<span class="ident" id="3343538">f</span><span class="op" id="3343539">.</span><span class="ident" id="3343540">infos</span><span class="op" id="3343545">[</span><span class="ident" id="3343546">i</span><span class="op" id="3343547">-</span><span class="num" id="3343548">1</span><span class="op" id="3343549">]</span><span class="op" id="3343550">.</span><span class="ident" id="3343551">Offset</span>&nbsp;<span class="op" id="3343558">&lt;</span>&nbsp;<span class="ident" id="3343560">offset</span>&nbsp;<span class="op" id="3343567">&amp;&amp;</span>&nbsp;<span class="ident" id="3343570">offset</span>&nbsp;<span class="op" id="3343577">&lt;</span>&nbsp;<span class="ident" id="3343579">f</span><span class="op" id="3343580">.</span><span class="ident" id="3343581">size</span>&nbsp;<span class="op" id="3343586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343590">f</span><span class="op" id="3343591">.</span><span class="ident" id="3343592">infos</span>&nbsp;<span class="op" id="3343598">=</span>&nbsp;<span class="builtinfunc" id="3343600">append</span><span class="op" id="3343606">(</span><span class="ident" id="3343607">f</span><span class="op" id="3343608">.</span><span class="ident" id="3343609">infos</span><span class="op" id="3343614">,</span>&nbsp;<span class="ident" id="3343616">lineInfo</span><span class="op" id="3343624">{</span><span class="ident" id="3343625">offset</span><span class="op" id="3343631">,</span>&nbsp;<span class="ident" id="3343633">filename</span><span class="op" id="3343641">,</span>&nbsp;<span class="ident" id="3343643">line</span><span class="op" id="3343647">}</span><span class="op" id="3343648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3343654">f</span><span class="op" id="3343655">.</span><span class="ident" id="3343656">set</span><span class="op" id="3343659">.</span><span class="ident" id="3343660">mutex</span><span class="op" id="3343665">.</span><span class="ident" id="3343666">Unlock</span><span class="op" id="3343672">(</span><span class="op" id="3343673">)</span><br>
<span class="lineno"></span><span class="op" id="3343675">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3343678">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="3343734">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="3343769">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3343797">//</span><br>
<span class="lineno">235</span><span class="keyword" id="3343800">func</span>&nbsp;<span class="op" id="3343805">(</span><span class="ident" id="3343806">f</span>&nbsp;<span class="op" id="3343808">*</span><span class="ident" id="3343809">File</span><span class="op" id="3343813">)</span>&nbsp;<span class="ident" id="3343815">Pos</span><span class="op" id="3343818">(</span><span class="ident" id="3343819">offset</span>&nbsp;<span class="builtintype" id="3343826">int</span><span class="op" id="3343829">)</span>&nbsp;<span class="ident" id="3343831">Pos</span>&nbsp;<span class="op" id="3343835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343838">if</span>&nbsp;<span class="ident" id="3343841">offset</span>&nbsp;<span class="op" id="3343848">&gt;</span>&nbsp;<span class="ident" id="3343850">f</span><span class="op" id="3343851">.</span><span class="ident" id="3343852">size</span>&nbsp;<span class="op" id="3343857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3343861">panic</span><span class="op" id="3343866">(</span><span class="string" id="3343867">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="3343888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3343891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3343894">return</span>&nbsp;<span class="ident" id="3343901">Pos</span><span class="op" id="3343904">(</span><span class="ident" id="3343905">f</span><span class="op" id="3343906">.</span><span class="ident" id="3343907">base</span>&nbsp;<span class="op" id="3343912">+</span>&nbsp;<span class="ident" id="3343914">offset</span><span class="op" id="3343920">)</span><br>
<span class="lineno">240</span><span class="op" id="3343922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3343925">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3343985">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3344030">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="3344068">//</span><br>
<span class="lineno"></span><span class="keyword" id="3344071">func</span>&nbsp;<span class="op" id="3344076">(</span><span class="ident" id="3344077">f</span>&nbsp;<span class="op" id="3344079">*</span><span class="ident" id="3344080">File</span><span class="op" id="3344084">)</span>&nbsp;<span class="ident" id="3344086">Offset</span><span class="op" id="3344092">(</span><span class="ident" id="3344093">p</span>&nbsp;<span class="ident" id="3344095">Pos</span><span class="op" id="3344098">)</span>&nbsp;<span class="builtintype" id="3344100">int</span>&nbsp;<span class="op" id="3344104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344107">if</span>&nbsp;<span class="builtintype" id="3344110">int</span><span class="op" id="3344113">(</span><span class="ident" id="3344114">p</span><span class="op" id="3344115">)</span>&nbsp;<span class="op" id="3344117">&lt;</span>&nbsp;<span class="ident" id="3344119">f</span><span class="op" id="3344120">.</span><span class="ident" id="3344121">base</span>&nbsp;<span class="op" id="3344126">||</span>&nbsp;<span class="builtintype" id="3344129">int</span><span class="op" id="3344132">(</span><span class="ident" id="3344133">p</span><span class="op" id="3344134">)</span>&nbsp;<span class="op" id="3344136">&gt;</span>&nbsp;<span class="ident" id="3344138">f</span><span class="op" id="3344139">.</span><span class="ident" id="3344140">base</span><span class="op" id="3344144">+</span><span class="ident" id="3344145">f</span><span class="op" id="3344146">.</span><span class="ident" id="3344147">size</span>&nbsp;<span class="op" id="3344152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3344156">panic</span><span class="op" id="3344161">(</span><span class="string" id="3344162">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3344181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344184">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344187">return</span>&nbsp;<span class="builtintype" id="3344194">int</span><span class="op" id="3344197">(</span><span class="ident" id="3344198">p</span><span class="op" id="3344199">)</span>&nbsp;<span class="op" id="3344201">-</span>&nbsp;<span class="ident" id="3344203">f</span><span class="op" id="3344204">.</span><span class="ident" id="3344205">base</span><br>
<span class="lineno"></span><span class="op" id="3344210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3344213">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3344276">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="3344324">//</span><br>
<span class="lineno"></span><span class="keyword" id="3344327">func</span>&nbsp;<span class="op" id="3344332">(</span><span class="ident" id="3344333">f</span>&nbsp;<span class="op" id="3344335">*</span><span class="ident" id="3344336">File</span><span class="op" id="3344340">)</span>&nbsp;<span class="ident" id="3344342">Line</span><span class="op" id="3344346">(</span><span class="ident" id="3344347">p</span>&nbsp;<span class="ident" id="3344349">Pos</span><span class="op" id="3344352">)</span>&nbsp;<span class="builtintype" id="3344354">int</span>&nbsp;<span class="op" id="3344358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344361">return</span>&nbsp;<span class="ident" id="3344368">f</span><span class="op" id="3344369">.</span><span class="ident" id="3344370">Position</span><span class="op" id="3344378">(</span><span class="ident" id="3344379">p</span><span class="op" id="3344380">)</span><span class="op" id="3344381">.</span><span class="ident" id="3344382">Line</span><br>
<span class="lineno"></span><span class="op" id="3344387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3344390">func</span>&nbsp;<span class="ident" id="3344395">searchLineInfos</span><span class="op" id="3344410">(</span><span class="ident" id="3344411">a</span>&nbsp;<span class="op" id="3344413">[</span><span class="op" id="3344414">]</span><span class="ident" id="3344415">lineInfo</span><span class="op" id="3344423">,</span>&nbsp;<span class="ident" id="3344425">x</span>&nbsp;<span class="builtintype" id="3344427">int</span><span class="op" id="3344430">)</span>&nbsp;<span class="builtintype" id="3344432">int</span>&nbsp;<span class="op" id="3344436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344439">return</span>&nbsp;<span class="ident" id="3344446">sort</span><span class="op" id="3344450">.</span><span class="ident" id="3344451">Search</span><span class="op" id="3344457">(</span><span class="builtinfunc" id="3344458">len</span><span class="op" id="3344461">(</span><span class="ident" id="3344462">a</span><span class="op" id="3344463">)</span><span class="op" id="3344464">,</span>&nbsp;<span class="keyword" id="3344466">func</span><span class="op" id="3344470">(</span><span class="ident" id="3344471">i</span>&nbsp;<span class="builtintype" id="3344473">int</span><span class="op" id="3344476">)</span>&nbsp;<span class="builtintype" id="3344478">bool</span>&nbsp;<span class="op" id="3344483">{</span>&nbsp;<span class="keyword" id="3344485">return</span>&nbsp;<span class="ident" id="3344492">a</span><span class="op" id="3344493">[</span><span class="ident" id="3344494">i</span><span class="op" id="3344495">]</span><span class="op" id="3344496">.</span><span class="ident" id="3344497">Offset</span>&nbsp;<span class="op" id="3344504">&gt;</span>&nbsp;<span class="ident" id="3344506">x</span>&nbsp;<span class="op" id="3344508">}</span><span class="op" id="3344509">)</span>&nbsp;<span class="op" id="3344511">-</span>&nbsp;<span class="num" id="3344513">1</span><br>
<span class="lineno"></span><span class="op" id="3344515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3344518">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="3344595">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3344671">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3344750">//</span><br>
<span class="lineno"></span><span class="keyword" id="3344753">func</span>&nbsp;<span class="op" id="3344758">(</span><span class="ident" id="3344759">f</span>&nbsp;<span class="op" id="3344761">*</span><span class="ident" id="3344762">File</span><span class="op" id="3344766">)</span>&nbsp;<span class="ident" id="3344768">unpack</span><span class="op" id="3344774">(</span><span class="ident" id="3344775">offset</span>&nbsp;<span class="builtintype" id="3344782">int</span><span class="op" id="3344785">,</span>&nbsp;<span class="ident" id="3344787">adjusted</span>&nbsp;<span class="builtintype" id="3344796">bool</span><span class="op" id="3344800">)</span>&nbsp;<span class="op" id="3344802">(</span><span class="ident" id="3344803">filename</span>&nbsp;<span class="builtintype" id="3344812">string</span><span class="op" id="3344818">,</span>&nbsp;<span class="ident" id="3344820">line</span><span class="op" id="3344824">,</span>&nbsp;<span class="ident" id="3344826">column</span>&nbsp;<span class="builtintype" id="3344833">int</span><span class="op" id="3344836">)</span>&nbsp;<span class="op" id="3344838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344841">filename</span>&nbsp;<span class="op" id="3344850">=</span>&nbsp;<span class="ident" id="3344852">f</span><span class="op" id="3344853">.</span><span class="ident" id="3344854">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344860">if</span>&nbsp;<span class="ident" id="3344863">i</span>&nbsp;<span class="op" id="3344865">:=</span>&nbsp;<span class="ident" id="3344868">searchInts</span><span class="op" id="3344878">(</span><span class="ident" id="3344879">f</span><span class="op" id="3344880">.</span><span class="ident" id="3344881">lines</span><span class="op" id="3344886">,</span>&nbsp;<span class="ident" id="3344888">offset</span><span class="op" id="3344894">)</span><span class="op" id="3344895">;</span>&nbsp;<span class="ident" id="3344897">i</span>&nbsp;<span class="op" id="3344899">&gt;=</span>&nbsp;<span class="num" id="3344902">0</span>&nbsp;<span class="op" id="3344904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3344908">line</span><span class="op" id="3344912">,</span>&nbsp;<span class="ident" id="3344914">column</span>&nbsp;<span class="op" id="3344921">=</span>&nbsp;<span class="ident" id="3344923">i</span><span class="op" id="3344924">+</span><span class="num" id="3344925">1</span><span class="op" id="3344926">,</span>&nbsp;<span class="ident" id="3344928">offset</span><span class="op" id="3344934">-</span><span class="ident" id="3344935">f</span><span class="op" id="3344936">.</span><span class="ident" id="3344937">lines</span><span class="op" id="3344942">[</span><span class="ident" id="3344943">i</span><span class="op" id="3344944">]</span><span class="op" id="3344945">+</span><span class="num" id="3344946">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3344949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3344952">if</span>&nbsp;<span class="ident" id="3344955">adjusted</span>&nbsp;<span class="op" id="3344964">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3344967">len</span><span class="op" id="3344970">(</span><span class="ident" id="3344971">f</span><span class="op" id="3344972">.</span><span class="ident" id="3344973">infos</span><span class="op" id="3344978">)</span>&nbsp;<span class="op" id="3344980">&gt;</span>&nbsp;<span class="num" id="3344982">0</span>&nbsp;<span class="op" id="3344984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3344988">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345031">if</span>&nbsp;<span class="ident" id="3345034">i</span>&nbsp;<span class="op" id="3345036">:=</span>&nbsp;<span class="ident" id="3345039">searchLineInfos</span><span class="op" id="3345054">(</span><span class="ident" id="3345055">f</span><span class="op" id="3345056">.</span><span class="ident" id="3345057">infos</span><span class="op" id="3345062">,</span>&nbsp;<span class="ident" id="3345064">offset</span><span class="op" id="3345070">)</span><span class="op" id="3345071">;</span>&nbsp;<span class="ident" id="3345073">i</span>&nbsp;<span class="op" id="3345075">&gt;=</span>&nbsp;<span class="num" id="3345078">0</span>&nbsp;<span class="op" id="3345080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345085">alt</span>&nbsp;<span class="op" id="3345089">:=</span>&nbsp;<span class="op" id="3345092">&amp;</span><span class="ident" id="3345093">f</span><span class="op" id="3345094">.</span><span class="ident" id="3345095">infos</span><span class="op" id="3345100">[</span><span class="ident" id="3345101">i</span><span class="op" id="3345102">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345107">filename</span>&nbsp;<span class="op" id="3345116">=</span>&nbsp;<span class="ident" id="3345118">alt</span><span class="op" id="3345121">.</span><span class="ident" id="3345122">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345134">if</span>&nbsp;<span class="ident" id="3345137">i</span>&nbsp;<span class="op" id="3345139">:=</span>&nbsp;<span class="ident" id="3345142">searchInts</span><span class="op" id="3345152">(</span><span class="ident" id="3345153">f</span><span class="op" id="3345154">.</span><span class="ident" id="3345155">lines</span><span class="op" id="3345160">,</span>&nbsp;<span class="ident" id="3345162">alt</span><span class="op" id="3345165">.</span><span class="ident" id="3345166">Offset</span><span class="op" id="3345172">)</span><span class="op" id="3345173">;</span>&nbsp;<span class="ident" id="3345175">i</span>&nbsp;<span class="op" id="3345177">&gt;=</span>&nbsp;<span class="num" id="3345180">0</span>&nbsp;<span class="op" id="3345182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345188">line</span>&nbsp;<span class="op" id="3345193">+=</span>&nbsp;<span class="ident" id="3345196">alt</span><span class="op" id="3345199">.</span><span class="ident" id="3345200">Line</span>&nbsp;<span class="op" id="3345205">-</span>&nbsp;<span class="ident" id="3345207">i</span>&nbsp;<span class="op" id="3345209">-</span>&nbsp;<span class="num" id="3345211">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345226">return</span><br>
<span class="lineno"></span><span class="op" id="3345233">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3345236">func</span>&nbsp;<span class="op" id="3345241">(</span><span class="ident" id="3345242">f</span>&nbsp;<span class="op" id="3345244">*</span><span class="ident" id="3345245">File</span><span class="op" id="3345249">)</span>&nbsp;<span class="ident" id="3345251">position</span><span class="op" id="3345259">(</span><span class="ident" id="3345260">p</span>&nbsp;<span class="ident" id="3345262">Pos</span><span class="op" id="3345265">,</span>&nbsp;<span class="ident" id="3345267">adjusted</span>&nbsp;<span class="builtintype" id="3345276">bool</span><span class="op" id="3345280">)</span>&nbsp;<span class="op" id="3345282">(</span><span class="ident" id="3345283">pos</span>&nbsp;<span class="ident" id="3345287">Position</span><span class="op" id="3345295">)</span>&nbsp;<span class="op" id="3345297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345300">offset</span>&nbsp;<span class="op" id="3345307">:=</span>&nbsp;<span class="builtintype" id="3345310">int</span><span class="op" id="3345313">(</span><span class="ident" id="3345314">p</span><span class="op" id="3345315">)</span>&nbsp;<span class="op" id="3345317">-</span>&nbsp;<span class="ident" id="3345319">f</span><span class="op" id="3345320">.</span><span class="ident" id="3345321">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345327">pos</span><span class="op" id="3345330">.</span><span class="ident" id="3345331">Offset</span>&nbsp;<span class="op" id="3345338">=</span>&nbsp;<span class="ident" id="3345340">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345348">pos</span><span class="op" id="3345351">.</span><span class="ident" id="3345352">Filename</span><span class="op" id="3345360">,</span>&nbsp;<span class="ident" id="3345362">pos</span><span class="op" id="3345365">.</span><span class="ident" id="3345366">Line</span><span class="op" id="3345370">,</span>&nbsp;<span class="ident" id="3345372">pos</span><span class="op" id="3345375">.</span><span class="ident" id="3345376">Column</span>&nbsp;<span class="op" id="3345383">=</span>&nbsp;<span class="ident" id="3345385">f</span><span class="op" id="3345386">.</span><span class="ident" id="3345387">unpack</span><span class="op" id="3345393">(</span><span class="ident" id="3345394">offset</span><span class="op" id="3345400">,</span>&nbsp;<span class="ident" id="3345402">adjusted</span><span class="op" id="3345410">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345413">return</span><br>
<span class="lineno"></span><span class="op" id="3345420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3345423">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3345496">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="3345569">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3345627">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3345667">//</span><br>
<span class="lineno"></span><span class="keyword" id="3345670">func</span>&nbsp;<span class="op" id="3345675">(</span><span class="ident" id="3345676">f</span>&nbsp;<span class="op" id="3345678">*</span><span class="ident" id="3345679">File</span><span class="op" id="3345683">)</span>&nbsp;<span class="ident" id="3345685">PositionFor</span><span class="op" id="3345696">(</span><span class="ident" id="3345697">p</span>&nbsp;<span class="ident" id="3345699">Pos</span><span class="op" id="3345702">,</span>&nbsp;<span class="ident" id="3345704">adjusted</span>&nbsp;<span class="builtintype" id="3345713">bool</span><span class="op" id="3345717">)</span>&nbsp;<span class="op" id="3345719">(</span><span class="ident" id="3345720">pos</span>&nbsp;<span class="ident" id="3345724">Position</span><span class="op" id="3345732">)</span>&nbsp;<span class="op" id="3345734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345737">if</span>&nbsp;<span class="ident" id="3345740">p</span>&nbsp;<span class="op" id="3345742">!=</span>&nbsp;<span class="ident" id="3345745">NoPos</span>&nbsp;<span class="op" id="3345751">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345755">if</span>&nbsp;<span class="builtintype" id="3345758">int</span><span class="op" id="3345761">(</span><span class="ident" id="3345762">p</span><span class="op" id="3345763">)</span>&nbsp;<span class="op" id="3345765">&lt;</span>&nbsp;<span class="ident" id="3345767">f</span><span class="op" id="3345768">.</span><span class="ident" id="3345769">base</span>&nbsp;<span class="op" id="3345774">||</span>&nbsp;<span class="builtintype" id="3345777">int</span><span class="op" id="3345780">(</span><span class="ident" id="3345781">p</span><span class="op" id="3345782">)</span>&nbsp;<span class="op" id="3345784">&gt;</span>&nbsp;<span class="ident" id="3345786">f</span><span class="op" id="3345787">.</span><span class="ident" id="3345788">base</span><span class="op" id="3345792">+</span><span class="ident" id="3345793">f</span><span class="op" id="3345794">.</span><span class="ident" id="3345795">size</span>&nbsp;<span class="op" id="3345800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3345805">panic</span><span class="op" id="3345810">(</span><span class="string" id="3345811">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3345830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345838">pos</span>&nbsp;<span class="op" id="3345842">=</span>&nbsp;<span class="ident" id="3345844">f</span><span class="op" id="3345845">.</span><span class="ident" id="3345846">position</span><span class="op" id="3345854">(</span><span class="ident" id="3345855">p</span><span class="op" id="3345856">,</span>&nbsp;<span class="ident" id="3345858">adjusted</span><span class="op" id="3345866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345869">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345872">return</span><br>
<span class="lineno"></span><span class="op" id="3345879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3345882">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3345952">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="3346026">//</span><br>
<span class="lineno"></span><span class="keyword" id="3346029">func</span>&nbsp;<span class="op" id="3346034">(</span><span class="ident" id="3346035">f</span>&nbsp;<span class="op" id="3346037">*</span><span class="ident" id="3346038">File</span><span class="op" id="3346042">)</span>&nbsp;<span class="ident" id="3346044">Position</span><span class="op" id="3346052">(</span><span class="ident" id="3346053">p</span>&nbsp;<span class="ident" id="3346055">Pos</span><span class="op" id="3346058">)</span>&nbsp;<span class="op" id="3346060">(</span><span class="ident" id="3346061">pos</span>&nbsp;<span class="ident" id="3346065">Position</span><span class="op" id="3346073">)</span>&nbsp;<span class="op" id="3346075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346078">return</span>&nbsp;<span class="ident" id="3346085">f</span><span class="op" id="3346086">.</span><span class="ident" id="3346087">PositionFor</span><span class="op" id="3346098">(</span><span class="ident" id="3346099">p</span><span class="op" id="3346100">,</span>&nbsp;<span class="builtintype" id="3346102">true</span><span class="op" id="3346106">)</span><br>
<span class="lineno"></span><span class="op" id="3346108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3346111">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3346192">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346204">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3346251">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="3346313">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="3346346">//</span><br>
<span class="lineno"></span><span class="keyword" id="3346349">type</span>&nbsp;<span class="ident" id="3346354">FileSet</span>&nbsp;<span class="keyword" id="3346362">struct</span>&nbsp;<span class="op" id="3346369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346372">mutex</span>&nbsp;<span class="ident" id="3346378">sync</span><span class="op" id="3346382">.</span><span class="ident" id="3346383">RWMutex</span>&nbsp;<span class="comment" id="3346391">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346417">base</span>&nbsp;&nbsp;<span class="builtintype" id="3346423">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346436">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346470">files</span>&nbsp;<span class="op" id="3346476">[</span><span class="op" id="3346477">]</span><span class="op" id="3346478">*</span><span class="ident" id="3346479">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346489">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346537">last</span>&nbsp;&nbsp;<span class="op" id="3346543">*</span><span class="ident" id="3346544">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346556">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="3346588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346591">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="3346629">func</span>&nbsp;<span class="ident" id="3346634">NewFileSet</span><span class="op" id="3346644">(</span><span class="op" id="3346645">)</span>&nbsp;<span class="op" id="3346647">*</span><span class="ident" id="3346648">FileSet</span>&nbsp;<span class="op" id="3346656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346659">return</span>&nbsp;<span class="op" id="3346666">&amp;</span><span class="ident" id="3346667">FileSet</span><span class="op" id="3346674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346678">base</span><span class="op" id="3346682">:</span>&nbsp;<span class="num" id="3346684">1</span><span class="op" id="3346685">,</span>&nbsp;<span class="comment" id="3346687">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346702">}</span><br>
<span class="lineno"></span><span class="op" id="3346704">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="3346707">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3346772">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3346810">//</span><br>
<span class="lineno"></span><span class="keyword" id="3346813">func</span>&nbsp;<span class="op" id="3346818">(</span><span class="ident" id="3346819">s</span>&nbsp;<span class="op" id="3346821">*</span><span class="ident" id="3346822">FileSet</span><span class="op" id="3346829">)</span>&nbsp;<span class="ident" id="3346831">Base</span><span class="op" id="3346835">(</span><span class="op" id="3346836">)</span>&nbsp;<span class="builtintype" id="3346838">int</span>&nbsp;<span class="op" id="3346842">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346845">s</span><span class="op" id="3346846">.</span><span class="ident" id="3346847">mutex</span><span class="op" id="3346852">.</span><span class="ident" id="3346853">RLock</span><span class="op" id="3346858">(</span><span class="op" id="3346859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346862">b</span>&nbsp;<span class="op" id="3346864">:=</span>&nbsp;<span class="ident" id="3346867">s</span><span class="op" id="3346868">.</span><span class="ident" id="3346869">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346875">s</span><span class="op" id="3346876">.</span><span class="ident" id="3346877">mutex</span><span class="op" id="3346882">.</span><span class="ident" id="3346883">RUnlock</span><span class="op" id="3346890">(</span><span class="op" id="3346891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346894">return</span>&nbsp;<span class="ident" id="3346901">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="3346904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346907">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="3346984">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3347060">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="3347136">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="3347217">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3347279">//</span><br>
<span class="lineno"></span><span class="comment" id="3347282">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3347357">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="3347432">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="3347494">//</span><br>
<span class="lineno"></span><span class="comment" id="3347497">//&nbsp;&nbsp;&nbsp;&nbsp;int(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="3347521">//</span><br>
<span class="lineno"></span><span class="comment" id="3347524">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="3347603">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3347677">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3347707">//</span><br>
<span class="lineno"></span><span class="keyword" id="3347710">func</span>&nbsp;<span class="op" id="3347715">(</span><span class="ident" id="3347716">s</span>&nbsp;<span class="op" id="3347718">*</span><span class="ident" id="3347719">FileSet</span><span class="op" id="3347726">)</span>&nbsp;<span class="ident" id="3347728">AddFile</span><span class="op" id="3347735">(</span><span class="ident" id="3347736">filename</span>&nbsp;<span class="builtintype" id="3347745">string</span><span class="op" id="3347751">,</span>&nbsp;<span class="ident" id="3347753">base</span><span class="op" id="3347757">,</span>&nbsp;<span class="ident" id="3347759">size</span>&nbsp;<span class="builtintype" id="3347764">int</span><span class="op" id="3347767">)</span>&nbsp;<span class="op" id="3347769">*</span><span class="ident" id="3347770">File</span>&nbsp;<span class="op" id="3347775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347778">s</span><span class="op" id="3347779">.</span><span class="ident" id="3347780">mutex</span><span class="op" id="3347785">.</span><span class="ident" id="3347786">Lock</span><span class="op" id="3347790">(</span><span class="op" id="3347791">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347794">defer</span>&nbsp;<span class="ident" id="3347800">s</span><span class="op" id="3347801">.</span><span class="ident" id="3347802">mutex</span><span class="op" id="3347807">.</span><span class="ident" id="3347808">Unlock</span><span class="op" id="3347814">(</span><span class="op" id="3347815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347818">if</span>&nbsp;<span class="ident" id="3347821">base</span>&nbsp;<span class="op" id="3347826">&lt;</span>&nbsp;<span class="num" id="3347828">0</span>&nbsp;<span class="op" id="3347830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347834">base</span>&nbsp;<span class="op" id="3347839">=</span>&nbsp;<span class="ident" id="3347841">s</span><span class="op" id="3347842">.</span><span class="ident" id="3347843">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347852">if</span>&nbsp;<span class="ident" id="3347855">base</span>&nbsp;<span class="op" id="3347860">&lt;</span>&nbsp;<span class="ident" id="3347862">s</span><span class="op" id="3347863">.</span><span class="ident" id="3347864">base</span>&nbsp;<span class="op" id="3347869">||</span>&nbsp;<span class="ident" id="3347872">size</span>&nbsp;<span class="op" id="3347877">&lt;</span>&nbsp;<span class="num" id="3347879">0</span>&nbsp;<span class="op" id="3347881">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3347885">panic</span><span class="op" id="3347890">(</span><span class="string" id="3347891">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="3347913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3347919">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347951">f</span>&nbsp;<span class="op" id="3347953">:=</span>&nbsp;<span class="op" id="3347956">&amp;</span><span class="ident" id="3347957">File</span><span class="op" id="3347961">{</span><span class="ident" id="3347962">s</span><span class="op" id="3347963">,</span>&nbsp;<span class="ident" id="3347965">filename</span><span class="op" id="3347973">,</span>&nbsp;<span class="ident" id="3347975">base</span><span class="op" id="3347979">,</span>&nbsp;<span class="ident" id="3347981">size</span><span class="op" id="3347985">,</span>&nbsp;<span class="op" id="3347987">[</span><span class="op" id="3347988">]</span><span class="builtintype" id="3347989">int</span><span class="op" id="3347992">{</span><span class="num" id="3347993">0</span><span class="op" id="3347994">}</span><span class="op" id="3347995">,</span>&nbsp;<span class="ident" id="3347997">nil</span><span class="op" id="3348000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348003">base</span>&nbsp;<span class="op" id="3348008">+=</span>&nbsp;<span class="ident" id="3348011">size</span>&nbsp;<span class="op" id="3348016">+</span>&nbsp;<span class="num" id="3348018">1</span>&nbsp;<span class="comment" id="3348020">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348059">if</span>&nbsp;<span class="ident" id="3348062">base</span>&nbsp;<span class="op" id="3348067">&lt;</span>&nbsp;<span class="num" id="3348069">0</span>&nbsp;<span class="op" id="3348071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3348075">panic</span><span class="op" id="3348080">(</span><span class="string" id="3348081">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="3348142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3348145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348148">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348181">s</span><span class="op" id="3348182">.</span><span class="ident" id="3348183">base</span>&nbsp;<span class="op" id="3348188">=</span>&nbsp;<span class="ident" id="3348190">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348196">s</span><span class="op" id="3348197">.</span><span class="ident" id="3348198">files</span>&nbsp;<span class="op" id="3348204">=</span>&nbsp;<span class="builtinfunc" id="3348206">append</span><span class="op" id="3348212">(</span><span class="ident" id="3348213">s</span><span class="op" id="3348214">.</span><span class="ident" id="3348215">files</span><span class="op" id="3348220">,</span>&nbsp;<span class="ident" id="3348222">f</span><span class="op" id="3348223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348226">s</span><span class="op" id="3348227">.</span><span class="ident" id="3348228">last</span>&nbsp;<span class="op" id="3348233">=</span>&nbsp;<span class="ident" id="3348235">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348238">return</span>&nbsp;<span class="ident" id="3348245">f</span><br>
<span class="lineno"></span><span class="op" id="3348247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3348250">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3348328">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3348354">//</span><br>
<span class="lineno"></span><span class="keyword" id="3348357">func</span>&nbsp;<span class="op" id="3348362">(</span><span class="ident" id="3348363">s</span>&nbsp;<span class="op" id="3348365">*</span><span class="ident" id="3348366">FileSet</span><span class="op" id="3348373">)</span>&nbsp;<span class="ident" id="3348375">Iterate</span><span class="op" id="3348382">(</span><span class="ident" id="3348383">f</span>&nbsp;<span class="keyword" id="3348385">func</span><span class="op" id="3348389">(</span><span class="op" id="3348390">*</span><span class="ident" id="3348391">File</span><span class="op" id="3348395">)</span>&nbsp;<span class="builtintype" id="3348397">bool</span><span class="op" id="3348401">)</span>&nbsp;<span class="op" id="3348403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348406">for</span>&nbsp;<span class="ident" id="3348410">i</span>&nbsp;<span class="op" id="3348412">:=</span>&nbsp;<span class="num" id="3348415">0</span><span class="op" id="3348416">;</span>&nbsp;<span class="op" id="3348418">;</span>&nbsp;<span class="ident" id="3348420">i</span><span class="op" id="3348421">++</span>&nbsp;<span class="op" id="3348424">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348428">var</span>&nbsp;<span class="ident" id="3348432">file</span>&nbsp;<span class="op" id="3348437">*</span><span class="ident" id="3348438">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348445">s</span><span class="op" id="3348446">.</span><span class="ident" id="3348447">mutex</span><span class="op" id="3348452">.</span><span class="ident" id="3348453">RLock</span><span class="op" id="3348458">(</span><span class="op" id="3348459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348463">if</span>&nbsp;<span class="ident" id="3348466">i</span>&nbsp;<span class="op" id="3348468">&lt;</span>&nbsp;<span class="builtinfunc" id="3348470">len</span><span class="op" id="3348473">(</span><span class="ident" id="3348474">s</span><span class="op" id="3348475">.</span><span class="ident" id="3348476">files</span><span class="op" id="3348481">)</span>&nbsp;<span class="op" id="3348483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348488">file</span>&nbsp;<span class="op" id="3348493">=</span>&nbsp;<span class="ident" id="3348495">s</span><span class="op" id="3348496">.</span><span class="ident" id="3348497">files</span><span class="op" id="3348502">[</span><span class="ident" id="3348503">i</span><span class="op" id="3348504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3348508">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348512">s</span><span class="op" id="3348513">.</span><span class="ident" id="3348514">mutex</span><span class="op" id="3348519">.</span><span class="ident" id="3348520">RUnlock</span><span class="op" id="3348527">(</span><span class="op" id="3348528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348532">if</span>&nbsp;<span class="ident" id="3348535">file</span>&nbsp;<span class="op" id="3348540">==</span>&nbsp;<span class="ident" id="3348543">nil</span>&nbsp;<span class="op" id="3348547">||</span>&nbsp;<span class="op" id="3348550">!</span><span class="ident" id="3348551">f</span><span class="op" id="3348552">(</span><span class="ident" id="3348553">file</span><span class="op" id="3348557">)</span>&nbsp;<span class="op" id="3348559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348564">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3348572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3348575">}</span><br>
<span class="lineno">400</span><span class="op" id="3348577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348580">func</span>&nbsp;<span class="ident" id="3348585">searchFiles</span><span class="op" id="3348596">(</span><span class="ident" id="3348597">a</span>&nbsp;<span class="op" id="3348599">[</span><span class="op" id="3348600">]</span><span class="op" id="3348601">*</span><span class="ident" id="3348602">File</span><span class="op" id="3348606">,</span>&nbsp;<span class="ident" id="3348608">x</span>&nbsp;<span class="builtintype" id="3348610">int</span><span class="op" id="3348613">)</span>&nbsp;<span class="builtintype" id="3348615">int</span>&nbsp;<span class="op" id="3348619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348622">return</span>&nbsp;<span class="ident" id="3348629">sort</span><span class="op" id="3348633">.</span><span class="ident" id="3348634">Search</span><span class="op" id="3348640">(</span><span class="builtinfunc" id="3348641">len</span><span class="op" id="3348644">(</span><span class="ident" id="3348645">a</span><span class="op" id="3348646">)</span><span class="op" id="3348647">,</span>&nbsp;<span class="keyword" id="3348649">func</span><span class="op" id="3348653">(</span><span class="ident" id="3348654">i</span>&nbsp;<span class="builtintype" id="3348656">int</span><span class="op" id="3348659">)</span>&nbsp;<span class="builtintype" id="3348661">bool</span>&nbsp;<span class="op" id="3348666">{</span>&nbsp;<span class="keyword" id="3348668">return</span>&nbsp;<span class="ident" id="3348675">a</span><span class="op" id="3348676">[</span><span class="ident" id="3348677">i</span><span class="op" id="3348678">]</span><span class="op" id="3348679">.</span><span class="ident" id="3348680">base</span>&nbsp;<span class="op" id="3348685">&gt;</span>&nbsp;<span class="ident" id="3348687">x</span>&nbsp;<span class="op" id="3348689">}</span><span class="op" id="3348690">)</span>&nbsp;<span class="op" id="3348692">-</span>&nbsp;<span class="num" id="3348694">1</span><br>
<span class="lineno"></span><span class="op" id="3348696">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3348699">func</span>&nbsp;<span class="op" id="3348704">(</span><span class="ident" id="3348705">s</span>&nbsp;<span class="op" id="3348707">*</span><span class="ident" id="3348708">FileSet</span><span class="op" id="3348715">)</span>&nbsp;<span class="ident" id="3348717">file</span><span class="op" id="3348721">(</span><span class="ident" id="3348722">p</span>&nbsp;<span class="ident" id="3348724">Pos</span><span class="op" id="3348727">)</span>&nbsp;<span class="op" id="3348729">*</span><span class="ident" id="3348730">File</span>&nbsp;<span class="op" id="3348735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348738">s</span><span class="op" id="3348739">.</span><span class="ident" id="3348740">mutex</span><span class="op" id="3348745">.</span><span class="ident" id="3348746">RLock</span><span class="op" id="3348751">(</span><span class="op" id="3348752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348755">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348790">if</span>&nbsp;<span class="ident" id="3348793">f</span>&nbsp;<span class="op" id="3348795">:=</span>&nbsp;<span class="ident" id="3348798">s</span><span class="op" id="3348799">.</span><span class="ident" id="3348800">last</span><span class="op" id="3348804">;</span>&nbsp;<span class="ident" id="3348806">f</span>&nbsp;<span class="op" id="3348808">!=</span>&nbsp;<span class="ident" id="3348811">nil</span>&nbsp;<span class="op" id="3348815">&amp;&amp;</span>&nbsp;<span class="ident" id="3348818">f</span><span class="op" id="3348819">.</span><span class="ident" id="3348820">base</span>&nbsp;<span class="op" id="3348825">&lt;=</span>&nbsp;<span class="builtintype" id="3348828">int</span><span class="op" id="3348831">(</span><span class="ident" id="3348832">p</span><span class="op" id="3348833">)</span>&nbsp;<span class="op" id="3348835">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3348838">int</span><span class="op" id="3348841">(</span><span class="ident" id="3348842">p</span><span class="op" id="3348843">)</span>&nbsp;<span class="op" id="3348845">&lt;=</span>&nbsp;<span class="ident" id="3348848">f</span><span class="op" id="3348849">.</span><span class="ident" id="3348850">base</span><span class="op" id="3348854">+</span><span class="ident" id="3348855">f</span><span class="op" id="3348856">.</span><span class="ident" id="3348857">size</span>&nbsp;<span class="op" id="3348862">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348866">s</span><span class="op" id="3348867">.</span><span class="ident" id="3348868">mutex</span><span class="op" id="3348873">.</span><span class="ident" id="3348874">RUnlock</span><span class="op" id="3348881">(</span><span class="op" id="3348882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348886">return</span>&nbsp;<span class="ident" id="3348893">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3348896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3348899">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3348944">if</span>&nbsp;<span class="ident" id="3348947">i</span>&nbsp;<span class="op" id="3348949">:=</span>&nbsp;<span class="ident" id="3348952">searchFiles</span><span class="op" id="3348963">(</span><span class="ident" id="3348964">s</span><span class="op" id="3348965">.</span><span class="ident" id="3348966">files</span><span class="op" id="3348971">,</span>&nbsp;<span class="builtintype" id="3348973">int</span><span class="op" id="3348976">(</span><span class="ident" id="3348977">p</span><span class="op" id="3348978">)</span><span class="op" id="3348979">)</span><span class="op" id="3348980">;</span>&nbsp;<span class="ident" id="3348982">i</span>&nbsp;<span class="op" id="3348984">&gt;=</span>&nbsp;<span class="num" id="3348987">0</span>&nbsp;<span class="op" id="3348989">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3348993">f</span>&nbsp;<span class="op" id="3348995">:=</span>&nbsp;<span class="ident" id="3348998">s</span><span class="op" id="3348999">.</span><span class="ident" id="3349000">files</span><span class="op" id="3349005">[</span><span class="ident" id="3349006">i</span><span class="op" id="3349007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3349011">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349062">if</span>&nbsp;<span class="builtintype" id="3349065">int</span><span class="op" id="3349068">(</span><span class="ident" id="3349069">p</span><span class="op" id="3349070">)</span>&nbsp;<span class="op" id="3349072">&lt;=</span>&nbsp;<span class="ident" id="3349075">f</span><span class="op" id="3349076">.</span><span class="ident" id="3349077">base</span><span class="op" id="3349081">+</span><span class="ident" id="3349082">f</span><span class="op" id="3349083">.</span><span class="ident" id="3349084">size</span>&nbsp;<span class="op" id="3349089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349094">s</span><span class="op" id="3349095">.</span><span class="ident" id="3349096">mutex</span><span class="op" id="3349101">.</span><span class="ident" id="3349102">RUnlock</span><span class="op" id="3349109">(</span><span class="op" id="3349110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349115">s</span><span class="op" id="3349116">.</span><span class="ident" id="3349117">mutex</span><span class="op" id="3349122">.</span><span class="ident" id="3349123">Lock</span><span class="op" id="3349127">(</span><span class="op" id="3349128">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349133">s</span><span class="op" id="3349134">.</span><span class="ident" id="3349135">last</span>&nbsp;<span class="op" id="3349140">=</span>&nbsp;<span class="ident" id="3349142">f</span>&nbsp;<span class="comment" id="3349144">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349186">s</span><span class="op" id="3349187">.</span><span class="ident" id="3349188">mutex</span><span class="op" id="3349193">.</span><span class="ident" id="3349194">Unlock</span><span class="op" id="3349200">(</span><span class="op" id="3349201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349206">return</span>&nbsp;<span class="ident" id="3349213">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349220">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349223">s</span><span class="op" id="3349224">.</span><span class="ident" id="3349225">mutex</span><span class="op" id="3349230">.</span><span class="ident" id="3349231">RUnlock</span><span class="op" id="3349238">(</span><span class="op" id="3349239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349242">return</span>&nbsp;<span class="ident" id="3349249">nil</span><br>
<span class="lineno"></span><span class="op" id="3349253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349256">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="3349311">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="3349370">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3349392">//</span><br>
<span class="lineno"></span><span class="keyword" id="3349395">func</span>&nbsp;<span class="op" id="3349400">(</span><span class="ident" id="3349401">s</span>&nbsp;<span class="op" id="3349403">*</span><span class="ident" id="3349404">FileSet</span><span class="op" id="3349411">)</span>&nbsp;<span class="ident" id="3349413">File</span><span class="op" id="3349417">(</span><span class="ident" id="3349418">p</span>&nbsp;<span class="ident" id="3349420">Pos</span><span class="op" id="3349423">)</span>&nbsp;<span class="op" id="3349425">(</span><span class="ident" id="3349426">f</span>&nbsp;<span class="op" id="3349428">*</span><span class="ident" id="3349429">File</span><span class="op" id="3349433">)</span>&nbsp;<span class="op" id="3349435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349438">if</span>&nbsp;<span class="ident" id="3349441">p</span>&nbsp;<span class="op" id="3349443">!=</span>&nbsp;<span class="ident" id="3349446">NoPos</span>&nbsp;<span class="op" id="3349452">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349456">f</span>&nbsp;<span class="op" id="3349458">=</span>&nbsp;<span class="ident" id="3349460">s</span><span class="op" id="3349461">.</span><span class="ident" id="3349462">file</span><span class="op" id="3349466">(</span><span class="ident" id="3349467">p</span><span class="op" id="3349468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349474">return</span><br>
<span class="lineno"></span><span class="op" id="3349481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="3349484">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3349554">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="3349627">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3349685">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3349725">//</span><br>
<span class="lineno">445</span><span class="keyword" id="3349728">func</span>&nbsp;<span class="op" id="3349733">(</span><span class="ident" id="3349734">s</span>&nbsp;<span class="op" id="3349736">*</span><span class="ident" id="3349737">FileSet</span><span class="op" id="3349744">)</span>&nbsp;<span class="ident" id="3349746">PositionFor</span><span class="op" id="3349757">(</span><span class="ident" id="3349758">p</span>&nbsp;<span class="ident" id="3349760">Pos</span><span class="op" id="3349763">,</span>&nbsp;<span class="ident" id="3349765">adjusted</span>&nbsp;<span class="builtintype" id="3349774">bool</span><span class="op" id="3349778">)</span>&nbsp;<span class="op" id="3349780">(</span><span class="ident" id="3349781">pos</span>&nbsp;<span class="ident" id="3349785">Position</span><span class="op" id="3349793">)</span>&nbsp;<span class="op" id="3349795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349798">if</span>&nbsp;<span class="ident" id="3349801">p</span>&nbsp;<span class="op" id="3349803">!=</span>&nbsp;<span class="ident" id="3349806">NoPos</span>&nbsp;<span class="op" id="3349812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349816">if</span>&nbsp;<span class="ident" id="3349819">f</span>&nbsp;<span class="op" id="3349821">:=</span>&nbsp;<span class="ident" id="3349824">s</span><span class="op" id="3349825">.</span><span class="ident" id="3349826">file</span><span class="op" id="3349830">(</span><span class="ident" id="3349831">p</span><span class="op" id="3349832">)</span><span class="op" id="3349833">;</span>&nbsp;<span class="ident" id="3349835">f</span>&nbsp;<span class="op" id="3349837">!=</span>&nbsp;<span class="ident" id="3349840">nil</span>&nbsp;<span class="op" id="3349844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3349849">pos</span>&nbsp;<span class="op" id="3349853">=</span>&nbsp;<span class="ident" id="3349855">f</span><span class="op" id="3349856">.</span><span class="ident" id="3349857">position</span><span class="op" id="3349865">(</span><span class="ident" id="3349866">p</span><span class="op" id="3349867">,</span>&nbsp;<span class="ident" id="3349869">adjusted</span><span class="op" id="3349877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349881">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3349884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3349887">return</span><br>
<span class="lineno"></span><span class="op" id="3349894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349897">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="3349964">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="3350038">//</span><br>
<span class="lineno"></span><span class="keyword" id="3350041">func</span>&nbsp;<span class="op" id="3350046">(</span><span class="ident" id="3350047">s</span>&nbsp;<span class="op" id="3350049">*</span><span class="ident" id="3350050">FileSet</span><span class="op" id="3350057">)</span>&nbsp;<span class="ident" id="3350059">Position</span><span class="op" id="3350067">(</span><span class="ident" id="3350068">p</span>&nbsp;<span class="ident" id="3350070">Pos</span><span class="op" id="3350073">)</span>&nbsp;<span class="op" id="3350075">(</span><span class="ident" id="3350076">pos</span>&nbsp;<span class="ident" id="3350080">Position</span><span class="op" id="3350088">)</span>&nbsp;<span class="op" id="3350090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350093">return</span>&nbsp;<span class="ident" id="3350100">s</span><span class="op" id="3350101">.</span><span class="ident" id="3350102">PositionFor</span><span class="op" id="3350113">(</span><span class="ident" id="3350114">p</span><span class="op" id="3350115">,</span>&nbsp;<span class="builtintype" id="3350117">true</span><span class="op" id="3350121">)</span><br>
<span class="lineno"></span><span class="op" id="3350123">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3350126">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3350207">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3350228">func</span>&nbsp;<span class="ident" id="3350233">searchInts</span><span class="op" id="3350243">(</span><span class="ident" id="3350244">a</span>&nbsp;<span class="op" id="3350246">[</span><span class="op" id="3350247">]</span><span class="builtintype" id="3350248">int</span><span class="op" id="3350251">,</span>&nbsp;<span class="ident" id="3350253">x</span>&nbsp;<span class="builtintype" id="3350255">int</span><span class="op" id="3350258">)</span>&nbsp;<span class="builtintype" id="3350260">int</span>&nbsp;<span class="op" id="3350264">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350267">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350324">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350328">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350403">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350407">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350477">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350543">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350610">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350669">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350727">i</span><span class="op" id="3350728">,</span>&nbsp;<span class="ident" id="3350730">j</span>&nbsp;<span class="op" id="3350732">:=</span>&nbsp;<span class="num" id="3350735">0</span><span class="op" id="3350736">,</span>&nbsp;<span class="builtinfunc" id="3350738">len</span><span class="op" id="3350741">(</span><span class="ident" id="3350742">a</span><span class="op" id="3350743">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350746">for</span>&nbsp;<span class="ident" id="3350750">i</span>&nbsp;<span class="op" id="3350752">&lt;</span>&nbsp;<span class="ident" id="3350754">j</span>&nbsp;<span class="op" id="3350756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350760">h</span>&nbsp;<span class="op" id="3350762">:=</span>&nbsp;<span class="ident" id="3350765">i</span>&nbsp;<span class="op" id="3350767">+</span>&nbsp;<span class="op" id="3350769">(</span><span class="ident" id="3350770">j</span><span class="op" id="3350771">-</span><span class="ident" id="3350772">i</span><span class="op" id="3350773">)</span><span class="op" id="3350774">/</span><span class="num" id="3350775">2</span>&nbsp;<span class="comment" id="3350777">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3350814">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350831">if</span>&nbsp;<span class="ident" id="3350834">a</span><span class="op" id="3350835">[</span><span class="ident" id="3350836">h</span><span class="op" id="3350837">]</span>&nbsp;<span class="op" id="3350839">&lt;=</span>&nbsp;<span class="ident" id="3350842">x</span>&nbsp;<span class="op" id="3350844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350849">i</span>&nbsp;<span class="op" id="3350851">=</span>&nbsp;<span class="ident" id="3350853">h</span>&nbsp;<span class="op" id="3350855">+</span>&nbsp;<span class="num" id="3350857">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350861">}</span>&nbsp;<span class="keyword" id="3350863">else</span>&nbsp;<span class="op" id="3350868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3350873">j</span>&nbsp;<span class="op" id="3350875">=</span>&nbsp;<span class="ident" id="3350877">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3350884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3350887">return</span>&nbsp;<span class="ident" id="3350894">i</span>&nbsp;<span class="op" id="3350896">-</span>&nbsp;<span class="num" id="3350898">1</span><br>
<span class="lineno">485</span><span class="op" id="3350900">}</span>
</div>
</body>
</html>
