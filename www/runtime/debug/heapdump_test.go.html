<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8350285">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8350340">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8350394">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8350445">package</span>&nbsp;<span class="ident" id="8350453">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8350460">import</span>&nbsp;<span class="op" id="8350467">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350470">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350483">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350489">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350500">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8350510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8350513">func</span>&nbsp;<span class="ident" id="8350518">TestWriteHeapDumpNonempty</span><span class="op" id="8350543">(</span><span class="ident" id="8350544">t</span>&nbsp;<span class="op" id="8350546">*</span><span class="ident" id="8350547">testing</span><span class="op" id="8350554">.</span><span class="ident" id="8350555">T</span><span class="op" id="8350556">)</span>&nbsp;<span class="op" id="8350558">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350561">if</span>&nbsp;<span class="ident" id="8350564">runtime</span><span class="op" id="8350571">.</span><span class="ident" id="8350572">GOOS</span>&nbsp;<span class="op" id="8350577">==</span>&nbsp;<span class="string" id="8350580">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8350587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350591">t</span><span class="op" id="8350592">.</span><span class="ident" id="8350593">Skip</span><span class="op" id="8350597">(</span><span class="string" id="8350598">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8350639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350645">f</span><span class="op" id="8350646">,</span>&nbsp;<span class="ident" id="8350648">err</span>&nbsp;<span class="op" id="8350652">:=</span>&nbsp;<span class="ident" id="8350655">ioutil</span><span class="op" id="8350661">.</span><span class="ident" id="8350662">TempFile</span><span class="op" id="8350670">(</span><span class="string" id="8350671">&#34;&#34;</span><span class="op" id="8350673">,</span>&nbsp;<span class="string" id="8350675">&#34;heapdumptest&#34;</span><span class="op" id="8350689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350692">if</span>&nbsp;<span class="ident" id="8350695">err</span>&nbsp;<span class="op" id="8350699">!=</span>&nbsp;<span class="ident" id="8350702">nil</span>&nbsp;<span class="op" id="8350706">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350710">t</span><span class="op" id="8350711">.</span><span class="ident" id="8350712">Fatalf</span><span class="op" id="8350718">(</span><span class="string" id="8350719">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8350740">,</span>&nbsp;<span class="ident" id="8350742">err</span><span class="op" id="8350745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350751">defer</span>&nbsp;<span class="ident" id="8350757">os</span><span class="op" id="8350759">.</span><span class="ident" id="8350760">Remove</span><span class="op" id="8350766">(</span><span class="ident" id="8350767">f</span><span class="op" id="8350768">.</span><span class="ident" id="8350769">Name</span><span class="op" id="8350773">(</span><span class="op" id="8350774">)</span><span class="op" id="8350775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350778">defer</span>&nbsp;<span class="ident" id="8350784">f</span><span class="op" id="8350785">.</span><span class="ident" id="8350786">Close</span><span class="op" id="8350791">(</span><span class="op" id="8350792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350795">WriteHeapDump</span><span class="op" id="8350808">(</span><span class="ident" id="8350809">f</span><span class="op" id="8350810">.</span><span class="ident" id="8350811">Fd</span><span class="op" id="8350813">(</span><span class="op" id="8350814">)</span><span class="op" id="8350815">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350818">fi</span><span class="op" id="8350820">,</span>&nbsp;<span class="ident" id="8350822">err</span>&nbsp;<span class="op" id="8350826">:=</span>&nbsp;<span class="ident" id="8350829">f</span><span class="op" id="8350830">.</span><span class="ident" id="8350831">Stat</span><span class="op" id="8350835">(</span><span class="op" id="8350836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350839">if</span>&nbsp;<span class="ident" id="8350842">err</span>&nbsp;<span class="op" id="8350846">!=</span>&nbsp;<span class="ident" id="8350849">nil</span>&nbsp;<span class="op" id="8350853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350857">t</span><span class="op" id="8350858">.</span><span class="ident" id="8350859">Fatalf</span><span class="op" id="8350865">(</span><span class="string" id="8350866">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8350883">,</span>&nbsp;<span class="ident" id="8350885">err</span><span class="op" id="8350888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350894">const</span>&nbsp;<span class="ident" id="8350900">minSize</span>&nbsp;<span class="op" id="8350908">=</span>&nbsp;<span class="num" id="8350910">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350913">if</span>&nbsp;<span class="ident" id="8350916">size</span>&nbsp;<span class="op" id="8350921">:=</span>&nbsp;<span class="ident" id="8350924">fi</span><span class="op" id="8350926">.</span><span class="ident" id="8350927">Size</span><span class="op" id="8350931">(</span><span class="op" id="8350932">)</span><span class="op" id="8350933">;</span>&nbsp;<span class="ident" id="8350935">size</span>&nbsp;<span class="op" id="8350940">&lt;</span>&nbsp;<span class="ident" id="8350942">minSize</span>&nbsp;<span class="op" id="8350950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350954">t</span><span class="op" id="8350955">.</span><span class="ident" id="8350956">Fatalf</span><span class="op" id="8350962">(</span><span class="string" id="8350963">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8351016">,</span>&nbsp;<span class="ident" id="8351018">size</span><span class="op" id="8351022">,</span>&nbsp;<span class="ident" id="8351024">minSize</span><span class="op" id="8351031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351034">}</span><br>
<span class="lineno"></span><span class="op" id="8351036">}</span>
</div>
</body>
</html>
