<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6912005">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6912060">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6912114">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6912165">package</span>&nbsp;<span class="ident" id="6912173">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912178">import</span>&nbsp;<span class="op" id="6912185">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912188">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912195">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912201">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912212">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912223">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912231">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6912242">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6912249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912252">func</span>&nbsp;<span class="ident" id="6912257">BenchmarkTCP4OneShot</span><span class="op" id="6912277">(</span><span class="ident" id="6912278">b</span>&nbsp;<span class="op" id="6912280">*</span><span class="ident" id="6912281"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912288">.</span><span class="ident" id="6912289">B</span><span class="op" id="6912290">)</span>&nbsp;<span class="op" id="6912292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912295"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912307">(</span><span class="ident" id="6912308"><a href="/net/tcp_test.go.html#6912278">b</a></span><span class="op" id="6912309">,</span>&nbsp;<span class="ident" id="6912311">false</span><span class="op" id="6912316">,</span>&nbsp;<span class="ident" id="6912318">false</span><span class="op" id="6912323">,</span>&nbsp;<span class="string" id="6912325">&#34;127.0.0.1:0&#34;</span><span class="op" id="6912338">)</span><br>
<span class="lineno"></span><span class="op" id="6912340">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6912343">func</span>&nbsp;<span class="ident" id="6912348">BenchmarkTCP4OneShotTimeout</span><span class="op" id="6912375">(</span><span class="ident" id="6912376">b</span>&nbsp;<span class="op" id="6912378">*</span><span class="ident" id="6912379"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912386">.</span><span class="ident" id="6912387">B</span><span class="op" id="6912388">)</span>&nbsp;<span class="op" id="6912390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912393"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912405">(</span><span class="ident" id="6912406"><a href="/net/tcp_test.go.html#6912376">b</a></span><span class="op" id="6912407">,</span>&nbsp;<span class="ident" id="6912409">false</span><span class="op" id="6912414">,</span>&nbsp;<span class="ident" id="6912416">true</span><span class="op" id="6912420">,</span>&nbsp;<span class="string" id="6912422">&#34;127.0.0.1:0&#34;</span><span class="op" id="6912435">)</span><br>
<span class="lineno"></span><span class="op" id="6912437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6912440">func</span>&nbsp;<span class="ident" id="6912445">BenchmarkTCP4Persistent</span><span class="op" id="6912468">(</span><span class="ident" id="6912469">b</span>&nbsp;<span class="op" id="6912471">*</span><span class="ident" id="6912472"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912479">.</span><span class="ident" id="6912480">B</span><span class="op" id="6912481">)</span>&nbsp;<span class="op" id="6912483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912486"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912498">(</span><span class="ident" id="6912499"><a href="/net/tcp_test.go.html#6912469">b</a></span><span class="op" id="6912500">,</span>&nbsp;<span class="ident" id="6912502">true</span><span class="op" id="6912506">,</span>&nbsp;<span class="ident" id="6912508">false</span><span class="op" id="6912513">,</span>&nbsp;<span class="string" id="6912515">&#34;127.0.0.1:0&#34;</span><span class="op" id="6912528">)</span><br>
<span class="lineno"></span><span class="op" id="6912530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912533">func</span>&nbsp;<span class="ident" id="6912538">BenchmarkTCP4PersistentTimeout</span><span class="op" id="6912568">(</span><span class="ident" id="6912569">b</span>&nbsp;<span class="op" id="6912571">*</span><span class="ident" id="6912572"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912579">.</span><span class="ident" id="6912580">B</span><span class="op" id="6912581">)</span>&nbsp;<span class="op" id="6912583">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912586"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912598">(</span><span class="ident" id="6912599"><a href="/net/tcp_test.go.html#6912569">b</a></span><span class="op" id="6912600">,</span>&nbsp;<span class="ident" id="6912602">true</span><span class="op" id="6912606">,</span>&nbsp;<span class="ident" id="6912608">true</span><span class="op" id="6912612">,</span>&nbsp;<span class="string" id="6912614">&#34;127.0.0.1:0&#34;</span><span class="op" id="6912627">)</span><br>
<span class="lineno"></span><span class="op" id="6912629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912632">func</span>&nbsp;<span class="ident" id="6912637">BenchmarkTCP6OneShot</span><span class="op" id="6912657">(</span><span class="ident" id="6912658">b</span>&nbsp;<span class="op" id="6912660">*</span><span class="ident" id="6912661"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912668">.</span><span class="ident" id="6912669">B</span><span class="op" id="6912670">)</span>&nbsp;<span class="op" id="6912672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6912675">if</span>&nbsp;<span class="op" id="6912678">!</span><span class="ident" id="6912679"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6912692">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912696"><a href="/net/tcp_test.go.html#6912658">b</a></span><span class="op" id="6912697">.</span><span class="ident" id="6912698">Skip</span><span class="op" id="6912702">(</span><span class="string" id="6912703">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6912726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6912729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912732"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912744">(</span><span class="ident" id="6912745"><a href="/net/tcp_test.go.html#6912658">b</a></span><span class="op" id="6912746">,</span>&nbsp;<span class="ident" id="6912748">false</span><span class="op" id="6912753">,</span>&nbsp;<span class="ident" id="6912755">false</span><span class="op" id="6912760">,</span>&nbsp;<span class="string" id="6912762">&#34;[::1]:0&#34;</span><span class="op" id="6912771">)</span><br>
<span class="lineno"></span><span class="op" id="6912773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6912776">func</span>&nbsp;<span class="ident" id="6912781">BenchmarkTCP6OneShotTimeout</span><span class="op" id="6912808">(</span><span class="ident" id="6912809">b</span>&nbsp;<span class="op" id="6912811">*</span><span class="ident" id="6912812"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912819">.</span><span class="ident" id="6912820">B</span><span class="op" id="6912821">)</span>&nbsp;<span class="op" id="6912823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6912826">if</span>&nbsp;<span class="op" id="6912829">!</span><span class="ident" id="6912830"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6912843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912847"><a href="/net/tcp_test.go.html#6912809">b</a></span><span class="op" id="6912848">.</span><span class="ident" id="6912849">Skip</span><span class="op" id="6912853">(</span><span class="string" id="6912854">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6912877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6912880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912883"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6912895">(</span><span class="ident" id="6912896"><a href="/net/tcp_test.go.html#6912809">b</a></span><span class="op" id="6912897">,</span>&nbsp;<span class="ident" id="6912899">false</span><span class="op" id="6912904">,</span>&nbsp;<span class="ident" id="6912906">true</span><span class="op" id="6912910">,</span>&nbsp;<span class="string" id="6912912">&#34;[::1]:0&#34;</span><span class="op" id="6912921">)</span><br>
<span class="lineno">45</span><span class="op" id="6912923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6912926">func</span>&nbsp;<span class="ident" id="6912931">BenchmarkTCP6Persistent</span><span class="op" id="6912954">(</span><span class="ident" id="6912955">b</span>&nbsp;<span class="op" id="6912957">*</span><span class="ident" id="6912958"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6912965">.</span><span class="ident" id="6912966">B</span><span class="op" id="6912967">)</span>&nbsp;<span class="op" id="6912969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6912972">if</span>&nbsp;<span class="op" id="6912975">!</span><span class="ident" id="6912976"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6912989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6912993"><a href="/net/tcp_test.go.html#6912955">b</a></span><span class="op" id="6912994">.</span><span class="ident" id="6912995">Skip</span><span class="op" id="6912999">(</span><span class="string" id="6913000">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6913023">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913029"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6913041">(</span><span class="ident" id="6913042"><a href="/net/tcp_test.go.html#6912955">b</a></span><span class="op" id="6913043">,</span>&nbsp;<span class="ident" id="6913045">true</span><span class="op" id="6913049">,</span>&nbsp;<span class="ident" id="6913051">false</span><span class="op" id="6913056">,</span>&nbsp;<span class="string" id="6913058">&#34;[::1]:0&#34;</span><span class="op" id="6913067">)</span><br>
<span class="lineno"></span><span class="op" id="6913069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6913072">func</span>&nbsp;<span class="ident" id="6913077">BenchmarkTCP6PersistentTimeout</span><span class="op" id="6913107">(</span><span class="ident" id="6913108">b</span>&nbsp;<span class="op" id="6913110">*</span><span class="ident" id="6913111"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6913118">.</span><span class="ident" id="6913119">B</span><span class="op" id="6913120">)</span>&nbsp;<span class="op" id="6913122">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913125">if</span>&nbsp;<span class="op" id="6913128">!</span><span class="ident" id="6913129"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6913142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913146"><a href="/net/tcp_test.go.html#6913108">b</a></span><span class="op" id="6913147">.</span><span class="ident" id="6913148">Skip</span><span class="op" id="6913152">(</span><span class="string" id="6913153">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6913176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913182"><a href="/net/tcp_test.go.html#6913229">benchmarkTCP</a></span><span class="op" id="6913194">(</span><span class="ident" id="6913195"><a href="/net/tcp_test.go.html#6913108">b</a></span><span class="op" id="6913196">,</span>&nbsp;<span class="ident" id="6913198">true</span><span class="op" id="6913202">,</span>&nbsp;<span class="ident" id="6913204">true</span><span class="op" id="6913208">,</span>&nbsp;<span class="string" id="6913210">&#34;[::1]:0&#34;</span><span class="op" id="6913219">)</span><br>
<span class="lineno"></span><span class="op" id="6913221">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6913224">func</span>&nbsp;<span class="ident" id="6913229">benchmarkTCP</span><span class="op" id="6913241">(</span><span class="ident" id="6913242">b</span>&nbsp;<span class="op" id="6913244">*</span><span class="ident" id="6913245"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6913252">.</span><span class="ident" id="6913253">B</span><span class="op" id="6913254">,</span>&nbsp;<span class="ident" id="6913256">persistent</span><span class="op" id="6913266">,</span>&nbsp;<span class="ident" id="6913268">timeout</span>&nbsp;<span class="builtintype" id="6913276">bool</span><span class="op" id="6913280">,</span>&nbsp;<span class="ident" id="6913282">laddr</span>&nbsp;<span class="builtintype" id="6913288">string</span><span class="op" id="6913294">)</span>&nbsp;<span class="op" id="6913296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913299">const</span>&nbsp;<span class="ident" id="6913305">msgLen</span>&nbsp;<span class="op" id="6913312">=</span>&nbsp;<span class="num" id="6913314">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913319">conns</span>&nbsp;<span class="op" id="6913325">:=</span>&nbsp;<span class="ident" id="6913328"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913329">.</span><span class="ident" id="6913330">N</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913333">numConcurrent</span>&nbsp;<span class="op" id="6913347">:=</span>&nbsp;<span class="ident" id="6913350"><a href="/net/tcp_test.go.html#6912212">runtime</a></span><span class="op" id="6913357">.</span><span class="ident" id="6913358">GOMAXPROCS</span><span class="op" id="6913368">(</span><span class="op" id="6913369">-</span><span class="num" id="6913370">1</span><span class="op" id="6913371">)</span>&nbsp;<span class="op" id="6913373">*</span>&nbsp;<span class="num" id="6913375">2</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913378">msgs</span>&nbsp;<span class="op" id="6913383">:=</span>&nbsp;<span class="num" id="6913386">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913389">if</span>&nbsp;<span class="ident" id="6913392"><a href="/net/tcp_test.go.html#6913256">persistent</a></span>&nbsp;<span class="op" id="6913403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913407"><a href="/net/tcp_test.go.html#6913319">conns</a></span>&nbsp;<span class="op" id="6913413">=</span>&nbsp;<span class="ident" id="6913415"><a href="/net/tcp_test.go.html#6913333">numConcurrent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913431"><a href="/net/tcp_test.go.html#6913378">msgs</a></span>&nbsp;<span class="op" id="6913436">=</span>&nbsp;<span class="ident" id="6913438"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913439">.</span><span class="ident" id="6913440">N</span>&nbsp;<span class="op" id="6913442">/</span>&nbsp;<span class="ident" id="6913444"><a href="/net/tcp_test.go.html#6913319">conns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913452">if</span>&nbsp;<span class="ident" id="6913455"><a href="/net/tcp_test.go.html#6913378">msgs</a></span>&nbsp;<span class="op" id="6913460">==</span>&nbsp;<span class="num" id="6913463">0</span>&nbsp;<span class="op" id="6913465">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913470"><a href="/net/tcp_test.go.html#6913378">msgs</a></span>&nbsp;<span class="op" id="6913475">=</span>&nbsp;<span class="num" id="6913477">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913485">if</span>&nbsp;<span class="ident" id="6913488"><a href="/net/tcp_test.go.html#6913319">conns</a></span>&nbsp;<span class="op" id="6913494">&gt;</span>&nbsp;<span class="ident" id="6913496"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913497">.</span><span class="ident" id="6913498">N</span>&nbsp;<span class="op" id="6913500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913505"><a href="/net/tcp_test.go.html#6913319">conns</a></span>&nbsp;<span class="op" id="6913511">=</span>&nbsp;<span class="ident" id="6913513"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913514">.</span><span class="ident" id="6913515">N</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913519">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913525">sendMsg</span>&nbsp;<span class="op" id="6913533">:=</span>&nbsp;<span class="keyword" id="6913536">func</span><span class="op" id="6913540">(</span><span class="ident" id="6913541">c</span>&nbsp;<span class="ident" id="6913543"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6913547">,</span>&nbsp;<span class="ident" id="6913549">buf</span>&nbsp;<span class="op" id="6913553">[</span><span class="op" id="6913554">]</span><span class="builtintype" id="6913555">byte</span><span class="op" id="6913559">)</span>&nbsp;<span class="builtintype" id="6913561">bool</span>&nbsp;<span class="op" id="6913566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913570">n</span><span class="op" id="6913571">,</span>&nbsp;<span class="ident" id="6913573">err</span>&nbsp;<span class="op" id="6913577">:=</span>&nbsp;<span class="ident" id="6913580"><a href="/net/tcp_test.go.html#6913541">c</a></span><span class="op" id="6913581">.</span><span class="ident" id="6913582">Write</span><span class="op" id="6913587">(</span><span class="ident" id="6913588"><a href="/net/tcp_test.go.html#6913549">buf</a></span><span class="op" id="6913591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913595">if</span>&nbsp;<span class="ident" id="6913598"><a href="/net/tcp_test.go.html#6913570">n</a></span>&nbsp;<span class="op" id="6913600">!=</span>&nbsp;<span class="builtinfunc" id="6913603">len</span><span class="op" id="6913606">(</span><span class="ident" id="6913607"><a href="/net/tcp_test.go.html#6913549">buf</a></span><span class="op" id="6913610">)</span>&nbsp;<span class="op" id="6913612">||</span>&nbsp;<span class="ident" id="6913615"><a href="/net/tcp_test.go.html#6913573">err</a></span>&nbsp;<span class="op" id="6913619">!=</span>&nbsp;<span class="ident" id="6913622">nil</span>&nbsp;<span class="op" id="6913626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913631"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913632">.</span><span class="ident" id="6913633">Logf</span><span class="op" id="6913637">(</span><span class="string" id="6913638">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6913656">,</span>&nbsp;<span class="ident" id="6913658"><a href="/net/tcp_test.go.html#6913573">err</a></span><span class="op" id="6913661">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913666">return</span>&nbsp;<span class="ident" id="6913673">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913685">return</span>&nbsp;<span class="ident" id="6913692">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913701">recvMsg</span>&nbsp;<span class="op" id="6913709">:=</span>&nbsp;<span class="keyword" id="6913712">func</span><span class="op" id="6913716">(</span><span class="ident" id="6913717">c</span>&nbsp;<span class="ident" id="6913719"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6913723">,</span>&nbsp;<span class="ident" id="6913725">buf</span>&nbsp;<span class="op" id="6913729">[</span><span class="op" id="6913730">]</span><span class="builtintype" id="6913731">byte</span><span class="op" id="6913735">)</span>&nbsp;<span class="builtintype" id="6913737">bool</span>&nbsp;<span class="op" id="6913742">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913746">for</span>&nbsp;<span class="ident" id="6913750">read</span>&nbsp;<span class="op" id="6913755">:=</span>&nbsp;<span class="num" id="6913758">0</span><span class="op" id="6913759">;</span>&nbsp;<span class="ident" id="6913761"><a href="/net/tcp_test.go.html#6913750">read</a></span>&nbsp;<span class="op" id="6913766">!=</span>&nbsp;<span class="builtinfunc" id="6913769">len</span><span class="op" id="6913772">(</span><span class="ident" id="6913773"><a href="/net/tcp_test.go.html#6913725">buf</a></span><span class="op" id="6913776">)</span><span class="op" id="6913777">;</span>&nbsp;<span class="op" id="6913779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913784">n</span><span class="op" id="6913785">,</span>&nbsp;<span class="ident" id="6913787">err</span>&nbsp;<span class="op" id="6913791">:=</span>&nbsp;<span class="ident" id="6913794"><a href="/net/tcp_test.go.html#6913717">c</a></span><span class="op" id="6913795">.</span><span class="ident" id="6913796">Read</span><span class="op" id="6913800">(</span><span class="ident" id="6913801"><a href="/net/tcp_test.go.html#6913725">buf</a></span><span class="op" id="6913804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913809"><a href="/net/tcp_test.go.html#6913750">read</a></span>&nbsp;<span class="op" id="6913814">+=</span>&nbsp;<span class="ident" id="6913817"><a href="/net/tcp_test.go.html#6913784">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913822">if</span>&nbsp;<span class="ident" id="6913825"><a href="/net/tcp_test.go.html#6913787">err</a></span>&nbsp;<span class="op" id="6913829">!=</span>&nbsp;<span class="ident" id="6913832">nil</span>&nbsp;<span class="op" id="6913836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913842"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913843">.</span><span class="ident" id="6913844">Logf</span><span class="op" id="6913848">(</span><span class="string" id="6913849">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6913866">,</span>&nbsp;<span class="ident" id="6913868"><a href="/net/tcp_test.go.html#6913787">err</a></span><span class="op" id="6913871">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913877">return</span>&nbsp;<span class="ident" id="6913884">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913901">return</span>&nbsp;<span class="ident" id="6913908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6913914">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913917">ln</span><span class="op" id="6913919">,</span>&nbsp;<span class="ident" id="6913921">err</span>&nbsp;<span class="op" id="6913925">:=</span>&nbsp;<span class="ident" id="6913928"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6913934">(</span><span class="string" id="6913935">&#34;tcp&#34;</span><span class="op" id="6913940">,</span>&nbsp;<span class="ident" id="6913942"><a href="/net/tcp_test.go.html#6913282">laddr</a></span><span class="op" id="6913947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6913950">if</span>&nbsp;<span class="ident" id="6913953"><a href="/net/tcp_test.go.html#6913921">err</a></span>&nbsp;<span class="op" id="6913957">!=</span>&nbsp;<span class="ident" id="6913960">nil</span>&nbsp;<span class="op" id="6913964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6913968"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6913969">.</span><span class="ident" id="6913970">Fatalf</span><span class="op" id="6913976">(</span><span class="string" id="6913977">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6913996">,</span>&nbsp;<span class="ident" id="6913998"><a href="/net/tcp_test.go.html#6913921">err</a></span><span class="op" id="6914001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914007">defer</span>&nbsp;<span class="ident" id="6914013"><a href="/net/tcp_test.go.html#6913917">ln</a></span><span class="op" id="6914015">.</span><span class="ident" id="6914016">Close</span><span class="op" id="6914021">(</span><span class="op" id="6914022">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914025">serverSem</span>&nbsp;<span class="op" id="6914035">:=</span>&nbsp;<span class="builtinfunc" id="6914038">make</span><span class="op" id="6914042">(</span><span class="keyword" id="6914043">chan</span>&nbsp;<span class="builtintype" id="6914048">bool</span><span class="op" id="6914052">,</span>&nbsp;<span class="ident" id="6914054"><a href="/net/tcp_test.go.html#6913333">numConcurrent</a></span><span class="op" id="6914067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6914070">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914084">go</span>&nbsp;<span class="keyword" id="6914087">func</span><span class="op" id="6914091">(</span><span class="op" id="6914092">)</span>&nbsp;<span class="op" id="6914094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914098">for</span>&nbsp;<span class="op" id="6914102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914107">c</span><span class="op" id="6914108">,</span>&nbsp;<span class="ident" id="6914110">err</span>&nbsp;<span class="op" id="6914114">:=</span>&nbsp;<span class="ident" id="6914117"><a href="/net/tcp_test.go.html#6913917">ln</a></span><span class="op" id="6914119">.</span><span class="ident" id="6914120">Accept</span><span class="op" id="6914126">(</span><span class="op" id="6914127">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914132">if</span>&nbsp;<span class="ident" id="6914135"><a href="/net/tcp_test.go.html#6914110">err</a></span>&nbsp;<span class="op" id="6914139">!=</span>&nbsp;<span class="ident" id="6914142">nil</span>&nbsp;<span class="op" id="6914146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914166"><a href="/net/tcp_test.go.html#6914025">serverSem</a></span>&nbsp;<span class="op" id="6914176">&lt;-</span>&nbsp;<span class="ident" id="6914179">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6914187">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914212">go</span>&nbsp;<span class="keyword" id="6914215">func</span><span class="op" id="6914219">(</span><span class="ident" id="6914220">c</span>&nbsp;<span class="ident" id="6914222"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6914226">)</span>&nbsp;<span class="op" id="6914228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914234">defer</span>&nbsp;<span class="keyword" id="6914240">func</span><span class="op" id="6914244">(</span><span class="op" id="6914245">)</span>&nbsp;<span class="op" id="6914247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914254"><a href="/net/tcp_test.go.html#6914220">c</a></span><span class="op" id="6914255">.</span><span class="ident" id="6914256">Close</span><span class="op" id="6914261">(</span><span class="op" id="6914262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914269">&lt;-</span><span class="ident" id="6914271"><a href="/net/tcp_test.go.html#6914025">serverSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914285">}</span><span class="op" id="6914286">(</span><span class="op" id="6914287">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914293">if</span>&nbsp;<span class="ident" id="6914296"><a href="/net/tcp_test.go.html#6913268">timeout</a></span>&nbsp;<span class="op" id="6914304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914311"><a href="/net/tcp_test.go.html#6914220">c</a></span><span class="op" id="6914312">.</span><span class="ident" id="6914313">SetDeadline</span><span class="op" id="6914324">(</span><span class="ident" id="6914325"><a href="/net/tcp_test.go.html#6912242">time</a></span><span class="op" id="6914329">.</span><span class="ident" id="6914330">Now</span><span class="op" id="6914333">(</span><span class="op" id="6914334">)</span><span class="op" id="6914335">.</span><span class="ident" id="6914336">Add</span><span class="op" id="6914339">(</span><span class="ident" id="6914340"><a href="/net/tcp_test.go.html#6912242">time</a></span><span class="op" id="6914344">.</span><span class="ident" id="6914345">Hour</span><span class="op" id="6914349">)</span><span class="op" id="6914350">)</span>&nbsp;<span class="comment" id="6914352">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914387">var</span>&nbsp;<span class="ident" id="6914391">buf</span>&nbsp;<span class="op" id="6914395">[</span><span class="ident" id="6914396"><a href="/net/tcp_test.go.html#6913305">msgLen</a></span><span class="op" id="6914402">]</span><span class="builtintype" id="6914403">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914412">for</span>&nbsp;<span class="ident" id="6914416">m</span>&nbsp;<span class="op" id="6914418">:=</span>&nbsp;<span class="num" id="6914421">0</span><span class="op" id="6914422">;</span>&nbsp;<span class="ident" id="6914424"><a href="/net/tcp_test.go.html#6914416">m</a></span>&nbsp;<span class="op" id="6914426">&lt;</span>&nbsp;<span class="ident" id="6914428"><a href="/net/tcp_test.go.html#6913378">msgs</a></span><span class="op" id="6914432">;</span>&nbsp;<span class="ident" id="6914434"><a href="/net/tcp_test.go.html#6914416">m</a></span><span class="op" id="6914435">++</span>&nbsp;<span class="op" id="6914438">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914445">if</span>&nbsp;<span class="op" id="6914448">!</span><span class="ident" id="6914449"><a href="/net/tcp_test.go.html#6913701">recvMsg</a></span><span class="op" id="6914456">(</span><span class="ident" id="6914457"><a href="/net/tcp_test.go.html#6914220">c</a></span><span class="op" id="6914458">,</span>&nbsp;<span class="ident" id="6914460"><a href="/net/tcp_test.go.html#6914391">buf</a></span><span class="op" id="6914463">[</span><span class="op" id="6914464">:</span><span class="op" id="6914465">]</span><span class="op" id="6914466">)</span>&nbsp;<span class="op" id="6914468">||</span>&nbsp;<span class="op" id="6914471">!</span><span class="ident" id="6914472"><a href="/net/tcp_test.go.html#6913525">sendMsg</a></span><span class="op" id="6914479">(</span><span class="ident" id="6914480"><a href="/net/tcp_test.go.html#6914220">c</a></span><span class="op" id="6914481">,</span>&nbsp;<span class="ident" id="6914483"><a href="/net/tcp_test.go.html#6914391">buf</a></span><span class="op" id="6914486">[</span><span class="op" id="6914487">:</span><span class="op" id="6914488">]</span><span class="op" id="6914489">)</span>&nbsp;<span class="op" id="6914491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914499">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914521">}</span><span class="op" id="6914522">(</span><span class="ident" id="6914523"><a href="/net/tcp_test.go.html#6914107">c</a></span><span class="op" id="6914524">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914531">}</span><span class="op" id="6914532">(</span><span class="op" id="6914533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914536">clientSem</span>&nbsp;<span class="op" id="6914546">:=</span>&nbsp;<span class="builtinfunc" id="6914549">make</span><span class="op" id="6914553">(</span><span class="keyword" id="6914554">chan</span>&nbsp;<span class="builtintype" id="6914559">bool</span><span class="op" id="6914563">,</span>&nbsp;<span class="ident" id="6914565"><a href="/net/tcp_test.go.html#6913333">numConcurrent</a></span><span class="op" id="6914578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914581">for</span>&nbsp;<span class="ident" id="6914585">i</span>&nbsp;<span class="op" id="6914587">:=</span>&nbsp;<span class="num" id="6914590">0</span><span class="op" id="6914591">;</span>&nbsp;<span class="ident" id="6914593"><a href="/net/tcp_test.go.html#6914585">i</a></span>&nbsp;<span class="op" id="6914595">&lt;</span>&nbsp;<span class="ident" id="6914597"><a href="/net/tcp_test.go.html#6913319">conns</a></span><span class="op" id="6914602">;</span>&nbsp;<span class="ident" id="6914604"><a href="/net/tcp_test.go.html#6914585">i</a></span><span class="op" id="6914605">++</span>&nbsp;<span class="op" id="6914608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914612"><a href="/net/tcp_test.go.html#6914536">clientSem</a></span>&nbsp;<span class="op" id="6914622">&lt;-</span>&nbsp;<span class="ident" id="6914625">true</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6914632">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914656">go</span>&nbsp;<span class="keyword" id="6914659">func</span><span class="op" id="6914663">(</span><span class="op" id="6914664">)</span>&nbsp;<span class="op" id="6914666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914671">defer</span>&nbsp;<span class="keyword" id="6914677">func</span><span class="op" id="6914681">(</span><span class="op" id="6914682">)</span>&nbsp;<span class="op" id="6914684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914690">&lt;-</span><span class="ident" id="6914692"><a href="/net/tcp_test.go.html#6914536">clientSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914705">}</span><span class="op" id="6914706">(</span><span class="op" id="6914707">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914712">c</span><span class="op" id="6914713">,</span>&nbsp;<span class="ident" id="6914715">err</span>&nbsp;<span class="op" id="6914719">:=</span>&nbsp;<span class="ident" id="6914722"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6914726">(</span><span class="string" id="6914727">&#34;tcp&#34;</span><span class="op" id="6914732">,</span>&nbsp;<span class="ident" id="6914734"><a href="/net/tcp_test.go.html#6913917">ln</a></span><span class="op" id="6914736">.</span><span class="ident" id="6914737">Addr</span><span class="op" id="6914741">(</span><span class="op" id="6914742">)</span><span class="op" id="6914743">.</span><span class="ident" id="6914744">String</span><span class="op" id="6914750">(</span><span class="op" id="6914751">)</span><span class="op" id="6914752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914757">if</span>&nbsp;<span class="ident" id="6914760"><a href="/net/tcp_test.go.html#6914715">err</a></span>&nbsp;<span class="op" id="6914764">!=</span>&nbsp;<span class="ident" id="6914767">nil</span>&nbsp;<span class="op" id="6914771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914777"><a href="/net/tcp_test.go.html#6913242">b</a></span><span class="op" id="6914778">.</span><span class="ident" id="6914779">Logf</span><span class="op" id="6914783">(</span><span class="string" id="6914784">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6914801">,</span>&nbsp;<span class="ident" id="6914803"><a href="/net/tcp_test.go.html#6914715">err</a></span><span class="op" id="6914806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914812">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914822">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914827">defer</span>&nbsp;<span class="ident" id="6914833"><a href="/net/tcp_test.go.html#6914712">c</a></span><span class="op" id="6914834">.</span><span class="ident" id="6914835">Close</span><span class="op" id="6914840">(</span><span class="op" id="6914841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914846">if</span>&nbsp;<span class="ident" id="6914849"><a href="/net/tcp_test.go.html#6913268">timeout</a></span>&nbsp;<span class="op" id="6914857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6914863"><a href="/net/tcp_test.go.html#6914712">c</a></span><span class="op" id="6914864">.</span><span class="ident" id="6914865">SetDeadline</span><span class="op" id="6914876">(</span><span class="ident" id="6914877"><a href="/net/tcp_test.go.html#6912242">time</a></span><span class="op" id="6914881">.</span><span class="ident" id="6914882">Now</span><span class="op" id="6914885">(</span><span class="op" id="6914886">)</span><span class="op" id="6914887">.</span><span class="ident" id="6914888">Add</span><span class="op" id="6914891">(</span><span class="ident" id="6914892"><a href="/net/tcp_test.go.html#6912242">time</a></span><span class="op" id="6914896">.</span><span class="ident" id="6914897">Hour</span><span class="op" id="6914901">)</span><span class="op" id="6914902">)</span>&nbsp;<span class="comment" id="6914904">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6914932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914937">var</span>&nbsp;<span class="ident" id="6914941">buf</span>&nbsp;<span class="op" id="6914945">[</span><span class="ident" id="6914946"><a href="/net/tcp_test.go.html#6913305">msgLen</a></span><span class="op" id="6914952">]</span><span class="builtintype" id="6914953">byte</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914961">for</span>&nbsp;<span class="ident" id="6914965">m</span>&nbsp;<span class="op" id="6914967">:=</span>&nbsp;<span class="num" id="6914970">0</span><span class="op" id="6914971">;</span>&nbsp;<span class="ident" id="6914973"><a href="/net/tcp_test.go.html#6914965">m</a></span>&nbsp;<span class="op" id="6914975">&lt;</span>&nbsp;<span class="ident" id="6914977"><a href="/net/tcp_test.go.html#6913378">msgs</a></span><span class="op" id="6914981">;</span>&nbsp;<span class="ident" id="6914983"><a href="/net/tcp_test.go.html#6914965">m</a></span><span class="op" id="6914984">++</span>&nbsp;<span class="op" id="6914987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6914993">if</span>&nbsp;<span class="op" id="6914996">!</span><span class="ident" id="6914997"><a href="/net/tcp_test.go.html#6913525">sendMsg</a></span><span class="op" id="6915004">(</span><span class="ident" id="6915005"><a href="/net/tcp_test.go.html#6914712">c</a></span><span class="op" id="6915006">,</span>&nbsp;<span class="ident" id="6915008"><a href="/net/tcp_test.go.html#6914941">buf</a></span><span class="op" id="6915011">[</span><span class="op" id="6915012">:</span><span class="op" id="6915013">]</span><span class="op" id="6915014">)</span>&nbsp;<span class="op" id="6915016">||</span>&nbsp;<span class="op" id="6915019">!</span><span class="ident" id="6915020"><a href="/net/tcp_test.go.html#6913701">recvMsg</a></span><span class="op" id="6915027">(</span><span class="ident" id="6915028"><a href="/net/tcp_test.go.html#6914712">c</a></span><span class="op" id="6915029">,</span>&nbsp;<span class="ident" id="6915031"><a href="/net/tcp_test.go.html#6914941">buf</a></span><span class="op" id="6915034">[</span><span class="op" id="6915035">:</span><span class="op" id="6915036">]</span><span class="op" id="6915037">)</span>&nbsp;<span class="op" id="6915039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6915046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915061">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915065">}</span><span class="op" id="6915066">(</span><span class="op" id="6915067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6915073">for</span>&nbsp;<span class="ident" id="6915077">i</span>&nbsp;<span class="op" id="6915079">:=</span>&nbsp;<span class="num" id="6915082">0</span><span class="op" id="6915083">;</span>&nbsp;<span class="ident" id="6915085"><a href="/net/tcp_test.go.html#6915077">i</a></span>&nbsp;<span class="op" id="6915087">&lt;</span>&nbsp;<span class="ident" id="6915089"><a href="/net/tcp_test.go.html#6913333">numConcurrent</a></span><span class="op" id="6915102">;</span>&nbsp;<span class="ident" id="6915104"><a href="/net/tcp_test.go.html#6915077">i</a></span><span class="op" id="6915105">++</span>&nbsp;<span class="op" id="6915108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915112"><a href="/net/tcp_test.go.html#6914536">clientSem</a></span>&nbsp;<span class="op" id="6915122">&lt;-</span>&nbsp;<span class="ident" id="6915125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915132"><a href="/net/tcp_test.go.html#6914025">serverSem</a></span>&nbsp;<span class="op" id="6915142">&lt;-</span>&nbsp;<span class="ident" id="6915145">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915151">}</span><br>
<span class="lineno"></span><span class="op" id="6915153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6915156">func</span>&nbsp;<span class="ident" id="6915161">BenchmarkTCP4ConcurrentReadWrite</span><span class="op" id="6915193">(</span><span class="ident" id="6915194">b</span>&nbsp;<span class="op" id="6915196">*</span><span class="ident" id="6915197"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6915204">.</span><span class="ident" id="6915205">B</span><span class="op" id="6915206">)</span>&nbsp;<span class="op" id="6915208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915211"><a href="/net/tcp_test.go.html#6915430">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="6915242">(</span><span class="ident" id="6915243"><a href="/net/tcp_test.go.html#6915194">b</a></span><span class="op" id="6915244">,</span>&nbsp;<span class="string" id="6915246">&#34;127.0.0.1:0&#34;</span><span class="op" id="6915259">)</span><br>
<span class="lineno">160</span><span class="op" id="6915261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6915264">func</span>&nbsp;<span class="ident" id="6915269">BenchmarkTCP6ConcurrentReadWrite</span><span class="op" id="6915301">(</span><span class="ident" id="6915302">b</span>&nbsp;<span class="op" id="6915304">*</span><span class="ident" id="6915305"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6915312">.</span><span class="ident" id="6915313">B</span><span class="op" id="6915314">)</span>&nbsp;<span class="op" id="6915316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6915319">if</span>&nbsp;<span class="op" id="6915322">!</span><span class="ident" id="6915323"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6915336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915340"><a href="/net/tcp_test.go.html#6915302">b</a></span><span class="op" id="6915341">.</span><span class="ident" id="6915342">Skip</span><span class="op" id="6915346">(</span><span class="string" id="6915347">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6915370">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6915373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915376"><a href="/net/tcp_test.go.html#6915430">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="6915407">(</span><span class="ident" id="6915408"><a href="/net/tcp_test.go.html#6915302">b</a></span><span class="op" id="6915409">,</span>&nbsp;<span class="string" id="6915411">&#34;[::1]:0&#34;</span><span class="op" id="6915420">)</span><br>
<span class="lineno"></span><span class="op" id="6915422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6915425">func</span>&nbsp;<span class="ident" id="6915430">benchmarkTCPConcurrentReadWrite</span><span class="op" id="6915461">(</span><span class="ident" id="6915462">b</span>&nbsp;<span class="op" id="6915464">*</span><span class="ident" id="6915465"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6915472">.</span><span class="ident" id="6915473">B</span><span class="op" id="6915474">,</span>&nbsp;<span class="ident" id="6915476">laddr</span>&nbsp;<span class="builtintype" id="6915482">string</span><span class="op" id="6915488">)</span>&nbsp;<span class="op" id="6915490">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6915493">//&nbsp;The&nbsp;benchmark&nbsp;creates&nbsp;GOMAXPROCS&nbsp;client/server&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6915551">//&nbsp;Each&nbsp;pair&nbsp;creates&nbsp;4&nbsp;goroutines:&nbsp;client&nbsp;reader/writer&nbsp;and&nbsp;server&nbsp;reader/writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6915634">//&nbsp;The&nbsp;benchmark&nbsp;stresses&nbsp;concurrent&nbsp;reading&nbsp;and&nbsp;writing&nbsp;to&nbsp;the&nbsp;same&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6915716">//&nbsp;Such&nbsp;pattern&nbsp;is&nbsp;used&nbsp;in&nbsp;net/http&nbsp;and&nbsp;net/rpc.</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915767"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6915768">.</span><span class="ident" id="6915769">StopTimer</span><span class="op" id="6915778">(</span><span class="op" id="6915779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915783">P</span>&nbsp;<span class="op" id="6915785">:=</span>&nbsp;<span class="ident" id="6915788"><a href="/net/tcp_test.go.html#6912212">runtime</a></span><span class="op" id="6915795">.</span><span class="ident" id="6915796">GOMAXPROCS</span><span class="op" id="6915806">(</span><span class="num" id="6915807">0</span><span class="op" id="6915808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915811">N</span>&nbsp;<span class="op" id="6915813">:=</span>&nbsp;<span class="ident" id="6915816"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6915817">.</span><span class="ident" id="6915818">N</span>&nbsp;<span class="op" id="6915820">/</span>&nbsp;<span class="ident" id="6915822"><a href="/net/tcp_test.go.html#6915783">P</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915825">W</span>&nbsp;<span class="op" id="6915827">:=</span>&nbsp;<span class="num" id="6915830">1000</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6915837">//&nbsp;Setup&nbsp;P&nbsp;client/server&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915876">clients</span>&nbsp;<span class="op" id="6915884">:=</span>&nbsp;<span class="builtinfunc" id="6915887">make</span><span class="op" id="6915891">(</span><span class="op" id="6915892">[</span><span class="op" id="6915893">]</span><span class="ident" id="6915894"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6915898">,</span>&nbsp;<span class="ident" id="6915900"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6915901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915904">servers</span>&nbsp;<span class="op" id="6915912">:=</span>&nbsp;<span class="builtinfunc" id="6915915">make</span><span class="op" id="6915919">(</span><span class="op" id="6915920">[</span><span class="op" id="6915921">]</span><span class="ident" id="6915922"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6915926">,</span>&nbsp;<span class="ident" id="6915928"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6915929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915932">ln</span><span class="op" id="6915934">,</span>&nbsp;<span class="ident" id="6915936">err</span>&nbsp;<span class="op" id="6915940">:=</span>&nbsp;<span class="ident" id="6915943"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6915949">(</span><span class="string" id="6915950">&#34;tcp&#34;</span><span class="op" id="6915955">,</span>&nbsp;<span class="ident" id="6915957"><a href="/net/tcp_test.go.html#6915476">laddr</a></span><span class="op" id="6915962">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6915965">if</span>&nbsp;<span class="ident" id="6915968"><a href="/net/tcp_test.go.html#6915936">err</a></span>&nbsp;<span class="op" id="6915972">!=</span>&nbsp;<span class="ident" id="6915975">nil</span>&nbsp;<span class="op" id="6915979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6915983"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6915984">.</span><span class="ident" id="6915985">Fatalf</span><span class="op" id="6915991">(</span><span class="string" id="6915992">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6916011">,</span>&nbsp;<span class="ident" id="6916013"><a href="/net/tcp_test.go.html#6915936">err</a></span><span class="op" id="6916016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916022">defer</span>&nbsp;<span class="ident" id="6916028"><a href="/net/tcp_test.go.html#6915932">ln</a></span><span class="op" id="6916030">.</span><span class="ident" id="6916031">Close</span><span class="op" id="6916036">(</span><span class="op" id="6916037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916040">done</span>&nbsp;<span class="op" id="6916045">:=</span>&nbsp;<span class="builtinfunc" id="6916048">make</span><span class="op" id="6916052">(</span><span class="keyword" id="6916053">chan</span>&nbsp;<span class="builtintype" id="6916058">bool</span><span class="op" id="6916062">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916065">go</span>&nbsp;<span class="keyword" id="6916068">func</span><span class="op" id="6916072">(</span><span class="op" id="6916073">)</span>&nbsp;<span class="op" id="6916075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916079">for</span>&nbsp;<span class="ident" id="6916083">p</span>&nbsp;<span class="op" id="6916085">:=</span>&nbsp;<span class="num" id="6916088">0</span><span class="op" id="6916089">;</span>&nbsp;<span class="ident" id="6916091"><a href="/net/tcp_test.go.html#6916083">p</a></span>&nbsp;<span class="op" id="6916093">&lt;</span>&nbsp;<span class="ident" id="6916095"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6916096">;</span>&nbsp;<span class="ident" id="6916098"><a href="/net/tcp_test.go.html#6916083">p</a></span><span class="op" id="6916099">++</span>&nbsp;<span class="op" id="6916102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916107">s</span><span class="op" id="6916108">,</span>&nbsp;<span class="ident" id="6916110">err</span>&nbsp;<span class="op" id="6916114">:=</span>&nbsp;<span class="ident" id="6916117"><a href="/net/tcp_test.go.html#6915932">ln</a></span><span class="op" id="6916119">.</span><span class="ident" id="6916120">Accept</span><span class="op" id="6916126">(</span><span class="op" id="6916127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916132">if</span>&nbsp;<span class="ident" id="6916135"><a href="/net/tcp_test.go.html#6916110">err</a></span>&nbsp;<span class="op" id="6916139">!=</span>&nbsp;<span class="ident" id="6916142">nil</span>&nbsp;<span class="op" id="6916146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916152"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6916153">.</span><span class="ident" id="6916154">Errorf</span><span class="op" id="6916160">(</span><span class="string" id="6916161">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6916180">,</span>&nbsp;<span class="ident" id="6916182"><a href="/net/tcp_test.go.html#6916110">err</a></span><span class="op" id="6916185">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916191">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916206"><a href="/net/tcp_test.go.html#6915904">servers</a></span><span class="op" id="6916213">[</span><span class="ident" id="6916214"><a href="/net/tcp_test.go.html#6916083">p</a></span><span class="op" id="6916215">]</span>&nbsp;<span class="op" id="6916217">=</span>&nbsp;<span class="ident" id="6916219"><a href="/net/tcp_test.go.html#6916107">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916227"><a href="/net/tcp_test.go.html#6916040">done</a></span>&nbsp;<span class="op" id="6916232">&lt;-</span>&nbsp;<span class="ident" id="6916235">true</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916241">}</span><span class="op" id="6916242">(</span><span class="op" id="6916243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916246">for</span>&nbsp;<span class="ident" id="6916250">p</span>&nbsp;<span class="op" id="6916252">:=</span>&nbsp;<span class="num" id="6916255">0</span><span class="op" id="6916256">;</span>&nbsp;<span class="ident" id="6916258"><a href="/net/tcp_test.go.html#6916250">p</a></span>&nbsp;<span class="op" id="6916260">&lt;</span>&nbsp;<span class="ident" id="6916262"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6916263">;</span>&nbsp;<span class="ident" id="6916265"><a href="/net/tcp_test.go.html#6916250">p</a></span><span class="op" id="6916266">++</span>&nbsp;<span class="op" id="6916269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916273">c</span><span class="op" id="6916274">,</span>&nbsp;<span class="ident" id="6916276">err</span>&nbsp;<span class="op" id="6916280">:=</span>&nbsp;<span class="ident" id="6916283"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6916287">(</span><span class="string" id="6916288">&#34;tcp&#34;</span><span class="op" id="6916293">,</span>&nbsp;<span class="ident" id="6916295"><a href="/net/tcp_test.go.html#6915932">ln</a></span><span class="op" id="6916297">.</span><span class="ident" id="6916298">Addr</span><span class="op" id="6916302">(</span><span class="op" id="6916303">)</span><span class="op" id="6916304">.</span><span class="ident" id="6916305">String</span><span class="op" id="6916311">(</span><span class="op" id="6916312">)</span><span class="op" id="6916313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916317">if</span>&nbsp;<span class="ident" id="6916320"><a href="/net/tcp_test.go.html#6916276">err</a></span>&nbsp;<span class="op" id="6916324">!=</span>&nbsp;<span class="ident" id="6916327">nil</span>&nbsp;<span class="op" id="6916331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916336"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6916337">.</span><span class="ident" id="6916338">Fatalf</span><span class="op" id="6916344">(</span><span class="string" id="6916345">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6916362">,</span>&nbsp;<span class="ident" id="6916364"><a href="/net/tcp_test.go.html#6916276">err</a></span><span class="op" id="6916367">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916375"><a href="/net/tcp_test.go.html#6915876">clients</a></span><span class="op" id="6916382">[</span><span class="ident" id="6916383"><a href="/net/tcp_test.go.html#6916250">p</a></span><span class="op" id="6916384">]</span>&nbsp;<span class="op" id="6916386">=</span>&nbsp;<span class="ident" id="6916388"><a href="/net/tcp_test.go.html#6916273">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916394">&lt;-</span><span class="ident" id="6916396"><a href="/net/tcp_test.go.html#6916040">done</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916403"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6916404">.</span><span class="ident" id="6916405">StartTimer</span><span class="op" id="6916415">(</span><span class="op" id="6916416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916420">var</span>&nbsp;<span class="ident" id="6916424">wg</span>&nbsp;<span class="ident" id="6916427"><a href="/net/tcp_test.go.html#6912223">sync</a></span><span class="op" id="6916431">.</span><span class="ident" id="6916432">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916443"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6916445">.</span><span class="ident" id="6916446">Add</span><span class="op" id="6916449">(</span><span class="num" id="6916450">4</span>&nbsp;<span class="op" id="6916452">*</span>&nbsp;<span class="ident" id="6916454"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6916455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916458">for</span>&nbsp;<span class="ident" id="6916462">p</span>&nbsp;<span class="op" id="6916464">:=</span>&nbsp;<span class="num" id="6916467">0</span><span class="op" id="6916468">;</span>&nbsp;<span class="ident" id="6916470"><a href="/net/tcp_test.go.html#6916462">p</a></span>&nbsp;<span class="op" id="6916472">&lt;</span>&nbsp;<span class="ident" id="6916474"><a href="/net/tcp_test.go.html#6915783">P</a></span><span class="op" id="6916475">;</span>&nbsp;<span class="ident" id="6916477"><a href="/net/tcp_test.go.html#6916462">p</a></span><span class="op" id="6916478">++</span>&nbsp;<span class="op" id="6916481">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6916485">//&nbsp;Client&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916505">go</span>&nbsp;<span class="keyword" id="6916508">func</span><span class="op" id="6916512">(</span><span class="ident" id="6916513">c</span>&nbsp;<span class="ident" id="6916515"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6916519">)</span>&nbsp;<span class="op" id="6916521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916526">defer</span>&nbsp;<span class="ident" id="6916532"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6916534">.</span><span class="ident" id="6916535">Done</span><span class="op" id="6916539">(</span><span class="op" id="6916540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916545">var</span>&nbsp;<span class="ident" id="6916549">buf</span>&nbsp;<span class="op" id="6916553">[</span><span class="num" id="6916554">1</span><span class="op" id="6916555">]</span><span class="builtintype" id="6916556">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916564">for</span>&nbsp;<span class="ident" id="6916568">i</span>&nbsp;<span class="op" id="6916570">:=</span>&nbsp;<span class="num" id="6916573">0</span><span class="op" id="6916574">;</span>&nbsp;<span class="ident" id="6916576"><a href="/net/tcp_test.go.html#6916568">i</a></span>&nbsp;<span class="op" id="6916578">&lt;</span>&nbsp;<span class="ident" id="6916580"><a href="/net/tcp_test.go.html#6915811">N</a></span><span class="op" id="6916581">;</span>&nbsp;<span class="ident" id="6916583"><a href="/net/tcp_test.go.html#6916568">i</a></span><span class="op" id="6916584">++</span>&nbsp;<span class="op" id="6916587">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916593">v</span>&nbsp;<span class="op" id="6916595">:=</span>&nbsp;<span class="builtintype" id="6916598">byte</span><span class="op" id="6916602">(</span><span class="ident" id="6916603"><a href="/net/tcp_test.go.html#6916568">i</a></span><span class="op" id="6916604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916610">for</span>&nbsp;<span class="ident" id="6916614">w</span>&nbsp;<span class="op" id="6916616">:=</span>&nbsp;<span class="num" id="6916619">0</span><span class="op" id="6916620">;</span>&nbsp;<span class="ident" id="6916622"><a href="/net/tcp_test.go.html#6916614">w</a></span>&nbsp;<span class="op" id="6916624">&lt;</span>&nbsp;<span class="ident" id="6916626"><a href="/net/tcp_test.go.html#6915825">W</a></span><span class="op" id="6916627">;</span>&nbsp;<span class="ident" id="6916629"><a href="/net/tcp_test.go.html#6916614">w</a></span><span class="op" id="6916630">++</span>&nbsp;<span class="op" id="6916633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916640"><a href="/net/tcp_test.go.html#6916593">v</a></span>&nbsp;<span class="op" id="6916642">*=</span>&nbsp;<span class="ident" id="6916645"><a href="/net/tcp_test.go.html#6916593">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916657"><a href="/net/tcp_test.go.html#6916549">buf</a></span><span class="op" id="6916660">[</span><span class="num" id="6916661">0</span><span class="op" id="6916662">]</span>&nbsp;<span class="op" id="6916664">=</span>&nbsp;<span class="ident" id="6916666"><a href="/net/tcp_test.go.html#6916593">v</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916672">_</span><span class="op" id="6916673">,</span>&nbsp;<span class="ident" id="6916675">err</span>&nbsp;<span class="op" id="6916679">:=</span>&nbsp;<span class="ident" id="6916682"><a href="/net/tcp_test.go.html#6916513">c</a></span><span class="op" id="6916683">.</span><span class="ident" id="6916684">Write</span><span class="op" id="6916689">(</span><span class="ident" id="6916690"><a href="/net/tcp_test.go.html#6916549">buf</a></span><span class="op" id="6916693">[</span><span class="op" id="6916694">:</span><span class="op" id="6916695">]</span><span class="op" id="6916696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916702">if</span>&nbsp;<span class="ident" id="6916705"><a href="/net/tcp_test.go.html#6916675">err</a></span>&nbsp;<span class="op" id="6916709">!=</span>&nbsp;<span class="ident" id="6916712">nil</span>&nbsp;<span class="op" id="6916716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916723"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6916724">.</span><span class="ident" id="6916725">Errorf</span><span class="op" id="6916731">(</span><span class="string" id="6916732">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6916750">,</span>&nbsp;<span class="ident" id="6916752"><a href="/net/tcp_test.go.html#6916675">err</a></span><span class="op" id="6916755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916773">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6916782">}</span><span class="op" id="6916783">(</span><span class="ident" id="6916784"><a href="/net/tcp_test.go.html#6915876">clients</a></span><span class="op" id="6916791">[</span><span class="ident" id="6916792"><a href="/net/tcp_test.go.html#6916462">p</a></span><span class="op" id="6916793">]</span><span class="op" id="6916794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6916799">//&nbsp;Pipe&nbsp;between&nbsp;server&nbsp;reader&nbsp;and&nbsp;server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916850">pipe</span>&nbsp;<span class="op" id="6916855">:=</span>&nbsp;<span class="builtinfunc" id="6916858">make</span><span class="op" id="6916862">(</span><span class="keyword" id="6916863">chan</span>&nbsp;<span class="builtintype" id="6916868">byte</span><span class="op" id="6916872">,</span>&nbsp;<span class="num" id="6916874">128</span><span class="op" id="6916877">)</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6916882">//&nbsp;Server&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916902">go</span>&nbsp;<span class="keyword" id="6916905">func</span><span class="op" id="6916909">(</span><span class="ident" id="6916910">s</span>&nbsp;<span class="ident" id="6916912"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6916916">)</span>&nbsp;<span class="op" id="6916918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916923">defer</span>&nbsp;<span class="ident" id="6916929"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6916931">.</span><span class="ident" id="6916932">Done</span><span class="op" id="6916936">(</span><span class="op" id="6916937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916942">var</span>&nbsp;<span class="ident" id="6916946">buf</span>&nbsp;<span class="op" id="6916950">[</span><span class="num" id="6916951">1</span><span class="op" id="6916952">]</span><span class="builtintype" id="6916953">byte</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6916961">for</span>&nbsp;<span class="ident" id="6916965">i</span>&nbsp;<span class="op" id="6916967">:=</span>&nbsp;<span class="num" id="6916970">0</span><span class="op" id="6916971">;</span>&nbsp;<span class="ident" id="6916973"><a href="/net/tcp_test.go.html#6916965">i</a></span>&nbsp;<span class="op" id="6916975">&lt;</span>&nbsp;<span class="ident" id="6916977"><a href="/net/tcp_test.go.html#6915811">N</a></span><span class="op" id="6916978">;</span>&nbsp;<span class="ident" id="6916980"><a href="/net/tcp_test.go.html#6916965">i</a></span><span class="op" id="6916981">++</span>&nbsp;<span class="op" id="6916984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6916990">_</span><span class="op" id="6916991">,</span>&nbsp;<span class="ident" id="6916993">err</span>&nbsp;<span class="op" id="6916997">:=</span>&nbsp;<span class="ident" id="6917000"><a href="/net/tcp_test.go.html#6916910">s</a></span><span class="op" id="6917001">.</span><span class="ident" id="6917002">Read</span><span class="op" id="6917006">(</span><span class="ident" id="6917007"><a href="/net/tcp_test.go.html#6916946">buf</a></span><span class="op" id="6917010">[</span><span class="op" id="6917011">:</span><span class="op" id="6917012">]</span><span class="op" id="6917013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917019">if</span>&nbsp;<span class="ident" id="6917022"><a href="/net/tcp_test.go.html#6916993">err</a></span>&nbsp;<span class="op" id="6917026">!=</span>&nbsp;<span class="ident" id="6917029">nil</span>&nbsp;<span class="op" id="6917033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917040"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6917041">.</span><span class="ident" id="6917042">Errorf</span><span class="op" id="6917048">(</span><span class="string" id="6917049">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6917066">,</span>&nbsp;<span class="ident" id="6917068"><a href="/net/tcp_test.go.html#6916993">err</a></span><span class="op" id="6917071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917078">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917095"><a href="/net/tcp_test.go.html#6916850">pipe</a></span>&nbsp;<span class="op" id="6917100">&lt;-</span>&nbsp;<span class="ident" id="6917103"><a href="/net/tcp_test.go.html#6916946">buf</a></span><span class="op" id="6917106">[</span><span class="num" id="6917107">0</span><span class="op" id="6917108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917117">}</span><span class="op" id="6917118">(</span><span class="ident" id="6917119"><a href="/net/tcp_test.go.html#6915904">servers</a></span><span class="op" id="6917126">[</span><span class="ident" id="6917127"><a href="/net/tcp_test.go.html#6916462">p</a></span><span class="op" id="6917128">]</span><span class="op" id="6917129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6917134">//&nbsp;Server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917154">go</span>&nbsp;<span class="keyword" id="6917157">func</span><span class="op" id="6917161">(</span><span class="ident" id="6917162">s</span>&nbsp;<span class="ident" id="6917164"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6917168">)</span>&nbsp;<span class="op" id="6917170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917175">defer</span>&nbsp;<span class="ident" id="6917181"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6917183">.</span><span class="ident" id="6917184">Done</span><span class="op" id="6917188">(</span><span class="op" id="6917189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917194">var</span>&nbsp;<span class="ident" id="6917198">buf</span>&nbsp;<span class="op" id="6917202">[</span><span class="num" id="6917203">1</span><span class="op" id="6917204">]</span><span class="builtintype" id="6917205">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917213">for</span>&nbsp;<span class="ident" id="6917217">i</span>&nbsp;<span class="op" id="6917219">:=</span>&nbsp;<span class="num" id="6917222">0</span><span class="op" id="6917223">;</span>&nbsp;<span class="ident" id="6917225"><a href="/net/tcp_test.go.html#6917217">i</a></span>&nbsp;<span class="op" id="6917227">&lt;</span>&nbsp;<span class="ident" id="6917229"><a href="/net/tcp_test.go.html#6915811">N</a></span><span class="op" id="6917230">;</span>&nbsp;<span class="ident" id="6917232"><a href="/net/tcp_test.go.html#6917217">i</a></span><span class="op" id="6917233">++</span>&nbsp;<span class="op" id="6917236">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917242">v</span>&nbsp;<span class="op" id="6917244">:=</span>&nbsp;<span class="op" id="6917247">&lt;-</span><span class="ident" id="6917249"><a href="/net/tcp_test.go.html#6916850">pipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917258">for</span>&nbsp;<span class="ident" id="6917262">w</span>&nbsp;<span class="op" id="6917264">:=</span>&nbsp;<span class="num" id="6917267">0</span><span class="op" id="6917268">;</span>&nbsp;<span class="ident" id="6917270"><a href="/net/tcp_test.go.html#6917262">w</a></span>&nbsp;<span class="op" id="6917272">&lt;</span>&nbsp;<span class="ident" id="6917274"><a href="/net/tcp_test.go.html#6915825">W</a></span><span class="op" id="6917275">;</span>&nbsp;<span class="ident" id="6917277"><a href="/net/tcp_test.go.html#6917262">w</a></span><span class="op" id="6917278">++</span>&nbsp;<span class="op" id="6917281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917288"><a href="/net/tcp_test.go.html#6917242">v</a></span>&nbsp;<span class="op" id="6917290">*=</span>&nbsp;<span class="ident" id="6917293"><a href="/net/tcp_test.go.html#6917242">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917305"><a href="/net/tcp_test.go.html#6917198">buf</a></span><span class="op" id="6917308">[</span><span class="num" id="6917309">0</span><span class="op" id="6917310">]</span>&nbsp;<span class="op" id="6917312">=</span>&nbsp;<span class="ident" id="6917314"><a href="/net/tcp_test.go.html#6917242">v</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917320">_</span><span class="op" id="6917321">,</span>&nbsp;<span class="ident" id="6917323">err</span>&nbsp;<span class="op" id="6917327">:=</span>&nbsp;<span class="ident" id="6917330"><a href="/net/tcp_test.go.html#6917162">s</a></span><span class="op" id="6917331">.</span><span class="ident" id="6917332">Write</span><span class="op" id="6917337">(</span><span class="ident" id="6917338"><a href="/net/tcp_test.go.html#6917198">buf</a></span><span class="op" id="6917341">[</span><span class="op" id="6917342">:</span><span class="op" id="6917343">]</span><span class="op" id="6917344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917350">if</span>&nbsp;<span class="ident" id="6917353"><a href="/net/tcp_test.go.html#6917323">err</a></span>&nbsp;<span class="op" id="6917357">!=</span>&nbsp;<span class="ident" id="6917360">nil</span>&nbsp;<span class="op" id="6917364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917371"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6917372">.</span><span class="ident" id="6917373">Errorf</span><span class="op" id="6917379">(</span><span class="string" id="6917380">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6917398">,</span>&nbsp;<span class="ident" id="6917400"><a href="/net/tcp_test.go.html#6917323">err</a></span><span class="op" id="6917403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917410">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917421">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917431"><a href="/net/tcp_test.go.html#6917162">s</a></span><span class="op" id="6917432">.</span><span class="ident" id="6917433">Close</span><span class="op" id="6917438">(</span><span class="op" id="6917439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917443">}</span><span class="op" id="6917444">(</span><span class="ident" id="6917445"><a href="/net/tcp_test.go.html#6915904">servers</a></span><span class="op" id="6917452">[</span><span class="ident" id="6917453"><a href="/net/tcp_test.go.html#6916462">p</a></span><span class="op" id="6917454">]</span><span class="op" id="6917455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6917460">//&nbsp;Client&nbsp;reader.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917480">go</span>&nbsp;<span class="keyword" id="6917483">func</span><span class="op" id="6917487">(</span><span class="ident" id="6917488">c</span>&nbsp;<span class="ident" id="6917490"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6917494">)</span>&nbsp;<span class="op" id="6917496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917501">defer</span>&nbsp;<span class="ident" id="6917507"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6917509">.</span><span class="ident" id="6917510">Done</span><span class="op" id="6917514">(</span><span class="op" id="6917515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917520">var</span>&nbsp;<span class="ident" id="6917524">buf</span>&nbsp;<span class="op" id="6917528">[</span><span class="num" id="6917529">1</span><span class="op" id="6917530">]</span><span class="builtintype" id="6917531">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917539">for</span>&nbsp;<span class="ident" id="6917543">i</span>&nbsp;<span class="op" id="6917545">:=</span>&nbsp;<span class="num" id="6917548">0</span><span class="op" id="6917549">;</span>&nbsp;<span class="ident" id="6917551"><a href="/net/tcp_test.go.html#6917543">i</a></span>&nbsp;<span class="op" id="6917553">&lt;</span>&nbsp;<span class="ident" id="6917555"><a href="/net/tcp_test.go.html#6915811">N</a></span><span class="op" id="6917556">;</span>&nbsp;<span class="ident" id="6917558"><a href="/net/tcp_test.go.html#6917543">i</a></span><span class="op" id="6917559">++</span>&nbsp;<span class="op" id="6917562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917568">_</span><span class="op" id="6917569">,</span>&nbsp;<span class="ident" id="6917571">err</span>&nbsp;<span class="op" id="6917575">:=</span>&nbsp;<span class="ident" id="6917578"><a href="/net/tcp_test.go.html#6917488">c</a></span><span class="op" id="6917579">.</span><span class="ident" id="6917580">Read</span><span class="op" id="6917584">(</span><span class="ident" id="6917585"><a href="/net/tcp_test.go.html#6917524">buf</a></span><span class="op" id="6917588">[</span><span class="op" id="6917589">:</span><span class="op" id="6917590">]</span><span class="op" id="6917591">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917597">if</span>&nbsp;<span class="ident" id="6917600"><a href="/net/tcp_test.go.html#6917571">err</a></span>&nbsp;<span class="op" id="6917604">!=</span>&nbsp;<span class="ident" id="6917607">nil</span>&nbsp;<span class="op" id="6917611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917618"><a href="/net/tcp_test.go.html#6915462">b</a></span><span class="op" id="6917619">.</span><span class="ident" id="6917620">Errorf</span><span class="op" id="6917626">(</span><span class="string" id="6917627">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6917644">,</span>&nbsp;<span class="ident" id="6917646"><a href="/net/tcp_test.go.html#6917571">err</a></span><span class="op" id="6917649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6917656">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917672">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917677"><a href="/net/tcp_test.go.html#6917488">c</a></span><span class="op" id="6917678">.</span><span class="ident" id="6917679">Close</span><span class="op" id="6917684">(</span><span class="op" id="6917685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917689">}</span><span class="op" id="6917690">(</span><span class="ident" id="6917691"><a href="/net/tcp_test.go.html#6915876">clients</a></span><span class="op" id="6917698">[</span><span class="ident" id="6917699"><a href="/net/tcp_test.go.html#6916462">p</a></span><span class="op" id="6917700">]</span><span class="op" id="6917701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917707"><a href="/net/tcp_test.go.html#6916424">wg</a></span><span class="op" id="6917709">.</span><span class="ident" id="6917710">Wait</span><span class="op" id="6917714">(</span><span class="op" id="6917715">)</span><br>
<span class="lineno"></span><span class="op" id="6917717">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6917720">type</span>&nbsp;<span class="ident" id="6917725">resolveTCPAddrTest</span>&nbsp;<span class="keyword" id="6917744">struct</span>&nbsp;<span class="op" id="6917751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917754">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6917768">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917776">litAddrOrName</span>&nbsp;<span class="builtintype" id="6917790">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917798">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6917812">*</span><span class="ident" id="6917813"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6917822">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6917836">error</span><br>
<span class="lineno"></span><span class="op" id="6917842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6917845">var</span>&nbsp;<span class="ident" id="6917849">resolveTCPAddrTests</span>&nbsp;<span class="op" id="6917869">=</span>&nbsp;<span class="op" id="6917871">[</span><span class="op" id="6917872">]</span><span class="ident" id="6917873"><a href="/net/tcp_test.go.html#6917725">resolveTCPAddrTest</a></span><span class="op" id="6917891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917894">{</span><span class="string" id="6917895">&#34;tcp&#34;</span><span class="op" id="6917900">,</span>&nbsp;<span class="string" id="6917902">&#34;127.0.0.1:0&#34;</span><span class="op" id="6917915">,</span>&nbsp;<span class="op" id="6917917">&amp;</span><span class="ident" id="6917918"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6917925">{</span><span class="ident" id="6917926">IP</span><span class="op" id="6917928">:</span>&nbsp;<span class="ident" id="6917930"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6917934">(</span><span class="num" id="6917935">127</span><span class="op" id="6917938">,</span>&nbsp;<span class="num" id="6917940">0</span><span class="op" id="6917941">,</span>&nbsp;<span class="num" id="6917943">0</span><span class="op" id="6917944">,</span>&nbsp;<span class="num" id="6917946">1</span><span class="op" id="6917947">)</span><span class="op" id="6917948">,</span>&nbsp;<span class="ident" id="6917950">Port</span><span class="op" id="6917954">:</span>&nbsp;<span class="num" id="6917956">0</span><span class="op" id="6917957">}</span><span class="op" id="6917958">,</span>&nbsp;<span class="ident" id="6917960">nil</span><span class="op" id="6917963">}</span><span class="op" id="6917964">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6917967">{</span><span class="string" id="6917968">&#34;tcp4&#34;</span><span class="op" id="6917974">,</span>&nbsp;<span class="string" id="6917976">&#34;127.0.0.1:65535&#34;</span><span class="op" id="6917993">,</span>&nbsp;<span class="op" id="6917995">&amp;</span><span class="ident" id="6917996"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918003">{</span><span class="ident" id="6918004">IP</span><span class="op" id="6918006">:</span>&nbsp;<span class="ident" id="6918008"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6918012">(</span><span class="num" id="6918013">127</span><span class="op" id="6918016">,</span>&nbsp;<span class="num" id="6918018">0</span><span class="op" id="6918019">,</span>&nbsp;<span class="num" id="6918021">0</span><span class="op" id="6918022">,</span>&nbsp;<span class="num" id="6918024">1</span><span class="op" id="6918025">)</span><span class="op" id="6918026">,</span>&nbsp;<span class="ident" id="6918028">Port</span><span class="op" id="6918032">:</span>&nbsp;<span class="num" id="6918034">65535</span><span class="op" id="6918039">}</span><span class="op" id="6918040">,</span>&nbsp;<span class="ident" id="6918042">nil</span><span class="op" id="6918045">}</span><span class="op" id="6918046">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918050">{</span><span class="string" id="6918051">&#34;tcp&#34;</span><span class="op" id="6918056">,</span>&nbsp;<span class="string" id="6918058">&#34;[::1]:1&#34;</span><span class="op" id="6918067">,</span>&nbsp;<span class="op" id="6918069">&amp;</span><span class="ident" id="6918070"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918077">{</span><span class="ident" id="6918078">IP</span><span class="op" id="6918080">:</span>&nbsp;<span class="ident" id="6918082"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918089">(</span><span class="string" id="6918090">&#34;::1&#34;</span><span class="op" id="6918095">)</span><span class="op" id="6918096">,</span>&nbsp;<span class="ident" id="6918098">Port</span><span class="op" id="6918102">:</span>&nbsp;<span class="num" id="6918104">1</span><span class="op" id="6918105">}</span><span class="op" id="6918106">,</span>&nbsp;<span class="ident" id="6918108">nil</span><span class="op" id="6918111">}</span><span class="op" id="6918112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918115">{</span><span class="string" id="6918116">&#34;tcp6&#34;</span><span class="op" id="6918122">,</span>&nbsp;<span class="string" id="6918124">&#34;[::1]:65534&#34;</span><span class="op" id="6918137">,</span>&nbsp;<span class="op" id="6918139">&amp;</span><span class="ident" id="6918140"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918147">{</span><span class="ident" id="6918148">IP</span><span class="op" id="6918150">:</span>&nbsp;<span class="ident" id="6918152"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918159">(</span><span class="string" id="6918160">&#34;::1&#34;</span><span class="op" id="6918165">)</span><span class="op" id="6918166">,</span>&nbsp;<span class="ident" id="6918168">Port</span><span class="op" id="6918172">:</span>&nbsp;<span class="num" id="6918174">65534</span><span class="op" id="6918179">}</span><span class="op" id="6918180">,</span>&nbsp;<span class="ident" id="6918182">nil</span><span class="op" id="6918185">}</span><span class="op" id="6918186">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918190">{</span><span class="string" id="6918191">&#34;tcp&#34;</span><span class="op" id="6918196">,</span>&nbsp;<span class="string" id="6918198">&#34;[::1%en0]:1&#34;</span><span class="op" id="6918211">,</span>&nbsp;<span class="op" id="6918213">&amp;</span><span class="ident" id="6918214"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918221">{</span><span class="ident" id="6918222">IP</span><span class="op" id="6918224">:</span>&nbsp;<span class="ident" id="6918226"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918233">(</span><span class="string" id="6918234">&#34;::1&#34;</span><span class="op" id="6918239">)</span><span class="op" id="6918240">,</span>&nbsp;<span class="ident" id="6918242">Port</span><span class="op" id="6918246">:</span>&nbsp;<span class="num" id="6918248">1</span><span class="op" id="6918249">,</span>&nbsp;<span class="ident" id="6918251">Zone</span><span class="op" id="6918255">:</span>&nbsp;<span class="string" id="6918257">&#34;en0&#34;</span><span class="op" id="6918262">}</span><span class="op" id="6918263">,</span>&nbsp;<span class="ident" id="6918265">nil</span><span class="op" id="6918268">}</span><span class="op" id="6918269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918272">{</span><span class="string" id="6918273">&#34;tcp6&#34;</span><span class="op" id="6918279">,</span>&nbsp;<span class="string" id="6918281">&#34;[::1%911]:2&#34;</span><span class="op" id="6918294">,</span>&nbsp;<span class="op" id="6918296">&amp;</span><span class="ident" id="6918297"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918304">{</span><span class="ident" id="6918305">IP</span><span class="op" id="6918307">:</span>&nbsp;<span class="ident" id="6918309"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918316">(</span><span class="string" id="6918317">&#34;::1&#34;</span><span class="op" id="6918322">)</span><span class="op" id="6918323">,</span>&nbsp;<span class="ident" id="6918325">Port</span><span class="op" id="6918329">:</span>&nbsp;<span class="num" id="6918331">2</span><span class="op" id="6918332">,</span>&nbsp;<span class="ident" id="6918334">Zone</span><span class="op" id="6918338">:</span>&nbsp;<span class="string" id="6918340">&#34;911&#34;</span><span class="op" id="6918345">}</span><span class="op" id="6918346">,</span>&nbsp;<span class="ident" id="6918348">nil</span><span class="op" id="6918351">}</span><span class="op" id="6918352">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918356">{</span><span class="string" id="6918357">&#34;&#34;</span><span class="op" id="6918359">,</span>&nbsp;<span class="string" id="6918361">&#34;127.0.0.1:0&#34;</span><span class="op" id="6918374">,</span>&nbsp;<span class="op" id="6918376">&amp;</span><span class="ident" id="6918377"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918384">{</span><span class="ident" id="6918385">IP</span><span class="op" id="6918387">:</span>&nbsp;<span class="ident" id="6918389"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6918393">(</span><span class="num" id="6918394">127</span><span class="op" id="6918397">,</span>&nbsp;<span class="num" id="6918399">0</span><span class="op" id="6918400">,</span>&nbsp;<span class="num" id="6918402">0</span><span class="op" id="6918403">,</span>&nbsp;<span class="num" id="6918405">1</span><span class="op" id="6918406">)</span><span class="op" id="6918407">,</span>&nbsp;<span class="ident" id="6918409">Port</span><span class="op" id="6918413">:</span>&nbsp;<span class="num" id="6918415">0</span><span class="op" id="6918416">}</span><span class="op" id="6918417">,</span>&nbsp;<span class="ident" id="6918419">nil</span><span class="op" id="6918422">}</span><span class="op" id="6918423">,</span>&nbsp;<span class="comment" id="6918425">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918445">{</span><span class="string" id="6918446">&#34;&#34;</span><span class="op" id="6918448">,</span>&nbsp;<span class="string" id="6918450">&#34;[::1]:0&#34;</span><span class="op" id="6918459">,</span>&nbsp;<span class="op" id="6918461">&amp;</span><span class="ident" id="6918462"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918469">{</span><span class="ident" id="6918470">IP</span><span class="op" id="6918472">:</span>&nbsp;<span class="ident" id="6918474"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918481">(</span><span class="string" id="6918482">&#34;::1&#34;</span><span class="op" id="6918487">)</span><span class="op" id="6918488">,</span>&nbsp;<span class="ident" id="6918490">Port</span><span class="op" id="6918494">:</span>&nbsp;<span class="num" id="6918496">0</span><span class="op" id="6918497">}</span><span class="op" id="6918498">,</span>&nbsp;<span class="ident" id="6918500">nil</span><span class="op" id="6918503">}</span><span class="op" id="6918504">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6918514">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918535">{</span><span class="string" id="6918536">&#34;tcp&#34;</span><span class="op" id="6918541">,</span>&nbsp;<span class="string" id="6918543">&#34;:12345&#34;</span><span class="op" id="6918551">,</span>&nbsp;<span class="op" id="6918553">&amp;</span><span class="ident" id="6918554"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918561">{</span><span class="ident" id="6918562">Port</span><span class="op" id="6918566">:</span>&nbsp;<span class="num" id="6918568">12345</span><span class="op" id="6918573">}</span><span class="op" id="6918574">,</span>&nbsp;<span class="ident" id="6918576">nil</span><span class="op" id="6918579">}</span><span class="op" id="6918580">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918584">{</span><span class="string" id="6918585">&#34;http&#34;</span><span class="op" id="6918591">,</span>&nbsp;<span class="string" id="6918593">&#34;127.0.0.1:0&#34;</span><span class="op" id="6918606">,</span>&nbsp;<span class="ident" id="6918608">nil</span><span class="op" id="6918611">,</span>&nbsp;<span class="ident" id="6918613"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="6918632">(</span><span class="string" id="6918633">&#34;http&#34;</span><span class="op" id="6918639">)</span><span class="op" id="6918640">}</span><span class="op" id="6918641">,</span><br>
<span class="lineno"></span><span class="op" id="6918643">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6918646">func</span>&nbsp;<span class="ident" id="6918651">init</span><span class="op" id="6918655">(</span><span class="op" id="6918656">)</span>&nbsp;<span class="op" id="6918658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6918661">if</span>&nbsp;<span class="ident" id="6918664">ifi</span>&nbsp;<span class="op" id="6918668">:=</span>&nbsp;<span class="ident" id="6918671"><a href="/net/interface_test.go.html#6819206">loopbackInterface</a></span><span class="op" id="6918688">(</span><span class="op" id="6918689">)</span><span class="op" id="6918690">;</span>&nbsp;<span class="ident" id="6918692"><a href="/net/tcp_test.go.html#6918664">ifi</a></span>&nbsp;<span class="op" id="6918696">!=</span>&nbsp;<span class="ident" id="6918699">nil</span>&nbsp;<span class="op" id="6918703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6918707">index</span>&nbsp;<span class="op" id="6918713">:=</span>&nbsp;<span class="ident" id="6918716"><a href="/net/tcp_test.go.html#6912188">fmt</a></span><span class="op" id="6918719">.</span><span class="ident" id="6918720">Sprintf</span><span class="op" id="6918727">(</span><span class="string" id="6918728">&#34;%v&#34;</span><span class="op" id="6918732">,</span>&nbsp;<span class="ident" id="6918734"><a href="/net/tcp_test.go.html#6918664">ifi</a></span><span class="op" id="6918737">.</span><span class="ident" id="6918738">Index</span><span class="op" id="6918743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6918747"><a href="/net/tcp_test.go.html#6917849">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6918767">=</span>&nbsp;<span class="builtinfunc" id="6918769">append</span><span class="op" id="6918775">(</span><span class="ident" id="6918776"><a href="/net/tcp_test.go.html#6917849">resolveTCPAddrTests</a></span><span class="op" id="6918795">,</span>&nbsp;<span class="op" id="6918797">[</span><span class="op" id="6918798">]</span><span class="ident" id="6918799"><a href="/net/tcp_test.go.html#6917725">resolveTCPAddrTest</a></span><span class="op" id="6918817">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918822">{</span><span class="string" id="6918823">&#34;tcp6&#34;</span><span class="op" id="6918829">,</span>&nbsp;<span class="string" id="6918831">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="6918843">+</span>&nbsp;<span class="ident" id="6918845"><a href="/net/tcp_test.go.html#6918664">ifi</a></span><span class="op" id="6918848">.</span><span class="ident" id="6918849">Name</span>&nbsp;<span class="op" id="6918854">+</span>&nbsp;<span class="string" id="6918856">&#34;]:3&#34;</span><span class="op" id="6918861">,</span>&nbsp;<span class="op" id="6918863">&amp;</span><span class="ident" id="6918864"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918871">{</span><span class="ident" id="6918872">IP</span><span class="op" id="6918874">:</span>&nbsp;<span class="ident" id="6918876"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6918883">(</span><span class="string" id="6918884">&#34;fe80::1&#34;</span><span class="op" id="6918893">)</span><span class="op" id="6918894">,</span>&nbsp;<span class="ident" id="6918896">Port</span><span class="op" id="6918900">:</span>&nbsp;<span class="num" id="6918902">3</span><span class="op" id="6918903">,</span>&nbsp;<span class="ident" id="6918905">Zone</span><span class="op" id="6918909">:</span>&nbsp;<span class="ident" id="6918911"><a href="/net/ipsock.go.html#2635208">zoneToString</a></span><span class="op" id="6918923">(</span><span class="ident" id="6918924"><a href="/net/tcp_test.go.html#6918664">ifi</a></span><span class="op" id="6918927">.</span><span class="ident" id="6918928">Index</span><span class="op" id="6918933">)</span><span class="op" id="6918934">}</span><span class="op" id="6918935">,</span>&nbsp;<span class="ident" id="6918937">nil</span><span class="op" id="6918940">}</span><span class="op" id="6918941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6918946">{</span><span class="string" id="6918947">&#34;tcp6&#34;</span><span class="op" id="6918953">,</span>&nbsp;<span class="string" id="6918955">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="6918967">+</span>&nbsp;<span class="ident" id="6918969"><a href="/net/tcp_test.go.html#6918707">index</a></span>&nbsp;<span class="op" id="6918975">+</span>&nbsp;<span class="string" id="6918977">&#34;]:4&#34;</span><span class="op" id="6918982">,</span>&nbsp;<span class="op" id="6918984">&amp;</span><span class="ident" id="6918985"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6918992">{</span><span class="ident" id="6918993">IP</span><span class="op" id="6918995">:</span>&nbsp;<span class="ident" id="6918997"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="6919004">(</span><span class="string" id="6919005">&#34;fe80::1&#34;</span><span class="op" id="6919014">)</span><span class="op" id="6919015">,</span>&nbsp;<span class="ident" id="6919017">Port</span><span class="op" id="6919021">:</span>&nbsp;<span class="num" id="6919023">4</span><span class="op" id="6919024">,</span>&nbsp;<span class="ident" id="6919026">Zone</span><span class="op" id="6919030">:</span>&nbsp;<span class="ident" id="6919032"><a href="/net/tcp_test.go.html#6918707">index</a></span><span class="op" id="6919037">}</span><span class="op" id="6919038">,</span>&nbsp;<span class="ident" id="6919040">nil</span><span class="op" id="6919043">}</span><span class="op" id="6919044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919048">}</span><span class="op" id="6919049">...</span><span class="op" id="6919052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919058">if</span>&nbsp;<span class="ident" id="6919061">ips</span><span class="op" id="6919064">,</span>&nbsp;<span class="ident" id="6919066">err</span>&nbsp;<span class="op" id="6919070">:=</span>&nbsp;<span class="ident" id="6919073"><a href="/net/lookup.go.html#2642100">LookupIP</a></span><span class="op" id="6919081">(</span><span class="string" id="6919082">&#34;localhost&#34;</span><span class="op" id="6919093">)</span><span class="op" id="6919094">;</span>&nbsp;<span class="ident" id="6919096"><a href="/net/tcp_test.go.html#6919066">err</a></span>&nbsp;<span class="op" id="6919100">==</span>&nbsp;<span class="ident" id="6919103">nil</span>&nbsp;<span class="op" id="6919107">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6919110">len</span><span class="op" id="6919113">(</span><span class="ident" id="6919114"><a href="/net/tcp_test.go.html#6919061">ips</a></span><span class="op" id="6919117">)</span>&nbsp;<span class="op" id="6919119">&gt;</span>&nbsp;<span class="num" id="6919121">1</span>&nbsp;<span class="op" id="6919123">&amp;&amp;</span>&nbsp;<span class="ident" id="6919126"><a href="/net/ipsock.go.html#2627659">supportsIPv4</a></span>&nbsp;<span class="op" id="6919139">&amp;&amp;</span>&nbsp;<span class="ident" id="6919142"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6919155">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919159"><a href="/net/tcp_test.go.html#6917849">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6919179">=</span>&nbsp;<span class="builtinfunc" id="6919181">append</span><span class="op" id="6919187">(</span><span class="ident" id="6919188"><a href="/net/tcp_test.go.html#6917849">resolveTCPAddrTests</a></span><span class="op" id="6919207">,</span>&nbsp;<span class="op" id="6919209">[</span><span class="op" id="6919210">]</span><span class="ident" id="6919211"><a href="/net/tcp_test.go.html#6917725">resolveTCPAddrTest</a></span><span class="op" id="6919229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919234">{</span><span class="string" id="6919235">&#34;tcp&#34;</span><span class="op" id="6919240">,</span>&nbsp;<span class="string" id="6919242">&#34;localhost:5&#34;</span><span class="op" id="6919255">,</span>&nbsp;<span class="op" id="6919257">&amp;</span><span class="ident" id="6919258"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6919265">{</span><span class="ident" id="6919266">IP</span><span class="op" id="6919268">:</span>&nbsp;<span class="ident" id="6919270"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6919274">(</span><span class="num" id="6919275">127</span><span class="op" id="6919278">,</span>&nbsp;<span class="num" id="6919280">0</span><span class="op" id="6919281">,</span>&nbsp;<span class="num" id="6919283">0</span><span class="op" id="6919284">,</span>&nbsp;<span class="num" id="6919286">1</span><span class="op" id="6919287">)</span><span class="op" id="6919288">,</span>&nbsp;<span class="ident" id="6919290">Port</span><span class="op" id="6919294">:</span>&nbsp;<span class="num" id="6919296">5</span><span class="op" id="6919297">}</span><span class="op" id="6919298">,</span>&nbsp;<span class="ident" id="6919300">nil</span><span class="op" id="6919303">}</span><span class="op" id="6919304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919309">{</span><span class="string" id="6919310">&#34;tcp4&#34;</span><span class="op" id="6919316">,</span>&nbsp;<span class="string" id="6919318">&#34;localhost:6&#34;</span><span class="op" id="6919331">,</span>&nbsp;<span class="op" id="6919333">&amp;</span><span class="ident" id="6919334"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6919341">{</span><span class="ident" id="6919342">IP</span><span class="op" id="6919344">:</span>&nbsp;<span class="ident" id="6919346"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6919350">(</span><span class="num" id="6919351">127</span><span class="op" id="6919354">,</span>&nbsp;<span class="num" id="6919356">0</span><span class="op" id="6919357">,</span>&nbsp;<span class="num" id="6919359">0</span><span class="op" id="6919360">,</span>&nbsp;<span class="num" id="6919362">1</span><span class="op" id="6919363">)</span><span class="op" id="6919364">,</span>&nbsp;<span class="ident" id="6919366">Port</span><span class="op" id="6919370">:</span>&nbsp;<span class="num" id="6919372">6</span><span class="op" id="6919373">}</span><span class="op" id="6919374">,</span>&nbsp;<span class="ident" id="6919376">nil</span><span class="op" id="6919379">}</span><span class="op" id="6919380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919385">{</span><span class="string" id="6919386">&#34;tcp6&#34;</span><span class="op" id="6919392">,</span>&nbsp;<span class="string" id="6919394">&#34;localhost:7&#34;</span><span class="op" id="6919407">,</span>&nbsp;<span class="op" id="6919409">&amp;</span><span class="ident" id="6919410"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6919417">{</span><span class="ident" id="6919418">IP</span><span class="op" id="6919420">:</span>&nbsp;<span class="ident" id="6919422"><a href="/net/ip.go.html#2605971">IPv6loopback</a></span><span class="op" id="6919434">,</span>&nbsp;<span class="ident" id="6919436">Port</span><span class="op" id="6919440">:</span>&nbsp;<span class="num" id="6919442">7</span><span class="op" id="6919443">}</span><span class="op" id="6919444">,</span>&nbsp;<span class="ident" id="6919446">nil</span><span class="op" id="6919449">}</span><span class="op" id="6919450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919454">}</span><span class="op" id="6919455">...</span><span class="op" id="6919458">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919461">}</span><br>
<span class="lineno"></span><span class="op" id="6919463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6919466">func</span>&nbsp;<span class="ident" id="6919471">TestResolveTCPAddr</span><span class="op" id="6919489">(</span><span class="ident" id="6919490">t</span>&nbsp;<span class="op" id="6919492">*</span><span class="ident" id="6919493"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6919500">.</span><span class="ident" id="6919501">T</span><span class="op" id="6919502">)</span>&nbsp;<span class="op" id="6919504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919507">for</span>&nbsp;<span class="ident" id="6919511">_</span><span class="op" id="6919512">,</span>&nbsp;<span class="ident" id="6919514">tt</span>&nbsp;<span class="op" id="6919517">:=</span>&nbsp;<span class="keyword" id="6919520">range</span>&nbsp;<span class="ident" id="6919526"><a href="/net/tcp_test.go.html#6917849">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="6919546">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919550">addr</span><span class="op" id="6919554">,</span>&nbsp;<span class="ident" id="6919556">err</span>&nbsp;<span class="op" id="6919560">:=</span>&nbsp;<span class="ident" id="6919563"><a href="/net/tcpsock.go.html#2692376">ResolveTCPAddr</a></span><span class="op" id="6919577">(</span><span class="ident" id="6919578"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919580">.</span><span class="ident" id="6919581">net</span><span class="op" id="6919584">,</span>&nbsp;<span class="ident" id="6919586"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919588">.</span><span class="ident" id="6919589">litAddrOrName</span><span class="op" id="6919602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919606">if</span>&nbsp;<span class="ident" id="6919609"><a href="/net/tcp_test.go.html#6919556">err</a></span>&nbsp;<span class="op" id="6919613">!=</span>&nbsp;<span class="ident" id="6919616"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919618">.</span><span class="ident" id="6919619">err</span>&nbsp;<span class="op" id="6919623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919628"><a href="/net/tcp_test.go.html#6919490">t</a></span><span class="op" id="6919629">.</span><span class="ident" id="6919630">Fatalf</span><span class="op" id="6919636">(</span><span class="string" id="6919637">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6919672">,</span>&nbsp;<span class="ident" id="6919674"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919676">.</span><span class="ident" id="6919677">net</span><span class="op" id="6919680">,</span>&nbsp;<span class="ident" id="6919682"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919684">.</span><span class="ident" id="6919685">litAddrOrName</span><span class="op" id="6919698">,</span>&nbsp;<span class="ident" id="6919700"><a href="/net/tcp_test.go.html#6919556">err</a></span><span class="op" id="6919703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919711">if</span>&nbsp;<span class="op" id="6919714">!</span><span class="ident" id="6919715"><a href="/net/tcp_test.go.html#6912201">reflect</a></span><span class="op" id="6919722">.</span><span class="ident" id="6919723">DeepEqual</span><span class="op" id="6919732">(</span><span class="ident" id="6919733"><a href="/net/tcp_test.go.html#6919550">addr</a></span><span class="op" id="6919737">,</span>&nbsp;<span class="ident" id="6919739"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919741">.</span><span class="ident" id="6919742">addr</span><span class="op" id="6919746">)</span>&nbsp;<span class="op" id="6919748">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919753"><a href="/net/tcp_test.go.html#6919490">t</a></span><span class="op" id="6919754">.</span><span class="ident" id="6919755">Fatalf</span><span class="op" id="6919761">(</span><span class="string" id="6919762">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="6919802">,</span>&nbsp;<span class="ident" id="6919804"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919806">.</span><span class="ident" id="6919807">net</span><span class="op" id="6919810">,</span>&nbsp;<span class="ident" id="6919812"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919814">.</span><span class="ident" id="6919815">litAddrOrName</span><span class="op" id="6919828">,</span>&nbsp;<span class="ident" id="6919830"><a href="/net/tcp_test.go.html#6919550">addr</a></span><span class="op" id="6919834">,</span>&nbsp;<span class="ident" id="6919836"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919838">.</span><span class="ident" id="6919839">addr</span><span class="op" id="6919843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6919847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919851">if</span>&nbsp;<span class="ident" id="6919854"><a href="/net/tcp_test.go.html#6919556">err</a></span>&nbsp;<span class="op" id="6919858">==</span>&nbsp;<span class="ident" id="6919861">nil</span>&nbsp;<span class="op" id="6919865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919870">str</span>&nbsp;<span class="op" id="6919874">:=</span>&nbsp;<span class="ident" id="6919877"><a href="/net/tcp_test.go.html#6919550">addr</a></span><span class="op" id="6919881">.</span><span class="ident" id="6919882">String</span><span class="op" id="6919888">(</span><span class="op" id="6919889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919894">addr1</span><span class="op" id="6919899">,</span>&nbsp;<span class="ident" id="6919901">err</span>&nbsp;<span class="op" id="6919905">:=</span>&nbsp;<span class="ident" id="6919908"><a href="/net/tcpsock.go.html#2692376">ResolveTCPAddr</a></span><span class="op" id="6919922">(</span><span class="ident" id="6919923"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6919925">.</span><span class="ident" id="6919926">net</span><span class="op" id="6919929">,</span>&nbsp;<span class="ident" id="6919931"><a href="/net/tcp_test.go.html#6919870">str</a></span><span class="op" id="6919934">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6919939">if</span>&nbsp;<span class="ident" id="6919942"><a href="/net/tcp_test.go.html#6919901">err</a></span>&nbsp;<span class="op" id="6919946">!=</span>&nbsp;<span class="ident" id="6919949">nil</span>&nbsp;<span class="op" id="6919953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6919959"><a href="/net/tcp_test.go.html#6919490">t</a></span><span class="op" id="6919960">.</span><span class="ident" id="6919961">Fatalf</span><span class="op" id="6919967">(</span><span class="string" id="6919968">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="6920006">,</span>&nbsp;<span class="ident" id="6920008"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6920010">.</span><span class="ident" id="6920011">net</span><span class="op" id="6920014">,</span>&nbsp;<span class="ident" id="6920016"><a href="/net/tcp_test.go.html#6919870">str</a></span><span class="op" id="6920019">,</span>&nbsp;<span class="ident" id="6920021"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6920023">.</span><span class="ident" id="6920024">litAddrOrName</span><span class="op" id="6920037">,</span>&nbsp;<span class="ident" id="6920039"><a href="/net/tcp_test.go.html#6919901">err</a></span><span class="op" id="6920042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920052">if</span>&nbsp;<span class="op" id="6920055">!</span><span class="ident" id="6920056"><a href="/net/tcp_test.go.html#6912201">reflect</a></span><span class="op" id="6920063">.</span><span class="ident" id="6920064">DeepEqual</span><span class="op" id="6920073">(</span><span class="ident" id="6920074"><a href="/net/tcp_test.go.html#6919894">addr1</a></span><span class="op" id="6920079">,</span>&nbsp;<span class="ident" id="6920081"><a href="/net/tcp_test.go.html#6919550">addr</a></span><span class="op" id="6920085">)</span>&nbsp;<span class="op" id="6920087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920093"><a href="/net/tcp_test.go.html#6919490">t</a></span><span class="op" id="6920094">.</span><span class="ident" id="6920095">Fatalf</span><span class="op" id="6920101">(</span><span class="string" id="6920102">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="6920152">,</span>&nbsp;<span class="ident" id="6920154"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6920156">.</span><span class="ident" id="6920157">net</span><span class="op" id="6920160">,</span>&nbsp;<span class="ident" id="6920162"><a href="/net/tcp_test.go.html#6919870">str</a></span><span class="op" id="6920165">,</span>&nbsp;<span class="ident" id="6920167"><a href="/net/tcp_test.go.html#6919514">tt</a></span><span class="op" id="6920169">.</span><span class="ident" id="6920170">litAddrOrName</span><span class="op" id="6920183">,</span>&nbsp;<span class="ident" id="6920185"><a href="/net/tcp_test.go.html#6919894">addr1</a></span><span class="op" id="6920190">,</span>&nbsp;<span class="ident" id="6920192"><a href="/net/tcp_test.go.html#6919550">addr</a></span><span class="op" id="6920196">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920208">}</span><br>
<span class="lineno"></span><span class="op" id="6920210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="6920213">var</span>&nbsp;<span class="ident" id="6920217">tcpListenerNameTests</span>&nbsp;<span class="op" id="6920238">=</span>&nbsp;<span class="op" id="6920240">[</span><span class="op" id="6920241">]</span><span class="keyword" id="6920242">struct</span>&nbsp;<span class="op" id="6920249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920252">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6920258">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920266">laddr</span>&nbsp;<span class="op" id="6920272">*</span><span class="ident" id="6920273"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><br>
<span class="lineno"></span><span class="op" id="6920281">}</span><span class="op" id="6920282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920285">{</span><span class="string" id="6920286">&#34;tcp4&#34;</span><span class="op" id="6920292">,</span>&nbsp;<span class="op" id="6920294">&amp;</span><span class="ident" id="6920295"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6920302">{</span><span class="ident" id="6920303">IP</span><span class="op" id="6920305">:</span>&nbsp;<span class="ident" id="6920307"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="6920311">(</span><span class="num" id="6920312">127</span><span class="op" id="6920315">,</span>&nbsp;<span class="num" id="6920317">0</span><span class="op" id="6920318">,</span>&nbsp;<span class="num" id="6920320">0</span><span class="op" id="6920321">,</span>&nbsp;<span class="num" id="6920323">1</span><span class="op" id="6920324">)</span><span class="op" id="6920325">}</span><span class="op" id="6920326">}</span><span class="op" id="6920327">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920330">{</span><span class="string" id="6920331">&#34;tcp4&#34;</span><span class="op" id="6920337">,</span>&nbsp;<span class="op" id="6920339">&amp;</span><span class="ident" id="6920340"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6920347">{</span><span class="op" id="6920348">}</span><span class="op" id="6920349">}</span><span class="op" id="6920350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920353">{</span><span class="string" id="6920354">&#34;tcp4&#34;</span><span class="op" id="6920360">,</span>&nbsp;<span class="ident" id="6920362">nil</span><span class="op" id="6920365">}</span><span class="op" id="6920366">,</span><br>
<span class="lineno"></span><span class="op" id="6920368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6920371">func</span>&nbsp;<span class="ident" id="6920376">TestTCPListenerName</span><span class="op" id="6920395">(</span><span class="ident" id="6920396">t</span>&nbsp;<span class="op" id="6920398">*</span><span class="ident" id="6920399"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6920406">.</span><span class="ident" id="6920407">T</span><span class="op" id="6920408">)</span>&nbsp;<span class="op" id="6920410">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920413">if</span>&nbsp;<span class="ident" id="6920416"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6920423">.</span><span class="ident" id="6920424">Short</span><span class="op" id="6920429">(</span><span class="op" id="6920430">)</span>&nbsp;<span class="op" id="6920432">||</span>&nbsp;<span class="op" id="6920435">!</span><span class="op" id="6920436">*</span><span class="ident" id="6920437"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6920450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920454"><a href="/net/tcp_test.go.html#6920396">t</a></span><span class="op" id="6920455">.</span><span class="ident" id="6920456">Skip</span><span class="op" id="6920460">(</span><span class="string" id="6920461">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6920502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920509">for</span>&nbsp;<span class="ident" id="6920513">_</span><span class="op" id="6920514">,</span>&nbsp;<span class="ident" id="6920516">tt</span>&nbsp;<span class="op" id="6920519">:=</span>&nbsp;<span class="keyword" id="6920522">range</span>&nbsp;<span class="ident" id="6920528"><a href="/net/tcp_test.go.html#6920217">tcpListenerNameTests</a></span>&nbsp;<span class="op" id="6920549">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920553">ln</span><span class="op" id="6920555">,</span>&nbsp;<span class="ident" id="6920557">err</span>&nbsp;<span class="op" id="6920561">:=</span>&nbsp;<span class="ident" id="6920564"><a href="/net/tcpsock_posix.go.html#2701875">ListenTCP</a></span><span class="op" id="6920573">(</span><span class="ident" id="6920574"><a href="/net/tcp_test.go.html#6920516">tt</a></span><span class="op" id="6920576">.</span><span class="ident" id="6920577">net</span><span class="op" id="6920580">,</span>&nbsp;<span class="ident" id="6920582"><a href="/net/tcp_test.go.html#6920516">tt</a></span><span class="op" id="6920584">.</span><span class="ident" id="6920585">laddr</span><span class="op" id="6920590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920594">if</span>&nbsp;<span class="ident" id="6920597"><a href="/net/tcp_test.go.html#6920557">err</a></span>&nbsp;<span class="op" id="6920601">!=</span>&nbsp;<span class="ident" id="6920604">nil</span>&nbsp;<span class="op" id="6920608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920613"><a href="/net/tcp_test.go.html#6920396">t</a></span><span class="op" id="6920614">.</span><span class="ident" id="6920615">Fatalf</span><span class="op" id="6920621">(</span><span class="string" id="6920622">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6920644">,</span>&nbsp;<span class="ident" id="6920646"><a href="/net/tcp_test.go.html#6920557">err</a></span><span class="op" id="6920649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920657">defer</span>&nbsp;<span class="ident" id="6920663"><a href="/net/tcp_test.go.html#6920553">ln</a></span><span class="op" id="6920665">.</span><span class="ident" id="6920666">Close</span><span class="op" id="6920671">(</span><span class="op" id="6920672">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920676">la</span>&nbsp;<span class="op" id="6920679">:=</span>&nbsp;<span class="ident" id="6920682"><a href="/net/tcp_test.go.html#6920553">ln</a></span><span class="op" id="6920684">.</span><span class="ident" id="6920685">Addr</span><span class="op" id="6920689">(</span><span class="op" id="6920690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920694">if</span>&nbsp;<span class="ident" id="6920697">a</span><span class="op" id="6920698">,</span>&nbsp;<span class="ident" id="6920700">ok</span>&nbsp;<span class="op" id="6920703">:=</span>&nbsp;<span class="ident" id="6920706"><a href="/net/tcp_test.go.html#6920676">la</a></span><span class="op" id="6920708">.</span><span class="op" id="6920709">(</span><span class="op" id="6920710">*</span><span class="ident" id="6920711"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6920718">)</span><span class="op" id="6920719">;</span>&nbsp;<span class="op" id="6920721">!</span><span class="ident" id="6920722"><a href="/net/tcp_test.go.html#6920700">ok</a></span>&nbsp;<span class="op" id="6920725">||</span>&nbsp;<span class="ident" id="6920728"><a href="/net/tcp_test.go.html#6920697">a</a></span><span class="op" id="6920729">.</span><span class="ident" id="6920730">Port</span>&nbsp;<span class="op" id="6920735">==</span>&nbsp;<span class="num" id="6920738">0</span>&nbsp;<span class="op" id="6920740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920745"><a href="/net/tcp_test.go.html#6920396">t</a></span><span class="op" id="6920746">.</span><span class="ident" id="6920747">Fatalf</span><span class="op" id="6920753">(</span><span class="string" id="6920754">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="6920815">,</span>&nbsp;<span class="ident" id="6920817"><a href="/net/tcp_test.go.html#6920676">la</a></span><span class="op" id="6920819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920826">}</span><br>
<span class="lineno">375</span><span class="op" id="6920828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6920831">func</span>&nbsp;<span class="ident" id="6920836">TestIPv6LinkLocalUnicastTCP</span><span class="op" id="6920863">(</span><span class="ident" id="6920864">t</span>&nbsp;<span class="op" id="6920866">*</span><span class="ident" id="6920867"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6920874">.</span><span class="ident" id="6920875">T</span><span class="op" id="6920876">)</span>&nbsp;<span class="op" id="6920878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920881">if</span>&nbsp;<span class="ident" id="6920884"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6920891">.</span><span class="ident" id="6920892">Short</span><span class="op" id="6920897">(</span><span class="op" id="6920898">)</span>&nbsp;<span class="op" id="6920900">||</span>&nbsp;<span class="op" id="6920903">!</span><span class="op" id="6920904">*</span><span class="ident" id="6920905"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6920918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920922"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6920923">.</span><span class="ident" id="6920924">Skip</span><span class="op" id="6920928">(</span><span class="string" id="6920929">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6920970">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6920973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6920976">if</span>&nbsp;<span class="op" id="6920979">!</span><span class="ident" id="6920980"><a href="/net/ipsock.go.html#2627769">supportsIPv6</a></span>&nbsp;<span class="op" id="6920993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6920997"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6920998">.</span><span class="ident" id="6920999">Skip</span><span class="op" id="6921003">(</span><span class="string" id="6921004">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6921027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921033">ifi</span>&nbsp;<span class="op" id="6921037">:=</span>&nbsp;<span class="ident" id="6921040"><a href="/net/interface_test.go.html#6819206">loopbackInterface</a></span><span class="op" id="6921057">(</span><span class="op" id="6921058">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921061">if</span>&nbsp;<span class="ident" id="6921064"><a href="/net/tcp_test.go.html#6921033">ifi</a></span>&nbsp;<span class="op" id="6921068">==</span>&nbsp;<span class="ident" id="6921071">nil</span>&nbsp;<span class="op" id="6921075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921079"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6921080">.</span><span class="ident" id="6921081">Skip</span><span class="op" id="6921085">(</span><span class="string" id="6921086">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="6921116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921122">laddr</span>&nbsp;<span class="op" id="6921128">:=</span>&nbsp;<span class="ident" id="6921131"><a href="/net/interface_test.go.html#6819593">ipv6LinkLocalUnicastAddr</a></span><span class="op" id="6921155">(</span><span class="ident" id="6921156"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921162">if</span>&nbsp;<span class="ident" id="6921165"><a href="/net/tcp_test.go.html#6921122">laddr</a></span>&nbsp;<span class="op" id="6921171">==</span>&nbsp;<span class="string" id="6921174">&#34;&#34;</span>&nbsp;<span class="op" id="6921177">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921181"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6921182">.</span><span class="ident" id="6921183">Skip</span><span class="op" id="6921187">(</span><span class="string" id="6921188">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="6921232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921239">type</span>&nbsp;<span class="ident" id="6921244">test</span>&nbsp;<span class="keyword" id="6921249">struct</span>&nbsp;<span class="op" id="6921256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921260">net</span><span class="op" id="6921263">,</span>&nbsp;<span class="ident" id="6921265">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6921271">string</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921280">nameLookup</span>&nbsp;<span class="builtintype" id="6921291">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921300">var</span>&nbsp;<span class="ident" id="6921304">tests</span>&nbsp;<span class="op" id="6921310">=</span>&nbsp;<span class="op" id="6921312">[</span><span class="op" id="6921313">]</span><span class="ident" id="6921314"><a href="/net/tcp_test.go.html#6921244">test</a></span><span class="op" id="6921318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921322">{</span><span class="string" id="6921323">&#34;tcp&#34;</span><span class="op" id="6921328">,</span>&nbsp;<span class="string" id="6921330">&#34;[&#34;</span>&nbsp;<span class="op" id="6921334">+</span>&nbsp;<span class="ident" id="6921336"><a href="/net/tcp_test.go.html#6921122">laddr</a></span>&nbsp;<span class="op" id="6921342">+</span>&nbsp;<span class="string" id="6921344">&#34;%&#34;</span>&nbsp;<span class="op" id="6921348">+</span>&nbsp;<span class="ident" id="6921350"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921353">.</span><span class="ident" id="6921354">Name</span>&nbsp;<span class="op" id="6921359">+</span>&nbsp;<span class="string" id="6921361">&#34;]:0&#34;</span><span class="op" id="6921366">,</span>&nbsp;<span class="ident" id="6921368">false</span><span class="op" id="6921373">}</span><span class="op" id="6921374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921378">{</span><span class="string" id="6921379">&#34;tcp6&#34;</span><span class="op" id="6921385">,</span>&nbsp;<span class="string" id="6921387">&#34;[&#34;</span>&nbsp;<span class="op" id="6921391">+</span>&nbsp;<span class="ident" id="6921393"><a href="/net/tcp_test.go.html#6921122">laddr</a></span>&nbsp;<span class="op" id="6921399">+</span>&nbsp;<span class="string" id="6921401">&#34;%&#34;</span>&nbsp;<span class="op" id="6921405">+</span>&nbsp;<span class="ident" id="6921407"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921410">.</span><span class="ident" id="6921411">Name</span>&nbsp;<span class="op" id="6921416">+</span>&nbsp;<span class="string" id="6921418">&#34;]:0&#34;</span><span class="op" id="6921423">,</span>&nbsp;<span class="ident" id="6921425">false</span><span class="op" id="6921430">}</span><span class="op" id="6921431">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921437">switch</span>&nbsp;<span class="ident" id="6921444"><a href="/net/tcp_test.go.html#6912212">runtime</a></span><span class="op" id="6921451">.</span><span class="ident" id="6921452">GOOS</span>&nbsp;<span class="op" id="6921457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921460">case</span>&nbsp;<span class="string" id="6921465">&#34;darwin&#34;</span><span class="op" id="6921473">,</span>&nbsp;<span class="string" id="6921475">&#34;freebsd&#34;</span><span class="op" id="6921484">,</span>&nbsp;<span class="string" id="6921486">&#34;openbsd&#34;</span><span class="op" id="6921495">,</span>&nbsp;<span class="string" id="6921497">&#34;netbsd&#34;</span><span class="op" id="6921505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921509"><a href="/net/tcp_test.go.html#6921304">tests</a></span>&nbsp;<span class="op" id="6921515">=</span>&nbsp;<span class="builtinfunc" id="6921517">append</span><span class="op" id="6921523">(</span><span class="ident" id="6921524"><a href="/net/tcp_test.go.html#6921304">tests</a></span><span class="op" id="6921529">,</span>&nbsp;<span class="op" id="6921531">[</span><span class="op" id="6921532">]</span><span class="ident" id="6921533"><a href="/net/tcp_test.go.html#6921244">test</a></span><span class="op" id="6921537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921542">{</span><span class="string" id="6921543">&#34;tcp&#34;</span><span class="op" id="6921548">,</span>&nbsp;<span class="string" id="6921550">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="6921564">+</span>&nbsp;<span class="ident" id="6921566"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921569">.</span><span class="ident" id="6921570">Name</span>&nbsp;<span class="op" id="6921575">+</span>&nbsp;<span class="string" id="6921577">&#34;]:0&#34;</span><span class="op" id="6921582">,</span>&nbsp;<span class="ident" id="6921584">true</span><span class="op" id="6921588">}</span><span class="op" id="6921589">,</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921594">{</span><span class="string" id="6921595">&#34;tcp6&#34;</span><span class="op" id="6921601">,</span>&nbsp;<span class="string" id="6921603">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="6921617">+</span>&nbsp;<span class="ident" id="6921619"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921622">.</span><span class="ident" id="6921623">Name</span>&nbsp;<span class="op" id="6921628">+</span>&nbsp;<span class="string" id="6921630">&#34;]:0&#34;</span><span class="op" id="6921635">,</span>&nbsp;<span class="ident" id="6921637">true</span><span class="op" id="6921641">}</span><span class="op" id="6921642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921646">}</span><span class="op" id="6921647">...</span><span class="op" id="6921650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921653">case</span>&nbsp;<span class="string" id="6921658">&#34;linux&#34;</span><span class="op" id="6921665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921669"><a href="/net/tcp_test.go.html#6921304">tests</a></span>&nbsp;<span class="op" id="6921675">=</span>&nbsp;<span class="builtinfunc" id="6921677">append</span><span class="op" id="6921683">(</span><span class="ident" id="6921684"><a href="/net/tcp_test.go.html#6921304">tests</a></span><span class="op" id="6921689">,</span>&nbsp;<span class="op" id="6921691">[</span><span class="op" id="6921692">]</span><span class="ident" id="6921693"><a href="/net/tcp_test.go.html#6921244">test</a></span><span class="op" id="6921697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921702">{</span><span class="string" id="6921703">&#34;tcp&#34;</span><span class="op" id="6921708">,</span>&nbsp;<span class="string" id="6921710">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="6921728">+</span>&nbsp;<span class="ident" id="6921730"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921733">.</span><span class="ident" id="6921734">Name</span>&nbsp;<span class="op" id="6921739">+</span>&nbsp;<span class="string" id="6921741">&#34;]:0&#34;</span><span class="op" id="6921746">,</span>&nbsp;<span class="ident" id="6921748">true</span><span class="op" id="6921752">}</span><span class="op" id="6921753">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921758">{</span><span class="string" id="6921759">&#34;tcp6&#34;</span><span class="op" id="6921765">,</span>&nbsp;<span class="string" id="6921767">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="6921785">+</span>&nbsp;<span class="ident" id="6921787"><a href="/net/tcp_test.go.html#6921033">ifi</a></span><span class="op" id="6921790">.</span><span class="ident" id="6921791">Name</span>&nbsp;<span class="op" id="6921796">+</span>&nbsp;<span class="string" id="6921798">&#34;]:0&#34;</span><span class="op" id="6921803">,</span>&nbsp;<span class="ident" id="6921805">true</span><span class="op" id="6921809">}</span><span class="op" id="6921810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921814">}</span><span class="op" id="6921815">...</span><span class="op" id="6921818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6921821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921824">for</span>&nbsp;<span class="ident" id="6921828">_</span><span class="op" id="6921829">,</span>&nbsp;<span class="ident" id="6921831">tt</span>&nbsp;<span class="op" id="6921834">:=</span>&nbsp;<span class="keyword" id="6921837">range</span>&nbsp;<span class="ident" id="6921843"><a href="/net/tcp_test.go.html#6921304">tests</a></span>&nbsp;<span class="op" id="6921849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6921853">ln</span><span class="op" id="6921855">,</span>&nbsp;<span class="ident" id="6921857">err</span>&nbsp;<span class="op" id="6921861">:=</span>&nbsp;<span class="ident" id="6921864"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6921870">(</span><span class="ident" id="6921871"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6921873">.</span><span class="ident" id="6921874">net</span><span class="op" id="6921877">,</span>&nbsp;<span class="ident" id="6921879"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6921881">.</span><span class="ident" id="6921882">addr</span><span class="op" id="6921886">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6921890">if</span>&nbsp;<span class="ident" id="6921893"><a href="/net/tcp_test.go.html#6921857">err</a></span>&nbsp;<span class="op" id="6921897">!=</span>&nbsp;<span class="ident" id="6921900">nil</span>&nbsp;<span class="op" id="6921904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6921909">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6921955">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922004"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922005">.</span><span class="ident" id="6922006">Logf</span><span class="op" id="6922010">(</span><span class="string" id="6922011">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6922030">,</span>&nbsp;<span class="ident" id="6922032"><a href="/net/tcp_test.go.html#6921857">err</a></span><span class="op" id="6922035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922040">continue</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922055">defer</span>&nbsp;<span class="ident" id="6922061"><a href="/net/tcp_test.go.html#6921853">ln</a></span><span class="op" id="6922063">.</span><span class="ident" id="6922064">Close</span><span class="op" id="6922069">(</span><span class="op" id="6922070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922074">if</span>&nbsp;<span class="ident" id="6922077">la</span><span class="op" id="6922079">,</span>&nbsp;<span class="ident" id="6922081">ok</span>&nbsp;<span class="op" id="6922084">:=</span>&nbsp;<span class="ident" id="6922087"><a href="/net/tcp_test.go.html#6921853">ln</a></span><span class="op" id="6922089">.</span><span class="ident" id="6922090">Addr</span><span class="op" id="6922094">(</span><span class="op" id="6922095">)</span><span class="op" id="6922096">.</span><span class="op" id="6922097">(</span><span class="op" id="6922098">*</span><span class="ident" id="6922099"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6922106">)</span><span class="op" id="6922107">;</span>&nbsp;<span class="op" id="6922109">!</span><span class="ident" id="6922110"><a href="/net/tcp_test.go.html#6922081">ok</a></span>&nbsp;<span class="op" id="6922113">||</span>&nbsp;<span class="op" id="6922116">!</span><span class="ident" id="6922117"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6922119">.</span><span class="ident" id="6922120">nameLookup</span>&nbsp;<span class="op" id="6922131">&amp;&amp;</span>&nbsp;<span class="ident" id="6922134"><a href="/net/tcp_test.go.html#6922077">la</a></span><span class="op" id="6922136">.</span><span class="ident" id="6922137">Zone</span>&nbsp;<span class="op" id="6922142">==</span>&nbsp;<span class="string" id="6922145">&#34;&#34;</span>&nbsp;<span class="op" id="6922148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922153"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922154">.</span><span class="ident" id="6922155">Fatalf</span><span class="op" id="6922161">(</span><span class="string" id="6922162">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6922218">,</span>&nbsp;<span class="ident" id="6922220"><a href="/net/tcp_test.go.html#6922077">la</a></span><span class="op" id="6922222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922226">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922231">done</span>&nbsp;<span class="op" id="6922236">:=</span>&nbsp;<span class="builtinfunc" id="6922239">make</span><span class="op" id="6922243">(</span><span class="keyword" id="6922244">chan</span>&nbsp;<span class="builtintype" id="6922249">int</span><span class="op" id="6922252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922256">go</span>&nbsp;<span class="ident" id="6922259"><a href="/net/conn_test.go.html#6768889">transponder</a></span><span class="op" id="6922270">(</span><span class="ident" id="6922271"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922272">,</span>&nbsp;<span class="ident" id="6922274"><a href="/net/tcp_test.go.html#6921853">ln</a></span><span class="op" id="6922276">,</span>&nbsp;<span class="ident" id="6922278"><a href="/net/tcp_test.go.html#6922231">done</a></span><span class="op" id="6922282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922287">c</span><span class="op" id="6922288">,</span>&nbsp;<span class="ident" id="6922290"><a href="/net/tcp_test.go.html#6921857">err</a></span>&nbsp;<span class="op" id="6922294">:=</span>&nbsp;<span class="ident" id="6922297"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6922301">(</span><span class="ident" id="6922302"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6922304">.</span><span class="ident" id="6922305">net</span><span class="op" id="6922308">,</span>&nbsp;<span class="ident" id="6922310"><a href="/net/tcp_test.go.html#6921853">ln</a></span><span class="op" id="6922312">.</span><span class="ident" id="6922313">Addr</span><span class="op" id="6922317">(</span><span class="op" id="6922318">)</span><span class="op" id="6922319">.</span><span class="ident" id="6922320">String</span><span class="op" id="6922326">(</span><span class="op" id="6922327">)</span><span class="op" id="6922328">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922332">if</span>&nbsp;<span class="ident" id="6922335"><a href="/net/tcp_test.go.html#6921857">err</a></span>&nbsp;<span class="op" id="6922339">!=</span>&nbsp;<span class="ident" id="6922342">nil</span>&nbsp;<span class="op" id="6922346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922351"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922352">.</span><span class="ident" id="6922353">Fatalf</span><span class="op" id="6922359">(</span><span class="string" id="6922360">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6922377">,</span>&nbsp;<span class="ident" id="6922379"><a href="/net/tcp_test.go.html#6921857">err</a></span><span class="op" id="6922382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922390">defer</span>&nbsp;<span class="ident" id="6922396"><a href="/net/tcp_test.go.html#6922287">c</a></span><span class="op" id="6922397">.</span><span class="ident" id="6922398">Close</span><span class="op" id="6922403">(</span><span class="op" id="6922404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922408">if</span>&nbsp;<span class="ident" id="6922411">la</span><span class="op" id="6922413">,</span>&nbsp;<span class="ident" id="6922415">ok</span>&nbsp;<span class="op" id="6922418">:=</span>&nbsp;<span class="ident" id="6922421"><a href="/net/tcp_test.go.html#6922287">c</a></span><span class="op" id="6922422">.</span><span class="ident" id="6922423">LocalAddr</span><span class="op" id="6922432">(</span><span class="op" id="6922433">)</span><span class="op" id="6922434">.</span><span class="op" id="6922435">(</span><span class="op" id="6922436">*</span><span class="ident" id="6922437"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6922444">)</span><span class="op" id="6922445">;</span>&nbsp;<span class="op" id="6922447">!</span><span class="ident" id="6922448"><a href="/net/tcp_test.go.html#6922415">ok</a></span>&nbsp;<span class="op" id="6922451">||</span>&nbsp;<span class="op" id="6922454">!</span><span class="ident" id="6922455"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6922457">.</span><span class="ident" id="6922458">nameLookup</span>&nbsp;<span class="op" id="6922469">&amp;&amp;</span>&nbsp;<span class="ident" id="6922472"><a href="/net/tcp_test.go.html#6922411">la</a></span><span class="op" id="6922474">.</span><span class="ident" id="6922475">Zone</span>&nbsp;<span class="op" id="6922480">==</span>&nbsp;<span class="string" id="6922483">&#34;&#34;</span>&nbsp;<span class="op" id="6922486">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922491"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922492">.</span><span class="ident" id="6922493">Fatalf</span><span class="op" id="6922499">(</span><span class="string" id="6922500">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6922556">,</span>&nbsp;<span class="ident" id="6922558"><a href="/net/tcp_test.go.html#6922411">la</a></span><span class="op" id="6922560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922568">if</span>&nbsp;<span class="ident" id="6922571">ra</span><span class="op" id="6922573">,</span>&nbsp;<span class="ident" id="6922575">ok</span>&nbsp;<span class="op" id="6922578">:=</span>&nbsp;<span class="ident" id="6922581"><a href="/net/tcp_test.go.html#6922287">c</a></span><span class="op" id="6922582">.</span><span class="ident" id="6922583">RemoteAddr</span><span class="op" id="6922593">(</span><span class="op" id="6922594">)</span><span class="op" id="6922595">.</span><span class="op" id="6922596">(</span><span class="op" id="6922597">*</span><span class="ident" id="6922598"><a href="/net/tcpsock.go.html#2691528">TCPAddr</a></span><span class="op" id="6922605">)</span><span class="op" id="6922606">;</span>&nbsp;<span class="op" id="6922608">!</span><span class="ident" id="6922609"><a href="/net/tcp_test.go.html#6922575">ok</a></span>&nbsp;<span class="op" id="6922612">||</span>&nbsp;<span class="op" id="6922615">!</span><span class="ident" id="6922616"><a href="/net/tcp_test.go.html#6921831">tt</a></span><span class="op" id="6922618">.</span><span class="ident" id="6922619">nameLookup</span>&nbsp;<span class="op" id="6922630">&amp;&amp;</span>&nbsp;<span class="ident" id="6922633"><a href="/net/tcp_test.go.html#6922571">ra</a></span><span class="op" id="6922635">.</span><span class="ident" id="6922636">Zone</span>&nbsp;<span class="op" id="6922641">==</span>&nbsp;<span class="string" id="6922644">&#34;&#34;</span>&nbsp;<span class="op" id="6922647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922652"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922653">.</span><span class="ident" id="6922654">Fatalf</span><span class="op" id="6922660">(</span><span class="string" id="6922661">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="6922717">,</span>&nbsp;<span class="ident" id="6922719"><a href="/net/tcp_test.go.html#6922571">ra</a></span><span class="op" id="6922721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922725">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922730">if</span>&nbsp;<span class="ident" id="6922733">_</span><span class="op" id="6922734">,</span>&nbsp;<span class="ident" id="6922736">err</span>&nbsp;<span class="op" id="6922740">:=</span>&nbsp;<span class="ident" id="6922743"><a href="/net/tcp_test.go.html#6922287">c</a></span><span class="op" id="6922744">.</span><span class="ident" id="6922745">Write</span><span class="op" id="6922750">(</span><span class="op" id="6922751">[</span><span class="op" id="6922752">]</span><span class="builtintype" id="6922753">byte</span><span class="op" id="6922757">(</span><span class="string" id="6922758">&#34;TCP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="6922788">)</span><span class="op" id="6922789">)</span><span class="op" id="6922790">;</span>&nbsp;<span class="ident" id="6922792"><a href="/net/tcp_test.go.html#6922736">err</a></span>&nbsp;<span class="op" id="6922796">!=</span>&nbsp;<span class="ident" id="6922799">nil</span>&nbsp;<span class="op" id="6922803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922808"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922809">.</span><span class="ident" id="6922810">Fatalf</span><span class="op" id="6922816">(</span><span class="string" id="6922817">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6922840">,</span>&nbsp;<span class="ident" id="6922842"><a href="/net/tcp_test.go.html#6922736">err</a></span><span class="op" id="6922845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922853">b</span>&nbsp;<span class="op" id="6922855">:=</span>&nbsp;<span class="builtinfunc" id="6922858">make</span><span class="op" id="6922862">(</span><span class="op" id="6922863">[</span><span class="op" id="6922864">]</span><span class="builtintype" id="6922865">byte</span><span class="op" id="6922869">,</span>&nbsp;<span class="num" id="6922871">32</span><span class="op" id="6922873">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922877">if</span>&nbsp;<span class="ident" id="6922880">_</span><span class="op" id="6922881">,</span>&nbsp;<span class="ident" id="6922883">err</span>&nbsp;<span class="op" id="6922887">:=</span>&nbsp;<span class="ident" id="6922890"><a href="/net/tcp_test.go.html#6922287">c</a></span><span class="op" id="6922891">.</span><span class="ident" id="6922892">Read</span><span class="op" id="6922896">(</span><span class="ident" id="6922897"><a href="/net/tcp_test.go.html#6922853">b</a></span><span class="op" id="6922898">)</span><span class="op" id="6922899">;</span>&nbsp;<span class="ident" id="6922901"><a href="/net/tcp_test.go.html#6922883">err</a></span>&nbsp;<span class="op" id="6922905">!=</span>&nbsp;<span class="ident" id="6922908">nil</span>&nbsp;<span class="op" id="6922912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922917"><a href="/net/tcp_test.go.html#6920864">t</a></span><span class="op" id="6922918">.</span><span class="ident" id="6922919">Fatalf</span><span class="op" id="6922925">(</span><span class="string" id="6922926">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6922948">,</span>&nbsp;<span class="ident" id="6922950"><a href="/net/tcp_test.go.html#6922883">err</a></span><span class="op" id="6922953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922962">&lt;-</span><span class="ident" id="6922964"><a href="/net/tcp_test.go.html#6922231">done</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922970">}</span><br>
<span class="lineno"></span><span class="op" id="6922972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6922975">func</span>&nbsp;<span class="ident" id="6922980">TestTCPConcurrentAccept</span><span class="op" id="6923003">(</span><span class="ident" id="6923004">t</span>&nbsp;<span class="op" id="6923006">*</span><span class="ident" id="6923007"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6923014">.</span><span class="ident" id="6923015">T</span><span class="op" id="6923016">)</span>&nbsp;<span class="op" id="6923018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923021">defer</span>&nbsp;<span class="ident" id="6923027"><a href="/net/tcp_test.go.html#6912212">runtime</a></span><span class="op" id="6923034">.</span><span class="ident" id="6923035">GOMAXPROCS</span><span class="op" id="6923045">(</span><span class="ident" id="6923046"><a href="/net/tcp_test.go.html#6912212">runtime</a></span><span class="op" id="6923053">.</span><span class="ident" id="6923054">GOMAXPROCS</span><span class="op" id="6923064">(</span><span class="num" id="6923065">4</span><span class="op" id="6923066">)</span><span class="op" id="6923067">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923070">ln</span><span class="op" id="6923072">,</span>&nbsp;<span class="ident" id="6923074">err</span>&nbsp;<span class="op" id="6923078">:=</span>&nbsp;<span class="ident" id="6923081"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6923087">(</span><span class="string" id="6923088">&#34;tcp&#34;</span><span class="op" id="6923093">,</span>&nbsp;<span class="string" id="6923095">&#34;127.0.0.1:0&#34;</span><span class="op" id="6923108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923111">if</span>&nbsp;<span class="ident" id="6923114"><a href="/net/tcp_test.go.html#6923074">err</a></span>&nbsp;<span class="op" id="6923118">!=</span>&nbsp;<span class="ident" id="6923121">nil</span>&nbsp;<span class="op" id="6923125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923129"><a href="/net/tcp_test.go.html#6923004">t</a></span><span class="op" id="6923130">.</span><span class="ident" id="6923131">Fatalf</span><span class="op" id="6923137">(</span><span class="string" id="6923138">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6923157">,</span>&nbsp;<span class="ident" id="6923159"><a href="/net/tcp_test.go.html#6923074">err</a></span><span class="op" id="6923162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923168">const</span>&nbsp;<span class="ident" id="6923174">N</span>&nbsp;<span class="op" id="6923176">=</span>&nbsp;<span class="num" id="6923178">10</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923182">var</span>&nbsp;<span class="ident" id="6923186">wg</span>&nbsp;<span class="ident" id="6923189"><a href="/net/tcp_test.go.html#6912223">sync</a></span><span class="op" id="6923193">.</span><span class="ident" id="6923194">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923205"><a href="/net/tcp_test.go.html#6923186">wg</a></span><span class="op" id="6923207">.</span><span class="ident" id="6923208">Add</span><span class="op" id="6923211">(</span><span class="ident" id="6923212"><a href="/net/tcp_test.go.html#6923174">N</a></span><span class="op" id="6923213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923216">for</span>&nbsp;<span class="ident" id="6923220">i</span>&nbsp;<span class="op" id="6923222">:=</span>&nbsp;<span class="num" id="6923225">0</span><span class="op" id="6923226">;</span>&nbsp;<span class="ident" id="6923228"><a href="/net/tcp_test.go.html#6923220">i</a></span>&nbsp;<span class="op" id="6923230">&lt;</span>&nbsp;<span class="ident" id="6923232"><a href="/net/tcp_test.go.html#6923174">N</a></span><span class="op" id="6923233">;</span>&nbsp;<span class="ident" id="6923235"><a href="/net/tcp_test.go.html#6923220">i</a></span><span class="op" id="6923236">++</span>&nbsp;<span class="op" id="6923239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923243">go</span>&nbsp;<span class="keyword" id="6923246">func</span><span class="op" id="6923250">(</span><span class="op" id="6923251">)</span>&nbsp;<span class="op" id="6923253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923258">for</span>&nbsp;<span class="op" id="6923262">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923268">c</span><span class="op" id="6923269">,</span>&nbsp;<span class="ident" id="6923271">err</span>&nbsp;<span class="op" id="6923275">:=</span>&nbsp;<span class="ident" id="6923278"><a href="/net/tcp_test.go.html#6923070">ln</a></span><span class="op" id="6923280">.</span><span class="ident" id="6923281">Accept</span><span class="op" id="6923287">(</span><span class="op" id="6923288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923294">if</span>&nbsp;<span class="ident" id="6923297"><a href="/net/tcp_test.go.html#6923271">err</a></span>&nbsp;<span class="op" id="6923301">!=</span>&nbsp;<span class="ident" id="6923304">nil</span>&nbsp;<span class="op" id="6923308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923315">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923331"><a href="/net/tcp_test.go.html#6923268">c</a></span><span class="op" id="6923332">.</span><span class="ident" id="6923333">Close</span><span class="op" id="6923338">(</span><span class="op" id="6923339">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923349"><a href="/net/tcp_test.go.html#6923186">wg</a></span><span class="op" id="6923351">.</span><span class="ident" id="6923352">Done</span><span class="op" id="6923356">(</span><span class="op" id="6923357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923361">}</span><span class="op" id="6923362">(</span><span class="op" id="6923363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923369">attempts</span>&nbsp;<span class="op" id="6923378">:=</span>&nbsp;<span class="num" id="6923381">10</span>&nbsp;<span class="op" id="6923384">*</span>&nbsp;<span class="ident" id="6923386"><a href="/net/tcp_test.go.html#6923174">N</a></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923389">fails</span>&nbsp;<span class="op" id="6923395">:=</span>&nbsp;<span class="num" id="6923398">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923401">d</span>&nbsp;<span class="op" id="6923403">:=</span>&nbsp;<span class="op" id="6923406">&amp;</span><span class="ident" id="6923407"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="6923413">{</span><span class="ident" id="6923414">Timeout</span><span class="op" id="6923421">:</span>&nbsp;<span class="num" id="6923423">200</span>&nbsp;<span class="op" id="6923427">*</span>&nbsp;<span class="ident" id="6923429"><a href="/net/tcp_test.go.html#6912242">time</a></span><span class="op" id="6923433">.</span><span class="ident" id="6923434">Millisecond</span><span class="op" id="6923445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923448">for</span>&nbsp;<span class="ident" id="6923452">i</span>&nbsp;<span class="op" id="6923454">:=</span>&nbsp;<span class="num" id="6923457">0</span><span class="op" id="6923458">;</span>&nbsp;<span class="ident" id="6923460"><a href="/net/tcp_test.go.html#6923452">i</a></span>&nbsp;<span class="op" id="6923462">&lt;</span>&nbsp;<span class="ident" id="6923464"><a href="/net/tcp_test.go.html#6923369">attempts</a></span><span class="op" id="6923472">;</span>&nbsp;<span class="ident" id="6923474"><a href="/net/tcp_test.go.html#6923452">i</a></span><span class="op" id="6923475">++</span>&nbsp;<span class="op" id="6923478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923482">c</span><span class="op" id="6923483">,</span>&nbsp;<span class="ident" id="6923485">err</span>&nbsp;<span class="op" id="6923489">:=</span>&nbsp;<span class="ident" id="6923492"><a href="/net/tcp_test.go.html#6923401">d</a></span><span class="op" id="6923493">.</span><span class="ident" id="6923494">Dial</span><span class="op" id="6923498">(</span><span class="string" id="6923499">&#34;tcp&#34;</span><span class="op" id="6923504">,</span>&nbsp;<span class="ident" id="6923506"><a href="/net/tcp_test.go.html#6923070">ln</a></span><span class="op" id="6923508">.</span><span class="ident" id="6923509">Addr</span><span class="op" id="6923513">(</span><span class="op" id="6923514">)</span><span class="op" id="6923515">.</span><span class="ident" id="6923516">String</span><span class="op" id="6923522">(</span><span class="op" id="6923523">)</span><span class="op" id="6923524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923528">if</span>&nbsp;<span class="ident" id="6923531"><a href="/net/tcp_test.go.html#6923485">err</a></span>&nbsp;<span class="op" id="6923535">!=</span>&nbsp;<span class="ident" id="6923538">nil</span>&nbsp;<span class="op" id="6923542">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923547"><a href="/net/tcp_test.go.html#6923389">fails</a></span><span class="op" id="6923552">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923557">}</span>&nbsp;<span class="keyword" id="6923559">else</span>&nbsp;<span class="op" id="6923564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923569"><a href="/net/tcp_test.go.html#6923482">c</a></span><span class="op" id="6923570">.</span><span class="ident" id="6923571">Close</span><span class="op" id="6923576">(</span><span class="op" id="6923577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923584">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923587"><a href="/net/tcp_test.go.html#6923070">ln</a></span><span class="op" id="6923589">.</span><span class="ident" id="6923590">Close</span><span class="op" id="6923595">(</span><span class="op" id="6923596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923599"><a href="/net/tcp_test.go.html#6923186">wg</a></span><span class="op" id="6923601">.</span><span class="ident" id="6923602">Wait</span><span class="op" id="6923606">(</span><span class="op" id="6923607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923610">if</span>&nbsp;<span class="ident" id="6923613"><a href="/net/tcp_test.go.html#6923389">fails</a></span>&nbsp;<span class="op" id="6923619">&gt;</span>&nbsp;<span class="ident" id="6923621"><a href="/net/tcp_test.go.html#6923369">attempts</a></span><span class="op" id="6923629">/</span><span class="num" id="6923630">9</span>&nbsp;<span class="op" id="6923632">{</span>&nbsp;<span class="comment" id="6923634">//&nbsp;see&nbsp;issues&nbsp;7400&nbsp;and&nbsp;7541</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923664"><a href="/net/tcp_test.go.html#6923004">t</a></span><span class="op" id="6923665">.</span><span class="ident" id="6923666">Fatalf</span><span class="op" id="6923672">(</span><span class="string" id="6923673">&#34;too&nbsp;many&nbsp;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6923699">,</span>&nbsp;<span class="ident" id="6923701"><a href="/net/tcp_test.go.html#6923389">fails</a></span><span class="op" id="6923706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923709">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923712">if</span>&nbsp;<span class="ident" id="6923715"><a href="/net/tcp_test.go.html#6923389">fails</a></span>&nbsp;<span class="op" id="6923721">&gt;</span>&nbsp;<span class="num" id="6923723">0</span>&nbsp;<span class="op" id="6923725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923729"><a href="/net/tcp_test.go.html#6923004">t</a></span><span class="op" id="6923730">.</span><span class="ident" id="6923731">Logf</span><span class="op" id="6923735">(</span><span class="string" id="6923736">&#34;#&nbsp;of&nbsp;failed&nbsp;Dials:&nbsp;%v&#34;</span><span class="op" id="6923759">,</span>&nbsp;<span class="ident" id="6923761"><a href="/net/tcp_test.go.html#6923389">fails</a></span><span class="op" id="6923766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923769">}</span><br>
<span class="lineno"></span><span class="op" id="6923771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="keyword" id="6923774">func</span>&nbsp;<span class="ident" id="6923779">TestTCPReadWriteMallocs</span><span class="op" id="6923802">(</span><span class="ident" id="6923803">t</span>&nbsp;<span class="op" id="6923805">*</span><span class="ident" id="6923806"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6923813">.</span><span class="ident" id="6923814">T</span><span class="op" id="6923815">)</span>&nbsp;<span class="op" id="6923817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923820">if</span>&nbsp;<span class="ident" id="6923823"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6923830">.</span><span class="ident" id="6923831">Short</span><span class="op" id="6923836">(</span><span class="op" id="6923837">)</span>&nbsp;<span class="op" id="6923839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923843"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6923844">.</span><span class="ident" id="6923845">Skip</span><span class="op" id="6923849">(</span><span class="string" id="6923850">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6923887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923893">ln</span><span class="op" id="6923895">,</span>&nbsp;<span class="ident" id="6923897">err</span>&nbsp;<span class="op" id="6923901">:=</span>&nbsp;<span class="ident" id="6923904"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6923910">(</span><span class="string" id="6923911">&#34;tcp&#34;</span><span class="op" id="6923916">,</span>&nbsp;<span class="string" id="6923918">&#34;127.0.0.1:0&#34;</span><span class="op" id="6923931">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923934">if</span>&nbsp;<span class="ident" id="6923937"><a href="/net/tcp_test.go.html#6923897">err</a></span>&nbsp;<span class="op" id="6923941">!=</span>&nbsp;<span class="ident" id="6923944">nil</span>&nbsp;<span class="op" id="6923948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923952"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6923953">.</span><span class="ident" id="6923954">Fatalf</span><span class="op" id="6923960">(</span><span class="string" id="6923961">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6923980">,</span>&nbsp;<span class="ident" id="6923982"><a href="/net/tcp_test.go.html#6923897">err</a></span><span class="op" id="6923985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923991">defer</span>&nbsp;<span class="ident" id="6923997"><a href="/net/tcp_test.go.html#6923893">ln</a></span><span class="op" id="6923999">.</span><span class="ident" id="6924000">Close</span><span class="op" id="6924005">(</span><span class="op" id="6924006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924009">var</span>&nbsp;<span class="ident" id="6924013">server</span>&nbsp;<span class="ident" id="6924020"><a href="/net/net.go.html#2652476">Conn</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924026">errc</span>&nbsp;<span class="op" id="6924031">:=</span>&nbsp;<span class="builtinfunc" id="6924034">make</span><span class="op" id="6924038">(</span><span class="keyword" id="6924039">chan</span>&nbsp;<span class="builtintype" id="6924044">error</span><span class="op" id="6924049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924052">go</span>&nbsp;<span class="keyword" id="6924055">func</span><span class="op" id="6924059">(</span><span class="op" id="6924060">)</span>&nbsp;<span class="op" id="6924062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924066">var</span>&nbsp;<span class="ident" id="6924070">err</span>&nbsp;<span class="builtintype" id="6924074">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924082"><a href="/net/tcp_test.go.html#6924013">server</a></span><span class="op" id="6924088">,</span>&nbsp;<span class="ident" id="6924090"><a href="/net/tcp_test.go.html#6924070">err</a></span>&nbsp;<span class="op" id="6924094">=</span>&nbsp;<span class="ident" id="6924096"><a href="/net/tcp_test.go.html#6923893">ln</a></span><span class="op" id="6924098">.</span><span class="ident" id="6924099">Accept</span><span class="op" id="6924105">(</span><span class="op" id="6924106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924110"><a href="/net/tcp_test.go.html#6924026">errc</a></span>&nbsp;<span class="op" id="6924115">&lt;-</span>&nbsp;<span class="ident" id="6924118"><a href="/net/tcp_test.go.html#6924070">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924123">}</span><span class="op" id="6924124">(</span><span class="op" id="6924125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924128">client</span><span class="op" id="6924134">,</span>&nbsp;<span class="ident" id="6924136"><a href="/net/tcp_test.go.html#6923897">err</a></span>&nbsp;<span class="op" id="6924140">:=</span>&nbsp;<span class="ident" id="6924143"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6924147">(</span><span class="string" id="6924148">&#34;tcp&#34;</span><span class="op" id="6924153">,</span>&nbsp;<span class="ident" id="6924155"><a href="/net/tcp_test.go.html#6923893">ln</a></span><span class="op" id="6924157">.</span><span class="ident" id="6924158">Addr</span><span class="op" id="6924162">(</span><span class="op" id="6924163">)</span><span class="op" id="6924164">.</span><span class="ident" id="6924165">String</span><span class="op" id="6924171">(</span><span class="op" id="6924172">)</span><span class="op" id="6924173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924176">if</span>&nbsp;<span class="ident" id="6924179"><a href="/net/tcp_test.go.html#6923897">err</a></span>&nbsp;<span class="op" id="6924183">!=</span>&nbsp;<span class="ident" id="6924186">nil</span>&nbsp;<span class="op" id="6924190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924194"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6924195">.</span><span class="ident" id="6924196">Fatalf</span><span class="op" id="6924202">(</span><span class="string" id="6924203">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6924220">,</span>&nbsp;<span class="ident" id="6924222"><a href="/net/tcp_test.go.html#6923897">err</a></span><span class="op" id="6924225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924228">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924231">if</span>&nbsp;<span class="ident" id="6924234">err</span>&nbsp;<span class="op" id="6924238">:=</span>&nbsp;<span class="op" id="6924241">&lt;-</span><span class="ident" id="6924243"><a href="/net/tcp_test.go.html#6924026">errc</a></span><span class="op" id="6924247">;</span>&nbsp;<span class="ident" id="6924249"><a href="/net/tcp_test.go.html#6924234">err</a></span>&nbsp;<span class="op" id="6924253">!=</span>&nbsp;<span class="ident" id="6924256">nil</span>&nbsp;<span class="op" id="6924260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924264"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6924265">.</span><span class="ident" id="6924266">Fatalf</span><span class="op" id="6924272">(</span><span class="string" id="6924273">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6924292">,</span>&nbsp;<span class="ident" id="6924294"><a href="/net/tcp_test.go.html#6924234">err</a></span><span class="op" id="6924297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924303">defer</span>&nbsp;<span class="ident" id="6924309"><a href="/net/tcp_test.go.html#6924013">server</a></span><span class="op" id="6924315">.</span><span class="ident" id="6924316">Close</span><span class="op" id="6924321">(</span><span class="op" id="6924322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924325">var</span>&nbsp;<span class="ident" id="6924329">buf</span>&nbsp;<span class="op" id="6924333">[</span><span class="num" id="6924334">128</span><span class="op" id="6924337">]</span><span class="builtintype" id="6924338">byte</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924344">mallocs</span>&nbsp;<span class="op" id="6924352">:=</span>&nbsp;<span class="ident" id="6924355"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6924362">.</span><span class="ident" id="6924363">AllocsPerRun</span><span class="op" id="6924375">(</span><span class="num" id="6924376">1000</span><span class="op" id="6924380">,</span>&nbsp;<span class="keyword" id="6924382">func</span><span class="op" id="6924386">(</span><span class="op" id="6924387">)</span>&nbsp;<span class="op" id="6924389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924393">_</span><span class="op" id="6924394">,</span>&nbsp;<span class="ident" id="6924396">err</span>&nbsp;<span class="op" id="6924400">:=</span>&nbsp;<span class="ident" id="6924403"><a href="/net/tcp_test.go.html#6924013">server</a></span><span class="op" id="6924409">.</span><span class="ident" id="6924410">Write</span><span class="op" id="6924415">(</span><span class="ident" id="6924416"><a href="/net/tcp_test.go.html#6924329">buf</a></span><span class="op" id="6924419">[</span><span class="op" id="6924420">:</span><span class="op" id="6924421">]</span><span class="op" id="6924422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924426">if</span>&nbsp;<span class="ident" id="6924429"><a href="/net/tcp_test.go.html#6924396">err</a></span>&nbsp;<span class="op" id="6924433">!=</span>&nbsp;<span class="ident" id="6924436">nil</span>&nbsp;<span class="op" id="6924440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924445"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6924446">.</span><span class="ident" id="6924447">Fatalf</span><span class="op" id="6924453">(</span><span class="string" id="6924454">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6924472">,</span>&nbsp;<span class="ident" id="6924474"><a href="/net/tcp_test.go.html#6924396">err</a></span><span class="op" id="6924477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924481">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924485">_</span><span class="op" id="6924486">,</span>&nbsp;<span class="ident" id="6924488"><a href="/net/tcp_test.go.html#6924396">err</a></span>&nbsp;<span class="op" id="6924492">=</span>&nbsp;<span class="ident" id="6924494"><a href="/net/tcp_test.go.html#6912195">io</a></span><span class="op" id="6924496">.</span><span class="ident" id="6924497">ReadFull</span><span class="op" id="6924505">(</span><span class="ident" id="6924506"><a href="/net/tcp_test.go.html#6924128">client</a></span><span class="op" id="6924512">,</span>&nbsp;<span class="ident" id="6924514"><a href="/net/tcp_test.go.html#6924329">buf</a></span><span class="op" id="6924517">[</span><span class="op" id="6924518">:</span><span class="op" id="6924519">]</span><span class="op" id="6924520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924524">if</span>&nbsp;<span class="ident" id="6924527"><a href="/net/tcp_test.go.html#6924396">err</a></span>&nbsp;<span class="op" id="6924531">!=</span>&nbsp;<span class="ident" id="6924534">nil</span>&nbsp;<span class="op" id="6924538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924543"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6924544">.</span><span class="ident" id="6924545">Fatalf</span><span class="op" id="6924551">(</span><span class="string" id="6924552">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6924569">,</span>&nbsp;<span class="ident" id="6924571"><a href="/net/tcp_test.go.html#6924396">err</a></span><span class="op" id="6924574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924581">}</span><span class="op" id="6924582">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924585">if</span>&nbsp;<span class="ident" id="6924588"><a href="/net/tcp_test.go.html#6924344">mallocs</a></span>&nbsp;<span class="op" id="6924596">&gt;</span>&nbsp;<span class="num" id="6924598">0</span>&nbsp;<span class="op" id="6924600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924604"><a href="/net/tcp_test.go.html#6923803">t</a></span><span class="op" id="6924605">.</span><span class="ident" id="6924606">Fatalf</span><span class="op" id="6924612">(</span><span class="string" id="6924613">&#34;Got&nbsp;%v&nbsp;allocs,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6924636">,</span>&nbsp;<span class="ident" id="6924638"><a href="/net/tcp_test.go.html#6924344">mallocs</a></span><span class="op" id="6924645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924648">}</span><br>
<span class="lineno"></span><span class="op" id="6924650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="6924653">func</span>&nbsp;<span class="ident" id="6924658">TestTCPStress</span><span class="op" id="6924671">(</span><span class="ident" id="6924672">t</span>&nbsp;<span class="op" id="6924674">*</span><span class="ident" id="6924675"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6924682">.</span><span class="ident" id="6924683">T</span><span class="op" id="6924684">)</span>&nbsp;<span class="op" id="6924686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924689">const</span>&nbsp;<span class="ident" id="6924695">conns</span>&nbsp;<span class="op" id="6924701">=</span>&nbsp;<span class="num" id="6924703">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924706">const</span>&nbsp;<span class="ident" id="6924712">msgLen</span>&nbsp;<span class="op" id="6924719">=</span>&nbsp;<span class="num" id="6924721">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924726">msgs</span>&nbsp;<span class="op" id="6924731">:=</span>&nbsp;<span class="builtintype" id="6924734">int</span><span class="op" id="6924737">(</span><span class="num" id="6924738">1e4</span><span class="op" id="6924741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924744">if</span>&nbsp;<span class="ident" id="6924747"><a href="/net/tcp_test.go.html#6912231">testing</a></span><span class="op" id="6924754">.</span><span class="ident" id="6924755">Short</span><span class="op" id="6924760">(</span><span class="op" id="6924761">)</span>&nbsp;<span class="op" id="6924763">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924767"><a href="/net/tcp_test.go.html#6924726">msgs</a></span>&nbsp;<span class="op" id="6924772">=</span>&nbsp;<span class="num" id="6924774">1e2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924783">sendMsg</span>&nbsp;<span class="op" id="6924791">:=</span>&nbsp;<span class="keyword" id="6924794">func</span><span class="op" id="6924798">(</span><span class="ident" id="6924799">c</span>&nbsp;<span class="ident" id="6924801"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6924805">,</span>&nbsp;<span class="ident" id="6924807">buf</span>&nbsp;<span class="op" id="6924811">[</span><span class="op" id="6924812">]</span><span class="builtintype" id="6924813">byte</span><span class="op" id="6924817">)</span>&nbsp;<span class="builtintype" id="6924819">bool</span>&nbsp;<span class="op" id="6924824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924828">n</span><span class="op" id="6924829">,</span>&nbsp;<span class="ident" id="6924831">err</span>&nbsp;<span class="op" id="6924835">:=</span>&nbsp;<span class="ident" id="6924838"><a href="/net/tcp_test.go.html#6924799">c</a></span><span class="op" id="6924839">.</span><span class="ident" id="6924840">Write</span><span class="op" id="6924845">(</span><span class="ident" id="6924846"><a href="/net/tcp_test.go.html#6924807">buf</a></span><span class="op" id="6924849">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924853">if</span>&nbsp;<span class="ident" id="6924856"><a href="/net/tcp_test.go.html#6924828">n</a></span>&nbsp;<span class="op" id="6924858">!=</span>&nbsp;<span class="builtinfunc" id="6924861">len</span><span class="op" id="6924864">(</span><span class="ident" id="6924865"><a href="/net/tcp_test.go.html#6924807">buf</a></span><span class="op" id="6924868">)</span>&nbsp;<span class="op" id="6924870">||</span>&nbsp;<span class="ident" id="6924873"><a href="/net/tcp_test.go.html#6924831">err</a></span>&nbsp;<span class="op" id="6924877">!=</span>&nbsp;<span class="ident" id="6924880">nil</span>&nbsp;<span class="op" id="6924884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924889"><a href="/net/tcp_test.go.html#6924672">t</a></span><span class="op" id="6924890">.</span><span class="ident" id="6924891">Logf</span><span class="op" id="6924895">(</span><span class="string" id="6924896">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6924914">,</span>&nbsp;<span class="ident" id="6924916"><a href="/net/tcp_test.go.html#6924831">err</a></span><span class="op" id="6924919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924924">return</span>&nbsp;<span class="ident" id="6924931">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924943">return</span>&nbsp;<span class="ident" id="6924950">true</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924959">recvMsg</span>&nbsp;<span class="op" id="6924967">:=</span>&nbsp;<span class="keyword" id="6924970">func</span><span class="op" id="6924974">(</span><span class="ident" id="6924975">c</span>&nbsp;<span class="ident" id="6924977"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6924981">,</span>&nbsp;<span class="ident" id="6924983">buf</span>&nbsp;<span class="op" id="6924987">[</span><span class="op" id="6924988">]</span><span class="builtintype" id="6924989">byte</span><span class="op" id="6924993">)</span>&nbsp;<span class="builtintype" id="6924995">bool</span>&nbsp;<span class="op" id="6925000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925004">for</span>&nbsp;<span class="ident" id="6925008">read</span>&nbsp;<span class="op" id="6925013">:=</span>&nbsp;<span class="num" id="6925016">0</span><span class="op" id="6925017">;</span>&nbsp;<span class="ident" id="6925019"><a href="/net/tcp_test.go.html#6925008">read</a></span>&nbsp;<span class="op" id="6925024">!=</span>&nbsp;<span class="builtinfunc" id="6925027">len</span><span class="op" id="6925030">(</span><span class="ident" id="6925031"><a href="/net/tcp_test.go.html#6924983">buf</a></span><span class="op" id="6925034">)</span><span class="op" id="6925035">;</span>&nbsp;<span class="op" id="6925037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925042">n</span><span class="op" id="6925043">,</span>&nbsp;<span class="ident" id="6925045">err</span>&nbsp;<span class="op" id="6925049">:=</span>&nbsp;<span class="ident" id="6925052"><a href="/net/tcp_test.go.html#6924975">c</a></span><span class="op" id="6925053">.</span><span class="ident" id="6925054">Read</span><span class="op" id="6925058">(</span><span class="ident" id="6925059"><a href="/net/tcp_test.go.html#6924983">buf</a></span><span class="op" id="6925062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925067"><a href="/net/tcp_test.go.html#6925008">read</a></span>&nbsp;<span class="op" id="6925072">+=</span>&nbsp;<span class="ident" id="6925075"><a href="/net/tcp_test.go.html#6925042">n</a></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925080">if</span>&nbsp;<span class="ident" id="6925083"><a href="/net/tcp_test.go.html#6925045">err</a></span>&nbsp;<span class="op" id="6925087">!=</span>&nbsp;<span class="ident" id="6925090">nil</span>&nbsp;<span class="op" id="6925094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925100"><a href="/net/tcp_test.go.html#6924672">t</a></span><span class="op" id="6925101">.</span><span class="ident" id="6925102">Logf</span><span class="op" id="6925106">(</span><span class="string" id="6925107">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6925124">,</span>&nbsp;<span class="ident" id="6925126"><a href="/net/tcp_test.go.html#6925045">err</a></span><span class="op" id="6925129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925135">return</span>&nbsp;<span class="ident" id="6925142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925155">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925159">return</span>&nbsp;<span class="ident" id="6925166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925176">ln</span><span class="op" id="6925178">,</span>&nbsp;<span class="ident" id="6925180">err</span>&nbsp;<span class="op" id="6925184">:=</span>&nbsp;<span class="ident" id="6925187"><a href="/net/dial.go.html#2525176">Listen</a></span><span class="op" id="6925193">(</span><span class="string" id="6925194">&#34;tcp&#34;</span><span class="op" id="6925199">,</span>&nbsp;<span class="string" id="6925201">&#34;127.0.0.1:0&#34;</span><span class="op" id="6925214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925217">if</span>&nbsp;<span class="ident" id="6925220"><a href="/net/tcp_test.go.html#6925180">err</a></span>&nbsp;<span class="op" id="6925224">!=</span>&nbsp;<span class="ident" id="6925227">nil</span>&nbsp;<span class="op" id="6925231">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925235"><a href="/net/tcp_test.go.html#6924672">t</a></span><span class="op" id="6925236">.</span><span class="ident" id="6925237">Fatalf</span><span class="op" id="6925243">(</span><span class="string" id="6925244">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6925263">,</span>&nbsp;<span class="ident" id="6925265"><a href="/net/tcp_test.go.html#6925180">err</a></span><span class="op" id="6925268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925274">defer</span>&nbsp;<span class="ident" id="6925280"><a href="/net/tcp_test.go.html#6925176">ln</a></span><span class="op" id="6925282">.</span><span class="ident" id="6925283">Close</span><span class="op" id="6925288">(</span><span class="op" id="6925289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6925292">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925306">go</span>&nbsp;<span class="keyword" id="6925309">func</span><span class="op" id="6925313">(</span><span class="op" id="6925314">)</span>&nbsp;<span class="op" id="6925316">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925320">for</span>&nbsp;<span class="op" id="6925324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925329">c</span><span class="op" id="6925330">,</span>&nbsp;<span class="ident" id="6925332">err</span>&nbsp;<span class="op" id="6925336">:=</span>&nbsp;<span class="ident" id="6925339"><a href="/net/tcp_test.go.html#6925176">ln</a></span><span class="op" id="6925341">.</span><span class="ident" id="6925342">Accept</span><span class="op" id="6925348">(</span><span class="op" id="6925349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925354">if</span>&nbsp;<span class="ident" id="6925357"><a href="/net/tcp_test.go.html#6925332">err</a></span>&nbsp;<span class="op" id="6925361">!=</span>&nbsp;<span class="ident" id="6925364">nil</span>&nbsp;<span class="op" id="6925368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925374">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925383">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6925388">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925413">go</span>&nbsp;<span class="keyword" id="6925416">func</span><span class="op" id="6925420">(</span><span class="ident" id="6925421">c</span>&nbsp;<span class="ident" id="6925423"><a href="/net/net.go.html#2652476">Conn</a></span><span class="op" id="6925427">)</span>&nbsp;<span class="op" id="6925429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925435">defer</span>&nbsp;<span class="ident" id="6925441"><a href="/net/tcp_test.go.html#6925421">c</a></span><span class="op" id="6925442">.</span><span class="ident" id="6925443">Close</span><span class="op" id="6925448">(</span><span class="op" id="6925449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925455">var</span>&nbsp;<span class="ident" id="6925459">buf</span>&nbsp;<span class="op" id="6925463">[</span><span class="ident" id="6925464"><a href="/net/tcp_test.go.html#6924712">msgLen</a></span><span class="op" id="6925470">]</span><span class="builtintype" id="6925471">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925480">for</span>&nbsp;<span class="ident" id="6925484">m</span>&nbsp;<span class="op" id="6925486">:=</span>&nbsp;<span class="num" id="6925489">0</span><span class="op" id="6925490">;</span>&nbsp;<span class="ident" id="6925492"><a href="/net/tcp_test.go.html#6925484">m</a></span>&nbsp;<span class="op" id="6925494">&lt;</span>&nbsp;<span class="ident" id="6925496"><a href="/net/tcp_test.go.html#6924726">msgs</a></span><span class="op" id="6925500">;</span>&nbsp;<span class="ident" id="6925502"><a href="/net/tcp_test.go.html#6925484">m</a></span><span class="op" id="6925503">++</span>&nbsp;<span class="op" id="6925506">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925513">if</span>&nbsp;<span class="op" id="6925516">!</span><span class="ident" id="6925517"><a href="/net/tcp_test.go.html#6924959">recvMsg</a></span><span class="op" id="6925524">(</span><span class="ident" id="6925525"><a href="/net/tcp_test.go.html#6925421">c</a></span><span class="op" id="6925526">,</span>&nbsp;<span class="ident" id="6925528"><a href="/net/tcp_test.go.html#6925459">buf</a></span><span class="op" id="6925531">[</span><span class="op" id="6925532">:</span><span class="op" id="6925533">]</span><span class="op" id="6925534">)</span>&nbsp;<span class="op" id="6925536">||</span>&nbsp;<span class="op" id="6925539">!</span><span class="ident" id="6925540"><a href="/net/tcp_test.go.html#6924783">sendMsg</a></span><span class="op" id="6925547">(</span><span class="ident" id="6925548"><a href="/net/tcp_test.go.html#6925421">c</a></span><span class="op" id="6925549">,</span>&nbsp;<span class="ident" id="6925551"><a href="/net/tcp_test.go.html#6925459">buf</a></span><span class="op" id="6925554">[</span><span class="op" id="6925555">:</span><span class="op" id="6925556">]</span><span class="op" id="6925557">)</span>&nbsp;<span class="op" id="6925559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925567">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925589">}</span><span class="op" id="6925590">(</span><span class="ident" id="6925591"><a href="/net/tcp_test.go.html#6925329">c</a></span><span class="op" id="6925592">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925599">}</span><span class="op" id="6925600">(</span><span class="op" id="6925601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925604">done</span>&nbsp;<span class="op" id="6925609">:=</span>&nbsp;<span class="builtinfunc" id="6925612">make</span><span class="op" id="6925616">(</span><span class="keyword" id="6925617">chan</span>&nbsp;<span class="builtintype" id="6925622">bool</span><span class="op" id="6925626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925629">for</span>&nbsp;<span class="ident" id="6925633">i</span>&nbsp;<span class="op" id="6925635">:=</span>&nbsp;<span class="num" id="6925638">0</span><span class="op" id="6925639">;</span>&nbsp;<span class="ident" id="6925641"><a href="/net/tcp_test.go.html#6925633">i</a></span>&nbsp;<span class="op" id="6925643">&lt;</span>&nbsp;<span class="ident" id="6925645"><a href="/net/tcp_test.go.html#6924695">conns</a></span><span class="op" id="6925650">;</span>&nbsp;<span class="ident" id="6925652"><a href="/net/tcp_test.go.html#6925633">i</a></span><span class="op" id="6925653">++</span>&nbsp;<span class="op" id="6925656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6925660">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925684">go</span>&nbsp;<span class="keyword" id="6925687">func</span><span class="op" id="6925691">(</span><span class="op" id="6925692">)</span>&nbsp;<span class="op" id="6925694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925699">defer</span>&nbsp;<span class="keyword" id="6925705">func</span><span class="op" id="6925709">(</span><span class="op" id="6925710">)</span>&nbsp;<span class="op" id="6925712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925718"><a href="/net/tcp_test.go.html#6925604">done</a></span>&nbsp;<span class="op" id="6925723">&lt;-</span>&nbsp;<span class="ident" id="6925726">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925734">}</span><span class="op" id="6925735">(</span><span class="op" id="6925736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925741">c</span><span class="op" id="6925742">,</span>&nbsp;<span class="ident" id="6925744">err</span>&nbsp;<span class="op" id="6925748">:=</span>&nbsp;<span class="ident" id="6925751"><a href="/net/dial.go.html#2521518">Dial</a></span><span class="op" id="6925755">(</span><span class="string" id="6925756">&#34;tcp&#34;</span><span class="op" id="6925761">,</span>&nbsp;<span class="ident" id="6925763"><a href="/net/tcp_test.go.html#6925176">ln</a></span><span class="op" id="6925765">.</span><span class="ident" id="6925766">Addr</span><span class="op" id="6925770">(</span><span class="op" id="6925771">)</span><span class="op" id="6925772">.</span><span class="ident" id="6925773">String</span><span class="op" id="6925779">(</span><span class="op" id="6925780">)</span><span class="op" id="6925781">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925786">if</span>&nbsp;<span class="ident" id="6925789"><a href="/net/tcp_test.go.html#6925744">err</a></span>&nbsp;<span class="op" id="6925793">!=</span>&nbsp;<span class="ident" id="6925796">nil</span>&nbsp;<span class="op" id="6925800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925806"><a href="/net/tcp_test.go.html#6924672">t</a></span><span class="op" id="6925807">.</span><span class="ident" id="6925808">Logf</span><span class="op" id="6925812">(</span><span class="string" id="6925813">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6925830">,</span>&nbsp;<span class="ident" id="6925832"><a href="/net/tcp_test.go.html#6925744">err</a></span><span class="op" id="6925835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925856">defer</span>&nbsp;<span class="ident" id="6925862"><a href="/net/tcp_test.go.html#6925741">c</a></span><span class="op" id="6925863">.</span><span class="ident" id="6925864">Close</span><span class="op" id="6925869">(</span><span class="op" id="6925870">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925875">var</span>&nbsp;<span class="ident" id="6925879">buf</span>&nbsp;<span class="op" id="6925883">[</span><span class="ident" id="6925884"><a href="/net/tcp_test.go.html#6924712">msgLen</a></span><span class="op" id="6925890">]</span><span class="builtintype" id="6925891">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925899">for</span>&nbsp;<span class="ident" id="6925903">m</span>&nbsp;<span class="op" id="6925905">:=</span>&nbsp;<span class="num" id="6925908">0</span><span class="op" id="6925909">;</span>&nbsp;<span class="ident" id="6925911"><a href="/net/tcp_test.go.html#6925903">m</a></span>&nbsp;<span class="op" id="6925913">&lt;</span>&nbsp;<span class="ident" id="6925915"><a href="/net/tcp_test.go.html#6924726">msgs</a></span><span class="op" id="6925919">;</span>&nbsp;<span class="ident" id="6925921"><a href="/net/tcp_test.go.html#6925903">m</a></span><span class="op" id="6925922">++</span>&nbsp;<span class="op" id="6925925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925931">if</span>&nbsp;<span class="op" id="6925934">!</span><span class="ident" id="6925935"><a href="/net/tcp_test.go.html#6924783">sendMsg</a></span><span class="op" id="6925942">(</span><span class="ident" id="6925943"><a href="/net/tcp_test.go.html#6925741">c</a></span><span class="op" id="6925944">,</span>&nbsp;<span class="ident" id="6925946"><a href="/net/tcp_test.go.html#6925879">buf</a></span><span class="op" id="6925949">[</span><span class="op" id="6925950">:</span><span class="op" id="6925951">]</span><span class="op" id="6925952">)</span>&nbsp;<span class="op" id="6925954">||</span>&nbsp;<span class="op" id="6925957">!</span><span class="ident" id="6925958"><a href="/net/tcp_test.go.html#6924959">recvMsg</a></span><span class="op" id="6925965">(</span><span class="ident" id="6925966"><a href="/net/tcp_test.go.html#6925741">c</a></span><span class="op" id="6925967">,</span>&nbsp;<span class="ident" id="6925969"><a href="/net/tcp_test.go.html#6925879">buf</a></span><span class="op" id="6925972">[</span><span class="op" id="6925973">:</span><span class="op" id="6925974">]</span><span class="op" id="6925975">)</span>&nbsp;<span class="op" id="6925977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925984">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925994">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926003">}</span><span class="op" id="6926004">(</span><span class="op" id="6926005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926011">for</span>&nbsp;<span class="ident" id="6926015">i</span>&nbsp;<span class="op" id="6926017">:=</span>&nbsp;<span class="num" id="6926020">0</span><span class="op" id="6926021">;</span>&nbsp;<span class="ident" id="6926023"><a href="/net/tcp_test.go.html#6926015">i</a></span>&nbsp;<span class="op" id="6926025">&lt;</span>&nbsp;<span class="ident" id="6926027"><a href="/net/tcp_test.go.html#6924695">conns</a></span><span class="op" id="6926032">;</span>&nbsp;<span class="ident" id="6926034"><a href="/net/tcp_test.go.html#6926015">i</a></span><span class="op" id="6926035">++</span>&nbsp;<span class="op" id="6926038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926042">&lt;-</span><span class="ident" id="6926044"><a href="/net/tcp_test.go.html#6925604">done</a></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926050">}</span><br>
<span class="lineno"></span><span class="op" id="6926052">}</span>
</div>
</body>
</html>
